var yie=Object.defineProperty;var bie=(e,t,r)=>t in e?yie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Fs=(e,t,r)=>(bie(e,typeof t!="symbol"?t+"":t,r),r);function wie(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var Tl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function _ie(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var UV={exports:{}},pC={},VV={exports:{}},as={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B1=Symbol.for("react.element"),jie=Symbol.for("react.portal"),Nie=Symbol.for("react.fragment"),Sie=Symbol.for("react.strict_mode"),Cie=Symbol.for("react.profiler"),Aie=Symbol.for("react.provider"),Pie=Symbol.for("react.context"),Eie=Symbol.for("react.forward_ref"),kie=Symbol.for("react.suspense"),Iie=Symbol.for("react.memo"),Oie=Symbol.for("react.lazy"),BF=Symbol.iterator;function Tie(e){return e===null||typeof e!="object"?null:(e=BF&&e[BF]||e["@@iterator"],typeof e=="function"?e:null)}var WV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HV=Object.assign,GV={};function q0(e,t,r){this.props=e,this.context=t,this.refs=GV,this.updater=r||WV}q0.prototype.isReactComponent={};q0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};q0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function KV(){}KV.prototype=q0.prototype;function K3(e,t,r){this.props=e,this.context=t,this.refs=GV,this.updater=r||WV}var X3=K3.prototype=new KV;X3.constructor=K3;HV(X3,q0.prototype);X3.isPureReactComponent=!0;var qF=Array.isArray,XV=Object.prototype.hasOwnProperty,Y3={current:null},YV={key:!0,ref:!0,__self:!0,__source:!0};function JV(e,t,r){var n,s={},o=null,i=null;if(t!=null)for(n in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(o=""+t.key),t)XV.call(t,n)&&!YV.hasOwnProperty(n)&&(s[n]=t[n]);var l=arguments.length-2;if(l===1)s.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps,l)s[n]===void 0&&(s[n]=l[n]);return{$$typeof:B1,type:e,key:o,ref:i,props:s,_owner:Y3.current}}function Die(e,t){return{$$typeof:B1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function J3(e){return typeof e=="object"&&e!==null&&e.$$typeof===B1}function Mie(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var zF=/\/+/g;function QA(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Mie(""+e.key):t.toString(36)}function ij(e,t,r,n,s){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case B1:case jie:i=!0}}if(i)return i=e,s=s(i),e=n===""?"."+QA(i,0):n,qF(s)?(r="",e!=null&&(r=e.replace(zF,"$&/")+"/"),ij(s,t,r,"",function(d){return d})):s!=null&&(J3(s)&&(s=Die(s,r+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(zF,"$&/")+"/")+e)),t.push(s)),1;if(i=0,n=n===""?".":n+":",qF(e))for(var l=0;l<e.length;l++){o=e[l];var c=n+QA(o,l);i+=ij(o,t,r,c,s)}else if(c=Tie(e),typeof c=="function")for(e=c.call(e),l=0;!(o=e.next()).done;)o=o.value,c=n+QA(o,l++),i+=ij(o,t,r,c,s);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function z2(e,t,r){if(e==null)return e;var n=[],s=0;return ij(e,n,"","",function(o){return t.call(r,o,s++)}),n}function Rie(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var dc={current:null},lj={transition:null},Fie={ReactCurrentDispatcher:dc,ReactCurrentBatchConfig:lj,ReactCurrentOwner:Y3};function QV(){throw Error("act(...) is not supported in production builds of React.")}as.Children={map:z2,forEach:function(e,t,r){z2(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return z2(e,function(){t++}),t},toArray:function(e){return z2(e,function(t){return t})||[]},only:function(e){if(!J3(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};as.Component=q0;as.Fragment=Nie;as.Profiler=Cie;as.PureComponent=K3;as.StrictMode=Sie;as.Suspense=kie;as.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fie;as.act=QV;as.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=HV({},e.props),s=e.key,o=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,i=Y3.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)XV.call(t,c)&&!YV.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];n.children=l}return{$$typeof:B1,type:e.type,key:s,ref:o,props:n,_owner:i}};as.createContext=function(e){return e={$$typeof:Pie,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Aie,_context:e},e.Consumer=e};as.createElement=JV;as.createFactory=function(e){var t=JV.bind(null,e);return t.type=e,t};as.createRef=function(){return{current:null}};as.forwardRef=function(e){return{$$typeof:Eie,render:e}};as.isValidElement=J3;as.lazy=function(e){return{$$typeof:Oie,_payload:{_status:-1,_result:e},_init:Rie}};as.memo=function(e,t){return{$$typeof:Iie,type:e,compare:t===void 0?null:t}};as.startTransition=function(e){var t=lj.transition;lj.transition={};try{e()}finally{lj.transition=t}};as.unstable_act=QV;as.useCallback=function(e,t){return dc.current.useCallback(e,t)};as.useContext=function(e){return dc.current.useContext(e)};as.useDebugValue=function(){};as.useDeferredValue=function(e){return dc.current.useDeferredValue(e)};as.useEffect=function(e,t){return dc.current.useEffect(e,t)};as.useId=function(){return dc.current.useId()};as.useImperativeHandle=function(e,t,r){return dc.current.useImperativeHandle(e,t,r)};as.useInsertionEffect=function(e,t){return dc.current.useInsertionEffect(e,t)};as.useLayoutEffect=function(e,t){return dc.current.useLayoutEffect(e,t)};as.useMemo=function(e,t){return dc.current.useMemo(e,t)};as.useReducer=function(e,t,r){return dc.current.useReducer(e,t,r)};as.useRef=function(e){return dc.current.useRef(e)};as.useState=function(e){return dc.current.useState(e)};as.useSyncExternalStore=function(e,t,r){return dc.current.useSyncExternalStore(e,t,r)};as.useTransition=function(){return dc.current.useTransition()};as.version="18.3.1";VV.exports=as;var p=VV.exports;const Ee=xs(p),Q3=wie({__proto__:null,default:Ee},[p]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lie=p,$ie=Symbol.for("react.element"),Bie=Symbol.for("react.fragment"),qie=Object.prototype.hasOwnProperty,zie=Lie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Uie={key:!0,ref:!0,__self:!0,__source:!0};function ZV(e,t,r){var n,s={},o=null,i=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)qie.call(t,n)&&!Uie.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:$ie,type:e,key:o,ref:i,props:s,_owner:zie.current}}pC.Fragment=Bie;pC.jsx=ZV;pC.jsxs=ZV;UV.exports=pC;var a=UV.exports,zk={},eW={exports:{}},wd={},tW={exports:{}},rW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(L,W){var ge=L.length;L.push(W);e:for(;0<ge;){var Ae=ge-1>>>1,V=L[Ae];if(0<s(V,W))L[Ae]=W,L[ge]=V,ge=Ae;else break e}}function r(L){return L.length===0?null:L[0]}function n(L){if(L.length===0)return null;var W=L[0],ge=L.pop();if(ge!==W){L[0]=ge;e:for(var Ae=0,V=L.length,$=V>>>1;Ae<$;){var Y=2*(Ae+1)-1,he=L[Y],J=Y+1,G=L[J];if(0>s(he,ge))J<V&&0>s(G,he)?(L[Ae]=G,L[J]=ge,Ae=J):(L[Ae]=he,L[Y]=ge,Ae=Y);else if(J<V&&0>s(G,ge))L[Ae]=G,L[J]=ge,Ae=J;else break e}}return W}function s(L,W){var ge=L.sortIndex-W.sortIndex;return ge!==0?ge:L.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();e.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,f=null,h=3,m=!1,x=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(L){for(var W=r(d);W!==null;){if(W.callback===null)n(d);else if(W.startTime<=L)n(d),W.sortIndex=W.expirationTime,t(c,W);else break;W=r(d)}}function _(L){if(g=!1,w(L),!x)if(r(c)!==null)x=!0,z(j);else{var W=r(d);W!==null&&U(_,W.startTime-L)}}function j(L,W){x=!1,g&&(g=!1,v(A),A=-1),m=!0;var ge=h;try{for(w(W),f=r(c);f!==null&&(!(f.expirationTime>W)||L&&!O());){var Ae=f.callback;if(typeof Ae=="function"){f.callback=null,h=f.priorityLevel;var V=Ae(f.expirationTime<=W);W=e.unstable_now(),typeof V=="function"?f.callback=V:f===r(c)&&n(c),w(W)}else n(c);f=r(c)}if(f!==null)var $=!0;else{var Y=r(d);Y!==null&&U(_,Y.startTime-W),$=!1}return $}finally{f=null,h=ge,m=!1}}var S=!1,C=null,A=-1,P=5,F=-1;function O(){return!(e.unstable_now()-F<P)}function I(){if(C!==null){var L=e.unstable_now();F=L;var W=!0;try{W=C(!0,L)}finally{W?T():(S=!1,C=null)}}else S=!1}var T;if(typeof b=="function")T=function(){b(I)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,B=k.port2;k.port1.onmessage=I,T=function(){B.postMessage(null)}}else T=function(){y(I,0)};function z(L){C=L,S||(S=!0,T())}function U(L,W){A=y(function(){L(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){x||m||(x=!0,z(j))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(L){switch(h){case 1:case 2:case 3:var W=3;break;default:W=h}var ge=h;h=W;try{return L()}finally{h=ge}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,W){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var ge=h;h=L;try{return W()}finally{h=ge}},e.unstable_scheduleCallback=function(L,W,ge){var Ae=e.unstable_now();switch(typeof ge=="object"&&ge!==null?(ge=ge.delay,ge=typeof ge=="number"&&0<ge?Ae+ge:Ae):ge=Ae,L){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=ge+V,L={id:u++,callback:W,priorityLevel:L,startTime:ge,expirationTime:V,sortIndex:-1},ge>Ae?(L.sortIndex=ge,t(d,L),r(c)===null&&L===r(d)&&(g?(v(A),A=-1):g=!0,U(_,ge-Ae))):(L.sortIndex=V,t(c,L),x||m||(x=!0,z(j))),L},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(L){var W=h;return function(){var ge=h;h=W;try{return L.apply(this,arguments)}finally{h=ge}}}})(rW);tW.exports=rW;var Vie=tW.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wie=p,yd=Vie;function yn(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nW=new Set,cw={};function ax(e,t){Hv(e,t),Hv(e+"Capture",t)}function Hv(e,t){for(cw[e]=t,e=0;e<t.length;e++)nW.add(t[e])}var wm=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uk=Object.prototype.hasOwnProperty,Hie=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,UF={},VF={};function Gie(e){return Uk.call(VF,e)?!0:Uk.call(UF,e)?!1:Hie.test(e)?VF[e]=!0:(UF[e]=!0,!1)}function Kie(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Xie(e,t,r,n){if(t===null||typeof t>"u"||Kie(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function uc(e,t,r,n,s,o,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=i}var fl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){fl[e]=new uc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];fl[t]=new uc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){fl[e]=new uc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){fl[e]=new uc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){fl[e]=new uc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){fl[e]=new uc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){fl[e]=new uc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){fl[e]=new uc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){fl[e]=new uc(e,5,!1,e.toLowerCase(),null,!1,!1)});var Z3=/[\-:]([a-z])/g;function e4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Z3,e4);fl[t]=new uc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Z3,e4);fl[t]=new uc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Z3,e4);fl[t]=new uc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){fl[e]=new uc(e,1,!1,e.toLowerCase(),null,!1,!1)});fl.xlinkHref=new uc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){fl[e]=new uc(e,1,!1,e.toLowerCase(),null,!0,!0)});function t4(e,t,r,n){var s=fl.hasOwnProperty(t)?fl[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Xie(t,r,s,n)&&(r=null),n||s===null?Gie(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Mm=Wie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,U2=Symbol.for("react.element"),rv=Symbol.for("react.portal"),nv=Symbol.for("react.fragment"),r4=Symbol.for("react.strict_mode"),Vk=Symbol.for("react.profiler"),aW=Symbol.for("react.provider"),sW=Symbol.for("react.context"),n4=Symbol.for("react.forward_ref"),Wk=Symbol.for("react.suspense"),Hk=Symbol.for("react.suspense_list"),a4=Symbol.for("react.memo"),ch=Symbol.for("react.lazy"),oW=Symbol.for("react.offscreen"),WF=Symbol.iterator;function Py(e){return e===null||typeof e!="object"?null:(e=WF&&e[WF]||e["@@iterator"],typeof e=="function"?e:null)}var $o=Object.assign,ZA;function db(e){if(ZA===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);ZA=t&&t[1]||""}return`
`+ZA+e}var eP=!1;function tP(e,t){if(!e||eP)return"";eP=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),o=n.stack.split(`
`),i=s.length-1,l=o.length-1;1<=i&&0<=l&&s[i]!==o[l];)l--;for(;1<=i&&0<=l;i--,l--)if(s[i]!==o[l]){if(i!==1||l!==1)do if(i--,l--,0>l||s[i]!==o[l]){var c=`
`+s[i].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=i&&0<=l);break}}}finally{eP=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?db(e):""}function Yie(e){switch(e.tag){case 5:return db(e.type);case 16:return db("Lazy");case 13:return db("Suspense");case 19:return db("SuspenseList");case 0:case 2:case 15:return e=tP(e.type,!1),e;case 11:return e=tP(e.type.render,!1),e;case 1:return e=tP(e.type,!0),e;default:return""}}function Gk(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case nv:return"Fragment";case rv:return"Portal";case Vk:return"Profiler";case r4:return"StrictMode";case Wk:return"Suspense";case Hk:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case sW:return(e.displayName||"Context")+".Consumer";case aW:return(e._context.displayName||"Context")+".Provider";case n4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case a4:return t=e.displayName||null,t!==null?t:Gk(e.type)||"Memo";case ch:t=e._payload,e=e._init;try{return Gk(e(t))}catch{}}return null}function Jie(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gk(t);case 8:return t===r4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function np(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function iW(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Qie(e){var t=iW(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(i){n=""+i,o.call(this,i)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function V2(e){e._valueTracker||(e._valueTracker=Qie(e))}function lW(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=iW(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Bj(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Kk(e,t){var r=t.checked;return $o({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function HF(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=np(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function cW(e,t){t=t.checked,t!=null&&t4(e,"checked",t,!1)}function Xk(e,t){cW(e,t);var r=np(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Yk(e,t.type,r):t.hasOwnProperty("defaultValue")&&Yk(e,t.type,np(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function GF(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Yk(e,t,r){(t!=="number"||Bj(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var ub=Array.isArray;function Cv(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+np(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function Jk(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(yn(91));return $o({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function KF(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(yn(92));if(ub(r)){if(1<r.length)throw Error(yn(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:np(r)}}function dW(e,t){var r=np(t.value),n=np(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function XF(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function uW(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qk(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?uW(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var W2,fW=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(W2=W2||document.createElement("div"),W2.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=W2.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function dw(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var _b={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zie=["Webkit","ms","Moz","O"];Object.keys(_b).forEach(function(e){Zie.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_b[t]=_b[e]})});function mW(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||_b.hasOwnProperty(e)&&_b[e]?(""+t).trim():t+"px"}function hW(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=mW(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var ele=$o({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zk(e,t){if(t){if(ele[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(yn(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(yn(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(yn(61))}if(t.style!=null&&typeof t.style!="object")throw Error(yn(62))}}function eI(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tI=null;function s4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var rI=null,Av=null,Pv=null;function YF(e){if(e=U1(e)){if(typeof rI!="function")throw Error(yn(280));var t=e.stateNode;t&&(t=bC(t),rI(e.stateNode,e.type,t))}}function pW(e){Av?Pv?Pv.push(e):Pv=[e]:Av=e}function gW(){if(Av){var e=Av,t=Pv;if(Pv=Av=null,YF(e),t)for(e=0;e<t.length;e++)YF(t[e])}}function xW(e,t){return e(t)}function vW(){}var rP=!1;function yW(e,t,r){if(rP)return e(t,r);rP=!0;try{return xW(e,t,r)}finally{rP=!1,(Av!==null||Pv!==null)&&(vW(),gW())}}function uw(e,t){var r=e.stateNode;if(r===null)return null;var n=bC(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(yn(231,t,typeof r));return r}var nI=!1;if(wm)try{var Ey={};Object.defineProperty(Ey,"passive",{get:function(){nI=!0}}),window.addEventListener("test",Ey,Ey),window.removeEventListener("test",Ey,Ey)}catch{nI=!1}function tle(e,t,r,n,s,o,i,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(u){this.onError(u)}}var jb=!1,qj=null,zj=!1,aI=null,rle={onError:function(e){jb=!0,qj=e}};function nle(e,t,r,n,s,o,i,l,c){jb=!1,qj=null,tle.apply(rle,arguments)}function ale(e,t,r,n,s,o,i,l,c){if(nle.apply(this,arguments),jb){if(jb){var d=qj;jb=!1,qj=null}else throw Error(yn(198));zj||(zj=!0,aI=d)}}function sx(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function bW(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function JF(e){if(sx(e)!==e)throw Error(yn(188))}function sle(e){var t=e.alternate;if(!t){if(t=sx(e),t===null)throw Error(yn(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var o=s.alternate;if(o===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===r)return JF(s),e;if(o===n)return JF(s),t;o=o.sibling}throw Error(yn(188))}if(r.return!==n.return)r=s,n=o;else{for(var i=!1,l=s.child;l;){if(l===r){i=!0,r=s,n=o;break}if(l===n){i=!0,n=s,r=o;break}l=l.sibling}if(!i){for(l=o.child;l;){if(l===r){i=!0,r=o,n=s;break}if(l===n){i=!0,n=o,r=s;break}l=l.sibling}if(!i)throw Error(yn(189))}}if(r.alternate!==n)throw Error(yn(190))}if(r.tag!==3)throw Error(yn(188));return r.stateNode.current===r?e:t}function wW(e){return e=sle(e),e!==null?_W(e):null}function _W(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=_W(e);if(t!==null)return t;e=e.sibling}return null}var jW=yd.unstable_scheduleCallback,QF=yd.unstable_cancelCallback,ole=yd.unstable_shouldYield,ile=yd.unstable_requestPaint,Zo=yd.unstable_now,lle=yd.unstable_getCurrentPriorityLevel,o4=yd.unstable_ImmediatePriority,NW=yd.unstable_UserBlockingPriority,Uj=yd.unstable_NormalPriority,cle=yd.unstable_LowPriority,SW=yd.unstable_IdlePriority,gC=null,jf=null;function dle(e){if(jf&&typeof jf.onCommitFiberRoot=="function")try{jf.onCommitFiberRoot(gC,e,void 0,(e.current.flags&128)===128)}catch{}}var Mu=Math.clz32?Math.clz32:mle,ule=Math.log,fle=Math.LN2;function mle(e){return e>>>=0,e===0?32:31-(ule(e)/fle|0)|0}var H2=64,G2=4194304;function fb(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Vj(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,o=e.pingedLanes,i=r&268435455;if(i!==0){var l=i&~s;l!==0?n=fb(l):(o&=i,o!==0&&(n=fb(o)))}else i=r&~s,i!==0?n=fb(i):o!==0&&(n=fb(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,o=t&-t,s>=o||s===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Mu(t),s=1<<r,n|=e[r],t&=~s;return n}function hle(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ple(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,o=e.pendingLanes;0<o;){var i=31-Mu(o),l=1<<i,c=s[i];c===-1?(!(l&r)||l&n)&&(s[i]=hle(l,t)):c<=t&&(e.expiredLanes|=l),o&=~l}}function sI(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function CW(){var e=H2;return H2<<=1,!(H2&4194240)&&(H2=64),e}function nP(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function q1(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Mu(t),e[t]=r}function gle(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-Mu(r),o=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~o}}function i4(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Mu(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var Bs=0;function AW(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var PW,l4,EW,kW,IW,oI=!1,K2=[],Oh=null,Th=null,Dh=null,fw=new Map,mw=new Map,hh=[],xle="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ZF(e,t){switch(e){case"focusin":case"focusout":Oh=null;break;case"dragenter":case"dragleave":Th=null;break;case"mouseover":case"mouseout":Dh=null;break;case"pointerover":case"pointerout":fw.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":mw.delete(t.pointerId)}}function ky(e,t,r,n,s,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[s]},t!==null&&(t=U1(t),t!==null&&l4(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function vle(e,t,r,n,s){switch(t){case"focusin":return Oh=ky(Oh,e,t,r,n,s),!0;case"dragenter":return Th=ky(Th,e,t,r,n,s),!0;case"mouseover":return Dh=ky(Dh,e,t,r,n,s),!0;case"pointerover":var o=s.pointerId;return fw.set(o,ky(fw.get(o)||null,e,t,r,n,s)),!0;case"gotpointercapture":return o=s.pointerId,mw.set(o,ky(mw.get(o)||null,e,t,r,n,s)),!0}return!1}function OW(e){var t=sg(e.target);if(t!==null){var r=sx(t);if(r!==null){if(t=r.tag,t===13){if(t=bW(r),t!==null){e.blockedOn=t,IW(e.priority,function(){EW(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function cj(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=iI(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);tI=n,r.target.dispatchEvent(n),tI=null}else return t=U1(r),t!==null&&l4(t),e.blockedOn=r,!1;t.shift()}return!0}function eL(e,t,r){cj(e)&&r.delete(t)}function yle(){oI=!1,Oh!==null&&cj(Oh)&&(Oh=null),Th!==null&&cj(Th)&&(Th=null),Dh!==null&&cj(Dh)&&(Dh=null),fw.forEach(eL),mw.forEach(eL)}function Iy(e,t){e.blockedOn===t&&(e.blockedOn=null,oI||(oI=!0,yd.unstable_scheduleCallback(yd.unstable_NormalPriority,yle)))}function hw(e){function t(s){return Iy(s,e)}if(0<K2.length){Iy(K2[0],e);for(var r=1;r<K2.length;r++){var n=K2[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Oh!==null&&Iy(Oh,e),Th!==null&&Iy(Th,e),Dh!==null&&Iy(Dh,e),fw.forEach(t),mw.forEach(t),r=0;r<hh.length;r++)n=hh[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<hh.length&&(r=hh[0],r.blockedOn===null);)OW(r),r.blockedOn===null&&hh.shift()}var Ev=Mm.ReactCurrentBatchConfig,Wj=!0;function ble(e,t,r,n){var s=Bs,o=Ev.transition;Ev.transition=null;try{Bs=1,c4(e,t,r,n)}finally{Bs=s,Ev.transition=o}}function wle(e,t,r,n){var s=Bs,o=Ev.transition;Ev.transition=null;try{Bs=4,c4(e,t,r,n)}finally{Bs=s,Ev.transition=o}}function c4(e,t,r,n){if(Wj){var s=iI(e,t,r,n);if(s===null)mP(e,t,n,Hj,r),ZF(e,n);else if(vle(s,e,t,r,n))n.stopPropagation();else if(ZF(e,n),t&4&&-1<xle.indexOf(e)){for(;s!==null;){var o=U1(s);if(o!==null&&PW(o),o=iI(e,t,r,n),o===null&&mP(e,t,n,Hj,r),o===s)break;s=o}s!==null&&n.stopPropagation()}else mP(e,t,n,null,r)}}var Hj=null;function iI(e,t,r,n){if(Hj=null,e=s4(n),e=sg(e),e!==null)if(t=sx(e),t===null)e=null;else if(r=t.tag,r===13){if(e=bW(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Hj=e,null}function TW(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lle()){case o4:return 1;case NW:return 4;case Uj:case cle:return 16;case SW:return 536870912;default:return 16}default:return 16}}var wh=null,d4=null,dj=null;function DW(){if(dj)return dj;var e,t=d4,r=t.length,n,s="value"in wh?wh.value:wh.textContent,o=s.length;for(e=0;e<r&&t[e]===s[e];e++);var i=r-e;for(n=1;n<=i&&t[r-n]===s[o-n];n++);return dj=s.slice(e,1<n?1-n:void 0)}function uj(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function X2(){return!0}function tL(){return!1}function _d(e){function t(r,n,s,o,i){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(r=e[l],this[l]=r?r(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?X2:tL,this.isPropagationStopped=tL,this}return $o(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=X2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=X2)},persist:function(){},isPersistent:X2}),t}var z0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},u4=_d(z0),z1=$o({},z0,{view:0,detail:0}),_le=_d(z1),aP,sP,Oy,xC=$o({},z1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:f4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Oy&&(Oy&&e.type==="mousemove"?(aP=e.screenX-Oy.screenX,sP=e.screenY-Oy.screenY):sP=aP=0,Oy=e),aP)},movementY:function(e){return"movementY"in e?e.movementY:sP}}),rL=_d(xC),jle=$o({},xC,{dataTransfer:0}),Nle=_d(jle),Sle=$o({},z1,{relatedTarget:0}),oP=_d(Sle),Cle=$o({},z0,{animationName:0,elapsedTime:0,pseudoElement:0}),Ale=_d(Cle),Ple=$o({},z0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ele=_d(Ple),kle=$o({},z0,{data:0}),nL=_d(kle),Ile={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ole={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tle={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Dle(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Tle[e])?!!t[e]:!1}function f4(){return Dle}var Mle=$o({},z1,{key:function(e){if(e.key){var t=Ile[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=uj(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Ole[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:f4,charCode:function(e){return e.type==="keypress"?uj(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?uj(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rle=_d(Mle),Fle=$o({},xC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),aL=_d(Fle),Lle=$o({},z1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:f4}),$le=_d(Lle),Ble=$o({},z0,{propertyName:0,elapsedTime:0,pseudoElement:0}),qle=_d(Ble),zle=$o({},xC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ule=_d(zle),Vle=[9,13,27,32],m4=wm&&"CompositionEvent"in window,Nb=null;wm&&"documentMode"in document&&(Nb=document.documentMode);var Wle=wm&&"TextEvent"in window&&!Nb,MW=wm&&(!m4||Nb&&8<Nb&&11>=Nb),sL=String.fromCharCode(32),oL=!1;function RW(e,t){switch(e){case"keyup":return Vle.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function FW(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var av=!1;function Hle(e,t){switch(e){case"compositionend":return FW(t);case"keypress":return t.which!==32?null:(oL=!0,sL);case"textInput":return e=t.data,e===sL&&oL?null:e;default:return null}}function Gle(e,t){if(av)return e==="compositionend"||!m4&&RW(e,t)?(e=DW(),dj=d4=wh=null,av=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return MW&&t.locale!=="ko"?null:t.data;default:return null}}var Kle={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iL(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Kle[e.type]:t==="textarea"}function LW(e,t,r,n){pW(n),t=Gj(t,"onChange"),0<t.length&&(r=new u4("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Sb=null,pw=null;function Xle(e){XW(e,0)}function vC(e){var t=iv(e);if(lW(t))return e}function Yle(e,t){if(e==="change")return t}var $W=!1;if(wm){var iP;if(wm){var lP="oninput"in document;if(!lP){var lL=document.createElement("div");lL.setAttribute("oninput","return;"),lP=typeof lL.oninput=="function"}iP=lP}else iP=!1;$W=iP&&(!document.documentMode||9<document.documentMode)}function cL(){Sb&&(Sb.detachEvent("onpropertychange",BW),pw=Sb=null)}function BW(e){if(e.propertyName==="value"&&vC(pw)){var t=[];LW(t,pw,e,s4(e)),yW(Xle,t)}}function Jle(e,t,r){e==="focusin"?(cL(),Sb=t,pw=r,Sb.attachEvent("onpropertychange",BW)):e==="focusout"&&cL()}function Qle(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return vC(pw)}function Zle(e,t){if(e==="click")return vC(t)}function ece(e,t){if(e==="input"||e==="change")return vC(t)}function tce(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Bu=typeof Object.is=="function"?Object.is:tce;function gw(e,t){if(Bu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!Uk.call(t,s)||!Bu(e[s],t[s]))return!1}return!0}function dL(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function uL(e,t){var r=dL(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=dL(r)}}function qW(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qW(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function zW(){for(var e=window,t=Bj();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Bj(e.document)}return t}function h4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function rce(e){var t=zW(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&qW(r.ownerDocument.documentElement,r)){if(n!==null&&h4(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,o=Math.min(n.start,s);n=n.end===void 0?o:Math.min(n.end,s),!e.extend&&o>n&&(s=n,n=o,o=s),s=uL(r,o);var i=uL(r,n);s&&i&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var nce=wm&&"documentMode"in document&&11>=document.documentMode,sv=null,lI=null,Cb=null,cI=!1;function fL(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;cI||sv==null||sv!==Bj(n)||(n=sv,"selectionStart"in n&&h4(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Cb&&gw(Cb,n)||(Cb=n,n=Gj(lI,"onSelect"),0<n.length&&(t=new u4("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=sv)))}function Y2(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var ov={animationend:Y2("Animation","AnimationEnd"),animationiteration:Y2("Animation","AnimationIteration"),animationstart:Y2("Animation","AnimationStart"),transitionend:Y2("Transition","TransitionEnd")},cP={},UW={};wm&&(UW=document.createElement("div").style,"AnimationEvent"in window||(delete ov.animationend.animation,delete ov.animationiteration.animation,delete ov.animationstart.animation),"TransitionEvent"in window||delete ov.transitionend.transition);function yC(e){if(cP[e])return cP[e];if(!ov[e])return e;var t=ov[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in UW)return cP[e]=t[r];return e}var VW=yC("animationend"),WW=yC("animationiteration"),HW=yC("animationstart"),GW=yC("transitionend"),KW=new Map,mL="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gp(e,t){KW.set(e,t),ax(t,[e])}for(var dP=0;dP<mL.length;dP++){var uP=mL[dP],ace=uP.toLowerCase(),sce=uP[0].toUpperCase()+uP.slice(1);gp(ace,"on"+sce)}gp(VW,"onAnimationEnd");gp(WW,"onAnimationIteration");gp(HW,"onAnimationStart");gp("dblclick","onDoubleClick");gp("focusin","onFocus");gp("focusout","onBlur");gp(GW,"onTransitionEnd");Hv("onMouseEnter",["mouseout","mouseover"]);Hv("onMouseLeave",["mouseout","mouseover"]);Hv("onPointerEnter",["pointerout","pointerover"]);Hv("onPointerLeave",["pointerout","pointerover"]);ax("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ax("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ax("onBeforeInput",["compositionend","keypress","textInput","paste"]);ax("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ax("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ax("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oce=new Set("cancel close invalid load scroll toggle".split(" ").concat(mb));function hL(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,ale(n,t,void 0,e),e.currentTarget=null}function XW(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var i=n.length-1;0<=i;i--){var l=n[i],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==o&&s.isPropagationStopped())break e;hL(s,l,d),o=c}else for(i=0;i<n.length;i++){if(l=n[i],c=l.instance,d=l.currentTarget,l=l.listener,c!==o&&s.isPropagationStopped())break e;hL(s,l,d),o=c}}}if(zj)throw e=aI,zj=!1,aI=null,e}function xo(e,t){var r=t[hI];r===void 0&&(r=t[hI]=new Set);var n=e+"__bubble";r.has(n)||(YW(t,e,2,!1),r.add(n))}function fP(e,t,r){var n=0;t&&(n|=4),YW(r,e,n,t)}var J2="_reactListening"+Math.random().toString(36).slice(2);function xw(e){if(!e[J2]){e[J2]=!0,nW.forEach(function(r){r!=="selectionchange"&&(oce.has(r)||fP(r,!1,e),fP(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[J2]||(t[J2]=!0,fP("selectionchange",!1,t))}}function YW(e,t,r,n){switch(TW(t)){case 1:var s=ble;break;case 4:s=wle;break;default:s=c4}r=s.bind(null,t,r,e),s=void 0,!nI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function mP(e,t,r,n,s){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var l=n.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(i===4)for(i=n.return;i!==null;){var c=i.tag;if((c===3||c===4)&&(c=i.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;i=i.return}for(;l!==null;){if(i=sg(l),i===null)return;if(c=i.tag,c===5||c===6){n=o=i;continue e}l=l.parentNode}}n=n.return}yW(function(){var d=o,u=s4(r),f=[];e:{var h=KW.get(e);if(h!==void 0){var m=u4,x=e;switch(e){case"keypress":if(uj(r)===0)break e;case"keydown":case"keyup":m=Rle;break;case"focusin":x="focus",m=oP;break;case"focusout":x="blur",m=oP;break;case"beforeblur":case"afterblur":m=oP;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=rL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Nle;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=$le;break;case VW:case WW:case HW:m=Ale;break;case GW:m=qle;break;case"scroll":m=_le;break;case"wheel":m=Ule;break;case"copy":case"cut":case"paste":m=Ele;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=aL}var g=(t&4)!==0,y=!g&&e==="scroll",v=g?h!==null?h+"Capture":null:h;g=[];for(var b=d,w;b!==null;){w=b;var _=w.stateNode;if(w.tag===5&&_!==null&&(w=_,v!==null&&(_=uw(b,v),_!=null&&g.push(vw(b,_,w)))),y)break;b=b.return}0<g.length&&(h=new m(h,x,null,r,u),f.push({event:h,listeners:g}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",h&&r!==tI&&(x=r.relatedTarget||r.fromElement)&&(sg(x)||x[_m]))break e;if((m||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,m?(x=r.relatedTarget||r.toElement,m=d,x=x?sg(x):null,x!==null&&(y=sx(x),x!==y||x.tag!==5&&x.tag!==6)&&(x=null)):(m=null,x=d),m!==x)){if(g=rL,_="onMouseLeave",v="onMouseEnter",b="mouse",(e==="pointerout"||e==="pointerover")&&(g=aL,_="onPointerLeave",v="onPointerEnter",b="pointer"),y=m==null?h:iv(m),w=x==null?h:iv(x),h=new g(_,b+"leave",m,r,u),h.target=y,h.relatedTarget=w,_=null,sg(u)===d&&(g=new g(v,b+"enter",x,r,u),g.target=w,g.relatedTarget=y,_=g),y=_,m&&x)t:{for(g=m,v=x,b=0,w=g;w;w=Nx(w))b++;for(w=0,_=v;_;_=Nx(_))w++;for(;0<b-w;)g=Nx(g),b--;for(;0<w-b;)v=Nx(v),w--;for(;b--;){if(g===v||v!==null&&g===v.alternate)break t;g=Nx(g),v=Nx(v)}g=null}else g=null;m!==null&&pL(f,h,m,g,!1),x!==null&&y!==null&&pL(f,y,x,g,!0)}}e:{if(h=d?iv(d):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var j=Yle;else if(iL(h))if($W)j=ece;else{j=Qle;var S=Jle}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(j=Zle);if(j&&(j=j(e,d))){LW(f,j,r,u);break e}S&&S(e,h,d),e==="focusout"&&(S=h._wrapperState)&&S.controlled&&h.type==="number"&&Yk(h,"number",h.value)}switch(S=d?iv(d):window,e){case"focusin":(iL(S)||S.contentEditable==="true")&&(sv=S,lI=d,Cb=null);break;case"focusout":Cb=lI=sv=null;break;case"mousedown":cI=!0;break;case"contextmenu":case"mouseup":case"dragend":cI=!1,fL(f,r,u);break;case"selectionchange":if(nce)break;case"keydown":case"keyup":fL(f,r,u)}var C;if(m4)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else av?RW(e,r)&&(A="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(A="onCompositionStart");A&&(MW&&r.locale!=="ko"&&(av||A!=="onCompositionStart"?A==="onCompositionEnd"&&av&&(C=DW()):(wh=u,d4="value"in wh?wh.value:wh.textContent,av=!0)),S=Gj(d,A),0<S.length&&(A=new nL(A,e,null,r,u),f.push({event:A,listeners:S}),C?A.data=C:(C=FW(r),C!==null&&(A.data=C)))),(C=Wle?Hle(e,r):Gle(e,r))&&(d=Gj(d,"onBeforeInput"),0<d.length&&(u=new nL("onBeforeInput","beforeinput",null,r,u),f.push({event:u,listeners:d}),u.data=C))}XW(f,t)})}function vw(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Gj(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=uw(e,r),o!=null&&n.unshift(vw(e,o,s)),o=uw(e,t),o!=null&&n.push(vw(e,o,s))),e=e.return}return n}function Nx(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pL(e,t,r,n,s){for(var o=t._reactName,i=[];r!==null&&r!==n;){var l=r,c=l.alternate,d=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&d!==null&&(l=d,s?(c=uw(r,o),c!=null&&i.unshift(vw(r,c,l))):s||(c=uw(r,o),c!=null&&i.push(vw(r,c,l)))),r=r.return}i.length!==0&&e.push({event:t,listeners:i})}var ice=/\r\n?/g,lce=/\u0000|\uFFFD/g;function gL(e){return(typeof e=="string"?e:""+e).replace(ice,`
`).replace(lce,"")}function Q2(e,t,r){if(t=gL(t),gL(e)!==t&&r)throw Error(yn(425))}function Kj(){}var dI=null,uI=null;function fI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var mI=typeof setTimeout=="function"?setTimeout:void 0,cce=typeof clearTimeout=="function"?clearTimeout:void 0,xL=typeof Promise=="function"?Promise:void 0,dce=typeof queueMicrotask=="function"?queueMicrotask:typeof xL<"u"?function(e){return xL.resolve(null).then(e).catch(uce)}:mI;function uce(e){setTimeout(function(){throw e})}function hP(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),hw(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);hw(t)}function Mh(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function vL(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var U0=Math.random().toString(36).slice(2),ff="__reactFiber$"+U0,yw="__reactProps$"+U0,_m="__reactContainer$"+U0,hI="__reactEvents$"+U0,fce="__reactListeners$"+U0,mce="__reactHandles$"+U0;function sg(e){var t=e[ff];if(t)return t;for(var r=e.parentNode;r;){if(t=r[_m]||r[ff]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=vL(e);e!==null;){if(r=e[ff])return r;e=vL(e)}return t}e=r,r=e.parentNode}return null}function U1(e){return e=e[ff]||e[_m],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function iv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(yn(33))}function bC(e){return e[yw]||null}var pI=[],lv=-1;function xp(e){return{current:e}}function wo(e){0>lv||(e.current=pI[lv],pI[lv]=null,lv--)}function io(e,t){lv++,pI[lv]=e.current,e.current=t}var ap={},Ml=xp(ap),Ec=xp(!1),Rg=ap;function Gv(e,t){var r=e.type.contextTypes;if(!r)return ap;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in r)s[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function kc(e){return e=e.childContextTypes,e!=null}function Xj(){wo(Ec),wo(Ml)}function yL(e,t,r){if(Ml.current!==ap)throw Error(yn(168));io(Ml,t),io(Ec,r)}function JW(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(yn(108,Jie(e)||"Unknown",s));return $o({},r,n)}function Yj(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ap,Rg=Ml.current,io(Ml,e),io(Ec,Ec.current),!0}function bL(e,t,r){var n=e.stateNode;if(!n)throw Error(yn(169));r?(e=JW(e,t,Rg),n.__reactInternalMemoizedMergedChildContext=e,wo(Ec),wo(Ml),io(Ml,e)):wo(Ec),io(Ec,r)}var am=null,wC=!1,pP=!1;function QW(e){am===null?am=[e]:am.push(e)}function hce(e){wC=!0,QW(e)}function vp(){if(!pP&&am!==null){pP=!0;var e=0,t=Bs;try{var r=am;for(Bs=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}am=null,wC=!1}catch(s){throw am!==null&&(am=am.slice(e+1)),jW(o4,vp),s}finally{Bs=t,pP=!1}}return null}var cv=[],dv=0,Jj=null,Qj=0,Ld=[],$d=0,Fg=null,lm=1,cm="";function Vp(e,t){cv[dv++]=Qj,cv[dv++]=Jj,Jj=e,Qj=t}function ZW(e,t,r){Ld[$d++]=lm,Ld[$d++]=cm,Ld[$d++]=Fg,Fg=e;var n=lm;e=cm;var s=32-Mu(n)-1;n&=~(1<<s),r+=1;var o=32-Mu(t)+s;if(30<o){var i=s-s%5;o=(n&(1<<i)-1).toString(32),n>>=i,s-=i,lm=1<<32-Mu(t)+s|r<<s|n,cm=o+e}else lm=1<<o|r<<s|n,cm=e}function p4(e){e.return!==null&&(Vp(e,1),ZW(e,1,0))}function g4(e){for(;e===Jj;)Jj=cv[--dv],cv[dv]=null,Qj=cv[--dv],cv[dv]=null;for(;e===Fg;)Fg=Ld[--$d],Ld[$d]=null,cm=Ld[--$d],Ld[$d]=null,lm=Ld[--$d],Ld[$d]=null}var dd=null,ad=null,Eo=!1,Eu=null;function eH(e,t){var r=Kd(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function wL(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,dd=e,ad=Mh(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,dd=e,ad=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Fg!==null?{id:lm,overflow:cm}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Kd(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,dd=e,ad=null,!0):!1;default:return!1}}function gI(e){return(e.mode&1)!==0&&(e.flags&128)===0}function xI(e){if(Eo){var t=ad;if(t){var r=t;if(!wL(e,t)){if(gI(e))throw Error(yn(418));t=Mh(r.nextSibling);var n=dd;t&&wL(e,t)?eH(n,r):(e.flags=e.flags&-4097|2,Eo=!1,dd=e)}}else{if(gI(e))throw Error(yn(418));e.flags=e.flags&-4097|2,Eo=!1,dd=e}}}function _L(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;dd=e}function Z2(e){if(e!==dd)return!1;if(!Eo)return _L(e),Eo=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!fI(e.type,e.memoizedProps)),t&&(t=ad)){if(gI(e))throw tH(),Error(yn(418));for(;t;)eH(e,t),t=Mh(t.nextSibling)}if(_L(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(yn(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){ad=Mh(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}ad=null}}else ad=dd?Mh(e.stateNode.nextSibling):null;return!0}function tH(){for(var e=ad;e;)e=Mh(e.nextSibling)}function Kv(){ad=dd=null,Eo=!1}function x4(e){Eu===null?Eu=[e]:Eu.push(e)}var pce=Mm.ReactCurrentBatchConfig;function Ty(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(yn(309));var n=r.stateNode}if(!n)throw Error(yn(147,e));var s=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(i){var l=s.refs;i===null?delete l[o]:l[o]=i},t._stringRef=o,t)}if(typeof e!="string")throw Error(yn(284));if(!r._owner)throw Error(yn(290,e))}return e}function e_(e,t){throw e=Object.prototype.toString.call(t),Error(yn(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function jL(e){var t=e._init;return t(e._payload)}function rH(e){function t(v,b){if(e){var w=v.deletions;w===null?(v.deletions=[b],v.flags|=16):w.push(b)}}function r(v,b){if(!e)return null;for(;b!==null;)t(v,b),b=b.sibling;return null}function n(v,b){for(v=new Map;b!==null;)b.key!==null?v.set(b.key,b):v.set(b.index,b),b=b.sibling;return v}function s(v,b){return v=$h(v,b),v.index=0,v.sibling=null,v}function o(v,b,w){return v.index=w,e?(w=v.alternate,w!==null?(w=w.index,w<b?(v.flags|=2,b):w):(v.flags|=2,b)):(v.flags|=1048576,b)}function i(v){return e&&v.alternate===null&&(v.flags|=2),v}function l(v,b,w,_){return b===null||b.tag!==6?(b=_P(w,v.mode,_),b.return=v,b):(b=s(b,w),b.return=v,b)}function c(v,b,w,_){var j=w.type;return j===nv?u(v,b,w.props.children,_,w.key):b!==null&&(b.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===ch&&jL(j)===b.type)?(_=s(b,w.props),_.ref=Ty(v,b,w),_.return=v,_):(_=vj(w.type,w.key,w.props,null,v.mode,_),_.ref=Ty(v,b,w),_.return=v,_)}function d(v,b,w,_){return b===null||b.tag!==4||b.stateNode.containerInfo!==w.containerInfo||b.stateNode.implementation!==w.implementation?(b=jP(w,v.mode,_),b.return=v,b):(b=s(b,w.children||[]),b.return=v,b)}function u(v,b,w,_,j){return b===null||b.tag!==7?(b=_g(w,v.mode,_,j),b.return=v,b):(b=s(b,w),b.return=v,b)}function f(v,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return b=_P(""+b,v.mode,w),b.return=v,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case U2:return w=vj(b.type,b.key,b.props,null,v.mode,w),w.ref=Ty(v,null,b),w.return=v,w;case rv:return b=jP(b,v.mode,w),b.return=v,b;case ch:var _=b._init;return f(v,_(b._payload),w)}if(ub(b)||Py(b))return b=_g(b,v.mode,w,null),b.return=v,b;e_(v,b)}return null}function h(v,b,w,_){var j=b!==null?b.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return j!==null?null:l(v,b,""+w,_);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case U2:return w.key===j?c(v,b,w,_):null;case rv:return w.key===j?d(v,b,w,_):null;case ch:return j=w._init,h(v,b,j(w._payload),_)}if(ub(w)||Py(w))return j!==null?null:u(v,b,w,_,null);e_(v,w)}return null}function m(v,b,w,_,j){if(typeof _=="string"&&_!==""||typeof _=="number")return v=v.get(w)||null,l(b,v,""+_,j);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case U2:return v=v.get(_.key===null?w:_.key)||null,c(b,v,_,j);case rv:return v=v.get(_.key===null?w:_.key)||null,d(b,v,_,j);case ch:var S=_._init;return m(v,b,w,S(_._payload),j)}if(ub(_)||Py(_))return v=v.get(w)||null,u(b,v,_,j,null);e_(b,_)}return null}function x(v,b,w,_){for(var j=null,S=null,C=b,A=b=0,P=null;C!==null&&A<w.length;A++){C.index>A?(P=C,C=null):P=C.sibling;var F=h(v,C,w[A],_);if(F===null){C===null&&(C=P);break}e&&C&&F.alternate===null&&t(v,C),b=o(F,b,A),S===null?j=F:S.sibling=F,S=F,C=P}if(A===w.length)return r(v,C),Eo&&Vp(v,A),j;if(C===null){for(;A<w.length;A++)C=f(v,w[A],_),C!==null&&(b=o(C,b,A),S===null?j=C:S.sibling=C,S=C);return Eo&&Vp(v,A),j}for(C=n(v,C);A<w.length;A++)P=m(C,v,A,w[A],_),P!==null&&(e&&P.alternate!==null&&C.delete(P.key===null?A:P.key),b=o(P,b,A),S===null?j=P:S.sibling=P,S=P);return e&&C.forEach(function(O){return t(v,O)}),Eo&&Vp(v,A),j}function g(v,b,w,_){var j=Py(w);if(typeof j!="function")throw Error(yn(150));if(w=j.call(w),w==null)throw Error(yn(151));for(var S=j=null,C=b,A=b=0,P=null,F=w.next();C!==null&&!F.done;A++,F=w.next()){C.index>A?(P=C,C=null):P=C.sibling;var O=h(v,C,F.value,_);if(O===null){C===null&&(C=P);break}e&&C&&O.alternate===null&&t(v,C),b=o(O,b,A),S===null?j=O:S.sibling=O,S=O,C=P}if(F.done)return r(v,C),Eo&&Vp(v,A),j;if(C===null){for(;!F.done;A++,F=w.next())F=f(v,F.value,_),F!==null&&(b=o(F,b,A),S===null?j=F:S.sibling=F,S=F);return Eo&&Vp(v,A),j}for(C=n(v,C);!F.done;A++,F=w.next())F=m(C,v,A,F.value,_),F!==null&&(e&&F.alternate!==null&&C.delete(F.key===null?A:F.key),b=o(F,b,A),S===null?j=F:S.sibling=F,S=F);return e&&C.forEach(function(I){return t(v,I)}),Eo&&Vp(v,A),j}function y(v,b,w,_){if(typeof w=="object"&&w!==null&&w.type===nv&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case U2:e:{for(var j=w.key,S=b;S!==null;){if(S.key===j){if(j=w.type,j===nv){if(S.tag===7){r(v,S.sibling),b=s(S,w.props.children),b.return=v,v=b;break e}}else if(S.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===ch&&jL(j)===S.type){r(v,S.sibling),b=s(S,w.props),b.ref=Ty(v,S,w),b.return=v,v=b;break e}r(v,S);break}else t(v,S);S=S.sibling}w.type===nv?(b=_g(w.props.children,v.mode,_,w.key),b.return=v,v=b):(_=vj(w.type,w.key,w.props,null,v.mode,_),_.ref=Ty(v,b,w),_.return=v,v=_)}return i(v);case rv:e:{for(S=w.key;b!==null;){if(b.key===S)if(b.tag===4&&b.stateNode.containerInfo===w.containerInfo&&b.stateNode.implementation===w.implementation){r(v,b.sibling),b=s(b,w.children||[]),b.return=v,v=b;break e}else{r(v,b);break}else t(v,b);b=b.sibling}b=jP(w,v.mode,_),b.return=v,v=b}return i(v);case ch:return S=w._init,y(v,b,S(w._payload),_)}if(ub(w))return x(v,b,w,_);if(Py(w))return g(v,b,w,_);e_(v,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,b!==null&&b.tag===6?(r(v,b.sibling),b=s(b,w),b.return=v,v=b):(r(v,b),b=_P(w,v.mode,_),b.return=v,v=b),i(v)):r(v,b)}return y}var Xv=rH(!0),nH=rH(!1),Zj=xp(null),eN=null,uv=null,v4=null;function y4(){v4=uv=eN=null}function b4(e){var t=Zj.current;wo(Zj),e._currentValue=t}function vI(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function kv(e,t){eN=e,v4=uv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Cc=!0),e.firstContext=null)}function nu(e){var t=e._currentValue;if(v4!==e)if(e={context:e,memoizedValue:t,next:null},uv===null){if(eN===null)throw Error(yn(308));uv=e,eN.dependencies={lanes:0,firstContext:e}}else uv=uv.next=e;return t}var og=null;function w4(e){og===null?og=[e]:og.push(e)}function aH(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,w4(t)):(r.next=s.next,s.next=r),t.interleaved=r,jm(e,n)}function jm(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var dh=!1;function _4(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sH(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function pm(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Rh(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ns&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,jm(e,r)}return s=n.interleaved,s===null?(t.next=t,w4(n)):(t.next=s.next,s.next=t),n.interleaved=t,jm(e,r)}function fj(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,i4(e,r)}}function NL(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var i={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?s=o=i:o=o.next=i,r=r.next}while(r!==null);o===null?s=o=t:o=o.next=t}else s=o=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function tN(e,t,r,n){var s=e.updateQueue;dh=!1;var o=s.firstBaseUpdate,i=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,i===null?o=d:i.next=d,i=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==i&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(o!==null){var f=s.baseState;i=0,u=d=c=null,l=o;do{var h=l.lane,m=l.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:m,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var x=e,g=l;switch(h=t,m=r,g.tag){case 1:if(x=g.payload,typeof x=="function"){f=x.call(m,f,h);break e}f=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,h=typeof x=="function"?x.call(m,f,h):x,h==null)break e;f=$o({},f,h);break e;case 2:dh=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,h=s.effects,h===null?s.effects=[l]:h.push(l))}else m={eventTime:m,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=m,c=f):u=u.next=m,i|=h;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;h=l,l=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(u===null&&(c=f),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,t=s.shared.interleaved,t!==null){s=t;do i|=s.lane,s=s.next;while(s!==t)}else o===null&&(s.shared.lanes=0);$g|=i,e.lanes=i,e.memoizedState=f}}function SL(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(yn(191,s));s.call(n)}}}var V1={},Nf=xp(V1),bw=xp(V1),ww=xp(V1);function ig(e){if(e===V1)throw Error(yn(174));return e}function j4(e,t){switch(io(ww,t),io(bw,e),io(Nf,V1),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Qk(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Qk(t,e)}wo(Nf),io(Nf,t)}function Yv(){wo(Nf),wo(bw),wo(ww)}function oH(e){ig(ww.current);var t=ig(Nf.current),r=Qk(t,e.type);t!==r&&(io(bw,e),io(Nf,r))}function N4(e){bw.current===e&&(wo(Nf),wo(bw))}var Do=xp(0);function rN(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var gP=[];function S4(){for(var e=0;e<gP.length;e++)gP[e]._workInProgressVersionPrimary=null;gP.length=0}var mj=Mm.ReactCurrentDispatcher,xP=Mm.ReactCurrentBatchConfig,Lg=0,Fo=null,ki=null,Ui=null,nN=!1,Ab=!1,_w=0,gce=0;function _l(){throw Error(yn(321))}function C4(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Bu(e[r],t[r]))return!1;return!0}function A4(e,t,r,n,s,o){if(Lg=o,Fo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,mj.current=e===null||e.memoizedState===null?bce:wce,e=r(n,s),Ab){o=0;do{if(Ab=!1,_w=0,25<=o)throw Error(yn(301));o+=1,Ui=ki=null,t.updateQueue=null,mj.current=_ce,e=r(n,s)}while(Ab)}if(mj.current=aN,t=ki!==null&&ki.next!==null,Lg=0,Ui=ki=Fo=null,nN=!1,t)throw Error(yn(300));return e}function P4(){var e=_w!==0;return _w=0,e}function df(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ui===null?Fo.memoizedState=Ui=e:Ui=Ui.next=e,Ui}function au(){if(ki===null){var e=Fo.alternate;e=e!==null?e.memoizedState:null}else e=ki.next;var t=Ui===null?Fo.memoizedState:Ui.next;if(t!==null)Ui=t,ki=e;else{if(e===null)throw Error(yn(310));ki=e,e={memoizedState:ki.memoizedState,baseState:ki.baseState,baseQueue:ki.baseQueue,queue:ki.queue,next:null},Ui===null?Fo.memoizedState=Ui=e:Ui=Ui.next=e}return Ui}function jw(e,t){return typeof t=="function"?t(e):t}function vP(e){var t=au(),r=t.queue;if(r===null)throw Error(yn(311));r.lastRenderedReducer=e;var n=ki,s=n.baseQueue,o=r.pending;if(o!==null){if(s!==null){var i=s.next;s.next=o.next,o.next=i}n.baseQueue=s=o,r.pending=null}if(s!==null){o=s.next,n=n.baseState;var l=i=null,c=null,d=o;do{var u=d.lane;if((Lg&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var f={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,i=n):c=c.next=f,Fo.lanes|=u,$g|=u}d=d.next}while(d!==null&&d!==o);c===null?i=n:c.next=l,Bu(n,t.memoizedState)||(Cc=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=c,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do o=s.lane,Fo.lanes|=o,$g|=o,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function yP(e){var t=au(),r=t.queue;if(r===null)throw Error(yn(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,o=t.memoizedState;if(s!==null){r.pending=null;var i=s=s.next;do o=e(o,i.action),i=i.next;while(i!==s);Bu(o,t.memoizedState)||(Cc=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function iH(){}function lH(e,t){var r=Fo,n=au(),s=t(),o=!Bu(n.memoizedState,s);if(o&&(n.memoizedState=s,Cc=!0),n=n.queue,E4(uH.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||Ui!==null&&Ui.memoizedState.tag&1){if(r.flags|=2048,Nw(9,dH.bind(null,r,n,s,t),void 0,null),Gi===null)throw Error(yn(349));Lg&30||cH(r,t,s)}return s}function cH(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Fo.updateQueue,t===null?(t={lastEffect:null,stores:null},Fo.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function dH(e,t,r,n){t.value=r,t.getSnapshot=n,fH(t)&&mH(e)}function uH(e,t,r){return r(function(){fH(t)&&mH(e)})}function fH(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Bu(e,r)}catch{return!0}}function mH(e){var t=jm(e,1);t!==null&&Ru(t,e,1,-1)}function CL(e){var t=df();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jw,lastRenderedState:e},t.queue=e,e=e.dispatch=yce.bind(null,Fo,e),[t.memoizedState,e]}function Nw(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Fo.updateQueue,t===null?(t={lastEffect:null,stores:null},Fo.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function hH(){return au().memoizedState}function hj(e,t,r,n){var s=df();Fo.flags|=e,s.memoizedState=Nw(1|t,r,void 0,n===void 0?null:n)}function _C(e,t,r,n){var s=au();n=n===void 0?null:n;var o=void 0;if(ki!==null){var i=ki.memoizedState;if(o=i.destroy,n!==null&&C4(n,i.deps)){s.memoizedState=Nw(t,r,o,n);return}}Fo.flags|=e,s.memoizedState=Nw(1|t,r,o,n)}function AL(e,t){return hj(8390656,8,e,t)}function E4(e,t){return _C(2048,8,e,t)}function pH(e,t){return _C(4,2,e,t)}function gH(e,t){return _C(4,4,e,t)}function xH(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function vH(e,t,r){return r=r!=null?r.concat([e]):null,_C(4,4,xH.bind(null,t,e),r)}function k4(){}function yH(e,t){var r=au();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&C4(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function bH(e,t){var r=au();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&C4(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function wH(e,t,r){return Lg&21?(Bu(r,t)||(r=CW(),Fo.lanes|=r,$g|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Cc=!0),e.memoizedState=r)}function xce(e,t){var r=Bs;Bs=r!==0&&4>r?r:4,e(!0);var n=xP.transition;xP.transition={};try{e(!1),t()}finally{Bs=r,xP.transition=n}}function _H(){return au().memoizedState}function vce(e,t,r){var n=Lh(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},jH(e))NH(t,r);else if(r=aH(e,t,r,n),r!==null){var s=ic();Ru(r,e,n,s),SH(r,t,n)}}function yce(e,t,r){var n=Lh(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(jH(e))NH(t,s);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var i=t.lastRenderedState,l=o(i,r);if(s.hasEagerState=!0,s.eagerState=l,Bu(l,i)){var c=t.interleaved;c===null?(s.next=s,w4(t)):(s.next=c.next,c.next=s),t.interleaved=s;return}}catch{}finally{}r=aH(e,t,s,n),r!==null&&(s=ic(),Ru(r,e,n,s),SH(r,t,n))}}function jH(e){var t=e.alternate;return e===Fo||t!==null&&t===Fo}function NH(e,t){Ab=nN=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function SH(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,i4(e,r)}}var aN={readContext:nu,useCallback:_l,useContext:_l,useEffect:_l,useImperativeHandle:_l,useInsertionEffect:_l,useLayoutEffect:_l,useMemo:_l,useReducer:_l,useRef:_l,useState:_l,useDebugValue:_l,useDeferredValue:_l,useTransition:_l,useMutableSource:_l,useSyncExternalStore:_l,useId:_l,unstable_isNewReconciler:!1},bce={readContext:nu,useCallback:function(e,t){return df().memoizedState=[e,t===void 0?null:t],e},useContext:nu,useEffect:AL,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,hj(4194308,4,xH.bind(null,t,e),r)},useLayoutEffect:function(e,t){return hj(4194308,4,e,t)},useInsertionEffect:function(e,t){return hj(4,2,e,t)},useMemo:function(e,t){var r=df();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=df();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=vce.bind(null,Fo,e),[n.memoizedState,e]},useRef:function(e){var t=df();return e={current:e},t.memoizedState=e},useState:CL,useDebugValue:k4,useDeferredValue:function(e){return df().memoizedState=e},useTransition:function(){var e=CL(!1),t=e[0];return e=xce.bind(null,e[1]),df().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Fo,s=df();if(Eo){if(r===void 0)throw Error(yn(407));r=r()}else{if(r=t(),Gi===null)throw Error(yn(349));Lg&30||cH(n,t,r)}s.memoizedState=r;var o={value:r,getSnapshot:t};return s.queue=o,AL(uH.bind(null,n,o,e),[e]),n.flags|=2048,Nw(9,dH.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=df(),t=Gi.identifierPrefix;if(Eo){var r=cm,n=lm;r=(n&~(1<<32-Mu(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=_w++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=gce++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},wce={readContext:nu,useCallback:yH,useContext:nu,useEffect:E4,useImperativeHandle:vH,useInsertionEffect:pH,useLayoutEffect:gH,useMemo:bH,useReducer:vP,useRef:hH,useState:function(){return vP(jw)},useDebugValue:k4,useDeferredValue:function(e){var t=au();return wH(t,ki.memoizedState,e)},useTransition:function(){var e=vP(jw)[0],t=au().memoizedState;return[e,t]},useMutableSource:iH,useSyncExternalStore:lH,useId:_H,unstable_isNewReconciler:!1},_ce={readContext:nu,useCallback:yH,useContext:nu,useEffect:E4,useImperativeHandle:vH,useInsertionEffect:pH,useLayoutEffect:gH,useMemo:bH,useReducer:yP,useRef:hH,useState:function(){return yP(jw)},useDebugValue:k4,useDeferredValue:function(e){var t=au();return ki===null?t.memoizedState=e:wH(t,ki.memoizedState,e)},useTransition:function(){var e=yP(jw)[0],t=au().memoizedState;return[e,t]},useMutableSource:iH,useSyncExternalStore:lH,useId:_H,unstable_isNewReconciler:!1};function Nu(e,t){if(e&&e.defaultProps){t=$o({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function yI(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:$o({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var jC={isMounted:function(e){return(e=e._reactInternals)?sx(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=ic(),s=Lh(e),o=pm(n,s);o.payload=t,r!=null&&(o.callback=r),t=Rh(e,o,s),t!==null&&(Ru(t,e,s,n),fj(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=ic(),s=Lh(e),o=pm(n,s);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=Rh(e,o,s),t!==null&&(Ru(t,e,s,n),fj(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ic(),n=Lh(e),s=pm(r,n);s.tag=2,t!=null&&(s.callback=t),t=Rh(e,s,n),t!==null&&(Ru(t,e,n,r),fj(t,e,n))}};function PL(e,t,r,n,s,o,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,i):t.prototype&&t.prototype.isPureReactComponent?!gw(r,n)||!gw(s,o):!0}function CH(e,t,r){var n=!1,s=ap,o=t.contextType;return typeof o=="object"&&o!==null?o=nu(o):(s=kc(t)?Rg:Ml.current,n=t.contextTypes,o=(n=n!=null)?Gv(e,s):ap),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=jC,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=o),t}function EL(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&jC.enqueueReplaceState(t,t.state,null)}function bI(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},_4(e);var o=t.contextType;typeof o=="object"&&o!==null?s.context=nu(o):(o=kc(t)?Rg:Ml.current,s.context=Gv(e,o)),s.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(yI(e,t,o,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&jC.enqueueReplaceState(s,s.state,null),tN(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function Jv(e,t){try{var r="",n=t;do r+=Yie(n),n=n.return;while(n);var s=r}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:s,digest:null}}function bP(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function wI(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var jce=typeof WeakMap=="function"?WeakMap:Map;function AH(e,t,r){r=pm(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){oN||(oN=!0,II=n),wI(e,t)},r}function PH(e,t,r){r=pm(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){wI(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){wI(e,t),typeof n!="function"&&(Fh===null?Fh=new Set([this]):Fh.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),r}function kL(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new jce;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=Fce.bind(null,e,t,r),t.then(e,e))}function IL(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function OL(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=pm(-1,1),t.tag=2,Rh(r,t,1))),r.lanes|=1),e)}var Nce=Mm.ReactCurrentOwner,Cc=!1;function Ql(e,t,r,n){t.child=e===null?nH(t,null,r,n):Xv(t,e.child,r,n)}function TL(e,t,r,n,s){r=r.render;var o=t.ref;return kv(t,s),n=A4(e,t,r,n,o,s),r=P4(),e!==null&&!Cc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Nm(e,t,s)):(Eo&&r&&p4(t),t.flags|=1,Ql(e,t,n,s),t.child)}function DL(e,t,r,n,s){if(e===null){var o=r.type;return typeof o=="function"&&!L4(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,EH(e,t,o,n,s)):(e=vj(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&s)){var i=o.memoizedProps;if(r=r.compare,r=r!==null?r:gw,r(i,n)&&e.ref===t.ref)return Nm(e,t,s)}return t.flags|=1,e=$h(o,n),e.ref=t.ref,e.return=t,t.child=e}function EH(e,t,r,n,s){if(e!==null){var o=e.memoizedProps;if(gw(o,n)&&e.ref===t.ref)if(Cc=!1,t.pendingProps=n=o,(e.lanes&s)!==0)e.flags&131072&&(Cc=!0);else return t.lanes=e.lanes,Nm(e,t,s)}return _I(e,t,r,n,s)}function kH(e,t,r){var n=t.pendingProps,s=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},io(mv,Zc),Zc|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,io(mv,Zc),Zc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,io(mv,Zc),Zc|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,io(mv,Zc),Zc|=n;return Ql(e,t,s,r),t.child}function IH(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function _I(e,t,r,n,s){var o=kc(r)?Rg:Ml.current;return o=Gv(t,o),kv(t,s),r=A4(e,t,r,n,o,s),n=P4(),e!==null&&!Cc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Nm(e,t,s)):(Eo&&n&&p4(t),t.flags|=1,Ql(e,t,r,s),t.child)}function ML(e,t,r,n,s){if(kc(r)){var o=!0;Yj(t)}else o=!1;if(kv(t,s),t.stateNode===null)pj(e,t),CH(t,r,n),bI(t,r,n,s),n=!0;else if(e===null){var i=t.stateNode,l=t.memoizedProps;i.props=l;var c=i.context,d=r.contextType;typeof d=="object"&&d!==null?d=nu(d):(d=kc(r)?Rg:Ml.current,d=Gv(t,d));var u=r.getDerivedStateFromProps,f=typeof u=="function"||typeof i.getSnapshotBeforeUpdate=="function";f||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==n||c!==d)&&EL(t,i,n,d),dh=!1;var h=t.memoizedState;i.state=h,tN(t,n,i,s),c=t.memoizedState,l!==n||h!==c||Ec.current||dh?(typeof u=="function"&&(yI(t,r,u,n),c=t.memoizedState),(l=dh||PL(t,r,l,n,h,c,d))?(f||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),i.props=n,i.state=c,i.context=d,n=l):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{i=t.stateNode,sH(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:Nu(t.type,l),i.props=d,f=t.pendingProps,h=i.context,c=r.contextType,typeof c=="object"&&c!==null?c=nu(c):(c=kc(r)?Rg:Ml.current,c=Gv(t,c));var m=r.getDerivedStateFromProps;(u=typeof m=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==f||h!==c)&&EL(t,i,n,c),dh=!1,h=t.memoizedState,i.state=h,tN(t,n,i,s);var x=t.memoizedState;l!==f||h!==x||Ec.current||dh?(typeof m=="function"&&(yI(t,r,m,n),x=t.memoizedState),(d=dh||PL(t,r,d,n,h,x,c)||!1)?(u||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,x,c),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,x,c)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=x),i.props=n,i.state=x,i.context=c,n=d):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return jI(e,t,r,n,o,s)}function jI(e,t,r,n,s,o){IH(e,t);var i=(t.flags&128)!==0;if(!n&&!i)return s&&bL(t,r,!1),Nm(e,t,o);n=t.stateNode,Nce.current=t;var l=i&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&i?(t.child=Xv(t,e.child,null,o),t.child=Xv(t,null,l,o)):Ql(e,t,l,o),t.memoizedState=n.state,s&&bL(t,r,!0),t.child}function OH(e){var t=e.stateNode;t.pendingContext?yL(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yL(e,t.context,!1),j4(e,t.containerInfo)}function RL(e,t,r,n,s){return Kv(),x4(s),t.flags|=256,Ql(e,t,r,n),t.child}var NI={dehydrated:null,treeContext:null,retryLane:0};function SI(e){return{baseLanes:e,cachePool:null,transitions:null}}function TH(e,t,r){var n=t.pendingProps,s=Do.current,o=!1,i=(t.flags&128)!==0,l;if((l=i)||(l=e!==null&&e.memoizedState===null?!1:(s&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),io(Do,s&1),e===null)return xI(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=n.children,e=n.fallback,o?(n=t.mode,o=t.child,i={mode:"hidden",children:i},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=CC(i,n,0,null),e=_g(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=SI(r),t.memoizedState=NI,e):I4(t,i));if(s=e.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return Sce(e,t,i,n,l,s,r);if(o){o=n.fallback,i=t.mode,s=e.child,l=s.sibling;var c={mode:"hidden",children:n.children};return!(i&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=$h(s,c),n.subtreeFlags=s.subtreeFlags&14680064),l!==null?o=$h(l,o):(o=_g(o,i,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,i=e.child.memoizedState,i=i===null?SI(r):{baseLanes:i.baseLanes|r,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~r,t.memoizedState=NI,n}return o=e.child,e=o.sibling,n=$h(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function I4(e,t){return t=CC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function t_(e,t,r,n){return n!==null&&x4(n),Xv(t,e.child,null,r),e=I4(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Sce(e,t,r,n,s,o,i){if(r)return t.flags&256?(t.flags&=-257,n=bP(Error(yn(422))),t_(e,t,i,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,s=t.mode,n=CC({mode:"visible",children:n.children},s,0,null),o=_g(o,s,i,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&Xv(t,e.child,null,i),t.child.memoizedState=SI(i),t.memoizedState=NI,o);if(!(t.mode&1))return t_(e,t,i,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var l=n.dgst;return n=l,o=Error(yn(419)),n=bP(o,n,void 0),t_(e,t,i,n)}if(l=(i&e.childLanes)!==0,Cc||l){if(n=Gi,n!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|i)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,jm(e,s),Ru(n,e,s,-1))}return F4(),n=bP(Error(yn(421))),t_(e,t,i,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=Lce.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,ad=Mh(s.nextSibling),dd=t,Eo=!0,Eu=null,e!==null&&(Ld[$d++]=lm,Ld[$d++]=cm,Ld[$d++]=Fg,lm=e.id,cm=e.overflow,Fg=t),t=I4(t,n.children),t.flags|=4096,t)}function FL(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),vI(e.return,t,r)}function wP(e,t,r,n,s){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=s)}function DH(e,t,r){var n=t.pendingProps,s=n.revealOrder,o=n.tail;if(Ql(e,t,n.children,r),n=Do.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&FL(e,r,t);else if(e.tag===19)FL(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(io(Do,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&rN(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),wP(t,!1,s,r,o);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&rN(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}wP(t,!0,r,null,o);break;case"together":wP(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function pj(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Nm(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),$g|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(yn(153));if(t.child!==null){for(e=t.child,r=$h(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=$h(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Cce(e,t,r){switch(t.tag){case 3:OH(t),Kv();break;case 5:oH(t);break;case 1:kc(t.type)&&Yj(t);break;case 4:j4(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;io(Zj,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(io(Do,Do.current&1),t.flags|=128,null):r&t.child.childLanes?TH(e,t,r):(io(Do,Do.current&1),e=Nm(e,t,r),e!==null?e.sibling:null);io(Do,Do.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return DH(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),io(Do,Do.current),n)break;return null;case 22:case 23:return t.lanes=0,kH(e,t,r)}return Nm(e,t,r)}var MH,CI,RH,FH;MH=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};CI=function(){};RH=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,ig(Nf.current);var o=null;switch(r){case"input":s=Kk(e,s),n=Kk(e,n),o=[];break;case"select":s=$o({},s,{value:void 0}),n=$o({},n,{value:void 0}),o=[];break;case"textarea":s=Jk(e,s),n=Jk(e,n),o=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Kj)}Zk(r,n);var i;r=null;for(d in s)if(!n.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(i in l)l.hasOwnProperty(i)&&(r||(r={}),r[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(cw.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in n){var c=n[d];if(l=s?.[d],n.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(r||(r={}),r[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(r||(r={}),r[i]=c[i])}else r||(o||(o=[]),o.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(cw.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&xo("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}r&&(o=o||[]).push("style",r);var d=o;(t.updateQueue=d)&&(t.flags|=4)}};FH=function(e,t,r,n){r!==n&&(t.flags|=4)};function Dy(e,t){if(!Eo)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function jl(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Ace(e,t,r){var n=t.pendingProps;switch(g4(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jl(t),null;case 1:return kc(t.type)&&Xj(),jl(t),null;case 3:return n=t.stateNode,Yv(),wo(Ec),wo(Ml),S4(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Z2(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Eu!==null&&(DI(Eu),Eu=null))),CI(e,t),jl(t),null;case 5:N4(t);var s=ig(ww.current);if(r=t.type,e!==null&&t.stateNode!=null)RH(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(yn(166));return jl(t),null}if(e=ig(Nf.current),Z2(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[ff]=t,n[yw]=o,e=(t.mode&1)!==0,r){case"dialog":xo("cancel",n),xo("close",n);break;case"iframe":case"object":case"embed":xo("load",n);break;case"video":case"audio":for(s=0;s<mb.length;s++)xo(mb[s],n);break;case"source":xo("error",n);break;case"img":case"image":case"link":xo("error",n),xo("load",n);break;case"details":xo("toggle",n);break;case"input":HF(n,o),xo("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},xo("invalid",n);break;case"textarea":KF(n,o),xo("invalid",n)}Zk(r,o),s=null;for(var i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="children"?typeof l=="string"?n.textContent!==l&&(o.suppressHydrationWarning!==!0&&Q2(n.textContent,l,e),s=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&Q2(n.textContent,l,e),s=["children",""+l]):cw.hasOwnProperty(i)&&l!=null&&i==="onScroll"&&xo("scroll",n)}switch(r){case"input":V2(n),GF(n,o,!0);break;case"textarea":V2(n),XF(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=Kj)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=uW(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=i.createElement(r,{is:n.is}):(e=i.createElement(r),r==="select"&&(i=e,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):e=i.createElementNS(e,r),e[ff]=t,e[yw]=n,MH(e,t,!1,!1),t.stateNode=e;e:{switch(i=eI(r,n),r){case"dialog":xo("cancel",e),xo("close",e),s=n;break;case"iframe":case"object":case"embed":xo("load",e),s=n;break;case"video":case"audio":for(s=0;s<mb.length;s++)xo(mb[s],e);s=n;break;case"source":xo("error",e),s=n;break;case"img":case"image":case"link":xo("error",e),xo("load",e),s=n;break;case"details":xo("toggle",e),s=n;break;case"input":HF(e,n),s=Kk(e,n),xo("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=$o({},n,{value:void 0}),xo("invalid",e);break;case"textarea":KF(e,n),s=Jk(e,n),xo("invalid",e);break;default:s=n}Zk(r,s),l=s;for(o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="style"?hW(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&fW(e,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&dw(e,c):typeof c=="number"&&dw(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(cw.hasOwnProperty(o)?c!=null&&o==="onScroll"&&xo("scroll",e):c!=null&&t4(e,o,c,i))}switch(r){case"input":V2(e),GF(e,n,!1);break;case"textarea":V2(e),XF(e);break;case"option":n.value!=null&&e.setAttribute("value",""+np(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?Cv(e,!!n.multiple,o,!1):n.defaultValue!=null&&Cv(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=Kj)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return jl(t),null;case 6:if(e&&t.stateNode!=null)FH(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(yn(166));if(r=ig(ww.current),ig(Nf.current),Z2(t)){if(n=t.stateNode,r=t.memoizedProps,n[ff]=t,(o=n.nodeValue!==r)&&(e=dd,e!==null))switch(e.tag){case 3:Q2(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Q2(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[ff]=t,t.stateNode=n}return jl(t),null;case 13:if(wo(Do),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Eo&&ad!==null&&t.mode&1&&!(t.flags&128))tH(),Kv(),t.flags|=98560,o=!1;else if(o=Z2(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(yn(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(yn(317));o[ff]=t}else Kv(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;jl(t),o=!1}else Eu!==null&&(DI(Eu),Eu=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Do.current&1?Di===0&&(Di=3):F4())),t.updateQueue!==null&&(t.flags|=4),jl(t),null);case 4:return Yv(),CI(e,t),e===null&&xw(t.stateNode.containerInfo),jl(t),null;case 10:return b4(t.type._context),jl(t),null;case 17:return kc(t.type)&&Xj(),jl(t),null;case 19:if(wo(Do),o=t.memoizedState,o===null)return jl(t),null;if(n=(t.flags&128)!==0,i=o.rendering,i===null)if(n)Dy(o,!1);else{if(Di!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=rN(e),i!==null){for(t.flags|=128,Dy(o,!1),n=i.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,e=i.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return io(Do,Do.current&1|2),t.child}e=e.sibling}o.tail!==null&&Zo()>Qv&&(t.flags|=128,n=!0,Dy(o,!1),t.lanes=4194304)}else{if(!n)if(e=rN(i),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Dy(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!Eo)return jl(t),null}else 2*Zo()-o.renderingStartTime>Qv&&r!==1073741824&&(t.flags|=128,n=!0,Dy(o,!1),t.lanes=4194304);o.isBackwards?(i.sibling=t.child,t.child=i):(r=o.last,r!==null?r.sibling=i:t.child=i,o.last=i)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Zo(),t.sibling=null,r=Do.current,io(Do,n?r&1|2:r&1),t):(jl(t),null);case 22:case 23:return R4(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Zc&1073741824&&(jl(t),t.subtreeFlags&6&&(t.flags|=8192)):jl(t),null;case 24:return null;case 25:return null}throw Error(yn(156,t.tag))}function Pce(e,t){switch(g4(t),t.tag){case 1:return kc(t.type)&&Xj(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Yv(),wo(Ec),wo(Ml),S4(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return N4(t),null;case 13:if(wo(Do),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(yn(340));Kv()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return wo(Do),null;case 4:return Yv(),null;case 10:return b4(t.type._context),null;case 22:case 23:return R4(),null;case 24:return null;default:return null}}var r_=!1,Il=!1,Ece=typeof WeakSet=="function"?WeakSet:Set,ea=null;function fv(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Vo(e,t,n)}else r.current=null}function AI(e,t,r){try{r()}catch(n){Vo(e,t,n)}}var LL=!1;function kce(e,t){if(dI=Wj,e=zW(),h4(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var i=0,l=-1,c=-1,d=0,u=0,f=e,h=null;t:for(;;){for(var m;f!==r||s!==0&&f.nodeType!==3||(l=i+s),f!==o||n!==0&&f.nodeType!==3||(c=i+n),f.nodeType===3&&(i+=f.nodeValue.length),(m=f.firstChild)!==null;)h=f,f=m;for(;;){if(f===e)break t;if(h===r&&++d===s&&(l=i),h===o&&++u===n&&(c=i),(m=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=m}r=l===-1||c===-1?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(uI={focusedElem:e,selectionRange:r},Wj=!1,ea=t;ea!==null;)if(t=ea,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ea=e;else for(;ea!==null;){t=ea;try{var x=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,y=x.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:Nu(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(yn(163))}}catch(_){Vo(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,ea=e;break}ea=t.return}return x=LL,LL=!1,x}function Pb(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var o=s.destroy;s.destroy=void 0,o!==void 0&&AI(t,r,o)}s=s.next}while(s!==n)}}function NC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function PI(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function LH(e){var t=e.alternate;t!==null&&(e.alternate=null,LH(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ff],delete t[yw],delete t[hI],delete t[fce],delete t[mce])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function $H(e){return e.tag===5||e.tag===3||e.tag===4}function $L(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||$H(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function EI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Kj));else if(n!==4&&(e=e.child,e!==null))for(EI(e,t,r),e=e.sibling;e!==null;)EI(e,t,r),e=e.sibling}function kI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(kI(e,t,r),e=e.sibling;e!==null;)kI(e,t,r),e=e.sibling}var ll=null,Su=!1;function Xm(e,t,r){for(r=r.child;r!==null;)BH(e,t,r),r=r.sibling}function BH(e,t,r){if(jf&&typeof jf.onCommitFiberUnmount=="function")try{jf.onCommitFiberUnmount(gC,r)}catch{}switch(r.tag){case 5:Il||fv(r,t);case 6:var n=ll,s=Su;ll=null,Xm(e,t,r),ll=n,Su=s,ll!==null&&(Su?(e=ll,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):ll.removeChild(r.stateNode));break;case 18:ll!==null&&(Su?(e=ll,r=r.stateNode,e.nodeType===8?hP(e.parentNode,r):e.nodeType===1&&hP(e,r),hw(e)):hP(ll,r.stateNode));break;case 4:n=ll,s=Su,ll=r.stateNode.containerInfo,Su=!0,Xm(e,t,r),ll=n,Su=s;break;case 0:case 11:case 14:case 15:if(!Il&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var o=s,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&AI(r,t,i),s=s.next}while(s!==n)}Xm(e,t,r);break;case 1:if(!Il&&(fv(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(l){Vo(r,t,l)}Xm(e,t,r);break;case 21:Xm(e,t,r);break;case 22:r.mode&1?(Il=(n=Il)||r.memoizedState!==null,Xm(e,t,r),Il=n):Xm(e,t,r);break;default:Xm(e,t,r)}}function BL(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Ece),t.forEach(function(n){var s=$ce.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function xu(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var o=e,i=t,l=i;e:for(;l!==null;){switch(l.tag){case 5:ll=l.stateNode,Su=!1;break e;case 3:ll=l.stateNode.containerInfo,Su=!0;break e;case 4:ll=l.stateNode.containerInfo,Su=!0;break e}l=l.return}if(ll===null)throw Error(yn(160));BH(o,i,s),ll=null,Su=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Vo(s,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)qH(t,e),t=t.sibling}function qH(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xu(t,e),sf(e),n&4){try{Pb(3,e,e.return),NC(3,e)}catch(g){Vo(e,e.return,g)}try{Pb(5,e,e.return)}catch(g){Vo(e,e.return,g)}}break;case 1:xu(t,e),sf(e),n&512&&r!==null&&fv(r,r.return);break;case 5:if(xu(t,e),sf(e),n&512&&r!==null&&fv(r,r.return),e.flags&32){var s=e.stateNode;try{dw(s,"")}catch(g){Vo(e,e.return,g)}}if(n&4&&(s=e.stateNode,s!=null)){var o=e.memoizedProps,i=r!==null?r.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&cW(s,o),eI(l,i);var d=eI(l,o);for(i=0;i<c.length;i+=2){var u=c[i],f=c[i+1];u==="style"?hW(s,f):u==="dangerouslySetInnerHTML"?fW(s,f):u==="children"?dw(s,f):t4(s,u,f,d)}switch(l){case"input":Xk(s,o);break;case"textarea":dW(s,o);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var m=o.value;m!=null?Cv(s,!!o.multiple,m,!1):h!==!!o.multiple&&(o.defaultValue!=null?Cv(s,!!o.multiple,o.defaultValue,!0):Cv(s,!!o.multiple,o.multiple?[]:"",!1))}s[yw]=o}catch(g){Vo(e,e.return,g)}}break;case 6:if(xu(t,e),sf(e),n&4){if(e.stateNode===null)throw Error(yn(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(g){Vo(e,e.return,g)}}break;case 3:if(xu(t,e),sf(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{hw(t.containerInfo)}catch(g){Vo(e,e.return,g)}break;case 4:xu(t,e),sf(e);break;case 13:xu(t,e),sf(e),s=e.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(D4=Zo())),n&4&&BL(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(Il=(d=Il)||u,xu(t,e),Il=d):xu(t,e),sf(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(ea=e,u=e.child;u!==null;){for(f=ea=u;ea!==null;){switch(h=ea,m=h.child,h.tag){case 0:case 11:case 14:case 15:Pb(4,h,h.return);break;case 1:fv(h,h.return);var x=h.stateNode;if(typeof x.componentWillUnmount=="function"){n=h,r=h.return;try{t=n,x.props=t.memoizedProps,x.state=t.memoizedState,x.componentWillUnmount()}catch(g){Vo(n,r,g)}}break;case 5:fv(h,h.return);break;case 22:if(h.memoizedState!==null){zL(f);continue}}m!==null?(m.return=h,ea=m):zL(f)}u=u.sibling}e:for(u=null,f=e;;){if(f.tag===5){if(u===null){u=f;try{s=f.stateNode,d?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=f.stateNode,c=f.memoizedProps.style,i=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=mW("display",i))}catch(g){Vo(e,e.return,g)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(g){Vo(e,e.return,g)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:xu(t,e),sf(e),n&4&&BL(e);break;case 21:break;default:xu(t,e),sf(e)}}function sf(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if($H(r)){var n=r;break e}r=r.return}throw Error(yn(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(dw(s,""),n.flags&=-33);var o=$L(e);kI(e,o,s);break;case 3:case 4:var i=n.stateNode.containerInfo,l=$L(e);EI(e,l,i);break;default:throw Error(yn(161))}}catch(c){Vo(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Ice(e,t,r){ea=e,zH(e)}function zH(e,t,r){for(var n=(e.mode&1)!==0;ea!==null;){var s=ea,o=s.child;if(s.tag===22&&n){var i=s.memoizedState!==null||r_;if(!i){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Il;l=r_;var d=Il;if(r_=i,(Il=c)&&!d)for(ea=s;ea!==null;)i=ea,c=i.child,i.tag===22&&i.memoizedState!==null?UL(s):c!==null?(c.return=i,ea=c):UL(s);for(;o!==null;)ea=o,zH(o),o=o.sibling;ea=s,r_=l,Il=d}qL(e)}else s.subtreeFlags&8772&&o!==null?(o.return=s,ea=o):qL(e)}}function qL(e){for(;ea!==null;){var t=ea;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Il||NC(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Il)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:Nu(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&SL(t,o,n);break;case 3:var i=t.updateQueue;if(i!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}SL(t,i,r)}break;case 5:var l=t.stateNode;if(r===null&&t.flags&4){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&hw(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(yn(163))}Il||t.flags&512&&PI(t)}catch(h){Vo(t,t.return,h)}}if(t===e){ea=null;break}if(r=t.sibling,r!==null){r.return=t.return,ea=r;break}ea=t.return}}function zL(e){for(;ea!==null;){var t=ea;if(t===e){ea=null;break}var r=t.sibling;if(r!==null){r.return=t.return,ea=r;break}ea=t.return}}function UL(e){for(;ea!==null;){var t=ea;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{NC(4,t)}catch(c){Vo(t,r,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(c){Vo(t,s,c)}}var o=t.return;try{PI(t)}catch(c){Vo(t,o,c)}break;case 5:var i=t.return;try{PI(t)}catch(c){Vo(t,i,c)}}}catch(c){Vo(t,t.return,c)}if(t===e){ea=null;break}var l=t.sibling;if(l!==null){l.return=t.return,ea=l;break}ea=t.return}}var Oce=Math.ceil,sN=Mm.ReactCurrentDispatcher,O4=Mm.ReactCurrentOwner,Zd=Mm.ReactCurrentBatchConfig,Ns=0,Gi=null,xi=null,ul=0,Zc=0,mv=xp(0),Di=0,Sw=null,$g=0,SC=0,T4=0,Eb=null,_c=null,D4=0,Qv=1/0,tm=null,oN=!1,II=null,Fh=null,n_=!1,_h=null,iN=0,kb=0,OI=null,gj=-1,xj=0;function ic(){return Ns&6?Zo():gj!==-1?gj:gj=Zo()}function Lh(e){return e.mode&1?Ns&2&&ul!==0?ul&-ul:pce.transition!==null?(xj===0&&(xj=CW()),xj):(e=Bs,e!==0||(e=window.event,e=e===void 0?16:TW(e.type)),e):1}function Ru(e,t,r,n){if(50<kb)throw kb=0,OI=null,Error(yn(185));q1(e,r,n),(!(Ns&2)||e!==Gi)&&(e===Gi&&(!(Ns&2)&&(SC|=r),Di===4&&ph(e,ul)),Ic(e,n),r===1&&Ns===0&&!(t.mode&1)&&(Qv=Zo()+500,wC&&vp()))}function Ic(e,t){var r=e.callbackNode;ple(e,t);var n=Vj(e,e===Gi?ul:0);if(n===0)r!==null&&QF(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&QF(r),t===1)e.tag===0?hce(VL.bind(null,e)):QW(VL.bind(null,e)),dce(function(){!(Ns&6)&&vp()}),r=null;else{switch(AW(n)){case 1:r=o4;break;case 4:r=NW;break;case 16:r=Uj;break;case 536870912:r=SW;break;default:r=Uj}r=YH(r,UH.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function UH(e,t){if(gj=-1,xj=0,Ns&6)throw Error(yn(327));var r=e.callbackNode;if(Iv()&&e.callbackNode!==r)return null;var n=Vj(e,e===Gi?ul:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=lN(e,n);else{t=n;var s=Ns;Ns|=2;var o=WH();(Gi!==e||ul!==t)&&(tm=null,Qv=Zo()+500,wg(e,t));do try{Mce();break}catch(l){VH(e,l)}while(1);y4(),sN.current=o,Ns=s,xi!==null?t=0:(Gi=null,ul=0,t=Di)}if(t!==0){if(t===2&&(s=sI(e),s!==0&&(n=s,t=TI(e,s))),t===1)throw r=Sw,wg(e,0),ph(e,n),Ic(e,Zo()),r;if(t===6)ph(e,n);else{if(s=e.current.alternate,!(n&30)&&!Tce(s)&&(t=lN(e,n),t===2&&(o=sI(e),o!==0&&(n=o,t=TI(e,o))),t===1))throw r=Sw,wg(e,0),ph(e,n),Ic(e,Zo()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(yn(345));case 2:Wp(e,_c,tm);break;case 3:if(ph(e,n),(n&130023424)===n&&(t=D4+500-Zo(),10<t)){if(Vj(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){ic(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=mI(Wp.bind(null,e,_c,tm),t);break}Wp(e,_c,tm);break;case 4:if(ph(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var i=31-Mu(n);o=1<<i,i=t[i],i>s&&(s=i),n&=~o}if(n=s,n=Zo()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Oce(n/1960))-n,10<n){e.timeoutHandle=mI(Wp.bind(null,e,_c,tm),n);break}Wp(e,_c,tm);break;case 5:Wp(e,_c,tm);break;default:throw Error(yn(329))}}}return Ic(e,Zo()),e.callbackNode===r?UH.bind(null,e):null}function TI(e,t){var r=Eb;return e.current.memoizedState.isDehydrated&&(wg(e,t).flags|=256),e=lN(e,t),e!==2&&(t=_c,_c=r,t!==null&&DI(t)),e}function DI(e){_c===null?_c=e:_c.push.apply(_c,e)}function Tce(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],o=s.getSnapshot;s=s.value;try{if(!Bu(o(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ph(e,t){for(t&=~T4,t&=~SC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Mu(t),n=1<<r;e[r]=-1,t&=~n}}function VL(e){if(Ns&6)throw Error(yn(327));Iv();var t=Vj(e,0);if(!(t&1))return Ic(e,Zo()),null;var r=lN(e,t);if(e.tag!==0&&r===2){var n=sI(e);n!==0&&(t=n,r=TI(e,n))}if(r===1)throw r=Sw,wg(e,0),ph(e,t),Ic(e,Zo()),r;if(r===6)throw Error(yn(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Wp(e,_c,tm),Ic(e,Zo()),null}function M4(e,t){var r=Ns;Ns|=1;try{return e(t)}finally{Ns=r,Ns===0&&(Qv=Zo()+500,wC&&vp())}}function Bg(e){_h!==null&&_h.tag===0&&!(Ns&6)&&Iv();var t=Ns;Ns|=1;var r=Zd.transition,n=Bs;try{if(Zd.transition=null,Bs=1,e)return e()}finally{Bs=n,Zd.transition=r,Ns=t,!(Ns&6)&&vp()}}function R4(){Zc=mv.current,wo(mv)}function wg(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,cce(r)),xi!==null)for(r=xi.return;r!==null;){var n=r;switch(g4(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Xj();break;case 3:Yv(),wo(Ec),wo(Ml),S4();break;case 5:N4(n);break;case 4:Yv();break;case 13:wo(Do);break;case 19:wo(Do);break;case 10:b4(n.type._context);break;case 22:case 23:R4()}r=r.return}if(Gi=e,xi=e=$h(e.current,null),ul=Zc=t,Di=0,Sw=null,T4=SC=$g=0,_c=Eb=null,og!==null){for(t=0;t<og.length;t++)if(r=og[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,o=r.pending;if(o!==null){var i=o.next;o.next=s,n.next=i}r.pending=n}og=null}return e}function VH(e,t){do{var r=xi;try{if(y4(),mj.current=aN,nN){for(var n=Fo.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}nN=!1}if(Lg=0,Ui=ki=Fo=null,Ab=!1,_w=0,O4.current=null,r===null||r.return===null){Di=1,Sw=t,xi=null;break}e:{var o=e,i=r.return,l=r,c=t;if(t=ul,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=IL(i);if(m!==null){m.flags&=-257,OL(m,i,l,o,t),m.mode&1&&kL(o,d,t),t=m,c=d;var x=t.updateQueue;if(x===null){var g=new Set;g.add(c),t.updateQueue=g}else x.add(c);break e}else{if(!(t&1)){kL(o,d,t),F4();break e}c=Error(yn(426))}}else if(Eo&&l.mode&1){var y=IL(i);if(y!==null){!(y.flags&65536)&&(y.flags|=256),OL(y,i,l,o,t),x4(Jv(c,l));break e}}o=c=Jv(c,l),Di!==4&&(Di=2),Eb===null?Eb=[o]:Eb.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var v=AH(o,c,t);NL(o,v);break e;case 1:l=c;var b=o.type,w=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Fh===null||!Fh.has(w)))){o.flags|=65536,t&=-t,o.lanes|=t;var _=PH(o,l,t);NL(o,_);break e}}o=o.return}while(o!==null)}GH(r)}catch(j){t=j,xi===r&&r!==null&&(xi=r=r.return);continue}break}while(1)}function WH(){var e=sN.current;return sN.current=aN,e===null?aN:e}function F4(){(Di===0||Di===3||Di===2)&&(Di=4),Gi===null||!($g&268435455)&&!(SC&268435455)||ph(Gi,ul)}function lN(e,t){var r=Ns;Ns|=2;var n=WH();(Gi!==e||ul!==t)&&(tm=null,wg(e,t));do try{Dce();break}catch(s){VH(e,s)}while(1);if(y4(),Ns=r,sN.current=n,xi!==null)throw Error(yn(261));return Gi=null,ul=0,Di}function Dce(){for(;xi!==null;)HH(xi)}function Mce(){for(;xi!==null&&!ole();)HH(xi)}function HH(e){var t=XH(e.alternate,e,Zc);e.memoizedProps=e.pendingProps,t===null?GH(e):xi=t,O4.current=null}function GH(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Pce(r,t),r!==null){r.flags&=32767,xi=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Di=6,xi=null;return}}else if(r=Ace(r,t,Zc),r!==null){xi=r;return}if(t=t.sibling,t!==null){xi=t;return}xi=t=e}while(t!==null);Di===0&&(Di=5)}function Wp(e,t,r){var n=Bs,s=Zd.transition;try{Zd.transition=null,Bs=1,Rce(e,t,r,n)}finally{Zd.transition=s,Bs=n}return null}function Rce(e,t,r,n){do Iv();while(_h!==null);if(Ns&6)throw Error(yn(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(yn(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(gle(e,o),e===Gi&&(xi=Gi=null,ul=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||n_||(n_=!0,YH(Uj,function(){return Iv(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=Zd.transition,Zd.transition=null;var i=Bs;Bs=1;var l=Ns;Ns|=4,O4.current=null,kce(e,r),qH(r,e),rce(uI),Wj=!!dI,uI=dI=null,e.current=r,Ice(r),ile(),Ns=l,Bs=i,Zd.transition=o}else e.current=r;if(n_&&(n_=!1,_h=e,iN=s),o=e.pendingLanes,o===0&&(Fh=null),dle(r.stateNode),Ic(e,Zo()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(oN)throw oN=!1,e=II,II=null,e;return iN&1&&e.tag!==0&&Iv(),o=e.pendingLanes,o&1?e===OI?kb++:(kb=0,OI=e):kb=0,vp(),null}function Iv(){if(_h!==null){var e=AW(iN),t=Zd.transition,r=Bs;try{if(Zd.transition=null,Bs=16>e?16:e,_h===null)var n=!1;else{if(e=_h,_h=null,iN=0,Ns&6)throw Error(yn(331));var s=Ns;for(Ns|=4,ea=e.current;ea!==null;){var o=ea,i=o.child;if(ea.flags&16){var l=o.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ea=d;ea!==null;){var u=ea;switch(u.tag){case 0:case 11:case 15:Pb(8,u,o)}var f=u.child;if(f!==null)f.return=u,ea=f;else for(;ea!==null;){u=ea;var h=u.sibling,m=u.return;if(LH(u),u===d){ea=null;break}if(h!==null){h.return=m,ea=h;break}ea=m}}}var x=o.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}ea=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,ea=i;else e:for(;ea!==null;){if(o=ea,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Pb(9,o,o.return)}var v=o.sibling;if(v!==null){v.return=o.return,ea=v;break e}ea=o.return}}var b=e.current;for(ea=b;ea!==null;){i=ea;var w=i.child;if(i.subtreeFlags&2064&&w!==null)w.return=i,ea=w;else e:for(i=b;ea!==null;){if(l=ea,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:NC(9,l)}}catch(j){Vo(l,l.return,j)}if(l===i){ea=null;break e}var _=l.sibling;if(_!==null){_.return=l.return,ea=_;break e}ea=l.return}}if(Ns=s,vp(),jf&&typeof jf.onPostCommitFiberRoot=="function")try{jf.onPostCommitFiberRoot(gC,e)}catch{}n=!0}return n}finally{Bs=r,Zd.transition=t}}return!1}function WL(e,t,r){t=Jv(r,t),t=AH(e,t,1),e=Rh(e,t,1),t=ic(),e!==null&&(q1(e,1,t),Ic(e,t))}function Vo(e,t,r){if(e.tag===3)WL(e,e,r);else for(;t!==null;){if(t.tag===3){WL(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Fh===null||!Fh.has(n))){e=Jv(r,e),e=PH(t,e,1),t=Rh(t,e,1),e=ic(),t!==null&&(q1(t,1,e),Ic(t,e));break}}t=t.return}}function Fce(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=ic(),e.pingedLanes|=e.suspendedLanes&r,Gi===e&&(ul&r)===r&&(Di===4||Di===3&&(ul&130023424)===ul&&500>Zo()-D4?wg(e,0):T4|=r),Ic(e,t)}function KH(e,t){t===0&&(e.mode&1?(t=G2,G2<<=1,!(G2&130023424)&&(G2=4194304)):t=1);var r=ic();e=jm(e,t),e!==null&&(q1(e,t,r),Ic(e,r))}function Lce(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),KH(e,r)}function $ce(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(yn(314))}n!==null&&n.delete(t),KH(e,r)}var XH;XH=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ec.current)Cc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Cc=!1,Cce(e,t,r);Cc=!!(e.flags&131072)}else Cc=!1,Eo&&t.flags&1048576&&ZW(t,Qj,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;pj(e,t),e=t.pendingProps;var s=Gv(t,Ml.current);kv(t,r),s=A4(null,t,n,e,s,r);var o=P4();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,kc(n)?(o=!0,Yj(t)):o=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,_4(t),s.updater=jC,t.stateNode=s,s._reactInternals=t,bI(t,n,e,r),t=jI(null,t,n,!0,o,r)):(t.tag=0,Eo&&o&&p4(t),Ql(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(pj(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=qce(n),e=Nu(n,e),s){case 0:t=_I(null,t,n,e,r);break e;case 1:t=ML(null,t,n,e,r);break e;case 11:t=TL(null,t,n,e,r);break e;case 14:t=DL(null,t,n,Nu(n.type,e),r);break e}throw Error(yn(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Nu(n,s),_I(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Nu(n,s),ML(e,t,n,s,r);case 3:e:{if(OH(t),e===null)throw Error(yn(387));n=t.pendingProps,o=t.memoizedState,s=o.element,sH(e,t),tN(t,n,null,r);var i=t.memoizedState;if(n=i.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){s=Jv(Error(yn(423)),t),t=RL(e,t,n,r,s);break e}else if(n!==s){s=Jv(Error(yn(424)),t),t=RL(e,t,n,r,s);break e}else for(ad=Mh(t.stateNode.containerInfo.firstChild),dd=t,Eo=!0,Eu=null,r=nH(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Kv(),n===s){t=Nm(e,t,r);break e}Ql(e,t,n,r)}t=t.child}return t;case 5:return oH(t),e===null&&xI(t),n=t.type,s=t.pendingProps,o=e!==null?e.memoizedProps:null,i=s.children,fI(n,s)?i=null:o!==null&&fI(n,o)&&(t.flags|=32),IH(e,t),Ql(e,t,i,r),t.child;case 6:return e===null&&xI(t),null;case 13:return TH(e,t,r);case 4:return j4(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Xv(t,null,n,r):Ql(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Nu(n,s),TL(e,t,n,s,r);case 7:return Ql(e,t,t.pendingProps,r),t.child;case 8:return Ql(e,t,t.pendingProps.children,r),t.child;case 12:return Ql(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,o=t.memoizedProps,i=s.value,io(Zj,n._currentValue),n._currentValue=i,o!==null)if(Bu(o.value,i)){if(o.children===s.children&&!Ec.current){t=Nm(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){i=o.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=pm(-1,r&-r),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),vI(o.return,r,t),l.lanes|=r;break}c=c.next}}else if(o.tag===10)i=o.type===t.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(yn(341));i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),vI(i,r,t),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===t){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}Ql(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,kv(t,r),s=nu(s),n=n(s),t.flags|=1,Ql(e,t,n,r),t.child;case 14:return n=t.type,s=Nu(n,t.pendingProps),s=Nu(n.type,s),DL(e,t,n,s,r);case 15:return EH(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Nu(n,s),pj(e,t),t.tag=1,kc(n)?(e=!0,Yj(t)):e=!1,kv(t,r),CH(t,n,s),bI(t,n,s,r),jI(null,t,n,!0,e,r);case 19:return DH(e,t,r);case 22:return kH(e,t,r)}throw Error(yn(156,t.tag))};function YH(e,t){return jW(e,t)}function Bce(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kd(e,t,r,n){return new Bce(e,t,r,n)}function L4(e){return e=e.prototype,!(!e||!e.isReactComponent)}function qce(e){if(typeof e=="function")return L4(e)?1:0;if(e!=null){if(e=e.$$typeof,e===n4)return 11;if(e===a4)return 14}return 2}function $h(e,t){var r=e.alternate;return r===null?(r=Kd(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function vj(e,t,r,n,s,o){var i=2;if(n=e,typeof e=="function")L4(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case nv:return _g(r.children,s,o,t);case r4:i=8,s|=8;break;case Vk:return e=Kd(12,r,t,s|2),e.elementType=Vk,e.lanes=o,e;case Wk:return e=Kd(13,r,t,s),e.elementType=Wk,e.lanes=o,e;case Hk:return e=Kd(19,r,t,s),e.elementType=Hk,e.lanes=o,e;case oW:return CC(r,s,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case aW:i=10;break e;case sW:i=9;break e;case n4:i=11;break e;case a4:i=14;break e;case ch:i=16,n=null;break e}throw Error(yn(130,e==null?e:typeof e,""))}return t=Kd(i,r,t,s),t.elementType=e,t.type=n,t.lanes=o,t}function _g(e,t,r,n){return e=Kd(7,e,n,t),e.lanes=r,e}function CC(e,t,r,n){return e=Kd(22,e,n,t),e.elementType=oW,e.lanes=r,e.stateNode={isHidden:!1},e}function _P(e,t,r){return e=Kd(6,e,null,t),e.lanes=r,e}function jP(e,t,r){return t=Kd(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zce(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nP(0),this.expirationTimes=nP(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nP(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function $4(e,t,r,n,s,o,i,l,c){return e=new zce(e,t,r,l,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Kd(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},_4(o),e}function Uce(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rv,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function JH(e){if(!e)return ap;e=e._reactInternals;e:{if(sx(e)!==e||e.tag!==1)throw Error(yn(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(kc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(yn(171))}if(e.tag===1){var r=e.type;if(kc(r))return JW(e,r,t)}return t}function QH(e,t,r,n,s,o,i,l,c){return e=$4(r,n,!0,e,s,o,i,l,c),e.context=JH(null),r=e.current,n=ic(),s=Lh(r),o=pm(n,s),o.callback=t??null,Rh(r,o,s),e.current.lanes=s,q1(e,s,n),Ic(e,n),e}function AC(e,t,r,n){var s=t.current,o=ic(),i=Lh(s);return r=JH(r),t.context===null?t.context=r:t.pendingContext=r,t=pm(o,i),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Rh(s,t,i),e!==null&&(Ru(e,s,i,o),fj(e,s,i)),i}function cN(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function HL(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function B4(e,t){HL(e,t),(e=e.alternate)&&HL(e,t)}function Vce(){return null}var ZH=typeof reportError=="function"?reportError:function(e){console.error(e)};function q4(e){this._internalRoot=e}PC.prototype.render=q4.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(yn(409));AC(e,t,null,null)};PC.prototype.unmount=q4.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Bg(function(){AC(null,e,null,null)}),t[_m]=null}};function PC(e){this._internalRoot=e}PC.prototype.unstable_scheduleHydration=function(e){if(e){var t=kW();e={blockedOn:null,target:e,priority:t};for(var r=0;r<hh.length&&t!==0&&t<hh[r].priority;r++);hh.splice(r,0,e),r===0&&OW(e)}};function z4(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function EC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function GL(){}function Wce(e,t,r,n,s){if(s){if(typeof n=="function"){var o=n;n=function(){var d=cN(i);o.call(d)}}var i=QH(t,n,e,0,null,!1,!1,"",GL);return e._reactRootContainer=i,e[_m]=i.current,xw(e.nodeType===8?e.parentNode:e),Bg(),i}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var l=n;n=function(){var d=cN(c);l.call(d)}}var c=$4(e,0,!1,null,null,!1,!1,"",GL);return e._reactRootContainer=c,e[_m]=c.current,xw(e.nodeType===8?e.parentNode:e),Bg(function(){AC(t,c,r,n)}),c}function kC(e,t,r,n,s){var o=r._reactRootContainer;if(o){var i=o;if(typeof s=="function"){var l=s;s=function(){var c=cN(i);l.call(c)}}AC(t,i,e,s)}else i=Wce(r,t,e,s,n);return cN(i)}PW=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=fb(t.pendingLanes);r!==0&&(i4(t,r|1),Ic(t,Zo()),!(Ns&6)&&(Qv=Zo()+500,vp()))}break;case 13:Bg(function(){var n=jm(e,1);if(n!==null){var s=ic();Ru(n,e,1,s)}}),B4(e,1)}};l4=function(e){if(e.tag===13){var t=jm(e,134217728);if(t!==null){var r=ic();Ru(t,e,134217728,r)}B4(e,134217728)}};EW=function(e){if(e.tag===13){var t=Lh(e),r=jm(e,t);if(r!==null){var n=ic();Ru(r,e,t,n)}B4(e,t)}};kW=function(){return Bs};IW=function(e,t){var r=Bs;try{return Bs=e,t()}finally{Bs=r}};rI=function(e,t,r){switch(t){case"input":if(Xk(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=bC(n);if(!s)throw Error(yn(90));lW(n),Xk(n,s)}}}break;case"textarea":dW(e,r);break;case"select":t=r.value,t!=null&&Cv(e,!!r.multiple,t,!1)}};xW=M4;vW=Bg;var Hce={usingClientEntryPoint:!1,Events:[U1,iv,bC,pW,gW,M4]},My={findFiberByHostInstance:sg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Gce={bundleType:My.bundleType,version:My.version,rendererPackageName:My.rendererPackageName,rendererConfig:My.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Mm.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=wW(e),e===null?null:e.stateNode},findFiberByHostInstance:My.findFiberByHostInstance||Vce,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var a_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!a_.isDisabled&&a_.supportsFiber)try{gC=a_.inject(Gce),jf=a_}catch{}}wd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hce;wd.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!z4(t))throw Error(yn(200));return Uce(e,t,null,r)};wd.createRoot=function(e,t){if(!z4(e))throw Error(yn(299));var r=!1,n="",s=ZH;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=$4(e,1,!1,null,null,r,!1,n,s),e[_m]=t.current,xw(e.nodeType===8?e.parentNode:e),new q4(t)};wd.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(yn(188)):(e=Object.keys(e).join(","),Error(yn(268,e)));return e=wW(t),e=e===null?null:e.stateNode,e};wd.flushSync=function(e){return Bg(e)};wd.hydrate=function(e,t,r){if(!EC(t))throw Error(yn(200));return kC(null,e,t,!0,r)};wd.hydrateRoot=function(e,t,r){if(!z4(e))throw Error(yn(405));var n=r!=null&&r.hydratedSources||null,s=!1,o="",i=ZH;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(i=r.onRecoverableError)),t=QH(t,null,e,1,r??null,s,!1,o,i),e[_m]=t.current,xw(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new PC(t)};wd.render=function(e,t,r){if(!EC(t))throw Error(yn(200));return kC(null,e,t,!1,r)};wd.unmountComponentAtNode=function(e){if(!EC(e))throw Error(yn(40));return e._reactRootContainer?(Bg(function(){kC(null,null,e,!1,function(){e._reactRootContainer=null,e[_m]=null})}),!0):!1};wd.unstable_batchedUpdates=M4;wd.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!EC(r))throw Error(yn(200));if(e==null||e._reactInternals===void 0)throw Error(yn(38));return kC(e,t,r,!1,n)};wd.version="18.3.1-next-f1338f8080-20240426";function eG(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(eG)}catch(e){console.error(e)}}eG(),eW.exports=wd;var Rm=eW.exports;const U4=xs(Rm);var KL=Rm;zk.createRoot=KL.createRoot,zk.hydrateRoot=KL.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Cw(){return Cw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cw.apply(this,arguments)}var jh;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(jh||(jh={}));const XL="popstate";function Kce(e){e===void 0&&(e={});function t(n,s){let{pathname:o,search:i,hash:l}=n.location;return MI("",{pathname:o,search:i,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:dN(s)}return Yce(t,r,null,e)}function Lo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function tG(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Xce(){return Math.random().toString(36).substr(2,8)}function YL(e,t){return{usr:e.state,key:e.key,idx:t}}function MI(e,t,r,n){return r===void 0&&(r=null),Cw({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?V0(t):t,{state:r,key:t&&t.key||n||Xce()})}function dN(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function V0(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Yce(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:o=!1}=n,i=s.history,l=jh.Pop,c=null,d=u();d==null&&(d=0,i.replaceState(Cw({},i.state,{idx:d}),""));function u(){return(i.state||{idx:null}).idx}function f(){l=jh.Pop;let y=u(),v=y==null?null:y-d;d=y,c&&c({action:l,location:g.location,delta:v})}function h(y,v){l=jh.Push;let b=MI(g.location,y,v);r&&r(b,y),d=u()+1;let w=YL(b,d),_=g.createHref(b);try{i.pushState(w,"",_)}catch(j){if(j instanceof DOMException&&j.name==="DataCloneError")throw j;s.location.assign(_)}o&&c&&c({action:l,location:g.location,delta:1})}function m(y,v){l=jh.Replace;let b=MI(g.location,y,v);r&&r(b,y),d=u();let w=YL(b,d),_=g.createHref(b);i.replaceState(w,"",_),o&&c&&c({action:l,location:g.location,delta:0})}function x(y){let v=s.location.origin!=="null"?s.location.origin:s.location.href,b=typeof y=="string"?y:dN(y);return b=b.replace(/ $/,"%20"),Lo(v,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,v)}let g={get action(){return l},get location(){return e(s,i)},listen(y){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(XL,f),c=y,()=>{s.removeEventListener(XL,f),c=null}},createHref(y){return t(s,y)},createURL:x,encodeLocation(y){let v=x(y);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:h,replace:m,go(y){return i.go(y)}};return g}var JL;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(JL||(JL={}));function Jce(e,t,r){return r===void 0&&(r="/"),Qce(e,t,r,!1)}function Qce(e,t,r,n){let s=typeof t=="string"?V0(t):t,o=Zv(s.pathname||"/",r);if(o==null)return null;let i=rG(e);Zce(i);let l=null;for(let c=0;l==null&&c<i.length;++c){let d=dde(o);l=lde(i[c],d,n)}return l}function rG(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(o,i,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};c.relativePath.startsWith("/")&&(Lo(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let d=Bh([n,c.relativePath]),u=r.concat(c);o.children&&o.children.length>0&&(Lo(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),rG(o.children,t,u,d)),!(o.path==null&&!o.index)&&t.push({path:d,score:ode(d,o.index),routesMeta:u})};return e.forEach((o,i)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))s(o,i);else for(let c of nG(o.path))s(o,i,c)}),t}function nG(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return s?[o,""]:[o];let i=nG(n.join("/")),l=[];return l.push(...i.map(c=>c===""?o:[o,c].join("/"))),s&&l.push(...i),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function Zce(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:ide(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const ede=/^:[\w-]+$/,tde=3,rde=2,nde=1,ade=10,sde=-2,QL=e=>e==="*";function ode(e,t){let r=e.split("/"),n=r.length;return r.some(QL)&&(n+=sde),t&&(n+=rde),r.filter(s=>!QL(s)).reduce((s,o)=>s+(ede.test(o)?tde:o===""?nde:ade),n)}function ide(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function lde(e,t,r){r===void 0&&(r=!1);let{routesMeta:n}=e,s={},o="/",i=[];for(let l=0;l<n.length;++l){let c=n[l],d=l===n.length-1,u=o==="/"?t:t.slice(o.length)||"/",f=uN({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),h=c.route;if(!f&&d&&r&&!n[n.length-1].route.index&&(f=uN({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!f)return null;Object.assign(s,f.params),i.push({params:s,pathname:Bh([o,f.pathname]),pathnameBase:hde(Bh([o,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(o=Bh([o,f.pathnameBase]))}return i}function uN(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=cde(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let o=s[0],i=o.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:n.reduce((d,u,f)=>{let{paramName:h,isOptional:m}=u;if(h==="*"){let g=l[f]||"";i=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[f];return m&&!x?d[h]=void 0:d[h]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:i,pattern:e}}function cde(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),tG(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function dde(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return tG(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Zv(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function ude(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?V0(e):e;return{pathname:r?r.startsWith("/")?r:fde(r,t):t,search:pde(n),hash:gde(s)}}function fde(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function NP(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function mde(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function V4(e,t){let r=mde(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function W4(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=V0(e):(s=Cw({},e),Lo(!s.pathname||!s.pathname.includes("?"),NP("?","pathname","search",s)),Lo(!s.pathname||!s.pathname.includes("#"),NP("#","pathname","hash",s)),Lo(!s.search||!s.search.includes("#"),NP("#","search","hash",s)));let o=e===""||s.pathname==="",i=o?"/":s.pathname,l;if(i==null)l=r;else{let f=t.length-1;if(!n&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}l=f>=0?t[f]:"/"}let c=ude(s,l),d=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const Bh=e=>e.join("/").replace(/\/\/+/g,"/"),hde=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),pde=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,gde=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function xde(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const aG=["post","put","patch","delete"];new Set(aG);const vde=["get",...aG];new Set(vde);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Aw(){return Aw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Aw.apply(this,arguments)}const IC=p.createContext(null),sG=p.createContext(null),Fm=p.createContext(null),OC=p.createContext(null),Lm=p.createContext({outlet:null,matches:[],isDataRoute:!1}),oG=p.createContext(null);function yde(e,t){let{relative:r}=t===void 0?{}:t;W0()||Lo(!1);let{basename:n,navigator:s}=p.useContext(Fm),{hash:o,pathname:i,search:l}=TC(e,{relative:r}),c=i;return n!=="/"&&(c=i==="/"?n:Bh([n,i])),s.createHref({pathname:c,search:l,hash:o})}function W0(){return p.useContext(OC)!=null}function wi(){return W0()||Lo(!1),p.useContext(OC).location}function iG(e){p.useContext(Fm).static||p.useLayoutEffect(e)}function hl(){let{isDataRoute:e}=p.useContext(Lm);return e?Tde():bde()}function bde(){W0()||Lo(!1);let e=p.useContext(IC),{basename:t,future:r,navigator:n}=p.useContext(Fm),{matches:s}=p.useContext(Lm),{pathname:o}=wi(),i=JSON.stringify(V4(s,r.v7_relativeSplatPath)),l=p.useRef(!1);return iG(()=>{l.current=!0}),p.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){n.go(d);return}let f=W4(d,JSON.parse(i),o,u.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Bh([t,f.pathname])),(u.replace?n.replace:n.push)(f,u.state,u)},[t,n,i,o,e])}function wde(){let{matches:e}=p.useContext(Lm),t=e[e.length-1];return t?t.params:{}}function TC(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=p.useContext(Fm),{matches:s}=p.useContext(Lm),{pathname:o}=wi(),i=JSON.stringify(V4(s,n.v7_relativeSplatPath));return p.useMemo(()=>W4(e,JSON.parse(i),o,r==="path"),[e,i,o,r])}function _de(e,t){return jde(e,t)}function jde(e,t,r,n){W0()||Lo(!1);let{navigator:s}=p.useContext(Fm),{matches:o}=p.useContext(Lm),i=o[o.length-1],l=i?i.params:{};i&&i.pathname;let c=i?i.pathnameBase:"/";i&&i.route;let d=wi(),u;if(t){var f;let y=typeof t=="string"?V0(t):t;c==="/"||(f=y.pathname)!=null&&f.startsWith(c)||Lo(!1),u=y}else u=d;let h=u.pathname||"/",m=h;if(c!=="/"){let y=c.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let x=Jce(e,{pathname:m}),g=Pde(x&&x.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:Bh([c,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:Bh([c,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,r,n);return t&&g?p.createElement(OC.Provider,{value:{location:Aw({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:jh.Pop}},g):g}function Nde(){let e=Ode(),t=xde(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},o=null;return p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},t),r?p.createElement("pre",{style:s},r):null,o)}const Sde=p.createElement(Nde,null);class Cde extends p.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?p.createElement(Lm.Provider,{value:this.props.routeContext},p.createElement(oG.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ade(e){let{routeContext:t,match:r,children:n}=e,s=p.useContext(IC);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),p.createElement(Lm.Provider,{value:t},n)}function Pde(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,l=(s=r)==null?void 0:s.errors;if(l!=null){let u=i.findIndex(f=>f.route.id&&l?.[f.route.id]!==void 0);u>=0||Lo(!1),i=i.slice(0,Math.min(i.length,u+1))}let c=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let u=0;u<i.length;u++){let f=i[u];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(d=u),f.route.id){let{loaderData:h,errors:m}=r,x=f.route.loader&&h[f.route.id]===void 0&&(!m||m[f.route.id]===void 0);if(f.route.lazy||x){c=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((u,f,h)=>{let m,x=!1,g=null,y=null;r&&(m=l&&f.route.id?l[f.route.id]:void 0,g=f.route.errorElement||Sde,c&&(d<0&&h===0?(Dde("route-fallback",!1),x=!0,y=null):d===h&&(x=!0,y=f.route.hydrateFallbackElement||null)));let v=t.concat(i.slice(0,h+1)),b=()=>{let w;return m?w=g:x?w=y:f.route.Component?w=p.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=u,p.createElement(Ade,{match:f,routeContext:{outlet:u,matches:v,isDataRoute:r!=null},children:w})};return r&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?p.createElement(Cde,{location:r.location,revalidation:r.revalidation,component:g,error:m,children:b(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):b()},null)}var lG=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(lG||{}),fN=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(fN||{});function Ede(e){let t=p.useContext(IC);return t||Lo(!1),t}function kde(e){let t=p.useContext(sG);return t||Lo(!1),t}function Ide(e){let t=p.useContext(Lm);return t||Lo(!1),t}function cG(e){let t=Ide(),r=t.matches[t.matches.length-1];return r.route.id||Lo(!1),r.route.id}function Ode(){var e;let t=p.useContext(oG),r=kde(fN.UseRouteError),n=cG(fN.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Tde(){let{router:e}=Ede(lG.UseNavigateStable),t=cG(fN.UseNavigateStable),r=p.useRef(!1);return iG(()=>{r.current=!0}),p.useCallback(function(s,o){o===void 0&&(o={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,Aw({fromRouteId:t},o)))},[e,t])}const ZL={};function Dde(e,t,r){!t&&!ZL[e]&&(ZL[e]=!0)}function Mde(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function dG(e){let{to:t,replace:r,state:n,relative:s}=e;W0()||Lo(!1);let{future:o,static:i}=p.useContext(Fm),{matches:l}=p.useContext(Lm),{pathname:c}=wi(),d=hl(),u=W4(t,V4(l,o.v7_relativeSplatPath),c,s==="path"),f=JSON.stringify(u);return p.useEffect(()=>d(JSON.parse(f),{replace:r,state:n,relative:s}),[d,f,s,r,n]),null}function Ps(e){Lo(!1)}function Rde(e){let{basename:t="/",children:r=null,location:n,navigationType:s=jh.Pop,navigator:o,static:i=!1,future:l}=e;W0()&&Lo(!1);let c=t.replace(/^\/*/,"/"),d=p.useMemo(()=>({basename:c,navigator:o,static:i,future:Aw({v7_relativeSplatPath:!1},l)}),[c,l,o,i]);typeof n=="string"&&(n=V0(n));let{pathname:u="/",search:f="",hash:h="",state:m=null,key:x="default"}=n,g=p.useMemo(()=>{let y=Zv(u,c);return y==null?null:{location:{pathname:y,search:f,hash:h,state:m,key:x},navigationType:s}},[c,u,f,h,m,x,s]);return g==null?null:p.createElement(Fm.Provider,{value:d},p.createElement(OC.Provider,{children:r,value:g}))}function yj(e){let{children:t,location:r}=e;return _de(RI(t),r)}new Promise(()=>{});function RI(e,t){t===void 0&&(t=[]);let r=[];return p.Children.forEach(e,(n,s)=>{if(!p.isValidElement(n))return;let o=[...t,s];if(n.type===p.Fragment){r.push.apply(r,RI(n.props.children,o));return}n.type!==Ps&&Lo(!1),!n.props.index||!n.props.children||Lo(!1);let i={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=RI(n.props.children,o)),r.push(i)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function mN(){return mN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mN.apply(this,arguments)}function uG(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function Fde(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Lde(e,t){return e.button===0&&(!t||t==="_self")&&!Fde(e)}function FI(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(s=>[r,s]):[[r,n]])},[]))}function $de(e,t){let r=FI(e);return t&&t.forEach((n,s)=>{r.has(s)||t.getAll(s).forEach(o=>{r.append(s,o)})}),r}const Bde=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],qde=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],zde="6";try{window.__reactRouterVersion=zde}catch{}const Ude=p.createContext({isTransitioning:!1}),Vde="startTransition",e$=Q3[Vde];function Wde(e){let{basename:t,children:r,future:n,window:s}=e,o=p.useRef();o.current==null&&(o.current=Kce({window:s,v5Compat:!0}));let i=o.current,[l,c]=p.useState({action:i.action,location:i.location}),{v7_startTransition:d}=n||{},u=p.useCallback(f=>{d&&e$?e$(()=>c(f)):c(f)},[c,d]);return p.useLayoutEffect(()=>i.listen(u),[i,u]),p.useEffect(()=>Mde(n),[n]),p.createElement(Rde,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:i,future:n})}const Hde=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Gde=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,H4=p.forwardRef(function(t,r){let{onClick:n,relative:s,reloadDocument:o,replace:i,state:l,target:c,to:d,preventScrollReset:u,viewTransition:f}=t,h=uG(t,Bde),{basename:m}=p.useContext(Fm),x,g=!1;if(typeof d=="string"&&Gde.test(d)&&(x=d,Hde))try{let w=new URL(window.location.href),_=d.startsWith("//")?new URL(w.protocol+d):new URL(d),j=Zv(_.pathname,m);_.origin===w.origin&&j!=null?d=j+_.search+_.hash:g=!0}catch{}let y=yde(d,{relative:s}),v=Xde(d,{replace:i,state:l,target:c,preventScrollReset:u,relative:s,viewTransition:f});function b(w){n&&n(w),w.defaultPrevented||v(w)}return p.createElement("a",mN({},h,{href:x||y,onClick:g||o?n:b,ref:r,target:c}))}),em=p.forwardRef(function(t,r){let{"aria-current":n="page",caseSensitive:s=!1,className:o="",end:i=!1,style:l,to:c,viewTransition:d,children:u}=t,f=uG(t,qde),h=TC(c,{relative:f.relative}),m=wi(),x=p.useContext(sG),{navigator:g,basename:y}=p.useContext(Fm),v=x!=null&&Yde(h)&&d===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,w=m.pathname,_=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;s||(w=w.toLowerCase(),_=_?_.toLowerCase():null,b=b.toLowerCase()),_&&y&&(_=Zv(_,y)||_);const j=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let S=w===b||!i&&w.startsWith(b)&&w.charAt(j)==="/",C=_!=null&&(_===b||!i&&_.startsWith(b)&&_.charAt(b.length)==="/"),A={isActive:S,isPending:C,isTransitioning:v},P=S?n:void 0,F;typeof o=="function"?F=o(A):F=[o,S?"active":null,C?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let O=typeof l=="function"?l(A):l;return p.createElement(H4,mN({},f,{"aria-current":P,className:F,ref:r,style:O,to:c,viewTransition:d}),typeof u=="function"?u(A):u)});var LI;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(LI||(LI={}));var t$;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(t$||(t$={}));function Kde(e){let t=p.useContext(IC);return t||Lo(!1),t}function Xde(e,t){let{target:r,replace:n,state:s,preventScrollReset:o,relative:i,viewTransition:l}=t===void 0?{}:t,c=hl(),d=wi(),u=TC(e,{relative:i});return p.useCallback(f=>{if(Lde(f,r)){f.preventDefault();let h=n!==void 0?n:dN(d)===dN(u);c(e,{replace:h,state:s,preventScrollReset:o,relative:i,viewTransition:l})}},[d,c,u,n,s,r,e,o,i,l])}function DC(e){let t=p.useRef(FI(e)),r=p.useRef(!1),n=wi(),s=p.useMemo(()=>$de(n.search,r.current?null:t.current),[n.search]),o=hl(),i=p.useCallback((l,c)=>{const d=FI(typeof l=="function"?l(s):l);r.current=!0,o("?"+d,c)},[o,s]);return[s,i]}function Yde(e,t){t===void 0&&(t={});let r=p.useContext(Ude);r==null&&Lo(!1);let{basename:n}=Kde(LI.useViewTransitionState),s=TC(e,{relative:t.relative});if(!r.isTransitioning)return!1;let o=Zv(r.currentLocation.pathname,n)||r.currentLocation.pathname,i=Zv(r.nextLocation.pathname,n)||r.nextLocation.pathname;return uN(s.pathname,i)!=null||uN(s.pathname,o)!=null}function fG(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=fG(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function qa(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=fG(e))&&(n&&(n+=" "),n+=t);return n}function Jde(){for(var e=0,t,r,n="";e<arguments.length;)(t=arguments[e++])&&(r=mG(t))&&(n&&(n+=" "),n+=r);return n}function mG(e){if(typeof e=="string")return e;for(var t,r="",n=0;n<e.length;n++)e[n]&&(t=mG(e[n]))&&(r&&(r+=" "),r+=t);return r}var G4="-";function Qde(e){var t=eue(e),r=e.conflictingClassGroups,n=e.conflictingClassGroupModifiers,s=n===void 0?{}:n;function o(l){var c=l.split(G4);return c[0]===""&&c.length!==1&&c.shift(),hG(c,t)||Zde(l)}function i(l,c){var d=r[l]||[];return c&&s[l]?[].concat(d,s[l]):d}return{getClassGroupId:o,getConflictingClassGroupIds:i}}function hG(e,t){if(e.length===0)return t.classGroupId;var r=e[0],n=t.nextPart.get(r),s=n?hG(e.slice(1),n):void 0;if(s)return s;if(t.validators.length!==0){var o=e.join(G4);return t.validators.find(function(i){var l=i.validator;return l(o)})?.classGroupId}}var r$=/^\[(.+)\]$/;function Zde(e){if(r$.test(e)){var t=r$.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}}function eue(e){var t=e.theme,r=e.prefix,n={nextPart:new Map,validators:[]},s=rue(Object.entries(e.classGroups),r);return s.forEach(function(o){var i=o[0],l=o[1];$I(l,n,i,t)}),n}function $I(e,t,r,n){e.forEach(function(s){if(typeof s=="string"){var o=s===""?t:n$(t,s);o.classGroupId=r;return}if(typeof s=="function"){if(tue(s)){$I(s(n),t,r,n);return}t.validators.push({validator:s,classGroupId:r});return}Object.entries(s).forEach(function(i){var l=i[0],c=i[1];$I(c,n$(t,l),r,n)})})}function n$(e,t){var r=e;return t.split(G4).forEach(function(n){r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r}function tue(e){return e.isThemeGetter}function rue(e,t){return t?e.map(function(r){var n=r[0],s=r[1],o=s.map(function(i){return typeof i=="string"?t+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(function(l){var c=l[0],d=l[1];return[t+c,d]})):i});return[n,o]}):e}function nue(e){if(e<1)return{get:function(){},set:function(){}};var t=0,r=new Map,n=new Map;function s(o,i){r.set(o,i),t++,t>e&&(t=0,n=r,r=new Map)}return{get:function(i){var l=r.get(i);if(l!==void 0)return l;if((l=n.get(i))!==void 0)return s(i,l),l},set:function(i,l){r.has(i)?r.set(i,l):s(i,l)}}}var pG="!";function aue(e){var t=e.separator||":",r=t.length===1,n=t[0],s=t.length;return function(i){for(var l=[],c=0,d=0,u,f=0;f<i.length;f++){var h=i[f];if(c===0){if(h===n&&(r||i.slice(f,f+s)===t)){l.push(i.slice(d,f)),d=f+s;continue}if(h==="/"){u=f;continue}}h==="["?c++:h==="]"&&c--}var m=l.length===0?i:i.substring(d),x=m.startsWith(pG),g=x?m.substring(1):m,y=u&&u>d?u-d:void 0;return{modifiers:l,hasImportantModifier:x,baseClassName:g,maybePostfixModifierPosition:y}}}function sue(e){if(e.length<=1)return e;var t=[],r=[];return e.forEach(function(n){var s=n[0]==="[";s?(t.push.apply(t,r.sort().concat([n])),r=[]):r.push(n)}),t.push.apply(t,r.sort()),t}function oue(e){return{cache:nue(e.cacheSize),splitModifiers:aue(e),...Qde(e)}}var iue=/\s+/;function lue(e,t){var r=t.splitModifiers,n=t.getClassGroupId,s=t.getConflictingClassGroupIds,o=new Set;return e.trim().split(iue).map(function(i){var l=r(i),c=l.modifiers,d=l.hasImportantModifier,u=l.baseClassName,f=l.maybePostfixModifierPosition,h=n(f?u.substring(0,f):u),m=!!f;if(!h){if(!f)return{isTailwindClass:!1,originalClassName:i};if(h=n(u),!h)return{isTailwindClass:!1,originalClassName:i};m=!1}var x=sue(c).join(":"),g=d?x+pG:x;return{isTailwindClass:!0,modifierId:g,classGroupId:h,originalClassName:i,hasPostfixModifier:m}}).reverse().filter(function(i){if(!i.isTailwindClass)return!0;var l=i.modifierId,c=i.classGroupId,d=i.hasPostfixModifier,u=l+c;return o.has(u)?!1:(o.add(u),s(c,d).forEach(function(f){return o.add(l+f)}),!0)}).reverse().map(function(i){return i.originalClassName}).join(" ")}function cue(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,s,o,i=l;function l(d){var u=t[0],f=t.slice(1),h=f.reduce(function(m,x){return x(m)},u());return n=oue(h),s=n.cache.get,o=n.cache.set,i=c,c(d)}function c(d){var u=s(d);if(u)return u;var f=lue(d,n);return o(d,f),f}return function(){return i(Jde.apply(null,arguments))}}function go(e){var t=function(n){return n[e]||[]};return t.isThemeGetter=!0,t}var gG=/^\[(?:([a-z-]+):)?(.+)\]$/i,due=/^\d+\/\d+$/,uue=new Set(["px","full","screen"]),fue=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,mue=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,hue=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function vu(e){return lg(e)||uue.has(e)||due.test(e)||BI(e)}function BI(e){return ox(e,"length",bue)}function pue(e){return ox(e,"size",xG)}function gue(e){return ox(e,"position",xG)}function xue(e){return ox(e,"url",wue)}function s_(e){return ox(e,"number",lg)}function lg(e){return!Number.isNaN(Number(e))}function vue(e){return e.endsWith("%")&&lg(e.slice(0,-1))}function Ry(e){return a$(e)||ox(e,"number",a$)}function ls(e){return gG.test(e)}function Fy(){return!0}function Ym(e){return fue.test(e)}function yue(e){return ox(e,"",_ue)}function ox(e,t,r){var n=gG.exec(e);return n?n[1]?n[1]===t:r(n[2]):!1}function bue(e){return mue.test(e)}function xG(){return!1}function wue(e){return e.startsWith("url(")}function a$(e){return Number.isInteger(Number(e))}function _ue(e){return hue.test(e)}function jue(){var e=go("colors"),t=go("spacing"),r=go("blur"),n=go("brightness"),s=go("borderColor"),o=go("borderRadius"),i=go("borderSpacing"),l=go("borderWidth"),c=go("contrast"),d=go("grayscale"),u=go("hueRotate"),f=go("invert"),h=go("gap"),m=go("gradientColorStops"),x=go("gradientColorStopPositions"),g=go("inset"),y=go("margin"),v=go("opacity"),b=go("padding"),w=go("saturate"),_=go("scale"),j=go("sepia"),S=go("skew"),C=go("space"),A=go("translate"),P=function(){return["auto","contain","none"]},F=function(){return["auto","hidden","clip","visible","scroll"]},O=function(){return["auto",ls,t]},I=function(){return[ls,t]},T=function(){return["",vu]},k=function(){return["auto",lg,ls]},B=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},z=function(){return["solid","dashed","dotted","double","none"]},U=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},L=function(){return["start","end","center","between","around","evenly","stretch"]},W=function(){return["","0",ls]},ge=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},Ae=function(){return[lg,s_]},V=function(){return[lg,ls]};return{cacheSize:500,theme:{colors:[Fy],spacing:[vu],blur:["none","",Ym,ls],brightness:Ae(),borderColor:[e],borderRadius:["none","","full",Ym,ls],borderSpacing:I(),borderWidth:T(),contrast:Ae(),grayscale:W(),hueRotate:V(),invert:W(),gap:I(),gradientColorStops:[e],gradientColorStopPositions:[vue,BI],inset:O(),margin:O(),opacity:Ae(),padding:I(),saturate:Ae(),scale:Ae(),sepia:W(),skew:V(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",ls]}],container:["container"],columns:[{columns:[Ym]}],"break-after":[{"break-after":ge()}],"break-before":[{"break-before":ge()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat(B(),[ls])}],overflow:[{overflow:F()}],"overflow-x":[{"overflow-x":F()}],"overflow-y":[{"overflow-y":F()}],overscroll:[{overscroll:P()}],"overscroll-x":[{"overscroll-x":P()}],"overscroll-y":[{"overscroll-y":P()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ry]}],basis:[{basis:O()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ls]}],grow:[{grow:W()}],shrink:[{shrink:W()}],order:[{order:["first","last","none",Ry]}],"grid-cols":[{"grid-cols":[Fy]}],"col-start-end":[{col:["auto",{span:["full",Ry]},ls]}],"col-start":[{"col-start":k()}],"col-end":[{"col-end":k()}],"grid-rows":[{"grid-rows":[Fy]}],"row-start-end":[{row:["auto",{span:[Ry]},ls]}],"row-start":[{"row-start":k()}],"row-end":[{"row-end":k()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ls]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ls]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal"].concat(L())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(L(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(L(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",ls,t]}],"min-w":[{"min-w":["min","max","fit",ls,vu]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[Ym]},Ym,ls]}],h:[{h:[ls,t,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",ls,vu]}],"max-h":[{"max-h":[ls,t,"min","max","fit"]}],"font-size":[{text:["base",Ym,BI]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",s_]}],"font-family":[{font:[Fy]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ls]}],"line-clamp":[{"line-clamp":["none",lg,s_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ls,vu]}],"list-image":[{"list-image":["none",ls]}],"list-style-type":[{list:["none","disc","decimal",ls]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(z(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",vu]}],"underline-offset":[{"underline-offset":["auto",ls,vu]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ls]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ls]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat(B(),[gue])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",pue]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},xue]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[].concat(z(),["hidden"])}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:z()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:[""].concat(z())}],"outline-offset":[{"outline-offset":[ls,vu]}],"outline-w":[{outline:[vu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:T()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[vu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Ym,yue]}],"shadow-color":[{shadow:[Fy]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":U()}],"bg-blend":[{"bg-blend":U()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Ym,ls]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[f]}],saturate:[{saturate:[w]}],sepia:[{sepia:[j]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[j]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ls]}],duration:[{duration:V()}],ease:[{ease:["linear","in","out","in-out",ls]}],delay:[{delay:V()}],animate:[{animate:["none","spin","ping","pulse","bounce",ls]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[_]}],"scale-x":[{"scale-x":[_]}],"scale-y":[{"scale-y":[_]}],rotate:[{rotate:[Ry,ls]}],"translate-x":[{"translate-x":[A]}],"translate-y":[{"translate-y":[A]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ls]}],accent:[{accent:["auto",e]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ls]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ls]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[vu,s_]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}var Nue=cue(jue);function Sr(...e){return Nue(qa(e))}const s$=["#3B82F6","#22C55E","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#F43F5E","#10B981","#A855F7","#EAB308"];function Sue(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return Math.abs(t)}function uh(e){if(!e)return"#94A3B8";const t=Sue(String(e))%s$.length;return s$[t]}var Cue={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Aue=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),on=(e,t)=>{const r=p.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:i,children:l,...c},d)=>p.createElement("svg",{ref:d,...Cue,width:s,height:s,stroke:n,strokeWidth:i?Number(o)*24/Number(s):o,className:`lucide lucide-${Aue(e)}`,...c},[...t.map(([u,f])=>p.createElement(u,f)),...(Array.isArray(l)?l:[l])||[]]));return r.displayName=`${e}`,r},ud=on("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Df=on("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Pue=on("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]),Ib=on("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),o_=on("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),K4=on("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),X4=on("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),Y4=on("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),bj=on("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Ob=on("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),vG=on("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),Eue=on("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),hN=on("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),kue=on("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),MC=on("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),Iue=on("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),J4=on("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),wj=on("CalendarX",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"10",x2:"14",y1:"14",y2:"18",key:"1g3qc0"}],["line",{x1:"14",x2:"10",y1:"14",y2:"18",key:"1az83m"}]]),lo=on("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),hb=on("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),vi=on("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Sm=on("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ix=on("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),qI=on("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),qg=on("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Oue=on("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Tue=on("Chrome",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["line",{x1:"21.17",x2:"12",y1:"8",y2:"8",key:"a0cw5f"}],["line",{x1:"3.95",x2:"8.54",y1:"6.06",y2:"14",key:"1kftof"}],["line",{x1:"10.88",x2:"15.46",y1:"21.94",y2:"14",key:"1ymyh8"}]]),Due=on("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Mue=on("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]),eu=on("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Q4=on("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Nh=on("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Oi=on("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),ks=on("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),jg=on("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),zg=on("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Sx=on("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),Vi=on("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),zI=on("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Rue=on("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Fue=on("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Lue=on("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),$ue=on("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),Bue=on("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),que=on("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),zue=on("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),yG=on("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Uue=on("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",key:"1kog09"}]]),Vue=on("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),Wue=on("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),bG=on("LifeBuoy",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.93 4.93 4.24 4.24",key:"1ymg45"}],["path",{d:"m14.83 9.17 4.24-4.24",key:"1cb5xl"}],["path",{d:"m14.83 14.83 4.24 4.24",key:"q42g0n"}],["path",{d:"m9.17 14.83-4.24 4.24",key:"bqpfvv"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]),wG=on("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),Hue=on("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),Zl=on("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),e0=on("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Gue=on("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Kue=on("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),t0=on("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),o$=on("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Xue=on("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),SP=on("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Yue=on("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),i$=on("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),hv=on("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Jue=on("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),l$=on("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),su=on("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),ec=on("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Que=on("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Pw=on("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),_G=on("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),Es=on("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),jG=on("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),Ng=on("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),c$=on("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Zue=on("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Mo=on("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Z4=on("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),fd=on("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),d$=on("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),u$=on("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),efe=on("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Tb=on("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),W1=on("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),f$=on("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),CP=on("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),UI=on("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),tfe=on("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),eD=on("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]),i_=on("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Sf=on("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),rfe=on("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Cm=on("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),sd=on("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),nfe=on("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]),NG=on("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),tD=on("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),afe=on("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),sfe=on("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),ofe=on("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),SG=on("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),xf=on("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),tc=on("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),CG=on("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),Sg=on("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),lc=on("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Hi=({size:e="md",variant:t="header",className:r=""})=>{const n={xs:"w-8 h-8",sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20",xl:"w-24 h-24"},s={header:"/isis-profile.png",message:"/isis-profile-baloon.png"},o=s[t]||s.header,i=e==="lg"?"scale-125":e==="md"?"scale-110":"scale-100";return a.jsx("div",{className:`${n[e]||n.md} rounded-full overflow-hidden flex-shrink-0 ring-2 ring-brand ring-offset-0 ${r}`,children:a.jsx("img",{src:o,alt:"Assistente Virtual",className:`w-full h-full object-cover ${i}`,onError:l=>{l.target.style.display="none",l.target.parentElement.innerHTML=`
            <div class="w-full h-full bg-brand flex items-center justify-center">
              <span class="text-bg font-bold text-lg">A</span>
            </div>
          `}})})},AG=p.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),RC=p.createContext({}),FC=p.createContext(null),LC=typeof document<"u",rD=LC?p.useLayoutEffect:p.useEffect,PG=p.createContext({strict:!1}),nD=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),ife="framerAppearId",EG="data-"+nD(ife);function lfe(e,t,r,n){const{visualElement:s}=p.useContext(RC),o=p.useContext(PG),i=p.useContext(FC),l=p.useContext(AG).reducedMotion,c=p.useRef();n=n||o.renderer,!c.current&&n&&(c.current=n(e,{visualState:t,parent:s,props:r,presenceContext:i,blockInitialAnimation:i?i.initial===!1:!1,reducedMotionConfig:l}));const d=c.current;p.useInsertionEffect(()=>{d&&d.update(r,i)});const u=p.useRef(!!(r[EG]&&!window.HandoffComplete));return rD(()=>{d&&(d.render(),u.current&&d.animationState&&d.animationState.animateChanges())}),p.useEffect(()=>{d&&(d.updateFeatures(),!u.current&&d.animationState&&d.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),d}function pv(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function cfe(e,t,r){return p.useCallback(n=>{n&&e.mount&&e.mount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):pv(r)&&(r.current=n))},[t])}function Ew(e){return typeof e=="string"||Array.isArray(e)}function $C(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const aD=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],sD=["initial",...aD];function BC(e){return $C(e.animate)||sD.some(t=>Ew(e[t]))}function kG(e){return!!(BC(e)||e.variants)}function dfe(e,t){if(BC(e)){const{initial:r,animate:n}=e;return{initial:r===!1||Ew(r)?r:void 0,animate:Ew(n)?n:void 0}}return e.inherit!==!1?t:{}}function ufe(e){const{initial:t,animate:r}=dfe(e,p.useContext(RC));return p.useMemo(()=>({initial:t,animate:r}),[m$(t),m$(r)])}function m$(e){return Array.isArray(e)?e.join(" "):e}const h$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},kw={};for(const e in h$)kw[e]={isEnabled:t=>h$[e].some(r=>!!t[r])};function ffe(e){for(const t in e)kw[t]={...kw[t],...e[t]}}const oD=p.createContext({}),IG=p.createContext({}),mfe=Symbol.for("motionComponentSymbol");function hfe({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:n,Component:s}){e&&ffe(e);function o(l,c){let d;const u={...p.useContext(AG),...l,layoutId:pfe(l)},{isStatic:f}=u,h=ufe(l),m=n(l,f);if(!f&&LC){h.visualElement=lfe(s,m,u,t);const x=p.useContext(IG),g=p.useContext(PG).strict;h.visualElement&&(d=h.visualElement.loadFeatures(u,g,e,x))}return p.createElement(RC.Provider,{value:h},d&&h.visualElement?p.createElement(d,{visualElement:h.visualElement,...u}):null,r(s,l,cfe(m,h.visualElement,c),m,f,h.visualElement))}const i=p.forwardRef(o);return i[mfe]=s,i}function pfe({layoutId:e}){const t=p.useContext(oD).id;return t&&e!==void 0?t+"-"+e:e}function gfe(e){function t(n,s={}){return hfe(e(n,s))}if(typeof Proxy>"u")return t;const r=new Map;return new Proxy(t,{get:(n,s)=>(r.has(s)||r.set(s,t(s)),r.get(s))})}const xfe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function iD(e){return typeof e!="string"||e.includes("-")?!1:!!(xfe.indexOf(e)>-1||/[A-Z]/.test(e))}const pN={};function vfe(e){Object.assign(pN,e)}const H1=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],lx=new Set(H1);function OG(e,{layout:t,layoutId:r}){return lx.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!pN[e]||e==="opacity")}const Tc=e=>!!(e&&e.getVelocity),yfe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},bfe=H1.length;function wfe(e,{enableHardwareAcceleration:t=!0,allowTransformNone:r=!0},n,s){let o="";for(let i=0;i<bfe;i++){const l=H1[i];if(e[l]!==void 0){const c=yfe[l]||l;o+=`${c}(${e[l]}) `}}return t&&!e.z&&(o+="translateZ(0)"),o=o.trim(),s?o=s(e,n?"":o):r&&n&&(o="none"),o}const TG=e=>t=>typeof t=="string"&&t.startsWith(e),DG=TG("--"),VI=TG("var(--"),_fe=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,jfe=(e,t)=>t&&typeof e=="number"?t.transform(e):e,sp=(e,t,r)=>Math.min(Math.max(r,e),t),cx={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Db={...cx,transform:e=>sp(0,1,e)},l_={...cx,default:1},Mb=e=>Math.round(e*1e5)/1e5,qC=/(-)?([\d]*\.?[\d])+/g,MG=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Nfe=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function G1(e){return typeof e=="string"}const K1=e=>({test:t=>G1(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),ah=K1("deg"),Cf=K1("%"),Oa=K1("px"),Sfe=K1("vh"),Cfe=K1("vw"),p$={...Cf,parse:e=>Cf.parse(e)/100,transform:e=>Cf.transform(e*100)},g$={...cx,transform:Math.round},RG={borderWidth:Oa,borderTopWidth:Oa,borderRightWidth:Oa,borderBottomWidth:Oa,borderLeftWidth:Oa,borderRadius:Oa,radius:Oa,borderTopLeftRadius:Oa,borderTopRightRadius:Oa,borderBottomRightRadius:Oa,borderBottomLeftRadius:Oa,width:Oa,maxWidth:Oa,height:Oa,maxHeight:Oa,size:Oa,top:Oa,right:Oa,bottom:Oa,left:Oa,padding:Oa,paddingTop:Oa,paddingRight:Oa,paddingBottom:Oa,paddingLeft:Oa,margin:Oa,marginTop:Oa,marginRight:Oa,marginBottom:Oa,marginLeft:Oa,rotate:ah,rotateX:ah,rotateY:ah,rotateZ:ah,scale:l_,scaleX:l_,scaleY:l_,scaleZ:l_,skew:ah,skewX:ah,skewY:ah,distance:Oa,translateX:Oa,translateY:Oa,translateZ:Oa,x:Oa,y:Oa,z:Oa,perspective:Oa,transformPerspective:Oa,opacity:Db,originX:p$,originY:p$,originZ:Oa,zIndex:g$,fillOpacity:Db,strokeOpacity:Db,numOctaves:g$};function lD(e,t,r,n){const{style:s,vars:o,transform:i,transformOrigin:l}=e;let c=!1,d=!1,u=!0;for(const f in t){const h=t[f];if(DG(f)){o[f]=h;continue}const m=RG[f],x=jfe(h,m);if(lx.has(f)){if(c=!0,i[f]=x,!u)continue;h!==(m.default||0)&&(u=!1)}else f.startsWith("origin")?(d=!0,l[f]=x):s[f]=x}if(t.transform||(c||n?s.transform=wfe(e.transform,r,u,n):s.transform&&(s.transform="none")),d){const{originX:f="50%",originY:h="50%",originZ:m=0}=l;s.transformOrigin=`${f} ${h} ${m}`}}const cD=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function FG(e,t,r){for(const n in t)!Tc(t[n])&&!OG(n,r)&&(e[n]=t[n])}function Afe({transformTemplate:e},t,r){return p.useMemo(()=>{const n=cD();return lD(n,t,{enableHardwareAcceleration:!r},e),Object.assign({},n.vars,n.style)},[t])}function Pfe(e,t,r){const n=e.style||{},s={};return FG(s,n,e),Object.assign(s,Afe(e,t,r)),e.transformValues?e.transformValues(s):s}function Efe(e,t,r){const n={},s=Pfe(e,t,r);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const kfe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function gN(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||kfe.has(e)}let LG=e=>!gN(e);function Ife(e){e&&(LG=t=>t.startsWith("on")?!gN(t):e(t))}try{Ife(require("@emotion/is-prop-valid").default)}catch{}function Ofe(e,t,r){const n={};for(const s in e)s==="values"&&typeof e.values=="object"||(LG(s)||r===!0&&gN(s)||!t&&!gN(s)||e.draggable&&s.startsWith("onDrag"))&&(n[s]=e[s]);return n}function x$(e,t,r){return typeof e=="string"?e:Oa.transform(t+r*e)}function Tfe(e,t,r){const n=x$(t,e.x,e.width),s=x$(r,e.y,e.height);return`${n} ${s}`}const Dfe={offset:"stroke-dashoffset",array:"stroke-dasharray"},Mfe={offset:"strokeDashoffset",array:"strokeDasharray"};function Rfe(e,t,r=1,n=0,s=!0){e.pathLength=1;const o=s?Dfe:Mfe;e[o.offset]=Oa.transform(-n);const i=Oa.transform(t),l=Oa.transform(r);e[o.array]=`${i} ${l}`}function dD(e,{attrX:t,attrY:r,attrScale:n,originX:s,originY:o,pathLength:i,pathSpacing:l=1,pathOffset:c=0,...d},u,f,h){if(lD(e,d,u,h),f){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:m,style:x,dimensions:g}=e;m.transform&&(g&&(x.transform=m.transform),delete m.transform),g&&(s!==void 0||o!==void 0||x.transform)&&(x.transformOrigin=Tfe(g,s!==void 0?s:.5,o!==void 0?o:.5)),t!==void 0&&(m.x=t),r!==void 0&&(m.y=r),n!==void 0&&(m.scale=n),i!==void 0&&Rfe(m,i,l,c,!1)}const $G=()=>({...cD(),attrs:{}}),uD=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Ffe(e,t,r,n){const s=p.useMemo(()=>{const o=$G();return dD(o,t,{enableHardwareAcceleration:!1},uD(n),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};FG(o,e.style,e),s.style={...o,...s.style}}return s}function Lfe(e=!1){return(r,n,s,{latestValues:o},i)=>{const c=(iD(r)?Ffe:Efe)(n,o,i,r),u={...Ofe(n,typeof r=="string",e),...c,ref:s},{children:f}=n,h=p.useMemo(()=>Tc(f)?f.get():f,[f]);return p.createElement(r,{...u,children:h})}}function BG(e,{style:t,vars:r},n,s){Object.assign(e.style,t,s&&s.getProjectionStyles(n));for(const o in r)e.style.setProperty(o,r[o])}const qG=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function zG(e,t,r,n){BG(e,t,void 0,n);for(const s in t.attrs)e.setAttribute(qG.has(s)?s:nD(s),t.attrs[s])}function fD(e,t){const{style:r}=e,n={};for(const s in r)(Tc(r[s])||t.style&&Tc(t.style[s])||OG(s,e))&&(n[s]=r[s]);return n}function UG(e,t){const r=fD(e,t);for(const n in e)if(Tc(e[n])||Tc(t[n])){const s=H1.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=e[n]}return r}function mD(e,t,r,n={},s={}){return typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,s)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,s)),t}function VG(e){const t=p.useRef(null);return t.current===null&&(t.current=e()),t.current}const xN=e=>Array.isArray(e),$fe=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),Bfe=e=>xN(e)?e[e.length-1]||0:e;function _j(e){const t=Tc(e)?e.get():e;return $fe(t)?t.toValue():t}function qfe({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:r},n,s,o){const i={latestValues:zfe(n,s,o,e),renderState:t()};return r&&(i.mount=l=>r(n,l,i)),i}const WG=e=>(t,r)=>{const n=p.useContext(RC),s=p.useContext(FC),o=()=>qfe(e,t,n,s);return r?o():VG(o)};function zfe(e,t,r,n){const s={},o=n(e,{});for(const h in o)s[h]=_j(o[h]);let{initial:i,animate:l}=e;const c=BC(e),d=kG(e);t&&d&&!c&&e.inherit!==!1&&(i===void 0&&(i=t.initial),l===void 0&&(l=t.animate));let u=r?r.initial===!1:!1;u=u||i===!1;const f=u?l:i;return f&&typeof f!="boolean"&&!$C(f)&&(Array.isArray(f)?f:[f]).forEach(m=>{const x=mD(e,m);if(!x)return;const{transitionEnd:g,transition:y,...v}=x;for(const b in v){let w=v[b];if(Array.isArray(w)){const _=u?w.length-1:0;w=w[_]}w!==null&&(s[b]=w)}for(const b in g)s[b]=g[b]}),s}const Ho=e=>e;class v${constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const r=this.order.indexOf(t);r!==-1&&(this.order.splice(r,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function Ufe(e){let t=new v$,r=new v$,n=0,s=!1,o=!1;const i=new WeakSet,l={schedule:(c,d=!1,u=!1)=>{const f=u&&s,h=f?t:r;return d&&i.add(c),h.add(c)&&f&&s&&(n=t.order.length),c},cancel:c=>{r.remove(c),i.delete(c)},process:c=>{if(s){o=!0;return}if(s=!0,[t,r]=[r,t],r.clear(),n=t.order.length,n)for(let d=0;d<n;d++){const u=t.order[d];u(c),i.has(u)&&(l.schedule(u),e())}s=!1,o&&(o=!1,l.process(c))}};return l}const c_=["prepare","read","update","preRender","render","postRender"],Vfe=40;function Wfe(e,t){let r=!1,n=!0;const s={delta:0,timestamp:0,isProcessing:!1},o=c_.reduce((f,h)=>(f[h]=Ufe(()=>r=!0),f),{}),i=f=>o[f].process(s),l=()=>{const f=performance.now();r=!1,s.delta=n?1e3/60:Math.max(Math.min(f-s.timestamp,Vfe),1),s.timestamp=f,s.isProcessing=!0,c_.forEach(i),s.isProcessing=!1,r&&t&&(n=!1,e(l))},c=()=>{r=!0,n=!0,s.isProcessing||e(l)};return{schedule:c_.reduce((f,h)=>{const m=o[h];return f[h]=(x,g=!1,y=!1)=>(r||c(),m.schedule(x,g,y)),f},{}),cancel:f=>c_.forEach(h=>o[h].cancel(f)),state:s,steps:o}}const{schedule:co,cancel:Am,state:Pl,steps:AP}=Wfe(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ho,!0),Hfe={useVisualState:WG({scrapeMotionValuesFromProps:UG,createRenderState:$G,onMount:(e,t,{renderState:r,latestValues:n})=>{co.read(()=>{try{r.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}}),co.render(()=>{dD(r,n,{enableHardwareAcceleration:!1},uD(t.tagName),e.transformTemplate),zG(t,r)})}})},Gfe={useVisualState:WG({scrapeMotionValuesFromProps:fD,createRenderState:cD})};function Kfe(e,{forwardMotionProps:t=!1},r,n){return{...iD(e)?Hfe:Gfe,preloadedFeatures:r,useRender:Lfe(t),createVisualElement:n,Component:e}}function dm(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}const HG=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function zC(e,t="page"){return{point:{x:e[t+"X"],y:e[t+"Y"]}}}const Xfe=e=>t=>HG(t)&&e(t,zC(t));function gm(e,t,r,n){return dm(e,t,Xfe(r),n)}const Yfe=(e,t)=>r=>t(e(r)),qh=(...e)=>e.reduce(Yfe);function GG(e){let t=null;return()=>{const r=()=>{t=null};return t===null?(t=e,r):!1}}const y$=GG("dragHorizontal"),b$=GG("dragVertical");function KG(e){let t=!1;if(e==="y")t=b$();else if(e==="x")t=y$();else{const r=y$(),n=b$();r&&n?t=()=>{r(),n()}:(r&&r(),n&&n())}return t}function XG(){const e=KG(!0);return e?(e(),!1):!0}class yp{constructor(t){this.isMounted=!1,this.node=t}update(){}}function w$(e,t){const r="pointer"+(t?"enter":"leave"),n="onHover"+(t?"Start":"End"),s=(o,i)=>{if(o.pointerType==="touch"||XG())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t),l[n]&&co.update(()=>l[n](o,i))};return gm(e.current,r,s,{passive:!e.getProps()[n]})}class Jfe extends yp{mount(){this.unmount=qh(w$(this.node,!0),w$(this.node,!1))}unmount(){}}class Qfe extends yp{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qh(dm(this.node.current,"focus",()=>this.onFocus()),dm(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const YG=(e,t)=>t?e===t?!0:YG(e,t.parentElement):!1;function PP(e,t){if(!t)return;const r=new PointerEvent("pointer"+e);t(r,zC(r))}class Zfe extends yp{constructor(){super(...arguments),this.removeStartListeners=Ho,this.removeEndListeners=Ho,this.removeAccessibleListeners=Ho,this.startPointerPress=(t,r)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),o=gm(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:u,globalTapTarget:f}=this.node.getProps();co.update(()=>{!f&&!YG(this.node.current,l.target)?u&&u(l,c):d&&d(l,c)})},{passive:!(n.onTap||n.onPointerUp)}),i=gm(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=qh(o,i),this.startPress(t,r)},this.startAccessiblePress=()=>{const t=o=>{if(o.key!=="Enter"||this.isPressing)return;const i=l=>{l.key!=="Enter"||!this.checkPressEnd()||PP("up",(c,d)=>{const{onTap:u}=this.node.getProps();u&&co.update(()=>u(c,d))})};this.removeEndListeners(),this.removeEndListeners=dm(this.node.current,"keyup",i),PP("down",(l,c)=>{this.startPress(l,c)})},r=dm(this.node.current,"keydown",t),n=()=>{this.isPressing&&PP("cancel",(o,i)=>this.cancelPress(o,i))},s=dm(this.node.current,"blur",n);this.removeAccessibleListeners=qh(r,s)}}startPress(t,r){this.isPressing=!0;const{onTapStart:n,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&co.update(()=>n(t,r))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!XG()}cancelPress(t,r){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&co.update(()=>n(t,r))}mount(){const t=this.node.getProps(),r=gm(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),n=dm(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=qh(r,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const WI=new WeakMap,EP=new WeakMap,eme=e=>{const t=WI.get(e.target);t&&t(e)},tme=e=>{e.forEach(eme)};function rme({root:e,...t}){const r=e||document;EP.has(r)||EP.set(r,{});const n=EP.get(r),s=JSON.stringify(t);return n[s]||(n[s]=new IntersectionObserver(tme,{root:e,...t})),n[s]}function nme(e,t,r){const n=rme(t);return WI.set(e,r),n.observe(e),()=>{WI.delete(e),n.unobserve(e)}}const ame={some:0,all:1};class sme extends yp{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:s="some",once:o}=t,i={root:r?r.current:void 0,rootMargin:n,threshold:typeof s=="number"?s:ame[s]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:f}=this.node.getProps(),h=d?u:f;h&&h(c)};return nme(this.node.current,i,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(ome(t,r))&&this.startObserver()}unmount(){}}function ome({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const ime={inView:{Feature:sme},tap:{Feature:Zfe},focus:{Feature:Qfe},hover:{Feature:Jfe}};function JG(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function lme(e){const t={};return e.values.forEach((r,n)=>t[n]=r.get()),t}function cme(e){const t={};return e.values.forEach((r,n)=>t[n]=r.getVelocity()),t}function UC(e,t,r){const n=e.getProps();return mD(n,t,r!==void 0?r:n.custom,lme(e),cme(e))}let dme=Ho,hD=Ho;const zh=e=>e*1e3,xm=e=>e/1e3,ume={current:!1},QG=e=>Array.isArray(e)&&typeof e[0]=="number";function ZG(e){return!!(!e||typeof e=="string"&&eK[e]||QG(e)||Array.isArray(e)&&e.every(ZG))}const pb=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,eK={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:pb([0,.65,.55,1]),circOut:pb([.55,0,1,.45]),backIn:pb([.31,.01,.66,-.59]),backOut:pb([.33,1.53,.69,.99])};function tK(e){if(e)return QG(e)?pb(e):Array.isArray(e)?e.map(tK):eK[e]}function fme(e,t,r,{delay:n=0,duration:s,repeat:o=0,repeatType:i="loop",ease:l,times:c}={}){const d={[t]:r};c&&(d.offset=c);const u=tK(l);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:n,duration:s,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:o+1,direction:i==="reverse"?"alternate":"normal"})}function mme(e,{repeat:t,repeatType:r="loop"}){const n=t&&r!=="loop"&&t%2===1?0:e.length-1;return e[n]}const rK=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,hme=1e-7,pme=12;function gme(e,t,r,n,s){let o,i,l=0;do i=t+(r-t)/2,o=rK(i,n,s)-e,o>0?r=i:t=i;while(Math.abs(o)>hme&&++l<pme);return i}function X1(e,t,r,n){if(e===t&&r===n)return Ho;const s=o=>gme(o,0,1,e,r);return o=>o===0||o===1?o:rK(s(o),t,n)}const xme=X1(.42,0,1,1),vme=X1(0,0,.58,1),nK=X1(.42,0,.58,1),yme=e=>Array.isArray(e)&&typeof e[0]!="number",aK=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,sK=e=>t=>1-e(1-t),pD=e=>1-Math.sin(Math.acos(e)),oK=sK(pD),bme=aK(pD),iK=X1(.33,1.53,.69,.99),gD=sK(iK),wme=aK(gD),_me=e=>(e*=2)<1?.5*gD(e):.5*(2-Math.pow(2,-10*(e-1))),jme={linear:Ho,easeIn:xme,easeInOut:nK,easeOut:vme,circIn:pD,circInOut:bme,circOut:oK,backIn:gD,backInOut:wme,backOut:iK,anticipate:_me},_$=e=>{if(Array.isArray(e)){hD(e.length===4);const[t,r,n,s]=e;return X1(t,r,n,s)}else if(typeof e=="string")return jme[e];return e},xD=(e,t)=>r=>!!(G1(r)&&Nfe.test(r)&&r.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(r,t)),lK=(e,t,r)=>n=>{if(!G1(n))return n;const[s,o,i,l]=n.match(qC);return{[e]:parseFloat(s),[t]:parseFloat(o),[r]:parseFloat(i),alpha:l!==void 0?parseFloat(l):1}},Nme=e=>sp(0,255,e),kP={...cx,transform:e=>Math.round(Nme(e))},cg={test:xD("rgb","red"),parse:lK("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+kP.transform(e)+", "+kP.transform(t)+", "+kP.transform(r)+", "+Mb(Db.transform(n))+")"};function Sme(e){let t="",r="",n="",s="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),s=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),s=e.substring(4,5),t+=t,r+=r,n+=n,s+=s),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}}const HI={test:xD("#"),parse:Sme,transform:cg.transform},gv={test:xD("hsl","hue"),parse:lK("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Cf.transform(Mb(t))+", "+Cf.transform(Mb(r))+", "+Mb(Db.transform(n))+")"},Yl={test:e=>cg.test(e)||HI.test(e)||gv.test(e),parse:e=>cg.test(e)?cg.parse(e):gv.test(e)?gv.parse(e):HI.parse(e),transform:e=>G1(e)?e:e.hasOwnProperty("red")?cg.transform(e):gv.transform(e)},Ro=(e,t,r)=>-r*e+r*t+e;function IP(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Cme({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let s=0,o=0,i=0;if(!t)s=o=i=r;else{const l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;s=IP(c,l,e+1/3),o=IP(c,l,e),i=IP(c,l,e-1/3)}return{red:Math.round(s*255),green:Math.round(o*255),blue:Math.round(i*255),alpha:n}}const OP=(e,t,r)=>{const n=e*e;return Math.sqrt(Math.max(0,r*(t*t-n)+n))},Ame=[HI,cg,gv],Pme=e=>Ame.find(t=>t.test(e));function j$(e){const t=Pme(e);let r=t.parse(e);return t===gv&&(r=Cme(r)),r}const cK=(e,t)=>{const r=j$(e),n=j$(t),s={...r};return o=>(s.red=OP(r.red,n.red,o),s.green=OP(r.green,n.green,o),s.blue=OP(r.blue,n.blue,o),s.alpha=Ro(r.alpha,n.alpha,o),cg.transform(s))};function Eme(e){var t,r;return isNaN(e)&&G1(e)&&(((t=e.match(qC))===null||t===void 0?void 0:t.length)||0)+(((r=e.match(MG))===null||r===void 0?void 0:r.length)||0)>0}const dK={regex:_fe,countKey:"Vars",token:"${v}",parse:Ho},uK={regex:MG,countKey:"Colors",token:"${c}",parse:Yl.parse},fK={regex:qC,countKey:"Numbers",token:"${n}",parse:cx.parse};function TP(e,{regex:t,countKey:r,token:n,parse:s}){const o=e.tokenised.match(t);o&&(e["num"+r]=o.length,e.tokenised=e.tokenised.replace(t,n),e.values.push(...o.map(s)))}function vN(e){const t=e.toString(),r={value:t,tokenised:t,values:[],numVars:0,numColors:0,numNumbers:0};return r.value.includes("var(--")&&TP(r,dK),TP(r,uK),TP(r,fK),r}function mK(e){return vN(e).values}function hK(e){const{values:t,numColors:r,numVars:n,tokenised:s}=vN(e),o=t.length;return i=>{let l=s;for(let c=0;c<o;c++)c<n?l=l.replace(dK.token,i[c]):c<n+r?l=l.replace(uK.token,Yl.transform(i[c])):l=l.replace(fK.token,Mb(i[c]));return l}}const kme=e=>typeof e=="number"?0:e;function Ime(e){const t=mK(e);return hK(e)(t.map(kme))}const op={test:Eme,parse:mK,createTransformer:hK,getAnimatableNone:Ime},pK=(e,t)=>r=>`${r>0?t:e}`;function gK(e,t){return typeof e=="number"?r=>Ro(e,t,r):Yl.test(e)?cK(e,t):e.startsWith("var(")?pK(e,t):vK(e,t)}const xK=(e,t)=>{const r=[...e],n=r.length,s=e.map((o,i)=>gK(o,t[i]));return o=>{for(let i=0;i<n;i++)r[i]=s[i](o);return r}},Ome=(e,t)=>{const r={...e,...t},n={};for(const s in r)e[s]!==void 0&&t[s]!==void 0&&(n[s]=gK(e[s],t[s]));return s=>{for(const o in n)r[o]=n[o](s);return r}},vK=(e,t)=>{const r=op.createTransformer(t),n=vN(e),s=vN(t);return n.numVars===s.numVars&&n.numColors===s.numColors&&n.numNumbers>=s.numNumbers?qh(xK(n.values,s.values),r):pK(e,t)},Iw=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n},N$=(e,t)=>r=>Ro(e,t,r);function Tme(e){return typeof e=="number"?N$:typeof e=="string"?Yl.test(e)?cK:vK:Array.isArray(e)?xK:typeof e=="object"?Ome:N$}function Dme(e,t,r){const n=[],s=r||Tme(e[0]),o=e.length-1;for(let i=0;i<o;i++){let l=s(e[i],e[i+1]);if(t){const c=Array.isArray(t)?t[i]||Ho:t;l=qh(c,l)}n.push(l)}return n}function yK(e,t,{clamp:r=!0,ease:n,mixer:s}={}){const o=e.length;if(hD(o===t.length),o===1)return()=>t[0];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=Dme(t,n,s),l=i.length,c=d=>{let u=0;if(l>1)for(;u<e.length-2&&!(d<e[u+1]);u++);const f=Iw(e[u],e[u+1],d);return i[u](f)};return r?d=>c(sp(e[0],e[o-1],d)):c}function Mme(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const s=Iw(0,t,n);e.push(Ro(r,1,s))}}function Rme(e){const t=[0];return Mme(t,e.length-1),t}function Fme(e,t){return e.map(r=>r*t)}function Lme(e,t){return e.map(()=>t||nK).splice(0,e.length-1)}function yN({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const s=yme(n)?n.map(_$):_$(n),o={done:!1,value:t[0]},i=Fme(r&&r.length===t.length?r:Rme(t),e),l=yK(i,t,{ease:Array.isArray(s)?s:Lme(t,s)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}function bK(e,t){return t?e*(1e3/t):0}const $me=5;function wK(e,t,r){const n=Math.max(t-$me,0);return bK(r-e(n),t-n)}const DP=.001,Bme=.01,S$=10,qme=.05,zme=1;function Ume({duration:e=800,bounce:t=.25,velocity:r=0,mass:n=1}){let s,o;dme(e<=zh(S$));let i=1-t;i=sp(qme,zme,i),e=sp(Bme,S$,xm(e)),i<1?(s=d=>{const u=d*i,f=u*e,h=u-r,m=GI(d,i),x=Math.exp(-f);return DP-h/m*x},o=d=>{const f=d*i*e,h=f*r+r,m=Math.pow(i,2)*Math.pow(d,2)*e,x=Math.exp(-f),g=GI(Math.pow(d,2),i);return(-s(d)+DP>0?-1:1)*((h-m)*x)/g}):(s=d=>{const u=Math.exp(-d*e),f=(d-r)*e+1;return-DP+u*f},o=d=>{const u=Math.exp(-d*e),f=(r-d)*(e*e);return u*f});const l=5/e,c=Wme(s,o,l);if(e=zh(e),isNaN(c))return{stiffness:100,damping:10,duration:e};{const d=Math.pow(c,2)*n;return{stiffness:d,damping:i*2*Math.sqrt(n*d),duration:e}}}const Vme=12;function Wme(e,t,r){let n=r;for(let s=1;s<Vme;s++)n=n-e(n)/t(n);return n}function GI(e,t){return e*Math.sqrt(1-t*t)}const Hme=["duration","bounce"],Gme=["stiffness","damping","mass"];function C$(e,t){return t.some(r=>e[r]!==void 0)}function Kme(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!C$(e,Gme)&&C$(e,Hme)){const r=Ume(e);t={...t,...r,mass:1},t.isResolvedFromDuration=!0}return t}function _K({keyframes:e,restDelta:t,restSpeed:r,...n}){const s=e[0],o=e[e.length-1],i={done:!1,value:s},{stiffness:l,damping:c,mass:d,duration:u,velocity:f,isResolvedFromDuration:h}=Kme({...n,velocity:-xm(n.velocity||0)}),m=f||0,x=c/(2*Math.sqrt(l*d)),g=o-s,y=xm(Math.sqrt(l/d)),v=Math.abs(g)<5;r||(r=v?.01:2),t||(t=v?.005:.5);let b;if(x<1){const w=GI(y,x);b=_=>{const j=Math.exp(-x*y*_);return o-j*((m+x*y*g)/w*Math.sin(w*_)+g*Math.cos(w*_))}}else if(x===1)b=w=>o-Math.exp(-y*w)*(g+(m+y*g)*w);else{const w=y*Math.sqrt(x*x-1);b=_=>{const j=Math.exp(-x*y*_),S=Math.min(w*_,300);return o-j*((m+x*y*g)*Math.sinh(S)+w*g*Math.cosh(S))/w}}return{calculatedDuration:h&&u||null,next:w=>{const _=b(w);if(h)i.done=w>=u;else{let j=m;w!==0&&(x<1?j=wK(b,w,_):j=0);const S=Math.abs(j)<=r,C=Math.abs(o-_)<=t;i.done=S&&C}return i.value=i.done?o:_,i}}}function A$({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:s=10,bounceStiffness:o=500,modifyTarget:i,min:l,max:c,restDelta:d=.5,restSpeed:u}){const f=e[0],h={done:!1,value:f},m=A=>l!==void 0&&A<l||c!==void 0&&A>c,x=A=>l===void 0?c:c===void 0||Math.abs(l-A)<Math.abs(c-A)?l:c;let g=r*t;const y=f+g,v=i===void 0?y:i(y);v!==y&&(g=v-f);const b=A=>-g*Math.exp(-A/n),w=A=>v+b(A),_=A=>{const P=b(A),F=w(A);h.done=Math.abs(P)<=d,h.value=h.done?v:F};let j,S;const C=A=>{m(h.value)&&(j=A,S=_K({keyframes:[h.value,x(h.value)],velocity:wK(w,A,h.value),damping:s,stiffness:o,restDelta:d,restSpeed:u}))};return C(0),{calculatedDuration:null,next:A=>{let P=!1;return!S&&j===void 0&&(P=!0,_(A),C(A)),j!==void 0&&A>j?S.next(A-j):(!P&&_(A),h)}}}const Xme=e=>{const t=({timestamp:r})=>e(r);return{start:()=>co.update(t,!0),stop:()=>Am(t),now:()=>Pl.isProcessing?Pl.timestamp:performance.now()}},P$=2e4;function E$(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<P$;)t+=r,n=e.next(t);return t>=P$?1/0:t}const Yme={decay:A$,inertia:A$,tween:yN,keyframes:yN,spring:_K};function bN({autoplay:e=!0,delay:t=0,driver:r=Xme,keyframes:n,type:s="keyframes",repeat:o=0,repeatDelay:i=0,repeatType:l="loop",onPlay:c,onStop:d,onComplete:u,onUpdate:f,...h}){let m=1,x=!1,g,y;const v=()=>{y=new Promise(Ae=>{g=Ae})};v();let b;const w=Yme[s]||yN;let _;w!==yN&&typeof n[0]!="number"&&(_=yK([0,100],n,{clamp:!1}),n=[0,100]);const j=w({...h,keyframes:n});let S;l==="mirror"&&(S=w({...h,keyframes:[...n].reverse(),velocity:-(h.velocity||0)}));let C="idle",A=null,P=null,F=null;j.calculatedDuration===null&&o&&(j.calculatedDuration=E$(j));const{calculatedDuration:O}=j;let I=1/0,T=1/0;O!==null&&(I=O+i,T=I*(o+1)-i);let k=0;const B=Ae=>{if(P===null)return;m>0&&(P=Math.min(P,Ae)),m<0&&(P=Math.min(Ae-T/m,P)),A!==null?k=A:k=Math.round(Ae-P)*m;const V=k-t*(m>=0?1:-1),$=m>=0?V<0:V>T;k=Math.max(V,0),C==="finished"&&A===null&&(k=T);let Y=k,he=j;if(o){const ve=Math.min(k,T)/I;let ae=Math.floor(ve),oe=ve%1;!oe&&ve>=1&&(oe=1),oe===1&&ae--,ae=Math.min(ae,o+1),!!(ae%2)&&(l==="reverse"?(oe=1-oe,i&&(oe-=i/I)):l==="mirror"&&(he=S)),Y=sp(0,1,oe)*I}const J=$?{done:!1,value:n[0]}:he.next(Y);_&&(J.value=_(J.value));let{done:G}=J;!$&&O!==null&&(G=m>=0?k>=T:k<=0);const ue=A===null&&(C==="finished"||C==="running"&&G);return f&&f(J.value),ue&&L(),J},z=()=>{b&&b.stop(),b=void 0},U=()=>{C="idle",z(),g(),v(),P=F=null},L=()=>{C="finished",u&&u(),z(),g()},W=()=>{if(x)return;b||(b=r(B));const Ae=b.now();c&&c(),A!==null?P=Ae-A:(!P||C==="finished")&&(P=Ae),C==="finished"&&v(),F=P,A=null,C="running",b.start()};e&&W();const ge={then(Ae,V){return y.then(Ae,V)},get time(){return xm(k)},set time(Ae){Ae=zh(Ae),k=Ae,A!==null||!b||m===0?A=Ae:P=b.now()-Ae/m},get duration(){const Ae=j.calculatedDuration===null?E$(j):j.calculatedDuration;return xm(Ae)},get speed(){return m},set speed(Ae){Ae===m||!b||(m=Ae,ge.time=xm(k))},get state(){return C},play:W,pause:()=>{C="paused",A=k},stop:()=>{x=!0,C!=="idle"&&(C="idle",d&&d(),U())},cancel:()=>{F!==null&&B(F),U()},complete:()=>{C="finished"},sample:Ae=>(P=0,B(Ae))};return ge}function Jme(e){let t;return()=>(t===void 0&&(t=e()),t)}const Qme=Jme(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Zme=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),d_=10,ehe=2e4,the=(e,t)=>t.type==="spring"||e==="backgroundColor"||!ZG(t.ease);function rhe(e,t,{onUpdate:r,onComplete:n,...s}){if(!(Qme()&&Zme.has(t)&&!s.repeatDelay&&s.repeatType!=="mirror"&&s.damping!==0&&s.type!=="inertia"))return!1;let i=!1,l,c,d=!1;const u=()=>{c=new Promise(w=>{l=w})};u();let{keyframes:f,duration:h=300,ease:m,times:x}=s;if(the(t,s)){const w=bN({...s,repeat:0,delay:0});let _={done:!1,value:f[0]};const j=[];let S=0;for(;!_.done&&S<ehe;)_=w.sample(S),j.push(_.value),S+=d_;x=void 0,f=j,h=S-d_,m="linear"}const g=fme(e.owner.current,t,f,{...s,duration:h,ease:m,times:x}),y=()=>{d=!1,g.cancel()},v=()=>{d=!0,co.update(y),l(),u()};return g.onfinish=()=>{d||(e.set(mme(f,s)),n&&n(),v())},{then(w,_){return c.then(w,_)},attachTimeline(w){return g.timeline=w,g.onfinish=null,Ho},get time(){return xm(g.currentTime||0)},set time(w){g.currentTime=zh(w)},get speed(){return g.playbackRate},set speed(w){g.playbackRate=w},get duration(){return xm(h)},play:()=>{i||(g.play(),Am(y))},pause:()=>g.pause(),stop:()=>{if(i=!0,g.playState==="idle")return;const{currentTime:w}=g;if(w){const _=bN({...s,autoplay:!1});e.setWithVelocity(_.sample(w-d_).value,_.sample(w).value,d_)}v()},complete:()=>{d||g.finish()},cancel:v}}function nhe({keyframes:e,delay:t,onUpdate:r,onComplete:n}){const s=()=>(r&&r(e[e.length-1]),n&&n(),{time:0,speed:1,duration:0,play:Ho,pause:Ho,stop:Ho,then:o=>(o(),Promise.resolve()),cancel:Ho,complete:Ho});return t?bN({keyframes:[0,1],duration:0,delay:t,onComplete:s}):s()}const ahe={type:"spring",stiffness:500,damping:25,restSpeed:10},she=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),ohe={type:"keyframes",duration:.8},ihe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},lhe=(e,{keyframes:t})=>t.length>2?ohe:lx.has(e)?e.startsWith("scale")?she(t[1]):ahe:ihe,KI=(e,t)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(op.test(t)||t==="0")&&!t.startsWith("url(")),che=new Set(["brightness","contrast","saturate","opacity"]);function dhe(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(qC)||[];if(!n)return e;const s=r.replace(n,"");let o=che.has(t)?1:0;return n!==r&&(o*=100),t+"("+o+s+")"}const uhe=/([a-z-]*)\(.*?\)/g,XI={...op,getAnimatableNone:e=>{const t=e.match(uhe);return t?t.map(dhe).join(" "):e}},fhe={...RG,color:Yl,backgroundColor:Yl,outlineColor:Yl,fill:Yl,stroke:Yl,borderColor:Yl,borderTopColor:Yl,borderRightColor:Yl,borderBottomColor:Yl,borderLeftColor:Yl,filter:XI,WebkitFilter:XI},vD=e=>fhe[e];function jK(e,t){let r=vD(e);return r!==XI&&(r=op),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const NK=e=>/^0[^.\s]+$/.test(e);function mhe(e){if(typeof e=="number")return e===0;if(e!==null)return e==="none"||e==="0"||NK(e)}function hhe(e,t,r,n){const s=KI(t,r);let o;Array.isArray(r)?o=[...r]:o=[null,r];const i=n.from!==void 0?n.from:e.get();let l;const c=[];for(let d=0;d<o.length;d++)o[d]===null&&(o[d]=d===0?i:o[d-1]),mhe(o[d])&&c.push(d),typeof o[d]=="string"&&o[d]!=="none"&&o[d]!=="0"&&(l=o[d]);if(s&&c.length&&l)for(let d=0;d<c.length;d++){const u=c[d];o[u]=jK(t,l)}return o}function phe({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:s,repeat:o,repeatType:i,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}function yD(e,t){return e[t]||e.default||e}const ghe={skipAnimations:!1},bD=(e,t,r,n={})=>s=>{const o=yD(n,e)||{},i=o.delay||n.delay||0;let{elapsed:l=0}=n;l=l-zh(i);const c=hhe(t,e,r,o),d=c[0],u=c[c.length-1],f=KI(e,d),h=KI(e,u);let m={keyframes:c,velocity:t.getVelocity(),ease:"easeOut",...o,delay:-l,onUpdate:x=>{t.set(x),o.onUpdate&&o.onUpdate(x)},onComplete:()=>{s(),o.onComplete&&o.onComplete()}};if(phe(o)||(m={...m,...lhe(e,m)}),m.duration&&(m.duration=zh(m.duration)),m.repeatDelay&&(m.repeatDelay=zh(m.repeatDelay)),!f||!h||ume.current||o.type===!1||ghe.skipAnimations)return nhe(m);if(!n.isHandoff&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const x=rhe(t,e,m);if(x)return x}return bN(m)};function wN(e){return!!(Tc(e)&&e.add)}const SK=e=>/^\-?\d*\.?\d+$/.test(e);function wD(e,t){e.indexOf(t)===-1&&e.push(t)}function _D(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class jD{constructor(){this.subscriptions=[]}add(t){return wD(this.subscriptions,t),()=>_D(this.subscriptions,t)}notify(t,r,n){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](t,r,n);else for(let o=0;o<s;o++){const i=this.subscriptions[o];i&&i(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const xhe=e=>!isNaN(parseFloat(e));class vhe{constructor(t,r={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(n,s=!0)=>{this.prev=this.current,this.current=n;const{delta:o,timestamp:i}=Pl;this.lastUpdated!==i&&(this.timeDelta=o,this.lastUpdated=i,co.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>co.postRender(this.velocityCheck),this.velocityCheck=({timestamp:n})=>{n!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=xhe(this.current),this.owner=r.owner}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new jD);const n=this.events[t].add(r);return t==="change"?()=>{n(),co.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,r,n){this.set(r),this.prev=t,this.timeDelta=n}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?bK(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function r0(e,t){return new vhe(e,t)}const CK=e=>t=>t.test(e),yhe={test:e=>e==="auto",parse:e=>e},AK=[cx,Oa,Cf,ah,Cfe,Sfe,yhe],Ly=e=>AK.find(CK(e)),bhe=[...AK,Yl,op],whe=e=>bhe.find(CK(e));function _he(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,r0(r))}function jhe(e,t){const r=UC(e,t);let{transitionEnd:n={},transition:s={},...o}=r?e.makeTargetAnimatable(r,!1):{};o={...o,...n};for(const i in o){const l=Bfe(o[i]);_he(e,i,l)}}function Nhe(e,t,r){var n,s;const o=Object.keys(t).filter(l=>!e.hasValue(l)),i=o.length;if(i)for(let l=0;l<i;l++){const c=o[l],d=t[c];let u=null;Array.isArray(d)&&(u=d[0]),u===null&&(u=(s=(n=r[c])!==null&&n!==void 0?n:e.readValue(c))!==null&&s!==void 0?s:t[c]),u!=null&&(typeof u=="string"&&(SK(u)||NK(u))?u=parseFloat(u):!whe(u)&&op.test(d)&&(u=jK(c,d)),e.addValue(c,r0(u,{owner:e})),r[c]===void 0&&(r[c]=u),u!==null&&e.setBaseTarget(c,u))}}function She(e,t){return t?(t[e]||t.default||t).from:void 0}function Che(e,t,r){const n={};for(const s in e){const o=She(s,t);if(o!==void 0)n[s]=o;else{const i=r.getValue(s);i&&(n[s]=i.get())}}return n}function Ahe({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function Phe(e,t){const r=e.get();if(Array.isArray(t)){for(let n=0;n<t.length;n++)if(t[n]!==r)return!0}else return r!==t}function PK(e,t,{delay:r=0,transitionOverride:n,type:s}={}){let{transition:o=e.getDefaultTransition(),transitionEnd:i,...l}=e.makeTargetAnimatable(t);const c=e.getValue("willChange");n&&(o=n);const d=[],u=s&&e.animationState&&e.animationState.getState()[s];for(const f in l){const h=e.getValue(f),m=l[f];if(!h||m===void 0||u&&Ahe(u,f))continue;const x={delay:r,elapsed:0,...yD(o||{},f)};if(window.HandoffAppearAnimations){const v=e.getProps()[EG];if(v){const b=window.HandoffAppearAnimations(v,f,h,co);b!==null&&(x.elapsed=b,x.isHandoff=!0)}}let g=!x.isHandoff&&!Phe(h,m);if(x.type==="spring"&&(h.getVelocity()||x.velocity)&&(g=!1),h.animation&&(g=!1),g)continue;h.start(bD(f,h,m,e.shouldReduceMotion&&lx.has(f)?{type:!1}:x));const y=h.animation;wN(c)&&(c.add(f),y.then(()=>c.remove(f))),d.push(y)}return i&&Promise.all(d).then(()=>{i&&jhe(e,i)}),d}function YI(e,t,r={}){const n=UC(e,t,r.custom);let{transition:s=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(s=r.transitionOverride);const o=n?()=>Promise.all(PK(e,n,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:f}=s;return Ehe(e,t,d+c,u,f,r)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,d]=l==="beforeChildren"?[o,i]:[i,o];return c().then(()=>d())}else return Promise.all([o(),i(r.delay)])}function Ehe(e,t,r=0,n=0,s=1,o){const i=[],l=(e.variantChildren.size-1)*n,c=s===1?(d=0)=>d*n:(d=0)=>l-d*n;return Array.from(e.variantChildren).sort(khe).forEach((d,u)=>{d.notify("AnimationStart",t),i.push(YI(d,t,{...o,delay:r+c(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(i)}function khe(e,t){return e.sortNodePosition(t)}function Ihe(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const s=t.map(o=>YI(e,o,r));n=Promise.all(s)}else if(typeof t=="string")n=YI(e,t,r);else{const s=typeof t=="function"?UC(e,t,r.custom):t;n=Promise.all(PK(e,s,r))}return n.then(()=>e.notify("AnimationComplete",t))}const Ohe=[...aD].reverse(),The=aD.length;function Dhe(e){return t=>Promise.all(t.map(({animation:r,options:n})=>Ihe(e,r,n)))}function Mhe(e){let t=Dhe(e);const r=Fhe();let n=!0;const s=(c,d)=>{const u=UC(e,d);if(u){const{transition:f,transitionEnd:h,...m}=u;c={...c,...m,...h}}return c};function o(c){t=c(e)}function i(c,d){const u=e.getProps(),f=e.getVariantContext(!0)||{},h=[],m=new Set;let x={},g=1/0;for(let v=0;v<The;v++){const b=Ohe[v],w=r[b],_=u[b]!==void 0?u[b]:f[b],j=Ew(_),S=b===d?w.isActive:null;S===!1&&(g=v);let C=_===f[b]&&_!==u[b]&&j;if(C&&n&&e.manuallyAnimateOnMount&&(C=!1),w.protectedKeys={...x},!w.isActive&&S===null||!_&&!w.prevProp||$C(_)||typeof _=="boolean")continue;let P=Rhe(w.prevProp,_)||b===d&&w.isActive&&!C&&j||v>g&&j,F=!1;const O=Array.isArray(_)?_:[_];let I=O.reduce(s,{});S===!1&&(I={});const{prevResolvedValues:T={}}=w,k={...T,...I},B=z=>{P=!0,m.has(z)&&(F=!0,m.delete(z)),w.needsAnimating[z]=!0};for(const z in k){const U=I[z],L=T[z];if(x.hasOwnProperty(z))continue;let W=!1;xN(U)&&xN(L)?W=!JG(U,L):W=U!==L,W?U!==void 0?B(z):m.add(z):U!==void 0&&m.has(z)?B(z):w.protectedKeys[z]=!0}w.prevProp=_,w.prevResolvedValues=I,w.isActive&&(x={...x,...I}),n&&e.blockInitialAnimation&&(P=!1),P&&(!C||F)&&h.push(...O.map(z=>({animation:z,options:{type:b,...c}})))}if(m.size){const v={};m.forEach(b=>{const w=e.getBaseTarget(b);w!==void 0&&(v[b]=w)}),h.push({animation:v})}let y=!!h.length;return n&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(y=!1),n=!1,y?t(h):Promise.resolve()}function l(c,d,u){var f;if(r[c].isActive===d)return Promise.resolve();(f=e.variantChildren)===null||f===void 0||f.forEach(m=>{var x;return(x=m.animationState)===null||x===void 0?void 0:x.setActive(c,d)}),r[c].isActive=d;const h=i(u,c);for(const m in r)r[m].protectedKeys={};return h}return{animateChanges:i,setActive:l,setAnimateFunction:o,getState:()=>r}}function Rhe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!JG(t,e):!1}function Mp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Fhe(){return{animate:Mp(!0),whileInView:Mp(),whileHover:Mp(),whileTap:Mp(),whileDrag:Mp(),whileFocus:Mp(),exit:Mp()}}class Lhe extends yp{constructor(t){super(t),t.animationState||(t.animationState=Mhe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),$C(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){}}let $he=0;class Bhe extends yp{constructor(){super(...arguments),this.id=$he++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r,custom:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const o=this.node.animationState.setActive("exit",!t,{custom:n??this.node.getProps().custom});r&&!t&&o.then(()=>r(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const qhe={animation:{Feature:Lhe},exit:{Feature:Bhe}},k$=(e,t)=>Math.abs(e-t);function zhe(e,t){const r=k$(e.x,t.x),n=k$(e.y,t.y);return Math.sqrt(r**2+n**2)}class EK{constructor(t,r,{transformPagePoint:n,contextWindow:s,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=RP(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,m=zhe(f.offset,{x:0,y:0})>=3;if(!h&&!m)return;const{point:x}=f,{timestamp:g}=Pl;this.history.push({...x,timestamp:g});const{onStart:y,onMove:v}=this.handlers;h||(y&&y(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,f)},this.handlePointerMove=(f,h)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=MP(h,this.transformPagePoint),co.update(this.updatePoint,!0)},this.handlePointerUp=(f,h)=>{this.end();const{onEnd:m,onSessionEnd:x,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=RP(f.type==="pointercancel"?this.lastMoveEventInfo:MP(h,this.transformPagePoint),this.history);this.startEvent&&m&&m(f,y),x&&x(f,y)},!HG(t))return;this.dragSnapToOrigin=o,this.handlers=r,this.transformPagePoint=n,this.contextWindow=s||window;const i=zC(t),l=MP(i,this.transformPagePoint),{point:c}=l,{timestamp:d}=Pl;this.history=[{...c,timestamp:d}];const{onSessionStart:u}=r;u&&u(t,RP(l,this.history)),this.removeListeners=qh(gm(this.contextWindow,"pointermove",this.handlePointerMove),gm(this.contextWindow,"pointerup",this.handlePointerUp),gm(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Am(this.updatePoint)}}function MP(e,t){return t?{point:t(e.point)}:e}function I$(e,t){return{x:e.x-t.x,y:e.y-t.y}}function RP({point:e},t){return{point:e,delta:I$(e,kK(t)),offset:I$(e,Uhe(t)),velocity:Vhe(t,.1)}}function Uhe(e){return e[0]}function kK(e){return e[e.length-1]}function Vhe(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const s=kK(e);for(;r>=0&&(n=e[r],!(s.timestamp-n.timestamp>zh(t)));)r--;if(!n)return{x:0,y:0};const o=xm(s.timestamp-n.timestamp);if(o===0)return{x:0,y:0};const i={x:(s.x-n.x)/o,y:(s.y-n.y)/o};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function bd(e){return e.max-e.min}function JI(e,t=0,r=.01){return Math.abs(e-t)<=r}function O$(e,t,r,n=.5){e.origin=n,e.originPoint=Ro(t.min,t.max,e.origin),e.scale=bd(r)/bd(t),(JI(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=Ro(r.min,r.max,e.origin)-e.originPoint,(JI(e.translate)||isNaN(e.translate))&&(e.translate=0)}function Rb(e,t,r,n){O$(e.x,t.x,r.x,n?n.originX:void 0),O$(e.y,t.y,r.y,n?n.originY:void 0)}function T$(e,t,r){e.min=r.min+t.min,e.max=e.min+bd(t)}function Whe(e,t,r){T$(e.x,t.x,r.x),T$(e.y,t.y,r.y)}function D$(e,t,r){e.min=t.min-r.min,e.max=e.min+bd(t)}function Fb(e,t,r){D$(e.x,t.x,r.x),D$(e.y,t.y,r.y)}function Hhe(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?Ro(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?Ro(r,e,n.max):Math.min(e,r)),e}function M$(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Ghe(e,{top:t,left:r,bottom:n,right:s}){return{x:M$(e.x,r,s),y:M$(e.y,t,n)}}function R$(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function Khe(e,t){return{x:R$(e.x,t.x),y:R$(e.y,t.y)}}function Xhe(e,t){let r=.5;const n=bd(e),s=bd(t);return s>n?r=Iw(t.min,t.max-n,e.min):n>s&&(r=Iw(e.min,e.max-s,t.min)),sp(0,1,r)}function Yhe(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const QI=.35;function Jhe(e=QI){return e===!1?e=0:e===!0&&(e=QI),{x:F$(e,"left","right"),y:F$(e,"top","bottom")}}function F$(e,t,r){return{min:L$(e,t),max:L$(e,r)}}function L$(e,t){return typeof e=="number"?e:e[t]||0}const $$=()=>({translate:0,scale:1,origin:0,originPoint:0}),xv=()=>({x:$$(),y:$$()}),B$=()=>({min:0,max:0}),mi=()=>({x:B$(),y:B$()});function Rd(e){return[e("x"),e("y")]}function IK({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function Qhe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Zhe(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function FP(e){return e===void 0||e===1}function ZI({scale:e,scaleX:t,scaleY:r}){return!FP(e)||!FP(t)||!FP(r)}function Hp(e){return ZI(e)||OK(e)||e.z||e.rotate||e.rotateX||e.rotateY}function OK(e){return q$(e.x)||q$(e.y)}function q$(e){return e&&e!=="0%"}function _N(e,t,r){const n=e-r,s=t*n;return r+s}function z$(e,t,r,n,s){return s!==void 0&&(e=_N(e,s,n)),_N(e,r,n)+t}function eO(e,t=0,r=1,n,s){e.min=z$(e.min,t,r,n,s),e.max=z$(e.max,t,r,n,s)}function TK(e,{x:t,y:r}){eO(e.x,t.translate,t.scale,t.originPoint),eO(e.y,r.translate,r.scale,r.originPoint)}function epe(e,t,r,n=!1){const s=r.length;if(!s)return;t.x=t.y=1;let o,i;for(let l=0;l<s;l++){o=r[l],i=o.projectionDelta;const c=o.instance;c&&c.style&&c.style.display==="contents"||(n&&o.options.layoutScroll&&o.scroll&&o!==o.root&&vv(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,TK(e,i)),n&&Hp(o.latestValues)&&vv(e,o.latestValues))}t.x=U$(t.x),t.y=U$(t.y)}function U$(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function fh(e,t){e.min=e.min+t,e.max=e.max+t}function V$(e,t,[r,n,s]){const o=t[s]!==void 0?t[s]:.5,i=Ro(e.min,e.max,o);eO(e,t[r],t[n],i,t.scale)}const tpe=["x","scaleX","originX"],rpe=["y","scaleY","originY"];function vv(e,t){V$(e.x,t,tpe),V$(e.y,t,rpe)}function DK(e,t){return IK(Zhe(e.getBoundingClientRect(),t))}function npe(e,t,r){const n=DK(e,r),{scroll:s}=t;return s&&(fh(n.x,s.offset.x),fh(n.y,s.offset.y)),n}const MK=({current:e})=>e?e.ownerDocument.defaultView:null,ape=new WeakMap;class spe{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=mi(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const s=u=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(zC(u,"page").point)},o=(u,f)=>{const{drag:h,dragPropagation:m,onDragStart:x}=this.getProps();if(h&&!m&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=KG(h),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Rd(y=>{let v=this.getAxisMotionValue(y).get()||0;if(Cf.test(v)){const{projection:b}=this.visualElement;if(b&&b.layout){const w=b.layout.layoutBox[y];w&&(v=bd(w)*(parseFloat(v)/100))}}this.originPoint[y]=v}),x&&co.update(()=>x(u,f),!1,!0);const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},i=(u,f)=>{const{dragPropagation:h,dragDirectionLock:m,onDirectionLock:x,onDrag:g}=this.getProps();if(!h&&!this.openGlobalLock)return;const{offset:y}=f;if(m&&this.currentDirection===null){this.currentDirection=ope(y),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",f.point,y),this.updateAxis("y",f.point,y),this.visualElement.render(),g&&g(u,f)},l=(u,f)=>this.stop(u,f),c=()=>Rd(u=>{var f;return this.getAnimationState(u)==="paused"&&((f=this.getAxisMotionValue(u).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new EK(t,{onSessionStart:s,onStart:o,onMove:i,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:MK(this.visualElement)})}stop(t,r){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:s}=r;this.startAnimation(s);const{onDragEnd:o}=this.getProps();o&&co.update(()=>o(t,r))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:s}=this.getProps();if(!n||!u_(t,s,this.currentDirection))return;const o=this.getAxisMotionValue(t);let i=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(i=Hhe(i,this.constraints[t],this.elastic[t])),o.set(i)}resolveConstraints(){var t;const{dragConstraints:r,dragElastic:n}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;r&&pv(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&s?this.constraints=Ghe(s.layoutBox,r):this.constraints=!1,this.elastic=Jhe(n),o!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Rd(i=>{this.getAxisMotionValue(i)&&(this.constraints[i]=Yhe(s.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!pv(t))return!1;const n=t.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const o=npe(n,s.root,this.visualElement.getTransformPagePoint());let i=Khe(s.layout.layoutBox,o);if(r){const l=r(Qhe(i));this.hasMutatedConstraints=!!l,l&&(i=IK(l))}return i}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:s,dragTransition:o,dragSnapToOrigin:i,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Rd(u=>{if(!u_(u,r,this.currentDirection))return;let f=c&&c[u]||{};i&&(f={min:0,max:0});const h=s?200:1e6,m=s?40:1e7,x={type:"inertia",velocity:n?t[u]:0,bounceStiffness:h,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...f};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return n.start(bD(t,n,0,r))}stopAnimation(){Rd(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Rd(t=>{var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(t){const r="_drag"+t.toUpperCase(),n=this.visualElement.getProps(),s=n[r];return s||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Rd(r=>{const{drag:n}=this.getProps();if(!u_(r,n,this.currentDirection))return;const{projection:s}=this.visualElement,o=this.getAxisMotionValue(r);if(s&&s.layout){const{min:i,max:l}=s.layout.layoutBox[r];o.set(t[r]-Ro(i,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!pv(r)||!n||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};Rd(i=>{const l=this.getAxisMotionValue(i);if(l){const c=l.get();s[i]=Xhe({min:c,max:c},this.constraints[i])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Rd(i=>{if(!u_(i,t,null))return;const l=this.getAxisMotionValue(i),{min:c,max:d}=this.constraints[i];l.set(Ro(c,d,s[i]))})}addListeners(){if(!this.visualElement.current)return;ape.set(this.visualElement,this);const t=this.visualElement.current,r=gm(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();pv(c)&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,o=s.addEventListener("measure",n);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),n();const i=dm(window,"resize",()=>this.scalePositionWithinConstraints()),l=s.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Rd(u=>{const f=this.getAxisMotionValue(u);f&&(this.originPoint[u]+=c[u].translate,f.set(f.get()+c[u].translate))}),this.visualElement.render())});return()=>{i(),r(),o(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:s=!1,dragConstraints:o=!1,dragElastic:i=QI,dragMomentum:l=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:s,dragConstraints:o,dragElastic:i,dragMomentum:l}}}function u_(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function ope(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class ipe extends yp{constructor(t){super(t),this.removeGroupControls=Ho,this.removeListeners=Ho,this.controls=new spe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ho}unmount(){this.removeGroupControls(),this.removeListeners()}}const W$=e=>(t,r)=>{e&&co.update(()=>e(t,r))};class lpe extends yp{constructor(){super(...arguments),this.removePointerDownListener=Ho}onPointerDown(t){this.session=new EK(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:MK(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:s}=this.node.getProps();return{onSessionStart:W$(t),onStart:W$(r),onMove:n,onEnd:(o,i)=>{delete this.session,s&&co.update(()=>s(o,i))}}}mount(){this.removePointerDownListener=gm(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function cpe(){const e=p.useContext(FC);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:n}=e,s=p.useId();return p.useEffect(()=>n(s),[]),!t&&r?[!1,()=>r&&r(s)]:[!0]}const jj={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function H$(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const $y={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Oa.test(e))e=parseFloat(e);else return e;const r=H$(e,t.target.x),n=H$(e,t.target.y);return`${r}% ${n}%`}},dpe={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,s=op.parse(e);if(s.length>5)return n;const o=op.createTransformer(e),i=typeof s[0]!="number"?1:0,l=r.x.scale*t.x,c=r.y.scale*t.y;s[0+i]/=l,s[1+i]/=c;const d=Ro(l,c,.5);return typeof s[2+i]=="number"&&(s[2+i]/=d),typeof s[3+i]=="number"&&(s[3+i]/=d),o(s)}};class upe extends Ee.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:s}=this.props,{projection:o}=t;vfe(fpe),o&&(r.group&&r.group.add(o),n&&n.register&&s&&n.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),jj.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:s,isPresent:o}=this.props,i=n.projection;return i&&(i.isPresent=o,s||t.layoutDependency!==r||r===void 0?i.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?i.promote():i.relegate()||co.postRender(()=>{const l=i.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),queueMicrotask(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:s}=t;s&&(s.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(s),n&&n.deregister&&n.deregister(s))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function RK(e){const[t,r]=cpe(),n=p.useContext(oD);return Ee.createElement(upe,{...e,layoutGroup:n,switchLayoutGroup:p.useContext(IG),isPresent:t,safeToRemove:r})}const fpe={borderRadius:{...$y,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:$y,borderTopRightRadius:$y,borderBottomLeftRadius:$y,borderBottomRightRadius:$y,boxShadow:dpe},FK=["TopLeft","TopRight","BottomLeft","BottomRight"],mpe=FK.length,G$=e=>typeof e=="string"?parseFloat(e):e,K$=e=>typeof e=="number"||Oa.test(e);function hpe(e,t,r,n,s,o){s?(e.opacity=Ro(0,r.opacity!==void 0?r.opacity:1,ppe(n)),e.opacityExit=Ro(t.opacity!==void 0?t.opacity:1,0,gpe(n))):o&&(e.opacity=Ro(t.opacity!==void 0?t.opacity:1,r.opacity!==void 0?r.opacity:1,n));for(let i=0;i<mpe;i++){const l=`border${FK[i]}Radius`;let c=X$(t,l),d=X$(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||K$(c)===K$(d)?(e[l]=Math.max(Ro(G$(c),G$(d),n),0),(Cf.test(d)||Cf.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||r.rotate)&&(e.rotate=Ro(t.rotate||0,r.rotate||0,n))}function X$(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const ppe=LK(0,.5,oK),gpe=LK(.5,.95,Ho);function LK(e,t,r){return n=>n<e?0:n>t?1:r(Iw(e,t,n))}function Y$(e,t){e.min=t.min,e.max=t.max}function Ed(e,t){Y$(e.x,t.x),Y$(e.y,t.y)}function J$(e,t,r,n,s){return e-=t,e=_N(e,1/r,n),s!==void 0&&(e=_N(e,1/s,n)),e}function xpe(e,t=0,r=1,n=.5,s,o=e,i=e){if(Cf.test(t)&&(t=parseFloat(t),t=Ro(i.min,i.max,t/100)-i.min),typeof t!="number")return;let l=Ro(o.min,o.max,n);e===o&&(l-=t),e.min=J$(e.min,t,r,l,s),e.max=J$(e.max,t,r,l,s)}function Q$(e,t,[r,n,s],o,i){xpe(e,t[r],t[n],t[s],t.scale,o,i)}const vpe=["x","scaleX","originX"],ype=["y","scaleY","originY"];function Z$(e,t,r,n){Q$(e.x,t,vpe,r?r.x:void 0,n?n.x:void 0),Q$(e.y,t,ype,r?r.y:void 0,n?n.y:void 0)}function e6(e){return e.translate===0&&e.scale===1}function $K(e){return e6(e.x)&&e6(e.y)}function bpe(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function BK(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function t6(e){return bd(e.x)/bd(e.y)}class wpe{constructor(){this.members=[]}add(t){wD(this.members,t),t.scheduleRender()}remove(t){if(_D(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(s=>t===s);if(r===0)return!1;let n;for(let s=r;s>=0;s--){const o=this.members[s];if(o.isPresent!==!1){n=o;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:s}=t.options;s===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function r6(e,t,r){let n="";const s=e.x.translate/t.x,o=e.y.translate/t.y;if((s||o)&&(n=`translate3d(${s}px, ${o}px, 0) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{rotate:c,rotateX:d,rotateY:u}=r;c&&(n+=`rotate(${c}deg) `),d&&(n+=`rotateX(${d}deg) `),u&&(n+=`rotateY(${u}deg) `)}const i=e.x.scale*t.x,l=e.y.scale*t.y;return(i!==1||l!==1)&&(n+=`scale(${i}, ${l})`),n||"none"}const _pe=(e,t)=>e.depth-t.depth;class jpe{constructor(){this.children=[],this.isDirty=!1}add(t){wD(this.children,t),this.isDirty=!0}remove(t){_D(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(_pe),this.isDirty=!1,this.children.forEach(t)}}function Npe(e,t){const r=performance.now(),n=({timestamp:s})=>{const o=s-r;o>=t&&(Am(n),e(o-t))};return co.read(n,!0),()=>Am(n)}function Spe(e){window.MotionDebug&&window.MotionDebug.record(e)}function Cpe(e){return e instanceof SVGElement&&e.tagName!=="svg"}function Ape(e,t,r){const n=Tc(e)?e:r0(e);return n.start(bD("",n,t,r)),n.animation}const n6=["","X","Y","Z"],Ppe={visibility:"hidden"},a6=1e3;let Epe=0;const Gp={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function qK({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:s}){return class{constructor(i={},l=t?.()){this.id=Epe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Gp.totalNodes=Gp.resolvedTargetDeltas=Gp.recalculatedProjection=0,this.nodes.forEach(Ope),this.nodes.forEach(Fpe),this.nodes.forEach(Lpe),this.nodes.forEach(Tpe),Spe(Gp)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new jpe)}addEventListener(i,l){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new jD),this.eventHandlers.get(i).add(l)}notifyListeners(i,...l){const c=this.eventHandlers.get(i);c&&c.notify(...l)}hasListeners(i){return this.eventHandlers.has(i)}mount(i,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Cpe(i),this.instance=i;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const h=()=>this.root.updateBlockedByResize=!1;e(i,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=Npe(h,250),jj.hasAnimatedSinceResize&&(jj.hasAnimatedSinceResize=!1,this.nodes.forEach(o6))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:h,hasRelativeTargetChanged:m,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||u.getDefaultTransition()||Upe,{onLayoutAnimationStart:y,onLayoutAnimationComplete:v}=u.getProps(),b=!this.targetLayout||!BK(this.targetLayout,x)||m,w=!h&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||h&&(b||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,w);const _={...yD(g,"layout"),onPlay:y,onComplete:v};(u.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_)}else h||o6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Am(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach($pe),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const f=this.path[u];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(s6);return}this.isUpdating||this.nodes.forEach(Mpe),this.isUpdating=!1,this.nodes.forEach(Rpe),this.nodes.forEach(kpe),this.nodes.forEach(Ipe),this.clearAllSnapshots();const l=performance.now();Pl.delta=sp(0,1e3/60,l-Pl.timestamp),Pl.timestamp=l,Pl.isProcessing=!0,AP.update.process(Pl),AP.preRender.process(Pl),AP.render.process(Pl),Pl.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Dpe),this.sharedNodes.forEach(Bpe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,co.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){co.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutCorrected=mi(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let l=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(l=!1),l&&(this.scroll={animationId:this.root.animationId,phase:i,isRoot:n(this.instance),offset:r(this.instance)})}resetTransform(){if(!s)return;const i=this.isLayoutDirty||this.shouldResetTransform,l=this.projectionDelta&&!$K(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;i&&(l||Hp(this.latestValues)||u)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return i&&(c=this.removeTransform(c)),Vpe(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:i}=this.options;if(!i)return mi();const l=i.measureViewportBox(),{scroll:c}=this.root;return c&&(fh(l.x,c.offset.x),fh(l.y,c.offset.y)),l}removeElementScroll(i){const l=mi();Ed(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:f}=d;if(d!==this.root&&u&&f.layoutScroll){if(u.isRoot){Ed(l,i);const{scroll:h}=this.root;h&&(fh(l.x,-h.offset.x),fh(l.y,-h.offset.y))}fh(l.x,u.offset.x),fh(l.y,u.offset.y)}}return l}applyTransform(i,l=!1){const c=mi();Ed(c,i);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&vv(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Hp(u.latestValues)&&vv(c,u.latestValues)}return Hp(this.latestValues)&&vv(c,this.latestValues),c}removeTransform(i){const l=mi();Ed(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!Hp(d.latestValues))continue;ZI(d.latestValues)&&d.updateSnapshot();const u=mi(),f=d.measurePageBox();Ed(u,f),Z$(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return Hp(this.latestValues)&&Z$(l,this.latestValues),l}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Pl.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(i||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:f,layoutId:h}=this.options;if(!(!this.layout||!(f||h))){if(this.resolvedRelativeTargetAt=Pl.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=mi(),this.relativeTargetOrigin=mi(),Fb(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),Ed(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=mi(),this.targetWithTransforms=mi()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Whe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ed(this.target,this.layout.layoutBox),TK(this.target,this.targetDelta)):Ed(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=mi(),this.relativeTargetOrigin=mi(),Fb(this.relativeTargetOrigin,this.target,m.target),Ed(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Gp.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||ZI(this.parent.latestValues)||OK(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var i;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((i=this.parent)===null||i===void 0)&&i.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Pl.timestamp&&(d=!1),d)return;const{layout:u,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||f))return;Ed(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,m=this.treeScale.y;epe(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox);const{target:x}=l;if(!x){this.projectionTransform&&(this.projectionDelta=xv(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=xv(),this.projectionDeltaWithTransform=xv());const g=this.projectionTransform;Rb(this.projectionDelta,this.layoutCorrected,x,this.latestValues),this.projectionTransform=r6(this.projectionDelta,this.treeScale),(this.projectionTransform!==g||this.treeScale.x!==h||this.treeScale.y!==m)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x)),Gp.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),i){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(i,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},f=xv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=mi(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,g=m!==x,y=this.getStack(),v=!y||y.members.length<=1,b=!!(g&&!v&&this.options.crossfade===!0&&!this.path.some(zpe));this.animationProgress=0;let w;this.mixTargetDelta=_=>{const j=_/1e3;i6(f.x,i.x,j),i6(f.y,i.y,j),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Fb(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),qpe(this.relativeTarget,this.relativeTargetOrigin,h,j),w&&bpe(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=mi()),Ed(w,this.relativeTarget)),g&&(this.animationValues=u,hpe(u,d,this.latestValues,j,b,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=j},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Am(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=co.update(()=>{jj.hasAnimatedSinceResize=!0,this.currentAnimation=Ape(0,a6,{...i,onUpdate:l=>{this.mixTargetDelta(l),i.onUpdate&&i.onUpdate(l)},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(a6),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=i;if(!(!l||!c||!d)){if(this!==i&&this.layout&&d&&zK(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||mi();const f=bd(this.layout.layoutBox.x);c.x.min=i.target.x.min,c.x.max=c.x.min+f;const h=bd(this.layout.layoutBox.y);c.y.min=i.target.y.min,c.y.max=c.y.min+h}Ed(l,c),vv(l,u),Rb(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(i,l){this.sharedNodes.has(i)||this.sharedNodes.set(i,new wpe),this.sharedNodes.get(i).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){var i;const{layoutId:l}=this.options;return l?((i=this.getStack())===null||i===void 0?void 0:i.lead)||this:this}getPrevLead(){var i;const{layoutId:l}=this.options;return l?(i=this.getStack())===null||i===void 0?void 0:i.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),i&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetRotation(){const{visualElement:i}=this.options;if(!i)return;let l=!1;const{latestValues:c}=i;if((c.rotate||c.rotateX||c.rotateY||c.rotateZ)&&(l=!0),!l)return;const d={};for(let u=0;u<n6.length;u++){const f="rotate"+n6[u];c[f]&&(d[f]=c[f],i.setStaticValue(f,0))}i.render();for(const u in d)i.setStaticValue(u,d[u]);i.scheduleRender()}getProjectionStyles(i){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Ppe;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=_j(i?.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const g={};return this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=_j(i?.pointerEvents)||""),this.hasProjected&&!Hp(this.latestValues)&&(g.transform=u?u({},""):"none",this.hasProjected=!1),g}const h=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=r6(this.projectionDeltaWithTransform,this.treeScale,h),u&&(d.transform=u(h,d.transform));const{x:m,y:x}=this.projectionDelta;d.transformOrigin=`${m.origin*100}% ${x.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(l=h.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:d.opacity=f===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const g in pN){if(h[g]===void 0)continue;const{correct:y,applyTo:v}=pN[g],b=d.transform==="none"?h[g]:y(h[g],f);if(v){const w=v.length;for(let _=0;_<w;_++)d[v[_]]=b}else d[g]=b}return this.options.layoutId&&(d.pointerEvents=f===this?_j(i?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>{var l;return(l=i.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(s6),this.root.sharedNodes.clear()}}}function kpe(e){e.updateLayout()}function Ipe(e){var t;const r=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:s}=e.layout,{animationType:o}=e.options,i=r.source!==e.layout.source;o==="size"?Rd(f=>{const h=i?r.measuredBox[f]:r.layoutBox[f],m=bd(h);h.min=n[f].min,h.max=h.min+m}):zK(o,r.layoutBox,n)&&Rd(f=>{const h=i?r.measuredBox[f]:r.layoutBox[f],m=bd(n[f]);h.max=h.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+m)});const l=xv();Rb(l,n,r.layoutBox);const c=xv();i?Rb(c,e.applyTransform(s,!0),r.measuredBox):Rb(c,n,r.layoutBox);const d=!$K(l);let u=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:m}=f;if(h&&m){const x=mi();Fb(x,r.layoutBox,h.layoutBox);const g=mi();Fb(g,n,m.layoutBox),BK(x,g)||(u=!0),f.options.layoutRoot&&(e.relativeTarget=g,e.relativeTargetOrigin=x,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:r,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Ope(e){Gp.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Tpe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Dpe(e){e.clearSnapshot()}function s6(e){e.clearMeasurements()}function Mpe(e){e.isLayoutDirty=!1}function Rpe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function o6(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Fpe(e){e.resolveTargetDelta()}function Lpe(e){e.calcProjection()}function $pe(e){e.resetRotation()}function Bpe(e){e.removeLeadSnapshot()}function i6(e,t,r){e.translate=Ro(t.translate,0,r),e.scale=Ro(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function l6(e,t,r,n){e.min=Ro(t.min,r.min,n),e.max=Ro(t.max,r.max,n)}function qpe(e,t,r,n){l6(e.x,t.x,r.x,n),l6(e.y,t.y,r.y,n)}function zpe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Upe={duration:.45,ease:[.4,0,.1,1]},c6=e=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(e),d6=c6("applewebkit/")&&!c6("chrome/")?Math.round:Ho;function u6(e){e.min=d6(e.min),e.max=d6(e.max)}function Vpe(e){u6(e.x),u6(e.y)}function zK(e,t,r){return e==="position"||e==="preserve-aspect"&&!JI(t6(t),t6(r),.2)}const Wpe=qK({attachResizeListener:(e,t)=>dm(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),LP={current:void 0},UK=qK({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!LP.current){const e=new Wpe({});e.mount(window),e.setOptions({layoutScroll:!0}),LP.current=e}return LP.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Hpe={pan:{Feature:lpe},drag:{Feature:ipe,ProjectionNode:UK,MeasureLayout:RK}},Gpe=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Kpe(e){const t=Gpe.exec(e);if(!t)return[,];const[,r,n]=t;return[r,n]}function tO(e,t,r=1){const[n,s]=Kpe(e);if(!n)return;const o=window.getComputedStyle(t).getPropertyValue(n);if(o){const i=o.trim();return SK(i)?parseFloat(i):i}else return VI(s)?tO(s,t,r+1):s}function Xpe(e,{...t},r){const n=e.current;if(!(n instanceof Element))return{target:t,transitionEnd:r};r&&(r={...r}),e.values.forEach(s=>{const o=s.get();if(!VI(o))return;const i=tO(o,n);i&&s.set(i)});for(const s in t){const o=t[s];if(!VI(o))continue;const i=tO(o,n);i&&(t[s]=i,r||(r={}),r[s]===void 0&&(r[s]=o))}return{target:t,transitionEnd:r}}const Ype=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),VK=e=>Ype.has(e),Jpe=e=>Object.keys(e).some(VK),f6=e=>e===cx||e===Oa,m6=(e,t)=>parseFloat(e.split(", ")[t]),h6=(e,t)=>(r,{transform:n})=>{if(n==="none"||!n)return 0;const s=n.match(/^matrix3d\((.+)\)$/);if(s)return m6(s[1],t);{const o=n.match(/^matrix\((.+)\)$/);return o?m6(o[1],e):0}},Qpe=new Set(["x","y","z"]),Zpe=H1.filter(e=>!Qpe.has(e));function ege(e){const t=[];return Zpe.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t.length&&e.render(),t}const n0={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:h6(4,13),y:h6(5,14)};n0.translateX=n0.x;n0.translateY=n0.y;const tge=(e,t,r)=>{const n=t.measureViewportBox(),s=t.current,o=getComputedStyle(s),{display:i}=o,l={};i==="none"&&t.setStaticValue("display",e.display||"block"),r.forEach(d=>{l[d]=n0[d](n,o)}),t.render();const c=t.measureViewportBox();return r.forEach(d=>{const u=t.getValue(d);u&&u.jump(l[d]),e[d]=n0[d](c,o)}),e},rge=(e,t,r={},n={})=>{t={...t},n={...n};const s=Object.keys(t).filter(VK);let o=[],i=!1;const l=[];if(s.forEach(c=>{const d=e.getValue(c);if(!e.hasValue(c))return;let u=r[c],f=Ly(u);const h=t[c];let m;if(xN(h)){const x=h.length,g=h[0]===null?1:0;u=h[g],f=Ly(u);for(let y=g;y<x&&h[y]!==null;y++)m?hD(Ly(h[y])===m):m=Ly(h[y])}else m=Ly(h);if(f!==m)if(f6(f)&&f6(m)){const x=d.get();typeof x=="string"&&d.set(parseFloat(x)),typeof h=="string"?t[c]=parseFloat(h):Array.isArray(h)&&m===Oa&&(t[c]=h.map(parseFloat))}else f?.transform&&m?.transform&&(u===0||h===0)?u===0?d.set(m.transform(u)):t[c]=f.transform(h):(i||(o=ege(e),i=!0),l.push(c),n[c]=n[c]!==void 0?n[c]:t[c],d.jump(h))}),l.length){const c=l.indexOf("height")>=0?window.pageYOffset:null,d=tge(t,e,l);return o.length&&o.forEach(([u,f])=>{e.getValue(u).set(f)}),e.render(),LC&&c!==null&&window.scrollTo({top:c}),{target:d,transitionEnd:n}}else return{target:t,transitionEnd:n}};function nge(e,t,r,n){return Jpe(t)?rge(e,t,r,n):{target:t,transitionEnd:n}}const age=(e,t,r,n)=>{const s=Xpe(e,t,n);return t=s.target,n=s.transitionEnd,nge(e,t,r,n)},rO={current:null},WK={current:!1};function sge(){if(WK.current=!0,!!LC)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>rO.current=e.matches;e.addListener(t),t()}else rO.current=!1}function oge(e,t,r){const{willChange:n}=t;for(const s in t){const o=t[s],i=r[s];if(Tc(o))e.addValue(s,o),wN(n)&&n.add(s);else if(Tc(i))e.addValue(s,r0(o,{owner:e})),wN(n)&&n.remove(s);else if(i!==o)if(e.hasValue(s)){const l=e.getValue(s);!l.hasAnimated&&l.set(o)}else{const l=e.getStaticValue(s);e.addValue(s,r0(l!==void 0?l:o,{owner:e}))}}for(const s in r)t[s]===void 0&&e.removeValue(s);return t}const p6=new WeakMap,HK=Object.keys(kw),ige=HK.length,g6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],lge=sD.length;class cge{constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:s,visualState:o},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>co.render(this.render,!1,!0);const{latestValues:l,renderState:c}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=r.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=s,this.options=i,this.isControllingVariants=BC(r),this.isVariantNode=kG(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:d,...u}=this.scrapeMotionValuesFromProps(r,{});for(const f in u){const h=u[f];l[f]!==void 0&&Tc(h)&&(h.set(l[f],!1),wN(d)&&d.add(f))}}scrapeMotionValuesFromProps(t,r){return{}}mount(t){this.current=t,p6.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),WK.current||sge(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:rO.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){p6.delete(this.current),this.projection&&this.projection.unmount(),Am(this.notifyUpdate),Am(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,r){const n=lx.has(t),s=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&co.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),o=r.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{s(),o()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...r},n,s,o){let i,l;for(let c=0;c<ige;c++){const d=HK[c],{isEnabled:u,Feature:f,ProjectionNode:h,MeasureLayout:m}=kw[d];h&&(i=h),u(r)&&(!this.features[d]&&f&&(this.features[d]=new f(this)),m&&(l=m))}if((this.type==="html"||this.type==="svg")&&!this.projection&&i){this.projection=new i(this.latestValues,this.parent&&this.parent.projection);const{layoutId:c,layout:d,drag:u,dragConstraints:f,layoutScroll:h,layoutRoot:m}=r;this.projection.setOptions({layoutId:c,layout:d,alwaysMeasureLayout:!!u||f&&pv(f),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof d=="string"?d:"both",initialPromotionConfig:o,layoutScroll:h,layoutRoot:m})}return l}updateFeatures(){for(const t in this.features){const r=this.features[t];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):mi()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}makeTargetAnimatable(t,r=!0){return this.makeTargetAnimatableFromInstance(t,this.props,r)}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<g6.length;n++){const s=g6[n];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const o=t["on"+s];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=oge(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const n=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(n.initial=this.props.initial),n}const r={};for(let n=0;n<lge;n++){const s=sD[n],o=this.props[s];(Ew(o)||o===!1)&&(r[s]=o)}return r}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){r!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,r)),this.values.set(t,r),this.latestValues[t]=r.get()}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=r0(r,{owner:this}),this.addValue(t,n)),n}readValue(t){var r;return this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(r=this.getBaseTargetFromProps(this.props,t))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,t,this.options)}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var r;const{initial:n}=this.props,s=typeof n=="string"||typeof n=="object"?(r=mD(this.props,n))===null||r===void 0?void 0:r[t]:void 0;if(n&&s!==void 0)return s;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!Tc(o)?o:this.initialValues[t]!==void 0&&s===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new jD),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}}class GK extends cge{sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}makeTargetAnimatableFromInstance({transition:t,transitionEnd:r,...n},{transformValues:s},o){let i=Che(n,t||{},this);if(s&&(r&&(r=s(r)),n&&(n=s(n)),i&&(i=s(i))),o){Nhe(this,n,i);const l=age(this,n,i,r);r=l.transitionEnd,n=l.target}return{transition:t,transitionEnd:r,...n}}}function dge(e){return window.getComputedStyle(e)}class uge extends GK{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,r){if(lx.has(r)){const n=vD(r);return n&&n.default||0}else{const n=dge(t),s=(DG(r)?n.getPropertyValue(r):n[r])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:r}){return DK(t,r)}build(t,r,n,s){lD(t,r,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,r){return fD(t,r)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Tc(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}renderInstance(t,r,n,s){BG(t,r,n,s)}}class fge extends GK{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(lx.has(r)){const n=vD(r);return n&&n.default||0}return r=qG.has(r)?r:nD(r),t.getAttribute(r)}measureInstanceViewportBox(){return mi()}scrapeMotionValuesFromProps(t,r){return UG(t,r)}build(t,r,n,s){dD(t,r,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,r,n,s){zG(t,r,n,s)}mount(t){this.isSVGTag=uD(t.tagName),super.mount(t)}}const mge=(e,t)=>iD(e)?new fge(t,{enableHardwareAcceleration:!1}):new uge(t,{enableHardwareAcceleration:!0}),hge={layout:{ProjectionNode:UK,MeasureLayout:RK}},pge={...qhe,...ime,...Hpe,...hge},Er=gfe((e,t)=>Kfe(e,t,pge,mge));function KK(){const e=p.useRef(!1);return rD(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function gge(){const e=KK(),[t,r]=p.useState(0),n=p.useCallback(()=>{e.current&&r(t+1)},[t]);return[p.useCallback(()=>co.postRender(n),[n]),t]}class xge extends p.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=r.offsetHeight||0,n.width=r.offsetWidth||0,n.top=r.offsetTop,n.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function vge({children:e,isPresent:t}){const r=p.useId(),n=p.useRef(null),s=p.useRef({width:0,height:0,top:0,left:0});return p.useInsertionEffect(()=>{const{width:o,height:i,top:l,left:c}=s.current;if(t||!n.current||!o||!i)return;n.current.dataset.motionPopId=r;const d=document.createElement("style");return document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${i}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[t]),p.createElement(xge,{isPresent:t,childRef:n,sizeRef:s},p.cloneElement(e,{ref:n}))}const $P=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:s,presenceAffectsLayout:o,mode:i})=>{const l=VG(yge),c=p.useId(),d=p.useMemo(()=>({id:c,initial:t,isPresent:r,custom:s,onExitComplete:u=>{l.set(u,!0);for(const f of l.values())if(!f)return;n&&n()},register:u=>(l.set(u,!1),()=>l.delete(u))}),o?void 0:[r]);return p.useMemo(()=>{l.forEach((u,f)=>l.set(f,!1))},[r]),p.useEffect(()=>{!r&&!l.size&&n&&n()},[r]),i==="popLayout"&&(e=p.createElement(vge,{isPresent:r},e)),p.createElement(FC.Provider,{value:d},e)};function yge(){return new Map}function bge(e){return p.useEffect(()=>()=>e(),[])}const Kp=e=>e.key||"";function wge(e,t){e.forEach(r=>{const n=Kp(r);t.set(n,r)})}function _ge(e){const t=[];return p.Children.forEach(e,r=>{p.isValidElement(r)&&t.push(r)}),t}const jge=({children:e,custom:t,initial:r=!0,onExitComplete:n,exitBeforeEnter:s,presenceAffectsLayout:o=!0,mode:i="sync"})=>{const l=p.useContext(oD).forceRender||gge()[0],c=KK(),d=_ge(e);let u=d;const f=p.useRef(new Map).current,h=p.useRef(u),m=p.useRef(new Map).current,x=p.useRef(!0);if(rD(()=>{x.current=!1,wge(d,m),h.current=u}),bge(()=>{x.current=!0,m.clear(),f.clear()}),x.current)return p.createElement(p.Fragment,null,u.map(b=>p.createElement($P,{key:Kp(b),isPresent:!0,initial:r?void 0:!1,presenceAffectsLayout:o,mode:i},b)));u=[...u];const g=h.current.map(Kp),y=d.map(Kp),v=g.length;for(let b=0;b<v;b++){const w=g[b];y.indexOf(w)===-1&&!f.has(w)&&f.set(w,void 0)}return i==="wait"&&f.size&&(u=[]),f.forEach((b,w)=>{if(y.indexOf(w)!==-1)return;const _=m.get(w);if(!_)return;const j=g.indexOf(w);let S=b;if(!S){const C=()=>{f.delete(w);const A=Array.from(m.keys()).filter(P=>!y.includes(P));if(A.forEach(P=>m.delete(P)),h.current=d.filter(P=>{const F=Kp(P);return F===w||A.includes(F)}),!f.size){if(c.current===!1)return;l(),n&&n()}};S=p.createElement($P,{key:Kp(_),isPresent:!1,onExitComplete:C,custom:t,presenceAffectsLayout:o,mode:i},_),f.set(w,S)}u.splice(j,0,S)}),u=u.map(b=>{const w=b.key;return f.has(w)?b:p.createElement($P,{key:Kp(b),isPresent:!0,presenceAffectsLayout:o,mode:i},b)}),p.createElement(p.Fragment,null,f.size?u:u.map(b=>p.cloneElement(b)))};function x6(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function VC(...e){return t=>{let r=!1;const n=e.map(s=>{const o=x6(s,t);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let s=0;s<n.length;s++){const o=n[s];typeof o=="function"?o():x6(e[s],null)}}}}function ms(...e){return p.useCallback(VC(...e),e)}function ip(e){const t=Sge(e),r=p.forwardRef((n,s)=>{const{children:o,...i}=n,l=p.Children.toArray(o),c=l.find(Age);if(c){const d=c.props.children,u=l.map(f=>f===c?p.Children.count(d)>1?p.Children.only(null):p.isValidElement(d)?d.props.children:null:f);return a.jsx(t,{...i,ref:s,children:p.isValidElement(d)?p.cloneElement(d,void 0,u):null})}return a.jsx(t,{...i,ref:s,children:o})});return r.displayName=`${e}.Slot`,r}var Nge=ip("Slot");function Sge(e){const t=p.forwardRef((r,n)=>{const{children:s,...o}=r;if(p.isValidElement(s)){const i=Ege(s),l=Pge(o,s.props);return s.type!==p.Fragment&&(l.ref=n?VC(n,i):i),p.cloneElement(s,l)}return p.Children.count(s)>1?p.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var XK=Symbol("radix.slottable");function Cge(e){const t=({children:r})=>a.jsx(a.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=XK,t}function Age(e){return p.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===XK}function Pge(e,t){const r={...t};for(const n in t){const s=e[n],o=t[n];/^on[A-Z]/.test(n)?s&&o?r[n]=(...l)=>{const c=o(...l);return s(...l),c}:s&&(r[n]=s):n==="style"?r[n]={...s,...o}:n==="className"&&(r[n]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}function Ege(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}const v6=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,y6=qa,ND=(e,t)=>r=>{var n;if(t?.variants==null)return y6(e,r?.class,r?.className);const{variants:s,defaultVariants:o}=t,i=Object.keys(s).map(d=>{const u=r?.[d],f=o?.[d];if(u===null)return null;const h=v6(u)||v6(f);return s[d][h]}),l=r&&Object.entries(r).reduce((d,u)=>{let[f,h]=u;return h===void 0||(d[f]=h),d},{}),c=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((d,u)=>{let{class:f,className:h,...m}=u;return Object.entries(m).every(x=>{let[g,y]=x;return Array.isArray(y)?y.includes({...o,...l}[g]):{...o,...l}[g]===y})?[...d,f,h]:d},[]);return y6(e,i,c,r?.class,r?.className)},Ow=ND("inline-flex items-center justify-center rounded-sm text-sm font-bold tracking-wide transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background active:scale-[0.98] disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-brand text-primary-foreground hover:bg-brand/90 shadow-lg shadow-brand/15",destructive:"bg-danger text-white hover:bg-danger/90 shadow-lg shadow-danger/15",outline:"border border-border bg-transparent hover:bg-accent hover:text-accent-foreground",secondary:"bg-surface-2 text-secondary-foreground hover:bg-surface-2/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-brand underline-offset-4 hover:underline",success:"bg-success text-white hover:bg-success/90 shadow-lg shadow-success/15"},size:{default:"h-10 px-5 py-2 gap-2",sm:"h-9 rounded-sm px-3 gap-1.5",lg:"h-12 rounded-md px-8 gap-2.5 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),se=Ee.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...s},o)=>{const i=n?Nge:"button";return a.jsx(i,{className:Sr(Ow({variant:t,size:r,className:e})),ref:o,...s})});se.displayName="Button";const f_=[{to:"/",icon:Wue,label:"Painel Principal"},{to:"/agenda",icon:lo,label:"Agenda"},{to:"/vendas",icon:W1,label:"Loja"},{to:"/financeiro",icon:CG,label:"Financeiro"},{to:"/fiscal",icon:Y4,label:"Central Fiscal"}],Nj={hidden:{opacity:0,x:-20},visible:e=>({opacity:1,x:0,transition:{delay:e*.05+.3,duration:.3,ease:"easeOut"}})},kge=({to:e,icon:t,label:r,index:n,onNavigate:s})=>{const o="flex items-center h-[52px] px-4 rounded-sm bg-brand text-primary-foreground font-bold shadow-lg shadow-brand/10 border-l-4 border-brand w-full",i="flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 border-transparent w-full";return a.jsx(Er.li,{custom:n,variants:Nj,initial:"hidden",animate:"visible",whileHover:{x:4},transition:{type:"spring",stiffness:300,damping:15},children:a.jsxs(em,{to:e,onClick:s,className:({isActive:l})=>e==="/isis"&&l?"flex items-center h-[52px] px-4 rounded-sm font-bold text-white shadow-lg shadow-emerald-500/10 border-l-4 border-transparent bg-gradient-to-r from-fuchsia-600 via-violet-600 to-emerald-600 ring-1 ring-white/10":l?o:i,children:[e==="/isis"?a.jsx("span",{className:"mr-4 flex-shrink-0 inline-flex items-center justify-center rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)]",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(Hi,{size:"sm"})})}):a.jsx(t,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base flex items-center gap-2",children:r})]})})};function Ige({onNavigate:e,isVisible:t,setIsVisible:r,sidebarPinned:n}){const s=hl(),o=wi(),i=["/produtos","/compras","/clientes","/equipe","/quadras","/empresas","/finalizadoras"],l=p.useMemo(()=>i.includes(o.pathname),[o.pathname]),[c,d]=p.useState(l),u=p.useRef(null);p.useRef(null);const f=p.useRef(0),h=p.useRef(0),m=()=>{window.innerWidth<768&&r(!1)};return p.useEffect(()=>{const x=v=>{window.innerWidth>=768||(f.current=v.touches[0].clientX,h.current=v.touches[0].clientY)},g=v=>{if(window.innerWidth>=768)return;const b=v.touches[0].clientX,w=v.touches[0].clientY,_=b-f.current,j=Math.abs(w-h.current);f.current<50&&_>50&&j<50&&r(!0)},y=()=>{f.current=0,h.current=0};return window.addEventListener("touchstart",x,{passive:!0}),window.addEventListener("touchmove",g,{passive:!0}),window.addEventListener("touchend",y,{passive:!0}),()=>{window.removeEventListener("touchstart",x),window.removeEventListener("touchmove",g),window.removeEventListener("touchend",y)}},[t]),a.jsx(a.Fragment,{children:a.jsxs(Er.aside,{ref:u,initial:!1,animate:{width:n||t?280:0},className:`h-screen bg-surface flex flex-col border-r border-border shadow-xl shadow-black/20 overflow-hidden\r
                   fixed inset-y-0 left-0 z-40 md:static md:flex-shrink-0`,children:[a.jsxs(Er.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},className:"flex items-center px-6 pt-8 pb-6 h-[120px] flex-shrink-0",children:[a.jsx("div",{className:"w-14 h-14 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(sd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]}),a.jsx("nav",{className:"flex-1 overflow-y-auto px-6 py-2 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent hover:scrollbar-thumb-border-hover",children:a.jsxs("ul",{className:"space-y-3",children:[f_.map((x,g)=>a.jsx(kge,{...x,index:g,onNavigate:m},x.to)),a.jsxs(Er.li,{custom:f_.length,variants:Nj,initial:"hidden",animate:"visible",children:[a.jsxs("button",{type:"button",onClick:()=>d(x=>!x),className:`w-full flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 ${l?"bg-brand text-primary-foreground font-bold border-brand":"border-transparent"}`,children:[a.jsx(Fue,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base flex-1 text-left",children:"Cadastros"}),a.jsx(ix,{className:`h-4 w-4 transition-transform ${c?"rotate-180":""}`})]}),c&&a.jsxs("ul",{className:"mt-2 ml-8 space-y-2",children:[a.jsx("li",{children:a.jsxs(em,{to:"/clientes",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(tc,{className:"h-4 w-4 mr-3"})," Clientes & Fornecedores"]})}),a.jsx("li",{children:a.jsxs(em,{to:"/finalizadoras",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(Nh,{className:"h-4 w-4 mr-3"})," Finalizadoras"]})}),a.jsx("li",{children:a.jsxs(em,{to:"/produtos",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(su,{className:"h-4 w-4 mr-3"})," Produtos"]})}),a.jsx("li",{children:a.jsxs(em,{to:"/equipe",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(sfe,{className:"h-4 w-4 mr-3"})," Equipe"]})}),a.jsx("li",{children:a.jsxs(em,{to:"/quadras",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(Vue,{className:"h-4 w-4 mr-3"})," Quadras"]})}),a.jsx("li",{children:a.jsxs(em,{to:"/empresas",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(hN,{className:"h-4 w-4 mr-3"})," Empresa"]})})]})]}),a.jsx(Er.li,{custom:f_.length+1,variants:Nj,initial:"hidden",animate:"visible",className:"pt-4 border-t border-border/50 mt-4",children:a.jsxs(em,{to:"/suporte",onClick:m,className:({isActive:x})=>x?"flex items-center h-[52px] px-4 rounded-sm bg-brand text-primary-foreground font-bold shadow-lg shadow-brand/10 border-l-4 border-brand":"flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 border-transparent",children:[a.jsx(bG,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base",children:"Suporte"})]})}),a.jsx(Er.li,{custom:f_.length+2,variants:Nj,initial:"hidden",animate:"visible",children:a.jsxs(em,{to:"/isis",onClick:m,className:({isActive:x})=>x?"flex items-center h-[56px] px-4 rounded-sm font-extrabold text-text-primary bg-surface-2/80 border border-white/20 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.06)]":"flex items-center h-[56px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border border-white/15",children:[a.jsx("span",{className:"mr-4 flex-shrink-0 inline-flex items-center justify-center rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)]",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(Hi,{size:"sm"})})}),a.jsx("span",{className:"text-lg font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 via-violet-300 to-emerald-300",children:"sis"}),a.jsx("button",{type:"button",title:"Dashboard analtica da sis",onClick:x=>{x.preventDefault(),x.stopPropagation(),s("/isis/analytics")},className:"ml-auto inline-flex items-center justify-center p-2.5 rounded-full text-text-secondary hover:text-text-primary hover:bg-white/10 transition-all border border-white/10 hover:border-white/20 cursor-pointer shadow-sm hover:shadow",children:a.jsx(fd,{className:"h-5 w-5"})})]})})]})})]})})}function Bn(e,t,{checkForDefaultPrevented:r=!0}={}){return function(s){if(e?.(s),r===!1||!s.defaultPrevented)return t?.(s)}}function Oge(e,t){const r=p.createContext(t),n=o=>{const{children:i,...l}=o,c=p.useMemo(()=>l,Object.values(l));return a.jsx(r.Provider,{value:c,children:i})};n.displayName=e+"Provider";function s(o){const i=p.useContext(r);if(i)return i;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return[n,s]}function cu(e,t=[]){let r=[];function n(o,i){const l=p.createContext(i),c=r.length;r=[...r,i];const d=f=>{const{scope:h,children:m,...x}=f,g=h?.[e]?.[c]||l,y=p.useMemo(()=>x,Object.values(x));return a.jsx(g.Provider,{value:y,children:m})};d.displayName=o+"Provider";function u(f,h){const m=h?.[e]?.[c]||l,x=p.useContext(m);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${o}\``)}return[d,u]}const s=()=>{const o=r.map(i=>p.createContext(i));return function(l){const c=l?.[e]||o;return p.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return s.scopeName=e,[n,Tge(s,...t)]}function Tge(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((l,{useScope:c,scopeName:d})=>{const f=c(o)[`__scope${d}`];return{...l,...f}},{});return p.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}var Dge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ka=Dge.reduce((e,t)=>{const r=ip(`Primitive.${t}`),n=p.forwardRef((s,o)=>{const{asChild:i,...l}=s,c=i?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function SD(e,t){e&&Rm.flushSync(()=>e.dispatchEvent(t))}function Dc(e){const t=p.useRef(e);return p.useEffect(()=>{t.current=e}),p.useMemo(()=>(...r)=>t.current?.(...r),[])}function Mge(e,t=globalThis?.document){const r=Dc(e);p.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Rge="DismissableLayer",nO="dismissableLayer.update",Fge="dismissableLayer.pointerDownOutside",Lge="dismissableLayer.focusOutside",b6,YK=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),H0=p.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:i,onDismiss:l,...c}=e,d=p.useContext(YK),[u,f]=p.useState(null),h=u?.ownerDocument??globalThis?.document,[,m]=p.useState({}),x=ms(t,C=>f(C)),g=Array.from(d.layers),[y]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),v=g.indexOf(y),b=u?g.indexOf(u):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,_=b>=v,j=Bge(C=>{const A=C.target,P=[...d.branches].some(F=>F.contains(A));!_||P||(s?.(C),i?.(C),C.defaultPrevented||l?.())},h),S=qge(C=>{const A=C.target;[...d.branches].some(F=>F.contains(A))||(o?.(C),i?.(C),C.defaultPrevented||l?.())},h);return Mge(C=>{b===d.layers.size-1&&(n?.(C),!C.defaultPrevented&&l&&(C.preventDefault(),l()))},h),p.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(b6=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),w6(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=b6)}},[u,h,r,d]),p.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),w6())},[u,d]),p.useEffect(()=>{const C=()=>m({});return document.addEventListener(nO,C),()=>document.removeEventListener(nO,C)},[]),a.jsx(ka.div,{...c,ref:x,style:{pointerEvents:w?_?"auto":"none":void 0,...e.style},onFocusCapture:Bn(e.onFocusCapture,S.onFocusCapture),onBlurCapture:Bn(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:Bn(e.onPointerDownCapture,j.onPointerDownCapture)})});H0.displayName=Rge;var $ge="DismissableLayerBranch",JK=p.forwardRef((e,t)=>{const r=p.useContext(YK),n=p.useRef(null),s=ms(t,n);return p.useEffect(()=>{const o=n.current;if(o)return r.branches.add(o),()=>{r.branches.delete(o)}},[r.branches]),a.jsx(ka.div,{...e,ref:s})});JK.displayName=$ge;function Bge(e,t=globalThis?.document){const r=Dc(e),n=p.useRef(!1),s=p.useRef(()=>{});return p.useEffect(()=>{const o=l=>{if(l.target&&!n.current){let c=function(){QK(Fge,r,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=c,t.addEventListener("click",s.current,{once:!0})):c()}else t.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",o),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function qge(e,t=globalThis?.document){const r=Dc(e),n=p.useRef(!1);return p.useEffect(()=>{const s=o=>{o.target&&!n.current&&QK(Lge,r,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function w6(){const e=new CustomEvent(nO);document.dispatchEvent(e)}function QK(e,t,r,{discrete:n}){const s=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?SD(s,o):s.dispatchEvent(o)}var zge=H0,Uge=JK,BP=0;function WC(){p.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??_6()),document.body.insertAdjacentElement("beforeend",e[1]??_6()),BP++,()=>{BP===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),BP--}},[])}function _6(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var qP="focusScope.autoFocusOnMount",zP="focusScope.autoFocusOnUnmount",j6={bubbles:!1,cancelable:!0},Vge="FocusScope",Y1=p.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=e,[l,c]=p.useState(null),d=Dc(s),u=Dc(o),f=p.useRef(null),h=ms(t,g=>c(g)),m=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(n){let g=function(w){if(m.paused||!l)return;const _=w.target;l.contains(_)?f.current=_:sh(f.current,{select:!0})},y=function(w){if(m.paused||!l)return;const _=w.relatedTarget;_!==null&&(l.contains(_)||sh(f.current,{select:!0}))},v=function(w){if(document.activeElement===document.body)for(const j of w)j.removedNodes.length>0&&sh(l)};document.addEventListener("focusin",g),document.addEventListener("focusout",y);const b=new MutationObserver(v);return l&&b.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",y),b.disconnect()}}},[n,l,m.paused]),p.useEffect(()=>{if(l){S6.add(m);const g=document.activeElement;if(!l.contains(g)){const v=new CustomEvent(qP,j6);l.addEventListener(qP,d),l.dispatchEvent(v),v.defaultPrevented||(Wge(Yge(ZK(l)),{select:!0}),document.activeElement===g&&sh(l))}return()=>{l.removeEventListener(qP,d),setTimeout(()=>{const v=new CustomEvent(zP,j6);l.addEventListener(zP,u),l.dispatchEvent(v),v.defaultPrevented||sh(g??document.body,{select:!0}),l.removeEventListener(zP,u),S6.remove(m)},0)}}},[l,d,u,m]);const x=p.useCallback(g=>{if(!r&&!n||m.paused)return;const y=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,v=document.activeElement;if(y&&v){const b=g.currentTarget,[w,_]=Hge(b);w&&_?!g.shiftKey&&v===_?(g.preventDefault(),r&&sh(w,{select:!0})):g.shiftKey&&v===w&&(g.preventDefault(),r&&sh(_,{select:!0})):v===b&&g.preventDefault()}},[r,n,m.paused]);return a.jsx(ka.div,{tabIndex:-1,...i,ref:h,onKeyDown:x})});Y1.displayName=Vge;function Wge(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(sh(n,{select:t}),document.activeElement!==r)return}function Hge(e){const t=ZK(e),r=N6(t,e),n=N6(t.reverse(),e);return[r,n]}function ZK(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function N6(e,t){for(const r of e)if(!Gge(r,{upTo:t}))return r}function Gge(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Kge(e){return e instanceof HTMLInputElement&&"select"in e}function sh(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&Kge(e)&&t&&e.select()}}var S6=Xge();function Xge(){let e=[];return{add(t){const r=e[0];t!==r&&r?.pause(),e=C6(e,t),e.unshift(t)},remove(t){e=C6(e,t),e[0]?.resume()}}}function C6(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function Yge(e){return e.filter(t=>t.tagName!=="A")}var ml=globalThis?.document?p.useLayoutEffect:()=>{},Jge=Q3[" useId ".trim().toString()]||(()=>{}),Qge=0;function Fu(e){const[t,r]=p.useState(Jge());return ml(()=>{e||r(n=>n??String(Qge++))},[e]),e||(t?`radix-${t}`:"")}const Zge=["top","right","bottom","left"],lp=Math.min,td=Math.max,jN=Math.round,m_=Math.floor,Af=e=>({x:e,y:e}),exe={left:"right",right:"left",bottom:"top",top:"bottom"},txe={start:"end",end:"start"};function aO(e,t,r){return td(e,lp(t,r))}function Pm(e,t){return typeof e=="function"?e(t):e}function Em(e){return e.split("-")[0]}function G0(e){return e.split("-")[1]}function CD(e){return e==="x"?"y":"x"}function AD(e){return e==="y"?"height":"width"}const rxe=new Set(["top","bottom"]);function vf(e){return rxe.has(Em(e))?"y":"x"}function PD(e){return CD(vf(e))}function nxe(e,t,r){r===void 0&&(r=!1);const n=G0(e),s=PD(e),o=AD(s);let i=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(i=NN(i)),[i,NN(i)]}function axe(e){const t=NN(e);return[sO(e),t,sO(t)]}function sO(e){return e.replace(/start|end/g,t=>txe[t])}const A6=["left","right"],P6=["right","left"],sxe=["top","bottom"],oxe=["bottom","top"];function ixe(e,t,r){switch(e){case"top":case"bottom":return r?t?P6:A6:t?A6:P6;case"left":case"right":return t?sxe:oxe;default:return[]}}function lxe(e,t,r,n){const s=G0(e);let o=ixe(Em(e),r==="start",n);return s&&(o=o.map(i=>i+"-"+s),t&&(o=o.concat(o.map(sO)))),o}function NN(e){return e.replace(/left|right|bottom|top/g,t=>exe[t])}function cxe(e){return{top:0,right:0,bottom:0,left:0,...e}}function eX(e){return typeof e!="number"?cxe(e):{top:e,right:e,bottom:e,left:e}}function SN(e){const{x:t,y:r,width:n,height:s}=e;return{width:n,height:s,top:r,left:t,right:t+n,bottom:r+s,x:t,y:r}}function E6(e,t,r){let{reference:n,floating:s}=e;const o=vf(t),i=PD(t),l=AD(i),c=Em(t),d=o==="y",u=n.x+n.width/2-s.width/2,f=n.y+n.height/2-s.height/2,h=n[l]/2-s[l]/2;let m;switch(c){case"top":m={x:u,y:n.y-s.height};break;case"bottom":m={x:u,y:n.y+n.height};break;case"right":m={x:n.x+n.width,y:f};break;case"left":m={x:n.x-s.width,y:f};break;default:m={x:n.x,y:n.y}}switch(G0(t)){case"start":m[i]-=h*(r&&d?-1:1);break;case"end":m[i]+=h*(r&&d?-1:1);break}return m}const dxe=async(e,t,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:o=[],platform:i}=r,l=o.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(t));let d=await i.getElementRects({reference:e,floating:t,strategy:s}),{x:u,y:f}=E6(d,n,c),h=n,m={},x=0;for(let g=0;g<l.length;g++){const{name:y,fn:v}=l[g],{x:b,y:w,data:_,reset:j}=await v({x:u,y:f,initialPlacement:n,placement:h,strategy:s,middlewareData:m,rects:d,platform:i,elements:{reference:e,floating:t}});u=b??u,f=w??f,m={...m,[y]:{...m[y],..._}},j&&x<=50&&(x++,typeof j=="object"&&(j.placement&&(h=j.placement),j.rects&&(d=j.rects===!0?await i.getElementRects({reference:e,floating:t,strategy:s}):j.rects),{x:u,y:f}=E6(d,h,c)),g=-1)}return{x:u,y:f,placement:h,strategy:s,middlewareData:m}};async function Tw(e,t){var r;t===void 0&&(t={});const{x:n,y:s,platform:o,rects:i,elements:l,strategy:c}=e,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:h=!1,padding:m=0}=Pm(t,e),x=eX(m),y=l[h?f==="floating"?"reference":"floating":f],v=SN(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(y)))==null||r?y:y.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(l.floating)),boundary:d,rootBoundary:u,strategy:c})),b=f==="floating"?{x:n,y:s,width:i.floating.width,height:i.floating.height}:i.reference,w=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l.floating)),_=await(o.isElement==null?void 0:o.isElement(w))?await(o.getScale==null?void 0:o.getScale(w))||{x:1,y:1}:{x:1,y:1},j=SN(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:b,offsetParent:w,strategy:c}):b);return{top:(v.top-j.top+x.top)/_.y,bottom:(j.bottom-v.bottom+x.bottom)/_.y,left:(v.left-j.left+x.left)/_.x,right:(j.right-v.right+x.right)/_.x}}const uxe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:s,rects:o,platform:i,elements:l,middlewareData:c}=t,{element:d,padding:u=0}=Pm(e,t)||{};if(d==null)return{};const f=eX(u),h={x:r,y:n},m=PD(s),x=AD(m),g=await i.getDimensions(d),y=m==="y",v=y?"top":"left",b=y?"bottom":"right",w=y?"clientHeight":"clientWidth",_=o.reference[x]+o.reference[m]-h[m]-o.floating[x],j=h[m]-o.reference[m],S=await(i.getOffsetParent==null?void 0:i.getOffsetParent(d));let C=S?S[w]:0;(!C||!await(i.isElement==null?void 0:i.isElement(S)))&&(C=l.floating[w]||o.floating[x]);const A=_/2-j/2,P=C/2-g[x]/2-1,F=lp(f[v],P),O=lp(f[b],P),I=F,T=C-g[x]-O,k=C/2-g[x]/2+A,B=aO(I,k,T),z=!c.arrow&&G0(s)!=null&&k!==B&&o.reference[x]/2-(k<I?F:O)-g[x]/2<0,U=z?k<I?k-I:k-T:0;return{[m]:h[m]+U,data:{[m]:B,centerOffset:k-B-U,...z&&{alignmentOffset:U}},reset:z}}}),fxe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:s,middlewareData:o,rects:i,initialPlacement:l,platform:c,elements:d}=t,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:h,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:g=!0,...y}=Pm(e,t);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const v=Em(s),b=vf(l),w=Em(l)===l,_=await(c.isRTL==null?void 0:c.isRTL(d.floating)),j=h||(w||!g?[NN(l)]:axe(l)),S=x!=="none";!h&&S&&j.push(...lxe(l,g,x,_));const C=[l,...j],A=await Tw(t,y),P=[];let F=((n=o.flip)==null?void 0:n.overflows)||[];if(u&&P.push(A[v]),f){const k=nxe(s,i,_);P.push(A[k[0]],A[k[1]])}if(F=[...F,{placement:s,overflows:P}],!P.every(k=>k<=0)){var O,I;const k=(((O=o.flip)==null?void 0:O.index)||0)+1,B=C[k];if(B&&(!(f==="alignment"?b!==vf(B):!1)||F.every(L=>vf(L.placement)===b?L.overflows[0]>0:!0)))return{data:{index:k,overflows:F},reset:{placement:B}};let z=(I=F.filter(U=>U.overflows[0]<=0).sort((U,L)=>U.overflows[1]-L.overflows[1])[0])==null?void 0:I.placement;if(!z)switch(m){case"bestFit":{var T;const U=(T=F.filter(L=>{if(S){const W=vf(L.placement);return W===b||W==="y"}return!0}).map(L=>[L.placement,L.overflows.filter(W=>W>0).reduce((W,ge)=>W+ge,0)]).sort((L,W)=>L[1]-W[1])[0])==null?void 0:T[0];U&&(z=U);break}case"initialPlacement":z=l;break}if(s!==z)return{reset:{placement:z}}}return{}}}};function k6(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function I6(e){return Zge.some(t=>e[t]>=0)}const mxe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...s}=Pm(e,t);switch(n){case"referenceHidden":{const o=await Tw(t,{...s,elementContext:"reference"}),i=k6(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:I6(i)}}}case"escaped":{const o=await Tw(t,{...s,altBoundary:!0}),i=k6(o,r.floating);return{data:{escapedOffsets:i,escaped:I6(i)}}}default:return{}}}}},tX=new Set(["left","top"]);async function hxe(e,t){const{placement:r,platform:n,elements:s}=e,o=await(n.isRTL==null?void 0:n.isRTL(s.floating)),i=Em(r),l=G0(r),c=vf(r)==="y",d=tX.has(i)?-1:1,u=o&&c?-1:1,f=Pm(t,e);let{mainAxis:h,crossAxis:m,alignmentAxis:x}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return l&&typeof x=="number"&&(m=l==="end"?x*-1:x),c?{x:m*u,y:h*d}:{x:h*d,y:m*u}}const pxe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:s,y:o,placement:i,middlewareData:l}=t,c=await hxe(t,e);return i===((r=l.offset)==null?void 0:r.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:s+c.x,y:o+c.y,data:{...c,placement:i}}}}},gxe=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:s}=t,{mainAxis:o=!0,crossAxis:i=!1,limiter:l={fn:y=>{let{x:v,y:b}=y;return{x:v,y:b}}},...c}=Pm(e,t),d={x:r,y:n},u=await Tw(t,c),f=vf(Em(s)),h=CD(f);let m=d[h],x=d[f];if(o){const y=h==="y"?"top":"left",v=h==="y"?"bottom":"right",b=m+u[y],w=m-u[v];m=aO(b,m,w)}if(i){const y=f==="y"?"top":"left",v=f==="y"?"bottom":"right",b=x+u[y],w=x-u[v];x=aO(b,x,w)}const g=l.fn({...t,[h]:m,[f]:x});return{...g,data:{x:g.x-r,y:g.y-n,enabled:{[h]:o,[f]:i}}}}}},xxe=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:s,rects:o,middlewareData:i}=t,{offset:l=0,mainAxis:c=!0,crossAxis:d=!0}=Pm(e,t),u={x:r,y:n},f=vf(s),h=CD(f);let m=u[h],x=u[f];const g=Pm(l,t),y=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(c){const w=h==="y"?"height":"width",_=o.reference[h]-o.floating[w]+y.mainAxis,j=o.reference[h]+o.reference[w]-y.mainAxis;m<_?m=_:m>j&&(m=j)}if(d){var v,b;const w=h==="y"?"width":"height",_=tX.has(Em(s)),j=o.reference[f]-o.floating[w]+(_&&((v=i.offset)==null?void 0:v[f])||0)+(_?0:y.crossAxis),S=o.reference[f]+o.reference[w]+(_?0:((b=i.offset)==null?void 0:b[f])||0)-(_?y.crossAxis:0);x<j?x=j:x>S&&(x=S)}return{[h]:m,[f]:x}}}},vxe=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:s,rects:o,platform:i,elements:l}=t,{apply:c=()=>{},...d}=Pm(e,t),u=await Tw(t,d),f=Em(s),h=G0(s),m=vf(s)==="y",{width:x,height:g}=o.floating;let y,v;f==="top"||f==="bottom"?(y=f,v=h===(await(i.isRTL==null?void 0:i.isRTL(l.floating))?"start":"end")?"left":"right"):(v=f,y=h==="end"?"top":"bottom");const b=g-u.top-u.bottom,w=x-u.left-u.right,_=lp(g-u[y],b),j=lp(x-u[v],w),S=!t.middlewareData.shift;let C=_,A=j;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(A=w),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(C=b),S&&!h){const F=td(u.left,0),O=td(u.right,0),I=td(u.top,0),T=td(u.bottom,0);m?A=x-2*(F!==0||O!==0?F+O:td(u.left,u.right)):C=g-2*(I!==0||T!==0?I+T:td(u.top,u.bottom))}await c({...t,availableWidth:A,availableHeight:C});const P=await i.getDimensions(l.floating);return x!==P.width||g!==P.height?{reset:{rects:!0}}:{}}}};function HC(){return typeof window<"u"}function K0(e){return rX(e)?(e.nodeName||"").toLowerCase():"#document"}function md(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Lf(e){var t;return(t=(rX(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function rX(e){return HC()?e instanceof Node||e instanceof md(e).Node:!1}function qu(e){return HC()?e instanceof Element||e instanceof md(e).Element:!1}function Mf(e){return HC()?e instanceof HTMLElement||e instanceof md(e).HTMLElement:!1}function O6(e){return!HC()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof md(e).ShadowRoot}const yxe=new Set(["inline","contents"]);function J1(e){const{overflow:t,overflowX:r,overflowY:n,display:s}=zu(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!yxe.has(s)}const bxe=new Set(["table","td","th"]);function wxe(e){return bxe.has(K0(e))}const _xe=[":popover-open",":modal"];function GC(e){return _xe.some(t=>{try{return e.matches(t)}catch{return!1}})}const jxe=["transform","translate","scale","rotate","perspective"],Nxe=["transform","translate","scale","rotate","perspective","filter"],Sxe=["paint","layout","strict","content"];function ED(e){const t=kD(),r=qu(e)?zu(e):e;return jxe.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||Nxe.some(n=>(r.willChange||"").includes(n))||Sxe.some(n=>(r.contain||"").includes(n))}function Cxe(e){let t=cp(e);for(;Mf(t)&&!a0(t);){if(ED(t))return t;if(GC(t))return null;t=cp(t)}return null}function kD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Axe=new Set(["html","body","#document"]);function a0(e){return Axe.has(K0(e))}function zu(e){return md(e).getComputedStyle(e)}function KC(e){return qu(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function cp(e){if(K0(e)==="html")return e;const t=e.assignedSlot||e.parentNode||O6(e)&&e.host||Lf(e);return O6(t)?t.host:t}function nX(e){const t=cp(e);return a0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Mf(t)&&J1(t)?t:nX(t)}function Dw(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const s=nX(e),o=s===((n=e.ownerDocument)==null?void 0:n.body),i=md(s);if(o){const l=oO(i);return t.concat(i,i.visualViewport||[],J1(s)?s:[],l&&r?Dw(l):[])}return t.concat(s,Dw(s,[],r))}function oO(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function aX(e){const t=zu(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const s=Mf(e),o=s?e.offsetWidth:r,i=s?e.offsetHeight:n,l=jN(r)!==o||jN(n)!==i;return l&&(r=o,n=i),{width:r,height:n,$:l}}function ID(e){return qu(e)?e:e.contextElement}function Ov(e){const t=ID(e);if(!Mf(t))return Af(1);const r=t.getBoundingClientRect(),{width:n,height:s,$:o}=aX(t);let i=(o?jN(r.width):r.width)/n,l=(o?jN(r.height):r.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!l||!Number.isFinite(l))&&(l=1),{x:i,y:l}}const Pxe=Af(0);function sX(e){const t=md(e);return!kD()||!t.visualViewport?Pxe:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Exe(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==md(e)?!1:t}function Ug(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const s=e.getBoundingClientRect(),o=ID(e);let i=Af(1);t&&(n?qu(n)&&(i=Ov(n)):i=Ov(e));const l=Exe(o,r,n)?sX(o):Af(0);let c=(s.left+l.x)/i.x,d=(s.top+l.y)/i.y,u=s.width/i.x,f=s.height/i.y;if(o){const h=md(o),m=n&&qu(n)?md(n):n;let x=h,g=oO(x);for(;g&&n&&m!==x;){const y=Ov(g),v=g.getBoundingClientRect(),b=zu(g),w=v.left+(g.clientLeft+parseFloat(b.paddingLeft))*y.x,_=v.top+(g.clientTop+parseFloat(b.paddingTop))*y.y;c*=y.x,d*=y.y,u*=y.x,f*=y.y,c+=w,d+=_,x=md(g),g=oO(x)}}return SN({width:u,height:f,x:c,y:d})}function OD(e,t){const r=KC(e).scrollLeft;return t?t.left+r:Ug(Lf(e)).left+r}function oX(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-(r?0:OD(e,n)),o=n.top+t.scrollTop;return{x:s,y:o}}function kxe(e){let{elements:t,rect:r,offsetParent:n,strategy:s}=e;const o=s==="fixed",i=Lf(n),l=t?GC(t.floating):!1;if(n===i||l&&o)return r;let c={scrollLeft:0,scrollTop:0},d=Af(1);const u=Af(0),f=Mf(n);if((f||!f&&!o)&&((K0(n)!=="body"||J1(i))&&(c=KC(n)),Mf(n))){const m=Ug(n);d=Ov(n),u.x=m.x+n.clientLeft,u.y=m.y+n.clientTop}const h=i&&!f&&!o?oX(i,c,!0):Af(0);return{width:r.width*d.x,height:r.height*d.y,x:r.x*d.x-c.scrollLeft*d.x+u.x+h.x,y:r.y*d.y-c.scrollTop*d.y+u.y+h.y}}function Ixe(e){return Array.from(e.getClientRects())}function Oxe(e){const t=Lf(e),r=KC(e),n=e.ownerDocument.body,s=td(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),o=td(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+OD(e);const l=-r.scrollTop;return zu(n).direction==="rtl"&&(i+=td(t.clientWidth,n.clientWidth)-s),{width:s,height:o,x:i,y:l}}function Txe(e,t){const r=md(e),n=Lf(e),s=r.visualViewport;let o=n.clientWidth,i=n.clientHeight,l=0,c=0;if(s){o=s.width,i=s.height;const d=kD();(!d||d&&t==="fixed")&&(l=s.offsetLeft,c=s.offsetTop)}return{width:o,height:i,x:l,y:c}}const Dxe=new Set(["absolute","fixed"]);function Mxe(e,t){const r=Ug(e,!0,t==="fixed"),n=r.top+e.clientTop,s=r.left+e.clientLeft,o=Mf(e)?Ov(e):Af(1),i=e.clientWidth*o.x,l=e.clientHeight*o.y,c=s*o.x,d=n*o.y;return{width:i,height:l,x:c,y:d}}function T6(e,t,r){let n;if(t==="viewport")n=Txe(e,r);else if(t==="document")n=Oxe(Lf(e));else if(qu(t))n=Mxe(t,r);else{const s=sX(e);n={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return SN(n)}function iX(e,t){const r=cp(e);return r===t||!qu(r)||a0(r)?!1:zu(r).position==="fixed"||iX(r,t)}function Rxe(e,t){const r=t.get(e);if(r)return r;let n=Dw(e,[],!1).filter(l=>qu(l)&&K0(l)!=="body"),s=null;const o=zu(e).position==="fixed";let i=o?cp(e):e;for(;qu(i)&&!a0(i);){const l=zu(i),c=ED(i);!c&&l.position==="fixed"&&(s=null),(o?!c&&!s:!c&&l.position==="static"&&!!s&&Dxe.has(s.position)||J1(i)&&!c&&iX(e,i))?n=n.filter(u=>u!==i):s=l,i=cp(i)}return t.set(e,n),n}function Fxe(e){let{element:t,boundary:r,rootBoundary:n,strategy:s}=e;const i=[...r==="clippingAncestors"?GC(t)?[]:Rxe(t,this._c):[].concat(r),n],l=i[0],c=i.reduce((d,u)=>{const f=T6(t,u,s);return d.top=td(f.top,d.top),d.right=lp(f.right,d.right),d.bottom=lp(f.bottom,d.bottom),d.left=td(f.left,d.left),d},T6(t,l,s));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Lxe(e){const{width:t,height:r}=aX(e);return{width:t,height:r}}function $xe(e,t,r){const n=Mf(t),s=Lf(t),o=r==="fixed",i=Ug(e,!0,o,t);let l={scrollLeft:0,scrollTop:0};const c=Af(0);function d(){c.x=OD(s)}if(n||!n&&!o)if((K0(t)!=="body"||J1(s))&&(l=KC(t)),n){const m=Ug(t,!0,o,t);c.x=m.x+t.clientLeft,c.y=m.y+t.clientTop}else s&&d();o&&!n&&s&&d();const u=s&&!n&&!o?oX(s,l):Af(0),f=i.left+l.scrollLeft-c.x-u.x,h=i.top+l.scrollTop-c.y-u.y;return{x:f,y:h,width:i.width,height:i.height}}function UP(e){return zu(e).position==="static"}function D6(e,t){if(!Mf(e)||zu(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Lf(e)===r&&(r=r.ownerDocument.body),r}function lX(e,t){const r=md(e);if(GC(e))return r;if(!Mf(e)){let s=cp(e);for(;s&&!a0(s);){if(qu(s)&&!UP(s))return s;s=cp(s)}return r}let n=D6(e,t);for(;n&&wxe(n)&&UP(n);)n=D6(n,t);return n&&a0(n)&&UP(n)&&!ED(n)?r:n||Cxe(e)||r}const Bxe=async function(e){const t=this.getOffsetParent||lX,r=this.getDimensions,n=await r(e.floating);return{reference:$xe(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function qxe(e){return zu(e).direction==="rtl"}const zxe={convertOffsetParentRelativeRectToViewportRelativeRect:kxe,getDocumentElement:Lf,getClippingRect:Fxe,getOffsetParent:lX,getElementRects:Bxe,getClientRects:Ixe,getDimensions:Lxe,getScale:Ov,isElement:qu,isRTL:qxe};function cX(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Uxe(e,t){let r=null,n;const s=Lf(e);function o(){var l;clearTimeout(n),(l=r)==null||l.disconnect(),r=null}function i(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),o();const d=e.getBoundingClientRect(),{left:u,top:f,width:h,height:m}=d;if(l||t(),!h||!m)return;const x=m_(f),g=m_(s.clientWidth-(u+h)),y=m_(s.clientHeight-(f+m)),v=m_(u),w={rootMargin:-x+"px "+-g+"px "+-y+"px "+-v+"px",threshold:td(0,lp(1,c))||1};let _=!0;function j(S){const C=S[0].intersectionRatio;if(C!==c){if(!_)return i();C?i(!1,C):n=setTimeout(()=>{i(!1,1e-7)},1e3)}C===1&&!cX(d,e.getBoundingClientRect())&&i(),_=!1}try{r=new IntersectionObserver(j,{...w,root:s.ownerDocument})}catch{r=new IntersectionObserver(j,w)}r.observe(e)}return i(!0),o}function Vxe(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=n,d=ID(e),u=s||o?[...d?Dw(d):[],...Dw(t)]:[];u.forEach(v=>{s&&v.addEventListener("scroll",r,{passive:!0}),o&&v.addEventListener("resize",r)});const f=d&&l?Uxe(d,r):null;let h=-1,m=null;i&&(m=new ResizeObserver(v=>{let[b]=v;b&&b.target===d&&m&&(m.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var w;(w=m)==null||w.observe(t)})),r()}),d&&!c&&m.observe(d),m.observe(t));let x,g=c?Ug(e):null;c&&y();function y(){const v=Ug(e);g&&!cX(g,v)&&r(),g=v,x=requestAnimationFrame(y)}return r(),()=>{var v;u.forEach(b=>{s&&b.removeEventListener("scroll",r),o&&b.removeEventListener("resize",r)}),f?.(),(v=m)==null||v.disconnect(),m=null,c&&cancelAnimationFrame(x)}}const Wxe=pxe,Hxe=gxe,Gxe=fxe,Kxe=vxe,Xxe=mxe,M6=uxe,Yxe=xxe,Jxe=(e,t,r)=>{const n=new Map,s={platform:zxe,...r},o={...s.platform,_c:n};return dxe(e,t,{...s,platform:o})};var Qxe=typeof document<"u",Zxe=function(){},Sj=Qxe?p.useLayoutEffect:Zxe;function CN(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,s;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!CN(e[n],t[n]))return!1;return!0}if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,s[n]))return!1;for(n=r;n--!==0;){const o=s[n];if(!(o==="_owner"&&e.$$typeof)&&!CN(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function dX(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function R6(e,t){const r=dX(e);return Math.round(t*r)/r}function VP(e){const t=p.useRef(e);return Sj(()=>{t.current=e}),t}function eve(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:i}={},transform:l=!0,whileElementsMounted:c,open:d}=e,[u,f]=p.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[h,m]=p.useState(n);CN(h,n)||m(n);const[x,g]=p.useState(null),[y,v]=p.useState(null),b=p.useCallback(L=>{L!==S.current&&(S.current=L,g(L))},[]),w=p.useCallback(L=>{L!==C.current&&(C.current=L,v(L))},[]),_=o||x,j=i||y,S=p.useRef(null),C=p.useRef(null),A=p.useRef(u),P=c!=null,F=VP(c),O=VP(s),I=VP(d),T=p.useCallback(()=>{if(!S.current||!C.current)return;const L={placement:t,strategy:r,middleware:h};O.current&&(L.platform=O.current),Jxe(S.current,C.current,L).then(W=>{const ge={...W,isPositioned:I.current!==!1};k.current&&!CN(A.current,ge)&&(A.current=ge,Rm.flushSync(()=>{f(ge)}))})},[h,t,r,O,I]);Sj(()=>{d===!1&&A.current.isPositioned&&(A.current.isPositioned=!1,f(L=>({...L,isPositioned:!1})))},[d]);const k=p.useRef(!1);Sj(()=>(k.current=!0,()=>{k.current=!1}),[]),Sj(()=>{if(_&&(S.current=_),j&&(C.current=j),_&&j){if(F.current)return F.current(_,j,T);T()}},[_,j,T,F,P]);const B=p.useMemo(()=>({reference:S,floating:C,setReference:b,setFloating:w}),[b,w]),z=p.useMemo(()=>({reference:_,floating:j}),[_,j]),U=p.useMemo(()=>{const L={position:r,left:0,top:0};if(!z.floating)return L;const W=R6(z.floating,u.x),ge=R6(z.floating,u.y);return l?{...L,transform:"translate("+W+"px, "+ge+"px)",...dX(z.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:W,top:ge}},[r,l,z.floating,u.x,u.y]);return p.useMemo(()=>({...u,update:T,refs:B,elements:z,floatingStyles:U}),[u,T,B,z,U])}const tve=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:s}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?M6({element:n.current,padding:s}).fn(r):{}:n?M6({element:n,padding:s}).fn(r):{}}}},rve=(e,t)=>({...Wxe(e),options:[e,t]}),nve=(e,t)=>({...Hxe(e),options:[e,t]}),ave=(e,t)=>({...Yxe(e),options:[e,t]}),sve=(e,t)=>({...Gxe(e),options:[e,t]}),ove=(e,t)=>({...Kxe(e),options:[e,t]}),ive=(e,t)=>({...Xxe(e),options:[e,t]}),lve=(e,t)=>({...tve(e),options:[e,t]});var cve="Arrow",uX=p.forwardRef((e,t)=>{const{children:r,width:n=10,height:s=5,...o}=e;return a.jsx(ka.svg,{...o,ref:t,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:a.jsx("polygon",{points:"0,0 30,0 15,10"})})});uX.displayName=cve;var dve=uX;function fX(e){const[t,r]=p.useState(void 0);return ml(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,l;if("borderBoxSize"in o){const c=o.borderBoxSize,d=Array.isArray(c)?c[0]:c;i=d.inlineSize,l=d.blockSize}else i=e.offsetWidth,l=e.offsetHeight;r({width:i,height:l})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var TD="Popper",[mX,X0]=cu(TD),[uve,hX]=mX(TD),pX=e=>{const{__scopePopper:t,children:r}=e,[n,s]=p.useState(null);return a.jsx(uve,{scope:t,anchor:n,onAnchorChange:s,children:r})};pX.displayName=TD;var gX="PopperAnchor",xX=p.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...s}=e,o=hX(gX,r),i=p.useRef(null),l=ms(t,i),c=p.useRef(null);return p.useEffect(()=>{const d=c.current;c.current=n?.current||i.current,d!==c.current&&o.onAnchorChange(c.current)}),n?null:a.jsx(ka.div,{...s,ref:l})});xX.displayName=gX;var DD="PopperContent",[fve,mve]=mX(DD),vX=p.forwardRef((e,t)=>{const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:o="center",alignOffset:i=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:d=[],collisionPadding:u=0,sticky:f="partial",hideWhenDetached:h=!1,updatePositionStrategy:m="optimized",onPlaced:x,...g}=e,y=hX(DD,r),[v,b]=p.useState(null),w=ms(t,G=>b(G)),[_,j]=p.useState(null),S=fX(_),C=S?.width??0,A=S?.height??0,P=n+(o!=="center"?"-"+o:""),F=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},O=Array.isArray(d)?d:[d],I=O.length>0,T={padding:F,boundary:O.filter(pve),altBoundary:I},{refs:k,floatingStyles:B,placement:z,isPositioned:U,middlewareData:L}=eve({strategy:"fixed",placement:P,whileElementsMounted:(...G)=>Vxe(...G,{animationFrame:m==="always"}),elements:{reference:y.anchor},middleware:[rve({mainAxis:s+A,alignmentAxis:i}),c&&nve({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?ave():void 0,...T}),c&&sve({...T}),ove({...T,apply:({elements:G,rects:ue,availableWidth:ve,availableHeight:ae})=>{const{width:oe,height:me}=ue.reference,De=G.floating.style;De.setProperty("--radix-popper-available-width",`${ve}px`),De.setProperty("--radix-popper-available-height",`${ae}px`),De.setProperty("--radix-popper-anchor-width",`${oe}px`),De.setProperty("--radix-popper-anchor-height",`${me}px`)}}),_&&lve({element:_,padding:l}),gve({arrowWidth:C,arrowHeight:A}),h&&ive({strategy:"referenceHidden",...T})]}),[W,ge]=wX(z),Ae=Dc(x);ml(()=>{U&&Ae?.()},[U,Ae]);const V=L.arrow?.x,$=L.arrow?.y,Y=L.arrow?.centerOffset!==0,[he,J]=p.useState();return ml(()=>{v&&J(window.getComputedStyle(v).zIndex)},[v]),a.jsx("div",{ref:k.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:U?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:he,"--radix-popper-transform-origin":[L.transformOrigin?.x,L.transformOrigin?.y].join(" "),...L.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:a.jsx(fve,{scope:r,placedSide:W,onArrowChange:j,arrowX:V,arrowY:$,shouldHideArrow:Y,children:a.jsx(ka.div,{"data-side":W,"data-align":ge,...g,ref:w,style:{...g.style,animation:U?void 0:"none"}})})})});vX.displayName=DD;var yX="PopperArrow",hve={top:"bottom",right:"left",bottom:"top",left:"right"},bX=p.forwardRef(function(t,r){const{__scopePopper:n,...s}=t,o=mve(yX,n),i=hve[o.placedSide];return a.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:a.jsx(dve,{...s,ref:r,style:{...s.style,display:"block"}})})});bX.displayName=yX;function pve(e){return e!==null}var gve=e=>({name:"transformOrigin",options:e,fn(t){const{placement:r,rects:n,middlewareData:s}=t,i=s.arrow?.centerOffset!==0,l=i?0:e.arrowWidth,c=i?0:e.arrowHeight,[d,u]=wX(r),f={start:"0%",center:"50%",end:"100%"}[u],h=(s.arrow?.x??0)+l/2,m=(s.arrow?.y??0)+c/2;let x="",g="";return d==="bottom"?(x=i?f:`${h}px`,g=`${-c}px`):d==="top"?(x=i?f:`${h}px`,g=`${n.floating.height+c}px`):d==="right"?(x=`${-c}px`,g=i?f:`${m}px`):d==="left"&&(x=`${n.floating.width+c}px`,g=i?f:`${m}px`),{data:{x,y:g}}}});function wX(e){const[t,r="center"]=e.split("-");return[t,r]}var MD=pX,XC=xX,RD=vX,FD=bX,xve="Portal",Y0=p.forwardRef((e,t)=>{const{container:r,...n}=e,[s,o]=p.useState(!1);ml(()=>o(!0),[]);const i=r||s&&globalThis?.document?.body;return i?U4.createPortal(a.jsx(ka.div,{...n,ref:t}),i):null});Y0.displayName=xve;function vve(e,t){return p.useReducer((r,n)=>t[r][n]??r,e)}var jd=e=>{const{present:t,children:r}=e,n=yve(t),s=typeof r=="function"?r({present:n.isPresent}):p.Children.only(r),o=ms(n.ref,bve(s));return typeof r=="function"||n.isPresent?p.cloneElement(s,{ref:o}):null};jd.displayName="Presence";function yve(e){const[t,r]=p.useState(),n=p.useRef(null),s=p.useRef(e),o=p.useRef("none"),i=e?"mounted":"unmounted",[l,c]=vve(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const d=h_(n.current);o.current=l==="mounted"?d:"none"},[l]),ml(()=>{const d=n.current,u=s.current;if(u!==e){const h=o.current,m=h_(d);e?c("MOUNT"):m==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&h!==m?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,c]),ml(()=>{if(t){let d;const u=t.ownerDocument.defaultView??window,f=m=>{const g=h_(n.current).includes(CSS.escape(m.animationName));if(m.target===t&&g&&(c("ANIMATION_END"),!s.current)){const y=t.style.animationFillMode;t.style.animationFillMode="forwards",d=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=y)})}},h=m=>{m.target===t&&(o.current=h_(n.current))};return t.addEventListener("animationstart",h),t.addEventListener("animationcancel",f),t.addEventListener("animationend",f),()=>{u.clearTimeout(d),t.removeEventListener("animationstart",h),t.removeEventListener("animationcancel",f),t.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:p.useCallback(d=>{n.current=d?getComputedStyle(d):null,r(d)},[])}}function h_(e){return e?.animationName||"none"}function bve(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var wve=Q3[" useInsertionEffect ".trim().toString()]||ml;function km({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[s,o,i]=_ve({defaultProp:t,onChange:r}),l=e!==void 0,c=l?e:s;{const u=p.useRef(e!==void 0);p.useEffect(()=>{const f=u.current;f!==l&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,n])}const d=p.useCallback(u=>{if(l){const f=jve(u)?u(e):u;f!==e&&i.current?.(f)}else o(u)},[l,e,o,i]);return[c,d]}function _ve({defaultProp:e,onChange:t}){const[r,n]=p.useState(e),s=p.useRef(r),o=p.useRef(t);return wve(()=>{o.current=t},[t]),p.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,n,o]}function jve(e){return typeof e=="function"}var Nve=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Cx=new WeakMap,p_=new WeakMap,g_={},WP=0,_X=function(e){return e&&(e.host||_X(e.parentNode))},Sve=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=_X(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Cve=function(e,t,r,n){var s=Sve(t,Array.isArray(e)?e:[e]);g_[r]||(g_[r]=new WeakMap);var o=g_[r],i=[],l=new Set,c=new Set(s),d=function(f){!f||l.has(f)||(l.add(f),d(f.parentNode))};s.forEach(d);var u=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(h){if(l.has(h))u(h);else try{var m=h.getAttribute(n),x=m!==null&&m!=="false",g=(Cx.get(h)||0)+1,y=(o.get(h)||0)+1;Cx.set(h,g),o.set(h,y),i.push(h),g===1&&x&&p_.set(h,!0),y===1&&h.setAttribute(r,"true"),x||h.setAttribute(n,"true")}catch(v){console.error("aria-hidden: cannot operate on ",h,v)}})};return u(t),l.clear(),WP++,function(){i.forEach(function(f){var h=Cx.get(f)-1,m=o.get(f)-1;Cx.set(f,h),o.set(f,m),h||(p_.has(f)||f.removeAttribute(n),p_.delete(f)),m||f.removeAttribute(r)}),WP--,WP||(Cx=new WeakMap,Cx=new WeakMap,p_=new WeakMap,g_={})}},YC=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),s=t||Nve(e);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live], script"))),Cve(n,s,r,"aria-hidden")):function(){return null}},mf=function(){return mf=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},mf.apply(this,arguments)};function jX(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Ave(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}var Cj="right-scroll-bar-position",Aj="width-before-scroll-bar",Pve="with-scroll-bars-hidden",Eve="--removed-body-scroll-bar-size";function HP(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function kve(e,t){var r=p.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var s=r.value;s!==n&&(r.value=n,r.callback(n,s))}}}})[0];return r.callback=t,r.facade}var Ive=typeof window<"u"?p.useLayoutEffect:p.useEffect,F6=new WeakMap;function Ove(e,t){var r=kve(t||null,function(n){return e.forEach(function(s){return HP(s,n)})});return Ive(function(){var n=F6.get(r);if(n){var s=new Set(n),o=new Set(e),i=r.current;s.forEach(function(l){o.has(l)||HP(l,null)}),o.forEach(function(l){s.has(l)||HP(l,i)})}F6.set(r,e)},[e]),r}function Tve(e){return e}function Dve(e,t){t===void 0&&(t=Tve);var r=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(o){var i=t(o,n);return r.push(i),function(){r=r.filter(function(l){return l!==i})}},assignSyncMedium:function(o){for(n=!0;r.length;){var i=r;r=[],i.forEach(o)}r={push:function(l){return o(l)},filter:function(){return r}}},assignMedium:function(o){n=!0;var i=[];if(r.length){var l=r;r=[],l.forEach(o),i=r}var c=function(){var u=i;i=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),r={push:function(u){i.push(u),d()},filter:function(u){return i=i.filter(u),r}}}};return s}function Mve(e){e===void 0&&(e={});var t=Dve(null);return t.options=mf({async:!0,ssr:!1},e),t}var NX=function(e){var t=e.sideCar,r=jX(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return p.createElement(n,mf({},r))};NX.isSideCarExport=!0;function Rve(e,t){return e.useMedium(t),NX}var SX=Mve(),GP=function(){},JC=p.forwardRef(function(e,t){var r=p.useRef(null),n=p.useState({onScrollCapture:GP,onWheelCapture:GP,onTouchMoveCapture:GP}),s=n[0],o=n[1],i=e.forwardProps,l=e.children,c=e.className,d=e.removeScrollBar,u=e.enabled,f=e.shards,h=e.sideCar,m=e.noRelative,x=e.noIsolation,g=e.inert,y=e.allowPinchZoom,v=e.as,b=v===void 0?"div":v,w=e.gapMode,_=jX(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),j=h,S=Ove([r,t]),C=mf(mf({},_),s);return p.createElement(p.Fragment,null,u&&p.createElement(j,{sideCar:SX,removeScrollBar:d,shards:f,noRelative:m,noIsolation:x,inert:g,setCallbacks:o,allowPinchZoom:!!y,lockRef:r,gapMode:w}),i?p.cloneElement(p.Children.only(l),mf(mf({},C),{ref:S})):p.createElement(b,mf({},C,{className:c,ref:S}),l))});JC.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};JC.classNames={fullWidth:Aj,zeroRight:Cj};var L6,Fve=function(){if(L6)return L6;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Lve(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Fve();return t&&e.setAttribute("nonce",t),e}function $ve(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Bve(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var qve=function(){var e=0,t=null;return{add:function(r){e==0&&(t=Lve())&&($ve(t,r),Bve(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},zve=function(){var e=qve();return function(t,r){p.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},CX=function(){var e=zve(),t=function(r){var n=r.styles,s=r.dynamic;return e(n,s),null};return t},Uve={left:0,top:0,right:0,gap:0},KP=function(e){return parseInt(e||"",10)||0},Vve=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[KP(r),KP(n),KP(s)]},Wve=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Uve;var t=Vve(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},Hve=CX(),Tv="data-scroll-locked",Gve=function(e,t,r,n){var s=e.left,o=e.top,i=e.right,l=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(Pve,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(l,"px ").concat(n,`;
  }
  body[`).concat(Tv,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(l,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Cj,` {
    right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(Aj,` {
    margin-right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(Cj," .").concat(Cj,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Aj," .").concat(Aj,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Tv,`] {
    `).concat(Eve,": ").concat(l,`px;
  }
`)},$6=function(){var e=parseInt(document.body.getAttribute(Tv)||"0",10);return isFinite(e)?e:0},Kve=function(){p.useEffect(function(){return document.body.setAttribute(Tv,($6()+1).toString()),function(){var e=$6()-1;e<=0?document.body.removeAttribute(Tv):document.body.setAttribute(Tv,e.toString())}},[])},Xve=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,s=n===void 0?"margin":n;Kve();var o=p.useMemo(function(){return Wve(s)},[s]);return p.createElement(Hve,{styles:Gve(o,!t,s,r?"":"!important")})},iO=!1;if(typeof window<"u")try{var x_=Object.defineProperty({},"passive",{get:function(){return iO=!0,!0}});window.addEventListener("test",x_,x_),window.removeEventListener("test",x_,x_)}catch{iO=!1}var Ax=iO?{passive:!1}:!1,Yve=function(e){return e.tagName==="TEXTAREA"},AX=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!Yve(e)&&r[t]==="visible")},Jve=function(e){return AX(e,"overflowY")},Qve=function(e){return AX(e,"overflowX")},B6=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=PX(e,n);if(s){var o=EX(e,n),i=o[1],l=o[2];if(i>l)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},Zve=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},e0e=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},PX=function(e,t){return e==="v"?Jve(t):Qve(t)},EX=function(e,t){return e==="v"?Zve(t):e0e(t)},t0e=function(e,t){return e==="h"&&t==="rtl"?-1:1},r0e=function(e,t,r,n,s){var o=t0e(e,window.getComputedStyle(t).direction),i=o*n,l=r.target,c=t.contains(l),d=!1,u=i>0,f=0,h=0;do{if(!l)break;var m=EX(e,l),x=m[0],g=m[1],y=m[2],v=g-y-o*x;(x||v)&&PX(e,l)&&(f+=v,h+=x);var b=l.parentNode;l=b&&b.nodeType===Node.DOCUMENT_FRAGMENT_NODE?b.host:b}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return(u&&(s&&Math.abs(f)<1||!s&&i>f)||!u&&(s&&Math.abs(h)<1||!s&&-i>h))&&(d=!0),d},v_=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},q6=function(e){return[e.deltaX,e.deltaY]},z6=function(e){return e&&"current"in e?e.current:e},n0e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},a0e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},s0e=0,Px=[];function o0e(e){var t=p.useRef([]),r=p.useRef([0,0]),n=p.useRef(),s=p.useState(s0e++)[0],o=p.useState(CX)[0],i=p.useRef(e);p.useEffect(function(){i.current=e},[e]),p.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var g=Ave([e.lockRef.current],(e.shards||[]).map(z6),!0).filter(Boolean);return g.forEach(function(y){return y.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),g.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var l=p.useCallback(function(g,y){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!i.current.allowPinchZoom;var v=v_(g),b=r.current,w="deltaX"in g?g.deltaX:b[0]-v[0],_="deltaY"in g?g.deltaY:b[1]-v[1],j,S=g.target,C=Math.abs(w)>Math.abs(_)?"h":"v";if("touches"in g&&C==="h"&&S.type==="range")return!1;var A=B6(C,S);if(!A)return!0;if(A?j=C:(j=C==="v"?"h":"v",A=B6(C,S)),!A)return!1;if(!n.current&&"changedTouches"in g&&(w||_)&&(n.current=j),!j)return!0;var P=n.current||j;return r0e(P,y,g,P==="h"?w:_,!0)},[]),c=p.useCallback(function(g){var y=g;if(!(!Px.length||Px[Px.length-1]!==o)){var v="deltaY"in y?q6(y):v_(y),b=t.current.filter(function(j){return j.name===y.type&&(j.target===y.target||y.target===j.shadowParent)&&n0e(j.delta,v)})[0];if(b&&b.should){y.cancelable&&y.preventDefault();return}if(!b){var w=(i.current.shards||[]).map(z6).filter(Boolean).filter(function(j){return j.contains(y.target)}),_=w.length>0?l(y,w[0]):!i.current.noIsolation;_&&y.cancelable&&y.preventDefault()}}},[]),d=p.useCallback(function(g,y,v,b){var w={name:g,delta:y,target:v,should:b,shadowParent:i0e(v)};t.current.push(w),setTimeout(function(){t.current=t.current.filter(function(_){return _!==w})},1)},[]),u=p.useCallback(function(g){r.current=v_(g),n.current=void 0},[]),f=p.useCallback(function(g){d(g.type,q6(g),g.target,l(g,e.lockRef.current))},[]),h=p.useCallback(function(g){d(g.type,v_(g),g.target,l(g,e.lockRef.current))},[]);p.useEffect(function(){return Px.push(o),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:h}),document.addEventListener("wheel",c,Ax),document.addEventListener("touchmove",c,Ax),document.addEventListener("touchstart",u,Ax),function(){Px=Px.filter(function(g){return g!==o}),document.removeEventListener("wheel",c,Ax),document.removeEventListener("touchmove",c,Ax),document.removeEventListener("touchstart",u,Ax)}},[]);var m=e.removeScrollBar,x=e.inert;return p.createElement(p.Fragment,null,x?p.createElement(o,{styles:a0e(s)}):null,m?p.createElement(Xve,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function i0e(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const l0e=Rve(SX,o0e);var kX=p.forwardRef(function(e,t){return p.createElement(JC,mf({},e,{ref:t,sideCar:l0e}))});kX.classNames=JC.classNames;const QC=kX;var ZC="Popover",[IX,act]=cu(ZC,[X0]),Q1=X0(),[c0e,bp]=IX(ZC),OX=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:i=!1}=e,l=Q1(t),c=p.useRef(null),[d,u]=p.useState(!1),[f,h]=km({prop:n,defaultProp:s??!1,onChange:o,caller:ZC});return a.jsx(MD,{...l,children:a.jsx(c0e,{scope:t,contentId:Fu(),triggerRef:c,open:f,onOpenChange:h,onOpenToggle:p.useCallback(()=>h(m=>!m),[h]),hasCustomAnchor:d,onCustomAnchorAdd:p.useCallback(()=>u(!0),[]),onCustomAnchorRemove:p.useCallback(()=>u(!1),[]),modal:i,children:r})})};OX.displayName=ZC;var TX="PopoverAnchor",d0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=bp(TX,r),o=Q1(r),{onCustomAnchorAdd:i,onCustomAnchorRemove:l}=s;return p.useEffect(()=>(i(),()=>l()),[i,l]),a.jsx(XC,{...o,...n,ref:t})});d0e.displayName=TX;var DX="PopoverTrigger",MX=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=bp(DX,r),o=Q1(r),i=ms(t,s.triggerRef),l=a.jsx(ka.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":BX(s.open),...n,ref:i,onClick:Bn(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?l:a.jsx(XC,{asChild:!0,...o,children:l})});MX.displayName=DX;var LD="PopoverPortal",[u0e,f0e]=IX(LD,{forceMount:void 0}),RX=e=>{const{__scopePopover:t,forceMount:r,children:n,container:s}=e,o=bp(LD,t);return a.jsx(u0e,{scope:t,forceMount:r,children:a.jsx(jd,{present:r||o.open,children:a.jsx(Y0,{asChild:!0,container:s,children:n})})})};RX.displayName=LD;var s0="PopoverContent",FX=p.forwardRef((e,t)=>{const r=f0e(s0,e.__scopePopover),{forceMount:n=r.forceMount,...s}=e,o=bp(s0,e.__scopePopover);return a.jsx(jd,{present:n||o.open,children:o.modal?a.jsx(h0e,{...s,ref:t}):a.jsx(p0e,{...s,ref:t})})});FX.displayName=s0;var m0e=ip("PopoverContent.RemoveScroll"),h0e=p.forwardRef((e,t)=>{const r=bp(s0,e.__scopePopover),n=p.useRef(null),s=ms(t,n),o=p.useRef(!1);return p.useEffect(()=>{const i=n.current;if(i)return YC(i)},[]),a.jsx(QC,{as:m0e,allowPinchZoom:!0,children:a.jsx(LX,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Bn(e.onCloseAutoFocus,i=>{i.preventDefault(),o.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Bn(e.onPointerDownOutside,i=>{const l=i.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;o.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:Bn(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),p0e=p.forwardRef((e,t)=>{const r=bp(s0,e.__scopePopover),n=p.useRef(!1),s=p.useRef(!1);return a.jsx(LX,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{e.onCloseAutoFocus?.(o),o.defaultPrevented||(n.current||r.triggerRef.current?.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{e.onInteractOutside?.(o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;r.triggerRef.current?.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),LX=p.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...f}=e,h=bp(s0,r),m=Q1(r);return WC(),a.jsx(Y1,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:a.jsx(H0,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:a.jsx(RD,{"data-state":BX(h.open),role:"dialog",id:h.contentId,...m,...f,ref:t,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),$X="PopoverClose",g0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=bp($X,r);return a.jsx(ka.button,{type:"button",...n,ref:t,onClick:Bn(e.onClick,()=>s.onOpenChange(!1))})});g0e.displayName=$X;var x0e="PopoverArrow",v0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Q1(r);return a.jsx(FD,{...s,...n,ref:t})});v0e.displayName=x0e;function BX(e){return e?"open":"closed"}var y0e=OX,b0e=MX,w0e=RX,qX=FX;const ai=y0e,si=b0e,Go=Ee.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},s)=>a.jsx(w0e,{container:document.body,children:a.jsx(qX,{ref:s,align:t,sideOffset:r,className:Sr("z-[9999] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Go.displayName=qX.displayName;var e5="Dialog",[zX,UX]=cu(e5),[_0e,Gu]=zX(e5),VX=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:i=!0}=e,l=p.useRef(null),c=p.useRef(null),[d,u]=km({prop:n,defaultProp:s??!1,onChange:o,caller:e5});return a.jsx(_0e,{scope:t,triggerRef:l,contentRef:c,contentId:Fu(),titleId:Fu(),descriptionId:Fu(),open:d,onOpenChange:u,onOpenToggle:p.useCallback(()=>u(f=>!f),[u]),modal:i,children:r})};VX.displayName=e5;var WX="DialogTrigger",HX=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Gu(WX,r),o=ms(t,s.triggerRef);return a.jsx(ka.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":qD(s.open),...n,ref:o,onClick:Bn(e.onClick,s.onOpenToggle)})});HX.displayName=WX;var $D="DialogPortal",[j0e,GX]=zX($D,{forceMount:void 0}),KX=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:s}=e,o=Gu($D,t);return a.jsx(j0e,{scope:t,forceMount:r,children:p.Children.map(n,i=>a.jsx(jd,{present:r||o.open,children:a.jsx(Y0,{asChild:!0,container:s,children:i})}))})};KX.displayName=$D;var AN="DialogOverlay",XX=p.forwardRef((e,t)=>{const r=GX(AN,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Gu(AN,e.__scopeDialog);return o.modal?a.jsx(jd,{present:n||o.open,children:a.jsx(S0e,{...s,ref:t})}):null});XX.displayName=AN;var N0e=ip("DialogOverlay.RemoveScroll"),S0e=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Gu(AN,r);return a.jsx(QC,{as:N0e,allowPinchZoom:!0,shards:[s.contentRef],children:a.jsx(ka.div,{"data-state":qD(s.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),Vg="DialogContent",YX=p.forwardRef((e,t)=>{const r=GX(Vg,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Gu(Vg,e.__scopeDialog);return a.jsx(jd,{present:n||o.open,children:o.modal?a.jsx(C0e,{...s,ref:t}):a.jsx(A0e,{...s,ref:t})})});YX.displayName=Vg;var C0e=p.forwardRef((e,t)=>{const r=Gu(Vg,e.__scopeDialog),n=p.useRef(null),s=ms(t,r.contentRef,n);return p.useEffect(()=>{const o=n.current;if(o)return YC(o)},[]),a.jsx(JX,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Bn(e.onCloseAutoFocus,o=>{o.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Bn(e.onPointerDownOutside,o=>{const i=o.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&o.preventDefault()}),onFocusOutside:Bn(e.onFocusOutside,o=>o.preventDefault())})}),A0e=p.forwardRef((e,t)=>{const r=Gu(Vg,e.__scopeDialog),n=p.useRef(!1),s=p.useRef(!1);return a.jsx(JX,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{e.onCloseAutoFocus?.(o),o.defaultPrevented||(n.current||r.triggerRef.current?.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{e.onInteractOutside?.(o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;r.triggerRef.current?.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),JX=p.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=e,l=Gu(Vg,r),c=p.useRef(null),d=ms(t,c);return WC(),a.jsxs(a.Fragment,{children:[a.jsx(Y1,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:a.jsx(H0,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":qD(l.open),...i,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),a.jsxs(a.Fragment,{children:[a.jsx(E0e,{titleId:l.titleId}),a.jsx(I0e,{contentRef:c,descriptionId:l.descriptionId})]})]})}),BD="DialogTitle",QX=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Gu(BD,r);return a.jsx(ka.h2,{id:s.titleId,...n,ref:t})});QX.displayName=BD;var ZX="DialogDescription",eY=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Gu(ZX,r);return a.jsx(ka.p,{id:s.descriptionId,...n,ref:t})});eY.displayName=ZX;var tY="DialogClose",rY=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Gu(tY,r);return a.jsx(ka.button,{type:"button",...n,ref:t,onClick:Bn(e.onClick,()=>s.onOpenChange(!1))})});rY.displayName=tY;function qD(e){return e?"open":"closed"}var nY="DialogTitleWarning",[P0e,aY]=Oge(nY,{contentName:Vg,titleName:BD,docsSlug:"dialog"}),E0e=({titleId:e})=>{const t=aY(nY),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return p.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},k0e="DialogDescriptionWarning",I0e=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${aY(k0e).contentName}}.`;return p.useEffect(()=>{const s=e.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},sY=VX,O0e=HX,oY=KX,zD=XX,UD=YX,VD=QX,WD=eY,t5=rY;const In=sY,T0e=oY,Uh=t5,iY=Ee.forwardRef(({className:e,disableAnimations:t,...r},n)=>{const s=typeof window<"u"&&(window.matchMedia?.("(pointer: coarse)")?.matches||window.innerWidth<768),o=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,i=(t??!1)||s||o;return a.jsx(zD,{ref:n,className:Sr("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm",i?"data-[state=open]:animate-none data-[state=closed]:animate-none":"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r})});iY.displayName=zD.displayName;const En=Ee.forwardRef(({className:e,children:t,overlayClassName:r,disableAnimations:n,alignTop:s,...o},i)=>{const l=typeof window<"u"&&(window.matchMedia?.("(pointer: coarse)")?.matches||window.innerWidth<768),c=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,d=(n??!1)||l||c;return a.jsxs(T0e,{children:[a.jsx(iY,{disableAnimations:d,className:r}),a.jsxs(UD,{ref:i,className:Sr("fixed z-50 grid w-full max-w-lg gap-4 border border-border bg-surface p-6 pr-14 shadow-lg duration-200 sm:rounded-lg",s?"left-1/2 top-[10%] -translate-x-1/2":"left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",d?"data-[state=open]:animate-none data-[state=closed]:animate-none":"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...o,children:[t,a.jsxs(t5,{className:"absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-md border border-border bg-surface/90 opacity-80 shadow-sm ring-offset-background transition-all hover:opacity-100 hover:bg-surface focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(lc,{className:"h-5 w-5"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]})});En.displayName=UD.displayName;const Cn=({className:e,...t})=>a.jsx("div",{className:Sr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Cn.displayName="DialogHeader";const Na=({className:e,...t})=>a.jsx("div",{className:Sr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Na.displayName="DialogFooter";const Nn=Ee.forwardRef(({className:e,...t},r)=>a.jsx(VD,{ref:r,className:Sr("text-lg font-semibold leading-none tracking-tight",e),...t}));Nn.displayName=VD.displayName;const Hn=Ee.forwardRef(({className:e,...t},r)=>a.jsx(WD,{ref:r,className:Sr("text-sm text-text-secondary",e),...t}));Hn.displayName=WD.displayName;const D0e=1;let XP=0;function M0e(){return XP=(XP+1)%Number.MAX_VALUE,XP.toString()}const Jl={state:{toasts:[]},listeners:[],getState:()=>Jl.state,setState:e=>{typeof e=="function"?Jl.state=e(Jl.state):Jl.state={...Jl.state,...e},Jl.listeners.forEach(t=>t(Jl.state))},subscribe:e=>(Jl.listeners.push(e),()=>{Jl.listeners=Jl.listeners.filter(t=>t!==e)})},Pj=({...e})=>{const t=M0e(),r=s=>Jl.setState(o=>({...o,toasts:o.toasts.map(i=>i.id===t?{...i,...s}:i)})),n=()=>Jl.setState(s=>({...s,toasts:s.toasts.filter(o=>o.id!==t)}));return Jl.setState(s=>({...s,toasts:[{...e,id:t,dismiss:n},...s.toasts].slice(0,D0e)})),{id:t,dismiss:n,update:r}};function Ss(){const[e,t]=p.useState(Jl.getState());return p.useEffect(()=>Jl.subscribe(n=>{t(n)}),[]),p.useEffect(()=>{const r=[];return e.toasts.forEach(n=>{if(n.duration===1/0)return;const s=setTimeout(()=>{n.dismiss()},n.duration||5e3);r.push(s)}),()=>{r.forEach(n=>clearTimeout(n))}},[e.toasts]),{toast:Pj,toasts:e.toasts}}const R0e="main",F0e={dev:{supabaseUrl:"https://xlbgopcindcsteymtwjp.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsYmdvcGNpbmRjc3RleW10d2pwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MDAwMTQsImV4cCI6MjA4MDI3NjAxNH0.0ydvsFW8j5ZKCyHalAlFWHjjK8QbcDC6mZQzVJ0lSnA"},main:{supabaseUrl:"https://dlfryxtyxqoacuunswuc.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY"}},L0e=Object.freeze(Object.defineProperty({__proto__:null,ACTIVE_TARGET:R0e,TARGETS:F0e},Symbol.toStringTag,{value:"Module"})),$0e=void 0,B0e=void 0,q0e=Object.freeze(Object.defineProperty({__proto__:null,ACTIVE_TARGET:$0e,TARGETS:B0e},Symbol.toStringTag,{value:"Module"})),z0e="modulepreload",U0e=function(e){return"/"+e},U6={},Pf=function(t,r,n){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=U0e(o),o in U6)return;U6[o]=!0;const i=o.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!n)for(let u=s.length-1;u>=0;u--){const f=s[u];if(f.href===o&&(!i||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":z0e,i||(d.as="script",d.crossOrigin=""),d.href=o,document.head.appendChild(d),i)return new Promise((u,f)=>{d.addEventListener("load",u),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})},V0e=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>Pf(()=>Promise.resolve().then(()=>J0),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)};class HD extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class V6 extends HD{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class W6 extends HD{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class H6 extends HD{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var lO;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(lO||(lO={}));var W0e=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class H0e{constructor(t,{headers:r={},customFetch:n,region:s=lO.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=V0e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return W0e(this,arguments,void 0,function*(r,n={}){var s;try{const{headers:o,method:i,body:l,signal:c}=n;let d={},{region:u}=n;u||(u=this.region);const f=new URL(`${this.url}/${r}`);u&&u!=="any"&&(d["x-region"]=u,f.searchParams.set("forceFunctionRegion",u));let h;l&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",h=l):typeof l=="string"?(d["Content-Type"]="text/plain",h=l):typeof FormData<"u"&&l instanceof FormData?h=l:(d["Content-Type"]="application/json",h=JSON.stringify(l)));const m=yield this.fetch(f.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),o),body:h,signal:c}).catch(v=>{throw v.name==="AbortError"?v:new V6(v)}),x=m.headers.get("x-relay-error");if(x&&x==="true")throw new W6(m);if(!m.ok)throw new H6(m);let g=((s=m.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),y;return g==="application/json"?y=yield m.json():g==="application/octet-stream"?y=yield m.blob():g==="text/event-stream"?y=m:g==="multipart/form-data"?y=yield m.formData():y=yield m.text(),{data:y,error:null,response:m}}catch(o){return o instanceof Error&&o.name==="AbortError"?{data:null,error:new V6(o)}:{data:null,error:o,response:o instanceof H6||o instanceof W6?o.context:void 0}}})}}var jc={},GD={},r5={},Z1={},n5={},a5={},G0e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},o0=G0e();const K0e=o0.fetch,lY=o0.fetch.bind(o0),cY=o0.Headers,X0e=o0.Request,Y0e=o0.Response,J0=Object.freeze(Object.defineProperty({__proto__:null,Headers:cY,Request:X0e,Response:Y0e,default:lY,fetch:K0e},Symbol.toStringTag,{value:"Module"})),J0e=_ie(J0);var s5={};Object.defineProperty(s5,"__esModule",{value:!0});let Q0e=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};s5.default=Q0e;var dY=Tl&&Tl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a5,"__esModule",{value:!0});const Z0e=dY(J0e),eye=dY(s5);let tye=class{constructor(t){var r,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(r=t.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=Z0e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,r){return this.headers=new Headers(this.headers),this.headers.set(t,r),this}then(t,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,l,c,d;let u=null,f=null,h=null,m=o.status,x=o.statusText;if(o.ok){if(this.method!=="HEAD"){const b=await o.text();b===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((i=this.headers.get("Accept"))===null||i===void 0)&&i.includes("application/vnd.pgrst.plan+text"))?f=b:f=JSON.parse(b))}const y=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),v=(c=o.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");y&&v&&v.length>1&&(h=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(u={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,m=406,x="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const y=await o.text();try{u=JSON.parse(y),Array.isArray(u)&&o.status===404&&(f=[],u=null,m=200,x="OK")}catch{o.status===404&&y===""?(m=204,x="No Content"):u={message:y}}if(u&&this.isMaybeSingle&&(!((d=u?.details)===null||d===void 0)&&d.includes("0 rows"))&&(u=null,m=200,x="OK"),u&&this.shouldThrowOnError)throw new eye.default(u)}return{error:u,data:f,count:h,status:m,statusText:x}});return this.shouldThrowOnError||(s=s.catch(o=>{var i,l,c;return{error:{message:`${(i=o?.name)!==null&&i!==void 0?i:"FetchError"}: ${o?.message}`,details:`${(l=o?.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=o?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(t,r)}returns(){return this}overrideTypes(){return this}};a5.default=tye;var rye=Tl&&Tl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n5,"__esModule",{value:!0});const nye=rye(a5);let aye=class extends nye.default{select(t){let r=!1;const n=(t??"*").split("").map(s=>/\s/.test(s)&&!r?"":(s==='"'&&(r=!r),s)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:r=!0,nullsFirst:n,foreignTable:s,referencedTable:o=s}={}){const i=o?`${o}.order`:"order",l=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${l?`${l},`:""}${t}.${r?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:r,referencedTable:n=r}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,r,{foreignTable:n,referencedTable:s=n}={}){const o=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(o,`${t}`),this.url.searchParams.set(i,`${r-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:r=!1,settings:n=!1,buffers:s=!1,wal:o=!1,format:i="text"}={}){var l;const c=[t?"analyze":null,r?"verbose":null,n?"settings":null,s?"buffers":null,o?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${d}"; options=${c};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};n5.default=aye;var sye=Tl&&Tl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Z1,"__esModule",{value:!0});const oye=sye(n5);let iye=class extends oye.default{eq(t,r){return this.url.searchParams.append(t,`eq.${r}`),this}neq(t,r){return this.url.searchParams.append(t,`neq.${r}`),this}gt(t,r){return this.url.searchParams.append(t,`gt.${r}`),this}gte(t,r){return this.url.searchParams.append(t,`gte.${r}`),this}lt(t,r){return this.url.searchParams.append(t,`lt.${r}`),this}lte(t,r){return this.url.searchParams.append(t,`lte.${r}`),this}like(t,r){return this.url.searchParams.append(t,`like.${r}`),this}likeAllOf(t,r){return this.url.searchParams.append(t,`like(all).{${r.join(",")}}`),this}likeAnyOf(t,r){return this.url.searchParams.append(t,`like(any).{${r.join(",")}}`),this}ilike(t,r){return this.url.searchParams.append(t,`ilike.${r}`),this}ilikeAllOf(t,r){return this.url.searchParams.append(t,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(t,r){return this.url.searchParams.append(t,`ilike(any).{${r.join(",")}}`),this}is(t,r){return this.url.searchParams.append(t,`is.${r}`),this}in(t,r){const n=Array.from(new Set(r)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cs.{${r.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(r)}`),this}containedBy(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cd.{${r.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(r)}`),this}rangeGt(t,r){return this.url.searchParams.append(t,`sr.${r}`),this}rangeGte(t,r){return this.url.searchParams.append(t,`nxl.${r}`),this}rangeLt(t,r){return this.url.searchParams.append(t,`sl.${r}`),this}rangeLte(t,r){return this.url.searchParams.append(t,`nxr.${r}`),this}rangeAdjacent(t,r){return this.url.searchParams.append(t,`adj.${r}`),this}overlaps(t,r){return typeof r=="string"?this.url.searchParams.append(t,`ov.${r}`):this.url.searchParams.append(t,`ov.{${r.join(",")}}`),this}textSearch(t,r,{config:n,type:s}={}){let o="";s==="plain"?o="pl":s==="phrase"?o="ph":s==="websearch"&&(o="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${o}fts${i}.${r}`),this}match(t){return Object.entries(t).forEach(([r,n])=>{this.url.searchParams.append(r,`eq.${n}`)}),this}not(t,r,n){return this.url.searchParams.append(t,`not.${r}.${n}`),this}or(t,{foreignTable:r,referencedTable:n=r}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,r,n){return this.url.searchParams.append(t,`${r}.${n}`),this}};Z1.default=iye;var lye=Tl&&Tl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r5,"__esModule",{value:!0});const By=lye(Z1);let cye=class{constructor(t,{headers:r={},schema:n,fetch:s}){this.url=t,this.headers=new Headers(r),this.schema=n,this.fetch=s}select(t,r){const{head:n=!1,count:s}=r??{},o=n?"HEAD":"GET";let i=!1;const l=(t??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join("");return this.url.searchParams.set("select",l),s&&this.headers.append("Prefer",`count=${s}`),new By.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:r,defaultToNull:n=!0}={}){var s;const o="POST";if(r&&this.headers.append("Prefer",`count=${r}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(i.length>0){const l=[...new Set(i)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new By.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(t,{onConflict:r,ignoreDuplicates:n=!1,count:s,defaultToNull:o=!0}={}){var i;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),r!==void 0&&this.url.searchParams.set("on_conflict",r),s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new By.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:r}={}){var n;const s="PATCH";return r&&this.headers.append("Prefer",`count=${r}`),new By.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var r;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new By.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}};r5.default=cye;var uY=Tl&&Tl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(GD,"__esModule",{value:!0});const dye=uY(r5),uye=uY(Z1);let fye=class fY{constructor(t,{headers:r={},schema:n,fetch:s}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=s}from(t){const r=new URL(`${this.url}/${t}`);return new dye.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new fY(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:s=!1,count:o}={}){var i;let l;const c=new URL(`${this.url}/rpc/${t}`);let d;n||s?(l=n?"HEAD":"GET",Object.entries(r).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{c.searchParams.append(f,h)})):(l="POST",d=r);const u=new Headers(this.headers);return o&&u.set("Prefer",`count=${o}`),new uye.default({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};GD.default=fye;var Q0=Tl&&Tl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(jc,"__esModule",{value:!0});jc.PostgrestError=jc.PostgrestBuilder=jc.PostgrestTransformBuilder=jc.PostgrestFilterBuilder=jc.PostgrestQueryBuilder=jc.PostgrestClient=void 0;const mY=Q0(GD);jc.PostgrestClient=mY.default;const hY=Q0(r5);jc.PostgrestQueryBuilder=hY.default;const pY=Q0(Z1);jc.PostgrestFilterBuilder=pY.default;const gY=Q0(n5);jc.PostgrestTransformBuilder=gY.default;const xY=Q0(a5);jc.PostgrestBuilder=xY.default;const vY=Q0(s5);jc.PostgrestError=vY.default;var mye=jc.default={PostgrestClient:mY.default,PostgrestQueryBuilder:hY.default,PostgrestFilterBuilder:pY.default,PostgrestTransformBuilder:gY.default,PostgrestBuilder:xY.default,PostgrestError:vY.default};const{PostgrestClient:hye,PostgrestQueryBuilder:dct,PostgrestFilterBuilder:uct,PostgrestTransformBuilder:fct,PostgrestBuilder:mct,PostgrestError:hct}=mye;class pye{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const gye="2.75.0",xye=`realtime-js/${gye}`,vye="1.0.0",cO=1e4,yye=1e3,bye=100;var Lb;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Lb||(Lb={}));var Ei;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Ei||(Ei={}));var Cu;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Cu||(Cu={}));var dO;(function(e){e.websocket="websocket"})(dO||(dO={}));var rg;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(rg||(rg={}));class wye{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,r,n)}_decodeBroadcast(t,r,n){const s=r.getUint8(1),o=r.getUint8(2);let i=this.HEADER_LENGTH+2;const l=n.decode(t.slice(i,i+s));i=i+s;const c=n.decode(t.slice(i,i+o));i=i+o;const d=JSON.parse(n.decode(t.slice(i,t.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class yY{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var no;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(no||(no={}));const G6=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((o,i)=>(o[i]=_ye(i,e,t,s),o),{}):{}},_ye=(e,t,r,n)=>{const s=t.find(l=>l.name===e),o=s?.type,i=r[e];return o&&!n.includes(o)?bY(o,i):uO(i)},bY=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return Cye(t,r)}switch(e){case no.bool:return jye(t);case no.float4:case no.float8:case no.int2:case no.int4:case no.int8:case no.numeric:case no.oid:return Nye(t);case no.json:case no.jsonb:return Sye(t);case no.timestamp:return Aye(t);case no.abstime:case no.date:case no.daterange:case no.int4range:case no.int8range:case no.money:case no.reltime:case no.text:case no.time:case no.timestamptz:case no.timetz:case no.tsrange:case no.tstzrange:return uO(t);default:return uO(t)}},uO=e=>e,jye=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Nye=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Sye=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Cye=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let o;const i=e.slice(1,r);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(l=>bY(t,l))}return e},Aye=e=>typeof e=="string"?e.replace(" ","T"):e,wY=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class YP{constructor(t,r,n={},s=cO){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var K6;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(K6||(K6={}));class $b{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=$b.syncState(this.state,s,o,i),this.pendingDiffs.forEach(c=>{this.state=$b.syncDiff(this.state,c,o,i)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=$b.syncDiff(this.state,s,o,i),l())}),this.onJoin((s,o,i)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:i})}),this.onLeave((s,o,i)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const o=this.cloneDeep(t),i=this.transformState(r),l={},c={};return this.map(o,(d,u)=>{i[d]||(c[d]=u)}),this.map(i,(d,u)=>{const f=o[d];if(f){const h=u.map(y=>y.presence_ref),m=f.map(y=>y.presence_ref),x=u.filter(y=>m.indexOf(y.presence_ref)<0),g=f.filter(y=>h.indexOf(y.presence_ref)<0);x.length>0&&(l[d]=x),g.length>0&&(c[d]=g)}else l[d]=u}),this.syncDiff(o,{joins:l,leaves:c},n,s)}static syncDiff(t,r,n,s){const{joins:o,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const f=t[l].map(m=>m.presence_ref),h=u.filter(m=>f.indexOf(m.presence_ref)<0);t[l].unshift(...h)}n(l,u,c)}),this.map(i,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(f=>f.presence_ref);d=d.filter(f=>u.indexOf(f.presence_ref)<0),t[l]=d,s(l,d,c),d.length===0&&delete t[l]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var X6;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(X6||(X6={}));var Bb;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Bb||(Bb={}));var rm;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(rm||(rm={}));class KD{constructor(t,r={config:{}},n){var s,o;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=Ei.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new YP(this,Cu.join,this.params,this.timeout),this.rejoinTimer=new yY(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ei.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ei.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ei.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ei.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ei.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Cu.reply,{},(i,l)=>{this._trigger(this._replyEventName(l),i)}),this.presence=new $b(this),this.broadcastEndpointURL=wY(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Ei.closed){const{config:{broadcast:i,presence:l,private:c}}=this.params,d=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[Bb.PRESENCE]&&this.bindings[Bb.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,f={},h={broadcast:i,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(m=>t?.(rm.CHANNEL_ERROR,m)),this._onClose(()=>t?.(rm.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:m})=>{var x;if(this.socket.setAuth(),m===void 0){t?.(rm.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,y=(x=g?.length)!==null&&x!==void 0?x:0,v=[];for(let b=0;b<y;b++){const w=g[b],{filter:{event:_,schema:j,table:S,filter:C}}=w,A=m&&m[b];if(A&&A.event===_&&A.schema===j&&A.table===S&&A.filter===C)v.push(Object.assign(Object.assign({},w),{id:A.id}));else{this.unsubscribe(),this.state=Ei.errored,t?.(rm.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,t&&t(rm.SUBSCRIBED);return}}).receive("error",m=>{this.state=Ei.errored,t?.(rm.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{t?.(rm.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===Ei.joined&&t===Bb.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){const{event:o,payload:i}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,l,c;const d=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(i=this.params)===null||i===void 0?void 0:i.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&o("ok"),d.receive("ok",()=>o("ok")),d.receive("error",()=>o("error")),d.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Ei.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Cu.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new YP(this,Cu.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ei.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),i=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(o),i}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new YP(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>bye){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,o;const i=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Cu;if(n&&[l,c,d,u].indexOf(i)>=0&&n!==this._joinRef())return;let h=this._onMessage(i,r,n);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(m=>{var x,g,y;return((x=m.filter)===null||x===void 0?void 0:x.event)==="*"||((y=(g=m.filter)===null||g===void 0?void 0:g.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===i}).map(m=>m.callback(h,n)):(o=this.bindings[i])===null||o===void 0||o.filter(m=>{var x,g,y,v,b,w;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in m){const _=m.id,j=(x=m.filter)===null||x===void 0?void 0:x.event;return _&&((g=r.ids)===null||g===void 0?void 0:g.includes(_))&&(j==="*"||j?.toLocaleLowerCase()===((y=r.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const _=(b=(v=m?.filter)===null||v===void 0?void 0:v.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return _==="*"||_===((w=r?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===i}).map(m=>{if(typeof h=="object"&&"ids"in h){const x=h.data,{schema:g,table:y,commit_timestamp:v,type:b,errors:w}=x;h=Object.assign(Object.assign({},{schema:g,table:y,commit_timestamp:v,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(x))}m.callback(h,n)})}_isClosed(){return this.state===Ei.closed}_isJoined(){return this.state===Ei.joined}_isJoining(){return this.state===Ei.joining}_isLeaving(){return this.state===Ei.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),o={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&KD.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Cu.close,{},t)}_onError(t){this._on(Cu.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ei.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=G6(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=G6(t.columns,t.old_record)),r}}const JP=()=>{},y_={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Pye=[1e3,2e3,5e3,1e4],Eye=1e4,kye=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Iye{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=cO,this.transport=null,this.heartbeatIntervalMs=y_.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=JP,this.ref=0,this.reconnectTimer=null,this.logger=JP,this.conn=null,this.sendBuffer=[],this.serializer=new wye,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let o;return s?o=s:typeof fetch>"u"?o=(...i)=>Pf(()=>Promise.resolve().then(()=>J0),void 0).then(({default:l})=>l(...i)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...i)=>o(...i)},!(!((n=r?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${dO.websocket}`,this.httpEndpoint=wY(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=pye.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:vye}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Lb.connecting:return rg.Connecting;case Lb.open:return rg.Open;case Lb.closing:return rg.Closing;default:return rg.Closed}}isConnected(){return this.connectionState()===rg.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new KD(`realtime:${t}`,r,this);return this.channels.push(o),o}}push(t){const{topic:r,event:n,payload:s,ref:o}=t,i=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${r} ${n} (${o})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(yye,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},y_.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:o,ref:i}=r,l=i?`(${i})`:"",c=o.status||"";this.log("receive",`${c} ${n} ${s} ${l}`.trim(),o),this.channels.filter(d=>d._isMember(n)).forEach(d=>d._trigger(s,o,i)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Cu.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([kye],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const s={access_token:r,version:xye};r&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(Cu.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new yY(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},y_.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,o,i,l,c,d,u;if(this.transport=(r=t?.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t?.timeout)!==null&&n!==void 0?n:cO,this.heartbeatIntervalMs=(s=t?.heartbeatIntervalMs)!==null&&s!==void 0?s:y_.HEARTBEAT_INTERVAL,this.worker=(o=t?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(i=t?.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(l=t?.heartbeatCallback)!==null&&l!==void 0?l:JP,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t?.reconnectAfterMs)!==null&&c!==void 0?c:f=>Pye[f-1]||Eye,this.encode=(d=t?.encode)!==null&&d!==void 0?d:(f,h)=>h(JSON.stringify(f)),this.decode=(u=t?.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class XD extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function gi(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Oye extends XD{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class fO extends XD{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}var Tye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const _Y=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>Pf(()=>Promise.resolve().then(()=>J0),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},Dye=()=>Tye(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Pf(()=>Promise.resolve().then(()=>J0),void 0)).Response:Response}),mO=e=>{if(Array.isArray(e))return e.map(r=>mO(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[s]=mO(n)}),t},Mye=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var dx=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const QP=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Rye=(e,t,r)=>dx(void 0,void 0,void 0,function*(){const n=yield Dye();e instanceof n&&!r?.noResolveJson?e.json().then(s=>{const o=e.status||500,i=s?.statusCode||o+"";t(new Oye(QP(s),o,i))}).catch(s=>{t(new fO(QP(s),s))}):t(new fO(QP(e),e))}),Fye=(e,t,r,n)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"||!n?s:(Mye(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t?.headers),s.body=JSON.stringify(n)):s.body=n,t?.duplex&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r))};function e2(e,t,r,n,s,o){return dx(this,void 0,void 0,function*(){return new Promise((i,l)=>{e(r,Fye(t,n,s,o)).then(c=>{if(!c.ok)throw c;return n?.noResolveJson?c:c.json()}).then(c=>i(c)).catch(c=>Rye(c,l,n))})})}function PN(e,t,r,n){return dx(this,void 0,void 0,function*(){return e2(e,"GET",t,r,n)})}function uf(e,t,r,n,s){return dx(this,void 0,void 0,function*(){return e2(e,"POST",t,n,s,r)})}function hO(e,t,r,n,s){return dx(this,void 0,void 0,function*(){return e2(e,"PUT",t,n,s,r)})}function Lye(e,t,r,n){return dx(this,void 0,void 0,function*(){return e2(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function jY(e,t,r,n,s){return dx(this,void 0,void 0,function*(){return e2(e,"DELETE",t,n,s,r)})}var $ye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Bye{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return $ye(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}}var qye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class zye{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}asStream(){return new Bye(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.execute().then(t,r)}execute(){return qye(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}}var xc=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Uye={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Y6={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Vye{constructor(t,r={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=_Y(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,s){return xc(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},Y6),s);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const c=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c))):(o=n,l["cache-control"]=`max-age=${i.cacheControl}`,l["content-type"]=i.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(l=Object.assign(Object.assign({},l),s.headers));const d=this._removeEmptyFolders(r),u=this._getFinalPath(d),f=yield(t=="PUT"?hO:uf)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:l},i?.duplex?{duplex:i.duplex}:{}));return{data:{path:d,id:f.Id,fullPath:f.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(gi(o))return{data:null,error:o};throw o}})}upload(t,r,n){return xc(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,s){return xc(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),i=this._getFinalPath(o),l=new URL(this.url+`/object/upload/sign/${i}`);l.searchParams.set("token",r);try{let c;const d=Object.assign({upsert:Y6.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const f=yield hO(this.fetch,l.toString(),c,{headers:u});return{data:{path:o,fullPath:f.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(gi(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,r){return xc(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const s=Object.assign({},this.headers);r?.upsert&&(s["x-upsert"]="true");const o=yield uf(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),i=new URL(this.url+o.url),l=i.searchParams.get("token");if(!l)throw new XD("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:l},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(gi(n))return{data:null,error:n};throw n}})}update(t,r,n){return xc(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return xc(this,void 0,void 0,function*(){try{return{data:yield uf(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(gi(s))return{data:null,error:s};throw s}})}copy(t,r,n){return xc(this,void 0,void 0,function*(){try{return{data:{path:(yield uf(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(gi(s))return{data:null,error:s};throw s}})}createSignedUrl(t,r,n){return xc(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),o=yield uf(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(gi(s))return{data:null,error:s};throw s}})}createSignedUrls(t,r,n){return xc(this,void 0,void 0,function*(){try{const s=yield uf(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(gi(s))return{data:null,error:s};throw s}})}download(t,r){const s=typeof r?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(r?.transform||{}),i=o?`?${o}`:"",l=this._getFinalPath(t),c=()=>PN(this.fetch,`${this.url}/${s}/${l}${i}`,{headers:this.headers,noResolveJson:!0});return new zye(c,this.shouldThrowOnError)}info(t){return xc(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield PN(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:mO(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(gi(n))return{data:null,error:n};throw n}})}exists(t){return xc(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield Lye(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(gi(n)&&n instanceof fO){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),s=[],o=r?.download?`download=${r.download===!0?"":r.download}`:"";o!==""&&s.push(o);const l=typeof r?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(r?.transform||{});c!==""&&s.push(c);let d=s.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${d}`)}}}remove(t){return xc(this,void 0,void 0,function*(){try{return{data:yield jY(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(gi(r))return{data:null,error:r};throw r}})}list(t,r,n){return xc(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Uye),r),{prefix:t||""});return{data:yield uf(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(gi(s))return{data:null,error:s};throw s}})}listV2(t,r){return xc(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield uf(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(gi(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const Wye="2.75.0",Hye={"X-Client-Info":`storage-js/${Wye}`};var Ex=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Gye{constructor(t,r={},n,s){this.shouldThrowOnError=!1;const o=new URL(t);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Hye),r),this.fetch=_Y(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Ex(this,void 0,void 0,function*(){try{return{data:yield PN(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}getBucket(t){return Ex(this,void 0,void 0,function*(){try{return{data:yield PN(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(gi(r))return{data:null,error:r};throw r}})}createBucket(t){return Ex(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield uf(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(gi(s))return{data:null,error:s};throw s}})}updateBucket(t,r){return Ex(this,void 0,void 0,function*(){try{return{data:yield hO(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(gi(n))return{data:null,error:n};throw n}})}emptyBucket(t){return Ex(this,void 0,void 0,function*(){try{return{data:yield uf(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(gi(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Ex(this,void 0,void 0,function*(){try{return{data:yield jY(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(gi(r))return{data:null,error:r};throw r}})}}class Kye extends Gye{constructor(t,r={},n,s){super(t,r,n,s)}from(t){return new Vye(this.url,this.headers,t,this.fetch)}}const Xye="2.75.0";let gb="";typeof Deno<"u"?gb="deno":typeof document<"u"?gb="web":typeof navigator<"u"&&navigator.product==="ReactNative"?gb="react-native":gb="node";const Yye={"X-Client-Info":`supabase-js-${gb}/${Xye}`},Jye={headers:Yye},Qye={schema:"public"},Zye={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ebe={};var tbe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const rbe=e=>{let t;return e?t=e:typeof fetch>"u"?t=lY:t=fetch,(...r)=>t(...r)},nbe=()=>typeof Headers>"u"?cY:Headers,abe=(e,t,r)=>{const n=rbe(r),s=nbe();return(o,i)=>tbe(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:e;let d=new s(i?.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(o,Object.assign(Object.assign({},i),{headers:d}))})};var sbe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};function obe(e){return e.endsWith("/")?e:e+"/"}function ibe(e,t){var r,n;const{db:s,auth:o,realtime:i,global:l}=e,{db:c,auth:d,realtime:u,global:f}=t,h={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},d),o),realtime:Object.assign(Object.assign({},u),i),storage:{},global:Object.assign(Object.assign(Object.assign({},f),l),{headers:Object.assign(Object.assign({},(r=f?.headers)!==null&&r!==void 0?r:{}),(n=l?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>sbe(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}function lbe(e){const t=e?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(obe(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const NY="2.75.0",Jx=30*1e3,pO=3,ZP=pO*Jx,cbe="http://localhost:9999",dbe="supabase.auth.token",ube={"X-Client-Info":`gotrue-js/${NY}`},gO="X-Supabase-Api-Version",SY={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},fbe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,mbe=10*60*1e3;class Mw extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function ja(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class hbe extends Mw{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function pbe(e){return ja(e)&&e.name==="AuthApiError"}class ng extends Mw{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class wp extends Mw{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class oh extends wp{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function gbe(e){return ja(e)&&e.name==="AuthSessionMissingError"}class kx extends wp{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class b_ extends wp{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class w_ extends wp{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function xbe(e){return ja(e)&&e.name==="AuthImplicitGrantRedirectError"}class J6 extends wp{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class xO extends wp{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function eE(e){return ja(e)&&e.name==="AuthRetryableFetchError"}class Q6 extends wp{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class vO extends wp{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const EN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Z6=` 	
\r=`.split(""),vbe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Z6.length;t+=1)e[Z6[t].charCodeAt(0)]=-2;for(let t=0;t<EN.length;t+=1)e[EN[t].charCodeAt(0)]=t;return e})();function e8(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(EN[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(EN[n]),t.queuedBits-=6}}function CY(e,t,r){const n=vbe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function t8(e){const t=[],r=i=>{t.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=i=>{wbe(i,n,r)};for(let i=0;i<e.length;i+=1)CY(e.charCodeAt(i),s,o);return t.join("")}function ybe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function bbe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}ybe(n,t)}}function wbe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Dv(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)CY(e.charCodeAt(s),r,n);return new Uint8Array(t)}function _be(e){const t=[];return bbe(e,r=>t.push(r)),new Uint8Array(t)}function dg(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>e8(s,r,n)),e8(null,r,n),t.join("")}function jbe(e){return Math.round(Date.now()/1e3)+e}function Nbe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const Xc=()=>typeof window<"u"&&typeof document<"u",Rp={tested:!1,writable:!1},AY=()=>{if(!Xc())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Rp.tested)return Rp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Rp.tested=!0,Rp.writable=!0}catch{Rp.tested=!0,Rp.writable=!1}return Rp.writable};function Sbe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,o)=>{t[o]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const PY=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>Pf(()=>Promise.resolve().then(()=>J0),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},Cbe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Qx=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Fp=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Jm=async(e,t)=>{await e.removeItem(t)};class o5{constructor(){this.promise=new o5.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}o5.promiseConstructor=Promise;function tE(e){const t=e.split(".");if(t.length!==3)throw new vO("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!fbe.test(t[n]))throw new vO("JWT not in base64url format");return{header:JSON.parse(t8(t[0])),payload:JSON.parse(t8(t[1])),signature:Dv(t[2]),raw:{header:t[0],payload:t[1]}}}async function Abe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Pbe(e,t){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await e(o);if(!t(o,null,i)){n(i);return}}catch(i){if(!t(o,i)){s(i);return}}})()})}function Ebe(e){return("0"+e.toString(16)).substr(-2)}function kbe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let o=0;o<56;o++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,Ebe).join("")}async function Ibe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function Obe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await Ibe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ix(e,t,r=!1){const n=kbe();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await Qx(e,`${t}-code-verifier`,s);const o=await Obe(n);return[o,n===o?"plain":"s256"]}const Tbe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Dbe(e){const t=e.headers.get(gO);if(!t||!t.match(Tbe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Mbe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Rbe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Fbe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ox(e){if(!Fbe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function rE(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function r8(e){return JSON.parse(JSON.stringify(e))}var Lbe=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};const Xp=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),$be=[502,503,504];async function n8(e){var t;if(!Cbe(e))throw new xO(Xp(e),0);if($be.includes(e.status))throw new xO(Xp(e),e.status);let r;try{r=await e.json()}catch(o){throw new ng(Xp(o),o)}let n;const s=Dbe(e);if(s&&s.getTime()>=SY["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Q6(Xp(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new oh}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new Q6(Xp(r),e.status,r.weak_password.reasons);throw new hbe(Xp(r),e.status||500,n)}const Bbe=(e,t,r,n)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function Va(e,t,r,n){var s;const o=Object.assign({},n?.headers);o[gO]||(o[gO]=SY["2024-01-01"].name),n?.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const i=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await qbe(e,t,r+l,{headers:o,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(c):{data:Object.assign({},c),error:null}}async function qbe(e,t,r,n,s,o){const i=Bbe(t,n,s,o);let l;try{l=await e(r,Object.assign({},i))}catch(c){throw console.error(c),new xO(Xp(c),0)}if(l.ok||await n8(l),n?.noResolveJson)return l;try{return await l.json()}catch(c){await n8(c)}}function wu(e){var t;let r=null;Vbe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=jbe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function a8(e){const t=wu(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function gh(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function zbe(e){return{data:e,error:null}}function Ube(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o}=e,i=Lbe(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o},c=Object.assign({},i);return{data:{properties:l,user:c},error:null}}function s8(e){return e}function Vbe(e){return e.access_token&&e.refresh_token&&e.expires_in}const nE=["global","local","others"];var Wbe=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};class Hbe{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=PY(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=nE[0]){if(nE.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${nE.join(", ")}`);try{return await Va(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ja(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await Va(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:gh})}catch(n){if(ja(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=Wbe(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await Va(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Ube,redirectTo:r?.redirectTo})}catch(r){if(ja(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await Va(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:gh})}catch(r){if(ja(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await Va(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:s8});if(u.error)throw u.error;const f=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(x=>{const g=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(x.split(";")[1].split("=")[1]);d[`${y}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(ja(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){Ox(t);try{return await Va(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:gh})}catch(r){if(ja(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Ox(t);try{return await Va(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:gh})}catch(n){if(ja(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){Ox(t);try{return await Va(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:gh})}catch(n){if(ja(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Ox(t.userId);try{const{data:r,error:n}=await Va(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Ox(t.userId),Ox(t.id);try{return{data:await Va(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await Va(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:s8});if(u.error)throw u.error;const f=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(x=>{const g=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(x.split(";")[1].split("=")[1]);d[`${y}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(ja(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(t){try{return await Va(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await Va(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await Va(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await Va(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ja(r))return{data:null,error:r};throw r}}}function o8(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Tx={debug:!!(globalThis&&AY()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class EY extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Gbe extends EY{}async function Kbe(e,t,r){Tx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Tx.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Tx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{Tx.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw Tx.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Gbe(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Tx.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Xbe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function kY(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Ybe(e){return parseInt(e,16)}function Jbe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function Qbe(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:o=new Date,nonce:i,notBefore:l,requestId:c,resources:d,scheme:u,uri:f,version:h}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const m=kY(e.address),x=u?`${u}://${n}`:n,g=e.statement?`${e.statement}
`:"",y=`${x} wants you to sign in with your Ethereum account:
${m}

${g}`;let v=`URI: ${f}
Version: ${h}
Chain ID: ${r}${i?`
Nonce: ${i}`:""}
Issued At: ${o.toISOString()}`;if(s&&(v+=`
Expiration Time: ${s.toISOString()}`),l&&(v+=`
Not Before: ${l.toISOString()}`),c&&(v+=`
Request ID: ${c}`),d){let b=`
Resources:`;for(const w of d){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);b+=`
- ${w}`}v+=b}return`${y}
${v}`}class pi extends Error{constructor({message:t,code:r,cause:n,name:s}){var o;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(o=s??(n instanceof Error?n.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=r}}class kN extends pi{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function Zbe({error:e,options:t}){var r,n,s;const{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new pi({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new pi({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=o.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new pi({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new pi({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new pi({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new pi({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return o.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new pi({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new pi({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const i=window.location.hostname;if(OY(i)){if(o.rp.id!==i)return new pi({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new pi({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new pi({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new pi({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new pi({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function ewe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new pi({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new pi({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(OY(n)){if(r.rpId!==n)return new pi({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new pi({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new pi({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new pi({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}var IY=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};class twe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const rwe=new twe;function nwe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=IY(e,["challenge","user","excludeCredentials"]),o=Dv(t).buffer,i=Object.assign(Object.assign({},r),{id:Dv(r.id).buffer}),l=Object.assign(Object.assign({},s),{challenge:o,user:i});if(n&&n.length>0){l.excludeCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const d=n[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:Dv(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function awe(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=IY(e,["challenge","allowCredentials"]),s=Dv(t).buffer,o=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){o.allowCredentials=new Array(r.length);for(let i=0;i<r.length;i++){const l=r[i];o.allowCredentials[i]=Object.assign(Object.assign({},l),{id:Dv(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return o}function swe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:dg(new Uint8Array(e.response.attestationObject)),clientDataJSON:dg(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function owe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:dg(new Uint8Array(s.authenticatorData)),clientDataJSON:dg(new Uint8Array(s.clientDataJSON)),signature:dg(new Uint8Array(s.signature)),userHandle:s.userHandle?dg(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function OY(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function i8(){var e,t;return!!(Xc()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function iwe(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new kN("Browser returned unexpected credential type",t)}:{data:null,error:new kN("Empty credential response",t)}}catch(t){return{data:null,error:Zbe({error:t,options:e})}}}async function lwe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new kN("Browser returned unexpected credential type",t)}:{data:null,error:new kN("Empty credential response",t)}}catch(t){return{data:null,error:ewe({error:t,options:e})}}}const cwe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},dwe={userVerification:"preferred",hints:["security-key"]};function IN(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const o in s){const i=s[o];if(i!==void 0)if(Array.isArray(i))n[o]=i;else if(r(i))n[o]=i;else if(t(i)){const l=n[o];t(l)?n[o]=IN(l,i):n[o]=IN(i)}else n[o]=i}return n}function uwe(e,t){return IN(cwe,e,t||{})}function fwe(e,t){return IN(dwe,e,t||{})}class mwe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},o){try{const{data:i,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!i)return{data:null,error:l};const c=s??rwe.createNewAbortSignal();if(i.webauthn.type==="create"){const{user:d}=i.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${n}`),d.displayName||(d.displayName=d.name)}switch(i.webauthn.type){case"create":{const d=uwe(i.webauthn.credential_options.publicKey,o?.create),{data:u,error:f}=await iwe({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}case"request":{const d=fwe(i.webauthn.credential_options.publicKey,o?.request),{data:u,error:f}=await lwe(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}}}catch(i){return ja(i)?{data:null,error:i}:{data:null,error:new ng("Unexpected error in challenge",i)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}},o){if(!r)return{data:null,error:new Mw("rpId is required for WebAuthn authentication")};try{if(!i8())return{data:null,error:new ng("Browser does not support WebAuthn",null)};const{data:i,error:l}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:o});if(!i)return{data:null,error:l};const{webauthn:c}=i;return this._verify({factorId:t,challengeId:i.challengeId,webauthn:{type:c.type,rpId:r,rpOrigins:n,credential_response:c.credential_response}})}catch(i){return ja(i)?{data:null,error:i}:{data:null,error:new ng("Unexpected error in authenticate",i)}}}async _register({friendlyName:t,rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s},o){if(!r)return{data:null,error:new Mw("rpId is required for WebAuthn registration")};try{if(!i8())return{data:null,error:new ng("Browser does not support WebAuthn",null)};const{data:i,error:l}=await this._enroll({friendlyName:t});if(!i)return await this.client.mfa.listFactors().then(u=>{var f;return(f=u.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===t&&h.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:o});return c?this._verify({factorId:i.id,challengeId:c.challengeId,webauthn:{rpId:r,rpOrigins:n,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(i){return ja(i)?{data:null,error:i}:{data:null,error:new ng("Unexpected error in register",i)}}}}Xbe();const hwe={url:cbe,storageKey:dbe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ube,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function l8(e,t,r){return await r()}const Dx={};class Rw{get jwks(){var t,r;return(r=(t=Dx[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){Dx[this.storageKey]=Object.assign(Object.assign({},Dx[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=Dx[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Dx[this.storageKey]=Object.assign(Object.assign({},Dx[this.storageKey]),{cachedAt:t})}constructor(t){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Rw.nextInstanceID,Rw.nextInstanceID+=1,this.instanceID>0&&Xc()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},hwe),t);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Hbe({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=PY(s.fetch),this.lock=s.lock||l8,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Xc()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Kbe:this.lock=l8,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new mwe(this)},this.persistSession?(s.storage?this.storage=s.storage:AY()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=o8(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=o8(this.memoryStorage)),Xc()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${NY}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const r=Sbe(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),Xc()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(r,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),xbe(o)){const c=(t=o.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",l),await this._saveSession(i),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return ja(r)?{error:r}:{error:new ng("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const o=await Va(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t?.options)===null||s===void 0?void 0:s.captchaToken}},xform:wu}),{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(ja(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(t){var r,n,s;try{let o;if("email"in t){const{email:u,password:f,options:h}=t;let m=null,x=null;this.flowType==="pkce"&&([m,x]=await Ix(this.storage,this.storageKey)),o=await Va(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:f,data:(r=h?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:m,code_challenge_method:x},xform:wu})}else if("phone"in t){const{phone:u,password:f,options:h}=t;o=await Va(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:f,data:(n=h?.data)!==null&&n!==void 0?n:{},channel:(s=h?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:wu})}else throw new b_("You must provide either an email or phone number and a password");const{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(ja(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(t){try{let r;if("email"in t){const{email:o,password:i,options:l}=t;r=await Va(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:a8})}else if("phone"in t){const{phone:o,password:i,options:l}=t;r=await Va(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:a8})}else throw new b_("You must provide either an email or phone number and a password");const{data:n,error:s}=r;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new kx}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(ja(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(t){var r,n,s,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,o,i,l,c,d,u,f,h;let m,x;if("message"in t)m=t.message,x=t.signature;else{const{chain:g,wallet:y,statement:v,options:b}=t;let w;if(Xc())if(typeof y=="object")w=y;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")w=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=y}const _=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href),j=await w.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!j||j.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const S=kY(j[0]);let C=(n=b?.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!C){const P=await w.request({method:"eth_chainId"});C=Ybe(P)}const A={domain:_.host,address:S,statement:v,uri:_.href,version:"1",chainId:C,nonce:(s=b?.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(i=(o=b?.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(l=b?.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=b?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=b?.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=b?.signInWithEthereum)===null||u===void 0?void 0:u.resources};m=Qbe(A),x=await w.request({method:"personal_sign",params:[Jbe(m),S]})}try{const{data:g,error:y}=await Va(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:x},!((f=t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=t.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:wu});if(y)throw y;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new kx}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:y})}catch(g){if(ja(g))return{data:{user:null,session:null},error:g};throw g}}async signInWithSolana(t){var r,n,s,o,i,l,c,d,u,f,h,m;let x,g;if("message"in t)x=t.message,g=t.signature;else{const{chain:y,wallet:v,statement:b,options:w}=t;let _;if(Xc())if(typeof v=="object")_=v;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))_=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=v}const j=new URL((r=w?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in _&&_.signIn){const S=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),b?{statement:b}:null));let C;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")C=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)C=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in C&&"signature"in C&&(typeof C.signedMessage=="string"||C.signedMessage instanceof Uint8Array)&&C.signature instanceof Uint8Array)x=typeof C.signedMessage=="string"?C.signedMessage:new TextDecoder().decode(C.signedMessage),g=C.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${j.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(s=(n=w?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=w?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((i=w?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((d=w?.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(C=>`- ${C}`)]:[]].join(`
`);const S=await _.signMessage(new TextEncoder().encode(x),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=S}}try{const{data:y,error:v}=await Va(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:dg(g)},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:wu});if(v)throw v;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new kx}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:v})}catch(y){if(ja(y))return{data:{user:null,session:null},error:y};throw y}}async _exchangeCodeForSession(t){const r=await Fp(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:o,error:i}=await Va(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:wu});if(await Jm(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new kx}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:i})}catch(o){if(ja(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:o,nonce:i}=t,l=await Va(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:wu}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new kx}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(r){if(ja(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(t){var r,n,s,o,i;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Ix(this.storage,this.storageKey));const{error:f}=await Va(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await Va(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(i=c?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:d?.message_id},error:u}}throw new b_("You must provide either an email or phone number.")}catch(l){if(ja(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var r,n;try{let s,o;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:l}=await Va(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:wu});if(l)throw l;if(!i)throw new Error("An error occurred on token verification.");const c=i.session,d=i.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(s){if(ja(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(t){var r,n,s;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await Ix(this.storage,this.storageKey)),await Va(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:zbe})}catch(o){if(ja(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new oh;const{error:s}=await Va(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:s}})}catch(t){if(ja(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:o}=t,{error:i}=await Va(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in t){const{phone:n,type:s,options:o}=t,{data:i,error:l}=await Va(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:l}}throw new b_("You must provide either an email or phone number and a type")}catch(r){if(ja(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Fp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<ZP:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const i=await Fp(this.userStorage,this.storageKey+"-user");i?.user?t.user=i.user:t.user=rE()}if(this.storage.isServer&&t.user){let i=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!i&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{session:null},error:o}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Va(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:gh}):await this._useSession(async r=>{var n,s,o;const{data:i,error:l}=r;if(l)throw l;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new oh}:await Va(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:gh})})}catch(r){if(ja(r))return gbe(r)&&(await this._removeSession(),await Jm(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new oh;const i=s.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await Ix(this.storage,this.storageKey));const{data:d,error:u}=await Va(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:i.access_token,xform:gh});if(u)throw u;return i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(ja(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new oh;const r=Date.now()/1e3;let n=r,s=!0,o=null;const{payload:i}=tE(t.access_token);if(i.exp&&(n=i.exp,s=n<=r),s){const{data:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};o=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;o={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(r){if(ja(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:i,error:l}=r;if(l)throw l;t=(n=i.session)!==null&&n!==void 0?n:void 0}if(!t?.refresh_token)throw new oh;const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{user:null,session:null},error:o}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(ja(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(t,r){try{if(!Xc())throw new w_("No browser detected.");if(t.error||t.error_description||t.error_code)throw new w_(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new J6("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new w_("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new J6("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(t.code);if(w)throw w;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:i,expires_in:l,expires_at:c,token_type:d}=t;if(!o||!l||!i||!d)throw new w_("No session defined in URL");const u=Math.round(Date.now()/1e3),f=parseInt(l);let h=u+f;c&&(h=parseInt(c));const m=h-u;m*1e3<=Jx&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${f}s`);const x=h-f;u-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,h,u):u-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,h,u);const{data:g,error:y}=await this._getUser(o);if(y)throw y;const v={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:f,expires_at:h,refresh_token:i,token_type:d,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:t.type},error:null}}catch(n){if(ja(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Fp(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{error:o};const i=(n=s.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:l}=await this.admin.signOut(i,t);if(l&&!(pbe(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await Jm(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const r=Nbe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:o},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Ix(this.storage,this.storageKey,!0));try{return await Va(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(o){if(ja(o))return{data:null,error:o};throw o}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(r){if(ja(r))return{data:null,error:r};throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async o=>{var i,l,c,d,u;const{data:f,error:h}=o;if(h)throw h;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Va(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(d=f.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return Xc()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:t.provider,url:n?.url},error:null}}catch(n){if(ja(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:o}}=r;if(s)throw s;const{options:i,provider:l,token:c,access_token:d,nonce:u}=t,f=await Va(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=o?.access_token)!==null&&n!==void 0?n:void 0,body:{provider:l,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:wu}),{data:h,error:m}=f;return m?{data:{user:null,session:null},error:m}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new kx}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),{data:h,error:m})}catch(s){if(ja(s))return{data:{user:null,session:null},error:s};throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)throw i;return await Va(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Pbe(async s=>(s>0&&await Abe(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await Va(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:wu})),(s,o)=>{const i=200*Math.pow(2,s);return o&&eE(o)&&Date.now()+i-n<Jx})}catch(n){if(this._debug(r,"error",n),ja(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),Xc()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Fp(this.storage,this.storageKey);if(s&&this.userStorage){let i=await Fp(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:s.user},await Qx(this.userStorage,this.storageKey+"-user",i)),s.user=(t=i?.user)!==null&&t!==void 0?t:rE()}else if(s&&!s.user&&!s.user){const i=await Fp(this.storage,this.storageKey+"-user");i&&i?.user?(s.user=i.user,await Jm(this.storage,this.storageKey+"-user"),await Qx(this.storage,this.storageKey,s)):s.user=rE()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<ZP;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${ZP}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),eE(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:l}=await this._getUser(s.access_token);!l&&i?.user?(s.user=i.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new oh;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new o5;const{data:o,error:i}=await this._refreshAccessToken(t);if(i)throw i;if(!o.session)throw new oh;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const l={data:o.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(o){if(this._debug(s,"error",o),ja(o)){const i={data:null,error:o};return eE(o)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,r)}catch(c){o.push(c)}});if(await Promise.all(i),o.length>0){for(let l=0;l<o.length;l+=1)console.error(o[l]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Qx(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const o=r8(s);await Qx(this.storage,this.storageKey,o)}else{const s=r8(r);await Qx(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Jm(this.storage,this.storageKey),await Jm(this.storage,this.storageKey+"-code-verifier"),await Jm(this.storage,this.storageKey+"-user"),this.userStorage&&await Jm(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Xc()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Jx);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/Jx);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Jx}ms, refresh threshold is ${pO} ticks`),s<=pO&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof EY)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Xc()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,i]=await Ix(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});s.push(l.toString())}if(n?.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;return o?{data:null,error:o}:await Va(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)return{data:null,error:i};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:d}=await Va(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&c.type==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(ja(r))return{data:null,error:r};throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{data:null,error:o};const i=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?swe(t.webauthn.credential_response):owe(t.webauthn.credential_response)})}:{code:t.code}),{data:l,error:c}=await Va(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:i,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:c})})}catch(r){if(ja(r))return{data:null,error:r};throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{data:null,error:o};const i=await Va(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});if(i.error)return i;const{data:l}=i;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:nwe(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:awe(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(ja(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const o of(t=r?.factors)!==null&&t!==void 0?t:[])s.all.push(o),o.status==="verified"&&s[o.factor_type].push(o);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var r,n;const{data:{session:s},error:o}=t;if(o)return{data:null,error:o};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=tE(s.access_token);let l=null;i.aal&&(l=i.aal);let c=l;((n=(r=s.user.factors)===null||r===void 0?void 0:r.filter(f=>f.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=i.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(l=>l.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(l=>l.kid===t),n&&this.jwks_cached_at+mbe>s)return n;const{data:o,error:i}=await Va(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(l=>l.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:m,error:x}=await this.getSession();if(x||!m.session)return{data:null,error:x};n=m.session.access_token}const{header:s,payload:o,signature:i,raw:{header:l,payload:c}}=tE(n);r?.allowExpired||Mbe(o.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!d){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:o,header:s,signature:i},error:null}}const u=Rbe(s.alg),f=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,f,i,_be(`${l}.${c}`)))throw new vO("Invalid JWT signature");return{data:{claims:o,header:s,signature:i},error:null}}catch(n){if(ja(n))return{data:null,error:n};throw n}}}Rw.nextInstanceID=0;const pwe=Rw;class gwe extends pwe{constructor(t){super(t)}}var xwe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class vwe{constructor(t,r,n){var s,o,i;this.supabaseUrl=t,this.supabaseKey=r;const l=lbe(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:Qye,realtime:ebe,auth:Object.assign(Object.assign({},Zye),{storageKey:c}),global:Jye},u=ibe(n??{},d);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=u.global.headers)!==null&&o!==void 0?o:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=u.auth)!==null&&i!==void 0?i:{},this.headers,u.global.fetch),this.fetch=abe(r,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new hye(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Kye(this.storageUrl.href,this.headers,this.fetch,n?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new H0e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return xwe(this,void 0,void 0,function*(){var t,r;if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,storageKey:i,flowType:l,lock:c,debug:d},u,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new gwe({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,flowType:l,lock:c,debug:d,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Iye(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ywe=(e,t,r)=>new vwe(e,t,r);function bwe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}bwe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const wwe="https://dlfryxtyxqoacuunswuc.supabase.co",_we="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY";function YD(){try{if(typeof window<"u"&&window.__SUPABASE_URL)return window.__SUPABASE_URL}catch{}return wwe}function TY(){try{if(typeof window<"u"&&window.__SUPABASE_KEY)return window.__SUPABASE_KEY}catch{}return _we}function jwe(){try{return(new URL(YD()).host||"").split(".")[0]||""}catch{return""}}function Nwe(){const e=jwe();return e?`sb-${e}-auth-token`:"sb-auth-token"}async function Swe(){try{const e=localStorage.getItem("custom-auth-token");if(e&&e.trim())return e.trim()}catch{}try{if(typeof Vh<"u"&&Vh?.auth?.getSession){const e=new Promise((s,o)=>setTimeout(()=>o(new Error("getSession timeout")),1e3)),t=Vh.auth.getSession(),{data:r}=await Promise.race([t,e]),n=r?.session?.access_token;if(n)return console.debug("[Supabase Wrapper] Token obtido via getSession"),n}}catch(e){console.debug("[Supabase Wrapper] getSession falhou ou timeout:",e.message)}try{const e=Nwe(),t=localStorage.getItem(e);if(t){const r=JSON.parse(t);if(r?.access_token)return console.debug("[Supabase Wrapper] Token obtido via localStorage"),r.access_token;if(r?.currentSession?.access_token)return console.debug("[Supabase Wrapper] Token obtido via localStorage (currentSession)"),r.currentSession.access_token}}catch(e){console.warn("[Supabase Wrapper] Erro ao ler localStorage:",e)}return console.warn("[Supabase Wrapper]  Nenhum token encontrado - usando anon key"),null}const Cwe=e=>{const t=new URLSearchParams;return Object.entries(e).forEach(([r,n])=>{n!=null&&(Array.isArray(n)?n.forEach(s=>t.append(r,String(s))):t.append(r,String(n)))}),t.toString()},DY=async(e,t={})=>{const{method:r="GET",body:n,headers:s={},params:o={},signal:i,timeoutMs:l=2e4}=t,c=Cwe(o),u=`${YD()}/rest/v1/${e}${c?`?${c}`:""}`,h={apikey:TY(),"Content-Type":"application/json",Prefer:"return=representation",...s};try{const j=await Swe();j&&(h.Authorization=`Bearer ${j}`)}catch(j){console.warn("[Supabase Wrapper] Erro ao obter token de sesso:",j)}const m={method:r,headers:h};n&&(m.body=JSON.stringify(n)),i&&(m.signal=i);const x=new AbortController,g=setTimeout(()=>{console.warn(`[Supabase Wrapper]  Timeout (${l}ms) para ${e}`);try{x.abort("timeout")}catch{}},Math.max(5e3,l)),y=(()=>{if(!i)return x.signal;try{i.addEventListener("abort",()=>{try{x.abort("upstream-abort")}catch{}})}catch{}return x.signal})();m.signal=y;const v=Date.now();let b;try{b=await fetch(u,m)}finally{clearTimeout(g)}if(!b.ok){let j="";try{j=await b.text()}catch{}const S=Date.now()-v;let C=!1;try{const A=JSON.parse(j);C=b.status===401&&(A?.code==="PGRST303"||/jwt expired/i.test(A?.message||""))}catch{}if(C){try{window.dispatchEvent(new CustomEvent("auth:jwt-expired"))}catch{}try{localStorage.removeItem("custom-auth-token"),Object.keys(localStorage).filter(A=>A.startsWith("sb-")).forEach(A=>localStorage.removeItem(A)),Object.keys(sessionStorage).filter(A=>A.startsWith("sb-")).forEach(A=>sessionStorage.removeItem(A)),sessionStorage.setItem("auth:forceLogout","1"),window.location.replace("/")}catch{}}throw new Error(`[Supabase Wrapper] HTTP ${b.status} (${S}ms) - ${j||"unknown error"}`)}const w=Date.now()-v;let _;try{_=await b.json()}catch(j){throw console.error(`[Supabase Wrapper] Erro ao parsear JSON de ${e}:`,j),new Error(`[Supabase Wrapper] JSON parse error: ${j.message}`)}return w>3e3?console.warn(`[Supabase Wrapper]  fetch ${e} LENTO (${w}ms)`):console.debug(`[Supabase Wrapper] fetch ${e} OK (${w}ms)`),{data:_,error:null}};class Awe{constructor(t){this.table=t,this.params={},this.multiFilters={},this.selectColumns="*",this.signal=null}select(t="*"){return this.selectColumns=t,this.params.select=t,this}eq(t,r){return this._addFilter(t,`eq.${r}`),this}neq(t,r){return this.params[t]=`neq.${r}`,this}gt(t,r){return this.params[t]=`gt.${r}`,this}gte(t,r){return this._addFilter(t,`gte.${r}`),this}lt(t,r){return this.params[t]=`lt.${r}`,this}lte(t,r){return this._addFilter(t,`lte.${r}`),this}like(t,r){return this.params[t]=`like.${r}`,this}ilike(t,r){return this.params[t]=`ilike.${r}`,this}is(t,r){return this.params[t]=`is.${r}`,this}in(t,r){return this.params[t]=`in.(${r.join(",")})`,this}not(t,r,n){return this.params[t]=`not.${r}.${n}`,this}or(t){return this.params.or=`(${t})`,this}contains(t,r){return this.params[t]=`cs.{${r}}`,this}containedBy(t,r){return this.params[t]=`cd.{${r}}`,this}filter(t,r,n){return this._addFilter(t,`${r}.${n}`),this}order(t,r={}){const n=r.ascending===!1?"desc":"asc";return this.params.order=`${t}.${n}`,this}limit(t){return this.params.limit=t,this}range(t,r){return this.params.offset=t,this.params.limit=r-t+1,this}single(){return this.params.limit=1,this.isSingle=!0,this}maybeSingle(){return this.params.limit=1,this.isMaybeSingle=!0,this}abortSignal(t){return this.signal=t,this}_addFilter(t,r){this.multiFilters[t]||(this.multiFilters[t]=[]),this.multiFilters[t].push(r)}async then(t,r){try{const n={...this.params};Object.entries(this.multiFilters).forEach(([o,i])=>{i.length===1?n[o]=i[0]:i.length>1&&(n[o]=i)});const s=await DY(this.table,{method:"GET",params:n,signal:this.signal});this.isSingle&&s.data&&(s.data=s.data[0]||null),this.isMaybeSingle&&s.data&&(s.data=s.data[0]||null),t(s)}catch(n){r(n)}}}class Pwe extends Awe{insert(t){return this.method="POST",this.body=Array.isArray(t)?t:[t],this}update(t){return this.method="PATCH",this.body=t,this}upsert(t,r={}){this.method="POST",this.body=Array.isArray(t)?t:[t];const n=r.ignoreDuplicates?"resolution=ignore-duplicates":"resolution=merge-duplicates",s=r.returning==="minimal"?"return=minimal":"return=representation";return this.headers={...this.headers||{},Prefer:`${n},${s}`},r.onConflict&&(this.params.on_conflict=r.onConflict),this}delete(){return this.method="DELETE",this}async then(t,r){try{const n={...this.params};Object.entries(this.multiFilters).forEach(([o,i])=>{i.length===1?n[o]=i[0]:i.length>1&&(n[o]=i)});const s=await DY(this.table,{method:this.method||"GET",body:this.body,params:n,signal:this.signal,headers:this.headers||{}});this.isSingle&&s.data&&(s.data=s.data[0]||null),this.isMaybeSingle&&s.data&&(s.data=s.data[0]||null),t(s)}catch(n){r(n)}}}const Vh={from(e){return new Pwe(e)},auth:null,supabaseUrl:YD(),supabaseKey:TY()};typeof window<"u"&&Vh.from("empresas").select("id").limit(1).then(({data:e,error:t})=>{t&&console.error("[Supabase Wrapper]  ERRO:",t)}).catch(e=>{console.error("[Supabase Wrapper]  EXCEPTION:",e)});const c8="main";let Mv,qb;try{const e=Object.assign({"./backendTargets.js":L0e,"./backendTargets.local.js":q0e}),t=e["./backendTargets.js"]||null,r=e["./backendTargets.local.js"]||null;t?.TARGETS&&(qb=t.TARGETS),t?.ACTIVE_TARGET&&(Mv=t.ACTIVE_TARGET),r?.TARGETS&&(qb=r.TARGETS),r?.ACTIVE_TARGET&&(Mv=r.ACTIVE_TARGET)}catch{}let Xd=qb&&Mv&&qb[Mv]?qb[Mv]:null,JD=Mv;!Xd&&c8&&(JD=c8);let Nc=Xd&&Xd.supabaseUrl&&Xd.supabaseUrl.trim()?Xd.supabaseUrl:"",Sc=Xd&&Xd.supabaseAnonKey&&Xd.supabaseAnonKey.trim()?Xd.supabaseAnonKey:"";if(!Nc||!Sc){const e=(JD||"dev").toLowerCase(),t=e==="main"?{}.VITE_SUPABASE_URL_MAIN:{}.VITE_SUPABASE_URL_DEV,r=e==="main"?{}.VITE_SUPABASE_ANON_KEY_MAIN:{}.VITE_SUPABASE_ANON_KEY_DEV;Nc=Nc&&Nc.trim()?Nc:t,Sc=Sc&&Sc.trim()?Sc:r}(!Nc||!Sc)&&(Nc=Nc||"https://dlfryxtyxqoacuunswuc.supabase.co",Sc=Sc||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY");try{try{const e=JD||"dev";console.log(`[Target] Branch ativa: ${e}`);try{typeof window<"u"&&(window.__ACTIVE_TARGET=e)}catch{}const t=!!Xd&&!!(Xd.supabaseUrl||"").trim()&&!!(Xd.supabaseAnonKey||"").trim(),r=!t&&(!!{}.VITE_SUPABASE_URL_DEV||!!{}.VITE_SUPABASE_URL_MAIN);console.info(`[Supabase] Backend target mode: ${t?"static config":r?"per-target env":"generic env"}`)}catch{}}catch{}if(!Nc||!Sc)throw console.error("[Supabase]  ERRO CRTICO: Variveis de ambiente ausentes!"),new Error("Supabase: Variveis de ambiente no configuradas!");const yO=Nc,bO=Sc,_u=ywe(Nc,Sc,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:typeof window<"u"?window.localStorage:void 0},global:{headers:{"X-Client-Info":"fluxo7arena-web",apikey:Sc}}});try{typeof window<"u"&&Vh&&(Vh.auth=_u.auth)}catch{}const re={from:e=>Vh.from(e),auth:_u.auth,storage:_u.storage,functions:_u.functions,rpc:(...e)=>_u.rpc(...e),realtime:_u.realtime,channel:(...e)=>_u.channel(...e),removeChannel:(...e)=>_u.removeChannel(...e),removeAllChannels:()=>_u.removeAllChannels(),getChannels:()=>_u.getChannels(),supabaseUrl:Nc,supabaseKey:Sc};if(typeof window<"u"){window.__supabase=re,window.__supabase_original=_u,window.__supabase_wrapper=Vh;try{window.__SUPABASE_URL=Nc}catch{}try{window.__SUPABASE_KEY=Sc}catch{}}try{if(typeof window<"u"){const e=()=>{try{const t=localStorage.getItem("custom-auth-token");if(t&&t.trim()){re.realtime.setAuth(t.trim());return}let r="";try{r=(new URL(Nc).host||"").split(".")[0]||""}catch{}const n=r?`sb-${r}-auth-token`:"sb-auth-token",s=localStorage.getItem(n);if(s){const o=JSON.parse(s),i=o?.access_token||o?.currentSession?.access_token;i&&re.realtime.setAuth(i)}}catch{}};e();try{window.addEventListener("storage",t=>{try{const r=t?.key||"";(r==="custom-auth-token"||r.startsWith("sb-"))&&e()}catch{}})}catch{}}}catch{}const MY=p.createContext({}),qs=()=>{const e=p.useContext(MY);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Ewe=({children:e})=>{const[t,r]=p.useState(null),[n,s]=p.useState(null),[o,i]=p.useState(null),[l,c]=p.useState(!0),[d,u]=p.useState(!1),f=p.useRef(null),h=p.useRef(!1),m=(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}})();p.useEffect(()=>{if((()=>{try{return sessionStorage.getItem("auth:forceLogout")==="1"}catch{return!1}})()){try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company")}catch{}r(null),s(null),i(null),u(!0),c(!1);try{sessionStorage.removeItem("auth:forceLogout")}catch{}try{re.auth.signOut({scope:"global"}).catch(()=>{})}catch{}return}try{const A=localStorage.getItem("auth:userProfile"),P=localStorage.getItem("auth:company");A&&s(JSON.parse(A)),P&&i(JSON.parse(P)),(A||P)&&u(!0)}catch(A){console.warn("AuthContext: falha ao hidratar cache local:",A)}(async()=>{try{if(m)try{const F=localStorage.getItem("custom-auth-token");if(F&&F.trim()){const I=JSON.parse(atob(F.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")))?.sub||null;if(I){r({id:I}),u(!0),await x(I),f.current=I,c(!1);return}}}catch{}const{data:{session:A},error:P}=await re.auth.getSession();P&&console.error("supabase.auth.getSession error:",P),A?.user?(r(A.user),u(!0),await x(A.user.id),f.current=A.user.id):u(!0)}catch(A){console.error("getSession exception:",A)}finally{c(!1)}})();const{data:S}=re.auth.onAuthStateChange(async(A,P)=>{console.log("[AuthContext] onAuthStateChange",{event:A,userId:P?.user?.id||null});try{if(A==="SIGNED_OUT"){try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company")}catch{}r(null),s(null),i(null),f.current=null,h.current=!1,c(!1),u(!0);return}if(m){u(!0),c(!1);return}const F=P?.user||null;r(F),u(!0),F?.id&&(await x(F.id),f.current=F.id,c(!1))}catch(F){console.error("onAuthStateChange handler error:",F),c(!1),u(!0)}}),C=setTimeout(()=>{c(A=>A&&!1),u(A=>A||!0)},12e3);return()=>{clearTimeout(C),S.subscription.unsubscribe()}},[]),p.useEffect(()=>{(async()=>{try{if(!d||!t)return;const j=!n,S=!!n&&!o&&!!n.codigo_empresa;(j||S)&&(await x(t.id),f.current=t.id)}catch{}})()},[d,t?.id,!!n,n?.codigo_empresa,!!o]),p.useEffect(()=>{const _=()=>{try{const C=localStorage.getItem("auth:userProfile"),A=localStorage.getItem("auth:company");if(C){const P=JSON.parse(C);(!n||!n.codigo_empresa)&&s(P)}if(A){const P=JSON.parse(A);(!o||!o.codigo_empresa)&&i(P)}}catch{}},j=()=>{_(),t?.id&&x(t.id).catch(()=>{})},S=()=>{document.visibilityState==="visible"&&j()};return window.addEventListener("focus",j),document.addEventListener("visibilitychange",S),()=>{window.removeEventListener("focus",j),document.removeEventListener("visibilitychange",S)}},[t?.id]);const x=async _=>{if(h.current){console.log("[AuthDebug] loadUserProfile:skip (already running)");return}h.current=!0;try{const j=[300,800,1600,3e3],S=P=>new Promise(F=>setTimeout(F,P)),C=async(P,F)=>{let O;try{const I=new Promise(k=>{O=setTimeout(()=>k({__timeout:!0}),F)});return await Promise.race([P,I])}finally{clearTimeout(O)}},A=1200;for(let P=0;P<=j.length;P++){console.log("[AuthDebug] loadUserProfile:start",{userId:_,attempt:P});try{console.log("[AuthDebug] querying colaboradores",{userId:_});const F=re.from("colaboradores").select("*").eq("id",_).single(),O=await C(F,A);if(O&&O.__timeout){console.warn("[AuthDebug] colaboradores:timeout, using usuarios fallback (inline)");try{console.log("[AuthDebug] fallback-inline: querying usuarios by id");const{data:k,error:B}=await re.from("usuarios").select("*").eq("id",_).maybeSingle();if(!B&&k){let z=null;if(k.codigo_empresa){console.log("[AuthDebug] fallback-inline: querying empresas by codigo",{codigo_empresa:k.codigo_empresa});const{data:L,error:W}=await re.from("empresas").select("*").eq("codigo_empresa",k.codigo_empresa).single();W?console.warn("[AuthDebug] fallback-inline: empresa error",{status:W.status,code:W.code,message:W.message}):(z=L,console.log("[AuthDebug] fallback-inline: empresa loaded"))}const U={id:_,nome:k.nome||null,cargo:k.papel||"user",codigo_empresa:k.codigo_empresa||null,_source:"usuarios"};s(U);try{localStorage.setItem("auth:userProfile",JSON.stringify(U))}catch{}if(z){i(z);try{localStorage.setItem("auth:company",JSON.stringify(z))}catch{}console.log("[AuthDebug] fallback-inline: set company from usuarios path")}else console.warn("[AuthDebug] fallback-inline: no company resolved; preserving previous company");return}B&&console.warn("[AuthDebug] fallback-inline: usuarios error",{status:B.status,code:B.code,message:B.message})}catch(k){console.warn("[AuthDebug] fallback-inline: unexpected error",k?.message||k)}if(P<j.length){await S(j[P]);continue}return}const{data:I,error:T}=O||{};if(console.log("[AuthDebug] colaboradores:success",{hasProfile:!!I,codigo_empresa:I?.codigo_empresa||null}),T){if(console.warn("[AuthDebug] colaboradores:error",{code:T.code,status:T.status,message:T.message}),T.code==="42P17"){if(P<j.length){await S(j[P]);continue}console.warn("RLS recursion (42P17) persistente ao carregar perfil. Prosseguindo sem alterar cache.");return}if([401,403].includes(Number(T.status))&&(console.warn("[AuthDebug] Erro de autorizao detectado, tentando fallback"),P<j.length)){await S(j[P]);continue}if(T.code==="PGRST116"){try{console.log("[AuthDebug] fallback: querying usuarios by id");const{data:B,error:z}=await re.from("usuarios").select("*").eq("id",_).maybeSingle();if(!z&&B){let U=null;if(B.codigo_empresa){console.log("[AuthDebug] fallback: querying empresas by codigo",{codigo_empresa:B.codigo_empresa});const{data:W,error:ge}=await re.from("empresas").select("*").eq("codigo_empresa",B.codigo_empresa).single();ge?console.warn("[AuthDebug] fallback: empresa error",{status:ge.status,code:ge.code,message:ge.message}):(U=W,console.log("[AuthDebug] fallback: empresa loaded"))}const L={id:_,nome:B.nome||null,cargo:B.papel||"user",codigo_empresa:B.codigo_empresa||null,_source:"usuarios"};s(L);try{localStorage.setItem("auth:userProfile",JSON.stringify(L))}catch{}if(U){i(U);try{localStorage.setItem("auth:company",JSON.stringify(U))}catch{}console.log("[AuthDebug] fallback: set company from usuarios path")}else console.warn("[AuthDebug] fallback: no company resolved; preserving previous company");return}z&&console.warn("[AuthDebug] fallback: usuarios error",{status:z.status,code:z.code,message:z.message})}catch{}console.warn("AuthContext: perfil no encontrado (PGRST116) e fallback falhou; mantendo cache atual.");return}if([401,403,406].includes(Number(T.status))&&P<j.length){await S(j[P]);continue}throw T}if(!I){if(P<j.length){await S(j[P]);continue}return}s(I);try{localStorage.setItem("auth:userProfile",JSON.stringify(I))}catch{}if(I?.codigo_empresa){console.log("[AuthDebug] company: querying empresas by codigo from colaboradores",{codigo_empresa:I.codigo_empresa});const{data:k,error:B}=await re.from("empresas").select("*").eq("codigo_empresa",I.codigo_empresa).single();if(B){if([401,403,406].includes(Number(B.status))&&P<j.length){await S(j[P]);continue}console.warn("[AuthDebug] company: load error; preserving previous company",{status:B.status,code:B.code,message:B.message});return}else{i(k);try{localStorage.setItem("auth:company",JSON.stringify(k))}catch{}console.log("[AuthDebug] company: set from colaboradores path")}}else console.warn("[AuthDebug] company: no codigo_empresa available on profile; preserving previous company");return}catch(F){if(console.error("[AuthDebug] loadUserProfile:unexpected error",{message:F?.message,code:F?.code,status:F?.status}),P<j.length){await S(j[P]);continue}console.error("Error loading user profile:",F);return}}}finally{h.current=!1}},w={user:t,userProfile:n,company:o,loading:l,authReady:d,signUp:async(_,j,S,C=null)=>{try{const{data:A,error:P}=await re.auth.signUp({email:_,password:j});if(P)throw P;if(A?.user&&C){const{data:F,error:O}=await re.from("empresas").select("id, codigo_empresa").eq("codigo_empresa",C).single();if(O)throw new Error("Cdigo de empresa invlido. Verifique o cdigo informado.");const{error:I}=await re.from("colaboradores").insert({id:A.user.id,codigo_empresa:F.codigo_empresa,nome:S,cargo:"user",ativo:!0});if(I)throw I}return{data:A,error:null}}catch(A){let P="No foi possvel cadastrar. Verifique os dados e tente novamente.";const F=(A?.message||"").toLowerCase();return F.includes("user already registered")||F.includes("already registered")||F.includes("user already exists")?P="Email j cadastrado. Tente entrar ou redefinir a senha.":F.includes("password")&&F.includes("length")&&(P="Senha muito curta. Use ao menos 6 caracteres."),{data:null,error:new Error(P)}}},signIn:async(_,j)=>{try{if(m){const A=yO,P=bO,F=await fetch(`${A}/rest/v1/rpc/auth_login_dev`,{method:"POST",headers:{"Content-Type":"application/json",apikey:P,Authorization:`Bearer ${P}`},body:JSON.stringify({p_email:_,p_password:j})});if(!F.ok){const k=await F.text().catch(()=>"");let B="No foi possvel entrar. Tente novamente.";return F.status===401&&(B="Email ou senha invlidos."),F.status===423&&(B="Usurio bloqueado temporariamente."),{data:null,error:new Error(B+(k?` (${k})`:""))}}const I=(await F.json())?.access_token||"",T=(()=>{try{return JSON.parse(atob(I.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))).sub}catch{return null}})();try{localStorage.setItem("custom-auth-token",I)}catch{}return T&&(r({id:T}),u(!0),await x(T),f.current=T),{data:{user:T?{id:T}:null},error:null}}const{data:S,error:C}=await re.auth.signInWithPassword({email:_,password:j});if(C){let A="No foi possvel entrar. Tente novamente.";const P=(C.message||"").toLowerCase(),F=C.status;return P.includes("invalid login")||P.includes("invalid credentials")||F===400?A="Email ou senha invlidos.":P.includes("email not confirmed")||P.includes("not confirmed")?A="Email no confirmado. Verifique sua caixa de entrada.":F===429?A="Muitas tentativas. Aguarde alguns minutos e tente novamente.":F>=500&&(A="Servio indisponvel no momento. Tente novamente mais tarde."),{data:null,error:new Error(A)}}return S.user&&await re.from("colaboradores").select("id").eq("id",S.user.id).single(),{data:S,error:null}}catch(S){return{data:null,error:S}}},signOut:async()=>{try{localStorage.removeItem("custom-auth-token")}catch{}try{const _=re.auth.signOut({scope:"global"}),j=new Promise(S=>setTimeout(S,700));await Promise.race([_,j])}catch(_){console.warn("[AuthContext] signOut(): error during signOut",_?.message||_)}f.current=null,r(null),s(null),i(null),c(!1),u(!0);try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company"),localStorage.removeItem("clientes:list"),localStorage.removeItem("quadras:list"),localStorage.removeItem("agenda:courts"),localStorage.removeItem("agenda:selectedCourts"),localStorage.removeItem("agenda:viewFilter"),Object.keys(localStorage).filter(_=>_.startsWith("agenda:bookings:")).forEach(_=>localStorage.removeItem(_)),Object.keys(localStorage).filter(_=>_.startsWith("sb-")).forEach(_=>localStorage.removeItem(_)),Object.keys(sessionStorage).filter(_=>_.startsWith("sb-")).forEach(_=>sessionStorage.removeItem(_))}catch{}try{sessionStorage.setItem("auth:forceLogout","1")}catch{}try{window.location.replace("/")}catch{}return{error:null}},reloadCompany:async()=>{try{const _=n&&n.codigo_empresa?n.codigo_empresa:null;if(!_)return;const{data:j,error:S}=await re.from("empresas").select("*").eq("codigo_empresa",_).single();if(!S&&j){i(j);try{localStorage.setItem("auth:company",JSON.stringify(j))}catch{}}}catch{}}};return a.jsx(MY.Provider,{value:w,children:e})};function cs(e){"@babel/helpers - typeof";return cs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cs(e)}function Ko(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function fa(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function $a(e){fa(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||cs(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function rs(e,t){fa(2,arguments);var r=$a(e),n=Ko(t);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function Uu(e,t){fa(2,arguments);var r=$a(e),n=Ko(t);if(isNaN(n))return new Date(NaN);if(!n)return r;var s=r.getDate(),o=new Date(r.getTime());o.setMonth(r.getMonth()+n+1,0);var i=o.getDate();return s>=i?o:(r.setFullYear(o.getFullYear(),o.getMonth(),s),r)}function RY(e,t){fa(2,arguments);var r=$a(e).getTime(),n=Ko(t);return new Date(r+n)}var kwe={};function _p(){return kwe}function ou(e,t){var r,n,s,o,i,l,c,d;fa(1,arguments);var u=_p(),f=Ko((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=$a(e),m=h.getDay(),x=(m<f?7:0)+m-f;return h.setDate(h.getDate()-x),h.setHours(0,0,0,0),h}function Wg(e){return fa(1,arguments),ou(e,{weekStartsOn:1})}function Iwe(e){fa(1,arguments);var t=$a(e),r=t.getFullYear(),n=new Date(0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);var s=Wg(n),o=new Date(0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);var i=Wg(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=i.getTime()?r:r-1}function Owe(e){fa(1,arguments);var t=Iwe(e),r=new Date(0);r.setFullYear(t,0,4),r.setHours(0,0,0,0);var n=Wg(r);return n}function Fw(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function so(e){fa(1,arguments);var t=$a(e);return t.setHours(0,0,0,0),t}var Twe=864e5;function yf(e,t){fa(2,arguments);var r=so(e),n=so(t),s=r.getTime()-Fw(r),o=n.getTime()-Fw(n);return Math.round((s-o)/Twe)}var Dwe=6e4;function d8(e,t){fa(2,arguments);var r=Ko(t);return RY(e,r*Dwe)}function wO(e,t){fa(2,arguments);var r=Ko(t),n=r*7;return rs(e,n)}function Mwe(e,t){fa(2,arguments);var r=Ko(t);return Uu(e,r*12)}function Rwe(e){fa(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(cs(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var r;return t.forEach(function(n){var s=$a(n);(r===void 0||r<s||isNaN(Number(s)))&&(r=s)}),r||new Date(NaN)}function Fwe(e){fa(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(cs(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var r;return t.forEach(function(n){var s=$a(n);(r===void 0||r>s||isNaN(s.getDate()))&&(r=s)}),r||new Date(NaN)}var FY=6e4,LY=36e5;function Dl(e,t){fa(2,arguments);var r=so(e),n=so(t);return r.getTime()===n.getTime()}function QD(e){return fa(1,arguments),e instanceof Date||cs(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Lwe(e){if(fa(1,arguments),!QD(e)&&typeof e!="number")return!1;var t=$a(e);return!isNaN(Number(t))}function Lw(e,t){fa(2,arguments);var r=$a(e),n=$a(t),s=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return s*12+o}var $we=6048e5;function Bwe(e,t,r){fa(2,arguments);var n=ou(e,r),s=ou(t,r),o=n.getTime()-Fw(n),i=s.getTime()-Fw(s);return Math.round((o-i)/$we)}function u8(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function qwe(e,t){fa(2,arguments);var r=$a(e),n=$a(t),s=u8(r,n),o=Math.abs(yf(r,n));r.setDate(r.getDate()-s*o);var i=+(u8(r,n)===-s),l=s*(o-i);return l===0?0:l}function Ej(e){fa(1,arguments);var t=$a(e);return t.setHours(23,59,59,999),t}function i5(e){fa(1,arguments);var t=$a(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function cc(e){fa(1,arguments);var t=$a(e);return t.setDate(1),t.setHours(0,0,0,0),t}function zwe(e){fa(1,arguments);var t=$a(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function ZD(e,t){var r,n,s,o,i,l,c,d;fa(1,arguments);var u=_p(),f=Ko((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=$a(e),m=h.getDay(),x=(m<f?-7:0)+6-(m-f);return h.setDate(h.getDate()+x),h.setHours(23,59,59,999),h}function $Y(e){return fa(1,arguments),ZD(e,{weekStartsOn:1})}function Uwe(e,t){fa(2,arguments);var r=Ko(t);return RY(e,-r)}var Vwe=864e5;function Wwe(e){fa(1,arguments);var t=$a(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=t.getTime(),s=r-n;return Math.floor(s/Vwe)+1}function ON(e){fa(1,arguments);var t=1,r=$a(e),n=r.getUTCDay(),s=(n<t?7:0)+n-t;return r.setUTCDate(r.getUTCDate()-s),r.setUTCHours(0,0,0,0),r}function BY(e){fa(1,arguments);var t=$a(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var s=ON(n),o=new Date(0);o.setUTCFullYear(r,0,4),o.setUTCHours(0,0,0,0);var i=ON(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=i.getTime()?r:r-1}function Hwe(e){fa(1,arguments);var t=BY(e),r=new Date(0);r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0);var n=ON(r);return n}var Gwe=6048e5;function Kwe(e){fa(1,arguments);var t=$a(e),r=ON(t).getTime()-Hwe(t).getTime();return Math.round(r/Gwe)+1}function TN(e,t){var r,n,s,o,i,l,c,d;fa(1,arguments);var u=_p(),f=Ko((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=$a(e),m=h.getUTCDay(),x=(m<f?7:0)+m-f;return h.setUTCDate(h.getUTCDate()-x),h.setUTCHours(0,0,0,0),h}function qY(e,t){var r,n,s,o,i,l,c,d;fa(1,arguments);var u=$a(e),f=u.getUTCFullYear(),h=_p(),m=Ko((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setUTCFullYear(f+1,0,m),x.setUTCHours(0,0,0,0);var g=TN(x,t),y=new Date(0);y.setUTCFullYear(f,0,m),y.setUTCHours(0,0,0,0);var v=TN(y,t);return u.getTime()>=g.getTime()?f+1:u.getTime()>=v.getTime()?f:f-1}function Xwe(e,t){var r,n,s,o,i,l,c,d;fa(1,arguments);var u=_p(),f=Ko((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:u.firstWeekContainsDate)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=qY(e,t),m=new Date(0);m.setUTCFullYear(h,0,f),m.setUTCHours(0,0,0,0);var x=TN(m,t);return x}var Ywe=6048e5;function Jwe(e,t){fa(1,arguments);var r=$a(e),n=TN(r,t).getTime()-Xwe(r,t).getTime();return Math.round(n/Ywe)+1}function $s(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var Qwe={y:function(t,r){var n=t.getUTCFullYear(),s=n>0?n:1-n;return $s(r==="yy"?s%100:s,r.length)},M:function(t,r){var n=t.getUTCMonth();return r==="M"?String(n+1):$s(n+1,2)},d:function(t,r){return $s(t.getUTCDate(),r.length)},a:function(t,r){var n=t.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(t,r){return $s(t.getUTCHours()%12||12,r.length)},H:function(t,r){return $s(t.getUTCHours(),r.length)},m:function(t,r){return $s(t.getUTCMinutes(),r.length)},s:function(t,r){return $s(t.getUTCSeconds(),r.length)},S:function(t,r){var n=r.length,s=t.getUTCMilliseconds(),o=Math.floor(s*Math.pow(10,n-3));return $s(o,r.length)}};const Qm=Qwe;var Mx={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Zwe={G:function(t,r,n){var s=t.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){var s=t.getUTCFullYear(),o=s>0?s:1-s;return n.ordinalNumber(o,{unit:"year"})}return Qm.y(t,r)},Y:function(t,r,n,s){var o=qY(t,s),i=o>0?o:1-o;if(r==="YY"){var l=i%100;return $s(l,2)}return r==="Yo"?n.ordinalNumber(i,{unit:"year"}):$s(i,r.length)},R:function(t,r){var n=BY(t);return $s(n,r.length)},u:function(t,r){var n=t.getUTCFullYear();return $s(n,r.length)},Q:function(t,r,n){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"Q":return String(s);case"QQ":return $s(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,r,n){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"q":return String(s);case"qq":return $s(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,r,n){var s=t.getUTCMonth();switch(r){case"M":case"MM":return Qm.M(t,r);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(t,r,n){var s=t.getUTCMonth();switch(r){case"L":return String(s+1);case"LL":return $s(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(t,r,n,s){var o=Jwe(t,s);return r==="wo"?n.ordinalNumber(o,{unit:"week"}):$s(o,r.length)},I:function(t,r,n){var s=Kwe(t);return r==="Io"?n.ordinalNumber(s,{unit:"week"}):$s(s,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):Qm.d(t,r)},D:function(t,r,n){var s=Wwe(t);return r==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):$s(s,r.length)},E:function(t,r,n){var s=t.getUTCDay();switch(r){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(t,r,n,s){var o=t.getUTCDay(),i=(o-s.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return $s(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});case"eeee":default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(t,r,n,s){var o=t.getUTCDay(),i=(o-s.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return $s(i,r.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});case"cccc":default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(t,r,n){var s=t.getUTCDay(),o=s===0?7:s;switch(r){case"i":return String(o);case"ii":return $s(o,r.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(t,r,n){var s=t.getUTCHours(),o=s/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(t,r,n){var s=t.getUTCHours(),o;switch(s===12?o=Mx.noon:s===0?o=Mx.midnight:o=s/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(t,r,n){var s=t.getUTCHours(),o;switch(s>=17?o=Mx.evening:s>=12?o=Mx.afternoon:s>=4?o=Mx.morning:o=Mx.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){var s=t.getUTCHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return Qm.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Qm.H(t,r)},K:function(t,r,n){var s=t.getUTCHours()%12;return r==="Ko"?n.ordinalNumber(s,{unit:"hour"}):$s(s,r.length)},k:function(t,r,n){var s=t.getUTCHours();return s===0&&(s=24),r==="ko"?n.ordinalNumber(s,{unit:"hour"}):$s(s,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Qm.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Qm.s(t,r)},S:function(t,r){return Qm.S(t,r)},X:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();if(i===0)return"Z";switch(r){case"X":return m8(i);case"XXXX":case"XX":return Yp(i);case"XXXXX":case"XXX":default:return Yp(i,":")}},x:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"x":return m8(i);case"xxxx":case"xx":return Yp(i);case"xxxxx":case"xxx":default:return Yp(i,":")}},O:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+f8(i,":");case"OOOO":default:return"GMT"+Yp(i,":")}},z:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+f8(i,":");case"zzzz":default:return"GMT"+Yp(i,":")}},t:function(t,r,n,s){var o=s._originalDate||t,i=Math.floor(o.getTime()/1e3);return $s(i,r.length)},T:function(t,r,n,s){var o=s._originalDate||t,i=o.getTime();return $s(i,r.length)}};function f8(e,t){var r=e>0?"-":"+",n=Math.abs(e),s=Math.floor(n/60),o=n%60;if(o===0)return r+String(s);var i=t||"";return r+String(s)+i+$s(o,2)}function m8(e,t){if(e%60===0){var r=e>0?"-":"+";return r+$s(Math.abs(e)/60,2)}return Yp(e,t)}function Yp(e,t){var r=t||"",n=e>0?"-":"+",s=Math.abs(e),o=$s(Math.floor(s/60),2),i=$s(s%60,2);return n+o+r+i}const e1e=Zwe;var h8=function(t,r){switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},zY=function(t,r){switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},t1e=function(t,r){var n=t.match(/(P+)(p+)?/)||[],s=n[1],o=n[2];if(!o)return h8(t,r);var i;switch(s){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;case"PPPP":default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",h8(s,r)).replace("{{time}}",zY(o,r))},r1e={p:zY,P:t1e};const n1e=r1e;var a1e=["D","DD"],s1e=["YY","YYYY"];function o1e(e){return a1e.indexOf(e)!==-1}function i1e(e){return s1e.indexOf(e)!==-1}function p8(e,t,r){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var l1e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},c1e=function(t,r,n){var s,o=l1e[t];return typeof o=="string"?s=o:r===1?s=o.one:s=o.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};const d1e=c1e;function Rv(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth,n=e.formats[r]||e.formats[e.defaultWidth];return n}}var u1e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},f1e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},m1e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},h1e={date:Rv({formats:u1e,defaultWidth:"full"}),time:Rv({formats:f1e,defaultWidth:"full"}),dateTime:Rv({formats:m1e,defaultWidth:"full"})};const p1e=h1e;var g1e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},x1e=function(t,r,n,s){return g1e[t]};const v1e=x1e;function hf(e){return function(t,r){var n=r!=null&&r.context?String(r.context):"standalone",s;if(n==="formatting"&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):o;s=e.formattingValues[i]||e.formattingValues[o]}else{var l=e.defaultWidth,c=r!=null&&r.width?String(r.width):e.defaultWidth;s=e.values[c]||e.values[l]}var d=e.argumentCallback?e.argumentCallback(t):t;return s[d]}}var y1e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},b1e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},w1e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},_1e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},j1e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},N1e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},S1e=function(t,r){var n=Number(t),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},C1e={ordinalNumber:S1e,era:hf({values:y1e,defaultWidth:"wide"}),quarter:hf({values:b1e,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:hf({values:w1e,defaultWidth:"wide"}),day:hf({values:_1e,defaultWidth:"wide"}),dayPeriod:hf({values:j1e,defaultWidth:"wide",formattingValues:N1e,defaultFormattingWidth:"wide"})};const A1e=C1e;function pf(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(s);if(!o)return null;var i=o[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?E1e(l,function(f){return f.test(i)}):P1e(l,function(f){return f.test(i)}),d;d=e.valueCallback?e.valueCallback(c):c,d=r.valueCallback?r.valueCallback(d):d;var u=t.slice(i.length);return{value:d,rest:u}}}function P1e(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r}function E1e(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r}function UY(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.match(e.matchPattern);if(!n)return null;var s=n[0],o=t.match(e.parsePattern);if(!o)return null;var i=e.valueCallback?e.valueCallback(o[0]):o[0];i=r.valueCallback?r.valueCallback(i):i;var l=t.slice(s.length);return{value:i,rest:l}}}var k1e=/^(\d+)(th|st|nd|rd)?/i,I1e=/\d+/i,O1e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},T1e={any:[/^b/i,/^(a|c)/i]},D1e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},M1e={any:[/1/i,/2/i,/3/i,/4/i]},R1e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},F1e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},L1e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},$1e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},B1e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},q1e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},z1e={ordinalNumber:UY({matchPattern:k1e,parsePattern:I1e,valueCallback:function(t){return parseInt(t,10)}}),era:pf({matchPatterns:O1e,defaultMatchWidth:"wide",parsePatterns:T1e,defaultParseWidth:"any"}),quarter:pf({matchPatterns:D1e,defaultMatchWidth:"wide",parsePatterns:M1e,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:pf({matchPatterns:R1e,defaultMatchWidth:"wide",parsePatterns:F1e,defaultParseWidth:"any"}),day:pf({matchPatterns:L1e,defaultMatchWidth:"wide",parsePatterns:$1e,defaultParseWidth:"any"}),dayPeriod:pf({matchPatterns:B1e,defaultMatchWidth:"any",parsePatterns:q1e,defaultParseWidth:"any"})};const U1e=z1e;var V1e={code:"en-US",formatDistance:d1e,formatLong:p1e,formatRelative:v1e,localize:A1e,match:U1e,options:{weekStartsOn:0,firstWeekContainsDate:1}};const VY=V1e;var W1e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,H1e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,G1e=/^'([^]*?)'?$/,K1e=/''/g,X1e=/[a-zA-Z]/;function sr(e,t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,y,v,b,w,_;fa(2,arguments);var j=String(t),S=_p(),C=(n=(s=r?.locale)!==null&&s!==void 0?s:S.locale)!==null&&n!==void 0?n:VY,A=Ko((o=(i=(l=(c=r?.firstWeekContainsDate)!==null&&c!==void 0?c:r==null||(d=r.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&l!==void 0?l:S.firstWeekContainsDate)!==null&&i!==void 0?i:(f=S.locale)===null||f===void 0||(h=f.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(A>=1&&A<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var P=Ko((m=(x=(g=(y=r?.weekStartsOn)!==null&&y!==void 0?y:r==null||(v=r.locale)===null||v===void 0||(b=v.options)===null||b===void 0?void 0:b.weekStartsOn)!==null&&g!==void 0?g:S.weekStartsOn)!==null&&x!==void 0?x:(w=S.locale)===null||w===void 0||(_=w.options)===null||_===void 0?void 0:_.weekStartsOn)!==null&&m!==void 0?m:0);if(!(P>=0&&P<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!C.localize)throw new RangeError("locale must contain localize property");if(!C.formatLong)throw new RangeError("locale must contain formatLong property");var F=$a(e);if(!Lwe(F))throw new RangeError("Invalid time value");var O=Fw(F),I=Uwe(F,O),T={firstWeekContainsDate:A,weekStartsOn:P,locale:C,_originalDate:F},k=j.match(H1e).map(function(B){var z=B[0];if(z==="p"||z==="P"){var U=n1e[z];return U(B,C.formatLong)}return B}).join("").match(W1e).map(function(B){if(B==="''")return"'";var z=B[0];if(z==="'")return Y1e(B);var U=e1e[z];if(U)return!(r!=null&&r.useAdditionalWeekYearTokens)&&i1e(B)&&p8(B,t,String(e)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&o1e(B)&&p8(B,t,String(e)),U(I,B,C.localize,T);if(z.match(X1e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+z+"`");return B}).join("");return k}function Y1e(e){var t=e.match(G1e);return t?t[1].replace(K1e,"'"):e}function J1e(e){fa(1,arguments);var t=$a(e),r=t.getFullYear(),n=t.getMonth(),s=new Date(0);return s.setFullYear(r,n+1,0),s.setHours(0,0,0,0),s.getDate()}function kd(e){fa(1,arguments);var t=$a(e),r=t.getHours();return r}var Q1e=6048e5;function Z1e(e){fa(1,arguments);var t=$a(e),r=Wg(t).getTime()-Owe(t).getTime();return Math.round(r/Q1e)+1}function Id(e){fa(1,arguments);var t=$a(e),r=t.getMinutes();return r}function e2e(e){fa(1,arguments);var t=$a(e),r=t.getTime();return r}function t2e(e){return fa(1,arguments),Math.floor(e2e(e)/1e3)}function r2e(e,t){var r,n,s,o,i,l,c,d;fa(1,arguments);var u=$a(e),f=u.getFullYear(),h=_p(),m=Ko((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setFullYear(f+1,0,m),x.setHours(0,0,0,0);var g=ou(x,t),y=new Date(0);y.setFullYear(f,0,m),y.setHours(0,0,0,0);var v=ou(y,t);return u.getTime()>=g.getTime()?f+1:u.getTime()>=v.getTime()?f:f-1}function n2e(e,t){var r,n,s,o,i,l,c,d;fa(1,arguments);var u=_p(),f=Ko((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:u.firstWeekContainsDate)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=r2e(e,t),m=new Date(0);m.setFullYear(h,0,f),m.setHours(0,0,0,0);var x=ou(m,t);return x}var a2e=6048e5;function s2e(e,t){fa(1,arguments);var r=$a(e),n=ou(r,t).getTime()-n2e(r,t).getTime();return Math.round(n/a2e)+1}function o2e(e){fa(1,arguments);var t=$a(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function i2e(e,t){return fa(1,arguments),Bwe(o2e(e),cc(e),t)+1}function _O(e,t){fa(2,arguments);var r=$a(e),n=$a(t);return r.getTime()>n.getTime()}function WY(e,t){fa(2,arguments);var r=$a(e),n=$a(t);return r.getTime()<n.getTime()}function g8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l2e(e,t){if(e){if(typeof e=="string")return g8(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g8(e,t):void 0}}function jO(e,t){return jO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},jO(e,t)}function c2e(e,t){if(cs(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(cs(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function d2e(e){var t=c2e(e,"string");return cs(t)=="symbol"?t:t+""}function u2e(e,t,r){return(t=d2e(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eM(e,t){fa(2,arguments);var r=$a(e),n=$a(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function f2e(e,t){fa(2,arguments);var r=$a(e),n=$a(t);return r.getFullYear()===n.getFullYear()}function Fv(e,t){fa(2,arguments);var r=Ko(t);return rs(e,-r)}function x8(e,t){var r;fa(1,arguments);var n=Ko((r=t?.additionalDigits)!==null&&r!==void 0?r:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var s=g2e(e),o;if(s.date){var i=x2e(s.date,n);o=v2e(i.restDateString,i.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var l=o.getTime(),c=0,d;if(s.time&&(c=y2e(s.time),isNaN(c)))return new Date(NaN);if(s.timezone){if(d=b2e(s.timezone),isNaN(d))return new Date(NaN)}else{var u=new Date(l+c),f=new Date(0);return f.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),f.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),f}return new Date(l+c+d)}var __={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},m2e=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,h2e=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,p2e=/^([+-])(\d{2})(?::?(\d{2}))?$/;function g2e(e){var t={},r=e.split(__.dateTimeDelimiter),n;if(r.length>2)return t;if(/:/.test(r[0])?n=r[0]:(t.date=r[0],n=r[1],__.timeZoneDelimiter.test(t.date)&&(t.date=e.split(__.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){var s=__.timezone.exec(n);s?(t.time=n.replace(s[1],""),t.timezone=s[1]):t.time=n}return t}function x2e(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};var s=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?s:o*100,restDateString:e.slice((n[1]||n[2]).length)}}function v2e(e,t){if(t===null)return new Date(NaN);var r=e.match(m2e);if(!r)return new Date(NaN);var n=!!r[4],s=qy(r[1]),o=qy(r[2])-1,i=qy(r[3]),l=qy(r[4]),c=qy(r[5])-1;if(n)return S2e(t,l,c)?w2e(t,l,c):new Date(NaN);var d=new Date(0);return!j2e(t,o,i)||!N2e(t,s)?new Date(NaN):(d.setUTCFullYear(t,o,Math.max(s,i)),d)}function qy(e){return e?parseInt(e):1}function y2e(e){var t=e.match(h2e);if(!t)return NaN;var r=aE(t[1]),n=aE(t[2]),s=aE(t[3]);return C2e(r,n,s)?r*LY+n*FY+s*1e3:NaN}function aE(e){return e&&parseFloat(e.replace(",","."))||0}function b2e(e){if(e==="Z")return 0;var t=e.match(p2e);if(!t)return 0;var r=t[1]==="+"?-1:1,n=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return A2e(n,s)?r*(n*LY+s*FY):NaN}function w2e(e,t,r){var n=new Date(0);n.setUTCFullYear(e,0,4);var s=n.getUTCDay()||7,o=(t-1)*7+r+1-s;return n.setUTCDate(n.getUTCDate()+o),n}var _2e=[31,null,31,30,31,30,31,31,30,31,30,31];function HY(e){return e%400===0||e%4===0&&e%100!==0}function j2e(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(_2e[t]||(HY(e)?29:28))}function N2e(e,t){return t>=1&&t<=(HY(e)?366:365)}function S2e(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function C2e(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function A2e(e,t){return t>=0&&t<=59}function sE(e,t){fa(2,arguments);var r=$a(e),n=Ko(t),s=r.getFullYear(),o=r.getDate(),i=new Date(0);i.setFullYear(s,n,15),i.setHours(0,0,0,0);var l=J1e(i);return r.setMonth(n,Math.min(o,l)),r}function j_(e,t){fa(2,arguments);var r=$a(e),n=Ko(t);return r.setHours(n),r}function N_(e,t){fa(2,arguments);var r=$a(e),n=Ko(t);return r.setMinutes(n),r}function v8(e,t){fa(2,arguments);var r=$a(e),n=Ko(t);return isNaN(r.getTime())?new Date(NaN):(r.setFullYear(n),r)}const GY=p.createContext(),P2e=({children:e})=>{const{userProfile:t}=qs(),r=wi(),[n,s]=p.useState([]),[o,i]=p.useState(!1),[l,c]=p.useState(!1),[d,u]=p.useState(!1),f=p.useRef(r.pathname),h=p.useRef(!1),m=p.useRef(null),[x,g]=p.useState(null),y=p.useRef([]),v=p.useRef(null),b=p.useRef(!1);p.useEffect(()=>{y.current=n},[n]);const w=p.useCallback(()=>`alerts:persisted:isis:${t?.codigo_empresa||"na"}`,[t?.codigo_empresa]),_=p.useCallback(()=>{try{const O=localStorage.getItem(w()),I=O?JSON.parse(O):[];return Array.isArray(I)?I.filter(T=>T&&T.tipo==="isis-event"&&T.id):[]}catch{return[]}},[w]),j=p.useCallback(O=>{try{localStorage.setItem(w(),JSON.stringify(O||[]))}catch{}},[w]),S=p.useCallback(O=>{if(!O)return;s(k=>Array.isArray(k)?k.filter(B=>B?.id!==O):[]);const T=_().filter(k=>k?.id!==O);j(T)},[_,j]),C=p.useCallback(()=>document.querySelectorAll('[role="dialog"]').length>0,[]),A=p.useCallback(async()=>{if(t?.codigo_empresa)try{u(!0);const O=t.codigo_empresa,I=new Date,T=so(I).toISOString(),k=Ej(I).toISOString(),B=[],{data:z}=await re.from("produtos").select("nome, estoque, estoque_minimo, status").eq("codigo_empresa",O).not("estoque_minimo","is",null),U=(z||[]).filter(ae=>{const oe=Number(ae.estoque||0),me=Number(ae.estoque_minimo||0);return oe<=me&&me>0});U.length>0&&B.push({tipo:"estoque",icone:"Package",cor:"danger",mensagem:`${U.length} produto${U.length>1?"s":""} com estoque baixo`,link:"/produtos"});const{data:L}=await re.from("agendamento_participantes").select("id, agendamento_id").eq("codigo_empresa",O).eq("status_pagamento","Pendente");if(L&&L.length>0){const ae=[...new Set(L.map(ne=>ne.agendamento_id))],{data:oe}=await re.from("agendamentos").select("id, inicio, status").in("id",ae).not("status","in","(canceled,absent)").order("inicio",{ascending:!0}),me=new Set((oe||[]).map(ne=>ne.id)),De=L.filter(ne=>me.has(ne.agendamento_id));if(De.length>0){const ne=oe?.[0],ie=sr(ne?new Date(ne.inicio):I,"yyyy-MM-dd");B.push({tipo:"pagamento",icone:"DollarSign",cor:"warning",mensagem:`${De.length} pagamento${De.length>1?"s":""} pendente${De.length>1?"s":""} em agendamentos`,link:`/agenda?date=${ie}`})}}const W=new Date;W.setHours(W.getHours()-3);const{data:ge}=await re.from("comandas").select("id, aberto_em, status").eq("codigo_empresa",O).eq("status","open").is("fechado_em",null).lte("aberto_em",W.toISOString());ge&&ge.length>0&&B.push({tipo:"comanda",icone:"Clock",cor:"warning",mensagem:`${ge.length} comanda${ge.length>1?"s":""} aberta${ge.length>1?"s":""} h mais de 3 horas`,link:"/vendas"});const Ae=new Date;Ae.setHours(Ae.getHours()-12);const{data:V}=await re.from("caixa_sessoes").select("id, aberto_em").eq("codigo_empresa",O).eq("status","open").lte("aberto_em",Ae.toISOString()).limit(1);V&&V.length>0&&B.push({tipo:"caixa",icone:"ShoppingCart",cor:"danger",mensagem:"Caixa aberto h mais de 12 horas",link:"/vendas"});const{data:$}=await re.from("mesas").select("id, nome, numero").eq("codigo_empresa",O).eq("status","awaiting-payment");if($&&$.length>0){const ae=$.map(me=>me.id),{data:oe}=await re.from("comandas").select("id, mesa_id").eq("codigo_empresa",O).in("mesa_id",ae).eq("status","open");if(oe&&oe.length>0){const me=oe.map(ht=>ht.id),{data:De}=await re.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",me),ne={};(De||[]).forEach(ht=>{const pt=(Number(ht.quantidade)||0)*(Number(ht.preco_unitario)||0),Ze=Number(ht.desconto)||0,vt=pt-Ze;ne[ht.comanda_id]=(ne[ht.comanda_id]||0)+vt});const ie=Object.values(ne).filter(ht=>ht>100).length;ie>0&&B.push({tipo:"mesa",icone:"Store",cor:"info",mensagem:`${ie} mesa${ie>1?"s":""} com saldo alto aguardando pagamento`,link:"/vendas"})}}const{data:Y}=await re.from("clientes").select("id, nome, aniversario").eq("codigo_empresa",O).eq("status","Ativo").not("aniversario","is",null),he=sr(I,"MM-dd"),J=(Y||[]).filter(ae=>ae.aniversario?sr(new Date(ae.aniversario),"MM-dd")===he:!1);J.length>0&&B.push({tipo:"aniversario",icone:"Users",cor:"success",mensagem:` ${J.length} aniversariante${J.length>1?"s":""} hoje!`,link:"/clientes"});const G=[];for(let ae=1;ae<=7;ae++){const oe=new Date(I);oe.setDate(oe.getDate()+ae),G.push(sr(oe,"MM-dd"))}const ue=(Y||[]).filter(ae=>{if(!ae.aniversario)return!1;const oe=sr(new Date(ae.aniversario),"MM-dd");return G.includes(oe)});ue.length>0&&B.push({tipo:"aniversario-semana",icone:"CalendarPlus",cor:"purple",mensagem:` ${ue.length} aniversariante${ue.length>1?"s":""} esta semana`,link:"/clientes"});const ve=_();s([...ve,...B]);try{if(!h.current&&!b.current&&B.length>0&&typeof document<"u"&&document.visibilityState==="visible"&&!C()){const oe=(()=>{try{return typeof window<"u"&&window.innerWidth<768}catch{return!1}})(),me=(()=>{try{return!!document.querySelector('button[aria-label="Fechar menu lateral"]')}catch{return!1}})();if(oe&&me){try{v.current&&clearInterval(v.current)}catch{}v.current=setInterval(()=>{try{if(h.current){clearInterval(v.current),v.current=null;return}if(!!!document.querySelector('button[aria-label="Fechar menu lateral"]')&&!C()){c(!0),h.current=!0;try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{c(!1)},3500),clearInterval(v.current),v.current=null}}catch{}},250)}else setTimeout(()=>{if(!h.current){if(C()){h.current=!0;return}c(!0),h.current=!0;try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{c(!1)},3500)}},350)}}catch{}}catch(O){console.error("[AlertsContext] Erro ao carregar alertas:",O)}finally{u(!1)}},[t?.codigo_empresa]);p.useEffect(()=>{if(o){h.current=!0,b.current=!0,c(!1);try{v.current&&(clearInterval(v.current),v.current=null)}catch{}}else c(!1)},[o]),p.useEffect(()=>()=>{try{m.current&&clearTimeout(m.current)}catch{}try{v.current&&clearInterval(v.current)}catch{}},[]);const P=p.useCallback(()=>{try{m.current&&clearTimeout(m.current)}catch{}c(!1),g(null)},[]),F=p.useCallback(()=>{s(O=>Array.isArray(O)?O.filter(I=>I?.tipo!=="isis-event"):[]);try{j([])}catch{}try{P()}catch{}},[j,P]);return p.useEffect(()=>{if(!t?.codigo_empresa)return;const O=t.codigo_empresa,I=re.channel(`isis-events:${O}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamentos",filter:`codigo_empresa=eq.${O}`},T=>{try{const{eventType:k,new:B,old:z}=T||{};if(!(B||z))return;const L=B?.created_by_isis===!0||z?.created_by_isis===!0,W=B?.canceled_by==="isis"||z?.canceled_by==="isis";if(!L&&!W||C())return;const ge=B?.inicio||z?.inicio;let Ae="";try{if(ge){const he=new Date(ge);Ae=`/agenda?date=${`${he.getFullYear()}-${String(he.getMonth()+1).padStart(2,"0")}-${String(he.getDate()).padStart(2,"0")}`}`}}catch{}let V="";if(k==="INSERT"){if(!L)return;V="sis criou um agendamento"}else if(k==="UPDATE")if(z?.status!=="canceled"&&B?.status==="canceled"&&B?.canceled_by==="isis")V="sis cancelou um agendamento";else return;else if(k==="DELETE")if(z?.canceled_by==="isis")V="sis cancelou um agendamento";else return;else return;const $=`isis-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,Y={id:$,tipo:"isis-event",icone:"AlertTriangle",cor:"warning",mensagem:V,link:"/isis/analytics",createdAt:new Date().toISOString()};s(he=>[Y,...Array.isArray(he)?he:[]]);try{const he=_(),J=[Y,...he.filter(G=>G.id!==$)];j(J)}catch{}g({id:$,message:V,link:Ae}),c(!0);try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{P()},5e3);try{s(he=>Array.isArray(he)?he:[])}catch{}}catch(k){console.warn("[AlertsContext] erro ao processar evento isis:",k)}}).subscribe();return()=>{try{re.removeChannel(I)}catch{}}},[t?.codigo_empresa,C,P]),p.useEffect(()=>{if(t?.codigo_empresa){A();const O=setInterval(()=>{A()},5*60*1e3);return()=>clearInterval(O)}},[t?.codigo_empresa,A]),p.useEffect(()=>{if(!t?.codigo_empresa)return;const O=()=>{if(document.visibilityState==="visible"){if(C())return;A()}},I=()=>{C()||A()};return document.addEventListener("visibilitychange",O),window.addEventListener("focus",I),()=>{document.removeEventListener("visibilitychange",O),window.removeEventListener("focus",I)}},[t?.codigo_empresa,A,C]),p.useEffect(()=>{if(t?.codigo_empresa){if(f.current===r.pathname)return;if(f.current=r.pathname,C()){console.log("[AlertsContext] Mudana de rota detectada, mas h modais abertos - ignorando recarga");return}console.log("[AlertsContext] Mudana de rota detectada - recarregando alertas"),A()}},[r.pathname,t?.codigo_empresa,A,C]),a.jsx(GY.Provider,{value:{alerts:n,setAlerts:s,showModal:o,setShowModal:i,showBalloon:l,setShowBalloon:c,eventBalloon:x,setEventBalloon:g,closeBalloon:P,dismissAlert:S,clearIsisAlerts:F,loading:d,loadAlerts:A},children:e})},t2=()=>{const e=p.useContext(GY);if(!e)throw new Error("useAlerts must be used within AlertsProvider");return e};function E2e({onToggleSidebar:e,sidebarVisible:t,sidebarPinned:r}){const{toast:n}=Ss(),{signOut:s,userProfile:o,company:i,user:l}=qs(),{alerts:c,setAlerts:d,showModal:u,setShowModal:f,showBalloon:h,setShowBalloon:m,eventBalloon:x,closeBalloon:g,dismissAlert:y}=t2(),v=hl(),b=o?.nome||"Usurio",w=Ee.useMemo(()=>{const W=b.trim().split(/\s+/);return W.length>=2?`${W[0]} ${W[1]}`:b},[b]),_=o?.cargo||o?.papel||"";let j="";try{const W=localStorage.getItem("auth:company");if(W){const ge=JSON.parse(W);j=ge?.nome_fantasia||ge?.razao_social||ge?.nome||ge?.codigoEmpresa||"";var S=ge?.logo_url||""}}catch{}const C=i?.nome_fantasia||i?.razao_social||i?.nome||i?.codigoEmpresa||j||"Empresa no vinculada",A=i?.logo_url||(typeof S<"u"?S:""),P=Ee.useMemo(()=>i?.logo_url?`${i.logo_url}?v=${Date.now()}`:A||"",[i?.logo_url]),F=Ee.useMemo(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}},[]),O=W=>({Package:su,DollarSign:Oi,CalendarCheck:MC,Clock:eu,ShoppingCart:W1,Store:eD,Users:tc,CalendarPlus:J4,AlertTriangle:Df,Info:yG})[W]||Df,I=W=>({danger:"text-danger",warning:"text-warning",info:"text-info",success:"text-success",purple:"text-purple"})[W]||"text-warning",T=({alert:W,onClick:ge})=>{const Ae=O(W.icone),V=I(W.cor),$=W?.tipo==="isis-event";return a.jsxs("li",{className:"flex items-center gap-2 p-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group",onClick:ge,children:[$?a.jsx("span",{className:"rounded-full overflow-hidden bg-background w-5 h-5 flex items-center justify-center flex-shrink-0 shadow-[0_0_0_2px_rgba(0,0,0,0.25)]",children:a.jsx(Hi,{size:"xs",className:"w-5 h-5"})}):a.jsx(Ae,{className:`w-4 h-4 flex-shrink-0 ${V}`}),a.jsx("span",{className:"text-text-secondary group-hover:text-text-primary transition-colors flex-1",children:W.mensagem}),W.link&&a.jsx(K4,{className:"w-3 h-3 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity"})]})},k=async()=>{console.log("[Header] Logout button clicked",{at:new Date().toISOString(),userBefore:!!l});const{error:W}=await s();console.log("[Header] Logout completed",{error:W,userAfter:!!l}),n(W?{title:"Erro ao sair",description:"Ocorreu um erro ao fazer logout. Tente novamente.",variant:"destructive"}:{title:"Logout realizado",description:"Voc foi desconectado com sucesso.",variant:"default"})};new Date().toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"});const B=wi(),z=Ee.useMemo(()=>{try{const W=String(B?.pathname||"");if(W==="/"||W.startsWith("/dashboard"))return"";const Ae=[{key:"/agenda",label:"Agenda"},{key:"/isis",label:"sis"},{key:"/clientes",label:"Clientes & Fornecedores"},{key:"/produtos",label:"Produtos"},{key:"/vendas",label:"Vendas"},{key:"/financeiro",label:"Financeiro"},{key:"/balcao",label:"Balco"},{key:"/cadastros",label:"Cadastros"},{key:"/quadras",label:"Quadras"},{key:"/equipe",label:"Equipe"},{key:"/finalizadoras",label:"Finalizadoras"},{key:"/empresas",label:"Empresas"},{key:"/configuracoes",label:"Configuraes"},{key:"/login",label:"Login"}].find(V=>W.startsWith(V.key));if(Ae)return Ae.label;if(typeof document<"u"){const V=String(document.title||"");return(V.includes(" - ")?V.split(" - ")[0]:V)||""}}catch{}return""},[B?.pathname]),U=Ee.useMemo(()=>String(B?.pathname||"").startsWith("/isis"),[B?.pathname]),L=Ee.useMemo(()=>{const W=i?.nome_fantasia||i?.nome||i?.razao_social||i?.codigoEmpresa||j||"";return String(W).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"").trim()},[i?.nome_fantasia,i?.nome,i?.razao_social,i?.codigoEmpresa,j]);return Ee.useMemo(()=>L?`https://${L}.f7arena.com`:"",[L]),a.jsxs(Er.header,{animate:{opacity:1,y:0},transition:{duration:.6,ease:[.22,1,.36,1]},className:"relative bg-surface/80 backdrop-blur-sm text-text-primary h-14 md:h-[72px] flex-shrink-0 flex items-center justify-between px-3 md:px-8 border-b border-border shadow-[0_1px_0_RGBA(255,255,255,0.04)]",children:[a.jsxs("div",{className:"flex items-center gap-2 md:gap-4 min-w-0 flex-1",children:[a.jsx(se,{variant:"ghost",size:"icon",onClick:e,"aria-label":t?"Ocultar barra lateral":"Mostrar barra lateral",className:"h-10 w-10 md:h-12 md:w-12 hover:bg-surface-2/60 transition-colors",children:a.jsx(Xue,{className:`w-6 h-6 md:w-7 md:h-7 transition-colors ${t?"text-brand":"text-text-primary"}`})}),a.jsxs("div",{className:"group mx-auto md:mx-0 pl-2 pr-3 md:pl-3 md:pr-5 py-1 md:py-1.5 border border-white/10 bg-gradient-to-b from-surface-2/60 to-surface/60 text-text-primary flex items-center gap-2 md:gap-4 shadow-sm hover:border-white/20 transition-colors overflow-hidden max-w-[60vw] md:max-w-[30vw] lg:max-w-[24vw]",title:C,children:[a.jsx("div",{className:"relative w-9 h-9 md:w-11 md:h-11 shrink-0 overflow-hidden border border-white/10 bg-surface-2/60 grid place-items-center shadow-[0_0_0_3px_RGBA(0,0,0,0.2)]",children:P?a.jsx("img",{src:P,alt:"Logo",className:"w-full h-full object-cover"}):a.jsx(kue,{className:"w-6 h-6 opacity-80"})}),a.jsx("span",{className:"tracking-tight truncate text-base leading-8 md:text-base md:leading-[44px] text-text-primary font-semibold flex-1 min-w-0 text-center md:text-left",children:C}),F&&a.jsx("span",{className:"ml-2 hidden md:inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-extrabold uppercase tracking-wider bg-red-600 text-white shadow animate-pulse",children:"Dev"})]})]}),U?a.jsx("div",{className:"pointer-events-none absolute z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:block",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)] w-8 h-8",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-full h-full",children:a.jsx(Hi,{size:"xs",className:"w-8 h-8"})})}),a.jsx("h1",{className:"text-lg md:text-xl font-bold tracking-tight text-text-primary",children:"sis"})]})}):z?a.jsx("div",{className:"pointer-events-none absolute z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:block",children:a.jsx("h1",{className:"text-lg md:text-xl font-bold tracking-tight text-text-primary",children:z})}):null,a.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[!U&&a.jsxs(se,{variant:"ghost",onClick:()=>v("/isis"),className:"hidden md:inline-flex items-center gap-2 px-2.5 py-1.5 rounded-full border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-all duration-200 hover:-translate-y-px hover:shadow-[0_4px_16px_rgba(0,0,0,0.25)]",children:[a.jsx("span",{className:"inline-flex items-center justify-center rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(Hi,{size:"xs"})})}),a.jsx("span",{className:"text-sm font-semibold text-text-primary",children:"sis"})]}),a.jsxs(ai,{open:u?!1:h,onOpenChange:m,children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"ghost",size:"icon",onClick:()=>{m(!1),f(!0)},className:"relative text-text-secondary hover:text-text-primary transition-colors duration-200",children:[a.jsx(Ob,{className:"h-5 w-5"}),c.length>0&&a.jsx("span",{className:"absolute -top-1 -right-1 bg-danger text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:c.length})]})}),a.jsxs(Go,{align:"end",sideOffset:8,className:"w-80 p-0 overflow-hidden bg-background border-white/10",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ob,{className:"h-4 w-4 text-brand"}),a.jsx("span",{className:"text-sm font-semibold",children:x?"Notificao":"Alertas"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[!x&&a.jsx(se,{size:"sm",variant:"ghost",onClick:()=>{m(!1),f(!0)},children:"Ver todos"}),a.jsx(se,{size:"icon",variant:"ghost",onClick:()=>{x?g():m(!1)},"aria-label":"Fechar",children:a.jsx(lc,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"p-2",children:x?a.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md bg-surface-2",children:[a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(Hi,{size:"xs"})}),a.jsx("span",{className:"text-sm text-text-secondary flex-1",children:x.message}),a.jsx(se,{size:"sm",variant:"ghost",className:"shrink-0",onClick:()=>{v("/isis/analytics");try{x?.id&&y(x.id)}catch{}g()},children:"Ver"})]}):c.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-6",children:"Nenhum alerta no momento"}):a.jsx("ul",{className:"space-y-1 text-sm",children:c.slice(0,3).map((W,ge)=>a.jsx(T,{alert:W,onClick:()=>{if(W.link&&v(W.link),W?.tipo==="isis-event"&&W?.id)try{y(W.id)}catch{}m(!1)}},ge))})})]})]}),a.jsx(se,{variant:"ghost",size:"icon",onClick:k,className:"text-text-secondary hover:text-brand hover:bg-brand/10 transition-colors duration-200 shrink-0",children:a.jsx(Kue,{className:"h-5 w-5"})}),a.jsx("div",{className:"hidden md:block w-px h-8 bg-border mx-1 md:mx-2"}),a.jsxs("div",{className:"hidden md:flex group pl-2 pr-3 md:pl-4 md:pr-4 py-1.5 rounded-full border border-white/10 bg-gradient-to-b from-surface-2/60 to-surface/60 text-text-primary items-center gap-2 md:gap-3 shadow-sm hover:border-white/20 transition-colors",title:`${w}  ${_}`,children:[a.jsx("span",{className:"text-xs md:text-sm font-semibold truncate max-w-[120px] md:max-w-[180px]",children:w}),a.jsx("span",{className:"text-[10px] md:text-[11px] px-1.5 md:px-2 py-0.5 rounded-full bg-brand/15 text-brand font-medium tracking-wide",children:_})]})]}),a.jsx(In,{open:u,onOpenChange:f,children:a.jsxs(En,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(Cn,{children:a.jsxs(Nn,{className:"flex items-center gap-2",children:[a.jsx(Ob,{className:"h-5 w-5 text-brand"}),"Todos os Alertas (",c.length,")"]})}),a.jsx("div",{className:"mt-4",children:c.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-8",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:c.map((W,ge)=>a.jsx(T,{alert:W,onClick:()=>{if(W.link&&(v(W.link),f(!1)),W?.tipo==="isis-event"&&W?.id)try{y(W.id)}catch{}}},ge))})})]})})]})}const Ct=Ee.forwardRef(({className:e,type:t,...r},n)=>a.jsx("input",{type:t,className:Sr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...r}));Ct.displayName="Input";var k2e="Label",KY=p.forwardRef((e,t)=>a.jsx(ka.label,{...e,ref:t,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));KY.displayName=k2e;var XY=KY;const I2e=ND("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),it=Ee.forwardRef(({className:e,...t},r)=>a.jsx(XY,{ref:r,className:Sr(I2e(),e),...t}));it.displayName=XY.displayName;const O2e=e=>{const t={"Invalid login credentials":"Email ou senha incorretos","Email not confirmed":"Email no confirmado","User not found":"Usurio no encontrado","Invalid email":"Email invlido","Password should be at least 6 characters":"A senha deve ter pelo menos 6 caracteres","Unable to validate email address: invalid format":"Formato de email invlido","Email rate limit exceeded":"Muitas tentativas. Aguarde alguns minutos","Network request failed":"Erro de conexo. Verifique sua internet","Failed to fetch":"Erro de conexo. Verifique sua internet"};if(t[e])return t[e];for(const[r,n]of Object.entries(t))if(e.includes(r))return n;return"Erro ao fazer login. Verifique suas credenciais e tente novamente."},T2e=()=>{const[e,t]=p.useState(!1),[r,n]=p.useState(!1),[s,o]=p.useState(""),[i,l]=p.useState({email:"",password:""}),{signIn:c,user:d,authReady:u}=qs(),{toast:f}=Ss();p.useEffect(()=>{if(u&&d)try{const y=sessionStorage.getItem("auth:returnUrl");sessionStorage.removeItem("auth:returnUrl");const v=y||"/";console.log("[LoginPage] Redirecionando para:",v),window.location.replace(v)}catch{}},[u,!!d]);const h=y=>{l({...i,[y.target.name]:y.target.value}),s&&o("")},m=async y=>{y.preventDefault(),n(!0),o("");try{const v=await c(i.email,i.password);if(v.error)throw v.error;f({title:"Login realizado!",description:"Bem-vindo de volta!",variant:"default"});try{const b=sessionStorage.getItem("auth:returnUrl");sessionStorage.removeItem("auth:returnUrl");const w=b||"/";console.log("[LoginPage] Redirecionando aps login para:",w),window.location.replace(w)}catch{}}catch(v){const b=v.message||"Ocorreu um erro. Tente novamente.",w=O2e(b);o(w),f({title:"Erro",description:w,variant:"destructive"})}finally{n(!1)}},x={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}},g=(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}})();return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 sm:p-6 relative",children:[g&&a.jsx("div",{className:"pointer-events-none select-none absolute top-4 right-4 z-20",children:a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-extrabold uppercase tracking-wider bg-red-600 text-white shadow animate-pulse",children:"Dev"})}),a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.02] mix-blend-overlay"}),a.jsxs(Er.div,{variants:x,initial:"hidden",animate:"visible",className:"relative z-10 w-full max-w-md pb-20 sm:pb-0",children:[a.jsxs("div",{className:"fx-card",children:[a.jsx("div",{className:"text-center mb-6",children:a.jsxs("div",{className:"flex items-center justify-center mb-4",children:[a.jsx("div",{className:"w-16 h-16 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(sd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-5xl font-extrabold",children:[a.jsx("span",{style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{style:{color:"#FFAA33"},children:"7"})]}),a.jsx("p",{className:"text-2xl font-semibold",style:{color:"#B0B0B0"},children:"Arena"})]})]})}),a.jsxs("form",{onSubmit:m,className:"space-y-5 sm:space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs(it,{htmlFor:"email",className:"text-text-primary flex items-center gap-2 text-sm sm:text-base",children:[a.jsx(t0,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Email"]}),a.jsx(Ct,{id:"email",name:"email",type:"email",placeholder:"seu@email.com",value:i.email,onChange:h,required:!0,className:"placeholder:text-[#B0B0B0] h-12 sm:h-10 text-base sm:text-sm"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(it,{htmlFor:"password",className:"text-text-primary flex items-center gap-2 text-sm sm:text-base",children:[a.jsx(e0,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Senha"]}),a.jsxs("div",{className:"relative",children:[a.jsx(Ct,{id:"password",name:"password",type:e?"text":"password",placeholder:"Sua senha",value:i.password,onChange:h,required:!0,className:"pr-10 placeholder:text-[#B0B0B0] h-12 sm:h-10 text-base sm:text-sm"}),a.jsx("button",{type:"button",onClick:()=>t(!e),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors",children:e?a.jsx(jg,{className:"w-5 h-5 sm:w-4 sm:h-4"}):a.jsx(zg,{className:"w-5 h-5 sm:w-4 sm:h-4"})})]})]}),s&&a.jsx(Er.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-lg bg-destructive/10 border border-destructive/30 text-destructive text-sm",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:""}),a.jsx("span",{className:"flex-1",children:s})]})}),a.jsx(se,{type:"submit",className:"w-full h-12 sm:h-10 text-base sm:text-sm",disabled:r,children:r?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin"}),"Entrando..."]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Gue,{className:"w-4 h-4"}),"Entrar"]})})]})]}),a.jsx("p",{className:"mt-4 text-center text-xs text-text-muted opacity-70",children:" 2026 Fluxo7 Arena  Todos os direitos reservados."})]})]})})},y8=({children:e})=>{const{user:t,authReady:r}=qs(),n=wi();return p.useEffect(()=>{if(r&&!t&&n.pathname!=="/login")try{sessionStorage.setItem("auth:returnUrl",n.pathname+n.search),console.log("[ProtectedRoute] Salvando rota de retorno:",n.pathname+n.search)}catch(s){console.warn("[ProtectedRoute] Erro ao salvar rota de retorno:",s)}},[r,t,n.pathname,n.search]),r?t?e:a.jsx(T2e,{}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 border-4 border-brand border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-text-primary font-medium",children:"Carregando..."})]})})},D2e=p.createContext(),M2e=({children:e})=>{const[t,r]=p.useState({payment:{open:!1,data:null},editParticipant:{open:!1,data:null}}),[n,s]=p.useState(new Set),o=p.useCallback((f,h=null)=>{console.log(" [MODALS] Abrindo modal:",f,h),r(m=>({...m,[f]:{open:!0,data:h}}))},[]),i=p.useCallback(f=>{if(n.has(f)){console.log(` [ModalsContext] Modal "${f}" est protegido, ignorando fechamento`);return}r(h=>({...h,[f]:{open:!1,data:{}}}))},[n]),l=p.useCallback(f=>t[f]?.open||!1,[t]),c=p.useCallback(f=>t[f]?.data||{},[t]),d=p.useCallback(f=>{console.log(` [ModalsContext] Protegendo modal "${f}"`),s(h=>new Set([...h,f]))},[]),u=p.useCallback(f=>{console.log(` [ModalsContext] Desprotegendo modal "${f}"`),s(h=>{const m=new Set(h);return m.delete(f),m})},[]);return a.jsx(D2e.Provider,{value:{openModal:o,closeModal:i,isModalOpen:l,getModalData:c,protectModal:d,unprotectModal:u},children:e})},YY=p.createContext(),DN=()=>{const e=p.useContext(YY);if(!e)throw new Error("useAgenda must be used within AgendaProvider");return e},R2e=({children:e})=>{const[t,r]=p.useState(!1),[n,s]=p.useState(!1),[o,i]=p.useState(!1),[l,c]=p.useState({participantId:null,participantName:""}),[d,u]=p.useState(null),[f,h]=p.useState([]),[m,x]=p.useState(""),[g,y]=p.useState([]),[v,b]=p.useState(null),[w,_]=p.useState([]),j=p.useRef({isProtected:!1,protectedUntil:0}),S=p.useRef(Date.now()),C=p.useRef(null),A=wi(),P=p.useCallback((z=2e3)=>{const U=Date.now()+z;if(U>j.current.protectedUntil)j.current.isProtected=!0,j.current.protectedUntil=U;else return;setTimeout(()=>{Date.now()>=j.current.protectedUntil&&(j.current.isProtected=!1)},z)},[]),F=p.useCallback(()=>{j.current.isProtected=!1,j.current.protectedUntil=0},[]),O=p.useCallback(()=>{r(!0)},[]),I=p.useCallback((z={})=>{const U=z===!0||z&&z.force===!0,L=Date.now();if(U)return r(!1),!0;if(j.current.isProtected&&L<j.current.protectedUntil){const ge=j.current.protectedUntil-L;try{localStorage.getItem("debug:agenda")==="1"&&console.log(` [PaymentModal] Fechamento bloqueado por proteo (${ge}ms restantes)`)}catch{}return!1}if(Date.now()-S.current<500){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Fechamento bloqueado por mudana de visibilidade recente")}catch{}return!1}try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Fechando modal (no protegido)")}catch{}return r(!1),!0},[]),T=p.useCallback((z,U)=>{c({participantId:z,participantName:U}),s(!0),P(3e3)},[P]),k=p.useCallback(()=>{s(!1),c({participantId:null,participantName:""})},[]);p.useEffect(()=>{if(!(A?.pathname||"").startsWith("/agenda"))return()=>{};const L=()=>{const ge=Date.now(),Ae=document.hidden;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] visibilitychange:",{hidden:Ae,timestamp:new Date().toISOString(),isPaymentModalOpen:t})}catch{}if(S.current=ge,!Ae&&t){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] Aba restaurada com modal aberto - protegendo por 3s")}catch{}const V=Date.now()+3e3;j.current.isProtected=!0,j.current.protectedUntil=V}},W=()=>{const ge=Date.now();try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] window focus:",{timestamp:new Date().toISOString(),isPaymentModalOpen:t})}catch{}if(S.current=ge,t){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] Janela ganhou foco com modal aberto - protegendo por 3s")}catch{}const Ae=Date.now()+3e3;j.current.isProtected=!0,j.current.protectedUntil=Ae}};return document.addEventListener("visibilitychange",L),window.addEventListener("focus",W),()=>{document.removeEventListener("visibilitychange",L),window.removeEventListener("focus",W)}},[t,A?.pathname]);const B={isPaymentModalOpen:t,isEditParticipantModalOpen:n,isAddBookingModalOpen:o,openPaymentModal:O,closePaymentModal:I,openEditParticipantModal:T,closeEditParticipantModal:k,setIsAddBookingModalOpen:i,editParticipantData:l,editingBooking:d,setEditingBooking:u,participantsForm:f,setParticipantsForm:h,paymentTotal:m,setPaymentTotal:x,payMethods:g,setPayMethods:y,bookingForm:v,setBookingForm:b,localCustomers:w,setLocalCustomers:_,protectPaymentModal:P,unprotectPaymentModal:F,onParticipantReplacedRef:C,get lastVisibilityChangeTime(){return S.current},get isModalProtected(){const z=Date.now();return j.current.isProtected&&z<j.current.protectedUntil}};return a.jsx(YY.Provider,{value:B,children:e})},F2e="https://guildthlqkfubbqoybys.supabase.co",b8="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",L2e=()=>({apikey:b8,Authorization:`Bearer ${b8}`,"Content-Type":"application/json","X-Client-Info":"fluxo7-isis-web"}),S_=async(e,{method:t="GET",body:r,headers:n}={})=>{const s=`${F2e}${e}`,o=await fetch(s,{method:t,headers:{...L2e(),...n||{}},body:r?JSON.stringify(r):void 0}),i=await o.text().catch(()=>""),l=i&&JSON.parse(i)||null;return o.ok?{data:l,error:null}:{data:null,error:{status:o.status,message:l?.message||i||`HTTP ${o.status}`,details:l?.details??null,hint:l?.hint??null,code:l?.code??null}}};class $2e{constructor(t){this.table=t,this._select="*",this._filters=[],this._order=null}select(t){return this._select=t||"*",this}eq(t,r){return this._filters.push([t,"eq",r]),this}is(t,r){return this._filters.push([t,"is",r]),this}order(t,{ascending:r}={}){return this._order={column:t,ascending:r!==!1},this}async insert(t){return S_(`/rest/v1/${this.table}`,{method:"POST",body:t})}async upsert(t,{onConflict:r}={}){const n=new URLSearchParams;r&&n.set("on_conflict",r);const s=n.toString();return S_(`/rest/v1/${this.table}${s?`?${s}`:""}`,{method:"POST",body:t,headers:{Prefer:"resolution=merge-duplicates,return=minimal"}})}async update(t){const r=new URLSearchParams;r.set("select",this._select);for(const[n,s,o]of this._filters)s==="is"&&o===null?r.set(n,"is.null"):r.set(n,`${s}.${o}`);return this._order?.column&&r.set("order",`${this._order.column}.${this._order.ascending?"asc":"desc"}`),S_(`/rest/v1/${this.table}?${r.toString()}`,{method:"PATCH",body:t,headers:{Prefer:"return=minimal"}})}async then(t,r){const n=new URLSearchParams;n.set("select",this._select);for(const[o,i,l]of this._filters)i==="is"&&l===null?n.set(o,"is.null"):n.set(o,`${i}.${l}`);this._order?.column&&n.set("order",`${this._order.column}.${this._order.ascending?"asc":"desc"}`);const s=await S_(`/rest/v1/${this.table}?${n.toString()}`,{method:"GET"});return Promise.resolve(s).then(t,r)}}const NO={from(e){return new $2e(e)}},JY=p.createContext(),l5=()=>{const e=p.useContext(JY);if(!e)throw new Error("useIsis deve ser usado dentro de IsisProvider");return e},QY=({children:e})=>{const[t,r]=p.useState("greeting"),[n,s]=p.useState([]),o=p.useRef((()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const oe=[...Array(36)].map(()=>"x");return oe[8]=oe[13]=oe[18]=oe[23]="-",oe[14]="4",oe.map((me,De)=>{if(me!=="x")return me;const ne=Math.random()*16|0;return(De===19?ne&3|8:ne).toString(16)}).join("")}catch{return"00000000-0000-4000-8000-000000000000"}})()),[i,l]=p.useState(o.current),[c,d]=p.useState({empresa:null,quadra:null,data:null,horario:null,modalidade:null,quantidade:null,nomes:[],contato:{nome:"",telefone:""}}),[u,f]=p.useState(!1),[h,m]=p.useState(!1),x=p.useRef(null),y=[["VITE_KEY_CHAT_ISIS",{}.VITE_KEY_CHAT_ISIS],["VITE-KEY-CHAT-ISIS",{VITE_JSONBIN_BIN_ID:"690605e5ae596e708f3c7bc5",VITE_JSONBIN_ISIS_BIN_ID:"6939b808ae596e708f90b843",VITE_JSONBIN_API_KEY:"$/XmOGvx8./SZzV3qMzQ5i.6FjBjS4toNbeaEFzX2D8QPUddyM6VR2",VITE_SUPABASE_URL:"https://dlfryxtyxqoacuunswuc.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY",VITE_SUPABASE_URL_ISIS:"https://guildthlqkfubbqoybys.supabase.co",VITE_SUPABASE_ANON_KEY_ISIS:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}["VITE-KEY-CHAT-ISIS"]],["KEY_CHAT_ISIS",{}.KEY_CHAT_ISIS],["KEY-CHAT-ISIS",{VITE_JSONBIN_BIN_ID:"690605e5ae596e708f3c7bc5",VITE_JSONBIN_ISIS_BIN_ID:"6939b808ae596e708f90b843",VITE_JSONBIN_API_KEY:"$/XmOGvx8./SZzV3qMzQ5i.6FjBjS4toNbeaEFzX2D8QPUddyM6VR2",VITE_SUPABASE_URL:"https://dlfryxtyxqoacuunswuc.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY",VITE_SUPABASE_URL_ISIS:"https://guildthlqkfubbqoybys.supabase.co",VITE_SUPABASE_ANON_KEY_ISIS:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}["KEY-CHAT-ISIS"]]].find(([oe,me])=>!!me),v=y?.[1],b=y?.[0]||"none",w={}.VITE_JSONBIN_COLLECTION_ID||null,_="6939b808ae596e708f90b843",j="https://api.jsonbin.io/v3/b",S={}.VITE_ISIS_EDGE_SYNC==="1",[C,A]=p.useState(S?_:null);if(S&&typeof window<"u")try{console.info("[Isis][JSONBin] keySource=%s binId=%s",b,_||window.localStorage.getItem("ISIS_JSONBIN_BIN_ID")||"none")}catch{}const P=p.useCallback(async oe=>{if(!S)return{ok:!1,data:null};if(!v){try{console.debug("[Isis][Edge] skipped (no JSONBIN key) mode=%s",oe?.mode)}catch{}return{ok:!1,data:null}}try{const{data:me,error:De}=await re.functions.invoke("isis-chat",{body:oe});if(De){try{console.debug("[Isis][Edge] %s error=%o",oe?.mode,De)}catch{}return{ok:!1,data:null}}try{console.debug("[Isis][Edge] %s ok resp=%o",oe?.mode,me)}catch{}return{ok:!0,data:me}}catch(me){try{console.debug("[Isis][Edge] invoke exception:",me)}catch{}return{ok:!1,data:null}}},[v,S]),F=p.useCallback(async oe=>{if(!v)return null;const me={"X-Master-Key":v,"X-Access-Key":v,"Content-Type":"application/json"};w&&(me["X-Collection-Id"]=w);const De=await fetch(`${j}`,{method:"POST",headers:me,body:JSON.stringify(oe||{projects:[{name:"F7 Arena"}],chat_sessions:[]})});if(!De.ok)return null;const ne=await De.json().catch(()=>null),ie=ne?.metadata?.id||ne?.id||null;if(ie){A(ie);try{window?.localStorage?.setItem("ISIS_JSONBIN_BIN_ID",ie)}catch{}}return ie},[v]),O=p.useCallback(async()=>{if(!v||!C)return null;try{console.debug("[Isis][JSONBin] loadBin: GET %s/%s",j,C)}catch{}const oe={"X-Master-Key":v,"X-Access-Key":v,"X-Bin-Meta":"false","Content-Type":"application/json"};w&&(oe["X-Collection-Id"]=w);const me=await fetch(`${j}/${C}`,{method:"GET",headers:oe});try{console.debug("[Isis][JSONBin] loadBin: status=%s",me?.status)}catch{}if(me.status===401||me.status===404){try{console.error("[Isis][JSONBin] GET unauthorized or not found. keySource=%s binId=%s status=%s",b,C,me.status)}catch{}return await F()?{projects:[{name:"F7 Arena"}],chat_sessions:[]}:null}if(!me.ok)return null;try{return await me.json()}catch{return null}},[v,C,F]),I=p.useCallback(async oe=>{if(!v||!C&&!await F(oe))return!1;const me=C||(typeof window<"u"?window.localStorage.getItem("ISIS_JSONBIN_BIN_ID"):null);try{console.debug("[Isis][JSONBin] saveBin: PUT %s/%s",j,me)}catch{}const De={"X-Master-Key":v,"X-Access-Key":v,"Content-Type":"application/json"};w&&(De["X-Collection-Id"]=w);const ne=await fetch(`${j}/${me}`,{method:"PUT",headers:De,body:JSON.stringify(oe)});try{console.debug("[Isis][JSONBin] saveBin: status=%s",ne?.status)}catch{}if(ne.status===401||ne.status===404){try{console.error("[Isis][JSONBin] PUT unauthorized or not found. keySource=%s binId=%s status=%s",b,me,ne.status)}catch{}return!!await F(oe)}return ne.ok},[v,C,F]),T=oe=>!oe||typeof oe!="object"?{projects:[{name:"F7 Arena"}],chat_sessions:[]}:(Array.isArray(oe.chat_sessions)||(oe.chat_sessions=[]),oe),k=(oe,me)=>(Array.isArray(oe?.chat_sessions)?oe.chat_sessions:[]).findIndex(ne=>(ne?.project||"").toString()===(me.project||"").toString()&&(ne?.company?.code||"").toString()===(me.companyCode||"").toString()&&(ne?.client_code||"").toString()===(me.clientCode||"").toString()),B=p.useCallback(async()=>{if(i)return i;try{try{console.info("[Isis][Chat] ensureSession: start")}catch{}const oe=c?.empresa||null,me=oe?{code:oe.codigo_empresa||oe.codigoEmpresa,name:oe.nome_fantasia||oe.nome}:null,De=c?.cliente||null;let ne=await O();ne=T(ne),Array.isArray(ne.projects)||(ne.projects=[{name:"F7 Arena"}]);const ie={project:"F7 Arena",companyCode:me?.code||null,clientCode:De?.id?String(De.id):null};try{console.debug("[Isis][Chat] ensureSession: criteria=%o",ie)}catch{}if(ie.companyCode&&ie.clientCode){const ht=k(ne,ie);try{console.debug("[Isis][Chat] ensureSession: existingIndex=%s",ht)}catch{}ht===-1&&ne.chat_sessions.push({client_code:ie.clientCode,client_name:De?.nome||De?.name||"",company:me,project:ie.project,conversation:[]})}await I(ne);try{console.info("[Isis][Chat] ensureSession: sessionId=%s",i)}catch{}return i}catch(oe){try{console.error("[Isis][Chat] ensureSession: failed",oe)}catch{}return null}},[i,c?.empresa,c?.cliente,O,I]),z=p.useCallback(async oe=>{if(oe)try{const me=c?.empresa||null,De=me?{code:me.codigo_empresa||me.codigoEmpresa,name:me.nome_fantasia||me.nome}:null,ne=c?.cliente||null;let ie=await O();if(!ie)return;ie=T(ie);const ht={project:"F7 Arena",companyCode:De?.code||null,clientCode:ne?.id?String(ne.id):null};try{console.debug("[Isis][Chat] tryUpdateSessionMeta: criteria=%o",ht)}catch{}if(!ht.companyCode&&!ht.clientCode)return;let pt=k(ie,ht);if(pt===-1){ie.chat_sessions.push({client_code:ht.clientCode,client_name:ne?.nome||ne?.name||"",company:De,project:ht.project,conversation:[]}),pt=ie.chat_sessions.length-1;try{console.debug("[Isis][Chat] tryUpdateSessionMeta: created index=%s",pt)}catch{}}else{ne?.id&&!ie.chat_sessions[pt].client_code&&(ie.chat_sessions[pt].client_code=String(ne.id)),ne?.nome&&!ie.chat_sessions[pt].client_name&&(ie.chat_sessions[pt].client_name=ne.nome),De&&!ie.chat_sessions[pt].company&&(ie.chat_sessions[pt].company=De);try{console.debug("[Isis][Chat] tryUpdateSessionMeta: updated index=%s",pt)}catch{}}await I(ie),De?.name&&ne?.id&&await P({mode:"set_meta",cod_cliente:ne?.id?String(ne.id):"",nome_cliente:ne?.nome||ne?.name||"",empresa:De.name,software:"F7 Arena"})}catch{}},[c?.empresa,c?.cliente,O,I,P]),U=p.useCallback(async oe=>{try{try{console.info("[Isis][Chat] persistMessage: incoming=%o",{sessionId:i,from:oe.from,text:oe.text})}catch{}const me=c?.empresa||null,De=me?{code:me.codigo_empresa||me.codigoEmpresa,name:me.nome_fantasia||me.nome}:null,ne=c?.cliente||null;try{const ie=oe.from==="isis"?"assistant":"user",ht=De?.name||me?.nome_fantasia||me?.nome||me?.razao_social||"Desconhecida";let pt=[];try{const{data:gt,error:er}=await NO.from("isis").select("conversa").eq("id",i);if(er)try{console.error("[Isis][Chat] supabase-isis select conversa error:",{sessionId:i,status:er?.status,message:er?.message,code:er?.code})}catch{}!er&&Array.isArray(gt)&&gt[0]?.conversa&&(pt=Array.isArray(gt[0].conversa)?gt[0].conversa:[])}catch{}const Ze=[...Array.isArray(pt)?pt:[],{ts:new Date().toISOString(),from:ie,text:String(oe.text??"")}],vt={id:String(i),cod_cliente:ne?.id?String(ne.id):null,nome_cliente:ne?.nome||ne?.name||null,empresa:ht,projeto:"fluxo7arena",nota:null,comentario:null,conversa:Ze,timestamp:new Date().toISOString()},{error:wt}=await NO.from("isis").upsert(vt,{onConflict:"id"});if(wt)try{console.error("[Isis][Chat] supabase-isis upsert error:",{sessionId:i,status:wt?.status,message:wt?.message,code:wt?.code})}catch{}else try{console.info("[Isis][Chat] supabase-isis upsert ok:",{sessionId:i,conversaLen:Array.isArray(Ze)?Ze.length:null,hasCliente:!!ne?.id,empresa:ht})}catch{}}catch(ie){try{console.error("[Isis][Chat] supabase-isis exception:",ie)}catch{}}if(S&&await P({mode:"append_message",cod_cliente:ne?.id?String(ne.id):"_unknown",nome_cliente:ne?.nome||ne?.name||"",empresa:De?.name||"",software:"F7 Arena",session_id:i,message:{from:oe.from==="isis"?"assistant":"user",text:String(oe.text??"")}}),S)try{const ie=await B();if(!ie)return;const ht=oe.from==="isis"?"assistant":"user",pt={ts:new Date().toISOString(),from:ht,text:String(oe.text??"")};let Ze=await O();if(!Ze)return;Ze=T(Ze);const vt=c?.empresa||null,wt=vt?{code:vt.codigo_empresa||vt.codigoEmpresa,name:vt.nome_fantasia||vt.nome}:null,gt=c?.cliente||null,er={project:"F7 Arena",companyCode:wt?.code||null,clientCode:gt?.id?String(gt.id):null};let _e=k(Ze,er);_e===-1?Ze.chat_sessions.push({client_code:er.clientCode,client_name:gt?.nome||gt?.name||"",company:wt,project:er.project,conversation:[pt]}):(Array.isArray(Ze.chat_sessions[_e].conversation)||(Ze.chat_sessions[_e].conversation=[]),Ze.chat_sessions[_e].conversation.push(pt)),await I(Ze),z(ie)}catch{}}catch{}},[B,z,O,I,P,c?.empresa,c?.cliente,i]),L=p.useCallback(oe=>{s(me=>[...me,{id:Date.now()+Math.random(),timestamp:new Date,...oe}]),setTimeout(()=>{x.current?.scrollIntoView({behavior:"smooth"})},100);try{U(oe)}catch{}},[U]),W=p.useCallback((oe,me=2e3,De=null)=>{m(!0),setTimeout(()=>{m(!1);const ne=oe&&typeof oe=="object"&&oe.text?oe:{text:oe};L({from:"isis",text:ne.text,type:"text",color:ne.color??De,copyable:!!ne.copyable,copyText:ne.copyText})},me)},[L]),ge=p.useCallback((oe,me,De=2e3)=>{m(!0),setTimeout(()=>{m(!1),s(ne=>ne.map(ie=>ie.type==="buttons"&&ie.buttons&&ie.buttons.length>0?{...ie,disabled:!0}:ie)),L({from:"isis",text:oe,type:"buttons",buttons:me,disabled:!1})},De)},[L]),Ae=p.useCallback(()=>{s(oe=>oe.map(me=>me.type==="buttons"&&me.buttons&&me.buttons.length>0&&!me.disabled?{...me,disabled:!0}:me))},[]),V=p.useCallback(oe=>{s(me=>me.filter(De=>De.id!==oe))},[]),$=p.useCallback(oe=>{s(me=>me.map(De=>De.id===oe&&De.type==="buttons"?{...De,buttonsHidden:!0,disabled:!0}:De))},[]),Y=p.useCallback(oe=>{L({from:"user",text:oe,type:"text"})},[L]),he=p.useCallback((oe,me)=>{if(d(De=>({...De,[oe]:me})),(oe==="cliente"||oe==="empresa")&&i)try{z(i)}catch{}},[]),J=p.useCallback((oe,me)=>{d(De=>({...De,contato:{...De.contato,[oe]:me}}))},[]),G=p.useCallback(oe=>{r(oe)},[]),ue=p.useCallback(()=>{const oe=["greeting","quadra","data","horario","modalidade","quantidade","nomes","contato","review","confirmation","avaliacao"],me=oe.indexOf(t);me>0&&r(oe[me-1])},[t]),ve=p.useCallback(()=>{r("greeting"),s([]),d({empresa:null,quadra:null,data:null,horario:null,modalidade:null,quantidade:null,nomes:[],contato:{nome:"",telefone:""}}),f(!1),m(!1),l(null)},[]),ae={currentStep:t,messages:n,selections:c,sessionId:i,isLoading:u,isTyping:h,chatEndRef:x,addMessage:L,addIsisMessage:W,addIsisMessageWithButtons:ge,addUserMessage:Y,disableAllButtons:Ae,removeMessageById:V,hideButtonsInMessage:$,updateSelection:he,updateContact:J,nextStep:G,previousStep:ue,resetConversation:ve,setIsLoading:f,setIsTyping:m};return a.jsx(JY.Provider,{value:ae,children:e})};var B2e=Array.isArray,Mc=B2e,q2e=typeof Tl=="object"&&Tl&&Tl.Object===Object&&Tl,ZY=q2e,z2e=ZY,U2e=typeof self=="object"&&self&&self.Object===Object&&self,V2e=z2e||U2e||Function("return this")(),$f=V2e,W2e=$f,H2e=W2e.Symbol,r2=H2e,w8=r2,eJ=Object.prototype,G2e=eJ.hasOwnProperty,K2e=eJ.toString,zy=w8?w8.toStringTag:void 0;function X2e(e){var t=G2e.call(e,zy),r=e[zy];try{e[zy]=void 0;var n=!0}catch{}var s=K2e.call(e);return n&&(t?e[zy]=r:delete e[zy]),s}var Y2e=X2e,J2e=Object.prototype,Q2e=J2e.toString;function Z2e(e){return Q2e.call(e)}var e_e=Z2e,_8=r2,t_e=Y2e,r_e=e_e,n_e="[object Null]",a_e="[object Undefined]",j8=_8?_8.toStringTag:void 0;function s_e(e){return e==null?e===void 0?a_e:n_e:j8&&j8 in Object(e)?t_e(e):r_e(e)}var $m=s_e;function o_e(e){return e!=null&&typeof e=="object"}var Bm=o_e,i_e=$m,l_e=Bm,c_e="[object Symbol]";function d_e(e){return typeof e=="symbol"||l_e(e)&&i_e(e)==c_e}var Z0=d_e,u_e=Mc,f_e=Z0,m_e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,h_e=/^\w*$/;function p_e(e,t){if(u_e(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||f_e(e)?!0:h_e.test(e)||!m_e.test(e)||t!=null&&e in Object(t)}var tM=p_e;function g_e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var jp=g_e;const ey=xs(jp);var x_e=$m,v_e=jp,y_e="[object AsyncFunction]",b_e="[object Function]",w_e="[object GeneratorFunction]",__e="[object Proxy]";function j_e(e){if(!v_e(e))return!1;var t=x_e(e);return t==b_e||t==w_e||t==y_e||t==__e}var rM=j_e;const Ea=xs(rM);var N_e=$f,S_e=N_e["__core-js_shared__"],C_e=S_e,oE=C_e,N8=function(){var e=/[^.]+$/.exec(oE&&oE.keys&&oE.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function A_e(e){return!!N8&&N8 in e}var P_e=A_e,E_e=Function.prototype,k_e=E_e.toString;function I_e(e){if(e!=null){try{return k_e.call(e)}catch{}try{return e+""}catch{}}return""}var tJ=I_e,O_e=rM,T_e=P_e,D_e=jp,M_e=tJ,R_e=/[\\^$.*+?()[\]{}|]/g,F_e=/^\[object .+?Constructor\]$/,L_e=Function.prototype,$_e=Object.prototype,B_e=L_e.toString,q_e=$_e.hasOwnProperty,z_e=RegExp("^"+B_e.call(q_e).replace(R_e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function U_e(e){if(!D_e(e)||T_e(e))return!1;var t=O_e(e)?z_e:F_e;return t.test(M_e(e))}var V_e=U_e;function W_e(e,t){return e?.[t]}var H_e=W_e,G_e=V_e,K_e=H_e;function X_e(e,t){var r=K_e(e,t);return G_e(r)?r:void 0}var ux=X_e,Y_e=ux,J_e=Y_e(Object,"create"),c5=J_e,S8=c5;function Q_e(){this.__data__=S8?S8(null):{},this.size=0}var Z_e=Q_e;function eje(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var tje=eje,rje=c5,nje="__lodash_hash_undefined__",aje=Object.prototype,sje=aje.hasOwnProperty;function oje(e){var t=this.__data__;if(rje){var r=t[e];return r===nje?void 0:r}return sje.call(t,e)?t[e]:void 0}var ije=oje,lje=c5,cje=Object.prototype,dje=cje.hasOwnProperty;function uje(e){var t=this.__data__;return lje?t[e]!==void 0:dje.call(t,e)}var fje=uje,mje=c5,hje="__lodash_hash_undefined__";function pje(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=mje&&t===void 0?hje:t,this}var gje=pje,xje=Z_e,vje=tje,yje=ije,bje=fje,wje=gje;function ty(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ty.prototype.clear=xje;ty.prototype.delete=vje;ty.prototype.get=yje;ty.prototype.has=bje;ty.prototype.set=wje;var _je=ty;function jje(){this.__data__=[],this.size=0}var Nje=jje;function Sje(e,t){return e===t||e!==e&&t!==t}var nM=Sje,Cje=nM;function Aje(e,t){for(var r=e.length;r--;)if(Cje(e[r][0],t))return r;return-1}var d5=Aje,Pje=d5,Eje=Array.prototype,kje=Eje.splice;function Ije(e){var t=this.__data__,r=Pje(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():kje.call(t,r,1),--this.size,!0}var Oje=Ije,Tje=d5;function Dje(e){var t=this.__data__,r=Tje(t,e);return r<0?void 0:t[r][1]}var Mje=Dje,Rje=d5;function Fje(e){return Rje(this.__data__,e)>-1}var Lje=Fje,$je=d5;function Bje(e,t){var r=this.__data__,n=$je(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var qje=Bje,zje=Nje,Uje=Oje,Vje=Mje,Wje=Lje,Hje=qje;function ry(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ry.prototype.clear=zje;ry.prototype.delete=Uje;ry.prototype.get=Vje;ry.prototype.has=Wje;ry.prototype.set=Hje;var u5=ry,Gje=ux,Kje=$f,Xje=Gje(Kje,"Map"),aM=Xje,C8=_je,Yje=u5,Jje=aM;function Qje(){this.size=0,this.__data__={hash:new C8,map:new(Jje||Yje),string:new C8}}var Zje=Qje;function eNe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var tNe=eNe,rNe=tNe;function nNe(e,t){var r=e.__data__;return rNe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var f5=nNe,aNe=f5;function sNe(e){var t=aNe(this,e).delete(e);return this.size-=t?1:0,t}var oNe=sNe,iNe=f5;function lNe(e){return iNe(this,e).get(e)}var cNe=lNe,dNe=f5;function uNe(e){return dNe(this,e).has(e)}var fNe=uNe,mNe=f5;function hNe(e,t){var r=mNe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var pNe=hNe,gNe=Zje,xNe=oNe,vNe=cNe,yNe=fNe,bNe=pNe;function ny(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ny.prototype.clear=gNe;ny.prototype.delete=xNe;ny.prototype.get=vNe;ny.prototype.has=yNe;ny.prototype.set=bNe;var sM=ny,rJ=sM,wNe="Expected a function";function oM(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(wNe);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],o=r.cache;if(o.has(s))return o.get(s);var i=e.apply(this,n);return r.cache=o.set(s,i)||o,i};return r.cache=new(oM.Cache||rJ),r}oM.Cache=rJ;var nJ=oM;const _Ne=xs(nJ);var jNe=nJ,NNe=500;function SNe(e){var t=jNe(e,function(n){return r.size===NNe&&r.clear(),n}),r=t.cache;return t}var CNe=SNe,ANe=CNe,PNe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ENe=/\\(\\)?/g,kNe=ANe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(PNe,function(r,n,s,o){t.push(s?o.replace(ENe,"$1"):n||r)}),t}),INe=kNe;function ONe(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var iM=ONe,A8=r2,TNe=iM,DNe=Mc,MNe=Z0,RNe=1/0,P8=A8?A8.prototype:void 0,E8=P8?P8.toString:void 0;function aJ(e){if(typeof e=="string")return e;if(DNe(e))return TNe(e,aJ)+"";if(MNe(e))return E8?E8.call(e):"";var t=e+"";return t=="0"&&1/e==-RNe?"-0":t}var FNe=aJ,LNe=FNe;function $Ne(e){return e==null?"":LNe(e)}var sJ=$Ne,BNe=Mc,qNe=tM,zNe=INe,UNe=sJ;function VNe(e,t){return BNe(e)?e:qNe(e,t)?[e]:zNe(UNe(e))}var oJ=VNe,WNe=Z0,HNe=1/0;function GNe(e){if(typeof e=="string"||WNe(e))return e;var t=e+"";return t=="0"&&1/e==-HNe?"-0":t}var m5=GNe,KNe=oJ,XNe=m5;function YNe(e,t){t=KNe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[XNe(t[r++])];return r&&r==n?e:void 0}var lM=YNe,JNe=lM;function QNe(e,t,r){var n=e==null?void 0:JNe(e,t);return n===void 0?r:n}var iJ=QNe;const hd=xs(iJ);function ZNe(e){return e==null}var eSe=ZNe;const La=xs(eSe);var tSe=$m,rSe=Mc,nSe=Bm,aSe="[object String]";function sSe(e){return typeof e=="string"||!rSe(e)&&nSe(e)&&tSe(e)==aSe}var oSe=sSe;const Hg=xs(oSe);var lJ={exports:{}},zs={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cM=Symbol.for("react.element"),dM=Symbol.for("react.portal"),h5=Symbol.for("react.fragment"),p5=Symbol.for("react.strict_mode"),g5=Symbol.for("react.profiler"),x5=Symbol.for("react.provider"),v5=Symbol.for("react.context"),iSe=Symbol.for("react.server_context"),y5=Symbol.for("react.forward_ref"),b5=Symbol.for("react.suspense"),w5=Symbol.for("react.suspense_list"),_5=Symbol.for("react.memo"),j5=Symbol.for("react.lazy"),lSe=Symbol.for("react.offscreen"),cJ;cJ=Symbol.for("react.module.reference");function du(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case cM:switch(e=e.type,e){case h5:case g5:case p5:case b5:case w5:return e;default:switch(e=e&&e.$$typeof,e){case iSe:case v5:case y5:case j5:case _5:case x5:return e;default:return t}}case dM:return t}}}zs.ContextConsumer=v5;zs.ContextProvider=x5;zs.Element=cM;zs.ForwardRef=y5;zs.Fragment=h5;zs.Lazy=j5;zs.Memo=_5;zs.Portal=dM;zs.Profiler=g5;zs.StrictMode=p5;zs.Suspense=b5;zs.SuspenseList=w5;zs.isAsyncMode=function(){return!1};zs.isConcurrentMode=function(){return!1};zs.isContextConsumer=function(e){return du(e)===v5};zs.isContextProvider=function(e){return du(e)===x5};zs.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===cM};zs.isForwardRef=function(e){return du(e)===y5};zs.isFragment=function(e){return du(e)===h5};zs.isLazy=function(e){return du(e)===j5};zs.isMemo=function(e){return du(e)===_5};zs.isPortal=function(e){return du(e)===dM};zs.isProfiler=function(e){return du(e)===g5};zs.isStrictMode=function(e){return du(e)===p5};zs.isSuspense=function(e){return du(e)===b5};zs.isSuspenseList=function(e){return du(e)===w5};zs.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===h5||e===g5||e===p5||e===b5||e===w5||e===lSe||typeof e=="object"&&e!==null&&(e.$$typeof===j5||e.$$typeof===_5||e.$$typeof===x5||e.$$typeof===v5||e.$$typeof===y5||e.$$typeof===cJ||e.getModuleId!==void 0)};zs.typeOf=du;lJ.exports=zs;var cSe=lJ.exports,dSe=$m,uSe=Bm,fSe="[object Number]";function mSe(e){return typeof e=="number"||uSe(e)&&dSe(e)==fSe}var dJ=mSe;const hSe=xs(dJ);var pSe=dJ;function gSe(e){return pSe(e)&&e!=+e}var xSe=gSe;const ay=xs(xSe);var rc=function(t){return t===0?0:t>0?1:-1},ug=function(t){return Hg(t)&&t.indexOf("%")===t.length-1},vn=function(t){return hSe(t)&&!ay(t)},vSe=function(t){return La(t)},Mi=function(t){return vn(t)||Hg(t)},ySe=0,fx=function(t){var r=++ySe;return"".concat(t||"").concat(r)},nc=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!vn(t)&&!Hg(t))return n;var o;if(ug(t)){var i=t.indexOf("%");o=r*parseFloat(t.slice(0,i))/100}else o=+t;return ay(o)&&(o=n),s&&o>r&&(o=r),o},xh=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},bSe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},s=0;s<r;s++)if(!n[t[s]])n[t[s]]=!0;else return!0;return!1},Ti=function(t,r){return vn(t)&&vn(r)?function(n){return t+n*(r-t)}:function(){return r}};function MN(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):hd(n,t))===r})}var wSe=function(t,r){return vn(t)&&vn(r)?t-r:Hg(t)&&Hg(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Lv(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function SO(e){"@babel/helpers - typeof";return SO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},SO(e)}var _Se=["viewBox","children"],jSe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],k8=["points","pathLength"],iE={svg:_Se,polygon:k8,polyline:k8},uM=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],RN=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(p.isValidElement(t)&&(n=t.props),!ey(n))return null;var s={};return Object.keys(n).forEach(function(o){uM.includes(o)&&(s[o]=r||function(i){return n[o](n,i)})}),s},NSe=function(t,r,n){return function(s){return t(r,n,s),null}},Gg=function(t,r,n){if(!ey(t)||SO(t)!=="object")return null;var s=null;return Object.keys(t).forEach(function(o){var i=t[o];uM.includes(o)&&typeof i=="function"&&(s||(s={}),s[o]=NSe(i,r,n))}),s},SSe=["children"],CSe=["children"];function I8(e,t){if(e==null)return{};var r=ASe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ASe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function CO(e){"@babel/helpers - typeof";return CO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},CO(e)}var O8={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},vm=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},T8=null,lE=null,fM=function e(t){if(t===T8&&Array.isArray(lE))return lE;var r=[];return p.Children.forEach(t,function(n){La(n)||(cSe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),lE=r,T8=t,r};function pd(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(s){return vm(s)}):n=[vm(t)],fM(e).forEach(function(s){var o=hd(s,"type.displayName")||hd(s,"type.name");n.indexOf(o)!==-1&&r.push(s)}),r}function ed(e,t){var r=pd(e,t);return r&&r[0]}var D8=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,s=r.height;return!(!vn(n)||n<=0||!vn(s)||s<=0)},PSe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],ESe=function(t){return t&&t.type&&Hg(t.type)&&PSe.indexOf(t.type)>=0},uJ=function(t){return t&&CO(t)==="object"&&"clipDot"in t},kSe=function(t,r,n,s){var o,i=(o=iE?.[s])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!Ea(t)&&(s&&i.includes(r)||jSe.includes(r))||n&&uM.includes(r)},ha=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var s=t;if(p.isValidElement(t)&&(s=t.props),!ey(s))return null;var o={};return Object.keys(s).forEach(function(i){var l;kSe((l=s)===null||l===void 0?void 0:l[i],i,r,n)&&(o[i]=s[i])}),o},AO=function e(t,r){if(t===r)return!0;var n=p.Children.count(t);if(n!==p.Children.count(r))return!1;if(n===0)return!0;if(n===1)return M8(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var s=0;s<n;s++){var o=t[s],i=r[s];if(Array.isArray(o)||Array.isArray(i)){if(!e(o,i))return!1}else if(!M8(o,i))return!1}return!0},M8=function(t,r){if(La(t)&&La(r))return!0;if(!La(t)&&!La(r)){var n=t.props||{},s=n.children,o=I8(n,SSe),i=r.props||{},l=i.children,c=I8(i,CSe);return s&&l?Lv(o,c)&&AO(s,l):!s&&!l?Lv(o,c):!1}return!1},R8=function(t,r){var n=[],s={};return fM(t).forEach(function(o,i){if(ESe(o))n.push(o);else if(o){var l=vm(o.type),c=r[l]||{},d=c.handler,u=c.once;if(d&&(!u||!s[l])){var f=d(o,l,i);n.push(f),s[l]=!0}}}),n},ISe=function(t){var r=t&&t.type;return r&&O8[r]?O8[r]:null},OSe=function(t,r){return fM(r).indexOf(t)},TSe=["children","width","height","viewBox","className","style","title","desc"];function PO(){return PO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PO.apply(this,arguments)}function DSe(e,t){if(e==null)return{};var r=MSe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function MSe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function EO(e){var t=e.children,r=e.width,n=e.height,s=e.viewBox,o=e.className,i=e.style,l=e.title,c=e.desc,d=DSe(e,TSe),u=s||{width:r,height:n,x:0,y:0},f=qa("recharts-surface",o);return Ee.createElement("svg",PO({},ha(d,!0,"svg"),{className:f,width:r,height:n,style:i,viewBox:"".concat(u.x," ").concat(u.y," ").concat(u.width," ").concat(u.height)}),Ee.createElement("title",null,l),Ee.createElement("desc",null,c),t)}var RSe=["children","className"];function kO(){return kO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kO.apply(this,arguments)}function FSe(e,t){if(e==null)return{};var r=LSe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function LSe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var ns=Ee.forwardRef(function(e,t){var r=e.children,n=e.className,s=FSe(e,RSe),o=qa("recharts-layer",n);return Ee.createElement("g",kO({className:o},ha(s,!0),{ref:t}),r)}),Lu=function(t,r){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o]};function $Se(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),r=r>s?s:r,r<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(s);++n<s;)o[n]=e[n+t];return o}var BSe=$Se,qSe=BSe;function zSe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:qSe(e,t,r)}var USe=zSe,VSe="\\ud800-\\udfff",WSe="\\u0300-\\u036f",HSe="\\ufe20-\\ufe2f",GSe="\\u20d0-\\u20ff",KSe=WSe+HSe+GSe,XSe="\\ufe0e\\ufe0f",YSe="\\u200d",JSe=RegExp("["+YSe+VSe+KSe+XSe+"]");function QSe(e){return JSe.test(e)}var fJ=QSe;function ZSe(e){return e.split("")}var eCe=ZSe,mJ="\\ud800-\\udfff",tCe="\\u0300-\\u036f",rCe="\\ufe20-\\ufe2f",nCe="\\u20d0-\\u20ff",aCe=tCe+rCe+nCe,sCe="\\ufe0e\\ufe0f",oCe="["+mJ+"]",IO="["+aCe+"]",OO="\\ud83c[\\udffb-\\udfff]",iCe="(?:"+IO+"|"+OO+")",hJ="[^"+mJ+"]",pJ="(?:\\ud83c[\\udde6-\\uddff]){2}",gJ="[\\ud800-\\udbff][\\udc00-\\udfff]",lCe="\\u200d",xJ=iCe+"?",vJ="["+sCe+"]?",cCe="(?:"+lCe+"(?:"+[hJ,pJ,gJ].join("|")+")"+vJ+xJ+")*",dCe=vJ+xJ+cCe,uCe="(?:"+[hJ+IO+"?",IO,pJ,gJ,oCe].join("|")+")",fCe=RegExp(OO+"(?="+OO+")|"+uCe+dCe,"g");function mCe(e){return e.match(fCe)||[]}var hCe=mCe,pCe=eCe,gCe=fJ,xCe=hCe;function vCe(e){return gCe(e)?xCe(e):pCe(e)}var yCe=vCe,bCe=USe,wCe=fJ,_Ce=yCe,jCe=sJ;function NCe(e){return function(t){t=jCe(t);var r=wCe(t)?_Ce(t):void 0,n=r?r[0]:t.charAt(0),s=r?bCe(r,1).join(""):t.slice(1);return n[e]()+s}}var SCe=NCe,CCe=SCe,ACe=CCe("toUpperCase"),PCe=ACe;const N5=xs(PCe);function oo(e){return function(){return e}}const yJ=Math.cos,FN=Math.sin,Ku=Math.sqrt,LN=Math.PI,S5=2*LN,TO=Math.PI,DO=2*TO,Jp=1e-6,ECe=DO-Jp;function bJ(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function kCe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return bJ;const r=10**t;return function(n){this._+=n[0];for(let s=1,o=n.length;s<o;++s)this._+=Math.round(arguments[s]*r)/r+n[s]}}class ICe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?bJ:kCe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,s){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+s}`}bezierCurveTo(t,r,n,s,o,i){this._append`C${+t},${+r},${+n},${+s},${this._x1=+o},${this._y1=+i}`}arcTo(t,r,n,s,o){if(t=+t,r=+r,n=+n,s=+s,o=+o,o<0)throw new Error(`negative radius: ${o}`);let i=this._x1,l=this._y1,c=n-t,d=s-r,u=i-t,f=l-r,h=u*u+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>Jp)if(!(Math.abs(f*c-d*u)>Jp)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let m=n-i,x=s-l,g=c*c+d*d,y=m*m+x*x,v=Math.sqrt(g),b=Math.sqrt(h),w=o*Math.tan((TO-Math.acos((g+h-y)/(2*v*b)))/2),_=w/b,j=w/v;Math.abs(_-1)>Jp&&this._append`L${t+_*u},${r+_*f}`,this._append`A${o},${o},0,0,${+(f*m>u*x)},${this._x1=t+j*c},${this._y1=r+j*d}`}}arc(t,r,n,s,o,i){if(t=+t,r=+r,n=+n,i=!!i,n<0)throw new Error(`negative radius: ${n}`);let l=n*Math.cos(s),c=n*Math.sin(s),d=t+l,u=r+c,f=1^i,h=i?s-o:o-s;this._x1===null?this._append`M${d},${u}`:(Math.abs(this._x1-d)>Jp||Math.abs(this._y1-u)>Jp)&&this._append`L${d},${u}`,n&&(h<0&&(h=h%DO+DO),h>ECe?this._append`A${n},${n},0,1,${f},${t-l},${r-c}A${n},${n},0,1,${f},${this._x1=d},${this._y1=u}`:h>Jp&&this._append`A${n},${n},0,${+(h>=TO)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+s}h${-n}Z`}toString(){return this._}}function mM(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new ICe(t)}function hM(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function wJ(e){this._context=e}wJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function C5(e){return new wJ(e)}function _J(e){return e[0]}function jJ(e){return e[1]}function NJ(e,t){var r=oo(!0),n=null,s=C5,o=null,i=mM(l);e=typeof e=="function"?e:e===void 0?_J:oo(e),t=typeof t=="function"?t:t===void 0?jJ:oo(t);function l(c){var d,u=(c=hM(c)).length,f,h=!1,m;for(n==null&&(o=s(m=i())),d=0;d<=u;++d)!(d<u&&r(f=c[d],d,c))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(f,d,c),+t(f,d,c));if(m)return o=null,m+""||null}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:oo(+c),l):e},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:oo(+c),l):t},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:oo(!!c),l):r},l.curve=function(c){return arguments.length?(s=c,n!=null&&(o=s(n)),l):s},l.context=function(c){return arguments.length?(c==null?n=o=null:o=s(n=c),l):n},l}function C_(e,t,r){var n=null,s=oo(!0),o=null,i=C5,l=null,c=mM(d);e=typeof e=="function"?e:e===void 0?_J:oo(+e),t=typeof t=="function"?t:oo(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?jJ:oo(+r);function d(f){var h,m,x,g=(f=hM(f)).length,y,v=!1,b,w=new Array(g),_=new Array(g);for(o==null&&(l=i(b=c())),h=0;h<=g;++h){if(!(h<g&&s(y=f[h],h,f))===v)if(v=!v)m=h,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),x=h-1;x>=m;--x)l.point(w[x],_[x]);l.lineEnd(),l.areaEnd()}v&&(w[h]=+e(y,h,f),_[h]=+t(y,h,f),l.point(n?+n(y,h,f):w[h],r?+r(y,h,f):_[h]))}if(b)return l=null,b+""||null}function u(){return NJ().defined(s).curve(i).context(o)}return d.x=function(f){return arguments.length?(e=typeof f=="function"?f:oo(+f),n=null,d):e},d.x0=function(f){return arguments.length?(e=typeof f=="function"?f:oo(+f),d):e},d.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:oo(+f),d):n},d.y=function(f){return arguments.length?(t=typeof f=="function"?f:oo(+f),r=null,d):t},d.y0=function(f){return arguments.length?(t=typeof f=="function"?f:oo(+f),d):t},d.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:oo(+f),d):r},d.lineX0=d.lineY0=function(){return u().x(e).y(t)},d.lineY1=function(){return u().x(e).y(r)},d.lineX1=function(){return u().x(n).y(t)},d.defined=function(f){return arguments.length?(s=typeof f=="function"?f:oo(!!f),d):s},d.curve=function(f){return arguments.length?(i=f,o!=null&&(l=i(o)),d):i},d.context=function(f){return arguments.length?(f==null?o=l=null:l=i(o=f),d):o},d}class SJ{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function OCe(e){return new SJ(e,!0)}function TCe(e){return new SJ(e,!1)}const pM={draw(e,t){const r=Ku(t/LN);e.moveTo(r,0),e.arc(0,0,r,0,S5)}},DCe={draw(e,t){const r=Ku(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},CJ=Ku(1/3),MCe=CJ*2,RCe={draw(e,t){const r=Ku(t/MCe),n=r*CJ;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},FCe={draw(e,t){const r=Ku(t),n=-r/2;e.rect(n,n,r,r)}},LCe=.8908130915292852,AJ=FN(LN/10)/FN(7*LN/10),$Ce=FN(S5/10)*AJ,BCe=-yJ(S5/10)*AJ,qCe={draw(e,t){const r=Ku(t*LCe),n=$Ce*r,s=BCe*r;e.moveTo(0,-r),e.lineTo(n,s);for(let o=1;o<5;++o){const i=S5*o/5,l=yJ(i),c=FN(i);e.lineTo(c*r,-l*r),e.lineTo(l*n-c*s,c*n+l*s)}e.closePath()}},cE=Ku(3),zCe={draw(e,t){const r=-Ku(t/(cE*3));e.moveTo(0,r*2),e.lineTo(-cE*r,-r),e.lineTo(cE*r,-r),e.closePath()}},Od=-.5,Td=Ku(3)/2,MO=1/Ku(12),UCe=(MO/2+1)*3,VCe={draw(e,t){const r=Ku(t/UCe),n=r/2,s=r*MO,o=n,i=r*MO+r,l=-o,c=i;e.moveTo(n,s),e.lineTo(o,i),e.lineTo(l,c),e.lineTo(Od*n-Td*s,Td*n+Od*s),e.lineTo(Od*o-Td*i,Td*o+Od*i),e.lineTo(Od*l-Td*c,Td*l+Od*c),e.lineTo(Od*n+Td*s,Od*s-Td*n),e.lineTo(Od*o+Td*i,Od*i-Td*o),e.lineTo(Od*l+Td*c,Od*c-Td*l),e.closePath()}};function WCe(e,t){let r=null,n=mM(s);e=typeof e=="function"?e:oo(e||pM),t=typeof t=="function"?t:oo(t===void 0?64:+t);function s(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return s.type=function(o){return arguments.length?(e=typeof o=="function"?o:oo(o),s):e},s.size=function(o){return arguments.length?(t=typeof o=="function"?o:oo(+o),s):t},s.context=function(o){return arguments.length?(r=o??null,s):r},s}function $N(){}function BN(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function PJ(e){this._context=e}PJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:BN(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:BN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function HCe(e){return new PJ(e)}function EJ(e){this._context=e}EJ.prototype={areaStart:$N,areaEnd:$N,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:BN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function GCe(e){return new EJ(e)}function kJ(e){this._context=e}kJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:BN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function KCe(e){return new kJ(e)}function IJ(e){this._context=e}IJ.prototype={areaStart:$N,areaEnd:$N,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function XCe(e){return new IJ(e)}function F8(e){return e<0?-1:1}function L8(e,t,r){var n=e._x1-e._x0,s=t-e._x1,o=(e._y1-e._y0)/(n||s<0&&-0),i=(r-e._y1)/(s||n<0&&-0),l=(o*s+i*n)/(n+s);return(F8(o)+F8(i))*Math.min(Math.abs(o),Math.abs(i),.5*Math.abs(l))||0}function $8(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function dE(e,t,r){var n=e._x0,s=e._y0,o=e._x1,i=e._y1,l=(o-n)/3;e._context.bezierCurveTo(n+l,s+l*t,o-l,i-l*r,o,i)}function qN(e){this._context=e}qN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:dE(this,this._t0,$8(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,dE(this,$8(this,r=L8(this,e,t)),r);break;default:dE(this,this._t0,r=L8(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function OJ(e){this._context=new TJ(e)}(OJ.prototype=Object.create(qN.prototype)).point=function(e,t){qN.prototype.point.call(this,t,e)};function TJ(e){this._context=e}TJ.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,s,o){this._context.bezierCurveTo(t,e,n,r,o,s)}};function YCe(e){return new qN(e)}function JCe(e){return new OJ(e)}function DJ(e){this._context=e}DJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=B8(e),s=B8(t),o=0,i=1;i<r;++o,++i)this._context.bezierCurveTo(n[0][o],s[0][o],n[1][o],s[1][o],e[i],t[i]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function B8(e){var t,r=e.length-1,n,s=new Array(r),o=new Array(r),i=new Array(r);for(s[0]=0,o[0]=2,i[0]=e[0]+2*e[1],t=1;t<r-1;++t)s[t]=1,o[t]=4,i[t]=4*e[t]+2*e[t+1];for(s[r-1]=2,o[r-1]=7,i[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=s[t]/o[t-1],o[t]-=n,i[t]-=n*i[t-1];for(s[r-1]=i[r-1]/o[r-1],t=r-2;t>=0;--t)s[t]=(i[t]-s[t+1])/o[t];for(o[r-1]=(e[r]+s[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-s[t+1];return[s,o]}function QCe(e){return new DJ(e)}function A5(e,t){this._context=e,this._t=t}A5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function ZCe(e){return new A5(e,.5)}function e5e(e){return new A5(e,0)}function t5e(e){return new A5(e,1)}function i0(e,t){if((i=e.length)>1)for(var r=1,n,s,o=e[t[0]],i,l=o.length;r<i;++r)for(s=o,o=e[t[r]],n=0;n<l;++n)o[n][1]+=o[n][0]=isNaN(s[n][1])?s[n][0]:s[n][1]}function RO(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function r5e(e,t){return e[t]}function n5e(e){const t=[];return t.key=e,t}function a5e(){var e=oo([]),t=RO,r=i0,n=r5e;function s(o){var i=Array.from(e.apply(this,arguments),n5e),l,c=i.length,d=-1,u;for(const f of o)for(l=0,++d;l<c;++l)(i[l][d]=[0,+n(f,i[l].key,d,o)]).data=f;for(l=0,u=hM(t(i));l<c;++l)i[u[l]].index=l;return r(i,u),i}return s.keys=function(o){return arguments.length?(e=typeof o=="function"?o:oo(Array.from(o)),s):e},s.value=function(o){return arguments.length?(n=typeof o=="function"?o:oo(+o),s):n},s.order=function(o){return arguments.length?(t=o==null?RO:typeof o=="function"?o:oo(Array.from(o)),s):t},s.offset=function(o){return arguments.length?(r=o??i0,s):r},s}function s5e(e,t){if((n=e.length)>0){for(var r,n,s=0,o=e[0].length,i;s<o;++s){for(i=r=0;r<n;++r)i+=e[r][s][1]||0;if(i)for(r=0;r<n;++r)e[r][s][1]/=i}i0(e,t)}}function o5e(e,t){if((s=e.length)>0){for(var r=0,n=e[t[0]],s,o=n.length;r<o;++r){for(var i=0,l=0;i<s;++i)l+=e[i][r][1]||0;n[r][1]+=n[r][0]=-l/2}i0(e,t)}}function i5e(e,t){if(!(!((i=e.length)>0)||!((o=(s=e[t[0]]).length)>0))){for(var r=0,n=1,s,o,i;n<o;++n){for(var l=0,c=0,d=0;l<i;++l){for(var u=e[t[l]],f=u[n][1]||0,h=u[n-1][1]||0,m=(f-h)/2,x=0;x<l;++x){var g=e[t[x]],y=g[n][1]||0,v=g[n-1][1]||0;m+=y-v}c+=f,d+=m*f}s[n-1][1]+=s[n-1][0]=r,c&&(r-=d/c)}s[n-1][1]+=s[n-1][0]=r,i0(e,t)}}function $w(e){"@babel/helpers - typeof";return $w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$w(e)}var l5e=["type","size","sizeType"];function FO(){return FO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},FO.apply(this,arguments)}function q8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function z8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q8(Object(r),!0).forEach(function(n){c5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c5e(e,t,r){return t=d5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d5e(e){var t=u5e(e,"string");return $w(t)=="symbol"?t:t+""}function u5e(e,t){if($w(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($w(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function f5e(e,t){if(e==null)return{};var r=m5e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function m5e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var MJ={symbolCircle:pM,symbolCross:DCe,symbolDiamond:RCe,symbolSquare:FCe,symbolStar:qCe,symbolTriangle:zCe,symbolWye:VCe},h5e=Math.PI/180,p5e=function(t){var r="symbol".concat(N5(t));return MJ[r]||pM},g5e=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var s=18*h5e;return 1.25*t*t*(Math.tan(s)-Math.tan(s*2)*Math.pow(Math.tan(s),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},x5e=function(t,r){MJ["symbol".concat(N5(t))]=r},gM=function(t){var r=t.type,n=r===void 0?"circle":r,s=t.size,o=s===void 0?64:s,i=t.sizeType,l=i===void 0?"area":i,c=f5e(t,l5e),d=z8(z8({},c),{},{type:n,size:o,sizeType:l}),u=function(){var y=p5e(n),v=WCe().type(y).size(g5e(o,l,n));return v()},f=d.className,h=d.cx,m=d.cy,x=ha(d,!0);return h===+h&&m===+m&&o===+o?Ee.createElement("path",FO({},x,{className:qa("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(m,")"),d:u()})):null};gM.registerSymbol=x5e;function l0(e){"@babel/helpers - typeof";return l0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l0(e)}function LO(){return LO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},LO.apply(this,arguments)}function U8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function v5e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U8(Object(r),!0).forEach(function(n){Bw(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function y5e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,FJ(n.key),n)}}function b5e(e,t,r){return t&&V8(e.prototype,t),r&&V8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function w5e(e,t,r){return t=zN(t),_5e(e,RJ()?Reflect.construct(t,r||[],zN(e).constructor):t.apply(e,r))}function _5e(e,t){if(t&&(l0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return j5e(e)}function j5e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function RJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(RJ=function(){return!!e})()}function zN(e){return zN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zN(e)}function N5e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$O(e,t)}function $O(e,t){return $O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},$O(e,t)}function Bw(e,t,r){return t=FJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FJ(e){var t=S5e(e,"string");return l0(t)=="symbol"?t:t+""}function S5e(e,t){if(l0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(l0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Dd=32,xM=function(e){function t(){return y5e(this,t),w5e(this,t,arguments)}return N5e(t,e),b5e(t,[{key:"renderIcon",value:function(n){var s=this.props.inactiveColor,o=Dd/2,i=Dd/6,l=Dd/3,c=n.inactive?s:n.color;if(n.type==="plainline")return Ee.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Dd,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ee.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(o,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(o,`
            H`).concat(Dd,"M").concat(2*l,",").concat(o,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ee.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(Dd/8,"h").concat(Dd,"v").concat(Dd*3/4,"h").concat(-Dd,"z"),className:"recharts-legend-icon"});if(Ee.isValidElement(n.legendIcon)){var d=v5e({},n);return delete d.legendIcon,Ee.cloneElement(n.legendIcon,d)}return Ee.createElement(gM,{fill:c,cx:o,cy:o,size:Dd,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,s=this.props,o=s.payload,i=s.iconSize,l=s.layout,c=s.formatter,d=s.inactiveColor,u={x:0,y:0,width:Dd,height:Dd},f={display:l==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(m,x){var g=m.formatter||c,y=qa(Bw(Bw({"recharts-legend-item":!0},"legend-item-".concat(x),!0),"inactive",m.inactive));if(m.type==="none")return null;var v=Ea(m.value)?null:m.value;Lu(!Ea(m.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var b=m.inactive?d:m.color;return Ee.createElement("li",LO({className:y,style:f,key:"legend-item-".concat(x)},Gg(n.props,m,x)),Ee.createElement(EO,{width:i,height:i,viewBox:u,style:h},n.renderIcon(m)),Ee.createElement("span",{className:"recharts-legend-item-text",style:{color:b}},g?g(v,m,x):v))})}},{key:"render",value:function(){var n=this.props,s=n.payload,o=n.layout,i=n.align;if(!s||!s.length)return null;var l={padding:0,margin:0,textAlign:o==="horizontal"?i:"left"};return Ee.createElement("ul",{className:"recharts-default-legend",style:l},this.renderItems())}}])}(p.PureComponent);Bw(xM,"displayName","Legend");Bw(xM,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var C5e=u5;function A5e(){this.__data__=new C5e,this.size=0}var P5e=A5e;function E5e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var k5e=E5e;function I5e(e){return this.__data__.get(e)}var O5e=I5e;function T5e(e){return this.__data__.has(e)}var D5e=T5e,M5e=u5,R5e=aM,F5e=sM,L5e=200;function $5e(e,t){var r=this.__data__;if(r instanceof M5e){var n=r.__data__;if(!R5e||n.length<L5e-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new F5e(n)}return r.set(e,t),this.size=r.size,this}var B5e=$5e,q5e=u5,z5e=P5e,U5e=k5e,V5e=O5e,W5e=D5e,H5e=B5e;function sy(e){var t=this.__data__=new q5e(e);this.size=t.size}sy.prototype.clear=z5e;sy.prototype.delete=U5e;sy.prototype.get=V5e;sy.prototype.has=W5e;sy.prototype.set=H5e;var LJ=sy,G5e="__lodash_hash_undefined__";function K5e(e){return this.__data__.set(e,G5e),this}var X5e=K5e;function Y5e(e){return this.__data__.has(e)}var J5e=Y5e,Q5e=sM,Z5e=X5e,eAe=J5e;function UN(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Q5e;++t<r;)this.add(e[t])}UN.prototype.add=UN.prototype.push=Z5e;UN.prototype.has=eAe;var $J=UN;function tAe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var BJ=tAe;function rAe(e,t){return e.has(t)}var qJ=rAe,nAe=$J,aAe=BJ,sAe=qJ,oAe=1,iAe=2;function lAe(e,t,r,n,s,o){var i=r&oAe,l=e.length,c=t.length;if(l!=c&&!(i&&c>l))return!1;var d=o.get(e),u=o.get(t);if(d&&u)return d==t&&u==e;var f=-1,h=!0,m=r&iAe?new nAe:void 0;for(o.set(e,t),o.set(t,e);++f<l;){var x=e[f],g=t[f];if(n)var y=i?n(g,x,f,t,e,o):n(x,g,f,e,t,o);if(y!==void 0){if(y)continue;h=!1;break}if(m){if(!aAe(t,function(v,b){if(!sAe(m,b)&&(x===v||s(x,v,r,n,o)))return m.push(b)})){h=!1;break}}else if(!(x===g||s(x,g,r,n,o))){h=!1;break}}return o.delete(e),o.delete(t),h}var zJ=lAe,cAe=$f,dAe=cAe.Uint8Array,uAe=dAe;function fAe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,s){r[++t]=[s,n]}),r}var mAe=fAe;function hAe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var vM=hAe,W8=r2,H8=uAe,pAe=nM,gAe=zJ,xAe=mAe,vAe=vM,yAe=1,bAe=2,wAe="[object Boolean]",_Ae="[object Date]",jAe="[object Error]",NAe="[object Map]",SAe="[object Number]",CAe="[object RegExp]",AAe="[object Set]",PAe="[object String]",EAe="[object Symbol]",kAe="[object ArrayBuffer]",IAe="[object DataView]",G8=W8?W8.prototype:void 0,uE=G8?G8.valueOf:void 0;function OAe(e,t,r,n,s,o,i){switch(r){case IAe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case kAe:return!(e.byteLength!=t.byteLength||!o(new H8(e),new H8(t)));case wAe:case _Ae:case SAe:return pAe(+e,+t);case jAe:return e.name==t.name&&e.message==t.message;case CAe:case PAe:return e==t+"";case NAe:var l=xAe;case AAe:var c=n&yAe;if(l||(l=vAe),e.size!=t.size&&!c)return!1;var d=i.get(e);if(d)return d==t;n|=bAe,i.set(e,t);var u=gAe(l(e),l(t),n,s,o,i);return i.delete(e),u;case EAe:if(uE)return uE.call(e)==uE.call(t)}return!1}var TAe=OAe;function DAe(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var UJ=DAe,MAe=UJ,RAe=Mc;function FAe(e,t,r){var n=t(e);return RAe(e)?n:MAe(n,r(e))}var LAe=FAe;function $Ae(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[s++]=i)}return o}var BAe=$Ae;function qAe(){return[]}var zAe=qAe,UAe=BAe,VAe=zAe,WAe=Object.prototype,HAe=WAe.propertyIsEnumerable,K8=Object.getOwnPropertySymbols,GAe=K8?function(e){return e==null?[]:(e=Object(e),UAe(K8(e),function(t){return HAe.call(e,t)}))}:VAe,KAe=GAe;function XAe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var YAe=XAe,JAe=$m,QAe=Bm,ZAe="[object Arguments]";function ePe(e){return QAe(e)&&JAe(e)==ZAe}var tPe=ePe,X8=tPe,rPe=Bm,VJ=Object.prototype,nPe=VJ.hasOwnProperty,aPe=VJ.propertyIsEnumerable,sPe=X8(function(){return arguments}())?X8:function(e){return rPe(e)&&nPe.call(e,"callee")&&!aPe.call(e,"callee")},yM=sPe,VN={exports:{}};function oPe(){return!1}var iPe=oPe;VN.exports;(function(e,t){var r=$f,n=iPe,s=t&&!t.nodeType&&t,o=s&&!0&&e&&!e.nodeType&&e,i=o&&o.exports===s,l=i?r.Buffer:void 0,c=l?l.isBuffer:void 0,d=c||n;e.exports=d})(VN,VN.exports);var WJ=VN.exports,lPe=9007199254740991,cPe=/^(?:0|[1-9]\d*)$/;function dPe(e,t){var r=typeof e;return t=t??lPe,!!t&&(r=="number"||r!="symbol"&&cPe.test(e))&&e>-1&&e%1==0&&e<t}var bM=dPe,uPe=9007199254740991;function fPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=uPe}var wM=fPe,mPe=$m,hPe=wM,pPe=Bm,gPe="[object Arguments]",xPe="[object Array]",vPe="[object Boolean]",yPe="[object Date]",bPe="[object Error]",wPe="[object Function]",_Pe="[object Map]",jPe="[object Number]",NPe="[object Object]",SPe="[object RegExp]",CPe="[object Set]",APe="[object String]",PPe="[object WeakMap]",EPe="[object ArrayBuffer]",kPe="[object DataView]",IPe="[object Float32Array]",OPe="[object Float64Array]",TPe="[object Int8Array]",DPe="[object Int16Array]",MPe="[object Int32Array]",RPe="[object Uint8Array]",FPe="[object Uint8ClampedArray]",LPe="[object Uint16Array]",$Pe="[object Uint32Array]",vo={};vo[IPe]=vo[OPe]=vo[TPe]=vo[DPe]=vo[MPe]=vo[RPe]=vo[FPe]=vo[LPe]=vo[$Pe]=!0;vo[gPe]=vo[xPe]=vo[EPe]=vo[vPe]=vo[kPe]=vo[yPe]=vo[bPe]=vo[wPe]=vo[_Pe]=vo[jPe]=vo[NPe]=vo[SPe]=vo[CPe]=vo[APe]=vo[PPe]=!1;function BPe(e){return pPe(e)&&hPe(e.length)&&!!vo[mPe(e)]}var qPe=BPe;function zPe(e){return function(t){return e(t)}}var HJ=zPe,WN={exports:{}};WN.exports;(function(e,t){var r=ZY,n=t&&!t.nodeType&&t,s=n&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===n,i=o&&r.process,l=function(){try{var c=s&&s.require&&s.require("util").types;return c||i&&i.binding&&i.binding("util")}catch{}}();e.exports=l})(WN,WN.exports);var UPe=WN.exports,VPe=qPe,WPe=HJ,Y8=UPe,J8=Y8&&Y8.isTypedArray,HPe=J8?WPe(J8):VPe,GJ=HPe,GPe=YAe,KPe=yM,XPe=Mc,YPe=WJ,JPe=bM,QPe=GJ,ZPe=Object.prototype,eEe=ZPe.hasOwnProperty;function tEe(e,t){var r=XPe(e),n=!r&&KPe(e),s=!r&&!n&&YPe(e),o=!r&&!n&&!s&&QPe(e),i=r||n||s||o,l=i?GPe(e.length,String):[],c=l.length;for(var d in e)(t||eEe.call(e,d))&&!(i&&(d=="length"||s&&(d=="offset"||d=="parent")||o&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||JPe(d,c)))&&l.push(d);return l}var rEe=tEe,nEe=Object.prototype;function aEe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||nEe;return e===r}var sEe=aEe;function oEe(e,t){return function(r){return e(t(r))}}var KJ=oEe,iEe=KJ,lEe=iEe(Object.keys,Object),cEe=lEe,dEe=sEe,uEe=cEe,fEe=Object.prototype,mEe=fEe.hasOwnProperty;function hEe(e){if(!dEe(e))return uEe(e);var t=[];for(var r in Object(e))mEe.call(e,r)&&r!="constructor"&&t.push(r);return t}var pEe=hEe,gEe=rM,xEe=wM;function vEe(e){return e!=null&&xEe(e.length)&&!gEe(e)}var n2=vEe,yEe=rEe,bEe=pEe,wEe=n2;function _Ee(e){return wEe(e)?yEe(e):bEe(e)}var P5=_Ee,jEe=LAe,NEe=KAe,SEe=P5;function CEe(e){return jEe(e,SEe,NEe)}var AEe=CEe,Q8=AEe,PEe=1,EEe=Object.prototype,kEe=EEe.hasOwnProperty;function IEe(e,t,r,n,s,o){var i=r&PEe,l=Q8(e),c=l.length,d=Q8(t),u=d.length;if(c!=u&&!i)return!1;for(var f=c;f--;){var h=l[f];if(!(i?h in t:kEe.call(t,h)))return!1}var m=o.get(e),x=o.get(t);if(m&&x)return m==t&&x==e;var g=!0;o.set(e,t),o.set(t,e);for(var y=i;++f<c;){h=l[f];var v=e[h],b=t[h];if(n)var w=i?n(b,v,h,t,e,o):n(v,b,h,e,t,o);if(!(w===void 0?v===b||s(v,b,r,n,o):w)){g=!1;break}y||(y=h=="constructor")}if(g&&!y){var _=e.constructor,j=t.constructor;_!=j&&"constructor"in e&&"constructor"in t&&!(typeof _=="function"&&_ instanceof _&&typeof j=="function"&&j instanceof j)&&(g=!1)}return o.delete(e),o.delete(t),g}var OEe=IEe,TEe=ux,DEe=$f,MEe=TEe(DEe,"DataView"),REe=MEe,FEe=ux,LEe=$f,$Ee=FEe(LEe,"Promise"),BEe=$Ee,qEe=ux,zEe=$f,UEe=qEe(zEe,"Set"),XJ=UEe,VEe=ux,WEe=$f,HEe=VEe(WEe,"WeakMap"),GEe=HEe,BO=REe,qO=aM,zO=BEe,UO=XJ,VO=GEe,YJ=$m,oy=tJ,Z8="[object Map]",KEe="[object Object]",eB="[object Promise]",tB="[object Set]",rB="[object WeakMap]",nB="[object DataView]",XEe=oy(BO),YEe=oy(qO),JEe=oy(zO),QEe=oy(UO),ZEe=oy(VO),Qp=YJ;(BO&&Qp(new BO(new ArrayBuffer(1)))!=nB||qO&&Qp(new qO)!=Z8||zO&&Qp(zO.resolve())!=eB||UO&&Qp(new UO)!=tB||VO&&Qp(new VO)!=rB)&&(Qp=function(e){var t=YJ(e),r=t==KEe?e.constructor:void 0,n=r?oy(r):"";if(n)switch(n){case XEe:return nB;case YEe:return Z8;case JEe:return eB;case QEe:return tB;case ZEe:return rB}return t});var eke=Qp,fE=LJ,tke=zJ,rke=TAe,nke=OEe,aB=eke,sB=Mc,oB=WJ,ake=GJ,ske=1,iB="[object Arguments]",lB="[object Array]",A_="[object Object]",oke=Object.prototype,cB=oke.hasOwnProperty;function ike(e,t,r,n,s,o){var i=sB(e),l=sB(t),c=i?lB:aB(e),d=l?lB:aB(t);c=c==iB?A_:c,d=d==iB?A_:d;var u=c==A_,f=d==A_,h=c==d;if(h&&oB(e)){if(!oB(t))return!1;i=!0,u=!1}if(h&&!u)return o||(o=new fE),i||ake(e)?tke(e,t,r,n,s,o):rke(e,t,c,r,n,s,o);if(!(r&ske)){var m=u&&cB.call(e,"__wrapped__"),x=f&&cB.call(t,"__wrapped__");if(m||x){var g=m?e.value():e,y=x?t.value():t;return o||(o=new fE),s(g,y,r,n,o)}}return h?(o||(o=new fE),nke(e,t,r,n,s,o)):!1}var lke=ike,cke=lke,dB=Bm;function JJ(e,t,r,n,s){return e===t?!0:e==null||t==null||!dB(e)&&!dB(t)?e!==e&&t!==t:cke(e,t,r,n,JJ,s)}var _M=JJ,dke=LJ,uke=_M,fke=1,mke=2;function hke(e,t,r,n){var s=r.length,o=s,i=!n;if(e==null)return!o;for(e=Object(e);s--;){var l=r[s];if(i&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++s<o;){l=r[s];var c=l[0],d=e[c],u=l[1];if(i&&l[2]){if(d===void 0&&!(c in e))return!1}else{var f=new dke;if(n)var h=n(d,u,c,e,t,f);if(!(h===void 0?uke(u,d,fke|mke,n,f):h))return!1}}return!0}var pke=hke,gke=jp;function xke(e){return e===e&&!gke(e)}var QJ=xke,vke=QJ,yke=P5;function bke(e){for(var t=yke(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,vke(s)]}return t}var wke=bke;function _ke(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var ZJ=_ke,jke=pke,Nke=wke,Ske=ZJ;function Cke(e){var t=Nke(e);return t.length==1&&t[0][2]?Ske(t[0][0],t[0][1]):function(r){return r===e||jke(r,e,t)}}var Ake=Cke;function Pke(e,t){return e!=null&&t in Object(e)}var Eke=Pke,kke=oJ,Ike=yM,Oke=Mc,Tke=bM,Dke=wM,Mke=m5;function Rke(e,t,r){t=kke(t,e);for(var n=-1,s=t.length,o=!1;++n<s;){var i=Mke(t[n]);if(!(o=e!=null&&r(e,i)))break;e=e[i]}return o||++n!=s?o:(s=e==null?0:e.length,!!s&&Dke(s)&&Tke(i,s)&&(Oke(e)||Ike(e)))}var Fke=Rke,Lke=Eke,$ke=Fke;function Bke(e,t){return e!=null&&$ke(e,t,Lke)}var qke=Bke,zke=_M,Uke=iJ,Vke=qke,Wke=tM,Hke=QJ,Gke=ZJ,Kke=m5,Xke=1,Yke=2;function Jke(e,t){return Wke(e)&&Hke(t)?Gke(Kke(e),t):function(r){var n=Uke(r,e);return n===void 0&&n===t?Vke(r,e):zke(t,n,Xke|Yke)}}var Qke=Jke;function Zke(e){return e}var iy=Zke;function eIe(e){return function(t){return t?.[e]}}var tIe=eIe,rIe=lM;function nIe(e){return function(t){return rIe(t,e)}}var aIe=nIe,sIe=tIe,oIe=aIe,iIe=tM,lIe=m5;function cIe(e){return iIe(e)?sIe(lIe(e)):oIe(e)}var dIe=cIe,uIe=Ake,fIe=Qke,mIe=iy,hIe=Mc,pIe=dIe;function gIe(e){return typeof e=="function"?e:e==null?mIe:typeof e=="object"?hIe(e)?fIe(e[0],e[1]):uIe(e):pIe(e)}var Bf=gIe;function xIe(e,t,r,n){for(var s=e.length,o=r+(n?1:-1);n?o--:++o<s;)if(t(e[o],o,e))return o;return-1}var eQ=xIe;function vIe(e){return e!==e}var yIe=vIe;function bIe(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}var wIe=bIe,_Ie=eQ,jIe=yIe,NIe=wIe;function SIe(e,t,r){return t===t?NIe(e,t,r):_Ie(e,jIe,r)}var CIe=SIe,AIe=CIe;function PIe(e,t){var r=e==null?0:e.length;return!!r&&AIe(e,t,0)>-1}var EIe=PIe;function kIe(e,t,r){for(var n=-1,s=e==null?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}var IIe=kIe;function OIe(){}var TIe=OIe,mE=XJ,DIe=TIe,MIe=vM,RIe=1/0,FIe=mE&&1/MIe(new mE([,-0]))[1]==RIe?function(e){return new mE(e)}:DIe,LIe=FIe,$Ie=$J,BIe=EIe,qIe=IIe,zIe=qJ,UIe=LIe,VIe=vM,WIe=200;function HIe(e,t,r){var n=-1,s=BIe,o=e.length,i=!0,l=[],c=l;if(r)i=!1,s=qIe;else if(o>=WIe){var d=t?null:UIe(e);if(d)return VIe(d);i=!1,s=zIe,c=new $Ie}else c=t?[]:l;e:for(;++n<o;){var u=e[n],f=t?t(u):u;if(u=r||u!==0?u:0,i&&f===f){for(var h=c.length;h--;)if(c[h]===f)continue e;t&&c.push(f),l.push(u)}else s(c,f,r)||(c!==l&&c.push(f),l.push(u))}return l}var GIe=HIe,KIe=Bf,XIe=GIe;function YIe(e,t){return e&&e.length?XIe(e,KIe(t)):[]}var JIe=YIe;const uB=xs(JIe);function tQ(e,t,r){return t===!0?uB(e,r):Ea(t)?uB(e,t):e}function c0(e){"@babel/helpers - typeof";return c0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c0(e)}var QIe=["ref"];function fB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Gf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fB(Object(r),!0).forEach(function(n){E5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZIe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nQ(n.key),n)}}function eOe(e,t,r){return t&&mB(e.prototype,t),r&&mB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tOe(e,t,r){return t=HN(t),rOe(e,rQ()?Reflect.construct(t,r||[],HN(e).constructor):t.apply(e,r))}function rOe(e,t){if(t&&(c0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nOe(e)}function nOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rQ=function(){return!!e})()}function HN(e){return HN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},HN(e)}function aOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WO(e,t)}function WO(e,t){return WO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},WO(e,t)}function E5(e,t,r){return t=nQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nQ(e){var t=sOe(e,"string");return c0(t)=="symbol"?t:t+""}function sOe(e,t){if(c0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(c0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function oOe(e,t){if(e==null)return{};var r=iOe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function iOe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function lOe(e){return e.value}function cOe(e,t){if(Ee.isValidElement(e))return Ee.cloneElement(e,t);if(typeof e=="function")return Ee.createElement(e,t);t.ref;var r=oOe(t,QIe);return Ee.createElement(xM,r)}var hB=1,Cg=function(e){function t(){var r;ZIe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=tOe(this,t,[].concat(s)),E5(r,"lastBoundingBox",{width:-1,height:-1}),r}return aOe(t,e),eOe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,s=this.getBBox();s?(Math.abs(s.width-this.lastBoundingBox.width)>hB||Math.abs(s.height-this.lastBoundingBox.height)>hB)&&(this.lastBoundingBox.width=s.width,this.lastBoundingBox.height=s.height,n&&n(s)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Gf({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var s=this.props,o=s.layout,i=s.align,l=s.verticalAlign,c=s.margin,d=s.chartWidth,u=s.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(i==="center"&&o==="vertical"){var m=this.getBBoxSnapshot();f={left:((d||0)-m.width)/2}}else f=i==="right"?{right:c&&c.right||0}:{left:c&&c.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(l==="middle"){var x=this.getBBoxSnapshot();h={top:((u||0)-x.height)/2}}else h=l==="bottom"?{bottom:c&&c.bottom||0}:{top:c&&c.top||0};return Gf(Gf({},f),h)}},{key:"render",value:function(){var n=this,s=this.props,o=s.content,i=s.width,l=s.height,c=s.wrapperStyle,d=s.payloadUniqBy,u=s.payload,f=Gf(Gf({position:"absolute",width:i||"auto",height:l||"auto"},this.getDefaultPosition(c)),c);return Ee.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(m){n.wrapperNode=m}},cOe(o,Gf(Gf({},this.props),{},{payload:tQ(u,d,lOe)})))}}],[{key:"getWithHeight",value:function(n,s){var o=Gf(Gf({},this.defaultProps),n.props),i=o.layout;return i==="vertical"&&vn(n.props.height)?{height:n.props.height}:i==="horizontal"?{width:n.props.width||s}:null}}])}(p.PureComponent);E5(Cg,"displayName","Legend");E5(Cg,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var pB=r2,dOe=yM,uOe=Mc,gB=pB?pB.isConcatSpreadable:void 0;function fOe(e){return uOe(e)||dOe(e)||!!(gB&&e&&e[gB])}var mOe=fOe,hOe=UJ,pOe=mOe;function aQ(e,t,r,n,s){var o=-1,i=e.length;for(r||(r=pOe),s||(s=[]);++o<i;){var l=e[o];t>0&&r(l)?t>1?aQ(l,t-1,r,n,s):hOe(s,l):n||(s[s.length]=l)}return s}var sQ=aQ;function gOe(e){return function(t,r,n){for(var s=-1,o=Object(t),i=n(t),l=i.length;l--;){var c=i[e?l:++s];if(r(o[c],c,o)===!1)break}return t}}var xOe=gOe,vOe=xOe,yOe=vOe(),bOe=yOe,wOe=bOe,_Oe=P5;function jOe(e,t){return e&&wOe(e,t,_Oe)}var oQ=jOe,NOe=n2;function SOe(e,t){return function(r,n){if(r==null)return r;if(!NOe(r))return e(r,n);for(var s=r.length,o=t?s:-1,i=Object(r);(t?o--:++o<s)&&n(i[o],o,i)!==!1;);return r}}var COe=SOe,AOe=oQ,POe=COe,EOe=POe(AOe),jM=EOe,kOe=jM,IOe=n2;function OOe(e,t){var r=-1,n=IOe(e)?Array(e.length):[];return kOe(e,function(s,o,i){n[++r]=t(s,o,i)}),n}var iQ=OOe;function TOe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var DOe=TOe,xB=Z0;function MOe(e,t){if(e!==t){var r=e!==void 0,n=e===null,s=e===e,o=xB(e),i=t!==void 0,l=t===null,c=t===t,d=xB(t);if(!l&&!d&&!o&&e>t||o&&i&&c&&!l&&!d||n&&i&&c||!r&&c||!s)return 1;if(!n&&!o&&!d&&e<t||d&&r&&s&&!n&&!o||l&&r&&s||!i&&s||!c)return-1}return 0}var ROe=MOe,FOe=ROe;function LOe(e,t,r){for(var n=-1,s=e.criteria,o=t.criteria,i=s.length,l=r.length;++n<i;){var c=FOe(s[n],o[n]);if(c){if(n>=l)return c;var d=r[n];return c*(d=="desc"?-1:1)}}return e.index-t.index}var $Oe=LOe,hE=iM,BOe=lM,qOe=Bf,zOe=iQ,UOe=DOe,VOe=HJ,WOe=$Oe,HOe=iy,GOe=Mc;function KOe(e,t,r){t.length?t=hE(t,function(o){return GOe(o)?function(i){return BOe(i,o.length===1?o[0]:o)}:o}):t=[HOe];var n=-1;t=hE(t,VOe(qOe));var s=zOe(e,function(o,i,l){var c=hE(t,function(d){return d(o)});return{criteria:c,index:++n,value:o}});return UOe(s,function(o,i){return WOe(o,i,r)})}var XOe=KOe;function YOe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var JOe=YOe,QOe=JOe,vB=Math.max;function ZOe(e,t,r){return t=vB(t===void 0?e.length-1:t,0),function(){for(var n=arguments,s=-1,o=vB(n.length-t,0),i=Array(o);++s<o;)i[s]=n[t+s];s=-1;for(var l=Array(t+1);++s<t;)l[s]=n[s];return l[t]=r(i),QOe(e,this,l)}}var eTe=ZOe;function tTe(e){return function(){return e}}var rTe=tTe,nTe=ux,aTe=function(){try{var e=nTe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),lQ=aTe,sTe=rTe,yB=lQ,oTe=iy,iTe=yB?function(e,t){return yB(e,"toString",{configurable:!0,enumerable:!1,value:sTe(t),writable:!0})}:oTe,lTe=iTe,cTe=800,dTe=16,uTe=Date.now;function fTe(e){var t=0,r=0;return function(){var n=uTe(),s=dTe-(n-r);if(r=n,s>0){if(++t>=cTe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var mTe=fTe,hTe=lTe,pTe=mTe,gTe=pTe(hTe),xTe=gTe,vTe=iy,yTe=eTe,bTe=xTe;function wTe(e,t){return bTe(yTe(e,t,vTe),e+"")}var _Te=wTe,jTe=nM,NTe=n2,STe=bM,CTe=jp;function ATe(e,t,r){if(!CTe(r))return!1;var n=typeof t;return(n=="number"?NTe(r)&&STe(t,r.length):n=="string"&&t in r)?jTe(r[t],e):!1}var k5=ATe,PTe=sQ,ETe=XOe,kTe=_Te,bB=k5,ITe=kTe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&bB(e,t[0],t[1])?t=[]:r>2&&bB(t[0],t[1],t[2])&&(t=[t[0]]),ETe(e,PTe(t,1),[])}),OTe=ITe;const NM=xs(OTe);function qw(e){"@babel/helpers - typeof";return qw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qw(e)}function HO(){return HO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HO.apply(this,arguments)}function TTe(e,t){return FTe(e)||RTe(e,t)||MTe(e,t)||DTe()}function DTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MTe(e,t){if(e){if(typeof e=="string")return wB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wB(e,t)}}function wB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function RTe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function FTe(e){if(Array.isArray(e))return e}function _B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function pE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_B(Object(r),!0).forEach(function(n){LTe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_B(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LTe(e,t,r){return t=$Te(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $Te(e){var t=BTe(e,"string");return qw(t)=="symbol"?t:t+""}function BTe(e,t){if(qw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(qw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qTe(e){return Array.isArray(e)&&Mi(e[0])&&Mi(e[1])?e.join(" ~ "):e}var zTe=function(t){var r=t.separator,n=r===void 0?" : ":r,s=t.contentStyle,o=s===void 0?{}:s,i=t.itemStyle,l=i===void 0?{}:i,c=t.labelStyle,d=c===void 0?{}:c,u=t.payload,f=t.formatter,h=t.itemSorter,m=t.wrapperClassName,x=t.labelClassName,g=t.label,y=t.labelFormatter,v=t.accessibilityLayer,b=v===void 0?!1:v,w=function(){if(u&&u.length){var I={padding:0,margin:0},T=(h?NM(u,h):u).map(function(k,B){if(k.type==="none")return null;var z=pE({display:"block",paddingTop:4,paddingBottom:4,color:k.color||"#000"},l),U=k.formatter||f||qTe,L=k.value,W=k.name,ge=L,Ae=W;if(U&&ge!=null&&Ae!=null){var V=U(L,W,k,B,u);if(Array.isArray(V)){var $=TTe(V,2);ge=$[0],Ae=$[1]}else ge=V}return Ee.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(B),style:z},Mi(Ae)?Ee.createElement("span",{className:"recharts-tooltip-item-name"},Ae):null,Mi(Ae)?Ee.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ee.createElement("span",{className:"recharts-tooltip-item-value"},ge),Ee.createElement("span",{className:"recharts-tooltip-item-unit"},k.unit||""))});return Ee.createElement("ul",{className:"recharts-tooltip-item-list",style:I},T)}return null},_=pE({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),j=pE({margin:0},d),S=!La(g),C=S?g:"",A=qa("recharts-default-tooltip",m),P=qa("recharts-tooltip-label",x);S&&y&&u!==void 0&&u!==null&&(C=y(g,u));var F=b?{role:"status","aria-live":"assertive"}:{};return Ee.createElement("div",HO({className:A,style:_},F),Ee.createElement("p",{className:P,style:j},Ee.isValidElement(C)?C:"".concat(C)),w())};function zw(e){"@babel/helpers - typeof";return zw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zw(e)}function P_(e,t,r){return t=UTe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UTe(e){var t=VTe(e,"string");return zw(t)=="symbol"?t:t+""}function VTe(e,t){if(zw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(zw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Uy="recharts-tooltip-wrapper",WTe={visibility:"hidden"};function HTe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return qa(Uy,P_(P_(P_(P_({},"".concat(Uy,"-right"),vn(r)&&t&&vn(t.x)&&r>=t.x),"".concat(Uy,"-left"),vn(r)&&t&&vn(t.x)&&r<t.x),"".concat(Uy,"-bottom"),vn(n)&&t&&vn(t.y)&&n>=t.y),"".concat(Uy,"-top"),vn(n)&&t&&vn(t.y)&&n<t.y))}function jB(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,s=e.offsetTopLeft,o=e.position,i=e.reverseDirection,l=e.tooltipDimension,c=e.viewBox,d=e.viewBoxDimension;if(o&&vn(o[n]))return o[n];var u=r[n]-l-s,f=r[n]+s;if(t[n])return i[n]?u:f;if(i[n]){var h=u,m=c[n];return h<m?Math.max(f,c[n]):Math.max(u,c[n])}var x=f+l,g=c[n]+d;return x>g?Math.max(u,c[n]):Math.max(f,c[n])}function GTe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function KTe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,s=e.position,o=e.reverseDirection,i=e.tooltipBox,l=e.useTranslate3d,c=e.viewBox,d,u,f;return i.height>0&&i.width>0&&r?(u=jB({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:i.width,viewBox:c,viewBoxDimension:c.width}),f=jB({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:i.height,viewBox:c,viewBoxDimension:c.height}),d=GTe({translateX:u,translateY:f,useTranslate3d:l})):d=WTe,{cssProperties:d,cssClasses:HTe({translateX:u,translateY:f,coordinate:r})}}function d0(e){"@babel/helpers - typeof";return d0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d0(e)}function NB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function SB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NB(Object(r),!0).forEach(function(n){KO(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XTe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function CB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dQ(n.key),n)}}function YTe(e,t,r){return t&&CB(e.prototype,t),r&&CB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function JTe(e,t,r){return t=GN(t),QTe(e,cQ()?Reflect.construct(t,r||[],GN(e).constructor):t.apply(e,r))}function QTe(e,t){if(t&&(d0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ZTe(e)}function ZTe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cQ=function(){return!!e})()}function GN(e){return GN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},GN(e)}function e3e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GO(e,t)}function GO(e,t){return GO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},GO(e,t)}function KO(e,t,r){return t=dQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dQ(e){var t=t3e(e,"string");return d0(t)=="symbol"?t:t+""}function t3e(e,t){if(d0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(d0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AB=1,r3e=function(e){function t(){var r;XTe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=JTe(this,t,[].concat(s)),KO(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),KO(r,"handleKeyDown",function(i){if(i.key==="Escape"){var l,c,d,u;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(l=(c=r.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&l!==void 0?l:0,y:(d=(u=r.props.coordinate)===null||u===void 0?void 0:u.y)!==null&&d!==void 0?d:0}})}}),r}return e3e(t,e),YTe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>AB||Math.abs(n.height-this.state.lastBoundingBox.height)>AB)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,s;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,s=this.props,o=s.active,i=s.allowEscapeViewBox,l=s.animationDuration,c=s.animationEasing,d=s.children,u=s.coordinate,f=s.hasPayload,h=s.isAnimationActive,m=s.offset,x=s.position,g=s.reverseDirection,y=s.useTranslate3d,v=s.viewBox,b=s.wrapperStyle,w=KTe({allowEscapeViewBox:i,coordinate:u,offsetTopLeft:m,position:x,reverseDirection:g,tooltipBox:this.state.lastBoundingBox,useTranslate3d:y,viewBox:v}),_=w.cssClasses,j=w.cssProperties,S=SB(SB({transition:h&&o?"transform ".concat(l,"ms ").concat(c):void 0},j),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&f?"visible":"hidden",position:"absolute",top:0,left:0},b);return Ee.createElement("div",{tabIndex:-1,className:_,style:S,ref:function(A){n.wrapperNode=A}},d)}}])}(p.PureComponent),n3e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},$u={isSsr:n3e(),get:function(t){return $u[t]},set:function(t,r){if(typeof t=="string")$u[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(s){$u[s]=t[s]})}}};function u0(e){"@babel/helpers - typeof";return u0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u0(e)}function PB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function EB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PB(Object(r),!0).forEach(function(n){SM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function a3e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fQ(n.key),n)}}function s3e(e,t,r){return t&&kB(e.prototype,t),r&&kB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o3e(e,t,r){return t=KN(t),i3e(e,uQ()?Reflect.construct(t,r||[],KN(e).constructor):t.apply(e,r))}function i3e(e,t){if(t&&(u0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l3e(e)}function l3e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uQ=function(){return!!e})()}function KN(e){return KN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},KN(e)}function c3e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&XO(e,t)}function XO(e,t){return XO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},XO(e,t)}function SM(e,t,r){return t=fQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fQ(e){var t=d3e(e,"string");return u0(t)=="symbol"?t:t+""}function d3e(e,t){if(u0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(u0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function u3e(e){return e.dataKey}function f3e(e,t){return Ee.isValidElement(e)?Ee.cloneElement(e,t):typeof e=="function"?Ee.createElement(e,t):Ee.createElement(zTe,t)}var wc=function(e){function t(){return a3e(this,t),o3e(this,t,arguments)}return c3e(t,e),s3e(t,[{key:"render",value:function(){var n=this,s=this.props,o=s.active,i=s.allowEscapeViewBox,l=s.animationDuration,c=s.animationEasing,d=s.content,u=s.coordinate,f=s.filterNull,h=s.isAnimationActive,m=s.offset,x=s.payload,g=s.payloadUniqBy,y=s.position,v=s.reverseDirection,b=s.useTranslate3d,w=s.viewBox,_=s.wrapperStyle,j=x??[];f&&j.length&&(j=tQ(x.filter(function(C){return C.value!=null&&(C.hide!==!0||n.props.includeHidden)}),g,u3e));var S=j.length>0;return Ee.createElement(r3e,{allowEscapeViewBox:i,animationDuration:l,animationEasing:c,isAnimationActive:h,active:o,coordinate:u,hasPayload:S,offset:m,position:y,reverseDirection:v,useTranslate3d:b,viewBox:w,wrapperStyle:_},f3e(d,EB(EB({},this.props),{},{payload:j})))}}])}(p.PureComponent);SM(wc,"displayName","Tooltip");SM(wc,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!$u.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var m3e=$f,h3e=function(){return m3e.Date.now()},p3e=h3e,g3e=/\s/;function x3e(e){for(var t=e.length;t--&&g3e.test(e.charAt(t)););return t}var v3e=x3e,y3e=v3e,b3e=/^\s+/;function w3e(e){return e&&e.slice(0,y3e(e)+1).replace(b3e,"")}var _3e=w3e,j3e=_3e,IB=jp,N3e=Z0,OB=0/0,S3e=/^[-+]0x[0-9a-f]+$/i,C3e=/^0b[01]+$/i,A3e=/^0o[0-7]+$/i,P3e=parseInt;function E3e(e){if(typeof e=="number")return e;if(N3e(e))return OB;if(IB(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=IB(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=j3e(e);var r=C3e.test(e);return r||A3e.test(e)?P3e(e.slice(2),r?2:8):S3e.test(e)?OB:+e}var mQ=E3e,k3e=jp,gE=p3e,TB=mQ,I3e="Expected a function",O3e=Math.max,T3e=Math.min;function D3e(e,t,r){var n,s,o,i,l,c,d=0,u=!1,f=!1,h=!0;if(typeof e!="function")throw new TypeError(I3e);t=TB(t)||0,k3e(r)&&(u=!!r.leading,f="maxWait"in r,o=f?O3e(TB(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h);function m(S){var C=n,A=s;return n=s=void 0,d=S,i=e.apply(A,C),i}function x(S){return d=S,l=setTimeout(v,t),u?m(S):i}function g(S){var C=S-c,A=S-d,P=t-C;return f?T3e(P,o-A):P}function y(S){var C=S-c,A=S-d;return c===void 0||C>=t||C<0||f&&A>=o}function v(){var S=gE();if(y(S))return b(S);l=setTimeout(v,g(S))}function b(S){return l=void 0,h&&n?m(S):(n=s=void 0,i)}function w(){l!==void 0&&clearTimeout(l),d=0,n=c=s=l=void 0}function _(){return l===void 0?i:b(gE())}function j(){var S=gE(),C=y(S);if(n=arguments,s=this,c=S,C){if(l===void 0)return x(c);if(f)return clearTimeout(l),l=setTimeout(v,t),m(c)}return l===void 0&&(l=setTimeout(v,t)),i}return j.cancel=w,j.flush=_,j}var M3e=D3e,R3e=M3e,F3e=jp,L3e="Expected a function";function $3e(e,t,r){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(L3e);return F3e(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),R3e(e,t,{leading:n,maxWait:t,trailing:s})}var B3e=$3e;const hQ=xs(B3e);function Uw(e){"@babel/helpers - typeof";return Uw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uw(e)}function DB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function E_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DB(Object(r),!0).forEach(function(n){q3e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function q3e(e,t,r){return t=z3e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z3e(e){var t=U3e(e,"string");return Uw(t)=="symbol"?t:t+""}function U3e(e,t){if(Uw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Uw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function V3e(e,t){return K3e(e)||G3e(e,t)||H3e(e,t)||W3e()}function W3e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H3e(e,t){if(e){if(typeof e=="string")return MB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return MB(e,t)}}function MB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function G3e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function K3e(e){if(Array.isArray(e))return e}var zb=p.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,s=n===void 0?{width:-1,height:-1}:n,o=e.width,i=o===void 0?"100%":o,l=e.height,c=l===void 0?"100%":l,d=e.minWidth,u=d===void 0?0:d,f=e.minHeight,h=e.maxHeight,m=e.children,x=e.debounce,g=x===void 0?0:x,y=e.id,v=e.className,b=e.onResize,w=e.style,_=w===void 0?{}:w,j=p.useRef(null),S=p.useRef();S.current=b,p.useImperativeHandle(t,function(){return Object.defineProperty(j.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),j.current},configurable:!0})});var C=p.useState({containerWidth:s.width,containerHeight:s.height}),A=V3e(C,2),P=A[0],F=A[1],O=p.useCallback(function(T,k){F(function(B){var z=Math.round(T),U=Math.round(k);return B.containerWidth===z&&B.containerHeight===U?B:{containerWidth:z,containerHeight:U}})},[]);p.useEffect(function(){var T=function(W){var ge,Ae=W[0].contentRect,V=Ae.width,$=Ae.height;O(V,$),(ge=S.current)===null||ge===void 0||ge.call(S,V,$)};g>0&&(T=hQ(T,g,{trailing:!0,leading:!1}));var k=new ResizeObserver(T),B=j.current.getBoundingClientRect(),z=B.width,U=B.height;return O(z,U),k.observe(j.current),function(){k.disconnect()}},[O,g]);var I=p.useMemo(function(){var T=P.containerWidth,k=P.containerHeight;if(T<0||k<0)return null;Lu(ug(i)||ug(c),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,i,c),Lu(!r||r>0,"The aspect(%s) must be greater than zero.",r);var B=ug(i)?T:i,z=ug(c)?k:c;r&&r>0&&(B?z=B/r:z&&(B=z*r),h&&z>h&&(z=h)),Lu(B>0||z>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,B,z,i,c,u,f,r);var U=!Array.isArray(m)&&vm(m.type).endsWith("Chart");return Ee.Children.map(m,function(L){return Ee.isValidElement(L)?p.cloneElement(L,E_({width:B,height:z},U?{style:E_({height:"100%",width:"100%",maxHeight:z,maxWidth:B},L.props.style)}:{})):L})},[r,m,c,h,f,u,P,i]);return Ee.createElement("div",{id:y?"".concat(y):void 0,className:qa("recharts-responsive-container",v),style:E_(E_({},_),{},{width:i,height:c,minWidth:u,minHeight:f,maxHeight:h}),ref:j},I)}),Vw=function(t){return null};Vw.displayName="Cell";function Ww(e){"@babel/helpers - typeof";return Ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ww(e)}function RB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function YO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RB(Object(r),!0).forEach(function(n){X3e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function X3e(e,t,r){return t=Y3e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y3e(e){var t=J3e(e,"string");return Ww(t)=="symbol"?t:t+""}function J3e(e,t){if(Ww(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ww(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Rx={widthCache:{},cacheCount:0},Q3e=2e3,Z3e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},FB="recharts_measurement_span";function e4e(e){var t=YO({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var Ub=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||$u.isSsr)return{width:0,height:0};var n=e4e(r),s=JSON.stringify({text:t,copyStyle:n});if(Rx.widthCache[s])return Rx.widthCache[s];try{var o=document.getElementById(FB);o||(o=document.createElement("span"),o.setAttribute("id",FB),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var i=YO(YO({},Z3e),n);Object.assign(o.style,i),o.textContent="".concat(t);var l=o.getBoundingClientRect(),c={width:l.width,height:l.height};return Rx.widthCache[s]=c,++Rx.cacheCount>Q3e&&(Rx.cacheCount=0,Rx.widthCache={}),c}catch{return{width:0,height:0}}},t4e=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Hw(e){"@babel/helpers - typeof";return Hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hw(e)}function XN(e,t){return s4e(e)||a4e(e,t)||n4e(e,t)||r4e()}function r4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n4e(e,t){if(e){if(typeof e=="string")return LB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LB(e,t)}}function LB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function s4e(e){if(Array.isArray(e))return e}function o4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l4e(n.key),n)}}function i4e(e,t,r){return t&&$B(e.prototype,t),r&&$B(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l4e(e){var t=c4e(e,"string");return Hw(t)=="symbol"?t:t+""}function c4e(e,t){if(Hw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Hw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var BB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,qB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,d4e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,u4e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,pQ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},f4e=Object.keys(pQ),yv="NaN";function m4e(e,t){return e*pQ[t]}var k_=function(){function e(t,r){o4e(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!d4e.test(r)&&(this.num=NaN,this.unit=""),f4e.includes(r)&&(this.num=m4e(t,r),this.unit="px")}return i4e(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,s=(n=u4e.exec(r))!==null&&n!==void 0?n:[],o=XN(s,3),i=o[1],l=o[2];return new e(parseFloat(i),l??"")}}])}();function gQ(e){if(e.includes(yv))return yv;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=BB.exec(t))!==null&&r!==void 0?r:[],s=XN(n,4),o=s[1],i=s[2],l=s[3],c=k_.parse(o??""),d=k_.parse(l??""),u=i==="*"?c.multiply(d):c.divide(d);if(u.isNaN())return yv;t=t.replace(BB,u.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=qB.exec(t))!==null&&f!==void 0?f:[],m=XN(h,4),x=m[1],g=m[2],y=m[3],v=k_.parse(x??""),b=k_.parse(y??""),w=g==="+"?v.add(b):v.subtract(b);if(w.isNaN())return yv;t=t.replace(qB,w.toString())}return t}var zB=/\(([^()]*)\)/;function h4e(e){for(var t=e;t.includes("(");){var r=zB.exec(t),n=XN(r,2),s=n[1];t=t.replace(zB,gQ(s))}return t}function p4e(e){var t=e.replace(/\s+/g,"");return t=h4e(t),t=gQ(t),t}function g4e(e){try{return p4e(e)}catch{return yv}}function xE(e){var t=g4e(e.slice(5,-1));return t===yv?"":t}var x4e=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],v4e=["dx","dy","angle","className","breakAll"];function JO(){return JO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JO.apply(this,arguments)}function UB(e,t){if(e==null)return{};var r=y4e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function y4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function VB(e,t){return j4e(e)||_4e(e,t)||w4e(e,t)||b4e()}function b4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function w4e(e,t){if(e){if(typeof e=="string")return WB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WB(e,t)}}function WB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function j4e(e){if(Array.isArray(e))return e}var xQ=/[ \f\n\r\t\v\u2028\u2029]+/,vQ=function(t){var r=t.children,n=t.breakAll,s=t.style;try{var o=[];La(r)||(n?o=r.toString().split(""):o=r.toString().split(xQ));var i=o.map(function(c){return{word:c,width:Ub(c,s).width}}),l=n?0:Ub("",s).width;return{wordsWithComputedWidth:i,spaceWidth:l}}catch{return null}},N4e=function(t,r,n,s,o){var i=t.maxLines,l=t.children,c=t.style,d=t.breakAll,u=vn(i),f=l,h=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return B.reduce(function(z,U){var L=U.word,W=U.width,ge=z[z.length-1];if(ge&&(s==null||o||ge.width+W+n<Number(s)))ge.words.push(L),ge.width+=W+n;else{var Ae={words:[L],width:W};z.push(Ae)}return z},[])},m=h(r),x=function(B){return B.reduce(function(z,U){return z.width>U.width?z:U})};if(!u)return m;for(var g="",y=function(B){var z=f.slice(0,B),U=vQ({breakAll:d,style:c,children:z+g}).wordsWithComputedWidth,L=h(U),W=L.length>i||x(L).width>Number(s);return[W,L]},v=0,b=f.length-1,w=0,_;v<=b&&w<=f.length-1;){var j=Math.floor((v+b)/2),S=j-1,C=y(S),A=VB(C,2),P=A[0],F=A[1],O=y(j),I=VB(O,1),T=I[0];if(!P&&!T&&(v=j+1),P&&T&&(b=j-1),!P&&T){_=F;break}w++}return _||m},HB=function(t){var r=La(t)?[]:t.toString().split(xQ);return[{words:r}]},S4e=function(t){var r=t.width,n=t.scaleToFit,s=t.children,o=t.style,i=t.breakAll,l=t.maxLines;if((r||n)&&!$u.isSsr){var c,d,u=vQ({breakAll:i,children:s,style:o});if(u){var f=u.wordsWithComputedWidth,h=u.spaceWidth;c=f,d=h}else return HB(s);return N4e({breakAll:i,children:s,maxLines:l,style:o},c,d,r,n)}return HB(s)},GB="#808080",Kg=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,i=t.lineHeight,l=i===void 0?"1em":i,c=t.capHeight,d=c===void 0?"0.71em":c,u=t.scaleToFit,f=u===void 0?!1:u,h=t.textAnchor,m=h===void 0?"start":h,x=t.verticalAnchor,g=x===void 0?"end":x,y=t.fill,v=y===void 0?GB:y,b=UB(t,x4e),w=p.useMemo(function(){return S4e({breakAll:b.breakAll,children:b.children,maxLines:b.maxLines,scaleToFit:f,style:b.style,width:b.width})},[b.breakAll,b.children,b.maxLines,f,b.style,b.width]),_=b.dx,j=b.dy,S=b.angle,C=b.className,A=b.breakAll,P=UB(b,v4e);if(!Mi(n)||!Mi(o))return null;var F=n+(vn(_)?_:0),O=o+(vn(j)?j:0),I;switch(g){case"start":I=xE("calc(".concat(d,")"));break;case"middle":I=xE("calc(".concat((w.length-1)/2," * -").concat(l," + (").concat(d," / 2))"));break;default:I=xE("calc(".concat(w.length-1," * -").concat(l,")"));break}var T=[];if(f){var k=w[0].width,B=b.width;T.push("scale(".concat((vn(B)?B/k:1)/k,")"))}return S&&T.push("rotate(".concat(S,", ").concat(F,", ").concat(O,")")),T.length&&(P.transform=T.join(" ")),Ee.createElement("text",JO({},ha(P,!0),{x:F,y:O,className:qa("recharts-text",C),textAnchor:m,fill:v.includes("url")?GB:v}),w.map(function(z,U){var L=z.words.join(A?"":" ");return Ee.createElement("tspan",{x:F,dy:U===0?I:l,key:"".concat(L,"-").concat(U)},L)}))};function Wh(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function C4e(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function CM(e){let t,r,n;e.length!==2?(t=Wh,r=(l,c)=>Wh(e(l),c),n=(l,c)=>e(l)-c):(t=e===Wh||e===C4e?e:A4e,r=e,n=e);function s(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;r(l[f],c)<0?d=f+1:u=f}while(d<u)}return d}function o(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;r(l[f],c)<=0?d=f+1:u=f}while(d<u)}return d}function i(l,c,d=0,u=l.length){const f=s(l,c,d,u-1);return f>d&&n(l[f-1],c)>-n(l[f],c)?f-1:f}return{left:s,center:i,right:o}}function A4e(){return 0}function yQ(e){return e===null?NaN:+e}function*P4e(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}const E4e=CM(Wh),k4e=E4e.right;CM(yQ).center;const a2=k4e;class KB extends Map{constructor(t,r=T4e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,s]of t)this.set(n,s)}get(t){return super.get(XB(this,t))}has(t){return super.has(XB(this,t))}set(t,r){return super.set(I4e(this,t),r)}delete(t){return super.delete(O4e(this,t))}}function XB({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function I4e({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function O4e({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function T4e(e){return e!==null&&typeof e=="object"?e.valueOf():e}function D4e(e=Wh){if(e===Wh)return bQ;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function bQ(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const M4e=Math.sqrt(50),R4e=Math.sqrt(10),F4e=Math.sqrt(2);function YN(e,t,r){const n=(t-e)/Math.max(0,r),s=Math.floor(Math.log10(n)),o=n/Math.pow(10,s),i=o>=M4e?10:o>=R4e?5:o>=F4e?2:1;let l,c,d;return s<0?(d=Math.pow(10,-s)/i,l=Math.round(e*d),c=Math.round(t*d),l/d<e&&++l,c/d>t&&--c,d=-d):(d=Math.pow(10,s)*i,l=Math.round(e/d),c=Math.round(t/d),l*d<e&&++l,c*d>t&&--c),c<l&&.5<=r&&r<2?YN(e,t,r*2):[l,c,d]}function QO(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[s,o,i]=n?YN(t,e,r):YN(e,t,r);if(!(o>=s))return[];const l=o-s+1,c=new Array(l);if(n)if(i<0)for(let d=0;d<l;++d)c[d]=(o-d)/-i;else for(let d=0;d<l;++d)c[d]=(o-d)*i;else if(i<0)for(let d=0;d<l;++d)c[d]=(s+d)/-i;else for(let d=0;d<l;++d)c[d]=(s+d)*i;return c}function ZO(e,t,r){return t=+t,e=+e,r=+r,YN(e,t,r)[2]}function eT(e,t,r){t=+t,e=+e,r=+r;const n=t<e,s=n?ZO(t,e,r):ZO(e,t,r);return(n?-1:1)*(s<0?1/-s:s)}function YB(e,t){let r;if(t===void 0)for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let s of e)(s=t(s,++n,e))!=null&&(r<s||r===void 0&&s>=s)&&(r=s)}return r}function JB(e,t){let r;if(t===void 0)for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let s of e)(s=t(s,++n,e))!=null&&(r>s||r===void 0&&s>=s)&&(r=s)}return r}function wQ(e,t,r=0,n=1/0,s){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(s=s===void 0?bQ:D4e(s);n>r;){if(n-r>600){const c=n-r+1,d=t-r+1,u=Math.log(c),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(c-f)/c)*(d-c/2<0?-1:1),m=Math.max(r,Math.floor(t-d*f/c+h)),x=Math.min(n,Math.floor(t+(c-d)*f/c+h));wQ(e,t,m,x,s)}const o=e[t];let i=r,l=n;for(Vy(e,r,t),s(e[n],o)>0&&Vy(e,r,n);i<l;){for(Vy(e,i,l),++i,--l;s(e[i],o)<0;)++i;for(;s(e[l],o)>0;)--l}s(e[r],o)===0?Vy(e,r,l):(++l,Vy(e,l,n)),l<=t&&(r=l+1),t<=l&&(n=l-1)}return e}function Vy(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function L4e(e,t,r){if(e=Float64Array.from(P4e(e,r)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return JB(e);if(t>=1)return YB(e);var n,s=(n-1)*t,o=Math.floor(s),i=YB(wQ(e,o).subarray(0,o+1)),l=JB(e.subarray(o+1));return i+(l-i)*(s-o)}}function $4e(e,t,r=yQ){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,s=(n-1)*t,o=Math.floor(s),i=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return i+(l-i)*(s-o)}}function B4e(e,t,r){e=+e,t=+t,r=(s=arguments.length)<2?(t=e,e=0,1):s<3?1:+r;for(var n=-1,s=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(s);++n<s;)o[n]=e+n*r;return o}function uu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function qm(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const tT=Symbol("implicit");function AM(){var e=new KB,t=[],r=[],n=tT;function s(o){let i=e.get(o);if(i===void 0){if(n!==tT)return n;e.set(o,i=t.push(o)-1)}return r[i%r.length]}return s.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new KB;for(const i of o)e.has(i)||e.set(i,t.push(i)-1);return s},s.range=function(o){return arguments.length?(r=Array.from(o),s):r.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return AM(t,r).unknown(n)},uu.apply(s,arguments),s}function Gw(){var e=AM().unknown(void 0),t=e.domain,r=e.range,n=0,s=1,o,i,l=!1,c=0,d=0,u=.5;delete e.unknown;function f(){var h=t().length,m=s<n,x=m?s:n,g=m?n:s;o=(g-x)/Math.max(1,h-c+d*2),l&&(o=Math.floor(o)),x+=(g-x-o*(h-c))*u,i=o*(1-c),l&&(x=Math.round(x),i=Math.round(i));var y=B4e(h).map(function(v){return x+o*v});return r(m?y.reverse():y)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,s]=h,n=+n,s=+s,f()):[n,s]},e.rangeRound=function(h){return[n,s]=h,n=+n,s=+s,l=!0,f()},e.bandwidth=function(){return i},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,f()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,d=+h),f()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),f()):c},e.paddingOuter=function(h){return arguments.length?(d=+h,f()):d},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),f()):u},e.copy=function(){return Gw(t(),[n,s]).round(l).paddingInner(c).paddingOuter(d).align(u)},uu.apply(f(),arguments)}function _Q(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return _Q(t())},e}function Vb(){return _Q(Gw.apply(null,arguments).paddingInner(1))}function PM(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function jQ(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function s2(){}var Kw=.7,JN=1/Kw,$v="\\s*([+-]?\\d+)\\s*",Xw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ef="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",q4e=/^#([0-9a-f]{3,8})$/,z4e=new RegExp(`^rgb\\(${$v},${$v},${$v}\\)$`),U4e=new RegExp(`^rgb\\(${Ef},${Ef},${Ef}\\)$`),V4e=new RegExp(`^rgba\\(${$v},${$v},${$v},${Xw}\\)$`),W4e=new RegExp(`^rgba\\(${Ef},${Ef},${Ef},${Xw}\\)$`),H4e=new RegExp(`^hsl\\(${Xw},${Ef},${Ef}\\)$`),G4e=new RegExp(`^hsla\\(${Xw},${Ef},${Ef},${Xw}\\)$`),QB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};PM(s2,Yw,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ZB,formatHex:ZB,formatHex8:K4e,formatHsl:X4e,formatRgb:eq,toString:eq});function ZB(){return this.rgb().formatHex()}function K4e(){return this.rgb().formatHex8()}function X4e(){return NQ(this).formatHsl()}function eq(){return this.rgb().formatRgb()}function Yw(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=q4e.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?tq(t):r===3?new Ac(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?I_(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?I_(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=z4e.exec(e))?new Ac(t[1],t[2],t[3],1):(t=U4e.exec(e))?new Ac(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=V4e.exec(e))?I_(t[1],t[2],t[3],t[4]):(t=W4e.exec(e))?I_(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=H4e.exec(e))?aq(t[1],t[2]/100,t[3]/100,1):(t=G4e.exec(e))?aq(t[1],t[2]/100,t[3]/100,t[4]):QB.hasOwnProperty(e)?tq(QB[e]):e==="transparent"?new Ac(NaN,NaN,NaN,0):null}function tq(e){return new Ac(e>>16&255,e>>8&255,e&255,1)}function I_(e,t,r,n){return n<=0&&(e=t=r=NaN),new Ac(e,t,r,n)}function Y4e(e){return e instanceof s2||(e=Yw(e)),e?(e=e.rgb(),new Ac(e.r,e.g,e.b,e.opacity)):new Ac}function rT(e,t,r,n){return arguments.length===1?Y4e(e):new Ac(e,t,r,n??1)}function Ac(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}PM(Ac,rT,jQ(s2,{brighter(e){return e=e==null?JN:Math.pow(JN,e),new Ac(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Kw:Math.pow(Kw,e),new Ac(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ac(Ag(this.r),Ag(this.g),Ag(this.b),QN(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rq,formatHex:rq,formatHex8:J4e,formatRgb:nq,toString:nq}));function rq(){return`#${fg(this.r)}${fg(this.g)}${fg(this.b)}`}function J4e(){return`#${fg(this.r)}${fg(this.g)}${fg(this.b)}${fg((isNaN(this.opacity)?1:this.opacity)*255)}`}function nq(){const e=QN(this.opacity);return`${e===1?"rgb(":"rgba("}${Ag(this.r)}, ${Ag(this.g)}, ${Ag(this.b)}${e===1?")":`, ${e})`}`}function QN(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ag(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function fg(e){return e=Ag(e),(e<16?"0":"")+e.toString(16)}function aq(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Ou(e,t,r,n)}function NQ(e){if(e instanceof Ou)return new Ou(e.h,e.s,e.l,e.opacity);if(e instanceof s2||(e=Yw(e)),!e)return new Ou;if(e instanceof Ou)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,s=Math.min(t,r,n),o=Math.max(t,r,n),i=NaN,l=o-s,c=(o+s)/2;return l?(t===o?i=(r-n)/l+(r<n)*6:r===o?i=(n-t)/l+2:i=(t-r)/l+4,l/=c<.5?o+s:2-o-s,i*=60):l=c>0&&c<1?0:i,new Ou(i,l,c,e.opacity)}function Q4e(e,t,r,n){return arguments.length===1?NQ(e):new Ou(e,t,r,n??1)}function Ou(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}PM(Ou,Q4e,jQ(s2,{brighter(e){return e=e==null?JN:Math.pow(JN,e),new Ou(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Kw:Math.pow(Kw,e),new Ou(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,s=2*r-n;return new Ac(vE(e>=240?e-240:e+120,s,n),vE(e,s,n),vE(e<120?e+240:e-120,s,n),this.opacity)},clamp(){return new Ou(sq(this.h),O_(this.s),O_(this.l),QN(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=QN(this.opacity);return`${e===1?"hsl(":"hsla("}${sq(this.h)}, ${O_(this.s)*100}%, ${O_(this.l)*100}%${e===1?")":`, ${e})`}`}}));function sq(e){return e=(e||0)%360,e<0?e+360:e}function O_(e){return Math.max(0,Math.min(1,e||0))}function vE(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const EM=e=>()=>e;function Z4e(e,t){return function(r){return e+r*t}}function eDe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function tDe(e){return(e=+e)==1?SQ:function(t,r){return r-t?eDe(t,r,e):EM(isNaN(t)?r:t)}}function SQ(e,t){var r=t-e;return r?Z4e(e,r):EM(isNaN(e)?t:e)}const oq=function e(t){var r=tDe(t);function n(s,o){var i=r((s=rT(s)).r,(o=rT(o)).r),l=r(s.g,o.g),c=r(s.b,o.b),d=SQ(s.opacity,o.opacity);return function(u){return s.r=i(u),s.g=l(u),s.b=c(u),s.opacity=d(u),s+""}}return n.gamma=e,n}(1);function rDe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),s;return function(o){for(s=0;s<r;++s)n[s]=e[s]*(1-o)+t[s]*o;return n}}function nDe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function aDe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,s=new Array(n),o=new Array(r),i;for(i=0;i<n;++i)s[i]=ly(e[i],t[i]);for(;i<r;++i)o[i]=t[i];return function(l){for(i=0;i<n;++i)o[i]=s[i](l);return o}}function sDe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function ZN(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function oDe(e,t){var r={},n={},s;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in e?r[s]=ly(e[s],t[s]):n[s]=t[s];return function(o){for(s in r)n[s]=r[s](o);return n}}var nT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,yE=new RegExp(nT.source,"g");function iDe(e){return function(){return e}}function lDe(e){return function(t){return e(t)+""}}function cDe(e,t){var r=nT.lastIndex=yE.lastIndex=0,n,s,o,i=-1,l=[],c=[];for(e=e+"",t=t+"";(n=nT.exec(e))&&(s=yE.exec(t));)(o=s.index)>r&&(o=t.slice(r,o),l[i]?l[i]+=o:l[++i]=o),(n=n[0])===(s=s[0])?l[i]?l[i]+=s:l[++i]=s:(l[++i]=null,c.push({i,x:ZN(n,s)})),r=yE.lastIndex;return r<t.length&&(o=t.slice(r),l[i]?l[i]+=o:l[++i]=o),l.length<2?c[0]?lDe(c[0].x):iDe(t):(t=c.length,function(d){for(var u=0,f;u<t;++u)l[(f=c[u]).i]=f.x(d);return l.join("")})}function ly(e,t){var r=typeof t,n;return t==null||r==="boolean"?EM(t):(r==="number"?ZN:r==="string"?(n=Yw(t))?(t=n,oq):cDe:t instanceof Yw?oq:t instanceof Date?sDe:nDe(t)?rDe:Array.isArray(t)?aDe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?oDe:ZN)(e,t)}function kM(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function dDe(e,t){t===void 0&&(t=e,e=ly);for(var r=0,n=t.length-1,s=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(s,s=t[++r]);return function(i){var l=Math.max(0,Math.min(n-1,Math.floor(i*=n)));return o[l](i-l)}}function uDe(e){return function(){return e}}function eS(e){return+e}var iq=[0,1];function ac(e){return e}function aT(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:uDe(isNaN(t)?NaN:.5)}function fDe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function mDe(e,t,r){var n=e[0],s=e[1],o=t[0],i=t[1];return s<n?(n=aT(s,n),o=r(i,o)):(n=aT(n,s),o=r(o,i)),function(l){return o(n(l))}}function hDe(e,t,r){var n=Math.min(e.length,t.length)-1,s=new Array(n),o=new Array(n),i=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<n;)s[i]=aT(e[i],e[i+1]),o[i]=r(t[i],t[i+1]);return function(l){var c=a2(e,l,1,n)-1;return o[c](s[c](l))}}function o2(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function I5(){var e=iq,t=iq,r=ly,n,s,o,i=ac,l,c,d;function u(){var h=Math.min(e.length,t.length);return i!==ac&&(i=fDe(e[0],e[h-1])),l=h>2?hDe:mDe,c=d=null,f}function f(h){return h==null||isNaN(h=+h)?o:(c||(c=l(e.map(n),t,r)))(n(i(h)))}return f.invert=function(h){return i(s((d||(d=l(t,e.map(n),ZN)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,eS),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=kM,u()},f.clamp=function(h){return arguments.length?(i=h?!0:ac,u()):i!==ac},f.interpolate=function(h){return arguments.length?(r=h,u()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,m){return n=h,s=m,u()}}function IM(){return I5()(ac,ac)}function pDe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function tS(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function f0(e){return e=tS(Math.abs(e)),e?e[1]:NaN}function gDe(e,t){return function(r,n){for(var s=r.length,o=[],i=0,l=e[0],c=0;s>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),o.push(r.substring(s-=l,s+l)),!((c+=l+1)>n));)l=e[i=(i+1)%e.length];return o.reverse().join(t)}}function xDe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var vDe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Jw(e){if(!(t=vDe.exec(e)))throw new Error("invalid format: "+e);var t;return new OM({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Jw.prototype=OM.prototype;function OM(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}OM.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function yDe(e){e:for(var t=e.length,r=1,n=-1,s;r<t;++r)switch(e[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(s+1):e}var CQ;function bDe(e,t){var r=tS(e,t);if(!r)return e+"";var n=r[0],s=r[1],o=s-(CQ=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,i=n.length;return o===i?n:o>i?n+new Array(o-i+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+tS(e,Math.max(0,t+o-1))[0]}function lq(e,t){var r=tS(e,t);if(!r)return e+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const cq={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:pDe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>lq(e*100,t),r:lq,s:bDe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function dq(e){return e}var uq=Array.prototype.map,fq=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function wDe(e){var t=e.grouping===void 0||e.thousands===void 0?dq:gDe(uq.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",s=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?dq:xDe(uq.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function d(f){f=Jw(f);var h=f.fill,m=f.align,x=f.sign,g=f.symbol,y=f.zero,v=f.width,b=f.comma,w=f.precision,_=f.trim,j=f.type;j==="n"?(b=!0,j="g"):cq[j]||(w===void 0&&(w=12),_=!0,j="g"),(y||h==="0"&&m==="=")&&(y=!0,h="0",m="=");var S=g==="$"?r:g==="#"&&/[boxX]/.test(j)?"0"+j.toLowerCase():"",C=g==="$"?n:/[%p]/.test(j)?i:"",A=cq[j],P=/[defgprs%]/.test(j);w=w===void 0?6:/[gprs]/.test(j)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function F(O){var I=S,T=C,k,B,z;if(j==="c")T=A(O)+T,O="";else{O=+O;var U=O<0||1/O<0;if(O=isNaN(O)?c:A(Math.abs(O),w),_&&(O=yDe(O)),U&&+O==0&&x!=="+"&&(U=!1),I=(U?x==="("?x:l:x==="-"||x==="("?"":x)+I,T=(j==="s"?fq[8+CQ/3]:"")+T+(U&&x==="("?")":""),P){for(k=-1,B=O.length;++k<B;)if(z=O.charCodeAt(k),48>z||z>57){T=(z===46?s+O.slice(k+1):O.slice(k))+T,O=O.slice(0,k);break}}}b&&!y&&(O=t(O,1/0));var L=I.length+O.length+T.length,W=L<v?new Array(v-L+1).join(h):"";switch(b&&y&&(O=t(W+O,W.length?v-T.length:1/0),W=""),m){case"<":O=I+O+T+W;break;case"=":O=I+W+O+T;break;case"^":O=W.slice(0,L=W.length>>1)+I+O+T+W.slice(L);break;default:O=W+I+O+T;break}return o(O)}return F.toString=function(){return f+""},F}function u(f,h){var m=d((f=Jw(f),f.type="f",f)),x=Math.max(-8,Math.min(8,Math.floor(f0(h)/3)))*3,g=Math.pow(10,-x),y=fq[8+x/3];return function(v){return m(g*v)+y}}return{format:d,formatPrefix:u}}var T_,TM,AQ;_De({thousands:",",grouping:[3],currency:["$",""]});function _De(e){return T_=wDe(e),TM=T_.format,AQ=T_.formatPrefix,T_}function jDe(e){return Math.max(0,-f0(Math.abs(e)))}function NDe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(f0(t)/3)))*3-f0(Math.abs(e)))}function SDe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,f0(t)-f0(e))+1}function PQ(e,t,r,n){var s=eT(e,t,r),o;switch(n=Jw(n??",f"),n.type){case"s":{var i=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=NDe(s,i))&&(n.precision=o),AQ(n,i)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=SDe(s,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=jDe(s))&&(n.precision=o-(n.type==="%")*2);break}}return TM(n)}function Np(e){var t=e.domain;return e.ticks=function(r){var n=t();return QO(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var s=t();return PQ(s[0],s[s.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),s=0,o=n.length-1,i=n[s],l=n[o],c,d,u=10;for(l<i&&(d=i,i=l,l=d,d=s,s=o,o=d);u-- >0;){if(d=ZO(i,l,r),d===c)return n[s]=i,n[o]=l,t(n);if(d>0)i=Math.floor(i/d)*d,l=Math.ceil(l/d)*d;else if(d<0)i=Math.ceil(i*d)/d,l=Math.floor(l*d)/d;else break;c=d}return e},e}function rS(){var e=IM();return e.copy=function(){return o2(e,rS())},uu.apply(e,arguments),Np(e)}function EQ(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,eS),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return EQ(e).unknown(t)},e=arguments.length?Array.from(e,eS):[0,1],Np(r)}function kQ(e,t){e=e.slice();var r=0,n=e.length-1,s=e[r],o=e[n],i;return o<s&&(i=r,r=n,n=i,i=s,s=o,o=i),e[r]=t.floor(s),e[n]=t.ceil(o),e}function mq(e){return Math.log(e)}function hq(e){return Math.exp(e)}function CDe(e){return-Math.log(-e)}function ADe(e){return-Math.exp(-e)}function PDe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function EDe(e){return e===10?PDe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function kDe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function pq(e){return(t,r)=>-e(-t,r)}function DM(e){const t=e(mq,hq),r=t.domain;let n=10,s,o;function i(){return s=kDe(n),o=EDe(n),r()[0]<0?(s=pq(s),o=pq(o),e(CDe,ADe)):e(mq,hq),t}return t.base=function(l){return arguments.length?(n=+l,i()):n},t.domain=function(l){return arguments.length?(r(l),i()):r()},t.ticks=l=>{const c=r();let d=c[0],u=c[c.length-1];const f=u<d;f&&([d,u]=[u,d]);let h=s(d),m=s(u),x,g;const y=l==null?10:+l;let v=[];if(!(n%1)&&m-h<y){if(h=Math.floor(h),m=Math.ceil(m),d>0){for(;h<=m;++h)for(x=1;x<n;++x)if(g=h<0?x/o(-h):x*o(h),!(g<d)){if(g>u)break;v.push(g)}}else for(;h<=m;++h)for(x=n-1;x>=1;--x)if(g=h>0?x/o(-h):x*o(h),!(g<d)){if(g>u)break;v.push(g)}v.length*2<y&&(v=QO(d,u,y))}else v=QO(h,m,Math.min(m-h,y)).map(o);return f?v.reverse():v},t.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=n===10?"s":","),typeof c!="function"&&(!(n%1)&&(c=Jw(c)).precision==null&&(c.trim=!0),c=TM(c)),l===1/0)return c;const d=Math.max(1,n*l/t.ticks().length);return u=>{let f=u/o(Math.round(s(u)));return f*n<n-.5&&(f*=n),f<=d?c(u):""}},t.nice=()=>r(kQ(r(),{floor:l=>o(Math.floor(s(l))),ceil:l=>o(Math.ceil(s(l)))})),t}function IQ(){const e=DM(I5()).domain([1,10]);return e.copy=()=>o2(e,IQ()).base(e.base()),uu.apply(e,arguments),e}function gq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function xq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function MM(e){var t=1,r=e(gq(t),xq(t));return r.constant=function(n){return arguments.length?e(gq(t=+n),xq(t)):t},Np(r)}function OQ(){var e=MM(I5());return e.copy=function(){return o2(e,OQ()).constant(e.constant())},uu.apply(e,arguments)}function vq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function IDe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ODe(e){return e<0?-e*e:e*e}function RM(e){var t=e(ac,ac),r=1;function n(){return r===1?e(ac,ac):r===.5?e(IDe,ODe):e(vq(r),vq(1/r))}return t.exponent=function(s){return arguments.length?(r=+s,n()):r},Np(t)}function FM(){var e=RM(I5());return e.copy=function(){return o2(e,FM()).exponent(e.exponent())},uu.apply(e,arguments),e}function TDe(){return FM.apply(null,arguments).exponent(.5)}function yq(e){return Math.sign(e)*e*e}function DDe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function TQ(){var e=IM(),t=[0,1],r=!1,n;function s(o){var i=DDe(e(o));return isNaN(i)?n:r?Math.round(i):i}return s.invert=function(o){return e.invert(yq(o))},s.domain=function(o){return arguments.length?(e.domain(o),s):e.domain()},s.range=function(o){return arguments.length?(e.range((t=Array.from(o,eS)).map(yq)),s):t.slice()},s.rangeRound=function(o){return s.range(o).round(!0)},s.round=function(o){return arguments.length?(r=!!o,s):r},s.clamp=function(o){return arguments.length?(e.clamp(o),s):e.clamp()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return TQ(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},uu.apply(s,arguments),Np(s)}function DQ(){var e=[],t=[],r=[],n;function s(){var i=0,l=Math.max(1,t.length);for(r=new Array(l-1);++i<l;)r[i-1]=$4e(e,i/l);return o}function o(i){return i==null||isNaN(i=+i)?n:t[a2(r,i)]}return o.invertExtent=function(i){var l=t.indexOf(i);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(i){if(!arguments.length)return e.slice();e=[];for(let l of i)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(Wh),s()},o.range=function(i){return arguments.length?(t=Array.from(i),s()):t.slice()},o.unknown=function(i){return arguments.length?(n=i,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return DQ().domain(e).range(t).unknown(n)},uu.apply(o,arguments)}function MQ(){var e=0,t=1,r=1,n=[.5],s=[0,1],o;function i(c){return c!=null&&c<=c?s[a2(n,c,0,r)]:o}function l(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return i}return i.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,l()):[e,t]},i.range=function(c){return arguments.length?(r=(s=Array.from(c)).length-1,l()):s.slice()},i.invertExtent=function(c){var d=s.indexOf(c);return d<0?[NaN,NaN]:d<1?[e,n[0]]:d>=r?[n[r-1],t]:[n[d-1],n[d]]},i.unknown=function(c){return arguments.length&&(o=c),i},i.thresholds=function(){return n.slice()},i.copy=function(){return MQ().domain([e,t]).range(s).unknown(o)},uu.apply(Np(i),arguments)}function RQ(){var e=[.5],t=[0,1],r,n=1;function s(o){return o!=null&&o<=o?t[a2(e,o,0,n)]:r}return s.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),s):e.slice()},s.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),s):t.slice()},s.invertExtent=function(o){var i=t.indexOf(o);return[e[i-1],e[i]]},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return RQ().domain(e).range(t).unknown(r)},uu.apply(s,arguments)}const bE=new Date,wE=new Date;function Ri(e,t,r,n){function s(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return s.floor=o=>(e(o=new Date(+o)),o),s.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),s.round=o=>{const i=s(o),l=s.ceil(o);return o-i<l-o?i:l},s.offset=(o,i)=>(t(o=new Date(+o),i==null?1:Math.floor(i)),o),s.range=(o,i,l)=>{const c=[];if(o=s.ceil(o),l=l==null?1:Math.floor(l),!(o<i)||!(l>0))return c;let d;do c.push(d=new Date(+o)),t(o,l),e(o);while(d<o&&o<i);return c},s.filter=o=>Ri(i=>{if(i>=i)for(;e(i),!o(i);)i.setTime(i-1)},(i,l)=>{if(i>=i)if(l<0)for(;++l<=0;)for(;t(i,-1),!o(i););else for(;--l>=0;)for(;t(i,1),!o(i););}),r&&(s.count=(o,i)=>(bE.setTime(+o),wE.setTime(+i),e(bE),e(wE),Math.floor(r(bE,wE))),s.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?s.filter(n?i=>n(i)%o===0:i=>s.count(0,i)%o===0):s)),s}const nS=Ri(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);nS.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ri(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):nS);nS.range;const um=1e3,Yd=um*60,fm=Yd*60,Im=fm*24,LM=Im*7,bq=Im*30,_E=Im*365,mg=Ri(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*um)},(e,t)=>(t-e)/um,e=>e.getUTCSeconds());mg.range;const $M=Ri(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*um)},(e,t)=>{e.setTime(+e+t*Yd)},(e,t)=>(t-e)/Yd,e=>e.getMinutes());$M.range;const BM=Ri(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Yd)},(e,t)=>(t-e)/Yd,e=>e.getUTCMinutes());BM.range;const qM=Ri(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*um-e.getMinutes()*Yd)},(e,t)=>{e.setTime(+e+t*fm)},(e,t)=>(t-e)/fm,e=>e.getHours());qM.range;const zM=Ri(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*fm)},(e,t)=>(t-e)/fm,e=>e.getUTCHours());zM.range;const i2=Ri(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Yd)/Im,e=>e.getDate()-1);i2.range;const O5=Ri(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Im,e=>e.getUTCDate()-1);O5.range;const FQ=Ri(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Im,e=>Math.floor(e/Im));FQ.range;function mx(e){return Ri(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Yd)/LM)}const T5=mx(0),aS=mx(1),MDe=mx(2),RDe=mx(3),m0=mx(4),FDe=mx(5),LDe=mx(6);T5.range;aS.range;MDe.range;RDe.range;m0.range;FDe.range;LDe.range;function hx(e){return Ri(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/LM)}const D5=hx(0),sS=hx(1),$De=hx(2),BDe=hx(3),h0=hx(4),qDe=hx(5),zDe=hx(6);D5.range;sS.range;$De.range;BDe.range;h0.range;qDe.range;zDe.range;const UM=Ri(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());UM.range;const VM=Ri(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());VM.range;const Om=Ri(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Om.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ri(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Om.range;const Tm=Ri(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Tm.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ri(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Tm.range;function LQ(e,t,r,n,s,o){const i=[[mg,1,um],[mg,5,5*um],[mg,15,15*um],[mg,30,30*um],[o,1,Yd],[o,5,5*Yd],[o,15,15*Yd],[o,30,30*Yd],[s,1,fm],[s,3,3*fm],[s,6,6*fm],[s,12,12*fm],[n,1,Im],[n,2,2*Im],[r,1,LM],[t,1,bq],[t,3,3*bq],[e,1,_E]];function l(d,u,f){const h=u<d;h&&([d,u]=[u,d]);const m=f&&typeof f.range=="function"?f:c(d,u,f),x=m?m.range(d,+u+1):[];return h?x.reverse():x}function c(d,u,f){const h=Math.abs(u-d)/f,m=CM(([,,y])=>y).right(i,h);if(m===i.length)return e.every(eT(d/_E,u/_E,f));if(m===0)return nS.every(Math.max(eT(d,u,f),1));const[x,g]=i[h/i[m-1][2]<i[m][2]/h?m-1:m];return x.every(g)}return[l,c]}const[UDe,VDe]=LQ(Tm,VM,D5,FQ,zM,BM),[WDe,HDe]=LQ(Om,UM,T5,i2,qM,$M);function jE(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function NE(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Wy(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function GDe(e){var t=e.dateTime,r=e.date,n=e.time,s=e.periods,o=e.days,i=e.shortDays,l=e.months,c=e.shortMonths,d=Hy(s),u=Gy(s),f=Hy(o),h=Gy(o),m=Hy(i),x=Gy(i),g=Hy(l),y=Gy(l),v=Hy(c),b=Gy(c),w={a:U,A:L,b:W,B:ge,c:null,d:Cq,e:Cq,f:gMe,g:CMe,G:PMe,H:mMe,I:hMe,j:pMe,L:$Q,m:xMe,M:vMe,p:Ae,q:V,Q:Eq,s:kq,S:yMe,u:bMe,U:wMe,V:_Me,w:jMe,W:NMe,x:null,X:null,y:SMe,Y:AMe,Z:EMe,"%":Pq},_={a:$,A:Y,b:he,B:J,c:null,d:Aq,e:Aq,f:TMe,g:UMe,G:WMe,H:kMe,I:IMe,j:OMe,L:qQ,m:DMe,M:MMe,p:G,q:ue,Q:Eq,s:kq,S:RMe,u:FMe,U:LMe,V:$Me,w:BMe,W:qMe,x:null,X:null,y:zMe,Y:VMe,Z:HMe,"%":Pq},j={a:F,A:O,b:I,B:T,c:k,d:Nq,e:Nq,f:cMe,g:jq,G:_q,H:Sq,I:Sq,j:sMe,L:lMe,m:aMe,M:oMe,p:P,q:nMe,Q:uMe,s:fMe,S:iMe,u:QDe,U:ZDe,V:eMe,w:JDe,W:tMe,x:B,X:z,y:jq,Y:_q,Z:rMe,"%":dMe};w.x=S(r,w),w.X=S(n,w),w.c=S(t,w),_.x=S(r,_),_.X=S(n,_),_.c=S(t,_);function S(ve,ae){return function(oe){var me=[],De=-1,ne=0,ie=ve.length,ht,pt,Ze;for(oe instanceof Date||(oe=new Date(+oe));++De<ie;)ve.charCodeAt(De)===37&&(me.push(ve.slice(ne,De)),(pt=wq[ht=ve.charAt(++De)])!=null?ht=ve.charAt(++De):pt=ht==="e"?" ":"0",(Ze=ae[ht])&&(ht=Ze(oe,pt)),me.push(ht),ne=De+1);return me.push(ve.slice(ne,De)),me.join("")}}function C(ve,ae){return function(oe){var me=Wy(1900,void 0,1),De=A(me,ve,oe+="",0),ne,ie;if(De!=oe.length)return null;if("Q"in me)return new Date(me.Q);if("s"in me)return new Date(me.s*1e3+("L"in me?me.L:0));if(ae&&!("Z"in me)&&(me.Z=0),"p"in me&&(me.H=me.H%12+me.p*12),me.m===void 0&&(me.m="q"in me?me.q:0),"V"in me){if(me.V<1||me.V>53)return null;"w"in me||(me.w=1),"Z"in me?(ne=NE(Wy(me.y,0,1)),ie=ne.getUTCDay(),ne=ie>4||ie===0?sS.ceil(ne):sS(ne),ne=O5.offset(ne,(me.V-1)*7),me.y=ne.getUTCFullYear(),me.m=ne.getUTCMonth(),me.d=ne.getUTCDate()+(me.w+6)%7):(ne=jE(Wy(me.y,0,1)),ie=ne.getDay(),ne=ie>4||ie===0?aS.ceil(ne):aS(ne),ne=i2.offset(ne,(me.V-1)*7),me.y=ne.getFullYear(),me.m=ne.getMonth(),me.d=ne.getDate()+(me.w+6)%7)}else("W"in me||"U"in me)&&("w"in me||(me.w="u"in me?me.u%7:"W"in me?1:0),ie="Z"in me?NE(Wy(me.y,0,1)).getUTCDay():jE(Wy(me.y,0,1)).getDay(),me.m=0,me.d="W"in me?(me.w+6)%7+me.W*7-(ie+5)%7:me.w+me.U*7-(ie+6)%7);return"Z"in me?(me.H+=me.Z/100|0,me.M+=me.Z%100,NE(me)):jE(me)}}function A(ve,ae,oe,me){for(var De=0,ne=ae.length,ie=oe.length,ht,pt;De<ne;){if(me>=ie)return-1;if(ht=ae.charCodeAt(De++),ht===37){if(ht=ae.charAt(De++),pt=j[ht in wq?ae.charAt(De++):ht],!pt||(me=pt(ve,oe,me))<0)return-1}else if(ht!=oe.charCodeAt(me++))return-1}return me}function P(ve,ae,oe){var me=d.exec(ae.slice(oe));return me?(ve.p=u.get(me[0].toLowerCase()),oe+me[0].length):-1}function F(ve,ae,oe){var me=m.exec(ae.slice(oe));return me?(ve.w=x.get(me[0].toLowerCase()),oe+me[0].length):-1}function O(ve,ae,oe){var me=f.exec(ae.slice(oe));return me?(ve.w=h.get(me[0].toLowerCase()),oe+me[0].length):-1}function I(ve,ae,oe){var me=v.exec(ae.slice(oe));return me?(ve.m=b.get(me[0].toLowerCase()),oe+me[0].length):-1}function T(ve,ae,oe){var me=g.exec(ae.slice(oe));return me?(ve.m=y.get(me[0].toLowerCase()),oe+me[0].length):-1}function k(ve,ae,oe){return A(ve,t,ae,oe)}function B(ve,ae,oe){return A(ve,r,ae,oe)}function z(ve,ae,oe){return A(ve,n,ae,oe)}function U(ve){return i[ve.getDay()]}function L(ve){return o[ve.getDay()]}function W(ve){return c[ve.getMonth()]}function ge(ve){return l[ve.getMonth()]}function Ae(ve){return s[+(ve.getHours()>=12)]}function V(ve){return 1+~~(ve.getMonth()/3)}function $(ve){return i[ve.getUTCDay()]}function Y(ve){return o[ve.getUTCDay()]}function he(ve){return c[ve.getUTCMonth()]}function J(ve){return l[ve.getUTCMonth()]}function G(ve){return s[+(ve.getUTCHours()>=12)]}function ue(ve){return 1+~~(ve.getUTCMonth()/3)}return{format:function(ve){var ae=S(ve+="",w);return ae.toString=function(){return ve},ae},parse:function(ve){var ae=C(ve+="",!1);return ae.toString=function(){return ve},ae},utcFormat:function(ve){var ae=S(ve+="",_);return ae.toString=function(){return ve},ae},utcParse:function(ve){var ae=C(ve+="",!0);return ae.toString=function(){return ve},ae}}}var wq={"-":"",_:" ",0:"0"},Yi=/^\s*\d+/,KDe=/^%/,XDe=/[\\^$*+?|[\]().{}]/g;function Cs(e,t,r){var n=e<0?"-":"",s=(n?-e:e)+"",o=s.length;return n+(o<r?new Array(r-o+1).join(t)+s:s)}function YDe(e){return e.replace(XDe,"\\$&")}function Hy(e){return new RegExp("^(?:"+e.map(YDe).join("|")+")","i")}function Gy(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function JDe(e,t,r){var n=Yi.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function QDe(e,t,r){var n=Yi.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function ZDe(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function eMe(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function tMe(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function _q(e,t,r){var n=Yi.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function jq(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function rMe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function nMe(e,t,r){var n=Yi.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function aMe(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function Nq(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function sMe(e,t,r){var n=Yi.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Sq(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function oMe(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function iMe(e,t,r){var n=Yi.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function lMe(e,t,r){var n=Yi.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function cMe(e,t,r){var n=Yi.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function dMe(e,t,r){var n=KDe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function uMe(e,t,r){var n=Yi.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function fMe(e,t,r){var n=Yi.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Cq(e,t){return Cs(e.getDate(),t,2)}function mMe(e,t){return Cs(e.getHours(),t,2)}function hMe(e,t){return Cs(e.getHours()%12||12,t,2)}function pMe(e,t){return Cs(1+i2.count(Om(e),e),t,3)}function $Q(e,t){return Cs(e.getMilliseconds(),t,3)}function gMe(e,t){return $Q(e,t)+"000"}function xMe(e,t){return Cs(e.getMonth()+1,t,2)}function vMe(e,t){return Cs(e.getMinutes(),t,2)}function yMe(e,t){return Cs(e.getSeconds(),t,2)}function bMe(e){var t=e.getDay();return t===0?7:t}function wMe(e,t){return Cs(T5.count(Om(e)-1,e),t,2)}function BQ(e){var t=e.getDay();return t>=4||t===0?m0(e):m0.ceil(e)}function _Me(e,t){return e=BQ(e),Cs(m0.count(Om(e),e)+(Om(e).getDay()===4),t,2)}function jMe(e){return e.getDay()}function NMe(e,t){return Cs(aS.count(Om(e)-1,e),t,2)}function SMe(e,t){return Cs(e.getFullYear()%100,t,2)}function CMe(e,t){return e=BQ(e),Cs(e.getFullYear()%100,t,2)}function AMe(e,t){return Cs(e.getFullYear()%1e4,t,4)}function PMe(e,t){var r=e.getDay();return e=r>=4||r===0?m0(e):m0.ceil(e),Cs(e.getFullYear()%1e4,t,4)}function EMe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Cs(t/60|0,"0",2)+Cs(t%60,"0",2)}function Aq(e,t){return Cs(e.getUTCDate(),t,2)}function kMe(e,t){return Cs(e.getUTCHours(),t,2)}function IMe(e,t){return Cs(e.getUTCHours()%12||12,t,2)}function OMe(e,t){return Cs(1+O5.count(Tm(e),e),t,3)}function qQ(e,t){return Cs(e.getUTCMilliseconds(),t,3)}function TMe(e,t){return qQ(e,t)+"000"}function DMe(e,t){return Cs(e.getUTCMonth()+1,t,2)}function MMe(e,t){return Cs(e.getUTCMinutes(),t,2)}function RMe(e,t){return Cs(e.getUTCSeconds(),t,2)}function FMe(e){var t=e.getUTCDay();return t===0?7:t}function LMe(e,t){return Cs(D5.count(Tm(e)-1,e),t,2)}function zQ(e){var t=e.getUTCDay();return t>=4||t===0?h0(e):h0.ceil(e)}function $Me(e,t){return e=zQ(e),Cs(h0.count(Tm(e),e)+(Tm(e).getUTCDay()===4),t,2)}function BMe(e){return e.getUTCDay()}function qMe(e,t){return Cs(sS.count(Tm(e)-1,e),t,2)}function zMe(e,t){return Cs(e.getUTCFullYear()%100,t,2)}function UMe(e,t){return e=zQ(e),Cs(e.getUTCFullYear()%100,t,2)}function VMe(e,t){return Cs(e.getUTCFullYear()%1e4,t,4)}function WMe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?h0(e):h0.ceil(e),Cs(e.getUTCFullYear()%1e4,t,4)}function HMe(){return"+0000"}function Pq(){return"%"}function Eq(e){return+e}function kq(e){return Math.floor(+e/1e3)}var Fx,UQ,VQ;GMe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function GMe(e){return Fx=GDe(e),UQ=Fx.format,Fx.parse,VQ=Fx.utcFormat,Fx.utcParse,Fx}function KMe(e){return new Date(e)}function XMe(e){return e instanceof Date?+e:+new Date(+e)}function WM(e,t,r,n,s,o,i,l,c,d){var u=IM(),f=u.invert,h=u.domain,m=d(".%L"),x=d(":%S"),g=d("%I:%M"),y=d("%I %p"),v=d("%a %d"),b=d("%b %d"),w=d("%B"),_=d("%Y");function j(S){return(c(S)<S?m:l(S)<S?x:i(S)<S?g:o(S)<S?y:n(S)<S?s(S)<S?v:b:r(S)<S?w:_)(S)}return u.invert=function(S){return new Date(f(S))},u.domain=function(S){return arguments.length?h(Array.from(S,XMe)):h().map(KMe)},u.ticks=function(S){var C=h();return e(C[0],C[C.length-1],S??10)},u.tickFormat=function(S,C){return C==null?j:d(C)},u.nice=function(S){var C=h();return(!S||typeof S.range!="function")&&(S=t(C[0],C[C.length-1],S??10)),S?h(kQ(C,S)):u},u.copy=function(){return o2(u,WM(e,t,r,n,s,o,i,l,c,d))},u}function YMe(){return uu.apply(WM(WDe,HDe,Om,UM,T5,i2,qM,$M,mg,UQ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function JMe(){return uu.apply(WM(UDe,VDe,Tm,VM,D5,O5,zM,BM,mg,VQ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function M5(){var e=0,t=1,r,n,s,o,i=ac,l=!1,c;function d(f){return f==null||isNaN(f=+f)?c:i(s===0?.5:(f=(o(f)-r)*s,l?Math.max(0,Math.min(1,f)):f))}d.domain=function(f){return arguments.length?([e,t]=f,r=o(e=+e),n=o(t=+t),s=r===n?0:1/(n-r),d):[e,t]},d.clamp=function(f){return arguments.length?(l=!!f,d):l},d.interpolator=function(f){return arguments.length?(i=f,d):i};function u(f){return function(h){var m,x;return arguments.length?([m,x]=h,i=f(m,x),d):[i(0),i(1)]}}return d.range=u(ly),d.rangeRound=u(kM),d.unknown=function(f){return arguments.length?(c=f,d):c},function(f){return o=f,r=f(e),n=f(t),s=r===n?0:1/(n-r),d}}function Sp(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function WQ(){var e=Np(M5()(ac));return e.copy=function(){return Sp(e,WQ())},qm.apply(e,arguments)}function HQ(){var e=DM(M5()).domain([1,10]);return e.copy=function(){return Sp(e,HQ()).base(e.base())},qm.apply(e,arguments)}function GQ(){var e=MM(M5());return e.copy=function(){return Sp(e,GQ()).constant(e.constant())},qm.apply(e,arguments)}function HM(){var e=RM(M5());return e.copy=function(){return Sp(e,HM()).exponent(e.exponent())},qm.apply(e,arguments)}function QMe(){return HM.apply(null,arguments).exponent(.5)}function KQ(){var e=[],t=ac;function r(n){if(n!=null&&!isNaN(n=+n))return t((a2(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let s of n)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Wh),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,s)=>t(s/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(s,o)=>L4e(e,o/n))},r.copy=function(){return KQ(t).domain(e)},qm.apply(r,arguments)}function R5(){var e=0,t=.5,r=1,n=1,s,o,i,l,c,d=ac,u,f=!1,h;function m(g){return isNaN(g=+g)?h:(g=.5+((g=+u(g))-o)*(n*g<n*o?l:c),d(f?Math.max(0,Math.min(1,g)):g))}m.domain=function(g){return arguments.length?([e,t,r]=g,s=u(e=+e),o=u(t=+t),i=u(r=+r),l=s===o?0:.5/(o-s),c=o===i?0:.5/(i-o),n=o<s?-1:1,m):[e,t,r]},m.clamp=function(g){return arguments.length?(f=!!g,m):f},m.interpolator=function(g){return arguments.length?(d=g,m):d};function x(g){return function(y){var v,b,w;return arguments.length?([v,b,w]=y,d=dDe(g,[v,b,w]),m):[d(0),d(.5),d(1)]}}return m.range=x(ly),m.rangeRound=x(kM),m.unknown=function(g){return arguments.length?(h=g,m):h},function(g){return u=g,s=g(e),o=g(t),i=g(r),l=s===o?0:.5/(o-s),c=o===i?0:.5/(i-o),n=o<s?-1:1,m}}function XQ(){var e=Np(R5()(ac));return e.copy=function(){return Sp(e,XQ())},qm.apply(e,arguments)}function YQ(){var e=DM(R5()).domain([.1,1,10]);return e.copy=function(){return Sp(e,YQ()).base(e.base())},qm.apply(e,arguments)}function JQ(){var e=MM(R5());return e.copy=function(){return Sp(e,JQ()).constant(e.constant())},qm.apply(e,arguments)}function GM(){var e=RM(R5());return e.copy=function(){return Sp(e,GM()).exponent(e.exponent())},qm.apply(e,arguments)}function ZMe(){return GM.apply(null,arguments).exponent(.5)}const Iq=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Gw,scaleDiverging:XQ,scaleDivergingLog:YQ,scaleDivergingPow:GM,scaleDivergingSqrt:ZMe,scaleDivergingSymlog:JQ,scaleIdentity:EQ,scaleImplicit:tT,scaleLinear:rS,scaleLog:IQ,scaleOrdinal:AM,scalePoint:Vb,scalePow:FM,scaleQuantile:DQ,scaleQuantize:MQ,scaleRadial:TQ,scaleSequential:WQ,scaleSequentialLog:HQ,scaleSequentialPow:HM,scaleSequentialQuantile:KQ,scaleSequentialSqrt:QMe,scaleSequentialSymlog:GQ,scaleSqrt:TDe,scaleSymlog:OQ,scaleThreshold:RQ,scaleTime:YMe,scaleUtc:JMe,tickFormat:PQ},Symbol.toStringTag,{value:"Module"}));var eRe=Z0;function tRe(e,t,r){for(var n=-1,s=e.length;++n<s;){var o=e[n],i=t(o);if(i!=null&&(l===void 0?i===i&&!eRe(i):r(i,l)))var l=i,c=o}return c}var F5=tRe;function rRe(e,t){return e>t}var QQ=rRe,nRe=F5,aRe=QQ,sRe=iy;function oRe(e){return e&&e.length?nRe(e,sRe,aRe):void 0}var iRe=oRe;const Sh=xs(iRe);function lRe(e,t){return e<t}var ZQ=lRe,cRe=F5,dRe=ZQ,uRe=iy;function fRe(e){return e&&e.length?cRe(e,uRe,dRe):void 0}var mRe=fRe;const L5=xs(mRe);var hRe=iM,pRe=Bf,gRe=iQ,xRe=Mc;function vRe(e,t){var r=xRe(e)?hRe:gRe;return r(e,pRe(t))}var yRe=vRe,bRe=sQ,wRe=yRe;function _Re(e,t){return bRe(wRe(e,t),1)}var jRe=_Re;const NRe=xs(jRe);var SRe=_M;function CRe(e,t){return SRe(e,t)}var ARe=CRe;const Xg=xs(ARe);var cy=1e9,PRe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},XM,ko=!0,iu="[DecimalError] ",Pg=iu+"Invalid argument: ",KM=iu+"Exponent out of range: ",dy=Math.floor,Zp=Math.pow,ERe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,nd,zi=1e7,yo=7,eZ=9007199254740991,oS=dy(eZ/yo),ta={};ta.absoluteValue=ta.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};ta.comparedTo=ta.cmp=function(e){var t,r,n,s,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,s=e.d.length,t=0,r=n<s?n:s;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===s?0:n>s^o.s<0?1:-1};ta.decimalPlaces=ta.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*yo;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};ta.dividedBy=ta.div=function(e){return ym(this,new this.constructor(e))};ta.dividedToIntegerBy=ta.idiv=function(e){var t=this,r=t.constructor;return Zs(ym(t,new r(e),0,1),r.precision)};ta.equals=ta.eq=function(e){return!this.cmp(e)};ta.exponent=function(){return yi(this)};ta.greaterThan=ta.gt=function(e){return this.cmp(e)>0};ta.greaterThanOrEqualTo=ta.gte=function(e){return this.cmp(e)>=0};ta.isInteger=ta.isint=function(){return this.e>this.d.length-2};ta.isNegative=ta.isneg=function(){return this.s<0};ta.isPositive=ta.ispos=function(){return this.s>0};ta.isZero=function(){return this.s===0};ta.lessThan=ta.lt=function(e){return this.cmp(e)<0};ta.lessThanOrEqualTo=ta.lte=function(e){return this.cmp(e)<1};ta.logarithm=ta.log=function(e){var t,r=this,n=r.constructor,s=n.precision,o=s+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(nd))throw Error(iu+"NaN");if(r.s<1)throw Error(iu+(r.s?"NaN":"-Infinity"));return r.eq(nd)?new n(0):(ko=!1,t=ym(Qw(r,o),Qw(e,o),o),ko=!0,Zs(t,s))};ta.minus=ta.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?nZ(t,e):tZ(t,(e.s=-e.s,e))};ta.modulo=ta.mod=function(e){var t,r=this,n=r.constructor,s=n.precision;if(e=new n(e),!e.s)throw Error(iu+"NaN");return r.s?(ko=!1,t=ym(r,e,0,1).times(e),ko=!0,r.minus(t)):Zs(new n(r),s)};ta.naturalExponential=ta.exp=function(){return rZ(this)};ta.naturalLogarithm=ta.ln=function(){return Qw(this)};ta.negated=ta.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};ta.plus=ta.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?tZ(t,e):nZ(t,(e.s=-e.s,e))};ta.precision=ta.sd=function(e){var t,r,n,s=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Pg+e);if(t=yi(s)+1,n=s.d.length-1,r=n*yo+1,n=s.d[n],n){for(;n%10==0;n/=10)r--;for(n=s.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};ta.squareRoot=ta.sqrt=function(){var e,t,r,n,s,o,i,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(iu+"NaN")}for(e=yi(l),ko=!1,s=Math.sqrt(+l),s==0||s==1/0?(t=bf(l.d),(t.length+e)%2==0&&(t+="0"),s=Math.sqrt(t),e=dy((e+1)/2)-(e<0||e%2),s==1/0?t="5e"+e:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new c(t)):n=new c(s.toString()),r=c.precision,s=i=r+3;;)if(o=n,n=o.plus(ym(l,o,i+2)).times(.5),bf(o.d).slice(0,i)===(t=bf(n.d)).slice(0,i)){if(t=t.slice(i-3,i+1),s==i&&t=="4999"){if(Zs(o,r+1,0),o.times(o).eq(l)){n=o;break}}else if(t!="9999")break;i+=4}return ko=!0,Zs(n,r)};ta.times=ta.mul=function(e){var t,r,n,s,o,i,l,c,d,u=this,f=u.constructor,h=u.d,m=(e=new f(e)).d;if(!u.s||!e.s)return new f(0);for(e.s*=u.s,r=u.e+e.e,c=h.length,d=m.length,c<d&&(o=h,h=m,m=o,i=c,c=d,d=i),o=[],i=c+d,n=i;n--;)o.push(0);for(n=d;--n>=0;){for(t=0,s=c+n;s>n;)l=o[s]+m[n]*h[s-n-1]+t,o[s--]=l%zi|0,t=l/zi|0;o[s]=(o[s]+t)%zi|0}for(;!o[--i];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,ko?Zs(e,f.precision):e};ta.toDecimalPlaces=ta.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Rf(e,0,cy),t===void 0?t=n.rounding:Rf(t,0,8),Zs(r,e+yi(r)+1,t))};ta.toExponential=function(e,t){var r,n=this,s=n.constructor;return e===void 0?r=Yg(n,!0):(Rf(e,0,cy),t===void 0?t=s.rounding:Rf(t,0,8),n=Zs(new s(n),e+1,t),r=Yg(n,!0,e+1)),r};ta.toFixed=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?Yg(s):(Rf(e,0,cy),t===void 0?t=o.rounding:Rf(t,0,8),n=Zs(new o(s),e+yi(s)+1,t),r=Yg(n.abs(),!1,e+yi(n)+1),s.isneg()&&!s.isZero()?"-"+r:r)};ta.toInteger=ta.toint=function(){var e=this,t=e.constructor;return Zs(new t(e),yi(e)+1,t.rounding)};ta.toNumber=function(){return+this};ta.toPower=ta.pow=function(e){var t,r,n,s,o,i,l=this,c=l.constructor,d=12,u=+(e=new c(e));if(!e.s)return new c(nd);if(l=new c(l),!l.s){if(e.s<1)throw Error(iu+"Infinity");return l}if(l.eq(nd))return l;if(n=c.precision,e.eq(nd))return Zs(l,n);if(t=e.e,r=e.d.length-1,i=t>=r,o=l.s,i){if((r=u<0?-u:u)<=eZ){for(s=new c(nd),t=Math.ceil(n/yo+4),ko=!1;r%2&&(s=s.times(l),Tq(s.d,t)),r=dy(r/2),r!==0;)l=l.times(l),Tq(l.d,t);return ko=!0,e.s<0?new c(nd).div(s):Zs(s,n)}}else if(o<0)throw Error(iu+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,l.s=1,ko=!1,s=e.times(Qw(l,n+d)),ko=!0,s=rZ(s),s.s=o,s};ta.toPrecision=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?(r=yi(s),n=Yg(s,r<=o.toExpNeg||r>=o.toExpPos)):(Rf(e,1,cy),t===void 0?t=o.rounding:Rf(t,0,8),s=Zs(new o(s),e,t),r=yi(s),n=Yg(s,e<=r||r<=o.toExpNeg,e)),n};ta.toSignificantDigits=ta.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Rf(e,1,cy),t===void 0?t=n.rounding:Rf(t,0,8)),Zs(new n(r),e,t)};ta.toString=ta.valueOf=ta.val=ta.toJSON=ta[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=yi(e),r=e.constructor;return Yg(e,t<=r.toExpNeg||t>=r.toExpPos)};function tZ(e,t){var r,n,s,o,i,l,c,d,u=e.constructor,f=u.precision;if(!e.s||!t.s)return t.s||(t=new u(e)),ko?Zs(t,f):t;if(c=e.d,d=t.d,i=e.e,s=t.e,c=c.slice(),o=i-s,o){for(o<0?(n=c,o=-o,l=d.length):(n=d,s=i,l=c.length),i=Math.ceil(f/yo),l=i>l?i+1:l+1,o>l&&(o=l,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(l=c.length,o=d.length,l-o<0&&(o=l,n=d,d=c,c=n),r=0;o;)r=(c[--o]=c[o]+d[o]+r)/zi|0,c[o]%=zi;for(r&&(c.unshift(r),++s),l=c.length;c[--l]==0;)c.pop();return t.d=c,t.e=s,ko?Zs(t,f):t}function Rf(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Pg+e)}function bf(e){var t,r,n,s=e.length-1,o="",i=e[0];if(s>0){for(o+=i,t=1;t<s;t++)n=e[t]+"",r=yo-n.length,r&&(o+=mh(r)),o+=n;i=e[t],n=i+"",r=yo-n.length,r&&(o+=mh(r))}else if(i===0)return"0";for(;i%10===0;)i/=10;return o+i}var ym=function(){function e(n,s){var o,i=0,l=n.length;for(n=n.slice();l--;)o=n[l]*s+i,n[l]=o%zi|0,i=o/zi|0;return i&&n.unshift(i),n}function t(n,s,o,i){var l,c;if(o!=i)c=o>i?1:-1;else for(l=c=0;l<o;l++)if(n[l]!=s[l]){c=n[l]>s[l]?1:-1;break}return c}function r(n,s,o){for(var i=0;o--;)n[o]-=i,i=n[o]<s[o]?1:0,n[o]=i*zi+n[o]-s[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,s,o,i){var l,c,d,u,f,h,m,x,g,y,v,b,w,_,j,S,C,A,P=n.constructor,F=n.s==s.s?1:-1,O=n.d,I=s.d;if(!n.s)return new P(n);if(!s.s)throw Error(iu+"Division by zero");for(c=n.e-s.e,C=I.length,j=O.length,m=new P(F),x=m.d=[],d=0;I[d]==(O[d]||0);)++d;if(I[d]>(O[d]||0)&&--c,o==null?b=o=P.precision:i?b=o+(yi(n)-yi(s))+1:b=o,b<0)return new P(0);if(b=b/yo+2|0,d=0,C==1)for(u=0,I=I[0],b++;(d<j||u)&&b--;d++)w=u*zi+(O[d]||0),x[d]=w/I|0,u=w%I|0;else{for(u=zi/(I[0]+1)|0,u>1&&(I=e(I,u),O=e(O,u),C=I.length,j=O.length),_=C,g=O.slice(0,C),y=g.length;y<C;)g[y++]=0;A=I.slice(),A.unshift(0),S=I[0],I[1]>=zi/2&&++S;do u=0,l=t(I,g,C,y),l<0?(v=g[0],C!=y&&(v=v*zi+(g[1]||0)),u=v/S|0,u>1?(u>=zi&&(u=zi-1),f=e(I,u),h=f.length,y=g.length,l=t(f,g,h,y),l==1&&(u--,r(f,C<h?A:I,h))):(u==0&&(l=u=1),f=I.slice()),h=f.length,h<y&&f.unshift(0),r(g,f,y),l==-1&&(y=g.length,l=t(I,g,C,y),l<1&&(u++,r(g,C<y?A:I,y))),y=g.length):l===0&&(u++,g=[0]),x[d++]=u,l&&g[0]?g[y++]=O[_]||0:(g=[O[_]],y=1);while((_++<j||g[0]!==void 0)&&b--)}return x[0]||x.shift(),m.e=c,Zs(m,i?o+yi(m)+1:o)}}();function rZ(e,t){var r,n,s,o,i,l,c=0,d=0,u=e.constructor,f=u.precision;if(yi(e)>16)throw Error(KM+yi(e));if(!e.s)return new u(nd);for(t==null?(ko=!1,l=f):l=t,i=new u(.03125);e.abs().gte(.1);)e=e.times(i),d+=5;for(n=Math.log(Zp(2,d))/Math.LN10*2+5|0,l+=n,r=s=o=new u(nd),u.precision=l;;){if(s=Zs(s.times(e),l),r=r.times(++c),i=o.plus(ym(s,r,l)),bf(i.d).slice(0,l)===bf(o.d).slice(0,l)){for(;d--;)o=Zs(o.times(o),l);return u.precision=f,t==null?(ko=!0,Zs(o,f)):o}o=i}}function yi(e){for(var t=e.e*yo,r=e.d[0];r>=10;r/=10)t++;return t}function SE(e,t,r){if(t>e.LN10.sd())throw ko=!0,r&&(e.precision=r),Error(iu+"LN10 precision limit exceeded");return Zs(new e(e.LN10),t)}function mh(e){for(var t="";e--;)t+="0";return t}function Qw(e,t){var r,n,s,o,i,l,c,d,u,f=1,h=10,m=e,x=m.d,g=m.constructor,y=g.precision;if(m.s<1)throw Error(iu+(m.s?"NaN":"-Infinity"));if(m.eq(nd))return new g(0);if(t==null?(ko=!1,d=y):d=t,m.eq(10))return t==null&&(ko=!0),SE(g,d);if(d+=h,g.precision=d,r=bf(x),n=r.charAt(0),o=yi(m),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)m=m.times(e),r=bf(m.d),n=r.charAt(0),f++;o=yi(m),n>1?(m=new g("0."+r),o++):m=new g(n+"."+r.slice(1))}else return c=SE(g,d+2,y).times(o+""),m=Qw(new g(n+"."+r.slice(1)),d-h).plus(c),g.precision=y,t==null?(ko=!0,Zs(m,y)):m;for(l=i=m=ym(m.minus(nd),m.plus(nd),d),u=Zs(m.times(m),d),s=3;;){if(i=Zs(i.times(u),d),c=l.plus(ym(i,new g(s),d)),bf(c.d).slice(0,d)===bf(l.d).slice(0,d))return l=l.times(2),o!==0&&(l=l.plus(SE(g,d+2,y).times(o+""))),l=ym(l,new g(f),d),g.precision=y,t==null?(ko=!0,Zs(l,y)):l;l=c,s+=2}}function Oq(e,t){var r,n,s;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(s=t.length;t.charCodeAt(s-1)===48;)--s;if(t=t.slice(n,s),t){if(s-=n,r=r-n-1,e.e=dy(r/yo),e.d=[],n=(r+1)%yo,r<0&&(n+=yo),n<s){for(n&&e.d.push(+t.slice(0,n)),s-=yo;n<s;)e.d.push(+t.slice(n,n+=yo));t=t.slice(n),n=yo-t.length}else n-=s;for(;n--;)t+="0";if(e.d.push(+t),ko&&(e.e>oS||e.e<-oS))throw Error(KM+r)}else e.s=0,e.e=0,e.d=[0];return e}function Zs(e,t,r){var n,s,o,i,l,c,d,u,f=e.d;for(i=1,o=f[0];o>=10;o/=10)i++;if(n=t-i,n<0)n+=yo,s=t,d=f[u=0];else{if(u=Math.ceil((n+1)/yo),o=f.length,u>=o)return e;for(d=o=f[u],i=1;o>=10;o/=10)i++;n%=yo,s=n-yo+i}if(r!==void 0&&(o=Zp(10,i-s-1),l=d/o%10|0,c=t<0||f[u+1]!==void 0||d%o,c=r<4?(l||c)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||c||r==6&&(n>0?s>0?d/Zp(10,i-s):0:f[u-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return c?(o=yi(e),f.length=1,t=t-o-1,f[0]=Zp(10,(yo-t%yo)%yo),e.e=dy(-t/yo)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=u,o=1,u--):(f.length=u+1,o=Zp(10,yo-n),f[u]=s>0?(d/Zp(10,i-s)%Zp(10,s)|0)*o:0),c)for(;;)if(u==0){(f[0]+=o)==zi&&(f[0]=1,++e.e);break}else{if(f[u]+=o,f[u]!=zi)break;f[u--]=0,o=1}for(n=f.length;f[--n]===0;)f.pop();if(ko&&(e.e>oS||e.e<-oS))throw Error(KM+yi(e));return e}function nZ(e,t){var r,n,s,o,i,l,c,d,u,f,h=e.constructor,m=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),ko?Zs(t,m):t;if(c=e.d,f=t.d,n=t.e,d=e.e,c=c.slice(),i=d-n,i){for(u=i<0,u?(r=c,i=-i,l=f.length):(r=f,n=d,l=c.length),s=Math.max(Math.ceil(m/yo),l)+2,i>s&&(i=s,r.length=1),r.reverse(),s=i;s--;)r.push(0);r.reverse()}else{for(s=c.length,l=f.length,u=s<l,u&&(l=s),s=0;s<l;s++)if(c[s]!=f[s]){u=c[s]<f[s];break}i=0}for(u&&(r=c,c=f,f=r,t.s=-t.s),l=c.length,s=f.length-l;s>0;--s)c[l++]=0;for(s=f.length;s>i;){if(c[--s]<f[s]){for(o=s;o&&c[--o]===0;)c[o]=zi-1;--c[o],c[s]+=zi}c[s]-=f[s]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(t.d=c,t.e=n,ko?Zs(t,m):t):new h(0)}function Yg(e,t,r){var n,s=yi(e),o=bf(e.d),i=o.length;return t?(r&&(n=r-i)>0?o=o.charAt(0)+"."+o.slice(1)+mh(n):i>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(s<0?"e":"e+")+s):s<0?(o="0."+mh(-s-1)+o,r&&(n=r-i)>0&&(o+=mh(n))):s>=i?(o+=mh(s+1-i),r&&(n=r-s-1)>0&&(o=o+"."+mh(n))):((n=s+1)<i&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-i)>0&&(s+1===i&&(o+="."),o+=mh(n))),e.s<0?"-"+o:o}function Tq(e,t){if(e.length>t)return e.length=t,!0}function aZ(e){var t,r,n;function s(o){var i=this;if(!(i instanceof s))return new s(o);if(i.constructor=s,o instanceof s){i.s=o.s,i.e=o.e,i.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(Pg+o);if(o>0)i.s=1;else if(o<0)o=-o,i.s=-1;else{i.s=0,i.e=0,i.d=[0];return}if(o===~~o&&o<1e7){i.e=0,i.d=[o];return}return Oq(i,o.toString())}else if(typeof o!="string")throw Error(Pg+o);if(o.charCodeAt(0)===45?(o=o.slice(1),i.s=-1):i.s=1,ERe.test(o))Oq(i,o);else throw Error(Pg+o)}if(s.prototype=ta,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=aZ,s.config=s.set=kRe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return s.config(e),s}function kRe(e){if(!e||typeof e!="object")throw Error(iu+"Object expected");var t,r,n,s=["precision",1,cy,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<s.length;t+=3)if((n=e[r=s[t]])!==void 0)if(dy(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(Pg+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Pg+r+": "+n);return this}var XM=aZ(PRe);nd=new XM(1);const Hs=XM;function IRe(e){return MRe(e)||DRe(e)||TRe(e)||ORe()}function ORe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TRe(e,t){if(e){if(typeof e=="string")return sT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sT(e,t)}}function DRe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function MRe(e){if(Array.isArray(e))return sT(e)}function sT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var RRe=function(t){return t},sZ={"@@functional/placeholder":!0},oZ=function(t){return t===sZ},Dq=function(t){return function r(){return arguments.length===0||arguments.length===1&&oZ(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},FRe=function e(t,r){return t===1?r:Dq(function(){for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];var i=s.filter(function(l){return l!==sZ}).length;return i>=t?r.apply(void 0,s):e(t-i,Dq(function(){for(var l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];var u=s.map(function(f){return oZ(f)?c.shift():f});return r.apply(void 0,IRe(u).concat(c))}))})},$5=function(t){return FRe(t.length,t)},oT=function(t,r){for(var n=[],s=t;s<r;++s)n[s-t]=s;return n},LRe=$5(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),$Re=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return RRe;var s=r.reverse(),o=s[0],i=s.slice(1);return function(){return i.reduce(function(l,c){return c(l)},o.apply(void 0,arguments))}},iT=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},iZ=function(t){var r=null,n=null;return function(){for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return r&&o.every(function(l,c){return l===r[c]})||(r=o,n=t.apply(void 0,o)),n}};function BRe(e){var t;return e===0?t=1:t=Math.floor(new Hs(e).abs().log(10).toNumber())+1,t}function qRe(e,t,r){for(var n=new Hs(e),s=0,o=[];n.lt(t)&&s<1e5;)o.push(n.toNumber()),n=n.add(r),s++;return o}var zRe=$5(function(e,t,r){var n=+e,s=+t;return n+r*(s-n)}),URe=$5(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),VRe=$5(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const B5={rangeStep:qRe,getDigitCount:BRe,interpolateNumber:zRe,uninterpolateNumber:URe,uninterpolateTruncation:VRe};function lT(e){return GRe(e)||HRe(e)||lZ(e)||WRe()}function WRe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HRe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function GRe(e){if(Array.isArray(e))return cT(e)}function Zw(e,t){return YRe(e)||XRe(e,t)||lZ(e,t)||KRe()}function KRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lZ(e,t){if(e){if(typeof e=="string")return cT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cT(e,t)}}function cT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function XRe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,s=!1,o=void 0;try{for(var i=e[Symbol.iterator](),l;!(n=(l=i.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(c){s=!0,o=c}finally{try{!n&&i.return!=null&&i.return()}finally{if(s)throw o}}return r}}function YRe(e){if(Array.isArray(e))return e}function cZ(e){var t=Zw(e,2),r=t[0],n=t[1],s=r,o=n;return r>n&&(s=n,o=r),[s,o]}function dZ(e,t,r){if(e.lte(0))return new Hs(0);var n=B5.getDigitCount(e.toNumber()),s=new Hs(10).pow(n),o=e.div(s),i=n!==1?.05:.1,l=new Hs(Math.ceil(o.div(i).toNumber())).add(r).mul(i),c=l.mul(s);return t?c:new Hs(Math.ceil(c))}function JRe(e,t,r){var n=1,s=new Hs(e);if(!s.isint()&&r){var o=Math.abs(e);o<1?(n=new Hs(10).pow(B5.getDigitCount(e)-1),s=new Hs(Math.floor(s.div(n).toNumber())).mul(n)):o>1&&(s=new Hs(Math.floor(e)))}else e===0?s=new Hs(Math.floor((t-1)/2)):r||(s=new Hs(Math.floor(e)));var i=Math.floor((t-1)/2),l=$Re(LRe(function(c){return s.add(new Hs(c-i).mul(n)).toNumber()}),oT);return l(0,t)}function uZ(e,t,r,n){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Hs(0),tickMin:new Hs(0),tickMax:new Hs(0)};var o=dZ(new Hs(t).sub(e).div(r-1),n,s),i;e<=0&&t>=0?i=new Hs(0):(i=new Hs(e).add(t).div(2),i=i.sub(new Hs(i).mod(o)));var l=Math.ceil(i.sub(e).div(o).toNumber()),c=Math.ceil(new Hs(t).sub(i).div(o).toNumber()),d=l+c+1;return d>r?uZ(e,t,r,n,s+1):(d<r&&(c=t>0?c+(r-d):c,l=t>0?l:l+(r-d)),{step:o,tickMin:i.sub(new Hs(l).mul(o)),tickMax:i.add(new Hs(c).mul(o))})}function QRe(e){var t=Zw(e,2),r=t[0],n=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=Math.max(s,2),l=cZ([r,n]),c=Zw(l,2),d=c[0],u=c[1];if(d===-1/0||u===1/0){var f=u===1/0?[d].concat(lT(oT(0,s-1).map(function(){return 1/0}))):[].concat(lT(oT(0,s-1).map(function(){return-1/0})),[u]);return r>n?iT(f):f}if(d===u)return JRe(d,s,o);var h=uZ(d,u,i,o),m=h.step,x=h.tickMin,g=h.tickMax,y=B5.rangeStep(x,g.add(new Hs(.1).mul(m)),m);return r>n?iT(y):y}function ZRe(e,t){var r=Zw(e,2),n=r[0],s=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=cZ([n,s]),l=Zw(i,2),c=l[0],d=l[1];if(c===-1/0||d===1/0)return[n,s];if(c===d)return[c];var u=Math.max(t,2),f=dZ(new Hs(d).sub(c).div(u-1),o,0),h=[].concat(lT(B5.rangeStep(new Hs(c),new Hs(d).sub(new Hs(.99).mul(f)),f)),[d]);return n>s?iT(h):h}var eFe=iZ(QRe),tFe=iZ(ZRe),rFe=!0,CE="Invariant failed";function dp(e,t){if(!e){if(rFe)throw new Error(CE);var r=typeof t=="function"?t():t,n=r?"".concat(CE,": ").concat(r):CE;throw new Error(n)}}var nFe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function p0(e){"@babel/helpers - typeof";return p0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p0(e)}function iS(){return iS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iS.apply(this,arguments)}function aFe(e,t){return lFe(e)||iFe(e,t)||oFe(e,t)||sFe()}function sFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oFe(e,t){if(e){if(typeof e=="string")return Mq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mq(e,t)}}function Mq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function iFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function lFe(e){if(Array.isArray(e))return e}function cFe(e,t){if(e==null)return{};var r=dFe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function dFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function uFe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hZ(n.key),n)}}function fFe(e,t,r){return t&&Rq(e.prototype,t),r&&Rq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function mFe(e,t,r){return t=lS(t),hFe(e,fZ()?Reflect.construct(t,r||[],lS(e).constructor):t.apply(e,r))}function hFe(e,t){if(t&&(p0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pFe(e)}function pFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fZ=function(){return!!e})()}function lS(e){return lS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},lS(e)}function gFe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dT(e,t)}function dT(e,t){return dT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},dT(e,t)}function mZ(e,t,r){return t=hZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hZ(e){var t=xFe(e,"string");return p0(t)=="symbol"?t:t+""}function xFe(e,t){if(p0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(p0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var l2=function(e){function t(){return uFe(this,t),mFe(this,t,arguments)}return gFe(t,e),fFe(t,[{key:"render",value:function(){var n=this.props,s=n.offset,o=n.layout,i=n.width,l=n.dataKey,c=n.data,d=n.dataPointFormatter,u=n.xAxis,f=n.yAxis,h=cFe(n,nFe),m=ha(h,!1);this.props.direction==="x"&&u.type!=="number"&&dp(!1);var x=c.map(function(g){var y=d(g,l),v=y.x,b=y.y,w=y.value,_=y.errorVal;if(!_)return null;var j=[],S,C;if(Array.isArray(_)){var A=aFe(_,2);S=A[0],C=A[1]}else S=C=_;if(o==="vertical"){var P=u.scale,F=b+s,O=F+i,I=F-i,T=P(w-S),k=P(w+C);j.push({x1:k,y1:O,x2:k,y2:I}),j.push({x1:T,y1:F,x2:k,y2:F}),j.push({x1:T,y1:O,x2:T,y2:I})}else if(o==="horizontal"){var B=f.scale,z=v+s,U=z-i,L=z+i,W=B(w-S),ge=B(w+C);j.push({x1:U,y1:ge,x2:L,y2:ge}),j.push({x1:z,y1:W,x2:z,y2:ge}),j.push({x1:U,y1:W,x2:L,y2:W})}return Ee.createElement(ns,iS({className:"recharts-errorBar",key:"bar-".concat(j.map(function(Ae){return"".concat(Ae.x1,"-").concat(Ae.x2,"-").concat(Ae.y1,"-").concat(Ae.y2)}))},m),j.map(function(Ae){return Ee.createElement("line",iS({},Ae,{key:"line-".concat(Ae.x1,"-").concat(Ae.x2,"-").concat(Ae.y1,"-").concat(Ae.y2)}))}))});return Ee.createElement(ns,{className:"recharts-errorBars"},x)}}])}(Ee.Component);mZ(l2,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});mZ(l2,"displayName","ErrorBar");function e1(e){"@babel/helpers - typeof";return e1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e1(e)}function Fq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Lp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fq(Object(r),!0).forEach(function(n){vFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vFe(e,t,r){return t=yFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yFe(e){var t=bFe(e,"string");return e1(t)=="symbol"?t:t+""}function bFe(e,t){if(e1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(e1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pZ=function(t){var r=t.children,n=t.formattedGraphicalItems,s=t.legendWidth,o=t.legendContent,i=ed(r,Cg);if(!i)return null;var l=Cg.defaultProps,c=l!==void 0?Lp(Lp({},l),i.props):{},d;return i.props&&i.props.payload?d=i.props&&i.props.payload:o==="children"?d=(n||[]).reduce(function(u,f){var h=f.item,m=f.props,x=m.sectors||m.data||[];return u.concat(x.map(function(g){return{type:i.props.iconType||h.props.legendType,value:g.name,color:g.fill,payload:g}}))},[]):d=(n||[]).map(function(u){var f=u.item,h=f.type.defaultProps,m=h!==void 0?Lp(Lp({},h),f.props):{},x=m.dataKey,g=m.name,y=m.legendType,v=m.hide;return{inactive:v,dataKey:x,type:c.iconType||y||"square",color:YM(f),value:g||x,payload:m}}),Lp(Lp(Lp({},c),Cg.getWithHeight(i,s)),{},{payload:d,item:i})};function t1(e){"@babel/helpers - typeof";return t1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t1(e)}function Lq(e){return NFe(e)||jFe(e)||_Fe(e)||wFe()}function wFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Fe(e,t){if(e){if(typeof e=="string")return uT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uT(e,t)}}function jFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function NFe(e){if(Array.isArray(e))return uT(e)}function uT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Wo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$q(Object(r),!0).forEach(function(n){Bv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$q(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Bv(e,t,r){return t=SFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SFe(e){var t=CFe(e,"string");return t1(t)=="symbol"?t:t+""}function CFe(e,t){if(t1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(t1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ni(e,t,r){return La(e)||La(t)?r:Mi(t)?hd(e,t,r):Ea(t)?t(e):r}function Wb(e,t,r,n){var s=NRe(e,function(l){return ni(l,t)});if(r==="number"){var o=s.filter(function(l){return vn(l)||parseFloat(l)});return o.length?[L5(o),Sh(o)]:[1/0,-1/0]}var i=n?s.filter(function(l){return!La(l)}):s;return i.map(function(l){return Mi(l)||l instanceof Date?l:""})}var AFe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,i=-1,l=(r=n?.length)!==null&&r!==void 0?r:0;if(l<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var c=o.range,d=0;d<l;d++){var u=d>0?s[d-1].coordinate:s[l-1].coordinate,f=s[d].coordinate,h=d>=l-1?s[0].coordinate:s[d+1].coordinate,m=void 0;if(rc(f-u)!==rc(h-f)){var x=[];if(rc(h-f)===rc(c[1]-c[0])){m=h;var g=f+c[1]-c[0];x[0]=Math.min(g,(g+u)/2),x[1]=Math.max(g,(g+u)/2)}else{m=u;var y=h+c[1]-c[0];x[0]=Math.min(f,(y+f)/2),x[1]=Math.max(f,(y+f)/2)}var v=[Math.min(f,(m+f)/2),Math.max(f,(m+f)/2)];if(t>v[0]&&t<=v[1]||t>=x[0]&&t<=x[1]){i=s[d].index;break}}else{var b=Math.min(u,h),w=Math.max(u,h);if(t>(b+f)/2&&t<=(w+f)/2){i=s[d].index;break}}}else for(var _=0;_<l;_++)if(_===0&&t<=(n[_].coordinate+n[_+1].coordinate)/2||_>0&&_<l-1&&t>(n[_].coordinate+n[_-1].coordinate)/2&&t<=(n[_].coordinate+n[_+1].coordinate)/2||_===l-1&&t>(n[_].coordinate+n[_-1].coordinate)/2){i=n[_].index;break}return i},YM=function(t){var r,n=t,s=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?Wo(Wo({},t.type.defaultProps),t.props):t.props,i=o.stroke,l=o.fill,c;switch(s){case"Line":c=i;break;case"Area":case"Radar":c=i&&i!=="none"?i:l;break;default:c=l;break}return c},PFe=function(t){var r=t.barSize,n=t.totalSize,s=t.stackGroups,o=s===void 0?{}:s;if(!o)return{};for(var i={},l=Object.keys(o),c=0,d=l.length;c<d;c++)for(var u=o[l[c]].stackGroups,f=Object.keys(u),h=0,m=f.length;h<m;h++){var x=u[f[h]],g=x.items,y=x.cateAxisId,v=g.filter(function(C){return vm(C.type).indexOf("Bar")>=0});if(v&&v.length){var b=v[0].type.defaultProps,w=b!==void 0?Wo(Wo({},b),v[0].props):v[0].props,_=w.barSize,j=w[y];i[j]||(i[j]=[]);var S=La(_)?r:_;i[j].push({item:v[0],stackList:v.slice(1),barSize:La(S)?void 0:nc(S,n,0)})}}return i},EFe=function(t){var r=t.barGap,n=t.barCategoryGap,s=t.bandSize,o=t.sizeList,i=o===void 0?[]:o,l=t.maxBarSize,c=i.length;if(c<1)return null;var d=nc(r,s,0,!0),u,f=[];if(i[0].barSize===+i[0].barSize){var h=!1,m=s/c,x=i.reduce(function(_,j){return _+j.barSize||0},0);x+=(c-1)*d,x>=s&&(x-=(c-1)*d,d=0),x>=s&&m>0&&(h=!0,m*=.9,x=c*m);var g=(s-x)/2>>0,y={offset:g-d,size:0};u=i.reduce(function(_,j){var S={item:j.item,position:{offset:y.offset+y.size+d,size:h?m:j.barSize}},C=[].concat(Lq(_),[S]);return y=C[C.length-1].position,j.stackList&&j.stackList.length&&j.stackList.forEach(function(A){C.push({item:A,position:y})}),C},f)}else{var v=nc(n,s,0,!0);s-2*v-(c-1)*d<=0&&(d=0);var b=(s-2*v-(c-1)*d)/c;b>1&&(b>>=0);var w=l===+l?Math.min(b,l):b;u=i.reduce(function(_,j,S){var C=[].concat(Lq(_),[{item:j.item,position:{offset:v+(b+d)*S+(b-w)/2,size:w}}]);return j.stackList&&j.stackList.length&&j.stackList.forEach(function(A){C.push({item:A,position:C[C.length-1].position})}),C},f)}return u},kFe=function(t,r,n,s){var o=n.children,i=n.width,l=n.margin,c=i-(l.left||0)-(l.right||0),d=pZ({children:o,legendWidth:c});if(d){var u=s||{},f=u.width,h=u.height,m=d.align,x=d.verticalAlign,g=d.layout;if((g==="vertical"||g==="horizontal"&&x==="middle")&&m!=="center"&&vn(t[m]))return Wo(Wo({},t),{},Bv({},m,t[m]+(f||0)));if((g==="horizontal"||g==="vertical"&&m==="center")&&x!=="middle"&&vn(t[x]))return Wo(Wo({},t),{},Bv({},x,t[x]+(h||0)))}return t},IFe=function(t,r,n){return La(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},gZ=function(t,r,n,s,o){var i=r.props.children,l=pd(i,l2).filter(function(d){return IFe(s,o,d.props.direction)});if(l&&l.length){var c=l.map(function(d){return d.props.dataKey});return t.reduce(function(d,u){var f=ni(u,n);if(La(f))return d;var h=Array.isArray(f)?[L5(f),Sh(f)]:[f,f],m=c.reduce(function(x,g){var y=ni(u,g,0),v=h[0]-Math.abs(Array.isArray(y)?y[0]:y),b=h[1]+Math.abs(Array.isArray(y)?y[1]:y);return[Math.min(v,x[0]),Math.max(b,x[1])]},[1/0,-1/0]);return[Math.min(m[0],d[0]),Math.max(m[1],d[1])]},[1/0,-1/0])}return null},OFe=function(t,r,n,s,o){var i=r.map(function(l){return gZ(t,l,n,o,s)}).filter(function(l){return!La(l)});return i&&i.length?i.reduce(function(l,c){return[Math.min(l[0],c[0]),Math.max(l[1],c[1])]},[1/0,-1/0]):null},xZ=function(t,r,n,s,o){var i=r.map(function(c){var d=c.props.dataKey;return n==="number"&&d&&gZ(t,c,d,s)||Wb(t,d,n,o)});if(n==="number")return i.reduce(function(c,d){return[Math.min(c[0],d[0]),Math.max(c[1],d[1])]},[1/0,-1/0]);var l={};return i.reduce(function(c,d){for(var u=0,f=d.length;u<f;u++)l[d[u]]||(l[d[u]]=!0,c.push(d[u]));return c},[])},vZ=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},yZ=function(t,r,n,s){if(s)return t.map(function(c){return c.coordinate});var o,i,l=t.map(function(c){return c.coordinate===r&&(o=!0),c.coordinate===n&&(i=!0),c.coordinate});return o||l.push(r),i||l.push(n),l},mm=function(t,r,n){if(!t)return null;var s=t.scale,o=t.duplicateDomain,i=t.type,l=t.range,c=t.realScaleType==="scaleBand"?s.bandwidth()/2:2,d=(r||n)&&i==="category"&&s.bandwidth?s.bandwidth()/c:0;if(d=t.axisType==="angleAxis"&&l?.length>=2?rc(l[0]-l[1])*2*d:d,r&&(t.ticks||t.niceTicks)){var u=(t.ticks||t.niceTicks).map(function(f){var h=o?o.indexOf(f):f;return{coordinate:s(h)+d,value:f,offset:d}});return u.filter(function(f){return!ay(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:s(f)+d,value:f,index:h,offset:d}}):s.ticks&&!n?s.ticks(t.tickCount).map(function(f){return{coordinate:s(f)+d,value:f,offset:d}}):s.domain().map(function(f,h){return{coordinate:s(f)+d,value:o?o[f]:f,index:h,offset:d}})},AE=new WeakMap,D_=function(t,r){if(typeof r!="function")return t;AE.has(t)||AE.set(t,new WeakMap);var n=AE.get(t);if(n.has(r))return n.get(r);var s=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,s),s},bZ=function(t,r,n){var s=t.scale,o=t.type,i=t.layout,l=t.axisType;if(s==="auto")return i==="radial"&&l==="radiusAxis"?{scale:Gw(),realScaleType:"band"}:i==="radial"&&l==="angleAxis"?{scale:rS(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Vb(),realScaleType:"point"}:o==="category"?{scale:Gw(),realScaleType:"band"}:{scale:rS(),realScaleType:"linear"};if(Hg(s)){var c="scale".concat(N5(s));return{scale:(Iq[c]||Vb)(),realScaleType:Iq[c]?c:"point"}}return Ea(s)?{scale:s}:{scale:Vb(),realScaleType:"point"}},Bq=1e-4,wZ=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,s=t.range(),o=Math.min(s[0],s[1])-Bq,i=Math.max(s[0],s[1])+Bq,l=t(r[0]),c=t(r[n-1]);(l<o||l>i||c<o||c>i)&&t.domain([r[0],r[n-1]])}},TFe=function(t,r){if(!t)return null;for(var n=0,s=t.length;n<s;n++)if(t[n].item===r)return t[n].position;return null},DFe=function(t,r){if(!r||r.length!==2||!vn(r[0])||!vn(r[1]))return t;var n=Math.min(r[0],r[1]),s=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!vn(t[0])||t[0]<n)&&(o[0]=n),(!vn(t[1])||t[1]>s)&&(o[1]=s),o[0]>s&&(o[0]=s),o[1]<n&&(o[1]=n),o},MFe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,i=0,l=0;l<r;++l){var c=ay(t[l][n][1])?t[l][n][0]:t[l][n][1];c>=0?(t[l][n][0]=o,t[l][n][1]=o+c,o=t[l][n][1]):(t[l][n][0]=i,t[l][n][1]=i+c,i=t[l][n][1])}},RFe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,i=0;i<r;++i){var l=ay(t[i][n][1])?t[i][n][0]:t[i][n][1];l>=0?(t[i][n][0]=o,t[i][n][1]=o+l,o=t[i][n][1]):(t[i][n][0]=0,t[i][n][1]=0)}},FFe={sign:MFe,expand:s5e,none:i0,silhouette:o5e,wiggle:i5e,positive:RFe},LFe=function(t,r,n){var s=r.map(function(l){return l.props.dataKey}),o=FFe[n],i=a5e().keys(s).value(function(l,c){return+ni(l,c,0)}).order(RO).offset(o);return i(t)},$Fe=function(t,r,n,s,o,i){if(!t)return null;var l=i?r.reverse():r,c={},d=l.reduce(function(f,h){var m,x=(m=h.type)!==null&&m!==void 0&&m.defaultProps?Wo(Wo({},h.type.defaultProps),h.props):h.props,g=x.stackId,y=x.hide;if(y)return f;var v=x[n],b=f[v]||{hasStack:!1,stackGroups:{}};if(Mi(g)){var w=b.stackGroups[g]||{numericAxisId:n,cateAxisId:s,items:[]};w.items.push(h),b.hasStack=!0,b.stackGroups[g]=w}else b.stackGroups[fx("_stackId_")]={numericAxisId:n,cateAxisId:s,items:[h]};return Wo(Wo({},f),{},Bv({},v,b))},c),u={};return Object.keys(d).reduce(function(f,h){var m=d[h];if(m.hasStack){var x={};m.stackGroups=Object.keys(m.stackGroups).reduce(function(g,y){var v=m.stackGroups[y];return Wo(Wo({},g),{},Bv({},y,{numericAxisId:n,cateAxisId:s,items:v.items,stackedData:LFe(t,v.items,o)}))},x)}return Wo(Wo({},f),{},Bv({},h,m))},u)},_Z=function(t,r){var n=r.realScaleType,s=r.type,o=r.tickCount,i=r.originalDomain,l=r.allowDecimals,c=n||r.scale;if(c!=="auto"&&c!=="linear")return null;if(o&&s==="number"&&i&&(i[0]==="auto"||i[1]==="auto")){var d=t.domain();if(!d.length)return null;var u=eFe(d,o,l);return t.domain([L5(u),Sh(u)]),{niceTicks:u}}if(o&&s==="number"){var f=t.domain(),h=tFe(f,o,l);return{niceTicks:h}}return null};function cS(e){var t=e.axis,r=e.ticks,n=e.bandSize,s=e.entry,o=e.index,i=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!La(s[t.dataKey])){var l=MN(r,"value",s[t.dataKey]);if(l)return l.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var c=ni(s,La(i)?t.dataKey:i);return La(c)?null:t.scale(c)}var qq=function(t){var r=t.axis,n=t.ticks,s=t.offset,o=t.bandSize,i=t.entry,l=t.index;if(r.type==="category")return n[l]?n[l].coordinate+s:null;var c=ni(i,r.dataKey,r.domain[l]);return La(c)?null:r.scale(c)-o/2+s},BFe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var s=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return s<=0&&o>=0?0:o<0?o:s}return n[0]},qFe=function(t,r){var n,s=(n=t.type)!==null&&n!==void 0&&n.defaultProps?Wo(Wo({},t.type.defaultProps),t.props):t.props,o=s.stackId;if(Mi(o)){var i=r[o];if(i){var l=i.items.indexOf(t);return l>=0?i.stackedData[l]:null}}return null},zFe=function(t){return t.reduce(function(r,n){return[L5(n.concat([r[0]]).filter(vn)),Sh(n.concat([r[1]]).filter(vn))]},[1/0,-1/0])},jZ=function(t,r,n){return Object.keys(t).reduce(function(s,o){var i=t[o],l=i.stackedData,c=l.reduce(function(d,u){var f=zFe(u.slice(r,n+1));return[Math.min(d[0],f[0]),Math.max(d[1],f[1])]},[1/0,-1/0]);return[Math.min(c[0],s[0]),Math.max(c[1],s[1])]},[1/0,-1/0]).map(function(s){return s===1/0||s===-1/0?0:s})},zq=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Uq=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,fT=function(t,r,n){if(Ea(t))return t(r,n);if(!Array.isArray(t))return r;var s=[];if(vn(t[0]))s[0]=n?t[0]:Math.min(t[0],r[0]);else if(zq.test(t[0])){var o=+zq.exec(t[0])[1];s[0]=r[0]-o}else Ea(t[0])?s[0]=t[0](r[0]):s[0]=r[0];if(vn(t[1]))s[1]=n?t[1]:Math.max(t[1],r[1]);else if(Uq.test(t[1])){var i=+Uq.exec(t[1])[1];s[1]=r[1]+i}else Ea(t[1])?s[1]=t[1](r[1]):s[1]=r[1];return s},dS=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var s=t.scale.bandwidth();if(!n||s>0)return s}if(t&&r&&r.length>=2){for(var o=NM(r,function(f){return f.coordinate}),i=1/0,l=1,c=o.length;l<c;l++){var d=o[l],u=o[l-1];i=Math.min((d.coordinate||0)-(u.coordinate||0),i)}return i===1/0?0:i}return n?void 0:0},Vq=function(t,r,n){return!t||!t.length||Xg(t,hd(n,"type.defaultProps.domain"))?r:t},NZ=function(t,r){var n=t.type.defaultProps?Wo(Wo({},t.type.defaultProps),t.props):t.props,s=n.dataKey,o=n.name,i=n.unit,l=n.formatter,c=n.tooltipType,d=n.chartType,u=n.hide;return Wo(Wo({},ha(t,!1)),{},{dataKey:s,unit:i,formatter:l,name:o||s,color:YM(t),value:ni(r,s),type:c,payload:r,chartType:d,hide:u})};function r1(e){"@babel/helpers - typeof";return r1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r1(e)}function Wq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function nm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wq(Object(r),!0).forEach(function(n){SZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SZ(e,t,r){return t=UFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UFe(e){var t=VFe(e,"string");return r1(t)=="symbol"?t:t+""}function VFe(e,t){if(r1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(r1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function WFe(e,t){return XFe(e)||KFe(e,t)||GFe(e,t)||HFe()}function HFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GFe(e,t){if(e){if(typeof e=="string")return Hq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hq(e,t)}}function Hq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function KFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function XFe(e){if(Array.isArray(e))return e}var uS=Math.PI/180,YFe=function(t){return t*180/Math.PI},uo=function(t,r,n,s){return{x:t+Math.cos(-uS*s)*n,y:r+Math.sin(-uS*s)*n}},CZ=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},JFe=function(t,r,n,s,o){var i=t.width,l=t.height,c=t.startAngle,d=t.endAngle,u=nc(t.cx,i,i/2),f=nc(t.cy,l,l/2),h=CZ(i,l,n),m=nc(t.innerRadius,h,0),x=nc(t.outerRadius,h,h*.8),g=Object.keys(r);return g.reduce(function(y,v){var b=r[v],w=b.domain,_=b.reversed,j;if(La(b.range))s==="angleAxis"?j=[c,d]:s==="radiusAxis"&&(j=[m,x]),_&&(j=[j[1],j[0]]);else{j=b.range;var S=j,C=WFe(S,2);c=C[0],d=C[1]}var A=bZ(b,o),P=A.realScaleType,F=A.scale;F.domain(w).range(j),wZ(F);var O=_Z(F,nm(nm({},b),{},{realScaleType:P})),I=nm(nm(nm({},b),O),{},{range:j,radius:x,realScaleType:P,scale:F,cx:u,cy:f,innerRadius:m,outerRadius:x,startAngle:c,endAngle:d});return nm(nm({},y),{},SZ({},v,I))},{})},QFe=function(t,r){var n=t.x,s=t.y,o=r.x,i=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(s-i,2))},ZFe=function(t,r){var n=t.x,s=t.y,o=r.cx,i=r.cy,l=QFe({x:n,y:s},{x:o,y:i});if(l<=0)return{radius:l};var c=(n-o)/l,d=Math.acos(c);return s>i&&(d=2*Math.PI-d),{radius:l,angle:YFe(d),angleInRadian:d}},eLe=function(t){var r=t.startAngle,n=t.endAngle,s=Math.floor(r/360),o=Math.floor(n/360),i=Math.min(s,o);return{startAngle:r-i*360,endAngle:n-i*360}},tLe=function(t,r){var n=r.startAngle,s=r.endAngle,o=Math.floor(n/360),i=Math.floor(s/360),l=Math.min(o,i);return t+l*360},Gq=function(t,r){var n=t.x,s=t.y,o=ZFe({x:n,y:s},r),i=o.radius,l=o.angle,c=r.innerRadius,d=r.outerRadius;if(i<c||i>d)return!1;if(i===0)return!0;var u=eLe(r),f=u.startAngle,h=u.endAngle,m=l,x;if(f<=h){for(;m>h;)m-=360;for(;m<f;)m+=360;x=m>=f&&m<=h}else{for(;m>f;)m-=360;for(;m<h;)m+=360;x=m>=h&&m<=f}return x?nm(nm({},r),{},{radius:i,angle:tLe(m,r)}):null},AZ=function(t){return!p.isValidElement(t)&&!Ea(t)&&typeof t!="boolean"?t.className:""};function n1(e){"@babel/helpers - typeof";return n1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n1(e)}var rLe=["offset"];function nLe(e){return iLe(e)||oLe(e)||sLe(e)||aLe()}function aLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sLe(e,t){if(e){if(typeof e=="string")return mT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mT(e,t)}}function oLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function iLe(e){if(Array.isArray(e))return mT(e)}function mT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function lLe(e,t){if(e==null)return{};var r=cLe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function cLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Kq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Pi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kq(Object(r),!0).forEach(function(n){dLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dLe(e,t,r){return t=uLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uLe(e){var t=fLe(e,"string");return n1(t)=="symbol"?t:t+""}function fLe(e,t){if(n1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(n1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function a1(){return a1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a1.apply(this,arguments)}var mLe=function(t){var r=t.value,n=t.formatter,s=La(t.children)?r:t.children;return Ea(n)?n(s):s},hLe=function(t,r){var n=rc(r-t),s=Math.min(Math.abs(r-t),360);return n*s},pLe=function(t,r,n){var s=t.position,o=t.viewBox,i=t.offset,l=t.className,c=o,d=c.cx,u=c.cy,f=c.innerRadius,h=c.outerRadius,m=c.startAngle,x=c.endAngle,g=c.clockWise,y=(f+h)/2,v=hLe(m,x),b=v>=0?1:-1,w,_;s==="insideStart"?(w=m+b*i,_=g):s==="insideEnd"?(w=x-b*i,_=!g):s==="end"&&(w=x+b*i,_=g),_=v<=0?_:!_;var j=uo(d,u,y,w),S=uo(d,u,y,w+(_?1:-1)*359),C="M".concat(j.x,",").concat(j.y,`
    A`).concat(y,",").concat(y,",0,1,").concat(_?0:1,`,
    `).concat(S.x,",").concat(S.y),A=La(t.id)?fx("recharts-radial-line-"):t.id;return Ee.createElement("text",a1({},n,{dominantBaseline:"central",className:qa("recharts-radial-bar-label",l)}),Ee.createElement("defs",null,Ee.createElement("path",{id:A,d:C})),Ee.createElement("textPath",{xlinkHref:"#".concat(A)},r))},gLe=function(t){var r=t.viewBox,n=t.offset,s=t.position,o=r,i=o.cx,l=o.cy,c=o.innerRadius,d=o.outerRadius,u=o.startAngle,f=o.endAngle,h=(u+f)/2;if(s==="outside"){var m=uo(i,l,d+n,h),x=m.x,g=m.y;return{x,y:g,textAnchor:x>=i?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"end"};var y=(c+d)/2,v=uo(i,l,y,h),b=v.x,w=v.y;return{x:b,y:w,textAnchor:"middle",verticalAnchor:"middle"}},xLe=function(t){var r=t.viewBox,n=t.parentViewBox,s=t.offset,o=t.position,i=r,l=i.x,c=i.y,d=i.width,u=i.height,f=u>=0?1:-1,h=f*s,m=f>0?"end":"start",x=f>0?"start":"end",g=d>=0?1:-1,y=g*s,v=g>0?"end":"start",b=g>0?"start":"end";if(o==="top"){var w={x:l+d/2,y:c-f*s,textAnchor:"middle",verticalAnchor:m};return Pi(Pi({},w),n?{height:Math.max(c-n.y,0),width:d}:{})}if(o==="bottom"){var _={x:l+d/2,y:c+u+h,textAnchor:"middle",verticalAnchor:x};return Pi(Pi({},_),n?{height:Math.max(n.y+n.height-(c+u),0),width:d}:{})}if(o==="left"){var j={x:l-y,y:c+u/2,textAnchor:v,verticalAnchor:"middle"};return Pi(Pi({},j),n?{width:Math.max(j.x-n.x,0),height:u}:{})}if(o==="right"){var S={x:l+d+y,y:c+u/2,textAnchor:b,verticalAnchor:"middle"};return Pi(Pi({},S),n?{width:Math.max(n.x+n.width-S.x,0),height:u}:{})}var C=n?{width:d,height:u}:{};return o==="insideLeft"?Pi({x:l+y,y:c+u/2,textAnchor:b,verticalAnchor:"middle"},C):o==="insideRight"?Pi({x:l+d-y,y:c+u/2,textAnchor:v,verticalAnchor:"middle"},C):o==="insideTop"?Pi({x:l+d/2,y:c+h,textAnchor:"middle",verticalAnchor:x},C):o==="insideBottom"?Pi({x:l+d/2,y:c+u-h,textAnchor:"middle",verticalAnchor:m},C):o==="insideTopLeft"?Pi({x:l+y,y:c+h,textAnchor:b,verticalAnchor:x},C):o==="insideTopRight"?Pi({x:l+d-y,y:c+h,textAnchor:v,verticalAnchor:x},C):o==="insideBottomLeft"?Pi({x:l+y,y:c+u-h,textAnchor:b,verticalAnchor:m},C):o==="insideBottomRight"?Pi({x:l+d-y,y:c+u-h,textAnchor:v,verticalAnchor:m},C):ey(o)&&(vn(o.x)||ug(o.x))&&(vn(o.y)||ug(o.y))?Pi({x:l+nc(o.x,d),y:c+nc(o.y,u),textAnchor:"end",verticalAnchor:"end"},C):Pi({x:l+d/2,y:c+u/2,textAnchor:"middle",verticalAnchor:"middle"},C)},vLe=function(t){return"cx"in t&&vn(t.cx)};function Wi(e){var t=e.offset,r=t===void 0?5:t,n=lLe(e,rLe),s=Pi({offset:r},n),o=s.viewBox,i=s.position,l=s.value,c=s.children,d=s.content,u=s.className,f=u===void 0?"":u,h=s.textBreakAll;if(!o||La(l)&&La(c)&&!p.isValidElement(d)&&!Ea(d))return null;if(p.isValidElement(d))return p.cloneElement(d,s);var m;if(Ea(d)){if(m=p.createElement(d,s),p.isValidElement(m))return m}else m=mLe(s);var x=vLe(o),g=ha(s,!0);if(x&&(i==="insideStart"||i==="insideEnd"||i==="end"))return pLe(s,m,g);var y=x?gLe(s):xLe(s);return Ee.createElement(Kg,a1({className:qa("recharts-label",f)},g,y,{breakAll:h}),m)}Wi.displayName="Label";var PZ=function(t){var r=t.cx,n=t.cy,s=t.angle,o=t.startAngle,i=t.endAngle,l=t.r,c=t.radius,d=t.innerRadius,u=t.outerRadius,f=t.x,h=t.y,m=t.top,x=t.left,g=t.width,y=t.height,v=t.clockWise,b=t.labelViewBox;if(b)return b;if(vn(g)&&vn(y)){if(vn(f)&&vn(h))return{x:f,y:h,width:g,height:y};if(vn(m)&&vn(x))return{x:m,y:x,width:g,height:y}}return vn(f)&&vn(h)?{x:f,y:h,width:0,height:0}:vn(r)&&vn(n)?{cx:r,cy:n,startAngle:o||s||0,endAngle:i||s||0,innerRadius:d||0,outerRadius:u||c||l||0,clockWise:v}:t.viewBox?t.viewBox:{}},yLe=function(t,r){return t?t===!0?Ee.createElement(Wi,{key:"label-implicit",viewBox:r}):Mi(t)?Ee.createElement(Wi,{key:"label-implicit",viewBox:r,value:t}):p.isValidElement(t)?t.type===Wi?p.cloneElement(t,{key:"label-implicit",viewBox:r}):Ee.createElement(Wi,{key:"label-implicit",content:t,viewBox:r}):Ea(t)?Ee.createElement(Wi,{key:"label-implicit",content:t,viewBox:r}):ey(t)?Ee.createElement(Wi,a1({viewBox:r},t,{key:"label-implicit"})):null:null},bLe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var s=t.children,o=PZ(t),i=pd(s,Wi).map(function(c,d){return p.cloneElement(c,{viewBox:r||o,key:"label-".concat(d)})});if(!n)return i;var l=yLe(t.label,r||o);return[l].concat(nLe(i))};Wi.parseViewBox=PZ;Wi.renderCallByParent=bLe;function wLe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var _Le=wLe;const jLe=xs(_Le);function s1(e){"@babel/helpers - typeof";return s1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s1(e)}var NLe=["valueAccessor"],SLe=["data","dataKey","clockWise","id","textBreakAll"];function CLe(e){return kLe(e)||ELe(e)||PLe(e)||ALe()}function ALe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PLe(e,t){if(e){if(typeof e=="string")return hT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hT(e,t)}}function ELe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kLe(e){if(Array.isArray(e))return hT(e)}function hT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fS(){return fS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fS.apply(this,arguments)}function Xq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Yq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xq(Object(r),!0).forEach(function(n){ILe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ILe(e,t,r){return t=OLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OLe(e){var t=TLe(e,"string");return s1(t)=="symbol"?t:t+""}function TLe(e,t){if(s1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(s1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jq(e,t){if(e==null)return{};var r=DLe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function DLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var MLe=function(t){return Array.isArray(t.value)?jLe(t.value):t.value};function kf(e){var t=e.valueAccessor,r=t===void 0?MLe:t,n=Jq(e,NLe),s=n.data,o=n.dataKey,i=n.clockWise,l=n.id,c=n.textBreakAll,d=Jq(n,SLe);return!s||!s.length?null:Ee.createElement(ns,{className:"recharts-label-list"},s.map(function(u,f){var h=La(o)?r(u,f):ni(u&&u.payload,o),m=La(l)?{}:{id:"".concat(l,"-").concat(f)};return Ee.createElement(Wi,fS({},ha(u,!0),d,m,{parentViewBox:u.parentViewBox,value:h,textBreakAll:c,viewBox:Wi.parseViewBox(La(i)?u:Yq(Yq({},u),{},{clockWise:i})),key:"label-".concat(f),index:f}))}))}kf.displayName="LabelList";function RLe(e,t){return e?e===!0?Ee.createElement(kf,{key:"labelList-implicit",data:t}):Ee.isValidElement(e)||Ea(e)?Ee.createElement(kf,{key:"labelList-implicit",data:t,content:e}):ey(e)?Ee.createElement(kf,fS({data:t},e,{key:"labelList-implicit"})):null:null}function FLe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,s=pd(n,kf).map(function(i,l){return p.cloneElement(i,{data:t,key:"labelList-".concat(l)})});if(!r)return s;var o=RLe(e.label,t);return[o].concat(CLe(s))}kf.renderCallByParent=FLe;function o1(e){"@babel/helpers - typeof";return o1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o1(e)}function pT(){return pT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pT.apply(this,arguments)}function Qq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Zq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qq(Object(r),!0).forEach(function(n){LLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LLe(e,t,r){return t=$Le(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $Le(e){var t=BLe(e,"string");return o1(t)=="symbol"?t:t+""}function BLe(e,t){if(o1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(o1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qLe=function(t,r){var n=rc(r-t),s=Math.min(Math.abs(r-t),359.999);return n*s},M_=function(t){var r=t.cx,n=t.cy,s=t.radius,o=t.angle,i=t.sign,l=t.isExternal,c=t.cornerRadius,d=t.cornerIsExternal,u=c*(l?1:-1)+s,f=Math.asin(c/u)/uS,h=d?o:o+i*f,m=uo(r,n,u,h),x=uo(r,n,s,h),g=d?o-i*f:o,y=uo(r,n,u*Math.cos(f*uS),g);return{center:m,circleTangency:x,lineTangency:y,theta:f}},EZ=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,i=t.startAngle,l=t.endAngle,c=qLe(i,l),d=i+c,u=uo(r,n,o,i),f=uo(r,n,o,d),h="M ".concat(u.x,",").concat(u.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(c)>180),",").concat(+(i>d),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(s>0){var m=uo(r,n,s,i),x=uo(r,n,s,d);h+="L ".concat(x.x,",").concat(x.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(c)>180),",").concat(+(i<=d),`,
            `).concat(m.x,",").concat(m.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},zLe=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,i=t.cornerRadius,l=t.forceCornerRadius,c=t.cornerIsExternal,d=t.startAngle,u=t.endAngle,f=rc(u-d),h=M_({cx:r,cy:n,radius:o,angle:d,sign:f,cornerRadius:i,cornerIsExternal:c}),m=h.circleTangency,x=h.lineTangency,g=h.theta,y=M_({cx:r,cy:n,radius:o,angle:u,sign:-f,cornerRadius:i,cornerIsExternal:c}),v=y.circleTangency,b=y.lineTangency,w=y.theta,_=c?Math.abs(d-u):Math.abs(d-u)-g-w;if(_<0)return l?"M ".concat(x.x,",").concat(x.y,`
        a`).concat(i,",").concat(i,",0,0,1,").concat(i*2,`,0
        a`).concat(i,",").concat(i,",0,0,1,").concat(-i*2,`,0
      `):EZ({cx:r,cy:n,innerRadius:s,outerRadius:o,startAngle:d,endAngle:u});var j="M ".concat(x.x,",").concat(x.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(m.x,",").concat(m.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(_>180),",").concat(+(f<0),",").concat(v.x,",").concat(v.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(b.x,",").concat(b.y,`
  `);if(s>0){var S=M_({cx:r,cy:n,radius:s,angle:d,sign:f,isExternal:!0,cornerRadius:i,cornerIsExternal:c}),C=S.circleTangency,A=S.lineTangency,P=S.theta,F=M_({cx:r,cy:n,radius:s,angle:u,sign:-f,isExternal:!0,cornerRadius:i,cornerIsExternal:c}),O=F.circleTangency,I=F.lineTangency,T=F.theta,k=c?Math.abs(d-u):Math.abs(d-u)-P-T;if(k<0&&i===0)return"".concat(j,"L").concat(r,",").concat(n,"Z");j+="L".concat(I.x,",").concat(I.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(O.x,",").concat(O.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(k>180),",").concat(+(f>0),",").concat(C.x,",").concat(C.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(A.x,",").concat(A.y,"Z")}else j+="L".concat(r,",").concat(n,"Z");return j},ULe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},JM=function(t){var r=Zq(Zq({},ULe),t),n=r.cx,s=r.cy,o=r.innerRadius,i=r.outerRadius,l=r.cornerRadius,c=r.forceCornerRadius,d=r.cornerIsExternal,u=r.startAngle,f=r.endAngle,h=r.className;if(i<o||u===f)return null;var m=qa("recharts-sector",h),x=i-o,g=nc(l,x,0,!0),y;return g>0&&Math.abs(u-f)<360?y=zLe({cx:n,cy:s,innerRadius:o,outerRadius:i,cornerRadius:Math.min(g,x/2),forceCornerRadius:c,cornerIsExternal:d,startAngle:u,endAngle:f}):y=EZ({cx:n,cy:s,innerRadius:o,outerRadius:i,startAngle:u,endAngle:f}),Ee.createElement("path",pT({},ha(r,!0),{className:m,d:y,role:"img"}))};function i1(e){"@babel/helpers - typeof";return i1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i1(e)}function gT(){return gT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gT.apply(this,arguments)}function e7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function t7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e7(Object(r),!0).forEach(function(n){VLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VLe(e,t,r){return t=WLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WLe(e){var t=HLe(e,"string");return i1(t)=="symbol"?t:t+""}function HLe(e,t){if(i1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(i1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var r7={curveBasisClosed:GCe,curveBasisOpen:KCe,curveBasis:HCe,curveBumpX:OCe,curveBumpY:TCe,curveLinearClosed:XCe,curveLinear:C5,curveMonotoneX:YCe,curveMonotoneY:JCe,curveNatural:QCe,curveStep:ZCe,curveStepAfter:t5e,curveStepBefore:e5e},R_=function(t){return t.x===+t.x&&t.y===+t.y},Ky=function(t){return t.x},Xy=function(t){return t.y},GLe=function(t,r){if(Ea(t))return t;var n="curve".concat(N5(t));return(n==="curveMonotone"||n==="curveBump")&&r?r7["".concat(n).concat(r==="vertical"?"Y":"X")]:r7[n]||C5},KLe=function(t){var r=t.type,n=r===void 0?"linear":r,s=t.points,o=s===void 0?[]:s,i=t.baseLine,l=t.layout,c=t.connectNulls,d=c===void 0?!1:c,u=GLe(n,l),f=d?o.filter(function(g){return R_(g)}):o,h;if(Array.isArray(i)){var m=d?i.filter(function(g){return R_(g)}):i,x=f.map(function(g,y){return t7(t7({},g),{},{base:m[y]})});return l==="vertical"?h=C_().y(Xy).x1(Ky).x0(function(g){return g.base.x}):h=C_().x(Ky).y1(Xy).y0(function(g){return g.base.y}),h.defined(R_).curve(u),h(x)}return l==="vertical"&&vn(i)?h=C_().y(Xy).x1(Ky).x0(i):vn(i)?h=C_().x(Ky).y1(Xy).y0(i):h=NJ().x(Ky).y(Xy),h.defined(R_).curve(u),h(f)},Eg=function(t){var r=t.className,n=t.points,s=t.path,o=t.pathRef;if((!n||!n.length)&&!s)return null;var i=n&&n.length?KLe(t):s;return p.createElement("path",gT({},ha(t,!1),RN(t),{className:qa("recharts-curve",r),d:i,ref:o}))},kZ={exports:{}},XLe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",YLe=XLe,JLe=YLe;function IZ(){}function OZ(){}OZ.resetWarningCache=IZ;var QLe=function(){function e(n,s,o,i,l,c){if(c!==JLe){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:OZ,resetWarningCache:IZ};return r.PropTypes=r,r};kZ.exports=QLe();var ZLe=kZ.exports;const ba=xs(ZLe);var e$e=Object.getOwnPropertyNames,t$e=Object.getOwnPropertySymbols,r$e=Object.prototype.hasOwnProperty;function n7(e,t){return function(n,s,o){return e(n,s,o)&&t(n,s,o)}}function F_(e){return function(r,n,s){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,s);var o=s.cache,i=o.get(r),l=o.get(n);if(i&&l)return i===n&&l===r;o.set(r,n),o.set(n,r);var c=e(r,n,s);return o.delete(r),o.delete(n),c}}function a7(e){return e$e(e).concat(t$e(e))}var n$e=Object.hasOwn||function(e,t){return r$e.call(e,t)};function px(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var a$e="__v",s$e="__o",o$e="_owner",s7=Object.getOwnPropertyDescriptor,o7=Object.keys;function i$e(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function l$e(e,t){return px(e.getTime(),t.getTime())}function c$e(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function d$e(e,t){return e===t}function i7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.entries(),i,l,c=0;(i=o.next())&&!i.done;){for(var d=t.entries(),u=!1,f=0;(l=d.next())&&!l.done;){if(s[f]){f++;continue}var h=i.value,m=l.value;if(r.equals(h[0],m[0],c,f,e,t,r)&&r.equals(h[1],m[1],h[0],m[0],e,t,r)){u=s[f]=!0;break}f++}if(!u)return!1;c++}return!0}var u$e=px;function f$e(e,t,r){var n=o7(e),s=n.length;if(o7(t).length!==s)return!1;for(;s-- >0;)if(!TZ(e,t,r,n[s]))return!1;return!0}function Yy(e,t,r){var n=a7(e),s=n.length;if(a7(t).length!==s)return!1;for(var o,i,l;s-- >0;)if(o=n[s],!TZ(e,t,r,o)||(i=s7(e,o),l=s7(t,o),(i||l)&&(!i||!l||i.configurable!==l.configurable||i.enumerable!==l.enumerable||i.writable!==l.writable)))return!1;return!0}function m$e(e,t){return px(e.valueOf(),t.valueOf())}function h$e(e,t){return e.source===t.source&&e.flags===t.flags}function l7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.values(),i,l;(i=o.next())&&!i.done;){for(var c=t.values(),d=!1,u=0;(l=c.next())&&!l.done;){if(!s[u]&&r.equals(i.value,l.value,i.value,l.value,e,t,r)){d=s[u]=!0;break}u++}if(!d)return!1}return!0}function p$e(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function g$e(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function TZ(e,t,r,n){return(n===o$e||n===s$e||n===a$e)&&(e.$$typeof||t.$$typeof)?!0:n$e(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var x$e="[object Arguments]",v$e="[object Boolean]",y$e="[object Date]",b$e="[object Error]",w$e="[object Map]",_$e="[object Number]",j$e="[object Object]",N$e="[object RegExp]",S$e="[object Set]",C$e="[object String]",A$e="[object URL]",P$e=Array.isArray,c7=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,d7=Object.assign,E$e=Object.prototype.toString.call.bind(Object.prototype.toString);function k$e(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,s=e.areFunctionsEqual,o=e.areMapsEqual,i=e.areNumbersEqual,l=e.areObjectsEqual,c=e.arePrimitiveWrappersEqual,d=e.areRegExpsEqual,u=e.areSetsEqual,f=e.areTypedArraysEqual,h=e.areUrlsEqual;return function(x,g,y){if(x===g)return!0;if(x==null||g==null)return!1;var v=typeof x;if(v!==typeof g)return!1;if(v!=="object")return v==="number"?i(x,g,y):v==="function"?s(x,g,y):!1;var b=x.constructor;if(b!==g.constructor)return!1;if(b===Object)return l(x,g,y);if(P$e(x))return t(x,g,y);if(c7!=null&&c7(x))return f(x,g,y);if(b===Date)return r(x,g,y);if(b===RegExp)return d(x,g,y);if(b===Map)return o(x,g,y);if(b===Set)return u(x,g,y);var w=E$e(x);return w===y$e?r(x,g,y):w===N$e?d(x,g,y):w===w$e?o(x,g,y):w===S$e?u(x,g,y):w===j$e?typeof x.then!="function"&&typeof g.then!="function"&&l(x,g,y):w===A$e?h(x,g,y):w===b$e?n(x,g,y):w===x$e?l(x,g,y):w===v$e||w===_$e||w===C$e?c(x,g,y):!1}}function I$e(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,s={areArraysEqual:n?Yy:i$e,areDatesEqual:l$e,areErrorsEqual:c$e,areFunctionsEqual:d$e,areMapsEqual:n?n7(i7,Yy):i7,areNumbersEqual:u$e,areObjectsEqual:n?Yy:f$e,arePrimitiveWrappersEqual:m$e,areRegExpsEqual:h$e,areSetsEqual:n?n7(l7,Yy):l7,areTypedArraysEqual:n?Yy:p$e,areUrlsEqual:g$e};if(r&&(s=d7({},s,r(s))),t){var o=F_(s.areArraysEqual),i=F_(s.areMapsEqual),l=F_(s.areObjectsEqual),c=F_(s.areSetsEqual);s=d7({},s,{areArraysEqual:o,areMapsEqual:i,areObjectsEqual:l,areSetsEqual:c})}return s}function O$e(e){return function(t,r,n,s,o,i,l){return e(t,r,l)}}function T$e(e){var t=e.circular,r=e.comparator,n=e.createState,s=e.equals,o=e.strict;if(n)return function(c,d){var u=n(),f=u.cache,h=f===void 0?t?new WeakMap:void 0:f,m=u.meta;return r(c,d,{cache:h,equals:s,meta:m,strict:o})};if(t)return function(c,d){return r(c,d,{cache:new WeakMap,equals:s,meta:void 0,strict:o})};var i={cache:void 0,equals:s,meta:void 0,strict:o};return function(c,d){return r(c,d,i)}}var D$e=Cp();Cp({strict:!0});Cp({circular:!0});Cp({circular:!0,strict:!0});Cp({createInternalComparator:function(){return px}});Cp({strict:!0,createInternalComparator:function(){return px}});Cp({circular:!0,createInternalComparator:function(){return px}});Cp({circular:!0,createInternalComparator:function(){return px},strict:!0});function Cp(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,s=e.createState,o=e.strict,i=o===void 0?!1:o,l=I$e(e),c=k$e(l),d=n?n(c):O$e(c);return T$e({circular:r,comparator:c,createState:s,equals:d,strict:i})}function M$e(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function u7(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function s(o){r<0&&(r=o),o-r>t?(e(o),r=-1):M$e(s)};requestAnimationFrame(n)}function xT(e){"@babel/helpers - typeof";return xT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xT(e)}function R$e(e){return B$e(e)||$$e(e)||L$e(e)||F$e()}function F$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function L$e(e,t){if(e){if(typeof e=="string")return f7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f7(e,t)}}function f7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $$e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function B$e(e){if(Array.isArray(e))return e}function q$e(){var e={},t=function(){return null},r=!1,n=function s(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var i=o,l=R$e(i),c=l[0],d=l.slice(1);if(typeof c=="number"){u7(s.bind(null,d),c);return}s(c),u7(s.bind(null,d));return}xT(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function l1(e){"@babel/helpers - typeof";return l1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l1(e)}function m7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function h7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m7(Object(r),!0).forEach(function(n){DZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DZ(e,t,r){return t=z$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z$e(e){var t=U$e(e,"string");return l1(t)==="symbol"?t:String(t)}function U$e(e,t){if(l1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(l1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var V$e=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,s){return n.filter(function(o){return s.includes(o)})})},W$e=function(t){return t},H$e=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Hb=function(t,r){return Object.keys(r).reduce(function(n,s){return h7(h7({},n),{},DZ({},s,t(s,r[s])))},{})},p7=function(t,r,n){return t.map(function(s){return"".concat(H$e(s)," ").concat(r,"ms ").concat(n)}).join(",")};function G$e(e,t){return Y$e(e)||X$e(e,t)||MZ(e,t)||K$e()}function K$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X$e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function Y$e(e){if(Array.isArray(e))return e}function J$e(e){return e6e(e)||Z$e(e)||MZ(e)||Q$e()}function Q$e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MZ(e,t){if(e){if(typeof e=="string")return vT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vT(e,t)}}function Z$e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function e6e(e){if(Array.isArray(e))return vT(e)}function vT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var mS=1e-4,RZ=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},FZ=function(t,r){return t.map(function(n,s){return n*Math.pow(r,s)}).reduce(function(n,s){return n+s})},g7=function(t,r){return function(n){var s=RZ(t,r);return FZ(s,n)}},t6e=function(t,r){return function(n){var s=RZ(t,r),o=[].concat(J$e(s.map(function(i,l){return i*l}).slice(1)),[0]);return FZ(o,n)}},x7=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0],o=r[1],i=r[2],l=r[3];if(r.length===1)switch(r[0]){case"linear":s=0,o=0,i=1,l=1;break;case"ease":s=.25,o=.1,i=.25,l=1;break;case"ease-in":s=.42,o=0,i=1,l=1;break;case"ease-out":s=.42,o=0,i=.58,l=1;break;case"ease-in-out":s=0,o=0,i=.58,l=1;break;default:{var c=r[0].split("(");if(c[0]==="cubic-bezier"&&c[1].split(")")[0].split(",").length===4){var d=c[1].split(")")[0].split(",").map(function(y){return parseFloat(y)}),u=G$e(d,4);s=u[0],o=u[1],i=u[2],l=u[3]}}}var f=g7(s,i),h=g7(o,l),m=t6e(s,i),x=function(v){return v>1?1:v<0?0:v},g=function(v){for(var b=v>1?1:v,w=b,_=0;_<8;++_){var j=f(w)-b,S=m(w);if(Math.abs(j-b)<mS||S<mS)return h(w);w=x(w-j/S)}return h(w)};return g.isStepper=!1,g},r6e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,s=t.damping,o=s===void 0?8:s,i=t.dt,l=i===void 0?17:i,c=function(u,f,h){var m=-(u-f)*n,x=h*o,g=h+(m-x)*l/1e3,y=h*l/1e3+u;return Math.abs(y-f)<mS&&Math.abs(g)<mS?[f,0]:[y,g]};return c.isStepper=!0,c.dt=l,c},n6e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0];if(typeof s=="string")switch(s){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return x7(s);case"spring":return r6e();default:if(s.split("(")[0]==="cubic-bezier")return x7(s)}return typeof s=="function"?s:null};function c1(e){"@babel/helpers - typeof";return c1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c1(e)}function v7(e){return o6e(e)||s6e(e)||LZ(e)||a6e()}function a6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function o6e(e){if(Array.isArray(e))return bT(e)}function y7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function il(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y7(Object(r),!0).forEach(function(n){yT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yT(e,t,r){return t=i6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i6e(e){var t=l6e(e,"string");return c1(t)==="symbol"?t:String(t)}function l6e(e,t){if(c1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(c1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function c6e(e,t){return f6e(e)||u6e(e,t)||LZ(e,t)||d6e()}function d6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LZ(e,t){if(e){if(typeof e=="string")return bT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bT(e,t)}}function bT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function f6e(e){if(Array.isArray(e))return e}var hS=function(t,r,n){return t+(r-t)*n},wT=function(t){var r=t.from,n=t.to;return r!==n},m6e=function e(t,r,n){var s=Hb(function(o,i){if(wT(i)){var l=t(i.from,i.to,i.velocity),c=c6e(l,2),d=c[0],u=c[1];return il(il({},i),{},{from:d,velocity:u})}return i},r);return n<1?Hb(function(o,i){return wT(i)?il(il({},i),{},{velocity:hS(i.velocity,s[o].velocity,n),from:hS(i.from,s[o].from,n)}):i},r):e(t,s,n-1)};const h6e=function(e,t,r,n,s){var o=V$e(e,t),i=o.reduce(function(y,v){return il(il({},y),{},yT({},v,[e[v],t[v]]))},{}),l=o.reduce(function(y,v){return il(il({},y),{},yT({},v,{from:e[v],velocity:0,to:t[v]}))},{}),c=-1,d,u,f=function(){return null},h=function(){return Hb(function(v,b){return b.from},l)},m=function(){return!Object.values(l).filter(wT).length},x=function(v){d||(d=v);var b=v-d,w=b/r.dt;l=m6e(r,l,w),s(il(il(il({},e),t),h())),d=v,m()||(c=requestAnimationFrame(f))},g=function(v){u||(u=v);var b=(v-u)/n,w=Hb(function(j,S){return hS.apply(void 0,v7(S).concat([r(b)]))},i);if(s(il(il(il({},e),t),w)),b<1)c=requestAnimationFrame(f);else{var _=Hb(function(j,S){return hS.apply(void 0,v7(S).concat([r(1)]))},i);s(il(il(il({},e),t),_))}};return f=r.isStepper?x:g,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(c)}}};function g0(e){"@babel/helpers - typeof";return g0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g0(e)}var p6e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function g6e(e,t){if(e==null)return{};var r=x6e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function x6e(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function PE(e){return w6e(e)||b6e(e)||y6e(e)||v6e()}function v6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y6e(e,t){if(e){if(typeof e=="string")return _T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _T(e,t)}}function b6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function w6e(e){if(Array.isArray(e))return _T(e)}function _T(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function yu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b7(Object(r),!0).forEach(function(n){xb(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xb(e,t,r){return t=$Z(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$Z(n.key),n)}}function j6e(e,t,r){return t&&w7(e.prototype,t),r&&w7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function $Z(e){var t=N6e(e,"string");return g0(t)==="symbol"?t:String(t)}function N6e(e,t){if(g0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(g0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function S6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jT(e,t)}function jT(e,t){return jT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},jT(e,t)}function C6e(e){var t=A6e();return function(){var n=pS(e),s;if(t){var o=pS(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return NT(this,s)}}function NT(e,t){if(t&&(g0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ST(e)}function ST(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A6e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function pS(e){return pS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pS(e)}var q5=function(e){S6e(r,e);var t=C6e(r);function r(n,s){var o;_6e(this,r),o=t.call(this,n,s);var i=o.props,l=i.isActive,c=i.attributeName,d=i.from,u=i.to,f=i.steps,h=i.children,m=i.duration;if(o.handleStyleChange=o.handleStyleChange.bind(ST(o)),o.changeStyle=o.changeStyle.bind(ST(o)),!l||m<=0)return o.state={style:{}},typeof h=="function"&&(o.state={style:u}),NT(o);if(f&&f.length)o.state={style:f[0].style};else if(d){if(typeof h=="function")return o.state={style:d},NT(o);o.state={style:c?xb({},c,d):d}}else o.state={style:{}};return o}return j6e(r,[{key:"componentDidMount",value:function(){var s=this.props,o=s.isActive,i=s.canBegin;this.mounted=!0,!(!o||!i)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(s){var o=this.props,i=o.isActive,l=o.canBegin,c=o.attributeName,d=o.shouldReAnimate,u=o.to,f=o.from,h=this.state.style;if(l){if(!i){var m={style:c?xb({},c,u):u};this.state&&h&&(c&&h[c]!==u||!c&&h!==u)&&this.setState(m);return}if(!(D$e(s.to,u)&&s.canBegin&&s.isActive)){var x=!s.canBegin||!s.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var g=x||d?f:s.to;if(this.state&&h){var y={style:c?xb({},c,g):g};(c&&h[c]!==g||!c&&h!==g)&&this.setState(y)}this.runAnimation(yu(yu({},this.props),{},{from:g,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var s=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),s&&s()}},{key:"handleStyleChange",value:function(s){this.changeStyle(s)}},{key:"changeStyle",value:function(s){this.mounted&&this.setState({style:s})}},{key:"runJSAnimation",value:function(s){var o=this,i=s.from,l=s.to,c=s.duration,d=s.easing,u=s.begin,f=s.onAnimationEnd,h=s.onAnimationStart,m=h6e(i,l,n6e(d),c,this.changeStyle),x=function(){o.stopJSAnimation=m()};this.manager.start([h,u,x,c,f])}},{key:"runStepAnimation",value:function(s){var o=this,i=s.steps,l=s.begin,c=s.onAnimationStart,d=i[0],u=d.style,f=d.duration,h=f===void 0?0:f,m=function(g,y,v){if(v===0)return g;var b=y.duration,w=y.easing,_=w===void 0?"ease":w,j=y.style,S=y.properties,C=y.onAnimationEnd,A=v>0?i[v-1]:y,P=S||Object.keys(j);if(typeof _=="function"||_==="spring")return[].concat(PE(g),[o.runJSAnimation.bind(o,{from:A.style,to:j,duration:b,easing:_}),b]);var F=p7(P,b,_),O=yu(yu(yu({},A.style),j),{},{transition:F});return[].concat(PE(g),[O,b,C]).filter(W$e)};return this.manager.start([c].concat(PE(i.reduce(m,[u,Math.max(h,l)])),[s.onAnimationEnd]))}},{key:"runAnimation",value:function(s){this.manager||(this.manager=q$e());var o=s.begin,i=s.duration,l=s.attributeName,c=s.to,d=s.easing,u=s.onAnimationStart,f=s.onAnimationEnd,h=s.steps,m=s.children,x=this.manager;if(this.unSubscribe=x.subscribe(this.handleStyleChange),typeof d=="function"||typeof m=="function"||d==="spring"){this.runJSAnimation(s);return}if(h.length>1){this.runStepAnimation(s);return}var g=l?xb({},l,c):c,y=p7(Object.keys(g),i,d);x.start([u,o,yu(yu({},g),{},{transition:y}),i,f])}},{key:"render",value:function(){var s=this.props,o=s.children;s.begin;var i=s.duration;s.attributeName,s.easing;var l=s.isActive;s.steps,s.from,s.to,s.canBegin,s.onAnimationEnd,s.shouldReAnimate,s.onAnimationReStart;var c=g6e(s,p6e),d=p.Children.count(o),u=this.state.style;if(typeof o=="function")return o(u);if(!l||d===0||i<=0)return o;var f=function(m){var x=m.props,g=x.style,y=g===void 0?{}:g,v=x.className,b=p.cloneElement(m,yu(yu({},c),{},{style:yu(yu({},y),u),className:v}));return b};return d===1?f(p.Children.only(o)):Ee.createElement("div",null,p.Children.map(o,function(h){return f(h)}))}}]),r}(p.PureComponent);q5.displayName="Animate";q5.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};q5.propTypes={from:ba.oneOfType([ba.object,ba.string]),to:ba.oneOfType([ba.object,ba.string]),attributeName:ba.string,duration:ba.number,begin:ba.number,easing:ba.oneOfType([ba.string,ba.func]),steps:ba.arrayOf(ba.shape({duration:ba.number.isRequired,style:ba.object.isRequired,easing:ba.oneOfType([ba.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),ba.func]),properties:ba.arrayOf("string"),onAnimationEnd:ba.func})),children:ba.oneOfType([ba.node,ba.func]),isActive:ba.bool,canBegin:ba.bool,onAnimationEnd:ba.func,shouldReAnimate:ba.bool,onAnimationStart:ba.func,onAnimationReStart:ba.func};const up=q5;function Sa(){return Sa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sa.apply(null,arguments)}function gS(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function BZ(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,jO(e,t)}function d1(e){"@babel/helpers - typeof";return d1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d1(e)}function xS(){return xS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xS.apply(this,arguments)}function P6e(e,t){return O6e(e)||I6e(e,t)||k6e(e,t)||E6e()}function E6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k6e(e,t){if(e){if(typeof e=="string")return _7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _7(e,t)}}function _7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function O6e(e){if(Array.isArray(e))return e}function j7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function N7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j7(Object(r),!0).forEach(function(n){T6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function T6e(e,t,r){return t=D6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D6e(e){var t=M6e(e,"string");return d1(t)=="symbol"?t:t+""}function M6e(e,t){if(d1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(d1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var S7=function(t,r,n,s,o){var i=Math.min(Math.abs(n)/2,Math.abs(s)/2),l=s>=0?1:-1,c=n>=0?1:-1,d=s>=0&&n>=0||s<0&&n<0?1:0,u;if(i>0&&o instanceof Array){for(var f=[0,0,0,0],h=0,m=4;h<m;h++)f[h]=o[h]>i?i:o[h];u="M".concat(t,",").concat(r+l*f[0]),f[0]>0&&(u+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(d,",").concat(t+c*f[0],",").concat(r)),u+="L ".concat(t+n-c*f[1],",").concat(r),f[1]>0&&(u+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(d,`,
        `).concat(t+n,",").concat(r+l*f[1])),u+="L ".concat(t+n,",").concat(r+s-l*f[2]),f[2]>0&&(u+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(d,`,
        `).concat(t+n-c*f[2],",").concat(r+s)),u+="L ".concat(t+c*f[3],",").concat(r+s),f[3]>0&&(u+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(d,`,
        `).concat(t,",").concat(r+s-l*f[3])),u+="Z"}else if(i>0&&o===+o&&o>0){var x=Math.min(i,o);u="M ".concat(t,",").concat(r+l*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+c*x,",").concat(r,`
            L `).concat(t+n-c*x,",").concat(r,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+n,",").concat(r+l*x,`
            L `).concat(t+n,",").concat(r+s-l*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+n-c*x,",").concat(r+s,`
            L `).concat(t+c*x,",").concat(r+s,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t,",").concat(r+s-l*x," Z")}else u="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(s," h ").concat(-n," Z");return u},R6e=function(t,r){if(!t||!r)return!1;var n=t.x,s=t.y,o=r.x,i=r.y,l=r.width,c=r.height;if(Math.abs(l)>0&&Math.abs(c)>0){var d=Math.min(o,o+l),u=Math.max(o,o+l),f=Math.min(i,i+c),h=Math.max(i,i+c);return n>=d&&n<=u&&s>=f&&s<=h}return!1},F6e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},QM=function(t){var r=N7(N7({},F6e),t),n=p.useRef(),s=p.useState(-1),o=P6e(s,2),i=o[0],l=o[1];p.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var _=n.current.getTotalLength();_&&l(_)}catch{}},[]);var c=r.x,d=r.y,u=r.width,f=r.height,h=r.radius,m=r.className,x=r.animationEasing,g=r.animationDuration,y=r.animationBegin,v=r.isAnimationActive,b=r.isUpdateAnimationActive;if(c!==+c||d!==+d||u!==+u||f!==+f||u===0||f===0)return null;var w=qa("recharts-rectangle",m);return b?Ee.createElement(up,{canBegin:i>0,from:{width:u,height:f,x:c,y:d},to:{width:u,height:f,x:c,y:d},duration:g,animationEasing:x,isActive:b},function(_){var j=_.width,S=_.height,C=_.x,A=_.y;return Ee.createElement(up,{canBegin:i>0,from:"0px ".concat(i===-1?1:i,"px"),to:"".concat(i,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:g,isActive:v,easing:x},Ee.createElement("path",xS({},ha(r,!0),{className:w,d:S7(C,A,j,S,h),ref:n})))}):Ee.createElement("path",xS({},ha(r,!0),{className:w,d:S7(c,d,u,f,h)}))},L6e=["points","className","baseLinePoints","connectNulls"];function bv(){return bv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bv.apply(this,arguments)}function $6e(e,t){if(e==null)return{};var r=B6e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function B6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function C7(e){return V6e(e)||U6e(e)||z6e(e)||q6e()}function q6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z6e(e,t){if(e){if(typeof e=="string")return CT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CT(e,t)}}function U6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function V6e(e){if(Array.isArray(e))return CT(e)}function CT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A7=function(t){return t&&t.x===+t.x&&t.y===+t.y},W6e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){A7(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),A7(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},Gb=function(t,r){var n=W6e(t);r&&(n=[n.reduce(function(o,i){return[].concat(C7(o),C7(i))},[])]);var s=n.map(function(o){return o.reduce(function(i,l,c){return"".concat(i).concat(c===0?"M":"L").concat(l.x,",").concat(l.y)},"")}).join("");return n.length===1?"".concat(s,"Z"):s},H6e=function(t,r,n){var s=Gb(t,n);return"".concat(s.slice(-1)==="Z"?s.slice(0,-1):s,"L").concat(Gb(r.reverse(),n).slice(1))},G6e=function(t){var r=t.points,n=t.className,s=t.baseLinePoints,o=t.connectNulls,i=$6e(t,L6e);if(!r||!r.length)return null;var l=qa("recharts-polygon",n);if(s&&s.length){var c=i.stroke&&i.stroke!=="none",d=H6e(r,s,o);return Ee.createElement("g",{className:l},Ee.createElement("path",bv({},ha(i,!0),{fill:d.slice(-1)==="Z"?i.fill:"none",stroke:"none",d})),c?Ee.createElement("path",bv({},ha(i,!0),{fill:"none",d:Gb(r,o)})):null,c?Ee.createElement("path",bv({},ha(i,!0),{fill:"none",d:Gb(s,o)})):null)}var u=Gb(r,o);return Ee.createElement("path",bv({},ha(i,!0),{fill:u.slice(-1)==="Z"?i.fill:"none",className:l,d:u}))};function AT(){return AT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AT.apply(this,arguments)}var c2=function(t){var r=t.cx,n=t.cy,s=t.r,o=t.className,i=qa("recharts-dot",o);return r===+r&&n===+n&&s===+s?p.createElement("circle",AT({},ha(t,!1),RN(t),{className:i,cx:r,cy:n,r:s})):null};function u1(e){"@babel/helpers - typeof";return u1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u1(e)}var K6e=["x","y","top","left","width","height","className"];function PT(){return PT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PT.apply(this,arguments)}function P7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function X6e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P7(Object(r),!0).forEach(function(n){Y6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y6e(e,t,r){return t=J6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J6e(e){var t=Q6e(e,"string");return u1(t)=="symbol"?t:t+""}function Q6e(e,t){if(u1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(u1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Z6e(e,t){if(e==null)return{};var r=e8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function e8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var t8e=function(t,r,n,s,o,i){return"M".concat(t,",").concat(o,"v").concat(s,"M").concat(i,",").concat(r,"h").concat(n)},r8e=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,i=t.top,l=i===void 0?0:i,c=t.left,d=c===void 0?0:c,u=t.width,f=u===void 0?0:u,h=t.height,m=h===void 0?0:h,x=t.className,g=Z6e(t,K6e),y=X6e({x:n,y:o,top:l,left:d,width:f,height:m},g);return!vn(n)||!vn(o)||!vn(f)||!vn(m)||!vn(l)||!vn(d)?null:Ee.createElement("path",PT({},ha(y,!0),{className:qa("recharts-cross",x),d:t8e(n,o,f,m,l,d)}))},n8e=F5,a8e=QQ,s8e=Bf;function o8e(e,t){return e&&e.length?n8e(e,s8e(t),a8e):void 0}var i8e=o8e;const l8e=xs(i8e);var c8e=F5,d8e=Bf,u8e=ZQ;function f8e(e,t){return e&&e.length?c8e(e,d8e(t),u8e):void 0}var m8e=f8e;const h8e=xs(m8e);var p8e=["cx","cy","angle","ticks","axisLine"],g8e=["ticks","tick","angle","tickFormatter","stroke"];function x0(e){"@babel/helpers - typeof";return x0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x0(e)}function Kb(){return Kb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Kb.apply(this,arguments)}function E7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function $p(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E7(Object(r),!0).forEach(function(n){z5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k7(e,t){if(e==null)return{};var r=x8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function x8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function v8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zZ(n.key),n)}}function y8e(e,t,r){return t&&I7(e.prototype,t),r&&I7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function b8e(e,t,r){return t=vS(t),w8e(e,qZ()?Reflect.construct(t,r||[],vS(e).constructor):t.apply(e,r))}function w8e(e,t){if(t&&(x0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _8e(e)}function _8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qZ=function(){return!!e})()}function vS(e){return vS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},vS(e)}function j8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ET(e,t)}function ET(e,t){return ET=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},ET(e,t)}function z5(e,t,r){return t=zZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zZ(e){var t=N8e(e,"string");return x0(t)=="symbol"?t:t+""}function N8e(e,t){if(x0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(x0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var U5=function(e){function t(){return v8e(this,t),b8e(this,t,arguments)}return j8e(t,e),y8e(t,[{key:"getTickValueCoord",value:function(n){var s=n.coordinate,o=this.props,i=o.angle,l=o.cx,c=o.cy;return uo(l,c,s,i)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,s;switch(n){case"left":s="end";break;case"right":s="start";break;default:s="middle";break}return s}},{key:"getViewBox",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.angle,l=n.ticks,c=l8e(l,function(u){return u.coordinate||0}),d=h8e(l,function(u){return u.coordinate||0});return{cx:s,cy:o,startAngle:i,endAngle:i,innerRadius:d.coordinate||0,outerRadius:c.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.angle,l=n.ticks,c=n.axisLine,d=k7(n,p8e),u=l.reduce(function(x,g){return[Math.min(x[0],g.coordinate),Math.max(x[1],g.coordinate)]},[1/0,-1/0]),f=uo(s,o,u[0],i),h=uo(s,o,u[1],i),m=$p($p($p({},ha(d,!1)),{},{fill:"none"},ha(c,!1)),{},{x1:f.x,y1:f.y,x2:h.x,y2:h.y});return Ee.createElement("line",Kb({className:"recharts-polar-radius-axis-line"},m))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,i=s.tick,l=s.angle,c=s.tickFormatter,d=s.stroke,u=k7(s,g8e),f=this.getTickTextAnchor(),h=ha(u,!1),m=ha(i,!1),x=o.map(function(g,y){var v=n.getTickValueCoord(g),b=$p($p($p($p({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(v.x,", ").concat(v.y,")")},h),{},{stroke:"none",fill:d},m),{},{index:y},v),{},{payload:g});return Ee.createElement(ns,Kb({className:qa("recharts-polar-radius-axis-tick",AZ(i)),key:"tick-".concat(g.coordinate)},Gg(n.props,g,y)),t.renderTickItem(i,b,c?c(g.value,y):g.value))});return Ee.createElement(ns,{className:"recharts-polar-radius-axis-ticks"},x)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.axisLine,i=n.tick;return!s||!s.length?null:Ee.createElement(ns,{className:qa("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),i&&this.renderTicks(),Wi.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,s,o){var i;return Ee.isValidElement(n)?i=Ee.cloneElement(n,s):Ea(n)?i=n(s):i=Ee.createElement(Kg,Kb({},s,{className:"recharts-polar-radius-axis-tick-value"}),o),i}}])}(p.PureComponent);z5(U5,"displayName","PolarRadiusAxis");z5(U5,"axisType","radiusAxis");z5(U5,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function v0(e){"@babel/helpers - typeof";return v0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v0(e)}function ag(){return ag=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ag.apply(this,arguments)}function O7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Bp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O7(Object(r),!0).forEach(function(n){V5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function S8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VZ(n.key),n)}}function C8e(e,t,r){return t&&T7(e.prototype,t),r&&T7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function A8e(e,t,r){return t=yS(t),P8e(e,UZ()?Reflect.construct(t,r||[],yS(e).constructor):t.apply(e,r))}function P8e(e,t){if(t&&(v0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return E8e(e)}function E8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UZ=function(){return!!e})()}function yS(e){return yS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},yS(e)}function k8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kT(e,t)}function kT(e,t){return kT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},kT(e,t)}function V5(e,t,r){return t=VZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VZ(e){var t=I8e(e,"string");return v0(t)=="symbol"?t:t+""}function I8e(e,t){if(v0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(v0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var O8e=Math.PI/180,D7=1e-5,W5=function(e){function t(){return S8e(this,t),A8e(this,t,arguments)}return k8e(t,e),C8e(t,[{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.cx,i=s.cy,l=s.radius,c=s.orientation,d=s.tickSize,u=d||8,f=uo(o,i,l,n.coordinate),h=uo(o,i,l+(c==="inner"?-1:1)*u,n.coordinate);return{x1:f.x,y1:f.y,x2:h.x,y2:h.y}}},{key:"getTickTextAnchor",value:function(n){var s=this.props.orientation,o=Math.cos(-n.coordinate*O8e),i;return o>D7?i=s==="outer"?"start":"end":o<-D7?i=s==="outer"?"end":"start":i="middle",i}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.radius,l=n.axisLine,c=n.axisLineType,d=Bp(Bp({},ha(this.props,!1)),{},{fill:"none"},ha(l,!1));if(c==="circle")return Ee.createElement(c2,ag({className:"recharts-polar-angle-axis-line"},d,{cx:s,cy:o,r:i}));var u=this.props.ticks,f=u.map(function(h){return uo(s,o,i,h.coordinate)});return Ee.createElement(G6e,ag({className:"recharts-polar-angle-axis-line"},d,{points:f}))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,i=s.tick,l=s.tickLine,c=s.tickFormatter,d=s.stroke,u=ha(this.props,!1),f=ha(i,!1),h=Bp(Bp({},u),{},{fill:"none"},ha(l,!1)),m=o.map(function(x,g){var y=n.getTickLineCoord(x),v=n.getTickTextAnchor(x),b=Bp(Bp(Bp({textAnchor:v},u),{},{stroke:"none",fill:d},f),{},{index:g,payload:x,x:y.x2,y:y.y2});return Ee.createElement(ns,ag({className:qa("recharts-polar-angle-axis-tick",AZ(i)),key:"tick-".concat(x.coordinate)},Gg(n.props,x,g)),l&&Ee.createElement("line",ag({className:"recharts-polar-angle-axis-tick-line"},h,y)),i&&t.renderTickItem(i,b,c?c(x.value,g):x.value))});return Ee.createElement(ns,{className:"recharts-polar-angle-axis-ticks"},m)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.radius,i=n.axisLine;return o<=0||!s||!s.length?null:Ee.createElement(ns,{className:qa("recharts-polar-angle-axis",this.props.className)},i&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,s,o){var i;return Ee.isValidElement(n)?i=Ee.cloneElement(n,s):Ea(n)?i=n(s):i=Ee.createElement(Kg,ag({},s,{className:"recharts-polar-angle-axis-tick-value"}),o),i}}])}(p.PureComponent);V5(W5,"displayName","PolarAngleAxis");V5(W5,"axisType","angleAxis");V5(W5,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var T8e=KJ,D8e=T8e(Object.getPrototypeOf,Object),M8e=D8e,R8e=$m,F8e=M8e,L8e=Bm,$8e="[object Object]",B8e=Function.prototype,q8e=Object.prototype,WZ=B8e.toString,z8e=q8e.hasOwnProperty,U8e=WZ.call(Object);function V8e(e){if(!L8e(e)||R8e(e)!=$8e)return!1;var t=F8e(e);if(t===null)return!0;var r=z8e.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&WZ.call(r)==U8e}var W8e=V8e;const H8e=xs(W8e);var G8e=$m,K8e=Bm,X8e="[object Boolean]";function Y8e(e){return e===!0||e===!1||K8e(e)&&G8e(e)==X8e}var J8e=Y8e;const Q8e=xs(J8e);function f1(e){"@babel/helpers - typeof";return f1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f1(e)}function bS(){return bS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bS.apply(this,arguments)}function Z8e(e,t){return nBe(e)||rBe(e,t)||tBe(e,t)||eBe()}function eBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tBe(e,t){if(e){if(typeof e=="string")return M7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M7(e,t)}}function M7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rBe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function nBe(e){if(Array.isArray(e))return e}function R7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function F7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?R7(Object(r),!0).forEach(function(n){aBe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aBe(e,t,r){return t=sBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sBe(e){var t=oBe(e,"string");return f1(t)=="symbol"?t:t+""}function oBe(e,t){if(f1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(f1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var L7=function(t,r,n,s,o){var i=n-s,l;return l="M ".concat(t,",").concat(r),l+="L ".concat(t+n,",").concat(r),l+="L ".concat(t+n-i/2,",").concat(r+o),l+="L ".concat(t+n-i/2-s,",").concat(r+o),l+="L ".concat(t,",").concat(r," Z"),l},iBe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},lBe=function(t){var r=F7(F7({},iBe),t),n=p.useRef(),s=p.useState(-1),o=Z8e(s,2),i=o[0],l=o[1];p.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var w=n.current.getTotalLength();w&&l(w)}catch{}},[]);var c=r.x,d=r.y,u=r.upperWidth,f=r.lowerWidth,h=r.height,m=r.className,x=r.animationEasing,g=r.animationDuration,y=r.animationBegin,v=r.isUpdateAnimationActive;if(c!==+c||d!==+d||u!==+u||f!==+f||h!==+h||u===0&&f===0||h===0)return null;var b=qa("recharts-trapezoid",m);return v?Ee.createElement(up,{canBegin:i>0,from:{upperWidth:0,lowerWidth:0,height:h,x:c,y:d},to:{upperWidth:u,lowerWidth:f,height:h,x:c,y:d},duration:g,animationEasing:x,isActive:v},function(w){var _=w.upperWidth,j=w.lowerWidth,S=w.height,C=w.x,A=w.y;return Ee.createElement(up,{canBegin:i>0,from:"0px ".concat(i===-1?1:i,"px"),to:"".concat(i,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:g,easing:x},Ee.createElement("path",bS({},ha(r,!0),{className:b,d:L7(C,A,_,j,S),ref:n})))}):Ee.createElement("g",null,Ee.createElement("path",bS({},ha(r,!0),{className:b,d:L7(c,d,u,f,h)})))},cBe=["option","shapeType","propTransformer","activeClassName","isActive"];function m1(e){"@babel/helpers - typeof";return m1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m1(e)}function dBe(e,t){if(e==null)return{};var r=uBe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function uBe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function $7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function wS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$7(Object(r),!0).forEach(function(n){fBe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fBe(e,t,r){return t=mBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mBe(e){var t=hBe(e,"string");return m1(t)=="symbol"?t:t+""}function hBe(e,t){if(m1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(m1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pBe(e,t){return wS(wS({},t),e)}function gBe(e,t){return e==="symbols"}function B7(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ee.createElement(QM,r);case"trapezoid":return Ee.createElement(lBe,r);case"sector":return Ee.createElement(JM,r);case"symbols":if(gBe(t))return Ee.createElement(gM,r);break;default:return null}}function xBe(e){return p.isValidElement(e)?e.props:e}function HZ(e){var t=e.option,r=e.shapeType,n=e.propTransformer,s=n===void 0?pBe:n,o=e.activeClassName,i=o===void 0?"recharts-active-shape":o,l=e.isActive,c=dBe(e,cBe),d;if(p.isValidElement(t))d=p.cloneElement(t,wS(wS({},c),xBe(t)));else if(Ea(t))d=t(c);else if(H8e(t)&&!Q8e(t)){var u=s(t,c);d=Ee.createElement(B7,{shapeType:r,elementProps:u})}else{var f=c;d=Ee.createElement(B7,{shapeType:r,elementProps:f})}return l?Ee.createElement(ns,{className:i},d):d}function H5(e,t){return t!=null&&"trapezoids"in e.props}function G5(e,t){return t!=null&&"sectors"in e.props}function h1(e,t){return t!=null&&"points"in e.props}function vBe(e,t){var r,n,s=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return s&&o}function yBe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function bBe(e,t){var r=e.x===t.x,n=e.y===t.y,s=e.z===t.z;return r&&n&&s}function wBe(e,t){var r;return H5(e,t)?r=vBe:G5(e,t)?r=yBe:h1(e,t)&&(r=bBe),r}function _Be(e,t){var r;return H5(e,t)?r="trapezoids":G5(e,t)?r="sectors":h1(e,t)&&(r="points"),r}function jBe(e,t){if(H5(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(G5(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return h1(e,t)?t.payload:{}}function NBe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,s=_Be(r,t),o=jBe(r,t),i=n.filter(function(c,d){var u=Xg(o,c),f=r.props[s].filter(function(x){var g=wBe(r,t);return g(x,t)}),h=r.props[s].indexOf(f[f.length-1]),m=d===h;return u&&m}),l=n.indexOf(i[i.length-1]);return l}var kj;function y0(e){"@babel/helpers - typeof";return y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y0(e)}function wv(){return wv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wv.apply(this,arguments)}function q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ao(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q7(Object(r),!0).forEach(function(n){Hd(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SBe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,KZ(n.key),n)}}function CBe(e,t,r){return t&&z7(e.prototype,t),r&&z7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ABe(e,t,r){return t=_S(t),PBe(e,GZ()?Reflect.construct(t,r||[],_S(e).constructor):t.apply(e,r))}function PBe(e,t){if(t&&(y0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return EBe(e)}function EBe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function GZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GZ=function(){return!!e})()}function _S(e){return _S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_S(e)}function kBe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IT(e,t)}function IT(e,t){return IT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},IT(e,t)}function Hd(e,t,r){return t=KZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KZ(e){var t=IBe(e,"string");return y0(t)=="symbol"?t:t+""}function IBe(e,t){if(y0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(y0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ff=function(e){function t(r){var n;return SBe(this,t),n=ABe(this,t,[r]),Hd(n,"pieRef",null),Hd(n,"sectorRefs",[]),Hd(n,"id",fx("recharts-pie-")),Hd(n,"handleAnimationEnd",function(){var s=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Ea(s)&&s()}),Hd(n,"handleAnimationStart",function(){var s=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Ea(s)&&s()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return kBe(t,e),CBe(t,[{key:"isActiveIndex",value:function(n){var s=this.props.activeIndex;return Array.isArray(s)?s.indexOf(n)!==-1:n===s}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.label,l=o.labelLine,c=o.dataKey,d=o.valueKey,u=ha(this.props,!1),f=ha(i,!1),h=ha(l,!1),m=i&&i.offsetRadius||20,x=n.map(function(g,y){var v=(g.startAngle+g.endAngle)/2,b=uo(g.cx,g.cy,g.outerRadius+m,v),w=ao(ao(ao(ao({},u),g),{},{stroke:"none"},f),{},{index:y,textAnchor:t.getTextAnchor(b.x,g.cx)},b),_=ao(ao(ao(ao({},u),g),{},{fill:"none",stroke:g.fill},h),{},{index:y,points:[uo(g.cx,g.cy,g.outerRadius,v),b]}),j=c;return La(c)&&La(d)?j="value":La(c)&&(j=d),Ee.createElement(ns,{key:"label-".concat(g.startAngle,"-").concat(g.endAngle,"-").concat(g.midAngle,"-").concat(y)},l&&t.renderLabelLineItem(l,_,"line"),t.renderLabelItem(i,w,ni(g,j)))});return Ee.createElement(ns,{className:"recharts-pie-labels"},x)}},{key:"renderSectorsStatically",value:function(n){var s=this,o=this.props,i=o.activeShape,l=o.blendStroke,c=o.inactiveShape;return n.map(function(d,u){if(d?.startAngle===0&&d?.endAngle===0&&n.length!==1)return null;var f=s.isActiveIndex(u),h=c&&s.hasActiveIndex()?c:null,m=f?i:h,x=ao(ao({},d),{},{stroke:l?d.fill:d.stroke,tabIndex:-1});return Ee.createElement(ns,wv({ref:function(y){y&&!s.sectorRefs.includes(y)&&s.sectorRefs.push(y)},tabIndex:-1,className:"recharts-pie-sector"},Gg(s.props,d,u),{key:"sector-".concat(d?.startAngle,"-").concat(d?.endAngle,"-").concat(d.midAngle,"-").concat(u)}),Ee.createElement(HZ,wv({option:m,isActive:f,shapeType:"sector"},x)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,s=this.props,o=s.sectors,i=s.isAnimationActive,l=s.animationBegin,c=s.animationDuration,d=s.animationEasing,u=s.animationId,f=this.state,h=f.prevSectors,m=f.prevIsAnimationActive;return Ee.createElement(up,{begin:l,duration:c,isActive:i,easing:d,from:{t:0},to:{t:1},key:"pie-".concat(u,"-").concat(m),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(x){var g=x.t,y=[],v=o&&o[0],b=v.startAngle;return o.forEach(function(w,_){var j=h&&h[_],S=_>0?hd(w,"paddingAngle",0):0;if(j){var C=Ti(j.endAngle-j.startAngle,w.endAngle-w.startAngle),A=ao(ao({},w),{},{startAngle:b+S,endAngle:b+C(g)+S});y.push(A),b=A.endAngle}else{var P=w.endAngle,F=w.startAngle,O=Ti(0,P-F),I=O(g),T=ao(ao({},w),{},{startAngle:b+S,endAngle:b+I+S});y.push(T),b=T.endAngle}}),Ee.createElement(ns,null,n.renderSectorsStatically(y))})}},{key:"attachKeyboardHandlers",value:function(n){var s=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var i=++s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[i].focus(),s.setState({sectorToFocus:i});break}case"ArrowRight":{var l=--s.state.sectorToFocus<0?s.sectorRefs.length-1:s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[l].focus(),s.setState({sectorToFocus:l});break}case"Escape":{s.sectorRefs[s.state.sectorToFocus].blur(),s.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,s=n.sectors,o=n.isAnimationActive,i=this.state.prevSectors;return o&&s&&s.length&&(!i||!Xg(i,s))?this.renderSectorsWithAnimation():this.renderSectorsStatically(s)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,s=this.props,o=s.hide,i=s.sectors,l=s.className,c=s.label,d=s.cx,u=s.cy,f=s.innerRadius,h=s.outerRadius,m=s.isAnimationActive,x=this.state.isAnimationFinished;if(o||!i||!i.length||!vn(d)||!vn(u)||!vn(f)||!vn(h))return null;var g=qa("recharts-pie",l);return Ee.createElement(ns,{tabIndex:this.props.rootTabIndex,className:g,ref:function(v){n.pieRef=v}},this.renderSectors(),c&&this.renderLabels(i),Wi.renderCallByParent(this.props,null,!1),(!m||x)&&kf.renderCallByParent(this.props,i,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return s.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:s.curSectors,isAnimationFinished:!0}:n.sectors!==s.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,s){return n>s?"start":n<s?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,s,o){if(Ee.isValidElement(n))return Ee.cloneElement(n,s);if(Ea(n))return n(s);var i=qa("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ee.createElement(Eg,wv({},s,{key:o,type:"linear",className:i}))}},{key:"renderLabelItem",value:function(n,s,o){if(Ee.isValidElement(n))return Ee.cloneElement(n,s);var i=o;if(Ea(n)&&(i=n(s),Ee.isValidElement(i)))return i;var l=qa("recharts-pie-label-text",typeof n!="boolean"&&!Ea(n)?n.className:"");return Ee.createElement(Kg,wv({},s,{alignmentBaseline:"middle",className:l}),i)}}])}(p.PureComponent);kj=Ff;Hd(Ff,"displayName","Pie");Hd(Ff,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!$u.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Hd(Ff,"parseDeltaAngle",function(e,t){var r=rc(t-e),n=Math.min(Math.abs(t-e),360);return r*n});Hd(Ff,"getRealPieData",function(e){var t=e.data,r=e.children,n=ha(e,!1),s=pd(r,Vw);return t&&t.length?t.map(function(o,i){return ao(ao(ao({payload:o},n),o),s&&s[i]&&s[i].props)}):s&&s.length?s.map(function(o){return ao(ao({},n),o.props)}):[]});Hd(Ff,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,s=t.width,o=t.height,i=CZ(s,o),l=n+nc(e.cx,s,s/2),c=r+nc(e.cy,o,o/2),d=nc(e.innerRadius,i,0),u=nc(e.outerRadius,i,i*.8),f=e.maxRadius||Math.sqrt(s*s+o*o)/2;return{cx:l,cy:c,innerRadius:d,outerRadius:u,maxRadius:f}});Hd(Ff,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?ao(ao({},t.type.defaultProps),t.props):t.props,s=kj.getRealPieData(n);if(!s||!s.length)return null;var o=n.cornerRadius,i=n.startAngle,l=n.endAngle,c=n.paddingAngle,d=n.dataKey,u=n.nameKey,f=n.valueKey,h=n.tooltipType,m=Math.abs(n.minAngle),x=kj.parseCoordinateOfPie(n,r),g=kj.parseDeltaAngle(i,l),y=Math.abs(g),v=d;La(d)&&La(f)?(Lu(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),v="value"):La(d)&&(Lu(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),v=f);var b=s.filter(function(A){return ni(A,v,0)!==0}).length,w=(y>=360?b:b-1)*c,_=y-b*m-w,j=s.reduce(function(A,P){var F=ni(P,v,0);return A+(vn(F)?F:0)},0),S;if(j>0){var C;S=s.map(function(A,P){var F=ni(A,v,0),O=ni(A,u,P),I=(vn(F)?F:0)/j,T;P?T=C.endAngle+rc(g)*c*(F!==0?1:0):T=i;var k=T+rc(g)*((F!==0?m:0)+I*_),B=(T+k)/2,z=(x.innerRadius+x.outerRadius)/2,U=[{name:O,value:F,payload:A,dataKey:v,type:h}],L=uo(x.cx,x.cy,z,B);return C=ao(ao(ao({percent:I,cornerRadius:o,name:O,tooltipPayload:U,midAngle:B,middleRadius:z,tooltipPosition:L},A),x),{},{value:ni(A,v),startAngle:T,endAngle:k,payload:A,paddingAngle:rc(g)*c}),C})}return ao(ao({},x),{},{sectors:S,data:s})});var OBe=Math.ceil,TBe=Math.max;function DBe(e,t,r,n){for(var s=-1,o=TBe(OBe((t-e)/(r||1)),0),i=Array(o);o--;)i[n?o:++s]=e,e+=r;return i}var MBe=DBe,RBe=mQ,U7=1/0,FBe=17976931348623157e292;function LBe(e){if(!e)return e===0?e:0;if(e=RBe(e),e===U7||e===-U7){var t=e<0?-1:1;return t*FBe}return e===e?e:0}var XZ=LBe,$Be=MBe,BBe=k5,EE=XZ;function qBe(e){return function(t,r,n){return n&&typeof n!="number"&&BBe(t,r,n)&&(r=n=void 0),t=EE(t),r===void 0?(r=t,t=0):r=EE(r),n=n===void 0?t<r?1:-1:EE(n),$Be(t,r,n,e)}}var zBe=qBe,UBe=zBe,VBe=UBe(),WBe=VBe;const jS=xs(WBe);function p1(e){"@babel/helpers - typeof";return p1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p1(e)}function V7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function W7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V7(Object(r),!0).forEach(function(n){YZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YZ(e,t,r){return t=HBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HBe(e){var t=GBe(e,"string");return p1(t)=="symbol"?t:t+""}function GBe(e,t){if(p1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(p1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var KBe=["Webkit","Moz","O","ms"],XBe=function(t,r){if(!t)return null;var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),s=KBe.reduce(function(o,i){return W7(W7({},o),{},YZ({},i+n,r))},{});return s[t]=r,s};function b0(e){"@babel/helpers - typeof";return b0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b0(e)}function NS(){return NS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},NS.apply(this,arguments)}function H7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function kE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H7(Object(r),!0).forEach(function(n){Yc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YBe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,QZ(n.key),n)}}function JBe(e,t,r){return t&&G7(e.prototype,t),r&&G7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function QBe(e,t,r){return t=SS(t),ZBe(e,JZ()?Reflect.construct(t,r||[],SS(e).constructor):t.apply(e,r))}function ZBe(e,t){if(t&&(b0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eqe(e)}function eqe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(JZ=function(){return!!e})()}function SS(e){return SS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},SS(e)}function tqe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OT(e,t)}function OT(e,t){return OT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},OT(e,t)}function Yc(e,t,r){return t=QZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QZ(e){var t=rqe(e,"string");return b0(t)=="symbol"?t:t+""}function rqe(e,t){if(b0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(b0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nqe=function(t){var r=t.data,n=t.startIndex,s=t.endIndex,o=t.x,i=t.width,l=t.travellerWidth;if(!r||!r.length)return{};var c=r.length,d=Vb().domain(jS(0,c)).range([o,o+i-l]),u=d.domain().map(function(f){return d(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:d(n),endX:d(s),scale:d,scaleValues:u}},K7=function(t){return t.changedTouches&&!!t.changedTouches.length},w0=function(e){function t(r){var n;return YBe(this,t),n=QBe(this,t,[r]),Yc(n,"handleDrag",function(s){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(s):n.state.isSlideMoving&&n.handleSlideDrag(s)}),Yc(n,"handleTouchMove",function(s){s.changedTouches!=null&&s.changedTouches.length>0&&n.handleDrag(s.changedTouches[0])}),Yc(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var s=n.props,o=s.endIndex,i=s.onDragEnd,l=s.startIndex;i?.({endIndex:o,startIndex:l})}),n.detachDragEndListener()}),Yc(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Yc(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Yc(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Yc(n,"handleSlideDragStart",function(s){var o=K7(s)?s.changedTouches[0]:s;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return tqe(t,e),JBe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var s=n.startX,o=n.endX,i=this.state.scaleValues,l=this.props,c=l.gap,d=l.data,u=d.length-1,f=Math.min(s,o),h=Math.max(s,o),m=t.getIndexInRange(i,f),x=t.getIndexInRange(i,h);return{startIndex:m-m%c,endIndex:x===u?u:x-x%c}}},{key:"getTextOfTick",value:function(n){var s=this.props,o=s.data,i=s.tickFormatter,l=s.dataKey,c=ni(o[n],l,n);return Ea(i)?i(c,n):c}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var s=this.state,o=s.slideMoveStartX,i=s.startX,l=s.endX,c=this.props,d=c.x,u=c.width,f=c.travellerWidth,h=c.startIndex,m=c.endIndex,x=c.onChange,g=n.pageX-o;g>0?g=Math.min(g,d+u-f-l,d+u-f-i):g<0&&(g=Math.max(g,d-i,d-l));var y=this.getIndex({startX:i+g,endX:l+g});(y.startIndex!==h||y.endIndex!==m)&&x&&x(y),this.setState({startX:i+g,endX:l+g,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,s){var o=K7(s)?s.changedTouches[0]:s;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var s=this.state,o=s.brushMoveStartX,i=s.movingTravellerId,l=s.endX,c=s.startX,d=this.state[i],u=this.props,f=u.x,h=u.width,m=u.travellerWidth,x=u.onChange,g=u.gap,y=u.data,v={startX:this.state.startX,endX:this.state.endX},b=n.pageX-o;b>0?b=Math.min(b,f+h-m-d):b<0&&(b=Math.max(b,f-d)),v[i]=d+b;var w=this.getIndex(v),_=w.startIndex,j=w.endIndex,S=function(){var A=y.length-1;return i==="startX"&&(l>c?_%g===0:j%g===0)||l<c&&j===A||i==="endX"&&(l>c?j%g===0:_%g===0)||l>c&&j===A};this.setState(Yc(Yc({},i,d+b),"brushMoveStartX",n.pageX),function(){x&&S()&&x(w)})}},{key:"handleTravellerMoveKeyboard",value:function(n,s){var o=this,i=this.state,l=i.scaleValues,c=i.startX,d=i.endX,u=this.state[s],f=l.indexOf(u);if(f!==-1){var h=f+n;if(!(h===-1||h>=l.length)){var m=l[h];s==="startX"&&m>=d||s==="endX"&&m<=c||this.setState(Yc({},s,m),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.fill,d=n.stroke;return Ee.createElement("rect",{stroke:d,fill:c,x:s,y:o,width:i,height:l})}},{key:"renderPanorama",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.data,d=n.children,u=n.padding,f=p.Children.only(d);return f?Ee.cloneElement(f,{x:s,y:o,width:i,height:l,margin:u,compact:!0,data:c}):null}},{key:"renderTravellerLayer",value:function(n,s){var o,i,l=this,c=this.props,d=c.y,u=c.travellerWidth,f=c.height,h=c.traveller,m=c.ariaLabel,x=c.data,g=c.startIndex,y=c.endIndex,v=Math.max(n,this.props.x),b=kE(kE({},ha(this.props,!1)),{},{x:v,y:d,width:u,height:f}),w=m||"Min value: ".concat((o=x[g])===null||o===void 0?void 0:o.name,", Max value: ").concat((i=x[y])===null||i===void 0?void 0:i.name);return Ee.createElement(ns,{tabIndex:0,role:"slider","aria-label":w,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[s],onTouchStart:this.travellerDragStartHandlers[s],onKeyDown:function(j){["ArrowLeft","ArrowRight"].includes(j.key)&&(j.preventDefault(),j.stopPropagation(),l.handleTravellerMoveKeyboard(j.key==="ArrowRight"?1:-1,s))},onFocus:function(){l.setState({isTravellerFocused:!0})},onBlur:function(){l.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,b))}},{key:"renderSlide",value:function(n,s){var o=this.props,i=o.y,l=o.height,c=o.stroke,d=o.travellerWidth,u=Math.min(n,s)+d,f=Math.max(Math.abs(s-n)-d,0);return Ee.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:c,fillOpacity:.2,x:u,y:i,width:f,height:l})}},{key:"renderText",value:function(){var n=this.props,s=n.startIndex,o=n.endIndex,i=n.y,l=n.height,c=n.travellerWidth,d=n.stroke,u=this.state,f=u.startX,h=u.endX,m=5,x={pointerEvents:"none",fill:d};return Ee.createElement(ns,{className:"recharts-brush-texts"},Ee.createElement(Kg,NS({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-m,y:i+l/2},x),this.getTextOfTick(s)),Ee.createElement(Kg,NS({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+c+m,y:i+l/2},x),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,s=n.data,o=n.className,i=n.children,l=n.x,c=n.y,d=n.width,u=n.height,f=n.alwaysShowText,h=this.state,m=h.startX,x=h.endX,g=h.isTextActive,y=h.isSlideMoving,v=h.isTravellerMoving,b=h.isTravellerFocused;if(!s||!s.length||!vn(l)||!vn(c)||!vn(d)||!vn(u)||d<=0||u<=0)return null;var w=qa("recharts-brush",o),_=Ee.Children.count(i)===1,j=XBe("userSelect","none");return Ee.createElement(ns,{className:w,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:j},this.renderBackground(),_&&this.renderPanorama(),this.renderSlide(m,x),this.renderTravellerLayer(m,"startX"),this.renderTravellerLayer(x,"endX"),(g||y||v||b||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var s=n.x,o=n.y,i=n.width,l=n.height,c=n.stroke,d=Math.floor(o+l/2)-1;return Ee.createElement(Ee.Fragment,null,Ee.createElement("rect",{x:s,y:o,width:i,height:l,fill:c,stroke:"none"}),Ee.createElement("line",{x1:s+1,y1:d,x2:s+i-1,y2:d,fill:"none",stroke:"#fff"}),Ee.createElement("line",{x1:s+1,y1:d+2,x2:s+i-1,y2:d+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,s){var o;return Ee.isValidElement(n)?o=Ee.cloneElement(n,s):Ea(n)?o=n(s):o=t.renderDefaultTraveller(s),o}},{key:"getDerivedStateFromProps",value:function(n,s){var o=n.data,i=n.width,l=n.x,c=n.travellerWidth,d=n.updateId,u=n.startIndex,f=n.endIndex;if(o!==s.prevData||d!==s.prevUpdateId)return kE({prevData:o,prevTravellerWidth:c,prevUpdateId:d,prevX:l,prevWidth:i},o&&o.length?nqe({data:o,width:i,x:l,travellerWidth:c,startIndex:u,endIndex:f}):{scale:null,scaleValues:null});if(s.scale&&(i!==s.prevWidth||l!==s.prevX||c!==s.prevTravellerWidth)){s.scale.range([l,l+i-c]);var h=s.scale.domain().map(function(m){return s.scale(m)});return{prevData:o,prevTravellerWidth:c,prevUpdateId:d,prevX:l,prevWidth:i,startX:s.scale(n.startIndex),endX:s.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,s){for(var o=n.length,i=0,l=o-1;l-i>1;){var c=Math.floor((i+l)/2);n[c]>s?l=c:i=c}return s>=n[l]?l:i}}])}(p.PureComponent);Yc(w0,"displayName","Brush");Yc(w0,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var aqe=jM;function sqe(e,t){var r;return aqe(e,function(n,s,o){return r=t(n,s,o),!r}),!!r}var oqe=sqe,iqe=BJ,lqe=Bf,cqe=oqe,dqe=Mc,uqe=k5;function fqe(e,t,r){var n=dqe(e)?iqe:cqe;return r&&uqe(e,t,r)&&(t=void 0),n(e,lqe(t))}var mqe=fqe;const hqe=xs(mqe);var If=function(t,r){var n=t.alwaysShow,s=t.ifOverflow;return n&&(s="extendDomain"),s===r},X7=lQ;function pqe(e,t,r){t=="__proto__"&&X7?X7(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var gqe=pqe,xqe=gqe,vqe=oQ,yqe=Bf;function bqe(e,t){var r={};return t=yqe(t),vqe(e,function(n,s,o){xqe(r,s,t(n,s,o))}),r}var wqe=bqe;const _qe=xs(wqe);function jqe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var Nqe=jqe,Sqe=jM;function Cqe(e,t){var r=!0;return Sqe(e,function(n,s,o){return r=!!t(n,s,o),r}),r}var Aqe=Cqe,Pqe=Nqe,Eqe=Aqe,kqe=Bf,Iqe=Mc,Oqe=k5;function Tqe(e,t,r){var n=Iqe(e)?Pqe:Eqe;return r&&Oqe(e,t,r)&&(t=void 0),n(e,kqe(t))}var Dqe=Tqe;const ZZ=xs(Dqe);var Mqe=["x","y"];function g1(e){"@babel/helpers - typeof";return g1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g1(e)}function TT(){return TT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TT.apply(this,arguments)}function Y7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Jy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Y7(Object(r),!0).forEach(function(n){Rqe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Rqe(e,t,r){return t=Fqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fqe(e){var t=Lqe(e,"string");return g1(t)=="symbol"?t:t+""}function Lqe(e,t){if(g1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(g1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $qe(e,t){if(e==null)return{};var r=Bqe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Bqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function qqe(e,t){var r=e.x,n=e.y,s=$qe(e,Mqe),o="".concat(r),i=parseInt(o,10),l="".concat(n),c=parseInt(l,10),d="".concat(t.height||s.height),u=parseInt(d,10),f="".concat(t.width||s.width),h=parseInt(f,10);return Jy(Jy(Jy(Jy(Jy({},t),s),i?{x:i}:{}),c?{y:c}:{}),{},{height:u,width:h,name:t.name,radius:t.radius})}function J7(e){return Ee.createElement(HZ,TT({shapeType:"rectangle",propTransformer:qqe,activeClassName:"recharts-active-bar"},e))}var zqe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,s){if(typeof t=="number")return t;var o=vn(n)||vSe(n);return o?t(n,s):(o||dp(!1),r)}},Uqe=["value","background"],eee;function _0(e){"@babel/helpers - typeof";return _0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_0(e)}function Vqe(e,t){if(e==null)return{};var r=Wqe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Wqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function CS(){return CS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},CS.apply(this,arguments)}function Q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function hi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q7(Object(r),!0).forEach(function(n){Ch(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hqe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ree(n.key),n)}}function Gqe(e,t,r){return t&&Z7(e.prototype,t),r&&Z7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Kqe(e,t,r){return t=AS(t),Xqe(e,tee()?Reflect.construct(t,r||[],AS(e).constructor):t.apply(e,r))}function Xqe(e,t){if(t&&(_0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yqe(e)}function Yqe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tee=function(){return!!e})()}function AS(e){return AS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},AS(e)}function Jqe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DT(e,t)}function DT(e,t){return DT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},DT(e,t)}function Ch(e,t,r){return t=ree(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ree(e){var t=Qqe(e,"string");return _0(t)=="symbol"?t:t+""}function Qqe(e,t){if(_0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(_0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gx=function(e){function t(){var r;Hqe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=Kqe(this,t,[].concat(s)),Ch(r,"state",{isAnimationFinished:!1}),Ch(r,"id",fx("recharts-bar-")),Ch(r,"handleAnimationEnd",function(){var i=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),i&&i()}),Ch(r,"handleAnimationStart",function(){var i=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),i&&i()}),r}return Jqe(t,e),Gqe(t,[{key:"renderRectanglesStatically",value:function(n){var s=this,o=this.props,i=o.shape,l=o.dataKey,c=o.activeIndex,d=o.activeBar,u=ha(this.props,!1);return n&&n.map(function(f,h){var m=h===c,x=m?d:i,g=hi(hi(hi({},u),f),{},{isActive:m,option:x,index:h,dataKey:l,onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd});return Ee.createElement(ns,CS({className:"recharts-bar-rectangle"},Gg(s.props,f,h),{key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(h)}),Ee.createElement(J7,g))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,s=this.props,o=s.data,i=s.layout,l=s.isAnimationActive,c=s.animationBegin,d=s.animationDuration,u=s.animationEasing,f=s.animationId,h=this.state.prevData;return Ee.createElement(up,{begin:c,duration:d,isActive:l,easing:u,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(m){var x=m.t,g=o.map(function(y,v){var b=h&&h[v];if(b){var w=Ti(b.x,y.x),_=Ti(b.y,y.y),j=Ti(b.width,y.width),S=Ti(b.height,y.height);return hi(hi({},y),{},{x:w(x),y:_(x),width:j(x),height:S(x)})}if(i==="horizontal"){var C=Ti(0,y.height),A=C(x);return hi(hi({},y),{},{y:y.y+y.height-A,height:A})}var P=Ti(0,y.width),F=P(x);return hi(hi({},y),{},{width:F})});return Ee.createElement(ns,null,n.renderRectanglesStatically(g))})}},{key:"renderRectangles",value:function(){var n=this.props,s=n.data,o=n.isAnimationActive,i=this.state.prevData;return o&&s&&s.length&&(!i||!Xg(i,s))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(s)}},{key:"renderBackground",value:function(){var n=this,s=this.props,o=s.data,i=s.dataKey,l=s.activeIndex,c=ha(this.props.background,!1);return o.map(function(d,u){d.value;var f=d.background,h=Vqe(d,Uqe);if(!f)return null;var m=hi(hi(hi(hi(hi({},h),{},{fill:"#eee"},f),c),Gg(n.props,d,u)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:i,index:u,className:"recharts-bar-background-rectangle"});return Ee.createElement(J7,CS({key:"background-bar-".concat(u),option:n.props.background,isActive:u===l},m))})}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.data,l=o.xAxis,c=o.yAxis,d=o.layout,u=o.children,f=pd(u,l2);if(!f)return null;var h=d==="vertical"?i[0].height/2:i[0].width/2,m=function(y,v){var b=Array.isArray(y.value)?y.value[1]:y.value;return{x:y.x,y:y.y,value:b,errorVal:ni(y,v)}},x={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ee.createElement(ns,x,f.map(function(g){return Ee.cloneElement(g,{key:"error-bar-".concat(s,"-").concat(g.props.dataKey),data:i,xAxis:l,yAxis:c,layout:d,offset:h,dataPointFormatter:m})}))}},{key:"render",value:function(){var n=this.props,s=n.hide,o=n.data,i=n.className,l=n.xAxis,c=n.yAxis,d=n.left,u=n.top,f=n.width,h=n.height,m=n.isAnimationActive,x=n.background,g=n.id;if(s||!o||!o.length)return null;var y=this.state.isAnimationFinished,v=qa("recharts-bar",i),b=l&&l.allowDataOverflow,w=c&&c.allowDataOverflow,_=b||w,j=La(g)?this.id:g;return Ee.createElement(ns,{className:v},b||w?Ee.createElement("defs",null,Ee.createElement("clipPath",{id:"clipPath-".concat(j)},Ee.createElement("rect",{x:b?d:d-f/2,y:w?u:u-h/2,width:b?f:f*2,height:w?h:h*2}))):null,Ee.createElement(ns,{className:"recharts-bar-rectangles",clipPath:_?"url(#clipPath-".concat(j,")"):null},x?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(_,j),(!m||y)&&kf.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:s.curData}:n.data!==s.curData?{curData:n.data}:null}}])}(p.PureComponent);eee=gx;Ch(gx,"displayName","Bar");Ch(gx,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!$u.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Ch(gx,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,s=e.bandSize,o=e.xAxis,i=e.yAxis,l=e.xAxisTicks,c=e.yAxisTicks,d=e.stackedData,u=e.dataStartIndex,f=e.displayedData,h=e.offset,m=TFe(n,r);if(!m)return null;var x=t.layout,g=r.type.defaultProps,y=g!==void 0?hi(hi({},g),r.props):r.props,v=y.dataKey,b=y.children,w=y.minPointSize,_=x==="horizontal"?i:o,j=d?_.scale.domain():null,S=BFe({numericAxis:_}),C=pd(b,Vw),A=f.map(function(P,F){var O,I,T,k,B,z;d?O=DFe(d[u+F],j):(O=ni(P,v),Array.isArray(O)||(O=[S,O]));var U=zqe(w,eee.defaultProps.minPointSize)(O[1],F);if(x==="horizontal"){var L,W=[i.scale(O[0]),i.scale(O[1])],ge=W[0],Ae=W[1];I=qq({axis:o,ticks:l,bandSize:s,offset:m.offset,entry:P,index:F}),T=(L=Ae??ge)!==null&&L!==void 0?L:void 0,k=m.size;var V=ge-Ae;if(B=Number.isNaN(V)?0:V,z={x:I,y:i.y,width:k,height:i.height},Math.abs(U)>0&&Math.abs(B)<Math.abs(U)){var $=rc(B||U)*(Math.abs(U)-Math.abs(B));T-=$,B+=$}}else{var Y=[o.scale(O[0]),o.scale(O[1])],he=Y[0],J=Y[1];if(I=he,T=qq({axis:i,ticks:c,bandSize:s,offset:m.offset,entry:P,index:F}),k=J-he,B=m.size,z={x:o.x,y:T,width:o.width,height:B},Math.abs(U)>0&&Math.abs(k)<Math.abs(U)){var G=rc(k||U)*(Math.abs(U)-Math.abs(k));k+=G}}return hi(hi(hi({},P),{},{x:I,y:T,width:k,height:B,value:d?O:O[1],payload:P,background:z},C&&C[F]&&C[F].props),{},{tooltipPayload:[NZ(r,P)],tooltipPosition:{x:I+k/2,y:T+B/2}})});return hi({data:A,layout:x},h)});function x1(e){"@babel/helpers - typeof";return x1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x1(e)}function Zqe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ez(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nee(n.key),n)}}function e7e(e,t,r){return t&&ez(e.prototype,t),r&&ez(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Au(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tz(Object(r),!0).forEach(function(n){K5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function K5(e,t,r){return t=nee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nee(e){var t=t7e(e,"string");return x1(t)=="symbol"?t:t+""}function t7e(e,t){if(x1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(x1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ZM=function(t,r,n,s,o){var i=t.width,l=t.height,c=t.layout,d=t.children,u=Object.keys(r),f={left:n.left,leftMirror:n.left,right:i-n.right,rightMirror:i-n.right,top:n.top,topMirror:n.top,bottom:l-n.bottom,bottomMirror:l-n.bottom},h=!!ed(d,gx);return u.reduce(function(m,x){var g=r[x],y=g.orientation,v=g.domain,b=g.padding,w=b===void 0?{}:b,_=g.mirror,j=g.reversed,S="".concat(y).concat(_?"Mirror":""),C,A,P,F,O;if(g.type==="number"&&(g.padding==="gap"||g.padding==="no-gap")){var I=v[1]-v[0],T=1/0,k=g.categoricalDomain.sort(wSe);if(k.forEach(function(Y,he){he>0&&(T=Math.min((Y||0)-(k[he-1]||0),T))}),Number.isFinite(T)){var B=T/I,z=g.layout==="vertical"?n.height:n.width;if(g.padding==="gap"&&(C=B*z/2),g.padding==="no-gap"){var U=nc(t.barCategoryGap,B*z),L=B*z/2;C=L-U-(L-U)/z*U}}}s==="xAxis"?A=[n.left+(w.left||0)+(C||0),n.left+n.width-(w.right||0)-(C||0)]:s==="yAxis"?A=c==="horizontal"?[n.top+n.height-(w.bottom||0),n.top+(w.top||0)]:[n.top+(w.top||0)+(C||0),n.top+n.height-(w.bottom||0)-(C||0)]:A=g.range,j&&(A=[A[1],A[0]]);var W=bZ(g,o,h),ge=W.scale,Ae=W.realScaleType;ge.domain(v).range(A),wZ(ge);var V=_Z(ge,Au(Au({},g),{},{realScaleType:Ae}));s==="xAxis"?(O=y==="top"&&!_||y==="bottom"&&_,P=n.left,F=f[S]-O*g.height):s==="yAxis"&&(O=y==="left"&&!_||y==="right"&&_,P=f[S]-O*g.width,F=n.top);var $=Au(Au(Au({},g),V),{},{realScaleType:Ae,x:P,y:F,scale:ge,width:s==="xAxis"?n.width:g.width,height:s==="yAxis"?n.height:g.height});return $.bandSize=dS($,V),!g.hide&&s==="xAxis"?f[S]+=(O?-1:1)*$.height:g.hide||(f[S]+=(O?-1:1)*$.width),Au(Au({},m),{},K5({},x,$))},{})},aee=function(t,r){var n=t.x,s=t.y,o=r.x,i=r.y;return{x:Math.min(n,o),y:Math.min(s,i),width:Math.abs(o-n),height:Math.abs(i-s)}},r7e=function(t){var r=t.x1,n=t.y1,s=t.x2,o=t.y2;return aee({x:r,y:n},{x:s,y:o})},see=function(){function e(t){Zqe(this,e),this.scale=t}return e7e(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+i}case"end":{var l=this.bandwidth?this.bandwidth():0;return this.scale(r)+l}default:return this.scale(r)}if(s){var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+c}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),s=n[0],o=n[n.length-1];return s<=o?r>=s&&r<=o:r>=o&&r<=s}}],[{key:"create",value:function(r){return new e(r)}}])}();K5(see,"EPS",1e-4);var eR=function(t){var r=Object.keys(t).reduce(function(n,s){return Au(Au({},n),{},K5({},s,see.create(t[s])))},{});return Au(Au({},r),{},{apply:function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=o.bandAware,l=o.position;return _qe(s,function(c,d){return r[d].apply(c,{bandAware:i,position:l})})},isInRange:function(s){return ZZ(s,function(o,i){return r[i].isInRange(o)})}})};function n7e(e){return(e%180+180)%180}var a7e=function(t){var r=t.width,n=t.height,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=n7e(s),i=o*Math.PI/180,l=Math.atan(n/r),c=i>l&&i<Math.PI-l?n/Math.sin(i):r/Math.cos(i);return Math.abs(c)},s7e=Bf,o7e=n2,i7e=P5;function l7e(e){return function(t,r,n){var s=Object(t);if(!o7e(t)){var o=s7e(r);t=i7e(t),r=function(l){return o(s[l],l,s)}}var i=e(t,r,n);return i>-1?s[o?t[i]:i]:void 0}}var c7e=l7e,d7e=XZ;function u7e(e){var t=d7e(e),r=t%1;return t===t?r?t-r:t:0}var f7e=u7e,m7e=eQ,h7e=Bf,p7e=f7e,g7e=Math.max;function x7e(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var s=r==null?0:p7e(r);return s<0&&(s=g7e(n+s,0)),m7e(e,h7e(t),s)}var v7e=x7e,y7e=c7e,b7e=v7e,w7e=y7e(b7e),_7e=w7e;const j7e=xs(_7e);var N7e=_Ne(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),tR=p.createContext(void 0),rR=p.createContext(void 0),oee=p.createContext(void 0),iee=p.createContext({}),lee=p.createContext(void 0),cee=p.createContext(0),dee=p.createContext(0),rz=function(t){var r=t.state,n=r.xAxisMap,s=r.yAxisMap,o=r.offset,i=t.clipPathId,l=t.children,c=t.width,d=t.height,u=N7e(o);return Ee.createElement(tR.Provider,{value:n},Ee.createElement(rR.Provider,{value:s},Ee.createElement(iee.Provider,{value:o},Ee.createElement(oee.Provider,{value:u},Ee.createElement(lee.Provider,{value:i},Ee.createElement(cee.Provider,{value:d},Ee.createElement(dee.Provider,{value:c},l)))))))},S7e=function(){return p.useContext(lee)},uee=function(t){var r=p.useContext(tR);r==null&&dp(!1);var n=r[t];return n==null&&dp(!1),n},C7e=function(){var t=p.useContext(tR);return xh(t)},A7e=function(){var t=p.useContext(rR),r=j7e(t,function(n){return ZZ(n.domain,Number.isFinite)});return r||xh(t)},fee=function(t){var r=p.useContext(rR);r==null&&dp(!1);var n=r[t];return n==null&&dp(!1),n},P7e=function(){var t=p.useContext(oee);return t},E7e=function(){return p.useContext(iee)},nR=function(){return p.useContext(dee)},aR=function(){return p.useContext(cee)};function j0(e){"@babel/helpers - typeof";return j0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j0(e)}function k7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hee(n.key),n)}}function I7e(e,t,r){return t&&nz(e.prototype,t),r&&nz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function O7e(e,t,r){return t=PS(t),T7e(e,mee()?Reflect.construct(t,r||[],PS(e).constructor):t.apply(e,r))}function T7e(e,t){if(t&&(j0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D7e(e)}function D7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mee=function(){return!!e})()}function PS(e){return PS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},PS(e)}function M7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MT(e,t)}function MT(e,t){return MT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},MT(e,t)}function az(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function sz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?az(Object(r),!0).forEach(function(n){sR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):az(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sR(e,t,r){return t=hee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hee(e){var t=R7e(e,"string");return j0(t)=="symbol"?t:t+""}function R7e(e,t){if(j0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(j0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function F7e(e,t){return q7e(e)||B7e(e,t)||$7e(e,t)||L7e()}function L7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $7e(e,t){if(e){if(typeof e=="string")return oz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oz(e,t)}}function oz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function B7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function q7e(e){if(Array.isArray(e))return e}function RT(){return RT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},RT.apply(this,arguments)}var z7e=function(t,r){var n;return Ee.isValidElement(t)?n=Ee.cloneElement(t,r):Ea(t)?n=t(r):n=Ee.createElement("line",RT({},r,{className:"recharts-reference-line-line"})),n},U7e=function(t,r,n,s,o,i,l,c,d){var u=o.x,f=o.y,h=o.width,m=o.height;if(n){var x=d.y,g=t.y.apply(x,{position:i});if(If(d,"discard")&&!t.y.isInRange(g))return null;var y=[{x:u+h,y:g},{x:u,y:g}];return c==="left"?y.reverse():y}if(r){var v=d.x,b=t.x.apply(v,{position:i});if(If(d,"discard")&&!t.x.isInRange(b))return null;var w=[{x:b,y:f+m},{x:b,y:f}];return l==="top"?w.reverse():w}if(s){var _=d.segment,j=_.map(function(S){return t.apply(S,{position:i})});return If(d,"discard")&&hqe(j,function(S){return!t.isInRange(S)})?null:j}return null};function V7e(e){var t=e.x,r=e.y,n=e.segment,s=e.xAxisId,o=e.yAxisId,i=e.shape,l=e.className,c=e.alwaysShow,d=S7e(),u=uee(s),f=fee(o),h=P7e();if(!d||!h)return null;Lu(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var m=eR({x:u.scale,y:f.scale}),x=Mi(t),g=Mi(r),y=n&&n.length===2,v=U7e(m,x,g,y,h,e.position,u.orientation,f.orientation,e);if(!v)return null;var b=F7e(v,2),w=b[0],_=w.x,j=w.y,S=b[1],C=S.x,A=S.y,P=If(e,"hidden")?"url(#".concat(d,")"):void 0,F=sz(sz({clipPath:P},ha(e,!0)),{},{x1:_,y1:j,x2:C,y2:A});return Ee.createElement(ns,{className:qa("recharts-reference-line",l)},z7e(i,F),Wi.renderCallByParent(e,r7e({x1:_,y1:j,x2:C,y2:A})))}var oR=function(e){function t(){return k7e(this,t),O7e(this,t,arguments)}return M7e(t,e),I7e(t,[{key:"render",value:function(){return Ee.createElement(V7e,this.props)}}])}(Ee.Component);sR(oR,"displayName","ReferenceLine");sR(oR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function FT(){return FT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},FT.apply(this,arguments)}function N0(e){"@babel/helpers - typeof";return N0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N0(e)}function iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function lz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iz(Object(r),!0).forEach(function(n){X5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function W7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gee(n.key),n)}}function H7e(e,t,r){return t&&cz(e.prototype,t),r&&cz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function G7e(e,t,r){return t=ES(t),K7e(e,pee()?Reflect.construct(t,r||[],ES(e).constructor):t.apply(e,r))}function K7e(e,t){if(t&&(N0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return X7e(e)}function X7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pee=function(){return!!e})()}function ES(e){return ES=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ES(e)}function Y7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LT(e,t)}function LT(e,t){return LT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},LT(e,t)}function X5(e,t,r){return t=gee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gee(e){var t=J7e(e,"string");return N0(t)=="symbol"?t:t+""}function J7e(e,t){if(N0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(N0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Q7e=function(t){var r=t.x,n=t.y,s=t.xAxis,o=t.yAxis,i=eR({x:s.scale,y:o.scale}),l=i.apply({x:r,y:n},{bandAware:!0});return If(t,"discard")&&!i.isInRange(l)?null:l},Y5=function(e){function t(){return W7e(this,t),G7e(this,t,arguments)}return Y7e(t,e),H7e(t,[{key:"render",value:function(){var n=this.props,s=n.x,o=n.y,i=n.r,l=n.alwaysShow,c=n.clipPathId,d=Mi(s),u=Mi(o);if(Lu(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!d||!u)return null;var f=Q7e(this.props);if(!f)return null;var h=f.x,m=f.y,x=this.props,g=x.shape,y=x.className,v=If(this.props,"hidden")?"url(#".concat(c,")"):void 0,b=lz(lz({clipPath:v},ha(this.props,!0)),{},{cx:h,cy:m});return Ee.createElement(ns,{className:qa("recharts-reference-dot",y)},t.renderDot(g,b),Wi.renderCallByParent(this.props,{x:h-i,y:m-i,width:2*i,height:2*i}))}}])}(Ee.Component);X5(Y5,"displayName","ReferenceDot");X5(Y5,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});X5(Y5,"renderDot",function(e,t){var r;return Ee.isValidElement(e)?r=Ee.cloneElement(e,t):Ea(e)?r=e(t):r=Ee.createElement(c2,FT({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function $T(){return $T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$T.apply(this,arguments)}function S0(e){"@babel/helpers - typeof";return S0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S0(e)}function dz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function uz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dz(Object(r),!0).forEach(function(n){J5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Z7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vee(n.key),n)}}function eze(e,t,r){return t&&fz(e.prototype,t),r&&fz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tze(e,t,r){return t=kS(t),rze(e,xee()?Reflect.construct(t,r||[],kS(e).constructor):t.apply(e,r))}function rze(e,t){if(t&&(S0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nze(e)}function nze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xee=function(){return!!e})()}function kS(e){return kS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},kS(e)}function aze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BT(e,t)}function BT(e,t){return BT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},BT(e,t)}function J5(e,t,r){return t=vee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vee(e){var t=sze(e,"string");return S0(t)=="symbol"?t:t+""}function sze(e,t){if(S0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(S0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oze=function(t,r,n,s,o){var i=o.x1,l=o.x2,c=o.y1,d=o.y2,u=o.xAxis,f=o.yAxis;if(!u||!f)return null;var h=eR({x:u.scale,y:f.scale}),m={x:t?h.x.apply(i,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(c,{position:"start"}):h.y.rangeMin},x={x:r?h.x.apply(l,{position:"end"}):h.x.rangeMax,y:s?h.y.apply(d,{position:"end"}):h.y.rangeMax};return If(o,"discard")&&(!h.isInRange(m)||!h.isInRange(x))?null:aee(m,x)},Q5=function(e){function t(){return Z7e(this,t),tze(this,t,arguments)}return aze(t,e),eze(t,[{key:"render",value:function(){var n=this.props,s=n.x1,o=n.x2,i=n.y1,l=n.y2,c=n.className,d=n.alwaysShow,u=n.clipPathId;Lu(d===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Mi(s),h=Mi(o),m=Mi(i),x=Mi(l),g=this.props.shape;if(!f&&!h&&!m&&!x&&!g)return null;var y=oze(f,h,m,x,this.props);if(!y&&!g)return null;var v=If(this.props,"hidden")?"url(#".concat(u,")"):void 0;return Ee.createElement(ns,{className:qa("recharts-reference-area",c)},t.renderRect(g,uz(uz({clipPath:v},ha(this.props,!0)),y)),Wi.renderCallByParent(this.props,y))}}])}(Ee.Component);J5(Q5,"displayName","ReferenceArea");J5(Q5,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});J5(Q5,"renderRect",function(e,t){var r;return Ee.isValidElement(e)?r=Ee.cloneElement(e,t):Ea(e)?r=e(t):r=Ee.createElement(QM,$T({},t,{className:"recharts-reference-area-rect"})),r});function yee(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],s=0;s<e.length;s+=t)if(r===void 0||r(e[s])===!0)n.push(e[s]);else return;return n}function ize(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return a7e(n,r)}function lze(e,t,r){var n=r==="width",s=e.x,o=e.y,i=e.width,l=e.height;return t===1?{start:n?s:o,end:n?s+i:o+l}:{start:n?s+i:o+l,end:n?s:o}}function IS(e,t,r,n,s){if(e*t<e*n||e*t>e*s)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-s)<=0}function cze(e,t){return yee(e,t+1)}function dze(e,t,r,n,s){for(var o=(n||[]).slice(),i=t.start,l=t.end,c=0,d=1,u=i,f=function(){var x=n?.[c];if(x===void 0)return{v:yee(n,d)};var g=c,y,v=function(){return y===void 0&&(y=r(x,g)),y},b=x.coordinate,w=c===0||IS(e,b,v,u,l);w||(c=0,u=i,d+=1),w&&(u=b+e*(v()/2+s),c+=d)},h;d<=o.length;)if(h=f(),h)return h.v;return[]}function v1(e){"@babel/helpers - typeof";return v1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v1(e)}function mz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function El(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mz(Object(r),!0).forEach(function(n){uze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uze(e,t,r){return t=fze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fze(e){var t=mze(e,"string");return v1(t)=="symbol"?t:t+""}function mze(e,t){if(v1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(v1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hze(e,t,r,n,s){for(var o=(n||[]).slice(),i=o.length,l=t.start,c=t.end,d=function(h){var m=o[h],x,g=function(){return x===void 0&&(x=r(m,h)),x};if(h===i-1){var y=e*(m.coordinate+e*g()/2-c);o[h]=m=El(El({},m),{},{tickCoord:y>0?m.coordinate-y*e:m.coordinate})}else o[h]=m=El(El({},m),{},{tickCoord:m.coordinate});var v=IS(e,m.tickCoord,g,l,c);v&&(c=m.tickCoord-e*(g()/2+s),o[h]=El(El({},m),{},{isShow:!0}))},u=i-1;u>=0;u--)d(u);return o}function pze(e,t,r,n,s,o){var i=(n||[]).slice(),l=i.length,c=t.start,d=t.end;if(o){var u=n[l-1],f=r(u,l-1),h=e*(u.coordinate+e*f/2-d);i[l-1]=u=El(El({},u),{},{tickCoord:h>0?u.coordinate-h*e:u.coordinate});var m=IS(e,u.tickCoord,function(){return f},c,d);m&&(d=u.tickCoord-e*(f/2+s),i[l-1]=El(El({},u),{},{isShow:!0}))}for(var x=o?l-1:l,g=function(b){var w=i[b],_,j=function(){return _===void 0&&(_=r(w,b)),_};if(b===0){var S=e*(w.coordinate-e*j()/2-c);i[b]=w=El(El({},w),{},{tickCoord:S<0?w.coordinate-S*e:w.coordinate})}else i[b]=w=El(El({},w),{},{tickCoord:w.coordinate});var C=IS(e,w.tickCoord,j,c,d);C&&(c=w.tickCoord+e*(j()/2+s),i[b]=El(El({},w),{},{isShow:!0}))},y=0;y<x;y++)g(y);return i}function iR(e,t,r){var n=e.tick,s=e.ticks,o=e.viewBox,i=e.minTickGap,l=e.orientation,c=e.interval,d=e.tickFormatter,u=e.unit,f=e.angle;if(!s||!s.length||!n)return[];if(vn(c)||$u.isSsr)return cze(s,typeof c=="number"&&vn(c)?c:0);var h=[],m=l==="top"||l==="bottom"?"width":"height",x=u&&m==="width"?Ub(u,{fontSize:t,letterSpacing:r}):{width:0,height:0},g=function(w,_){var j=Ea(d)?d(w.value,_):w.value;return m==="width"?ize(Ub(j,{fontSize:t,letterSpacing:r}),x,f):Ub(j,{fontSize:t,letterSpacing:r})[m]},y=s.length>=2?rc(s[1].coordinate-s[0].coordinate):1,v=lze(o,y,m);return c==="equidistantPreserveStart"?dze(y,v,g,s,i):(c==="preserveStart"||c==="preserveStartEnd"?h=pze(y,v,g,s,i,c==="preserveStartEnd"):h=hze(y,v,g,s,i),h.filter(function(b){return b.isShow}))}var gze=["viewBox"],xze=["viewBox"],vze=["ticks"];function C0(e){"@babel/helpers - typeof";return C0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C0(e)}function _v(){return _v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_v.apply(this,arguments)}function hz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ai(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hz(Object(r),!0).forEach(function(n){lR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function IE(e,t){if(e==null)return{};var r=yze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function bze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,wee(n.key),n)}}function wze(e,t,r){return t&&pz(e.prototype,t),r&&pz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _ze(e,t,r){return t=OS(t),jze(e,bee()?Reflect.construct(t,r||[],OS(e).constructor):t.apply(e,r))}function jze(e,t){if(t&&(C0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nze(e)}function Nze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bee=function(){return!!e})()}function OS(e){return OS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},OS(e)}function Sze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qT(e,t)}function qT(e,t){return qT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},qT(e,t)}function lR(e,t,r){return t=wee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wee(e){var t=Cze(e,"string");return C0(t)=="symbol"?t:t+""}function Cze(e,t){if(C0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(C0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uy=function(e){function t(r){var n;return bze(this,t),n=_ze(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return Sze(t,e),wze(t,[{key:"shouldComponentUpdate",value:function(n,s){var o=n.viewBox,i=IE(n,gze),l=this.props,c=l.viewBox,d=IE(l,xze);return!Lv(o,c)||!Lv(i,d)||!Lv(s,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var s=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];s&&this.setState({fontSize:window.getComputedStyle(s).fontSize,letterSpacing:window.getComputedStyle(s).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.x,i=s.y,l=s.width,c=s.height,d=s.orientation,u=s.tickSize,f=s.mirror,h=s.tickMargin,m,x,g,y,v,b,w=f?-1:1,_=n.tickSize||u,j=vn(n.tickCoord)?n.tickCoord:n.coordinate;switch(d){case"top":m=x=n.coordinate,y=i+ +!f*c,g=y-w*_,b=g-w*h,v=j;break;case"left":g=y=n.coordinate,x=o+ +!f*l,m=x-w*_,v=m-w*h,b=j;break;case"right":g=y=n.coordinate,x=o+ +f*l,m=x+w*_,v=m+w*h,b=j;break;default:m=x=n.coordinate,y=i+ +f*c,g=y+w*_,b=g+w*h,v=j;break}return{line:{x1:m,y1:g,x2:x,y2:y},tick:{x:v,y:b}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,i;switch(s){case"left":i=o?"start":"end";break;case"right":i=o?"end":"start";break;default:i="middle";break}return i}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,i="end";switch(s){case"left":case"right":i="middle";break;case"top":i=o?"start":"end";break;default:i=o?"end":"start";break}return i}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.orientation,d=n.mirror,u=n.axisLine,f=Ai(Ai(Ai({},ha(this.props,!1)),ha(u,!1)),{},{fill:"none"});if(c==="top"||c==="bottom"){var h=+(c==="top"&&!d||c==="bottom"&&d);f=Ai(Ai({},f),{},{x1:s,y1:o+h*l,x2:s+i,y2:o+h*l})}else{var m=+(c==="left"&&!d||c==="right"&&d);f=Ai(Ai({},f),{},{x1:s+m*i,y1:o,x2:s+m*i,y2:o+l})}return Ee.createElement("line",_v({},f,{className:qa("recharts-cartesian-axis-line",hd(u,"className"))}))}},{key:"renderTicks",value:function(n,s,o){var i=this,l=this.props,c=l.tickLine,d=l.stroke,u=l.tick,f=l.tickFormatter,h=l.unit,m=iR(Ai(Ai({},this.props),{},{ticks:n}),s,o),x=this.getTickTextAnchor(),g=this.getTickVerticalAnchor(),y=ha(this.props,!1),v=ha(u,!1),b=Ai(Ai({},y),{},{fill:"none"},ha(c,!1)),w=m.map(function(_,j){var S=i.getTickLineCoord(_),C=S.line,A=S.tick,P=Ai(Ai(Ai(Ai({textAnchor:x,verticalAnchor:g},y),{},{stroke:"none",fill:d},v),A),{},{index:j,payload:_,visibleTicksCount:m.length,tickFormatter:f});return Ee.createElement(ns,_v({className:"recharts-cartesian-axis-tick",key:"tick-".concat(_.value,"-").concat(_.coordinate,"-").concat(_.tickCoord)},Gg(i.props,_,j)),c&&Ee.createElement("line",_v({},b,C,{className:qa("recharts-cartesian-axis-tick-line",hd(c,"className"))})),u&&t.renderTickItem(u,P,"".concat(Ea(f)?f(_.value,j):_.value).concat(h||"")))});return Ee.createElement("g",{className:"recharts-cartesian-axis-ticks"},w)}},{key:"render",value:function(){var n=this,s=this.props,o=s.axisLine,i=s.width,l=s.height,c=s.ticksGenerator,d=s.className,u=s.hide;if(u)return null;var f=this.props,h=f.ticks,m=IE(f,vze),x=h;return Ea(c)&&(x=h&&h.length>0?c(this.props):c(m)),i<=0||l<=0||!x||!x.length?null:Ee.createElement(ns,{className:qa("recharts-cartesian-axis",d),ref:function(y){n.layerReference=y}},o&&this.renderAxisLine(),this.renderTicks(x,this.state.fontSize,this.state.letterSpacing),Wi.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,s,o){var i,l=qa(s.className,"recharts-cartesian-axis-tick-value");return Ee.isValidElement(n)?i=Ee.cloneElement(n,Ai(Ai({},s),{},{className:l})):Ea(n)?i=n(Ai(Ai({},s),{},{className:l})):i=Ee.createElement(Kg,_v({},s,{className:"recharts-cartesian-axis-tick-value"}),o),i}}])}(p.Component);lR(uy,"displayName","CartesianAxis");lR(uy,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Aze=["x1","y1","x2","y2","key"],Pze=["offset"];function Jg(e){"@babel/helpers - typeof";return Jg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jg(e)}function gz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ol(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gz(Object(r),!0).forEach(function(n){Eze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Eze(e,t,r){return t=kze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kze(e){var t=Ize(e,"string");return Jg(t)=="symbol"?t:t+""}function Ize(e,t){if(Jg(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Jg(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hg(){return hg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hg.apply(this,arguments)}function xz(e,t){if(e==null)return{};var r=Oze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Oze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Tze=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,s=t.x,o=t.y,i=t.width,l=t.height,c=t.ry;return Ee.createElement("rect",{x:s,y:o,ry:c,width:i,height:l,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function _ee(e,t){var r;if(Ee.isValidElement(e))r=Ee.cloneElement(e,t);else if(Ea(e))r=e(t);else{var n=t.x1,s=t.y1,o=t.x2,i=t.y2,l=t.key,c=xz(t,Aze),d=ha(c,!1);d.offset;var u=xz(d,Pze);r=Ee.createElement("line",hg({},u,{x1:n,y1:s,x2:o,y2:i,fill:"none",key:l}))}return r}function Dze(e){var t=e.x,r=e.width,n=e.horizontal,s=n===void 0?!0:n,o=e.horizontalPoints;if(!s||!o||!o.length)return null;var i=o.map(function(l,c){var d=Ol(Ol({},e),{},{x1:t,y1:l,x2:t+r,y2:l,key:"line-".concat(c),index:c});return _ee(s,d)});return Ee.createElement("g",{className:"recharts-cartesian-grid-horizontal"},i)}function Mze(e){var t=e.y,r=e.height,n=e.vertical,s=n===void 0?!0:n,o=e.verticalPoints;if(!s||!o||!o.length)return null;var i=o.map(function(l,c){var d=Ol(Ol({},e),{},{x1:l,y1:t,x2:l,y2:t+r,key:"line-".concat(c),index:c});return _ee(s,d)});return Ee.createElement("g",{className:"recharts-cartesian-grid-vertical"},i)}function Rze(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,s=e.y,o=e.width,i=e.height,l=e.horizontalPoints,c=e.horizontal,d=c===void 0?!0:c;if(!d||!t||!t.length)return null;var u=l.map(function(h){return Math.round(h+s-s)}).sort(function(h,m){return h-m});s!==u[0]&&u.unshift(0);var f=u.map(function(h,m){var x=!u[m+1],g=x?s+i-h:u[m+1]-h;if(g<=0)return null;var y=m%t.length;return Ee.createElement("rect",{key:"react-".concat(m),y:h,x:n,height:g,width:o,stroke:"none",fill:t[y],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ee.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function Fze(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,s=e.fillOpacity,o=e.x,i=e.y,l=e.width,c=e.height,d=e.verticalPoints;if(!r||!n||!n.length)return null;var u=d.map(function(h){return Math.round(h+o-o)}).sort(function(h,m){return h-m});o!==u[0]&&u.unshift(0);var f=u.map(function(h,m){var x=!u[m+1],g=x?o+l-h:u[m+1]-h;if(g<=0)return null;var y=m%n.length;return Ee.createElement("rect",{key:"react-".concat(m),x:h,y:i,width:g,height:c,stroke:"none",fill:n[y],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return Ee.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var Lze=function(t,r){var n=t.xAxis,s=t.width,o=t.height,i=t.offset;return yZ(iR(Ol(Ol(Ol({},uy.defaultProps),n),{},{ticks:mm(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),i.left,i.left+i.width,r)},$ze=function(t,r){var n=t.yAxis,s=t.width,o=t.height,i=t.offset;return yZ(iR(Ol(Ol(Ol({},uy.defaultProps),n),{},{ticks:mm(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),i.top,i.top+i.height,r)},Lx={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function TS(e){var t,r,n,s,o,i,l=nR(),c=aR(),d=E7e(),u=Ol(Ol({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Lx.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:Lx.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:Lx.horizontal,horizontalFill:(s=e.horizontalFill)!==null&&s!==void 0?s:Lx.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:Lx.vertical,verticalFill:(i=e.verticalFill)!==null&&i!==void 0?i:Lx.verticalFill,x:vn(e.x)?e.x:d.left,y:vn(e.y)?e.y:d.top,width:vn(e.width)?e.width:d.width,height:vn(e.height)?e.height:d.height}),f=u.x,h=u.y,m=u.width,x=u.height,g=u.syncWithTicks,y=u.horizontalValues,v=u.verticalValues,b=C7e(),w=A7e();if(!vn(m)||m<=0||!vn(x)||x<=0||!vn(f)||f!==+f||!vn(h)||h!==+h)return null;var _=u.verticalCoordinatesGenerator||Lze,j=u.horizontalCoordinatesGenerator||$ze,S=u.horizontalPoints,C=u.verticalPoints;if((!S||!S.length)&&Ea(j)){var A=y&&y.length,P=j({yAxis:w?Ol(Ol({},w),{},{ticks:A?y:w.ticks}):void 0,width:l,height:c,offset:d},A?!0:g);Lu(Array.isArray(P),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Jg(P),"]")),Array.isArray(P)&&(S=P)}if((!C||!C.length)&&Ea(_)){var F=v&&v.length,O=_({xAxis:b?Ol(Ol({},b),{},{ticks:F?v:b.ticks}):void 0,width:l,height:c,offset:d},F?!0:g);Lu(Array.isArray(O),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Jg(O),"]")),Array.isArray(O)&&(C=O)}return Ee.createElement("g",{className:"recharts-cartesian-grid"},Ee.createElement(Tze,{fill:u.fill,fillOpacity:u.fillOpacity,x:u.x,y:u.y,width:u.width,height:u.height,ry:u.ry}),Ee.createElement(Dze,hg({},u,{offset:d,horizontalPoints:S,xAxis:b,yAxis:w})),Ee.createElement(Mze,hg({},u,{offset:d,verticalPoints:C,xAxis:b,yAxis:w})),Ee.createElement(Rze,hg({},u,{horizontalPoints:S})),Ee.createElement(Fze,hg({},u,{verticalPoints:C})))}TS.displayName="CartesianGrid";var Bze=["type","layout","connectNulls","ref"],qze=["key"];function A0(e){"@babel/helpers - typeof";return A0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A0(e)}function vz(e,t){if(e==null)return{};var r=zze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function zze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Xb(){return Xb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xb.apply(this,arguments)}function yz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Kc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yz(Object(r),!0).forEach(function(n){Pu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $x(e){return Hze(e)||Wze(e)||Vze(e)||Uze()}function Uze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vze(e,t){if(e){if(typeof e=="string")return zT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zT(e,t)}}function Wze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Hze(e){if(Array.isArray(e))return zT(e)}function zT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Gze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Nee(n.key),n)}}function Kze(e,t,r){return t&&bz(e.prototype,t),r&&bz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Xze(e,t,r){return t=DS(t),Yze(e,jee()?Reflect.construct(t,r||[],DS(e).constructor):t.apply(e,r))}function Yze(e,t){if(t&&(A0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jze(e)}function Jze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jee=function(){return!!e})()}function DS(e){return DS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},DS(e)}function Qze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UT(e,t)}function UT(e,t){return UT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},UT(e,t)}function Pu(e,t,r){return t=Nee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nee(e){var t=Zze(e,"string");return A0(t)=="symbol"?t:t+""}function Zze(e,t){if(A0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(A0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fy=function(e){function t(){var r;Gze(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=Xze(this,t,[].concat(s)),Pu(r,"state",{isAnimationFinished:!0,totalLength:0}),Pu(r,"generateSimpleStrokeDasharray",function(i,l){return"".concat(l,"px ").concat(i-l,"px")}),Pu(r,"getStrokeDasharray",function(i,l,c){var d=c.reduce(function(v,b){return v+b});if(!d)return r.generateSimpleStrokeDasharray(l,i);for(var u=Math.floor(i/d),f=i%d,h=l-i,m=[],x=0,g=0;x<c.length;g+=c[x],++x)if(g+c[x]>f){m=[].concat($x(c.slice(0,x)),[f-g]);break}var y=m.length%2===0?[0,h]:[h];return[].concat($x(t.repeat(c,u)),$x(m),y).map(function(v){return"".concat(v,"px")}).join(", ")}),Pu(r,"id",fx("recharts-line-")),Pu(r,"pathRef",function(i){r.mainCurve=i}),Pu(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Pu(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Qze(t,e),Kze(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.points,l=o.xAxis,c=o.yAxis,d=o.layout,u=o.children,f=pd(u,l2);if(!f)return null;var h=function(g,y){return{x:g.x,y:g.y,value:g.value,errorVal:ni(g.payload,y)}},m={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ee.createElement(ns,m,f.map(function(x){return Ee.cloneElement(x,{key:"bar-".concat(x.props.dataKey),data:i,xAxis:l,yAxis:c,layout:d,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,s,o){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.dot,d=l.points,u=l.dataKey,f=ha(this.props,!1),h=ha(c,!0),m=d.map(function(g,y){var v=Kc(Kc(Kc({key:"dot-".concat(y),r:3},f),h),{},{index:y,cx:g.x,cy:g.y,value:g.value,dataKey:u,payload:g.payload,points:d});return t.renderDotItem(c,v)}),x={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ee.createElement(ns,Xb({className:"recharts-line-dots",key:"dots"},x),m)}},{key:"renderCurveStatically",value:function(n,s,o,i){var l=this.props,c=l.type,d=l.layout,u=l.connectNulls;l.ref;var f=vz(l,Bze),h=Kc(Kc(Kc({},ha(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(o,")"):null,points:n},i),{},{type:c,layout:d,connectNulls:u});return Ee.createElement(Eg,Xb({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,s){var o=this,i=this.props,l=i.points,c=i.strokeDasharray,d=i.isAnimationActive,u=i.animationBegin,f=i.animationDuration,h=i.animationEasing,m=i.animationId,x=i.animateNewValues,g=i.width,y=i.height,v=this.state,b=v.prevPoints,w=v.totalLength;return Ee.createElement(up,{begin:u,duration:f,isActive:d,easing:h,from:{t:0},to:{t:1},key:"line-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(_){var j=_.t;if(b){var S=b.length/l.length,C=l.map(function(I,T){var k=Math.floor(T*S);if(b[k]){var B=b[k],z=Ti(B.x,I.x),U=Ti(B.y,I.y);return Kc(Kc({},I),{},{x:z(j),y:U(j)})}if(x){var L=Ti(g*2,I.x),W=Ti(y/2,I.y);return Kc(Kc({},I),{},{x:L(j),y:W(j)})}return Kc(Kc({},I),{},{x:I.x,y:I.y})});return o.renderCurveStatically(C,n,s)}var A=Ti(0,w),P=A(j),F;if(c){var O="".concat(c).split(/[,\s]+/gim).map(function(I){return parseFloat(I)});F=o.getStrokeDasharray(P,w,O)}else F=o.generateSimpleStrokeDasharray(w,P);return o.renderCurveStatically(l,n,s,{strokeDasharray:F})})}},{key:"renderCurve",value:function(n,s){var o=this.props,i=o.points,l=o.isAnimationActive,c=this.state,d=c.prevPoints,u=c.totalLength;return l&&i&&i.length&&(!d&&u>0||!Xg(d,i))?this.renderCurveWithAnimation(n,s):this.renderCurveStatically(i,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,i=s.dot,l=s.points,c=s.className,d=s.xAxis,u=s.yAxis,f=s.top,h=s.left,m=s.width,x=s.height,g=s.isAnimationActive,y=s.id;if(o||!l||!l.length)return null;var v=this.state.isAnimationFinished,b=l.length===1,w=qa("recharts-line",c),_=d&&d.allowDataOverflow,j=u&&u.allowDataOverflow,S=_||j,C=La(y)?this.id:y,A=(n=ha(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},P=A.r,F=P===void 0?3:P,O=A.strokeWidth,I=O===void 0?2:O,T=uJ(i)?i:{},k=T.clipDot,B=k===void 0?!0:k,z=F*2+I;return Ee.createElement(ns,{className:w},_||j?Ee.createElement("defs",null,Ee.createElement("clipPath",{id:"clipPath-".concat(C)},Ee.createElement("rect",{x:_?h:h-m/2,y:j?f:f-x/2,width:_?m:m*2,height:j?x:x*2})),!B&&Ee.createElement("clipPath",{id:"clipPath-dots-".concat(C)},Ee.createElement("rect",{x:h-z/2,y:f-z/2,width:m+z,height:x+z}))):null,!b&&this.renderCurve(S,C),this.renderErrorBar(S,C),(b||i)&&this.renderDots(S,B,C),(!g||v)&&kf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:s.curPoints}:n.points!==s.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,s){for(var o=n.length%2!==0?[].concat($x(n),[0]):n,i=[],l=0;l<s;++l)i=[].concat($x(i),$x(o));return i}},{key:"renderDotItem",value:function(n,s){var o;if(Ee.isValidElement(n))o=Ee.cloneElement(n,s);else if(Ea(n))o=n(s);else{var i=s.key,l=vz(s,qze),c=qa("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ee.createElement(c2,Xb({key:i},l,{className:c}))}return o}}])}(p.PureComponent);Pu(fy,"displayName","Line");Pu(fy,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!$u.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Pu(fy,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,s=e.xAxisTicks,o=e.yAxisTicks,i=e.dataKey,l=e.bandSize,c=e.displayedData,d=e.offset,u=t.layout,f=c.map(function(h,m){var x=ni(h,i);return u==="horizontal"?{x:cS({axis:r,ticks:s,bandSize:l,entry:h,index:m}),y:La(x)?null:n.scale(x),value:x,payload:h}:{x:La(x)?null:r.scale(x),y:cS({axis:n,ticks:o,bandSize:l,entry:h,index:m}),value:x,payload:h}});return Kc({points:f,layout:u},d)});var e9e=["layout","type","stroke","connectNulls","isRange","ref"],t9e=["key"],See;function P0(e){"@babel/helpers - typeof";return P0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P0(e)}function Cee(e,t){if(e==null)return{};var r=r9e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function r9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function pg(){return pg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pg.apply(this,arguments)}function wz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ih(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wz(Object(r),!0).forEach(function(n){wf(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function n9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pee(n.key),n)}}function a9e(e,t,r){return t&&_z(e.prototype,t),r&&_z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s9e(e,t,r){return t=MS(t),o9e(e,Aee()?Reflect.construct(t,r||[],MS(e).constructor):t.apply(e,r))}function o9e(e,t){if(t&&(P0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return i9e(e)}function i9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Aee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Aee=function(){return!!e})()}function MS(e){return MS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},MS(e)}function l9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&VT(e,t)}function VT(e,t){return VT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},VT(e,t)}function wf(e,t,r){return t=Pee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pee(e){var t=c9e(e,"string");return P0(t)=="symbol"?t:t+""}function c9e(e,t){if(P0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(P0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ap=function(e){function t(){var r;n9e(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=s9e(this,t,[].concat(s)),wf(r,"state",{isAnimationFinished:!0}),wf(r,"id",fx("recharts-area-")),wf(r,"handleAnimationEnd",function(){var i=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),Ea(i)&&i()}),wf(r,"handleAnimationStart",function(){var i=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),Ea(i)&&i()}),r}return l9e(t,e),a9e(t,[{key:"renderDots",value:function(n,s,o){var i=this.props.isAnimationActive,l=this.state.isAnimationFinished;if(i&&!l)return null;var c=this.props,d=c.dot,u=c.points,f=c.dataKey,h=ha(this.props,!1),m=ha(d,!0),x=u.map(function(y,v){var b=ih(ih(ih({key:"dot-".concat(v),r:3},h),m),{},{index:v,cx:y.x,cy:y.y,dataKey:f,value:y.value,payload:y.payload,points:u});return t.renderDotItem(d,b)}),g={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ee.createElement(ns,pg({className:"recharts-area-dots"},g),x)}},{key:"renderHorizontalRect",value:function(n){var s=this.props,o=s.baseLine,i=s.points,l=s.strokeWidth,c=i[0].x,d=i[i.length-1].x,u=n*Math.abs(c-d),f=Sh(i.map(function(h){return h.y||0}));return vn(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(Sh(o.map(function(h){return h.y||0})),f)),vn(f)?Ee.createElement("rect",{x:c<d?c:c-u,y:0,width:u,height:Math.floor(f+(l?parseInt("".concat(l),10):1))}):null}},{key:"renderVerticalRect",value:function(n){var s=this.props,o=s.baseLine,i=s.points,l=s.strokeWidth,c=i[0].y,d=i[i.length-1].y,u=n*Math.abs(c-d),f=Sh(i.map(function(h){return h.x||0}));return vn(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(Sh(o.map(function(h){return h.x||0})),f)),vn(f)?Ee.createElement("rect",{x:0,y:c<d?c:c-u,width:f+(l?parseInt("".concat(l),10):1),height:Math.floor(u)}):null}},{key:"renderClipRect",value:function(n){var s=this.props.layout;return s==="vertical"?this.renderVerticalRect(n):this.renderHorizontalRect(n)}},{key:"renderAreaStatically",value:function(n,s,o,i){var l=this.props,c=l.layout,d=l.type,u=l.stroke,f=l.connectNulls,h=l.isRange;l.ref;var m=Cee(l,e9e);return Ee.createElement(ns,{clipPath:o?"url(#clipPath-".concat(i,")"):null},Ee.createElement(Eg,pg({},ha(m,!0),{points:n,connectNulls:f,type:d,baseLine:s,layout:c,stroke:"none",className:"recharts-area-area"})),u!=="none"&&Ee.createElement(Eg,pg({},ha(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:n})),u!=="none"&&h&&Ee.createElement(Eg,pg({},ha(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:s})))}},{key:"renderAreaWithAnimation",value:function(n,s){var o=this,i=this.props,l=i.points,c=i.baseLine,d=i.isAnimationActive,u=i.animationBegin,f=i.animationDuration,h=i.animationEasing,m=i.animationId,x=this.state,g=x.prevPoints,y=x.prevBaseLine;return Ee.createElement(up,{begin:u,duration:f,isActive:d,easing:h,from:{t:0},to:{t:1},key:"area-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(v){var b=v.t;if(g){var w=g.length/l.length,_=l.map(function(A,P){var F=Math.floor(P*w);if(g[F]){var O=g[F],I=Ti(O.x,A.x),T=Ti(O.y,A.y);return ih(ih({},A),{},{x:I(b),y:T(b)})}return A}),j;if(vn(c)&&typeof c=="number"){var S=Ti(y,c);j=S(b)}else if(La(c)||ay(c)){var C=Ti(y,0);j=C(b)}else j=c.map(function(A,P){var F=Math.floor(P*w);if(y[F]){var O=y[F],I=Ti(O.x,A.x),T=Ti(O.y,A.y);return ih(ih({},A),{},{x:I(b),y:T(b)})}return A});return o.renderAreaStatically(_,j,n,s)}return Ee.createElement(ns,null,Ee.createElement("defs",null,Ee.createElement("clipPath",{id:"animationClipPath-".concat(s)},o.renderClipRect(b))),Ee.createElement(ns,{clipPath:"url(#animationClipPath-".concat(s,")")},o.renderAreaStatically(l,c,n,s)))})}},{key:"renderArea",value:function(n,s){var o=this.props,i=o.points,l=o.baseLine,c=o.isAnimationActive,d=this.state,u=d.prevPoints,f=d.prevBaseLine,h=d.totalLength;return c&&i&&i.length&&(!u&&h>0||!Xg(u,i)||!Xg(f,l))?this.renderAreaWithAnimation(n,s):this.renderAreaStatically(i,l,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,i=s.dot,l=s.points,c=s.className,d=s.top,u=s.left,f=s.xAxis,h=s.yAxis,m=s.width,x=s.height,g=s.isAnimationActive,y=s.id;if(o||!l||!l.length)return null;var v=this.state.isAnimationFinished,b=l.length===1,w=qa("recharts-area",c),_=f&&f.allowDataOverflow,j=h&&h.allowDataOverflow,S=_||j,C=La(y)?this.id:y,A=(n=ha(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},P=A.r,F=P===void 0?3:P,O=A.strokeWidth,I=O===void 0?2:O,T=uJ(i)?i:{},k=T.clipDot,B=k===void 0?!0:k,z=F*2+I;return Ee.createElement(ns,{className:w},_||j?Ee.createElement("defs",null,Ee.createElement("clipPath",{id:"clipPath-".concat(C)},Ee.createElement("rect",{x:_?u:u-m/2,y:j?d:d-x/2,width:_?m:m*2,height:j?x:x*2})),!B&&Ee.createElement("clipPath",{id:"clipPath-dots-".concat(C)},Ee.createElement("rect",{x:u-z/2,y:d-z/2,width:m+z,height:x+z}))):null,b?null:this.renderArea(S,C),(i||b)&&this.renderDots(S,B,C),(!g||v)&&kf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,curBaseLine:n.baseLine,prevPoints:s.curPoints,prevBaseLine:s.curBaseLine}:n.points!==s.curPoints||n.baseLine!==s.curBaseLine?{curPoints:n.points,curBaseLine:n.baseLine}:null}}])}(p.PureComponent);See=Ap;wf(Ap,"displayName","Area");wf(Ap,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!$u.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});wf(Ap,"getBaseValue",function(e,t,r,n){var s=e.layout,o=e.baseValue,i=t.props.baseValue,l=i??o;if(vn(l)&&typeof l=="number")return l;var c=s==="horizontal"?n:r,d=c.scale.domain();if(c.type==="number"){var u=Math.max(d[0],d[1]),f=Math.min(d[0],d[1]);return l==="dataMin"?f:l==="dataMax"||u<0?u:Math.max(Math.min(d[0],d[1]),0)}return l==="dataMin"?d[0]:l==="dataMax"?d[1]:d[0]});wf(Ap,"getComposedData",function(e){var t=e.props,r=e.item,n=e.xAxis,s=e.yAxis,o=e.xAxisTicks,i=e.yAxisTicks,l=e.bandSize,c=e.dataKey,d=e.stackedData,u=e.dataStartIndex,f=e.displayedData,h=e.offset,m=t.layout,x=d&&d.length,g=See.getBaseValue(t,r,n,s),y=m==="horizontal",v=!1,b=f.map(function(_,j){var S;x?S=d[u+j]:(S=ni(_,c),Array.isArray(S)?v=!0:S=[g,S]);var C=S[1]==null||x&&ni(_,c)==null;return y?{x:cS({axis:n,ticks:o,bandSize:l,entry:_,index:j}),y:C?null:s.scale(S[1]),value:S,payload:_}:{x:C?null:n.scale(S[1]),y:cS({axis:s,ticks:i,bandSize:l,entry:_,index:j}),value:S,payload:_}}),w;return x||v?w=b.map(function(_){var j=Array.isArray(_.value)?_.value[0]:null;return y?{x:_.x,y:j!=null&&_.y!=null?s.scale(j):null}:{x:j!=null?n.scale(j):null,y:_.y}}):w=y?s.scale(g):n.scale(g),ih({points:b,baseLine:w,layout:m,isRange:v},h)});wf(Ap,"renderDotItem",function(e,t){var r;if(Ee.isValidElement(e))r=Ee.cloneElement(e,t);else if(Ea(e))r=e(t);else{var n=qa("recharts-area-dot",typeof e!="boolean"?e.className:""),s=t.key,o=Cee(t,t9e);r=Ee.createElement(c2,pg({},o,{key:s,className:n}))}return r});function E0(e){"@babel/helpers - typeof";return E0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E0(e)}function d9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Iee(n.key),n)}}function u9e(e,t,r){return t&&jz(e.prototype,t),r&&jz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function f9e(e,t,r){return t=RS(t),m9e(e,Eee()?Reflect.construct(t,r||[],RS(e).constructor):t.apply(e,r))}function m9e(e,t){if(t&&(E0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return h9e(e)}function h9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Eee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Eee=function(){return!!e})()}function RS(e){return RS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},RS(e)}function p9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WT(e,t)}function WT(e,t){return WT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},WT(e,t)}function kee(e,t,r){return t=Iee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Iee(e){var t=g9e(e,"string");return E0(t)=="symbol"?t:t+""}function g9e(e,t){if(E0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(E0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HT(){return HT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HT.apply(this,arguments)}function x9e(e){var t=e.xAxisId,r=nR(),n=aR(),s=uee(t);return s==null?null:p.createElement(uy,HT({},s,{className:qa("recharts-".concat(s.axisType," ").concat(s.axisType),s.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(i){return mm(i,!0)}}))}var fp=function(e){function t(){return d9e(this,t),f9e(this,t,arguments)}return p9e(t,e),u9e(t,[{key:"render",value:function(){return p.createElement(x9e,this.props)}}])}(p.Component);kee(fp,"displayName","XAxis");kee(fp,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function k0(e){"@babel/helpers - typeof";return k0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k0(e)}function v9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dee(n.key),n)}}function y9e(e,t,r){return t&&Nz(e.prototype,t),r&&Nz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function b9e(e,t,r){return t=FS(t),w9e(e,Oee()?Reflect.construct(t,r||[],FS(e).constructor):t.apply(e,r))}function w9e(e,t){if(t&&(k0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _9e(e)}function _9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Oee=function(){return!!e})()}function FS(e){return FS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},FS(e)}function j9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GT(e,t)}function GT(e,t){return GT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},GT(e,t)}function Tee(e,t,r){return t=Dee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dee(e){var t=N9e(e,"string");return k0(t)=="symbol"?t:t+""}function N9e(e,t){if(k0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(k0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KT(){return KT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KT.apply(this,arguments)}var S9e=function(t){var r=t.yAxisId,n=nR(),s=aR(),o=fee(r);return o==null?null:p.createElement(uy,KT({},o,{className:qa("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:s},ticksGenerator:function(l){return mm(l,!0)}}))},mp=function(e){function t(){return v9e(this,t),b9e(this,t,arguments)}return j9e(t,e),y9e(t,[{key:"render",value:function(){return p.createElement(S9e,this.props)}}])}(p.Component);Tee(mp,"displayName","YAxis");Tee(mp,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function Sz(e){return E9e(e)||P9e(e)||A9e(e)||C9e()}function C9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A9e(e,t){if(e){if(typeof e=="string")return XT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return XT(e,t)}}function P9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function E9e(e){if(Array.isArray(e))return XT(e)}function XT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var YT=function(t,r,n,s,o){var i=pd(t,oR),l=pd(t,Y5),c=[].concat(Sz(i),Sz(l)),d=pd(t,Q5),u="".concat(s,"Id"),f=s[0],h=r;if(c.length&&(h=c.reduce(function(g,y){if(y.props[u]===n&&If(y.props,"extendDomain")&&vn(y.props[f])){var v=y.props[f];return[Math.min(g[0],v),Math.max(g[1],v)]}return g},h)),d.length){var m="".concat(f,"1"),x="".concat(f,"2");h=d.reduce(function(g,y){if(y.props[u]===n&&If(y.props,"extendDomain")&&vn(y.props[m])&&vn(y.props[x])){var v=y.props[m],b=y.props[x];return[Math.min(g[0],v,b),Math.max(g[1],v,b)]}return g},h)}return o&&o.length&&(h=o.reduce(function(g,y){return vn(y)?[Math.min(g[0],y),Math.max(g[1],y)]:g},h)),h},Mee={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function s(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function o(c,d,u,f,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new s(u,f||c,h),x=r?r+d:d;return c._events[x]?c._events[x].fn?c._events[x]=[c._events[x],m]:c._events[x].push(m):(c._events[x]=m,c._eventsCount++),c}function i(c,d){--c._eventsCount===0?c._events=new n:delete c._events[d]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],u,f;if(this._eventsCount===0)return d;for(f in u=this._events)t.call(u,f)&&d.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},l.prototype.listeners=function(d){var u=r?r+d:d,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,m=f.length,x=new Array(m);h<m;h++)x[h]=f[h].fn;return x},l.prototype.listenerCount=function(d){var u=r?r+d:d,f=this._events[u];return f?f.fn?1:f.length:0},l.prototype.emit=function(d,u,f,h,m,x){var g=r?r+d:d;if(!this._events[g])return!1;var y=this._events[g],v=arguments.length,b,w;if(y.fn){switch(y.once&&this.removeListener(d,y.fn,void 0,!0),v){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,u),!0;case 3:return y.fn.call(y.context,u,f),!0;case 4:return y.fn.call(y.context,u,f,h),!0;case 5:return y.fn.call(y.context,u,f,h,m),!0;case 6:return y.fn.call(y.context,u,f,h,m,x),!0}for(w=1,b=new Array(v-1);w<v;w++)b[w-1]=arguments[w];y.fn.apply(y.context,b)}else{var _=y.length,j;for(w=0;w<_;w++)switch(y[w].once&&this.removeListener(d,y[w].fn,void 0,!0),v){case 1:y[w].fn.call(y[w].context);break;case 2:y[w].fn.call(y[w].context,u);break;case 3:y[w].fn.call(y[w].context,u,f);break;case 4:y[w].fn.call(y[w].context,u,f,h);break;default:if(!b)for(j=1,b=new Array(v-1);j<v;j++)b[j-1]=arguments[j];y[w].fn.apply(y[w].context,b)}}return!0},l.prototype.on=function(d,u,f){return o(this,d,u,f,!1)},l.prototype.once=function(d,u,f){return o(this,d,u,f,!0)},l.prototype.removeListener=function(d,u,f,h){var m=r?r+d:d;if(!this._events[m])return this;if(!u)return i(this,m),this;var x=this._events[m];if(x.fn)x.fn===u&&(!h||x.once)&&(!f||x.context===f)&&i(this,m);else{for(var g=0,y=[],v=x.length;g<v;g++)(x[g].fn!==u||h&&!x[g].once||f&&x[g].context!==f)&&y.push(x[g]);y.length?this._events[m]=y.length===1?y[0]:y:i(this,m)}return this},l.prototype.removeAllListeners=function(d){var u;return d?(u=r?r+d:d,this._events[u]&&i(this,u)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l})(Mee);var k9e=Mee.exports;const I9e=xs(k9e);var OE=new I9e,TE="recharts.syncMouseEvents";function y1(e){"@babel/helpers - typeof";return y1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y1(e)}function O9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ree(n.key),n)}}function T9e(e,t,r){return t&&Cz(e.prototype,t),r&&Cz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function DE(e,t,r){return t=Ree(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ree(e){var t=D9e(e,"string");return y1(t)=="symbol"?t:t+""}function D9e(e,t){if(y1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(y1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var M9e=function(){function e(){O9e(this,e),DE(this,"activeIndex",0),DE(this,"coordinateList",[]),DE(this,"layout","horizontal")}return T9e(e,[{key:"setDetails",value:function(r){var n,s=r.coordinateList,o=s===void 0?null:s,i=r.container,l=i===void 0?null:i,c=r.layout,d=c===void 0?null:c,u=r.offset,f=u===void 0?null:u,h=r.mouseHandlerCallback,m=h===void 0?null:h;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=l??this.container,this.layout=d??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=m??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var s=this.container.getBoundingClientRect(),o=s.x,i=s.y,l=s.height,c=this.coordinateList[this.activeIndex].coordinate,d=((r=window)===null||r===void 0?void 0:r.scrollX)||0,u=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=o+c+d,h=i+this.offset.top+l/2+u;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function R9e(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],s=e?.[1];if(n&&s&&vn(n)&&vn(s))return!0}return!1}function F9e(e,t,r,n){var s=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-s:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-s,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function Fee(e){var t=e.cx,r=e.cy,n=e.radius,s=e.startAngle,o=e.endAngle,i=uo(t,r,n,s),l=uo(t,r,n,o);return{points:[i,l],cx:t,cy:r,radius:n,startAngle:s,endAngle:o}}function L9e(e,t,r){var n,s,o,i;if(e==="horizontal")n=t.x,o=n,s=r.top,i=r.top+r.height;else if(e==="vertical")s=t.y,i=s,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var l=t.cx,c=t.cy,d=t.innerRadius,u=t.outerRadius,f=t.angle,h=uo(l,c,d,f),m=uo(l,c,u,f);n=h.x,s=h.y,o=m.x,i=m.y}else return Fee(t);return[{x:n,y:s},{x:o,y:i}]}function b1(e){"@babel/helpers - typeof";return b1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b1(e)}function Az(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function L_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Az(Object(r),!0).forEach(function(n){$9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Az(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $9e(e,t,r){return t=B9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B9e(e){var t=q9e(e,"string");return b1(t)=="symbol"?t:t+""}function q9e(e,t){if(b1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(b1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function z9e(e){var t,r,n=e.element,s=e.tooltipEventType,o=e.isActive,i=e.activeCoordinate,l=e.activePayload,c=e.offset,d=e.activeTooltipIndex,u=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,m=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!m||!o||!i||h!=="ScatterChart"&&s!=="axis")return null;var x,g=Eg;if(h==="ScatterChart")x=i,g=r8e;else if(h==="BarChart")x=F9e(f,i,c,u),g=QM;else if(f==="radial"){var y=Fee(i),v=y.cx,b=y.cy,w=y.radius,_=y.startAngle,j=y.endAngle;x={cx:v,cy:b,startAngle:_,endAngle:j,innerRadius:w,outerRadius:w},g=JM}else x={points:L9e(f,i,c)},g=Eg;var S=L_(L_(L_(L_({stroke:"#ccc",pointerEvents:"none"},c),x),ha(m,!1)),{},{payload:l,payloadIndex:d,className:qa("recharts-tooltip-cursor",m.className)});return p.isValidElement(m)?p.cloneElement(m,S):p.createElement(g,S)}var U9e=["item"],V9e=["children","className","width","height","style","compact","title","desc"];function I0(e){"@babel/helpers - typeof";return I0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I0(e)}function jv(){return jv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jv.apply(this,arguments)}function Pz(e,t){return G9e(e)||H9e(e,t)||$ee(e,t)||W9e()}function W9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function G9e(e){if(Array.isArray(e))return e}function Ez(e,t){if(e==null)return{};var r=K9e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function K9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function X9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Bee(n.key),n)}}function Y9e(e,t,r){return t&&kz(e.prototype,t),r&&kz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function J9e(e,t,r){return t=LS(t),Q9e(e,Lee()?Reflect.construct(t,r||[],LS(e).constructor):t.apply(e,r))}function Q9e(e,t){if(t&&(I0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Z9e(e)}function Z9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lee=function(){return!!e})()}function LS(e){return LS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},LS(e)}function eUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JT(e,t)}function JT(e,t){return JT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},JT(e,t)}function O0(e){return nUe(e)||rUe(e)||$ee(e)||tUe()}function tUe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $ee(e,t){if(e){if(typeof e=="string")return QT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return QT(e,t)}}function rUe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nUe(e){if(Array.isArray(e))return QT(e)}function QT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Fr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Iz(Object(r),!0).forEach(function(n){Aa(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Aa(e,t,r){return t=Bee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bee(e){var t=aUe(e,"string");return I0(t)=="symbol"?t:t+""}function aUe(e,t){if(I0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(I0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sUe={xAxis:["bottom","top"],yAxis:["left","right"]},oUe={width:"100%",height:"100%"},qee={x:0,y:0};function $_(e){return e}var iUe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},lUe=function(t,r,n,s){var o=r.find(function(u){return u&&u.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:s.y};if(t==="vertical")return{x:s.x,y:o.coordinate};if(t==="centric"){var i=o.coordinate,l=s.radius;return Fr(Fr(Fr({},s),uo(s.cx,s.cy,l,i)),{},{angle:i,radius:l})}var c=o.coordinate,d=s.angle;return Fr(Fr(Fr({},s),uo(s.cx,s.cy,c,d)),{},{angle:d,radius:c})}return qee},Z5=function(t,r){var n=r.graphicalItems,s=r.dataStartIndex,o=r.dataEndIndex,i=(n??[]).reduce(function(l,c){var d=c.props.data;return d&&d.length?[].concat(O0(l),O0(d)):l},[]);return i.length>0?i:t&&t.length&&vn(s)&&vn(o)?t.slice(s,o+1):[]};function zee(e){return e==="number"?[0,"auto"]:void 0}var ZT=function(t,r,n,s){var o=t.graphicalItems,i=t.tooltipAxis,l=Z5(r,t);return n<0||!o||!o.length||n>=l.length?null:o.reduce(function(c,d){var u,f=(u=d.props.data)!==null&&u!==void 0?u:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(i.dataKey&&!i.allowDuplicatedCategory){var m=f===void 0?l:f;h=MN(m,i.dataKey,s)}else h=f&&f[n]||l[n];return h?[].concat(O0(c),[NZ(d,h)]):c},[])},Oz=function(t,r,n,s){var o=s||{x:t.chartX,y:t.chartY},i=iUe(o,n),l=t.orderedTooltipTicks,c=t.tooltipAxis,d=t.tooltipTicks,u=AFe(i,l,d,c);if(u>=0&&d){var f=d[u]&&d[u].value,h=ZT(t,r,u,f),m=lUe(n,l,u,o);return{activeTooltipIndex:u,activeLabel:f,activePayload:h,activeCoordinate:m}}return null},cUe=function(t,r){var n=r.axes,s=r.graphicalItems,o=r.axisType,i=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.layout,f=t.children,h=t.stackOffset,m=vZ(u,o);return n.reduce(function(x,g){var y,v=g.type.defaultProps!==void 0?Fr(Fr({},g.type.defaultProps),g.props):g.props,b=v.type,w=v.dataKey,_=v.allowDataOverflow,j=v.allowDuplicatedCategory,S=v.scale,C=v.ticks,A=v.includeHidden,P=v[i];if(x[P])return x;var F=Z5(t.data,{graphicalItems:s.filter(function(V){var $,Y=i in V.props?V.props[i]:($=V.type.defaultProps)===null||$===void 0?void 0:$[i];return Y===P}),dataStartIndex:c,dataEndIndex:d}),O=F.length,I,T,k;R9e(v.domain,_,b)&&(I=fT(v.domain,null,_),m&&(b==="number"||S!=="auto")&&(k=Wb(F,w,"category")));var B=zee(b);if(!I||I.length===0){var z,U=(z=v.domain)!==null&&z!==void 0?z:B;if(w){if(I=Wb(F,w,b),b==="category"&&m){var L=bSe(I);j&&L?(T=I,I=jS(0,O)):j||(I=Vq(U,I,g).reduce(function(V,$){return V.indexOf($)>=0?V:[].concat(O0(V),[$])},[]))}else if(b==="category")j?I=I.filter(function(V){return V!==""&&!La(V)}):I=Vq(U,I,g).reduce(function(V,$){return V.indexOf($)>=0||$===""||La($)?V:[].concat(O0(V),[$])},[]);else if(b==="number"){var W=OFe(F,s.filter(function(V){var $,Y,he=i in V.props?V.props[i]:($=V.type.defaultProps)===null||$===void 0?void 0:$[i],J="hide"in V.props?V.props.hide:(Y=V.type.defaultProps)===null||Y===void 0?void 0:Y.hide;return he===P&&(A||!J)}),w,o,u);W&&(I=W)}m&&(b==="number"||S!=="auto")&&(k=Wb(F,w,"category"))}else m?I=jS(0,O):l&&l[P]&&l[P].hasStack&&b==="number"?I=h==="expand"?[0,1]:jZ(l[P].stackGroups,c,d):I=xZ(F,s.filter(function(V){var $=i in V.props?V.props[i]:V.type.defaultProps[i],Y="hide"in V.props?V.props.hide:V.type.defaultProps.hide;return $===P&&(A||!Y)}),b,u,!0);if(b==="number")I=YT(f,I,P,o,C),U&&(I=fT(U,I,_));else if(b==="category"&&U){var ge=U,Ae=I.every(function(V){return ge.indexOf(V)>=0});Ae&&(I=ge)}}return Fr(Fr({},x),{},Aa({},P,Fr(Fr({},v),{},{axisType:o,domain:I,categoricalDomain:k,duplicateDomain:T,originalDomain:(y=v.domain)!==null&&y!==void 0?y:B,isCategorical:m,layout:u})))},{})},dUe=function(t,r){var n=r.graphicalItems,s=r.Axis,o=r.axisType,i=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.layout,f=t.children,h=Z5(t.data,{graphicalItems:n,dataStartIndex:c,dataEndIndex:d}),m=h.length,x=vZ(u,o),g=-1;return n.reduce(function(y,v){var b=v.type.defaultProps!==void 0?Fr(Fr({},v.type.defaultProps),v.props):v.props,w=b[i],_=zee("number");if(!y[w]){g++;var j;return x?j=jS(0,m):l&&l[w]&&l[w].hasStack?(j=jZ(l[w].stackGroups,c,d),j=YT(f,j,w,o)):(j=fT(_,xZ(h,n.filter(function(S){var C,A,P=i in S.props?S.props[i]:(C=S.type.defaultProps)===null||C===void 0?void 0:C[i],F="hide"in S.props?S.props.hide:(A=S.type.defaultProps)===null||A===void 0?void 0:A.hide;return P===w&&!F}),"number",u),s.defaultProps.allowDataOverflow),j=YT(f,j,w,o)),Fr(Fr({},y),{},Aa({},w,Fr(Fr({axisType:o},s.defaultProps),{},{hide:!0,orientation:hd(sUe,"".concat(o,".").concat(g%2),null),domain:j,originalDomain:_,isCategorical:x,layout:u})))}return y},{})},uUe=function(t,r){var n=r.axisType,s=n===void 0?"xAxis":n,o=r.AxisComp,i=r.graphicalItems,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.children,f="".concat(s,"Id"),h=pd(u,o),m={};return h&&h.length?m=cUe(t,{axes:h,graphicalItems:i,axisType:s,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:d}):i&&i.length&&(m=dUe(t,{Axis:o,graphicalItems:i,axisType:s,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:d})),m},fUe=function(t){var r=xh(t),n=mm(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:NM(n,function(s){return s.coordinate}),tooltipAxis:r,tooltipAxisBandSize:dS(r,n)}},Tz=function(t){var r=t.children,n=t.defaultShowTooltip,s=ed(r,w0),o=0,i=0;return t.data&&t.data.length!==0&&(i=t.data.length-1),s&&s.props&&(s.props.startIndex>=0&&(o=s.props.startIndex),s.props.endIndex>=0&&(i=s.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:i,activeTooltipIndex:-1,isTooltipActive:!!n}},mUe=function(t){return!t||!t.length?!1:t.some(function(r){var n=vm(r&&r.type);return n&&n.indexOf("Bar")>=0})},Dz=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},hUe=function(t,r){var n=t.props,s=t.graphicalItems,o=t.xAxisMap,i=o===void 0?{}:o,l=t.yAxisMap,c=l===void 0?{}:l,d=n.width,u=n.height,f=n.children,h=n.margin||{},m=ed(f,w0),x=ed(f,Cg),g=Object.keys(c).reduce(function(j,S){var C=c[S],A=C.orientation;return!C.mirror&&!C.hide?Fr(Fr({},j),{},Aa({},A,j[A]+C.width)):j},{left:h.left||0,right:h.right||0}),y=Object.keys(i).reduce(function(j,S){var C=i[S],A=C.orientation;return!C.mirror&&!C.hide?Fr(Fr({},j),{},Aa({},A,hd(j,"".concat(A))+C.height)):j},{top:h.top||0,bottom:h.bottom||0}),v=Fr(Fr({},y),g),b=v.bottom;m&&(v.bottom+=m.props.height||w0.defaultProps.height),x&&r&&(v=kFe(v,s,n,r));var w=d-v.left-v.right,_=u-v.top-v.bottom;return Fr(Fr({brushBottom:b},v),{},{width:Math.max(w,0),height:Math.max(_,0)})},pUe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},eA=function(t){var r=t.chartName,n=t.GraphicalChild,s=t.defaultTooltipEventType,o=s===void 0?"axis":s,i=t.validateTooltipEventTypes,l=i===void 0?["axis"]:i,c=t.axisComponents,d=t.legendContent,u=t.formatAxisMap,f=t.defaultProps,h=function(v,b){var w=b.graphicalItems,_=b.stackGroups,j=b.offset,S=b.updateId,C=b.dataStartIndex,A=b.dataEndIndex,P=v.barSize,F=v.layout,O=v.barGap,I=v.barCategoryGap,T=v.maxBarSize,k=Dz(F),B=k.numericAxisName,z=k.cateAxisName,U=mUe(w),L=[];return w.forEach(function(W,ge){var Ae=Z5(v.data,{graphicalItems:[W],dataStartIndex:C,dataEndIndex:A}),V=W.type.defaultProps!==void 0?Fr(Fr({},W.type.defaultProps),W.props):W.props,$=V.dataKey,Y=V.maxBarSize,he=V["".concat(B,"Id")],J=V["".concat(z,"Id")],G={},ue=c.reduce(function(gt,er){var _e=b["".concat(er.axisType,"Map")],Pt=V["".concat(er.axisType,"Id")];_e&&_e[Pt]||er.axisType==="zAxis"||dp(!1);var Lt=_e[Pt];return Fr(Fr({},gt),{},Aa(Aa({},er.axisType,Lt),"".concat(er.axisType,"Ticks"),mm(Lt)))},G),ve=ue[z],ae=ue["".concat(z,"Ticks")],oe=_&&_[he]&&_[he].hasStack&&qFe(W,_[he].stackGroups),me=vm(W.type).indexOf("Bar")>=0,De=dS(ve,ae),ne=[],ie=U&&PFe({barSize:P,stackGroups:_,totalSize:pUe(ue,z)});if(me){var ht,pt,Ze=La(Y)?T:Y,vt=(ht=(pt=dS(ve,ae,!0))!==null&&pt!==void 0?pt:Ze)!==null&&ht!==void 0?ht:0;ne=EFe({barGap:O,barCategoryGap:I,bandSize:vt!==De?vt:De,sizeList:ie[J],maxBarSize:Ze}),vt!==De&&(ne=ne.map(function(gt){return Fr(Fr({},gt),{},{position:Fr(Fr({},gt.position),{},{offset:gt.position.offset-vt/2})})}))}var wt=W&&W.type&&W.type.getComposedData;wt&&L.push({props:Fr(Fr({},wt(Fr(Fr({},ue),{},{displayedData:Ae,props:v,dataKey:$,item:W,bandSize:De,barPosition:ne,offset:j,stackedData:oe,layout:F,dataStartIndex:C,dataEndIndex:A}))),{},Aa(Aa(Aa({key:W.key||"item-".concat(ge)},B,ue[B]),z,ue[z]),"animationId",S)),childIndex:OSe(W,v.children),item:W})}),L},m=function(v,b){var w=v.props,_=v.dataStartIndex,j=v.dataEndIndex,S=v.updateId;if(!D8({props:w}))return null;var C=w.children,A=w.layout,P=w.stackOffset,F=w.data,O=w.reverseStackOrder,I=Dz(A),T=I.numericAxisName,k=I.cateAxisName,B=pd(C,n),z=$Fe(F,B,"".concat(T,"Id"),"".concat(k,"Id"),P,O),U=c.reduce(function(V,$){var Y="".concat($.axisType,"Map");return Fr(Fr({},V),{},Aa({},Y,uUe(w,Fr(Fr({},$),{},{graphicalItems:B,stackGroups:$.axisType===T&&z,dataStartIndex:_,dataEndIndex:j}))))},{}),L=hUe(Fr(Fr({},U),{},{props:w,graphicalItems:B}),b?.legendBBox);Object.keys(U).forEach(function(V){U[V]=u(w,U[V],L,V.replace("Map",""),r)});var W=U["".concat(k,"Map")],ge=fUe(W),Ae=h(w,Fr(Fr({},U),{},{dataStartIndex:_,dataEndIndex:j,updateId:S,graphicalItems:B,stackGroups:z,offset:L}));return Fr(Fr({formattedGraphicalItems:Ae,graphicalItems:B,offset:L,stackGroups:z},ge),U)},x=function(y){function v(b){var w,_,j;return X9e(this,v),j=J9e(this,v,[b]),Aa(j,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Aa(j,"accessibilityManager",new M9e),Aa(j,"handleLegendBBoxUpdate",function(S){if(S){var C=j.state,A=C.dataStartIndex,P=C.dataEndIndex,F=C.updateId;j.setState(Fr({legendBBox:S},m({props:j.props,dataStartIndex:A,dataEndIndex:P,updateId:F},Fr(Fr({},j.state),{},{legendBBox:S}))))}}),Aa(j,"handleReceiveSyncEvent",function(S,C,A){if(j.props.syncId===S){if(A===j.eventEmitterSymbol&&typeof j.props.syncMethod!="function")return;j.applySyncEvent(C)}}),Aa(j,"handleBrushChange",function(S){var C=S.startIndex,A=S.endIndex;if(C!==j.state.dataStartIndex||A!==j.state.dataEndIndex){var P=j.state.updateId;j.setState(function(){return Fr({dataStartIndex:C,dataEndIndex:A},m({props:j.props,dataStartIndex:C,dataEndIndex:A,updateId:P},j.state))}),j.triggerSyncEvent({dataStartIndex:C,dataEndIndex:A})}}),Aa(j,"handleMouseEnter",function(S){var C=j.getMouseInfo(S);if(C){var A=Fr(Fr({},C),{},{isTooltipActive:!0});j.setState(A),j.triggerSyncEvent(A);var P=j.props.onMouseEnter;Ea(P)&&P(A,S)}}),Aa(j,"triggeredAfterMouseMove",function(S){var C=j.getMouseInfo(S),A=C?Fr(Fr({},C),{},{isTooltipActive:!0}):{isTooltipActive:!1};j.setState(A),j.triggerSyncEvent(A);var P=j.props.onMouseMove;Ea(P)&&P(A,S)}),Aa(j,"handleItemMouseEnter",function(S){j.setState(function(){return{isTooltipActive:!0,activeItem:S,activePayload:S.tooltipPayload,activeCoordinate:S.tooltipPosition||{x:S.cx,y:S.cy}}})}),Aa(j,"handleItemMouseLeave",function(){j.setState(function(){return{isTooltipActive:!1}})}),Aa(j,"handleMouseMove",function(S){S.persist(),j.throttleTriggeredAfterMouseMove(S)}),Aa(j,"handleMouseLeave",function(S){j.throttleTriggeredAfterMouseMove.cancel();var C={isTooltipActive:!1};j.setState(C),j.triggerSyncEvent(C);var A=j.props.onMouseLeave;Ea(A)&&A(C,S)}),Aa(j,"handleOuterEvent",function(S){var C=ISe(S),A=hd(j.props,"".concat(C));if(C&&Ea(A)){var P,F;/.*touch.*/i.test(C)?F=j.getMouseInfo(S.changedTouches[0]):F=j.getMouseInfo(S),A((P=F)!==null&&P!==void 0?P:{},S)}}),Aa(j,"handleClick",function(S){var C=j.getMouseInfo(S);if(C){var A=Fr(Fr({},C),{},{isTooltipActive:!0});j.setState(A),j.triggerSyncEvent(A);var P=j.props.onClick;Ea(P)&&P(A,S)}}),Aa(j,"handleMouseDown",function(S){var C=j.props.onMouseDown;if(Ea(C)){var A=j.getMouseInfo(S);C(A,S)}}),Aa(j,"handleMouseUp",function(S){var C=j.props.onMouseUp;if(Ea(C)){var A=j.getMouseInfo(S);C(A,S)}}),Aa(j,"handleTouchMove",function(S){S.changedTouches!=null&&S.changedTouches.length>0&&j.throttleTriggeredAfterMouseMove(S.changedTouches[0])}),Aa(j,"handleTouchStart",function(S){S.changedTouches!=null&&S.changedTouches.length>0&&j.handleMouseDown(S.changedTouches[0])}),Aa(j,"handleTouchEnd",function(S){S.changedTouches!=null&&S.changedTouches.length>0&&j.handleMouseUp(S.changedTouches[0])}),Aa(j,"handleDoubleClick",function(S){var C=j.props.onDoubleClick;if(Ea(C)){var A=j.getMouseInfo(S);C(A,S)}}),Aa(j,"handleContextMenu",function(S){var C=j.props.onContextMenu;if(Ea(C)){var A=j.getMouseInfo(S);C(A,S)}}),Aa(j,"triggerSyncEvent",function(S){j.props.syncId!==void 0&&OE.emit(TE,j.props.syncId,S,j.eventEmitterSymbol)}),Aa(j,"applySyncEvent",function(S){var C=j.props,A=C.layout,P=C.syncMethod,F=j.state.updateId,O=S.dataStartIndex,I=S.dataEndIndex;if(S.dataStartIndex!==void 0||S.dataEndIndex!==void 0)j.setState(Fr({dataStartIndex:O,dataEndIndex:I},m({props:j.props,dataStartIndex:O,dataEndIndex:I,updateId:F},j.state)));else if(S.activeTooltipIndex!==void 0){var T=S.chartX,k=S.chartY,B=S.activeTooltipIndex,z=j.state,U=z.offset,L=z.tooltipTicks;if(!U)return;if(typeof P=="function")B=P(L,S);else if(P==="value"){B=-1;for(var W=0;W<L.length;W++)if(L[W].value===S.activeLabel){B=W;break}}var ge=Fr(Fr({},U),{},{x:U.left,y:U.top}),Ae=Math.min(T,ge.x+ge.width),V=Math.min(k,ge.y+ge.height),$=L[B]&&L[B].value,Y=ZT(j.state,j.props.data,B),he=L[B]?{x:A==="horizontal"?L[B].coordinate:Ae,y:A==="horizontal"?V:L[B].coordinate}:qee;j.setState(Fr(Fr({},S),{},{activeLabel:$,activeCoordinate:he,activePayload:Y,activeTooltipIndex:B}))}else j.setState(S)}),Aa(j,"renderCursor",function(S){var C,A=j.state,P=A.isTooltipActive,F=A.activeCoordinate,O=A.activePayload,I=A.offset,T=A.activeTooltipIndex,k=A.tooltipAxisBandSize,B=j.getTooltipEventType(),z=(C=S.props.active)!==null&&C!==void 0?C:P,U=j.props.layout,L=S.key||"_recharts-cursor";return Ee.createElement(z9e,{key:L,activeCoordinate:F,activePayload:O,activeTooltipIndex:T,chartName:r,element:S,isActive:z,layout:U,offset:I,tooltipAxisBandSize:k,tooltipEventType:B})}),Aa(j,"renderPolarAxis",function(S,C,A){var P=hd(S,"type.axisType"),F=hd(j.state,"".concat(P,"Map")),O=S.type.defaultProps,I=O!==void 0?Fr(Fr({},O),S.props):S.props,T=F&&F[I["".concat(P,"Id")]];return p.cloneElement(S,Fr(Fr({},T),{},{className:qa(P,T.className),key:S.key||"".concat(C,"-").concat(A),ticks:mm(T,!0)}))}),Aa(j,"renderPolarGrid",function(S){var C=S.props,A=C.radialLines,P=C.polarAngles,F=C.polarRadius,O=j.state,I=O.radiusAxisMap,T=O.angleAxisMap,k=xh(I),B=xh(T),z=B.cx,U=B.cy,L=B.innerRadius,W=B.outerRadius;return p.cloneElement(S,{polarAngles:Array.isArray(P)?P:mm(B,!0).map(function(ge){return ge.coordinate}),polarRadius:Array.isArray(F)?F:mm(k,!0).map(function(ge){return ge.coordinate}),cx:z,cy:U,innerRadius:L,outerRadius:W,key:S.key||"polar-grid",radialLines:A})}),Aa(j,"renderLegend",function(){var S=j.state.formattedGraphicalItems,C=j.props,A=C.children,P=C.width,F=C.height,O=j.props.margin||{},I=P-(O.left||0)-(O.right||0),T=pZ({children:A,formattedGraphicalItems:S,legendWidth:I,legendContent:d});if(!T)return null;var k=T.item,B=Ez(T,U9e);return p.cloneElement(k,Fr(Fr({},B),{},{chartWidth:P,chartHeight:F,margin:O,onBBoxUpdate:j.handleLegendBBoxUpdate}))}),Aa(j,"renderTooltip",function(){var S,C=j.props,A=C.children,P=C.accessibilityLayer,F=ed(A,wc);if(!F)return null;var O=j.state,I=O.isTooltipActive,T=O.activeCoordinate,k=O.activePayload,B=O.activeLabel,z=O.offset,U=(S=F.props.active)!==null&&S!==void 0?S:I;return p.cloneElement(F,{viewBox:Fr(Fr({},z),{},{x:z.left,y:z.top}),active:U,label:B,payload:U?k:[],coordinate:T,accessibilityLayer:P})}),Aa(j,"renderBrush",function(S){var C=j.props,A=C.margin,P=C.data,F=j.state,O=F.offset,I=F.dataStartIndex,T=F.dataEndIndex,k=F.updateId;return p.cloneElement(S,{key:S.key||"_recharts-brush",onChange:D_(j.handleBrushChange,S.props.onChange),data:P,x:vn(S.props.x)?S.props.x:O.left,y:vn(S.props.y)?S.props.y:O.top+O.height+O.brushBottom-(A.bottom||0),width:vn(S.props.width)?S.props.width:O.width,startIndex:I,endIndex:T,updateId:"brush-".concat(k)})}),Aa(j,"renderReferenceElement",function(S,C,A){if(!S)return null;var P=j,F=P.clipPathId,O=j.state,I=O.xAxisMap,T=O.yAxisMap,k=O.offset,B=S.type.defaultProps||{},z=S.props,U=z.xAxisId,L=U===void 0?B.xAxisId:U,W=z.yAxisId,ge=W===void 0?B.yAxisId:W;return p.cloneElement(S,{key:S.key||"".concat(C,"-").concat(A),xAxis:I[L],yAxis:T[ge],viewBox:{x:k.left,y:k.top,width:k.width,height:k.height},clipPathId:F})}),Aa(j,"renderActivePoints",function(S){var C=S.item,A=S.activePoint,P=S.basePoint,F=S.childIndex,O=S.isRange,I=[],T=C.props.key,k=C.item.type.defaultProps!==void 0?Fr(Fr({},C.item.type.defaultProps),C.item.props):C.item.props,B=k.activeDot,z=k.dataKey,U=Fr(Fr({index:F,dataKey:z,cx:A.x,cy:A.y,r:4,fill:YM(C.item),strokeWidth:2,stroke:"#fff",payload:A.payload,value:A.value},ha(B,!1)),RN(B));return I.push(v.renderActiveDot(B,U,"".concat(T,"-activePoint-").concat(F))),P?I.push(v.renderActiveDot(B,Fr(Fr({},U),{},{cx:P.x,cy:P.y}),"".concat(T,"-basePoint-").concat(F))):O&&I.push(null),I}),Aa(j,"renderGraphicChild",function(S,C,A){var P=j.filterFormatItem(S,C,A);if(!P)return null;var F=j.getTooltipEventType(),O=j.state,I=O.isTooltipActive,T=O.tooltipAxis,k=O.activeTooltipIndex,B=O.activeLabel,z=j.props.children,U=ed(z,wc),L=P.props,W=L.points,ge=L.isRange,Ae=L.baseLine,V=P.item.type.defaultProps!==void 0?Fr(Fr({},P.item.type.defaultProps),P.item.props):P.item.props,$=V.activeDot,Y=V.hide,he=V.activeBar,J=V.activeShape,G=!!(!Y&&I&&U&&($||he||J)),ue={};F!=="axis"&&U&&U.props.trigger==="click"?ue={onClick:D_(j.handleItemMouseEnter,S.props.onClick)}:F!=="axis"&&(ue={onMouseLeave:D_(j.handleItemMouseLeave,S.props.onMouseLeave),onMouseEnter:D_(j.handleItemMouseEnter,S.props.onMouseEnter)});var ve=p.cloneElement(S,Fr(Fr({},P.props),ue));function ae(er){return typeof T.dataKey=="function"?T.dataKey(er.payload):null}if(G)if(k>=0){var oe,me;if(T.dataKey&&!T.allowDuplicatedCategory){var De=typeof T.dataKey=="function"?ae:"payload.".concat(T.dataKey.toString());oe=MN(W,De,B),me=ge&&Ae&&MN(Ae,De,B)}else oe=W?.[k],me=ge&&Ae&&Ae[k];if(J||he){var ne=S.props.activeIndex!==void 0?S.props.activeIndex:k;return[p.cloneElement(S,Fr(Fr(Fr({},P.props),ue),{},{activeIndex:ne})),null,null]}if(!La(oe))return[ve].concat(O0(j.renderActivePoints({item:P,activePoint:oe,basePoint:me,childIndex:k,isRange:ge})))}else{var ie,ht=(ie=j.getItemByXY(j.state.activeCoordinate))!==null&&ie!==void 0?ie:{graphicalItem:ve},pt=ht.graphicalItem,Ze=pt.item,vt=Ze===void 0?S:Ze,wt=pt.childIndex,gt=Fr(Fr(Fr({},P.props),ue),{},{activeIndex:wt});return[p.cloneElement(vt,gt),null,null]}return ge?[ve,null,null]:[ve,null]}),Aa(j,"renderCustomized",function(S,C,A){return p.cloneElement(S,Fr(Fr({key:"recharts-customized-".concat(A)},j.props),j.state))}),Aa(j,"renderMap",{CartesianGrid:{handler:$_,once:!0},ReferenceArea:{handler:j.renderReferenceElement},ReferenceLine:{handler:$_},ReferenceDot:{handler:j.renderReferenceElement},XAxis:{handler:$_},YAxis:{handler:$_},Brush:{handler:j.renderBrush,once:!0},Bar:{handler:j.renderGraphicChild},Line:{handler:j.renderGraphicChild},Area:{handler:j.renderGraphicChild},Radar:{handler:j.renderGraphicChild},RadialBar:{handler:j.renderGraphicChild},Scatter:{handler:j.renderGraphicChild},Pie:{handler:j.renderGraphicChild},Funnel:{handler:j.renderGraphicChild},Tooltip:{handler:j.renderCursor,once:!0},PolarGrid:{handler:j.renderPolarGrid,once:!0},PolarAngleAxis:{handler:j.renderPolarAxis},PolarRadiusAxis:{handler:j.renderPolarAxis},Customized:{handler:j.renderCustomized}}),j.clipPathId="".concat((w=b.id)!==null&&w!==void 0?w:fx("recharts"),"-clip"),j.throttleTriggeredAfterMouseMove=hQ(j.triggeredAfterMouseMove,(_=b.throttleDelay)!==null&&_!==void 0?_:1e3/60),j.state={},j}return eUe(v,y),Y9e(v,[{key:"componentDidMount",value:function(){var w,_;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(_=this.props.margin.top)!==null&&_!==void 0?_:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var w=this.props,_=w.children,j=w.data,S=w.height,C=w.layout,A=ed(_,wc);if(A){var P=A.props.defaultIndex;if(!(typeof P!="number"||P<0||P>this.state.tooltipTicks.length-1)){var F=this.state.tooltipTicks[P]&&this.state.tooltipTicks[P].value,O=ZT(this.state,j,P,F),I=this.state.tooltipTicks[P].coordinate,T=(this.state.offset.top+S)/2,k=C==="horizontal",B=k?{x:I,y:T}:{y:I,x:T},z=this.state.formattedGraphicalItems.find(function(L){var W=L.item;return W.type.name==="Scatter"});z&&(B=Fr(Fr({},B),z.props.points[P].tooltipPosition),O=z.props.points[P].tooltipPayload);var U={activeTooltipIndex:P,isTooltipActive:!0,activeLabel:F,activePayload:O,activeCoordinate:B};this.setState(U),this.renderCursor(A),this.accessibilityManager.setIndex(P)}}}},{key:"getSnapshotBeforeUpdate",value:function(w,_){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==_.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==w.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==w.margin){var j,S;this.accessibilityManager.setDetails({offset:{left:(j=this.props.margin.left)!==null&&j!==void 0?j:0,top:(S=this.props.margin.top)!==null&&S!==void 0?S:0}})}return null}},{key:"componentDidUpdate",value:function(w){AO([ed(w.children,wc)],[ed(this.props.children,wc)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var w=ed(this.props.children,wc);if(w&&typeof w.props.shared=="boolean"){var _=w.props.shared?"axis":"item";return l.indexOf(_)>=0?_:o}return o}},{key:"getMouseInfo",value:function(w){if(!this.container)return null;var _=this.container,j=_.getBoundingClientRect(),S=t4e(j),C={chartX:Math.round(w.pageX-S.left),chartY:Math.round(w.pageY-S.top)},A=j.width/_.offsetWidth||1,P=this.inRange(C.chartX,C.chartY,A);if(!P)return null;var F=this.state,O=F.xAxisMap,I=F.yAxisMap,T=this.getTooltipEventType(),k=Oz(this.state,this.props.data,this.props.layout,P);if(T!=="axis"&&O&&I){var B=xh(O).scale,z=xh(I).scale,U=B&&B.invert?B.invert(C.chartX):null,L=z&&z.invert?z.invert(C.chartY):null;return Fr(Fr({},C),{},{xValue:U,yValue:L},k)}return k?Fr(Fr({},C),k):null}},{key:"inRange",value:function(w,_){var j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,S=this.props.layout,C=w/j,A=_/j;if(S==="horizontal"||S==="vertical"){var P=this.state.offset,F=C>=P.left&&C<=P.left+P.width&&A>=P.top&&A<=P.top+P.height;return F?{x:C,y:A}:null}var O=this.state,I=O.angleAxisMap,T=O.radiusAxisMap;if(I&&T){var k=xh(I);return Gq({x:C,y:A},k)}return null}},{key:"parseEventsOfWrapper",value:function(){var w=this.props.children,_=this.getTooltipEventType(),j=ed(w,wc),S={};j&&_==="axis"&&(j.props.trigger==="click"?S={onClick:this.handleClick}:S={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var C=RN(this.props,this.handleOuterEvent);return Fr(Fr({},C),S)}},{key:"addListener",value:function(){OE.on(TE,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){OE.removeListener(TE,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(w,_,j){for(var S=this.state.formattedGraphicalItems,C=0,A=S.length;C<A;C++){var P=S[C];if(P.item===w||P.props.key===w.key||_===vm(P.item.type)&&j===P.childIndex)return P}return null}},{key:"renderClipPath",value:function(){var w=this.clipPathId,_=this.state.offset,j=_.left,S=_.top,C=_.height,A=_.width;return Ee.createElement("defs",null,Ee.createElement("clipPath",{id:w},Ee.createElement("rect",{x:j,y:S,height:C,width:A})))}},{key:"getXScales",value:function(){var w=this.state.xAxisMap;return w?Object.entries(w).reduce(function(_,j){var S=Pz(j,2),C=S[0],A=S[1];return Fr(Fr({},_),{},Aa({},C,A.scale))},{}):null}},{key:"getYScales",value:function(){var w=this.state.yAxisMap;return w?Object.entries(w).reduce(function(_,j){var S=Pz(j,2),C=S[0],A=S[1];return Fr(Fr({},_),{},Aa({},C,A.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(w){var _;return(_=this.state.xAxisMap)===null||_===void 0||(_=_[w])===null||_===void 0?void 0:_.scale}},{key:"getYScaleByAxisId",value:function(w){var _;return(_=this.state.yAxisMap)===null||_===void 0||(_=_[w])===null||_===void 0?void 0:_.scale}},{key:"getItemByXY",value:function(w){var _=this.state,j=_.formattedGraphicalItems,S=_.activeItem;if(j&&j.length)for(var C=0,A=j.length;C<A;C++){var P=j[C],F=P.props,O=P.item,I=O.type.defaultProps!==void 0?Fr(Fr({},O.type.defaultProps),O.props):O.props,T=vm(O.type);if(T==="Bar"){var k=(F.data||[]).find(function(L){return R6e(w,L)});if(k)return{graphicalItem:P,payload:k}}else if(T==="RadialBar"){var B=(F.data||[]).find(function(L){return Gq(w,L)});if(B)return{graphicalItem:P,payload:B}}else if(H5(P,S)||G5(P,S)||h1(P,S)){var z=NBe({graphicalItem:P,activeTooltipItem:S,itemData:I.data}),U=I.activeIndex===void 0?z:I.activeIndex;return{graphicalItem:Fr(Fr({},P),{},{childIndex:U}),payload:h1(P,S)?I.data[z]:P.props.data[z]}}}return null}},{key:"render",value:function(){var w=this;if(!D8(this))return null;var _=this.props,j=_.children,S=_.className,C=_.width,A=_.height,P=_.style,F=_.compact,O=_.title,I=_.desc,T=Ez(_,V9e),k=ha(T,!1);if(F)return Ee.createElement(rz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ee.createElement(EO,jv({},k,{width:C,height:A,title:O,desc:I}),this.renderClipPath(),R8(j,this.renderMap)));if(this.props.accessibilityLayer){var B,z;k.tabIndex=(B=this.props.tabIndex)!==null&&B!==void 0?B:0,k.role=(z=this.props.role)!==null&&z!==void 0?z:"application",k.onKeyDown=function(L){w.accessibilityManager.keyboardEvent(L)},k.onFocus=function(){w.accessibilityManager.focus()}}var U=this.parseEventsOfWrapper();return Ee.createElement(rz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ee.createElement("div",jv({className:qa("recharts-wrapper",S),style:Fr({position:"relative",cursor:"default",width:C,height:A},P)},U,{ref:function(W){w.container=W}}),Ee.createElement(EO,jv({},k,{width:C,height:A,title:O,desc:I,style:oUe}),this.renderClipPath(),R8(j,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(p.Component);Aa(x,"displayName",r),Aa(x,"defaultProps",Fr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),Aa(x,"getDerivedStateFromProps",function(y,v){var b=y.dataKey,w=y.data,_=y.children,j=y.width,S=y.height,C=y.layout,A=y.stackOffset,P=y.margin,F=v.dataStartIndex,O=v.dataEndIndex;if(v.updateId===void 0){var I=Tz(y);return Fr(Fr(Fr({},I),{},{updateId:0},m(Fr(Fr({props:y},I),{},{updateId:0}),v)),{},{prevDataKey:b,prevData:w,prevWidth:j,prevHeight:S,prevLayout:C,prevStackOffset:A,prevMargin:P,prevChildren:_})}if(b!==v.prevDataKey||w!==v.prevData||j!==v.prevWidth||S!==v.prevHeight||C!==v.prevLayout||A!==v.prevStackOffset||!Lv(P,v.prevMargin)){var T=Tz(y),k={chartX:v.chartX,chartY:v.chartY,isTooltipActive:v.isTooltipActive},B=Fr(Fr({},Oz(v,w,C)),{},{updateId:v.updateId+1}),z=Fr(Fr(Fr({},T),k),B);return Fr(Fr(Fr({},z),m(Fr({props:y},z),v)),{},{prevDataKey:b,prevData:w,prevWidth:j,prevHeight:S,prevLayout:C,prevStackOffset:A,prevMargin:P,prevChildren:_})}if(!AO(_,v.prevChildren)){var U,L,W,ge,Ae=ed(_,w0),V=Ae&&(U=(L=Ae.props)===null||L===void 0?void 0:L.startIndex)!==null&&U!==void 0?U:F,$=Ae&&(W=(ge=Ae.props)===null||ge===void 0?void 0:ge.endIndex)!==null&&W!==void 0?W:O,Y=V!==F||$!==O,he=!La(w),J=he&&!Y?v.updateId:v.updateId+1;return Fr(Fr({updateId:J},m(Fr(Fr({props:y},v),{},{updateId:J,dataStartIndex:V,dataEndIndex:$}),v)),{},{prevChildren:_,dataStartIndex:V,dataEndIndex:$})}return null}),Aa(x,"renderActiveDot",function(y,v,b){var w;return p.isValidElement(y)?w=p.cloneElement(y,v):Ea(y)?w=y(v):w=Ee.createElement(c2,v),Ee.createElement(ns,{className:"recharts-active-dot",key:b},w)});var g=p.forwardRef(function(v,b){return Ee.createElement(x,jv({},v,{ref:b}))});return g.displayName=x.displayName,g},Uee=eA({chartName:"LineChart",GraphicalChild:fy,axisComponents:[{axisType:"xAxis",AxisComp:fp},{axisType:"yAxis",AxisComp:mp}],formatAxisMap:ZM}),gUe=eA({chartName:"BarChart",GraphicalChild:gx,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:fp},{axisType:"yAxis",AxisComp:mp}],formatAxisMap:ZM}),xUe=eA({chartName:"PieChart",GraphicalChild:Ff,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:W5},{axisType:"radiusAxis",AxisComp:U5}],formatAxisMap:JFe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}}),vUe=eA({chartName:"AreaChart",GraphicalChild:Ap,axisComponents:[{axisType:"xAxis",AxisComp:fp},{axisType:"yAxis",AxisComp:mp}],formatAxisMap:ZM});const Mz=({icon:e,title:t,value:r,trend:n,trendValue:s,color:o,className:i,loading:l})=>{const c=n==="up"?K4:Pue,d=n==="up"?"text-success":"text-danger";return a.jsx(Er.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group flex flex-col justify-between ${i}`,children:a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10",style:{color:`var(--${o})`},children:a.jsx(e,{className:"h-5 w-5"})}),!l&&n&&s&&a.jsxs("div",{className:`flex items-center text-xs font-bold ${d}`,children:[a.jsx(c,{className:"w-3.5 h-3.5 mr-1"}),a.jsx("span",{children:s})]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider mb-2",children:t}),l?a.jsx("div",{className:"h-9 bg-white/5 rounded animate-pulse"}):a.jsx("p",{className:"text-3xl font-bold text-text-primary tabular-nums tracking-tight",children:r})]})]})})},yUe=({alerts:e,className:t})=>{const r=hl(),[n,s]=p.useState(!1),o=u=>({Package:su,DollarSign:Oi,CalendarCheck:MC,Clock:eu,ShoppingCart:W1,Store:eD,Users:tc,CalendarPlus:J4,AlertTriangle:Df,Info:yG})[u]||Df,i=u=>({danger:"text-danger",warning:"text-warning",info:"text-info",success:"text-success",purple:"text-purple"})[u]||"text-warning",l=e.length>2?e.slice(0,2):e,c=e.length>2,d=({alert:u,onClick:f})=>{const h=o(u.icone),m=i(u.cor);return a.jsxs("li",{className:"flex items-center gap-2 p-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group",onClick:f,children:[a.jsx(h,{className:`w-4 h-4 flex-shrink-0 ${m}`}),a.jsx("span",{className:"text-text-secondary group-hover:text-text-primary transition-colors flex-1",children:u.mensagem}),u.link&&a.jsx(K4,{className:"w-3 h-3 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity"})]})};return a.jsxs(a.Fragment,{children:[a.jsxs(Er.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card ${t||""}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h2",{className:"text-lg font-bold text-text-primary flex items-center",children:[a.jsx(Ob,{className:"mr-2 h-5 w-5 text-brand"})," Alertas do Dia"]}),c&&a.jsx(se,{variant:"ghost",size:"sm",className:"text-xs text-brand hover:text-brand/80",onClick:()=>s(!0),children:"Ver todos"})]}),e.length===0?a.jsx("p",{className:"text-sm text-text-muted",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:l.map((u,f)=>a.jsx(d,{alert:u,onClick:()=>u.link&&r(u.link)},f))})]}),a.jsx(In,{open:n,onOpenChange:s,children:a.jsxs(En,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(Cn,{children:a.jsxs(Nn,{className:"flex items-center gap-2",children:[a.jsx(Ob,{className:"h-5 w-5 text-brand"}),"Todos os Alertas (",e.length,")"]})}),a.jsx("div",{className:"mt-4",children:e.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-8",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:e.map((u,f)=>a.jsx(d,{alert:u,onClick:()=>{u.link&&(r(u.link),s(!1))}},f))})})]})})]})},bUe=({title:e,icon:t,data:r,color:n,className:s,loading:o})=>{const i=r.reduce((d,u)=>d+(u.receita||0),0),l=r.reduce((d,u)=>d+(u.despesa||0),0),c=i-l;return a.jsxs(Er.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group ${s||""}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10 mr-3",style:{color:`var(--${n})`},children:a.jsx(t,{className:"h-5 w-5"})}),a.jsx("h3",{className:"text-base font-bold text-text-primary flex-1",children:e}),a.jsx("div",{className:"text-xs font-semibold text-text-muted",children:"ltimos 14 dias"})]}),a.jsx("div",{className:"mb-2",children:a.jsx(zb,{width:"100%",height:90,children:a.jsxs(vUe,{data:r,margin:{top:4,right:0,left:0,bottom:0},children:[a.jsx(wc,{cursor:{stroke:"var(--border)",strokeDasharray:"3 3"},contentStyle:{background:"rgba(10, 10, 10, 0.85)",borderColor:"var(--border)",color:"var(--text-primary)",borderRadius:"var(--radius-sm)"},formatter:(d,u)=>u==="saldo"?[`R$ ${d.toLocaleString("pt-BR")}`,"Saldo"]:d,labelFormatter:d=>d}),a.jsx(Ap,{type:"monotone",dataKey:"saldo",stroke:"var(--brand)",strokeWidth:2,fill:"var(--brand)",fillOpacity:.15})]})})}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Receita"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-success tabular-nums",children:["R$ ",i.toLocaleString("pt-BR")]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Despesa"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-danger tabular-nums",children:["R$ ",l.toLocaleString("pt-BR")]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Saldo"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-text-primary tabular-nums",children:["R$ ",c.toLocaleString("pt-BR")]})]})]})]})},wUe=({title:e,icon:t,data:r,color:n,className:s,loading:o})=>a.jsxs(Er.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group flex flex-col ${s||""}`,children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10 mr-3",style:{color:`var(--${n})`},children:a.jsx(t,{className:"h-5 w-5"})}),a.jsx("h3",{className:"text-base font-bold text-text-primary",children:e})]}),a.jsx("div",{className:"space-y-3 mt-auto",children:o?Array.from({length:3}).map((i,l)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("div",{className:"h-4 w-24 bg-white/5 rounded animate-pulse"}),a.jsx("div",{className:"h-4 w-12 bg-white/5 rounded animate-pulse"})]},l)):r.map((i,l)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:i.name}),a.jsx("span",{className:"font-bold text-text-primary tabular-nums",children:i.value})]},l))})]}),_Ue={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.1,delayChildren:.2}}},ME={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}};function jUe(){const{toast:e}=Ss(),{userProfile:t}=qs(),n=t2()?.alerts||[],s=hl(),[o,i]=p.useState(!0),[l,c]=p.useState(0),[d,u]=p.useState({finalizados:0,total:0}),[f,h]=p.useState(0),[m,x]=p.useState(0),[g,y]=p.useState(0),[v,b]=p.useState(0),[w,_]=p.useState(0),[j,S]=p.useState(0),[C,A]=p.useState([]);p.useEffect(()=>{(async()=>{if(!t?.codigo_empresa){console.log("[DashboardPage] Aguardando autenticao..."),i(!1);return}console.log("[DashboardPage] Iniciando carregamento de dados...");try{i(!0);const I=t.codigo_empresa,T=new Date,k=so(T).toISOString(),B=Ej(T).toISOString();console.log("[Dashboard] 1. Buscando pagamentos...");const{data:z}=await re.from("pagamentos").select("valor, status").eq("codigo_empresa",I).gte("recebido_em",k).lte("recebido_em",B);console.log("[Dashboard]  Pagamentos carregados:",z?.length||0);const U=(z||[]).filter(_e=>!["Cancelado","Estornado"].includes(_e.status)).reduce((_e,Pt)=>_e+Number(Pt.valor||0),0);console.log("[Dashboard] 2. Buscando agendamentos de hoje...");const{data:L}=await re.from("agendamentos").select("id").eq("codigo_empresa",I).gte("inicio",k).lte("inicio",B);console.log("[Dashboard]  Agendamentos de hoje:",L?.length||0);let W=0;if(L&&L.length>0){console.log("[Dashboard] 3. Buscando participantes pagos...");const _e=L.map(Lt=>Lt.id),{data:Pt}=await re.from("agendamento_participantes").select("valor_cota, status_pagamento, aplicar_taxa, finalizadora_id, finalizadoras!agp_finalizadora_id_fkey(taxa_percentual)").eq("codigo_empresa",I).in("agendamento_id",_e).eq("status_pagamento","Pago");console.log("[Dashboard]  Participantes pagos:",Pt?.length||0),W=(Pt||[]).reduce((Lt,gr)=>{let fr=Number(gr.valor_cota||0);if(gr.aplicar_taxa===!0){const je=Number(gr.finalizadoras?.taxa_percentual||0);je>0&&(fr=fr/(1+je/100))}return Lt+fr},0)}const ge=U+W;c(ge),console.log("[Dashboard] 4. Buscando agendamentos completos...");const{data:Ae}=await re.from("agendamentos").select("id, status, inicio, fim").eq("codigo_empresa",I).gte("inicio",k).lte("inicio",B);console.log("[Dashboard]  Agendamentos completos:",Ae?.length||0);const V=(Ae||[]).filter(_e=>_e.status==="finished").length;u({finalizados:V,total:Ae?.length||0});const $=new Date().toISOString(),Y=(Ae||[]).filter(_e=>_e.inicio>$&&!["canceled","finished"].includes(_e.status)).length;h(Y);const he=(Ae||[]).filter(_e=>_e.status==="in_progress").length;x(he),console.log("[Dashboard] 5. Buscando quadras...");const{data:J}=await re.from("quadras").select("id").eq("codigo_empresa",I);console.log("[Dashboard]  Quadras:",J?.length||0);const ve=(J?.length||0)*17;let ae=0;for(const _e of Ae||[])if(!["canceled","no_show"].includes(_e.status))if(_e.inicio&&_e.fim){const Pt=new Date(_e.inicio),fr=(new Date(_e.fim)-Pt)/(1e3*60*60);ae+=fr}else ae+=1;const oe=ve>0?Math.round(ae/ve*100):0;y(oe),console.log("[Dashboard] 6. Buscando comandas abertas...");const{data:me}=await re.from("comandas").select("id").eq("codigo_empresa",I).eq("status","open");console.log("[Dashboard]  Comandas abertas:",me?.length||0),b(me?.length||0),console.log("[Dashboard] 7. Buscando mesas...");const{data:De}=await re.from("mesas").select("id, status").eq("codigo_empresa",I);console.log("[Dashboard]  Mesas:",De?.length||0);const ne=(De||[]).filter(_e=>["in-use","awaiting-payment"].includes(_e.status)).length;_(ne),console.log("[Dashboard] 8. Buscando vendas da loja...");const{data:ie}=await re.from("comandas").select("id").eq("codigo_empresa",I).eq("status","closed").gte("fechado_em",k).lte("fechado_em",B);console.log("[Dashboard]  Vendas da loja:",ie?.length||0),S(ie?.length||0),console.log("[Dashboard] 9. Buscando dados dos ltimos 14 dias...");const ht=new Date;ht.setDate(ht.getDate()-13);const pt=so(ht).toISOString(),Ze=Ej(T).toISOString(),{data:vt}=await re.from("pagamentos").select("valor, status, recebido_em").eq("codigo_empresa",I).gte("recebido_em",pt).lte("recebido_em",Ze);console.log("[Dashboard]  Pagamentos 14 dias:",vt?.length||0);const{data:wt}=await re.from("agendamentos").select("id, inicio").eq("codigo_empresa",I).gte("inicio",pt).lte("inicio",Ze);console.log("[Dashboard]  Agendamentos 14 dias:",wt?.length||0);let gt=[];if(wt&&wt.length>0){const _e=wt.map(Lt=>Lt.id),{data:Pt}=await re.from("agendamento_participantes").select("valor_cota, agendamento_id").eq("codigo_empresa",I).in("agendamento_id",_e).eq("status_pagamento","Pago");gt=Pt||[],console.log("[Dashboard]  Participantes pagos 14 dias:",gt.length)}const er=[];for(let _e=13;_e>=0;_e--){const Pt=new Date;Pt.setDate(Pt.getDate()-_e);const Lt=so(Pt),gr=Ej(Pt),fr=(vt||[]).filter(Ut=>{const Fe=new Date(Ut.recebido_em);return Fe>=Lt&&Fe<=gr&&!["Cancelado","Estornado"].includes(Ut.status)}).reduce((Ut,Fe)=>Ut+Number(Fe.valor||0),0),je=(wt||[]).filter(Ut=>{const Fe=new Date(Ut.inicio);return Fe>=Lt&&Fe<=gr}).map(Ut=>Ut.id),nt=gt.filter(Ut=>je.includes(Ut.agendamento_id)).reduce((Ut,Fe)=>Ut+Number(Fe.valor_cota||0),0),$t=fr+nt;er.push({name:_e===0?"Hoje":`${_e}d`,saldo:Math.round($t),receita:Math.round($t),despesa:0})}console.log("[Dashboard]  Dados de 14 dias carregados"),A(er)}catch(I){console.error("[DashboardPage]  Erro ao carregar dashboard:",I),e({title:"Erro ao carregar dashboard",description:I?.message||"Tente recarregar a pgina",variant:"destructive"})}finally{console.log("[DashboardPage]  Carregamento concludo"),i(!1)}})()},[t?.codigo_empresa]);const P=O=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(O||0)),F=[{name:"Comandas Abertas",value:v},{name:"Mesas Ocupadas",value:w},{name:"Vendas Hoje",value:j}];return a.jsx(a.Fragment,{children:a.jsxs(Er.div,{variants:_Ue,initial:"hidden",animate:"visible",className:"space-y-4",children:[a.jsxs(Er.div,{variants:ME,className:"relative grid grid-cols-1 xl:grid-cols-12 gap-4 items-start",children:[a.jsx("div",{className:"xl:col-span-8",children:a.jsxs("div",{className:"bg-surface/70 backdrop-blur-sm relative p-4 rounded-xl border border-white/10 overflow-hidden shadow-1",children:[a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.03] mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 max-w-[720px]",children:[a.jsxs("h1",{className:"text-3xl font-black mb-2 text-text-primary tracking-tighter",children:["Bem-vindo de volta, ",a.jsxs("span",{className:"text-brand",children:[(t?.nome_exibicao||t?.nome||t?.email?.split("@")[0]||"Admin").split(" ")[0],"!"]})]}),a.jsx("p",{className:"text-text-secondary mb-3 max-w-[60ch] text-sm md:text-base font-normal",children:"Sua central de comando para uma gesto de sucesso. Monitore agendamentos, faturamento e clientes em um s lugar."}),a.jsxs("div",{className:"flex flex-wrap gap-2.5",children:[a.jsxs(se,{onClick:()=>s("/agenda",{state:{openModal:!0}}),size:"default",children:[a.jsx(J4,{className:"mr-2 h-4 w-4"}),"+ Agendamento"]}),a.jsxs(se,{onClick:()=>s("/clientes",{state:{openModal:!0}}),variant:"outline",size:"default",children:[a.jsx(tc,{className:"mr-2 h-4 w-4"}),"Adicionar Cliente"]})]})]})]})}),a.jsx("div",{className:"xl:col-span-4",children:a.jsxs("div",{className:"fx-card",children:[a.jsxs("h2",{className:"text-lg font-bold text-text-primary mb-3 flex items-center",children:[a.jsx(eu,{className:"mr-2 h-5 w-5 text-brand"})," Resumo do Dia"]}),a.jsxs("ul",{className:"space-y-2 text-sm",children:[a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Prximas Reservas"}),o?a.jsx("div",{className:"h-6 w-12 bg-white/5 rounded animate-pulse"}):a.jsx("span",{className:"font-bold text-text-primary tabular-nums",children:f})]}),a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Quadras em Uso"}),o?a.jsx("div",{className:"h-6 w-12 bg-white/5 rounded animate-pulse"}):a.jsx("span",{className:"font-bold text-success tabular-nums",children:m})]}),a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Taxa de Ocupao"}),o?a.jsx("div",{className:"h-6 w-16 bg-white/5 rounded animate-pulse"}):a.jsxs("span",{className:`font-bold tabular-nums ${g>=70?"text-success":g>=40?"text-warning":"text-danger"}`,children:[g,"%"]})]})]})]})})]}),a.jsxs(Er.div,{variants:ME,className:"relative grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-12 gap-4 items-stretch",children:[a.jsx("div",{className:"xl:col-span-3",children:a.jsx(Mz,{icon:Oi,title:"Faturamento do Dia",value:P(l),color:"success",className:"h-full",loading:o})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(Mz,{icon:MC,title:"Agend. Finalizados",value:`${d.finalizados} de ${d.total}`,color:"info",className:"h-full",loading:o})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(yUe,{className:"h-full",alerts:n})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(wUe,{icon:eD,title:"Informaes da Loja",data:F,color:"purple",className:"h-full",loading:o})})]}),a.jsx(Er.div,{variants:ME,className:"grid grid-cols-1 gap-4",children:a.jsx(bUe,{icon:Cm,title:"Resumo Financeiro",data:C,color:"brand",loading:o})})]})})}var NUe={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 ms",other:"cerca de {{count}} meses"},xMonths:{one:"1 ms",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},SUe=function(t,r,n){var s,o=NUe[t];return typeof o=="string"?s=o:r===1?s=o.one:s=o.other.replace("{{count}}",String(r)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"em "+s:"h "+s:s};const CUe=SUe;var AUe={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},PUe={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},EUe={full:"{{date}} 's' {{time}}",long:"{{date}} 's' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},kUe={date:Rv({formats:AUe,defaultWidth:"full"}),time:Rv({formats:PUe,defaultWidth:"full"}),dateTime:Rv({formats:EUe,defaultWidth:"full"})};const IUe=kUe;var OUe={lastWeek:function(t){var r=t.getUTCDay(),n=r===0||r===6?"ltimo":"ltima";return"'"+n+"' eeee 's' p"},yesterday:"'ontem s' p",today:"'hoje s' p",tomorrow:"'amanh s' p",nextWeek:"eeee 's' p",other:"P"},TUe=function(t,r,n,s){var o=OUe[t];return typeof o=="function"?o(r):o};const DUe=TUe;var MUe={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},RUe={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},FUe={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},LUe={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","tera","quarta","quinta","sexta","sbado"],wide:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"]},$Ue={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"}},BUe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},qUe=function(t,r){var n=Number(t);return r?.unit==="week"?n+"":n+""},zUe={ordinalNumber:qUe,era:hf({values:MUe,defaultWidth:"wide"}),quarter:hf({values:RUe,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:hf({values:FUe,defaultWidth:"wide"}),day:hf({values:LUe,defaultWidth:"wide"}),dayPeriod:hf({values:$Ue,defaultWidth:"wide",formattingValues:BUe,defaultFormattingWidth:"wide"})};const UUe=zUe;var VUe=/^(\d+)[o]?/i,WUe=/\d+/i,HUe={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},GUe={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},KUe={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},XUe={any:[/1/i,/2/i,/3/i,/4/i]},YUe={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|maro|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},JUe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},QUe={narrow:/^(dom|[23456]?|s[a]b)/i,short:/^(dom|[23456]?|s[a]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a]b)/i,wide:/^(domingo|(segunda|ter[c]a|quarta|quinta|sexta)([- ]feira)?|s[a]bado)/i},ZUe={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a]b/i]},eVe={narrow:/^(a|p|mn|md|(da) (manh|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh|tarde|noite))/i},tVe={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},rVe={ordinalNumber:UY({matchPattern:VUe,parsePattern:WUe,valueCallback:function(t){return parseInt(t,10)}}),era:pf({matchPatterns:HUe,defaultMatchWidth:"wide",parsePatterns:GUe,defaultParseWidth:"any"}),quarter:pf({matchPatterns:KUe,defaultMatchWidth:"wide",parsePatterns:XUe,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:pf({matchPatterns:YUe,defaultMatchWidth:"wide",parsePatterns:JUe,defaultParseWidth:"any"}),day:pf({matchPatterns:QUe,defaultMatchWidth:"wide",parsePatterns:ZUe,defaultParseWidth:"any"}),dayPeriod:pf({matchPatterns:eVe,defaultMatchWidth:"any",parsePatterns:tVe,defaultParseWidth:"any"})};const nVe=rVe;var aVe={code:"pt-BR",formatDistance:CUe,formatLong:IUe,formatRelative:DUe,localize:UUe,match:nVe,options:{weekStartsOn:0,firstWeekContainsDate:1}};const ga=aVe;var Ma=function(){return Ma=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Ma.apply(this,arguments)};function sVe(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Vee(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function d2(e){return e.mode==="multiple"}function u2(e){return e.mode==="range"}function tA(e){return e.mode==="single"}var oVe={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function iVe(e,t){return sr(e,"LLLL y",t)}function lVe(e,t){return sr(e,"d",t)}function cVe(e,t){return sr(e,"LLLL",t)}function dVe(e){return"".concat(e)}function uVe(e,t){return sr(e,"cccccc",t)}function fVe(e,t){return sr(e,"yyyy",t)}var mVe=Object.freeze({__proto__:null,formatCaption:iVe,formatDay:lVe,formatMonthCaption:cVe,formatWeekNumber:dVe,formatWeekdayName:uVe,formatYearCaption:fVe}),hVe=function(e,t,r){return sr(e,"do MMMM (EEEE)",r)},pVe=function(){return"Month: "},gVe=function(){return"Go to next month"},xVe=function(){return"Go to previous month"},vVe=function(e,t){return sr(e,"cccc",t)},yVe=function(e){return"Week n. ".concat(e)},bVe=function(){return"Year: "},wVe=Object.freeze({__proto__:null,labelDay:hVe,labelMonthDropdown:pVe,labelNext:gVe,labelPrevious:xVe,labelWeekNumber:yVe,labelWeekday:vVe,labelYearDropdown:bVe});function _Ve(){var e="buttons",t=oVe,r=VY,n={},s={},o=1,i={},l=new Date;return{captionLayout:e,classNames:t,formatters:mVe,labels:wVe,locale:r,modifiersClassNames:n,modifiers:s,numberOfMonths:o,styles:i,today:l,mode:"default"}}function jVe(e){var t=e.fromYear,r=e.toYear,n=e.fromMonth,s=e.toMonth,o=e.fromDate,i=e.toDate;return n?o=cc(n):t&&(o=new Date(t,0,1)),s?i=i5(s):r&&(i=new Date(r,11,31)),{fromDate:o?so(o):void 0,toDate:i?so(i):void 0}}var Wee=p.createContext(void 0);function NVe(e){var t,r=e.initialProps,n=_Ve(),s=jVe(r),o=s.fromDate,i=s.toDate,l=(t=r.captionLayout)!==null&&t!==void 0?t:n.captionLayout;l!=="buttons"&&(!o||!i)&&(l="buttons");var c;(tA(r)||d2(r)||u2(r))&&(c=r.onSelect);var d=Ma(Ma(Ma({},n),r),{captionLayout:l,classNames:Ma(Ma({},n.classNames),r.classNames),components:Ma({},r.components),formatters:Ma(Ma({},n.formatters),r.formatters),fromDate:o,labels:Ma(Ma({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:Ma(Ma({},n.modifiers),r.modifiers),modifiersClassNames:Ma(Ma({},n.modifiersClassNames),r.modifiersClassNames),onSelect:c,styles:Ma(Ma({},n.styles),r.styles),toDate:i});return a.jsx(Wee.Provider,{value:d,children:e.children})}function fo(){var e=p.useContext(Wee);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function Hee(e){var t=fo(),r=t.locale,n=t.classNames,s=t.styles,o=t.formatters.formatCaption;return a.jsx("div",{className:n.caption_label,style:s.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:r})})}function SVe(e){return a.jsx("svg",Ma({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:a.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Gee(e){var t,r,n=e.onChange,s=e.value,o=e.children,i=e.caption,l=e.className,c=e.style,d=fo(),u=(r=(t=d.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:SVe;return a.jsxs("div",{className:l,style:c,children:[a.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),a.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:s,onChange:n,children:o}),a.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[i,a.jsx(u,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function CVe(e){var t,r=fo(),n=r.fromDate,s=r.toDate,o=r.styles,i=r.locale,l=r.formatters.formatMonthCaption,c=r.classNames,d=r.components,u=r.labels.labelMonthDropdown;if(!n)return a.jsx(a.Fragment,{});if(!s)return a.jsx(a.Fragment,{});var f=[];if(f2e(n,s))for(var h=cc(n),m=n.getMonth();m<=s.getMonth();m++)f.push(sE(h,m));else for(var h=cc(new Date),m=0;m<=11;m++)f.push(sE(h,m));var x=function(y){var v=Number(y.target.value),b=sE(cc(e.displayMonth),v);e.onChange(b)},g=(t=d?.Dropdown)!==null&&t!==void 0?t:Gee;return a.jsx(g,{name:"months","aria-label":u(),className:c.dropdown_month,style:o.dropdown_month,onChange:x,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:f.map(function(y){return a.jsx("option",{value:y.getMonth(),children:l(y,{locale:i})},y.getMonth())})})}function AVe(e){var t,r=e.displayMonth,n=fo(),s=n.fromDate,o=n.toDate,i=n.locale,l=n.styles,c=n.classNames,d=n.components,u=n.formatters.formatYearCaption,f=n.labels.labelYearDropdown,h=[];if(!s)return a.jsx(a.Fragment,{});if(!o)return a.jsx(a.Fragment,{});for(var m=s.getFullYear(),x=o.getFullYear(),g=m;g<=x;g++)h.push(v8(zwe(new Date),g));var y=function(b){var w=v8(cc(r),Number(b.target.value));e.onChange(w)},v=(t=d?.Dropdown)!==null&&t!==void 0?t:Gee;return a.jsx(v,{name:"years","aria-label":f(),className:c.dropdown_year,style:l.dropdown_year,onChange:y,value:r.getFullYear(),caption:u(r,{locale:i}),children:h.map(function(b){return a.jsx("option",{value:b.getFullYear(),children:u(b,{locale:i})},b.getFullYear())})})}function PVe(e,t){var r=p.useState(e),n=r[0],s=r[1],o=t===void 0?n:t;return[o,s]}function EVe(e){var t=e.month,r=e.defaultMonth,n=e.today,s=t||r||n||new Date,o=e.toDate,i=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(o&&Lw(o,s)<0){var d=-1*(c-1);s=Uu(o,d)}return i&&Lw(s,i)<0&&(s=i),cc(s)}function kVe(){var e=fo(),t=EVe(e),r=PVe(t,e.month),n=r[0],s=r[1],o=function(i){var l;if(!e.disableNavigation){var c=cc(i);s(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[n,o]}function IVe(e,t){for(var r=t.reverseMonths,n=t.numberOfMonths,s=cc(e),o=cc(Uu(s,n)),i=Lw(o,s),l=[],c=0;c<i;c++){var d=Uu(s,c);l.push(d)}return r&&(l=l.reverse()),l}function OVe(e,t){if(!t.disableNavigation){var r=t.toDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=n?o:1,l=cc(e);if(!r)return Uu(l,i);var c=Lw(r,e);if(!(c<o))return Uu(l,i)}}function TVe(e,t){if(!t.disableNavigation){var r=t.fromDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=n?o:1,l=cc(e);if(!r)return Uu(l,-i);var c=Lw(l,r);if(!(c<=0))return Uu(l,-i)}}var Kee=p.createContext(void 0);function DVe(e){var t=fo(),r=kVe(),n=r[0],s=r[1],o=IVe(n,t),i=OVe(n,t),l=TVe(n,t),c=function(f){return o.some(function(h){return eM(f,h)})},d=function(f,h){c(f)||(h&&WY(f,h)?s(Uu(f,1+t.numberOfMonths*-1)):s(f))},u={currentMonth:n,displayMonths:o,goToMonth:s,goToDate:d,previousMonth:l,nextMonth:i,isDateDisplayed:c};return a.jsx(Kee.Provider,{value:u,children:e.children})}function f2(){var e=p.useContext(Kee);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function Rz(e){var t,r=fo(),n=r.classNames,s=r.styles,o=r.components,i=f2().goToMonth,l=function(u){i(Uu(u,e.displayIndex?-e.displayIndex:0))},c=(t=o?.CaptionLabel)!==null&&t!==void 0?t:Hee,d=a.jsx(c,{id:e.id,displayMonth:e.displayMonth});return a.jsxs("div",{className:n.caption_dropdowns,style:s.caption_dropdowns,children:[a.jsx("div",{className:n.vhidden,children:d}),a.jsx(CVe,{onChange:l,displayMonth:e.displayMonth}),a.jsx(AVe,{onChange:l,displayMonth:e.displayMonth})]})}function MVe(e){return a.jsx("svg",Ma({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:a.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function RVe(e){return a.jsx("svg",Ma({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:a.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var $S=p.forwardRef(function(e,t){var r=fo(),n=r.classNames,s=r.styles,o=[n.button_reset,n.button];e.className&&o.push(e.className);var i=o.join(" "),l=Ma(Ma({},s.button_reset),s.button);return e.style&&Object.assign(l,e.style),a.jsx("button",Ma({},e,{ref:t,type:"button",className:i,style:l}))});function FVe(e){var t,r,n=fo(),s=n.dir,o=n.locale,i=n.classNames,l=n.styles,c=n.labels,d=c.labelPrevious,u=c.labelNext,f=n.components;if(!e.nextMonth&&!e.previousMonth)return a.jsx(a.Fragment,{});var h=d(e.previousMonth,{locale:o}),m=[i.nav_button,i.nav_button_previous].join(" "),x=u(e.nextMonth,{locale:o}),g=[i.nav_button,i.nav_button_next].join(" "),y=(t=f?.IconRight)!==null&&t!==void 0?t:RVe,v=(r=f?.IconLeft)!==null&&r!==void 0?r:MVe;return a.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&a.jsx($S,{name:"previous-month","aria-label":h,className:m,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:s==="rtl"?a.jsx(y,{className:i.nav_icon,style:l.nav_icon}):a.jsx(v,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&a.jsx($S,{name:"next-month","aria-label":x,className:g,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:s==="rtl"?a.jsx(v,{className:i.nav_icon,style:l.nav_icon}):a.jsx(y,{className:i.nav_icon,style:l.nav_icon})})]})}function Fz(e){var t=fo().numberOfMonths,r=f2(),n=r.previousMonth,s=r.nextMonth,o=r.goToMonth,i=r.displayMonths,l=i.findIndex(function(x){return eM(e.displayMonth,x)}),c=l===0,d=l===i.length-1,u=t>1&&(c||!d),f=t>1&&(d||!c),h=function(){n&&o(n)},m=function(){s&&o(s)};return a.jsx(FVe,{displayMonth:e.displayMonth,hideNext:u,hidePrevious:f,nextMonth:s,previousMonth:n,onPreviousClick:h,onNextClick:m})}function LVe(e){var t,r=fo(),n=r.classNames,s=r.disableNavigation,o=r.styles,i=r.captionLayout,l=r.components,c=(t=l?.CaptionLabel)!==null&&t!==void 0?t:Hee,d;return s?d=a.jsx(c,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?d=a.jsx(Rz,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?d=a.jsxs(a.Fragment,{children:[a.jsx(Rz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),a.jsx(Fz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):d=a.jsxs(a.Fragment,{children:[a.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),a.jsx(Fz,{displayMonth:e.displayMonth,id:e.id})]}),a.jsx("div",{className:n.caption,style:o.caption,children:d})}function $Ve(e){var t=fo(),r=t.footer,n=t.styles,s=t.classNames.tfoot;return r?a.jsx("tfoot",{className:s,style:n.tfoot,children:a.jsx("tr",{children:a.jsx("td",{colSpan:8,children:r})})}):a.jsx(a.Fragment,{})}function BVe(e,t,r){for(var n=r?Wg(new Date):ou(new Date,{locale:e,weekStartsOn:t}),s=[],o=0;o<7;o++){var i=rs(n,o);s.push(i)}return s}function qVe(){var e=fo(),t=e.classNames,r=e.styles,n=e.showWeekNumber,s=e.locale,o=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=BVe(s,o,i);return a.jsxs("tr",{style:r.head_row,className:t.head_row,children:[n&&a.jsx("td",{style:r.head_cell,className:t.head_cell}),d.map(function(u,f){return a.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":c(u,{locale:s}),children:l(u,{locale:s})},f)})]})}function zVe(){var e,t=fo(),r=t.classNames,n=t.styles,s=t.components,o=(e=s?.HeadRow)!==null&&e!==void 0?e:qVe;return a.jsx("thead",{style:n.head,className:r.head,children:a.jsx(o,{})})}function UVe(e){var t=fo(),r=t.locale,n=t.formatters.formatDay;return a.jsx(a.Fragment,{children:n(e.date,{locale:r})})}var cR=p.createContext(void 0);function VVe(e){if(!d2(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return a.jsx(cR.Provider,{value:t,children:e.children})}return a.jsx(WVe,{initialProps:e.initialProps,children:e.children})}function WVe(e){var t=e.initialProps,r=e.children,n=t.selected,s=t.min,o=t.max,i=function(d,u,f){var h,m;(h=t.onDayClick)===null||h===void 0||h.call(t,d,u,f);var x=!!(u.selected&&s&&n?.length===s);if(!x){var g=!!(!u.selected&&o&&n?.length===o);if(!g){var y=n?Vee([],n,!0):[];if(u.selected){var v=y.findIndex(function(b){return Dl(d,b)});y.splice(v,1)}else y.push(d);(m=t.onSelect)===null||m===void 0||m.call(t,y,d,u,f)}}},l={disabled:[]};n&&l.disabled.push(function(d){var u=o&&n.length>o-1,f=n.some(function(h){return Dl(h,d)});return!!(u&&!f)});var c={selected:n,onDayClick:i,modifiers:l};return a.jsx(cR.Provider,{value:c,children:r})}function dR(){var e=p.useContext(cR);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function HVe(e,t){var r=t||{},n=r.from,s=r.to;return n&&s?Dl(s,e)&&Dl(n,e)?void 0:Dl(s,e)?{from:s,to:void 0}:Dl(n,e)?void 0:_O(n,e)?{from:e,to:s}:{from:n,to:e}:s?_O(e,s)?{from:s,to:e}:{from:e,to:s}:n?WY(e,n)?{from:e,to:n}:{from:n,to:e}:{from:e,to:void 0}}var uR=p.createContext(void 0);function GVe(e){if(!u2(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return a.jsx(uR.Provider,{value:t,children:e.children})}return a.jsx(KVe,{initialProps:e.initialProps,children:e.children})}function KVe(e){var t=e.initialProps,r=e.children,n=t.selected,s=n||{},o=s.from,i=s.to,l=t.min,c=t.max,d=function(m,x,g){var y,v;(y=t.onDayClick)===null||y===void 0||y.call(t,m,x,g);var b=HVe(m,n);(v=t.onSelect)===null||v===void 0||v.call(t,b,m,x,g)},u={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(u.range_start=[o],i?(u.range_end=[i],Dl(o,i)||(u.range_middle=[{after:o,before:i}])):u.range_end=[o]):i&&(u.range_start=[i],u.range_end=[i]),l&&(o&&!i&&u.disabled.push({after:Fv(o,l-1),before:rs(o,l-1)}),o&&i&&u.disabled.push({after:o,before:rs(o,l-1)}),!o&&i&&u.disabled.push({after:Fv(i,l-1),before:rs(i,l-1)})),c){if(o&&!i&&(u.disabled.push({before:rs(o,-c+1)}),u.disabled.push({after:rs(o,c-1)})),o&&i){var f=yf(i,o)+1,h=c-f;u.disabled.push({before:Fv(o,h)}),u.disabled.push({after:rs(i,h)})}!o&&i&&(u.disabled.push({before:rs(i,-c+1)}),u.disabled.push({after:rs(i,c-1)}))}return a.jsx(uR.Provider,{value:{selected:n,onDayClick:d,modifiers:u},children:r})}function fR(){var e=p.useContext(uR);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Ij(e){return Array.isArray(e)?Vee([],e,!0):e!==void 0?[e]:[]}function XVe(e){var t={};return Object.entries(e).forEach(function(r){var n=r[0],s=r[1];t[n]=Ij(s)}),t}var Vu;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Vu||(Vu={}));var YVe=Vu.Selected,Kf=Vu.Disabled,JVe=Vu.Hidden,QVe=Vu.Today,RE=Vu.RangeEnd,FE=Vu.RangeMiddle,LE=Vu.RangeStart,ZVe=Vu.Outside;function eWe(e,t,r){var n,s=(n={},n[YVe]=Ij(e.selected),n[Kf]=Ij(e.disabled),n[JVe]=Ij(e.hidden),n[QVe]=[e.today],n[RE]=[],n[FE]=[],n[LE]=[],n[ZVe]=[],n);return e.fromDate&&s[Kf].push({before:e.fromDate}),e.toDate&&s[Kf].push({after:e.toDate}),d2(e)?s[Kf]=s[Kf].concat(t.modifiers[Kf]):u2(e)&&(s[Kf]=s[Kf].concat(r.modifiers[Kf]),s[LE]=r.modifiers[LE],s[FE]=r.modifiers[FE],s[RE]=r.modifiers[RE]),s}var Xee=p.createContext(void 0);function tWe(e){var t=fo(),r=dR(),n=fR(),s=eWe(t,r,n),o=XVe(t.modifiers),i=Ma(Ma({},s),o);return a.jsx(Xee.Provider,{value:i,children:e.children})}function Yee(){var e=p.useContext(Xee);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function rWe(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function nWe(e){return!!(e&&typeof e=="object"&&"from"in e)}function aWe(e){return!!(e&&typeof e=="object"&&"after"in e)}function sWe(e){return!!(e&&typeof e=="object"&&"before"in e)}function oWe(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function iWe(e,t){var r,n=t.from,s=t.to;if(n&&s){var o=yf(s,n)<0;o&&(r=[s,n],n=r[0],s=r[1]);var i=yf(e,n)>=0&&yf(s,e)>=0;return i}return s?Dl(s,e):n?Dl(n,e):!1}function lWe(e){return QD(e)}function cWe(e){return Array.isArray(e)&&e.every(QD)}function dWe(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(lWe(r))return Dl(e,r);if(cWe(r))return r.includes(e);if(nWe(r))return iWe(e,r);if(oWe(r))return r.dayOfWeek.includes(e.getDay());if(rWe(r)){var n=yf(r.before,e),s=yf(r.after,e),o=n>0,i=s<0,l=_O(r.before,r.after);return l?i&&o:o||i}return aWe(r)?yf(e,r.after)>0:sWe(r)?yf(r.before,e)>0:typeof r=="function"?r(e):!1})}function mR(e,t,r){var n=Object.keys(t).reduce(function(o,i){var l=t[i];return dWe(e,l)&&o.push(i),o},[]),s={};return n.forEach(function(o){return s[o]=!0}),r&&!eM(e,r)&&(s.outside=!0),s}function uWe(e,t){for(var r=cc(e[0]),n=i5(e[e.length-1]),s,o,i=r;i<=n;){var l=mR(i,t),c=!l.disabled&&!l.hidden;if(!c){i=rs(i,1);continue}if(l.selected)return i;l.today&&!o&&(o=i),s||(s=i),i=rs(i,1)}return o||s}var fWe=365;function Jee(e,t){var r=t.moveBy,n=t.direction,s=t.context,o=t.modifiers,i=t.retry,l=i===void 0?{count:0,lastFocused:e}:i,c=s.weekStartsOn,d=s.fromDate,u=s.toDate,f=s.locale,h={day:rs,week:wO,month:Uu,year:Mwe,startOfWeek:function(y){return s.ISOWeek?Wg(y):ou(y,{locale:f,weekStartsOn:c})},endOfWeek:function(y){return s.ISOWeek?$Y(y):ZD(y,{locale:f,weekStartsOn:c})}},m=h[r](e,n==="after"?1:-1);n==="before"&&d?m=Rwe([d,m]):n==="after"&&u&&(m=Fwe([u,m]));var x=!0;if(o){var g=mR(m,o);x=!g.disabled&&!g.hidden}return x?m:l.count>fWe?l.lastFocused:Jee(m,{moveBy:r,direction:n,context:s,modifiers:o,retry:Ma(Ma({},l),{count:l.count+1})})}var Qee=p.createContext(void 0);function mWe(e){var t=f2(),r=Yee(),n=p.useState(),s=n[0],o=n[1],i=p.useState(),l=i[0],c=i[1],d=uWe(t.displayMonths,r),u=s??(l&&t.isDateDisplayed(l))?l:d,f=function(){c(s),o(void 0)},h=function(y){o(y)},m=fo(),x=function(y,v){if(s){var b=Jee(s,{moveBy:y,direction:v,context:m,modifiers:r});Dl(s,b)||(t.goToDate(b,s),h(b))}},g={focusedDay:s,focusTarget:u,blur:f,focus:h,focusDayAfter:function(){return x("day","after")},focusDayBefore:function(){return x("day","before")},focusWeekAfter:function(){return x("week","after")},focusWeekBefore:function(){return x("week","before")},focusMonthBefore:function(){return x("month","before")},focusMonthAfter:function(){return x("month","after")},focusYearBefore:function(){return x("year","before")},focusYearAfter:function(){return x("year","after")},focusStartOfWeek:function(){return x("startOfWeek","before")},focusEndOfWeek:function(){return x("endOfWeek","after")}};return a.jsx(Qee.Provider,{value:g,children:e.children})}function hR(){var e=p.useContext(Qee);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function hWe(e,t){var r=Yee(),n=mR(e,r,t);return n}var pR=p.createContext(void 0);function pWe(e){if(!tA(e.initialProps)){var t={selected:void 0};return a.jsx(pR.Provider,{value:t,children:e.children})}return a.jsx(gWe,{initialProps:e.initialProps,children:e.children})}function gWe(e){var t=e.initialProps,r=e.children,n=function(o,i,l){var c,d,u;if((c=t.onDayClick)===null||c===void 0||c.call(t,o,i,l),i.selected&&!t.required){(d=t.onSelect)===null||d===void 0||d.call(t,void 0,o,i,l);return}(u=t.onSelect)===null||u===void 0||u.call(t,o,o,i,l)},s={selected:t.selected,onDayClick:n};return a.jsx(pR.Provider,{value:s,children:r})}function Zee(){var e=p.useContext(pR);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function xWe(e,t){var r=fo(),n=Zee(),s=dR(),o=fR(),i=hR(),l=i.focusDayAfter,c=i.focusDayBefore,d=i.focusWeekAfter,u=i.focusWeekBefore,f=i.blur,h=i.focus,m=i.focusMonthBefore,x=i.focusMonthAfter,g=i.focusYearBefore,y=i.focusYearAfter,v=i.focusStartOfWeek,b=i.focusEndOfWeek,w=function(U){var L,W,ge,Ae;tA(r)?(L=n.onDayClick)===null||L===void 0||L.call(n,e,t,U):d2(r)?(W=s.onDayClick)===null||W===void 0||W.call(s,e,t,U):u2(r)?(ge=o.onDayClick)===null||ge===void 0||ge.call(o,e,t,U):(Ae=r.onDayClick)===null||Ae===void 0||Ae.call(r,e,t,U)},_=function(U){var L;h(e),(L=r.onDayFocus)===null||L===void 0||L.call(r,e,t,U)},j=function(U){var L;f(),(L=r.onDayBlur)===null||L===void 0||L.call(r,e,t,U)},S=function(U){var L;(L=r.onDayMouseEnter)===null||L===void 0||L.call(r,e,t,U)},C=function(U){var L;(L=r.onDayMouseLeave)===null||L===void 0||L.call(r,e,t,U)},A=function(U){var L;(L=r.onDayPointerEnter)===null||L===void 0||L.call(r,e,t,U)},P=function(U){var L;(L=r.onDayPointerLeave)===null||L===void 0||L.call(r,e,t,U)},F=function(U){var L;(L=r.onDayTouchCancel)===null||L===void 0||L.call(r,e,t,U)},O=function(U){var L;(L=r.onDayTouchEnd)===null||L===void 0||L.call(r,e,t,U)},I=function(U){var L;(L=r.onDayTouchMove)===null||L===void 0||L.call(r,e,t,U)},T=function(U){var L;(L=r.onDayTouchStart)===null||L===void 0||L.call(r,e,t,U)},k=function(U){var L;(L=r.onDayKeyUp)===null||L===void 0||L.call(r,e,t,U)},B=function(U){var L;switch(U.key){case"ArrowLeft":U.preventDefault(),U.stopPropagation(),r.dir==="rtl"?l():c();break;case"ArrowRight":U.preventDefault(),U.stopPropagation(),r.dir==="rtl"?c():l();break;case"ArrowDown":U.preventDefault(),U.stopPropagation(),d();break;case"ArrowUp":U.preventDefault(),U.stopPropagation(),u();break;case"PageUp":U.preventDefault(),U.stopPropagation(),U.shiftKey?g():m();break;case"PageDown":U.preventDefault(),U.stopPropagation(),U.shiftKey?y():x();break;case"Home":U.preventDefault(),U.stopPropagation(),v();break;case"End":U.preventDefault(),U.stopPropagation(),b();break}(L=r.onDayKeyDown)===null||L===void 0||L.call(r,e,t,U)},z={onClick:w,onFocus:_,onBlur:j,onKeyDown:B,onKeyUp:k,onMouseEnter:S,onMouseLeave:C,onPointerEnter:A,onPointerLeave:P,onTouchCancel:F,onTouchEnd:O,onTouchMove:I,onTouchStart:T};return z}function vWe(){var e=fo(),t=Zee(),r=dR(),n=fR(),s=tA(e)?t.selected:d2(e)?r.selected:u2(e)?n.selected:void 0;return s}function yWe(e){return Object.values(Vu).includes(e)}function bWe(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(n){var s=e.modifiersClassNames[n];if(s)r.push(s);else if(yWe(n)){var o=e.classNames["day_".concat(n)];o&&r.push(o)}}),r}function wWe(e,t){var r=Ma({},e.styles.day);return Object.keys(t).forEach(function(n){var s;r=Ma(Ma({},r),(s=e.modifiersStyles)===null||s===void 0?void 0:s[n])}),r}function _We(e,t,r){var n,s,o,i=fo(),l=hR(),c=hWe(e,t),d=xWe(e,c),u=vWe(),f=!!(i.onDayClick||i.mode!=="default");p.useEffect(function(){var S;c.outside||l.focusedDay&&f&&Dl(l.focusedDay,e)&&((S=r.current)===null||S===void 0||S.focus())},[l.focusedDay,e,r,f,c.outside]);var h=bWe(i,c).join(" "),m=wWe(i,c),x=!!(c.outside&&!i.showOutsideDays||c.hidden),g=(o=(s=i.components)===null||s===void 0?void 0:s.DayContent)!==null&&o!==void 0?o:UVe,y=a.jsx(g,{date:e,displayMonth:t,activeModifiers:c}),v={style:m,className:h,children:y,role:"gridcell"},b=l.focusTarget&&Dl(l.focusTarget,e)&&!c.outside,w=l.focusedDay&&Dl(l.focusedDay,e),_=Ma(Ma(Ma({},v),(n={disabled:c.disabled,role:"gridcell"},n["aria-selected"]=c.selected,n.tabIndex=w||b?0:-1,n)),d),j={isButton:f,isHidden:x,activeModifiers:c,selectedDays:u,buttonProps:_,divProps:v};return j}function jWe(e){var t=p.useRef(null),r=_We(e.date,e.displayMonth,t);return r.isHidden?a.jsx("div",{role:"gridcell"}):r.isButton?a.jsx($S,Ma({name:"day",ref:t},r.buttonProps)):a.jsx("div",Ma({},r.divProps))}function NWe(e){var t=e.number,r=e.dates,n=fo(),s=n.onWeekNumberClick,o=n.styles,i=n.classNames,l=n.locale,c=n.labels.labelWeekNumber,d=n.formatters.formatWeekNumber,u=d(Number(t),{locale:l});if(!s)return a.jsx("span",{className:i.weeknumber,style:o.weeknumber,children:u});var f=c(Number(t),{locale:l}),h=function(m){s(t,r,m)};return a.jsx($S,{name:"week-number","aria-label":f,className:i.weeknumber,style:o.weeknumber,onClick:h,children:u})}function SWe(e){var t,r,n=fo(),s=n.styles,o=n.classNames,i=n.showWeekNumber,l=n.components,c=(t=l?.Day)!==null&&t!==void 0?t:jWe,d=(r=l?.WeekNumber)!==null&&r!==void 0?r:NWe,u;return i&&(u=a.jsx("td",{className:o.cell,style:s.cell,children:a.jsx(d,{number:e.weekNumber,dates:e.dates})})),a.jsxs("tr",{className:o.row,style:s.row,children:[u,e.dates.map(function(f){return a.jsx("td",{className:o.cell,style:s.cell,role:"presentation",children:a.jsx(c,{displayMonth:e.displayMonth,date:f})},t2e(f))})]})}function Lz(e,t,r){for(var n=r?.ISOWeek?$Y(t):ZD(t,r),s=r?.ISOWeek?Wg(e):ou(e,r),o=yf(n,s),i=[],l=0;l<=o;l++)i.push(rs(s,l));var c=i.reduce(function(d,u){var f=r?.ISOWeek?Z1e(u):s2e(u,r),h=d.find(function(m){return m.weekNumber===f});return h?(h.dates.push(u),d):(d.push({weekNumber:f,dates:[u]}),d)},[]);return c}function CWe(e,t){var r=Lz(cc(e),i5(e),t);if(t?.useFixedWeeks){var n=i2e(e,t);if(n<6){var s=r[r.length-1],o=s.dates[s.dates.length-1],i=wO(o,6-n),l=Lz(wO(o,1),i,t);r.push.apply(r,l)}}return r}function AWe(e){var t,r,n,s=fo(),o=s.locale,i=s.classNames,l=s.styles,c=s.hideHead,d=s.fixedWeeks,u=s.components,f=s.weekStartsOn,h=s.firstWeekContainsDate,m=s.ISOWeek,x=CWe(e.displayMonth,{useFixedWeeks:!!d,ISOWeek:m,locale:o,weekStartsOn:f,firstWeekContainsDate:h}),g=(t=u?.Head)!==null&&t!==void 0?t:zVe,y=(r=u?.Row)!==null&&r!==void 0?r:SWe,v=(n=u?.Footer)!==null&&n!==void 0?n:$Ve;return a.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&a.jsx(g,{}),a.jsx("tbody",{className:i.tbody,style:l.tbody,children:x.map(function(b){return a.jsx(y,{displayMonth:e.displayMonth,dates:b.dates,weekNumber:b.weekNumber},b.weekNumber)})}),a.jsx(v,{displayMonth:e.displayMonth})]})}function PWe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var EWe=PWe()?p.useLayoutEffect:p.useEffect,$E=!1,kWe=0;function $z(){return"react-day-picker-".concat(++kWe)}function IWe(e){var t,r=e??($E?$z():null),n=p.useState(r),s=n[0],o=n[1];return EWe(function(){s===null&&o($z())},[]),p.useEffect(function(){$E===!1&&($E=!0)},[]),(t=e??s)!==null&&t!==void 0?t:void 0}function OWe(e){var t,r,n=fo(),s=n.dir,o=n.classNames,i=n.styles,l=n.components,c=f2().displayMonths,d=IWe(n.id?"".concat(n.id,"-").concat(e.displayIndex):void 0),u=n.id?"".concat(n.id,"-grid-").concat(e.displayIndex):void 0,f=[o.month],h=i.month,m=e.displayIndex===0,x=e.displayIndex===c.length-1,g=!m&&!x;s==="rtl"&&(t=[m,x],x=t[0],m=t[1]),m&&(f.push(o.caption_start),h=Ma(Ma({},h),i.caption_start)),x&&(f.push(o.caption_end),h=Ma(Ma({},h),i.caption_end)),g&&(f.push(o.caption_between),h=Ma(Ma({},h),i.caption_between));var y=(r=l?.Caption)!==null&&r!==void 0?r:LVe;return a.jsxs("div",{className:f.join(" "),style:h,children:[a.jsx(y,{id:d,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),a.jsx(AWe,{id:u,"aria-labelledby":d,displayMonth:e.displayMonth})]},e.displayIndex)}function TWe(e){var t=fo(),r=t.classNames,n=t.styles;return a.jsx("div",{className:r.months,style:n.months,children:e.children})}function DWe(e){var t,r,n=e.initialProps,s=fo(),o=hR(),i=f2(),l=p.useState(!1),c=l[0],d=l[1];p.useEffect(function(){s.initialFocus&&o.focusTarget&&(c||(o.focus(o.focusTarget),d(!0)))},[s.initialFocus,c,o.focus,o.focusTarget,o]);var u=[s.classNames.root,s.className];s.numberOfMonths>1&&u.push(s.classNames.multiple_months),s.showWeekNumber&&u.push(s.classNames.with_weeknumber);var f=Ma(Ma({},s.styles.root),s.style),h=Object.keys(n).filter(function(x){return x.startsWith("data-")}).reduce(function(x,g){var y;return Ma(Ma({},x),(y={},y[g]=n[g],y))},{}),m=(r=(t=n.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:TWe;return a.jsx("div",Ma({className:u.join(" "),style:f,dir:s.dir,id:s.id,nonce:n.nonce,title:n.title,lang:n.lang},h,{children:a.jsx(m,{children:i.displayMonths.map(function(x,g){return a.jsx(OWe,{displayIndex:g,displayMonth:x},g)})})}))}function MWe(e){var t=e.children,r=sVe(e,["children"]);return a.jsx(NVe,{initialProps:r,children:a.jsx(DVe,{children:a.jsx(pWe,{initialProps:r,children:a.jsx(VVe,{initialProps:r,children:a.jsx(GVe,{initialProps:r,children:a.jsx(tWe,{children:a.jsx(mWe,{children:t})})})})})})})}function e3(e){return a.jsx(MWe,Ma({},e,{children:a.jsx(DWe,{initialProps:e})}))}function oi({className:e,classNames:t,showOutsideDays:r=!0,weekStartsOn:n=1,locale:s=ga,...o}){const i=["dom","seg","ter","qua","qui","sex","sb"];return a.jsx(e3,{showOutsideDays:r,weekStartsOn:n,locale:s,className:Sr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Sr(Ow({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Sr(Ow({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},formatters:{formatWeekdayName:(l,c)=>i[l.getDay()]},components:{IconLeft:({...l})=>a.jsx(qI,{className:"h-4 w-4"}),IconRight:({...l})=>a.jsx(qg,{className:"h-4 w-4"})},...o})}oi.displayName="Calendar";var ete="AlertDialog",[RWe,pct]=cu(ete,[UX]),zm=UX(),tte=e=>{const{__scopeAlertDialog:t,...r}=e,n=zm(t);return a.jsx(sY,{...n,...r,modal:!0})};tte.displayName=ete;var FWe="AlertDialogTrigger",rte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=zm(r);return a.jsx(O0e,{...s,...n,ref:t})});rte.displayName=FWe;var LWe="AlertDialogPortal",nte=e=>{const{__scopeAlertDialog:t,...r}=e,n=zm(t);return a.jsx(oY,{...n,...r})};nte.displayName=LWe;var $We="AlertDialogOverlay",ate=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=zm(r);return a.jsx(zD,{...s,...n,ref:t})});ate.displayName=$We;var qv="AlertDialogContent",[BWe,qWe]=RWe(qv),zWe=Cge("AlertDialogContent"),ste=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...s}=e,o=zm(r),i=p.useRef(null),l=ms(t,i),c=p.useRef(null);return a.jsx(P0e,{contentName:qv,titleName:ote,docsSlug:"alert-dialog",children:a.jsx(BWe,{scope:r,cancelRef:c,children:a.jsxs(UD,{role:"alertdialog",...o,...s,ref:l,onOpenAutoFocus:Bn(s.onOpenAutoFocus,d=>{d.preventDefault(),c.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[a.jsx(zWe,{children:n}),a.jsx(VWe,{contentRef:i})]})})})});ste.displayName=qv;var ote="AlertDialogTitle",ite=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=zm(r);return a.jsx(VD,{...s,...n,ref:t})});ite.displayName=ote;var lte="AlertDialogDescription",cte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=zm(r);return a.jsx(WD,{...s,...n,ref:t})});cte.displayName=lte;var UWe="AlertDialogAction",dte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=zm(r);return a.jsx(t5,{...s,...n,ref:t})});dte.displayName=UWe;var ute="AlertDialogCancel",fte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:s}=qWe(ute,r),o=zm(r),i=ms(t,s);return a.jsx(t5,{...o,...n,ref:i})});fte.displayName=ute;var VWe=({contentRef:e})=>{const t=`\`${qv}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${qv}\` by passing a \`${lte}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${qv}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return p.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},WWe=tte,HWe=rte,GWe=nte,mte=ate,hte=ste,pte=dte,gte=fte,xte=ite,vte=cte;const ku=WWe,gg=HWe,KWe=GWe,yte=Ee.forwardRef(({className:e,...t},r)=>a.jsx(mte,{className:Sr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));yte.displayName=mte.displayName;const Bd=Ee.forwardRef(({className:e,...t},r)=>a.jsxs(KWe,{children:[a.jsx(yte,{}),a.jsx(hte,{ref:r,className:Sr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Bd.displayName=hte.displayName;const qd=({className:e,...t})=>a.jsx("div",{className:Sr("flex flex-col space-y-2 text-center sm:text-left",e),...t});qd.displayName="AlertDialogHeader";const zd=({className:e,...t})=>a.jsx("div",{className:Sr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});zd.displayName="AlertDialogFooter";const Ud=Ee.forwardRef(({className:e,...t},r)=>a.jsx(xte,{ref:r,className:Sr("text-lg font-semibold",e),...t}));Ud.displayName=xte.displayName;const Vd=Ee.forwardRef(({className:e,...t},r)=>a.jsx(vte,{ref:r,className:Sr("text-sm text-muted-foreground",e),...t}));Vd.displayName=vte.displayName;const Iu=Ee.forwardRef(({className:e,...t},r)=>a.jsx(pte,{ref:r,className:Sr(Ow(),e),...t}));Iu.displayName=pte.displayName;const Wd=Ee.forwardRef(({className:e,...t},r)=>a.jsx(gte,{ref:r,className:Sr(Ow({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Wd.displayName=gte.displayName;function Bz(e,[t,r]){return Math.min(r,Math.max(t,e))}function rA(e){const t=e+"CollectionProvider",[r,n]=cu(t),[s,o]=r(t,{collectionRef:{current:null},itemMap:new Map}),i=g=>{const{scope:y,children:v}=g,b=Ee.useRef(null),w=Ee.useRef(new Map).current;return a.jsx(s,{scope:y,itemMap:w,collectionRef:b,children:v})};i.displayName=t;const l=e+"CollectionSlot",c=ip(l),d=Ee.forwardRef((g,y)=>{const{scope:v,children:b}=g,w=o(l,v),_=ms(y,w.collectionRef);return a.jsx(c,{ref:_,children:b})});d.displayName=l;const u=e+"CollectionItemSlot",f="data-radix-collection-item",h=ip(u),m=Ee.forwardRef((g,y)=>{const{scope:v,children:b,...w}=g,_=Ee.useRef(null),j=ms(y,_),S=o(u,v);return Ee.useEffect(()=>(S.itemMap.set(_,{ref:_,...w}),()=>void S.itemMap.delete(_))),a.jsx(h,{[f]:"",ref:j,children:b})});m.displayName=u;function x(g){const y=o(e+"CollectionConsumer",g);return Ee.useCallback(()=>{const b=y.collectionRef.current;if(!b)return[];const w=Array.from(b.querySelectorAll(`[${f}]`));return Array.from(y.itemMap.values()).sort((S,C)=>w.indexOf(S.ref.current)-w.indexOf(C.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:i,Slot:d,ItemSlot:m},x,n]}var XWe=p.createContext(void 0);function nA(e){const t=p.useContext(XWe);return e||t||"ltr"}function bte(e){const t=p.useRef({value:e,previous:e});return p.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var wte=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),YWe="VisuallyHidden",gR=p.forwardRef((e,t)=>a.jsx(ka.span,{...e,ref:t,style:{...wte,...e.style}}));gR.displayName=YWe;var JWe=[" ","Enter","ArrowUp","ArrowDown"],QWe=[" ","Enter"],Qg="Select",[aA,sA,ZWe]=rA(Qg),[my,gct]=cu(Qg,[ZWe,X0]),oA=X0(),[eHe,Pp]=my(Qg),[tHe,rHe]=my(Qg),_te=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:s,onOpenChange:o,value:i,defaultValue:l,onValueChange:c,dir:d,name:u,autoComplete:f,disabled:h,required:m,form:x}=e,g=oA(t),[y,v]=p.useState(null),[b,w]=p.useState(null),[_,j]=p.useState(!1),S=nA(d),[C,A]=km({prop:n,defaultProp:s??!1,onChange:o,caller:Qg}),[P,F]=km({prop:i,defaultProp:l,onChange:c,caller:Qg}),O=p.useRef(null),I=y?x||!!y.closest("form"):!0,[T,k]=p.useState(new Set),B=Array.from(T).map(z=>z.props.value).join(";");return a.jsx(MD,{...g,children:a.jsxs(eHe,{required:m,scope:t,trigger:y,onTriggerChange:v,valueNode:b,onValueNodeChange:w,valueNodeHasChildren:_,onValueNodeHasChildrenChange:j,contentId:Fu(),value:P,onValueChange:F,open:C,onOpenChange:A,dir:S,triggerPointerDownPosRef:O,disabled:h,children:[a.jsx(aA.Provider,{scope:t,children:a.jsx(tHe,{scope:e.__scopeSelect,onNativeOptionAdd:p.useCallback(z=>{k(U=>new Set(U).add(z))},[]),onNativeOptionRemove:p.useCallback(z=>{k(U=>{const L=new Set(U);return L.delete(z),L})},[]),children:r})}),I?a.jsxs(Vte,{"aria-hidden":!0,required:m,tabIndex:-1,name:u,autoComplete:f,value:P,onChange:z=>F(z.target.value),disabled:h,form:x,children:[P===void 0?a.jsx("option",{value:""}):null,Array.from(T)]},B):null]})})};_te.displayName=Qg;var jte="SelectTrigger",Nte=p.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...s}=e,o=oA(r),i=Pp(jte,r),l=i.disabled||n,c=ms(t,i.onTriggerChange),d=sA(r),u=p.useRef("touch"),[f,h,m]=Hte(g=>{const y=d().filter(w=>!w.disabled),v=y.find(w=>w.value===i.value),b=Gte(y,g,v);b!==void 0&&i.onValueChange(b.value)}),x=g=>{l||(i.onOpenChange(!0),m()),g&&(i.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return a.jsx(XC,{asChild:!0,...o,children:a.jsx(ka.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":Wte(i.value)?"":void 0,...s,ref:c,onClick:Bn(s.onClick,g=>{g.currentTarget.focus(),u.current!=="mouse"&&x(g)}),onPointerDown:Bn(s.onPointerDown,g=>{u.current=g.pointerType;const y=g.target;y.hasPointerCapture(g.pointerId)&&y.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(x(g),g.preventDefault())}),onKeyDown:Bn(s.onKeyDown,g=>{const y=f.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&h(g.key),!(y&&g.key===" ")&&JWe.includes(g.key)&&(x(),g.preventDefault())})})})});Nte.displayName=jte;var Ste="SelectValue",Cte=p.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,children:o,placeholder:i="",...l}=e,c=Pp(Ste,r),{onValueNodeHasChildrenChange:d}=c,u=o!==void 0,f=ms(t,c.onValueNodeChange);return ml(()=>{d(u)},[d,u]),a.jsx(ka.span,{...l,ref:f,style:{pointerEvents:"none"},children:Wte(c.value)?a.jsx(a.Fragment,{children:i}):o})});Cte.displayName=Ste;var nHe="SelectIcon",Ate=p.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...s}=e;return a.jsx(ka.span,{"aria-hidden":!0,...s,ref:t,children:n||""})});Ate.displayName=nHe;var aHe="SelectPortal",Pte=e=>a.jsx(Y0,{asChild:!0,...e});Pte.displayName=aHe;var Zg="SelectContent",Ete=p.forwardRef((e,t)=>{const r=Pp(Zg,e.__scopeSelect),[n,s]=p.useState();if(ml(()=>{s(new DocumentFragment)},[]),!r.open){const o=n;return o?Rm.createPortal(a.jsx(kte,{scope:e.__scopeSelect,children:a.jsx(aA.Slot,{scope:e.__scopeSelect,children:a.jsx("div",{children:e.children})})}),o):null}return a.jsx(Ite,{...e,ref:t})});Ete.displayName=Zg;var ju=10,[kte,Ep]=my(Zg),sHe="SelectContentImpl",oHe=ip("SelectContent.RemoveScroll"),Ite=p.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:o,onPointerDownOutside:i,side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:h,collisionPadding:m,sticky:x,hideWhenDetached:g,avoidCollisions:y,...v}=e,b=Pp(Zg,r),[w,_]=p.useState(null),[j,S]=p.useState(null),C=ms(t,G=>_(G)),[A,P]=p.useState(null),[F,O]=p.useState(null),I=sA(r),[T,k]=p.useState(!1),B=p.useRef(!1);p.useEffect(()=>{if(w)return YC(w)},[w]),WC();const z=p.useCallback(G=>{const[ue,...ve]=I().map(me=>me.ref.current),[ae]=ve.slice(-1),oe=document.activeElement;for(const me of G)if(me===oe||(me?.scrollIntoView({block:"nearest"}),me===ue&&j&&(j.scrollTop=0),me===ae&&j&&(j.scrollTop=j.scrollHeight),me?.focus(),document.activeElement!==oe))return},[I,j]),U=p.useCallback(()=>z([A,w]),[z,A,w]);p.useEffect(()=>{T&&U()},[T,U]);const{onOpenChange:L,triggerPointerDownPosRef:W}=b;p.useEffect(()=>{if(w){let G={x:0,y:0};const ue=ae=>{G={x:Math.abs(Math.round(ae.pageX)-(W.current?.x??0)),y:Math.abs(Math.round(ae.pageY)-(W.current?.y??0))}},ve=ae=>{G.x<=10&&G.y<=10?ae.preventDefault():w.contains(ae.target)||L(!1),document.removeEventListener("pointermove",ue),W.current=null};return W.current!==null&&(document.addEventListener("pointermove",ue),document.addEventListener("pointerup",ve,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ue),document.removeEventListener("pointerup",ve,{capture:!0})}}},[w,L,W]),p.useEffect(()=>{const G=()=>L(!1);return window.addEventListener("blur",G),window.addEventListener("resize",G),()=>{window.removeEventListener("blur",G),window.removeEventListener("resize",G)}},[L]);const[ge,Ae]=Hte(G=>{const ue=I().filter(oe=>!oe.disabled),ve=ue.find(oe=>oe.ref.current===document.activeElement),ae=Gte(ue,G,ve);ae&&setTimeout(()=>ae.ref.current.focus())}),V=p.useCallback((G,ue,ve)=>{const ae=!B.current&&!ve;(b.value!==void 0&&b.value===ue||ae)&&(P(G),ae&&(B.current=!0))},[b.value]),$=p.useCallback(()=>w?.focus(),[w]),Y=p.useCallback((G,ue,ve)=>{const ae=!B.current&&!ve;(b.value!==void 0&&b.value===ue||ae)&&O(G)},[b.value]),he=n==="popper"?t3:Ote,J=he===t3?{side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:h,collisionPadding:m,sticky:x,hideWhenDetached:g,avoidCollisions:y}:{};return a.jsx(kte,{scope:r,content:w,viewport:j,onViewportChange:S,itemRefCallback:V,selectedItem:A,onItemLeave:$,itemTextRefCallback:Y,focusSelectedItem:U,selectedItemText:F,position:n,isPositioned:T,searchRef:ge,children:a.jsx(QC,{as:oHe,allowPinchZoom:!0,children:a.jsx(Y1,{asChild:!0,trapped:b.open,onMountAutoFocus:G=>{G.preventDefault()},onUnmountAutoFocus:Bn(s,G=>{b.trigger?.focus({preventScroll:!0}),G.preventDefault()}),children:a.jsx(H0,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:G=>G.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:a.jsx(he,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:G=>G.preventDefault(),...v,...J,onPlaced:()=>k(!0),ref:C,style:{display:"flex",flexDirection:"column",outline:"none",...v.style},onKeyDown:Bn(v.onKeyDown,G=>{const ue=G.ctrlKey||G.altKey||G.metaKey;if(G.key==="Tab"&&G.preventDefault(),!ue&&G.key.length===1&&Ae(G.key),["ArrowUp","ArrowDown","Home","End"].includes(G.key)){let ae=I().filter(oe=>!oe.disabled).map(oe=>oe.ref.current);if(["ArrowUp","End"].includes(G.key)&&(ae=ae.slice().reverse()),["ArrowUp","ArrowDown"].includes(G.key)){const oe=G.target,me=ae.indexOf(oe);ae=ae.slice(me+1)}setTimeout(()=>z(ae)),G.preventDefault()}})})})})})})});Ite.displayName=sHe;var iHe="SelectItemAlignedPosition",Ote=p.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...s}=e,o=Pp(Zg,r),i=Ep(Zg,r),[l,c]=p.useState(null),[d,u]=p.useState(null),f=ms(t,C=>u(C)),h=sA(r),m=p.useRef(!1),x=p.useRef(!0),{viewport:g,selectedItem:y,selectedItemText:v,focusSelectedItem:b}=i,w=p.useCallback(()=>{if(o.trigger&&o.valueNode&&l&&d&&g&&y&&v){const C=o.trigger.getBoundingClientRect(),A=d.getBoundingClientRect(),P=o.valueNode.getBoundingClientRect(),F=v.getBoundingClientRect();if(o.dir!=="rtl"){const oe=F.left-A.left,me=P.left-oe,De=C.left-me,ne=C.width+De,ie=Math.max(ne,A.width),ht=window.innerWidth-ju,pt=Bz(me,[ju,Math.max(ju,ht-ie)]);l.style.minWidth=ne+"px",l.style.left=pt+"px"}else{const oe=A.right-F.right,me=window.innerWidth-P.right-oe,De=window.innerWidth-C.right-me,ne=C.width+De,ie=Math.max(ne,A.width),ht=window.innerWidth-ju,pt=Bz(me,[ju,Math.max(ju,ht-ie)]);l.style.minWidth=ne+"px",l.style.right=pt+"px"}const O=h(),I=window.innerHeight-ju*2,T=g.scrollHeight,k=window.getComputedStyle(d),B=parseInt(k.borderTopWidth,10),z=parseInt(k.paddingTop,10),U=parseInt(k.borderBottomWidth,10),L=parseInt(k.paddingBottom,10),W=B+z+T+L+U,ge=Math.min(y.offsetHeight*5,W),Ae=window.getComputedStyle(g),V=parseInt(Ae.paddingTop,10),$=parseInt(Ae.paddingBottom,10),Y=C.top+C.height/2-ju,he=I-Y,J=y.offsetHeight/2,G=y.offsetTop+J,ue=B+z+G,ve=W-ue;if(ue<=Y){const oe=O.length>0&&y===O[O.length-1].ref.current;l.style.bottom="0px";const me=d.clientHeight-g.offsetTop-g.offsetHeight,De=Math.max(he,J+(oe?$:0)+me+U),ne=ue+De;l.style.height=ne+"px"}else{const oe=O.length>0&&y===O[0].ref.current;l.style.top="0px";const De=Math.max(Y,B+g.offsetTop+(oe?V:0)+J)+ve;l.style.height=De+"px",g.scrollTop=ue-Y+g.offsetTop}l.style.margin=`${ju}px 0`,l.style.minHeight=ge+"px",l.style.maxHeight=I+"px",n?.(),requestAnimationFrame(()=>m.current=!0)}},[h,o.trigger,o.valueNode,l,d,g,y,v,o.dir,n]);ml(()=>w(),[w]);const[_,j]=p.useState();ml(()=>{d&&j(window.getComputedStyle(d).zIndex)},[d]);const S=p.useCallback(C=>{C&&x.current===!0&&(w(),b?.(),x.current=!1)},[w,b]);return a.jsx(cHe,{scope:r,contentWrapper:l,shouldExpandOnScrollRef:m,onScrollButtonChange:S,children:a.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:_},children:a.jsx(ka.div,{...s,ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});Ote.displayName=iHe;var lHe="SelectPopperPosition",t3=p.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:s=ju,...o}=e,i=oA(r);return a.jsx(RD,{...i,...o,ref:t,align:n,collisionPadding:s,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});t3.displayName=lHe;var[cHe,xR]=my(Zg,{}),r3="SelectViewport",Tte=p.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...s}=e,o=Ep(r3,r),i=xR(r3,r),l=ms(t,o.onViewportChange),c=p.useRef(0);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),a.jsx(aA.Slot,{scope:r,children:a.jsx(ka.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:Bn(s.onScroll,d=>{const u=d.currentTarget,{contentWrapper:f,shouldExpandOnScrollRef:h}=i;if(h?.current&&f){const m=Math.abs(c.current-u.scrollTop);if(m>0){const x=window.innerHeight-ju*2,g=parseFloat(f.style.minHeight),y=parseFloat(f.style.height),v=Math.max(g,y);if(v<x){const b=v+m,w=Math.min(x,b),_=b-w;f.style.height=w+"px",f.style.bottom==="0px"&&(u.scrollTop=_>0?_:0,f.style.justifyContent="flex-end")}}}c.current=u.scrollTop})})})]})});Tte.displayName=r3;var Dte="SelectGroup",[dHe,uHe]=my(Dte),fHe=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=Fu();return a.jsx(dHe,{scope:r,id:s,children:a.jsx(ka.div,{role:"group","aria-labelledby":s,...n,ref:t})})});fHe.displayName=Dte;var Mte="SelectLabel",Rte=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=uHe(Mte,r);return a.jsx(ka.div,{id:s.id,...n,ref:t})});Rte.displayName=Mte;var BS="SelectItem",[mHe,Fte]=my(BS),Lte=p.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:s=!1,textValue:o,...i}=e,l=Pp(BS,r),c=Ep(BS,r),d=l.value===n,[u,f]=p.useState(o??""),[h,m]=p.useState(!1),x=ms(t,b=>c.itemRefCallback?.(b,n,s)),g=Fu(),y=p.useRef("touch"),v=()=>{s||(l.onValueChange(n),l.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return a.jsx(mHe,{scope:r,value:n,disabled:s,textId:g,isSelected:d,onItemTextChange:p.useCallback(b=>{f(w=>w||(b?.textContent??"").trim())},[]),children:a.jsx(aA.ItemSlot,{scope:r,value:n,disabled:s,textValue:u,children:a.jsx(ka.div,{role:"option","aria-labelledby":g,"data-highlighted":h?"":void 0,"aria-selected":d&&h,"data-state":d?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...i,ref:x,onFocus:Bn(i.onFocus,()=>m(!0)),onBlur:Bn(i.onBlur,()=>m(!1)),onClick:Bn(i.onClick,()=>{y.current!=="mouse"&&v()}),onPointerUp:Bn(i.onPointerUp,()=>{y.current==="mouse"&&v()}),onPointerDown:Bn(i.onPointerDown,b=>{y.current=b.pointerType}),onPointerMove:Bn(i.onPointerMove,b=>{y.current=b.pointerType,s?c.onItemLeave?.():y.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Bn(i.onPointerLeave,b=>{b.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:Bn(i.onKeyDown,b=>{c.searchRef?.current!==""&&b.key===" "||(QWe.includes(b.key)&&v(),b.key===" "&&b.preventDefault())})})})})});Lte.displayName=BS;var vb="SelectItemText",$te=p.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,...o}=e,i=Pp(vb,r),l=Ep(vb,r),c=Fte(vb,r),d=rHe(vb,r),[u,f]=p.useState(null),h=ms(t,v=>f(v),c.onItemTextChange,v=>l.itemTextRefCallback?.(v,c.value,c.disabled)),m=u?.textContent,x=p.useMemo(()=>a.jsx("option",{value:c.value,disabled:c.disabled,children:m},c.value),[c.disabled,c.value,m]),{onNativeOptionAdd:g,onNativeOptionRemove:y}=d;return ml(()=>(g(x),()=>y(x)),[g,y,x]),a.jsxs(a.Fragment,{children:[a.jsx(ka.span,{id:c.textId,...o,ref:h}),c.isSelected&&i.valueNode&&!i.valueNodeHasChildren?Rm.createPortal(o.children,i.valueNode):null]})});$te.displayName=vb;var Bte="SelectItemIndicator",qte=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return Fte(Bte,r).isSelected?a.jsx(ka.span,{"aria-hidden":!0,...n,ref:t}):null});qte.displayName=Bte;var n3="SelectScrollUpButton",hHe=p.forwardRef((e,t)=>{const r=Ep(n3,e.__scopeSelect),n=xR(n3,e.__scopeSelect),[s,o]=p.useState(!1),i=ms(t,n.onScrollButtonChange);return ml(()=>{if(r.viewport&&r.isPositioned){let l=function(){const d=c.scrollTop>0;o(d)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),s?a.jsx(zte,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop-c.offsetHeight)}}):null});hHe.displayName=n3;var a3="SelectScrollDownButton",pHe=p.forwardRef((e,t)=>{const r=Ep(a3,e.__scopeSelect),n=xR(a3,e.__scopeSelect),[s,o]=p.useState(!1),i=ms(t,n.onScrollButtonChange);return ml(()=>{if(r.viewport&&r.isPositioned){let l=function(){const d=c.scrollHeight-c.clientHeight,u=Math.ceil(c.scrollTop)<d;o(u)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),s?a.jsx(zte,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop+c.offsetHeight)}}):null});pHe.displayName=a3;var zte=p.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...s}=e,o=Ep("SelectScrollButton",r),i=p.useRef(null),l=sA(r),c=p.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return p.useEffect(()=>()=>c(),[c]),ml(()=>{l().find(u=>u.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),a.jsx(ka.div,{"aria-hidden":!0,...s,ref:t,style:{flexShrink:0,...s.style},onPointerDown:Bn(s.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(n,50))}),onPointerMove:Bn(s.onPointerMove,()=>{o.onItemLeave?.(),i.current===null&&(i.current=window.setInterval(n,50))}),onPointerLeave:Bn(s.onPointerLeave,()=>{c()})})}),gHe="SelectSeparator",Ute=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return a.jsx(ka.div,{"aria-hidden":!0,...n,ref:t})});Ute.displayName=gHe;var s3="SelectArrow",xHe=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=oA(r),o=Pp(s3,r),i=Ep(s3,r);return o.open&&i.position==="popper"?a.jsx(FD,{...s,...n,ref:t}):null});xHe.displayName=s3;var vHe="SelectBubbleInput",Vte=p.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const s=p.useRef(null),o=ms(n,s),i=bte(t);return p.useEffect(()=>{const l=s.current;if(!l)return;const c=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(i!==t&&u){const f=new Event("change",{bubbles:!0});u.call(l,t),l.dispatchEvent(f)}},[i,t]),a.jsx(ka.select,{...r,style:{...wte,...r.style},ref:o,defaultValue:t})});Vte.displayName=vHe;function Wte(e){return e===""||e===void 0}function Hte(e){const t=Dc(e),r=p.useRef(""),n=p.useRef(0),s=p.useCallback(i=>{const l=r.current+i;t(l),function c(d){r.current=d,window.clearTimeout(n.current),d!==""&&(n.current=window.setTimeout(()=>c(""),1e3))}(l)},[t]),o=p.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return p.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,s,o]}function Gte(e,t,r){const s=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let i=yHe(e,Math.max(o,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.textValue.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function yHe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var bHe=_te,Kte=Nte,wHe=Cte,_He=Ate,jHe=Pte,Xte=Ete,NHe=Tte,Yte=Rte,Jte=Lte,SHe=$te,CHe=qte,Qte=Ute;const Gn=bHe,Kn=wHe,Vn=Ee.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Kte,{ref:n,className:Sr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground hover:bg-surface-2/30 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-150",e),...r,children:[t,a.jsx(_He,{asChild:!0,children:a.jsx(ix,{className:"h-4 w-4 opacity-50"})})]}));Vn.displayName=Kte.displayName;const Wn=Ee.forwardRef(({className:e,children:t,position:r="popper",...n},s)=>a.jsx(jHe,{children:a.jsx(Xte,{ref:s,className:Sr("relative z-50 min-w-[8rem] max-h-[340px] overflow-auto fx-scroll rounded-md border bg-popover text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:a.jsx(NHe,{className:Sr("p-1",r==="popper"&&"w-full min-w-[var(--radix-select-trigger-width)]"),children:t})})}));Wn.displayName=Xte.displayName;const AHe=Ee.forwardRef(({className:e,...t},r)=>a.jsx(Yte,{ref:r,className:Sr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));AHe.displayName=Yte.displayName;const lt=Ee.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Jte,{ref:n,className:Sr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none hover:bg-surface-2/50 focus:bg-surface-2/50 data-[state=checked]:bg-surface-2/50 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-colors",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(CHe,{children:a.jsx(Sm,{className:"h-4 w-4"})})}),a.jsx(SHe,{children:t})]}));lt.displayName=Jte.displayName;const PHe=Ee.forwardRef(({className:e,...t},r)=>a.jsx(Qte,{ref:r,className:Sr("-mx-1 my-1 h-px bg-muted",e),...t}));PHe.displayName=Qte.displayName;var iA="Checkbox",[EHe,xct]=cu(iA),[kHe,vR]=EHe(iA);function IHe(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:s,disabled:o,form:i,name:l,onCheckedChange:c,required:d,value:u="on",internal_do_not_use_render:f}=e,[h,m]=km({prop:r,defaultProp:s??!1,onChange:c,caller:iA}),[x,g]=p.useState(null),[y,v]=p.useState(null),b=p.useRef(!1),w=x?!!i||!!x.closest("form"):!0,_={checked:h,disabled:o,setChecked:m,control:x,setControl:g,name:l,form:i,value:u,hasConsumerStoppedPropagationRef:b,required:d,defaultChecked:Hh(s)?!1:s,isFormControl:w,bubbleInput:y,setBubbleInput:v};return a.jsx(kHe,{scope:t,..._,children:OHe(f)?f(_):n})}var Zte="CheckboxTrigger",ere=p.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},s)=>{const{control:o,value:i,disabled:l,checked:c,required:d,setControl:u,setChecked:f,hasConsumerStoppedPropagationRef:h,isFormControl:m,bubbleInput:x}=vR(Zte,e),g=ms(s,u),y=p.useRef(c);return p.useEffect(()=>{const v=o?.form;if(v){const b=()=>f(y.current);return v.addEventListener("reset",b),()=>v.removeEventListener("reset",b)}},[o,f]),a.jsx(ka.button,{type:"button",role:"checkbox","aria-checked":Hh(c)?"mixed":c,"aria-required":d,"data-state":sre(c),"data-disabled":l?"":void 0,disabled:l,value:i,...n,ref:g,onKeyDown:Bn(t,v=>{v.key==="Enter"&&v.preventDefault()}),onClick:Bn(r,v=>{f(b=>Hh(b)?!0:!b),x&&m&&(h.current=v.isPropagationStopped(),h.current||v.stopPropagation())})})});ere.displayName=Zte;var yR=p.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:s,defaultChecked:o,required:i,disabled:l,value:c,onCheckedChange:d,form:u,...f}=e;return a.jsx(IHe,{__scopeCheckbox:r,checked:s,defaultChecked:o,disabled:l,required:i,onCheckedChange:d,name:n,form:u,value:c,internal_do_not_use_render:({isFormControl:h})=>a.jsxs(a.Fragment,{children:[a.jsx(ere,{...f,ref:t,__scopeCheckbox:r}),h&&a.jsx(are,{__scopeCheckbox:r})]})})});yR.displayName=iA;var tre="CheckboxIndicator",rre=p.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...s}=e,o=vR(tre,r);return a.jsx(jd,{present:n||Hh(o.checked)||o.checked===!0,children:a.jsx(ka.span,{"data-state":sre(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});rre.displayName=tre;var nre="CheckboxBubbleInput",are=p.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:s,checked:o,defaultChecked:i,required:l,disabled:c,name:d,value:u,form:f,bubbleInput:h,setBubbleInput:m}=vR(nre,e),x=ms(r,m),g=bte(o),y=fX(n);p.useEffect(()=>{const b=h;if(!b)return;const w=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(w,"checked").set,S=!s.current;if(g!==o&&j){const C=new Event("click",{bubbles:S});b.indeterminate=Hh(o),j.call(b,Hh(o)?!1:o),b.dispatchEvent(C)}},[h,g,o,s]);const v=p.useRef(Hh(o)?!1:o);return a.jsx(ka.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??v.current,required:l,disabled:c,name:d,value:u,form:f,...t,tabIndex:-1,ref:x,style:{...t.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});are.displayName=nre;function OHe(e){return typeof e=="function"}function Hh(e){return e==="indeterminate"}function sre(e){return Hh(e)?"indeterminate":e?"checked":"unchecked"}const Is=Ee.forwardRef(({className:e,...t},r)=>a.jsx(yR,{ref:r,className:Sr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:a.jsx(rre,{className:Sr("flex items-center justify-center text-current"),children:a.jsx(Sm,{className:"h-4 w-4"})})}));Is.displayName=yR.displayName;var BE="rovingFocusGroup.onEntryFocus",THe={bubbles:!1,cancelable:!0},m2="RovingFocusGroup",[o3,ore,DHe]=rA(m2),[MHe,lA]=cu(m2,[DHe]),[RHe,FHe]=MHe(m2),ire=p.forwardRef((e,t)=>a.jsx(o3.Provider,{scope:e.__scopeRovingFocusGroup,children:a.jsx(o3.Slot,{scope:e.__scopeRovingFocusGroup,children:a.jsx(LHe,{...e,ref:t})})}));ire.displayName=m2;var LHe=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:s=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:u=!1,...f}=e,h=p.useRef(null),m=ms(t,h),x=nA(o),[g,y]=km({prop:i,defaultProp:l??null,onChange:c,caller:m2}),[v,b]=p.useState(!1),w=Dc(d),_=ore(r),j=p.useRef(!1),[S,C]=p.useState(0);return p.useEffect(()=>{const A=h.current;if(A)return A.addEventListener(BE,w),()=>A.removeEventListener(BE,w)},[w]),a.jsx(RHe,{scope:r,orientation:n,dir:x,loop:s,currentTabStopId:g,onItemFocus:p.useCallback(A=>y(A),[y]),onItemShiftTab:p.useCallback(()=>b(!0),[]),onFocusableItemAdd:p.useCallback(()=>C(A=>A+1),[]),onFocusableItemRemove:p.useCallback(()=>C(A=>A-1),[]),children:a.jsx(ka.div,{tabIndex:v||S===0?-1:0,"data-orientation":n,...f,ref:m,style:{outline:"none",...e.style},onMouseDown:Bn(e.onMouseDown,()=>{j.current=!0}),onFocus:Bn(e.onFocus,A=>{const P=!j.current;if(A.target===A.currentTarget&&P&&!v){const F=new CustomEvent(BE,THe);if(A.currentTarget.dispatchEvent(F),!F.defaultPrevented){const O=_().filter(z=>z.focusable),I=O.find(z=>z.active),T=O.find(z=>z.id===g),B=[I,T,...O].filter(Boolean).map(z=>z.ref.current);dre(B,u)}}j.current=!1}),onBlur:Bn(e.onBlur,()=>b(!1))})})}),lre="RovingFocusGroupItem",cre=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:s=!1,tabStopId:o,children:i,...l}=e,c=Fu(),d=o||c,u=FHe(lre,r),f=u.currentTabStopId===d,h=ore(r),{onFocusableItemAdd:m,onFocusableItemRemove:x,currentTabStopId:g}=u;return p.useEffect(()=>{if(n)return m(),()=>x()},[n,m,x]),a.jsx(o3.ItemSlot,{scope:r,id:d,focusable:n,active:s,children:a.jsx(ka.span,{tabIndex:f?0:-1,"data-orientation":u.orientation,...l,ref:t,onMouseDown:Bn(e.onMouseDown,y=>{n?u.onItemFocus(d):y.preventDefault()}),onFocus:Bn(e.onFocus,()=>u.onItemFocus(d)),onKeyDown:Bn(e.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){u.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const v=qHe(y,u.orientation,u.dir);if(v!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let w=h().filter(_=>_.focusable).map(_=>_.ref.current);if(v==="last")w.reverse();else if(v==="prev"||v==="next"){v==="prev"&&w.reverse();const _=w.indexOf(y.currentTarget);w=u.loop?zHe(w,_+1):w.slice(_+1)}setTimeout(()=>dre(w))}}),children:typeof i=="function"?i({isCurrentTabStop:f,hasTabStop:g!=null}):i})})});cre.displayName=lre;var $He={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function BHe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function qHe(e,t,r){const n=BHe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return $He[n]}function dre(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function zHe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var ure=ire,fre=cre,i3=["Enter"," "],UHe=["ArrowDown","PageUp","Home"],mre=["ArrowUp","PageDown","End"],VHe=[...UHe,...mre],WHe={ltr:[...i3,"ArrowRight"],rtl:[...i3,"ArrowLeft"]},HHe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},h2="Menu",[w1,GHe,KHe]=rA(h2),[xx,hre]=cu(h2,[KHe,X0,lA]),cA=X0(),pre=lA(),[XHe,vx]=xx(h2),[YHe,p2]=xx(h2),gre=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:o,modal:i=!0}=e,l=cA(t),[c,d]=p.useState(null),u=p.useRef(!1),f=Dc(o),h=nA(s);return p.useEffect(()=>{const m=()=>{u.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>u.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),a.jsx(MD,{...l,children:a.jsx(XHe,{scope:t,open:r,onOpenChange:f,content:c,onContentChange:d,children:a.jsx(YHe,{scope:t,onClose:p.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:u,dir:h,modal:i,children:n})})})};gre.displayName=h2;var JHe="MenuAnchor",bR=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=cA(r);return a.jsx(XC,{...s,...n,ref:t})});bR.displayName=JHe;var wR="MenuPortal",[QHe,xre]=xx(wR,{forceMount:void 0}),vre=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:s}=e,o=vx(wR,t);return a.jsx(QHe,{scope:t,forceMount:r,children:a.jsx(jd,{present:r||o.open,children:a.jsx(Y0,{asChild:!0,container:s,children:n})})})};vre.displayName=wR;var tu="MenuContent",[ZHe,_R]=xx(tu),yre=p.forwardRef((e,t)=>{const r=xre(tu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=vx(tu,e.__scopeMenu),i=p2(tu,e.__scopeMenu);return a.jsx(w1.Provider,{scope:e.__scopeMenu,children:a.jsx(jd,{present:n||o.open,children:a.jsx(w1.Slot,{scope:e.__scopeMenu,children:i.modal?a.jsx(eGe,{...s,ref:t}):a.jsx(tGe,{...s,ref:t})})})})}),eGe=p.forwardRef((e,t)=>{const r=vx(tu,e.__scopeMenu),n=p.useRef(null),s=ms(t,n);return p.useEffect(()=>{const o=n.current;if(o)return YC(o)},[]),a.jsx(jR,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Bn(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),tGe=p.forwardRef((e,t)=>{const r=vx(tu,e.__scopeMenu);return a.jsx(jR,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),rGe=ip("MenuContent.ScrollLock"),jR=p.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:h,onDismiss:m,disableOutsideScroll:x,...g}=e,y=vx(tu,r),v=p2(tu,r),b=cA(r),w=pre(r),_=GHe(r),[j,S]=p.useState(null),C=p.useRef(null),A=ms(t,C,y.onContentChange),P=p.useRef(0),F=p.useRef(""),O=p.useRef(0),I=p.useRef(null),T=p.useRef("right"),k=p.useRef(0),B=x?QC:p.Fragment,z=x?{as:rGe,allowPinchZoom:!0}:void 0,U=W=>{const ge=F.current+W,Ae=_().filter(G=>!G.disabled),V=document.activeElement,$=Ae.find(G=>G.ref.current===V)?.textValue,Y=Ae.map(G=>G.textValue),he=hGe(Y,ge,$),J=Ae.find(G=>G.textValue===he)?.ref.current;(function G(ue){F.current=ue,window.clearTimeout(P.current),ue!==""&&(P.current=window.setTimeout(()=>G(""),1e3))})(ge),J&&setTimeout(()=>J.focus())};p.useEffect(()=>()=>window.clearTimeout(P.current),[]),WC();const L=p.useCallback(W=>T.current===I.current?.side&&gGe(W,I.current?.area),[]);return a.jsx(ZHe,{scope:r,searchRef:F,onItemEnter:p.useCallback(W=>{L(W)&&W.preventDefault()},[L]),onItemLeave:p.useCallback(W=>{L(W)||(C.current?.focus(),S(null))},[L]),onTriggerLeave:p.useCallback(W=>{L(W)&&W.preventDefault()},[L]),pointerGraceTimerRef:O,onPointerGraceIntentChange:p.useCallback(W=>{I.current=W},[]),children:a.jsx(B,{...z,children:a.jsx(Y1,{asChild:!0,trapped:s,onMountAutoFocus:Bn(o,W=>{W.preventDefault(),C.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:a.jsx(H0,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:h,onDismiss:m,children:a.jsx(ure,{asChild:!0,...w,dir:v.dir,orientation:"vertical",loop:n,currentTabStopId:j,onCurrentTabStopIdChange:S,onEntryFocus:Bn(c,W=>{v.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:a.jsx(RD,{role:"menu","aria-orientation":"vertical","data-state":Mre(y.open),"data-radix-menu-content":"",dir:v.dir,...b,...g,ref:A,style:{outline:"none",...g.style},onKeyDown:Bn(g.onKeyDown,W=>{const Ae=W.target.closest("[data-radix-menu-content]")===W.currentTarget,V=W.ctrlKey||W.altKey||W.metaKey,$=W.key.length===1;Ae&&(W.key==="Tab"&&W.preventDefault(),!V&&$&&U(W.key));const Y=C.current;if(W.target!==Y||!VHe.includes(W.key))return;W.preventDefault();const J=_().filter(G=>!G.disabled).map(G=>G.ref.current);mre.includes(W.key)&&J.reverse(),fGe(J)}),onBlur:Bn(e.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(P.current),F.current="")}),onPointerMove:Bn(e.onPointerMove,_1(W=>{const ge=W.target,Ae=k.current!==W.clientX;if(W.currentTarget.contains(ge)&&Ae){const V=W.clientX>k.current?"right":"left";T.current=V,k.current=W.clientX}}))})})})})})})});yre.displayName=tu;var nGe="MenuGroup",NR=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(ka.div,{role:"group",...n,ref:t})});NR.displayName=nGe;var aGe="MenuLabel",bre=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(ka.div,{...n,ref:t})});bre.displayName=aGe;var qS="MenuItem",qz="menu.itemSelect",dA=p.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...s}=e,o=p.useRef(null),i=p2(qS,e.__scopeMenu),l=_R(qS,e.__scopeMenu),c=ms(t,o),d=p.useRef(!1),u=()=>{const f=o.current;if(!r&&f){const h=new CustomEvent(qz,{bubbles:!0,cancelable:!0});f.addEventListener(qz,m=>n?.(m),{once:!0}),SD(f,h),h.defaultPrevented?d.current=!1:i.onClose()}};return a.jsx(wre,{...s,ref:c,disabled:r,onClick:Bn(e.onClick,u),onPointerDown:f=>{e.onPointerDown?.(f),d.current=!0},onPointerUp:Bn(e.onPointerUp,f=>{d.current||f.currentTarget?.click()}),onKeyDown:Bn(e.onKeyDown,f=>{const h=l.searchRef.current!=="";r||h&&f.key===" "||i3.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});dA.displayName=qS;var wre=p.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:s,...o}=e,i=_R(qS,r),l=pre(r),c=p.useRef(null),d=ms(t,c),[u,f]=p.useState(!1),[h,m]=p.useState("");return p.useEffect(()=>{const x=c.current;x&&m((x.textContent??"").trim())},[o.children]),a.jsx(w1.ItemSlot,{scope:r,disabled:n,textValue:s??h,children:a.jsx(fre,{asChild:!0,...l,focusable:!n,children:a.jsx(ka.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:d,onPointerMove:Bn(e.onPointerMove,_1(x=>{n?i.onItemLeave(x):(i.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Bn(e.onPointerLeave,_1(x=>i.onItemLeave(x))),onFocus:Bn(e.onFocus,()=>f(!0)),onBlur:Bn(e.onBlur,()=>f(!1))})})})}),sGe="MenuCheckboxItem",_re=p.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...s}=e;return a.jsx(Are,{scope:e.__scopeMenu,checked:r,children:a.jsx(dA,{role:"menuitemcheckbox","aria-checked":zS(r)?"mixed":r,...s,ref:t,"data-state":CR(r),onSelect:Bn(s.onSelect,()=>n?.(zS(r)?!0:!r),{checkForDefaultPrevented:!1})})})});_re.displayName=sGe;var jre="MenuRadioGroup",[oGe,iGe]=xx(jre,{value:void 0,onValueChange:()=>{}}),Nre=p.forwardRef((e,t)=>{const{value:r,onValueChange:n,...s}=e,o=Dc(n);return a.jsx(oGe,{scope:e.__scopeMenu,value:r,onValueChange:o,children:a.jsx(NR,{...s,ref:t})})});Nre.displayName=jre;var Sre="MenuRadioItem",Cre=p.forwardRef((e,t)=>{const{value:r,...n}=e,s=iGe(Sre,e.__scopeMenu),o=r===s.value;return a.jsx(Are,{scope:e.__scopeMenu,checked:o,children:a.jsx(dA,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":CR(o),onSelect:Bn(n.onSelect,()=>s.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Cre.displayName=Sre;var SR="MenuItemIndicator",[Are,lGe]=xx(SR,{checked:!1}),Pre=p.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...s}=e,o=lGe(SR,r);return a.jsx(jd,{present:n||zS(o.checked)||o.checked===!0,children:a.jsx(ka.span,{...s,ref:t,"data-state":CR(o.checked)})})});Pre.displayName=SR;var cGe="MenuSeparator",Ere=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(ka.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});Ere.displayName=cGe;var dGe="MenuArrow",kre=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=cA(r);return a.jsx(FD,{...s,...n,ref:t})});kre.displayName=dGe;var uGe="MenuSub",[vct,Ire]=xx(uGe),yb="MenuSubTrigger",Ore=p.forwardRef((e,t)=>{const r=vx(yb,e.__scopeMenu),n=p2(yb,e.__scopeMenu),s=Ire(yb,e.__scopeMenu),o=_R(yb,e.__scopeMenu),i=p.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=o,d={__scopeMenu:e.__scopeMenu},u=p.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return p.useEffect(()=>u,[u]),p.useEffect(()=>{const f=l.current;return()=>{window.clearTimeout(f),c(null)}},[l,c]),a.jsx(bR,{asChild:!0,...d,children:a.jsx(wre,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":Mre(r.open),...e,ref:VC(t,s.onTriggerChange),onClick:f=>{e.onClick?.(f),!(e.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Bn(e.onPointerMove,_1(f=>{o.onItemEnter(f),!f.defaultPrevented&&!e.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:Bn(e.onPointerLeave,_1(f=>{u();const h=r.content?.getBoundingClientRect();if(h){const m=r.content?.dataset.side,x=m==="right",g=x?-5:5,y=h[x?"left":"right"],v=h[x?"right":"left"];o.onPointerGraceIntentChange({area:[{x:f.clientX+g,y:f.clientY},{x:y,y:h.top},{x:v,y:h.top},{x:v,y:h.bottom},{x:y,y:h.bottom}],side:m}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(f),f.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:Bn(e.onKeyDown,f=>{const h=o.searchRef.current!=="";e.disabled||h&&f.key===" "||WHe[n.dir].includes(f.key)&&(r.onOpenChange(!0),r.content?.focus(),f.preventDefault())})})})});Ore.displayName=yb;var Tre="MenuSubContent",Dre=p.forwardRef((e,t)=>{const r=xre(tu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=vx(tu,e.__scopeMenu),i=p2(tu,e.__scopeMenu),l=Ire(Tre,e.__scopeMenu),c=p.useRef(null),d=ms(t,c);return a.jsx(w1.Provider,{scope:e.__scopeMenu,children:a.jsx(jd,{present:n||o.open,children:a.jsx(w1.Slot,{scope:e.__scopeMenu,children:a.jsx(jR,{id:l.contentId,"aria-labelledby":l.triggerId,...s,ref:d,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{i.isUsingKeyboardRef.current&&c.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Bn(e.onFocusOutside,u=>{u.target!==l.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:Bn(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:Bn(e.onKeyDown,u=>{const f=u.currentTarget.contains(u.target),h=HHe[i.dir].includes(u.key);f&&h&&(o.onOpenChange(!1),l.trigger?.focus(),u.preventDefault())})})})})})});Dre.displayName=Tre;function Mre(e){return e?"open":"closed"}function zS(e){return e==="indeterminate"}function CR(e){return zS(e)?"indeterminate":e?"checked":"unchecked"}function fGe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function mGe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function hGe(e,t,r){const s=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let i=mGe(e,Math.max(o,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function pGe(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const l=t[o],c=t[i],d=l.x,u=l.y,f=c.x,h=c.y;u>n!=h>n&&r<(f-d)*(n-u)/(h-u)+d&&(s=!s)}return s}function gGe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return pGe(r,t)}function _1(e){return t=>t.pointerType==="mouse"?e(t):void 0}var xGe=gre,vGe=bR,yGe=vre,bGe=yre,wGe=NR,_Ge=bre,jGe=dA,NGe=_re,SGe=Nre,CGe=Cre,AGe=Pre,PGe=Ere,EGe=kre,kGe=Ore,IGe=Dre,uA="DropdownMenu",[OGe,yct]=cu(uA,[hre]),fc=hre(),[TGe,Rre]=OGe(uA),Fre=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:o,onOpenChange:i,modal:l=!0}=e,c=fc(t),d=p.useRef(null),[u,f]=km({prop:s,defaultProp:o??!1,onChange:i,caller:uA});return a.jsx(TGe,{scope:t,triggerId:Fu(),triggerRef:d,contentId:Fu(),open:u,onOpenChange:f,onOpenToggle:p.useCallback(()=>f(h=>!h),[f]),modal:l,children:a.jsx(xGe,{...c,open:u,onOpenChange:f,dir:n,modal:l,children:r})})};Fre.displayName=uA;var Lre="DropdownMenuTrigger",$re=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...s}=e,o=Rre(Lre,r),i=fc(r);return a.jsx(vGe,{asChild:!0,...i,children:a.jsx(ka.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:VC(t,o.triggerRef),onPointerDown:Bn(e.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(o.onOpenToggle(),o.open||l.preventDefault())}),onKeyDown:Bn(e.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&o.onOpenToggle(),l.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});$re.displayName=Lre;var DGe="DropdownMenuPortal",Bre=e=>{const{__scopeDropdownMenu:t,...r}=e,n=fc(t);return a.jsx(yGe,{...n,...r})};Bre.displayName=DGe;var qre="DropdownMenuContent",zre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Rre(qre,r),o=fc(r),i=p.useRef(!1);return a.jsx(bGe,{id:s.contentId,"aria-labelledby":s.triggerId,...o,...n,ref:t,onCloseAutoFocus:Bn(e.onCloseAutoFocus,l=>{i.current||s.triggerRef.current?.focus(),i.current=!1,l.preventDefault()}),onInteractOutside:Bn(e.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,u=c.button===2||d;(!s.modal||u)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});zre.displayName=qre;var MGe="DropdownMenuGroup",RGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(wGe,{...s,...n,ref:t})});RGe.displayName=MGe;var FGe="DropdownMenuLabel",Ure=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(_Ge,{...s,...n,ref:t})});Ure.displayName=FGe;var LGe="DropdownMenuItem",Vre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(jGe,{...s,...n,ref:t})});Vre.displayName=LGe;var $Ge="DropdownMenuCheckboxItem",Wre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(NGe,{...s,...n,ref:t})});Wre.displayName=$Ge;var BGe="DropdownMenuRadioGroup",qGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(SGe,{...s,...n,ref:t})});qGe.displayName=BGe;var zGe="DropdownMenuRadioItem",Hre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(CGe,{...s,...n,ref:t})});Hre.displayName=zGe;var UGe="DropdownMenuItemIndicator",Gre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(AGe,{...s,...n,ref:t})});Gre.displayName=UGe;var VGe="DropdownMenuSeparator",Kre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(PGe,{...s,...n,ref:t})});Kre.displayName=VGe;var WGe="DropdownMenuArrow",HGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(EGe,{...s,...n,ref:t})});HGe.displayName=WGe;var GGe="DropdownMenuSubTrigger",Xre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(kGe,{...s,...n,ref:t})});Xre.displayName=GGe;var KGe="DropdownMenuSubContent",Yre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=fc(r);return a.jsx(IGe,{...s,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Yre.displayName=KGe;var XGe=Fre,YGe=$re,JGe=Bre,Jre=zre,Qre=Ure,Zre=Vre,ene=Wre,tne=Hre,rne=Gre,nne=Kre,ane=Xre,sne=Yre;const Gh=XGe,Kh=YGe,QGe=Ee.forwardRef(({className:e,inset:t,children:r,...n},s)=>a.jsxs(ane,{ref:s,className:Sr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...n,children:[r,a.jsx(qg,{className:"ml-auto h-4 w-4"})]}));QGe.displayName=ane.displayName;const ZGe=Ee.forwardRef(({className:e,...t},r)=>a.jsx(sne,{ref:r,className:Sr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));ZGe.displayName=sne.displayName;const bm=Ee.forwardRef(({className:e,sideOffset:t=4,...r},n)=>a.jsx(JGe,{children:a.jsx(Jre,{ref:n,sideOffset:t,className:Sr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));bm.displayName=Jre.displayName;const Po=Ee.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(Zre,{ref:n,className:Sr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...r}));Po.displayName=Zre.displayName;const eKe=Ee.forwardRef(({className:e,children:t,checked:r,...n},s)=>a.jsxs(ene,{ref:s,className:Sr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...n,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(rne,{children:a.jsx(Sm,{className:"h-4 w-4"})})}),t]}));eKe.displayName=ene.displayName;const tKe=Ee.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(tne,{ref:n,className:Sr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(rne,{children:a.jsx(Due,{className:"h-2 w-2 fill-current"})})}),t]}));tKe.displayName=tne.displayName;const l3=Ee.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(Qre,{ref:n,className:Sr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));l3.displayName=Qre.displayName;const Oj=Ee.forwardRef(({className:e,...t},r)=>a.jsx(nne,{ref:r,className:Sr("-mx-1 my-1 h-px bg-muted",e),...t}));Oj.displayName=nne.displayName;function _a(){try{const e=localStorage.getItem("auth:userProfile");if(e){const r=JSON.parse(e);if(r?.codigo_empresa)return r.codigo_empresa}const t=localStorage.getItem("auth:company");if(t){const r=JSON.parse(t);if(r?.codigo_empresa)return r.codigo_empresa;if(r?.codigo)return r.codigo}return typeof window<"u"&&window.__authProfile&&window.__authProfile.codigo_empresa?window.__authProfile.codigo_empresa:null}catch{return null}}async function Ah({somenteAtivas:e=!0,codigoEmpresa:t}={}){const r=t||_a();let n=re.from("finalizadoras").select("*").order("codigo_interno",{ascending:!0,nullsFirst:!1}).order("nome",{ascending:!0});r&&(n=n.eq("codigo_empresa",r)),e&&(n=n.eq("ativo",!0));const{data:s,error:o}=await n;if(o)throw o;const i=s||[];return i.sort((l,c)=>{const d=parseInt(l?.codigo_interno)||0,u=parseInt(c?.codigo_interno)||0;if(d!==u)return d-u;const f=(l?.nome||"").toLowerCase(),h=(c?.nome||"").toLowerCase();return f.localeCompare(h)}),i}async function rKe(e,t){const r=t||_a(),n={codigo_interno:e?.codigo_interno||null,codigo_sefaz:e?.codigo_sefaz||null,nome:(e?.nome||"").trim(),tipo:e?.tipo||"outros",ativo:e?.ativo??!0,taxa_percentual:e?.taxa_percentual==null?null:Number(e.taxa_percentual)};if(!n.nome)throw new Error("Nome  obrigatrio");r&&(n.codigo_empresa=r);const{data:s,error:o}=await re.from("finalizadoras").insert(n).select("*").single();if(o)throw o;return s}async function US({caixaSessaoId:e,codigoEmpresa:t}={}){if(!e)throw new Error("caixaSessaoId  obrigatrio");const r=t||_a();let n=re.from("caixa_sessoes").select("id, aberto_em, fechado_em, saldo_inicial, saldo_final").eq("id",e).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i=Array.isArray(s)?s[0]:s;if(!i)throw new Error("Sesso no encontrada");const l=i.aberto_em,c=i.fechado_em||new Date().toISOString(),d=await Jd({from:l,to:c,codigoEmpresa:r});let u=0,f=0,h=0,m=0;try{let g=re.from("caixa_movimentacoes").select("tipo, valor").eq("caixa_sessao_id",e);r&&(g=g.eq("codigo_empresa",r));const{data:y}=await g;for(const v of y||[]){const b=Number(v?.valor||0),w=String(v?.tipo||"").toLowerCase();w==="suprimento"?u+=b:w==="sangria"?f+=b:w==="ajuste"?h+=b:w==="troco"&&(m+=b)}}catch{}const x=u+h-f-m;return{...d,saldoInicial:Number(i.saldo_inicial||0),saldoFinal:i.saldo_final!=null?Number(i.saldo_final):null,movimentos:{suprimentos:u,sangrias:f,ajustes:h,troco:m,totalMovimentos:x}}}async function nKe(e,t,r){if(!e)throw new Error("ID invlido");const n=r||_a(),s={codigo_interno:t?.codigo_interno||null,codigo_sefaz:t?.codigo_sefaz||null,nome:(t?.nome||"").trim(),tipo:t?.tipo||"outros",ativo:t?.ativo??!0,taxa_percentual:t?.taxa_percentual==null?null:Number(t.taxa_percentual)};if(!s.nome)throw new Error("Nome  obrigatrio");let o=re.from("finalizadoras").update(s).eq("id",e);n&&(o=o.eq("codigo_empresa",n));const{data:i,error:l}=await o.select("*").single();if(l)throw l;return i}async function aKe(e,t,r){if(!e)throw new Error("ID invlido");const n=r||_a();let s=re.from("finalizadoras").update({ativo:!!t}).eq("id",e);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s.select("*").single();if(i)throw i;return o}async function AR({codigoEmpresa:e}={}){const t=e||_a();let r=re.from("caixa_sessoes").select("id").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;if(!(Array.isArray(n)&&n.length>0)){const i=new Error(" necessrio abrir o caixa antes de criar comandas.");throw i.code="NO_OPEN_CASH_SESSION",i}return!0}async function c3(e=[],t){if(!Array.isArray(e)||e.length===0)return{};const r=t||_a(),n=async i=>{let l=re.from("comanda_clientes").select(`comanda_id, cliente_id, nome_livre, clientes:clientes${i}(id, nome)`).in("comanda_id",e);return r&&(l=l.eq("codigo_empresa",r)),l};let s=[];try{const{data:i,error:l}=await n("!comanda_clientes_cliente_id_fkey");if(l)throw l;s=i||[]}catch{try{const{data:i,error:l}=await n("!fk_comanda_clientes_cliente");if(l)throw l;s=i||[]}catch{let i=re.from("comanda_clientes").select("comanda_id, cliente_id, nome_livre").in("comanda_id",e);r&&(i=i.eq("codigo_empresa",r));const{data:l}=await i;s=l||[]}}const o={};for(const i of s){const l=i.comanda_id,c=i.clientes?.nome||i.nome_livre||"";o[l]||(o[l]=[]),c&&o[l].push(c)}for(const i of Object.keys(o))o[i]=Array.from(new Set(o[i])).join(", ");return o}async function d3(e=[],t){if(!Array.isArray(e)||e.length===0)return{};const r=t||_a();let n=re.from("pagamentos").select("comanda_id, metodo, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").in("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i={};for(const c of s||[]){if(!((c.status||"Pago")!=="Cancelado"&&(c.status||"Pago")!=="Estornado"))continue;const u=c.comanda_id,f=c?.finalizadoras?.nome||c.metodo||"Outros";i[u]||(i[u]=[]),i[u].push(f)}const l={};for(const[c,d]of Object.entries(i))d.length===0?l[c]="":d.length===1?l[c]=d[0]:l[c]=`${d[0]} +${d.length-1}`;return l}async function sKe({comandaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("comandaId  obrigatrio");const r=t||_a();let n=re.from("comanda_itens").select("produto_id, quantidade").eq("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i=new Map;for(const m of s||[]){const x=m.produto_id,g=Number(m.quantidade||0);i.set(x,(i.get(x)||0)+g)}if(i.size===0)return!0;const l=Array.from(i.keys());let c=re.from("produtos").select("id, nome, estoque");c=c.in("id",l),r&&(c=c.eq("codigo_empresa",r));const{data:d,error:u}=await c;if(u)throw u;const f=new Map((d||[]).map(m=>[m.id,{nome:m.nome,estoque:Number(m.estoque||0)}])),h=[];for(const[m,x]of i.entries()){const g=f.get(m)||{nome:`Produto ${m}`,estoque:0};x>g.estoque&&h.push({id:m,name:g.nome,solicitado:x,estoque:g.estoque})}if(h.length>0){const m=h.map(g=>`${g.name}: solicitado ${g.solicitado}, estoque ${g.estoque}`).join("; "),x=new Error(`Estoque insuficiente para finalizar: ${m}`);throw x.code="INSUFFICIENT_STOCK_COMANDA",x.items=h,x}return!0}async function Nv({codigoEmpresa:e}={}){const t=e||_a();let r=re.from("comandas").select("id,status,aberto_em").is("mesa_id",null).in("status",["open","awaiting-payment"]).order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n?.[0]||null}async function Tj({codigoEmpresa:e}={}){const t=e||_a();console.log("[getOrCreateComandaBalcao] Iniciando com codigo_empresa:",t),await AR({codigoEmpresa:t});const r=await Nv({codigoEmpresa:t});if(r)return console.log("[getOrCreateComandaBalcao] Comanda existente encontrada:",r),r;const n={status:"open",mesa_id:null,aberto_em:new Date().toISOString()};console.log("[getOrCreateComandaBalcao] Criando nova comanda (codigo_empresa via DEFAULT):",n);const{data:s,error:o}=await re.from("comandas").insert(n).select("id,status,aberto_em,tipo,codigo_empresa").single();if(o)throw console.error("[getOrCreateComandaBalcao] ERRO ao criar comanda:",o),o;return console.log("[getOrCreateComandaBalcao] Comanda criada com sucesso:",s),console.log("[getOrCreateComandaBalcao] Codigo da comanda criada:",s?.codigo_empresa,"vs esperado:",t),await new Promise(i=>setTimeout(i,100)),s}async function zz({status:e,from:t,to:r,search:n="",limit:s=50,offset:o=0,codigoEmpresa:i}={}){const l=i||_a();let c=re.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").order("fechado_em",{ascending:!1,nullsFirst:!1}).order("aberto_em",{ascending:!1}).range(o,o+s-1);l&&(c=c.eq("codigo_empresa",l)),e&&Array.isArray(e)&&e.length?c=c.in("status",e):typeof e=="string"&&e!=="all"&&(e==="closed"?c=c.or("status.eq.closed,fechado_em.not.is.null").neq("status","cancelled"):c=c.eq("status",e));const d=y=>{if(!y)return null;if(typeof y=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(y)){const[v,b,w]=y.split("-").map(Number);return new Date(v,b-1,w,0,0,0,0)}return new Date(y)},u=y=>{if(!y)return null;if(typeof y=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(y)){const[v,b,w]=y.split("-").map(Number);return new Date(v,b-1,w,23,59,59,999)}return new Date(y)},f=d(t),h=u(r);f&&(c=c.gte("aberto_em",f.toISOString())),h&&(c=c.lte("aberto_em",h.toISOString()));const m=(n||"").trim();if(m){const y=/^\d+$/.test(m);if(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(m)){const b=re.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").eq("id",m).eq("codigo_empresa",l),w=re.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").eq("mesa_id",m).eq("codigo_empresa",l),[_,j]=await Promise.all([b,w]),S=_.data||[],C=j.data||[],A=[...S,...C];return Array.from(new Map(A.map(F=>[F.id,F])).values()).sort((F,O)=>new Date(O.fechado_em||O.aberto_em)-new Date(F.fechado_em||F.aberto_em))}else y?c=c.or(`id.eq.${m},status.ilike.%${m}%`):c=c.or(`status.ilike.%${m}%`)}const{data:x,error:g}=await c;if(g)throw g;return x||[]}async function Jd({from:e,to:t,codigoEmpresa:r}={}){const n="[listarResumoPeriodo]",s=r||_a();console.log(`${n} Iniciando consulta`),console.log(`${n} Perodo: ${e||"SEM from"} at ${t||"SEM to"}`),console.log(`${n} codigo_empresa: ${s}`);let o=[];try{let h=re.from("comandas").select("id, fechado_em").eq("status","closed");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("fechado_em",new Date(e).toISOString())),t&&(h=h.lte("fechado_em",new Date(t).toISOString()));const{data:m,error:x}=await h;if(x)throw x;o=m||[]}catch{o=[]}const i=(o||[]).map(h=>h.id);let l=0,c=0;if(i.length>0)try{let h=re.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",i);s&&(h=h.eq("codigo_empresa",s));const{data:m,error:x}=await h;if(x)throw x;for(const g of m||[]){const y=Number(g.quantidade||0)*Number(g.preco_unitario||0),v=Number(g.desconto||0);l+=y,c+=v}}catch{}const d=Math.max(0,l-c),u={};let f=0;try{let h=re.from("pagamentos").select("metodo, valor, recebido_em, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("recebido_em",new Date(e).toISOString())),t&&(h=h.lte("recebido_em",new Date(t).toISOString())),console.log(`${n} Consultando pagamentos de comandas...`);const{data:m,error:x}=await h;if(x)throw console.error(`${n}  Erro ao buscar pagamentos:`,x),x;console.log(`${n} Total de pagamentos de comandas encontrados: ${(m||[]).length}`);for(const g of m||[]){if(!((g.status||"Pago")!=="Cancelado"&&(g.status||"Pago")!=="Estornado"))continue;const v=g.finalizadoras?.nome||g.metodo||"outros",b=Number(g.valor||0);u[v]=(u[v]||0)+b,f+=b}console.log(`${n}  Resumo comandas por finalizadora:`,u)}catch(h){console.error(`${n}  Exception ao processar pagamentos de comandas:`,h)}try{let h=re.from("agendamentos").select("id, inicio");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("inicio",new Date(e).toISOString())),t&&(h=h.lte("inicio",new Date(t).toISOString())),console.log(`${n} Consultando agendamentos no perodo...`);const{data:m,error:x}=await h;if(x)throw console.error(`${n}  Erro ao buscar agendamentos:`,x),x;if(console.log(`${n} Total de agendamentos encontrados: ${(m||[]).length}`),m&&m.length>0){const g=m.map(w=>w.id);let y=re.from("agendamento_participantes").select("valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, finalizadoras!agp_finalizadora_id_fkey(nome, taxa_percentual)").in("agendamento_id",g).eq("status_pagamento","Pago");s&&(y=y.eq("codigo_empresa",s)),console.log(`${n} Consultando participantes pagos...`);const{data:v,error:b}=await y;if(b)throw console.error(`${n}  Erro ao buscar participantes:`,b),b;console.log(`${n} Total de participantes pagos encontrados: ${(v||[]).length}`);for(const w of v||[]){const _=w.finalizadoras?.nome||"Outros";let j=Number(w.valor_cota||0);if(w.aplicar_taxa===!0){const S=Number(w.finalizadoras?.taxa_percentual||0);S>0&&(j=j/(1+S/100),console.log(`${n}  Participante com taxa: valor_cota=${w.valor_cota}, taxa=${S}%, valor_real=${j.toFixed(2)}`))}u[_]=(u[_]||0)+j,f+=j}console.log(`${n}  Resumo agendamentos por finalizadora:`,u)}}catch(h){console.error(`${n}  Exception ao processar pagamentos de agendamentos:`,h)}return console.log(`${n}  RESUMO FINAL por finalizadora:`,u),console.log(`${n} Total de entradas: R$ ${f.toFixed(2)}`),{from:e?new Date(e).toISOString():null,to:t?new Date(t).toISOString():null,totalPorFinalizadora:u,totalEntradas:f,totalVendasBrutas:l,totalDescontos:c,totalVendasLiquidas:d}}async function j1({codigoEmpresa:e}={}){const t=e||_a();let r=null;try{let s=re.from("caixa_sessoes").select("aberto_em").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(s=s.eq("codigo_empresa",t));const{data:o,error:i}=await s;if(i)throw i;r=o?.[0]?.aberto_em||null}catch{}if(!r)return null;const n=new Date().toISOString();return Jd({from:r,to:n,codigoEmpresa:t})}async function one({comandaId:e,codigoEmpresa:t}={}){const r=t||_a();let n=re.from("pagamentos").select("*, finalizadoras!pagamentos_finalizadora_id_fkey(id, nome, codigo_sefaz, codigo_interno)").order("recebido_em",{ascending:!0});e&&(n=n.eq("comanda_id",e)),r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function Yb({searchTerm:e="",limit:t=20,codigoEmpresa:r}={}){const n=r||_a();let s=re.from("clientes").select("*").eq("status","active").eq("flag_cliente",!0).order("nome",{ascending:!0}).limit(t);n&&(s=s.eq("codigo_empresa",n));const o=(e||"").trim();o&&(/^\d+$/.test(o)?s=s.or(`codigo.eq.${o},nome.ilike.%${o}%,email.ilike.%${o}%,telefone.ilike.%${o}%`):s=s.or(`nome.ilike.%${o}%,email.ilike.%${o}%,telefone.ilike.%${o}%`));const{data:i,error:l}=await s;if(l)throw l;return i||[]}async function rd({codigoEmpresa:e}={}){const t="[listarComandasAbertas]",r=e||_a(),n=async()=>{const s=new Promise((c,d)=>setTimeout(()=>d(new Error("listarComandasAbertas timeout aps 30s")),3e4));let o=re.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, observacoes, observacoes_atualizadas_em").is("fechado_em",null).neq("status","cancelled").order("aberto_em",{ascending:!1}).limit(500);r&&(o=o.eq("codigo_empresa",r));const{data:i,error:l}=await Promise.race([o,s]);if(l)throw l;return i||[]};try{try{return await n()}catch(s){if(String(s?.message||"").includes("timeout"))return console.warn(`${t} timeout na primeira tentativa, retornando array vazio`),[];throw s}}catch(s){return console.error(`${t}  EXCEPTION:`,s?.message||s),[]}}async function oKe({mesaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("mesaId  obrigatrio");const r=t||_a();let n=re.from("comandas").select("id,status,fechado_em").eq("mesa_id",e).is("fechado_em",null).in("status",["open","awaiting-payment"]);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;if(Array.isArray(s)&&s.length>0)throw new Error("No  possvel inativar: existe comanda aberta vinculada a esta mesa.");let i=re.from("mesas").select("id, numero, status").eq("id",e).limit(1);r&&(i=i.eq("codigo_empresa",r));const{data:l,error:c}=await i;if(c)throw c;const d=l?.[0];if(d&&Number(d.numero)===0)throw new Error("A mesa especial do balco no pode ser inativada.");let u=re.from("mesas").update({status:"inactive"}).eq("id",e);r&&(u=u.eq("codigo_empresa",r));const{error:f}=await u;if(f)throw f;return!0}async function iKe(e){const t=e||_a();let r=re.from("mesas").select("id, numero, nome, status").order("numero",{ascending:!0}).limit(500);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n||[]}async function lKe({mesaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("mesaId  obrigatrio");const r=t||_a();let n=re.from("mesas").update({status:"available"}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{error:s}=await n;if(s)throw s;return!0}async function VS(e=[],t){if(!e||e.length===0)return{};const r=t||_a();let n=re.from("comanda_itens").select("comanda_id, quantidade, preco_unitario").in("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i={};for(const l of s||[]){const c=l.comanda_id,d=Number(l.quantidade||0)*Number(l.preco_unitario||0);i[c]=(i[c]||0)+d}return i}async function Ph(e){const t="[listMesas]",r=e||_a(),n=async()=>{const s=new Promise((c,d)=>setTimeout(()=>d(new Error("listMesas timeout aps 30s")),3e4));let o=re.from("mesas").select("id, numero, nome, status").neq("status","inactive").order("numero",{ascending:!0}).limit(200);r&&(o=o.eq("codigo_empresa",r));const{data:i,error:l}=await Promise.race([o,s]);if(l)throw l;return i||[]};try{try{return await n()}catch(s){if(String(s?.message||"").includes("timeout"))return console.warn(`${t} timeout na primeira tentativa, retornando array vazio`),[];throw s}}catch(s){return console.error(`${t}  EXCEPTION:`,s?.message||s),[]}}async function cKe({comandaId:e,status:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");let n=re.from("pagamentos").select("*").eq("comanda_id",e);t&&(n=n.eq("status",t)),n=n.order("created_at",{ascending:!0});const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function B_({comandaId:e,linhas:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");const n=r||_a();if(Array.isArray(t)){await re.from("pagamentos").delete().eq("comanda_id",e).eq("status","Pendente");for(const s of t){const o=Number(s?.valor||0);if(o<=0)continue;const i=s?.metodo||s?.metodoNome||"outros";await PR({comandaId:e,finalizadoraId:s?.finalizadoraId||s?.methodId||null,metodo:i,valor:o,status:"Pendente",codigoEmpresa:n,clienteId:s?.clienteId||s?.clientId||null})}}}async function dKe({comandaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("comandaId  obrigatrio");const r=t||_a();let n=re.from("pagamentos").update({status:"Pago",recebido_em:new Date().toISOString()}).eq("comanda_id",e).eq("status","Pendente");r&&(n=n.eq("codigo_empresa",r));const{error:s}=await n;if(s)throw s;return!0}async function uKe({numero:e,nome:t,codigoEmpresa:r}={}){const n=r||_a();let s=e;if(!s){let i=re.from("mesas").select("numero").order("numero",{ascending:!1}).limit(1);n&&(i=i.eq("codigo_empresa",n));const{data:l,error:c}=await i;if(c)throw c;s=(l?.[0]?.numero||0)+1}const o={numero:s,status:"available"};t&&typeof t=="string"&&t.trim()&&(o.nome=t.trim()),n&&(o.codigo_empresa=n);try{const{data:i,error:l}=await re.from("mesas").insert(o).select("*").single();if(l)throw l;return i}catch(i){const l=String(i?.message||i||"");if(/column\s+\"?nome\"?\s+of\s+relation/i.test(l)||/column\s+\"?nome\"?\s+does not exist/i.test(l)){const c={numero:s,status:"available"};n&&(c.codigo_empresa=n);const{data:d,error:u}=await re.from("mesas").insert(c).select("*").single();if(u)throw u;return d}throw i}}async function im({saldoInicial:e=0,codigoEmpresa:t}={}){const r=t||_a();let n=re.from("caixa_sessoes").select("id,status,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;if(s&&s.length>0){const d=s[0];try{const u=new Date(d.aberto_em),f=new Date;if(u.toDateString()!==f.toDateString()){try{const b=await rd({codigoEmpresa:r});if(Array.isArray(b)&&b.length>0)return console.warn("[ensureCaixaAberto] Sesso de dia anterior detectada, mas h comandas abertas. No fechar automaticamente."),d}catch{}const m=f.toISOString();let x=0,g=0;try{const b=await Jd({from:d.aberto_em,to:m,codigoEmpresa:r});x=Number(b?.totalEntradas||0)}catch{}try{let b=re.from("caixa_movimentacoes").select("tipo,valor").eq("caixa_sessao_id",d.id);r&&(b=b.eq("codigo_empresa",r));const{data:w}=await b;for(const _ of w||[]){const j=Number(_?.valor||0),S=String(_?.tipo||"").toLowerCase();S==="suprimento"||S==="ajuste"?g+=j:(S==="sangria"||S==="troco")&&(g-=j)}}catch{}const y=Number(d?.saldo_inicial||0)+x+g;let v=re.from("caixa_sessoes").update({status:"closed",saldo_final:y,fechado_em:m}).eq("id",d.id).eq("status","open");r&&(v=v.eq("codigo_empresa",r)),await v;try{const b=await US({caixaSessaoId:d.id,codigoEmpresa:r}).catch(async()=>await Jd({from:d.aberto_em,to:m,codigoEmpresa:r})),w={codigo_empresa:r||_a(),caixa_sessao_id:d.id,periodo_de:b?.from||d.aberto_em,periodo_ate:b?.to||m,total_bruto:Number(b?.totalVendasBrutas||0),total_descontos:Number(b?.totalDescontos||0),total_liquido:Number(b?.totalVendasLiquidas||0),total_entradas:Number(b?.totalEntradas||0),por_finalizadora:b?.totalPorFinalizadora||{}},_=w.por_finalizadora;await re.from("caixa_resumos").insert({...w,por_finalizadora:_&&typeof _!="string"?JSON.stringify(_):_})}catch{}}else{try{if(d?.saldo_inicial==null&&e!=null){let m=re.from("caixa_sessoes").update({saldo_inicial:Number(e)||0}).eq("id",d.id);return r&&(m=m.eq("codigo_empresa",r)),await m,{...d,saldo_inicial:Number(e)||0}}}catch{}return d}}catch{}return d}const i={status:"open",saldo_inicial:e};r&&(i.codigo_empresa=r);const{data:l,error:c}=await re.from("caixa_sessoes").insert(i).select("id,status,aberto_em").single();if(c)throw c;return l}async function Eh({codigoEmpresa:e}={}){const t=e||_a();let r=re.from("caixa_sessoes").select("id,status,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n?.[0]||null}async function ine({saldoFinal:e=null,valorFinalDinheiro:t=null,codigoEmpresa:r}={}){console.log("[fecharCaixa] Iniciando fechamento:",{valorFinalDinheiro:t,saldoFinal:e,codigoEmpresa:r});const n=r||_a();try{console.log("[fecharCaixa]  Limpeza preventiva: ajustando apenas comandas cancelled/closed sem fechado_em...");const{data:v}=await re.from("comandas").select("id, status, fechado_em").eq("codigo_empresa",n).is("fechado_em",null).in("status",["cancelled","closed"]);if(v&&v.length>0){console.log(`[fecharCaixa]  Encontradas ${v.length} comandas (cancelled/closed) sem fechado_em, ajustando...`);const b=new Date().toISOString();for(const w of v)try{await re.from("comandas").update({fechado_em:b}).eq("id",w.id).eq("codigo_empresa",n),console.log(`[fecharCaixa]  Comanda ${w.id} (status: ${w.status}) ajustada com fechado_em`)}catch{}}else console.log("[fecharCaixa]  Nenhuma comanda cancelled/closed sem fechado_em encontrada")}catch(v){console.warn("[fecharCaixa]  Erro na limpeza preventiva:",v?.message)}try{let v=await rd({codigoEmpresa:n});if(v=v||[],console.log(`[fecharCaixa]  Comandas abertas encontradas: ${v.length}`,v.map(w=>({id:w.id,status:w.status,mesa:w.mesa_id}))),v&&v.length>0){const w=v.map(_=>`${_.id}${_.mesa_id?`@mesa:${_.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${v.length} comanda(s) aberta(s). Feche todas as comandas antes de encerrar o caixa.`)}let b=0;for(;b<12&&(v=await rd({codigoEmpresa:n}),!(!v||v.length===0));)await new Promise(w=>setTimeout(w,250)),b++;if(v&&v.length>0){const w=v.map(C=>C.id);let _=new Map,j=new Map;try{if(w.length>0){let C=re.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",w);n&&(C=C.eq("codigo_empresa",n));const{data:A}=await C;_=new Map;for(const P of A||[]){const F=P.comanda_id,O=Number(P.quantidade||0);_.set(F,(_.get(F)||0)+O)}}}catch{}try{if(w.length>0){let C=re.from("pagamentos").select("comanda_id, status").in("comanda_id",w);n&&(C=C.eq("codigo_empresa",n));const{data:A}=await C;j=new Map;for(const P of A||[]){const F=String(P?.status||"Pago");if(F==="Cancelado"||F==="Estornado")continue;const O=P.comanda_id;j.set(O,(j.get(O)||0)+1)}}}catch{}for(const C of v){const A=Number(_.get(C.id)||0)>0,P=Number(j.get(C.id)||0)>0;if(!A&&!P)try{await T0({comandaId:C.id,codigoEmpresa:n})}catch{}}let S=await rd({codigoEmpresa:n});if(S=S||[],S.length>0){const C=S.map(O=>O.id);let A=new Map,P=new Map;try{if(C.length>0){let O=re.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",C);n&&(O=O.eq("codigo_empresa",n));const{data:I}=await O;A=new Map;for(const T of I||[]){const k=T.comanda_id,B=Number(T.quantidade||0);A.set(k,(A.get(k)||0)+B)}}}catch{}try{if(C.length>0){let O=re.from("pagamentos").select("comanda_id, status").in("comanda_id",C);n&&(O=O.eq("codigo_empresa",n));const{data:I}=await O;P=new Map;for(const T of I||[]){const k=String(T?.status||"Pago");if(k==="Cancelado"||k==="Estornado")continue;const B=T.comanda_id;P.set(B,(P.get(B)||0)+1)}}}catch{}const F=S.filter(O=>Number(A.get(O.id)||0)>0||Number(P.get(O.id)||0)>0);if(F.length>0){const O=F.map(I=>`${I.id}${I.mesa_id?`@mesa:${I.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${F.length} comandas abertas. IDs: ${O}. Feche todas antes de encerrar o caixa.`)}}}}catch(v){if(v&&/Existem \d+ comandas/.test(v.message||""))throw v;const b=new Error("Falha ao validar comandas abertas. Tente novamente e verifique sua conexo.");throw b.code="CASH_CLOSE_VALIDATION_FAILED",b}let s=re.from("caixa_sessoes").select("id,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s;if(i)throw i;const l=o?.[0]?.id||null,c=o?.[0]?.aberto_em||null,d=Number(o?.[0]?.saldo_inicial||0);if(!l)throw new Error("Nenhuma sesso de caixa aberta encontrada.");const u=new Date().toISOString();let f=0,h=0;try{const v=await Jd({from:c,to:u,codigoEmpresa:n});f=Number(v?.totalEntradas||0)}catch{}try{let v=re.from("caixa_movimentacoes").select("tipo, valor").eq("caixa_sessao_id",l);n&&(v=v.eq("codigo_empresa",n));const{data:b}=await v;for(const w of b||[]){const _=Number(w?.valor||0),j=String(w?.tipo||"").toLowerCase();j==="suprimento"||j==="ajuste"?h+=_:(j==="sangria"||j==="troco")&&(h-=_)}}catch{}const m=e!=null?Number(e):d+f+h;try{let v=await rd({codigoEmpresa:n});if(v=v||[],v.length>0){const b=v.map(S=>S.id);let w=new Map,_=new Map;try{if(b.length>0){let S=re.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",b);n&&(S=S.eq("codigo_empresa",n));const{data:C}=await S;w=new Map;for(const A of C||[]){const P=A.comanda_id,F=Number(A.quantidade||0);w.set(P,(w.get(P)||0)+F)}}}catch{}try{if(b.length>0){let S=re.from("pagamentos").select("comanda_id, status").in("comanda_id",b);n&&(S=S.eq("codigo_empresa",n));const{data:C}=await S;_=new Map;for(const A of C||[]){const P=String(A?.status||"Pago");if(P==="Cancelado"||P==="Estornado")continue;const F=A.comanda_id;_.set(F,(_.get(F)||0)+1)}}}catch{}for(const S of v){const C=Number(w.get(S.id)||0)>0,A=Number(_.get(S.id)||0)>0;if(!C&&!A)try{await T0({comandaId:S.id,codigoEmpresa:n})}catch{}}let j=await rd({codigoEmpresa:n});if(j=j||[],j.length>0){const S=j.map(C=>`${C.id}${C.mesa_id?`@mesa:${C.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${j.length} comandas abertas. IDs: ${S}. Feche todas antes de encerrar o caixa.`)}}}catch(v){if(!(v&&v.message)){const b=new Error("Falha ao validar comandas abertas no momento do fechamento. Tente novamente.");throw b.code="CASH_CLOSE_FINAL_CHECK_FAILED",b}throw v}let x=re.from("caixa_sessoes").update({status:"closed",saldo_final:m,fechado_em:u}).eq("id",l).eq("status","open");n&&(x=x.eq("codigo_empresa",n));const{data:g,error:y}=await x.select("id,status,fechado_em,saldo_final").single();if(y){const v=String(y.message||"");if(v.toLowerCase().includes("row")||v.toLowerCase().includes("single")){let b=re.from("caixa_sessoes").select("id,status,fechado_em,saldo_final").eq("id",l).limit(1);n&&(b=b.eq("codigo_empresa",n));const{data:w}=await b;if(w&&w[0])return w[0]}throw y}try{if(c&&u&&g?.status==="closed"){let v;try{v=await US({caixaSessaoId:l,codigoEmpresa:n})}catch{v=await Jd({from:c,to:u,codigoEmpresa:n})}const b={codigo_empresa:n||_a(),caixa_sessao_id:l,periodo_de:v?.from||c,periodo_ate:v?.to||u,total_bruto:Number(v?.totalVendasBrutas||0),total_descontos:Number(v?.totalDescontos||0),total_liquido:Number(v?.totalVendasLiquidas||0),total_entradas:Number(v?.totalEntradas||0),por_finalizadora:v?.totalPorFinalizadora||{}},w=t!=null?Number(t):null,_=w!=null?w-Number(m||0):null;console.log("[fecharCaixa] Valores para snapshot:",{contado:w,diferenca:_,efetivoSaldoFinal:m,valorFinalDinheiroOriginal:t});const S=await(async C=>{const A={...C},P=A.por_finalizadora;P&&typeof P!="string"&&(A.por_finalizadora=JSON.stringify(P));let F=!0,O=!0;try{const U=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),L=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");U==="no"&&(F=!1),L==="no"&&(O=!1)}catch{}if(!F||!O)try{let U=re.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:L}=await U;if(!L){F=!0,O=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}if(!F&&!O)return await re.from("caixa_resumos").insert(A);let I={...A};F&&w!=null&&(I.valor_final_dinheiro=w),O&&_!=null&&(I.diferenca_dinheiro=_),console.log("[fecharCaixa] Tentando inserir snapshot com:",{supportValor:F,supportDif:O,contado:w,diferenca:_,hasValorFinalDinheiro:"valor_final_dinheiro"in I});const T=await re.from("caixa_resumos").insert(I);if(!T.error)return T;const k=`${T.error?.message||""} ${T.error?.details||""}`.toLowerCase(),B=T.error?.code;if(B==="42703"||B==="PGRST204"||k.includes("column")||k.includes("schema cache")){try{I.valor_final_dinheiro!==void 0&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),I.diferenca_dinheiro!==void 0&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}return await re.from("caixa_resumos").insert(A)}return T})(b);if(S.error)throw console.error("[fecharCaixa] Erro ao inserir snapshot:",S.error),S.error;console.log("[fecharCaixa]  Snapshot inserido com sucesso");try{const{data:C}=await re.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").eq("caixa_sessao_id",l).order("criado_em",{ascending:!1}).limit(1).single();console.log("[fecharCaixa] Verificao ps-insert:",C)}catch(C){console.warn("[fecharCaixa] Falha ao verificar snapshot:",C?.message)}}}catch(v){console.warn("[fecharCaixa] Falha ao gravar snapshot de fechamento:",v)}try{let v=re.from("caixa_sessoes").select("id,aberto_em,saldo_inicial").eq("status","open");n&&(v=v.eq("codigo_empresa",n));const{data:b}=await v;if(Array.isArray(b)&&b.length>0)for(const w of b)try{const _=w?.aberto_em,j=Number(w?.saldo_inicial||0),S=new Date().toISOString();let C=0,A=0;try{const F=await Jd({from:_,to:S,codigoEmpresa:n});C=Number(F?.totalEntradas||0)}catch{}try{let F=re.from("caixa_movimentacoes").select("tipo,valor").eq("caixa_sessao_id",w.id);n&&(F=F.eq("codigo_empresa",n));const{data:O}=await F;for(const I of O||[]){const T=Number(I?.valor||0),k=String(I?.tipo||"").toLowerCase();k==="suprimento"||k==="ajuste"?A+=T:(k==="sangria"||k==="troco")&&(A-=T)}}catch{}const P=j+C+A;await re.from("caixa_sessoes").update({status:"closed",saldo_final:P,fechado_em:S}).eq("id",w.id).eq("status","open").eq(n?"codigo_empresa":"id",n||w.id);try{const F=await US({caixaSessaoId:w.id,codigoEmpresa:n}).catch(async()=>await Jd({from:_,to:S,codigoEmpresa:n})),O={codigo_empresa:n||_a(),caixa_sessao_id:w.id,periodo_de:F?.from||_,periodo_ate:F?.to||S,total_bruto:Number(F?.totalVendasBrutas||0),total_descontos:Number(F?.totalDescontos||0),total_liquido:Number(F?.totalVendasLiquidas||0),total_entradas:Number(F?.totalEntradas||0),por_finalizadora:F?.totalPorFinalizadora||{}},I=O.por_finalizadora;await re.from("caixa_resumos").insert({...O,por_finalizadora:I&&typeof I!="string"?JSON.stringify(I):I})}catch{}}catch(_){try{console.warn("[fecharCaixa] Saneamento: falhou ao fechar sesso remanescente",w?.id,_?.message||_)}catch{}}}catch{}return g}async function lne({from:e,to:t,limit:r=50,codigoEmpresa:n}={}){console.log("[listarFechamentosCaixa] Iniciando busca de fechamentos",{from:e,to:t,limit:r});const s=n||_a();let o=re.from("caixa_sessoes").select("id, aberto_em, fechado_em, saldo_inicial, saldo_final, status").eq("status","closed").order("fechado_em",{ascending:!1}).limit(r);s&&(o=o.eq("codigo_empresa",s)),e&&(o=o.gte("fechado_em",`${e}T00:00:00`)),t&&(o=o.lte("fechado_em",`${t}T23:59:59`));const{data:i,error:l}=await o;if(l)throw l;const c=Array.isArray(i)?i:[];if(console.log("[listarFechamentosCaixa] Sesses fechadas encontradas:",c.length),c.length===0)return[];const d=c.map(m=>m.id);let u=[];try{let m=!0,x=!0;try{const _=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),j=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");_==="no"&&(m=!1),j==="no"&&(x=!1)}catch{}if(!m||!x)try{let _=re.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:j}=await _;if(!j){m=!0,x=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}const g=["caixa_sessao_id"];m&&g.push("valor_final_dinheiro"),x&&g.push("diferenca_dinheiro");const y=g.join(", ");let v=re.from("caixa_resumos").select(y).in("caixa_sessao_id",d).order("criado_em",{ascending:!1});s&&(v=v.eq("codigo_empresa",s));let{data:b,error:w}=await v;if(w){const _=w?.code,j=`${w?.message||""} ${w?.details||""}`.toLowerCase();if(_==="42703"||_==="PGRST204"||j.includes("column")||j.includes("schema cache")){try{m&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),x&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}let C=re.from("caixa_resumos").select("caixa_sessao_id").in("caixa_sessao_id",d).order("criado_em",{ascending:!1});s&&(C=C.eq("codigo_empresa",s));const{data:A}=await C;u=A||[]}else throw w}else u=b||[]}catch(m){console.warn("[listarFechamentosCaixa] Erro ao buscar snapshots:",m?.message),u=[]}console.log("[listarFechamentosCaixa] Snapshots encontrados:",u.length,u);const f=new Map(u.map(m=>[m.caixa_sessao_id,m])),h=c.map(m=>{const x=f.get(m.id),g={...m,valor_final_dinheiro:x?.valor_final_dinheiro??null,diferenca_dinheiro:x?.diferenca_dinheiro??null};return x&&console.log(`[listarFechamentosCaixa] Sesso ${m.id} enriquecida com snapshot:`,{valor_final_dinheiro:x.valor_final_dinheiro,diferenca_dinheiro:x.diferenca_dinheiro}),g});return console.log("[listarFechamentosCaixa] Resultado final:",h.length,"sesses com dados enriquecidos"),h}async function WS({caixaSessaoId:e,codigoEmpresa:t}={}){if(!e)throw new Error("caixaSessaoId  obrigatrio");const r=t||_a();let n=null;try{let s=!0,o=!0;try{const f=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),h=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");f==="no"&&(s=!1),h==="no"&&(o=!1)}catch{}if(!s||!o)try{let f=re.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:h}=await f;if(!h){s=!0,o=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}const i=["caixa_sessao_id","periodo_de","periodo_ate","total_bruto","total_descontos","total_liquido","total_entradas","por_finalizadora"];s&&i.push("valor_final_dinheiro"),o&&i.push("diferenca_dinheiro");const l=i.join(", ");let c=re.from("caixa_resumos").select(l).eq("caixa_sessao_id",e).order("criado_em",{ascending:!1}).limit(1);r&&(c=c.eq("codigo_empresa",r));let{data:d,error:u}=await c;if(u){const f=u?.code,h=`${u?.message||""} ${u?.details||""}`.toLowerCase();if(f==="42703"||f==="PGRST204"||h.includes("column")||h.includes("schema cache")){try{s&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),o&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}let x=re.from("caixa_resumos").select("caixa_sessao_id, periodo_de, periodo_ate, total_bruto, total_descontos, total_liquido, total_entradas, por_finalizadora").eq("caixa_sessao_id",e).order("criado_em",{ascending:!1}).limit(1);r&&(x=x.eq("codigo_empresa",r));const{data:g}=await x;n=g?.[0]||null}else throw u}else n=d?.[0]||null}catch(s){try{console.warn("[getCaixaResumo] Snapshot select falhou, usando fallback dinmico:",s?.message||s)}catch{}}if(!n||typeof n.saldo_inicial>"u"||typeof n.saldo_final>"u"){const s=await US({caixaSessaoId:e,codigoEmpresa:r});let o=null;try{let i=re.from("caixa_sessoes").select("saldo_inicial, saldo_final").eq("id",e).limit(1);r&&(i=i.eq("codigo_empresa",r));const{data:l}=await i;o=l?.[0]||null}catch{}n={codigo_empresa:r,caixa_sessao_id:e,periodo_de:s?.from||null,periodo_ate:s?.to||null,total_bruto:Number(s?.totalVendasBrutas||0),total_descontos:Number(s?.totalDescontos||0),total_liquido:Number(s?.totalVendasLiquidas||0),total_entradas:Number(s?.totalEntradas||0),por_finalizadora:s?.totalPorFinalizadora||{},saldo_inicial:Number(o?.saldo_inicial??s?.saldoInicial??0),saldo_final:o?.saldo_final!=null?Number(o.saldo_final):null,movimentos:s?.movimentos||{suprimentos:0,sangrias:0,ajustes:0,troco:0,totalMovimentos:0}}}else if(typeof n.por_finalizadora=="string")try{n.por_finalizadora=JSON.parse(n.por_finalizadora)}catch{n.por_finalizadora={}}return n}async function u3({tipo:e,valor:t,observacao:r="",caixaSessaoId:n,codigoEmpresa:s}={}){const o=s||_a();if(!e||!["sangria","suprimento","troco","ajuste"].includes(e))throw new Error("Tipo invlido de movimentao");let i=n;if(!i){let u=re.from("caixa_sessoes").select("id").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);o&&(u=u.eq("codigo_empresa",o));const{data:f,error:h}=await u;if(h)throw h;i=f?.[0]?.id||null}if(!i)throw new Error("Sesso de caixa no encontrada para registrar movimentao");const l={codigo_empresa:o,caixa_sessao_id:i,tipo:e,valor:Math.max(0,Number(t)||0),observacao:(r||"").trim()||null},{data:c,error:d}=await re.from("caixa_movimentacoes").insert(l).select("*").single();if(d)throw d;return c}async function kg({caixaSessaoId:e,codigoEmpresa:t}={}){const r=t||_a();if(!e)throw new Error("caixaSessaoId  obrigatrio");let n=re.from("caixa_movimentacoes").select("*").eq("caixa_sessao_id",e).order("criado_em",{ascending:!0});r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function fKe({mesaId:e,codigoEmpresa:t}={}){const r=t||_a();await AR({codigoEmpresa:r}),console.log(`[abrirComandaParaMesa] Iniciando para mesaId: ${e}, codigo_empresa: ${r}`);try{const n={status:"open",aberto_em:new Date().toISOString()};e&&(n.mesa_id=e),console.log("[abrirComandaParaMesa] Payload (codigo_empresa via DEFAULT):",n);const{data:s,error:o}=await re.from("comandas").insert(n).select("*").single();if(o)throw console.error("[abrirComandaParaMesa] ERRO ao criar comanda:",o),o;return console.log("[abrirComandaParaMesa]  Comanda criada:",s),await new Promise(i=>setTimeout(i,100)),s}catch(n){throw console.error("[abrirComandaParaMesa] ERRO:",n),n}}async function mKe({mesaId:e,codigoEmpresa:t}){const r=t||_a();let n=re.from("comandas").select("id,status,aberto_em,fechado_em").eq("mesa_id",e).is("fechado_em",null).in("status",["open","awaiting-payment"]).order("aberto_em",{ascending:!1}).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s?.[0]||null}async function To({comandaId:e,codigoEmpresa:t}){const r=t||_a();let n=re.from("comanda_itens").select("*").eq("comanda_id",e).order("created_at",{ascending:!0});r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function vh({codigoEmpresa:e}){const t=e||_a();let r=re.from("comandas").select("id").is("fechado_em",null);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;if(console.log("[listarItensDeTodasComandasAbertas] Comandas abertas:",n?.length||0,"IDs:",n?.map(d=>d.id)),!n||n.length===0)return console.log("[listarItensDeTodasComandasAbertas] Nenhuma comanda aberta encontrada"),[];const o=n.map(d=>d.id);let i=re.from("comanda_itens").select("produto_id, quantidade").in("comanda_id",o);t&&(i=i.eq("codigo_empresa",t));const{data:l,error:c}=await i;if(c)throw c;return console.log("[listarItensDeTodasComandasAbertas] Itens encontrados:",l?.length||0),l&&l.length>0&&console.log("[listarItensDeTodasComandasAbertas] Detalhes dos itens:",l),l||[]}const q_=new Map;async function hKe({mesaId:e,codigoEmpresa:t}={}){const r=`${e}:${t||_a()}`;if(q_.has(r))return console.log(`[getOrCreateComandaForMesa]  Operao j em andamento para mesa ${e}, aguardando...`),q_.get(r);const n=t||_a(),s=(async()=>{try{await AR({codigoEmpresa:n}),console.log(`[getOrCreateComandaForMesa]  Criando nova comanda para mesa ${e}`);const o=await mKe({mesaId:e,codigoEmpresa:n});if(o){console.log(`[getOrCreateComandaForMesa]  Comanda existente ${o.id} encontrada, verificando se est vazia...`);let l=!1,c=!1;try{l=(await To({comandaId:o.id,codigoEmpresa:n})||[]).length>0}catch{}try{const{data:d}=await re.from("pagamentos").select("id, status").eq("comanda_id",o.id).eq("codigo_empresa",n);c=(d||[]).filter(f=>{const h=String(f?.status||"Pago");return h!=="Cancelado"&&h!=="Estornado"}).length>0}catch{}if(!l&&!c){console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} est vazia, fechando automaticamente...`);try{await T0({comandaId:o.id,codigoEmpresa:n}),console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} fechada com sucesso`)}catch(d){console.warn(`[getOrCreateComandaForMesa]  Erro ao fechar comanda ${o.id}:`,d?.message)}}else console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} tem dados (itens: ${l}, pagamentos: ${c}), no ser fechada automaticamente`)}console.log(`[getOrCreateComandaForMesa]  Criando comanda zerada para mesa ${e}`);const i=await fKe({mesaId:e,codigoEmpresa:n});return console.log(`[getOrCreateComandaForMesa]  Comanda ${i.id} criada com sucesso`),i}finally{q_.delete(r),console.log(`[getOrCreateComandaForMesa]  Lock liberado para mesa ${e}`)}})();return q_.set(r,s),s}async function Jb({comandaId:e,clienteIds:t=[],nomesLivres:r=[],codigoEmpresa:n,replace:s=!1}={}){const o=n||_a();if(!e)throw new Error("comandaId  obrigatrio");let i=[],l=[];try{i=Array.isArray(t)?t:t?[t]:[]}catch(m){console.warn("[adicionarClientesAComanda] Erro ao processar clienteIds:",m),i=[]}try{l=Array.isArray(r)?r:r?[r]:[]}catch(m){console.warn("[adicionarClientesAComanda] Erro ao processar nomesLivres:",m),l=[]}const c=i.map(m=>m&&typeof m=="object"?m.id||m.cliente_id||m.value:m).filter(Boolean),d=l.map(m=>m&&typeof m=="object"?m.nome||m.name||m.label:m).map(m=>String(m||"").trim()).filter(Boolean);if(console.log(`[adicionarClientesAComanda] Adicionando clientes  comanda ${e}:`,{clienteIds:c,nomesLivres:d,codigo:o,replace:s}),s){const{error:m}=await re.from("comanda_clientes").delete().eq("comanda_id",e);m&&console.warn("[adicionarClientesAComanda] Erro ao limpar clientes existentes:",m)}const u=[];if(Array.isArray(c)){let m=[];if(!s)try{const{data:g}=await re.from("comanda_clientes").select("cliente_id, nome_livre").eq("comanda_id",e);m=Array.isArray(g)?g:[]}catch{}const x=new Set((m||[]).map(g=>g.cliente_id).filter(Boolean));for(let g=0;g<c.length;g++){const y=c[g];y&&(!s&&x.has(y)||u.push({comanda_id:e,cliente_id:y}))}}if(Array.isArray(d))for(let m=0;m<d.length;m++){const g=(d[m]||"").trim();g&&u.push({comanda_id:e,nome_livre:g})}if(u.length===0)return console.log("[adicionarClientesAComanda] Nenhum cliente para adicionar"),!0;let f=[];Array.isArray(u)&&(f=u.map(m=>o?{...m,codigo_empresa:o}:m)),console.log("[adicionarClientesAComanda] Payload para insero:",f);const{error:h}=await re.from("comanda_clientes").insert(f);if(h)throw console.error("[adicionarClientesAComanda] ERRO ao inserir clientes:",h),h;return console.log("[adicionarClientesAComanda] Clientes adicionados com sucesso"),!0}async function Bi({comandaId:e,codigoEmpresa:t}={}){if(t||_a(),!e)throw new Error("comandaId  obrigatrio");try{const{data:r,error:n}=await re.from("comanda_clientes").select("id, cliente_id, nome_livre, clientes:clientes!comanda_clientes_cliente_id_fkey(id, codigo, nome, email, telefone)").eq("comanda_id",e).order("created_at",{ascending:!0});if(n)throw n;return(r||[]).map(s=>({id:s.id,tipo:s.cliente_id?"cadastrado":"livre",nome:s.clientes?.nome||s.nome_livre,cliente_id:s.cliente_id}))}catch{try{const{data:n,error:s}=await re.from("comanda_clientes").select("id, cliente_id, nome_livre, clientes:clientes!fk_comanda_clientes_cliente(id, nome, email, telefone)").eq("comanda_id",e).order("created_at",{ascending:!0});if(s)throw s;return(n||[]).map(o=>({id:o.id,tipo:o.cliente_id?"cadastrado":"livre",nome:o.clientes?.nome||o.nome_livre,cliente_id:o.cliente_id}))}catch{const{data:s,error:o}=await re.from("comanda_clientes").select("id, cliente_id, nome_livre").eq("comanda_id",e).order("created_at",{ascending:!0});if(o)throw o;return(s||[]).map(i=>({id:i.id,tipo:i.cliente_id?"cadastrado":"livre",nome:i.nome_livre||"",cliente_id:i.cliente_id}))}}}async function f3({comandaId:e,produtoId:t,descricao:r,quantidade:n,precoUnitario:s,desconto:o=0,codigoEmpresa:i}){const l=i||_a();console.log(`[adicionarItem] Adicionando item  comanda ${e}:`,{produtoId:t,descricao:r,quantidade:n,precoUnitario:s,codigo:l});try{let f=re.from("produtos").select("id, estoque, estoque_minimo, nome").eq("id",t).limit(1);l&&(f=f.eq("codigo_empresa",l));const{data:h,error:m}=await f;if(m)throw m;const x=Array.isArray(h)?h[0]:h;if(x){const g=Number(x.estoque??0),y=Number(x.estoque_minimo??0),v=Number(n??1);if(g<=0){const C=new Error(`Produto sem estoque: ${x.nome||""}`.trim());throw C.code="OUT_OF_STOCK",C}let b=re.from("comanda_itens").select("quantidade").eq("comanda_id",e).eq("produto_id",t);l&&(b=b.eq("codigo_empresa",l));const{data:w,error:_}=await b;if(_)throw _;const j=Array.isArray(w)&&w.length?w.reduce((C,A)=>C+Number(A?.quantidade||0),0):0;if(j+v>g){const C=new Error(`Estoque insuficiente. Em comanda: ${j}, solicitado: +${v}, disponvel: ${g}`);throw C.code="INSUFFICIENT_STOCK",C}if(g<=y&&g>0)try{console.warn(`[adicionarItem] Aviso: estoque baixo para produto '${x.nome}' (estoque=${g}, minimo=${y})`)}catch{}}}catch(f){throw f}const c={comanda_id:e,produto_id:t,descricao:r,quantidade:n,preco_unitario:s,desconto:o};l&&(c.codigo_empresa=l);const{data:d,error:u}=await re.from("comanda_itens").insert(c).select("*").single();if(u)throw u;return d}async function Fd({itemId:e,quantidade:t,codigoEmpresa:r}){const n=r||_a();let s=re.from("comanda_itens").select("id, quantidade, produto_id, comanda_id").eq("id",e).limit(1);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s;if(i)throw i;const l=Array.isArray(o)?o[0]:o,c=Number(t||0);if(!l)throw new Error("Item no encontrado");const d=Number(l.quantidade||0);if(c-d>0){let x=re.from("produtos").select("id, estoque, nome, estoque_minimo").eq("id",l.produto_id).limit(1);n&&(x=x.eq("codigo_empresa",n));const{data:g,error:y}=await x;if(y)throw y;const v=Array.isArray(g)?g[0]:g;if(v){const b=Number(v.estoque??0);let w=re.from("comanda_itens").select("quantidade").eq("comanda_id",l.comanda_id).eq("produto_id",l.produto_id).neq("id",l.id);n&&(w=w.eq("codigo_empresa",n));const{data:_,error:j}=await w;if(j)throw j;const S=Array.isArray(_)&&_.length?_.reduce((F,O)=>F+Number(O?.quantidade||0),0):0;if(S+c>b){const F=new Error(`Estoque insuficiente. Em comanda (outros itens): ${S}, novo para este item: ${c}, disponvel: ${b}`);throw F.code="INSUFFICIENT_STOCK",F}const A=Number(v.estoque_minimo??0),P=b-(S+c);if(P<=A&&P>=0)try{console.warn(`[atualizarQuantidadeItem] Aviso: produto '${v.nome}' atingiu nvel de estoque baixo (restante=${P}, minimo=${A})`)}catch{}}}let f=re.from("comanda_itens").update({quantidade:c}).eq("id",e);n&&(f=f.eq("codigo_empresa",n));const{data:h,error:m}=await f.select("*").single();if(m)throw m;return h}async function Sv({itemId:e,codigoEmpresa:t}){const r=t||_a();let n=re.from("comanda_itens").delete().eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("id");if(o&&o.code!=="PGRST116")throw o;return Array.isArray(s)&&s.length>0}function pKe(e){if(!e)return!1;const t=e.code?String(e.code):"",r=[e.message,e.details,e.hint].filter(Boolean).join(" ").toLowerCase();return t==="22P02"||r.includes("invalid input value for enum")}async function PR({comandaId:e,finalizadoraId:t,metodo:r,valor:n,status:s="Pago",codigoEmpresa:o,clienteId:i=null}){const l=o||_a();if(!l)throw new Error("Empresa no identificada (codigo_empresa ausente).");const c=s&&["Pendente","Pago","Estornado","Cancelado"].includes(s)?s:"Pago",d=["dinheiro","credito","debito","pix","voucher","outros"],f=(m=>{if(!m)return"outros";const x=String(m).toLowerCase().trim(),y={"cartao credito":"credito","carto credito":"credito","cartao debito":"debito","carto debito":"debito","carto de credito":"credito","carto de dbito":"debito","cartao de credito":"credito","cartao de debito":"debito"}[x]||x;return d.includes(y)?y:"outros"})(r),h={comanda_id:e,finalizadora_id:t||null,metodo:f,valor:Math.max(0,Number(n)||0),status:c,recebido_em:new Date().toISOString(),codigo_empresa:l};i&&(h.cliente_id=i),console.log("[registrarPagamento] Iniciando registro de pagamento:",{comandaId:e,finalizadoraId:t,metodo:f,valor:h.valor,status:h.status,codigoEmpresa:l,payload:h});try{const{data:m,error:x}=await re.from("pagamentos").insert(h).select().single();if(x){console.warn("[registrarPagamento] Primeira tentativa falhou:",{code:x.code,message:x.message});const g=`${x?.message||""} ${x?.details||""}`.toLowerCase();if(x?.code==="42703"||g.includes("column")&&g.includes("cliente_id")){const{cliente_id:v,...b}=h;try{localStorage.setItem("schema:pagamentos:cliente_id","no")}catch{}const{data:w,error:_}=await re.from("pagamentos").insert(b).select().single();if(_)throw _;return console.log("[registrarPagamento] Pagamento registrado sem cliente_id:",w),w}if(pKe(x)){console.log("[registrarPagamento] Tentando abordagem alternativa sem status...");try{const v={...h};delete v.status;const{data:b,error:w}=await re.from("pagamentos").insert(v).select().single();if(w)throw w;return console.log("[registrarPagamento] Pagamento registrado com sucesso (abordagem alternativa):",b),b}catch(v){throw console.error("[registrarPagamento] Falha na abordagem alternativa:",v),new Error(`Falha ao processar pagamento: ${v.message}`)}}throw x}return console.log("[registrarPagamento] Pagamento registrado com sucesso:",m),m}catch(m){throw console.error("[registrarPagamento] Erro ao registrar pagamento:",{error:{message:m.message,code:m.code,details:m.details,hint:m.hint},comandaId:e,finalizadoraId:t,valor:h.valor,status:h.status,codigoEmpresa:l}),m}}async function T0({comandaId:e,codigoEmpresa:t,diferencaPagamento:r}){const n=t||_a(),s="[fecharComandaEMesa]";try{console.group(s)}catch{}try{console.time?.(s)}catch{}try{console.log(`${s} Iniciando fechamento da comanda ${e}`),console.log(`${s} Obtendo dados da comanda...`);const{data:o,error:i}=await re.from("comandas").select("id, mesa_id, status, fechado_em").eq("id",e).single();if(i||!o)throw console.error(`${s} Erro ao buscar comanda:`,i?.message||"Comanda no encontrada"),i||new Error("Comanda no encontrada");if(o.fechado_em)return console.log(`${s} Comanda ${e} j est fechada em ${o.fechado_em}`),!0;const l=new Date().toISOString();console.log(`${s} Atualizando comanda...`);const c={status:"closed",fechado_em:l};typeof r=="number"&&Number.isFinite(r)&&(c.diferenca_pagamento=r),console.log(`${s} Fechando comanda com status closed + fechado_em${c.diferenca_pagamento!=null?" + diferenca_pagamento":""}...`);let{error:d}=await re.from("comandas").update(c).eq("id",e).eq("codigo_empresa",n);if(d&&d.code==="42703"){console.warn(`${s} Coluna diferenca_pagamento ausente no schema, tentando novamente sem ela...`);const u={status:"closed",fechado_em:l};({error:d}=await re.from("comandas").update(u).eq("id",e).eq("codigo_empresa",n))}if(d)throw console.error(`${s} Erro ao fechar comanda:`,d),d;if(console.log(`${s} Comanda ${e} fechada com sucesso`),o.mesa_id){console.log(`${s} Atualizando status da mesa ${o.mesa_id} para disponvel...`);try{const{error:u}=await re.from("mesas").update({status:"available"}).eq("id",o.mesa_id).select("id").single();u?console.error(`${s} Erro ao atualizar status da mesa:`,u):console.log(`${s} Mesa ${o.mesa_id} marcada como disponvel`)}catch(u){console.error(`${s} Exceo ao atualizar mesa:`,u)}}else console.log(`${s} Nenhuma mesa associada para liberar`);return console.log(`${s} Fechamento da comanda ${e} concludo com sucesso`),!0}catch(o){throw console.error(`${s} Erro fatal ao fechar comanda:`,o),o}finally{try{console.timeEnd?.(s)}catch{}try{console.groupEnd()}catch{}}}async function Uz({comandaId:e,codigoEmpresa:t}){const r=t||_a(),n="[cancelarComandaEMesa]";try{console.group(n)}catch{}try{console.time?.(n)}catch{}try{if(!e)throw new Error("comandaId obrigatrio");if(!r)throw new Error("codigo_empresa obrigatrio");console.log(`${n} Cancelando comanda ${e}`);const{data:s}=await re.from("comandas").select("id, mesa_id").eq("id",e).single();try{await re.from("comanda_itens").delete().eq("comanda_id",e).eq("codigo_empresa",r)}catch{}try{await re.from("comanda_clientes").delete().eq("comanda_id",e).eq("codigo_empresa",r)}catch{}const o=new Date().toISOString(),{data:i,error:l}=await re.from("comandas").update({status:"cancelled",fechado_em:o}).eq("id",e).eq("codigo_empresa",r).select();if(l)throw console.error(`${n} Erro ao atualizar comanda:`,l),l;if(!i||i.length===0)throw console.error(`${n}  UPDATE no afetou nenhuma linha! Comanda ${e} no foi encontrada ou RLS bloqueou`),new Error("Comanda no encontrada ou sem permisso para cancelar");if(console.log(`${n}  Comanda atualizada:`,i[0]),s?.mesa_id){console.log(`${n} Liberando mesa ${s.mesa_id}`);try{await re.from("mesas").update({status:"available"}).eq("id",s.mesa_id)}catch(c){console.error(`${n} Erro ao liberar mesa:`,c)}}return console.log(`${n} Comanda ${e} cancelada com sucesso`),!0}catch(s){throw console.error(`${n} Falha:`,s),s}finally{try{console.timeEnd?.(n)}catch{}try{console.groupEnd?.(n)}catch{}}}async function gKe({itemId:e,desconto_tipo:t,desconto_valor:r,desconto_motivo:n,codigoEmpresa:s}={}){const o=s||_a();if(!e)throw new Error("itemId  obrigatrio");if(!["percentual","fixo"].includes(t))throw new Error('Tipo de desconto deve ser "percentual" ou "fixo"');if(r<0)throw new Error("Desconto no pode ser negativo");if(t==="percentual"&&r>100)throw new Error("Desconto percentual no pode ser maior que 100%");let i=re.from("comanda_itens").update({desconto_tipo:t,desconto_valor:Number(r),desconto_motivo:n||null}).eq("id",e);o&&(i=i.eq("codigo_empresa",o));const{data:l,error:c}=await i.select("*").single();if(c)throw c;return l}async function xKe({comandaId:e,desconto_tipo:t,desconto_valor:r,desconto_motivo:n,codigoEmpresa:s}={}){const o=s||_a();if(!e)throw new Error("comandaId  obrigatrio");if(!["percentual","fixo"].includes(t))throw new Error('Tipo de desconto deve ser "percentual" ou "fixo"');if(r<0)throw new Error("Desconto no pode ser negativo");if(t==="percentual"&&r>100)throw new Error("Desconto percentual no pode ser maior que 100%");let i=re.from("comandas").update({desconto_tipo:t,desconto_valor:Number(r),desconto_motivo:n||null}).eq("id",e);o&&(i=i.eq("codigo_empresa",o));const{data:l,error:c}=await i.select("*").single();if(c)throw c;return l}async function vKe({itemId:e,codigoEmpresa:t}={}){const r=t||_a();if(!e)throw new Error("itemId  obrigatrio");let n=re.from("comanda_itens").update({desconto_tipo:null,desconto_valor:0,desconto_motivo:null}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("*").single();if(o)throw o;return s}async function yKe({comandaId:e,codigoEmpresa:t}={}){const r=t||_a();if(!e)throw new Error("comandaId  obrigatrio");let n=re.from("comandas").update({desconto_tipo:null,desconto_valor:0,desconto_motivo:null}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("*").single();if(o)throw o;return s}async function bKe({comandaId:e,observacoes:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");const{error:n}=await re.from("comandas").update({observacoes:(t||"").trim()||null,observacoes_atualizadas_em:new Date().toISOString()}).eq("id",e);if(n)throw n;return{id:e}}var fA="Tabs",[wKe,bct]=cu(fA,[lA]),cne=lA(),[_Ke,ER]=wKe(fA),dne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:s,defaultValue:o,orientation:i="horizontal",dir:l,activationMode:c="automatic",...d}=e,u=nA(l),[f,h]=km({prop:n,onChange:s,defaultProp:o??"",caller:fA});return a.jsx(_Ke,{scope:r,baseId:Fu(),value:f,onValueChange:h,orientation:i,dir:u,activationMode:c,children:a.jsx(ka.div,{dir:u,"data-orientation":i,...d,ref:t})})});dne.displayName=fA;var une="TabsList",fne=p.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...s}=e,o=ER(une,r),i=cne(r);return a.jsx(ure,{asChild:!0,...i,orientation:o.orientation,dir:o.dir,loop:n,children:a.jsx(ka.div,{role:"tablist","aria-orientation":o.orientation,...s,ref:t})})});fne.displayName=une;var mne="TabsTrigger",hne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:s=!1,...o}=e,i=ER(mne,r),l=cne(r),c=xne(i.baseId,n),d=vne(i.baseId,n),u=n===i.value;return a.jsx(fre,{asChild:!0,...l,focusable:!s,active:u,children:a.jsx(ka.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":d,"data-state":u?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:c,...o,ref:t,onMouseDown:Bn(e.onMouseDown,f=>{!s&&f.button===0&&f.ctrlKey===!1?i.onValueChange(n):f.preventDefault()}),onKeyDown:Bn(e.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&i.onValueChange(n)}),onFocus:Bn(e.onFocus,()=>{const f=i.activationMode!=="manual";!u&&!s&&f&&i.onValueChange(n)})})})});hne.displayName=mne;var pne="TabsContent",gne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:s,children:o,...i}=e,l=ER(pne,r),c=xne(l.baseId,n),d=vne(l.baseId,n),u=n===l.value,f=p.useRef(u);return p.useEffect(()=>{const h=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(h)},[]),a.jsx(jd,{present:s||u,children:({present:h})=>a.jsx(ka.div,{"data-state":u?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!h,id:d,tabIndex:0,...i,ref:t,style:{...e.style,animationDuration:f.current?"0s":void 0},children:h&&o})})});gne.displayName=pne;function xne(e,t){return`${e}-trigger-${t}`}function vne(e,t){return`${e}-content-${t}`}var jKe=dne,yne=fne,bne=hne,wne=gne;const od=jKe,sc=Ee.forwardRef(({className:e,...t},r)=>a.jsx(yne,{ref:r,className:Sr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));sc.displayName=yne.displayName;const Pa=Ee.forwardRef(({className:e,...t},r)=>a.jsx(bne,{ref:r,className:Sr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Pa.displayName=bne.displayName;const Gs=Ee.forwardRef(({className:e,...t},r)=>a.jsx(wne,{ref:r,className:Sr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Gs.displayName=wne.displayName;function _ne({open:e,onOpenChange:t,client:r,onSaved:n}){const{toast:s}=Ss(),{userProfile:o}=qs(),i=I=>({tipo_pessoa:I?.tipo_pessoa||"PF",tipo_cadastro:I?.tipo_cadastro||"cliente",nome:I?.nome||"",apelido:I?.apelido||"",cpf:I?.cpf||"",cnpj:I?.cnpj||"",rg:I?.rg||"",ie:I?.ie||"",email:I?.email||"",telefone:I?.telefone||"",fone2:I?.fone2||"",celular1:I?.celular1||"",celular2:I?.celular2||"",whatsapp:I?.whatsapp||"",cep:I?.cep||"",endereco:I?.endereco||"",numero:I?.numero||"",complemento:I?.complemento||"",bairro:I?.bairro||"",cidade:I?.cidade||"",uf:I?.uf||"",cidade_ibge:I?.cidade_ibge||"",limite_credito:I?.limite_credito??"",tipo_recebimento:I?.tipo_recebimento||"",regime_tributario:I?.regime_tributario||"",tipo_contribuinte:I?.tipo_contribuinte||"",aniversario:I?.aniversario?String(I.aniversario).slice(0,10):"",sexo:I?.sexo||"",estado_civil:I?.estado_civil||"",nome_mae:I?.nome_mae||"",nome_pai:I?.nome_pai||"",observacoes:I?.observacoes||"",status:I?.status||"active"}),[l,c]=p.useState(i(r)),[d,u]=p.useState("basicos"),[f,h]=p.useState(!1);p.useEffect(()=>{let I="cliente";r?.flag_cliente&&r?.flag_fornecedor?I="ambos":r?.flag_fornecedor&&(I="fornecedor"),c({tipo_pessoa:r?.tipo_pessoa||"PF",tipo_cadastro:I,nome:r?.nome||"",apelido:r?.apelido||"",cpf:r?.cpf||"",cnpj:r?.cnpj||"",rg:r?.rg||"",ie:r?.ie||"",email:r?.email||"",telefone:r?.telefone||"",fone2:r?.fone2||"",celular1:r?.celular1||"",celular2:r?.celular2||"",whatsapp:r?.whatsapp||"",cep:r?.cep||"",endereco:r?.endereco||"",numero:r?.numero||"",complemento:r?.complemento||"",bairro:r?.bairro||"",cidade:r?.cidade||"",uf:r?.uf||"",cidade_ibge:r?.cidade_ibge||"",limite_credito:r?.limite_credito??"",tipo_recebimento:r?.tipo_recebimento||"",regime_tributario:r?.regime_tributario||"",tipo_contribuinte:r?.tipo_contribuinte||"",aniversario:r?.aniversario?String(r.aniversario).slice(0,10):"",sexo:r?.sexo||"",estado_civil:r?.estado_civil||"",nome_mae:r?.nome_mae||"",nome_pai:r?.nome_pai||"",observacoes:r?.observacoes||"",status:r?.status||"active"})},[r]),p.useEffect(()=>{e?c(i(r||null)):r||c(i(null))},[e,!!r]);const m=I=>{const{id:T,value:k}=I.target;c(B=>({...B,[T]:k}))},x=async()=>{try{const I=v.digits(l.cnpj);if(!I||I.length!==14){s({title:"CNPJ invlido",description:"Informe 14 dgitos para buscar.",variant:"destructive"});return}const T=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${I}`);if(!T.ok){let he="Falha ao consultar CNPJ";try{const J=await T.json();J?.message&&(he=J.message)}catch{}throw new Error(he)}const k=await T.json();try{console.info("[clientes] BuscarCNPJ:payload",k)}catch{}const B=k.razao_social||k.nome||"",z=k.nome_fantasia||"",U=k.logradouro||"",L=String(k.numero||""),W=k.complemento||"",ge=k.bairro||"",Ae=k.municipio||k.localidade||"",V=k.uf||"",$=v.digits(k.cep||"");let Y="";try{if(Ae&&V){const he=await fetch(`https://brasilapi.com.br/api/ibge/municipios/v1/${V}`);if(he.ok){const J=await he.json(),G=ae=>String(ae||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim(),ue=G(Ae),ve=(J||[]).find(ae=>G(ae.nome)===ue);(ve?.codigo_ibge||ve?.codigo)&&(Y=String(ve.codigo_ibge||ve.codigo))}}}catch{}c(he=>({...he,nome:B,apelido:z||B,endereco:U,numero:L,complemento:W,bairro:ge,cidade:Ae,uf:V,cep:$,cidade_ibge:Y||he.cidade_ibge}));try{console.info("[clientes] BuscarCNPJ:setForm",{razao:B,fantasia:z,logradouro:U,numero:L,complemento:W,bairro:ge,cidade:Ae,uf:V,cep:$,codigoIBGE:Y})}catch{}s({title:"CNPJ carregado",description:"Dados preenchidos."})}catch(I){s({title:"Falha ao buscar CNPJ",description:I.message||"Tente novamente.",variant:"destructive"})}},g=I=>I===""?null:I,y=I=>{if(I==null)return null;if(typeof I=="number")return I;const T=String(I).trim();if(!T)return null;const k=T.replace(/\s+/g,"").replace(/\.(?=\d{3}(?:\D|$))/g,"").replace(/,/g,"."),B=Number(k);return Number.isFinite(B)?B:null},v=p.useMemo(()=>({digits:I=>(I||"").replace(/\D+/g,"")}),[]),b=I=>v.digits(I).slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"),w=I=>v.digits(I).slice(0,14).replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2"),_=I=>v.digits(I).slice(0,8).replace(/(\d{5})(\d)/,"$1-$2"),j=I=>{const T=v.digits(I).slice(0,11);return T.length<=10?T.replace(/(\d{2})(\d{4})(\d{0,4})/,"($1) $2-$3").trim():T.replace(/(\d{2})(\d{5})(\d{0,4})/,"($1) $2-$3").trim()},S=I=>String(I||"").replace(/[^a-z]/gi,"").toUpperCase().slice(0,2),C=(I,T=6)=>v.digits(I).slice(0,T),A=I=>{const T=v.digits(I);return T?(Number(T)/100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},P=(I,T)=>{let k=T;I==="cpf"&&(k=b(T)),I==="cnpj"&&(k=w(T)),I==="cep"&&(k=_(T)),["telefone","fone2","celular1","celular2","whatsapp"].includes(I)&&(k=j(T)),I==="uf"&&(k=S(T)),I==="numero"&&(k=C(T,8)),I==="cidade_ibge"&&(k=C(T,7)),I==="limite_credito"&&(k=A(T)),c(B=>({...B,[I]:k}))},F=async()=>{const I=v.digits(l.cep);if(!I||I.length!==8){s({title:"CEP invlido",description:"Informe 8 dgitos.",variant:"destructive"});return}try{h(!0),c(B=>({...B,endereco:"Buscando...",bairro:"Buscando...",cidade:"Buscando...",uf:""}));const k=await(await fetch(`https://viacep.com.br/ws/${I}/json/`)).json();if(k.erro)throw new Error("CEP no encontrado");c(B=>({...B,endereco:k.logradouro||"",bairro:k.bairro||"",cidade:k.localidade||"",uf:k.uf||"",cidade_ibge:k.ibge||""})),s({title:"CEP encontrado!",description:"Endereo preenchido automaticamente.",variant:"success"})}catch(T){c(k=>({...k,endereco:"",bairro:"",cidade:"",uf:""})),s({title:"Falha ao buscar CEP",description:T.message||"Tente novamente.",variant:"destructive"})}finally{h(!1)}},O=async I=>{I?.preventDefault?.(),window.__protectPaymentModal&&window.__protectPaymentModal(5e3);try{if(!l.nome||l.nome.trim().length<2)throw new Error("Informe o nome/razo social do cliente.");const T={tipo_pessoa:g(l.tipo_pessoa),nome:l.nome,apelido:g(l.apelido),cpf:g(l.cpf),cnpj:g(l.cnpj),rg:g(l.rg),ie:g(l.ie),email:g(l.email),telefone:g(l.telefone),fone2:g(l.fone2),celular1:g(l.celular1),celular2:g(l.celular2),whatsapp:g(l.whatsapp),cep:g(l.cep),endereco:g(l.endereco),numero:g(l.numero),complemento:g(l.complemento),bairro:g(l.bairro),cidade:g(l.cidade),uf:g(l.uf),cidade_ibge:g(l.cidade_ibge),limite_credito:y(l.limite_credito),tipo_recebimento:g(l.tipo_recebimento),regime_tributario:g(l.regime_tributario),tipo_contribuinte:g(l.tipo_contribuinte),aniversario:g(l.aniversario),sexo:g(l.sexo),estado_civil:g(l.estado_civil),nome_mae:g(l.nome_mae),nome_pai:g(l.nome_pai),observacoes:g(l.observacoes),flag_cliente:l.tipo_cadastro==="cliente"||l.tipo_cadastro==="ambos",flag_fornecedor:l.tipo_cadastro==="fornecedor"||l.tipo_cadastro==="ambos",flag_funcionario:!1,flag_administradora:!1,flag_parceiro:!1,flag_ccf_spc:!1,status:l.status};let k,B=null;if(r?.id){const{data:z,error:U}=await re.from("clientes").update(T).eq("id",r.id).select().single();k=U,B=z??null}else{const z=o?.codigo_empresa||null;if(!z)throw new Error("No foi possvel identificar a empresa do usurio (codigo_empresa). Tente recarregar a pgina ou entrar novamente.");const U={...T,codigo_empresa:z},{data:L,error:W}=await re.from("clientes").insert(U).select().single();k=W,B=L??null}if(k)throw k;s({title:"Cliente salvo!",description:"As informaes do cliente foram atualizadas.",variant:"success"}),n?.(B),setTimeout(()=>{t?.(!1)},50)}catch(T){const k=(T?.message||"").toLowerCase(),B=T?.code||"";let z="Erro ao salvar cliente",U=T.message;B==="23505"||k.includes("duplicate key")&&k.includes("uq_clientes_empresa_codigo")?(z="Cdigo j cadastrado",U="J existe um cliente com este cdigo na sua empresa. Deixe o campo cdigo em branco para gerar automaticamente ou escolha outro nmero."):k.includes("column")&&k.includes("does not exist")&&(U="Seu banco pode no estar migrado para os novos campos. Atualize o schema conforme estrutura_bd."),s({title:z,description:U,variant:"destructive"})}};return a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto w-full",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:r?"Editar Cliente":"Novo Cliente"}),a.jsx(Hn,{children:"Preencha os dados cadastrais do cliente."})]}),a.jsx("form",{onSubmit:O,className:"grid gap-4 sm:gap-6 py-2",children:a.jsxs(od,{value:d,onValueChange:u,className:"w-full",children:[a.jsx("div",{className:"sm:hidden mb-4",children:a.jsxs(Gn,{value:d,onValueChange:u,children:[a.jsx(Vn,{className:"w-full",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"basicos",children:"Dados Bsicos"}),a.jsx(lt,{value:"endereco",children:"Endereo"}),a.jsx(lt,{value:"financeiro",children:"Financeiro"}),a.jsx(lt,{value:"adicionais",children:"Adicionais"})]})]})}),a.jsxs(sc,{className:"hidden sm:grid grid-cols-4 gap-2",children:[a.jsx(Pa,{value:"basicos",children:"Dados Bsicos"}),a.jsx(Pa,{value:"endereco",children:"Endereo"}),a.jsx(Pa,{value:"financeiro",children:"Financeiro"}),a.jsx(Pa,{value:"adicionais",children:"Adicionais"})]}),a.jsx(Gs,{value:"basicos",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{children:"Tipo de Pessoa"}),a.jsxs(Gn,{value:l.tipo_pessoa,onValueChange:I=>c(T=>({...T,tipo_pessoa:I})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Pessoa"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"PF",children:"Fsica"}),a.jsx(lt,{value:"PJ",children:"Jurdica"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{children:"Tipo de Cadastro *"}),a.jsxs(Gn,{value:l.tipo_cadastro,onValueChange:I=>c(T=>({...T,tipo_cadastro:I})),required:!0,children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"cliente",children:"Cliente"}),a.jsx(lt,{value:"fornecedor",children:"Fornecedor"}),a.jsx(lt,{value:"ambos",children:"Cliente e Fornecedor"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(it,{htmlFor:"nome",children:l.tipo_pessoa==="PJ"?"Razo Social":"Nome"}),a.jsx(Ct,{id:"nome",value:l.nome,onChange:m,required:!0})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(it,{htmlFor:"apelido",children:l.tipo_pessoa==="PJ"?"Nome Fantasia":"Apelido"}),a.jsx(Ct,{id:"apelido",value:l.apelido,onChange:m})]}),l.tipo_pessoa==="PF"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"cpf",children:"CPF"}),a.jsx(Ct,{id:"cpf",value:l.cpf,onChange:I=>P("cpf",I.target.value),placeholder:"000.000.000-00"})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"rg",children:"RG"}),a.jsx(Ct,{id:"rg",value:l.rg,onChange:m})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"cnpj",children:"CNPJ"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Ct,{id:"cnpj",value:l.cnpj,onChange:I=>P("cnpj",I.target.value),placeholder:"00.000.000/0000-00"}),a.jsx(se,{type:"button",variant:"outline",onClick:x,children:"Buscar"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"ie",children:"Inscrio Estadual (IE)"}),a.jsx(Ct,{id:"ie",value:l.ie,onChange:m})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(it,{htmlFor:"email",children:"Email"}),a.jsx(Ct,{id:"email",type:"email",value:l.email,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"telefone",children:"Telefone"}),a.jsx(Ct,{id:"telefone",value:l.telefone,onChange:I=>P("telefone",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"celular1",children:"Celular"}),a.jsx(Ct,{id:"celular1",value:l.celular1,onChange:I=>P("celular1",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"whatsapp",children:"WhatsApp"}),a.jsx(Ct,{id:"whatsapp",value:l.whatsapp,onChange:I=>P("whatsapp",I.target.value),placeholder:"(DDD) 9...."})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"fone2",children:"Fone 2"}),a.jsx(Ct,{id:"fone2",value:l.fone2,onChange:I=>P("fone2",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"celular2",children:"Celular 2"}),a.jsx(Ct,{id:"celular2",value:l.celular2,onChange:I=>P("celular2",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"aniversario",children:"Nascimento"}),a.jsx(Ct,{id:"aniversario",type:"date",value:l.aniversario||"",onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{children:"Status"}),a.jsxs(Gn,{value:l.status,onValueChange:I=>c(T=>({...T,status:I})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Status"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"active",children:"Ativo"}),a.jsx(lt,{value:"inactive",children:"Inativo"})]})]})]})]})}),a.jsx(Gs,{value:"endereco",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"cep",children:"CEP"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Ct,{id:"cep",value:l.cep,onChange:I=>P("cep",I.target.value),placeholder:"00000-000"}),a.jsx(se,{type:"button",variant:"outline",onClick:F,disabled:f,children:f?"Buscando...":"Buscar"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(it,{htmlFor:"endereco",children:"Endereo"}),a.jsx(Ct,{id:"endereco",value:l.endereco,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"numero",children:"Nmero"}),a.jsx(Ct,{id:"numero",value:l.numero,onChange:I=>P("numero",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(it,{htmlFor:"complemento",children:"Complemento"}),a.jsx(Ct,{id:"complemento",value:l.complemento,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(it,{htmlFor:"bairro",children:"Bairro"}),a.jsx(Ct,{id:"bairro",value:l.bairro,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"cidade",children:"Cidade"}),a.jsx(Ct,{id:"cidade",value:l.cidade,onChange:m})]}),a.jsxs("div",{className:"col-span-6 sm:col-span-1",children:[a.jsx(it,{htmlFor:"uf",children:"UF"}),a.jsx(Ct,{id:"uf",value:l.uf,onChange:I=>P("uf",I.target.value),placeholder:"UF"})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"cidade_ibge",children:"Cd. IBGE"}),a.jsx(Ct,{id:"cidade_ibge",value:l.cidade_ibge,onChange:I=>P("cidade_ibge",I.target.value)})]})]})}),a.jsx(Gs,{value:"financeiro",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{htmlFor:"limite_credito",children:"Limite de Crdito"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary text-sm",children:"R$"}),a.jsx(Ct,{id:"limite_credito",value:l.limite_credito,onChange:I=>P("limite_credito",I.target.value),placeholder:"0,00",className:"pl-10"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{children:"Tipo de Recebimento"}),a.jsxs(Gn,{value:l.tipo_recebimento||"",onValueChange:I=>c(T=>({...T,tipo_recebimento:I})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"avista",children:" vista"}),a.jsx(lt,{value:"aprazo",children:"A prazo"}),a.jsx(lt,{value:"misto",children:"Misto"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{children:"Regime Tributrio"}),a.jsxs(Gn,{value:l.regime_tributario||"",onValueChange:I=>c(T=>({...T,regime_tributario:I})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"simples",children:"Simples"}),a.jsx(lt,{value:"lucro_presumido",children:"Lucro Presumido"}),a.jsx(lt,{value:"lucro_real",children:"Lucro Real"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(it,{children:"Tipo de Contribuinte"}),a.jsxs(Gn,{value:l.tipo_contribuinte||"",onValueChange:I=>c(T=>({...T,tipo_contribuinte:I})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"nao_contribuinte",children:"No Contribuinte"}),a.jsx(lt,{value:"contribuinte",children:"Contribuinte"}),a.jsx(lt,{value:"isento",children:"Isento"})]})]})]})]})}),a.jsx(Gs,{value:"adicionais",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(it,{htmlFor:"sexo",children:"Sexo"}),a.jsxs(Gn,{value:l.sexo||"",onValueChange:I=>c(T=>({...T,sexo:I})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"m",children:"Masculino"}),a.jsx(lt,{value:"f",children:"Feminino"}),a.jsx(lt,{value:"o",children:"Outro"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(it,{htmlFor:"estado_civil",children:"Estado Civil"}),a.jsxs(Gn,{value:l.estado_civil||"",onValueChange:I=>c(T=>({...T,estado_civil:I})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"solteiro",children:"Solteiro(a)"}),a.jsx(lt,{value:"casado",children:"Casado(a)"}),a.jsx(lt,{value:"divorciado",children:"Divorciado(a)"}),a.jsx(lt,{value:"viuvo",children:"Vivo(a)"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(it,{htmlFor:"nome_mae",children:"Nome da Me"}),a.jsx(Ct,{id:"nome_mae",value:l.nome_mae,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(it,{htmlFor:"nome_pai",children:"Nome do Pai"}),a.jsx(Ct,{id:"nome_pai",value:l.nome_pai,onChange:m})]}),a.jsxs("div",{className:"col-span-12",children:[a.jsx(it,{htmlFor:"observacoes",children:"Observaes"}),a.jsx("textarea",{id:"observacoes",value:l.observacoes,onChange:m,rows:4,className:"w-full rounded-md border border-border bg-background p-2 text-sm"})]})]})})]})}),a.jsxs(Na,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Cancelar"})}),a.jsx(se,{type:"submit",onClick:O,className:"w-full sm:w-auto",children:"Salvar Cliente"})]})]})})}function NKe(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const r=document.implementation.createHTMLDocument(),n=r.createElement("base"),s=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(s),t&&(n.href=t),s.href=e,s.href}const SKe=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function Xh(e){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r]);return t}let Bx=null;function jne(e={}){return Bx||(e.includeStyleProperties?(Bx=e.includeStyleProperties,Bx):(Bx=Xh(window.getComputedStyle(document.documentElement)),Bx))}function HS(e,t){const n=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return n?parseFloat(n.replace("px","")):0}function CKe(e){const t=HS(e,"border-left-width"),r=HS(e,"border-right-width");return e.clientWidth+t+r}function AKe(e){const t=HS(e,"border-top-width"),r=HS(e,"border-bottom-width");return e.clientHeight+t+r}function Nne(e,t={}){const r=t.width||CKe(e),n=t.height||AKe(e);return{width:r,height:n}}function PKe(){let e,t;try{t=process}catch{}const r=t&&t.env?t.env.devicePixelRatio:null;return r&&(e=parseInt(r,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const Hc=16384;function EKe(e){(e.width>Hc||e.height>Hc)&&(e.width>Hc&&e.height>Hc?e.width>e.height?(e.height*=Hc/e.width,e.width=Hc):(e.width*=Hc/e.height,e.height=Hc):e.width>Hc?(e.height*=Hc/e.width,e.width=Hc):(e.width*=Hc/e.height,e.height=Hc))}function GS(e){return new Promise((t,r)=>{const n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=r,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function kKe(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function IKe(e,t,r){const n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),o=document.createElementNS(n,"foreignObject");return s.setAttribute("width",`${t}`),s.setAttribute("height",`${r}`),s.setAttribute("viewBox",`0 0 ${t} ${r}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),s.appendChild(o),o.appendChild(e),kKe(s)}const Oc=(e,t)=>{if(e instanceof t)return!0;const r=Object.getPrototypeOf(e);return r===null?!1:r.constructor.name===t.name||Oc(r,t)};function OKe(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function TKe(e,t){return jne(t).map(r=>{const n=e.getPropertyValue(r),s=e.getPropertyPriority(r);return`${r}: ${n}${s?" !important":""};`}).join(" ")}function DKe(e,t,r,n){const s=`.${e}:${t}`,o=r.cssText?OKe(r):TKe(r,n);return document.createTextNode(`${s}{${o}}`)}function Vz(e,t,r,n){const s=window.getComputedStyle(e,r),o=s.getPropertyValue("content");if(o===""||o==="none")return;const i=SKe();try{t.className=`${t.className} ${i}`}catch{return}const l=document.createElement("style");l.appendChild(DKe(i,r,s,n)),t.appendChild(l)}function MKe(e,t,r){Vz(e,t,":before",r),Vz(e,t,":after",r)}const Wz="application/font-woff",Hz="image/jpeg",RKe={woff:Wz,woff2:Wz,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Hz,jpeg:Hz,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function FKe(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function kR(e){const t=FKe(e).toLowerCase();return RKe[t]||""}function LKe(e){return e.split(/,/)[1]}function m3(e){return e.search(/^(data:)/)!==-1}function Sne(e,t){return`data:${t};base64,${e}`}async function Cne(e,t,r){const n=await fetch(e,t);if(n.status===404)throw new Error(`Resource "${n.url}" not found`);const s=await n.blob();return new Promise((o,i)=>{const l=new FileReader;l.onerror=i,l.onloadend=()=>{try{o(r({res:n,result:l.result}))}catch(c){i(c)}},l.readAsDataURL(s)})}const qE={};function $Ke(e,t,r){let n=e.replace(/\?.*/,"");return r&&(n=e),/ttf|otf|eot|woff2?/i.test(n)&&(n=n.replace(/.*\//,"")),t?`[${t}]${n}`:n}async function IR(e,t,r){const n=$Ke(e,t,r.includeQueryParams);if(qE[n]!=null)return qE[n];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let s;try{const o=await Cne(e,r.fetchRequestInit,({res:i,result:l})=>(t||(t=i.headers.get("Content-Type")||""),LKe(l)));s=Sne(o,t)}catch(o){s=r.imagePlaceholder||"";let i=`Failed to fetch resource: ${e}`;o&&(i=typeof o=="string"?o:o.message),i&&console.warn(i)}return qE[n]=s,s}async function BKe(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):GS(t)}async function qKe(e,t){if(e.currentSrc){const o=document.createElement("canvas"),i=o.getContext("2d");o.width=e.clientWidth,o.height=e.clientHeight,i?.drawImage(e,0,0,o.width,o.height);const l=o.toDataURL();return GS(l)}const r=e.poster,n=kR(r),s=await IR(r,n,t);return GS(s)}async function zKe(e,t){var r;try{if(!((r=e?.contentDocument)===null||r===void 0)&&r.body)return await mA(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function UKe(e,t){return Oc(e,HTMLCanvasElement)?BKe(e):Oc(e,HTMLVideoElement)?qKe(e,t):Oc(e,HTMLIFrameElement)?zKe(e,t):e.cloneNode(Ane(e))}const VKe=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",Ane=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function WKe(e,t,r){var n,s;if(Ane(t))return t;let o=[];return VKe(e)&&e.assignedNodes?o=Xh(e.assignedNodes()):Oc(e,HTMLIFrameElement)&&(!((n=e.contentDocument)===null||n===void 0)&&n.body)?o=Xh(e.contentDocument.body.childNodes):o=Xh(((s=e.shadowRoot)!==null&&s!==void 0?s:e).childNodes),o.length===0||Oc(e,HTMLVideoElement)||await o.reduce((i,l)=>i.then(()=>mA(l,r)).then(c=>{c&&t.appendChild(c)}),Promise.resolve()),t}function HKe(e,t,r){const n=t.style;if(!n)return;const s=window.getComputedStyle(e);s.cssText?(n.cssText=s.cssText,n.transformOrigin=s.transformOrigin):jne(r).forEach(o=>{let i=s.getPropertyValue(o);o==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),Oc(e,HTMLIFrameElement)&&o==="display"&&i==="inline"&&(i="block"),o==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),n.setProperty(o,i,s.getPropertyPriority(o))})}function GKe(e,t){Oc(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),Oc(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function KKe(e,t){if(Oc(e,HTMLSelectElement)){const r=t,n=Array.from(r.children).find(s=>e.value===s.getAttribute("value"));n&&n.setAttribute("selected","")}}function XKe(e,t,r){return Oc(t,Element)&&(HKe(e,t,r),MKe(e,t,r),GKe(e,t),KKe(e,t)),t}async function YKe(e,t){const r=e.querySelectorAll?e.querySelectorAll("use"):[];if(r.length===0)return e;const n={};for(let o=0;o<r.length;o++){const l=r[o].getAttribute("xlink:href");if(l){const c=e.querySelector(l),d=document.querySelector(l);!c&&d&&!n[l]&&(n[l]=await mA(d,t,!0))}}const s=Object.values(n);if(s.length){const o="http://www.w3.org/1999/xhtml",i=document.createElementNS(o,"svg");i.setAttribute("xmlns",o),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden",i.style.display="none";const l=document.createElementNS(o,"defs");i.appendChild(l);for(let c=0;c<s.length;c++)l.appendChild(s[c]);e.appendChild(i)}return e}async function mA(e,t,r){return!r&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(n=>UKe(n,t)).then(n=>WKe(e,n,t)).then(n=>XKe(e,n,t)).then(n=>YKe(n,t))}const Pne=/url\((['"]?)([^'"]+?)\1\)/g,JKe=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,QKe=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ZKe(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function eXe(e){const t=[];return e.replace(Pne,(r,n,s)=>(t.push(s),r)),t.filter(r=>!m3(r))}async function tXe(e,t,r,n,s){try{const o=r?NKe(t,r):t,i=kR(t);let l;if(s){const c=await s(o);l=Sne(c,i)}else l=await IR(o,i,n);return e.replace(ZKe(t),`$1${l}$3`)}catch{}return e}function rXe(e,{preferredFontFormat:t}){return t?e.replace(QKe,r=>{for(;;){const[n,,s]=JKe.exec(r)||[];if(!s)return"";if(s===t)return`src: ${n};`}}):e}function Ene(e){return e.search(Pne)!==-1}async function kne(e,t,r){if(!Ene(e))return e;const n=rXe(e,r);return eXe(n).reduce((o,i)=>o.then(l=>tXe(l,i,t,r)),Promise.resolve(n))}async function qx(e,t,r){var n;const s=(n=t.style)===null||n===void 0?void 0:n.getPropertyValue(e);if(s){const o=await kne(s,null,r);return t.style.setProperty(e,o,t.style.getPropertyPriority(e)),!0}return!1}async function nXe(e,t){await qx("background",e,t)||await qx("background-image",e,t),await qx("mask",e,t)||await qx("-webkit-mask",e,t)||await qx("mask-image",e,t)||await qx("-webkit-mask-image",e,t)}async function aXe(e,t){const r=Oc(e,HTMLImageElement);if(!(r&&!m3(e.src))&&!(Oc(e,SVGImageElement)&&!m3(e.href.baseVal)))return;const n=r?e.src:e.href.baseVal,s=await IR(n,kR(n),t);await new Promise((o,i)=>{e.onload=o,e.onerror=t.onImageErrorHandler?(...c)=>{try{o(t.onImageErrorHandler(...c))}catch(d){i(d)}}:i;const l=e;l.decode&&(l.decode=o),l.loading==="lazy"&&(l.loading="eager"),r?(e.srcset="",e.src=s):e.href.baseVal=s})}async function sXe(e,t){const n=Xh(e.childNodes).map(s=>Ine(s,t));await Promise.all(n).then(()=>e)}async function Ine(e,t){Oc(e,Element)&&(await nXe(e,t),await aXe(e,t),await sXe(e,t))}function oXe(e,t){const{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);const n=t.style;return n!=null&&Object.keys(n).forEach(s=>{r[s]=n[s]}),e}const Gz={};async function Kz(e){let t=Gz[e];if(t!=null)return t;const n=await(await fetch(e)).text();return t={url:e,cssText:n},Gz[e]=t,t}async function Xz(e,t){let r=e.cssText;const n=/url\(["']?([^"')]+)["']?\)/g,o=(r.match(/url\([^)]+\)/g)||[]).map(async i=>{let l=i.replace(n,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),Cne(l,t.fetchRequestInit,({result:c})=>(r=r.replace(i,`url(${c})`),[i,c]))});return Promise.all(o).then(()=>r)}function Yz(e){if(e==null)return[];const t=[],r=/(\/\*[\s\S]*?\*\/)/gi;let n=e.replace(r,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=s.exec(n);if(c===null)break;t.push(c[0])}n=n.replace(s,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(i,"gi");for(;;){let c=o.exec(n);if(c===null){if(c=l.exec(n),c===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;t.push(c[0])}return t}async function iXe(e,t){const r=[],n=[];return e.forEach(s=>{if("cssRules"in s)try{Xh(s.cssRules||[]).forEach((o,i)=>{if(o.type===CSSRule.IMPORT_RULE){let l=i+1;const c=o.href,d=Kz(c).then(u=>Xz(u,t)).then(u=>Yz(u).forEach(f=>{try{s.insertRule(f,f.startsWith("@import")?l+=1:s.cssRules.length)}catch(h){console.error("Error inserting rule from remote css",{rule:f,error:h})}})).catch(u=>{console.error("Error loading remote css",u.toString())});n.push(d)}})}catch(o){const i=e.find(l=>l.href==null)||document.styleSheets[0];s.href!=null&&n.push(Kz(s.href).then(l=>Xz(l,t)).then(l=>Yz(l).forEach(c=>{i.insertRule(c,i.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",o)}}),Promise.all(n).then(()=>(e.forEach(s=>{if("cssRules"in s)try{Xh(s.cssRules||[]).forEach(o=>{r.push(o)})}catch(o){console.error(`Error while reading CSS rules from ${s.href}`,o)}}),r))}function lXe(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Ene(t.style.getPropertyValue("src")))}async function cXe(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const r=Xh(e.ownerDocument.styleSheets),n=await iXe(r,t);return lXe(n)}function One(e){return e.trim().replace(/["']/g,"")}function dXe(e){const t=new Set;function r(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(o=>{t.add(One(o))}),Array.from(n.children).forEach(o=>{o instanceof HTMLElement&&r(o)})}return r(e),t}async function uXe(e,t){const r=await cXe(e,t),n=dXe(e);return(await Promise.all(r.filter(o=>n.has(One(o.style.fontFamily))).map(o=>{const i=o.parentStyleSheet?o.parentStyleSheet.href:null;return kne(o.cssText,i,t)}))).join(`
`)}async function fXe(e,t){const r=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await uXe(e,t);if(r){const n=document.createElement("style"),s=document.createTextNode(r);n.appendChild(s),e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)}}async function mXe(e,t={}){const{width:r,height:n}=Nne(e,t),s=await mA(e,t,!0);return await fXe(s,t),await Ine(s,t),oXe(s,t),await IKe(s,r,n)}async function hXe(e,t={}){const{width:r,height:n}=Nne(e,t),s=await mXe(e,t),o=await GS(s),i=document.createElement("canvas"),l=i.getContext("2d"),c=t.pixelRatio||PKe(),d=t.canvasWidth||r,u=t.canvasHeight||n;return i.width=d*c,i.height=u*c,t.skipAutoScale||EKe(i),i.style.width=`${d}`,i.style.height=`${u}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,i.width,i.height)),l.drawImage(o,0,0,i.width,i.height),i}async function pXe(e,t={}){return(await hXe(e,t)).toDataURL()}var Wu=Uint8Array,id=Uint16Array,OR=Int32Array,TR=new Wu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),DR=new Wu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Jz=new Wu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tne=function(e,t){for(var r=new id(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var s=new OR(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)s[o]=o-r[n]<<5|n;return{b:r,r:s}},Dne=Tne(TR,2),gXe=Dne.b,h3=Dne.r;gXe[28]=258,h3[258]=28;var xXe=Tne(DR,0),Qz=xXe.r,p3=new id(32768);for(var bo=0;bo<32768;++bo){var Zm=(bo&43690)>>1|(bo&21845)<<1;Zm=(Zm&52428)>>2|(Zm&13107)<<2,Zm=(Zm&61680)>>4|(Zm&3855)<<4,p3[bo]=((Zm&65280)>>8|(Zm&255)<<8)>>1}var Qb=function(e,t,r){for(var n=e.length,s=0,o=new id(t);s<n;++s)e[s]&&++o[e[s]-1];var i=new id(t);for(s=1;s<t;++s)i[s]=i[s-1]+o[s-1]<<1;var l;if(r){l=new id(1<<t);var c=15-t;for(s=0;s<n;++s)if(e[s])for(var d=s<<4|e[s],u=t-e[s],f=i[e[s]-1]++<<u,h=f|(1<<u)-1;f<=h;++f)l[p3[f]>>c]=d}else for(l=new id(n),s=0;s<n;++s)e[s]&&(l[s]=p3[i[e[s]-1]++]>>15-e[s]);return l},ex=new Wu(288);for(var bo=0;bo<144;++bo)ex[bo]=8;for(var bo=144;bo<256;++bo)ex[bo]=9;for(var bo=256;bo<280;++bo)ex[bo]=7;for(var bo=280;bo<288;++bo)ex[bo]=8;var KS=new Wu(32);for(var bo=0;bo<32;++bo)KS[bo]=5;var vXe=Qb(ex,9,0),yXe=Qb(KS,5,0),Mne=function(e){return(e+7)/8|0},bXe=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new Wu(e.subarray(t,r))},Xf=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},Qy=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},zE=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var s=r.length,o=r.slice();if(!s)return{t:Fne,l:0};if(s==1){var i=new Wu(r[0].s+1);return i[r[0].s]=1,{t:i,l:1}}r.sort(function(j,S){return j.f-S.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],d=0,u=1,f=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};u!=s-1;)l=r[r[d].f<r[f].f?d++:f++],c=r[d!=u&&r[d].f<r[f].f?d++:f++],r[u++]={s:-1,f:l.f+c.f,l,r:c};for(var h=o[0].s,n=1;n<s;++n)o[n].s>h&&(h=o[n].s);var m=new id(h+1),x=g3(r[u-1],m,0);if(x>t){var n=0,g=0,y=x-t,v=1<<y;for(o.sort(function(S,C){return m[C.s]-m[S.s]||S.f-C.f});n<s;++n){var b=o[n].s;if(m[b]>t)g+=v-(1<<x-m[b]),m[b]=t;else break}for(g>>=y;g>0;){var w=o[n].s;m[w]<t?g-=1<<t-m[w]++-1:++n}for(;n>=0&&g;--n){var _=o[n].s;m[_]==t&&(--m[_],++g)}x=t}return{t:new Wu(m),l:x}},g3=function(e,t,r){return e.s==-1?Math.max(g3(e.l,t,r+1),g3(e.r,t,r+1)):t[e.s]=r},Zz=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new id(++t),n=0,s=e[0],o=1,i=function(c){r[n++]=c},l=1;l<=t;++l)if(e[l]==s&&l!=t)++o;else{if(!s&&o>2){for(;o>138;o-=138)i(32754);o>2&&(i(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(i(s),--o;o>6;o-=6)i(8304);o>2&&(i(o-3<<5|8208),o=0)}for(;o--;)i(s);o=1,s=e[l]}return{c:r.subarray(0,n),n:t}},Zy=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},Rne=function(e,t,r){var n=r.length,s=Mne(t+2);e[s]=n&255,e[s+1]=n>>8,e[s+2]=e[s]^255,e[s+3]=e[s+1]^255;for(var o=0;o<n;++o)e[s+o+4]=r[o];return(s+4+n)*8},e9=function(e,t,r,n,s,o,i,l,c,d,u){Xf(t,u++,r),++s[256];for(var f=zE(s,15),h=f.t,m=f.l,x=zE(o,15),g=x.t,y=x.l,v=Zz(h),b=v.c,w=v.n,_=Zz(g),j=_.c,S=_.n,C=new id(19),A=0;A<b.length;++A)++C[b[A]&31];for(var A=0;A<j.length;++A)++C[j[A]&31];for(var P=zE(C,7),F=P.t,O=P.l,I=19;I>4&&!F[Jz[I-1]];--I);var T=d+5<<3,k=Zy(s,ex)+Zy(o,KS)+i,B=Zy(s,h)+Zy(o,g)+i+14+3*I+Zy(C,F)+2*C[16]+3*C[17]+7*C[18];if(c>=0&&T<=k&&T<=B)return Rne(t,u,e.subarray(c,c+d));var z,U,L,W;if(Xf(t,u,1+(B<k)),u+=2,B<k){z=Qb(h,m,0),U=h,L=Qb(g,y,0),W=g;var ge=Qb(F,O,0);Xf(t,u,w-257),Xf(t,u+5,S-1),Xf(t,u+10,I-4),u+=14;for(var A=0;A<I;++A)Xf(t,u+3*A,F[Jz[A]]);u+=3*I;for(var Ae=[b,j],V=0;V<2;++V)for(var $=Ae[V],A=0;A<$.length;++A){var Y=$[A]&31;Xf(t,u,ge[Y]),u+=F[Y],Y>15&&(Xf(t,u,$[A]>>5&127),u+=$[A]>>12)}}else z=vXe,U=ex,L=yXe,W=KS;for(var A=0;A<l;++A){var he=n[A];if(he>255){var Y=he>>18&31;Qy(t,u,z[Y+257]),u+=U[Y+257],Y>7&&(Xf(t,u,he>>23&31),u+=TR[Y]);var J=he&31;Qy(t,u,L[J]),u+=W[J],J>3&&(Qy(t,u,he>>5&8191),u+=DR[J])}else Qy(t,u,z[he]),u+=U[he]}return Qy(t,u,z[256]),u+U[256]},wXe=new OR([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Fne=new Wu(0),_Xe=function(e,t,r,n,s,o){var i=o.z||e.length,l=new Wu(n+i+5*(1+Math.ceil(i/7e3))+s),c=l.subarray(n,l.length-s),d=o.l,u=(o.r||0)&7;if(t){u&&(c[0]=o.r>>3);for(var f=wXe[t-1],h=f>>13,m=f&8191,x=(1<<r)-1,g=o.p||new id(32768),y=o.h||new id(x+1),v=Math.ceil(r/3),b=2*v,w=function(ne){return(e[ne]^e[ne+1]<<v^e[ne+2]<<b)&x},_=new OR(25e3),j=new id(288),S=new id(32),C=0,A=0,P=o.i||0,F=0,O=o.w||0,I=0;P+2<i;++P){var T=w(P),k=P&32767,B=y[T];if(g[k]=B,y[T]=k,O<=P){var z=i-P;if((C>7e3||F>24576)&&(z>423||!d)){u=e9(e,c,0,_,j,S,A,F,I,P-I,u),F=C=A=0,I=P;for(var U=0;U<286;++U)j[U]=0;for(var U=0;U<30;++U)S[U]=0}var L=2,W=0,ge=m,Ae=k-B&32767;if(z>2&&T==w(P-Ae))for(var V=Math.min(h,z)-1,$=Math.min(32767,P),Y=Math.min(258,z);Ae<=$&&--ge&&k!=B;){if(e[P+L]==e[P+L-Ae]){for(var he=0;he<Y&&e[P+he]==e[P+he-Ae];++he);if(he>L){if(L=he,W=Ae,he>V)break;for(var J=Math.min(Ae,he-2),G=0,U=0;U<J;++U){var ue=P-Ae+U&32767,ve=g[ue],ae=ue-ve&32767;ae>G&&(G=ae,B=ue)}}}k=B,B=g[k],Ae+=k-B&32767}if(W){_[F++]=268435456|h3[L]<<18|Qz[W];var oe=h3[L]&31,me=Qz[W]&31;A+=TR[oe]+DR[me],++j[257+oe],++S[me],O=P+L,++C}else _[F++]=e[P],++j[e[P]]}}for(P=Math.max(P,O);P<i;++P)_[F++]=e[P],++j[e[P]];u=e9(e,c,d,_,j,S,A,F,I,P-I,u),d||(o.r=u&7|c[u/8|0]<<3,u-=7,o.h=y,o.p=g,o.i=P,o.w=O)}else{for(var P=o.w||0;P<i+d;P+=65535){var De=P+65535;De>=i&&(c[u/8|0]=d,De=i),u=Rne(c,u+1,e.subarray(P,De))}o.i=i}return bXe(l,0,n+Mne(u)+s)},Lne=function(){var e=1,t=0;return{p:function(r){for(var n=e,s=t,o=r.length|0,i=0;i!=o;){for(var l=Math.min(i+2655,o);i<l;++i)s+=n+=r[i];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}e=n,t=s},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},jXe=function(e,t,r,n,s){if(!s&&(s={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),i=new Wu(o.length+e.length);i.set(o),i.set(e,o.length),e=i,s.w=o.length}return _Xe(e,t.level==null?6:t.level,t.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,s)},$ne=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},NXe=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var s=Lne();s.p(t.dictionary),$ne(e,2,s.d())}};function x3(e,t){t||(t={});var r=Lne();r.p(e);var n=jXe(e,t,t.dictionary?6:2,4);return NXe(n,t),$ne(n,n.length-4,r.d()),n}var SXe=typeof TextDecoder<"u"&&new TextDecoder,CXe=0;try{SXe.decode(Fne,{stream:!0}),CXe=1}catch{}function AXe(e){if(Array.isArray(e))return e}function PXe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function EXe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t9(e,t){return AXe(e)||PXe(e,t)||l2e(e,t)||EXe()}function r9(e,t="utf8"){return new TextDecoder(t).decode(e)}const kXe=new TextEncoder;function IXe(e){return kXe.encode(e)}const OXe=1024*8,TXe=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),UE={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class MR{constructor(t=OXe,r={}){Fs(this,"buffer");Fs(this,"byteLength");Fs(this,"byteOffset");Fs(this,"length");Fs(this,"offset");Fs(this,"lastWrittenByte");Fs(this,"littleEndian");Fs(this,"_data");Fs(this,"_mark");Fs(this,"_marks");let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const s=r.offset?r.offset>>>0:0,o=t.byteLength-s;let i=s;(ArrayBuffer.isView(t)||t instanceof MR)&&(t.byteLength!==t.buffer.byteLength&&(i=t.byteOffset+s),t=t.buffer),n?this.lastWrittenByte=o:this.lastWrittenByte=0,this.buffer=t,this.length=o,this.byteLength=o,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,o),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,r){const n=UE[r].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,o=this.buffer.slice(s,s+n);if(this.littleEndian===TXe&&r!=="uint8"&&r!=="int8"){const l=new Uint8Array(this.buffer.slice(s,s+n));l.reverse();const c=new UE[r](l.buffer);return this.offset+=n,c.reverse(),c}const i=new UE[r](o);return this.offset+=n,i}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let n=0;n<t;n++)r+=this.readChar();return r}readUtf8(t=1){return r9(this.readBytes(t))}decodeText(t=1,r="utf8"){return r9(this.readBytes(t),r)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}writeUtf8(t){return this.writeBytes(IXe(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const DXe=4,n9=0,a9=1,MXe=2;function hy(e){let t=e.length;for(;--t>=0;)e[t]=0}const RXe=0,Bne=1,FXe=2,LXe=3,$Xe=258,RR=29,g2=256,N1=g2+1+RR,zv=30,FR=19,qne=2*N1+1,xg=15,VE=16,BXe=7,LR=256,zne=16,Une=17,Vne=18,v3=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Dj=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),qXe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Wne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zXe=512,sm=new Array((N1+2)*2);hy(sm);const Zb=new Array(zv*2);hy(Zb);const S1=new Array(zXe);hy(S1);const C1=new Array($Xe-LXe+1);hy(C1);const $R=new Array(RR);hy($R);const XS=new Array(zv);hy(XS);function WE(e,t,r,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let Hne,Gne,Kne;function HE(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const Xne=e=>e<256?S1[e]:S1[256+(e>>>7)],A1=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},Pc=(e,t,r)=>{e.bi_valid>VE-r?(e.bi_buf|=t<<e.bi_valid&65535,A1(e,e.bi_buf),e.bi_buf=t>>VE-e.bi_valid,e.bi_valid+=r-VE):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},gf=(e,t,r)=>{Pc(e,r[t*2],r[t*2+1])},Yne=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},UXe=e=>{e.bi_valid===16?(A1(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},VXe=(e,t)=>{const r=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,i=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let d,u,f,h,m,x,g=0;for(h=0;h<=xg;h++)e.bl_count[h]=0;for(r[e.heap[e.heap_max]*2+1]=0,d=e.heap_max+1;d<qne;d++)u=e.heap[d],h=r[r[u*2+1]*2+1]+1,h>c&&(h=c,g++),r[u*2+1]=h,!(u>n)&&(e.bl_count[h]++,m=0,u>=l&&(m=i[u-l]),x=r[u*2],e.opt_len+=x*(h+m),o&&(e.static_len+=x*(s[u*2+1]+m)));if(g!==0){do{for(h=c-1;e.bl_count[h]===0;)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(h=c;h!==0;h--)for(u=e.bl_count[h];u!==0;)f=e.heap[--d],!(f>n)&&(r[f*2+1]!==h&&(e.opt_len+=(h-r[f*2+1])*r[f*2],r[f*2+1]=h),u--)}},Jne=(e,t,r)=>{const n=new Array(xg+1);let s=0,o,i;for(o=1;o<=xg;o++)s=s+r[o-1]<<1,n[o]=s;for(i=0;i<=t;i++){let l=e[i*2+1];l!==0&&(e[i*2]=Yne(n[l]++,l))}},WXe=()=>{let e,t,r,n,s;const o=new Array(xg+1);for(r=0,n=0;n<RR-1;n++)for($R[n]=r,e=0;e<1<<v3[n];e++)C1[r++]=n;for(C1[r-1]=n,s=0,n=0;n<16;n++)for(XS[n]=s,e=0;e<1<<Dj[n];e++)S1[s++]=n;for(s>>=7;n<zv;n++)for(XS[n]=s<<7,e=0;e<1<<Dj[n]-7;e++)S1[256+s++]=n;for(t=0;t<=xg;t++)o[t]=0;for(e=0;e<=143;)sm[e*2+1]=8,e++,o[8]++;for(;e<=255;)sm[e*2+1]=9,e++,o[9]++;for(;e<=279;)sm[e*2+1]=7,e++,o[7]++;for(;e<=287;)sm[e*2+1]=8,e++,o[8]++;for(Jne(sm,N1+1,o),e=0;e<zv;e++)Zb[e*2+1]=5,Zb[e*2]=Yne(e,5);Hne=new WE(sm,v3,g2+1,N1,xg),Gne=new WE(Zb,Dj,0,zv,xg),Kne=new WE(new Array(0),qXe,0,FR,BXe)},Qne=e=>{let t;for(t=0;t<N1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<zv;t++)e.dyn_dtree[t*2]=0;for(t=0;t<FR;t++)e.bl_tree[t*2]=0;e.dyn_ltree[LR*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Zne=e=>{e.bi_valid>8?A1(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},s9=(e,t,r,n)=>{const s=t*2,o=r*2;return e[s]<e[o]||e[s]===e[o]&&n[t]<=n[r]},GE=(e,t,r)=>{const n=e.heap[r];let s=r<<1;for(;s<=e.heap_len&&(s<e.heap_len&&s9(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!s9(t,n,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=n},o9=(e,t,r)=>{let n,s,o=0,i,l;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+o++]&255,n+=(e.pending_buf[e.sym_buf+o++]&255)<<8,s=e.pending_buf[e.sym_buf+o++],n===0?gf(e,s,t):(i=C1[s],gf(e,i+g2+1,t),l=v3[i],l!==0&&(s-=$R[i],Pc(e,s,l)),n--,i=Xne(n),gf(e,i,r),l=Dj[i],l!==0&&(n-=XS[i],Pc(e,n,l)));while(o<e.sym_next);gf(e,LR,t)},y3=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.elems;let i,l,c=-1,d;for(e.heap_len=0,e.heap_max=qne,i=0;i<o;i++)r[i*2]!==0?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):r[i*2+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=c<2?++c:0,r[d*2]=1,e.depth[d]=0,e.opt_len--,s&&(e.static_len-=n[d*2+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)GE(e,r,i);d=o;do i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],GE(e,r,1),l=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=l,r[d*2]=r[i*2]+r[l*2],e.depth[d]=(e.depth[i]>=e.depth[l]?e.depth[i]:e.depth[l])+1,r[i*2+1]=r[l*2+1]=d,e.heap[1]=d++,GE(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],VXe(e,t),Jne(r,c,e.bl_count)},i9=(e,t,r)=>{let n,s=-1,o,i=t[0*2+1],l=0,c=7,d=4;for(i===0&&(c=138,d=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)o=i,i=t[(n+1)*2+1],!(++l<c&&o===i)&&(l<d?e.bl_tree[o*2]+=l:o!==0?(o!==s&&e.bl_tree[o*2]++,e.bl_tree[zne*2]++):l<=10?e.bl_tree[Une*2]++:e.bl_tree[Vne*2]++,l=0,s=o,i===0?(c=138,d=3):o===i?(c=6,d=3):(c=7,d=4))},l9=(e,t,r)=>{let n,s=-1,o,i=t[0*2+1],l=0,c=7,d=4;for(i===0&&(c=138,d=3),n=0;n<=r;n++)if(o=i,i=t[(n+1)*2+1],!(++l<c&&o===i)){if(l<d)do gf(e,o,e.bl_tree);while(--l!==0);else o!==0?(o!==s&&(gf(e,o,e.bl_tree),l--),gf(e,zne,e.bl_tree),Pc(e,l-3,2)):l<=10?(gf(e,Une,e.bl_tree),Pc(e,l-3,3)):(gf(e,Vne,e.bl_tree),Pc(e,l-11,7));l=0,s=o,i===0?(c=138,d=3):o===i?(c=6,d=3):(c=7,d=4)}},HXe=e=>{let t;for(i9(e,e.dyn_ltree,e.l_desc.max_code),i9(e,e.dyn_dtree,e.d_desc.max_code),y3(e,e.bl_desc),t=FR-1;t>=3&&e.bl_tree[Wne[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},GXe=(e,t,r,n)=>{let s;for(Pc(e,t-257,5),Pc(e,r-1,5),Pc(e,n-4,4),s=0;s<n;s++)Pc(e,e.bl_tree[Wne[s]*2+1],3);l9(e,e.dyn_ltree,t-1),l9(e,e.dyn_dtree,r-1)},KXe=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return n9;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return a9;for(r=32;r<g2;r++)if(e.dyn_ltree[r*2]!==0)return a9;return n9};let c9=!1;const XXe=e=>{c9||(WXe(),c9=!0),e.l_desc=new HE(e.dyn_ltree,Hne),e.d_desc=new HE(e.dyn_dtree,Gne),e.bl_desc=new HE(e.bl_tree,Kne),e.bi_buf=0,e.bi_valid=0,Qne(e)},eae=(e,t,r,n)=>{Pc(e,(RXe<<1)+(n?1:0),3),Zne(e),A1(e,r),A1(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},YXe=e=>{Pc(e,Bne<<1,3),gf(e,LR,sm),UXe(e)},JXe=(e,t,r,n)=>{let s,o,i=0;e.level>0?(e.strm.data_type===MXe&&(e.strm.data_type=KXe(e)),y3(e,e.l_desc),y3(e,e.d_desc),i=HXe(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=r+5,r+4<=s&&t!==-1?eae(e,t,r,n):e.strategy===DXe||o===s?(Pc(e,(Bne<<1)+(n?1:0),3),o9(e,sm,Zb)):(Pc(e,(FXe<<1)+(n?1:0),3),GXe(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),o9(e,e.dyn_ltree,e.dyn_dtree)),Qne(e),n&&Zne(e)},QXe=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(C1[r]+g2+1)*2]++,e.dyn_dtree[Xne(t)*2]++),e.sym_next===e.sym_end);var ZXe=XXe,eYe=eae,tYe=JXe,rYe=QXe,nYe=YXe,aYe={_tr_init:ZXe,_tr_stored_block:eYe,_tr_flush_block:tYe,_tr_tally:rYe,_tr_align:nYe};const sYe=(e,t,r,n)=>{let s=e&65535|0,o=e>>>16&65535|0,i=0;for(;r!==0;){i=r>2e3?2e3:r,r-=i;do s=s+t[n++]|0,o=o+s|0;while(--i);s%=65521,o%=65521}return s|o<<16|0};var P1=sYe;const oYe=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},iYe=new Uint32Array(oYe()),lYe=(e,t,r,n)=>{const s=iYe,o=n+r;e^=-1;for(let i=n;i<o;i++)e=e>>>8^s[(e^t[i])&255];return e^-1};var qi=lYe,D0={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},x2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:cYe,_tr_stored_block:b3,_tr_flush_block:dYe,_tr_tally:Yh,_tr_align:uYe}=aYe,{Z_NO_FLUSH:Jh,Z_PARTIAL_FLUSH:fYe,Z_FULL_FLUSH:mYe,Z_FINISH:Gd,Z_BLOCK:d9,Z_OK:cl,Z_STREAM_END:u9,Z_STREAM_ERROR:Of,Z_DATA_ERROR:hYe,Z_BUF_ERROR:KE,Z_DEFAULT_COMPRESSION:pYe,Z_FILTERED:gYe,Z_HUFFMAN_ONLY:z_,Z_RLE:xYe,Z_FIXED:vYe,Z_DEFAULT_STRATEGY:yYe,Z_UNKNOWN:bYe,Z_DEFLATED:hA}=x2,wYe=9,_Ye=15,jYe=8,NYe=29,SYe=256,w3=SYe+1+NYe,CYe=30,AYe=19,PYe=2*w3+1,EYe=15,fs=3,kh=258,Tf=kh+fs+1,kYe=32,M0=42,BR=57,_3=69,j3=73,N3=91,S3=103,vg=113,bb=666,oc=1,py=2,tx=3,gy=4,IYe=3,yg=(e,t)=>(e.msg=D0[t],t),f9=e=>e*2-(e>4?9:0),yh=e=>{let t=e.length;for(;--t>=0;)e[t]=0},OYe=e=>{let t,r,n,s=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=s?r-s:0;while(--t);t=s,n=t;do r=e.prev[--n],e.prev[n]=r>=s?r-s:0;while(--t)};let TYe=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,Qh=TYe;const Jc=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},ld=(e,t)=>{dYe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Jc(e.strm)},As=(e,t)=>{e.pending_buf[e.pending++]=t},eb=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},C3=(e,t,r,n)=>{let s=e.avail_in;return s>n&&(s=n),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),r),e.state.wrap===1?e.adler=P1(e.adler,t,s,r):e.state.wrap===2&&(e.adler=qi(e.adler,t,s,r)),e.next_in+=s,e.total_in+=s,s)},tae=(e,t)=>{let r=e.max_chain_length,n=e.strstart,s,o,i=e.prev_length,l=e.nice_match;const c=e.strstart>e.w_size-Tf?e.strstart-(e.w_size-Tf):0,d=e.window,u=e.w_mask,f=e.prev,h=e.strstart+kh;let m=d[n+i-1],x=d[n+i];e.prev_length>=e.good_match&&(r>>=2),l>e.lookahead&&(l=e.lookahead);do if(s=t,!(d[s+i]!==x||d[s+i-1]!==m||d[s]!==d[n]||d[++s]!==d[n+1])){n+=2,s++;do;while(d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&n<h);if(o=kh-(h-n),n=h-kh,o>i){if(e.match_start=t,i=o,o>=l)break;m=d[n+i-1],x=d[n+i]}}while((t=f[t&u])>c&&--r!==0);return i<=e.lookahead?i:e.lookahead},R0=e=>{const t=e.w_size;let r,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Tf)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),OYe(e),n+=t),e.strm.avail_in===0)break;if(r=C3(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=fs)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=Qh(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=Qh(e,e.ins_h,e.window[s+fs-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<fs)););}while(e.lookahead<Tf&&e.strm.avail_in!==0)},rae=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,s,o,i=0,l=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>o&&(n=o),n<r&&(n===0&&t!==Gd||t===Jh||n!==s+e.strm.avail_in)))break;i=t===Gd&&n===s+e.strm.avail_in?1:0,b3(e,0,0,i),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Jc(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(C3(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(i===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?gy:t!==Jh&&t!==Gd&&e.strm.avail_in===0&&e.strstart===e.block_start?py:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(C3(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,r=o>e.w_size?e.w_size:o,s=e.strstart-e.block_start,(s>=r||(s||t===Gd)&&t!==Jh&&e.strm.avail_in===0&&s<=o)&&(n=s>o?o:s,i=t===Gd&&e.strm.avail_in===0&&n===s?1:0,b3(e,e.block_start,n,i),e.block_start+=n,Jc(e.strm)),i?tx:oc)},XE=(e,t)=>{let r,n;for(;;){if(e.lookahead<Tf){if(R0(e),e.lookahead<Tf&&t===Jh)return oc;if(e.lookahead===0)break}if(r=0,e.lookahead>=fs&&(e.ins_h=Qh(e,e.ins_h,e.window[e.strstart+fs-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Tf&&(e.match_length=tae(e,r)),e.match_length>=fs)if(n=Yh(e,e.strstart-e.match_start,e.match_length-fs),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=fs){e.match_length--;do e.strstart++,e.ins_h=Qh(e,e.ins_h,e.window[e.strstart+fs-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Qh(e,e.ins_h,e.window[e.strstart+1]);else n=Yh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(ld(e,!1),e.strm.avail_out===0))return oc}return e.insert=e.strstart<fs-1?e.strstart:fs-1,t===Gd?(ld(e,!0),e.strm.avail_out===0?tx:gy):e.sym_next&&(ld(e,!1),e.strm.avail_out===0)?oc:py},zx=(e,t)=>{let r,n,s;for(;;){if(e.lookahead<Tf){if(R0(e),e.lookahead<Tf&&t===Jh)return oc;if(e.lookahead===0)break}if(r=0,e.lookahead>=fs&&(e.ins_h=Qh(e,e.ins_h,e.window[e.strstart+fs-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=fs-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Tf&&(e.match_length=tae(e,r),e.match_length<=5&&(e.strategy===gYe||e.match_length===fs&&e.strstart-e.match_start>4096)&&(e.match_length=fs-1)),e.prev_length>=fs&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-fs,n=Yh(e,e.strstart-1-e.prev_match,e.prev_length-fs),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=Qh(e,e.ins_h,e.window[e.strstart+fs-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=fs-1,e.strstart++,n&&(ld(e,!1),e.strm.avail_out===0))return oc}else if(e.match_available){if(n=Yh(e,0,e.window[e.strstart-1]),n&&ld(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return oc}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Yh(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<fs-1?e.strstart:fs-1,t===Gd?(ld(e,!0),e.strm.avail_out===0?tx:gy):e.sym_next&&(ld(e,!1),e.strm.avail_out===0)?oc:py},DYe=(e,t)=>{let r,n,s,o;const i=e.window;for(;;){if(e.lookahead<=kh){if(R0(e),e.lookahead<=kh&&t===Jh)return oc;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=fs&&e.strstart>0&&(s=e.strstart-1,n=i[s],n===i[++s]&&n===i[++s]&&n===i[++s])){o=e.strstart+kh;do;while(n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&s<o);e.match_length=kh-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=fs?(r=Yh(e,1,e.match_length-fs),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Yh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(ld(e,!1),e.strm.avail_out===0))return oc}return e.insert=0,t===Gd?(ld(e,!0),e.strm.avail_out===0?tx:gy):e.sym_next&&(ld(e,!1),e.strm.avail_out===0)?oc:py},MYe=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(R0(e),e.lookahead===0)){if(t===Jh)return oc;break}if(e.match_length=0,r=Yh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(ld(e,!1),e.strm.avail_out===0))return oc}return e.insert=0,t===Gd?(ld(e,!0),e.strm.avail_out===0?tx:gy):e.sym_next&&(ld(e,!1),e.strm.avail_out===0)?oc:py};function of(e,t,r,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=s}const wb=[new of(0,0,0,0,rae),new of(4,4,8,4,XE),new of(4,5,16,8,XE),new of(4,6,32,32,XE),new of(4,4,16,16,zx),new of(8,16,32,32,zx),new of(8,16,128,128,zx),new of(8,32,128,256,zx),new of(32,128,258,1024,zx),new of(32,258,258,4096,zx)],RYe=e=>{e.window_size=2*e.w_size,yh(e.head),e.max_lazy_match=wb[e.level].max_lazy,e.good_match=wb[e.level].good_length,e.nice_match=wb[e.level].nice_length,e.max_chain_length=wb[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=fs-1,e.match_available=0,e.ins_h=0};function FYe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=hA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(PYe*2),this.dyn_dtree=new Uint16Array((2*CYe+1)*2),this.bl_tree=new Uint16Array((2*AYe+1)*2),yh(this.dyn_ltree),yh(this.dyn_dtree),yh(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(EYe+1),this.heap=new Uint16Array(2*w3+1),yh(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*w3+1),yh(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const v2=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==M0&&t.status!==BR&&t.status!==_3&&t.status!==j3&&t.status!==N3&&t.status!==S3&&t.status!==vg&&t.status!==bb?1:0},nae=e=>{if(v2(e))return yg(e,Of);e.total_in=e.total_out=0,e.data_type=bYe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?BR:t.wrap?M0:vg,e.adler=t.wrap===2?0:1,t.last_flush=-2,cYe(t),cl},aae=e=>{const t=nae(e);return t===cl&&RYe(e.state),t},LYe=(e,t)=>v2(e)||e.state.wrap!==2?Of:(e.state.gzhead=t,cl),sae=(e,t,r,n,s,o)=>{if(!e)return Of;let i=1;if(t===pYe&&(t=6),n<0?(i=0,n=-n):n>15&&(i=2,n-=16),s<1||s>wYe||r!==hA||n<8||n>15||t<0||t>9||o<0||o>vYe||n===8&&i!==1)return yg(e,Of);n===8&&(n=9);const l=new FYe;return e.state=l,l.strm=e,l.status=M0,l.wrap=i,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+fs-1)/fs),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=t,l.strategy=o,l.method=r,aae(e)},$Ye=(e,t)=>sae(e,t,hA,_Ye,jYe,yYe),BYe=(e,t)=>{if(v2(e)||t>d9||t<0)return e?yg(e,Of):Of;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===bb&&t!==Gd)return yg(e,e.avail_out===0?KE:Of);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Jc(e),e.avail_out===0)return r.last_flush=-1,cl}else if(e.avail_in===0&&f9(t)<=f9(n)&&t!==Gd)return yg(e,KE);if(r.status===bb&&e.avail_in!==0)return yg(e,KE);if(r.status===M0&&r.wrap===0&&(r.status=vg),r.status===M0){let s=hA+(r.w_bits-8<<4)<<8,o=-1;if(r.strategy>=z_||r.level<2?o=0:r.level<6?o=1:r.level===6?o=2:o=3,s|=o<<6,r.strstart!==0&&(s|=kYe),s+=31-s%31,eb(r,s),r.strstart!==0&&(eb(r,e.adler>>>16),eb(r,e.adler&65535)),e.adler=1,r.status=vg,Jc(e),r.pending!==0)return r.last_flush=-1,cl}if(r.status===BR){if(e.adler=0,As(r,31),As(r,139),As(r,8),r.gzhead)As(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),As(r,r.gzhead.time&255),As(r,r.gzhead.time>>8&255),As(r,r.gzhead.time>>16&255),As(r,r.gzhead.time>>24&255),As(r,r.level===9?2:r.strategy>=z_||r.level<2?4:0),As(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(As(r,r.gzhead.extra.length&255),As(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=qi(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=_3;else if(As(r,0),As(r,0),As(r,0),As(r,0),As(r,0),As(r,r.level===9?2:r.strategy>=z_||r.level<2?4:0),As(r,IYe),r.status=vg,Jc(e),r.pending!==0)return r.last_flush=-1,cl}if(r.status===_3){if(r.gzhead.extra){let s=r.pending,o=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let l=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+l),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>s&&(e.adler=qi(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex+=l,Jc(e),r.pending!==0)return r.last_flush=-1,cl;s=0,o-=l}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>s&&(e.adler=qi(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=j3}if(r.status===j3){if(r.gzhead.name){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=qi(e.adler,r.pending_buf,r.pending-s,s)),Jc(e),r.pending!==0)return r.last_flush=-1,cl;s=0}r.gzindex<r.gzhead.name.length?o=r.gzhead.name.charCodeAt(r.gzindex++)&255:o=0,As(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=qi(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=N3}if(r.status===N3){if(r.gzhead.comment){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=qi(e.adler,r.pending_buf,r.pending-s,s)),Jc(e),r.pending!==0)return r.last_flush=-1,cl;s=0}r.gzindex<r.gzhead.comment.length?o=r.gzhead.comment.charCodeAt(r.gzindex++)&255:o=0,As(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=qi(e.adler,r.pending_buf,r.pending-s,s))}r.status=S3}if(r.status===S3){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Jc(e),r.pending!==0))return r.last_flush=-1,cl;As(r,e.adler&255),As(r,e.adler>>8&255),e.adler=0}if(r.status=vg,Jc(e),r.pending!==0)return r.last_flush=-1,cl}if(e.avail_in!==0||r.lookahead!==0||t!==Jh&&r.status!==bb){let s=r.level===0?rae(r,t):r.strategy===z_?MYe(r,t):r.strategy===xYe?DYe(r,t):wb[r.level].func(r,t);if((s===tx||s===gy)&&(r.status=bb),s===oc||s===tx)return e.avail_out===0&&(r.last_flush=-1),cl;if(s===py&&(t===fYe?uYe(r):t!==d9&&(b3(r,0,0,!1),t===mYe&&(yh(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Jc(e),e.avail_out===0))return r.last_flush=-1,cl}return t!==Gd?cl:r.wrap<=0?u9:(r.wrap===2?(As(r,e.adler&255),As(r,e.adler>>8&255),As(r,e.adler>>16&255),As(r,e.adler>>24&255),As(r,e.total_in&255),As(r,e.total_in>>8&255),As(r,e.total_in>>16&255),As(r,e.total_in>>24&255)):(eb(r,e.adler>>>16),eb(r,e.adler&65535)),Jc(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?cl:u9)},qYe=e=>{if(v2(e))return Of;const t=e.state.status;return e.state=null,t===vg?yg(e,hYe):cl},zYe=(e,t)=>{let r=t.length;if(v2(e))return Of;const n=e.state,s=n.wrap;if(s===2||s===1&&n.status!==M0||n.lookahead)return Of;if(s===1&&(e.adler=P1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){s===0&&(yh(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(t.subarray(r-n.w_size,r),0),t=c,r=n.w_size}const o=e.avail_in,i=e.next_in,l=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,R0(n);n.lookahead>=fs;){let c=n.strstart,d=n.lookahead-(fs-1);do n.ins_h=Qh(n,n.ins_h,n.window[c+fs-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--d);n.strstart=c,n.lookahead=fs-1,R0(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=fs-1,n.match_available=0,e.next_in=i,e.input=l,e.avail_in=o,n.wrap=s,cl};var UYe=$Ye,VYe=sae,WYe=aae,HYe=nae,GYe=LYe,KYe=BYe,XYe=qYe,YYe=zYe,JYe="pako deflate (from Nodeca project)",ew={deflateInit:UYe,deflateInit2:VYe,deflateReset:WYe,deflateResetKeep:HYe,deflateSetHeader:GYe,deflate:KYe,deflateEnd:XYe,deflateSetDictionary:YYe,deflateInfo:JYe};const QYe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ZYe=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)QYe(r,n)&&(e[n]=r[n])}}return e},eJe=e=>{let t=0;for(let n=0,s=e.length;n<s;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,s=0,o=e.length;n<o;n++){let i=e[n];r.set(i,s),s+=i.length}return r},pA={assign:ZYe,flattenChunks:eJe};let oae=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{oae=!1}const E1=new Uint8Array(256);for(let e=0;e<256;e++)E1[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;E1[254]=E1[254]=1;var tJe=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,s,o,i=e.length,l=0;for(s=0;s<i;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<i&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(l),o=0,s=0;o<l;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<i&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|r&63):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|r&63):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|r&63);return t};const rJe=(e,t)=>{if(t<65534&&e.subarray&&oae)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var nJe=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,s;const o=new Array(r*2);for(s=0,n=0;n<r;){let i=e[n++];if(i<128){o[s++]=i;continue}let l=E1[i];if(l>4){o[s++]=65533,n+=l-1;continue}for(i&=l===2?31:l===3?15:7;l>1&&n<r;)i=i<<6|e[n++]&63,l--;if(l>1){o[s++]=65533;continue}i<65536?o[s++]=i:(i-=65536,o[s++]=55296|i>>10&1023,o[s++]=56320|i&1023)}return rJe(o,s)},aJe=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+E1[e[r]]>t?r:t},k1={string2buf:tJe,buf2string:nJe,utf8border:aJe};function sJe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var iae=sJe;const lae=Object.prototype.toString,{Z_NO_FLUSH:oJe,Z_SYNC_FLUSH:iJe,Z_FULL_FLUSH:lJe,Z_FINISH:cJe,Z_OK:YS,Z_STREAM_END:dJe,Z_DEFAULT_COMPRESSION:uJe,Z_DEFAULT_STRATEGY:fJe,Z_DEFLATED:mJe}=x2;function qR(e){this.options=pA.assign({level:uJe,method:mJe,chunkSize:16384,windowBits:15,memLevel:8,strategy:fJe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iae,this.strm.avail_out=0;let r=ew.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==YS)throw new Error(D0[r]);if(t.header&&ew.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=k1.string2buf(t.dictionary):lae.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=ew.deflateSetDictionary(this.strm,n),r!==YS)throw new Error(D0[r]);this._dict_set=!0}}qR.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let s,o;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?cJe:oJe,typeof e=="string"?r.input=k1.string2buf(e):lae.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===iJe||o===lJe)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(s=ew.deflate(r,o),s===dJe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),s=ew.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===YS;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};qR.prototype.onData=function(e){this.chunks.push(e)};qR.prototype.onEnd=function(e){e===YS&&(this.result=pA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const U_=16209,hJe=16191;var pJe=function(t,r){let n,s,o,i,l,c,d,u,f,h,m,x,g,y,v,b,w,_,j,S,C,A,P,F;const O=t.state;n=t.next_in,P=t.input,s=n+(t.avail_in-5),o=t.next_out,F=t.output,i=o-(r-t.avail_out),l=o+(t.avail_out-257),c=O.dmax,d=O.wsize,u=O.whave,f=O.wnext,h=O.window,m=O.hold,x=O.bits,g=O.lencode,y=O.distcode,v=(1<<O.lenbits)-1,b=(1<<O.distbits)-1;e:do{x<15&&(m+=P[n++]<<x,x+=8,m+=P[n++]<<x,x+=8),w=g[m&v];t:for(;;){if(_=w>>>24,m>>>=_,x-=_,_=w>>>16&255,_===0)F[o++]=w&65535;else if(_&16){j=w&65535,_&=15,_&&(x<_&&(m+=P[n++]<<x,x+=8),j+=m&(1<<_)-1,m>>>=_,x-=_),x<15&&(m+=P[n++]<<x,x+=8,m+=P[n++]<<x,x+=8),w=y[m&b];r:for(;;){if(_=w>>>24,m>>>=_,x-=_,_=w>>>16&255,_&16){if(S=w&65535,_&=15,x<_&&(m+=P[n++]<<x,x+=8,x<_&&(m+=P[n++]<<x,x+=8)),S+=m&(1<<_)-1,S>c){t.msg="invalid distance too far back",O.mode=U_;break e}if(m>>>=_,x-=_,_=o-i,S>_){if(_=S-_,_>u&&O.sane){t.msg="invalid distance too far back",O.mode=U_;break e}if(C=0,A=h,f===0){if(C+=d-_,_<j){j-=_;do F[o++]=h[C++];while(--_);C=o-S,A=F}}else if(f<_){if(C+=d+f-_,_-=f,_<j){j-=_;do F[o++]=h[C++];while(--_);if(C=0,f<j){_=f,j-=_;do F[o++]=h[C++];while(--_);C=o-S,A=F}}}else if(C+=f-_,_<j){j-=_;do F[o++]=h[C++];while(--_);C=o-S,A=F}for(;j>2;)F[o++]=A[C++],F[o++]=A[C++],F[o++]=A[C++],j-=3;j&&(F[o++]=A[C++],j>1&&(F[o++]=A[C++]))}else{C=o-S;do F[o++]=F[C++],F[o++]=F[C++],F[o++]=F[C++],j-=3;while(j>2);j&&(F[o++]=F[C++],j>1&&(F[o++]=F[C++]))}}else if(_&64){t.msg="invalid distance code",O.mode=U_;break e}else{w=y[(w&65535)+(m&(1<<_)-1)];continue r}break}}else if(_&64)if(_&32){O.mode=hJe;break e}else{t.msg="invalid literal/length code",O.mode=U_;break e}else{w=g[(w&65535)+(m&(1<<_)-1)];continue t}break}}while(n<s&&o<l);j=x>>3,n-=j,x-=j<<3,m&=(1<<x)-1,t.next_in=n,t.next_out=o,t.avail_in=n<s?5+(s-n):5-(n-s),t.avail_out=o<l?257+(l-o):257-(o-l),O.hold=m,O.bits=x};const Ux=15,m9=852,h9=592,p9=0,YE=1,g9=2,gJe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),xJe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),vJe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),yJe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),bJe=(e,t,r,n,s,o,i,l)=>{const c=l.bits;let d=0,u=0,f=0,h=0,m=0,x=0,g=0,y=0,v=0,b=0,w,_,j,S,C,A=null,P;const F=new Uint16Array(Ux+1),O=new Uint16Array(Ux+1);let I=null,T,k,B;for(d=0;d<=Ux;d++)F[d]=0;for(u=0;u<n;u++)F[t[r+u]]++;for(m=c,h=Ux;h>=1&&F[h]===0;h--);if(m>h&&(m=h),h===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,l.bits=1,0;for(f=1;f<h&&F[f]===0;f++);for(m<f&&(m=f),y=1,d=1;d<=Ux;d++)if(y<<=1,y-=F[d],y<0)return-1;if(y>0&&(e===p9||h!==1))return-1;for(O[1]=0,d=1;d<Ux;d++)O[d+1]=O[d]+F[d];for(u=0;u<n;u++)t[r+u]!==0&&(i[O[t[r+u]]++]=u);if(e===p9?(A=I=i,P=20):e===YE?(A=gJe,I=xJe,P=257):(A=vJe,I=yJe,P=0),b=0,u=0,d=f,C=o,x=m,g=0,j=-1,v=1<<m,S=v-1,e===YE&&v>m9||e===g9&&v>h9)return 1;for(;;){T=d-g,i[u]+1<P?(k=0,B=i[u]):i[u]>=P?(k=I[i[u]-P],B=A[i[u]-P]):(k=32+64,B=0),w=1<<d-g,_=1<<x,f=_;do _-=w,s[C+(b>>g)+_]=T<<24|k<<16|B|0;while(_!==0);for(w=1<<d-1;b&w;)w>>=1;if(w!==0?(b&=w-1,b+=w):b=0,u++,--F[d]===0){if(d===h)break;d=t[r+i[u]]}if(d>m&&(b&S)!==j){for(g===0&&(g=m),C+=f,x=d-g,y=1<<x;x+g<h&&(y-=F[x+g],!(y<=0));)x++,y<<=1;if(v+=1<<x,e===YE&&v>m9||e===g9&&v>h9)return 1;j=b&S,s[j]=m<<24|x<<16|C-o|0}}return b!==0&&(s[C+b]=d-g<<24|64<<16|0),l.bits=m,0};var tw=bJe;const wJe=0,cae=1,dae=2,{Z_FINISH:x9,Z_BLOCK:_Je,Z_TREES:V_,Z_OK:rx,Z_STREAM_END:jJe,Z_NEED_DICT:NJe,Z_STREAM_ERROR:lu,Z_DATA_ERROR:uae,Z_MEM_ERROR:fae,Z_BUF_ERROR:SJe,Z_DEFLATED:v9}=x2,gA=16180,y9=16181,b9=16182,w9=16183,_9=16184,j9=16185,N9=16186,S9=16187,C9=16188,A9=16189,JS=16190,Yf=16191,JE=16192,P9=16193,QE=16194,E9=16195,k9=16196,I9=16197,O9=16198,W_=16199,H_=16200,T9=16201,D9=16202,M9=16203,R9=16204,F9=16205,ZE=16206,L9=16207,$9=16208,So=16209,mae=16210,hae=16211,CJe=852,AJe=592,PJe=15,EJe=PJe,B9=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function kJe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const yx=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<gA||t.mode>hae?1:0},pae=e=>{if(yx(e))return lu;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=gA,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(CJe),t.distcode=t.distdyn=new Int32Array(AJe),t.sane=1,t.back=-1,rx},gae=e=>{if(yx(e))return lu;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,pae(e)},xae=(e,t)=>{let r;if(yx(e))return lu;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?lu:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,gae(e))},vae=(e,t)=>{if(!e)return lu;const r=new kJe;e.state=r,r.strm=e,r.window=null,r.mode=gA;const n=xae(e,t);return n!==rx&&(e.state=null),n},IJe=e=>vae(e,EJe);let q9=!0,ek,tk;const OJe=e=>{if(q9){ek=new Int32Array(512),tk=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(tw(cae,e.lens,0,288,ek,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;tw(dae,e.lens,0,32,tk,0,e.work,{bits:5}),q9=!1}e.lencode=ek,e.lenbits=9,e.distcode=tk,e.distbits=5},yae=(e,t,r,n)=>{let s;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>n&&(s=n),o.window.set(t.subarray(r-n,r-n+s),o.wnext),n-=s,n?(o.window.set(t.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0},TJe=(e,t)=>{let r,n,s,o,i,l,c,d,u,f,h,m,x,g,y=0,v,b,w,_,j,S,C,A;const P=new Uint8Array(4);let F,O;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yx(e)||!e.output||!e.input&&e.avail_in!==0)return lu;r=e.state,r.mode===Yf&&(r.mode=JE),i=e.next_out,s=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,u=r.bits,f=l,h=c,A=rx;e:for(;;)switch(r.mode){case gA:if(r.wrap===0){r.mode=JE;break}for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&2&&d===35615){r.wbits===0&&(r.wbits=15),r.check=0,P[0]=d&255,P[1]=d>>>8&255,r.check=qi(r.check,P,2,0),d=0,u=0,r.mode=y9;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((d&255)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=So;break}if((d&15)!==v9){e.msg="unknown compression method",r.mode=So;break}if(d>>>=4,u-=4,C=(d&15)+8,r.wbits===0&&(r.wbits=C),C>15||C>r.wbits){e.msg="invalid window size",r.mode=So;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=d&512?A9:Yf,d=0,u=0;break;case y9:for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.flags=d,(r.flags&255)!==v9){e.msg="unknown compression method",r.mode=So;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=So;break}r.head&&(r.head.text=d>>8&1),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,r.check=qi(r.check,P,2,0)),d=0,u=0,r.mode=b9;case b9:for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.head&&(r.head.time=d),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,P[2]=d>>>16&255,P[3]=d>>>24&255,r.check=qi(r.check,P,4,0)),d=0,u=0,r.mode=w9;case w9:for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.head&&(r.head.xflags=d&255,r.head.os=d>>8),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,r.check=qi(r.check,P,2,0)),d=0,u=0,r.mode=_9;case _9:if(r.flags&1024){for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.length=d,r.head&&(r.head.extra_len=d),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,r.check=qi(r.check,P,2,0)),d=0,u=0}else r.head&&(r.head.extra=null);r.mode=j9;case j9:if(r.flags&1024&&(m=r.length,m>l&&(m=l),m&&(r.head&&(C=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+m),C)),r.flags&512&&r.wrap&4&&(r.check=qi(r.check,n,m,o)),l-=m,o+=m,r.length-=m),r.length))break e;r.length=0,r.mode=N9;case N9:if(r.flags&2048){if(l===0)break e;m=0;do C=n[o+m++],r.head&&C&&r.length<65536&&(r.head.name+=String.fromCharCode(C));while(C&&m<l);if(r.flags&512&&r.wrap&4&&(r.check=qi(r.check,n,m,o)),l-=m,o+=m,C)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=S9;case S9:if(r.flags&4096){if(l===0)break e;m=0;do C=n[o+m++],r.head&&C&&r.length<65536&&(r.head.comment+=String.fromCharCode(C));while(C&&m<l);if(r.flags&512&&r.wrap&4&&(r.check=qi(r.check,n,m,o)),l-=m,o+=m,C)break e}else r.head&&(r.head.comment=null);r.mode=C9;case C9:if(r.flags&512){for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&4&&d!==(r.check&65535)){e.msg="header crc mismatch",r.mode=So;break}d=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Yf;break;case A9:for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}e.adler=r.check=B9(d),d=0,u=0,r.mode=JS;case JS:if(r.havedict===0)return e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,NJe;e.adler=r.check=1,r.mode=Yf;case Yf:if(t===_Je||t===V_)break e;case JE:if(r.last){d>>>=u&7,u-=u&7,r.mode=ZE;break}for(;u<3;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}switch(r.last=d&1,d>>>=1,u-=1,d&3){case 0:r.mode=P9;break;case 1:if(OJe(r),r.mode=W_,t===V_){d>>>=2,u-=2;break e}break;case 2:r.mode=k9;break;case 3:e.msg="invalid block type",r.mode=So}d>>>=2,u-=2;break;case P9:for(d>>>=u&7,u-=u&7;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if((d&65535)!==(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=So;break}if(r.length=d&65535,d=0,u=0,r.mode=QE,t===V_)break e;case QE:r.mode=E9;case E9:if(m=r.length,m){if(m>l&&(m=l),m>c&&(m=c),m===0)break e;s.set(n.subarray(o,o+m),i),l-=m,o+=m,c-=m,i+=m,r.length-=m;break}r.mode=Yf;break;case k9:for(;u<14;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.nlen=(d&31)+257,d>>>=5,u-=5,r.ndist=(d&31)+1,d>>>=5,u-=5,r.ncode=(d&15)+4,d>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=So;break}r.have=0,r.mode=I9;case I9:for(;r.have<r.ncode;){for(;u<3;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.lens[I[r.have++]]=d&7,d>>>=3,u-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,F={bits:r.lenbits},A=tw(wJe,r.lens,0,19,r.lencode,0,r.work,F),r.lenbits=F.bits,A){e.msg="invalid code lengths set",r.mode=So;break}r.have=0,r.mode=O9;case O9:for(;r.have<r.nlen+r.ndist;){for(;y=r.lencode[d&(1<<r.lenbits)-1],v=y>>>24,b=y>>>16&255,w=y&65535,!(v<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(w<16)d>>>=v,u-=v,r.lens[r.have++]=w;else{if(w===16){for(O=v+2;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(d>>>=v,u-=v,r.have===0){e.msg="invalid bit length repeat",r.mode=So;break}C=r.lens[r.have-1],m=3+(d&3),d>>>=2,u-=2}else if(w===17){for(O=v+3;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=v,u-=v,C=0,m=3+(d&7),d>>>=3,u-=3}else{for(O=v+7;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=v,u-=v,C=0,m=11+(d&127),d>>>=7,u-=7}if(r.have+m>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=So;break}for(;m--;)r.lens[r.have++]=C}}if(r.mode===So)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=So;break}if(r.lenbits=9,F={bits:r.lenbits},A=tw(cae,r.lens,0,r.nlen,r.lencode,0,r.work,F),r.lenbits=F.bits,A){e.msg="invalid literal/lengths set",r.mode=So;break}if(r.distbits=6,r.distcode=r.distdyn,F={bits:r.distbits},A=tw(dae,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,F),r.distbits=F.bits,A){e.msg="invalid distances set",r.mode=So;break}if(r.mode=W_,t===V_)break e;case W_:r.mode=H_;case H_:if(l>=6&&c>=258){e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,pJe(e,h),i=e.next_out,s=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,u=r.bits,r.mode===Yf&&(r.back=-1);break}for(r.back=0;y=r.lencode[d&(1<<r.lenbits)-1],v=y>>>24,b=y>>>16&255,w=y&65535,!(v<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(b&&!(b&240)){for(_=v,j=b,S=w;y=r.lencode[S+((d&(1<<_+j)-1)>>_)],v=y>>>24,b=y>>>16&255,w=y&65535,!(_+v<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=_,u-=_,r.back+=_}if(d>>>=v,u-=v,r.back+=v,r.length=w,b===0){r.mode=F9;break}if(b&32){r.back=-1,r.mode=Yf;break}if(b&64){e.msg="invalid literal/length code",r.mode=So;break}r.extra=b&15,r.mode=T9;case T9:if(r.extra){for(O=r.extra;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=D9;case D9:for(;y=r.distcode[d&(1<<r.distbits)-1],v=y>>>24,b=y>>>16&255,w=y&65535,!(v<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(!(b&240)){for(_=v,j=b,S=w;y=r.distcode[S+((d&(1<<_+j)-1)>>_)],v=y>>>24,b=y>>>16&255,w=y&65535,!(_+v<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=_,u-=_,r.back+=_}if(d>>>=v,u-=v,r.back+=v,b&64){e.msg="invalid distance code",r.mode=So;break}r.offset=w,r.extra=b&15,r.mode=M9;case M9:if(r.extra){for(O=r.extra;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=So;break}r.mode=R9;case R9:if(c===0)break e;if(m=h-c,r.offset>m){if(m=r.offset-m,m>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=So;break}m>r.wnext?(m-=r.wnext,x=r.wsize-m):x=r.wnext-m,m>r.length&&(m=r.length),g=r.window}else g=s,x=i-r.offset,m=r.length;m>c&&(m=c),c-=m,r.length-=m;do s[i++]=g[x++];while(--m);r.length===0&&(r.mode=H_);break;case F9:if(c===0)break e;s[i++]=r.length,c--,r.mode=H_;break;case ZE:if(r.wrap){for(;u<32;){if(l===0)break e;l--,d|=n[o++]<<u,u+=8}if(h-=c,e.total_out+=h,r.total+=h,r.wrap&4&&h&&(e.adler=r.check=r.flags?qi(r.check,s,h,i-h):P1(r.check,s,h,i-h)),h=c,r.wrap&4&&(r.flags?d:B9(d))!==r.check){e.msg="incorrect data check",r.mode=So;break}d=0,u=0}r.mode=L9;case L9:if(r.wrap&&r.flags){for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&4&&d!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=So;break}d=0,u=0}r.mode=$9;case $9:A=jJe;break e;case So:A=uae;break e;case mae:return fae;case hae:default:return lu}return e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,(r.wsize||h!==e.avail_out&&r.mode<So&&(r.mode<ZE||t!==x9))&&yae(e,e.output,e.next_out,h-e.avail_out),f-=e.avail_in,h-=e.avail_out,e.total_in+=f,e.total_out+=h,r.total+=h,r.wrap&4&&h&&(e.adler=r.check=r.flags?qi(r.check,s,h,e.next_out-h):P1(r.check,s,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Yf?128:0)+(r.mode===W_||r.mode===QE?256:0),(f===0&&h===0||t===x9)&&A===rx&&(A=SJe),A},DJe=e=>{if(yx(e))return lu;let t=e.state;return t.window&&(t.window=null),e.state=null,rx},MJe=(e,t)=>{if(yx(e))return lu;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,rx):lu},RJe=(e,t)=>{const r=t.length;let n,s,o;return yx(e)||(n=e.state,n.wrap!==0&&n.mode!==JS)?lu:n.mode===JS&&(s=1,s=P1(s,t,r,0),s!==n.check)?uae:(o=yae(e,t,r,r),o?(n.mode=mae,fae):(n.havedict=1,rx))};var FJe=gae,LJe=xae,$Je=pae,BJe=IJe,qJe=vae,zJe=TJe,UJe=DJe,VJe=MJe,WJe=RJe,HJe="pako inflate (from Nodeca project)",om={inflateReset:FJe,inflateReset2:LJe,inflateResetKeep:$Je,inflateInit:BJe,inflateInit2:qJe,inflate:zJe,inflateEnd:UJe,inflateGetHeader:VJe,inflateSetDictionary:WJe,inflateInfo:HJe};function GJe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var KJe=GJe;const bae=Object.prototype.toString,{Z_NO_FLUSH:XJe,Z_FINISH:YJe,Z_OK:I1,Z_STREAM_END:rk,Z_NEED_DICT:nk,Z_STREAM_ERROR:JJe,Z_DATA_ERROR:z9,Z_MEM_ERROR:QJe}=x2;function y2(e){this.options=pA.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iae,this.strm.avail_out=0;let r=om.inflateInit2(this.strm,t.windowBits);if(r!==I1)throw new Error(D0[r]);if(this.header=new KJe,om.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=k1.string2buf(t.dictionary):bae.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=om.inflateSetDictionary(this.strm,t.dictionary),r!==I1)))throw new Error(D0[r])}y2.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let o,i,l;if(this.ended)return!1;for(t===~~t?i=t:i=t===!0?YJe:XJe,bae.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=om.inflate(r,i),o===nk&&s&&(o=om.inflateSetDictionary(r,s),o===I1?o=om.inflate(r,i):o===z9&&(o=nk));r.avail_in>0&&o===rk&&r.state.wrap>0&&e[r.next_in]!==0;)om.inflateReset(r),o=om.inflate(r,i);switch(o){case JJe:case z9:case nk:case QJe:return this.onEnd(o),this.ended=!0,!1}if(l=r.avail_out,r.next_out&&(r.avail_out===0||o===rk))if(this.options.to==="string"){let c=k1.utf8border(r.output,r.next_out),d=r.next_out-c,u=k1.buf2string(r.output,c);r.next_out=d,r.avail_out=n-d,d&&r.output.set(r.output.subarray(c,c+d),0),this.onData(u)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===I1&&l===0)){if(o===rk)return o=om.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};y2.prototype.onData=function(e){this.chunks.push(e)};y2.prototype.onEnd=function(e){e===I1&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=pA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function zR(e,t){const r=new y2(t);if(r.push(e),r.err)throw r.msg||D0[r.err];return r.result}function ZJe(e,t){return t=t||{},t.raw=!0,zR(e,t)}var eQe=y2,tQe=zR,rQe=ZJe,nQe=zR,aQe=x2,sQe={Inflate:eQe,inflate:tQe,inflateRaw:rQe,ungzip:nQe,constants:aQe};const{Inflate:oQe,inflate:iQe,inflateRaw:wct,ungzip:_ct}=sQe;var U9=oQe,lQe=iQe;const wae=[];for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;wae[e]=t}const V9=4294967295;function cQe(e,t,r){let n=e;for(let s=0;s<r;s++)n=wae[(n^t[s])&255]^n>>>8;return n}function dQe(e,t){return(cQe(V9,e,t)^V9)>>>0}function W9(e,t,r){const n=e.readUint32(),s=dQe(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(s!==n)throw new Error(`CRC mismatch for chunk ${r}. Expected ${n}, found ${s}`)}function _ae(e,t,r){for(let n=0;n<r;n++)t[n]=e[n]}function jae(e,t,r,n){let s=0;for(;s<n;s++)t[s]=e[s];for(;s<r;s++)t[s]=e[s]+t[s-n]&255}function Nae(e,t,r,n){let s=0;if(r.length===0)for(;s<n;s++)t[s]=e[s];else for(;s<n;s++)t[s]=e[s]+r[s]&255}function Sae(e,t,r,n,s){let o=0;if(r.length===0){for(;o<s;o++)t[o]=e[o];for(;o<n;o++)t[o]=e[o]+(t[o-s]>>1)&255}else{for(;o<s;o++)t[o]=e[o]+(r[o]>>1)&255;for(;o<n;o++)t[o]=e[o]+(t[o-s]+r[o]>>1)&255}}function Cae(e,t,r,n,s){let o=0;if(r.length===0){for(;o<s;o++)t[o]=e[o];for(;o<n;o++)t[o]=e[o]+t[o-s]&255}else{for(;o<s;o++)t[o]=e[o]+r[o]&255;for(;o<n;o++)t[o]=e[o]+uQe(t[o-s],r[o],r[o-s])&255}}function uQe(e,t,r){const n=e+t-r,s=Math.abs(n-e),o=Math.abs(n-t),i=Math.abs(n-r);return s<=o&&s<=i?e:o<=i?t:r}function fQe(e,t,r,n,s,o){switch(e){case 0:_ae(t,r,s);break;case 1:jae(t,r,s,o);break;case 2:Nae(t,r,n,s);break;case 3:Sae(t,r,n,s,o);break;case 4:Cae(t,r,n,s,o);break;default:throw new Error(`Unsupported filter: ${e}`)}}const mQe=new Uint16Array([255]),hQe=new Uint8Array(mQe.buffer),pQe=hQe[0]===255;function gQe(e){const{data:t,width:r,height:n,channels:s,depth:o}=e,i=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(o/8)*s,c=new Uint8Array(n*r*l);let d=0;for(let u=0;u<7;u++){const f=i[u],h=Math.ceil((r-f.x)/f.xStep),m=Math.ceil((n-f.y)/f.yStep);if(h<=0||m<=0)continue;const x=h*l,g=new Uint8Array(x);for(let y=0;y<m;y++){const v=t[d++],b=t.subarray(d,d+x);d+=x;const w=new Uint8Array(x);fQe(v,b,w,g,x,l),g.set(w);for(let _=0;_<h;_++){const j=f.x+_*f.xStep,S=f.y+y*f.yStep;if(!(j>=r||S>=n))for(let C=0;C<l;C++)c[(S*r+j)*l+C]=w[_*l+C]}}}if(o===16){const u=new Uint16Array(c.buffer);if(pQe)for(let f=0;f<u.length;f++)u[f]=xQe(u[f]);return u}else return c}function xQe(e){return(e&255)<<8|e>>8&255}const vQe=new Uint16Array([255]),yQe=new Uint8Array(vQe.buffer),bQe=yQe[0]===255,wQe=new Uint8Array(0);function H9(e){const{data:t,width:r,height:n,channels:s,depth:o}=e,i=Math.ceil(o/8)*s,l=Math.ceil(o/8*s*r),c=new Uint8Array(n*l);let d=wQe,u=0,f,h;for(let m=0;m<n;m++){switch(f=t.subarray(u+1,u+1+l),h=c.subarray(m*l,(m+1)*l),t[u]){case 0:_ae(f,h,l);break;case 1:jae(f,h,l,i);break;case 2:Nae(f,h,d,l);break;case 3:Sae(f,h,d,l,i);break;case 4:Cae(f,h,d,l,i);break;default:throw new Error(`Unsupported filter: ${t[u]}`)}d=h,u+=l+1}if(o===16){const m=new Uint16Array(c.buffer);if(bQe)for(let x=0;x<m.length;x++)m[x]=_Qe(m[x]);return m}else return c}function _Qe(e){return(e&255)<<8|e>>8&255}const Mj=Uint8Array.of(137,80,78,71,13,10,26,10);function G9(e){if(!jQe(e.readBytes(Mj.length)))throw new Error("wrong PNG signature")}function jQe(e){if(e.length<Mj.length)return!1;for(let t=0;t<Mj.length;t++)if(e[t]!==Mj[t])return!1;return!0}const NQe="tEXt",SQe=0,Aae=new TextDecoder("latin1");function CQe(e){if(PQe(e),e.length===0||e.length>79)throw new Error("keyword length must be between 1 and 79")}const AQe=/^[\u0000-\u00FF]*$/;function PQe(e){if(!AQe.test(e))throw new Error("invalid latin1 text")}function EQe(e,t,r){const n=Pae(t);e[n]=kQe(t,r-n.length-1)}function Pae(e){for(e.mark();e.readByte()!==SQe;);const t=e.offset;e.reset();const r=Aae.decode(e.readBytes(t-e.offset-1));return e.skip(1),CQe(r),r}function kQe(e,t){return Aae.decode(e.readBytes(t))}const Gc={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},ak={UNKNOWN:-1,DEFLATE:0},K9={UNKNOWN:-1,ADAPTIVE:0},sk={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},G_={NONE:0,BACKGROUND:1,PREVIOUS:2},ok={SOURCE:0,OVER:1};class IQe extends MR{constructor(r,n={}){super(r);Fs(this,"_checkCrc");Fs(this,"_inflator");Fs(this,"_png");Fs(this,"_apng");Fs(this,"_end");Fs(this,"_hasPalette");Fs(this,"_palette");Fs(this,"_hasTransparency");Fs(this,"_transparency");Fs(this,"_compressionMethod");Fs(this,"_filterMethod");Fs(this,"_interlaceMethod");Fs(this,"_colorType");Fs(this,"_isAnimated");Fs(this,"_numberOfFrames");Fs(this,"_numberOfPlays");Fs(this,"_frames");Fs(this,"_writingDataChunks");const{checkCrc:s=!1}=n;this._checkCrc=s,this._inflator=new U9,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=ak.UNKNOWN,this._filterMethod=K9.UNKNOWN,this._interlaceMethod=sk.UNKNOWN,this._colorType=Gc.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(G9(this);!this._end;){const r=this.readUint32(),n=this.readChars(4);this.decodeChunk(r,n)}return this.decodeImage(),this._png}decodeApng(){for(G9(this);!this._end;){const r=this.readUint32(),n=this.readChars(4);this.decodeApngChunk(r,n)}return this.decodeApngImage(),this._apng}decodeChunk(r,n){const s=this.offset;switch(n){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(r);break;case"iCCP":this.decodeiCCP(r);break;case NQe:EQe(this._png.text,this,r);break;case"pHYs":this.decodepHYs();break;default:this.skip(r);break}if(this.offset-s!==r)throw new Error(`Length mismatch while decoding chunk ${n}`);this._checkCrc?W9(this,r+4,n):this.skip(4)}decodeApngChunk(r,n){const s=this.offset;switch(n!=="fdAT"&&n!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),n){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(r);break;default:this.decodeChunk(r,n),this.offset=s+r;break}if(this.offset-s!==r)throw new Error(`Length mismatch while decoding chunk ${n}`);this._checkCrc?W9(this,r+4,n):this.skip(4)}decodeIHDR(){const r=this._png;r.width=this.readUint32(),r.height=this.readUint32(),r.depth=OQe(this.readUint8());const n=this.readUint8();this._colorType=n;let s;switch(n){case Gc.GREYSCALE:s=1;break;case Gc.TRUECOLOUR:s=3;break;case Gc.INDEXED_COLOUR:s=1;break;case Gc.GREYSCALE_ALPHA:s=2;break;case Gc.TRUECOLOUR_ALPHA:s=4;break;case Gc.UNKNOWN:default:throw new Error(`Unknown color type: ${n}`)}if(this._png.channels=s,this._compressionMethod=this.readUint8(),this._compressionMethod!==ak.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const r={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(r)}decodePLTE(r){if(r%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${r}`);const n=r/3;this._hasPalette=!0;const s=[];this._palette=s;for(let o=0;o<n;o++)s.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(r){this._writingDataChunks=!0;const n=r,s=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,s,n)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodeFDAT(r){this._writingDataChunks=!0;let n=r,s=this.offset+this.byteOffset;if(s+=4,n-=4,this._inflator.push(new Uint8Array(this.buffer,s,n)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodetRNS(r){switch(this._colorType){case Gc.GREYSCALE:case Gc.TRUECOLOUR:{if(r%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${r}`);if(r/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${r/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(r/2);for(let n=0;n<r/2;n++)this._transparency[n]=this.readUint16();break}case Gc.INDEXED_COLOUR:{if(r>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${r} vs ${this._palette.length})`);let n=0;for(;n<r;n++){const s=this.readByte();this._palette[n].push(s)}for(;n<this._palette.length;n++)this._palette[n].push(255);break}case Gc.UNKNOWN:case Gc.GREYSCALE_ALPHA:case Gc.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(r){const n=Pae(this),s=this.readUint8();if(s!==ak.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const o=this.readBytes(r-n.length-2);this._png.iccEmbeddedProfile={name:n,profile:lQe(o)}}decodepHYs(){const r=this.readUint32(),n=this.readUint32(),s=this.readByte();this._png.resolution={x:r,y:n,unit:s}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let r=0;r<this._numberOfFrames;r++){const n={sequenceNumber:this._frames[r].sequenceNumber,delayNumber:this._frames[r].delayNumber,delayDenominator:this._frames[r].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},s=this._frames.at(r);if(s){if(s.data=H9({data:s.data,width:s.width,height:s.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),r===0||s.xOffset===0&&s.yOffset===0&&s.width===this._png.width&&s.height===this._png.height)n.data=s.data;else{const o=this._apng.frames.at(r-1);this.disposeFrame(s,o,n),this.addFrameDataToCanvas(n,s)}this._apng.frames.push(n)}}return this._apng}disposeFrame(r,n,s){switch(r.disposeOp){case G_.NONE:break;case G_.BACKGROUND:for(let o=0;o<this._png.height;o++)for(let i=0;i<this._png.width;i++){const l=(o*r.width+i)*this._png.channels;for(let c=0;c<this._png.channels;c++)s.data[l+c]=0}break;case G_.PREVIOUS:s.data.set(n.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(r,n){const s=1<<this._png.depth,o=(i,l)=>{const c=((i+n.yOffset)*this._png.width+n.xOffset+l)*this._png.channels,d=(i*n.width+l)*this._png.channels;return{index:c,frameIndex:d}};switch(n.blendOp){case ok.SOURCE:for(let i=0;i<n.height;i++)for(let l=0;l<n.width;l++){const{index:c,frameIndex:d}=o(i,l);for(let u=0;u<this._png.channels;u++)r.data[c+u]=n.data[d+u]}break;case ok.OVER:for(let i=0;i<n.height;i++)for(let l=0;l<n.width;l++){const{index:c,frameIndex:d}=o(i,l);for(let u=0;u<this._png.channels;u++){const f=n.data[d+this._png.channels-1]/s,h=u%(this._png.channels-1)===0?1:n.data[d+u],m=Math.floor(f*h+(1-f)*r.data[c+u]);r.data[c+u]+=m}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const r=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==K9.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===sk.NO_INTERLACE)this._png.data=H9({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===sk.ADAM7)this._png.data=gQe({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const r=this._inflator.result,n=this._frames.at(-1);n?n.data=r:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:G_.NONE,blendOp:ok.SOURCE,data:r}),this._inflator=new U9,this._writingDataChunks=!1}}function OQe(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}var X9;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(X9||(X9={}));function TQe(e,t){return new IQe(e,t).decode()}var Ra=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function ik(){Ra.console&&typeof Ra.console.log=="function"&&Ra.console.log.apply(Ra.console,arguments)}var Qs={log:ik,warn:function(e){Ra.console&&(typeof Ra.console.warn=="function"?Ra.console.warn.apply(Ra.console,arguments):ik.call(null,arguments))},error:function(e){Ra.console&&(typeof Ra.console.error=="function"?Ra.console.error.apply(Ra.console,arguments):ik(e))}};function lk(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){eg(n.response,t,r)},n.onerror=function(){Qs.error("could not download file")},n.send()}function Y9(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function K_(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var eg=Ra.saveAs||((typeof window>"u"?"undefined":cs(window))!=="object"||window!==Ra?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=Ra.URL||Ra.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener",typeof e=="string"?(s.href=e,s.origin!==location.origin?Y9(s.href)?lk(e,t,r):K_(s,s.target="_blank"):K_(s)):(s.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(s.href)},4e4),setTimeout(function(){K_(s)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(Y9(e))lk(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){K_(n)})}else navigator.msSaveOrOpenBlob(function(s,o){return o===void 0?o={autoBom:!1}:cs(o)!=="object"&&(Qs.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob([String.fromCharCode(65279),s],{type:s.type}):s}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return lk(e,t,r);var s=e.type==="application/octet-stream",o=/constructor/i.test(Ra.HTMLElement)||Ra.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||s&&o)&&(typeof FileReader>"u"?"undefined":cs(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var u=l.result;u=i?u:u.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=u:location=u,n=null},l.readAsDataURL(e)}else{var c=Ra.URL||Ra.webkitURL,d=c.createObjectURL(e);n?n.location=d:location.href=d,n=null,setTimeout(function(){c.revokeObjectURL(d)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Eae(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<r.length;n++){var s=r[n].re,o=r[n].process,i=s.exec(e);i&&(t=o(i),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),d=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),d.length==1&&(d="0"+d),"#"+l+c+d}}var Rj=Ra.atob.bind(Ra),J9=Ra.btoa.bind(Ra);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function ck(e,t){var r=e[0],n=e[1],s=e[2],o=e[3];r=Nl(r,n,s,o,t[0],7,-680876936),o=Nl(o,r,n,s,t[1],12,-389564586),s=Nl(s,o,r,n,t[2],17,606105819),n=Nl(n,s,o,r,t[3],22,-1044525330),r=Nl(r,n,s,o,t[4],7,-176418897),o=Nl(o,r,n,s,t[5],12,1200080426),s=Nl(s,o,r,n,t[6],17,-1473231341),n=Nl(n,s,o,r,t[7],22,-45705983),r=Nl(r,n,s,o,t[8],7,1770035416),o=Nl(o,r,n,s,t[9],12,-1958414417),s=Nl(s,o,r,n,t[10],17,-42063),n=Nl(n,s,o,r,t[11],22,-1990404162),r=Nl(r,n,s,o,t[12],7,1804603682),o=Nl(o,r,n,s,t[13],12,-40341101),s=Nl(s,o,r,n,t[14],17,-1502002290),r=Sl(r,n=Nl(n,s,o,r,t[15],22,1236535329),s,o,t[1],5,-165796510),o=Sl(o,r,n,s,t[6],9,-1069501632),s=Sl(s,o,r,n,t[11],14,643717713),n=Sl(n,s,o,r,t[0],20,-373897302),r=Sl(r,n,s,o,t[5],5,-701558691),o=Sl(o,r,n,s,t[10],9,38016083),s=Sl(s,o,r,n,t[15],14,-660478335),n=Sl(n,s,o,r,t[4],20,-405537848),r=Sl(r,n,s,o,t[9],5,568446438),o=Sl(o,r,n,s,t[14],9,-1019803690),s=Sl(s,o,r,n,t[3],14,-187363961),n=Sl(n,s,o,r,t[8],20,1163531501),r=Sl(r,n,s,o,t[13],5,-1444681467),o=Sl(o,r,n,s,t[2],9,-51403784),s=Sl(s,o,r,n,t[7],14,1735328473),r=Cl(r,n=Sl(n,s,o,r,t[12],20,-1926607734),s,o,t[5],4,-378558),o=Cl(o,r,n,s,t[8],11,-2022574463),s=Cl(s,o,r,n,t[11],16,1839030562),n=Cl(n,s,o,r,t[14],23,-35309556),r=Cl(r,n,s,o,t[1],4,-1530992060),o=Cl(o,r,n,s,t[4],11,1272893353),s=Cl(s,o,r,n,t[7],16,-155497632),n=Cl(n,s,o,r,t[10],23,-1094730640),r=Cl(r,n,s,o,t[13],4,681279174),o=Cl(o,r,n,s,t[0],11,-358537222),s=Cl(s,o,r,n,t[3],16,-722521979),n=Cl(n,s,o,r,t[6],23,76029189),r=Cl(r,n,s,o,t[9],4,-640364487),o=Cl(o,r,n,s,t[12],11,-421815835),s=Cl(s,o,r,n,t[15],16,530742520),r=Al(r,n=Cl(n,s,o,r,t[2],23,-995338651),s,o,t[0],6,-198630844),o=Al(o,r,n,s,t[7],10,1126891415),s=Al(s,o,r,n,t[14],15,-1416354905),n=Al(n,s,o,r,t[5],21,-57434055),r=Al(r,n,s,o,t[12],6,1700485571),o=Al(o,r,n,s,t[3],10,-1894986606),s=Al(s,o,r,n,t[10],15,-1051523),n=Al(n,s,o,r,t[1],21,-2054922799),r=Al(r,n,s,o,t[8],6,1873313359),o=Al(o,r,n,s,t[15],10,-30611744),s=Al(s,o,r,n,t[6],15,-1560198380),n=Al(n,s,o,r,t[13],21,1309151649),r=Al(r,n,s,o,t[4],6,-145523070),o=Al(o,r,n,s,t[11],10,-1120210379),s=Al(s,o,r,n,t[2],15,718787259),n=Al(n,s,o,r,t[9],21,-343485551),e[0]=Ih(r,e[0]),e[1]=Ih(n,e[1]),e[2]=Ih(s,e[2]),e[3]=Ih(o,e[3])}function xA(e,t,r,n,s,o){return t=Ih(Ih(t,e),Ih(n,o)),Ih(t<<s|t>>>32-s,r)}function Nl(e,t,r,n,s,o,i){return xA(t&r|~t&n,e,t,s,o,i)}function Sl(e,t,r,n,s,o,i){return xA(t&n|r&~n,e,t,s,o,i)}function Cl(e,t,r,n,s,o,i){return xA(t^r^n,e,t,s,o,i)}function Al(e,t,r,n,s,o,i){return xA(r^(t|~n),e,t,s,o,i)}function kae(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)ck(n,DQe(e.substring(t-64,t)));e=e.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(ck(n,s),t=0;t<16;t++)s[t]=0;return s[14]=8*r,ck(n,s),n}function DQe(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}var Q9="0123456789abcdef".split("");function MQe(e){for(var t="",r=0;r<4;r++)t+=Q9[e>>8*r+4&15]+Q9[e>>8*r&15];return t}function RQe(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function A3(e){return kae(e).map(RQe).join("")}var FQe=function(e){for(var t=0;t<e.length;t++)e[t]=MQe(e[t]);return e.join("")}(kae("hello"))!="5d41402abc4b2a76b9719d911017c592";function Ih(e,t){if(FQe){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function P3(e,t){var r,n,s,o;if(e!==r){for(var i=(s=e,o=1+(256/e.length|0),new Array(o+1).join(s)),l=[],c=0;c<256;c++)l[c]=c;var d=0;for(c=0;c<256;c++){var u=l[c];d=(d+u+i.charCodeAt(c))%256,l[c]=l[d],l[d]=u}r=e,n=l}else l=n;var f=t.length,h=0,m=0,x="";for(c=0;c<f;c++)m=(m+(u=l[h=(h+1)%256]))%256,l[h]=l[m],l[m]=u,i=l[(l[h]+l[m])%256],x+=String.fromCharCode(t.charCodeAt(c)^i);return x}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var Z9={print:4,modify:8,copy:16,"annot-forms":32};function Zx(e,t,r,n){this.v=1,this.r=2;var s=192;e.forEach(function(l){if(Z9.perm!==void 0)throw new Error("Invalid permission: "+l);s+=Z9[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(t+this.padding).substr(0,32),i=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,i),this.P=-(1+(255^s)),this.encryptionKey=A3(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=P3(this.encryptionKey,this.padding)}function ev(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var s=e.charCodeAt(n);t+=s<33||s===35||s===37||s===40||s===41||s===47||s===60||s===62||s===91||s===93||s===123||s===125||s>126?"#"+("0"+s.toString(16)).slice(-2):e[n]}return t}function eU(e){if(cs(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,n,s){if(s=s||!1,typeof r!="string"||typeof n!="function"||typeof s!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var o=Math.random().toString(35);return t[r][o]=[n,!!s],o},this.unsubscribe=function(r){for(var n in t)if(t[n][r])return delete t[n][r],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),s=[];for(var o in t[r]){var i=t[r][o];try{i[0].apply(e,n)}catch(l){Ra.console&&Qs.error("jsPDF PubSub Error",l.message,l)}i[1]&&s.push(o)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function O1(e){if(!(this instanceof O1))return new O1(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function Iae(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function bh(e,t,r,n,s){if(!(this instanceof bh))return new bh(e,t,r,n,s);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,Iae.call(this,n,s)}function bg(e,t,r,n,s){if(!(this instanceof bg))return new bg(e,t,r,n,s);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,Iae.call(this,n,s)}function da(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],s=arguments[2],o=arguments[3],i=[],l=1,c=16,d="S",u=null;cs(e=e||{})==="object"&&(r=e.orientation,n=e.unit||n,s=e.format||s,o=e.compress||e.compressPdf||o,(u=e.encryption||null)!==null&&(u.userPassword=u.userPassword||"",u.ownerPassword=u.ownerPassword||"",u.userPermissions=u.userPermissions||[]),l=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(c=e.floatPrecision),d=e.defaultPathOperation||"S"),i=e.filters||(o===!0?["FlateEncode"]:i),n=n||"mm",r=(""+(r||"P")).toLowerCase();var f=e.putOnlyUsedFonts||!1,h={},m={internal:{},__private__:{}};m.__private__.PubSub=eU;var x="1.3",g=m.__private__.getPdfVersion=function(){return x};m.__private__.setPdfVersion=function(R){x=R};var y={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};m.__private__.getPageFormats=function(){return y};var v=m.__private__.getPageFormat=function(R){return y[R]};s=s||"a4";var b="compat",w="advanced",_=b;function j(){this.saveGraphicsState(),ie(new ze($t,0,0,-$t,0,Xo()*$t).toString()+" cm"),this.setFontSize(this.getFontSize()/$t),d="n",_=w}function S(){this.restoreGraphicsState(),d="S",_=b}var C=m.__private__.combineFontStyleAndFontWeight=function(R,pe){if(R=="bold"&&pe=="normal"||R=="bold"&&pe==400||R=="normal"&&pe=="italic"||R=="bold"&&pe=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return pe&&(R=pe==400||pe==="normal"?R==="italic"?"italic":"normal":pe!=700&&pe!=="bold"||R!=="normal"?(pe==700?"bold":pe)+""+R:"bold"),R};m.advancedAPI=function(R){var pe=_===b;return pe&&j.call(this),typeof R!="function"||(R(this),pe&&S.call(this)),this},m.compatAPI=function(R){var pe=_===w;return pe&&S.call(this),typeof R!="function"||(R(this),pe&&j.call(this)),this},m.isAdvancedAPI=function(){return _===w};var A,P=function(R){if(_!==w)throw new Error(R+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},F=m.roundToPrecision=m.__private__.roundToPrecision=function(R,pe){var He=t||pe;if(isNaN(R)||isNaN(He))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return R.toFixed(He).replace(/0+$/,"")};A=m.hpf=m.__private__.hpf=typeof c=="number"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return F(R,c)}:c==="smart"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return F(R,R>-1&&R<1?16:5)}:function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return F(R,16)};var O=m.f2=m.__private__.f2=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f2");return F(R,2)},I=m.__private__.f3=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f3");return F(R,3)},T=m.scale=m.__private__.scale=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.scale");return _===b?R*$t:_===w?R:void 0},k=function(R){return T(function(pe){return _===b?Xo()-pe:_===w?pe:void 0}(R))};m.__private__.setPrecision=m.setPrecision=function(R){typeof parseInt(R,10)=="number"&&(t=parseInt(R,10))};var B,z="00000000000000000000000000000000",U=m.__private__.getFileId=function(){return z},L=m.__private__.setFileId=function(R){return z=R!==void 0&&/^[a-fA-F0-9]{32}$/.test(R)?R.toUpperCase():z.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),u!==null&&(Se=new Zx(u.userPermissions,u.userPassword,u.ownerPassword,z)),z};m.setFileId=function(R){return L(R),this},m.getFileId=function(){return U()};var W=m.__private__.convertDateToPDFDate=function(R){var pe=R.getTimezoneOffset(),He=pe<0?"+":"-",mt=Math.floor(Math.abs(pe/60)),zt=Math.abs(pe%60),Dr=[He,Y(mt),"'",Y(zt),"'"].join("");return["D:",R.getFullYear(),Y(R.getMonth()+1),Y(R.getDate()),Y(R.getHours()),Y(R.getMinutes()),Y(R.getSeconds()),Dr].join("")},ge=m.__private__.convertPDFDateToDate=function(R){var pe=parseInt(R.substr(2,4),10),He=parseInt(R.substr(6,2),10)-1,mt=parseInt(R.substr(8,2),10),zt=parseInt(R.substr(10,2),10),Dr=parseInt(R.substr(12,2),10),Qr=parseInt(R.substr(14,2),10);return new Date(pe,He,mt,zt,Dr,Qr,0)},Ae=m.__private__.setCreationDate=function(R){var pe;if(R===void 0&&(R=new Date),R instanceof Date)pe=W(R);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(R))throw new Error("Invalid argument passed to jsPDF.setCreationDate");pe=R}return B=pe},V=m.__private__.getCreationDate=function(R){var pe=B;return R==="jsDate"&&(pe=ge(B)),pe};m.setCreationDate=function(R){return Ae(R),this},m.getCreationDate=function(R){return V(R)};var $,Y=m.__private__.padd2=function(R){return("0"+parseInt(R)).slice(-2)},he=m.__private__.padd2Hex=function(R){return("00"+(R=R.toString())).substr(R.length)},J=0,G=[],ue=[],ve=0,ae=[],oe=[],me=!1,De=ue;m.__private__.setCustomOutputDestination=function(R){me=!0,De=R};var ne=function(R){me||(De=R)};m.__private__.resetCustomOutputDestination=function(){me=!1,De=ue};var ie=m.__private__.out=function(R){return R=R.toString(),ve+=R.length+1,De.push(R),De},ht=m.__private__.write=function(R){return ie(arguments.length===1?R.toString():Array.prototype.join.call(arguments," "))},pt=m.__private__.getArrayBuffer=function(R){for(var pe=R.length,He=new ArrayBuffer(pe),mt=new Uint8Array(He);pe--;)mt[pe]=R.charCodeAt(pe);return He},Ze=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];m.__private__.getStandardFonts=function(){return Ze};var vt=e.fontSize||16;m.__private__.setFontSize=m.setFontSize=function(R){return vt=_===w?R/$t:R,this};var wt,gt=m.__private__.getFontSize=m.getFontSize=function(){return _===b?vt:vt*$t},er=e.R2L||!1;m.__private__.setR2L=m.setR2L=function(R){return er=R,this},m.__private__.getR2L=m.getR2L=function(){return er};var _e,Pt=m.__private__.setZoomMode=function(R){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(R))wt=R;else if(isNaN(R)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(R)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+R+'" is not recognized.');wt=R}else wt=parseInt(R,10)};m.__private__.getZoomMode=function(){return wt};var Lt,gr=m.__private__.setPageMode=function(R){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(R)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+R+'" is not recognized.');_e=R};m.__private__.getPageMode=function(){return _e};var fr=m.__private__.setLayoutMode=function(R){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(R)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+R+'" is not recognized.');Lt=R};m.__private__.getLayoutMode=function(){return Lt},m.__private__.setDisplayMode=m.setDisplayMode=function(R,pe,He){return Pt(R),fr(pe),gr(He),this};var je={title:"",subject:"",author:"",keywords:"",creator:""};m.__private__.getDocumentProperty=function(R){if(Object.keys(je).indexOf(R)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return je[R]},m.__private__.getDocumentProperties=function(){return je},m.__private__.setDocumentProperties=m.setProperties=m.setDocumentProperties=function(R){for(var pe in je)je.hasOwnProperty(pe)&&R[pe]&&(je[pe]=R[pe]);return this},m.__private__.setDocumentProperty=function(R,pe){if(Object.keys(je).indexOf(R)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return je[R]=pe};var nt,$t,Ut,Fe,xt,Ot={},Cr={},Me=[],Qe={},et={},Yt={},xr={},Jt=null,kr=0,_r=[],Rr=new eU(m),nn=e.hotfixes||[],rn={},Ke={},qe=[],ze=function R(pe,He,mt,zt,Dr,Qr){if(!(this instanceof R))return new R(pe,He,mt,zt,Dr,Qr);isNaN(pe)&&(pe=1),isNaN(He)&&(He=0),isNaN(mt)&&(mt=0),isNaN(zt)&&(zt=1),isNaN(Dr)&&(Dr=0),isNaN(Qr)&&(Qr=0),this._matrix=[pe,He,mt,zt,Dr,Qr]};Object.defineProperty(ze.prototype,"sx",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(ze.prototype,"shy",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(ze.prototype,"shx",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(ze.prototype,"sy",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(ze.prototype,"tx",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(ze.prototype,"ty",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(ze.prototype,"a",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(ze.prototype,"b",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(ze.prototype,"c",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(ze.prototype,"d",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(ze.prototype,"e",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(ze.prototype,"f",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(ze.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(ze.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(ze.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(ze.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),ze.prototype.join=function(R){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(A).join(R)},ze.prototype.multiply=function(R){var pe=R.sx*this.sx+R.shy*this.shx,He=R.sx*this.shy+R.shy*this.sy,mt=R.shx*this.sx+R.sy*this.shx,zt=R.shx*this.shy+R.sy*this.sy,Dr=R.tx*this.sx+R.ty*this.shx+this.tx,Qr=R.tx*this.shy+R.ty*this.sy+this.ty;return new ze(pe,He,mt,zt,Dr,Qr)},ze.prototype.decompose=function(){var R=this.sx,pe=this.shy,He=this.shx,mt=this.sy,zt=this.tx,Dr=this.ty,Qr=Math.sqrt(R*R+pe*pe),de=(R/=Qr)*He+(pe/=Qr)*mt;He-=R*de,mt-=pe*de;var ke=Math.sqrt(He*He+mt*mt);return de/=ke,R*(mt/=ke)<pe*(He/=ke)&&(R=-R,pe=-pe,de=-de,Qr=-Qr),{scale:new ze(Qr,0,0,ke,0,0),translate:new ze(1,0,0,1,zt,Dr),rotate:new ze(R,pe,-pe,R,0,0),skew:new ze(1,0,de,1,0,0)}},ze.prototype.toString=function(R){return this.join(" ")},ze.prototype.inversed=function(){var R=this.sx,pe=this.shy,He=this.shx,mt=this.sy,zt=this.tx,Dr=this.ty,Qr=1/(R*mt-pe*He),de=mt*Qr,ke=-pe*Qr,st=-He*Qr,ot=R*Qr;return new ze(de,ke,st,ot,-de*zt-st*Dr,-ke*zt-ot*Dr)},ze.prototype.applyToPoint=function(R){var pe=R.x*this.sx+R.y*this.shx+this.tx,He=R.x*this.shy+R.y*this.sy+this.ty;return new _o(pe,He)},ze.prototype.applyToRectangle=function(R){var pe=this.applyToPoint(R),He=this.applyToPoint(new _o(R.x+R.w,R.y+R.h));return new $c(pe.x,pe.y,He.x-pe.x,He.y-pe.y)},ze.prototype.clone=function(){var R=this.sx,pe=this.shy,He=this.shx,mt=this.sy,zt=this.tx,Dr=this.ty;return new ze(R,pe,He,mt,zt,Dr)},m.Matrix=ze;var Je=m.matrixMult=function(R,pe){return pe.multiply(R)},kt=new ze(1,0,0,1,0,0);m.unitMatrix=m.identityMatrix=kt;var ct=function(R,pe){if(!et[R]){var He=(pe instanceof bh?"Sh":"P")+(Object.keys(Qe).length+1).toString(10);pe.id=He,et[R]=He,Qe[He]=pe,Rr.publish("addPattern",pe)}};m.ShadingPattern=bh,m.TilingPattern=bg,m.addShadingPattern=function(R,pe){return P("addShadingPattern()"),ct(R,pe),this},m.beginTilingPattern=function(R){P("beginTilingPattern()"),_i(R.boundingBox[0],R.boundingBox[1],R.boundingBox[2]-R.boundingBox[0],R.boundingBox[3]-R.boundingBox[1],R.matrix)},m.endTilingPattern=function(R,pe){P("endTilingPattern()"),pe.stream=oe[$].join(`
`),ct(R,pe),Rr.publish("endTilingPattern",pe),qe.pop().restore()};var tr,dt=m.__private__.newObject=function(){var R=Mt();return ce(R,!0),R},Mt=m.__private__.newObjectDeferred=function(){return J++,G[J]=function(){return ve},J},ce=function(R,pe){return pe=typeof pe=="boolean"&&pe,G[R]=ve,pe&&ie(R+" 0 obj"),R},Xe=m.__private__.newAdditionalObject=function(){var R={objId:Mt(),content:""};return ae.push(R),R},Qt=Mt(),Tt=Mt(),Ar=m.__private__.decodeColorString=function(R){var pe=R.split(" ");if(pe.length!==2||pe[1]!=="g"&&pe[1]!=="G")pe.length!==5||pe[4]!=="k"&&pe[4]!=="K"||(pe=[(1-pe[0])*(1-pe[3]),(1-pe[1])*(1-pe[3]),(1-pe[2])*(1-pe[3]),"r"]);else{var He=parseFloat(pe[0]);pe=[He,He,He,"r"]}for(var mt="#",zt=0;zt<3;zt++)mt+=("0"+Math.floor(255*parseFloat(pe[zt])).toString(16)).slice(-2);return mt},nr=m.__private__.encodeColorString=function(R){var pe;typeof R=="string"&&(R={ch1:R});var He=R.ch1,mt=R.ch2,zt=R.ch3,Dr=R.ch4,Qr=R.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof He=="string"&&He.charAt(0)!=="#"){var de=new Eae(He);if(de.ok)He=de.toHex();else if(!/^\d*\.?\d*$/.test(He))throw new Error('Invalid color "'+He+'" passed to jsPDF.encodeColorString.')}if(typeof He=="string"&&/^#[0-9A-Fa-f]{3}$/.test(He)&&(He="#"+He[1]+He[1]+He[2]+He[2]+He[3]+He[3]),typeof He=="string"&&/^#[0-9A-Fa-f]{6}$/.test(He)){var ke=parseInt(He.substr(1),16);He=ke>>16&255,mt=ke>>8&255,zt=255&ke}if(mt===void 0||Dr===void 0&&He===mt&&mt===zt)pe=typeof He=="string"?He+" "+Qr[0]:R.precision===2?O(He/255)+" "+Qr[0]:I(He/255)+" "+Qr[0];else if(Dr===void 0||cs(Dr)==="object"){if(Dr&&!isNaN(Dr.a)&&Dr.a===0)return["1.","1.","1.",Qr[1]].join(" ");pe=typeof He=="string"?[He,mt,zt,Qr[1]].join(" "):R.precision===2?[O(He/255),O(mt/255),O(zt/255),Qr[1]].join(" "):[I(He/255),I(mt/255),I(zt/255),Qr[1]].join(" ")}else pe=typeof He=="string"?[He,mt,zt,Dr,Qr[2]].join(" "):R.precision===2?[O(He),O(mt),O(zt),O(Dr),Qr[2]].join(" "):[I(He),I(mt),I(zt),I(Dr),Qr[2]].join(" ");return pe},Jr=m.__private__.getFilters=function(){return i},gn=m.__private__.putStream=function(R){var pe=(R=R||{}).data||"",He=R.filters||Jr(),mt=R.alreadyAppliedFilters||[],zt=R.addLength1||!1,Dr=pe.length,Qr=R.objectId,de=function(yr){return yr};if(u!==null&&Qr===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");u!==null&&(de=Se.encryptor(Qr,0));var ke={};He===!0&&(He=["FlateEncode"]);var st=R.additionalKeyValues||[],ot=(ke=da.API.processDataByFilters!==void 0?da.API.processDataByFilters(pe,He):{data:pe,reverseChain:[]}).reverseChain+(Array.isArray(mt)?mt.join(" "):mt.toString());if(ke.data.length!==0&&(st.push({key:"Length",value:ke.data.length}),zt===!0&&st.push({key:"Length1",value:Dr})),ot.length!=0)if(ot.split("/").length-1==1)st.push({key:"Filter",value:ot});else{st.push({key:"Filter",value:"["+ot+"]"});for(var Nt=0;Nt<st.length;Nt+=1)if(st[Nt].key==="DecodeParms"){for(var or=[],Bt=0;Bt<ke.reverseChain.split("/").length-1;Bt+=1)or.push("null");or.push(st[Nt].value),st[Nt].value="["+or.join(" ")+"]"}}ie("<<");for(var vr=0;vr<st.length;vr++)ie("/"+st[vr].key+" "+st[vr].value);ie(">>"),ke.data.length!==0&&(ie("stream"),ie(de(ke.data)),ie("endstream"))},tt=m.__private__.putPage=function(R){var pe=R.number,He=R.data,mt=R.objId,zt=R.contentsObjId;ce(mt,!0),ie("<</Type /Page"),ie("/Parent "+R.rootDictionaryObjId+" 0 R"),ie("/Resources "+R.resourceDictionaryObjId+" 0 R"),ie("/MediaBox ["+parseFloat(A(R.mediaBox.bottomLeftX))+" "+parseFloat(A(R.mediaBox.bottomLeftY))+" "+A(R.mediaBox.topRightX)+" "+A(R.mediaBox.topRightY)+"]"),R.cropBox!==null&&ie("/CropBox ["+A(R.cropBox.bottomLeftX)+" "+A(R.cropBox.bottomLeftY)+" "+A(R.cropBox.topRightX)+" "+A(R.cropBox.topRightY)+"]"),R.bleedBox!==null&&ie("/BleedBox ["+A(R.bleedBox.bottomLeftX)+" "+A(R.bleedBox.bottomLeftY)+" "+A(R.bleedBox.topRightX)+" "+A(R.bleedBox.topRightY)+"]"),R.trimBox!==null&&ie("/TrimBox ["+A(R.trimBox.bottomLeftX)+" "+A(R.trimBox.bottomLeftY)+" "+A(R.trimBox.topRightX)+" "+A(R.trimBox.topRightY)+"]"),R.artBox!==null&&ie("/ArtBox ["+A(R.artBox.bottomLeftX)+" "+A(R.artBox.bottomLeftY)+" "+A(R.artBox.topRightX)+" "+A(R.artBox.topRightY)+"]"),typeof R.userUnit=="number"&&R.userUnit!==1&&ie("/UserUnit "+R.userUnit),Rr.publish("putPage",{objId:mt,pageContext:_r[pe],pageNumber:pe,page:He}),ie("/Contents "+zt+" 0 R"),ie(">>"),ie("endobj");var Dr=He.join(`
`);return _===w&&(Dr+=`
Q`),ce(zt,!0),gn({data:Dr,filters:Jr(),objectId:zt}),ie("endobj"),mt},jr=m.__private__.putPages=function(){var R,pe,He=[];for(R=1;R<=kr;R++)_r[R].objId=Mt(),_r[R].contentsObjId=Mt();for(R=1;R<=kr;R++)He.push(tt({number:R,data:oe[R],objId:_r[R].objId,contentsObjId:_r[R].contentsObjId,mediaBox:_r[R].mediaBox,cropBox:_r[R].cropBox,bleedBox:_r[R].bleedBox,trimBox:_r[R].trimBox,artBox:_r[R].artBox,userUnit:_r[R].userUnit,rootDictionaryObjId:Qt,resourceDictionaryObjId:Tt}));ce(Qt,!0),ie("<</Type /Pages");var mt="/Kids [";for(pe=0;pe<kr;pe++)mt+=He[pe]+" 0 R ";ie(mt+"]"),ie("/Count "+kr),ie(">>"),ie("endobj"),Rr.publish("postPutPages")},ua=function(R){Rr.publish("putFont",{font:R,out:ie,newObject:dt,putStream:gn}),R.isAlreadyPutted!==!0&&(R.objectNumber=dt(),ie("<<"),ie("/Type /Font"),ie("/BaseFont /"+ev(R.postScriptName)),ie("/Subtype /Type1"),typeof R.encoding=="string"&&ie("/Encoding /"+R.encoding),ie("/FirstChar 32"),ie("/LastChar 255"),ie(">>"),ie("endobj"))},Oe=function(R){R.objectNumber=dt();var pe=[];pe.push({key:"Type",value:"/XObject"}),pe.push({key:"Subtype",value:"/Form"}),pe.push({key:"BBox",value:"["+[A(R.x),A(R.y),A(R.x+R.width),A(R.y+R.height)].join(" ")+"]"}),pe.push({key:"Matrix",value:"["+R.matrix.toString()+"]"});var He=R.pages[1].join(`
`);gn({data:He,additionalKeyValues:pe,objectId:R.objectNumber}),ie("endobj")},Wt=function(R,pe){pe||(pe=21);var He=dt(),mt=function(Qr,de){var ke,st=[],ot=1/(de-1);for(ke=0;ke<1;ke+=ot)st.push(ke);if(st.push(1),Qr[0].offset!=0){var Nt={offset:0,color:Qr[0].color};Qr.unshift(Nt)}if(Qr[Qr.length-1].offset!=1){var or={offset:1,color:Qr[Qr.length-1].color};Qr.push(or)}for(var Bt="",vr=0,yr=0;yr<st.length;yr++){for(ke=st[yr];ke>Qr[vr+1].offset;)vr++;var It=Qr[vr].offset,Hr=(ke-It)/(Qr[vr+1].offset-It),Vr=Qr[vr].color,pr=Qr[vr+1].color;Bt+=he(Math.round((1-Hr)*Vr[0]+Hr*pr[0]).toString(16))+he(Math.round((1-Hr)*Vr[1]+Hr*pr[1]).toString(16))+he(Math.round((1-Hr)*Vr[2]+Hr*pr[2]).toString(16))}return Bt.trim()}(R.colors,pe),zt=[];zt.push({key:"FunctionType",value:"0"}),zt.push({key:"Domain",value:"[0.0 1.0]"}),zt.push({key:"Size",value:"["+pe+"]"}),zt.push({key:"BitsPerSample",value:"8"}),zt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),zt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),gn({data:mt,additionalKeyValues:zt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:He}),ie("endobj"),R.objectNumber=dt(),ie("<< /ShadingType "+R.type),ie("/ColorSpace /DeviceRGB");var Dr="/Coords ["+A(parseFloat(R.coords[0]))+" "+A(parseFloat(R.coords[1]))+" ";R.type===2?Dr+=A(parseFloat(R.coords[2]))+" "+A(parseFloat(R.coords[3])):Dr+=A(parseFloat(R.coords[2]))+" "+A(parseFloat(R.coords[3]))+" "+A(parseFloat(R.coords[4]))+" "+A(parseFloat(R.coords[5])),ie(Dr+="]"),R.matrix&&ie("/Matrix ["+R.matrix.toString()+"]"),ie("/Function "+He+" 0 R"),ie("/Extend [true true]"),ie(">>"),ie("endobj")},Ht=function(R,pe){var He=Mt(),mt=dt();pe.push({resourcesOid:He,objectOid:mt}),R.objectNumber=mt;var zt=[];zt.push({key:"Type",value:"/Pattern"}),zt.push({key:"PatternType",value:"1"}),zt.push({key:"PaintType",value:"1"}),zt.push({key:"TilingType",value:"1"}),zt.push({key:"BBox",value:"["+R.boundingBox.map(A).join(" ")+"]"}),zt.push({key:"XStep",value:A(R.xStep)}),zt.push({key:"YStep",value:A(R.yStep)}),zt.push({key:"Resources",value:He+" 0 R"}),R.matrix&&zt.push({key:"Matrix",value:"["+R.matrix.toString()+"]"}),gn({data:R.stream,additionalKeyValues:zt,objectId:R.objectNumber}),ie("endobj")},mr=function(R){for(var pe in R.objectNumber=dt(),ie("<<"),R)switch(pe){case"opacity":ie("/ca "+O(R[pe]));break;case"stroke-opacity":ie("/CA "+O(R[pe]))}ie(">>"),ie("endobj")},Gt=function(R){ce(R.resourcesOid,!0),ie("<<"),ie("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var pe in ie("/Font <<"),Ot)Ot.hasOwnProperty(pe)&&(f===!1||f===!0&&h.hasOwnProperty(pe))&&ie("/"+pe+" "+Ot[pe].objectNumber+" 0 R");ie(">>")}(),function(){if(Object.keys(Qe).length>0){for(var pe in ie("/Shading <<"),Qe)Qe.hasOwnProperty(pe)&&Qe[pe]instanceof bh&&Qe[pe].objectNumber>=0&&ie("/"+pe+" "+Qe[pe].objectNumber+" 0 R");Rr.publish("putShadingPatternDict"),ie(">>")}}(),function(pe){if(Object.keys(Qe).length>0){for(var He in ie("/Pattern <<"),Qe)Qe.hasOwnProperty(He)&&Qe[He]instanceof m.TilingPattern&&Qe[He].objectNumber>=0&&Qe[He].objectNumber<pe&&ie("/"+He+" "+Qe[He].objectNumber+" 0 R");Rr.publish("putTilingPatternDict"),ie(">>")}}(R.objectOid),function(){if(Object.keys(Yt).length>0){var pe;for(pe in ie("/ExtGState <<"),Yt)Yt.hasOwnProperty(pe)&&Yt[pe].objectNumber>=0&&ie("/"+pe+" "+Yt[pe].objectNumber+" 0 R");Rr.publish("putGStateDict"),ie(">>")}}(),function(){for(var pe in ie("/XObject <<"),rn)rn.hasOwnProperty(pe)&&rn[pe].objectNumber>=0&&ie("/"+pe+" "+rn[pe].objectNumber+" 0 R");Rr.publish("putXobjectDict"),ie(">>")}(),ie(">>"),ie("endobj")},pn=function(R){Cr[R.fontName]=Cr[R.fontName]||{},Cr[R.fontName][R.fontStyle]=R.id},jt=function(R,pe,He,mt,zt){var Dr={id:"F"+(Object.keys(Ot).length+1).toString(10),postScriptName:R,fontName:pe,fontStyle:He,encoding:mt,isStandardFont:zt||!1,metadata:{}};return Rr.publish("addFont",{font:Dr,instance:this}),Ot[Dr.id]=Dr,pn(Dr),Dr.id},ur=m.__private__.pdfEscape=m.pdfEscape=function(R,pe){return function(He,mt){var zt,Dr,Qr,de,ke,st,ot,Nt,or;if(Qr=(mt=mt||{}).sourceEncoding||"Unicode",ke=mt.outputEncoding,(mt.autoencode||ke)&&Ot[nt].metadata&&Ot[nt].metadata[Qr]&&Ot[nt].metadata[Qr].encoding&&(de=Ot[nt].metadata[Qr].encoding,!ke&&Ot[nt].encoding&&(ke=Ot[nt].encoding),!ke&&de.codePages&&(ke=de.codePages[0]),typeof ke=="string"&&(ke=de[ke]),ke)){for(ot=!1,st=[],zt=0,Dr=He.length;zt<Dr;zt++)(Nt=ke[He.charCodeAt(zt)])?st.push(String.fromCharCode(Nt)):st.push(He[zt]),st[zt].charCodeAt(0)>>8&&(ot=!0);He=st.join("")}for(zt=He.length;ot===void 0&&zt!==0;)He.charCodeAt(zt-1)>>8&&(ot=!0),zt--;if(!ot)return He;for(st=mt.noBOM?[]:[254,255],zt=0,Dr=He.length;zt<Dr;zt++){if((or=(Nt=He.charCodeAt(zt))>>8)>>8)throw new Error("Character at position "+zt+" of string '"+He+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");st.push(or),st.push(Nt-(or<<8))}return String.fromCharCode.apply(void 0,st)}(R,pe).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},rt=m.__private__.beginPage=function(R){oe[++kr]=[],_r[kr]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(R[0]),topRightY:Number(R[1])}},Tr(kr),ne(oe[$])},Dt=function(R,pe){var He,mt,zt;switch(r=pe||r,typeof R=="string"&&(He=v(R.toLowerCase()),Array.isArray(He)&&(mt=He[0],zt=He[1])),Array.isArray(R)&&(mt=R[0]*$t,zt=R[1]*$t),isNaN(mt)&&(mt=s[0],zt=s[1]),(mt>14400||zt>14400)&&(Qs.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),mt=Math.min(14400,mt),zt=Math.min(14400,zt)),s=[mt,zt],r.substr(0,1)){case"l":zt>mt&&(s=[zt,mt]);break;case"p":mt>zt&&(s=[zt,mt])}rt(s),Wa(Fn),ie(ii),ci!==0&&ie(ci+" J"),Lc!==0&&ie(Lc+" j"),Rr.publish("addPage",{pageNumber:kr})},Xt=function(R){R>0&&R<=kr&&(oe.splice(R,1),_r.splice(R,1),kr--,$>kr&&($=kr),this.setPage($))},Tr=function(R){R>0&&R<=kr&&($=R)},qn=m.__private__.getNumberOfPages=m.getNumberOfPages=function(){return oe.length-1},Gr=function(R,pe,He){var mt,zt=void 0;return He=He||{},R=R!==void 0?R:Ot[nt].fontName,pe=pe!==void 0?pe:Ot[nt].fontStyle,mt=R.toLowerCase(),Cr[mt]!==void 0&&Cr[mt][pe]!==void 0?zt=Cr[mt][pe]:Cr[R]!==void 0&&Cr[R][pe]!==void 0?zt=Cr[R][pe]:He.disableWarning===!1&&Qs.warn("Unable to look up font label for font '"+R+"', '"+pe+"'. Refer to getFontList() for available fonts."),zt||He.noFallback||(zt=Cr.times[pe])==null&&(zt=Cr.times.normal),zt},ar=m.__private__.putInfo=function(){var R=dt(),pe=function(mt){return mt};for(var He in u!==null&&(pe=Se.encryptor(R,0)),ie("<<"),ie("/Producer ("+ur(pe("jsPDF "+da.version))+")"),je)je.hasOwnProperty(He)&&je[He]&&ie("/"+He.substr(0,1).toUpperCase()+He.substr(1)+" ("+ur(pe(je[He]))+")");ie("/CreationDate ("+ur(pe(B))+")"),ie(">>"),ie("endobj")},kn=m.__private__.putCatalog=function(R){var pe=(R=R||{}).rootDictionaryObjId||Qt;switch(dt(),ie("<<"),ie("/Type /Catalog"),ie("/Pages "+pe+" 0 R"),wt||(wt="fullwidth"),wt){case"fullwidth":ie("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ie("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ie("/OpenAction [3 0 R /Fit]");break;case"original":ie("/OpenAction [3 0 R /XYZ null null 1]");break;default:var He=""+wt;He.substr(He.length-1)==="%"&&(wt=parseInt(wt)/100),typeof wt=="number"&&ie("/OpenAction [3 0 R /XYZ null null "+O(wt)+"]")}switch(Lt||(Lt="continuous"),Lt){case"continuous":ie("/PageLayout /OneColumn");break;case"single":ie("/PageLayout /SinglePage");break;case"two":case"twoleft":ie("/PageLayout /TwoColumnLeft");break;case"tworight":ie("/PageLayout /TwoColumnRight")}_e&&ie("/PageMode /"+_e),Rr.publish("putCatalog"),ie(">>"),ie("endobj")},Xn=m.__private__.putTrailer=function(){ie("trailer"),ie("<<"),ie("/Size "+(J+1)),ie("/Root "+J+" 0 R"),ie("/Info "+(J-1)+" 0 R"),u!==null&&ie("/Encrypt "+Se.oid+" 0 R"),ie("/ID [ <"+z+"> <"+z+"> ]"),ie(">>")},aa=m.__private__.putHeader=function(){ie("%PDF-"+x),ie("%")},pa=m.__private__.putXRef=function(){var R="0000000000";ie("xref"),ie("0 "+(J+1)),ie("0000000000 65535 f ");for(var pe=1;pe<=J;pe++)typeof G[pe]=="function"?ie((R+G[pe]()).slice(-10)+" 00000 n "):G[pe]!==void 0?ie((R+G[pe]).slice(-10)+" 00000 n "):ie("0000000000 00000 n ")},te=m.__private__.buildDocument=function(){var R;J=0,ve=0,ue=[],G=[],ae=[],Qt=Mt(),Tt=Mt(),ne(ue),Rr.publish("buildDocument"),aa(),jr(),function(){Rr.publish("putAdditionalObjects");for(var He=0;He<ae.length;He++){var mt=ae[He];ce(mt.objId,!0),ie(mt.content),ie("endobj")}Rr.publish("postPutAdditionalObjects")}(),R=[],function(){for(var He in Ot)Ot.hasOwnProperty(He)&&(f===!1||f===!0&&h.hasOwnProperty(He))&&ua(Ot[He])}(),function(){var He;for(He in Yt)Yt.hasOwnProperty(He)&&mr(Yt[He])}(),function(){for(var He in rn)rn.hasOwnProperty(He)&&Oe(rn[He])}(),function(He){var mt;for(mt in Qe)Qe.hasOwnProperty(mt)&&(Qe[mt]instanceof bh?Wt(Qe[mt]):Qe[mt]instanceof bg&&Ht(Qe[mt],He))}(R),Rr.publish("putResources"),R.forEach(Gt),Gt({resourcesOid:Tt,objectOid:Number.MAX_SAFE_INTEGER}),Rr.publish("postPutResources"),u!==null&&(Se.oid=dt(),ie("<<"),ie("/Filter /Standard"),ie("/V "+Se.v),ie("/R "+Se.r),ie("/U <"+Se.toHexString(Se.U)+">"),ie("/O <"+Se.toHexString(Se.O)+">"),ie("/P "+Se.P),ie(">>"),ie("endobj")),ar(),kn();var pe=ve;return pa(),Xn(),ie("startxref"),ie(""+pe),ie("%%EOF"),ne(oe[$]),ue.join(`
`)},Te=m.__private__.getBlob=function(R){return new Blob([pt(R)],{type:"application/pdf"})},at=m.output=m.__private__.output=(tr=function(R,pe){switch(typeof(pe=pe||{})=="string"?pe={filename:pe}:pe.filename=pe.filename||"generated.pdf",R){case void 0:return te();case"save":m.save(pe.filename);break;case"arraybuffer":return pt(te());case"blob":return Te(te());case"bloburi":case"bloburl":if(Ra.URL!==void 0&&typeof Ra.URL.createObjectURL=="function")return Ra.URL&&Ra.URL.createObjectURL(Te(te()))||void 0;Qs.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var He="",mt=te();try{He=J9(mt)}catch{He=J9(unescape(encodeURIComponent(mt)))}return"data:application/pdf;filename="+pe.filename+";base64,"+He;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Ra)==="[object Window]"){var zt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Dr=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';pe.pdfObjectUrl&&(zt=pe.pdfObjectUrl,Dr="");var Qr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+zt+'"'+Dr+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(pe)+");<\/script></body></html>",de=Ra.open();return de!==null&&de.document.write(Qr),de}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Ra)==="[object Window]"){var ke='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(pe.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+pe.filename+'" width="500px" height="400px" /></body></html>',st=Ra.open();if(st!==null){st.document.write(ke);var ot=this;st.document.documentElement.querySelector("#pdfViewer").onload=function(){st.document.title=pe.filename,st.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(ot.output("bloburl"))}}return st}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Ra)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Nt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",pe)+'"></iframe></body></html>',or=Ra.open();if(or!==null&&(or.document.write(Nt),or.document.title=pe.filename),or||typeof safari>"u")return or;break;case"datauri":case"dataurl":return Ra.document.location.href=this.output("datauristring",pe);default:return null}},tr.foo=function(){try{return tr.apply(this,arguments)}catch(He){var R=He.stack||"";~R.indexOf(" at ")&&(R=R.split(" at ")[1]);var pe="Error in function "+R.split(`
`)[0].split("<")[0]+": "+He.message;if(!Ra.console)throw new Error(pe);Ra.console.error(pe,He),Ra.alert&&alert(pe)}},tr.foo.bar=tr,tr.foo),ee=function(R){return Array.isArray(nn)===!0&&nn.indexOf(R)>-1};switch(n){case"pt":$t=1;break;case"mm":$t=72/25.4;break;case"cm":$t=72/2.54;break;case"in":$t=72;break;case"px":$t=ee("px_scaling")==1?.75:96/72;break;case"pc":case"em":$t=12;break;case"ex":$t=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);$t=n}var Se=null;Ae(),L();var $e=m.__private__.getPageInfo=m.getPageInfo=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:_r[R].objId,pageNumber:R,pageContext:_r[R]}},Be=m.__private__.getPageInfoByObjId=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var pe in _r)if(_r[pe].objId===R)break;return $e(pe)},Ge=m.__private__.getCurrentPageInfo=m.getCurrentPageInfo=function(){return{objId:_r[$].objId,pageNumber:$,pageContext:_r[$]}};m.addPage=function(){return Dt.apply(this,arguments),this},m.setPage=function(){return Tr.apply(this,arguments),ne.call(this,oe[$]),this},m.insertPage=function(R){return this.addPage(),this.movePage($,R),this},m.movePage=function(R,pe){var He,mt;if(R>pe){He=oe[R],mt=_r[R];for(var zt=R;zt>pe;zt--)oe[zt]=oe[zt-1],_r[zt]=_r[zt-1];oe[pe]=He,_r[pe]=mt,this.setPage(pe)}else if(R<pe){He=oe[R],mt=_r[R];for(var Dr=R;Dr<pe;Dr++)oe[Dr]=oe[Dr+1],_r[Dr]=_r[Dr+1];oe[pe]=He,_r[pe]=mt,this.setPage(pe)}return this},m.deletePage=function(){return Xt.apply(this,arguments),this},m.__private__.text=m.text=function(R,pe,He,mt,zt){var Dr,Qr,de,ke,st,ot,Nt,or,Bt,vr=(mt=mt||{}).scope||this;if(typeof R=="number"&&typeof pe=="number"&&(typeof He=="string"||Array.isArray(He))){var yr=He;He=pe,pe=R,R=yr}if(arguments[3]instanceof ze==0?(de=arguments[4],ke=arguments[5],cs(Nt=arguments[3])==="object"&&Nt!==null||(typeof de=="string"&&(ke=de,de=null),typeof Nt=="string"&&(ke=Nt,Nt=null),typeof Nt=="number"&&(de=Nt,Nt=null),mt={flags:Nt,angle:de,align:ke})):(P("The transform parameter of text() with a Matrix value"),Bt=zt),isNaN(pe)||isNaN(He)||R==null)throw new Error("Invalid arguments passed to jsPDF.text");if(R.length===0)return vr;var It,Hr="",Vr=typeof mt.lineHeightFactor=="number"?mt.lineHeightFactor:zn,pr=vr.internal.scaleFactor;function ln(Zn){return Zn=Zn.split("	").join(Array(mt.TabLen||9).join(" ")),ur(Zn,Nt)}function hr(Zn){for(var Mn,Yr=Zn.concat(),Sn=[],Da=Yr.length;Da--;)typeof(Mn=Yr.shift())=="string"?Sn.push(Mn):Array.isArray(Zn)&&(Mn.length===1||Mn[1]===void 0&&Mn[2]===void 0)?Sn.push(Mn[0]):Sn.push([Mn[0],Mn[1],Mn[2]]);return Sn}function Zr(Zn,Mn){var Yr;if(typeof Zn=="string")Yr=Mn(Zn)[0];else if(Array.isArray(Zn)){for(var Sn,Da,Ha=Zn.concat(),Xs=[],jo=Ha.length;jo--;)typeof(Sn=Ha.shift())=="string"?Xs.push(Mn(Sn)[0]):Array.isArray(Sn)&&typeof Sn[0]=="string"&&(Da=Mn(Sn[0],Sn[1],Sn[2]),Xs.push([Da[0],Da[1],Da[2]]));Yr=Xs}return Yr}var Pr=!1,cr=!0;if(typeof R=="string")Pr=!0;else if(Array.isArray(R)){var Mr=R.concat();Qr=[];for(var bn,ca=Mr.length;ca--;)(typeof(bn=Mr.shift())!="string"||Array.isArray(bn)&&typeof bn[0]!="string")&&(cr=!1);Pr=cr}if(Pr===!1)throw new Error('Type of text must be string or Array. "'+R+'" is not recognized.');typeof R=="string"&&(R=R.match(/[\r?\n]/)?R.split(/\r\n|\r|\n/g):[R]);var os=vt/vr.internal.scaleFactor,ys=os*(Vr-1);switch(mt.baseline){case"bottom":He-=ys;break;case"top":He+=os-ys;break;case"hanging":He+=os-2*ys;break;case"middle":He+=os/2-ys}if((ot=mt.maxWidth||0)>0&&(typeof R=="string"?R=vr.splitTextToSize(R,ot):Object.prototype.toString.call(R)==="[object Array]"&&(R=R.reduce(function(Zn,Mn){return Zn.concat(vr.splitTextToSize(Mn,ot))},[]))),Dr={text:R,x:pe,y:He,options:mt,mutex:{pdfEscape:ur,activeFontKey:nt,fonts:Ot,activeFontSize:vt}},Rr.publish("preProcessText",Dr),R=Dr.text,de=(mt=Dr.options).angle,Bt instanceof ze==0&&de&&typeof de=="number"){de*=Math.PI/180,mt.rotationDirection===0&&(de=-de),_===w&&(de=-de);var cn=Math.cos(de),Kr=Math.sin(de);Bt=new ze(cn,Kr,-Kr,cn,0,0)}else de&&de instanceof ze&&(Bt=de);_!==w||Bt||(Bt=kt),(st=mt.charSpace||Fc)!==void 0&&(Hr+=A(T(st))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(or=mt.horizontalScale)!==void 0&&(Hr+=A(100*or)+` Tz
`),mt.lang;var tn=-1,An=mt.renderingMode!==void 0?mt.renderingMode:mt.stroke,dn=vr.internal.getCurrentPageInfo().pageContext;switch(An){case 0:case!1:case"fill":tn=0;break;case 1:case!0:case"stroke":tn=1;break;case 2:case"fillThenStroke":tn=2;break;case 3:case"invisible":tn=3;break;case 4:case"fillAndAddForClipping":tn=4;break;case 5:case"strokeAndAddPathForClipping":tn=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":tn=6;break;case 7:case"addToPathForClipping":tn=7}var Yn=dn.usedRenderingMode!==void 0?dn.usedRenderingMode:-1;tn!==-1?Hr+=tn+` Tr
`:Yn!==-1&&(Hr+=`0 Tr
`),tn!==-1&&(dn.usedRenderingMode=tn),ke=mt.align||"left";var Ir,wn=vt*Vr,wr=vr.internal.pageSize.getWidth(),Wr=Ot[nt];st=mt.charSpace||Fc,ot=mt.maxWidth||0,Nt=Object.assign({autoencode:!0,noBOM:!0},mt.flags);var D=[],Q=function(Zn){return vr.getStringUnitWidth(Zn,{font:Wr,charSpace:st,fontSize:vt,doKerning:!1})*vt/pr};if(Object.prototype.toString.call(R)==="[object Array]"){var M;Qr=hr(R),ke!=="left"&&(Ir=Qr.map(Q));var H,le=0;if(ke==="right"){pe-=Ir[0],R=[],ca=Qr.length;for(var X=0;X<ca;X++)X===0?(H=Os(pe),M=ss(He)):(H=T(le-Ir[X]),M=-wn),R.push([Qr[X],H,M]),le=Ir[X]}else if(ke==="center"){pe-=Ir[0]/2,R=[],ca=Qr.length;for(var Ce=0;Ce<ca;Ce++)Ce===0?(H=Os(pe),M=ss(He)):(H=T((le-Ir[Ce])/2),M=-wn),R.push([Qr[Ce],H,M]),le=Ir[Ce]}else if(ke==="left"){R=[],ca=Qr.length;for(var we=0;we<ca;we++)R.push(Qr[we])}else if(ke==="justify"&&Wr.encoding==="Identity-H"){R=[],ca=Qr.length,ot=ot!==0?ot:wr;for(var Z=0,ye=0;ye<ca;ye++)if(M=ye===0?ss(He):-wn,H=ye===0?Os(pe):Z,ye<ca-1){var Ne=T((ot-Ir[ye])/(Qr[ye].split(" ").length-1)),Re=Qr[ye].split(" ");R.push([Re[0]+" ",H,M]),Z=0;for(var bt=1;bt<Re.length;bt++){var Rt=(Q(Re[bt-1]+" "+Re[bt])-Q(Re[bt]))*pr+Ne;bt==Re.length-1?R.push([Re[bt],Rt,0]):R.push([Re[bt]+" ",Rt,0]),Z-=Rt}}else R.push([Qr[ye],H,M]);R.push(["",Z,0])}else{if(ke!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(R=[],ca=Qr.length,ot=ot!==0?ot:wr,ye=0;ye<ca;ye++){M=ye===0?ss(He):-wn,H=ye===0?Os(pe):0;var dr=Qr[ye].split(" ").length-1,qt=dr>0?(ot-Ir[ye])/dr:0;ye<ca-1?D.push(A(T(qt))):D.push(0),R.push([Qr[ye],H,M])}}}(typeof mt.R2L=="boolean"?mt.R2L:er)===!0&&(R=Zr(R,function(Zn,Mn,Yr){return[Zn.split("").reverse().join(""),Mn,Yr]})),Dr={text:R,x:pe,y:He,options:mt,mutex:{pdfEscape:ur,activeFontKey:nt,fonts:Ot,activeFontSize:vt}},Rr.publish("postProcessText",Dr),R=Dr.text,It=Dr.mutex.isHex||!1;var rr=Ot[nt].encoding;rr!=="WinAnsiEncoding"&&rr!=="StandardEncoding"||(R=Zr(R,function(Zn,Mn,Yr){return[ln(Zn),Mn,Yr]})),Qr=hr(R),R=[];for(var qr,Dn,$r,xn=Array.isArray(Qr[0])?1:0,$n="",_n=function(Zn,Mn,Yr){var Sn="";return Yr instanceof ze?(Yr=typeof mt.angle=="number"?Je(Yr,new ze(1,0,0,1,Zn,Mn)):Je(new ze(1,0,0,1,Zn,Mn),Yr),_===w&&(Yr=Je(new ze(1,0,0,-1,0,0),Yr)),Sn=Yr.join(" ")+` Tm
`):Sn=A(Zn)+" "+A(Mn)+` Td
`,Sn},un=0;un<Qr.length;un++){switch($n="",xn){case 1:$r=(It?"<":"(")+Qr[un][0]+(It?">":")"),qr=parseFloat(Qr[un][1]),Dn=parseFloat(Qr[un][2]);break;case 0:$r=(It?"<":"(")+Qr[un]+(It?">":")"),qr=Os(pe),Dn=ss(He)}D!==void 0&&D[un]!==void 0&&($n=D[un]+` Tw
`),un===0?R.push($n+_n(qr,Dn,Bt)+$r):xn===0?R.push($n+$r):xn===1&&R.push($n+_n(qr,Dn,Bt)+$r)}R=xn===0?R.join(` Tj
T* `):R.join(` Tj
`),R+=` Tj
`;var Ca=`BT
/`;return Ca+=nt+" "+vt+` Tf
`,Ca+=A(vt*Vr)+` TL
`,Ca+=li+`
`,Ca+=Hr,Ca+=R,ie(Ca+="ET"),h[nt]=!0,vr};var Ye=m.__private__.clip=m.clip=function(R){return ie(R==="evenodd"?"W*":"W"),this};m.clipEvenOdd=function(){return Ye("evenodd")},m.__private__.discardPath=m.discardPath=function(){return ie("n"),this};var ft=m.__private__.isValidStyle=function(R){var pe=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(R)!==-1&&(pe=!0),pe};m.__private__.setDefaultPathOperation=m.setDefaultPathOperation=function(R){return ft(R)&&(d=R),this};var yt=m.__private__.getStyle=m.getStyle=function(R){var pe=d;switch(R){case"D":case"S":pe="S";break;case"F":pe="f";break;case"FD":case"DF":pe="B";break;case"f":case"f*":case"B":case"B*":pe=R}return pe},Et=m.close=function(){return ie("h"),this};m.stroke=function(){return ie("S"),this},m.fill=function(R){return br("f",R),this},m.fillEvenOdd=function(R){return br("f*",R),this},m.fillStroke=function(R){return br("B",R),this},m.fillStrokeEvenOdd=function(R){return br("B*",R),this};var br=function(R,pe){cs(pe)==="object"?Nr(pe,R):ie(R)},Ue=function(R){R===null||_===w&&R===void 0||(R=yt(R),ie(R))};function St(R,pe,He,mt,zt){var Dr=new bg(pe||this.boundingBox,He||this.xStep,mt||this.yStep,this.gState,zt||this.matrix);Dr.stream=this.stream;var Qr=R+"$$"+this.cloneIndex+++"$$";return ct(Qr,Dr),Dr}var Nr=function(R,pe){var He=et[R.key],mt=Qe[He];if(mt instanceof bh)ie("q"),ie(an(pe)),mt.gState&&m.setGState(mt.gState),ie(R.matrix.toString()+" cm"),ie("/"+He+" sh"),ie("Q");else if(mt instanceof bg){var zt=new ze(1,0,0,-1,0,Xo());R.matrix&&(zt=zt.multiply(R.matrix||kt),He=St.call(mt,R.key,R.boundingBox,R.xStep,R.yStep,zt).id),ie("q"),ie("/Pattern cs"),ie("/"+He+" scn"),mt.gState&&m.setGState(mt.gState),ie(pe),ie("Q")}},an=function(R){switch(R){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Lr=m.moveTo=function(R,pe){return ie(A(T(R))+" "+A(k(pe))+" m"),this},On=m.lineTo=function(R,pe){return ie(A(T(R))+" "+A(k(pe))+" l"),this},Qn=m.curveTo=function(R,pe,He,mt,zt,Dr){return ie([A(T(R)),A(k(pe)),A(T(He)),A(k(mt)),A(T(zt)),A(k(Dr)),"c"].join(" ")),this};m.__private__.line=m.line=function(R,pe,He,mt,zt){if(isNaN(R)||isNaN(pe)||isNaN(He)||isNaN(mt)||!ft(zt))throw new Error("Invalid arguments passed to jsPDF.line");return _===b?this.lines([[He-R,mt-pe]],R,pe,[1,1],zt||"S"):this.lines([[He-R,mt-pe]],R,pe,[1,1]).stroke()},m.__private__.lines=m.lines=function(R,pe,He,mt,zt,Dr){var Qr,de,ke,st,ot,Nt,or,Bt,vr,yr,It,Hr;if(typeof R=="number"&&(Hr=He,He=pe,pe=R,R=Hr),mt=mt||[1,1],Dr=Dr||!1,isNaN(pe)||isNaN(He)||!Array.isArray(R)||!Array.isArray(mt)||!ft(zt)||typeof Dr!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Lr(pe,He),Qr=mt[0],de=mt[1],st=R.length,yr=pe,It=He,ke=0;ke<st;ke++)(ot=R[ke]).length===2?(yr=ot[0]*Qr+yr,It=ot[1]*de+It,On(yr,It)):(Nt=ot[0]*Qr+yr,or=ot[1]*de+It,Bt=ot[2]*Qr+yr,vr=ot[3]*de+It,yr=ot[4]*Qr+yr,It=ot[5]*de+It,Qn(Nt,or,Bt,vr,yr,It));return Dr&&Et(),Ue(zt),this},m.path=function(R){for(var pe=0;pe<R.length;pe++){var He=R[pe],mt=He.c;switch(He.op){case"m":Lr(mt[0],mt[1]);break;case"l":On(mt[0],mt[1]);break;case"c":Qn.apply(this,mt);break;case"h":Et()}}return this},m.__private__.rect=m.rect=function(R,pe,He,mt,zt){if(isNaN(R)||isNaN(pe)||isNaN(He)||isNaN(mt)||!ft(zt))throw new Error("Invalid arguments passed to jsPDF.rect");return _===b&&(mt=-mt),ie([A(T(R)),A(k(pe)),A(T(He)),A(T(mt)),"re"].join(" ")),Ue(zt),this},m.__private__.triangle=m.triangle=function(R,pe,He,mt,zt,Dr,Qr){if(isNaN(R)||isNaN(pe)||isNaN(He)||isNaN(mt)||isNaN(zt)||isNaN(Dr)||!ft(Qr))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[He-R,mt-pe],[zt-He,Dr-mt],[R-zt,pe-Dr]],R,pe,[1,1],Qr,!0),this},m.__private__.roundedRect=m.roundedRect=function(R,pe,He,mt,zt,Dr,Qr){if(isNaN(R)||isNaN(pe)||isNaN(He)||isNaN(mt)||isNaN(zt)||isNaN(Dr)||!ft(Qr))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var de=4/3*(Math.SQRT2-1);return zt=Math.min(zt,.5*He),Dr=Math.min(Dr,.5*mt),this.lines([[He-2*zt,0],[zt*de,0,zt,Dr-Dr*de,zt,Dr],[0,mt-2*Dr],[0,Dr*de,-zt*de,Dr,-zt,Dr],[2*zt-He,0],[-zt*de,0,-zt,-Dr*de,-zt,-Dr],[0,2*Dr-mt],[0,-Dr*de,zt*de,-Dr,zt,-Dr]],R+zt,pe,[1,1],Qr,!0),this},m.__private__.ellipse=m.ellipse=function(R,pe,He,mt,zt){if(isNaN(R)||isNaN(pe)||isNaN(He)||isNaN(mt)||!ft(zt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Dr=4/3*(Math.SQRT2-1)*He,Qr=4/3*(Math.SQRT2-1)*mt;return Lr(R+He,pe),Qn(R+He,pe-Qr,R+Dr,pe-mt,R,pe-mt),Qn(R-Dr,pe-mt,R-He,pe-Qr,R-He,pe),Qn(R-He,pe+Qr,R-Dr,pe+mt,R,pe+mt),Qn(R+Dr,pe+mt,R+He,pe+Qr,R+He,pe),Ue(zt),this},m.__private__.circle=m.circle=function(R,pe,He,mt){if(isNaN(R)||isNaN(pe)||isNaN(He)||!ft(mt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(R,pe,He,He,mt)},m.setFont=function(R,pe,He){return He&&(pe=C(pe,He)),nt=Gr(R,pe,{disableWarning:!1}),this};var Ta=m.__private__.getFont=m.getFont=function(){return Ot[Gr.apply(m,arguments)]};m.__private__.getFontList=m.getFontList=function(){var R,pe,He={};for(R in Cr)if(Cr.hasOwnProperty(R))for(pe in He[R]=[],Cr[R])Cr[R].hasOwnProperty(pe)&&He[R].push(pe);return He},m.addFont=function(R,pe,He,mt,zt){var Dr=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Dr.indexOf(arguments[3])!==-1?zt=arguments[3]:arguments[3]&&Dr.indexOf(arguments[3])==-1&&(He=C(He,mt)),jt.call(this,R,pe,He,zt=zt||"Identity-H")};var zn,Fn=e.lineWidth||.200025,en=m.__private__.getLineWidth=m.getLineWidth=function(){return Fn},Wa=m.__private__.setLineWidth=m.setLineWidth=function(R){return Fn=R,ie(A(T(R))+" w"),this};m.__private__.setLineDash=da.API.setLineDash=da.API.setLineDashPattern=function(R,pe){if(R=R||[],pe=pe||0,isNaN(pe)||!Array.isArray(R))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return R=R.map(function(He){return A(T(He))}).join(" "),pe=A(T(pe)),ie("["+R+"] "+pe+" d"),this};var Ya=m.__private__.getLineHeight=m.getLineHeight=function(){return vt*zn};m.__private__.getLineHeight=m.getLineHeight=function(){return vt*zn};var za=m.__private__.setLineHeightFactor=m.setLineHeightFactor=function(R){return typeof(R=R||1.15)=="number"&&(zn=R),this},vs=m.__private__.getLineHeightFactor=m.getLineHeightFactor=function(){return zn};za(e.lineHeight);var Os=m.__private__.getHorizontalCoordinate=function(R){return T(R)},ss=m.__private__.getVerticalCoordinate=function(R){return _===w?R:_r[$].mediaBox.topRightY-_r[$].mediaBox.bottomLeftY-T(R)},Io=m.__private__.getHorizontalCoordinateString=m.getHorizontalCoordinateString=function(R){return A(Os(R))},Vs=m.__private__.getVerticalCoordinateString=m.getVerticalCoordinateString=function(R){return A(ss(R))},ii=e.strokeColor||"0 G";m.__private__.getStrokeColor=m.getDrawColor=function(){return Ar(ii)},m.__private__.setStrokeColor=m.setDrawColor=function(R,pe,He,mt){return ii=nr({ch1:R,ch2:pe,ch3:He,ch4:mt,pdfColorType:"draw",precision:2}),ie(ii),this};var Rl=e.fillColor||"0 g";m.__private__.getFillColor=m.getFillColor=function(){return Ar(Rl)},m.__private__.setFillColor=m.setFillColor=function(R,pe,He,mt){return Rl=nr({ch1:R,ch2:pe,ch3:He,ch4:mt,pdfColorType:"fill",precision:2}),ie(Rl),this};var li=e.textColor||"0 g",pl=m.__private__.getTextColor=m.getTextColor=function(){return Ar(li)};m.__private__.setTextColor=m.setTextColor=function(R,pe,He,mt){return li=nr({ch1:R,ch2:pe,ch3:He,ch4:mt,pdfColorType:"text",precision:3}),this};var Fc=e.charSpace,mc=m.__private__.getCharSpace=m.getCharSpace=function(){return parseFloat(Fc||0)};m.__private__.setCharSpace=m.setCharSpace=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Fc=R,this};var ci=0;m.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},m.__private__.setLineCap=m.setLineCap=function(R){var pe=m.CapJoinStyles[R];if(pe===void 0)throw new Error("Line cap style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ci=pe,ie(pe+" J"),this};var Lc=0;m.__private__.setLineJoin=m.setLineJoin=function(R){var pe=m.CapJoinStyles[R];if(pe===void 0)throw new Error("Line join style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Lc=pe,ie(pe+" j"),this},m.__private__.setLineMiterLimit=m.__private__.setMiterLimit=m.setLineMiterLimit=m.setMiterLimit=function(R){if(R=R||0,isNaN(R))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ie(A(T(R))+" M"),this},m.GState=O1,m.setGState=function(R){(R=typeof R=="string"?Yt[xr[R]]:Ks(null,R)).equals(Jt)||(ie("/"+R.id+" gs"),Jt=R)};var Ks=function(R,pe){if(!R||!xr[R]){var He=!1;for(var mt in Yt)if(Yt.hasOwnProperty(mt)&&Yt[mt].equals(pe)){He=!0;break}if(He)pe=Yt[mt];else{var zt="GS"+(Object.keys(Yt).length+1).toString(10);Yt[zt]=pe,pe.id=zt}return R&&(xr[R]=pe.id),Rr.publish("addGState",pe),pe}};m.addGState=function(R,pe){return Ks(R,pe),this},m.saveGraphicsState=function(){return ie("q"),Me.push({key:nt,size:vt,color:li}),this},m.restoreGraphicsState=function(){ie("Q");var R=Me.pop();return nt=R.key,vt=R.size,li=R.color,Jt=null,this},m.setCurrentTransformationMatrix=function(R){return ie(R.toString()+" cm"),this},m.comment=function(R){return ie("#"+R),this};var _o=function(R,pe){var He=R||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return He},set:function(Dr){isNaN(Dr)||(He=parseFloat(Dr))}});var mt=pe||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return mt},set:function(Dr){isNaN(Dr)||(mt=parseFloat(Dr))}});var zt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return zt},set:function(Dr){zt=Dr.toString()}}),this},$c=function(R,pe,He,mt){_o.call(this,R,pe),this.type="rect";var zt=He||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return zt},set:function(Qr){isNaN(Qr)||(zt=parseFloat(Qr))}});var Dr=mt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Dr},set:function(Qr){isNaN(Qr)||(Dr=parseFloat(Qr))}}),this},gl=function(){this.page=kr,this.currentPage=$,this.pages=oe.slice(0),this.pagesContext=_r.slice(0),this.x=Ut,this.y=Fe,this.matrix=xt,this.width=xl($),this.height=Qi($),this.outputDestination=De,this.id="",this.objectNumber=-1};gl.prototype.restore=function(){kr=this.page,$=this.currentPage,_r=this.pagesContext,oe=this.pages,Ut=this.x,Fe=this.y,xt=this.matrix,Ba($,this.width),Xr($,this.height),De=this.outputDestination};var _i=function(R,pe,He,mt,zt){qe.push(new gl),kr=$=0,oe=[],Ut=R,Fe=pe,xt=zt,rt([He,mt])};for(var ts in m.beginFormObject=function(R,pe,He,mt,zt){return _i(R,pe,He,mt,zt),this},m.endFormObject=function(R){return function(pe){if(Ke[pe])qe.pop().restore();else{var He=new gl,mt="Xo"+(Object.keys(rn).length+1).toString(10);He.id=mt,Ke[pe]=mt,rn[mt]=He,Rr.publish("addFormObject",He),qe.pop().restore()}}(R),this},m.doFormObject=function(R,pe){var He=rn[Ke[R]];return ie("q"),ie(pe.toString()+" cm"),ie("/"+He.id+" Do"),ie("Q"),this},m.getFormObject=function(R){var pe=rn[Ke[R]];return{x:pe.x,y:pe.y,width:pe.width,height:pe.height,matrix:pe.matrix}},m.save=function(R,pe){return R=R||"generated.pdf",(pe=pe||{}).returnPromise=pe.returnPromise||!1,pe.returnPromise===!1?(eg(Te(te()),R),typeof eg.unload=="function"&&Ra.setTimeout&&setTimeout(eg.unload,911),this):new Promise(function(He,mt){try{var zt=eg(Te(te()),R);typeof eg.unload=="function"&&Ra.setTimeout&&setTimeout(eg.unload,911),He(zt)}catch(Dr){mt(Dr.message)}})},da.API)da.API.hasOwnProperty(ts)&&(ts==="events"&&da.API.events.length?function(R,pe){var He,mt,zt;for(zt=pe.length-1;zt!==-1;zt--)He=pe[zt][0],mt=pe[zt][1],R.subscribe.apply(R,[He].concat(typeof mt=="function"?[mt]:mt))}(Rr,da.API.events):m[ts]=da.API[ts]);function xl(R){return _r[R].mediaBox.topRightX-_r[R].mediaBox.bottomLeftX}function Ba(R,pe){_r[R].mediaBox.topRightX=pe+_r[R].mediaBox.bottomLeftX}function Qi(R){return _r[R].mediaBox.topRightY-_r[R].mediaBox.bottomLeftY}function Xr(R,pe){_r[R].mediaBox.topRightY=pe+_r[R].mediaBox.bottomLeftY}var fu=m.getPageWidth=function(R){return xl(R=R||$)/$t},vl=m.setPageWidth=function(R,pe){Ba(R,pe*$t)},Xo=m.getPageHeight=function(R){return Qi(R=R||$)/$t},Zi=m.setPageHeight=function(R,pe){Xr(R,pe*$t)};return m.internal={pdfEscape:ur,getStyle:yt,getFont:Ta,getFontSize:gt,getCharSpace:mc,getTextColor:pl,getLineHeight:Ya,getLineHeightFactor:vs,getLineWidth:en,write:ht,getHorizontalCoordinate:Os,getVerticalCoordinate:ss,getCoordinateString:Io,getVerticalCoordinateString:Vs,collections:{},newObject:dt,newAdditionalObject:Xe,newObjectDeferred:Mt,newObjectDeferredBegin:ce,getFilters:Jr,putStream:gn,events:Rr,scaleFactor:$t,pageSize:{getWidth:function(){return fu($)},setWidth:function(R){vl($,R)},getHeight:function(){return Xo($)},setHeight:function(R){Zi($,R)}},encryptionOptions:u,encryption:Se,getEncryptor:function(R){return u!==null?Se.encryptor(R,0):function(pe){return pe}},output:at,getNumberOfPages:qn,pages:oe,out:ie,f2:O,f3:I,getPageInfo:$e,getPageInfoByObjId:Be,getCurrentPageInfo:Ge,getPDFVersion:g,Point:_o,Rectangle:$c,Matrix:ze,hasHotfix:ee},Object.defineProperty(m.internal.pageSize,"width",{get:function(){return fu($)},set:function(R){vl($,R)},enumerable:!0,configurable:!0}),Object.defineProperty(m.internal.pageSize,"height",{get:function(){return Xo($)},set:function(R){Zi($,R)},enumerable:!0,configurable:!0}),function(R){for(var pe=0,He=Ze.length;pe<He;pe++){var mt=jt.call(this,R[pe][0],R[pe][1],R[pe][2],Ze[pe][3],!0);f===!1&&(h[mt]=!0);var zt=R[pe][0].split("-");pn({id:mt,fontName:zt[0],fontStyle:zt[1]||""})}Rr.publish("addFonts",{fonts:Ot,dictionary:Cr})}.call(m,Ze),nt="F1",Dt(s,r),Rr.publish("initialized"),m}Zx.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},Zx.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Zx.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},Zx.prototype.processOwnerPassword=function(e,t){return P3(A3(t).substr(0,5),e)},Zx.prototype.encryptor=function(e,t){var r=A3(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return P3(r,n)}},O1.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||cs(e)!==cs(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return n===0},da.API={events:[]},da.version="3.0.3";var Uo=da.API,UR=1,bx=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Vx=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Ua=function(e){return e.toFixed(2)},eh=function(e){return e.toFixed(5)};Uo.__acroform__={};var Rc=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},tU=function(e){return e*UR},cf=function(e){var t=new Tae,r=na.internal.getHeight(e)||0,n=na.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Ua(n)),Number(Ua(r))],t},LQe=Uo.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},$Qe=Uo.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},BQe=Uo.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},ei=Uo.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return BQe(e,t-1)},ti=Uo.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return LQe(e,t-1)},ri=Uo.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return $Qe(e,t-1)},qQe=Uo.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,s=e[0],o=e[1],i=e[2],l=e[3],c={};return c.lowerLeft_X=r(s)||0,c.lowerLeft_Y=n(o+l)||0,c.upperRight_X=r(s+i)||0,c.upperRight_Y=n(o)||0,[Number(Ua(c.lowerLeft_X)),Number(Ua(c.lowerLeft_Y)),Number(Ua(c.upperRight_X)),Number(Ua(c.upperRight_Y))]},zQe=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=E3(e,r),s=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+s+" "+Ua(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var o=cf(e);return o.scope=e.scope,o.stream=t.join(`
`),o}},E3=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},s=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");s=e.multiline?s.map(function(O){return O.split(`
`)}):s.map(function(O){return[O]});var o=r,i=na.internal.getHeight(e)||0;i=i<0?-i:i;var l=na.internal.getWidth(e)||0;l=l<0?-l:l;var c=function(O,I,T){if(O+1<s.length){var k=I+" "+s[O+1][0];return X_(k,e,T).width<=l-4}return!1};o++;e:for(;o>0;){t="",o--;var d,u,f=X_("3",e,o).height,h=e.multiline?i-o:(i-f)/2,m=h+=2,x=0,g=0,y=0;if(o<=0){t=`(...) Tj
`,t+="% Width of Text: "+X_(t,e,o=12).width+", FieldWidth:"+l+`
`;break}for(var v="",b=0,w=0;w<s.length;w++)if(s.hasOwnProperty(w)){var _=!1;if(s[w].length!==1&&y!==s[w].length-1){if((f+2)*(b+2)+2>i)continue e;v+=s[w][y],_=!0,g=w,w--}else{v=(v+=s[w][y]+" ").substr(v.length-1)==" "?v.substr(0,v.length-1):v;var j=parseInt(w),S=c(j,v,o),C=w>=s.length-1;if(S&&!C){v+=" ",y=0;continue}if(S||C){if(C)g=j;else if(e.multiline&&(f+2)*(b+2)+2>i)continue e}else{if(!e.multiline||(f+2)*(b+2)+2>i)continue e;g=j}}for(var A="",P=x;P<=g;P++){var F=s[P];if(e.multiline){if(P===g){A+=F[y]+" ",y=(y+1)%F.length;continue}if(P===x){A+=F[F.length-1]+" ";continue}}A+=F[0]+" "}switch(A=A.substr(A.length-1)==" "?A.substr(0,A.length-1):A,u=X_(A,e,o).width,e.textAlign){case"right":d=l-u-2;break;case"center":d=(l-u)/2;break;default:d=2}t+=Ua(d)+" "+Ua(m)+` Td
`,t+="("+bx(A)+`) Tj
`,t+=-Ua(d)+` 0 Td
`,m=-(o+2),u=0,x=_?g:g+1,b++,v=""}break}return n.text=t,n.fontSize=o,n},X_=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),s=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:s}},UQe={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},VQe=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},WQe=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(Xu.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(UQe)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");UR=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new Dae,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var s in n)if(n.hasOwnProperty(s)){var o=n[s];o.objId=void 0,o.hasAnnotation&&VQe(o,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(n,s){var o=!n;for(var i in n||(s.internal.newObjectDeferredBegin(s.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),s.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||s.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(i)){var l=n[i],c=[],d=l.Rect;if(l.Rect&&(l.Rect=qQe(l.Rect,s)),s.internal.newObjectDeferredBegin(l.objId,!0),l.DA=na.createDefaultAppearanceStream(l),cs(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=d,l.hasAppearanceStream&&!l.appearanceStreamContent){var u=zQe(l);c.push({key:"AP",value:"<</N "+u+">>"}),s.internal.acroformPlugin.xForms.push(u)}if(l.appearanceStreamContent){var f="";for(var h in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(h)){var m=l.appearanceStreamContent[h];if(f+="/"+h+" ",f+="<<",Object.keys(m).length>=1||Array.isArray(m)){for(var i in m)if(m.hasOwnProperty(i)){var x=m[i];typeof x=="function"&&(x=x.call(s,l)),f+="/"+i+" "+x+" ",s.internal.acroformPlugin.xForms.indexOf(x)>=0||s.internal.acroformPlugin.xForms.push(x)}}else typeof(x=m)=="function"&&(x=x.call(s,l)),f+="/"+i+" "+x,s.internal.acroformPlugin.xForms.indexOf(x)>=0||s.internal.acroformPlugin.xForms.push(x);f+=">>"}c.push({key:"AP",value:`<<
`+f+">>"})}s.internal.putStream({additionalKeyValues:c,objectId:l.objId}),s.internal.out("endobj")}o&&function(g,y){for(var v in g)if(g.hasOwnProperty(v)){var b=v,w=g[v];y.internal.newObjectDeferredBegin(w.objId,!0),cs(w)==="object"&&typeof w.putStream=="function"&&w.putStream(),delete g[b]}}(s.internal.acroformPlugin.xForms,s)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},Oae=Uo.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(i){return i};if(Array.isArray(e)){for(var s="[",o=0;o<e.length;o++)switch(o!==0&&(s+=" "),cs(e[o])){case"boolean":case"number":case"object":s+=e[o].toString();break;case"string":e[o].substr(0,1)!=="/"?(t!==void 0&&r&&(n=r.internal.getEncryptor(t)),s+="("+bx(n(e[o].toString()))+")"):s+=e[o].toString()}return s+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},dk=function(e,t,r){var n=function(s){return s};return t!==void 0&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),"("+bx(n(e))+")"},_f=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};_f.prototype.toString=function(){return this.objId+" 0 R"},_f.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},_f.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var n=t[r],s=this[n];s&&(Array.isArray(s)?e.push({key:n,value:Oae(s,this.objId,this.scope)}):s instanceof _f?(s.scope=this.scope,e.push({key:n,value:s.objId+" 0 R"})):typeof s!="function"&&e.push({key:n,value:s}))}return e};var Tae=function(){_f.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};Rc(Tae,_f);var Dae=function(){_f.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+bx(r(e))+")"}},set:function(r){e=r}})};Rc(Dae,_f);var Xu=function e(){_f.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(v){if(isNaN(v))throw new Error('Invalid value "'+v+'" for attribute F supplied.');t=v}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!ei(t,3)},set:function(v){v?this.F=ti(t,3):this.F=ri(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(v){if(isNaN(v))throw new Error('Invalid value "'+v+'" for attribute Ff supplied.');r=v}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(v){n=v!==void 0?v:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(v){n[0]=v}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(v){n[1]=v}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(v){n[2]=v}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(v){n[3]=v}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(v){switch(v){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=v;break;default:throw new Error('Invalid value "'+v+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof QS)return;o="FieldObject"+e.FieldNum++}var v=function(b){return b};return this.scope&&(v=this.scope.internal.getEncryptor(this.objId)),"("+bx(v(o))+")"},set:function(v){o=v.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(v){o=v}});var i="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return i},set:function(v){i=v}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(v){l=v}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(v){c=v}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/UR:d},set:function(v){d=v}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(v){u=v}});var f="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!f||this instanceof QS||this instanceof Zh))return dk(f,this.objId,this.scope)},set:function(v){v=v.toString(),f=v}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof Ii==0?dk(h,this.objId,this.scope):h},set:function(v){v=v.toString(),h=this instanceof Ii==0?v.substr(0,1)==="("?Vx(v.substr(1,v.length-2)):Vx(v):v}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ii==1?Vx(h.substr(1,h.length-1)):h},set:function(v){v=v.toString(),h=this instanceof Ii==1?"/"+v:v}});var m=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(m)return m},set:function(v){this.V=v}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof Ii==0?dk(m,this.objId,this.scope):m},set:function(v){v=v.toString(),m=this instanceof Ii==0?v.substr(0,1)==="("?Vx(v.substr(1,v.length-2)):Vx(v):v}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ii==1?Vx(m.substr(1,m.length-1)):m},set:function(v){v=v.toString(),m=this instanceof Ii==1?"/"+v:v}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var x,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(v){v=!!v,g=v}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(x)return x},set:function(v){x=v}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,1)},set:function(v){v?this.Ff=ti(this.Ff,1):this.Ff=ri(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,2)},set:function(v){v?this.Ff=ti(this.Ff,2):this.Ff=ri(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,3)},set:function(v){v?this.Ff=ti(this.Ff,3):this.Ff=ri(this.Ff,3)}});var y=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(y!==null)return y},set:function(v){if([0,1,2].indexOf(v)===-1)throw new Error('Invalid value "'+v+'" for attribute Q supplied.');y=v}}),Object.defineProperty(this,"textAlign",{get:function(){var v;switch(y){case 0:default:v="left";break;case 1:v="center";break;case 2:v="right"}return v},configurable:!0,enumerable:!0,set:function(v){switch(v){case"right":case 2:y=2;break;case"center":case 1:y=1;break;default:y=0}}})};Rc(Xu,_f);var Ig=function(){Xu.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Oae(t,this.objId,this.scope)},set:function(r){var n,s;s=[],typeof(n=r)=="string"&&(s=function(o,i,l){l||(l=1);for(var c,d=[];c=i.exec(o);)d.push(c[l]);return d}(n,/\((.*?)\)/g)),t=s}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,18)},set:function(r){r?this.Ff=ti(this.Ff,18):this.Ff=ri(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=ti(this.Ff,19):this.Ff=ri(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,20)},set:function(r){r?(this.Ff=ti(this.Ff,20),t.sort()):this.Ff=ri(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,22)},set:function(r){r?this.Ff=ti(this.Ff,22):this.Ff=ri(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,23)},set:function(r){r?this.Ff=ti(this.Ff,23):this.Ff=ri(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,27)},set:function(r){r?this.Ff=ti(this.Ff,27):this.Ff=ri(this.Ff,27)}}),this.hasAppearanceStream=!1};Rc(Ig,Xu);var Og=function(){Ig.call(this),this.fontName="helvetica",this.combo=!1};Rc(Og,Ig);var Tg=function(){Og.call(this),this.combo=!0};Rc(Tg,Og);var rw=function(){Tg.call(this),this.edit=!0};Rc(rw,Tg);var Ii=function(){Xu.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,15)},set:function(r){r?this.Ff=ti(this.Ff,15):this.Ff=ri(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,16)},set:function(r){r?this.Ff=ti(this.Ff,16):this.Ff=ri(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,17)},set:function(r){r?this.Ff=ti(this.Ff,17):this.Ff=ri(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,26)},set:function(r){r?this.Ff=ti(this.Ff,26):this.Ff=ri(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,s=[];for(n in s.push("<<"),t)s.push("/"+n+" ("+bx(r(t[n]))+")");return s.push(">>"),s.join(`
`)}},set:function(r){cs(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};Rc(Ii,Xu);var nw=function(){Ii.call(this),this.pushButton=!0};Rc(nw,Ii);var Dg=function(){Ii.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};Rc(Dg,Ii);var QS=function(){var e,t;Xu.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(s){e=s}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(s){t=s}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(l){return l};this.scope&&(s=this.scope.internal.getEncryptor(this.objId));var o,i=[];for(o in i.push("<<"),n)i.push("/"+o+" ("+bx(s(n[o]))+")");return i.push(">>"),i.join(`
`)},set:function(s){cs(s)==="object"&&(n=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(s){typeof s=="string"&&(n.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(s){r=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(s){r="/"+s}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=na.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Rc(QS,Xu),Dg.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Dg.prototype.createOption=function(e){var t=new QS;return t.Parent=this,t.optionName=e,this.Kids.push(t),HQe.call(this.scope,t),t};var aw=function(){Ii.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=na.CheckBox.createAppearanceStream()};Rc(aw,Ii);var Zh=function(){Xu.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,13)},set:function(t){t?this.Ff=ti(this.Ff,13):this.Ff=ri(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,21)},set:function(t){t?this.Ff=ti(this.Ff,21):this.Ff=ri(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,23)},set:function(t){t?this.Ff=ti(this.Ff,23):this.Ff=ri(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,24)},set:function(t){t?this.Ff=ti(this.Ff,24):this.Ff=ri(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,25)},set:function(t){t?this.Ff=ti(this.Ff,25):this.Ff=ri(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,26)},set:function(t){t?this.Ff=ti(this.Ff,26):this.Ff=ri(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Rc(Zh,Xu);var sw=function(){Zh.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!ei(this.Ff,14)},set:function(e){e?this.Ff=ti(this.Ff,14):this.Ff=ri(this.Ff,14)}}),this.password=!0};Rc(sw,Zh);var na={CheckBox:{createAppearanceStream:function(){return{N:{On:na.CheckBox.YesNormal},D:{On:na.CheckBox.YesPushDown,Off:na.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=cf(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,s=e.scope.__private__.encodeColorString(e.color),o=E3(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+Ua(na.internal.getWidth(e))+" "+Ua(na.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+Ua(o.fontSize)+" Tf "+s),r.push("BT"),r.push(o.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=cf(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),s=[],o=na.internal.getHeight(e),i=na.internal.getWidth(e),l=E3(e,e.caption);return s.push("1 g"),s.push("0 0 "+Ua(i)+" "+Ua(o)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+Ua(i-1)+" "+Ua(o-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+r+" "+Ua(l.fontSize)+" Tf "+n),s.push(l.text),s.push("ET"),s.push("Q"),t.stream=s.join(`
`),t},OffPushDown:function(e){var t=cf(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Ua(na.internal.getWidth(e))+" "+Ua(na.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:na.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=na.RadioButton.Circle.YesNormal,t.D[e]=na.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=cf(e);t.scope=e.scope;var r=[],n=na.internal.getWidth(e)<=na.internal.getHeight(e)?na.internal.getWidth(e)/4:na.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=na.internal.Bezier_C,o=Number((n*s).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+eh(na.internal.getWidth(e)/2)+" "+eh(na.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=cf(e);t.scope=e.scope;var r=[],n=na.internal.getWidth(e)<=na.internal.getHeight(e)?na.internal.getWidth(e)/4:na.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),o=Number((s*na.internal.Bezier_C).toFixed(5)),i=Number((n*na.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+eh(na.internal.getWidth(e)/2)+" "+eh(na.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),r.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),r.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),r.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+eh(na.internal.getWidth(e)/2)+" "+eh(na.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),r.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),r.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),r.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=cf(e);t.scope=e.scope;var r=[],n=na.internal.getWidth(e)<=na.internal.getHeight(e)?na.internal.getWidth(e)/4:na.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),o=Number((s*na.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+eh(na.internal.getWidth(e)/2)+" "+eh(na.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),r.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),r.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),r.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:na.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=na.RadioButton.Cross.YesNormal,t.D[e]=na.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=cf(e);t.scope=e.scope;var r=[],n=na.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+Ua(na.internal.getWidth(e)-2)+" "+Ua(na.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Ua(n.x1.x)+" "+Ua(n.x1.y)+" m"),r.push(Ua(n.x2.x)+" "+Ua(n.x2.y)+" l"),r.push(Ua(n.x4.x)+" "+Ua(n.x4.y)+" m"),r.push(Ua(n.x3.x)+" "+Ua(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=cf(e);t.scope=e.scope;var r=na.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+Ua(na.internal.getWidth(e))+" "+Ua(na.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+Ua(na.internal.getWidth(e)-2)+" "+Ua(na.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(Ua(r.x1.x)+" "+Ua(r.x1.y)+" m"),n.push(Ua(r.x2.x)+" "+Ua(r.x2.y)+" l"),n.push(Ua(r.x4.x)+" "+Ua(r.x4.y)+" m"),n.push(Ua(r.x3.x)+" "+Ua(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=cf(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Ua(na.internal.getWidth(e))+" "+Ua(na.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};na.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=na.internal.getWidth(e),r=na.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},na.internal.getWidth=function(e){var t=0;return cs(e)==="object"&&(t=tU(e.Rect[2])),t},na.internal.getHeight=function(e){var t=0;return cs(e)==="object"&&(t=tU(e.Rect[3])),t};var HQe=Uo.addField=function(e){if(WQe(this,e),!(e instanceof Xu))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};Uo.AcroFormChoiceField=Ig,Uo.AcroFormListBox=Og,Uo.AcroFormComboBox=Tg,Uo.AcroFormEditBox=rw,Uo.AcroFormButton=Ii,Uo.AcroFormPushButton=nw,Uo.AcroFormRadioButton=Dg,Uo.AcroFormCheckBox=aw,Uo.AcroFormTextField=Zh,Uo.AcroFormPasswordField=sw,Uo.AcroFormAppearance=na,Uo.AcroForm={ChoiceField:Ig,ListBox:Og,ComboBox:Tg,EditBox:rw,Button:Ii,PushButton:nw,RadioButton:Dg,CheckBox:aw,TextField:Zh,PasswordField:sw,Appearance:na},da.AcroForm={ChoiceField:Ig,ListBox:Og,ComboBox:Tg,EditBox:rw,Button:Ii,PushButton:nw,RadioButton:Dg,CheckBox:aw,TextField:Zh,PasswordField:sw,Appearance:na};var GQe=da.AcroForm;function Mae(e){return e.reduce(function(t,r,n){return t[r]=n,t},{})}(function(e){var t="addImage_";e.__addimage__={};var r="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},s=e.__addimage__.getImageFileTypeByImageData=function(O,I){var T,k,B,z,U,L=r;if((I=I||r)==="RGBA"||O.data!==void 0&&O.data instanceof Uint8ClampedArray&&"height"in O&&"width"in O)return"RGBA";if(S(O))for(U in n)for(B=n[U],T=0;T<B.length;T+=1){for(z=!0,k=0;k<B[T].length;k+=1)if(B[T][k]!==void 0&&B[T][k]!==O[k]){z=!1;break}if(z===!0){L=U;break}}else for(U in n)for(B=n[U],T=0;T<B.length;T+=1){for(z=!0,k=0;k<B[T].length;k+=1)if(B[T][k]!==void 0&&B[T][k]!==O.charCodeAt(k)){z=!1;break}if(z===!0){L=U;break}}return L===r&&I!==r&&(L=I),L},o=function O(I){for(var T=this.internal.write,k=this.internal.putStream,B=(0,this.internal.getFilters)();B.indexOf("FlateEncode")!==-1;)B.splice(B.indexOf("FlateEncode"),1);I.objectId=this.internal.newObject();var z=[];if(z.push({key:"Type",value:"/XObject"}),z.push({key:"Subtype",value:"/Image"}),z.push({key:"Width",value:I.width}),z.push({key:"Height",value:I.height}),I.colorSpace===v.INDEXED?z.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(I.palette.length/3-1)+" "+("sMask"in I&&I.sMask!==void 0?I.objectId+2:I.objectId+1)+" 0 R]"}):(z.push({key:"ColorSpace",value:"/"+I.colorSpace}),I.colorSpace===v.DEVICE_CMYK&&z.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),z.push({key:"BitsPerComponent",value:I.bitsPerComponent}),"decodeParameters"in I&&I.decodeParameters!==void 0&&z.push({key:"DecodeParms",value:"<<"+I.decodeParameters+">>"}),"transparency"in I&&Array.isArray(I.transparency)&&I.transparency.length>0){for(var U="",L=0,W=I.transparency.length;L<W;L++)U+=I.transparency[L]+" "+I.transparency[L]+" ";z.push({key:"Mask",value:"["+U+"]"})}I.sMask!==void 0&&z.push({key:"SMask",value:I.objectId+1+" 0 R"});var ge=I.filter!==void 0?["/"+I.filter]:void 0;if(k({data:I.data,additionalKeyValues:z,alreadyAppliedFilters:ge,objectId:I.objectId}),T("endobj"),"sMask"in I&&I.sMask!==void 0){var Ae,V=(Ae=I.sMaskBitsPerComponent)!==null&&Ae!==void 0?Ae:I.bitsPerComponent,$={width:I.width,height:I.height,colorSpace:"DeviceGray",bitsPerComponent:V,data:I.sMask};"filter"in I&&($.decodeParameters="/Predictor ".concat(I.predictor," /Colors 1 /BitsPerComponent ").concat(V," /Columns ").concat(I.width),$.filter=I.filter),O.call(this,$)}if(I.colorSpace===v.INDEXED){var Y=this.internal.newObject();k({data:A(new Uint8Array(I.palette)),objectId:Y}),T("endobj")}},i=function(){var O=this.internal.collections[t+"images"];for(var I in O)o.call(this,O[I])},l=function(){var O,I=this.internal.collections[t+"images"],T=this.internal.write;for(var k in I)T("/I"+(O=I[k]).index,O.objectId,"0","R")},c=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",i),this.internal.events.subscribe("putXobjectDict",l))},d=function(){var O=this.internal.collections[t+"images"];return c.call(this),O},u=function(){return Object.keys(this.internal.collections[t+"images"]).length},f=function(O){return typeof e["process"+O.toUpperCase()]=="function"},h=function(O){return cs(O)==="object"&&O.nodeType===1},m=function(O,I){if(O.nodeName==="IMG"&&O.hasAttribute("src")){var T=""+O.getAttribute("src");if(T.indexOf("data:image/")===0)return Rj(unescape(T).split("base64,").pop());var k=e.loadFile(T,!0);if(k!==void 0)return k}if(O.nodeName==="CANVAS"){if(O.width===0||O.height===0)throw new Error("Given canvas must have data. Canvas width: "+O.width+", height: "+O.height);var B;switch(I){case"PNG":B="image/png";break;case"WEBP":B="image/webp";break;default:B="image/jpeg"}return Rj(O.toDataURL(B,1).split("base64,").pop())}},x=function(O){var I=this.internal.collections[t+"images"];if(I){for(var T in I)if(O===I[T].alias)return I[T]}},g=function(O,I,T){return O||I||(O=-96,I=-96),O<0&&(O=-1*T.width*72/O/this.internal.scaleFactor),I<0&&(I=-1*T.height*72/I/this.internal.scaleFactor),O===0&&(O=I*T.width/T.height),I===0&&(I=O*T.height/T.width),[O,I]},y=function(O,I,T,k,B,z){var U=g.call(this,T,k,B),L=this.internal.getCoordinateString,W=this.internal.getVerticalCoordinateString,ge=d.call(this);if(T=U[0],k=U[1],ge[B.index]=B,z){z*=Math.PI/180;var Ae=Math.cos(z),V=Math.sin(z),$=function(he){return he.toFixed(4)},Y=[$(Ae),$(V),$(-1*V),$(Ae),0,0,"cm"]}this.internal.write("q"),z?(this.internal.write([1,"0","0",1,L(O),W(I+k),"cm"].join(" ")),this.internal.write(Y.join(" ")),this.internal.write([L(T),"0","0",L(k),"0","0","cm"].join(" "))):this.internal.write([L(T),"0","0",L(k),L(O),W(I+k),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+B.index+" Do"),this.internal.write("Q")},v=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},w=e.__addimage__.sHashCode=function(O){var I,T,k=0;if(typeof O=="string")for(T=O.length,I=0;I<T;I++)k=(k<<5)-k+O.charCodeAt(I),k|=0;else if(S(O))for(T=O.byteLength/2,I=0;I<T;I++)k=(k<<5)-k+O[I],k|=0;return k},_=e.__addimage__.validateStringAsBase64=function(O){(O=O||"").toString().trim();var I=!0;return O.length===0&&(I=!1),O.length%4!=0&&(I=!1),/^[A-Za-z0-9+/]+$/.test(O.substr(0,O.length-2))===!1&&(I=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(O.substr(-2))===!1&&(I=!1),I},j=e.__addimage__.extractImageFromDataUrl=function(O){if(O==null||!(O=O.trim()).startsWith("data:"))return null;var I=O.indexOf(",");return I<0?null:O.substring(0,I).trim().endsWith("base64")?O.substring(I+1):null};e.__addimage__.isArrayBuffer=function(O){return O instanceof ArrayBuffer};var S=e.__addimage__.isArrayBufferView=function(O){return O instanceof Int8Array||O instanceof Uint8Array||O instanceof Uint8ClampedArray||O instanceof Int16Array||O instanceof Uint16Array||O instanceof Int32Array||O instanceof Uint32Array||O instanceof Float32Array||O instanceof Float64Array},C=e.__addimage__.binaryStringToUint8Array=function(O){for(var I=O.length,T=new Uint8Array(I),k=0;k<I;k++)T[k]=O.charCodeAt(k);return T},A=e.__addimage__.arrayBufferToBinaryString=function(O){for(var I="",T=S(O)?O:new Uint8Array(O),k=0;k<T.length;k+=8192)I+=String.fromCharCode.apply(null,T.subarray(k,k+8192));return I};e.addImage=function(){var O,I,T,k,B,z,U,L,W;if(typeof arguments[1]=="number"?(I=r,T=arguments[1],k=arguments[2],B=arguments[3],z=arguments[4],U=arguments[5],L=arguments[6],W=arguments[7]):(I=arguments[1],T=arguments[2],k=arguments[3],B=arguments[4],z=arguments[5],U=arguments[6],L=arguments[7],W=arguments[8]),cs(O=arguments[0])==="object"&&!h(O)&&"imageData"in O){var ge=O;O=ge.imageData,I=ge.format||I||r,T=ge.x||T||0,k=ge.y||k||0,B=ge.w||ge.width||B,z=ge.h||ge.height||z,U=ge.alias||U,L=ge.compression||L,W=ge.rotation||ge.angle||W}var Ae=this.internal.getFilters();if(L===void 0&&Ae.indexOf("FlateEncode")!==-1&&(L="SLOW"),isNaN(T)||isNaN(k))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var V=P.call(this,O,I,U,L);return y.call(this,T,k,B,z,V,W),this};var P=function(O,I,T,k){var B,z,U;if(typeof O=="string"&&s(O)===r){O=unescape(O);var L=F(O,!1);(L!==""||(L=e.loadFile(O,!0))!==void 0)&&(O=L)}if(h(O)&&(O=m(O,I)),I=s(O,I),!f(I))throw new Error("addImage does not support files of type '"+I+"', please ensure that a plugin for '"+I+"' support is added.");if(((U=T)==null||U.length===0)&&(T=function(W){return typeof W=="string"||S(W)?w(W):S(W.data)?w(W.data):null}(O)),(B=x.call(this,T))||(O instanceof Uint8Array||I==="RGBA"||(z=O,O=C(O)),B=this["process"+I.toUpperCase()](O,u.call(this),T,function(W){return W&&typeof W=="string"&&(W=W.toUpperCase()),W in e.image_compression?W:b.NONE}(k),z)),!B)throw new Error("An unknown error occurred whilst processing the image.");return B},F=e.__addimage__.convertBase64ToBinaryString=function(O,I){I=typeof I!="boolean"||I;var T,k="";if(typeof O=="string"){var B;T=(B=j(O))!==null&&B!==void 0?B:O;try{k=Rj(T)}catch(z){if(I)throw _(T)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+z.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return k};e.getImageProperties=function(O){var I,T,k="";if(h(O)&&(O=m(O)),typeof O=="string"&&s(O)===r&&((k=F(O,!1))===""&&(k=e.loadFile(O)||""),O=k),T=s(O),!f(T))throw new Error("addImage does not support files of type '"+T+"', please ensure that a plugin for '"+T+"' support is added.");if(O instanceof Uint8Array||(O=C(O)),!(I=this["process"+T.toUpperCase()](O)))throw new Error("An unknown error occurred whilst processing the image");return I.fileType=T,I}})(da.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};da.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var n,s,o,i=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(r.objId),d=r.pageContext.annotations,u=!1,f=0;f<d.length&&!u;f++)switch((n=d[f]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(u=!0);break;case"reference":case"text":case"freetext":u=!0}if(u!=0){this.internal.write("/Annots [");for(var h=0;h<d.length;h++){n=d[h];var m=this.internal.pdfEscape,x=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var g=this.internal.newAdditionalObject(),y=this.internal.newAdditionalObject(),v=this.internal.getEncryptor(g.objId),b=n.title||"Note";o="<</Type /Annot /Subtype /Text "+(s="/Rect ["+i(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+m(v(n.contents))+")",o+=" /Popup "+y.objId+" 0 R",o+=" /P "+c.objId+" 0 R",o+=" /T ("+m(v(b))+") >>",g.content=o;var w=g.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(s="/Rect ["+i(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+w,n.open&&(o+=" /Open true"),o+=" >>",y.content=o,this.internal.write(g.objId,"0 R",y.objId,"0 R");break;case"freetext":s="/Rect ["+i(n.bounds.x)+" "+l(n.bounds.y)+" "+i(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var _=n.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+s+"/Contents ("+m(x(n.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+_+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(n.options.name){var j=this.annotations._nameMap[n.options.name];n.options.pageNumber=j.page,n.options.top=j.y}else n.options.top||(n.options.top=0);if(s="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",o="",n.options.url)o="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /A <</S /URI /URI ("+m(x(n.options.url))+") >>";else if(n.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,o+=" /FitV "+n.options.left+"]";break;default:var S=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),o+=" /XYZ "+n.options.left+" "+S+" "+n.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},e.link=function(r,n,s,o,i){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(r),y:d(n),w:c(r+s),h:d(n+o)},options:i,type:"link"})},e.textWithLink=function(r,n,s,o){var i,l,c=this.getTextWidth(r),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){l=o.maxWidth;var u=this.splitTextToSize(r,l).length;i=Math.ceil(d*u)}else l=c,i=d;return this.text(r,n,s,o),s+=.2*d,o.align==="center"&&(n-=c/2),o.align==="right"&&(n-=c),this.link(n,s-d,l,i,o),c},e.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(da.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];e.__arabicParser__={};var o=e.__arabicParser__.isInArabicSubstitutionA=function(g){return t[g.charCodeAt(0)]!==void 0},i=e.__arabicParser__.isArabicLetter=function(g){return typeof g=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(g)},l=e.__arabicParser__.isArabicEndLetter=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(g){return i(g)&&s.indexOf(g.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=1};var d=e.__arabicParser__.arabicLetterHasFinalForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=3};var u=e.__arabicParser__.arabicLetterHasMedialForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length==4},f=e.__arabicParser__.resolveLigatures=function(g){var y=0,v=r,b="",w=0;for(y=0;y<g.length;y+=1)v[g.charCodeAt(y)]!==void 0?(w++,typeof(v=v[g.charCodeAt(y)])=="number"&&(b+=String.fromCharCode(v),v=r,w=0),y===g.length-1&&(v=r,b+=g.charAt(y-(w-1)),y-=w-1,w=0)):(v=r,b+=g.charAt(y-w),y-=w,w=0);return b};e.__arabicParser__.isArabicDiacritic=function(g){return g!==void 0&&n[g.charCodeAt(0)]!==void 0};var h=e.__arabicParser__.getCorrectForm=function(g,y,v){return i(g)?o(g)===!1?-1:!d(g)||!i(y)&&!i(v)||!i(v)&&l(y)||l(g)&&!i(y)||l(g)&&c(y)||l(g)&&l(y)?0:u(g)&&i(y)&&!l(y)&&i(v)&&d(v)?3:l(g)||!i(v)?1:2:-1},m=function(g){var y=0,v=0,b=0,w="",_="",j="",S=(g=g||"").split("\\s+"),C=[];for(y=0;y<S.length;y+=1){for(C.push(""),v=0;v<S[y].length;v+=1)w=S[y][v],_=S[y][v-1],j=S[y][v+1],i(w)?(b=h(w,_,j),C[y]+=b!==-1?String.fromCharCode(t[w.charCodeAt(0)][b]):w):C[y]+=w;C[y]=f(C[y])}return C.join(" ")},x=e.__arabicParser__.processArabic=e.processArabic=function(){var g,y=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,v=[];if(Array.isArray(y)){var b=0;for(v=[],b=0;b<y.length;b+=1)Array.isArray(y[b])?v.push([m(y[b][0]),y[b][1],y[b][2]]):v.push([m(y[b])]);g=v}else g=m(y);return typeof arguments[0]=="string"?g:(arguments[0].text=g,arguments[0])};e.events.push(["preProcessText",x])}(da.API),da.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform",e.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var s=300;Object.defineProperty(this,"height",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=s+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(l){o=l}});var i={};Object.defineProperty(this,"style",{get:function(){return i},set:function(l){i=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,n){var s;if((r=r||"2d")!=="2d")return null;for(s in n)this.pdf.context2d.hasOwnProperty(s)&&(this.pdf.context2d[s]=n[s]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(da.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(g){c=g}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(g){d=g}});var u=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return u},set:function(g){u=g}});var f=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return f},set:function(g){f=g}});var h=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return h},set:function(g){h=g}});var m=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return m},set:function(g){m=g}});var x=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return x},set:function(g){x=g}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(c){return n.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},e.getTextDimensions=function(c,d){n.call(this);var u=(d=d||{}).fontSize||this.getFontSize(),f=d.font||this.getFont(),h=d.scaleFactor||this.internal.scaleFactor,m=0,x=0,g=0,y=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var v=d.maxWidth;v>0?typeof c=="string"?c=this.splitTextToSize(c,v):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(w,_){return w.concat(y.splitTextToSize(_,v))},[])):c=Array.isArray(c)?c:[c];for(var b=0;b<c.length;b++)m<(g=this.getStringUnitWidth(c[b],{font:f})*u)&&(m=g);return m!==0&&(x=c.length),{w:m/=h,h:Math.max((x*u*this.getLineHeightFactor()-u*(this.getLineHeightFactor()-1))/h,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var i=e.cell=function(){var c;c=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var d=this.internal.__cell__.lastCell,u=this.internal.__cell__.padding,f=this.internal.__cell__.margins||t,h=this.internal.__cell__.tableHeaderRow,m=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===c.lineNumber?(c.x=(d.x||0)+(d.width||0),c.y=d.y||0):d.y+d.height+c.height+f.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=f.top,m&&h&&(this.printHeaderRow(c.lineNumber,!0),c.y+=h[0].height)):c.y=d.y+d.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,r===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-u,c.y+u,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+u,{align:"center",baseline:"top",maxWidth:c.width-u-u}):this.text(c.text,c.x+u,c.y+u,{align:"left",baseline:"top",maxWidth:c.width-u-u})),this.internal.__cell__.lastCell=c,this};e.table=function(c,d,u,f,h){if(n.call(this),!u)throw new Error("No data for PDF table.");var m,x,g,y,v=[],b=[],w=[],_={},j={},S=[],C=[],A=(h=h||{}).autoSize||!1,P=h.printHeaders!==!1,F=h.css&&h.css["font-size"]!==void 0?16*h.css["font-size"]:h.fontSize||12,O=h.margins||Object.assign({width:this.getPageWidth()},t),I=typeof h.padding=="number"?h.padding:3,T=h.headerBackgroundColor||"#c8c8c8",k=h.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=P,this.internal.__cell__.margins=O,this.internal.__cell__.table_font_size=F,this.internal.__cell__.padding=I,this.internal.__cell__.headerBackgroundColor=T,this.internal.__cell__.headerTextColor=k,this.setFontSize(F),f==null)b=v=Object.keys(u[0]),w=v.map(function(){return"left"});else if(Array.isArray(f)&&cs(f[0])==="object")for(v=f.map(function(ge){return ge.name}),b=f.map(function(ge){return ge.prompt||ge.name||""}),w=f.map(function(ge){return ge.align||"left"}),m=0;m<f.length;m+=1)j[f[m].name]=.7499990551181103*f[m].width;else Array.isArray(f)&&typeof f[0]=="string"&&(b=v=f,w=v.map(function(){return"left"}));if(A||Array.isArray(f)&&typeof f[0]=="string")for(m=0;m<v.length;m+=1){for(_[y=v[m]]=u.map(function(ge){return ge[y]}),this.setFont(void 0,"bold"),S.push(this.getTextDimensions(b[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),x=_[y],this.setFont(void 0,"normal"),g=0;g<x.length;g+=1)S.push(this.getTextDimensions(x[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);j[y]=Math.max.apply(null,S)+I+I,S=[]}if(P){var B={};for(m=0;m<v.length;m+=1)B[v[m]]={},B[v[m]].text=b[m],B[v[m]].align=w[m];var z=l.call(this,B,j);C=v.map(function(ge){return new o(c,d,j[ge],z,B[ge].text,void 0,B[ge].align)}),this.setTableHeaderRow(C),this.printHeaderRow(1,!1)}var U=f.reduce(function(ge,Ae){return ge[Ae.name]=Ae.align,ge},{});for(m=0;m<u.length;m+=1){"rowStart"in h&&h.rowStart instanceof Function&&h.rowStart({row:m,data:u[m]},this);var L=l.call(this,u[m],j);for(g=0;g<v.length;g+=1){var W=u[m][v[g]];"cellStart"in h&&h.cellStart instanceof Function&&h.cellStart({row:m,col:g,data:W},this),i.call(this,new o(c,d,j[v[g]],L,W,m+2,U[v[g]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=d,this};var l=function(c,d){var u=this.internal.__cell__.padding,f=this.internal.__cell__.table_font_size,h=this.internal.scaleFactor;return Object.keys(c).map(function(m){var x=c[m];return this.splitTextToSize(x.hasOwnProperty("text")?x.text:x,d[m]-u-u)},this).map(function(m){return this.getLineHeightFactor()*m.length*f/h+u+u},this).reduce(function(m,x){return Math.max(m,x)},0)};e.setTableHeaderRow=function(c){n.call(this),this.internal.__cell__.tableHeaderRow=c},e.printHeaderRow=function(c,d){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var u;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var f=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(f[0],f[1],f[2],f[3],void 0,-1)}this.setFont(void 0,"bold");for(var h=[],m=0;m<this.internal.__cell__.tableHeaderRow.length;m+=1){u=this.internal.__cell__.tableHeaderRow[m].clone(),d&&(u.y=this.internal.__cell__.margins.top||0,h.push(u)),u.lineNumber=c;var x=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),i.call(this,u),this.setTextColor(x)}h.length>0&&this.setTableHeaderRow(h),this.setFont(void 0,"normal"),r=!1}}(da.API);var Rae={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Fae=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],k3=Mae(Fae),Lae=[100,200,300,400,500,600,700,800,900],KQe=Mae(Lae);function uk(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(o){return Rae[o=o||"normal"]?o:"normal"}(e.style),n=function(o){return o?typeof o=="number"?o>=100&&o<=900&&o%100==0?o:400:/^\d00$/.test(o)?parseInt(o):o==="bold"?700:400:400}(e.weight),s=function(o){return typeof k3[o=o||"normal"]=="number"?o:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:s,src:e.src||[],ref:e.ref||{name:t,style:[s,r,n].join(" ")}}}function rU(e,t,r,n){var s;for(s=r;s>=0&&s<t.length;s+=n)if(e[t[s]])return e[t[s]];for(s=r;s>=0&&s<t.length;s-=n)if(e[t[s]])return e[t[s]]}var XQe={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},nU={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function aU(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function sU(e){return e.trimLeft()}function YQe(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function JQe(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var Y_,oU,iU,Wx,J_,lU,cU,dU,fk=["times"];function uU(e,t,r,n,s){var o=4,i=mU;switch(s){case da.API.image_compression.FAST:o=1,i=fU;break;case da.API.image_compression.MEDIUM:o=6,i=hU;break;case da.API.image_compression.SLOW:o=9,i=pU}e=function(c,d,u,f){for(var h,m=c.length/d,x=new Uint8Array(c.length+m),g=[QQe,fU,mU,hU,pU],y=0;y<m;y+=1){var v=y*d,b=c.subarray(v,v+d);if(f)x.set(f(b,u,h),v+y);else{for(var w=g.length,_=[],j=0;j<w;j+=1)_[j]=g[j](b,u,h);var S=eZe(_.concat());x.set(_[S],v+y)}h=b}return x}(e,t,Math.ceil(r*n/8),i);var l=x3(e,{level:o});return da.API.__addimage__.arrayBufferToBinaryString(l)}function QQe(e){var t=Array.apply([],e);return t.unshift(0),t}function fU(e,t){var r=e.length,n=[];n[0]=1;for(var s=0;s<r;s+=1){var o=e[s-t]||0;n[s+1]=e[s]-o+256&255}return n}function mU(e,t,r){var n=e.length,s=[];s[0]=2;for(var o=0;o<n;o+=1){var i=r&&r[o]||0;s[o+1]=e[o]-i+256&255}return s}function hU(e,t,r){var n=e.length,s=[];s[0]=3;for(var o=0;o<n;o+=1){var i=e[o-t]||0,l=r&&r[o]||0;s[o+1]=e[o]+256-(i+l>>>1)&255}return s}function pU(e,t,r){var n=e.length,s=[];s[0]=4;for(var o=0;o<n;o+=1){var i=ZQe(e[o-t]||0,r&&r[o]||0,r&&r[o-t]||0);s[o+1]=e[o]-i+256&255}return s}function ZQe(e,t,r){if(e===t&&t===r)return e;var n=Math.abs(t-r),s=Math.abs(e-r),o=Math.abs(e+t-r-r);return n<=s&&n<=o?e:s<=o?t:r}function eZe(e){var t=e.map(function(r){return r.reduce(function(n,s){return n+Math.abs(s)},0)});return t.indexOf(Math.min.apply(null,t))}function mk(e,t,r){var n=t*r,s=Math.floor(n/8),o=16-(n-8*s+r),i=(1<<r)-1;return $ae(e,s)>>o&i}function gU(e,t,r,n){var s=r*n,o=Math.floor(s/8),i=16-(s-8*o+n),l=(1<<n)-1,c=(t&l)<<i;(function(d,u,f){if(u+1<d.byteLength)d.setUint16(u,f,!1);else{var h=f>>8&255;d.setUint8(u,h)}})(e,o,$ae(e,o)&~(l<<i)&65535|c)}function $ae(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function tZe(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,s=e[t++],o=s>>7,i=1<<1+(7&s);e[t++],e[t++];var l=null,c=null;o&&(l=t,c=i,t+=3*i);var d=!0,u=[],f=0,h=null,m=0,x=null;for(this.width=r,this.height=n;d&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,x=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var g=e[t++];f=e[t++]|e[t++]<<8,h=e[t++],1&g||(h=null),m=g>>2&7,t++;break;case 254:for(;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var y=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,_=e[t++],j=_>>6&1,S=1<<1+(7&_),C=l,A=c,P=!1;_>>7&&(P=!0,C=t,A=S,t+=3*S);var F=t;for(t++;;){var O;if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}u.push({x:y,y:v,width:b,height:w,has_local_palette:P,palette_offset:C,palette_size:A,data_offset:F,data_length:t-F,transparent_index:h,interlaced:!!j,delay:f,disposal:m});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return x},this.frameInfo=function(I){if(I<0||I>=u.length)throw new Error("Frame index out of range.");return u[I]},this.decodeAndBlitFrameBGRA=function(I,T){var k=this.frameInfo(I),B=k.width*k.height,z=new Uint8Array(B);xU(e,k.data_offset,z,B);var U=k.palette_offset,L=k.transparent_index;L===null&&(L=256);var W=k.width,ge=r-W,Ae=W,V=4*(k.y*r+k.x),$=4*((k.y+k.height)*r+k.x),Y=V,he=4*ge;k.interlaced===!0&&(he+=4*r*7);for(var J=8,G=0,ue=z.length;G<ue;++G){var ve=z[G];if(Ae===0&&(Ae=W,(Y+=he)>=$&&(he=4*ge+4*r*(J-1),Y=V+(W+ge)*(J<<1),J>>=1)),ve===L)Y+=4;else{var ae=e[U+3*ve],oe=e[U+3*ve+1],me=e[U+3*ve+2];T[Y++]=me,T[Y++]=oe,T[Y++]=ae,T[Y++]=255}--Ae}},this.decodeAndBlitFrameRGBA=function(I,T){var k=this.frameInfo(I),B=k.width*k.height,z=new Uint8Array(B);xU(e,k.data_offset,z,B);var U=k.palette_offset,L=k.transparent_index;L===null&&(L=256);var W=k.width,ge=r-W,Ae=W,V=4*(k.y*r+k.x),$=4*((k.y+k.height)*r+k.x),Y=V,he=4*ge;k.interlaced===!0&&(he+=4*r*7);for(var J=8,G=0,ue=z.length;G<ue;++G){var ve=z[G];if(Ae===0&&(Ae=W,(Y+=he)>=$&&(he=4*ge+4*r*(J-1),Y=V+(W+ge)*(J<<1),J>>=1)),ve===L)Y+=4;else{var ae=e[U+3*ve],oe=e[U+3*ve+1],me=e[U+3*ve+2];T[Y++]=ae,T[Y++]=oe,T[Y++]=me,T[Y++]=255}--Ae}}}function xU(e,t,r,n){for(var s=e[t++],o=1<<s,i=o+1,l=i+1,c=s+1,d=(1<<c)-1,u=0,f=0,h=0,m=e[t++],x=new Int32Array(4096),g=null;;){for(;u<16&&m!==0;)f|=e[t++]<<u,u+=8,m===1?m=e[t++]:--m;if(u<c)break;var y=f&d;if(f>>=c,u-=c,y!==o){if(y===i)break;for(var v=y<l?y:g,b=0,w=v;w>o;)w=x[w]>>8,++b;var _=w;if(h+b+(v!==y?1:0)>n)return void Qs.log("Warning, gif stream longer than expected.");r[h++]=_;var j=h+=b;for(v!==y&&(r[h++]=_),w=v;b--;)w=x[w],r[--j]=255&w,w>>=8;g!==null&&l<4096&&(x[l++]=g<<8|_,l>=d+1&&c<12&&(++c,d=d<<1|1)),g=y}else l=i+1,d=(1<<(c=s+1))-1,g=null}return h!==n&&Qs.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function hk(e){var t,r,n,s,o,i=Math.floor,l=new Array(64),c=new Array(64),d=new Array(64),u=new Array(64),f=new Array(65535),h=new Array(65535),m=new Array(64),x=new Array(64),g=[],y=0,v=7,b=new Array(64),w=new Array(64),_=new Array(64),j=new Array(256),S=new Array(2048),C=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],A=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],P=[0,1,2,3,4,5,6,7,8,9,10,11],F=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],O=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],k=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],B=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function z(V,$){for(var Y=0,he=0,J=new Array,G=1;G<=16;G++){for(var ue=1;ue<=V[G];ue++)J[$[he]]=[],J[$[he]][0]=Y,J[$[he]][1]=G,he++,Y++;Y*=2}return J}function U(V){for(var $=V[0],Y=V[1]-1;Y>=0;)$&1<<Y&&(y|=1<<v),Y--,--v<0&&(y==255?(L(255),L(0)):L(y),v=7,y=0)}function L(V){g.push(V)}function W(V){L(V>>8&255),L(255&V)}function ge(V,$,Y,he,J){for(var G,ue=J[0],ve=J[240],ae=function(vt,wt){var gt,er,_e,Pt,Lt,gr,fr,je,nt,$t,Ut=0;for(nt=0;nt<8;++nt){gt=vt[Ut],er=vt[Ut+1],_e=vt[Ut+2],Pt=vt[Ut+3],Lt=vt[Ut+4],gr=vt[Ut+5],fr=vt[Ut+6];var Fe=gt+(je=vt[Ut+7]),xt=gt-je,Ot=er+fr,Cr=er-fr,Me=_e+gr,Qe=_e-gr,et=Pt+Lt,Yt=Pt-Lt,xr=Fe+et,Jt=Fe-et,kr=Ot+Me,_r=Ot-Me;vt[Ut]=xr+kr,vt[Ut+4]=xr-kr;var Rr=.707106781*(_r+Jt);vt[Ut+2]=Jt+Rr,vt[Ut+6]=Jt-Rr;var nn=.382683433*((xr=Yt+Qe)-(_r=Cr+xt)),rn=.5411961*xr+nn,Ke=1.306562965*_r+nn,qe=.707106781*(kr=Qe+Cr),ze=xt+qe,Je=xt-qe;vt[Ut+5]=Je+rn,vt[Ut+3]=Je-rn,vt[Ut+1]=ze+Ke,vt[Ut+7]=ze-Ke,Ut+=8}for(Ut=0,nt=0;nt<8;++nt){gt=vt[Ut],er=vt[Ut+8],_e=vt[Ut+16],Pt=vt[Ut+24],Lt=vt[Ut+32],gr=vt[Ut+40],fr=vt[Ut+48];var kt=gt+(je=vt[Ut+56]),ct=gt-je,tr=er+fr,dt=er-fr,Mt=_e+gr,ce=_e-gr,Xe=Pt+Lt,Qt=Pt-Lt,Tt=kt+Xe,Ar=kt-Xe,nr=tr+Mt,Jr=tr-Mt;vt[Ut]=Tt+nr,vt[Ut+32]=Tt-nr;var gn=.707106781*(Jr+Ar);vt[Ut+16]=Ar+gn,vt[Ut+48]=Ar-gn;var tt=.382683433*((Tt=Qt+ce)-(Jr=dt+ct)),jr=.5411961*Tt+tt,ua=1.306562965*Jr+tt,Oe=.707106781*(nr=ce+dt),Wt=ct+Oe,Ht=ct-Oe;vt[Ut+40]=Ht+jr,vt[Ut+24]=Ht-jr,vt[Ut+8]=Wt+ua,vt[Ut+56]=Wt-ua,Ut++}for(nt=0;nt<64;++nt)$t=vt[nt]*wt[nt],m[nt]=$t>0?$t+.5|0:$t-.5|0;return m}(V,$),oe=0;oe<64;++oe)x[C[oe]]=ae[oe];var me=x[0]-Y;Y=x[0],me==0?U(he[0]):(U(he[h[G=32767+me]]),U(f[G]));for(var De=63;De>0&&x[De]==0;)De--;if(De==0)return U(ue),Y;for(var ne,ie=1;ie<=De;){for(var ht=ie;x[ie]==0&&ie<=De;)++ie;var pt=ie-ht;if(pt>=16){ne=pt>>4;for(var Ze=1;Ze<=ne;++Ze)U(ve);pt&=15}G=32767+x[ie],U(J[(pt<<4)+h[G]]),U(f[G]),ie++}return De!=63&&U(ue),Y}function Ae(V){V=Math.min(Math.max(V,1),100),o!=V&&(function($){for(var Y=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],he=0;he<64;he++){var J=i((Y[he]*$+50)/100);J=Math.min(Math.max(J,1),255),l[C[he]]=J}for(var G=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ue=0;ue<64;ue++){var ve=i((G[ue]*$+50)/100);ve=Math.min(Math.max(ve,1),255),c[C[ue]]=ve}for(var ae=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],oe=0,me=0;me<8;me++)for(var De=0;De<8;De++)d[oe]=1/(l[C[oe]]*ae[me]*ae[De]*8),u[oe]=1/(c[C[oe]]*ae[me]*ae[De]*8),oe++}(V<50?Math.floor(5e3/V):Math.floor(200-2*V)),o=V)}this.encode=function(V,$){$&&Ae($),g=new Array,y=0,v=7,W(65496),W(65504),W(16),L(74),L(70),L(73),L(70),L(0),L(1),L(1),L(0),W(1),W(1),L(0),L(0),function(){W(65499),W(132),L(0);for(var er=0;er<64;er++)L(l[er]);L(1);for(var _e=0;_e<64;_e++)L(c[_e])}(),function(er,_e){W(65472),W(17),L(8),W(_e),W(er),L(3),L(1),L(17),L(0),L(2),L(17),L(1),L(3),L(17),L(1)}(V.width,V.height),function(){W(65476),W(418),L(0);for(var er=0;er<16;er++)L(A[er+1]);for(var _e=0;_e<=11;_e++)L(P[_e]);L(16);for(var Pt=0;Pt<16;Pt++)L(F[Pt+1]);for(var Lt=0;Lt<=161;Lt++)L(O[Lt]);L(1);for(var gr=0;gr<16;gr++)L(I[gr+1]);for(var fr=0;fr<=11;fr++)L(T[fr]);L(17);for(var je=0;je<16;je++)L(k[je+1]);for(var nt=0;nt<=161;nt++)L(B[nt])}(),W(65498),W(12),L(3),L(1),L(0),L(2),L(17),L(3),L(17),L(0),L(63),L(0);var Y=0,he=0,J=0;y=0,v=7,this.encode.displayName="_encode_";for(var G,ue,ve,ae,oe,me,De,ne,ie,ht=V.data,pt=V.width,Ze=V.height,vt=4*pt,wt=0;wt<Ze;){for(G=0;G<vt;){for(oe=vt*wt+G,De=-1,ne=0,ie=0;ie<64;ie++)me=oe+(ne=ie>>3)*vt+(De=4*(7&ie)),wt+ne>=Ze&&(me-=vt*(wt+1+ne-Ze)),G+De>=vt&&(me-=G+De-vt+4),ue=ht[me++],ve=ht[me++],ae=ht[me++],b[ie]=(S[ue]+S[ve+256|0]+S[ae+512|0]>>16)-128,w[ie]=(S[ue+768|0]+S[ve+1024|0]+S[ae+1280|0]>>16)-128,_[ie]=(S[ue+1280|0]+S[ve+1536|0]+S[ae+1792|0]>>16)-128;Y=ge(b,d,Y,t,n),he=ge(w,u,he,r,s),J=ge(_,u,J,r,s),G+=32}wt+=8}if(v>=0){var gt=[];gt[1]=v+1,gt[0]=(1<<v+1)-1,U(gt)}return W(65497),new Uint8Array(g)},e=e||50,function(){for(var V=String.fromCharCode,$=0;$<256;$++)j[$]=V($)}(),t=z(A,P),r=z(I,T),n=z(F,O),s=z(k,B),function(){for(var V=1,$=2,Y=1;Y<=15;Y++){for(var he=V;he<$;he++)h[32767+he]=Y,f[32767+he]=[],f[32767+he][1]=Y,f[32767+he][0]=he;for(var J=-($-1);J<=-V;J++)h[32767+J]=Y,f[32767+J]=[],f[32767+J][1]=Y,f[32767+J][0]=$-1+J;V<<=1,$<<=1}}(),function(){for(var V=0;V<256;V++)S[V]=19595*V,S[V+256|0]=38470*V,S[V+512|0]=7471*V+32768,S[V+768|0]=-11059*V,S[V+1024|0]=-21709*V,S[V+1280|0]=32768*V+8421375,S[V+1536|0]=-27439*V,S[V+1792|0]=-5329*V}(),Ae(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function bu(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function vU(e){function t(P){if(!P)throw Error("assert :P")}function r(P,F,O){for(var I=0;4>I;I++)if(P[F+I]!=O.charCodeAt(I))return!0;return!1}function n(P,F,O,I,T){for(var k=0;k<T;k++)P[F+k]=O[I+k]}function s(P,F,O,I){for(var T=0;T<I;T++)P[F+T]=O}function o(P){return new Int32Array(P)}function i(P,F){for(var O=[],I=0;I<P;I++)O.push(new F);return O}function l(P,F){var O=[];return function I(T,k,B){for(var z=B[k],U=0;U<z&&(T.push(B.length>k+1?[]:new F),!(B.length<k+1));U++)I(T[U],k+1,B)}(O,0,P),O}var c=function(){var P=this;function F(N,E){for(var q=1<<E-1>>>0;N&q;)q>>>=1;return q?(N&q-1)+q:N}function O(N,E,q,K,fe){t(!(K%q));do N[E+(K-=q)]=fe;while(0<K)}function I(N,E,q,K,fe){if(t(2328>=fe),512>=fe)var be=o(512);else if((be=o(fe))==null)return 0;return function(xe,Pe,Ie,We,_t,Vt){var Ve,At,Zt=Pe,Or=1<<Ie,ir=o(16),Br=o(16);for(t(_t!=0),t(We!=null),t(xe!=null),t(0<Ie),At=0;At<_t;++At){if(15<We[At])return 0;++ir[We[At]]}if(ir[0]==_t)return 0;for(Br[1]=0,Ve=1;15>Ve;++Ve){if(ir[Ve]>1<<Ve)return 0;Br[Ve+1]=Br[Ve]+ir[Ve]}for(At=0;At<_t;++At)Ve=We[At],0<We[At]&&(Vt[Br[Ve]++]=At);if(Br[15]==1)return(We=new T).g=0,We.value=Vt[0],O(xe,Zt,1,Or,We),Or;var Ur,mn=-1,sn=Or-1,ma=0,ra=1,Ja=1,ia=1<<Ie;for(At=0,Ve=1,_t=2;Ve<=Ie;++Ve,_t<<=1){if(ra+=Ja<<=1,0>(Ja-=ir[Ve]))return 0;for(;0<ir[Ve];--ir[Ve])(We=new T).g=Ve,We.value=Vt[At++],O(xe,Zt+ma,_t,ia,We),ma=F(ma,Ve)}for(Ve=Ie+1,_t=2;15>=Ve;++Ve,_t<<=1){if(ra+=Ja<<=1,0>(Ja-=ir[Ve]))return 0;for(;0<ir[Ve];--ir[Ve]){if(We=new T,(ma&sn)!=mn){for(Zt+=ia,Ur=1<<(mn=Ve)-Ie;15>mn&&!(0>=(Ur-=ir[mn]));)++mn,Ur<<=1;Or+=ia=1<<(Ur=mn-Ie),xe[Pe+(mn=ma&sn)].g=Ur+Ie,xe[Pe+mn].value=Zt-Pe-mn}We.g=Ve-Ie,We.value=Vt[At++],O(xe,Zt+(ma>>Ie),_t,ia,We),ma=F(ma,Ve)}}return ra!=2*Br[15]-1?0:Or}(N,E,q,K,fe,be)}function T(){this.value=this.g=0}function k(){this.value=this.g=0}function B(){this.G=i(5,T),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=i(Q,k)}function z(N,E,q,K){t(N!=null),t(E!=null),t(2147483648>K),N.Ca=254,N.I=0,N.b=-8,N.Ka=0,N.oa=E,N.pa=q,N.Jd=E,N.Yc=q+K,N.Zc=4<=K?q+K-4+1:q,ue(N)}function U(N,E){for(var q=0;0<E--;)q|=ae(N,128)<<E;return q}function L(N,E){var q=U(N,E);return ve(N)?-q:q}function W(N,E,q,K){var fe,be=0;for(t(N!=null),t(E!=null),t(4294967288>K),N.Sb=K,N.Ra=0,N.u=0,N.h=0,4<K&&(K=4),fe=0;fe<K;++fe)be+=E[q+fe]<<8*fe;N.Ra=be,N.bb=K,N.oa=E,N.pa=q}function ge(N){for(;8<=N.u&&N.bb<N.Sb;)N.Ra>>>=8,N.Ra+=N.oa[N.pa+N.bb]<<le-8>>>0,++N.bb,N.u-=8;he(N)&&(N.h=1,N.u=0)}function Ae(N,E){if(t(0<=E),!N.h&&E<=H){var q=Y(N)&M[E];return N.u+=E,ge(N),q}return N.h=1,N.u=0}function V(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function $(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Y(N){return N.Ra>>>(N.u&le-1)>>>0}function he(N){return t(N.bb<=N.Sb),N.h||N.bb==N.Sb&&N.u>le}function J(N,E){N.u=E,N.h=he(N)}function G(N){N.u>=X&&(t(N.u>=X),ge(N))}function ue(N){t(N!=null&&N.oa!=null),N.pa<N.Zc?(N.I=(N.oa[N.pa++]|N.I<<8)>>>0,N.b+=8):(t(N!=null&&N.oa!=null),N.pa<N.Yc?(N.b+=8,N.I=N.oa[N.pa++]|N.I<<8):N.Ka?N.b=0:(N.I<<=8,N.b+=8,N.Ka=1))}function ve(N){return U(N,1)}function ae(N,E){var q=N.Ca;0>N.b&&ue(N);var K=N.b,fe=q*E>>>8,be=(N.I>>>K>fe)+0;for(be?(q-=fe,N.I-=fe+1<<K>>>0):q=fe+1,K=q,fe=0;256<=K;)fe+=8,K>>=8;return K=7^fe+Ce[K],N.b-=K,N.Ca=(q<<K)-1,be}function oe(N,E,q){N[E+0]=q>>24&255,N[E+1]=q>>16&255,N[E+2]=q>>8&255,N[E+3]=255&q}function me(N,E){return N[E+0]|N[E+1]<<8}function De(N,E){return me(N,E)|N[E+2]<<16}function ne(N,E){return me(N,E)|me(N,E+2)<<16}function ie(N,E){var q=1<<E;return t(N!=null),t(0<E),N.X=o(q),N.X==null?0:(N.Mb=32-E,N.Xa=E,1)}function ht(N,E){t(N!=null),t(E!=null),t(N.Xa==E.Xa),n(E.X,0,N.X,0,1<<E.Xa)}function pt(){this.X=[],this.Xa=this.Mb=0}function Ze(N,E,q,K){t(q!=null),t(K!=null);var fe=q[0],be=K[0];return fe==0&&(fe=(N*be+E/2)/E),be==0&&(be=(E*fe+N/2)/N),0>=fe||0>=be?0:(q[0]=fe,K[0]=be,1)}function vt(N,E){return N+(1<<E)-1>>>E}function wt(N,E){return((4278255360&N)+(4278255360&E)>>>0&4278255360)+((16711935&N)+(16711935&E)>>>0&16711935)>>>0}function gt(N,E){P[E]=function(q,K,fe,be,xe,Pe,Ie){var We;for(We=0;We<xe;++We){var _t=P[N](Pe[Ie+We-1],fe,be+We);Pe[Ie+We]=wt(q[K+We],_t)}}}function er(){this.ud=this.hd=this.jd=0}function _e(N,E){return((4278124286&(N^E))>>>1)+(N&E)>>>0}function Pt(N){return 0<=N&&256>N?N:0>N?0:255<N?255:void 0}function Lt(N,E){return Pt(N+(N-E+.5>>1))}function gr(N,E,q){return Math.abs(E-q)-Math.abs(N-q)}function fr(N,E,q,K,fe,be,xe){for(K=be[xe-1],q=0;q<fe;++q)be[xe+q]=K=wt(N[E+q],K)}function je(N,E,q,K,fe){var be;for(be=0;be<q;++be){var xe=N[E+be],Pe=xe>>8&255,Ie=16711935&(Ie=(Ie=16711935&xe)+((Pe<<16)+Pe));K[fe+be]=(4278255360&xe)+Ie>>>0}}function nt(N,E){E.jd=255&N,E.hd=N>>8&255,E.ud=N>>16&255}function $t(N,E,q,K,fe,be){var xe;for(xe=0;xe<K;++xe){var Pe=E[q+xe],Ie=Pe>>>8,We=Pe,_t=255&(_t=(_t=Pe>>>16)+((N.jd<<24>>24)*(Ie<<24>>24)>>>5));We=255&(We=(We+=(N.hd<<24>>24)*(Ie<<24>>24)>>>5)+((N.ud<<24>>24)*(_t<<24>>24)>>>5)),fe[be+xe]=(4278255360&Pe)+(_t<<16)+We}}function Ut(N,E,q,K,fe){P[E]=function(be,xe,Pe,Ie,We,_t,Vt,Ve,At){for(Ie=Vt;Ie<Ve;++Ie)for(Vt=0;Vt<At;++Vt)We[_t++]=fe(Pe[K(be[xe++])])},P[N]=function(be,xe,Pe,Ie,We,_t,Vt){var Ve=8>>be.b,At=be.Ea,Zt=be.K[0],Or=be.w;if(8>Ve)for(be=(1<<be.b)-1,Or=(1<<Ve)-1;xe<Pe;++xe){var ir,Br=0;for(ir=0;ir<At;++ir)ir&be||(Br=K(Ie[We++])),_t[Vt++]=fe(Zt[Br&Or]),Br>>=Ve}else P["VP8LMapColor"+q](Ie,We,Zt,Or,_t,Vt,xe,Pe,At)}}function Fe(N,E,q,K,fe){for(q=E+q;E<q;){var be=N[E++];K[fe++]=be>>16&255,K[fe++]=be>>8&255,K[fe++]=255&be}}function xt(N,E,q,K,fe){for(q=E+q;E<q;){var be=N[E++];K[fe++]=be>>16&255,K[fe++]=be>>8&255,K[fe++]=255&be,K[fe++]=be>>24&255}}function Ot(N,E,q,K,fe){for(q=E+q;E<q;){var be=(xe=N[E++])>>16&240|xe>>12&15,xe=240&xe|xe>>28&15;K[fe++]=be,K[fe++]=xe}}function Cr(N,E,q,K,fe){for(q=E+q;E<q;){var be=(xe=N[E++])>>16&248|xe>>13&7,xe=xe>>5&224|xe>>3&31;K[fe++]=be,K[fe++]=xe}}function Me(N,E,q,K,fe){for(q=E+q;E<q;){var be=N[E++];K[fe++]=255&be,K[fe++]=be>>8&255,K[fe++]=be>>16&255}}function Qe(N,E,q,K,fe,be){if(be==0)for(q=E+q;E<q;)oe(K,((be=N[E++])[0]>>24|be[1]>>8&65280|be[2]<<8&16711680|be[3]<<24)>>>0),fe+=32;else n(K,fe,N,E,q)}function et(N,E){P[E][0]=P[N+"0"],P[E][1]=P[N+"1"],P[E][2]=P[N+"2"],P[E][3]=P[N+"3"],P[E][4]=P[N+"4"],P[E][5]=P[N+"5"],P[E][6]=P[N+"6"],P[E][7]=P[N+"7"],P[E][8]=P[N+"8"],P[E][9]=P[N+"9"],P[E][10]=P[N+"10"],P[E][11]=P[N+"11"],P[E][12]=P[N+"12"],P[E][13]=P[N+"13"],P[E][14]=P[N+"0"],P[E][15]=P[N+"0"]}function Yt(N){return N==tf||N==ji||N==rf||N==Ip}function xr(){this.eb=[],this.size=this.A=this.fb=0}function Jt(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function kr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new xr,this.f.kb=new Jt,this.sd=null}function _r(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Rr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function nn(N){return alert("todo:WebPSamplerProcessPlane"),N.T}function rn(N,E){var q=N.T,K=E.ba.f.RGBA,fe=K.eb,be=K.fb+N.ka*K.A,xe=Fi[E.ba.S],Pe=N.y,Ie=N.O,We=N.f,_t=N.N,Vt=N.ea,Ve=N.W,At=E.cc,Zt=E.dc,Or=E.Mc,ir=E.Nc,Br=N.ka,Ur=N.ka+N.T,mn=N.U,sn=mn+1>>1;for(Br==0?xe(Pe,Ie,null,null,We,_t,Vt,Ve,We,_t,Vt,Ve,fe,be,null,null,mn):(xe(E.ec,E.fc,Pe,Ie,At,Zt,Or,ir,We,_t,Vt,Ve,fe,be-K.A,fe,be,mn),++q);Br+2<Ur;Br+=2)At=We,Zt=_t,Or=Vt,ir=Ve,_t+=N.Rc,Ve+=N.Rc,be+=2*K.A,xe(Pe,(Ie+=2*N.fa)-N.fa,Pe,Ie,At,Zt,Or,ir,We,_t,Vt,Ve,fe,be-K.A,fe,be,mn);return Ie+=N.fa,N.j+Ur<N.o?(n(E.ec,E.fc,Pe,Ie,mn),n(E.cc,E.dc,We,_t,sn),n(E.Mc,E.Nc,Vt,Ve,sn),q--):1&Ur||xe(Pe,Ie,null,null,We,_t,Vt,Ve,We,_t,Vt,Ve,fe,be+K.A,null,null,mn),q}function Ke(N,E,q){var K=N.F,fe=[N.J];if(K!=null){var be=N.U,xe=E.ba.S,Pe=xe==mu||xe==rf;E=E.ba.f.RGBA;var Ie=[0],We=N.ka;Ie[0]=N.T,N.Kb&&(We==0?--Ie[0]:(--We,fe[0]-=N.width),N.j+N.ka+N.T==N.o&&(Ie[0]=N.o-N.j-We));var _t=E.eb;We=E.fb+We*E.A,N=Ys(K,fe[0],N.width,be,Ie,_t,We+(Pe?0:3),E.A),t(q==Ie),N&&Yt(xe)&&to(_t,We,Pe,be,Ie,E.A)}return 0}function qe(N){var E=N.ma,q=E.ba.S,K=11>q,fe=q==Fl||q==_x||q==mu||q==ef||q==12||Yt(q);if(E.memory=null,E.Ib=null,E.Jb=null,E.Nd=null,!wr(E.Oa,N,fe?11:12))return 0;if(fe&&Yt(q)&&ln(),N.da)alert("todo:use_scaling");else{if(K){if(E.Ib=nn,N.Kb){if(q=N.U+1>>1,E.memory=o(N.U+2*q),E.memory==null)return 0;E.ec=E.memory,E.fc=0,E.cc=E.ec,E.dc=E.fc+N.U,E.Mc=E.cc,E.Nc=E.dc+q,E.Ib=rn,ln()}}else alert("todo:EmitYUV");fe&&(E.Jb=Ke,K&&Vr())}if(K&&!Li){for(N=0;256>N;++N)yl[N]=89858*(N-128)+ya>>fn,Pd[N]=-22014*(N-128)+ya,$l[N]=-45773*(N-128),Ad[N]=113618*(N-128)+ya>>fn;for(N=Za;N<Fa;++N)E=76283*(N-16)+ya>>fn,Vm[N-Za]=tn(E,255),ws[N-Za]=tn(E+8>>4,15);Li=1}return 1}function ze(N){var E=N.ma,q=N.U,K=N.T;return t(!(1&N.ka)),0>=q||0>=K?0:(q=E.Ib(N,E),E.Jb!=null&&E.Jb(N,E,q),E.Dc+=q,1)}function Je(N){N.ma.memory=null}function kt(N,E,q,K){return Ae(N,8)!=47?0:(E[0]=Ae(N,14)+1,q[0]=Ae(N,14)+1,K[0]=Ae(N,1),Ae(N,3)!=0?0:!N.h)}function ct(N,E){if(4>N)return N+1;var q=N-2>>1;return(2+(1&N)<<q)+Ae(E,q)+1}function tr(N,E){return 120<E?E-120:1<=(q=((q=_y[E-1])>>4)*N+(8-(15&q)))?q:1;var q}function dt(N,E,q){var K=Y(q),fe=N[E+=255&K].g-8;return 0<fe&&(J(q,q.u+8),K=Y(q),E+=N[E].value,E+=K&(1<<fe)-1),J(q,q.u+N[E].g),N[E].value}function Mt(N,E,q){return q.g+=N.g,q.value+=N.value<<E>>>0,t(8>=q.g),N.g}function ce(N,E,q){var K=N.xc;return t((E=K==0?0:N.vc[N.md*(q>>K)+(E>>K)])<N.Wb),N.Ya[E]}function Xe(N,E,q,K){var fe=N.ab,be=N.c*E,xe=N.C;E=xe+E;var Pe=q,Ie=K;for(K=N.Ta,q=N.Ua;0<fe--;){var We=N.gc[fe],_t=xe,Vt=E,Ve=Pe,At=Ie,Zt=(Ie=K,Pe=q,We.Ea);switch(t(_t<Vt),t(Vt<=We.nc),We.hc){case 2:ye(Ve,At,(Vt-_t)*Zt,Ie,Pe);break;case 0:var Or=_t,ir=Vt,Br=Ie,Ur=Pe,mn=(ia=We).Ea;Or==0&&(we(Ve,At,null,null,1,Br,Ur),fr(Ve,At+1,0,0,mn-1,Br,Ur+1),At+=mn,Ur+=mn,++Or);for(var sn=1<<ia.b,ma=sn-1,ra=vt(mn,ia.b),Ja=ia.K,ia=ia.w+(Or>>ia.b)*ra;Or<ir;){var us=Ja,Ni=ia,Qa=1;for(Z(Ve,At,Br,Ur-mn,1,Br,Ur);Qa<mn;){var la=(Qa&~ma)+sn;la>mn&&(la=mn),(0,dr[us[Ni++]>>8&15])(Ve,At+ +Qa,Br,Ur+Qa-mn,la-Qa,Br,Ur+Qa),Qa=la}At+=mn,Ur+=mn,++Or&ma||(ia+=ra)}Vt!=We.nc&&n(Ie,Pe-Zt,Ie,Pe+(Vt-_t-1)*Zt,Zt);break;case 1:for(Zt=Ve,ir=At,mn=(Ve=We.Ea)-(Ur=Ve&~(Br=(At=1<<We.b)-1)),Or=vt(Ve,We.b),sn=We.K,We=We.w+(_t>>We.b)*Or;_t<Vt;){for(ma=sn,ra=We,Ja=new er,ia=ir+Ur,us=ir+Ve;ir<ia;)nt(ma[ra++],Ja),qt(Ja,Zt,ir,At,Ie,Pe),ir+=At,Pe+=At;ir<us&&(nt(ma[ra++],Ja),qt(Ja,Zt,ir,mn,Ie,Pe),ir+=mn,Pe+=mn),++_t&Br||(We+=Or)}break;case 3:if(Ve==Ie&&At==Pe&&0<We.b){for(ir=Ie,Ve=Zt=Pe+(Vt-_t)*Zt-(Ur=(Vt-_t)*vt(We.Ea,We.b)),At=Ie,Br=Pe,Or=[],Ur=(mn=Ur)-1;0<=Ur;--Ur)Or[Ur]=At[Br+Ur];for(Ur=mn-1;0<=Ur;--Ur)ir[Ve+Ur]=Or[Ur];Ne(We,_t,Vt,Ie,Zt,Ie,Pe)}else Ne(We,_t,Vt,Ve,At,Ie,Pe)}Pe=K,Ie=q}Ie!=q&&n(K,q,Pe,Ie,be)}function Qt(N,E){var q=N.V,K=N.Ba+N.c*N.C,fe=E-N.C;if(t(E<=N.l.o),t(16>=fe),0<fe){var be=N.l,xe=N.Ta,Pe=N.Ua,Ie=be.width;if(Xe(N,fe,q,K),fe=Pe=[Pe],t((q=N.C)<(K=E)),t(be.v<be.va),K>be.o&&(K=be.o),q<be.j){var We=be.j-q;q=be.j,fe[0]+=We*Ie}if(q>=K?q=0:(fe[0]+=4*be.v,be.ka=q-be.j,be.U=be.va-be.v,be.T=K-q,q=1),q){if(Pe=Pe[0],11>(q=N.ca).S){var _t=q.f.RGBA,Vt=(K=q.S,fe=be.U,be=be.T,We=_t.eb,_t.A),Ve=be;for(_t=_t.fb+N.Ma*_t.A;0<Ve--;){var At=xe,Zt=Pe,Or=fe,ir=We,Br=_t;switch(K){case wx:rr(At,Zt,Or,ir,Br);break;case Fl:qr(At,Zt,Or,ir,Br);break;case tf:qr(At,Zt,Or,ir,Br),to(ir,Br,0,Or,1,0);break;case Ll:xn(At,Zt,Or,ir,Br);break;case _x:Qe(At,Zt,Or,ir,Br,1);break;case ji:Qe(At,Zt,Or,ir,Br,1),to(ir,Br,0,Or,1,0);break;case mu:Qe(At,Zt,Or,ir,Br,0);break;case rf:Qe(At,Zt,Or,ir,Br,0),to(ir,Br,1,Or,1,0);break;case ef:Dn(At,Zt,Or,ir,Br);break;case Ip:Dn(At,Zt,Or,ir,Br),Ts(ir,Br,Or,1,0);break;case zf:$r(At,Zt,Or,ir,Br);break;default:t(0)}Pe+=Ie,_t+=Vt}N.Ma+=be}else alert("todo:EmitRescaledRowsYUVA");t(N.Ma<=q.height)}}N.C=E,t(N.C<=N.i)}function Tt(N){var E;if(0<N.ua)return 0;for(E=0;E<N.Wb;++E){var q=N.Ya[E].G,K=N.Ya[E].H;if(0<q[1][K[1]+0].g||0<q[2][K[2]+0].g||0<q[3][K[3]+0].g)return 0}return 1}function Ar(N,E,q,K,fe,be){if(N.Z!=0){var xe=N.qd,Pe=N.rd;for(t(Cd[N.Z]!=null);E<q;++E)Cd[N.Z](xe,Pe,K,fe,K,fe,be),xe=K,Pe=fe,fe+=be;N.qd=xe,N.rd=Pe}}function nr(N,E){var q=N.l.ma,K=q.Z==0||q.Z==1?N.l.j:N.C;if(K=N.C<K?K:N.C,t(E<=N.l.o),E>K){var fe=N.l.width,be=q.ca,xe=q.tb+fe*K,Pe=N.V,Ie=N.Ba+N.c*K,We=N.gc;t(N.ab==1),t(We[0].hc==3),bt(We[0],K,E,Pe,Ie,be,xe),Ar(q,K,E,be,xe,fe)}N.C=N.Ma=E}function Jr(N,E,q,K,fe,be,xe){var Pe=N.$/K,Ie=N.$%K,We=N.m,_t=N.s,Vt=q+N.$,Ve=Vt;fe=q+K*fe;var At=q+K*be,Zt=280+_t.ua,Or=N.Pb?Pe:16777216,ir=0<_t.ua?_t.Wa:null,Br=_t.wc,Ur=Vt<At?ce(_t,Ie,Pe):null;t(N.C<be),t(At<=fe);var mn=!1;e:for(;;){for(;mn||Vt<At;){var sn=0;if(Pe>=Or){var ma=Vt-q;t((Or=N).Pb),Or.wd=Or.m,Or.xd=ma,0<Or.s.ua&&ht(Or.s.Wa,Or.s.vb),Or=Pe+Uf}if(Ie&Br||(Ur=ce(_t,Ie,Pe)),t(Ur!=null),Ur.Qb&&(E[Vt]=Ur.qb,mn=!0),!mn)if(G(We),Ur.jc){sn=We,ma=E;var ra=Vt,Ja=Ur.pd[Y(sn)&Q-1];t(Ur.jc),256>Ja.g?(J(sn,sn.u+Ja.g),ma[ra]=Ja.value,sn=0):(J(sn,sn.u+Ja.g-256),t(256<=Ja.value),sn=Ja.value),sn==0&&(mn=!0)}else sn=dt(Ur.G[0],Ur.H[0],We);if(We.h)break;if(mn||256>sn){if(!mn)if(Ur.nd)E[Vt]=(Ur.qb|sn<<8)>>>0;else{if(G(We),mn=dt(Ur.G[1],Ur.H[1],We),G(We),ma=dt(Ur.G[2],Ur.H[2],We),ra=dt(Ur.G[3],Ur.H[3],We),We.h)break;E[Vt]=(ra<<24|mn<<16|sn<<8|ma)>>>0}if(mn=!1,++Vt,++Ie>=K&&(Ie=0,++Pe,xe!=null&&Pe<=be&&!(Pe%16)&&xe(N,Pe),ir!=null))for(;Ve<Vt;)sn=E[Ve++],ir.X[(506832829*sn&4294967295)>>>ir.Mb]=sn}else if(280>sn){if(sn=ct(sn-256,We),ma=dt(Ur.G[4],Ur.H[4],We),G(We),ma=tr(K,ma=ct(ma,We)),We.h)break;if(Vt-q<ma||fe-Vt<sn)break e;for(ra=0;ra<sn;++ra)E[Vt+ra]=E[Vt+ra-ma];for(Vt+=sn,Ie+=sn;Ie>=K;)Ie-=K,++Pe,xe!=null&&Pe<=be&&!(Pe%16)&&xe(N,Pe);if(t(Vt<=fe),Ie&Br&&(Ur=ce(_t,Ie,Pe)),ir!=null)for(;Ve<Vt;)sn=E[Ve++],ir.X[(506832829*sn&4294967295)>>>ir.Mb]=sn}else{if(!(sn<Zt))break e;for(mn=sn-280,t(ir!=null);Ve<Vt;)sn=E[Ve++],ir.X[(506832829*sn&4294967295)>>>ir.Mb]=sn;sn=Vt,t(!(mn>>>(ma=ir).Xa)),E[sn]=ma.X[mn],mn=!0}mn||t(We.h==he(We))}if(N.Pb&&We.h&&Vt<fe)t(N.m.h),N.a=5,N.m=N.wd,N.$=N.xd,0<N.s.ua&&ht(N.s.vb,N.s.Wa);else{if(We.h)break e;xe?.(N,Pe>be?be:Pe),N.a=0,N.$=Vt-q}return 1}return N.a=3,0}function gn(N){t(N!=null),N.vc=null,N.yc=null,N.Ya=null;var E=N.Wa;E!=null&&(E.X=null),N.vb=null,t(N!=null)}function tt(){var N=new ke;return N==null?null:(N.a=0,N.xb=Ny,et("Predictor","VP8LPredictors"),et("Predictor","VP8LPredictors_C"),et("PredictorAdd","VP8LPredictorsAdd"),et("PredictorAdd","VP8LPredictorsAdd_C"),ye=je,qt=$t,rr=Fe,qr=xt,Dn=Ot,$r=Cr,xn=Me,P.VP8LMapColor32b=Re,P.VP8LMapColor8b=Rt,N)}function jr(N,E,q,K,fe){var be=1,xe=[N],Pe=[E],Ie=K.m,We=K.s,_t=null,Vt=0;e:for(;;){if(q)for(;be&&Ae(Ie,1);){var Ve=xe,At=Pe,Zt=K,Or=1,ir=Zt.m,Br=Zt.gc[Zt.ab],Ur=Ae(ir,2);if(Zt.Oc&1<<Ur)be=0;else{switch(Zt.Oc|=1<<Ur,Br.hc=Ur,Br.Ea=Ve[0],Br.nc=At[0],Br.K=[null],++Zt.ab,t(4>=Zt.ab),Ur){case 0:case 1:Br.b=Ae(ir,3)+2,Or=jr(vt(Br.Ea,Br.b),vt(Br.nc,Br.b),0,Zt,Br.K),Br.K=Br.K[0];break;case 3:var mn,sn=Ae(ir,8)+1,ma=16<sn?0:4<sn?1:2<sn?2:3;if(Ve[0]=vt(Br.Ea,ma),Br.b=ma,mn=Or=jr(sn,1,0,Zt,Br.K)){var ra,Ja=sn,ia=Br,us=1<<(8>>ia.b),Ni=o(us);if(Ni==null)mn=0;else{var Qa=ia.K[0],la=ia.w;for(Ni[0]=ia.K[0][0],ra=1;ra<1*Ja;++ra)Ni[ra]=wt(Qa[la+ra],Ni[ra-1]);for(;ra<4*us;++ra)Ni[ra]=0;ia.K[0]=null,ia.K[0]=Ni,mn=1}}Or=mn;break;case 2:break;default:t(0)}be=Or}}if(xe=xe[0],Pe=Pe[0],be&&Ae(Ie,1)&&!(be=1<=(Vt=Ae(Ie,4))&&11>=Vt)){K.a=3;break e}var Ln;if(Ln=be)t:{var Jo,Ka,ps,po=K,tl=xe,ql=Pe,qo=Vt,wl=q,zl=po.m,Si=po.s,_s=[null],Ms=1,zo=0,Rs=jy[qo];r:for(;;){if(wl&&Ae(zl,1)){var rl=Ae(zl,3)+2,pu=vt(tl,rl),Qo=vt(ql,rl),pc=pu*Qo;if(!jr(pu,Qo,0,po,_s))break r;for(_s=_s[0],Si.xc=rl,Jo=0;Jo<pc;++Jo){var Js=_s[Jo]>>8&65535;_s[Jo]=Js,Js>=Ms&&(Ms=Js+1)}}if(zl.h)break r;for(Ka=0;5>Ka;++Ka){var Ci=by[Ka];!Ka&&0<qo&&(Ci+=1<<qo),zo<Ci&&(zo=Ci)}var qc=i(Ms*Rs,T),Ul=Ms,zc=i(Ul,B);if(zc==null)var Uc=null;else t(65536>=Ul),Uc=zc;var gc=o(zo);if(Uc==null||gc==null||qc==null){po.a=1;break r}var Vc=qc;for(Jo=ps=0;Jo<Ms;++Jo){var ro=Uc[Jo],Wc=ro.G,gu=ro.H,Dp=0,Wf=1,nl=0;for(Ka=0;5>Ka;++Ka){Ci=by[Ka],Wc[Ka]=Vc,gu[Ka]=ps,!Ka&&0<qo&&(Ci+=1<<qo);a:{var M2,VA=Ci,R2=po,Sy=gc,lie=Vc,cie=ps,WA=0,Wm=R2.m,die=Ae(Wm,1);if(s(Sy,0,0,VA),die){var uie=Ae(Wm,1)+1,fie=Ae(Wm,1),EF=Ae(Wm,fie==0?1:8);Sy[EF]=1,uie==2&&(Sy[EF=Ae(Wm,8)]=1);var F2=1}else{var kF=o(19),IF=Ae(Wm,4)+4;if(19<IF){R2.a=3;var L2=0;break a}for(M2=0;M2<IF;++M2)kF[wy[M2]]=Ae(Wm,3);var HA=void 0,Cy=void 0,OF=R2,mie=kF,$2=VA,TF=Sy,GA=0,Hm=OF.m,DF=8,MF=i(128,T);n:for(;I(MF,0,7,mie,19);){if(Ae(Hm,1)){var hie=2+2*Ae(Hm,3);if((HA=2+Ae(Hm,hie))>$2)break n}else HA=$2;for(Cy=0;Cy<$2&&HA--;){G(Hm);var RF=MF[0+(127&Y(Hm))];J(Hm,Hm.u+RF.g);var jx=RF.value;if(16>jx)TF[Cy++]=jx,jx!=0&&(DF=jx);else{var pie=jx==16,FF=jx-16,gie=BA[FF],LF=Ae(Hm,Um[FF])+gie;if(Cy+LF>$2)break n;for(var xie=pie?DF:0;0<LF--;)TF[Cy++]=xie}}GA=1;break n}GA||(OF.a=3),F2=GA}(F2=F2&&!Wm.h)&&(WA=I(lie,cie,8,Sy,VA)),F2&&WA!=0?L2=WA:(R2.a=3,L2=0)}if(L2==0)break r;if(Wf&&qA[Ka]==1&&(Wf=Vc[ps].g==0),Dp+=Vc[ps].g,ps+=L2,3>=Ka){var Ay,KA=gc[0];for(Ay=1;Ay<Ci;++Ay)gc[Ay]>KA&&(KA=gc[Ay]);nl+=KA}}if(ro.nd=Wf,ro.Qb=0,Wf&&(ro.qb=(Wc[3][gu[3]+0].value<<24|Wc[1][gu[1]+0].value<<16|Wc[2][gu[2]+0].value)>>>0,Dp==0&&256>Wc[0][gu[0]+0].value&&(ro.Qb=1,ro.qb+=Wc[0][gu[0]+0].value<<8)),ro.jc=!ro.Qb&&6>nl,ro.jc){var B2,Hf=ro;for(B2=0;B2<Q;++B2){var Gm=B2,Km=Hf.pd[Gm],q2=Hf.G[0][Hf.H[0]+Gm];256<=q2.value?(Km.g=q2.g+256,Km.value=q2.value):(Km.g=0,Km.value=0,Gm>>=Mt(q2,8,Km),Gm>>=Mt(Hf.G[1][Hf.H[1]+Gm],16,Km),Gm>>=Mt(Hf.G[2][Hf.H[2]+Gm],0,Km),Mt(Hf.G[3][Hf.H[3]+Gm],24,Km))}}}Si.vc=_s,Si.Wb=Ms,Si.Ya=Uc,Si.yc=qc,Ln=1;break t}Ln=0}if(!(be=Ln)){K.a=3;break e}if(0<Vt){if(We.ua=1<<Vt,!ie(We.Wa,Vt)){K.a=1,be=0;break e}}else We.ua=0;var XA=K,$F=xe,vie=Pe,YA=XA.s,JA=YA.xc;if(XA.c=$F,XA.i=vie,YA.md=vt($F,JA),YA.wc=JA==0?-1:(1<<JA)-1,q){K.xb=D2;break e}if((_t=o(xe*Pe))==null){K.a=1,be=0;break e}be=(be=Jr(K,_t,0,xe,Pe,Pe,null))&&!Ie.h;break e}return be?(fe!=null?fe[0]=_t:(t(_t==null),t(q)),K.$=0,q||gn(We)):gn(We),be}function ua(N,E){var q=N.c*N.i,K=q+E+16*E;return t(N.c<=E),N.V=o(K),N.V==null?(N.Ta=null,N.Ua=0,N.a=1,0):(N.Ta=N.V,N.Ua=N.Ba+q+E,1)}function Oe(N,E){var q=N.C,K=E-q,fe=N.V,be=N.Ba+N.c*q;for(t(E<=N.l.o);0<K;){var xe=16<K?16:K,Pe=N.l.ma,Ie=N.l.width,We=Ie*xe,_t=Pe.ca,Vt=Pe.tb+Ie*q,Ve=N.Ta,At=N.Ua;Xe(N,xe,fe,be),Bo(Ve,At,_t,Vt,We),Ar(Pe,q,q+xe,_t,Vt,Ie),K-=xe,fe+=xe*N.c,q+=xe}t(q==E),N.C=N.Ma=E}function Wt(){this.ub=this.yd=this.td=this.Rb=0}function Ht(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function mr(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function Gt(){this.Yb=function(){var N=[];return function E(q,K,fe){for(var be=fe[K],xe=0;xe<be&&(q.push(fe.length>K+1?[]:0),!(fe.length<K+1));xe++)E(q[xe],K+1,fe)}(N,0,[3,11]),N}()}function pn(){this.jb=o(3),this.Wc=l([4,8],Gt),this.Xc=l([4,17],Gt)}function jt(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function ur(){this.ld=this.La=this.dd=this.tc=0}function rt(){this.Na=this.la=0}function Dt(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Xt(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Tr(){this.uc=this.M=this.Nb=0,this.wa=Array(new ur),this.Y=0,this.ya=Array(new Xt),this.aa=0,this.l=new ar}function qn(){this.y=o(16),this.f=o(8),this.ea=o(8)}function Gr(){this.cb=this.a=0,this.sc="",this.m=new V,this.Od=new Wt,this.Kc=new Ht,this.ed=new jt,this.Qa=new mr,this.Ic=this.$c=this.Aa=0,this.D=new Tr,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=i(8,V),this.ia=0,this.pb=i(4,Dt),this.Pa=new pn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new qn),this.Hd=0,this.rb=Array(new rt),this.sb=0,this.wa=Array(new ur),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Xt),this.L=this.aa=0,this.gd=l([4,2],ur),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function ar(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function kn(){var N=new Gr;return N!=null&&(N.a=0,N.sc="OK",N.cb=0,N.Xb=0,Vf||(Vf=te)),N}function Xn(N,E,q){return N.a==0&&(N.a=E,N.sc=q,N.cb=0),0}function aa(N,E,q){return 3<=q&&N[E+0]==157&&N[E+1]==1&&N[E+2]==42}function pa(N,E){if(N==null)return 0;if(N.a=0,N.sc="OK",E==null)return Xn(N,2,"null VP8Io passed to VP8GetHeaders()");var q=E.data,K=E.w,fe=E.ha;if(4>fe)return Xn(N,7,"Truncated header.");var be=q[K+0]|q[K+1]<<8|q[K+2]<<16,xe=N.Od;if(xe.Rb=!(1&be),xe.td=be>>1&7,xe.yd=be>>4&1,xe.ub=be>>5,3<xe.td)return Xn(N,3,"Incorrect keyframe parameters.");if(!xe.yd)return Xn(N,4,"Frame not displayable.");K+=3,fe-=3;var Pe=N.Kc;if(xe.Rb){if(7>fe)return Xn(N,7,"cannot parse picture header");if(!aa(q,K,fe))return Xn(N,3,"Bad code word");Pe.c=16383&(q[K+4]<<8|q[K+3]),Pe.Td=q[K+4]>>6,Pe.i=16383&(q[K+6]<<8|q[K+5]),Pe.Ud=q[K+6]>>6,K+=7,fe-=7,N.za=Pe.c+15>>4,N.Ub=Pe.i+15>>4,E.width=Pe.c,E.height=Pe.i,E.Da=0,E.j=0,E.v=0,E.va=E.width,E.o=E.height,E.da=0,E.ib=E.width,E.hb=E.height,E.U=E.width,E.T=E.height,s((be=N.Pa).jb,0,255,be.jb.length),t((be=N.Qa)!=null),be.Cb=0,be.Bb=0,be.Fb=1,s(be.Zb,0,0,be.Zb.length),s(be.Lb,0,0,be.Lb)}if(xe.ub>fe)return Xn(N,7,"bad partition length");z(be=N.m,q,K,xe.ub),K+=xe.ub,fe-=xe.ub,xe.Rb&&(Pe.Ld=ve(be),Pe.Kd=ve(be)),Pe=N.Qa;var Ie,We=N.Pa;if(t(be!=null),t(Pe!=null),Pe.Cb=ve(be),Pe.Cb){if(Pe.Bb=ve(be),ve(be)){for(Pe.Fb=ve(be),Ie=0;4>Ie;++Ie)Pe.Zb[Ie]=ve(be)?L(be,7):0;for(Ie=0;4>Ie;++Ie)Pe.Lb[Ie]=ve(be)?L(be,6):0}if(Pe.Bb)for(Ie=0;3>Ie;++Ie)We.jb[Ie]=ve(be)?U(be,8):255}else Pe.Bb=0;if(be.Ka)return Xn(N,3,"cannot parse segment header");if((Pe=N.ed).zd=ve(be),Pe.Tb=U(be,6),Pe.wb=U(be,3),Pe.Pc=ve(be),Pe.Pc&&ve(be)){for(We=0;4>We;++We)ve(be)&&(Pe.vd[We]=L(be,6));for(We=0;4>We;++We)ve(be)&&(Pe.od[We]=L(be,6))}if(N.L=Pe.Tb==0?0:Pe.zd?1:2,be.Ka)return Xn(N,3,"cannot parse filter header");var _t=fe;if(fe=Ie=K,K=Ie+_t,Pe=_t,N.Xb=(1<<U(N.m,2))-1,_t<3*(We=N.Xb))q=7;else{for(Ie+=3*We,Pe-=3*We,_t=0;_t<We;++_t){var Vt=q[fe+0]|q[fe+1]<<8|q[fe+2]<<16;Vt>Pe&&(Vt=Pe),z(N.Jc[+_t],q,Ie,Vt),Ie+=Vt,Pe-=Vt,fe+=3}z(N.Jc[+We],q,Ie,Pe),q=Ie<K?0:5}if(q!=0)return Xn(N,q,"cannot parse partitions");for(q=U(Ie=N.m,7),fe=ve(Ie)?L(Ie,4):0,K=ve(Ie)?L(Ie,4):0,Pe=ve(Ie)?L(Ie,4):0,We=ve(Ie)?L(Ie,4):0,Ie=ve(Ie)?L(Ie,4):0,_t=N.Qa,Vt=0;4>Vt;++Vt){if(_t.Cb){var Ve=_t.Zb[Vt];_t.Fb||(Ve+=q)}else{if(0<Vt){N.pb[Vt]=N.pb[0];continue}Ve=q}var At=N.pb[Vt];At.Sc[0]=Sd[tn(Ve+fe,127)],At.Sc[1]=Op[tn(Ve+0,127)],At.Eb[0]=2*Sd[tn(Ve+K,127)],At.Eb[1]=101581*Op[tn(Ve+Pe,127)]>>16,8>At.Eb[1]&&(At.Eb[1]=8),At.Qc[0]=Sd[tn(Ve+We,117)],At.Qc[1]=Op[tn(Ve+Ie,127)],At.lc=Ve+Ie}if(!xe.Rb)return Xn(N,4,"Not a key frame.");for(ve(be),xe=N.Pa,q=0;4>q;++q){for(fe=0;8>fe;++fe)for(K=0;3>K;++K)for(Pe=0;11>Pe;++Pe)We=ae(be,T2[q][fe][K][Pe])?U(be,8):zA[q][fe][K][Pe],xe.Wc[q][fe].Yb[K][Pe]=We;for(fe=0;17>fe;++fe)xe.Xc[q][fe]=xe.Wc[q][UA[fe]]}return N.kc=ve(be),N.kc&&(N.Bd=U(be,8)),N.cb=1}function te(N,E,q,K,fe,be,xe){var Pe=E[fe].Yb[q];for(q=0;16>fe;++fe){if(!ae(N,Pe[q+0]))return fe;for(;!ae(N,Pe[q+1]);)if(Pe=E[++fe].Yb[0],q=0,fe==16)return 16;var Ie=E[fe+1].Yb;if(ae(N,Pe[q+2])){var We=N,_t=0;if(ae(We,(Ve=Pe)[(Vt=q)+3]))if(ae(We,Ve[Vt+6])){for(Pe=0,Vt=2*(_t=ae(We,Ve[Vt+8]))+(Ve=ae(We,Ve[Vt+9+_t])),_t=0,Ve=hc[Vt];Ve[Pe];++Pe)_t+=_t+ae(We,Ve[Pe]);_t+=3+(8<<Vt)}else ae(We,Ve[Vt+7])?(_t=7+2*ae(We,165),_t+=ae(We,145)):_t=5+ae(We,159);else _t=ae(We,Ve[Vt+4])?3+ae(We,Ve[Vt+5]):2;Pe=Ie[2]}else _t=1,Pe=Ie[1];Ie=xe+O2[fe],0>(We=N).b&&ue(We);var Vt,Ve=We.b,At=(Vt=We.Ca>>1)-(We.I>>Ve)>>31;--We.b,We.Ca+=At,We.Ca|=1,We.I-=(Vt+1&At)<<Ve,be[Ie]=((_t^At)-At)*K[(0<fe)+0]}return 16}function Te(N){var E=N.rb[N.sb-1];E.la=0,E.Na=0,s(N.zc,0,0,N.zc.length),N.ja=0}function at(N,E,q,K,fe){fe=N[E+q+32*K]+(fe>>3),N[E+q+32*K]=-256&fe?0>fe?0:255:fe}function ee(N,E,q,K,fe,be){at(N,E,0,q,K+fe),at(N,E,1,q,K+be),at(N,E,2,q,K-be),at(N,E,3,q,K-fe)}function Se(N){return(20091*N>>16)+N}function $e(N,E,q,K){var fe,be=0,xe=o(16);for(fe=0;4>fe;++fe){var Pe=N[E+0]+N[E+8],Ie=N[E+0]-N[E+8],We=(35468*N[E+4]>>16)-Se(N[E+12]),_t=Se(N[E+4])+(35468*N[E+12]>>16);xe[be+0]=Pe+_t,xe[be+1]=Ie+We,xe[be+2]=Ie-We,xe[be+3]=Pe-_t,be+=4,E++}for(fe=be=0;4>fe;++fe)Pe=(N=xe[be+0]+4)+xe[be+8],Ie=N-xe[be+8],We=(35468*xe[be+4]>>16)-Se(xe[be+12]),at(q,K,0,0,Pe+(_t=Se(xe[be+4])+(35468*xe[be+12]>>16))),at(q,K,1,0,Ie+We),at(q,K,2,0,Ie-We),at(q,K,3,0,Pe-_t),be++,K+=32}function Be(N,E,q,K){var fe=N[E+0]+4,be=35468*N[E+4]>>16,xe=Se(N[E+4]),Pe=35468*N[E+1]>>16;ee(q,K,0,fe+xe,N=Se(N[E+1]),Pe),ee(q,K,1,fe+be,N,Pe),ee(q,K,2,fe-be,N,Pe),ee(q,K,3,fe-xe,N,Pe)}function Ge(N,E,q,K,fe){$e(N,E,q,K),fe&&$e(N,E+16,q,K+4)}function Ye(N,E,q,K){_n(N,E+0,q,K,1),_n(N,E+32,q,K+128,1)}function ft(N,E,q,K){var fe;for(N=N[E+0]+4,fe=0;4>fe;++fe)for(E=0;4>E;++E)at(q,K,E,fe,N)}function yt(N,E,q,K){N[E+0]&&Zn(N,E+0,q,K),N[E+16]&&Zn(N,E+16,q,K+4),N[E+32]&&Zn(N,E+32,q,K+128),N[E+48]&&Zn(N,E+48,q,K+128+4)}function Et(N,E,q,K){var fe,be=o(16);for(fe=0;4>fe;++fe){var xe=N[E+0+fe]+N[E+12+fe],Pe=N[E+4+fe]+N[E+8+fe],Ie=N[E+4+fe]-N[E+8+fe],We=N[E+0+fe]-N[E+12+fe];be[0+fe]=xe+Pe,be[8+fe]=xe-Pe,be[4+fe]=We+Ie,be[12+fe]=We-Ie}for(fe=0;4>fe;++fe)xe=(N=be[0+4*fe]+3)+be[3+4*fe],Pe=be[1+4*fe]+be[2+4*fe],Ie=be[1+4*fe]-be[2+4*fe],We=N-be[3+4*fe],q[K+0]=xe+Pe>>3,q[K+16]=We+Ie>>3,q[K+32]=xe-Pe>>3,q[K+48]=We-Ie>>3,K+=64}function br(N,E,q){var K,fe=E-32,be=bs,xe=255-N[fe-1];for(K=0;K<q;++K){var Pe,Ie=be,We=xe+N[E-1];for(Pe=0;Pe<q;++Pe)N[E+Pe]=Ie[We+N[fe+Pe]];E+=32}}function Ue(N,E){br(N,E,4)}function St(N,E){br(N,E,8)}function Nr(N,E){br(N,E,16)}function an(N,E){var q;for(q=0;16>q;++q)n(N,E+32*q,N,E-32,16)}function Lr(N,E){var q;for(q=16;0<q;--q)s(N,E,N[E-1],16),E+=32}function On(N,E,q){var K;for(K=0;16>K;++K)s(E,q+32*K,N,16)}function Qn(N,E){var q,K=16;for(q=0;16>q;++q)K+=N[E-1+32*q]+N[E+q-32];On(K>>5,N,E)}function Ta(N,E){var q,K=8;for(q=0;16>q;++q)K+=N[E-1+32*q];On(K>>4,N,E)}function zn(N,E){var q,K=8;for(q=0;16>q;++q)K+=N[E+q-32];On(K>>4,N,E)}function Fn(N,E){On(128,N,E)}function en(N,E,q){return N+2*E+q+2>>2}function Wa(N,E){var q,K=E-32;for(K=new Uint8Array([en(N[K-1],N[K+0],N[K+1]),en(N[K+0],N[K+1],N[K+2]),en(N[K+1],N[K+2],N[K+3]),en(N[K+2],N[K+3],N[K+4])]),q=0;4>q;++q)n(N,E+32*q,K,0,K.length)}function Ya(N,E){var q=N[E-1],K=N[E-1+32],fe=N[E-1+64],be=N[E-1+96];oe(N,E+0,16843009*en(N[E-1-32],q,K)),oe(N,E+32,16843009*en(q,K,fe)),oe(N,E+64,16843009*en(K,fe,be)),oe(N,E+96,16843009*en(fe,be,be))}function za(N,E){var q,K=4;for(q=0;4>q;++q)K+=N[E+q-32]+N[E-1+32*q];for(K>>=3,q=0;4>q;++q)s(N,E+32*q,K,4)}function vs(N,E){var q=N[E-1+0],K=N[E-1+32],fe=N[E-1+64],be=N[E-1-32],xe=N[E+0-32],Pe=N[E+1-32],Ie=N[E+2-32],We=N[E+3-32];N[E+0+96]=en(K,fe,N[E-1+96]),N[E+1+96]=N[E+0+64]=en(q,K,fe),N[E+2+96]=N[E+1+64]=N[E+0+32]=en(be,q,K),N[E+3+96]=N[E+2+64]=N[E+1+32]=N[E+0+0]=en(xe,be,q),N[E+3+64]=N[E+2+32]=N[E+1+0]=en(Pe,xe,be),N[E+3+32]=N[E+2+0]=en(Ie,Pe,xe),N[E+3+0]=en(We,Ie,Pe)}function Os(N,E){var q=N[E+1-32],K=N[E+2-32],fe=N[E+3-32],be=N[E+4-32],xe=N[E+5-32],Pe=N[E+6-32],Ie=N[E+7-32];N[E+0+0]=en(N[E+0-32],q,K),N[E+1+0]=N[E+0+32]=en(q,K,fe),N[E+2+0]=N[E+1+32]=N[E+0+64]=en(K,fe,be),N[E+3+0]=N[E+2+32]=N[E+1+64]=N[E+0+96]=en(fe,be,xe),N[E+3+32]=N[E+2+64]=N[E+1+96]=en(be,xe,Pe),N[E+3+64]=N[E+2+96]=en(xe,Pe,Ie),N[E+3+96]=en(Pe,Ie,Ie)}function ss(N,E){var q=N[E-1+0],K=N[E-1+32],fe=N[E-1+64],be=N[E-1-32],xe=N[E+0-32],Pe=N[E+1-32],Ie=N[E+2-32],We=N[E+3-32];N[E+0+0]=N[E+1+64]=be+xe+1>>1,N[E+1+0]=N[E+2+64]=xe+Pe+1>>1,N[E+2+0]=N[E+3+64]=Pe+Ie+1>>1,N[E+3+0]=Ie+We+1>>1,N[E+0+96]=en(fe,K,q),N[E+0+64]=en(K,q,be),N[E+0+32]=N[E+1+96]=en(q,be,xe),N[E+1+32]=N[E+2+96]=en(be,xe,Pe),N[E+2+32]=N[E+3+96]=en(xe,Pe,Ie),N[E+3+32]=en(Pe,Ie,We)}function Io(N,E){var q=N[E+0-32],K=N[E+1-32],fe=N[E+2-32],be=N[E+3-32],xe=N[E+4-32],Pe=N[E+5-32],Ie=N[E+6-32],We=N[E+7-32];N[E+0+0]=q+K+1>>1,N[E+1+0]=N[E+0+64]=K+fe+1>>1,N[E+2+0]=N[E+1+64]=fe+be+1>>1,N[E+3+0]=N[E+2+64]=be+xe+1>>1,N[E+0+32]=en(q,K,fe),N[E+1+32]=N[E+0+96]=en(K,fe,be),N[E+2+32]=N[E+1+96]=en(fe,be,xe),N[E+3+32]=N[E+2+96]=en(be,xe,Pe),N[E+3+64]=en(xe,Pe,Ie),N[E+3+96]=en(Pe,Ie,We)}function Vs(N,E){var q=N[E-1+0],K=N[E-1+32],fe=N[E-1+64],be=N[E-1+96];N[E+0+0]=q+K+1>>1,N[E+2+0]=N[E+0+32]=K+fe+1>>1,N[E+2+32]=N[E+0+64]=fe+be+1>>1,N[E+1+0]=en(q,K,fe),N[E+3+0]=N[E+1+32]=en(K,fe,be),N[E+3+32]=N[E+1+64]=en(fe,be,be),N[E+3+64]=N[E+2+64]=N[E+0+96]=N[E+1+96]=N[E+2+96]=N[E+3+96]=be}function ii(N,E){var q=N[E-1+0],K=N[E-1+32],fe=N[E-1+64],be=N[E-1+96],xe=N[E-1-32],Pe=N[E+0-32],Ie=N[E+1-32],We=N[E+2-32];N[E+0+0]=N[E+2+32]=q+xe+1>>1,N[E+0+32]=N[E+2+64]=K+q+1>>1,N[E+0+64]=N[E+2+96]=fe+K+1>>1,N[E+0+96]=be+fe+1>>1,N[E+3+0]=en(Pe,Ie,We),N[E+2+0]=en(xe,Pe,Ie),N[E+1+0]=N[E+3+32]=en(q,xe,Pe),N[E+1+32]=N[E+3+64]=en(K,q,xe),N[E+1+64]=N[E+3+96]=en(fe,K,q),N[E+1+96]=en(be,fe,K)}function Rl(N,E){var q;for(q=0;8>q;++q)n(N,E+32*q,N,E-32,8)}function li(N,E){var q;for(q=0;8>q;++q)s(N,E,N[E-1],8),E+=32}function pl(N,E,q){var K;for(K=0;8>K;++K)s(E,q+32*K,N,8)}function Fc(N,E){var q,K=8;for(q=0;8>q;++q)K+=N[E+q-32]+N[E-1+32*q];pl(K>>4,N,E)}function mc(N,E){var q,K=4;for(q=0;8>q;++q)K+=N[E+q-32];pl(K>>3,N,E)}function ci(N,E){var q,K=4;for(q=0;8>q;++q)K+=N[E-1+32*q];pl(K>>3,N,E)}function Lc(N,E){pl(128,N,E)}function Ks(N,E,q){var K=N[E-q],fe=N[E+0],be=3*(fe-K)+Ds[1020+N[E-2*q]-N[E+q]],xe=ho[112+(be+4>>3)];N[E-q]=bs[255+K+ho[112+(be+3>>3)]],N[E+0]=bs[255+fe-xe]}function _o(N,E,q,K){var fe=N[E+0],be=N[E+q];return Oo[255+N[E-2*q]-N[E-q]]>K||Oo[255+be-fe]>K}function $c(N,E,q,K){return 4*Oo[255+N[E-q]-N[E+0]]+Oo[255+N[E-2*q]-N[E+q]]<=K}function gl(N,E,q,K,fe){var be=N[E-3*q],xe=N[E-2*q],Pe=N[E-q],Ie=N[E+0],We=N[E+q],_t=N[E+2*q],Vt=N[E+3*q];return 4*Oo[255+Pe-Ie]+Oo[255+xe-We]>K?0:Oo[255+N[E-4*q]-be]<=fe&&Oo[255+be-xe]<=fe&&Oo[255+xe-Pe]<=fe&&Oo[255+Vt-_t]<=fe&&Oo[255+_t-We]<=fe&&Oo[255+We-Ie]<=fe}function _i(N,E,q,K){var fe=2*K+1;for(K=0;16>K;++K)$c(N,E+K,q,fe)&&Ks(N,E+K,q)}function ts(N,E,q,K){var fe=2*K+1;for(K=0;16>K;++K)$c(N,E+K*q,1,fe)&&Ks(N,E+K*q,1)}function xl(N,E,q,K){var fe;for(fe=3;0<fe;--fe)_i(N,E+=4*q,q,K)}function Ba(N,E,q,K){var fe;for(fe=3;0<fe;--fe)ts(N,E+=4,q,K)}function Qi(N,E,q,K,fe,be,xe,Pe){for(be=2*be+1;0<fe--;){if(gl(N,E,q,be,xe))if(_o(N,E,q,Pe))Ks(N,E,q);else{var Ie=N,We=E,_t=q,Vt=Ie[We-2*_t],Ve=Ie[We-_t],At=Ie[We+0],Zt=Ie[We+_t],Or=Ie[We+2*_t],ir=27*(Ur=Ds[1020+3*(At-Ve)+Ds[1020+Vt-Zt]])+63>>7,Br=18*Ur+63>>7,Ur=9*Ur+63>>7;Ie[We-3*_t]=bs[255+Ie[We-3*_t]+Ur],Ie[We-2*_t]=bs[255+Vt+Br],Ie[We-_t]=bs[255+Ve+ir],Ie[We+0]=bs[255+At-ir],Ie[We+_t]=bs[255+Zt-Br],Ie[We+2*_t]=bs[255+Or-Ur]}E+=K}}function Xr(N,E,q,K,fe,be,xe,Pe){for(be=2*be+1;0<fe--;){if(gl(N,E,q,be,xe))if(_o(N,E,q,Pe))Ks(N,E,q);else{var Ie=N,We=E,_t=q,Vt=Ie[We-_t],Ve=Ie[We+0],At=Ie[We+_t],Zt=ho[112+(4+(Or=3*(Ve-Vt))>>3)],Or=ho[112+(Or+3>>3)],ir=Zt+1>>1;Ie[We-2*_t]=bs[255+Ie[We-2*_t]+ir],Ie[We-_t]=bs[255+Vt+Or],Ie[We+0]=bs[255+Ve-Zt],Ie[We+_t]=bs[255+At-ir]}E+=K}}function fu(N,E,q,K,fe,be){Qi(N,E,q,1,16,K,fe,be)}function vl(N,E,q,K,fe,be){Qi(N,E,1,q,16,K,fe,be)}function Xo(N,E,q,K,fe,be){var xe;for(xe=3;0<xe;--xe)Xr(N,E+=4*q,q,1,16,K,fe,be)}function Zi(N,E,q,K,fe,be){var xe;for(xe=3;0<xe;--xe)Xr(N,E+=4,1,q,16,K,fe,be)}function R(N,E,q,K,fe,be,xe,Pe){Qi(N,E,fe,1,8,be,xe,Pe),Qi(q,K,fe,1,8,be,xe,Pe)}function pe(N,E,q,K,fe,be,xe,Pe){Qi(N,E,1,fe,8,be,xe,Pe),Qi(q,K,1,fe,8,be,xe,Pe)}function He(N,E,q,K,fe,be,xe,Pe){Xr(N,E+4*fe,fe,1,8,be,xe,Pe),Xr(q,K+4*fe,fe,1,8,be,xe,Pe)}function mt(N,E,q,K,fe,be,xe,Pe){Xr(N,E+4,1,fe,8,be,xe,Pe),Xr(q,K+4,1,fe,8,be,xe,Pe)}function zt(){this.ba=new kr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Rr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Dr(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Qr(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function de(){this.ua=0,this.Wa=new pt,this.vb=new pt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new B,this.yc=new T}function ke(){this.xb=this.a=0,this.l=new ar,this.ca=new kr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new $,this.Pb=0,this.wd=new $,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new de,this.ab=0,this.gc=i(4,Qr),this.Oc=0}function st(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new ar,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ot(N,E,q,K,fe,be,xe){for(N=N==null?0:N[E+0],E=0;E<xe;++E)fe[be+E]=N+q[K+E]&255,N=fe[be+E]}function Nt(N,E,q,K,fe,be,xe){var Pe;if(N==null)ot(null,null,q,K,fe,be,xe);else for(Pe=0;Pe<xe;++Pe)fe[be+Pe]=N[E+Pe]+q[K+Pe]&255}function or(N,E,q,K,fe,be,xe){if(N==null)ot(null,null,q,K,fe,be,xe);else{var Pe,Ie=N[E+0],We=Ie,_t=Ie;for(Pe=0;Pe<xe;++Pe)We=_t+(Ie=N[E+Pe])-We,_t=q[K+Pe]+(-256&We?0>We?0:255:We)&255,We=Ie,fe[be+Pe]=_t}}function Bt(N,E,q,K){var fe=E.width,be=E.o;if(t(N!=null&&E!=null),0>q||0>=K||q+K>be)return null;if(!N.Cc){if(N.ga==null){var xe;if(N.ga=new st,(xe=N.ga==null)||(xe=E.width*E.o,t(N.Gb.length==0),N.Gb=o(xe),N.Uc=0,N.Gb==null?xe=0:(N.mb=N.Gb,N.nb=N.Uc,N.rc=null,xe=1),xe=!xe),!xe){xe=N.ga;var Pe=N.Fa,Ie=N.P,We=N.qc,_t=N.mb,Vt=N.nb,Ve=Ie+1,At=We-1,Zt=xe.l;if(t(Pe!=null&&_t!=null&&E!=null),Cd[0]=null,Cd[1]=ot,Cd[2]=Nt,Cd[3]=or,xe.ca=_t,xe.tb=Vt,xe.c=E.width,xe.i=E.height,t(0<xe.c&&0<xe.i),1>=We)E=0;else if(xe.$a=3&Pe[Ie+0],xe.Z=Pe[Ie+0]>>2&3,xe.Lc=Pe[Ie+0]>>4&3,Ie=Pe[Ie+0]>>6&3,0>xe.$a||1<xe.$a||4<=xe.Z||1<xe.Lc||Ie)E=0;else if(Zt.put=ze,Zt.ac=qe,Zt.bc=Je,Zt.ma=xe,Zt.width=E.width,Zt.height=E.height,Zt.Da=E.Da,Zt.v=E.v,Zt.va=E.va,Zt.j=E.j,Zt.o=E.o,xe.$a)e:{t(xe.$a==1),E=tt();t:for(;;){if(E==null){E=0;break e}if(t(xe!=null),xe.mc=E,E.c=xe.c,E.i=xe.i,E.l=xe.l,E.l.ma=xe,E.l.width=xe.c,E.l.height=xe.i,E.a=0,W(E.m,Pe,Ve,At),!jr(xe.c,xe.i,1,E,null)||(E.ab==1&&E.gc[0].hc==3&&Tt(E.s)?(xe.ic=1,Pe=E.c*E.i,E.Ta=null,E.Ua=0,E.V=o(Pe),E.Ba=0,E.V==null?(E.a=1,E=0):E=1):(xe.ic=0,E=ua(E,xe.c)),!E))break t;E=1;break e}xe.mc=null,E=0}else E=At>=xe.c*xe.i;xe=!E}if(xe)return null;N.ga.Lc!=1?N.Ga=0:K=be-q}t(N.ga!=null),t(q+K<=be);e:{if(E=(Pe=N.ga).c,be=Pe.l.o,Pe.$a==0){if(Ve=N.rc,At=N.Vc,Zt=N.Fa,Ie=N.P+1+q*E,We=N.mb,_t=N.nb+q*E,t(Ie<=N.P+N.qc),Pe.Z!=0)for(t(Cd[Pe.Z]!=null),xe=0;xe<K;++xe)Cd[Pe.Z](Ve,At,Zt,Ie,We,_t,E),Ve=We,At=_t,_t+=E,Ie+=E;else for(xe=0;xe<K;++xe)n(We,_t,Zt,Ie,E),Ve=We,At=_t,_t+=E,Ie+=E;N.rc=Ve,N.Vc=At}else{if(t(Pe.mc!=null),E=q+K,t((xe=Pe.mc)!=null),t(E<=xe.i),xe.C>=E)E=1;else if(Pe.ic||Vr(),Pe.ic){Pe=xe.V,Ve=xe.Ba,At=xe.c;var Or=xe.i,ir=(Zt=1,Ie=xe.$/At,We=xe.$%At,_t=xe.m,Vt=xe.s,xe.$),Br=At*Or,Ur=At*E,mn=Vt.wc,sn=ir<Ur?ce(Vt,We,Ie):null;t(ir<=Br),t(E<=Or),t(Tt(Vt));t:for(;;){for(;!_t.h&&ir<Ur;){if(We&mn||(sn=ce(Vt,We,Ie)),t(sn!=null),G(_t),256>(Or=dt(sn.G[0],sn.H[0],_t)))Pe[Ve+ir]=Or,++ir,++We>=At&&(We=0,++Ie<=E&&!(Ie%16)&&nr(xe,Ie));else{if(!(280>Or)){Zt=0;break t}Or=ct(Or-256,_t);var ma,ra=dt(sn.G[4],sn.H[4],_t);if(G(_t),!(ir>=(ra=tr(At,ra=ct(ra,_t)))&&Br-ir>=Or)){Zt=0;break t}for(ma=0;ma<Or;++ma)Pe[Ve+ir+ma]=Pe[Ve+ir+ma-ra];for(ir+=Or,We+=Or;We>=At;)We-=At,++Ie<=E&&!(Ie%16)&&nr(xe,Ie);ir<Ur&&We&mn&&(sn=ce(Vt,We,Ie))}t(_t.h==he(_t))}nr(xe,Ie>E?E:Ie);break t}!Zt||_t.h&&ir<Br?(Zt=0,xe.a=_t.h?5:3):xe.$=ir,E=Zt}else E=Jr(xe,xe.V,xe.Ba,xe.c,xe.i,E,Oe);if(!E){K=0;break e}}q+K>=be&&(N.Cc=1),K=1}if(!K)return null;if(N.Cc&&((K=N.ga)!=null&&(K.mc=null),N.ga=null,0<N.Ga))return alert("todo:WebPDequantizeLevels"),null}return N.nb+q*fe}function vr(N,E,q,K,fe,be){for(;0<fe--;){var xe,Pe=N,Ie=E+(q?1:0),We=N,_t=E+(q?0:3);for(xe=0;xe<K;++xe){var Vt=We[_t+4*xe];Vt!=255&&(Vt*=32897,Pe[Ie+4*xe+0]=Pe[Ie+4*xe+0]*Vt>>23,Pe[Ie+4*xe+1]=Pe[Ie+4*xe+1]*Vt>>23,Pe[Ie+4*xe+2]=Pe[Ie+4*xe+2]*Vt>>23)}E+=be}}function yr(N,E,q,K,fe){for(;0<K--;){var be;for(be=0;be<q;++be){var xe=N[E+2*be+0],Pe=15&(We=N[E+2*be+1]),Ie=4369*Pe,We=(240&We|We>>4)*Ie>>16;N[E+2*be+0]=(240&xe|xe>>4)*Ie>>16&240|(15&xe|xe<<4)*Ie>>16>>4&15,N[E+2*be+1]=240&We|Pe}E+=fe}}function It(N,E,q,K,fe,be,xe,Pe){var Ie,We,_t=255;for(We=0;We<fe;++We){for(Ie=0;Ie<K;++Ie){var Vt=N[E+Ie];be[xe+4*Ie]=Vt,_t&=Vt}E+=q,xe+=Pe}return _t!=255}function Hr(N,E,q,K,fe){var be;for(be=0;be<fe;++be)q[K+be]=N[E+be]>>8}function Vr(){to=vr,Ts=yr,Ys=It,Bo=Hr}function pr(N,E,q){P[N]=function(K,fe,be,xe,Pe,Ie,We,_t,Vt,Ve,At,Zt,Or,ir,Br,Ur,mn){var sn,ma=mn-1>>1,ra=Pe[Ie+0]|We[_t+0]<<16,Ja=Vt[Ve+0]|At[Zt+0]<<16;t(K!=null);var ia=3*ra+Ja+131074>>2;for(E(K[fe+0],255&ia,ia>>16,Or,ir),be!=null&&(ia=3*Ja+ra+131074>>2,E(be[xe+0],255&ia,ia>>16,Br,Ur)),sn=1;sn<=ma;++sn){var us=Pe[Ie+sn]|We[_t+sn]<<16,Ni=Vt[Ve+sn]|At[Zt+sn]<<16,Qa=ra+us+Ja+Ni+524296,la=Qa+2*(us+Ja)>>3;ia=la+ra>>1,ra=(Qa=Qa+2*(ra+Ni)>>3)+us>>1,E(K[fe+2*sn-1],255&ia,ia>>16,Or,ir+(2*sn-1)*q),E(K[fe+2*sn-0],255&ra,ra>>16,Or,ir+(2*sn-0)*q),be!=null&&(ia=Qa+Ja>>1,ra=la+Ni>>1,E(be[xe+2*sn-1],255&ia,ia>>16,Br,Ur+(2*sn-1)*q),E(be[xe+2*sn+0],255&ra,ra>>16,Br,Ur+(2*sn+0)*q)),ra=us,Ja=Ni}1&mn||(ia=3*ra+Ja+131074>>2,E(K[fe+mn-1],255&ia,ia>>16,Or,ir+(mn-1)*q),be!=null&&(ia=3*Ja+ra+131074>>2,E(be[xe+mn-1],255&ia,ia>>16,Br,Ur+(mn-1)*q)))}}function ln(){Fi[wx]=Le,Fi[Fl]=Ft,Fi[Ll]=ut,Fi[_x]=Kt,Fi[mu]=lr,Fi[ef]=zr,Fi[zf]=hn,Fi[tf]=Ft,Fi[ji]=Kt,Fi[rf]=lr,Fi[Ip]=zr}function hr(N){return N&~di?0>N?0:255:N>>Jn}function Zr(N,E){return hr((19077*N>>8)+(26149*E>>8)-14234)}function Pr(N,E,q){return hr((19077*N>>8)-(6419*E>>8)-(13320*q>>8)+8708)}function cr(N,E){return hr((19077*N>>8)+(33050*E>>8)-17685)}function Mr(N,E,q,K,fe){K[fe+0]=Zr(N,q),K[fe+1]=Pr(N,E,q),K[fe+2]=cr(N,E)}function bn(N,E,q,K,fe){K[fe+0]=cr(N,E),K[fe+1]=Pr(N,E,q),K[fe+2]=Zr(N,q)}function ca(N,E,q,K,fe){var be=Pr(N,E,q);E=be<<3&224|cr(N,E)>>3,K[fe+0]=248&Zr(N,q)|be>>5,K[fe+1]=E}function os(N,E,q,K,fe){var be=240&cr(N,E)|15;K[fe+0]=240&Zr(N,q)|Pr(N,E,q)>>4,K[fe+1]=be}function ys(N,E,q,K,fe){K[fe+0]=255,Mr(N,E,q,K,fe+1)}function cn(N,E,q,K,fe){bn(N,E,q,K,fe),K[fe+3]=255}function Kr(N,E,q,K,fe){Mr(N,E,q,K,fe),K[fe+3]=255}function tn(N,E){return 0>N?0:N>E?E:N}function An(N,E,q){P[N]=function(K,fe,be,xe,Pe,Ie,We,_t,Vt){for(var Ve=_t+(-2&Vt)*q;_t!=Ve;)E(K[fe+0],be[xe+0],Pe[Ie+0],We,_t),E(K[fe+1],be[xe+0],Pe[Ie+0],We,_t+q),fe+=2,++xe,++Ie,_t+=2*q;1&Vt&&E(K[fe+0],be[xe+0],Pe[Ie+0],We,_t)}}function dn(N,E,q){return q==0?N==0?E==0?6:5:E==0?4:0:q}function Yn(N,E,q,K,fe){switch(N>>>30){case 3:_n(E,q,K,fe,0);break;case 2:un(E,q,K,fe);break;case 1:Zn(E,q,K,fe)}}function Ir(N,E){var q,K,fe=E.M,be=E.Nb,xe=N.oc,Pe=N.pc+40,Ie=N.oc,We=N.pc+584,_t=N.oc,Vt=N.pc+600;for(q=0;16>q;++q)xe[Pe+32*q-1]=129;for(q=0;8>q;++q)Ie[We+32*q-1]=129,_t[Vt+32*q-1]=129;for(0<fe?xe[Pe-1-32]=Ie[We-1-32]=_t[Vt-1-32]=129:(s(xe,Pe-32-1,127,21),s(Ie,We-32-1,127,9),s(_t,Vt-32-1,127,9)),K=0;K<N.za;++K){var Ve=E.ya[E.aa+K];if(0<K){for(q=-1;16>q;++q)n(xe,Pe+32*q-4,xe,Pe+32*q+12,4);for(q=-1;8>q;++q)n(Ie,We+32*q-4,Ie,We+32*q+4,4),n(_t,Vt+32*q-4,_t,Vt+32*q+4,4)}var At=N.Gd,Zt=N.Hd+K,Or=Ve.ad,ir=Ve.Hc;if(0<fe&&(n(xe,Pe-32,At[Zt].y,0,16),n(Ie,We-32,At[Zt].f,0,8),n(_t,Vt-32,At[Zt].ea,0,8)),Ve.Za){var Br=xe,Ur=Pe-32+16;for(0<fe&&(K>=N.za-1?s(Br,Ur,At[Zt].y[15],4):n(Br,Ur,At[Zt+1].y,0,4)),q=0;4>q;q++)Br[Ur+128+q]=Br[Ur+256+q]=Br[Ur+384+q]=Br[Ur+0+q];for(q=0;16>q;++q,ir<<=2)Br=xe,Ur=Pe+Ws[q],Bc[Ve.Ob[q]](Br,Ur),Yn(ir,Or,16*+q,Br,Ur)}else if(Br=dn(K,fe,Ve.Ob[0]),af[Br](xe,Pe),ir!=0)for(q=0;16>q;++q,ir<<=2)Yn(ir,Or,16*+q,xe,Pe+Ws[q]);for(q=Ve.Gc,Br=dn(K,fe,Ve.Dd),hu[Br](Ie,We),hu[Br](_t,Vt),ir=Or,Br=Ie,Ur=We,255&(Ve=0|q)&&(170&Ve?Ca(ir,256,Br,Ur):Mn(ir,256,Br,Ur)),Ve=_t,ir=Vt,255&(q>>=8)&&(170&q?Ca(Or,320,Ve,ir):Mn(Or,320,Ve,ir)),fe<N.Ub-1&&(n(At[Zt].y,0,xe,Pe+480,16),n(At[Zt].f,0,Ie,We+224,8),n(At[Zt].ea,0,_t,Vt+224,8)),q=8*be*N.B,At=N.sa,Zt=N.ta+16*K+16*be*N.R,Or=N.qa,Ve=N.ra+8*K+q,ir=N.Ha,Br=N.Ia+8*K+q,q=0;16>q;++q)n(At,Zt+q*N.R,xe,Pe+32*q,16);for(q=0;8>q;++q)n(Or,Ve+q*N.B,Ie,We+32*q,8),n(ir,Br+q*N.B,_t,Vt+32*q,8)}}function wn(N,E,q,K,fe,be,xe,Pe,Ie){var We=[0],_t=[0],Vt=0,Ve=Ie!=null?Ie.kd:0,At=Ie??new Dr;if(N==null||12>q)return 7;At.data=N,At.w=E,At.ha=q,E=[E],q=[q],At.gb=[At.gb];e:{var Zt=E,Or=q,ir=At.gb;if(t(N!=null),t(Or!=null),t(ir!=null),ir[0]=0,12<=Or[0]&&!r(N,Zt[0],"RIFF")){if(r(N,Zt[0]+8,"WEBP")){ir=3;break e}var Br=ne(N,Zt[0]+4);if(12>Br||4294967286<Br){ir=3;break e}if(Ve&&Br>Or[0]-8){ir=7;break e}ir[0]=Br,Zt[0]+=12,Or[0]-=12}ir=0}if(ir!=0)return ir;for(Br=0<At.gb[0],q=q[0];;){e:{var Ur=N;Or=E,ir=q;var mn=We,sn=_t,ma=Zt=[0];if((ia=Vt=[Vt])[0]=0,8>ir[0])ir=7;else{if(!r(Ur,Or[0],"VP8X")){if(ne(Ur,Or[0]+4)!=10){ir=3;break e}if(18>ir[0]){ir=7;break e}var ra=ne(Ur,Or[0]+8),Ja=1+De(Ur,Or[0]+12);if(2147483648<=Ja*(Ur=1+De(Ur,Or[0]+15))){ir=3;break e}ma!=null&&(ma[0]=ra),mn!=null&&(mn[0]=Ja),sn!=null&&(sn[0]=Ur),Or[0]+=18,ir[0]-=18,ia[0]=1}ir=0}}if(Vt=Vt[0],Zt=Zt[0],ir!=0)return ir;if(Or=!!(2&Zt),!Br&&Vt)return 3;if(be!=null&&(be[0]=!!(16&Zt)),xe!=null&&(xe[0]=Or),Pe!=null&&(Pe[0]=0),xe=We[0],Zt=_t[0],Vt&&Or&&Ie==null){ir=0;break}if(4>q){ir=7;break}if(Br&&Vt||!Br&&!Vt&&!r(N,E[0],"ALPH")){q=[q],At.na=[At.na],At.P=[At.P],At.Sa=[At.Sa];e:{ra=N,ir=E,Br=q;var ia=At.gb;mn=At.na,sn=At.P,ma=At.Sa,Ja=22,t(ra!=null),t(Br!=null),Ur=ir[0];var us=Br[0];for(t(mn!=null),t(ma!=null),mn[0]=null,sn[0]=null,ma[0]=0;;){if(ir[0]=Ur,Br[0]=us,8>us){ir=7;break e}var Ni=ne(ra,Ur+4);if(4294967286<Ni){ir=3;break e}var Qa=8+Ni+1&-2;if(Ja+=Qa,0<ia&&Ja>ia){ir=3;break e}if(!r(ra,Ur,"VP8 ")||!r(ra,Ur,"VP8L")){ir=0;break e}if(us[0]<Qa){ir=7;break e}r(ra,Ur,"ALPH")||(mn[0]=ra,sn[0]=Ur+8,ma[0]=Ni),Ur+=Qa,us-=Qa}}if(q=q[0],At.na=At.na[0],At.P=At.P[0],At.Sa=At.Sa[0],ir!=0)break}q=[q],At.Ja=[At.Ja],At.xa=[At.xa];e:if(ia=N,ir=E,Br=q,mn=At.gb[0],sn=At.Ja,ma=At.xa,ra=ir[0],Ur=!r(ia,ra,"VP8 "),Ja=!r(ia,ra,"VP8L"),t(ia!=null),t(Br!=null),t(sn!=null),t(ma!=null),8>Br[0])ir=7;else{if(Ur||Ja){if(ia=ne(ia,ra+4),12<=mn&&ia>mn-12){ir=3;break e}if(Ve&&ia>Br[0]-8){ir=7;break e}sn[0]=ia,ir[0]+=8,Br[0]-=8,ma[0]=Ja}else ma[0]=5<=Br[0]&&ia[ra+0]==47&&!(ia[ra+4]>>5),sn[0]=Br[0];ir=0}if(q=q[0],At.Ja=At.Ja[0],At.xa=At.xa[0],E=E[0],ir!=0)break;if(4294967286<At.Ja)return 3;if(Pe==null||Or||(Pe[0]=At.xa?2:1),xe=[xe],Zt=[Zt],At.xa){if(5>q){ir=7;break}Pe=xe,Ve=Zt,Or=be,N==null||5>q?N=0:5<=q&&N[E+0]==47&&!(N[E+4]>>5)?(Br=[0],ia=[0],mn=[0],W(sn=new $,N,E,q),kt(sn,Br,ia,mn)?(Pe!=null&&(Pe[0]=Br[0]),Ve!=null&&(Ve[0]=ia[0]),Or!=null&&(Or[0]=mn[0]),N=1):N=0):N=0}else{if(10>q){ir=7;break}Pe=Zt,N==null||10>q||!aa(N,E+3,q-3)?N=0:(Ve=N[E+0]|N[E+1]<<8|N[E+2]<<16,Or=16383&(N[E+7]<<8|N[E+6]),N=16383&(N[E+9]<<8|N[E+8]),1&Ve||3<(Ve>>1&7)||!(Ve>>4&1)||Ve>>5>=At.Ja||!Or||!N?N=0:(xe&&(xe[0]=Or),Pe&&(Pe[0]=N),N=1))}if(!N||(xe=xe[0],Zt=Zt[0],Vt&&(We[0]!=xe||_t[0]!=Zt)))return 3;Ie!=null&&(Ie[0]=At,Ie.offset=E-Ie.w,t(4294967286>E-Ie.w),t(Ie.offset==Ie.ha-q));break}return ir==0||ir==7&&Vt&&Ie==null?(be!=null&&(be[0]|=At.na!=null&&0<At.na.length),K!=null&&(K[0]=xe),fe!=null&&(fe[0]=Zt),0):ir}function wr(N,E,q){var K=E.width,fe=E.height,be=0,xe=0,Pe=K,Ie=fe;if(E.Da=N!=null&&0<N.Da,E.Da&&(Pe=N.cd,Ie=N.bd,be=N.v,xe=N.j,11>q||(be&=-2,xe&=-2),0>be||0>xe||0>=Pe||0>=Ie||be+Pe>K||xe+Ie>fe))return 0;if(E.v=be,E.j=xe,E.va=be+Pe,E.o=xe+Ie,E.U=Pe,E.T=Ie,E.da=N!=null&&0<N.da,E.da){if(!Ze(Pe,Ie,q=[N.ib],be=[N.hb]))return 0;E.ib=q[0],E.hb=be[0]}return E.ob=N!=null&&N.ob,E.Kb=N==null||!N.Sd,E.da&&(E.ob=E.ib<3*K/4&&E.hb<3*fe/4,E.Kb=0),1}function Wr(N){if(N==null)return 2;if(11>N.S){var E=N.f.RGBA;E.fb+=(N.height-1)*E.A,E.A=-E.A}else E=N.f.kb,N=N.height,E.O+=(N-1)*E.fa,E.fa=-E.fa,E.N+=(N-1>>1)*E.Ab,E.Ab=-E.Ab,E.W+=(N-1>>1)*E.Db,E.Db=-E.Db,E.F!=null&&(E.J+=(N-1)*E.lb,E.lb=-E.lb);return 0}function D(N,E,q,K){if(K==null||0>=N||0>=E)return 2;if(q!=null){if(q.Da){var fe=q.cd,be=q.bd,xe=-2&q.v,Pe=-2&q.j;if(0>xe||0>Pe||0>=fe||0>=be||xe+fe>N||Pe+be>E)return 2;N=fe,E=be}if(q.da){if(!Ze(N,E,fe=[q.ib],be=[q.hb]))return 2;N=fe[0],E=be[0]}}K.width=N,K.height=E;e:{var Ie=K.width,We=K.height;if(N=K.S,0>=Ie||0>=We||!(N>=wx&&13>N))N=2;else{if(0>=K.Rd&&K.sd==null){xe=be=fe=E=0;var _t=(Pe=Ie*ds[N])*We;if(11>N||(be=(We+1)/2*(E=(Ie+1)/2),N==12&&(xe=(fe=Ie)*We)),(We=o(_t+2*be+xe))==null){N=1;break e}K.sd=We,11>N?((Ie=K.f.RGBA).eb=We,Ie.fb=0,Ie.A=Pe,Ie.size=_t):((Ie=K.f.kb).y=We,Ie.O=0,Ie.fa=Pe,Ie.Fd=_t,Ie.f=We,Ie.N=0+_t,Ie.Ab=E,Ie.Cd=be,Ie.ea=We,Ie.W=0+_t+be,Ie.Db=E,Ie.Ed=be,N==12&&(Ie.F=We,Ie.J=0+_t+2*be),Ie.Tc=xe,Ie.lb=fe)}if(E=1,fe=K.S,be=K.width,xe=K.height,fe>=wx&&13>fe)if(11>fe)N=K.f.RGBA,E&=(Pe=Math.abs(N.A))*(xe-1)+be<=N.size,E&=Pe>=be*ds[fe],E&=N.eb!=null;else{N=K.f.kb,Pe=(be+1)/2,_t=(xe+1)/2,Ie=Math.abs(N.fa),We=Math.abs(N.Ab);var Vt=Math.abs(N.Db),Ve=Math.abs(N.lb),At=Ve*(xe-1)+be;E&=Ie*(xe-1)+be<=N.Fd,E&=We*(_t-1)+Pe<=N.Cd,E=(E&=Vt*(_t-1)+Pe<=N.Ed)&Ie>=be&We>=Pe&Vt>=Pe,E&=N.y!=null,E&=N.f!=null,E&=N.ea!=null,fe==12&&(E&=Ve>=be,E&=At<=N.Tc,E&=N.F!=null)}else E=0;N=E?0:2}}return N!=0||q!=null&&q.fd&&(N=Wr(K)),N}var Q=64,M=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],H=24,le=32,X=8,Ce=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];gt("Predictor0","PredictorAdd0"),P.Predictor0=function(){return 4278190080},P.Predictor1=function(N){return N},P.Predictor2=function(N,E,q){return E[q+0]},P.Predictor3=function(N,E,q){return E[q+1]},P.Predictor4=function(N,E,q){return E[q-1]},P.Predictor5=function(N,E,q){return _e(_e(N,E[q+1]),E[q+0])},P.Predictor6=function(N,E,q){return _e(N,E[q-1])},P.Predictor7=function(N,E,q){return _e(N,E[q+0])},P.Predictor8=function(N,E,q){return _e(E[q-1],E[q+0])},P.Predictor9=function(N,E,q){return _e(E[q+0],E[q+1])},P.Predictor10=function(N,E,q){return _e(_e(N,E[q-1]),_e(E[q+0],E[q+1]))},P.Predictor11=function(N,E,q){var K=E[q+0];return 0>=gr(K>>24&255,N>>24&255,(E=E[q-1])>>24&255)+gr(K>>16&255,N>>16&255,E>>16&255)+gr(K>>8&255,N>>8&255,E>>8&255)+gr(255&K,255&N,255&E)?K:N},P.Predictor12=function(N,E,q){var K=E[q+0];return(Pt((N>>24&255)+(K>>24&255)-((E=E[q-1])>>24&255))<<24|Pt((N>>16&255)+(K>>16&255)-(E>>16&255))<<16|Pt((N>>8&255)+(K>>8&255)-(E>>8&255))<<8|Pt((255&N)+(255&K)-(255&E)))>>>0},P.Predictor13=function(N,E,q){var K=E[q-1];return(Lt((N=_e(N,E[q+0]))>>24&255,K>>24&255)<<24|Lt(N>>16&255,K>>16&255)<<16|Lt(N>>8&255,K>>8&255)<<8|Lt(255&N,255&K))>>>0};var we=P.PredictorAdd0;P.PredictorAdd1=fr,gt("Predictor2","PredictorAdd2"),gt("Predictor3","PredictorAdd3"),gt("Predictor4","PredictorAdd4"),gt("Predictor5","PredictorAdd5"),gt("Predictor6","PredictorAdd6"),gt("Predictor7","PredictorAdd7"),gt("Predictor8","PredictorAdd8"),gt("Predictor9","PredictorAdd9"),gt("Predictor10","PredictorAdd10"),gt("Predictor11","PredictorAdd11"),gt("Predictor12","PredictorAdd12"),gt("Predictor13","PredictorAdd13");var Z=P.PredictorAdd2;Ut("ColorIndexInverseTransform","MapARGB","32b",function(N){return N>>8&255},function(N){return N}),Ut("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(N){return N},function(N){return N>>8&255});var ye,Ne=P.ColorIndexInverseTransform,Re=P.MapARGB,bt=P.VP8LColorIndexInverseTransformAlpha,Rt=P.MapAlpha,dr=P.VP8LPredictorsAdd=[];dr.length=16,(P.VP8LPredictors=[]).length=16,(P.VP8LPredictorsAdd_C=[]).length=16,(P.VP8LPredictors_C=[]).length=16;var qt,rr,qr,Dn,$r,xn,$n,_n,un,Ca,Zn,Mn,Yr,Sn,Da,Ha,Xs,jo,jn,Pn,Rn,va,Ga,hs,to,Ts,Ys,Bo,mo=o(511),oa=o(2041),is=o(225),No=o(767),el=0,Ds=oa,ho=is,bs=No,Oo=mo,wx=0,Fl=1,Ll=2,_x=3,mu=4,ef=5,zf=6,tf=7,ji=8,rf=9,Ip=10,Um=[2,3,7],BA=[3,3,11],by=[280,256,256,256,40],qA=[0,1,1,1,0],wy=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],_y=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],jy=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Uf=8,Sd=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Op=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Vf=null,hc=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],O2=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Tp=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],zA=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],nf=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],T2=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],UA=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],af=[],Bc=[],hu=[],D2=1,Ny=2,Cd=[],Fi=[];pr("UpsampleRgbLinePair",Mr,3),pr("UpsampleBgrLinePair",bn,3),pr("UpsampleRgbaLinePair",Kr,4),pr("UpsampleBgraLinePair",cn,4),pr("UpsampleArgbLinePair",ys,4),pr("UpsampleRgba4444LinePair",os,2),pr("UpsampleRgb565LinePair",ca,2);var Le=P.UpsampleRgbLinePair,ut=P.UpsampleBgrLinePair,Ft=P.UpsampleRgbaLinePair,Kt=P.UpsampleBgraLinePair,lr=P.UpsampleArgbLinePair,zr=P.UpsampleRgba4444LinePair,hn=P.UpsampleRgb565LinePair,fn=16,ya=1<<fn-1,Za=-227,Fa=482,Jn=6,di=(256<<Jn)-1,Li=0,yl=o(256),Ad=o(256),$l=o(256),Pd=o(256),Vm=o(Fa-Za),ws=o(Fa-Za);An("YuvToRgbRow",Mr,3),An("YuvToBgrRow",bn,3),An("YuvToRgbaRow",Kr,4),An("YuvToBgraRow",cn,4),An("YuvToArgbRow",ys,4),An("YuvToRgba4444Row",os,2),An("YuvToRgb565Row",ca,2);var Ws=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],bl=[0,2,8],Yo=[8,7,6,4,4,2,2,2,1,1,1,1],Bl=1;this.WebPDecodeRGBA=function(N,E,q,K,fe){var be=Fl,xe=new zt,Pe=new kr;xe.ba=Pe,Pe.S=be,Pe.width=[Pe.width],Pe.height=[Pe.height];var Ie=Pe.width,We=Pe.height,_t=new _r;if(_t==null||N==null)var Vt=2;else t(_t!=null),Vt=wn(N,E,q,_t.width,_t.height,_t.Pd,_t.Qd,_t.format,null);if(Vt!=0?Ie=0:(Ie!=null&&(Ie[0]=_t.width[0]),We!=null&&(We[0]=_t.height[0]),Ie=1),Ie){Pe.width=Pe.width[0],Pe.height=Pe.height[0],K!=null&&(K[0]=Pe.width),fe!=null&&(fe[0]=Pe.height);e:{if(K=new ar,(fe=new Dr).data=N,fe.w=E,fe.ha=q,fe.kd=1,E=[0],t(fe!=null),((N=wn(fe.data,fe.w,fe.ha,null,null,null,E,null,fe))==0||N==7)&&E[0]&&(N=4),(E=N)==0){if(t(xe!=null),K.data=fe.data,K.w=fe.w+fe.offset,K.ha=fe.ha-fe.offset,K.put=ze,K.ac=qe,K.bc=Je,K.ma=xe,fe.xa){if((N=tt())==null){xe=1;break e}if(function(Ve,At){var Zt=[0],Or=[0],ir=[0];t:for(;;){if(Ve==null)return 0;if(At==null)return Ve.a=2,0;if(Ve.l=At,Ve.a=0,W(Ve.m,At.data,At.w,At.ha),!kt(Ve.m,Zt,Or,ir)){Ve.a=3;break t}if(Ve.xb=Ny,At.width=Zt[0],At.height=Or[0],!jr(Zt[0],Or[0],1,Ve,null))break t;return 1}return t(Ve.a!=0),0}(N,K)){if(K=(E=D(K.width,K.height,xe.Oa,xe.ba))==0){t:{K=N;r:for(;;){if(K==null){K=0;break t}if(t(K.s.yc!=null),t(K.s.Ya!=null),t(0<K.s.Wb),t((q=K.l)!=null),t((fe=q.ma)!=null),K.xb!=0){if(K.ca=fe.ba,K.tb=fe.tb,t(K.ca!=null),!wr(fe.Oa,q,_x)){K.a=2;break r}if(!ua(K,q.width)||q.da)break r;if((q.da||Yt(K.ca.S))&&Vr(),11>K.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),K.ca.f.kb.F!=null&&Vr()),K.Pb&&0<K.s.ua&&K.s.vb.X==null&&!ie(K.s.vb,K.s.Wa.Xa)){K.a=1;break r}K.xb=0}if(!Jr(K,K.V,K.Ba,K.c,K.i,q.o,Qt))break r;fe.Dc=K.Ma,K=1;break t}t(K.a!=0),K=0}K=!K}K&&(E=N.a)}else E=N.a}else{if((N=new kn)==null){xe=1;break e}if(N.Fa=fe.na,N.P=fe.P,N.qc=fe.Sa,pa(N,K)){if((E=D(K.width,K.height,xe.Oa,xe.ba))==0){if(N.Aa=0,q=xe.Oa,t((fe=N)!=null),q!=null){if(0<(Ie=0>(Ie=q.Md)?0:100<Ie?255:255*Ie/100)){for(We=_t=0;4>We;++We)12>(Vt=fe.pb[We]).lc&&(Vt.ia=Ie*Yo[0>Vt.lc?0:Vt.lc]>>3),_t|=Vt.ia;_t&&(alert("todo:VP8InitRandom"),fe.ia=1)}fe.Ga=q.Id,100<fe.Ga?fe.Ga=100:0>fe.Ga&&(fe.Ga=0)}(function(Ve,At){if(Ve==null)return 0;if(At==null)return Xn(Ve,2,"NULL VP8Io parameter in VP8Decode().");if(!Ve.cb&&!pa(Ve,At))return 0;if(t(Ve.cb),At.ac==null||At.ac(At)){At.ob&&(Ve.L=0);var Zt=bl[Ve.L];if(Ve.L==2?(Ve.yb=0,Ve.zb=0):(Ve.yb=At.v-Zt>>4,Ve.zb=At.j-Zt>>4,0>Ve.yb&&(Ve.yb=0),0>Ve.zb&&(Ve.zb=0)),Ve.Va=At.o+15+Zt>>4,Ve.Hb=At.va+15+Zt>>4,Ve.Hb>Ve.za&&(Ve.Hb=Ve.za),Ve.Va>Ve.Ub&&(Ve.Va=Ve.Ub),0<Ve.L){var Or=Ve.ed;for(Zt=0;4>Zt;++Zt){var ir;if(Ve.Qa.Cb){var Br=Ve.Qa.Lb[Zt];Ve.Qa.Fb||(Br+=Or.Tb)}else Br=Or.Tb;for(ir=0;1>=ir;++ir){var Ur=Ve.gd[Zt][ir],mn=Br;if(Or.Pc&&(mn+=Or.vd[0],ir&&(mn+=Or.od[0])),0<(mn=0>mn?0:63<mn?63:mn)){var sn=mn;0<Or.wb&&(sn=4<Or.wb?sn>>2:sn>>1)>9-Or.wb&&(sn=9-Or.wb),1>sn&&(sn=1),Ur.dd=sn,Ur.tc=2*mn+sn,Ur.ld=40<=mn?2:15<=mn?1:0}else Ur.tc=0;Ur.La=ir}}}Zt=0}else Xn(Ve,6,"Frame setup failed"),Zt=Ve.a;if(Zt=Zt==0){if(Zt){Ve.$c=0,0<Ve.Aa||(Ve.Ic=Bl);t:{Zt=Ve.Ic,Or=4*(sn=Ve.za);var ma=32*sn,ra=sn+1,Ja=0<Ve.L?sn*(0<Ve.Aa?2:1):0,ia=(Ve.Aa==2?2:1)*sn;if((Ur=Or+832+(ir=3*(16*Zt+bl[Ve.L])/2*ma)+(Br=Ve.Fa!=null&&0<Ve.Fa.length?Ve.Kc.c*Ve.Kc.i:0))!=Ur)Zt=0;else{if(Ur>Ve.Vb){if(Ve.Vb=0,Ve.Ec=o(Ur),Ve.Fc=0,Ve.Ec==null){Zt=Xn(Ve,1,"no memory during frame initialization.");break t}Ve.Vb=Ur}Ur=Ve.Ec,mn=Ve.Fc,Ve.Ac=Ur,Ve.Bc=mn,mn+=Or,Ve.Gd=i(ma,qn),Ve.Hd=0,Ve.rb=i(ra+1,rt),Ve.sb=1,Ve.wa=Ja?i(Ja,ur):null,Ve.Y=0,Ve.D.Nb=0,Ve.D.wa=Ve.wa,Ve.D.Y=Ve.Y,0<Ve.Aa&&(Ve.D.Y+=sn),t(!0),Ve.oc=Ur,Ve.pc=mn,mn+=832,Ve.ya=i(ia,Xt),Ve.aa=0,Ve.D.ya=Ve.ya,Ve.D.aa=Ve.aa,Ve.Aa==2&&(Ve.D.aa+=sn),Ve.R=16*sn,Ve.B=8*sn,sn=(ma=bl[Ve.L])*Ve.R,ma=ma/2*Ve.B,Ve.sa=Ur,Ve.ta=mn+sn,Ve.qa=Ve.sa,Ve.ra=Ve.ta+16*Zt*Ve.R+ma,Ve.Ha=Ve.qa,Ve.Ia=Ve.ra+8*Zt*Ve.B+ma,Ve.$c=0,mn+=ir,Ve.mb=Br?Ur:null,Ve.nb=Br?mn:null,t(mn+Br<=Ve.Fc+Ve.Vb),Te(Ve),s(Ve.Ac,Ve.Bc,0,Or),Zt=1}}if(Zt){if(At.ka=0,At.y=Ve.sa,At.O=Ve.ta,At.f=Ve.qa,At.N=Ve.ra,At.ea=Ve.Ha,At.Vd=Ve.Ia,At.fa=Ve.R,At.Rc=Ve.B,At.F=null,At.J=0,!el){for(Zt=-255;255>=Zt;++Zt)mo[255+Zt]=0>Zt?-Zt:Zt;for(Zt=-1020;1020>=Zt;++Zt)oa[1020+Zt]=-128>Zt?-128:127<Zt?127:Zt;for(Zt=-112;112>=Zt;++Zt)is[112+Zt]=-16>Zt?-16:15<Zt?15:Zt;for(Zt=-255;510>=Zt;++Zt)No[255+Zt]=0>Zt?0:255<Zt?255:Zt;el=1}$n=Et,_n=Ge,Ca=Ye,Zn=ft,Mn=yt,un=Be,Yr=fu,Sn=vl,Da=R,Ha=pe,Xs=Xo,jo=Zi,jn=He,Pn=mt,Rn=_i,va=ts,Ga=xl,hs=Ba,Bc[0]=za,Bc[1]=Ue,Bc[2]=Wa,Bc[3]=Ya,Bc[4]=vs,Bc[5]=ss,Bc[6]=Os,Bc[7]=Io,Bc[8]=ii,Bc[9]=Vs,af[0]=Qn,af[1]=Nr,af[2]=an,af[3]=Lr,af[4]=Ta,af[5]=zn,af[6]=Fn,hu[0]=Fc,hu[1]=St,hu[2]=Rl,hu[3]=li,hu[4]=ci,hu[5]=mc,hu[6]=Lc,Zt=1}else Zt=0}Zt&&(Zt=function(us,Ni){for(us.M=0;us.M<us.Va;++us.M){var Qa,la=us.Jc[us.M&us.Xb],Ln=us.m,Jo=us;for(Qa=0;Qa<Jo.za;++Qa){var Ka=Ln,ps=Jo,po=ps.Ac,tl=ps.Bc+4*Qa,ql=ps.zc,qo=ps.ya[ps.aa+Qa];if(ps.Qa.Bb?qo.$b=ae(Ka,ps.Pa.jb[0])?2+ae(Ka,ps.Pa.jb[2]):ae(Ka,ps.Pa.jb[1]):qo.$b=0,ps.kc&&(qo.Ad=ae(Ka,ps.Bd)),qo.Za=!ae(Ka,145)+0,qo.Za){var wl=qo.Ob,zl=0;for(ps=0;4>ps;++ps){var Si,_s=ql[0+ps];for(Si=0;4>Si;++Si){_s=nf[po[tl+Si]][_s];for(var Ms=Tp[ae(Ka,_s[0])];0<Ms;)Ms=Tp[2*Ms+ae(Ka,_s[Ms])];_s=-Ms,po[tl+Si]=_s}n(wl,zl,po,tl,4),zl+=4,ql[0+ps]=_s}}else _s=ae(Ka,156)?ae(Ka,128)?1:3:ae(Ka,163)?2:0,qo.Ob[0]=_s,s(po,tl,_s,4),s(ql,0,_s,4);qo.Dd=ae(Ka,142)?ae(Ka,114)?ae(Ka,183)?1:3:2:0}if(Jo.m.Ka)return Xn(us,7,"Premature end-of-partition0 encountered.");for(;us.ja<us.za;++us.ja){if(Jo=la,Ka=(Ln=us).rb[Ln.sb-1],po=Ln.rb[Ln.sb+Ln.ja],Qa=Ln.ya[Ln.aa+Ln.ja],tl=Ln.kc?Qa.Ad:0)Ka.la=po.la=0,Qa.Za||(Ka.Na=po.Na=0),Qa.Hc=0,Qa.Gc=0,Qa.ia=0;else{var zo,Rs;if(Ka=po,po=Jo,tl=Ln.Pa.Xc,ql=Ln.ya[Ln.aa+Ln.ja],qo=Ln.pb[ql.$b],ps=ql.ad,wl=0,zl=Ln.rb[Ln.sb-1],_s=Si=0,s(ps,wl,0,384),ql.Za)var rl=0,pu=tl[3];else{Ms=o(16);var Qo=Ka.Na+zl.Na;if(Qo=Vf(po,tl[1],Qo,qo.Eb,0,Ms,0),Ka.Na=zl.Na=(0<Qo)+0,1<Qo)$n(Ms,0,ps,wl);else{var pc=Ms[0]+3>>3;for(Ms=0;256>Ms;Ms+=16)ps[wl+Ms]=pc}rl=1,pu=tl[0]}var Js=15&Ka.la,Ci=15&zl.la;for(Ms=0;4>Ms;++Ms){var qc=1&Ci;for(pc=Rs=0;4>pc;++pc)Js=Js>>1|(qc=(Qo=Vf(po,pu,Qo=qc+(1&Js),qo.Sc,rl,ps,wl))>rl)<<7,Rs=Rs<<2|(3<Qo?3:1<Qo?2:ps[wl+0]!=0),wl+=16;Js>>=4,Ci=Ci>>1|qc<<7,Si=(Si<<8|Rs)>>>0}for(pu=Js,rl=Ci>>4,zo=0;4>zo;zo+=2){for(Rs=0,Js=Ka.la>>4+zo,Ci=zl.la>>4+zo,Ms=0;2>Ms;++Ms){for(qc=1&Ci,pc=0;2>pc;++pc)Qo=qc+(1&Js),Js=Js>>1|(qc=0<(Qo=Vf(po,tl[2],Qo,qo.Qc,0,ps,wl)))<<3,Rs=Rs<<2|(3<Qo?3:1<Qo?2:ps[wl+0]!=0),wl+=16;Js>>=2,Ci=Ci>>1|qc<<5}_s|=Rs<<4*zo,pu|=Js<<4<<zo,rl|=(240&Ci)<<zo}Ka.la=pu,zl.la=rl,ql.Hc=Si,ql.Gc=_s,ql.ia=43690&_s?0:qo.ia,tl=!(Si|_s)}if(0<Ln.L&&(Ln.wa[Ln.Y+Ln.ja]=Ln.gd[Qa.$b][Qa.Za],Ln.wa[Ln.Y+Ln.ja].La|=!tl),Jo.Ka)return Xn(us,7,"Premature end-of-file encountered.")}if(Te(us),Ln=Ni,Jo=1,Qa=(la=us).D,Ka=0<la.L&&la.M>=la.zb&&la.M<=la.Va,la.Aa==0)t:{if(Qa.M=la.M,Qa.uc=Ka,Ir(la,Qa),Jo=1,Qa=(Rs=la.D).Nb,Ka=(_s=bl[la.L])*la.R,po=_s/2*la.B,Ms=16*Qa*la.R,pc=8*Qa*la.B,tl=la.sa,ql=la.ta-Ka+Ms,qo=la.qa,ps=la.ra-po+pc,wl=la.Ha,zl=la.Ia-po+pc,Ci=(Js=Rs.M)==0,Si=Js>=la.Va-1,la.Aa==2&&Ir(la,Rs),Rs.uc)for(qc=(Qo=la).D.M,t(Qo.D.uc),Rs=Qo.yb;Rs<Qo.Hb;++Rs){rl=Rs,pu=qc;var Ul=(zc=(nl=Qo).D).Nb;zo=nl.R;var zc=zc.wa[zc.Y+rl],Uc=nl.sa,gc=nl.ta+16*Ul*zo+16*rl,Vc=zc.dd,ro=zc.tc;if(ro!=0)if(t(3<=ro),nl.L==1)0<rl&&va(Uc,gc,zo,ro+4),zc.La&&hs(Uc,gc,zo,ro),0<pu&&Rn(Uc,gc,zo,ro+4),zc.La&&Ga(Uc,gc,zo,ro);else{var Wc=nl.B,gu=nl.qa,Dp=nl.ra+8*Ul*Wc+8*rl,Wf=nl.Ha,nl=nl.Ia+8*Ul*Wc+8*rl;Ul=zc.ld,0<rl&&(Sn(Uc,gc,zo,ro+4,Vc,Ul),Ha(gu,Dp,Wf,nl,Wc,ro+4,Vc,Ul)),zc.La&&(jo(Uc,gc,zo,ro,Vc,Ul),Pn(gu,Dp,Wf,nl,Wc,ro,Vc,Ul)),0<pu&&(Yr(Uc,gc,zo,ro+4,Vc,Ul),Da(gu,Dp,Wf,nl,Wc,ro+4,Vc,Ul)),zc.La&&(Xs(Uc,gc,zo,ro,Vc,Ul),jn(gu,Dp,Wf,nl,Wc,ro,Vc,Ul))}}if(la.ia&&alert("todo:DitherRow"),Ln.put!=null){if(Rs=16*Js,Js=16*(Js+1),Ci?(Ln.y=la.sa,Ln.O=la.ta+Ms,Ln.f=la.qa,Ln.N=la.ra+pc,Ln.ea=la.Ha,Ln.W=la.Ia+pc):(Rs-=_s,Ln.y=tl,Ln.O=ql,Ln.f=qo,Ln.N=ps,Ln.ea=wl,Ln.W=zl),Si||(Js-=_s),Js>Ln.o&&(Js=Ln.o),Ln.F=null,Ln.J=null,la.Fa!=null&&0<la.Fa.length&&Rs<Js&&(Ln.J=Bt(la,Ln,Rs,Js-Rs),Ln.F=la.mb,Ln.F==null&&Ln.F.length==0)){Jo=Xn(la,3,"Could not decode alpha data.");break t}Rs<Ln.j&&(_s=Ln.j-Rs,Rs=Ln.j,t(!(1&_s)),Ln.O+=la.R*_s,Ln.N+=la.B*(_s>>1),Ln.W+=la.B*(_s>>1),Ln.F!=null&&(Ln.J+=Ln.width*_s)),Rs<Js&&(Ln.O+=Ln.v,Ln.N+=Ln.v>>1,Ln.W+=Ln.v>>1,Ln.F!=null&&(Ln.J+=Ln.v),Ln.ka=Rs-Ln.j,Ln.U=Ln.va-Ln.v,Ln.T=Js-Rs,Jo=Ln.put(Ln))}Qa+1!=la.Ic||Si||(n(la.sa,la.ta-Ka,tl,ql+16*la.R,Ka),n(la.qa,la.ra-po,qo,ps+8*la.B,po),n(la.Ha,la.Ia-po,wl,zl+8*la.B,po))}if(!Jo)return Xn(us,6,"Output aborted.")}return 1}(Ve,At)),At.bc!=null&&At.bc(At),Zt&=1}return Zt?(Ve.cb=0,Zt):0})(N,K)||(E=N.a)}}else E=N.a}E==0&&xe.Oa!=null&&xe.Oa.fd&&(E=Wr(xe.ba))}xe=E}be=xe!=0?null:11>be?Pe.f.RGBA.eb:Pe.f.kb.y}else be=null;return be};var ds=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(P,F){for(var O="",I=0;I<4;I++)O+=String.fromCharCode(P[F++]);return O}function u(P,F){return P[F+0]|P[F+1]<<8}function f(P,F){return(P[F+0]|P[F+1]<<8|P[F+2]<<16)>>>0}function h(P,F){return(P[F+0]|P[F+1]<<8|P[F+2]<<16|P[F+3]<<24)>>>0}new c;var m=[0],x=[0],g=[],y=new c,v=e,b=function(P,F){var O={},I=0,T=!1,k=0,B=0;if(O.frames=[],!function(V,$){for(var Y=0;Y<4;Y++)if(V[$+Y]!="RIFF".charCodeAt(Y))return!0;return!1}(P,F)){for(h(P,F+=4),F+=8;F<P.length;){var z=d(P,F),U=h(P,F+=4);F+=4;var L=U+(1&U);switch(z){case"VP8 ":case"VP8L":O.frames[I]===void 0&&(O.frames[I]={}),(Ae=O.frames[I]).src_off=T?B:F-8,Ae.src_size=k+U+8,I++,T&&(T=!1,k=0,B=0);break;case"VP8X":(Ae=O.header={}).feature_flags=P[F];var W=F+4;Ae.canvas_width=1+f(P,W),W+=3,Ae.canvas_height=1+f(P,W),W+=3;break;case"ALPH":T=!0,k=L+8,B=F-8;break;case"ANIM":(Ae=O.header).bgcolor=h(P,F),W=F+4,Ae.loop_count=u(P,W),W+=2;break;case"ANMF":var ge,Ae;(Ae=O.frames[I]={}).offset_x=2*f(P,F),F+=3,Ae.offset_y=2*f(P,F),F+=3,Ae.width=1+f(P,F),F+=3,Ae.height=1+f(P,F),F+=3,Ae.duration=f(P,F),F+=3,ge=P[F++],Ae.dispose=1&ge,Ae.blend=ge>>1&1}z!="ANMF"&&(F+=L)}return O}}(v,0);b.response=v,b.rgbaoutput=!0,b.dataurl=!1;var w=b.header?b.header:null,_=b.frames?b.frames:null;if(w){w.loop_counter=w.loop_count,m=[w.canvas_height],x=[w.canvas_width];for(var j=0;j<_.length&&_[j].blend!=0;j++);}var S=_[0],C=y.WebPDecodeRGBA(v,S.src_off,S.src_size,x,m);S.rgba=C,S.imgwidth=x[0],S.imgheight=m[0];for(var A=0;A<x[0]*m[0]*4;A++)g[A]=C[A];return this.width=x,this.height=m,this.data=g,this}(function(e){var t,r,n,s,o,i,l,c,d,u=function(V){return V=V||{},this.isStrokeTransparent=V.isStrokeTransparent||!1,this.strokeOpacity=V.strokeOpacity||1,this.strokeStyle=V.strokeStyle||"#000000",this.fillStyle=V.fillStyle||"#000000",this.isFillTransparent=V.isFillTransparent||!1,this.fillOpacity=V.fillOpacity||1,this.font=V.font||"10px sans-serif",this.textBaseline=V.textBaseline||"alphabetic",this.textAlign=V.textAlign||"left",this.lineWidth=V.lineWidth||1,this.lineJoin=V.lineJoin||"miter",this.lineCap=V.lineCap||"butt",this.path=V.path||[],this.transform=V.transform!==void 0?V.transform.clone():new c,this.globalCompositeOperation=V.globalCompositeOperation||"normal",this.globalAlpha=V.globalAlpha||1,this.clip_path=V.clip_path||[],this.currentPoint=V.currentPoint||new i,this.miterLimit=V.miterLimit||10,this.lastPoint=V.lastPoint||new i,this.lineDashOffset=V.lineDashOffset||0,this.lineDash=V.lineDash||[],this.margin=V.margin||[0,0,0,0],this.prevPageLastElemOffset=V.prevPageLastElemOffset||0,this.ignoreClearRect=typeof V.ignoreClearRect!="boolean"||V.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new f(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,i=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,d=new u}]);var f=function(V){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var $=V;Object.defineProperty(this,"pdf",{get:function(){return $}});var Y=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Y},set:function(ne){Y=!!ne}});var he=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return he},set:function(ne){he=!!ne}});var J=0;Object.defineProperty(this,"posX",{get:function(){return J},set:function(ne){isNaN(ne)||(J=ne)}});var G=0;Object.defineProperty(this,"posY",{get:function(){return G},set:function(ne){isNaN(ne)||(G=ne)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function(ne){var ie;typeof ne=="number"?ie=[ne,ne,ne,ne]:((ie=new Array(4))[0]=ne[0],ie[1]=ne.length>=2?ne[1]:ie[0],ie[2]=ne.length>=3?ne[2]:ie[0],ie[3]=ne.length>=4?ne[3]:ie[1]),d.margin=ie}});var ue=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ue},set:function(ne){ue=ne}});var ve=0;Object.defineProperty(this,"lastBreak",{get:function(){return ve},set:function(ne){ve=ne}});var ae=[];Object.defineProperty(this,"pageBreaks",{get:function(){return ae},set:function(ne){ae=ne}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function(ne){ne instanceof u&&(d=ne)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function(ne){d.path=ne}});var oe=[];Object.defineProperty(this,"ctxStack",{get:function(){return oe},set:function(ne){oe=ne}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(ne){var ie;ie=h(ne),this.ctx.fillStyle=ie.style,this.ctx.isFillTransparent=ie.a===0,this.ctx.fillOpacity=ie.a,this.pdf.setFillColor(ie.r,ie.g,ie.b,{a:ie.a}),this.pdf.setTextColor(ie.r,ie.g,ie.b,{a:ie.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(ne){var ie=h(ne);this.ctx.strokeStyle=ie.style,this.ctx.isStrokeTransparent=ie.a===0,this.ctx.strokeOpacity=ie.a,ie.a===0?this.pdf.setDrawColor(255,255,255):(ie.a,this.pdf.setDrawColor(ie.r,ie.g,ie.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(ne){["butt","round","square"].indexOf(ne)!==-1&&(this.ctx.lineCap=ne,this.pdf.setLineCap(ne))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(ne){isNaN(ne)||(this.ctx.lineWidth=ne,this.pdf.setLineWidth(ne))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(ne){["bevel","round","miter"].indexOf(ne)!==-1&&(this.ctx.lineJoin=ne,this.pdf.setLineJoin(ne))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(ne){isNaN(ne)||(this.ctx.miterLimit=ne,this.pdf.setMiterLimit(ne))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(ne){this.ctx.textBaseline=ne}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(ne){["right","end","center","left","start"].indexOf(ne)!==-1&&(this.ctx.textAlign=ne)}});var me=null,De=null;Object.defineProperty(this,"fontFaces",{get:function(){return De},set:function(ne){me=null,De=ne}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(ne){var ie;if(this.ctx.font=ne,(ie=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(ne))!==null){var ht=ie[1];ie[2];var pt=ie[3],Ze=ie[4];ie[5];var vt=ie[6],wt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Ze)[2];Ze=Math.floor(wt==="px"?parseFloat(Ze)*this.pdf.internal.scaleFactor:wt==="em"?parseFloat(Ze)*this.pdf.getFontSize():parseFloat(Ze)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Ze);var gt=function($t){var Ut,Fe,xt=[],Ot=$t.trim();if(Ot==="")return fk;if(Ot in nU)return[nU[Ot]];for(;Ot!=="";){switch(Fe=null,Ut=(Ot=sU(Ot)).charAt(0)){case'"':case"'":Fe=YQe(Ot.substring(1),Ut);break;default:Fe=JQe(Ot)}if(Fe===null||(xt.push(Fe[0]),(Ot=sU(Fe[1]))!==""&&Ot.charAt(0)!==","))return fk;Ot=Ot.replace(/^,/,"")}return xt}(vt);if(this.fontFaces){var er=function($t,Ut){if(me===null){var Fe=function(xt){var Ot=[];return Object.keys(xt).forEach(function(Cr){xt[Cr].forEach(function(Me){var Qe=null;switch(Me){case"bold":Qe={family:Cr,weight:"bold"};break;case"italic":Qe={family:Cr,style:"italic"};break;case"bolditalic":Qe={family:Cr,weight:"bold",style:"italic"};break;case"":case"normal":Qe={family:Cr}}Qe!==null&&(Qe.ref={name:Cr,style:Me},Ot.push(Qe))})}),Ot}($t.getFontList());me=function(xt){for(var Ot={},Cr=0;Cr<xt.length;++Cr){var Me=uk(xt[Cr]),Qe=Me.family,et=Me.stretch,Yt=Me.style,xr=Me.weight;Ot[Qe]=Ot[Qe]||{},Ot[Qe][et]=Ot[Qe][et]||{},Ot[Qe][et][Yt]=Ot[Qe][et][Yt]||{},Ot[Qe][et][Yt][xr]=Me}return Ot}(Fe.concat(Ut))}return me}(this.pdf,this.fontFaces),_e=gt.map(function($t){return{family:$t,stretch:"normal",weight:pt,style:ht}}),Pt=function($t,Ut,Fe){for(var xt=(Fe=Fe||{}).defaultFontFamily||"times",Ot=Object.assign({},XQe,Fe.genericFontFamilies||{}),Cr=null,Me=null,Qe=0;Qe<Ut.length;++Qe)if(Ot[(Cr=uk(Ut[Qe])).family]&&(Cr.family=Ot[Cr.family]),$t.hasOwnProperty(Cr.family)){Me=$t[Cr.family];break}if(!(Me=Me||$t[xt]))throw new Error("Could not find a font-family for the rule '"+aU(Cr)+"' and default family '"+xt+"'.");if(Me=function(et,Yt){if(Yt[et])return Yt[et];var xr=k3[et],Jt=xr<=k3.normal?-1:1,kr=rU(Yt,Fae,xr,Jt);if(!kr)throw new Error("Could not find a matching font-stretch value for "+et);return kr}(Cr.stretch,Me),Me=function(et,Yt){if(Yt[et])return Yt[et];for(var xr=Rae[et],Jt=0;Jt<xr.length;++Jt)if(Yt[xr[Jt]])return Yt[xr[Jt]];throw new Error("Could not find a matching font-style for "+et)}(Cr.style,Me),!(Me=function(et,Yt){if(Yt[et])return Yt[et];if(et===400&&Yt[500])return Yt[500];if(et===500&&Yt[400])return Yt[400];var xr=KQe[et],Jt=rU(Yt,Lae,xr,et<400?-1:1);if(!Jt)throw new Error("Could not find a matching font-weight for value "+et);return Jt}(Cr.weight,Me)))throw new Error("Failed to resolve a font for the rule '"+aU(Cr)+"'.");return Me}(er,_e);this.pdf.setFont(Pt.ref.name,Pt.ref.style)}else{var Lt="";(pt==="bold"||parseInt(pt,10)>=700||ht==="bold")&&(Lt="bold"),ht==="italic"&&(Lt+="italic"),Lt.length===0&&(Lt="normal");for(var gr="",fr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},je=0;je<gt.length;je++){if(this.pdf.internal.getFont(gt[je],Lt,{noFallback:!0,disableWarning:!0})!==void 0){gr=gt[je];break}if(Lt==="bolditalic"&&this.pdf.internal.getFont(gt[je],"bold",{noFallback:!0,disableWarning:!0})!==void 0)gr=gt[je],Lt="bold";else if(this.pdf.internal.getFont(gt[je],"normal",{noFallback:!0,disableWarning:!0})!==void 0){gr=gt[je],Lt="normal";break}}if(gr===""){for(var nt=0;nt<gt.length;nt++)if(fr[gt[nt]]){gr=fr[gt[nt]];break}}gr=gr===""?"Times":gr,this.pdf.setFont(gr,Lt)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(ne){this.ctx.globalCompositeOperation=ne}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(ne){this.ctx.globalAlpha=ne}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(ne){this.ctx.lineDashOffset=ne,Ae.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(ne){this.ctx.lineDash=ne,Ae.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(ne){this.ctx.ignoreClearRect=!!ne}})};f.prototype.setLineDash=function(V){this.lineDash=V},f.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},f.prototype.fill=function(){_.call(this,"fill",!1)},f.prototype.stroke=function(){_.call(this,"stroke",!1)},f.prototype.beginPath=function(){this.path=[{type:"begin"}]},f.prototype.moveTo=function(V,$){if(isNaN(V)||isNaN($))throw Qs.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Y=this.ctx.transform.applyToPoint(new i(V,$));this.path.push({type:"mt",x:Y.x,y:Y.y}),this.ctx.lastPoint=new i(V,$)},f.prototype.closePath=function(){var V=new i(0,0),$=0;for($=this.path.length-1;$!==-1;$--)if(this.path[$].type==="begin"&&cs(this.path[$+1])==="object"&&typeof this.path[$+1].x=="number"){V=new i(this.path[$+1].x,this.path[$+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new i(V.x,V.y)},f.prototype.lineTo=function(V,$){if(isNaN(V)||isNaN($))throw Qs.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Y=this.ctx.transform.applyToPoint(new i(V,$));this.path.push({type:"lt",x:Y.x,y:Y.y}),this.ctx.lastPoint=new i(Y.x,Y.y)},f.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),_.call(this,null,!0)},f.prototype.quadraticCurveTo=function(V,$,Y,he){if(isNaN(Y)||isNaN(he)||isNaN(V)||isNaN($))throw Qs.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var J=this.ctx.transform.applyToPoint(new i(Y,he)),G=this.ctx.transform.applyToPoint(new i(V,$));this.path.push({type:"qct",x1:G.x,y1:G.y,x:J.x,y:J.y}),this.ctx.lastPoint=new i(J.x,J.y)},f.prototype.bezierCurveTo=function(V,$,Y,he,J,G){if(isNaN(J)||isNaN(G)||isNaN(V)||isNaN($)||isNaN(Y)||isNaN(he))throw Qs.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ue=this.ctx.transform.applyToPoint(new i(J,G)),ve=this.ctx.transform.applyToPoint(new i(V,$)),ae=this.ctx.transform.applyToPoint(new i(Y,he));this.path.push({type:"bct",x1:ve.x,y1:ve.y,x2:ae.x,y2:ae.y,x:ue.x,y:ue.y}),this.ctx.lastPoint=new i(ue.x,ue.y)},f.prototype.arc=function(V,$,Y,he,J,G){if(isNaN(V)||isNaN($)||isNaN(Y)||isNaN(he)||isNaN(J))throw Qs.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(G=!!G,!this.ctx.transform.isIdentity){var ue=this.ctx.transform.applyToPoint(new i(V,$));V=ue.x,$=ue.y;var ve=this.ctx.transform.applyToPoint(new i(0,Y)),ae=this.ctx.transform.applyToPoint(new i(0,0));Y=Math.sqrt(Math.pow(ve.x-ae.x,2)+Math.pow(ve.y-ae.y,2))}Math.abs(J-he)>=2*Math.PI&&(he=0,J=2*Math.PI),this.path.push({type:"arc",x:V,y:$,radius:Y,startAngle:he,endAngle:J,counterclockwise:G})},f.prototype.arcTo=function(V,$,Y,he,J){throw new Error("arcTo not implemented.")},f.prototype.rect=function(V,$,Y,he){if(isNaN(V)||isNaN($)||isNaN(Y)||isNaN(he))throw Qs.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(V,$),this.lineTo(V+Y,$),this.lineTo(V+Y,$+he),this.lineTo(V,$+he),this.lineTo(V,$),this.lineTo(V+Y,$),this.lineTo(V,$)},f.prototype.fillRect=function(V,$,Y,he){if(isNaN(V)||isNaN($)||isNaN(Y)||isNaN(he))throw Qs.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!m.call(this)){var J={};this.lineCap!=="butt"&&(J.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(J.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(V,$,Y,he),this.fill(),J.hasOwnProperty("lineCap")&&(this.lineCap=J.lineCap),J.hasOwnProperty("lineJoin")&&(this.lineJoin=J.lineJoin)}},f.prototype.strokeRect=function(V,$,Y,he){if(isNaN(V)||isNaN($)||isNaN(Y)||isNaN(he))throw Qs.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");x.call(this)||(this.beginPath(),this.rect(V,$,Y,he),this.stroke())},f.prototype.clearRect=function(V,$,Y,he){if(isNaN(V)||isNaN($)||isNaN(Y)||isNaN(he))throw Qs.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(V,$,Y,he))},f.prototype.save=function(V){V=typeof V!="boolean"||V;for(var $=this.pdf.internal.getCurrentPageInfo().pageNumber,Y=0;Y<this.pdf.internal.getNumberOfPages();Y++)this.pdf.setPage(Y+1),this.pdf.internal.out("q");if(this.pdf.setPage($),V){this.ctx.fontSize=this.pdf.internal.getFontSize();var he=new u(this.ctx);this.ctxStack.push(this.ctx),this.ctx=he}},f.prototype.restore=function(V){V=typeof V!="boolean"||V;for(var $=this.pdf.internal.getCurrentPageInfo().pageNumber,Y=0;Y<this.pdf.internal.getNumberOfPages();Y++)this.pdf.setPage(Y+1),this.pdf.internal.out("Q");this.pdf.setPage($),V&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},f.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(V){var $,Y,he,J;if(V.isCanvasGradient===!0&&(V=V.getColor()),!V)return{r:0,g:0,b:0,a:0,style:V};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(V))$=0,Y=0,he=0,J=0;else{var G=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(V);if(G!==null)$=parseInt(G[1]),Y=parseInt(G[2]),he=parseInt(G[3]),J=1;else if((G=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(V))!==null)$=parseInt(G[1]),Y=parseInt(G[2]),he=parseInt(G[3]),J=parseFloat(G[4]);else{if(J=1,typeof V=="string"&&V.charAt(0)!=="#"){var ue=new Eae(V);V=ue.ok?ue.toHex():"#000000"}V.length===4?($=V.substring(1,2),$+=$,Y=V.substring(2,3),Y+=Y,he=V.substring(3,4),he+=he):($=V.substring(1,3),Y=V.substring(3,5),he=V.substring(5,7)),$=parseInt($,16),Y=parseInt(Y,16),he=parseInt(he,16)}}return{r:$,g:Y,b:he,a:J,style:V}},m=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},x=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};f.prototype.fillText=function(V,$,Y,he){if(isNaN($)||isNaN(Y)||typeof V!="string")throw Qs.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(he=isNaN(he)?void 0:he,!m.call(this)){var J=L(this.ctx.transform.rotation),G=this.ctx.transform.scaleX;I.call(this,{text:V,x:$,y:Y,scale:G,angle:J,align:this.textAlign,maxWidth:he})}},f.prototype.strokeText=function(V,$,Y,he){if(isNaN($)||isNaN(Y)||typeof V!="string")throw Qs.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!x.call(this)){he=isNaN(he)?void 0:he;var J=L(this.ctx.transform.rotation),G=this.ctx.transform.scaleX;I.call(this,{text:V,x:$,y:Y,scale:G,renderingMode:"stroke",angle:J,align:this.textAlign,maxWidth:he})}},f.prototype.measureText=function(V){if(typeof V!="string")throw Qs.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var $=this.pdf,Y=this.pdf.internal.scaleFactor,he=$.internal.getFontSize(),J=$.getStringUnitWidth(V)*he/$.internal.scaleFactor;return new function(G){var ue=(G=G||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ue}}),this}({width:J*=Math.round(96*Y/72*1e4)/1e4})},f.prototype.scale=function(V,$){if(isNaN(V)||isNaN($))throw Qs.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Y=new c(V,0,0,$,0,0);this.ctx.transform=this.ctx.transform.multiply(Y)},f.prototype.rotate=function(V){if(isNaN(V))throw Qs.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var $=new c(Math.cos(V),Math.sin(V),-Math.sin(V),Math.cos(V),0,0);this.ctx.transform=this.ctx.transform.multiply($)},f.prototype.translate=function(V,$){if(isNaN(V)||isNaN($))throw Qs.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Y=new c(1,0,0,1,V,$);this.ctx.transform=this.ctx.transform.multiply(Y)},f.prototype.transform=function(V,$,Y,he,J,G){if(isNaN(V)||isNaN($)||isNaN(Y)||isNaN(he)||isNaN(J)||isNaN(G))throw Qs.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ue=new c(V,$,Y,he,J,G);this.ctx.transform=this.ctx.transform.multiply(ue)},f.prototype.setTransform=function(V,$,Y,he,J,G){V=isNaN(V)?1:V,$=isNaN($)?0:$,Y=isNaN(Y)?0:Y,he=isNaN(he)?1:he,J=isNaN(J)?0:J,G=isNaN(G)?0:G,this.ctx.transform=new c(V,$,Y,he,J,G)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};f.prototype.drawImage=function(V,$,Y,he,J,G,ue,ve,ae){var oe=this.pdf.getImageProperties(V),me=1,De=1,ne=1,ie=1;he!==void 0&&ve!==void 0&&(ne=ve/he,ie=ae/J,me=oe.width/he*ve/he,De=oe.height/J*ae/J),G===void 0&&(G=$,ue=Y,$=0,Y=0),he!==void 0&&ve===void 0&&(ve=he,ae=J),he===void 0&&ve===void 0&&(ve=oe.width,ae=oe.height);for(var ht,pt=this.ctx.transform.decompose(),Ze=L(pt.rotate.shx),vt=new c,wt=(vt=(vt=(vt=vt.multiply(pt.translate)).multiply(pt.skew)).multiply(pt.scale)).applyToRectangle(new l(G-$*ne,ue-Y*ie,he*me,J*De)),gt=y.call(this,wt),er=[],_e=0;_e<gt.length;_e+=1)er.indexOf(gt[_e])===-1&&er.push(gt[_e]);if(w(er),this.autoPaging)for(var Pt=er[0],Lt=er[er.length-1],gr=Pt;gr<Lt+1;gr++){this.pdf.setPage(gr);var fr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],je=gr===1?this.posY+this.margin[0]:this.margin[0],nt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],$t=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ut=gr===1?0:nt+(gr-2)*$t;if(this.ctx.clip_path.length!==0){var Fe=this.path;ht=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(ht,this.posX+this.margin[3],-Ut+je+this.ctx.prevPageLastElemOffset),j.call(this,"fill",!0),this.path=Fe}var xt=JSON.parse(JSON.stringify(wt));xt=b([xt],this.posX+this.margin[3],-Ut+je+this.ctx.prevPageLastElemOffset)[0];var Ot=(gr>Pt||gr<Lt)&&g.call(this);Ot&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],fr,$t,null).clip().discardPath()),this.pdf.addImage(V,"JPEG",xt.x,xt.y,xt.w,xt.h,null,null,Ze),Ot&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(V,"JPEG",wt.x,wt.y,wt.w,wt.h,null,null,Ze)};var y=function(V,$,Y){var he=[];$=$||this.pdf.internal.pageSize.width,Y=Y||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var J=this.posY+this.ctx.prevPageLastElemOffset;switch(V.type){default:case"mt":case"lt":he.push(Math.floor((V.y+J)/Y)+1);break;case"arc":he.push(Math.floor((V.y+J-V.radius)/Y)+1),he.push(Math.floor((V.y+J+V.radius)/Y)+1);break;case"qct":var G=W(this.ctx.lastPoint.x,this.ctx.lastPoint.y,V.x1,V.y1,V.x,V.y);he.push(Math.floor((G.y+J)/Y)+1),he.push(Math.floor((G.y+G.h+J)/Y)+1);break;case"bct":var ue=ge(this.ctx.lastPoint.x,this.ctx.lastPoint.y,V.x1,V.y1,V.x2,V.y2,V.x,V.y);he.push(Math.floor((ue.y+J)/Y)+1),he.push(Math.floor((ue.y+ue.h+J)/Y)+1);break;case"rect":he.push(Math.floor((V.y+J)/Y)+1),he.push(Math.floor((V.y+V.h+J)/Y)+1)}for(var ve=0;ve<he.length;ve+=1)for(;this.pdf.internal.getNumberOfPages()<he[ve];)v.call(this);return he},v=function(){var V=this.fillStyle,$=this.strokeStyle,Y=this.font,he=this.lineCap,J=this.lineWidth,G=this.lineJoin;this.pdf.addPage(),this.fillStyle=V,this.strokeStyle=$,this.font=Y,this.lineCap=he,this.lineWidth=J,this.lineJoin=G},b=function(V,$,Y){for(var he=0;he<V.length;he++)switch(V[he].type){case"bct":V[he].x2+=$,V[he].y2+=Y;case"qct":V[he].x1+=$,V[he].y1+=Y;default:V[he].x+=$,V[he].y+=Y}return V},w=function(V){return V.sort(function($,Y){return $-Y})},_=function(V,$){for(var Y,he,J=this.fillStyle,G=this.strokeStyle,ue=this.lineCap,ve=this.lineWidth,ae=Math.abs(ve*this.ctx.transform.scaleX),oe=this.lineJoin,me=JSON.parse(JSON.stringify(this.path)),De=JSON.parse(JSON.stringify(this.path)),ne=[],ie=0;ie<De.length;ie++)if(De[ie].x!==void 0)for(var ht=y.call(this,De[ie]),pt=0;pt<ht.length;pt+=1)ne.indexOf(ht[pt])===-1&&ne.push(ht[pt]);for(var Ze=0;Ze<ne.length;Ze++)for(;this.pdf.internal.getNumberOfPages()<ne[Ze];)v.call(this);if(w(ne),this.autoPaging)for(var vt=ne[0],wt=ne[ne.length-1],gt=vt;gt<wt+1;gt++){this.pdf.setPage(gt),this.fillStyle=J,this.strokeStyle=G,this.lineCap=ue,this.lineWidth=ae,this.lineJoin=oe;var er=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],_e=gt===1?this.posY+this.margin[0]:this.margin[0],Pt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Lt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],gr=gt===1?0:Pt+(gt-2)*Lt;if(this.ctx.clip_path.length!==0){var fr=this.path;Y=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(Y,this.posX+this.margin[3],-gr+_e+this.ctx.prevPageLastElemOffset),j.call(this,V,!0),this.path=fr}if(he=JSON.parse(JSON.stringify(me)),this.path=b(he,this.posX+this.margin[3],-gr+_e+this.ctx.prevPageLastElemOffset),$===!1||gt===0){var je=(gt>vt||gt<wt)&&g.call(this);je&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],er,Lt,null).clip().discardPath()),j.call(this,V,$),je&&this.pdf.restoreGraphicsState()}this.lineWidth=ve}else this.lineWidth=ae,j.call(this,V,$),this.lineWidth=ve;this.path=me},j=function(V,$){if((V!=="stroke"||$||!x.call(this))&&(V==="stroke"||$||!m.call(this))){for(var Y,he,J=[],G=this.path,ue=0;ue<G.length;ue++){var ve=G[ue];switch(ve.type){case"begin":J.push({begin:!0});break;case"close":J.push({close:!0});break;case"mt":J.push({start:ve,deltas:[],abs:[]});break;case"lt":var ae=J.length;if(G[ue-1]&&!isNaN(G[ue-1].x)&&(Y=[ve.x-G[ue-1].x,ve.y-G[ue-1].y],ae>0)){for(;ae>=0;ae--)if(J[ae-1].close!==!0&&J[ae-1].begin!==!0){J[ae-1].deltas.push(Y),J[ae-1].abs.push(ve);break}}break;case"bct":Y=[ve.x1-G[ue-1].x,ve.y1-G[ue-1].y,ve.x2-G[ue-1].x,ve.y2-G[ue-1].y,ve.x-G[ue-1].x,ve.y-G[ue-1].y],J[J.length-1].deltas.push(Y);break;case"qct":var oe=G[ue-1].x+2/3*(ve.x1-G[ue-1].x),me=G[ue-1].y+2/3*(ve.y1-G[ue-1].y),De=ve.x+2/3*(ve.x1-ve.x),ne=ve.y+2/3*(ve.y1-ve.y),ie=ve.x,ht=ve.y;Y=[oe-G[ue-1].x,me-G[ue-1].y,De-G[ue-1].x,ne-G[ue-1].y,ie-G[ue-1].x,ht-G[ue-1].y],J[J.length-1].deltas.push(Y);break;case"arc":J.push({deltas:[],abs:[],arc:!0}),Array.isArray(J[J.length-1].abs)&&J[J.length-1].abs.push(ve)}}he=$?null:V==="stroke"?"stroke":"fill";for(var pt=!1,Ze=0;Ze<J.length;Ze++)if(J[Ze].arc)for(var vt=J[Ze].abs,wt=0;wt<vt.length;wt++){var gt=vt[wt];gt.type==="arc"?A.call(this,gt.x,gt.y,gt.radius,gt.startAngle,gt.endAngle,gt.counterclockwise,void 0,$,!pt):T.call(this,gt.x,gt.y),pt=!0}else if(J[Ze].close===!0)this.pdf.internal.out("h"),pt=!1;else if(J[Ze].begin!==!0){var er=J[Ze].start.x,_e=J[Ze].start.y;k.call(this,J[Ze].deltas,er,_e),pt=!0}he&&P.call(this,he),$&&F.call(this)}},S=function(V){var $=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Y=$*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return V-Y;case"top":return V+$-Y;case"hanging":return V+$-2*Y;case"middle":return V+$/2-Y;default:return V}},C=function(V){return V+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};f.prototype.createLinearGradient=function(){var V=function(){};return V.colorStops=[],V.addColorStop=function($,Y){this.colorStops.push([$,Y])},V.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},V.isCanvasGradient=!0,V},f.prototype.createPattern=function(){return this.createLinearGradient()},f.prototype.createRadialGradient=function(){return this.createLinearGradient()};var A=function(V,$,Y,he,J,G,ue,ve,ae){for(var oe=z.call(this,Y,he,J,G),me=0;me<oe.length;me++){var De=oe[me];me===0&&(ae?O.call(this,De.x1+V,De.y1+$):T.call(this,De.x1+V,De.y1+$)),B.call(this,V,$,De.x2,De.y2,De.x3,De.y3,De.x4,De.y4)}ve?F.call(this):P.call(this,ue)},P=function(V){switch(V){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},F=function(){this.pdf.clip(),this.pdf.discardPath()},O=function(V,$){this.pdf.internal.out(r(V)+" "+n($)+" m")},I=function(V){var $;switch(V.align){case"right":case"end":$="right";break;case"center":$="center";break;default:$="left"}var Y=this.pdf.getTextDimensions(V.text),he=S.call(this,V.y),J=C.call(this,he)-Y.h,G=this.ctx.transform.applyToPoint(new i(V.x,he)),ue=this.ctx.transform.decompose(),ve=new c;ve=(ve=(ve=ve.multiply(ue.translate)).multiply(ue.skew)).multiply(ue.scale);for(var ae,oe,me,De=this.ctx.transform.applyToRectangle(new l(V.x,he,Y.w,Y.h)),ne=ve.applyToRectangle(new l(V.x,J,Y.w,Y.h)),ie=y.call(this,ne),ht=[],pt=0;pt<ie.length;pt+=1)ht.indexOf(ie[pt])===-1&&ht.push(ie[pt]);if(w(ht),this.autoPaging)for(var Ze=ht[0],vt=ht[ht.length-1],wt=Ze;wt<vt+1;wt++){this.pdf.setPage(wt);var gt=wt===1?this.posY+this.margin[0]:this.margin[0],er=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],_e=this.pdf.internal.pageSize.height-this.margin[2],Pt=_e-this.margin[0],Lt=this.pdf.internal.pageSize.width-this.margin[1],gr=Lt-this.margin[3],fr=wt===1?0:er+(wt-2)*Pt;if(this.ctx.clip_path.length!==0){var je=this.path;ae=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(ae,this.posX+this.margin[3],-1*fr+gt),j.call(this,"fill",!0),this.path=je}var nt=b([JSON.parse(JSON.stringify(ne))],this.posX+this.margin[3],-fr+gt+this.ctx.prevPageLastElemOffset)[0];V.scale>=.01&&(oe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(oe*V.scale),me=this.lineWidth,this.lineWidth=me*V.scale);var $t=this.autoPaging!=="text";if($t||nt.y+nt.h<=_e){if($t||nt.y>=gt&&nt.x<=Lt){var Ut=$t?V.text:this.pdf.splitTextToSize(V.text,V.maxWidth||Lt-nt.x)[0],Fe=b([JSON.parse(JSON.stringify(De))],this.posX+this.margin[3],-fr+gt+this.ctx.prevPageLastElemOffset)[0],xt=$t&&(wt>Ze||wt<vt)&&g.call(this);xt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],gr,Pt,null).clip().discardPath()),this.pdf.text(Ut,Fe.x,Fe.y,{angle:V.angle,align:$,renderingMode:V.renderingMode}),xt&&this.pdf.restoreGraphicsState()}}else nt.y<_e&&(this.ctx.prevPageLastElemOffset+=_e-nt.y);V.scale>=.01&&(this.pdf.setFontSize(oe),this.lineWidth=me)}else V.scale>=.01&&(oe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(oe*V.scale),me=this.lineWidth,this.lineWidth=me*V.scale),this.pdf.text(V.text,G.x+this.posX,G.y+this.posY,{angle:V.angle,align:$,renderingMode:V.renderingMode,maxWidth:V.maxWidth}),V.scale>=.01&&(this.pdf.setFontSize(oe),this.lineWidth=me)},T=function(V,$,Y,he){Y=Y||0,he=he||0,this.pdf.internal.out(r(V+Y)+" "+n($+he)+" l")},k=function(V,$,Y){return this.pdf.lines(V,$,Y,null,null)},B=function(V,$,Y,he,J,G,ue,ve){this.pdf.internal.out([t(s(Y+V)),t(o(he+$)),t(s(J+V)),t(o(G+$)),t(s(ue+V)),t(o(ve+$)),"c"].join(" "))},z=function(V,$,Y,he){for(var J=2*Math.PI,G=Math.PI/2;$>Y;)$-=J;var ue=Math.abs(Y-$);ue<J&&he&&(ue=J-ue);for(var ve=[],ae=he?-1:1,oe=$;ue>1e-5;){var me=oe+ae*Math.min(ue,G);ve.push(U.call(this,V,oe,me)),ue-=Math.abs(me-oe),oe=me}return ve},U=function(V,$,Y){var he=(Y-$)/2,J=V*Math.cos(he),G=V*Math.sin(he),ue=J,ve=-G,ae=ue*ue+ve*ve,oe=ae+ue*J+ve*G,me=4/3*(Math.sqrt(2*ae*oe)-oe)/(ue*G-ve*J),De=ue-me*ve,ne=ve+me*ue,ie=De,ht=-ne,pt=he+$,Ze=Math.cos(pt),vt=Math.sin(pt);return{x1:V*Math.cos($),y1:V*Math.sin($),x2:De*Ze-ne*vt,y2:De*vt+ne*Ze,x3:ie*Ze-ht*vt,y3:ie*vt+ht*Ze,x4:V*Math.cos(Y),y4:V*Math.sin(Y)}},L=function(V){return 180*V/Math.PI},W=function(V,$,Y,he,J,G){var ue=V+.5*(Y-V),ve=$+.5*(he-$),ae=J+.5*(Y-J),oe=G+.5*(he-G),me=Math.min(V,J,ue,ae),De=Math.max(V,J,ue,ae),ne=Math.min($,G,ve,oe),ie=Math.max($,G,ve,oe);return new l(me,ne,De-me,ie-ne)},ge=function(V,$,Y,he,J,G,ue,ve){var ae,oe,me,De,ne,ie,ht,pt,Ze,vt,wt,gt,er,_e,Pt=Y-V,Lt=he-$,gr=J-Y,fr=G-he,je=ue-J,nt=ve-G;for(oe=0;oe<41;oe++)Ze=(ht=(me=V+(ae=oe/40)*Pt)+ae*((ne=Y+ae*gr)-me))+ae*(ne+ae*(J+ae*je-ne)-ht),vt=(pt=(De=$+ae*Lt)+ae*((ie=he+ae*fr)-De))+ae*(ie+ae*(G+ae*nt-ie)-pt),oe==0?(wt=Ze,gt=vt,er=Ze,_e=vt):(wt=Math.min(wt,Ze),gt=Math.min(gt,vt),er=Math.max(er,Ze),_e=Math.max(_e,vt));return new l(Math.round(wt),Math.round(gt),Math.round(er-wt),Math.round(_e-gt))},Ae=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var V,$,Y=(V=this.ctx.lineDash,$=this.ctx.lineDashOffset,JSON.stringify({lineDash:V,lineDashOffset:$}));this.prevLineDash!==Y&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Y)}}})(da.API),function(e){var t=function(i){var l,c,d,u,f,h,m,x,g,y;for(c=[],d=0,u=(i+=l="\0\0\0\0".slice(i.length%4||4)).length;u>d;d+=4)(f=(i.charCodeAt(d)<<24)+(i.charCodeAt(d+1)<<16)+(i.charCodeAt(d+2)<<8)+i.charCodeAt(d+3))!==0?(h=(f=((f=((f=((f=(f-(y=f%85))/85)-(g=f%85))/85)-(x=f%85))/85)-(m=f%85))/85)%85,c.push(h+33,m+33,x+33,g+33,y+33)):c.push(122);return function(v,b){for(var w=b;w>0;w--)v.pop()}(c,l.length),String.fromCharCode.apply(String,c)+"~>"},r=function(i){var l,c,d,u,f,h=String,m="length",x=255,g="charCodeAt",y="slice",v="replace";for(i[y](-2),i=i[y](0,-2)[v](/\s/g,"")[v]("z","!!!!!"),d=[],u=0,f=(i+=l="uuuuu"[y](i[m]%5||5))[m];f>u;u+=5)c=52200625*(i[g](u)-33)+614125*(i[g](u+1)-33)+7225*(i[g](u+2)-33)+85*(i[g](u+3)-33)+(i[g](u+4)-33),d.push(x&c>>24,x&c>>16,x&c>>8,x&c);return function(b,w){for(var _=w;_>0;_--)b.pop()}(d,l[m]),h.fromCharCode.apply(h,d)},n=function(i){return i.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},s=function(i){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((i=i.replace(/\s/g,"")).indexOf(">")!==-1&&(i=i.substr(0,i.indexOf(">"))),i.length%2&&(i+="0"),l.test(i)===!1)return"";for(var c="",d=0;d<i.length;d+=2)c+=String.fromCharCode("0x"+(i[d]+i[d+1]));return c},o=function(i){for(var l=new Uint8Array(i.length),c=i.length;c--;)l[c]=i.charCodeAt(c);return(l=x3(l)).reduce(function(d,u){return d+String.fromCharCode(u)},"")};e.processDataByFilters=function(i,l){var c=0,d=i||"",u=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":d=r(d),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=t(d),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=s(d),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=n(d),u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=o(d),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:d,reverseChain:u.reverse().join(" ")}}}(da.API),function(e){e.loadFile=function(t,r,n){return function(s,o,i){o=o!==!1,i=typeof i=="function"?i:function(){};var l=void 0;try{l=function(c,d,u){var f=new XMLHttpRequest,h=0,m=function(x){var g=x.length,y=[],v=String.fromCharCode;for(h=0;h<g;h+=1)y.push(v(255&x.charCodeAt(h)));return y.join("")};if(f.open("GET",c,!d),f.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(f.onload=function(){f.status===200?u(m(this.responseText)):u(void 0)}),f.send(null),d&&f.status===200)return m(f.responseText)}(s,o,i)}catch{}return l}(t,r,n)},e.loadImageFile=e.loadFile}(da.API),function(e){function t(){return(Ra.html2canvas?Promise.resolve(Ra.html2canvas):Pf(()=>import("./html2canvas.esm-f16e60ff.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function r(){return(Ra.DOMPurify?Promise.resolve(Ra.DOMPurify):Pf(()=>import("./purify.es-fd086bfc.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var n=function(l){var c=cs(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},s=function(l,c){var d=document.createElement(l);for(var u in c.className&&(d.className=c.className),c.innerHTML&&c.dompurify&&(d.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)d.style[u]=c.style[u];return d},o=function l(c,d){for(var u=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),f=c.firstChild;f;f=f.nextSibling)d!==!0&&f.nodeType===1&&f.nodeName==="SCRIPT"||u.appendChild(l(f,d));return c.nodeType===1&&(c.nodeName==="CANVAS"?(u.width=c.width,u.height=c.height,u.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(u.value=c.value),u.addEventListener("load",function(){u.scrollTop=c.scrollTop,u.scrollLeft=c.scrollLeft},!0)),u},i=function l(c){var d=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),u=l.convert(Promise.resolve(),d);return(u=u.setProgress(1,l,1,[l])).set(c)};(i.prototype=Object.create(Promise.prototype)).constructor=i,i.convert=function(l,c){return l.__proto__=c||i.prototype,l},i.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},i.prototype.from=function(l,c){return this.then(function(){switch(c=c||function(d){switch(n(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(l),c){case"string":return this.then(r).then(function(d){return this.set({src:s("div",{innerHTML:l,dompurify:d})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},i.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},i.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=o(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},i.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,c(this.prop.container,d)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},i.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=this.opt.jsPDF,u=this.opt.fontFaces,f=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,h=Object.assign({async:!0,allowTaint:!0,scale:f,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete h.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=u,u)for(var m=0;m<u.length;++m){var x=u[m],g=x.src.find(function(y){return y.format==="truetype"});g&&d.addFont(g.url,x.ref.name,x.ref.style)}return h.windowHeight=h.windowHeight||0,h.windowHeight=h.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):h.windowHeight,d.context2d.save(!0),c(this.prop.container,h)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},i.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},i.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},i.prototype.output=function(l,c,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},i.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},i.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},i.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},i.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},i.prototype.set=function(l){if(n(l)!=="object")return this;var c=Object.keys(l||{}).map(function(d){if(d in i.template.prop)return function(){this.prop[d]=l[d]};switch(d){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[d]=l[d]}}},this);return this.then(function(){return this.thenList(c)})},i.prototype.get=function(l,c){return this.then(function(){var d=l in i.template.prop?this.prop[l]:this.opt[l];return c?c(d):d})},i.prototype.setMargin=function(l){return this.then(function(){switch(n(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},i.prototype.setPageSize=function(l){function c(d,u){return Math.floor(d*u/72*96)}return this.then(function(){(l=l||da.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},i.prototype.setProgress=function(l,c,d,u){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),d!=null&&(this.progress.n=d),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},i.prototype.updateProgress=function(l,c,d,u){return this.setProgress(l?this.progress.val+l:null,c||null,d?this.progress.n+d:null,u?this.progress.stack.concat(u):null)},i.prototype.then=function(l,c){var d=this;return this.thenCore(l,c,function(u,f){return d.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,function(h){return d.updateProgress(null,u),h}).then(u,f).then(function(h){return d.updateProgress(1),h})})},i.prototype.thenCore=function(l,c,d){d=d||Promise.prototype.then;var u=this;l&&(l=l.bind(u)),c&&(c=c.bind(u));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?u:i.convert(Object.assign({},u),Promise.prototype),h=d.call(f,l,c);return i.convert(h,u.__proto__)},i.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},i.prototype.thenList=function(l){var c=this;return l.forEach(function(d){c=c.thenCore(d)}),c},i.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return i.convert(c,this)},i.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},i.prototype.error=function(l){return this.then(function(){throw new Error(l)})},i.prototype.using=i.prototype.set,i.prototype.saveAs=i.prototype.save,i.prototype.export=i.prototype.output,i.prototype.run=i.prototype.then,da.getPageSize=function(l,c,d){if(cs(l)==="object"){var u=l;l=u.orientation,c=u.unit||c,d=u.format||d}c=c||"mm",d=d||"a4",l=(""+(l||"P")).toLowerCase();var f,h=(""+d).toLowerCase(),m={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":f=1;break;case"mm":f=72/25.4;break;case"cm":f=72/2.54;break;case"in":f=72;break;case"px":f=.75;break;case"pc":case"em":f=12;break;case"ex":f=6;break;default:throw"Invalid unit: "+c}var x,g=0,y=0;if(m.hasOwnProperty(h))g=m[h][1]/f,y=m[h][0]/f;else try{g=d[1],y=d[0]}catch{throw new Error("Invalid format: "+d)}if(l==="p"||l==="portrait")l="p",y>g&&(x=y,y=g,g=x);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",g>y&&(x=y,y=g,g=x)}return{width:y,height:g,unit:c,k:f,orientation:l}},e.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(uk):null;var d=new i(c);return c.worker?d:d.from(l).doCallback()}}(da.API),da.API.addJS=function(e){return iU=e,this.internal.events.subscribe("postPutResources",function(){Y_=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Y_+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),oU=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+iU+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Y_!==void 0&&oU!==void 0&&this.internal.out("/Names <</JavaScript "+Y_+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var s=r.outline.render().split(/\r\n/),o=0;o<s.length;o++){var i=s[o],l=n.exec(i);if(l!=null){var c=l[1];r.internal.newObjectDeferredBegin(c,!1)}r.internal.write(i)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,u=[];for(o=0;o<d;o++){var f=r.internal.newObject();u.push(f);var h=r.internal.getPageInfo(o+1);r.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var m=r.internal.newObject();for(r.internal.write("<< /Names [ "),o=0;o<u.length;o++)r.internal.write("(page_"+(o+1)+")"+u[o]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+m+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var r=this;r.outline.root.children.length>0&&(r.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&r.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,s,o){var i={title:s,options:o,children:[]};return n==null&&(n=this.root),n.children.push(i),i},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var s=0;s<n.children.length;s++)this.genIds_r(n.children[s])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var s=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<n.children.length;o++){var i=n.children[o];this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(n)),o>0&&this.line("/Prev "+this.makeRef(n.children[o-1])),o<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[o+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var l=this.count=this.count_r({count:0},i);if(l>0&&this.line("/Count "+l),i.options&&i.options.pageNumber){var c=r.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+s(0)+" 0]")}this.objEnd()}for(var d=0;d<n.children.length;d++)this.renderItems(n.children[d])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,s){for(var o=0;o<s.children.length;o++)n.count++,this.count_r(n,s.children[o]);return n.count}}])}(da.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,n,s,o,i,l){var c,d=this.decode.DCT_DECODE,u=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=i||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,c=function(f){for(var h,m=256*f.charCodeAt(4)+f.charCodeAt(5),x=f.length,g={width:0,height:0,numcomponents:1},y=4;y<x;y+=2){if(y+=m,t.indexOf(f.charCodeAt(y+1))!==-1){h=256*f.charCodeAt(y+5)+f.charCodeAt(y+6),g={width:256*f.charCodeAt(y+7)+f.charCodeAt(y+8),height:h,numcomponents:f.charCodeAt(y+9)};break}m=256*f.charCodeAt(y+2)+f.charCodeAt(y+3)}return g}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}u={data:r,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:d,index:n,alias:s}}return u}}(da.API),da.API.processPNG=function(e,t,r,n){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var s,o=TQe(e,{checkCrc:!0}),i=o.width,l=o.height,c=o.channels,d=o.palette,u=o.depth;s=d&&c===1?function(A){for(var P=A.width,F=A.height,O=A.data,I=A.palette,T=A.depth,k=!1,B=[],z=[],U=void 0,L=!1,W=0,ge=0;ge<I.length;ge++){var Ae=t9(I[ge],4),V=Ae[0],$=Ae[1],Y=Ae[2],he=Ae[3];B.push(V,$,Y),he!=null&&(he===0?(W++,z.length<1&&z.push(ge)):he<255&&(L=!0))}if(L||W>1){k=!0,z=void 0;var J=P*F;U=new Uint8Array(J);for(var G=new DataView(O.buffer),ue=0;ue<J;ue++){var ve=mk(G,ue,T),ae=t9(I[ve],4)[3];U[ue]=ae}}else W===0&&(z=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:k?8:void 0,colorBytes:O,alphaBytes:U,needSMask:k,palette:B,mask:z}}(o):c===2||c===4?function(A){for(var P=A.data,F=A.width,O=A.height,I=A.channels,T=A.depth,k=I===2?"DeviceGray":"DeviceRGB",B=I-1,z=F*O,U=B,L=z*U,W=1*z,ge=Math.ceil(L*T/8),Ae=Math.ceil(W*T/8),V=new Uint8Array(ge),$=new Uint8Array(Ae),Y=new DataView(P.buffer),he=new DataView(V.buffer),J=new DataView($.buffer),G=!1,ue=0;ue<z;ue++){for(var ve=ue*I,ae=0;ae<U;ae++)gU(he,mk(Y,ve+ae,T),ue*U+ae,T);var oe=mk(Y,ve+U,T);oe<(1<<T)-1&&(G=!0),gU(J,oe,1*ue,T)}return{colorSpace:k,colorsPerPixel:B,sMaskBitsPerComponent:G?T:void 0,colorBytes:V,alphaBytes:$,needSMask:G}}(o):function(A){var P=A.data,F=A.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:F,colorsPerPixel:F==="DeviceGray"?1:3,colorBytes:P instanceof Uint16Array?function(O){for(var I=O.length,T=new Uint8Array(2*I),k=new DataView(T.buffer,T.byteOffset,T.byteLength),B=0;B<I;B++)k.setUint16(2*B,O[B],!1);return T}(P):P,needSMask:!1}}(o);var f,h,m,x=s,g=x.colorSpace,y=x.colorsPerPixel,v=x.sMaskBitsPerComponent,b=x.colorBytes,w=x.alphaBytes,_=x.needSMask,j=x.palette,S=x.mask,C=null;return n!==da.API.image_compression.NONE&&typeof x3=="function"?(C=function(A){var P;switch(A){case da.API.image_compression.FAST:P=11;break;case da.API.image_compression.MEDIUM:P=13;break;case da.API.image_compression.SLOW:P=14;break;default:P=12}return P}(n),f=this.decode.FLATE_DECODE,h="/Predictor ".concat(C," /Colors ").concat(y," /BitsPerComponent ").concat(u," /Columns ").concat(i),e=uU(b,Math.ceil(i*y*u/8),y,u,n),_&&(m=uU(w,Math.ceil(i*v/8),1,v,n))):(f=void 0,h=void 0,e=b,_&&(m=w)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(m&&this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),{alias:r,data:e,index:t,filter:f,decodeParameters:h,transparency:S,palette:j,sMask:m,predictor:C,width:i,height:l,bitsPerComponent:u,sMaskBitsPerComponent:v,colorSpace:g}}},function(e){e.processGIF89A=function(t,r,n,s){var o=new tZe(t),i=o.width,l=o.height,c=[];o.decodeAndBlitFrameRGBA(0,c);var d={data:c,width:i,height:l},u=new hk(100).encode(d,100);return e.processJPEG.call(this,u,r,n,s)},e.processGIF87A=e.processGIF89A}(da.API),bu.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:s,green:n,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},bu.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){Qs.log("bit decode error:"+r)}},bu.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,s=0;s<t;s++)for(var o=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+8*s*4,l=0;l<8&&8*s+l<this.width;l++){var c=this.palette[o>>7-l&1];this.data[i+4*l]=c.blue,this.data[i+4*l+1]=c.green,this.data[i+4*l+2]=c.red,this.data[i+4*l+3]=255}r!==0&&(this.pos+=4-r)}},bu.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<e;s++){var o=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+2*s*4,l=o>>4,c=15&o,d=this.palette[l];if(this.data[i]=d.blue,this.data[i+1]=d.green,this.data[i+2]=d.red,this.data[i+3]=255,2*s+1>=this.width)break;d=this.palette[c],this.data[i+4]=d.blue,this.data[i+4+1]=d.green,this.data[i+4+2]=d.red,this.data[i+4+3]=255}t!==0&&(this.pos+=4-t)}},bu.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var s=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+4*n;if(s<this.palette.length){var i=this.palette[s];this.data[o]=i.red,this.data[o+1]=i.green,this.data[o+2]=i.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}e!==0&&(this.pos+=4-e)}},bu.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<this.width;s++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(o&t)/t*255|0,l=(o>>5&t)/t*255|0,c=(o>>10&t)/t*255|0,d=o>>15?255:0,u=n*this.width*4+4*s;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=i,this.data[u+3]=d}this.pos+=e}},bu.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var s=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(i&t)/t*255|0,c=(i>>5&r)/r*255|0,d=(i>>11)/t*255|0,u=s*this.width*4+4*o;this.data[u]=d,this.data[u+1]=c,this.data[u+2]=l,this.data[u+3]=255}this.pos+=e}},bu.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),i=t*this.width*4+4*r;this.data[i]=o,this.data[i+1]=s,this.data[i+2]=n,this.data[i+3]=255}this.pos+=this.width%4}},bu.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*r;this.data[l]=o,this.data[l+1]=s,this.data[l+2]=n,this.data[l+3]=i}},bu.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,s){var o=new bu(t,!1),i=o.width,l=o.height,c={data:o.getData(),width:i,height:l},d=new hk(100).encode(c,100);return e.processJPEG.call(this,d,r,n,s)}}(da.API),vU.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,s){var o=new vU(t),i=o.width,l=o.height,c={data:o.getData(),width:i,height:l},d=new hk(100).encode(c,100);return e.processJPEG.call(this,d,r,n,s)}}(da.API),da.API.processRGBA=function(e,t,r){for(var n=e.data,s=n.length,o=new Uint8Array(s/4*3),i=new Uint8Array(s/4),l=0,c=0,d=0;d<s;d+=4){var u=n[d],f=n[d+1],h=n[d+2],m=n[d+3];o[l++]=u,o[l++]=f,o[l++]=h,i[c++]=m}var x=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(i),data:x,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},da.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Wx=da.API,J_=Wx.getCharWidthsArray=function(e,t){var r,n,s=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),i=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:s.metadata.Unicode.widths,c=l.fof?l.fof:1,d=t.kerning?t.kerning:s.metadata.Unicode.kerning,u=d.fof?d.fof:1,f=t.doKerning!==!1,h=0,m=e.length,x=0,g=l[0]||c,y=[];for(r=0;r<m;r++)n=e.charCodeAt(r),typeof s.metadata.widthOfString=="function"?y.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(n))+i*(1e3/o)||0)/1e3):(h=f&&cs(d[n])==="object"&&!isNaN(parseInt(d[n][x],10))?d[n][x]/u:0,y.push((l[n]||g)/c+h)),x=n;return y},lU=Wx.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),s=t.charSpace||this.internal.getCharSpace();return Wx.processArabic&&(e=Wx.processArabic(e)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(e,r,s)/r:J_.apply(this,arguments).reduce(function(o,i){return o+i},0)},cU=function(e,t,r,n){for(var s=[],o=0,i=e.length,l=0;o!==i&&l+t[o]<r;)l+=t[o],o++;s.push(e.slice(0,o));var c=o;for(l=0;o!==i;)l+t[o]>n&&(s.push(e.slice(c,o)),l=0,c=o),l+=t[o],o++;return c!==o&&s.push(e.slice(c,o)),s},dU=function(e,t,r){r||(r={});var n,s,o,i,l,c,d,u=[],f=[u],h=r.textIndent||0,m=0,x=0,g=e.split(" "),y=J_.apply(this,[" ",r])[0];if(c=r.lineIndent===-1?g[0].length+2:r.lineIndent||0){var v=Array(c).join(" "),b=[];g.map(function(_){(_=_.split(/\s*\n/)).length>1?b=b.concat(_.map(function(j,S){return(S&&j.length?`
`:"")+j})):b.push(_[0])}),g=b,c=lU.apply(this,[v,r])}for(o=0,i=g.length;o<i;o++){var w=0;if(n=g[o],c&&n[0]==`
`&&(n=n.substr(1),w=1),h+m+(x=(s=J_.apply(this,[n,r])).reduce(function(_,j){return _+j},0))>t||w){if(x>t){for(l=cU.apply(this,[n,s,t-(h+m),t]),u.push(l.shift()),u=[l.pop()];l.length;)f.push([l.shift()]);x=s.slice(n.length-(u[0]?u[0].length:0)).reduce(function(_,j){return _+j},0)}else u=[n];f.push(u),h=x+c,m=y}else u.push(n),h+=m+x,m=y}return d=c?function(_,j){return(j?v:"")+_.join(" ")}:function(_){return _.join(" ")},f.map(d)},Wx.splitTextToSize=function(e,t,r){var n,s=(r=r||{}).fontSize||this.internal.getFontSize(),o=function(u){if(u.widths&&u.kerning)return{widths:u.widths,kerning:u.kerning};var f=this.internal.getFont(u.fontName,u.fontStyle),h="Unicode";return f.metadata[h]?{widths:f.metadata[h].widths||{0:1},kerning:f.metadata[h].kerning||{}}:{font:f.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var i=1*this.internal.scaleFactor*t/s;o.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/s:0,o.lineIndent=r.lineIndent;var l,c,d=[];for(l=0,c=n.length;l<c;l++)d=d.concat(dU.apply(this,[n[l],i,o]));return d},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",r="klmnopqrstuvwxyz",n={},s={},o=0;o<16;o++)n[r[o]]=t[o],s[t[o]]=r[o];var i=function(h){return"0x"+parseInt(h,10).toString(16)},l=e.__fontmetrics__.compress=function(h){var m,x,g,y,v=["{"];for(var b in h){if(m=h[b],isNaN(parseInt(b,10))?x="'"+b+"'":(b=parseInt(b,10),x=(x=i(b).slice(2)).slice(0,-1)+s[x.slice(-1)]),typeof m=="number")m<0?(g=i(m).slice(3),y="-"):(g=i(m).slice(2),y=""),g=y+g.slice(0,-1)+s[g.slice(-1)];else{if(cs(m)!=="object")throw new Error("Don't know what to do with value type "+cs(m)+".");g=l(m)}v.push(x+g)}return v.push("}"),v.join("")},c=e.__fontmetrics__.uncompress=function(h){if(typeof h!="string")throw new Error("Invalid argument passed to uncompress.");for(var m,x,g,y,v={},b=1,w=v,_=[],j="",S="",C=h.length-1,A=1;A<C;A+=1)(y=h[A])=="'"?m?(g=m.join(""),m=void 0):m=[]:m?m.push(y):y=="{"?(_.push([w,g]),w={},g=void 0):y=="}"?((x=_.pop())[0][x[1]]=w,g=void 0,w=x[0]):y=="-"?b=-1:g===void 0?n.hasOwnProperty(y)?(j+=n[y],g=parseInt(j,16)*b,b=1,j=""):j+=y:n.hasOwnProperty(y)?(S+=n[y],w[g]=parseInt(S,16)*b,b=1,g=void 0,S=""):S+=y;return v},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},f={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(h){var m=h.font,x=f.Unicode[m.postScriptName];x&&(m.metadata.Unicode={},m.metadata.Unicode.widths=x.widths,m.metadata.Unicode.kerning=x.kerning);var g=u.Unicode[m.postScriptName];g&&(m.metadata.Unicode.encoding=g,m.encoding=g.codePages[0])}])}(da.API),function(e){var t=function(r){for(var n=r.length,s=new Uint8Array(n),o=0;o<n;o++)s[o]=r.charCodeAt(o);return s};e.API.events.push(["addFont",function(r){var n=void 0,s=r.font,o=r.instance;if(!s.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if(typeof(n=o.existsFileInVFS(s.postScriptName)===!1?o.loadFile(s.postScriptName):o.getFileFromVFS(s.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");(function(i,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(Rj(l)),i.metadata=e.API.TTFFont.open(l),i.metadata.Unicode=i.metadata.Unicode||{encoding:{},kerning:{},widths:[]},i.metadata.glyIdsUsed=[0]})(s,n)}}])}(da),da.API.addSvgAsImage=function(e,t,r,n,s,o,i,l){if(isNaN(t)||isNaN(r))throw Qs.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(s))throw Qs.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=n,c.height=s;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},f=this;return(Ra.canvg?Promise.resolve(Ra.canvg):Pf(()=>import("./index.es-c6726791.js"),[])).catch(function(h){return Promise.reject(new Error("Could not load canvg: "+h))}).then(function(h){return h.default?h.default:h}).then(function(h){return h.fromString(d,e,u)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(h){return h.render(u)}).then(function(){f.addImage(c.toDataURL("image/jpeg",1),t,r,n,s,i,l)})},da.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var s=0;s<this.internal.pages[n].length;s++)this.internal.pages[n][s]=this.internal.pages[n][s].replace(t,r);return this},da.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,s,o,i={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(i),c=[],d=0,u=0,f=0;function h(x,g){var y,v=!1;for(y=0;y<x.length;y+=1)x[y]===g&&(v=!0);return v}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(i)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var m=l.length;for(f=0;f<m;f+=1)r[l[f]].value=r[l[f]].defaultValue,r[l[f]].explicitSet=!1}if(cs(e)==="object"){for(s in e)if(o=e[s],h(l,s)&&o!==void 0){if(r[s].type==="boolean"&&typeof o=="boolean")r[s].value=o;else if(r[s].type==="name"&&h(r[s].valueSet,o))r[s].value=o;else if(r[s].type==="integer"&&Number.isInteger(o))r[s].value=o;else if(r[s].type==="array"){for(d=0;d<o.length;d+=1)if(n=!0,o[d].length===1&&typeof o[d][0]=="number")c.push(String(o[d]-1));else if(o[d].length>1){for(u=0;u<o[d].length;u+=1)typeof o[d][u]!="number"&&(n=!1);n===!0&&c.push([o[d][0]-1,o[d][1]-1].join(" "))}r[s].value="["+c.join(" ")+"]"}else r[s].value=r[s].defaultValue;r[s].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var x,g=[];for(x in r)r[x].explicitSet===!0&&(r[x].type==="name"?g.push("/"+x+" /"+r[x].value):g.push("/"+x+" "+r[x].value));g.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+g.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',s=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(n)),i=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),d=o.length+i.length+l.length+s.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+d+" >>"),this.internal.write("stream"),this.internal.write(s+o+i+l+c),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(n,s){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:s||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(da.API),function(e){var t=e.API,r=t.pdfEscape16=function(o,i){for(var l,c=i.metadata.Unicode.widths,d=["","0","00","000","0000"],u=[""],f=0,h=o.length;f<h;++f){if(l=i.metadata.characterToGlyph(o.charCodeAt(f)),i.metadata.glyIdsUsed.push(l),i.metadata.toUnicode[l]=o.charCodeAt(f),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(i.metadata.widthOfGlyph(l),10)])),l=="0")return u.join("");l=l.toString(16),u.push(d[4-l.length],l)}return u.join("")},n=function(o){var i,l,c,d,u,f,h;for(u=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],f=0,h=(l=Object.keys(o).sort(function(m,x){return m-x})).length;f<h;f++)i=l[f],c.length>=100&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),o[i]!==void 0&&o[i]!==null&&typeof o[i].toString=="function"&&(d=("0000"+o[i].toString(16)).slice(-4),i=("0000"+(+i).toString(16)).slice(-4),c.push("<"+i+"><"+d+">"));return c.length&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),u+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(o){(function(i){var l=i.font,c=i.out,d=i.newObject,u=i.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="Identity-H"){for(var f=l.metadata.Unicode.widths,h=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),m="",x=0;x<h.length;x++)m+=String.fromCharCode(h[x]);var g=d();u({data:m,addLength1:!0,objectId:g}),c("endobj");var y=d();u({data:n(l.metadata.toUnicode),addLength1:!0,objectId:y}),c("endobj");var v=d();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+ev(l.fontName)),c("/FontFile2 "+g+" 0 R"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var b=d();c("<<"),c("/Type /Font"),c("/BaseFont /"+ev(l.fontName)),c("/FontDescriptor "+v+" 0 R"),c("/W "+e.API.PDFObject.convert(f)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=d(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+y+" 0 R"),c("/BaseFont /"+ev(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+b+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]),t.events.push(["putFont",function(o){(function(i){var l=i.font,c=i.out,d=i.newObject,u=i.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var f=l.metadata.rawData,h="",m=0;m<f.length;m++)h+=String.fromCharCode(f[m]);var x=d();u({data:h,addLength1:!0,objectId:x}),c("endobj");var g=d();u({data:n(l.metadata.toUnicode),addLength1:!0,objectId:g}),c("endobj");var y=d();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+x+" 0 R"),c("/Flags 96"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+ev(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=d();for(var v=0;v<l.metadata.hmtx.widths.length;v++)l.metadata.hmtx.widths[v]=parseInt(l.metadata.hmtx.widths[v]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+g+" 0 R/BaseFont/"+ev(l.fontName)+"/FontDescriptor "+y+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]);var s=function(o){var i,l=o.text||"",c=o.x,d=o.y,u=o.options||{},f=o.mutex||{},h=f.pdfEscape,m=f.activeFontKey,x=f.fonts,g=m,y="",v=0,b="",w=x[g].encoding;if(x[g].encoding!=="Identity-H")return{text:l,x:c,y:d,options:u,mutex:f};for(b=l,g=m,Array.isArray(l)&&(b=l[0]),v=0;v<b.length;v+=1)x[g].metadata.hasOwnProperty("cmap")&&(i=x[g].metadata.cmap.unicode.codeMap[b[v].charCodeAt(0)]),i||b[v].charCodeAt(0)<256&&x[g].metadata.hasOwnProperty("Unicode")?y+=b[v]:y+="";var _="";return parseInt(g.slice(1))<14||w==="WinAnsiEncoding"?_=h(y,g).split("").map(function(j){return j.charCodeAt(0).toString(16)}).join(""):w==="Identity-H"&&(_=r(y,x[g])),f.isHex=!0,{text:_,x:c,y:d,options:u,mutex:f}};t.events.push(["postProcessText",function(o){var i=o.text||"",l=[],c={text:i,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(i)){var d=0;for(d=0;d<i.length;d+=1)Array.isArray(i[d])&&i[d].length===3?l.push([s(Object.assign({},c,{text:i[d][0]})).text,i[d][1],i[d][2]]):l.push(s(Object.assign({},c,{text:i[d]})).text);o.text=l}else o.text=s(Object.assign({},c,{text:i})).text}])}(da),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,n){return t.call(this),this.internal.vFS[r]=n,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(da.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(n){var s,o,i,l,c,d,u,f=t,h=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],m=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],x={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},g={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},y=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],v=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),b=!1,w=0;this.__bidiEngine__={};var _=function(O){var I=O.charCodeAt(),T=I>>8,k=g[T];return k!==void 0?f[256*k+(255&I)]:T===252||T===253?"AL":v.test(T)?"L":T===8?"R":"N"},j=function(O){for(var I,T=0;T<O.length;T++){if((I=_(O.charAt(T)))==="L")return!1;if(I==="R")return!0}return!1},S=function(O,I,T,k){var B,z,U,L,W=I[k];switch(W){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":b=!1;break;case"N":case"AN":break;case"EN":b&&(W="AN");break;case"AL":b=!0,W="R";break;case"WS":case"BN":W="N";break;case"CS":k<1||k+1>=I.length||(B=T[k-1])!=="EN"&&B!=="AN"||(z=I[k+1])!=="EN"&&z!=="AN"?W="N":b&&(z="AN"),W=z===B?z:"N";break;case"ES":W=(B=k>0?T[k-1]:"B")==="EN"&&k+1<I.length&&I[k+1]==="EN"?"EN":"N";break;case"ET":if(k>0&&T[k-1]==="EN"){W="EN";break}if(b){W="N";break}for(U=k+1,L=I.length;U<L&&I[U]==="ET";)U++;W=U<L&&I[U]==="EN"?"EN":"N";break;case"NSM":if(i&&!l){for(L=I.length,U=k+1;U<L&&I[U]==="NSM";)U++;if(U<L){var ge=O[k],Ae=ge>=1425&&ge<=2303||ge===64286;if(B=I[U],Ae&&(B==="R"||B==="AL")){W="R";break}}}W=k<1||(B=I[k-1])==="B"?"N":T[k-1];break;case"B":b=!1,s=!0,W=w;break;case"S":o=!0,W="N"}return W},C=function(O,I,T){var k=O.split("");return T&&A(k,T,{hiLevel:w}),k.reverse(),I&&I.reverse(),k.join("")},A=function(O,I,T){var k,B,z,U,L,W=-1,ge=O.length,Ae=0,V=[],$=w?m:h,Y=[];for(b=!1,s=!1,o=!1,B=0;B<ge;B++)Y[B]=_(O[B]);for(z=0;z<ge;z++){if(L=Ae,V[z]=S(O,Y,V,z),k=240&(Ae=$[L][x[V[z]]]),Ae&=15,I[z]=U=$[Ae][5],k>0)if(k===16){for(B=W;B<z;B++)I[B]=1;W=-1}else W=-1;if($[Ae][6])W===-1&&(W=z);else if(W>-1){for(B=W;B<z;B++)I[B]=U;W=-1}Y[z]==="B"&&(I[z]=0),T.hiLevel|=U}o&&function(he,J,G){for(var ue=0;ue<G;ue++)if(he[ue]==="S"){J[ue]=w;for(var ve=ue-1;ve>=0&&he[ve]==="WS";ve--)J[ve]=w}}(Y,I,ge)},P=function(O,I,T,k,B){if(!(B.hiLevel<O)){if(O===1&&w===1&&!s)return I.reverse(),void(T&&T.reverse());for(var z,U,L,W,ge=I.length,Ae=0;Ae<ge;){if(k[Ae]>=O){for(L=Ae+1;L<ge&&k[L]>=O;)L++;for(W=Ae,U=L-1;W<U;W++,U--)z=I[W],I[W]=I[U],I[U]=z,T&&(z=T[W],T[W]=T[U],T[U]=z);Ae=L}Ae++}}},F=function(O,I,T){var k=O.split(""),B={hiLevel:w};return T||(T=[]),A(k,T,B),function(z,U,L){if(L.hiLevel!==0&&u)for(var W,ge=0;ge<z.length;ge++)U[ge]===1&&(W=y.indexOf(z[ge]))>=0&&(z[ge]=y[W+1])}(k,T,B),P(2,k,I,T,B),P(1,k,I,T,B),k.join("")};return this.__bidiEngine__.doBidiReorder=function(O,I,T){if(function(B,z){if(z)for(var U=0;U<B.length;U++)z[U]=U;l===void 0&&(l=j(B)),d===void 0&&(d=j(B))}(O,I),i||!c||d)if(i&&c&&l^d)w=l?1:0,O=C(O,I,T);else if(!i&&c&&d)w=l?1:0,O=F(O,I,T),O=C(O,I);else if(!i||l||c||d){if(i&&!c&&l^d)O=C(O,I),l?(w=0,O=F(O,I,T)):(w=1,O=F(O,I,T),O=C(O,I));else if(i&&l&&!c&&d)w=1,O=F(O,I,T),O=C(O,I);else if(!i&&!c&&l^d){var k=u;l?(w=1,O=F(O,I,T),w=0,u=!1,O=F(O,I,T),u=k):(w=0,O=F(O,I,T),O=C(O,I),w=1,u=!1,O=F(O,I,T),u=k,O=C(O,I))}}else w=0,O=F(O,I,T);else w=l?1:0,O=F(O,I,T);return O},this.__bidiEngine__.setOptions=function(O){O&&(i=O.isInputVisual,c=O.isOutputVisual,l=O.isInputRtl,d=O.isOutputRtl,u=O.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(n){var s=n.text;n.x,n.y;var o=n.options||{};n.mutex,o.lang;var i=[];if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,r.setOptions(o),Object.prototype.toString.call(s)==="[object Array]"){var l=0;for(i=[],l=0;l<s.length;l+=1)Object.prototype.toString.call(s[l])==="[object Array]"?i.push([r.doBidiReorder(s[l][0]),s[l][1],s[l][2]]):i.push([r.doBidiReorder(s[l])]);n.text=i}else n.text=r.doBidiReorder(s);r.setOptions({isInputVisual:!0})}])}(da),da.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new hp(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new gZe(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new rZe(this.contents),this.head=new aZe(this),this.name=new cZe(this),this.cmap=new Bae(this),this.toUnicode={},this.hhea=new sZe(this),this.maxp=new dZe(this),this.hmtx=new uZe(this),this.post=new iZe(this),this.os2=new oZe(this),this.loca=new pZe(this),this.glyf=new fZe(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,n,s,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var i,l,c,d;for(d=[],i=0,l=(c=this.bbox).length;i<l;i++)t=c[i],d.push(Math.round(t*this.scaleFactor));return d}.call(this),this.stemV=0,this.post.exists?(n=255&(s=this.post.italic_angle),32768&(r=s>>16)&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,n){var s,o,i,l;for(i=0,o=0,l=(t=""+t).length;0<=l?o<l:o>l;o=0<=l?++o:--o)s=t.charCodeAt(o),i+=this.widthOfGlyph(this.characterToGlyph(s))+n*(1e3/r)||0;return i*(r/1e3)},e.prototype.lineHeight=function(t,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},e}();var Yu,hp=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,n;for(n=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(t){var r,n,s;for(s=[],r=0,n=t.length;0<=n?r<n:r>n;r=0<=n?++r:--r)s.push(this.writeByte(t.charCodeAt(r)));return s},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,n,s,o,i,l,c;return t=this.readByte(),r=this.readByte(),n=this.readByte(),s=this.readByte(),o=this.readByte(),i=this.readByte(),l=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^s)+16777216*(255^o)+65536*(255^i)+256*(255^l)+(255^c)+1):72057594037927940*t+281474976710656*r+1099511627776*n+4294967296*s+16777216*o+65536*i+256*l+c},e.prototype.writeLongLong=function(t){var r,n;return r=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,n;for(r=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)r.push(this.readByte());return r},e.prototype.write=function(t){var r,n,s,o;for(o=[],n=0,s=t.length;n<s;n++)r=t[n],o.push(this.writeByte(r));return o},e}(),rZe=function(){var e;function t(r){var n,s,o;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},s=0,o=this.tableCount;0<=o?s<o:s>o;s=0<=o?++s:--s)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(r){var n,s,o,i,l,c,d,u,f,h,m,x,g;for(g in m=Object.keys(r).length,c=Math.log(2),f=16*Math.floor(Math.log(m)/c),i=Math.floor(f/c),u=16*m-f,(s=new hp).writeInt(this.scalarType),s.writeShort(m),s.writeShort(f),s.writeShort(i),s.writeShort(u),o=16*m,d=s.pos+o,l=null,x=[],r)for(h=r[g],s.writeString(g),s.writeInt(e(h)),s.writeInt(d),s.writeInt(h.length),x=x.concat(h),g==="head"&&(l=d),d+=h.length;d%4;)x.push(0),d++;return s.write(x),n=2981146554-e(s.data),s.pos=l+8,s.writeUInt32(n),s.data},e=function(r){var n,s,o,i;for(r=qae.call(r);r.length%4;)r.push(0);for(o=new hp(r),s=0,n=0,i=r.length;n<i;n=n+=4)s+=o.readUInt32();return 4294967295&s},t}(),nZe={}.hasOwnProperty,qf=function(e,t){for(var r in t)nZe.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Yu=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var aZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new hp).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),yU=function(){function e(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,y,v,b,w;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),f=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(m=t.readUInt16(),h=m/2,t.pos+=6,o=function(){var _,j;for(j=[],c=_=0;0<=h?_<h:_>h;c=0<=h?++_:--_)j.push(t.readUInt16());return j}(),t.pos+=2,g=function(){var _,j;for(j=[],c=_=0;0<=h?_<h:_>h;c=0<=h?++_:--_)j.push(t.readUInt16());return j}(),d=function(){var _,j;for(j=[],c=_=0;0<=h?_<h:_>h;c=0<=h?++_:--_)j.push(t.readUInt16());return j}(),u=function(){var _,j;for(j=[],c=_=0;0<=h?_<h:_>h;c=0<=h?++_:--_)j.push(t.readUInt16());return j}(),s=(this.length-t.pos+this.offset)/2,l=function(){var _,j;for(j=[],c=_=0;0<=s?_<s:_>s;c=0<=s?++_:--_)j.push(t.readUInt16());return j}(),c=v=0,w=o.length;v<w;c=++v)for(y=o[c],n=b=x=g[c];x<=y?b<=y:b>=y;n=x<=y?++b:--b)u[c]===0?i=n+d[c]:(i=l[u[c]/2+(n-x)-(h-c)]||0)!==0&&(i+=d[c]),this.codeMap[n]=65535&i}t.pos=f}return e.encode=function(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,y,v,b,w,_,j,S,C,A,P,F,O,I,T,k,B,z,U,L,W,ge,Ae,V,$,Y,he,J,G,ue,ve,ae,oe,me;switch(k=new hp,i=Object.keys(t).sort(function(De,ne){return De-ne}),r){case"macroman":for(g=0,y=function(){var De=[];for(x=0;x<256;++x)De.push(0);return De}(),b={0:0},o={},B=0,W=i.length;B<W;B++)b[ve=t[s=i[B]]]==null&&(b[ve]=++g),o[s]={old:t[s],new:b[t[s]]},y[s]=b[t[s]];return k.writeUInt16(1),k.writeUInt16(0),k.writeUInt32(12),k.writeUInt16(0),k.writeUInt16(262),k.writeUInt16(0),k.write(y),{charMap:o,subtable:k.data,maxGlyphID:g+1};case"unicode":for(I=[],f=[],w=0,b={},n={},v=d=null,z=0,ge=i.length;z<ge;z++)b[j=t[s=i[z]]]==null&&(b[j]=++w),n[s]={old:j,new:b[j]},l=b[j]-s,v!=null&&l===d||(v&&f.push(v),I.push(s),d=l),v=s;for(v&&f.push(v),f.push(65535),I.push(65535),F=2*(P=I.length),A=2*Math.pow(Math.log(P)/Math.LN2,2),h=Math.log(A/2)/Math.LN2,C=2*P-A,c=[],S=[],m=[],x=U=0,Ae=I.length;U<Ae;x=++U){if(O=I[x],u=f[x],O===65535){c.push(0),S.push(0);break}if(O-(T=n[O].new)>=32768)for(c.push(0),S.push(2*(m.length+P-x)),s=L=O;O<=u?L<=u:L>=u;s=O<=u?++L:--L)m.push(n[s].new);else c.push(T-O),S.push(0)}for(k.writeUInt16(3),k.writeUInt16(1),k.writeUInt32(12),k.writeUInt16(4),k.writeUInt16(16+8*P+2*m.length),k.writeUInt16(0),k.writeUInt16(F),k.writeUInt16(A),k.writeUInt16(h),k.writeUInt16(C),G=0,V=f.length;G<V;G++)s=f[G],k.writeUInt16(s);for(k.writeUInt16(0),ue=0,$=I.length;ue<$;ue++)s=I[ue],k.writeUInt16(s);for(ae=0,Y=c.length;ae<Y;ae++)l=c[ae],k.writeUInt16(l);for(oe=0,he=S.length;oe<he;oe++)_=S[oe],k.writeUInt16(_);for(me=0,J=m.length;me<J;me++)g=m[me],k.writeUInt16(g);return{charMap:n,subtable:k.data,maxGlyphID:w+1}}},e}(),Bae=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,n,s;for(t.pos=this.offset,this.version=t.readUInt16(),s=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=s?n<s:n>s;n=0<=s?++n:--n)r=new yU(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var n,s;return r==null&&(r="macroman"),n=yU.encode(t,r),(s=new hp).writeUInt16(0),s.writeUInt16(1),n.table=s.data.concat(n.subtable),n},e}(),sZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),oZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(t.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),iZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="post",e.prototype.parse=function(t){var r,n,s;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var o;for(n=t.readUInt16(),this.glyphNameIndex=[],o=0;0<=n?o<n:o>n;o=0<=n?++o:--o)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],s=[];t.pos<this.offset+this.length;)r=t.readByte(),s.push(this.names.push(t.readString(r)));return s;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 262144:return this.map=function(){var i,l,c;for(c=[],o=i=0,l=this.file.maxp.numGlyphs;0<=l?i<l:i>l;o=0<=l?++i:--i)c.push(t.readUInt32());return c}.call(this)}},e}(),lZe=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},cZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="name",e.prototype.parse=function(t){var r,n,s,o,i,l,c,d,u,f,h;for(t.pos=this.offset,t.readShort(),r=t.readShort(),l=t.readShort(),n=[],o=0;0<=r?o<r:o>r;o=0<=r?++o:--o)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+l+t.readShort()});for(c={},o=u=0,f=n.length;u<f;o=++u)s=n[o],t.pos=s.offset,d=t.readString(s.length),i=new lZe(d,s),c[h=s.nameID]==null&&(c[h]=[]),c[s.nameID].push(i);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},e}(),dZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),uZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,n,s,o,i,l,c;for(t.pos=this.offset,this.metrics=[],r=0,l=this.file.hhea.numberOfMetrics;0<=l?r<l:r>l;r=0<=l?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,u;for(u=[],r=d=0;0<=s?d<s:d>s;r=0<=s?++d:--d)u.push(t.readInt16());return u}(),this.widths=function(){var d,u,f,h;for(h=[],d=0,u=(f=this.metrics).length;d<u;d++)o=f[d],h.push(o.advance);return h}.call(this),n=this.widths[this.widths.length-1],c=[],r=i=0;0<=s?i<s:i>s;r=0<=s?++i:--i)c.push(this.widths.push(n));return c},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),qae=[].slice,fZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,n,s,o,i,l,c,d,u,f;return t in this.cache?this.cache[t]:(o=this.file.loca,r=this.file.contents,n=o.indexOf(t),(s=o.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+n,i=(l=new hp(r.read(s))).readShort(),d=l.readShort(),f=l.readShort(),c=l.readShort(),u=l.readShort(),this.cache[t]=i===-1?new hZe(l,d,f,c,u):new mZe(l,i,d,f,c,u),this.cache[t]))},e.prototype.encode=function(t,r,n){var s,o,i,l,c;for(i=[],o=[],l=0,c=r.length;l<c;l++)s=t[r[l]],o.push(i.length),s&&(i=i.concat(s.encode(n)));return o.push(i.length),{table:i,offsets:o}},e}(),mZe=function(){function e(t,r,n,s,o,i){this.raw=t,this.numberOfContours=r,this.xMin=n,this.yMin=s,this.xMax=o,this.yMax=i,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),hZe=function(){function e(t,r,n,s,o){var i,l;for(this.raw=t,this.xMin=r,this.yMin=n,this.xMax=s,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],i=this.raw;l=i.readShort(),this.glyphOffsets.push(i.pos),this.glyphIDs.push(i.readUInt16()),32&l;)i.pos+=1&l?4:2,128&l?i.pos+=8:64&l?i.pos+=4:8&l&&(i.pos+=2)}return e.prototype.encode=function(){var t,r,n;for(r=new hp(qae.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),pZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return qf(e,Yu),e.prototype.tag="loca",e.prototype.parse=function(t){var r,n;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?function(){var s,o;for(o=[],n=0,s=this.length;n<s;n+=2)o.push(2*t.readUInt16());return o}.call(this):function(){var s,o;for(o=[],n=0,s=this.length;n<s;n+=4)o.push(t.readUInt32());return o}.call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var n=new Uint32Array(this.offsets.length),s=0,o=0,i=0;i<n.length;++i)if(n[i]=s,o<r.length&&r[o]==i){++o,n[i]=s;var l=this.offsets[i],c=this.offsets[i+1]-l;c>0&&(s+=c)}for(var d=new Array(4*n.length),u=0;u<n.length;++u)d[4*u+3]=255&n[u],d[4*u+2]=(65280&n[u])>>8,d[4*u+1]=(16711680&n[u])>>16,d[4*u]=(4278190080&n[u])>>24;return d},e}(),gZe=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,n,s,o;for(r in s=this.font.cmap.tables[0].codeMap,t={},o=this.subset)n=o[r],t[r]=s[n];return t},e.prototype.glyphsFor=function(t){var r,n,s,o,i,l,c;for(s={},i=0,l=t.length;i<l;i++)s[o=t[i]]=this.font.glyf.glyphFor(o);for(o in r=[],s)(n=s[o])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(o in c=this.glyphsFor(r))n=c[o],s[o]=n;return s},e.prototype.encode=function(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,y,v;for(s in n=Bae.encode(this.generateCmap(),"unicode"),i=this.glyphsFor(t),m={0:0},v=n.charMap)m[(c=v[s]).old]=c.new;for(x in h=n.maxGlyphID,i)x in m||(m[x]=h++);return u=function(b){var w,_;for(w in _={},b)_[b[w]]=w;return _}(m),f=Object.keys(u).sort(function(b,w){return b-w}),g=function(){var b,w,_;for(_=[],b=0,w=f.length;b<w;b++)l=f[b],_.push(u[l]);return _}(),o=this.font.glyf.encode(i,g,m),d=this.font.loca.encode(o.offsets,g),y={cmap:this.font.cmap.raw(),glyf:o.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(y["OS/2"]=this.font.os2.raw()),this.font.directory.encode(y)},e}();da.API.PDFObject=function(){var e;function t(){}return e=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},t.convert=function(r){var n,s,o,i;if(Array.isArray(r))return"["+function(){var l,c,d;for(d=[],l=0,c=r.length;l<c;l++)n=r[l],d.push(t.convert(n));return d}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r?.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(s in o=["<<"],r)i=r[s],o.push("/"+s+" "+t.convert(i));return o.push(">>"),o.join(`
`)}return""+r},t}();const xZe=Object.freeze(Object.defineProperty({__proto__:null,AcroForm:GQe,AcroFormAppearance:na,AcroFormButton:Ii,AcroFormCheckBox:aw,AcroFormChoiceField:Ig,AcroFormComboBox:Tg,AcroFormEditBox:rw,AcroFormListBox:Og,AcroFormPasswordField:sw,AcroFormPushButton:nw,AcroFormRadioButton:Dg,AcroFormTextField:Zh,GState:O1,ShadingPattern:bh,TilingPattern:bg,default:da,jsPDF:da},Symbol.toStringTag,{value:"Module"})),ui=e=>{const t=String(e??"").replace(/\D/g,"");if(!t)return"";const r=(Number(t)/100).toFixed(2),[n,s]=r.split(".");return`${n.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${s}`},al=e=>{if(e==null||e==="")return NaN;const t=String(e).replace(/\./g,"").replace(",","."),r=parseFloat(t);return Number.isFinite(r)?r:NaN};function vZe({setIsModalOpen:e,setBookings:t,form:r,setForm:n,localCustomers:s,onOpenClientModal:o,onClientModalSuccess:i}){const{toast:l}=Ss(),{userProfile:c}=qs(),{loadAlerts:d}=t2(),{isPaymentModalOpen:u,closePaymentModal:f,editingBooking:h,paymentTotal:m,setPaymentTotal:x,participantsForm:g,setParticipantsForm:y,payMethods:v,openEditParticipantModal:b,protectPaymentModal:w,unprotectPaymentModal:_,onParticipantReplacedRef:j,lastVisibilityChangeTime:S,isModalProtected:C}=DN();window.__protectPaymentModal=w,p.useEffect(()=>(u&&(document.body.style.overflow="auto",document.body.style.pointerEvents="auto"),()=>{document.body.style.overflow="",document.body.style.pointerEvents=""}),[u]);const[A,P]=p.useState(""),[F,O]=p.useState([]);p.useState(null);const[I,T]=p.useState(null),[k,B]=p.useState(!1),[z,U]=p.useState(""),[L,W]=p.useState(!1),[ge,Ae]=p.useState([]);p.useState(null);const[V,$]=p.useState(0),[Y,he]=p.useState(!1),[J,G]=p.useState(""),[ue,ve]=p.useState([]),[ae,oe]=p.useState([]),me=p.useRef(!1),De=p.useRef({}),ne=p.useRef({}),ie=p.useRef({}),[ht,pt]=p.useState(null),[Ze,vt]=p.useState(null),[wt,gt]=p.useState(!1),[er,_e]=p.useState("downloading"),[Pt,Lt]=p.useState(0),[gr,fr]=p.useState(null),[je,nt]=p.useState(""),[$t,Ut]=p.useState(null),Fe=p.useRef(null),xt=p.useRef(null),Ot=p.useRef(null),Cr=p.useRef(null),Me=p.useRef([]),Qe=p.useRef(null),et=p.useRef(!1),Yt=p.useRef(null),xr=p.useRef([]),[Jt,kr]=p.useState({isOpen:!1,participantIndex:null,currentStatus:null}),_r=p.useRef(!1),Rr=p.useCallback((Oe,Wt)=>{oe(Ht=>{const mr=[...Ht];return Oe>=0&&Oe<mr.length&&(Wt===""&&mr[Oe].nome&&(ie.current[Oe]=mr[Oe].nome),Wt!==""&&delete ie.current[Oe],mr[Oe]={...mr[Oe],nome:Wt}),y(mr),mr})},[y]),nn=p.useCallback(Oe=>{const Wt=ie.current[Oe];Wt&&(oe(Ht=>{const mr=[...Ht];return Oe>=0&&Oe<mr.length&&(mr[Oe]={...mr[Oe],nome:Wt}),delete ie.current[Oe],y(mr),mr}),setTimeout(()=>{De.current[Oe]?.focus()},0))},[y]),rn=p.useCallback((Oe,Wt,Ht)=>{if(Wt==="Pago"){const mr=al(Ht);if(Number.isFinite(mr)&&mr>0)return}_r.current=!0,console.log(" [StatusConfirmation] Modal protegido por 3 segundos"),setTimeout(()=>{_r.current=!1,console.log(" [StatusConfirmation] Proteo removida")},3e3),kr({isOpen:!0,participantIndex:Oe,currentStatus:Wt})},[]),Ke=p.useCallback(Oe=>{const{participantIndex:Wt}=Jt;Wt!==null&&(oe(Ht=>{const mr=[...Ht];return Wt>=0&&Wt<mr.length&&(mr[Wt]={...mr[Wt],status_pagamento:Oe}),y(mr),mr}),setTimeout(()=>{console.log(" [StatusChange] Recarregando alertas..."),d().catch(Ht=>{console.error(" [StatusChange] Erro ao recarregar alertas:",Ht)})},500)),kr({isOpen:!1,participantIndex:null,currentStatus:null})},[Jt,y,d]),qe=p.useCallback(Oe=>!s||!Array.isArray(s)?!1:s.find(Ht=>Ht.id===Oe)?.is_consumidor_final===!0,[s]),ze=p.useCallback(()=>{const Oe=F||[],Wt=(ae||[]).map((Gt,pn)=>({...Gt,_originalIndex:pn})).filter(Gt=>!Oe.includes(Gt._originalIndex)),Ht=Wt.find(Gt=>qe(Gt.cliente_id)&&Gt.nome&&Gt.nome.toLowerCase().includes("cliente consumidor"));return Ht?Ht._originalIndex:Wt.find(Gt=>qe(Gt.cliente_id)&&Gt.nome)?._originalIndex??null},[ae,F,qe]),Je=p.useCallback(Oe=>{const Wt=F||[],mr=(ae||[]).map((pn,jt)=>({...pn,_originalIndex:jt})).filter(pn=>!Wt.includes(pn._originalIndex)).filter(pn=>qe(pn.cliente_id));if(mr.length===0)return null;const Gt=mr.findIndex(pn=>pn._originalIndex===Oe);return Gt!==-1?Gt<mr.length-1?mr[Gt+1]._originalIndex:mr[0]._originalIndex:null},[ae,F,qe]),kt=p.useCallback(Oe=>{const Wt=F||[],mr=(ae||[]).map((pn,jt)=>({...pn,_originalIndex:jt})).filter(pn=>!Wt.includes(pn._originalIndex)).filter(pn=>qe(pn.cliente_id)),Gt=mr.findIndex(pn=>pn._originalIndex===Oe);return Gt>0?mr[Gt-1]._originalIndex:null},[ae,F,qe]),ct=p.useCallback(()=>{if(!v||v.length===0)return null;const Oe=v.find(Wt=>Wt.codigo_interno==="01");return Oe||v[0]},[v]),tr=p.useMemo(()=>{const Oe=ae||[],Wt=F||[];return Oe.filter((Ht,mr)=>!Wt.includes(mr)).length},[ae,F]),dt=p.useMemo(()=>{const Oe=ae||[],Wt=F||[],Ht=Oe.filter((Dt,Xt)=>!Wt.includes(Xt)),mr=al(m);let Gt=0,pn=0,jt=0,ur=!1;Ht.forEach(Dt=>{let Xt=al(Dt?.valor_cota);if(Dt?.aplicar_taxa===!0&&Number.isFinite(Xt)){const qn=v.find(ar=>String(ar.id)===String(Dt.finalizadora_id)),Gr=Number(qn?.taxa_percentual||0);Gr>0&&(Xt=Xt/(1+Gr/100),ur=!0)}Number.isFinite(Xt)&&(Gt+=Xt),(Dt?.status_pagamento||"Pendente")==="Pago"?pn++:jt++});const rt=Number.isFinite(mr)?Gt-mr:0;return{totalTarget:mr,totalAssigned:Gt,diff:rt,paid:pn,pending:jt,temTaxaAplicada:ur}},[ae,F,m,v]),Mt=()=>{const Oe=al(m);if(!Number.isFinite(Oe)||tr===0)return;const Wt=Oe/tr,Ht=ui(String(Wt.toFixed(2)));oe(mr=>{const Gt=[...mr];return Gt.forEach((pn,jt)=>{Gt[jt]={...Gt[jt],valor_cota:Ht,status_pagamento:"Pago",aplicar_taxa:!1}}),Gt})},ce=()=>{oe(Oe=>{const Wt=[...Oe];return Wt.forEach((Ht,mr)=>{Wt[mr]={...Wt[mr],valor_cota:"",status_pagamento:"Pendente",aplicar_taxa:!1}}),Wt})},Xe=()=>{oe(Oe=>{const Wt=[...Oe];return Wt.forEach((Ht,mr)=>{const Gt=al(Ht.valor_cota);if(Gt>0){const jt=v.find(rt=>String(rt.id)===String(Ht.finalizadora_id)),ur=Number(jt?.taxa_percentual||0);if(ur>0&&!Ht.aplicar_taxa){const rt=Gt*(1+ur/100);Wt[mr]={...Wt[mr],aplicar_taxa:!0,valor_cota:ui(rt.toFixed(2))}}}}),Wt})},Qt=(Oe,Wt)=>{b(Oe,Wt)},Tt=()=>{G(m||""),he(!0)},Ar=()=>{try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] confirmEditingTotal",{prev:m,next:J,timestamp:new Date().toISOString()})}catch{}x(J),he(!1)},nr=()=>{G(""),he(!1)},Jr=async(Oe={})=>{const{autoSave:Wt=!1}=Oe;try{if(et.current||k){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [SAVE-PAYMENTS] Salvamento ignorado (j existe um em andamento)",{autoSave:Wt})}catch{}return}et.current=!0,B(!0);const Ht=h?.id,mr=c?.codigo_empresa;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [SAVE-PAYMENTS] Iniciando salvamento",{autoSave:Wt,agendamentoId:Ht,timestamp:new Date().toISOString()})}catch{}if(!Ht||!mr){l({title:"Erro ao salvar pagamentos",description:"Agendamento ou empresa indisponvel.",variant:"destructive"});return}const Gt=(ae||[]).filter((te,Te)=>!(F||[]).includes(Te)),pn=Y?J:m;try{if(Y){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] forcing total from editing state before save",{prev:m,editingTotalValue:J,totalStrToSave:pn,timestamp:new Date().toISOString()})}catch{}x(pn),he(!1)}}catch{}let jt=0;const ur=Gt.reduce((te,Te)=>{const at=Te.status_pagamento||"Pendente";return te+(at!=="Pago"?1:0)},0);try{localStorage.getItem("debug:agenda")==="1"&&(console.log(" [SAVE-PAYMENTS] Dados a salvar:",{totalParticipantes:Gt.length,pendentes:ur}),console.log("[ORDER-SAVE] savingIds:",Gt.map(te=>te.cliente_id)))}catch{}const rt=new Date().toISOString();try{localStorage.getItem("debug:agenda")==="1"&&console.log(`

========== SALVAMENTO INICIADO ${rt} ==========`)}catch{}const{data:Dt,error:Xt}=await re.from("agendamento_participantes").select("*").eq("codigo_empresa",mr).eq("agendamento_id",Ht).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(Xt)throw console.error(" Erro ao buscar participantes originais:",Xt),Xt;try{localStorage.getItem("debug:agenda")==="1"&&(console.log(` Participantes originais no banco: ${Dt?.length||0}`),console.log("[ORDER-SAVE] originalIds:",(Dt||[]).map(te=>te.cliente_id)))}catch{}jt=0,Gt.forEach((te,Te)=>{console.log(`  #${Te+1} (novo): ${te.nome}`)}),console.log(" Fazendo recriao completa de participantes (soft-delete + insert)");try{const{error:te}=await re.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).eq("codigo_empresa",mr).eq("agendamento_id",Ht).is("deleted_at",null);if(te)throw console.error(" Erro ao aplicar soft-delete nos participantes atuais:",te),te}catch(te){throw console.error(" Falha ao soft-deletar participantes antes de recriar:",te),te}if(Gt.length>0){const te=Gt.map((at,ee)=>{const Se=al(at.valor_cota),$e=ct(),Be=at.finalizadora_id||($e?.id?String($e.id):null);return{codigo_empresa:mr,agendamento_id:Ht,cliente_id:at.cliente_id,nome:(at?.nome||"").trim()||"Cliente Consumidor",valor_cota:Number.isFinite(Se)?Se:0,status_pagamento:at.status_pagamento||"Pendente",finalizadora_id:Be,aplicar_taxa:at.aplicar_taxa||!1,ordem:ee+1,is_representante:ee===0,deleted_at:null}}),{error:Te}=await re.from("agendamento_participantes").insert(te);if(Te)throw console.error(" Erro ao inserir participantes recriados:",Te),Te}console.log(" Recriao completa de participantes concluda"),console.log(`========== SALVAMENTO CONCLUDO ==========

`);const Tr=Gt.map(te=>({id:te.cliente_id,nome:te.nome,codigo:te.codigo!==null&&te.codigo!==void 0?te.codigo:null})),qn=Tr[0]||null,Gr=Tr.map(te=>te?.nome).filter(Boolean),ar=al(pn),kn=Number.isFinite(ar)?ar:null;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] updating agendamentos.valor_total",{agendamentoId:Ht,codigo_empresa:mr,totalStrToSave:pn,totalNum:ar,totalToPersist:kn,timestamp:new Date().toISOString()})}catch{}const{data:Xn,error:aa}=await re.from("agendamentos").update({cliente_id:qn?.id??null,clientes:Gr,valor_total:kn}).eq("codigo_empresa",mr).eq("id",Ht).select("id, valor_total");try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] update agendamentos result",{ok:!aa,error:aa?aa.message||aa:null,data:Xn,timestamp:new Date().toISOString()})}catch{}if(aa)throw aa;n(te=>({...te,selectedClients:Tr})),t(te=>te.map(Te=>Te.id===Ht?{...Te,customer:qn?.nome||Te.customer,cliente_id:qn?.id??null,clientes:Gr,valor_total:kn}:Te));let pa=Gt;if(Ze!==null){const te=De.current?.[Ze]?.value;typeof te=="string"&&(pa=[...Gt],Ze>=0&&Ze<pa.length&&(pa[Ze]={...pa[Ze],nome:te}))}oe(pa),O([]),Wt||(ur>0?l({title:"Pagamentos salvos",description:`${ur} ${ur===1?"pendente":"pendentes"}`,variant:"warning"}):l({title:"Pagamentos salvos",variant:"success"})),T(null),y(Gt);try{window.dispatchEvent(new CustomEvent("payments:saved",{detail:{agendamentoId:Ht,participants:Gt}}))}catch{}d().catch(te=>{console.error("[PaymentModal] Erro ao recarregar alertas:",te)});try{localStorage.getItem("debug:agenda")==="1"&&(console.log(" [SAVE-PAYMENTS] Salvamento concludo com sucesso"),console.log(" [SAVE-PAYMENTS] Contagem final de pendentes:",ur))}catch{}console.log(" [LOG 2 - FECHAR PAYMENT MODAL] Dados salvos no banco:"),console.log("   Total:",Gt.length),console.log("   Pendentes:",ur),Gt.forEach((te,Te)=>{console.log(`   #${Te+1}: ${te.nome} | Status: ${te.status_pagamento} | Valor: ${te.valor_cota}`)}),Wt&&console.log(" [SAVE-PAYMENTS] Salvamento em modo autoSave (sem fechar modal)")}catch(Ht){throw console.error(" [SAVE-PAYMENTS] Erro ao salvar:",Ht),l({title:"Erro ao salvar pagamentos",description:"Tente novamente.",variant:"destructive"}),Ht}finally{et.current=!1,B(!1)}},gn=p.useCallback(async(Oe="close")=>{try{if(!u||me.current||wt&&er==="downloading"||Jt?.isOpen||L||C&&String(Oe)==="interactOutside")return;me.current=!0;try{await Jr({autoSave:!0})}catch(Wt){console.error("[PaymentModal] Falha ao salvar ao fechar:",Wt)}finally{try{_()}catch{}f({force:!0});try{window.dispatchEvent(new Event("paymentmodal:closed"))}catch{}}}catch{}finally{me.current=!1}},[u,wt,er,Jt?.isOpen,L,C,Jr,f,_]);p.useEffect(()=>{const Oe=Wt=>{if(u&&!L&&!wt&&(Wt.key==="Escape"&&(Wt.preventDefault(),gn("escape-key")),Wt.key==="F8"&&(Wt.preventDefault(),m&&tr>0&&Mt()),Wt.key==="F9"&&(Wt.preventDefault(),tr>0&&Xe()),Wt.key==="F10"&&(Wt.preventDefault(),tr>0&&ce()),Wt.key==="Delete")){const Ht=document.activeElement;if(!(Ht&&Ht.tagName==="INPUT")){Wt.preventDefault();const Gt=ze();Gt!==null&&(Rr(Gt,""),setTimeout(()=>{De.current[Gt]?.focus()},0))}}};return window.addEventListener("keydown",Oe),()=>window.removeEventListener("keydown",Oe)},[u,L,wt,m,tr,Mt,Xe,ce,gn,ae,F,qe,Rr,ze]),p.useEffect(()=>{if(u){const Oe=ze();pt(Oe)}},[u,ae,F,ze]),p.useEffect(()=>{if(u){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Modal aberto - payMethods:",v?.length||0,"initializedRef:",xt.current)}catch{}Ot.current=setTimeout(()=>{try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Timeout de 3s acionado - initializedRef:",xt.current,"payMethods:",v?.length||0)}catch{}if(!xt.current&&(!v||v.length===0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Inicializando com timeout (sem finalizadoras)")}catch{}const Oe=(r?.selectedClients||[]).map(Wt=>{let Ht=Wt.codigo;if(Ht==null&&s&&Array.isArray(s)){const mr=s.find(Gt=>Gt.id===Wt.id);Ht=mr?.codigo!==null&&mr?.codigo!==void 0?mr.codigo:null}return{cliente_id:Wt.id,nome:Wt.nome,codigo:Ht,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1}});Array.isArray(ae)&&ae.length>0||oe(Oe),xt.current=Date.now()}},3e3),!xt.current&&v&&v.length>0&&(Ot.current&&(clearTimeout(Ot.current),Ot.current=null),(async()=>{const{defaultMethod:Wt,defaultFinalizadoraId:Ht,defaultAplicarTaxa:mr}=(()=>{const ur=ct(),rt=ur?.id?String(ur.id):null,Dt=Number(ur?.taxa_percentual||0)>0;return{defaultMethod:ur,defaultFinalizadoraId:rt,defaultAplicarTaxa:Dt}})();let Gt=[],pn="nenhuma";if(h?.id)try{const{data:ur,error:rt}=await re.from("agendamento_participantes").select("*").eq("agendamento_id",h.id).eq("codigo_empresa",c?.codigo_empresa).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});rt?console.error(" Erro ao buscar participantes:",rt):ur&&ur.length>0?(Gt=ur.map(Dt=>({cliente_id:Dt.cliente_id,nome:Dt.nome,codigo:null,valor_cota:Dt.valor_cota?ui(String(Number(Dt.valor_cota).toFixed(2))):"0,00",status_pagamento:Dt.status_pagamento||"Pendente",finalizadora_id:Dt.finalizadora_id?String(Dt.finalizadora_id):Ht,aplicar_taxa:Dt.aplicar_taxa||!1})),pn="banco de dados"):pn="banco vazio"}catch(ur){console.error(" Erro ao buscar participantes:",ur)}Gt.length===0&&g&&g.length>0?(Gt=g,pn="participantsForm (contexto)"):Gt.length===0&&r?.selectedClients&&r.selectedClients.length>0&&(Gt=(r?.selectedClients||[]).map(ur=>{let rt=ur.codigo;if(rt==null&&s&&Array.isArray(s)){const Dt=s.find(Xt=>Xt.id===ur.id);rt=Dt?.codigo!==null&&Dt?.codigo!==void 0?Dt.codigo:null}return{cliente_id:ur.id,nome:ur.nome,codigo:rt,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:Ht,aplicar_taxa:mr}}),pn="form.selectedClients");let jt=Gt.map(ur=>{let rt=ur.codigo;if(rt==null&&s&&Array.isArray(s)){const Xt=s.find(Tr=>Tr.id===ur.cliente_id);rt=Xt?.codigo!==null&&Xt?.codigo!==void 0?Xt.codigo:null}let Dt=ur.finalizadora_id;if(!Dt){const Xt=ct();Dt=Xt?.id?String(Xt.id):null}return{...ur,codigo:rt??ur.codigo,finalizadora_id:Dt}});try{const ur=(r?.selectedClients||[]).slice();if(ur.length>0&&jt.length>0){const rt=new Map;jt.forEach(Tr=>{const qn=rt.get(Tr.cliente_id)||[];qn.push(Tr),rt.set(Tr.cliente_id,qn)});const Dt=new Map,Xt=[];for(const Tr of ur){const qn=Dt.get(Tr.id)||0,ar=(rt.get(Tr.id)||[])[qn];if(ar)Xt.push(ar),Dt.set(Tr.id,qn+1);else{const kn=ct(),Xn=kn?.id?String(kn.id):null;Xt.push({cliente_id:Tr.id,nome:Tr.nome,codigo:Tr.codigo??null,valor_cota:"0,00",status_pagamento:"Pendente",finalizadora_id:Xn,aplicar_taxa:Number(kn?.taxa_percentual||0)>0})}}Gt=Xt,pn=pn+" (reordenado pelos chips)"}}catch(ur){console.error("[PaymentModal] Falha ao reordenar por chips:",ur)}if(jt=Gt.map(ur=>{let rt=ur.codigo;if(rt==null&&s&&Array.isArray(s)){const Dt=s.find(Xt=>Xt.id===ur.cliente_id);rt=Dt?.codigo!==null&&Dt?.codigo!==void 0?Dt.codigo:null}return{...ur,codigo:rt??ur.codigo,finalizadora_id:ur.finalizadora_id||(()=>{const Dt=ct();return Dt?.id?String(Dt.id):null})()}}),jt.length===0&&h?.id){console.error(" ALERTA CRTICO: Nenhum participante encontrado em NENHUMA fonte!"),console.error(" Agendamento ID:",h.id),console.error(" Empresa:",c?.codigo_empresa),console.error(" Isso pode indicar perda de dados!");try{const{data:ur,error:rt}=await re.from("agendamento_participantes").select("*").eq("agendamento_id",h.id);console.error(" Busca sem filtro de empresa:",{encontrados:ur?.length||0,dados:ur,erro:rt})}catch(ur){console.error(" Erro na busca de debug:",ur)}}if(jt.length>0||!h?.id){Array.isArray(ae)&&ae.length>0||oe(jt),xt.current=Date.now();try{if(localStorage.getItem("debug:agenda")==="1"){console.log(" [LOG 1 - ABRIR PAYMENT MODAL] Participantes carregados:"),console.log("   Total:",jt.length),console.log("   Fonte:",pn),jt.forEach((Dt,Xt)=>{console.log(`   #${Xt+1}: ${Dt.nome} | Status: ${Dt.status_pagamento} | Valor: ${Dt.valor_cota}`)});const ur=(r?.selectedClients||[]).map(Dt=>Dt.id),rt=jt.map(Dt=>Dt.cliente_id);console.log("[ORDER] chipsIds:",ur),console.log("[ORDER] finalIds:",rt)}}catch{}}else console.error(" BLOQUEADO: No vou sobrescrever com array vazio!"),console.error(" Mantendo dados anteriores para evitar perda.")})())}else Ot.current&&(clearTimeout(Ot.current),Ot.current=null),P(""),T(null),O([]),oe([]);return()=>{Ot.current&&clearTimeout(Ot.current)}},[u,v,ct,g,r?.selectedClients,s,ae]),p.useEffect(()=>{u&&!xt.current&&Array.isArray(ae)&&ae.length>0&&(xt.current=Date.now())},[u,ae]),p.useEffect(()=>{if(!u)return;const Oe=(ae||[]).length;if(Yt.current==null){Yt.current=Oe,xr.current=Array.isArray(ae)?ae:[];return}const Wt=Oe<Yt.current;let Ht=[];try{const mr=Array.isArray(xr.current)?xr.current:[],Gt=Array.isArray(ae)?ae:[],pn=ur=>`${ur?.cliente_id??""}|${(ur?.nome??"").toLowerCase()}`,jt=new Set(Gt.map(pn));Ht=mr.filter(ur=>!jt.has(pn(ur)))}catch{}if(Yt.current=Oe,xr.current=Array.isArray(ae)?ae:[],Wt&&h?.id)try{const mr=Ht.map(Gt=>Gt?.nome).filter(Boolean);console.log(" [PaymentModal] Participante(s) removido(s):",mr);try{window.dispatchEvent(new CustomEvent("payments:participant-removed",{detail:{agendamentoId:h?.id,removed:Ht}}))}catch{}}catch{}},[u,ae,h?.id,Jr]),p.useEffect(()=>{if(!u)return;const Oe=p.useRef.__prevHidden=p.useRef.__prevHidden||{len:0},Wt=(F||[]).length,Ht=Wt>(Oe.len||0);if(Oe.len=Wt,Ht&&h?.id)try{console.log(" [PaymentModal] ndices ocultados (remoo lgica):",F)}catch{}},[F,u,h?.id,Jr]),p.useEffect(()=>{xt.current=null},[h?.id]),p.useEffect(()=>(j.current=Oe=>{ve([Oe]),setTimeout(()=>{ve([])},1e3)},()=>{j.current=null}),[j]);const tt=p.useCallback(Oe=>{oe(Oe)},[]);p.useEffect(()=>(u&&(y.updateLocal=tt,y.getLocal=()=>ae),()=>{y.updateLocal&&(delete y.updateLocal,delete y.getLocal)}),[u,tt,ae]),p.useLayoutEffect(()=>{if(!u)return;const Oe=(r?.selectedClients||[]).slice();if(!(Oe.length===0||!ae||ae.length===0||Ze!==null||(ae||[]).some(Ht=>Ht?.status_pagamento&&Ht.status_pagamento!=="Pendente"||Ht?.valor_cota&&Ht.valor_cota!==""&&Ht.valor_cota!=="0,00")))try{const Ht=new Map;ae.forEach(Dt=>{const Xt=Ht.get(Dt.cliente_id)||[];Xt.push(Dt),Ht.set(Dt.cliente_id,Xt)});const mr=new Map,Gt=[];for(const Dt of Oe){const Xt=mr.get(Dt.id)||0,qn=(Ht.get(Dt.id)||[])[Xt];qn?(Gt.push(qn),mr.set(Dt.id,Xt+1)):Gt.push({cliente_id:Dt.id,nome:Dt.nome,codigo:Dt.codigo??null,valor_cota:"0,00",status_pagamento:"Pendente",finalizadora_id:ct()?.id?String(ct().id):null,aplicar_taxa:Number(ct()?.taxa_percentual||0)>0})}const pn=new Map(mr),jt=[];Ht.forEach((Dt,Xt)=>{const Tr=pn.get(Xt)||0;for(let qn=Tr;qn<Dt.length;qn++)jt.push(Dt[qn])});const ur=Gt.concat(jt);if(ur.length!==ae.length||ur.some((Dt,Xt)=>Dt.cliente_id!==ae[Xt]?.cliente_id||Dt.nome!==ae[Xt]?.nome)){try{if(localStorage.getItem("debug:agenda")==="1"){const Dt=Oe.map(Tr=>Tr.nome),Xt=ur.map(Tr=>Tr.nome);console.log("[ORDER] chipsNames:",Dt),console.log("[ORDER] finalNames (next):",Xt)}}catch{}oe(ur)}}catch(Ht){console.error("[PaymentModal] Falha ao reordenar aps mudana de chips:",Ht)}},[u,r?.selectedClients]),p.useEffect(()=>{L||(Ae([]),U("")),$(0)},[L]),p.useEffect(()=>{L&&Me.current[V]&&Me.current[V]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[V,L]),p.useEffect(()=>{const Oe=Wt=>{if(L){if(Wt.key==="Escape"){Wt.preventDefault(),W(!1),U(""),Ae([]);try{_()}catch{}}if(Wt.key==="Enter"&&Wt.target.tagName!=="INPUT"&&ge.length>0){Wt.preventDefault();const Ht=ge.map(mr=>({cliente_id:mr.id,nome:mr.nome,codigo:mr.codigo,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:(()=>{const Gt=ct();return Gt?.id?String(Gt.id):null})(),aplicar_taxa:(()=>{const Gt=ct();return Number(Gt?.taxa_percentual||0)>0})()}));oe(mr=>{const Gt=mr.length,pn=Ht.map((jt,ur)=>Gt+ur);return ve(pn),setTimeout(()=>{ve([])},1e3),[...mr,...Ht]}),W(!1),Ae([]),U("");try{_()}catch{}}}};return window.addEventListener("keydown",Oe),()=>window.removeEventListener("keydown",Oe)},[L,ge,ct,oe,l,U,W,Ae]),p.useEffect(()=>{const Oe=async()=>{await gn("external:save-and-close")};return window.addEventListener("paymentmodal:save-and-close",Oe),()=>window.removeEventListener("paymentmodal:save-and-close",Oe)},[gn]),p.useEffect(()=>{!wt&&$t&&(console.log(" [PDF] Revogando URL do blob ao fechar modal"),URL.revokeObjectURL($t),Ut(null))},[wt,$t]);const jr=p.useRef(null),ua=async()=>{try{if(console.log(" [PDF] Iniciando gerao do PDF"),!jr.current)throw new Error("Elemento do relatrio no encontrado");console.log(" [PDF] Abrindo modal de download"),$t&&URL.revokeObjectURL($t),gt(!0),_e("downloading"),Lt(0),fr(null),Ut(null),nt("");const Oe=(ae||[]).filter((pa,te)=>!(F||[]).includes(te)),Wt=20,Ht=Math.ceil(Oe.length/Wt);Lt(5);const mr=new da({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),Gt=297,pn=210;for(let pa=0;pa<Ht;pa++){const te=pa*Wt,Te=Math.min(te+Wt,Oe.length),at=Oe.slice(te,Te),ee=10+Math.floor(pa/Ht*80);Lt(ee);const Se=jr.current;if(!Se)throw new Error("Elemento do relatrio no encontrado durante a gerao");console.log(` [PDF] Capturando pgina ${pa+1}/${Ht} (participantes ${te+1}-${Te})`);const $e={visibility:Se.style.visibility,opacity:Se.style.opacity};Se.style.visibility="visible",Se.style.opacity="1",console.log(` [PDF] Elemento innerHTML length: ${Se.innerHTML.length}`),console.log(` [PDF] Elemento scrollHeight: ${Se.scrollHeight}`),console.log(` [PDF] Elemento scrollWidth: ${Se.scrollWidth}`);const Be=Se.querySelector('div[style*="borderBottom"]'),Ge=Se.querySelectorAll('div[style*="borderBottom"]')[1];pa>0?(Be&&(Be.style.display="none"),Ge&&(Ge.style.display="none")):(Be&&(Be.style.display="block"),Ge&&(Ge.style.display="flex"));const Ye=Se.querySelectorAll("tbody tr");console.log(` [PDF] Total de linhas na tabela: ${Ye.length}`),Ye.forEach((St,Nr)=>{St.style.display=Nr>=te&&Nr<Te?"table-row":"none"});const ft=Se.querySelector("#page-indicator");ft&&(ft.textContent=`Pgina ${pa+1} de ${Ht}`),console.log(" [PDF] Forando reflow..."),Se.offsetHeight,Se.getBoundingClientRect(),Se.scrollHeight,Se.offsetWidth,Se.clientHeight,console.log(" [PDF] Aguardando renderizao..."),await new Promise(St=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(St,2e3)})})})}),console.log(" [PDF] Renderizao completa, iniciando captura...");const yt=Se.querySelectorAll("tbody tr");if(console.log(` [PDF] Linhas da tabela encontradas: ${yt.length}`),yt.forEach((St,Nr)=>{const an=St.querySelectorAll("td"),Lr=Array.from(an).map(On=>On.textContent.trim()).join(" | ");console.log(` [PDF] Linha ${Nr+1}: ${Lr}`)}),yt.length===0){console.warn(" [PDF] AVISO: Nenhuma linha de tabela encontrada! Verificando estrutura...");const St=Se.querySelector("tbody");console.log(" [PDF] tbody existe:",!!St),St&&console.log(" [PDF] innerHTML do tbody:",St.innerHTML.substring(0,500))}let Et;try{const St=Se.scrollHeight,Nr=Se.scrollWidth;if(console.log(` [PDF] Dimenses reais: width=${Nr}px, height=${St}px`),Et=await pXe(Se,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0,skipFonts:!1}),!Et||Et.length===0)throw new Error("Canvas vazio retornado pela captura");console.log(` [PDF] Pgina ${pa+1} capturada (${Et.length} bytes, ${St}px altura, ${yt.length} linhas)`)}catch(St){throw console.error(` [PDF] Erro ao capturar pgina ${pa+1}:`,St),Se.style.visibility=$e.visibility,Se.style.opacity=$e.opacity,new Error(`Falha ao capturar pgina ${pa+1}: ${St.message}`)}Se.style.visibility=$e.visibility,Se.style.opacity=$e.opacity,pa>0&&mr.addPage();const br=Gt,Ue=Se.scrollHeight/Se.scrollWidth*Gt;mr.addImage(Et,"PNG",0,0,br,Ue,"","MEDIUM"),console.log(` [PDF] Pgina ${pa+1} adicionada ao PDF (${br}mm x ${Ue}mm)`)}if(jr.current){jr.current.querySelectorAll("tbody tr").forEach(Te=>{Te.style.display="table-row"});const te=jr.current.querySelector("#page-indicator");te&&(te.textContent="")}Lt(95);const jt=Ht>1?` (${Ht} pginas)`:"",ur=(ae||[]).filter((pa,te)=>!(F||[]).includes(te));let rt=ur.find(pa=>!s?.find(Te=>Te.id===pa.cliente_id)?.is_consumidor_final);!rt&&ur.length>0&&(rt=ur[0]);const Xt=(rt?.nome||"sem-nome").trim().split(/\s+/),Tr=Xt[0]||"sem",qn=Xt.length>1?Xt[Xt.length-1]:"nome",ar=`rel-${`${Tr}-${qn}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9-]+/g,"-").replace(/^-+|-+$/g,"")}-${h?.code||"0"}${jt}.pdf`,kn=mr.output("blob"),Xn=URL.createObjectURL(kn);fr(kn),Ut(Xn),nt(ar),Lt(100);const aa=document.createElement("a");aa.href=Xn,aa.download=ar,aa.click(),await new Promise(pa=>setTimeout(pa,500)),console.log(" [PDF] PDF gerado com sucesso! Modal de download deve permanecer aberto."),console.log(" [PDF] isPaymentModalOpen deve continuar true"),_e("success"),console.log(" [PDF] Status atualizado para success")}catch(Oe){console.error(" [PDF] Erro ao gerar PDF:",Oe),gt(!1),l({title:"Erro ao gerar PDF",description:Oe?.message||"No foi possvel gerar o PDF.",variant:"destructive"})}};return a.jsxs(a.Fragment,{children:[a.jsx(In,{open:u,onOpenChange:Oe=>{if(console.log(" [PaymentModal] onOpenChange chamado:",{open:Oe,isDownloadModalOpen:wt}),!Oe){if(console.log(" [PaymentModal] Tentando fechar modal de pagamentos"),wt&&er==="downloading"){console.log(" [PaymentModal] BLOQUEADO: Modal de download est gerando");return}gn("x")}},children:a.jsx(En,{forceMount:!0,className:"w-full max-w-screen-sm sm:max-w-[1100px] max-h-[90vh] overflow-y-auto overflow-x-hidden mx-auto px-5 sm:px-6 flex flex-col items-center sm:items-stretch",onOpenAutoFocus:Oe=>Oe.preventDefault(),onInteractOutside:async Oe=>{const Wt=Date.now(),Ht=xt.current?Wt-xt.current:0,mr=Wt-S;if(console.log(" [PaymentModal] onInteractOutside disparado:",{target:Oe.target?.tagName,className:Oe.target?.className?.substring?.(0,50),timeSinceInit:`${Ht}ms`,timeSinceVisibility:`${mr}ms`,isAddParticipantOpen:L,isDownloadModalOpen:wt,statusConfirmationOpen:Jt.isOpen,isModalProtected:C,timestamp:new Date().toISOString()}),Jt.isOpen){console.log(" [PaymentModal] Bloqueado: modal de confirmao de status est aberto"),Oe.preventDefault();return}if(wt){console.log(" [PaymentModal] Bloqueado: modal de download est aberto"),Oe.preventDefault();return}if(C){console.log(" [PaymentModal] Bloqueado: modal protegido (protectPaymentModal ativo)"),Oe.preventDefault();return}if(L){console.log(" [PaymentModal] Bloqueado: modal de adicionar participante aberto"),Oe.preventDefault();return}if(xt.current&&Ht<500){console.log(" [PaymentModal] Bloqueado: modal abriu recentemente"),Oe.preventDefault();return}if(mr<3e3){console.log(` [PaymentModal] Bloqueado: mudana de visibilidade recente (${mr}ms atrs)`),Oe.preventDefault();return}Oe.preventDefault(),await gn("interactOutside")},onEscapeKeyDown:Oe=>{Oe.preventDefault(),gn("escape")},children:!v||v.length===0?xt.current?a.jsxs(a.Fragment,{children:[a.jsxs(Cn,{className:"sr-only",children:[a.jsx(Nn,{children:"Aviso"}),a.jsx(Hn,{children:"Nenhuma forma de pagamento cadastrada"})]}),a.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4",children:[a.jsx(Df,{className:"w-12 h-12 text-amber-500"}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("p",{className:"font-semibold text-amber-500",children:"Nenhuma forma de pagamento cadastrada"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Cadastre pelo menos uma finalizadora para gerenciar pagamentos."})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx(se,{type:"button",variant:"outline",onClick:f,children:"Fechar"}),a.jsx(H4,{to:"/finalizadoras",children:a.jsx(se,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:f,children:"Cadastrar Finalizadora"})})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(Cn,{className:"sr-only",children:[a.jsx(Nn,{children:"Carregando"}),a.jsx(Hn,{children:"Carregando formas de pagamento"})]}),a.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Carregando formas de pagamento..."})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(Cn,{className:"relative pb-4 w-full max-w-[600px] mx-auto sm:max-w-none sm:mx-0",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3 sm:gap-4",children:[a.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsx(Nn,{children:"Registrar pagamento"})}),a.jsx(Hn,{className:"hidden sm:block",children:"As alteraes so salvas ao fechar o modal."})]}),a.jsxs(se,{type:"button",variant:"outline",size:"sm",onClick:ua,className:"flex-shrink-0 gap-2 w-full sm:w-auto mt-2 sm:mt-0 sm:mr-12",title:"Baixar relatrio como imagem",children:[a.jsx(ks,{className:"w-4 h-4"}),a.jsx("span",{children:"Baixar Relatrio"})]})]})}),a.jsxs("div",{className:"space-y-3 sm:space-y-6 w-full max-w-[600px] mx-auto sm:max-w-none sm:mx-0",children:[a.jsxs("div",{className:"sm:hidden space-y-2 max-w-md mx-auto",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{className:"p-2 rounded-lg bg-emerald-600/10 border border-emerald-500/30 min-w-0 relative group",children:[a.jsx("div",{className:"text-[10px] text-emerald-300/80 mb-1 truncate",children:"Total"}),Y?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Ct,{type:"text",value:J,onChange:Oe=>G(ui(Oe.target.value)),className:"w-full h-6 text-xs text-center font-bold bg-emerald-950/50 border-emerald-400/50 text-emerald-300 px-1",placeholder:"0,00",autoFocus:!0,onKeyDown:Oe=>{Oe.key==="Enter"&&J!==m?Ar():Oe.key==="Escape"&&nr()},onBlur:()=>{J!==m?Ar():nr()}}),J!==m&&a.jsx("button",{onMouseDown:Oe=>Oe.preventDefault(),onClick:Ar,className:"p-0.5 rounded hover:bg-emerald-500/20 transition-colors flex-shrink-0",title:"Confirmar",children:a.jsx(Sm,{className:"w-3 h-3 text-emerald-400"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-bold text-emerald-400 truncate",children:ui(m)||"R$ 0,00"}),a.jsx("button",{onClick:Tt,className:"absolute right-1 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-emerald-500/20 transition-colors",title:"Editar",children:a.jsx(ec,{className:"w-3 h-3 text-emerald-400"})})]})]}),a.jsxs("div",{className:`p-2 rounded-lg border min-w-0 ${dt.diff===0?"bg-emerald-600/10 border-emerald-500/30":dt.diff>0?"bg-amber-600/10 border-amber-500/30":"bg-rose-600/10 border-rose-500/30"}`,children:[a.jsx("div",{className:`text-[10px] mb-1 truncate ${dt.diff===0?"text-emerald-300/80":dt.diff>0?"text-amber-300/80":"text-rose-300/80"}`,children:"Diferena"}),a.jsxs("div",{className:`text-sm font-bold truncate ${dt.diff===0?"text-emerald-400":dt.diff>0?"text-amber-400":"text-rose-400"}`,children:[dt.diff>0?"+":"",ui(String(Math.abs(dt.diff).toFixed(2)))]})]})]}),a.jsxs("div",{className:"flex gap-1.5 text-xs justify-center",children:[a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"})," ",a.jsx("strong",{children:tr})]}),a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Atribudo:"})," ",a.jsxs("strong",{children:["R$ ",dt.totalAssigned.toFixed(2)]})]}),a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Alvo:"})," ",a.jsxs("strong",{children:["R$ ",dt.totalTarget.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(se,{type:"button",size:"sm",className:"bg-sky-600 hover:bg-sky-500 text-white text-xs h-8 px-3",onClick:Mt,disabled:!m||tr===0,children:(()=>{const Oe=al(m);if(Number.isFinite(Oe)&&tr>0){const Wt=Oe/tr;return`Dividir (${ui(String(Wt.toFixed(2)))})`}return"Dividir"})()}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{type:"button",variant:"ghost",size:"sm",className:"border border-amber-500/30 text-amber-400 hover:bg-amber-500/10 text-xs h-8 px-3 flex-1",onClick:Xe,disabled:tr===0,children:"Aplicar taxas"}),a.jsx(se,{type:"button",variant:"ghost",size:"sm",className:"border border-white/10 text-xs h-8 px-3 flex-1",onClick:ce,disabled:tr===0,children:"Zerar"})]})]})]}),a.jsx("div",{className:"hidden sm:block p-4 rounded-lg border border-border bg-gradient-to-br from-surface-2 to-surface shadow-md",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start gap-3 w-full",children:[a.jsxs("div",{className:"flex flex-row gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(it,{className:"font-bold text-base text-white",children:"Valor total a receber"}),a.jsx("div",{className:"w-[180px] px-3 py-2 rounded-md bg-gradient-to-br from-emerald-600/20 to-emerald-700/20 border-2 border-emerald-500/40 shadow-lg flex items-center justify-center gap-2 relative group",children:Y?a.jsxs(a.Fragment,{children:[a.jsx(Ct,{type:"text",value:J,onChange:Oe=>G(ui(Oe.target.value)),className:"w-full h-8 text-center text-lg font-bold bg-emerald-950/50 border-emerald-400/50 text-emerald-300",placeholder:"0,00",autoFocus:!0,onKeyDown:Oe=>{Oe.key==="Enter"&&J!==m?Ar():Oe.key==="Escape"&&nr()},onBlur:()=>{J!==m?Ar():nr()}}),J!==m&&a.jsx("button",{onMouseDown:Oe=>Oe.preventDefault(),onClick:Ar,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-emerald-500/20 transition-colors",title:"Confirmar (Enter)",children:a.jsx(Sm,{className:"w-4 h-4 text-emerald-400"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-xl font-bold text-emerald-400",children:ui(m)||"R$ 0,00"}),a.jsx("button",{onClick:Tt,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-emerald-500/20 transition-colors opacity-0 group-hover:opacity-100",title:"Editar valor total",children:a.jsx(ec,{className:"w-4 h-4 text-emerald-400"})})]})})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(it,{className:"font-bold text-base text-white",children:"Diferena"}),a.jsx("div",{className:`w-[180px] px-3 py-2 rounded-md border-2 shadow-lg flex items-center justify-center ${dt.diff===0?"bg-gradient-to-br from-emerald-600/20 to-emerald-700/20 border-emerald-500/40":dt.diff>0?"bg-gradient-to-br from-amber-600/20 to-amber-700/20 border-amber-500/40":"bg-gradient-to-br from-rose-600/20 to-rose-700/20 border-rose-500/40"}`,children:a.jsxs("span",{className:`text-xl font-bold ${dt.diff===0?"text-emerald-400":dt.diff>0?"text-amber-400":"text-rose-400"}`,children:[dt.diff>0?"+":"",ui(String(Math.abs(dt.diff).toFixed(2)))]})})]})]}),a.jsxs("div",{className:"ml-auto flex flex-col gap-3 items-end",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"}),a.jsx("strong",{children:tr})]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Atribudo:"}),a.jsxs("strong",{children:["R$ ",dt.totalAssigned.toFixed(2)]})]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Alvo:"}),a.jsxs("strong",{children:["R$ ",dt.totalTarget.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[a.jsx(se,{type:"button",variant:"secondary",size:"sm",className:"bg-sky-600 hover:bg-sky-500 text-white flex-shrink-0",onClick:Mt,disabled:!m||tr===0,children:(()=>{const Oe=al(m);if(Number.isFinite(Oe)&&tr>0){const Wt=Oe/tr;return a.jsxs(a.Fragment,{children:["Dividir igualmente (",ui(String(Wt.toFixed(2)))," cada)",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-sky-700/50 rounded border border-sky-500/30",children:"F8"})]})}return a.jsxs(a.Fragment,{children:["Dividir igualmente",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-sky-700/50 rounded border border-sky-500/30",children:"F8"})]})})()}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{type:"button",variant:"ghost",size:"sm",className:"border border-amber-500/30 text-amber-400 hover:bg-amber-500/10 flex-1 sm:flex-initial whitespace-nowrap",onClick:Xe,disabled:tr===0,children:["Aplicar taxas",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-amber-700/50 rounded border border-amber-500/30",children:"F9"})]}),a.jsxs(se,{type:"button",variant:"ghost",size:"sm",className:"border border-white/10 flex-1 sm:flex-initial",onClick:ce,disabled:tr===0,children:["Zerar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"F10"})]})]})]})]})]})}),(r.selectedClients||[]).length===0?a.jsx("div",{className:"text-xs text-text-muted italic",children:'Nenhum participante neste agendamento. Adicione participantes no campo "Clientes" do modal principal.'}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("div",{className:"relative flex-1 min-w-0",children:[a.jsx(Ct,{ref:Fe,type:"text",placeholder:"Buscar participante...",value:A,onChange:Oe=>P(Oe.target.value),className:"pr-16"}),a.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-amber-400 hover:text-amber-300",onClick:()=>{P(""),Fe.current?.focus()},children:"limpar"})]}),a.jsxs(se,{type:"button",size:"sm",className:"bg-amber-500 hover:bg-amber-400 text-black shadow-md flex-shrink-0",onClick:Oe=>{Oe.preventDefault(),Oe.stopPropagation(),w(2e3),W(!0)},children:[a.jsx("span",{className:"hidden sm:inline",children:"Adicionar participante +"}),a.jsx("span",{className:"sm:hidden",children:"Participante +"})]})]}),I?.type==="pending"&&a.jsxs("div",{role:"alert",className:"mb-2 rounded-md border border-amber-600/40 bg-amber-500/10 px-3 py-2 text-amber-200 flex items-start gap-3",children:[a.jsx(Df,{className:"w-4 h-4 text-amber-300 mt-0.5"}),a.jsxs("div",{className:"flex-1 text-sm",children:[a.jsx("strong",{children:"Ateno:"})," Existem ",a.jsx("strong",{children:I.count})," participante(s) com status ",a.jsx("strong",{children:"Pendente"}),"."]}),a.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded bg-amber-500/20 hover:bg-amber-500/30 border border-amber-600/40",onClick:()=>T(null),children:"Entendi"})]}),a.jsx("div",{className:"border border-border rounded-md overflow-hidden",children:a.jsx("div",{className:"divide-y divide-border max-h-[50vh] overflow-y-scroll",children:(()=>{const Oe=A.trim().toLowerCase(),Wt=F||[],mr=(ae||[]).map((Gt,pn)=>({...Gt,_originalIndex:pn})).filter(Gt=>!Wt.includes(Gt._originalIndex)).filter(Gt=>!Oe||String(Gt?.nome||"").toLowerCase().includes(Oe));return mr.length===0?a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Nenhum participante com esse nome"}):mr.map(Gt=>{const pn=`participant-${Gt._originalIndex}`,jt=Gt._originalIndex,ur=ue.includes(jt);return a.jsxs("div",{className:`p-2 sm:p-3 border-b last:border-b-0 transition-all duration-500 ease-out ${ur?"bg-white/10":""}`,children:[a.jsxs("div",{className:"sm:hidden space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[Gt.codigo!==null&&Gt.codigo!==void 0&&a.jsxs("span",{className:`text-xs font-bold rounded px-1.5 py-0.5 shrink-0 ${Gt.status_pagamento==="Pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",Gt.codigo]}),qe(Gt.cliente_id)?a.jsxs("div",{className:"relative flex-1 min-w-0",children:[a.jsx("input",{ref:rt=>{rt&&(De.current[jt]=rt)},type:"text",value:Gt.nome||"",onChange:rt=>Rr(jt,rt.target.value),onFocus:()=>vt(jt),onKeyDown:rt=>{if(rt.key==="Enter"){rt.preventDefault();const Dt=Je(jt);Dt!==null&&setTimeout(()=>{De.current[Dt]?.focus()},0)}else if(rt.key==="Delete"&&Gt.nome&&rt.target===document.activeElement)rt.preventDefault(),rt.stopPropagation(),Rr(jt,""),setTimeout(()=>{De.current[jt]?.focus()},0);else if(rt.key==="ArrowDown"){rt.preventDefault();const Dt=Je(jt);Dt!==null&&setTimeout(()=>{De.current[Dt]?.focus()},0)}else if(rt.key==="ArrowUp"){rt.preventDefault();const Dt=kt(jt);Dt!==null&&setTimeout(()=>{De.current[Dt]?.focus()},0)}},onBlur:async rt=>{vt(null);const Dt=(rt.currentTarget?.value||"").trim();Dt===""?ie.current[jt]&&nn(jt):(oe(Xt=>{const Tr=[...Xt];return jt>=0&&jt<Tr.length&&(Tr[jt]={...Tr[jt],nome:Dt}),Tr}),delete ie.current[jt])},placeholder:"Nome do cliente...",className:"font-medium text-sm bg-black/40 text-white placeholder:text-white/50 border border-white/15 rounded px-2 py-0.5 pr-11 focus:border-white/30 focus:outline-none focus:ring-1 focus:ring-white/20 w-full",title:"Editar nome do Cliente Consumidor (histrico do agendamento)"}),Gt.nome?a.jsx("button",{type:"button",onClick:()=>{Rr(jt,""),setTimeout(()=>{De.current[jt]?.focus()},0)},className:`absolute right-1 top-1/2 -translate-y-1/2 px-1.5 py-0.5 text-[10px] font-bold border rounded transition-all ${Ze===jt||!Ze&&ht===jt?"text-amber-300 bg-amber-500/20 border-amber-400/50 animate-pulse shadow-lg shadow-amber-500/20":"text-white/60 bg-white/10 hover:bg-white/20 hover:text-white/90 border-white/20"}`,title:Ze===jt||!Ze&&ht===jt?"Ser limpo ao pressionar Delete":"Limpar nome (tecla Delete)",children:"DEL"}):ie.current[jt]?a.jsx("button",{type:"button",onClick:()=>nn(jt),className:"absolute right-1 top-1/2 -translate-y-1/2 p-1 text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20 hover:text-emerald-300 border border-emerald-500/30 rounded transition-all",title:"Restaurar ltimo nome",children:a.jsx(c$,{className:"w-3 h-3"})}):null]}):a.jsx("span",{className:"font-medium text-sm truncate",children:Gt.nome})]}),a.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[a.jsx("button",{type:"button",className:"p-1 text-text-secondary hover:text-brand transition-colors",onClick:()=>Qt(jt,Gt.nome),title:"Trocar",children:a.jsx(ec,{className:"w-4 h-4"})}),a.jsx(se,{type:"button",variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400 h-6 w-6 p-0",onClick:()=>{O(rt=>[...rt,jt])},children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{children:[a.jsx(it,{className:"text-[10px] text-text-muted",children:"Mtodo"}),a.jsxs(Gn,{value:String(Gt.finalizadora_id||""),onValueChange:rt=>{oe(Dt=>{const Xt=[...Dt];if(jt>=0&&jt<Xt.length){const Tr=v.find(Gr=>String(Gr.id)===String(rt)),qn=Number(Tr?.taxa_percentual||0)>0;Xt[jt]={...Xt[jt],finalizadora_id:rt,aplicar_taxa:qn?Xt[jt].aplicar_taxa??!0:!1}}return Xt})},children:[a.jsx(Vn,{className:"h-8 text-xs",children:a.jsx(Kn,{placeholder:"Mtodo"})}),a.jsx(Wn,{children:v.map(rt=>a.jsx(lt,{value:String(rt.id),children:rt.nome||rt.tipo||"Outros"},rt.id))})]}),(()=>{const rt=v.find(qn=>String(qn.id)===String(Gt.finalizadora_id)),Dt=Number(rt?.taxa_percentual||0);if(Dt<=0)return a.jsx("div",{className:"h-4 mt-1"});const Xt=al(Gt.valor_cota),Tr=Number.isFinite(Xt)&&Xt>0;return a.jsxs("label",{className:`flex items-center gap-1.5 mt-1 text-[11px] ${Tr?"cursor-pointer":"cursor-not-allowed opacity-50"}`,title:Tr?`Taxa de ${Dt.toFixed(2)}%`:"Informe o valor primeiro",children:[a.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!Gt.aplicar_taxa,disabled:!Tr,onChange:qn=>{if(!Tr){l({title:"Valor necessrio",description:"Informe o valor antes de aplicar a taxa.",variant:"destructive"});return}oe(Gr=>{const ar=[...Gr];if(jt>=0&&jt<ar.length){const kn=qn.target.checked;let Xn=Xt;kn?Xn=Xt*(1+Dt/100):Xn=Xt/(1+Dt/100),ar[jt]={...ar[jt],aplicar_taxa:kn,valor_cota:ui(Xn.toFixed(2))}}return ar})},style:{accentColor:"#f59e0b"}}),a.jsxs("span",{className:"text-amber-500 font-medium",children:["Taxa (",Dt.toFixed(2),"%)"]})]})})()]}),a.jsxs("div",{className:"isolate",children:[a.jsx(it,{className:"text-[10px] text-text-muted",children:"Valor"}),a.jsx(Ct,{ref:rt=>{rt&&(ne.current[jt]=rt)},type:"text",inputMode:"decimal",placeholder:"R$ 0,00",value:ui(Gt.valor_cota),onChange:rt=>{const Dt=ui(rt.target.value),Xt=al(Dt),Tr=Number.isFinite(Xt)&&Xt>0?"Pago":"Pendente";oe(qn=>{const Gr=[...qn];return jt>=0&&jt<Gr.length&&(Gr[jt]={...Gr[jt],valor_cota:Dt,status_pagamento:Tr,aplicar_taxa:Dt===""||Xt<=0?!1:Gr[jt].aplicar_taxa}),Gr})},className:"h-8 text-xs text-text-primary placeholder:text-slate-400 bg-surface-2 border-border hover:border-border-hover focus:border-brand focus:ring-2 focus:ring-brand/20"})]})]}),a.jsx("div",{className:"flex justify-end",children:(()=>{const rt=Gt.status_pagamento==="Pago",Dt=Number.isFinite(al(Gt.valor_cota))&&al(Gt.valor_cota)>0,Xt=rt&&Dt;return a.jsx("button",{type:"button",onClick:()=>rn(jt,Gt.status_pagamento,Gt.valor_cota),disabled:Xt,className:`inline-flex items-center justify-center px-3 py-0.5 rounded text-xs font-medium border transition-all ${rt&&Dt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 cursor-not-allowed":rt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 hover:bg-emerald-600/30 hover:border-emerald-600/60 cursor-pointer":"bg-amber-600/20 text-amber-400 border-amber-700/40 hover:bg-amber-600/30 hover:border-amber-600/60 cursor-pointer"}`,title:Xt?"No  possvel alterar (valor preenchido)":"Clique para alterar status",children:rt?"Pago":"Pendente"})})()})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-3",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"flex items-center gap-2",children:[Gt.codigo!==null&&Gt.codigo!==void 0&&a.jsxs("span",{className:`text-sm font-bold rounded-md px-2.5 py-1 shadow-sm ${Gt.status_pagamento==="Pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",Gt.codigo]}),qe(Gt.cliente_id)?a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:rt=>{rt&&(De.current[jt]=rt)},type:"text",value:Gt.nome||"",onChange:rt=>Rr(jt,rt.target.value),onFocus:()=>vt(jt),onKeyDown:rt=>{if(rt.key==="Enter"){rt.preventDefault();const Dt=Je(jt);Dt!==null&&setTimeout(()=>{De.current[Dt]?.focus()},0)}else if(rt.key==="Delete"&&Gt.nome&&rt.target===document.activeElement)rt.preventDefault(),rt.stopPropagation(),Rr(jt,""),setTimeout(()=>{De.current[jt]?.focus()},0);else if(rt.key==="ArrowDown"){rt.preventDefault();const Dt=Je(jt);Dt!==null&&setTimeout(()=>{De.current[Dt]?.focus()},0)}else if(rt.key==="ArrowUp"){rt.preventDefault();const Dt=kt(jt);Dt!==null&&setTimeout(()=>{De.current[Dt]?.focus()},0)}},onBlur:async rt=>{vt(null);const Dt=(rt.currentTarget?.value||"").trim();Dt===""?ie.current[jt]&&nn(jt):(oe(Xt=>{const Tr=[...Xt];return jt>=0&&jt<Tr.length&&(Tr[jt]={...Tr[jt],nome:Dt}),Tr}),delete ie.current[jt])},placeholder:"Nome do cliente...",className:"font-medium text-base bg-black/40 text-white placeholder:text-white/50 border border-white/15 rounded-md px-3 py-1.5 pr-14 focus:border-white/30 focus:outline-none focus:ring-2 focus:ring-white/20 min-w-[200px] max-w-[300px]",title:"Editar nome do Cliente Consumidor (histrico do agendamento)"}),Gt.nome?a.jsx("button",{type:"button",onClick:()=>{Rr(jt,""),setTimeout(()=>{De.current[jt]?.focus()},0)},className:`absolute right-2 top-1/2 -translate-y-1/2 px-2 py-1 text-xs font-bold border rounded transition-all ${Ze===jt||!Ze&&ht===jt?"text-amber-300 bg-amber-500/20 border-amber-400/50 animate-pulse shadow-lg shadow-amber-500/30":"text-white/60 bg-white/10 hover:bg-white/20 hover:text-white/90 border-white/20 shadow-sm"}`,title:Ze===jt||!Ze&&ht===jt?"Ser limpo ao pressionar Delete":"Limpar nome (tecla Delete)",children:"DEL"}):ie.current[jt]?a.jsx("button",{type:"button",onClick:()=>nn(jt),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20 hover:text-emerald-300 border border-emerald-500/30 rounded transition-all shadow-sm",title:"Restaurar ltimo nome",children:a.jsx(c$,{className:"w-4 h-4"})}):null]}):a.jsx("span",{className:"font-medium text-base",children:Gt.nome}),a.jsx("button",{type:"button",className:"p-1 text-text-secondary hover:text-brand transition-colors",onClick:()=>Qt(jt,Gt.nome),title:"Trocar participante",children:a.jsx(ec,{className:"w-5 h-5"})})]})}),a.jsx("div",{className:"isolate",children:a.jsx(Ct,{ref:rt=>{rt&&(ne.current[jt]=rt)},type:"text",inputMode:"decimal",placeholder:"R$ 0,00",value:ui(Gt.valor_cota),onChange:rt=>{const Dt=ui(rt.target.value),Xt=al(Dt),Tr=Number.isFinite(Xt)&&Xt>0?"Pago":"Pendente";oe(qn=>{const Gr=[...qn];return jt>=0&&jt<Gr.length&&(Gr[jt]={...Gr[jt],valor_cota:Dt,status_pagamento:Tr,aplicar_taxa:Dt===""||Xt<=0?!1:Gr[jt].aplicar_taxa}),Gr})},className:"w-28 text-text-primary placeholder:text-slate-400 bg-surface-2 border-border hover:border-border-hover focus:border-brand focus:ring-2 focus:ring-brand/20"})}),a.jsxs("div",{className:"flex items-center gap-2 min-w-[240px] isolate",children:[a.jsxs(Gn,{value:String(Gt.finalizadora_id||""),onValueChange:rt=>{oe(Dt=>{const Xt=[...Dt];if(jt>=0&&jt<Xt.length){const Tr=v.find(Gr=>String(Gr.id)===String(rt)),qn=Number(Tr?.taxa_percentual||0)>0;Xt[jt]={...Xt[jt],finalizadora_id:rt,aplicar_taxa:qn?Xt[jt].aplicar_taxa??!0:!1}}return Xt})},children:[a.jsx(Vn,{className:"w-[140px] flex-shrink-0",children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsx(Wn,{children:v.map(rt=>a.jsx(lt,{value:String(rt.id),children:rt.nome||rt.tipo||"Outros"},rt.id))})]}),a.jsx("div",{className:"flex-1 min-w-0 isolate",children:(()=>{const rt=v.find(qn=>String(qn.id)===String(Gt.finalizadora_id)),Dt=Number(rt?.taxa_percentual||0);if(Dt<=0)return a.jsx("div",{className:"h-5"});const Xt=al(Gt.valor_cota),Tr=Xt>0;return a.jsxs("label",{className:`flex items-center gap-1.5 text-xs transition-colors ${Tr?"cursor-pointer hover:text-text-primary":"cursor-not-allowed opacity-50"}`,title:Tr?`Taxa de ${Dt.toFixed(2)}%`:"Informe o valor primeiro",children:[a.jsx("input",{type:"checkbox",checked:!!Gt.aplicar_taxa,disabled:!Tr,onChange:qn=>{if(!Tr){l({title:"Valor necessrio",description:"Informe o valor antes de aplicar a taxa.",variant:"destructive"});return}oe(Gr=>{const ar=[...Gr];if(jt>=0&&jt<ar.length){const kn=qn.target.checked;let Xn=Xt;kn?Xn=Xt*(1+Dt/100):Xn=Xt/(1+Dt/100),ar[jt]={...ar[jt],aplicar_taxa:kn,valor_cota:ui(Xn.toFixed(2))}}return ar})},className:`w-4 h-4 rounded border-2 border-amber-500 checked:bg-amber-500 checked:border-amber-500 focus:ring-2 focus:ring-amber-500 focus:ring-offset-1 ${Tr?"cursor-pointer":"cursor-not-allowed"}`,style:{accentColor:"#f59e0b"}}),a.jsxs("span",{className:"whitespace-nowrap text-amber-500 font-medium",children:["Taxa (",Dt.toFixed(2),"%)"]})]})})()})]}),(()=>{const rt=Gt.status_pagamento==="Pago",Dt=Number.isFinite(al(Gt.valor_cota))&&al(Gt.valor_cota)>0,Xt=rt&&Dt;return a.jsx("button",{type:"button",onClick:()=>rn(jt,Gt.status_pagamento,Gt.valor_cota),disabled:Xt,className:`inline-flex items-center justify-center w-[90px] px-3 py-1 rounded text-sm font-medium border transition-all ${rt&&Dt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 cursor-not-allowed":rt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 hover:bg-emerald-600/30 hover:border-emerald-600/60 cursor-pointer":"bg-amber-600/20 text-amber-400 border-amber-700/40 hover:bg-amber-600/30 hover:border-amber-600/60 cursor-pointer"}`,title:Xt?"No  possvel alterar (valor preenchido)":"Clique para alterar status",children:rt?"Pago":"Pendente"})})(),a.jsx(se,{type:"button",variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400",onClick:()=>{O(rt=>[...rt,jt])},children:"Remover"})]})]},pn)})})()})})]})]}),a.jsx(Na,{className:"gap-2",children:a.jsxs(se,{type:"button",variant:"ghost",className:"border border-white/10",onClick:async()=>{await gn("footer-close")},children:["Fechar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]})})]})})}),a.jsxs("div",{ref:jr,style:{position:"fixed",left:"0",top:"0",width:"900px",minHeight:"auto",padding:"30px",backgroundColor:"#ffffff !important",color:"#000000 !important",fontFamily:"Arial, sans-serif",opacity:"0",visibility:"hidden",zIndex:"-9999",pointerEvents:"none",overflow:"hidden"},children:[a.jsxs("div",{style:{marginBottom:"8px",paddingBottom:"6px",borderBottom:"2px solid #000",backgroundColor:"#fff",color:"#000"},children:[a.jsx("h1",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 6px 0",color:"#000",letterSpacing:"0.5px",textAlign:"center"},children:"RELATRIO DE PAGAMENTOS"}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"10px",color:"#000",fontWeight:"600"},children:[a.jsxs("div",{style:{display:"flex",gap:"20px",flex:1},children:[a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Data:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.start?new Date(h.start).toLocaleDateString("pt-BR"):"-"})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Quadra:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.court||"-"})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Cdigo:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.code?`#${h.code}`:"-"})]})]}),a.jsxs("div",{style:{display:"flex",gap:"30px",textAlign:"right"},children:[a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Total:"}),a.jsxs("strong",{style:{marginLeft:"4px",color:"#000",fontSize:"11px",display:"inline"},children:["R$ ",ui(m||0)]})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Diferena:"}),a.jsxs("strong",{style:{marginLeft:"4px",color:dt.diff<0?"#dc2626":"#16a34a",fontSize:"11px",display:"inline"},children:[dt.diff<0?"-":"","R$ ",ui(Math.abs(dt.diff).toFixed(2))]})]})]})]})]}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"8px",fontSize:"10px",backgroundColor:"#fff",fontFamily:"Arial, sans-serif",border:"1px solid #000",tableLayout:"fixed"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{backgroundColor:"#cccccc",borderBottom:"1px solid #000"},children:[a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"5%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"N"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"35%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Nome"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"10%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Cdigo"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"15%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Valor"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"20%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Forma"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"15%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Status"})]})}),a.jsx("tbody",{children:(()=>(ae||[]).filter((Wt,Ht)=>!(F||[]).includes(Ht)).map((Wt,Ht)=>{const mr=v?.find(Xt=>String(Xt.id)===String(Wt.finalizadora_id)),Gt=Wt.status_pagamento==="Pago",jt=s?.find(Xt=>Xt.id===Wt.cliente_id)?.is_consumidor_final,rt=(Wt.nome||"Sem nome").trim().split(/\s+/).slice(0,2).join(" "),Dt=jt?"0":Wt.codigo||"N/A";return a.jsxs("tr",{"data-participant-index":Ht,style:{backgroundColor:"#fff"},children:[a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word"},children:Ht+1}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"left",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word",overflow:"hidden"},children:rt}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",fontSize:"10px",fontWeight:"600",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:Dt}),a.jsxs("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word"},children:["R$ ",ui(Wt.valor_cota||0)]}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",fontSize:"10px",fontWeight:"600",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:mr?.nome||"N/D"}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:Gt?"#16a34a":"#ca8a04",fontSize:"10px",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:Gt?" Pago":" Pendente"})]},`participant-${Ht}-${Wt.cliente_id}`)}))()})]}),a.jsx("div",{style:{height:"2px",backgroundColor:"#fff"}}),a.jsxs("div",{style:{marginTop:"2px",textAlign:"center",fontSize:"10px",color:"#000",borderTop:"1px solid #000",paddingTop:"2px",display:"flex",justifyContent:"space-between",backgroundColor:"#fff"},children:[a.jsxs("div",{style:{color:"#000",fontWeight:"500"},children:["Gerado em: ",new Date().toLocaleString("pt-BR")]}),a.jsx("div",{id:"page-indicator",style:{fontSize:"10px",fontWeight:"bold",color:"#000"}})]})]}),a.jsx(In,{open:L,onOpenChange:Oe=>{if(!Oe){Ae([]),U("");try{_()}catch{}}W(Oe)},children:a.jsxs(En,{className:"sm:max-w-[500px]",onInteractOutside:Oe=>{Oe.preventDefault(),W(!1);try{_()}catch{}},children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Adicionar Participante"}),a.jsx(Hn,{children:"Selecione um cliente para adicionar aos pagamentos."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{ref:Cr,placeholder:"Buscar por cdigo ou nome...",value:z,onChange:Oe=>{U(Oe.target.value),$(0)},onKeyDown:Oe=>{const Wt=z.toLowerCase().trim(),Ht=(s||[]).filter(ur=>{if(!Wt)return!0;const rt=String(ur.codigo||""),Dt=(ur.nome||"").toLowerCase();return rt.includes(Wt)||Dt.includes(Wt)}),mr=Ht.find(ur=>ur?.is_consumidor_final===!0),pn=Ht.filter(ur=>ur?.is_consumidor_final!==!0).sort((ur,rt)=>{const Dt=ur.codigo||0,Xt=rt.codigo||0;return Dt-Xt}),jt=mr?[mr,...pn]:pn;if(Oe.key==="ArrowDown")Oe.preventDefault(),$(ur=>Math.min(ur+1,jt.length-1));else if(Oe.key==="ArrowUp")Oe.preventDefault(),$(ur=>Math.max(ur-1,0));else if(Oe.key==="Enter"&&jt[V]){Oe.preventDefault();const rt={...jt[V],timestamp:Date.now()};Ae(Dt=>[...Dt,rt])}},className:"pl-10 pr-10"}),z&&a.jsx("button",{type:"button",onClick:()=>U(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text",children:a.jsx(lc,{className:"h-4 w-4"})})]}),a.jsx(se,{type:"button",size:"sm",className:"bg-amber-500 hover:bg-amber-400 text-black shadow-md",onClick:()=>{o&&(w(15e3),o(()=>{W(!0)}),W(!1),U(""))},children:"+Novo"})]}),a.jsx("div",{ref:Qe,className:"border rounded-md max-h-[400px] overflow-y-auto",children:(()=>{const Oe=z.toLowerCase().trim(),Wt=(s||[]).filter(jt=>{if(!Oe)return!0;const ur=String(jt.codigo||""),rt=(jt.nome||"").toLowerCase();return ur.includes(Oe)||rt.includes(Oe)}),Ht=Wt.find(jt=>jt?.is_consumidor_final===!0),Gt=Wt.filter(jt=>jt?.is_consumidor_final!==!0).sort((jt,ur)=>{const rt=jt.codigo||0,Dt=ur.codigo||0;return rt-Dt}),pn=Ht?[Ht,...Gt]:Gt;return pn.length===0?a.jsx("div",{className:"p-8 text-center text-text-muted",children:"Nenhum cliente encontrado."}):pn.map((jt,ur)=>{const rt=jt?.is_consumidor_final===!0,Dt=ge.filter(Tr=>Tr.id===jt.id).length,Xt=ur===V;return a.jsxs("div",{ref:Tr=>{Me.current[ur]=Tr},role:"button",tabIndex:0,className:`w-full px-4 py-3 text-left transition-all border-b border-border last:border-0 flex items-center gap-3 cursor-pointer ${Xt?"ring-2 ring-blue-500 ring-inset z-10":""} ${rt?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":Dt>0?"bg-emerald-600/20 hover:bg-emerald-600/30":"hover:bg-surface-2"}`,onMouseEnter:()=>$(ur),onClick:Tr=>{Tr.preventDefault(),Tr.stopPropagation();const qn={...jt,timestamp:Date.now()};Ae(Gr=>[...Gr,qn])},onKeyDown:Tr=>{if(Tr.key==="Enter"||Tr.key===" "){Tr.preventDefault();const qn={...jt,timestamp:Date.now()};Ae(Gr=>[...Gr,qn])}},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[(()=>jt.codigo!==null&&jt.codigo!==void 0?a.jsxs("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors ${rt?"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20":"bg-emerald-600/20 text-emerald-400"}`,children:["#",jt.codigo]}):null)(),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:`font-medium ${rt?"text-amber-100/90":""}`,children:jt.nome}),rt&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),Dt>0&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-rose-600 hover:bg-rose-500 text-white text-base font-bold transition-colors",onClick:Tr=>{Tr.preventDefault(),Tr.stopPropagation(),Ae(qn=>{const Gr=qn.findIndex(ar=>ar.id===jt.id);if(Gr!==-1){const ar=[...qn];return ar.splice(Gr,1),ar}return qn})},children:"-"}),a.jsx("span",{className:"inline-flex items-center justify-center min-w-[32px] h-7 px-2 rounded-full bg-sky-600 text-white text-base font-bold",children:Dt}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-emerald-600 hover:bg-emerald-500 text-white text-base font-bold transition-colors",onClick:Tr=>{Tr.preventDefault(),Tr.stopPropagation();const qn={...jt,timestamp:Date.now()};Ae(Gr=>[...Gr,qn])},children:"+"})]})]},jt.id)})})()})]}),a.jsxs(Na,{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-text-muted",children:ge.length>0&&a.jsxs("span",{className:"font-medium",children:[ge.length," ",ge.length===1?"participante selecionado":"participantes selecionados"]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{type:"button",variant:"ghost",className:"border border-border",onClick:Oe=>{Oe.preventDefault(),Oe.stopPropagation(),w(1e3),W(!1),U(""),Ae([]);try{_()}catch{}},children:["Cancelar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]}),a.jsxs(se,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",disabled:ge.length===0,onClick:Oe=>{console.log("[AddParticipant] Boto Salvar clicado"),Oe.preventDefault(),Oe.stopPropagation(),console.log("[AddParticipant] Protegendo modal de pagamentos (3000ms)"),w(3e3),console.log("[AddParticipant] Adicionando participantes:",ge.length);const Wt=ge.map(Ht=>({cliente_id:Ht.id,nome:Ht.nome,codigo:Ht.codigo,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:(()=>{const mr=ct();return mr?.id?String(mr.id):null})(),aplicar_taxa:(()=>{const mr=ct();return Number(mr?.taxa_percentual||0)>0})()}));oe(Ht=>{const mr=Ht.length,Gt=Wt.map((pn,jt)=>mr+jt);return ve(Gt),setTimeout(()=>{ve([])},1e3),[...Ht,...Wt]}),console.log("[AddParticipant] Fechando modal de adicionar participante"),W(!1),U(""),Ae([]);try{_()}catch{}console.log("[AddParticipant] Concludo")},children:["Confirmar (",ge.length,")",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-emerald-700/50 rounded border border-emerald-500/30",children:""})]})]})]})]})}),a.jsx(In,{open:wt,onOpenChange:Oe=>{console.log(" [DownloadModal] onOpenChange chamado:",{open:Oe,downloadStatus:er}),!Oe&&er==="success"?(console.log(" [DownloadModal] Fechando modal de download (sucesso)"),gt(!1)):Oe||console.log(" [DownloadModal] BLOQUEADO: Ainda baixando")},children:a.jsxs(En,{className:"sm:max-w-md",onPointerDownOutside:Oe=>{er==="downloading"&&Oe.preventDefault()},onEscapeKeyDown:Oe=>{er==="downloading"&&Oe.preventDefault()},children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-center",children:er==="downloading"?"Gerando PDF...":"PDF Gerado com Sucesso!"}),a.jsx(Hn,{className:"sr-only",children:er==="downloading"?"Aguarde enquanto o relatrio de pagamentos est sendo gerado":"Relatrio de pagamentos gerado e baixado com sucesso"})]}),a.jsx("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:er==="downloading"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-green-500"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Gerando seu relatrio..."}),a.jsxs("div",{className:"w-full max-w-xs",children:[a.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[a.jsx("span",{children:"Progresso"}),a.jsxs("span",{children:[Pt,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:a.jsx("div",{className:"bg-green-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${Pt}%`}})})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"rounded-full bg-green-100 p-3",children:a.jsx("svg",{className:"w-12 h-12 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),a.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Relatrio baixado com sucesso!"}),a.jsx("p",{className:"text-xs text-gray-400 text-center",children:je})]})}),er==="success"&&a.jsxs("div",{className:"flex flex-col gap-2",children:[navigator.share&&navigator.canShare&&navigator.canShare({files:[]})&&a.jsxs(se,{onClick:async()=>{if(!gr){l({title:"Arquivo no disponvel",description:"Tente gerar o PDF novamente.",variant:"destructive"});return}try{console.log(" [PDF] Compartilhando via Web Share API...");const Oe=new File([gr],je,{type:"application/pdf"});await navigator.share({files:[Oe],title:"Relatrio de Pagamentos",text:"Confira o relatrio de pagamentos"}),console.log(" [PDF] Compartilhado com sucesso"),l({title:"Compartilhado com sucesso!",variant:"success"})}catch(Oe){if(Oe.name==="AbortError"){console.log(" [PDF] Compartilhamento cancelado");return}console.error(" [PDF] Erro ao compartilhar:",Oe),l({title:"Erro ao compartilhar",description:Oe.message,variant:"destructive"})}},className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Compartilhar"]}),a.jsxs(se,{onClick:()=>{$t?(console.log(" [PDF] Abrindo PDF em nova aba:",$t),window.open($t,"_blank")):(console.error(" [PDF] URL do blob no disponvel"),l({title:"Erro ao abrir PDF",description:"URL do PDF no est disponvel.",variant:"destructive"}))},className:"w-full bg-green-600 hover:bg-green-700",children:[a.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Abrir PDF"]}),a.jsx("p",{className:"text-xs text-center text-gray-500 px-2",children:"O PDF foi baixado. Abra-o para visualizar, imprimir ou compartilhar."}),a.jsx(se,{onClick:()=>gt(!1),variant:"ghost",className:"w-full",children:"Fechar"})]})]})}),a.jsx(In,{open:Jt.isOpen,onOpenChange:Oe=>{if(!Oe&&_r.current){console.log(" [StatusConfirmation] Bloqueado onOpenChange (protegido)");return}Oe||(console.log(" [StatusConfirmation] Fechando modal via onOpenChange"),kr({isOpen:!1,participantIndex:null,currentStatus:null}))},children:a.jsxs(En,{className:"w-[95vw] sm:max-w-[400px]",onInteractOutside:Oe=>{_r.current&&(console.log(" [StatusConfirmation] Bloqueado clique fora"),Oe.preventDefault())},onEscapeKeyDown:Oe=>{_r.current&&(console.log(" [StatusConfirmation] Bloqueado ESC"),Oe.preventDefault())},children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Alterar Status de Pagamento"}),a.jsx(Hn,{children:Jt.currentStatus==="Pago"?a.jsxs(a.Fragment,{children:["Tem certeza que deseja marcar este participante como ",a.jsx("strong",{children:"Pendente"}),"?"]}):a.jsxs(a.Fragment,{children:["Tem certeza que deseja marcar este participante como ",a.jsx("strong",{children:"Pago"})," mesmo sem valor registrado?"]})})]}),a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/30",children:a.jsx("p",{className:"text-sm text-amber-400",children:Jt.currentStatus==="Pago"?a.jsx(a.Fragment,{children:" Esta ao marcar o participante como pendente novamente para refazer o pagamento."}):a.jsx(a.Fragment,{children:" Esta ao marcar o participante como pago sem um valor especfico."})})})}),a.jsxs(Na,{className:"gap-2",children:[a.jsx(se,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>{kr({isOpen:!1,participantIndex:null,currentStatus:null})},children:"Cancelar"}),a.jsx(se,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:()=>Ke(Jt.currentStatus==="Pago"?"Pendente":"Pago"),children:"Confirmar"})]})]})})]})}function yZe({form:e,setForm:t,localCustomers:r}){Ss(),qs();const{isEditParticipantModalOpen:n,closeEditParticipantModal:s,editParticipantData:o,participantsForm:i,setParticipantsForm:l,payMethods:c,protectPaymentModal:d,onParticipantReplacedRef:u}=DN(),[f,h]=p.useState(""),[m,x]=p.useState(!1),[g,y]=p.useState(0),v=Ee.useRef(null),b=Ee.useRef([]),w=Ee.useRef(null),_=O=>{const I=o.participantId;if(i[I]?.cliente_id===O.id)return;console.log(" [EditParticipantModal] Substituindo participante:",{de:o.participantName,para:O.nome,indice:I,id_para:O.id});const T=i[I];if(l.updateLocal&&l.getLocal){const k=l.getLocal();if(I>=0&&I<k.length){const B={cliente_id:O.id,nome:O.nome,codigo:O.codigo,valor_cota:T?.valor_cota||"",status_pagamento:T?.status_pagamento||"Pendente",finalizadora_id:T?.finalizadora_id||(c[0]?.id?String(c[0].id):null),aplicar_taxa:T?.aplicar_taxa||!1},z=[...k];z[I]=B,l.updateLocal(z)}}else l(k=>{if(I<0||I>=k.length)return k;const B={cliente_id:O.id,nome:O.nome,codigo:O.codigo,valor_cota:T?.valor_cota||"",status_pagamento:T?.status_pagamento||"Pendente",finalizadora_id:T?.finalizadora_id||(c[0]?.id?String(c[0].id):null),aplicar_taxa:T?.aplicar_taxa||!1},z=[...k];return z[I]=B,z});d(3e3),s(),h(""),u?.current&&u.current(I)};if(p.useEffect(()=>{n&&(h(""),x(!1),y(0))},[n]),p.useEffect(()=>{n&&b.current[g]&&b.current[g]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[g,n]),!n)return null;const j=f.trim().toLowerCase(),S=(r||[]).filter(O=>j?String(O?.nome||"").toLowerCase().includes(j):!0),C=S.find(O=>O?.is_consumidor_final===!0),P=S.filter(O=>O?.is_consumidor_final!==!0).sort((O,I)=>{const T=Number(O?.codigo),k=Number(I?.codigo);return Number.isFinite(T)&&Number.isFinite(k)?T-k:String(O?.nome||"").localeCompare(String(I?.nome||""))}),F=C?[C,...P]:P;return a.jsx(In,{open:n,onOpenChange:O=>{console.log("[EditParticipantModal] onOpenChange:",O),O||(console.log("[EditParticipantModal] Protegendo modal de pagamentos"),d(2e3),s(),h(""))},modal:!0,children:a.jsxs(En,{className:"sm:max-w-[500px]",onPointerDownOutside:O=>{console.log(" [EditParticipantModal] onPointerDownOutside - prevenindo"),O.preventDefault(),O.stopPropagation()},onInteractOutside:O=>{console.log(" [EditParticipantModal] onInteractOutside - prevenindo"),O.preventDefault(),O.stopPropagation(),d(2e3)},children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Trocar Participante"}),a.jsxs(Hn,{children:["Substituindo: ",a.jsx("strong",{children:o.participantName})]})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"edit-participant-search",children:"Buscar cliente"}),a.jsx(Ct,{ref:v,id:"edit-participant-search",type:"text",placeholder:"Digite o nome do cliente...",value:f,onChange:O=>{h(O.target.value),y(0)},onKeyDown:O=>{if(O.key==="ArrowDown")O.preventDefault(),y(I=>Math.min(I+1,F.length-1));else if(O.key==="ArrowUp")O.preventDefault(),y(I=>Math.max(I-1,0));else if(O.key==="Enter"&&F[g]){O.preventDefault();const I=F[g],T=o.participantId;i[T]?.cliente_id===I.id||(d(2e3),_(I))}},className:"mt-1",autoFocus:!0})]}),a.jsx("div",{ref:w,className:"border border-border rounded-md max-h-[300px] overflow-y-auto",children:m?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:"Carregando clientes..."}):F.length===0?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:j?"Nenhum cliente encontrado":"Nenhum cliente cadastrado"}):F.map((O,I)=>{const T=o.participantId,k=i[T]?.cliente_id===O.id,B=O?.is_consumidor_final===!0,z=I===g;return a.jsxs("button",{ref:U=>{b.current[I]=U},type:"button",className:Sr(z&&"ring-2 ring-blue-500 ring-inset z-10","w-full px-4 py-3 text-left transition-all","border-b border-border last:border-b-0","flex items-center gap-3",k&&"bg-brand/10 cursor-not-allowed opacity-60",!k&&B&&"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40",!k&&!B&&"hover:bg-surface-2"),disabled:k,onMouseEnter:()=>y(I),onClick:U=>{U.preventDefault(),U.stopPropagation(),console.log("[EditParticipantModal] Cliente selecionado - protegendo modal"),d(2e3),_(O)},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[O.codigo!==null&&O.codigo!==void 0&&a.jsxs("span",{className:Sr("inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors",B&&"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20",!B&&"bg-emerald-600/20 text-emerald-400"),children:["#",O.codigo]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:Sr("font-medium",B&&"text-amber-100/90"),children:O.nome}),B&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),k&&a.jsx("span",{className:"text-xs text-brand font-medium",children:"Atual"})]},O.id)})})]}),a.jsx(Na,{children:a.jsx(se,{type:"button",variant:"ghost",className:"border border-white/10",onClick:O=>{console.log(" [EditParticipantModal] ========== BOTO CANCELAR CLICADO =========="),console.log(" [EditParticipantModal] preventDefault()"),O.preventDefault(),console.log(" [EditParticipantModal] stopPropagation()"),O.stopPropagation(),console.log(" [EditParticipantModal] Protegendo modal de pagamentos (2000ms)"),d(2e3),console.log(" [EditParticipantModal] Fechando modal de editar participante"),s(),console.log(" [EditParticipantModal] Limpando busca"),h(""),console.log(" [EditParticipantModal] ========== CANCELAR CONCLUDO ==========")},children:"Cancelar"})})]})})}const bZe=e=>e?e.trim().split(/\s+/).slice(0,2).join(" "):"",th=56,pk=30,wZe=6,_Ze=24;function jZe({weekStart:e,weekBookings:t,activeCourtFilter:r,courtsMap:n,participantsByAgendamento:s,onBookingClick:o,onSlotClick:i,statusConfig:l,dayStartHour:c=wZe,dayEndHourExclusive:d=_Ze,weekDiasFuncionamento:u={},sidebarVisible:f=!1}){const h=p.useRef(null),m=p.useRef(null),[x,g]=Ee.useState(0),[y,v]=Ee.useState(window.innerWidth<768);Ee.useEffect(()=>{const A=()=>{v(window.innerWidth<768)};return window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]);const b=p.useMemo(()=>Array.from({length:7},(A,P)=>rs(e,P)),[e]);p.useEffect(()=>{const A=()=>{m.current&&h.current&&(h.current.scrollLeft=m.current.scrollLeft)},P=()=>{h.current&&m.current&&(m.current.scrollLeft=h.current.scrollLeft)},F=()=>{if(m.current){const T=m.current.scrollHeight>m.current.clientHeight;g(T?17:0)}},O=m.current,I=h.current;return O&&O.addEventListener("scroll",A),I&&I.addEventListener("scroll",P),F(),window.addEventListener("resize",F),()=>{O&&O.removeEventListener("scroll",A),I&&I.removeEventListener("scroll",P),window.removeEventListener("resize",F)}},[]);const w=p.useMemo(()=>{if(r&&n[r]){const A=n[r],P=A.hora_inicio||`${c}:00:00`,F=A.hora_fim||`${d}:00:00`,[O]=String(P).split(":").map(Number),[I,T]=String(F).split(":").map(Number);let k=I===0&&T===0?24:I;return T>0&&k<24&&(k+=1),{start:O||c,end:k||d}}return{start:c,end:d}},[r,n,c,d]),_=p.useMemo(()=>Array.from({length:Math.max(0,w.end-w.start)},(A,P)=>w.start+P),[w]),j=p.useMemo(()=>Math.max(0,w.end-w.start)*(60/pk)*th,[w]),S=p.useMemo(()=>{const A={};return b.forEach(P=>{A[sr(P,"yyyy-MM-dd")]=[]}),t.forEach(P=>{const F=sr(so(P.start),"yyyy-MM-dd");A[F]&&A[F].push(P)}),A},[b,t]),C=(A,P)=>{const F=A.start.getHours()*60+A.start.getMinutes(),I=A.end.getHours()*60+A.end.getMinutes()-F,T=w.start*60,k=(F-T)/pk*th,B=I/pk*th,U=l[A.status]||{hex:"#888",text:"text-gray-400",label:"Unknown",icon:null},L=U.icon,W=40,ge=Math.max(W,B-4),Ae=Math.min(1.3,ge/55),V=Math.max(11,Math.round(13*Ae)),$=Math.max(10,Math.round(11*Ae)),Y=Math.max(9,Math.round(10*Ae)),he=Math.max(14,Math.round(16*Ae)),J=P?.[A.id]||[],G=J.filter(ae=>String(ae.status_pagamento||"").toLowerCase()==="pago").length,ue=J.length,ve=I===30;return a.jsx("div",{id:`booking-${A.id}`,className:"absolute left-0.5 right-0.5 rounded-md border-2 bg-surface cursor-pointer transition-all hover:bg-surface-2 hover:shadow-md overflow-hidden",style:{top:`${k}px`,height:`${Math.max(W,B)}px`,borderColor:U.hex||"#888",borderLeftWidth:"3px",zIndex:5},onClick:()=>o(A),children:a.jsxs("div",{className:"h-full flex flex-col justify-center px-2 py-1",children:[a.jsx("div",{className:"flex items-center gap-1.5 mb-0.5",children:a.jsx("p",{className:"font-semibold truncate",style:{fontSize:`${V}px`,lineHeight:1.1,color:"#e2e8f0"},children:bZe(A.customer)})}),ve&&(A.modality||ue>0)&&a.jsxs("div",{className:"flex items-center gap-1 w-full justify-between",style:{lineHeight:1},children:[A.modality&&a.jsx("span",{className:"text-xs font-bold text-white bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded px-1.5 py-0.5 whitespace-nowrap shadow-sm flex-shrink-0",style:{fontSize:Math.max(7,Y-1)},children:A.modality}),ue>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-1.5 py-0.5 border flex items-center gap-0.5 whitespace-nowrap flex-shrink-0 ${G===ue?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(8,Y-1)},children:[a.jsx(Oi,{style:{width:Math.max(10,Y-1),height:Math.max(10,Y-1)}}),a.jsxs("span",{children:[G,"/",ue]})]})]}),ve&&a.jsxs("div",{className:"flex items-center gap-1.5 justify-between",children:[a.jsxs("span",{className:"font-semibold whitespace-nowrap",style:{fontSize:`${$}px`,color:"#999",lineHeight:1},children:[sr(A.start,"HH:mm"),"",sr(A.end,"HH:mm")]}),L&&a.jsxs("div",{className:"flex items-center gap-0.5",children:[!f&&!y&&a.jsx(L,{style:{width:Math.max(12,he-2),height:Math.max(12,he-2),color:U.hex}}),a.jsx("span",{className:"truncate font-semibold",style:{fontSize:`${$}px`,color:U.hex,lineHeight:1},children:U.label})]})]}),!ve&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"truncate",style:{fontSize:`${$}px`,color:"#999",lineHeight:1,marginBottom:"2px"},children:[sr(A.start,"HH:mm"),"",sr(A.end,"HH:mm")]}),A.modality&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded px-1.5 py-0.5 whitespace-nowrap shadow-sm mb-0.5",style:{fontSize:Math.max(7,Y-1),display:"inline-block",width:"fit-content"},children:A.modality}),a.jsxs("div",{className:"flex items-center gap-1 w-full justify-between",children:[L&&a.jsxs("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[!f&&!y&&a.jsx(L,{style:{width:he,height:he,color:U.hex}}),a.jsx("span",{className:"truncate font-semibold",style:{fontSize:`${Y}px`,color:U.hex,lineHeight:1},children:A.status==="in_progress"?"Andamento":U.label})]}),ue>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-1.5 py-0.5 border flex items-center gap-0.5 whitespace-nowrap flex-shrink-0 ${G===ue?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(8,Y-1)},children:[a.jsx(Oi,{style:{width:Math.max(12,Y),height:Math.max(12,Y)}}),a.jsxs("span",{children:[G,"/",ue]})]})]})]})]})},A.id)};return a.jsxs("div",{className:"flex-1 bg-surface rounded-lg border border-border flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"flex sticky top-0 z-20 bg-surface border-b border-border",children:[a.jsx("div",{className:"w-20 flex-shrink-0 flex items-center justify-center font-semibold text-sm border-r border-border bg-surface",children:"Horrios"}),a.jsxs("div",{ref:h,"data-header-scroll":!0,className:"flex flex-1 overflow-auto",style:{scrollbarWidth:"none",msOverflowStyle:"none",paddingRight:`${x}px`,minWidth:0},children:[a.jsx("style",{children:`
            [data-header-scroll]::-webkit-scrollbar {
              display: none;
            }
          `}),b.map(A=>a.jsxs("div",{className:"flex-1 basis-[140px] min-w-[140px] flex flex-col items-center justify-center py-3 border-r border-border bg-surface-2/50 text-center",children:[a.jsx("div",{className:"text-xs font-semibold text-text-muted",children:sr(A,"EEE",{locale:ga}).toUpperCase()}),a.jsx("div",{className:"text-sm font-bold text-text-primary",children:sr(A,"dd")})]},sr(A,"yyyy-MM-dd")))]})]}),a.jsxs("div",{ref:m,className:"flex flex-1 overflow-auto",style:{minWidth:0},children:[a.jsxs("div",{className:"w-20 flex-shrink-0 bg-surface sticky left-0 z-10 flex flex-col relative",style:{borderRight:"1px solid var(--color-border)",minHeight:`${j}px`},children:[_.map(A=>a.jsxs(Ee.Fragment,{children:[a.jsx("div",{className:Sr("relative border-b border-border/60",A%2===1&&"bg-surface-2/30"),style:{height:th},children:a.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded px-1 text-sm font-bold whitespace-nowrap",children:[String(A).padStart(2,"0"),":00"]})}),a.jsx("div",{className:Sr("relative border-b border-border/60",A%2===1&&"bg-surface-2/30"),style:{height:th},children:a.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded px-1 text-sm font-bold whitespace-nowrap",children:[String(A).padStart(2,"0"),":30"]})})]},`time-${A}`)),a.jsx("div",{className:"absolute right-0 top-0 w-px bg-border pointer-events-none",style:{height:`${j}px`}})]}),b.map(A=>{const P=sr(A,"yyyy-MM-dd"),F=S[P]||[],O=u[P]||{},I=r&&O[r]&&!O[r].funciona;return a.jsxs("div",{className:"flex-1 basis-[140px] min-w-[140px] relative border-r border-border bg-surface-2/10",style:{minHeight:`${j}px`},children:[_.map(T=>a.jsx("div",{className:Sr("border-b border-border/60",T%2===1&&"bg-surface-2/5"),style:{height:th*2},children:I?a.jsx("div",{className:"w-full h-full cursor-not-allowed bg-surface/60 flex items-center justify-center border-b border-border/60 transition-colors",onClick:k=>k.preventDefault(),children:a.jsxs("div",{className:"text-center pointer-events-none",children:[a.jsx(X4,{className:"h-5 w-5 text-text-primary mx-auto mb-1"}),a.jsx("div",{className:"text-xs font-medium text-text-primary mb-1",children:"Fechada"}),O[r]?.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:O[r].observacao})]})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"relative border-b border-border/60 transition-colors flex items-center justify-center cursor-pointer hover:bg-white/5",style:{height:th},onClick:()=>{const k=new Date(A.getTime());k.setHours(T,0,0,0),console.log("Slot :00 clicked",{day:A,hour:T,slotDate:k,activeCourtFilter:r}),i?.(k,r)}}),a.jsx("div",{className:"relative border-b border-border/60 transition-colors flex items-center justify-center cursor-pointer hover:bg-white/5",style:{height:th},onClick:()=>{const k=new Date(A.getTime());k.setHours(T,30,0,0),console.log("Slot :30 clicked",{day:A,hour:T,slotDate:k,activeCourtFilter:r}),i?.(k,r)}})]})},`${P}-${T}`)),F.map(T=>C(T,s))]},P)})]})]})}const es=30,qp=e=>{const t=String(e??"").replace(/\D/g,"");if(!t)return"";const r=(Number(t)/100).toFixed(2),[n,s]=r.split(".");return`${n.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${s}`},Jf=e=>{if(e==null||e==="")return NaN;const t=String(e).replace(/\./g,"").replace(",","."),r=parseFloat(t);return Number.isFinite(r)?r:NaN};function bU(e){const t=String(e||"").trim().split(/\s+/).filter(Boolean);return t.length===0?"":t.length===1?t[0]:`${t[0]} ${t[1]}`}const sl=56,NZe=6,ZS=6,I3=24;Array.from({length:(I3-ZS)*(60/es)},(e,t)=>{const r=ZS*60+t*es,n=Math.floor(r/60),s=r%60;return{time:`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}`,isHourMark:s===0}});const zp=["Futebol","Beach Tennis","Futevlei","Treino"];function lh(e){return ou(e,{weekStartsOn:1})}function SZe(e){const t=lh(e),r=rs(t,6);return t.getMonth()===r.getMonth()?`${sr(t,"dd")}-${sr(r,"dd")} de ${sr(r,"MMMM",{locale:ga})} de ${sr(r,"yyyy")}`:`${sr(t,"dd")} de ${sr(t,"MMMM",{locale:ga})} - ${sr(r,"dd")} de ${sr(r,"MMMM",{locale:ga})} de ${sr(r,"yyyy")}`}const $i={scheduled:{label:"Agendado",accent:"bg-[#3B82F6]",text:"text-[#3B82F6]",border:"border-[#3B82F6]",hex:"#3B82F6",icon:lo},confirmed:{label:"Confirmado",accent:"bg-[#22C55E]",text:"text-[#22C55E]",border:"border-[#22C55E]",hex:"#22C55E",icon:vi},in_progress:{label:"Em andamento",accent:"bg-[#FACC15]",text:"text-[#FACC15]",border:"border-[#FACC15]",hex:"#FACC15",icon:_G},finished:{label:"Finalizado",accent:"bg-[#6B7280]",text:"text-[#6B7280]",border:"border-[#6B7280]",hex:"#6B7280",icon:Rue},canceled:{label:"Cancelado",accent:"bg-[#EF4444]",text:"text-[#EF4444]",border:"border-[#EF4444]",hex:"#EF4444",icon:Sg},absent:{label:"Ausente",accent:"bg-[#F97316]",text:"text-[#F97316]",border:"border-[#F97316]",hex:"#F97316",icon:SG}},CZe={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},wU={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},_U=e=>{let t=Math.floor(e/60);const r=e%60;return t>=24&&(t=t%24),`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}`};function AZe({sidebarVisible:e=!1}){const{toast:t}=Ss(),{loadAlerts:r}=t2(),n=wi(),{isPaymentModalOpen:s,openPaymentModal:o,closePaymentModal:i,isEditParticipantModalOpen:l,openEditParticipantModal:c,closeEditParticipantModal:d,editParticipantData:u,editingBooking:f,setEditingBooking:h,participantsForm:m,setParticipantsForm:x,paymentTotal:g,setPaymentTotal:y,payMethods:v,setPayMethods:b}=DN(),w=p.useMemo(()=>{try{return typeof window<"u"&&localStorage.getItem("debug:agenda")==="1"}catch{return!1}},[]),_=p.useCallback((...M)=>{if(w)try{console.log("[AgendaDbg]",...M)}catch{}},[w]);p.useEffect(()=>{try{Te.current=Date.now()+2500,_("runAutomation:startup grace set",{until:Te.current}),setTimeout(()=>{try{ln()}catch{}},2500+200)}catch{}const M=console.log,H=console.info,le=console.debug,X=console.warn,Ce=console.error,we=Z=>{const ye=String(Z||"");return ye.startsWith("[AgendaDbg]")||!1||ye.startsWith("[PulseDump]")||ye.startsWith("[Clientes:load]")||ye.startsWith("[AgendaSettings]")||ye.startsWith("[Auto]")||ye.startsWith("[DEBUG-PaymentModal]")||ye.startsWith(" EditGuard")};return console.log=(...Z)=>{try{if(we(Z[0]))return}catch{}return M(...Z)},console.info=(...Z)=>{try{if(we(Z[0]))return}catch{}return H(...Z)},console.debug=(...Z)=>{try{if(we(Z[0]))return}catch{}return le(...Z)},console.warn=(...Z)=>{try{if(we(Z[0]))return}catch{}return X(...Z)},console.error=(...Z)=>{try{if(we(Z[0]))return}catch{}return Ce(...Z)},()=>{console.log=M,console.info=H,console.debug=le,console.warn=X,console.error=Ce}},[]);const j=p.useRef({active:!1,tag:"",start:0,timer:null,events:[]}),S=p.useCallback((M,H)=>{if(w)try{const le=Date.now(),X=j.current&&j.current.active?le-(j.current.start||le):0;j.current.events.push({t:le,ms:X,event:M,data:H})}catch{}},[w]),C=p.useCallback(M=>{if(w){try{if(!j.current.active)return;const{tag:H,start:le,events:X}=j.current,Ce=`[PulseDump] tag=${H} dur=${Date.now()-le}ms reason=${M}`;console.groupCollapsed(Ce);for(const we of X)console.log(` +${String(we.ms).padStart(4," ")}ms`,we.event,we.data||{});console.groupEnd()}catch{}try{j.current.timer&&clearTimeout(j.current.timer)}catch{}j.current={active:!1,tag:"",start:0,timer:null,events:[]}}},[w]),A=p.useCallback((M,H=5e3)=>{if(w){try{j.current.timer&&clearTimeout(j.current.timer)}catch{}j.current={active:!0,tag:M,start:Date.now(),timer:null,events:[]},j.current.timer=setTimeout(()=>C("timeout"),H),_("PulseStart",{tag:M,timeoutMs:H})}},[w,C,_]),{userProfile:P,authReady:F,company:O}=qs(),[I,T]=DC(),[k,B]=p.useState(new Date),[z,U]=p.useState("day"),[L,W]=p.useState(!1),[ge,Ae]=p.useState({}),[V,$]=p.useState(!1),[Y,he]=p.useState({}),[J,G]=p.useState("");p.useEffect(()=>{let M=!1;return(async()=>{try{if(!F||!O?.id)return;const{data:H,error:le}=await re.from("agenda_settings").select("isis_subdomain").eq("empresa_id",O.id).single();if(M||le&&le.code!=="PGRST116")return;const X=(H?.isis_subdomain||"").toLowerCase().replace(/[^a-z0-9]+/g,"").trim();G(X)}catch{}})(),()=>{M=!0}},[F,O?.id]);const ue=p.useMemo(()=>{const M=O?.nome_fantasia||O?.nome||O?.razao_social||O?.codigoEmpresa||"";return String(M).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"").trim()},[O?.nome_fantasia,O?.nome,O?.razao_social,O?.codigoEmpresa]),ve=p.useMemo(()=>{const M=J||ue;return M?`https://${M}.f7arena.com`:""},[J,ue]),ae=p.useCallback(async M=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(M);else{const H=document.createElement("textarea");H.value=M,H.style.position="fixed",H.style.top="0",H.style.left="0",H.style.opacity="0",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}return!0}catch{return!1}},[]),[oe,me]=p.useState(!1),[De,ne]=p.useState(!1),[ie,ht]=p.useState(""),pt=p.useRef(null),[Ze,vt]=p.useState(!1),[wt,gt]=p.useState(new Date),er=p.useRef(!1),_e=p.useRef(""),Pt=p.useRef(null),Lt=p.useRef([]),gr=p.useRef({}),fr=p.useRef([]),je=p.useRef(ZS),nt=p.useRef(I3),$t=p.useRef(new Date);p.useEffect(()=>{try{oe||gt(k||new Date)}catch{}},[k,oe]),p.useEffect(()=>{try{$t.current=wt||new Date}catch{}},[wt]);const Ut=p.useCallback(()=>{try{return Pt.current||Lt.current?.[0]||""}catch{return""}},[]),Fe=p.useCallback((M=null)=>{try{const H=Ut();if(!H)return[];const le=gr.current||{},X=fr.current||[],Ce=je.current,we=nt.current,Z=M||wt||new Date,ye=(()=>{const xn=le?.[H]?.hora_inicio;if(!xn)return Ce*60;const[$n,_n]=String(xn).split(":").map(Number);return $n*60+(_n||0)})(),Ne=(()=>{const xn=le?.[H]?.hora_fim;if(!xn)return we*60;const[$n,_n]=String(xn).split(":").map(Number);return($n===0&&_n===0?24:$n)*60+(_n||0)})(),Re=xn=>{const $n=kd(xn),_n=Id(xn);return $n===0&&_n===0?1440:$n*60+_n},bt=sr(Z,"yyyy-MM-dd"),Rt=le?.[H]?.id,dr=(X||[]).filter(xn=>{const $n=xn.court===H,_n=Rt!=null&&String(xn.court_id||"")===String(Rt);return($n||_n)&&sr(xn.start,"yyyy-MM-dd")===bt&&xn.status!=="canceled"}).map(xn=>[Re(xn.start),Re(xn.end)]).sort((xn,$n)=>xn[0]-$n[0]),qt=[];let rr=ye;for(const[xn,$n]of dr)xn>rr&&qt.push([rr,xn]),rr=Math.max(rr,$n);rr<Ne&&qt.push([rr,Ne]);const qr=new Date,Dn=sr(qr,"yyyy-MM-dd");let $r=0;if(Dn===bt){const xn=kd(qr),$n=Id(qr),_n=xn*60+$n,un=es||30;$r=Math.ceil(_n/un)*un}else if(qr>Z)return[];return $r<=ye?qt:$r>=Ne?[]:qt.map(([xn,$n])=>[Math.max(xn,$r),$n]).filter(([xn,$n])=>$n>xn).filter(([xn,$n])=>$n-xn>=60)}catch{return[]}},[Ut,wt]),xt=p.useMemo(()=>{const M=ve||"",H=wt||new Date,le=sr(H,"EEEE",{locale:ga}).replace(/-feira\b/gi,"").trim(),X=le?`${le.charAt(0).toUpperCase()}${le.slice(1)}`:"",Ce=`${X}${X?", ":""}${sr(H,"dd/MM",{locale:ga})}`,we=Re=>{let bt=Math.floor(Re/60),Rt=Re%60;return bt>=24&&(bt=bt%24),`${String(bt).padStart(2,"0")}:${String(Rt).padStart(2,"0")}`},ye=(Fe(H)||[]).map(([Re,bt])=>`${we(Re)}${we(bt)}`);if(ye.length===0)return`No momento no temos horrios disponveis para ${Ce}.
Confira novamente mais tarde e agende pelo link abaixo 

${M}`.trim();const Ne=ye.join(`
`);return`Horrios disponveis (${Ce}):
${Ne}

Agende pelo link abaixo 

${M}`.trim()},[ve,wt,Fe]),Ot=p.useCallback(async()=>{if(ve){ht("");try{pt.current=null}catch{}try{gt(k||new Date)}catch{}me(!0)}},[ve,k]),Cr=p.useCallback(()=>{me(!1)},[]);p.useEffect(()=>{oe||vt(!1)},[oe]);const Me=p.useCallback(M=>new Promise((H,le)=>{try{if(!M)return H(null);const X=new Image;X.crossOrigin="anonymous",X.onload=()=>H(X),X.onerror=()=>H(null),X.src=M}catch{H(null)}}),[]),Qe=p.useCallback(async M=>await(await fetch(M)).blob(),[]),et=p.useCallback(async()=>{const le=document.createElement("canvas");le.width=1080,le.height=1680;const X=le.getContext("2d");if(!X)throw new Error("Canvas indisponvel");const Ce=X.createLinearGradient(0,0,1080,1680);Ce.addColorStop(0,"#07070A"),Ce.addColorStop(1,"#0B0B10"),X.fillStyle=Ce,X.fillRect(0,0,1080,1680);try{X.save(),X.globalAlpha=.55;const oa=X.createRadialGradient(Math.round(1080*.55),Math.round(1680*.22),40,Math.round(1080*.55),Math.round(1680*.22),760);oa.addColorStop(0,"rgba(249,115,22,0.55)"),oa.addColorStop(1,"rgba(249,115,22,0)"),X.fillStyle=oa,X.fillRect(0,0,1080,1680),X.restore()}catch{}const we=O?.logo_url||"",Z=await Me(we),ye=1080/2;let Ne=220;if(Z){const No=Math.min(640/Z.width,260/Z.height),el=Math.round(Z.width*No),Ds=Math.round(Z.height*No),ho=Math.round(ye-el/2),bs=130;X.save(),X.globalAlpha=.98,X.drawImage(Z,ho,bs,el,Ds),X.restore(),Ne=bs+Ds}else X.save(),X.globalAlpha=.2,X.fillStyle="white",X.fillRect(Math.round(1080*.22),190,Math.round(1080*.56),10),X.restore(),Ne=230;const Re=(O?.nome_fantasia||O?.nome||O?.razao_social||"").toString().trim();X.textAlign="center",X.textBaseline="top",Re&&(X.fillStyle="#E0E0E0",X.font="600 40px system-ui, -apple-system, Segoe UI, Roboto, Arial",X.fillText(Re,ye,Ne+28),Ne+=28+44);const bt="Horrios disponveis",Rt=$t.current||new Date,dr=sr(Rt,"EEEE",{locale:ga}).replace(/-feira\b/gi,"").trim(),qt=dr?`${dr.charAt(0).toUpperCase()}${dr.slice(1)}`:"",rr=`${qt}${qt?"  ":""}${sr(Rt,"dd/MM",{locale:ga})}`;X.textAlign="center",X.textBaseline="top";const qr=Ne+40;X.fillStyle="#F8F8F8",X.font="bold 72px system-ui, -apple-system, Segoe UI, Roboto, Arial",X.fillText(bt,ye,qr);const xn=X.measureText(bt).width*.5,$n=qr+72+10,_n=ye-xn/2;X.save(),X.fillStyle="#F5A623",X.fillRect(_n,$n,xn,2),X.restore();const un=$n+22;X.font="700 52px system-ui, -apple-system, Segoe UI, Roboto, Arial",X.fillStyle="#F5A623",X.fillText(rr,ye,un);const Ca=X.measureText(rr).width,Zn=24,Mn=un+56,Yr=ye-Ca/2-Zn/2,Sn=Ca+Zn;X.save();const Da=X.createLinearGradient(Yr,Mn,Yr+Sn,Mn);Da.addColorStop(0,"rgba(249,115,22,0.0)"),Da.addColorStop(.5,"rgba(249,115,22,0.9)"),Da.addColorStop(1,"rgba(249,115,22,0.0)"),X.strokeStyle=Da,X.lineWidth=4,X.beginPath(),X.moveTo(Yr,Mn),X.lineTo(Yr+Sn,Mn),X.stroke(),X.restore();const Ha=Fe(),Xs=120,jo=700,jn=1080-240,Pn=720;X.save(),X.fillStyle="rgba(0,0,0,0.38)",X.strokeStyle="rgba(255,255,255,0.10)",X.lineWidth=2,((oa,is,No,el,Ds)=>{X.beginPath(),X.moveTo(oa+Ds,is),X.lineTo(oa+No-Ds,is),X.quadraticCurveTo(oa+No,is,oa+No,is+Ds),X.lineTo(oa+No,is+el-Ds),X.quadraticCurveTo(oa+No,is+el,oa+No-Ds,is+el),X.lineTo(oa+Ds,is+el),X.quadraticCurveTo(oa,is+el,oa,is+el-Ds),X.lineTo(oa,is+Ds),X.quadraticCurveTo(oa,is,oa+Ds,is),X.closePath()})(Xs,jo,jn,Pn,28),X.fill(),X.stroke();const Ga=oa=>{let is=Math.floor(oa/60),No=oa%60;return is>=24&&(is=is%24),`${String(is).padStart(2,"0")}:${String(No).padStart(2,"0")}`},hs=(Ha||[]).map(([oa,is])=>`${Ga(oa)}${Ga(is)}`),to=10,Ts=hs.slice(0,to),Ys=hs.length-Ts.length;X.fillStyle="#FFFFFF",X.font="700 54px system-ui, -apple-system, Segoe UI, Roboto, Arial",X.shadowColor="rgba(0,0,0,0.6)",X.shadowBlur=12,X.shadowOffsetX=0,X.shadowOffsetY=4;let Bo=jo+96;const mo=80;if(Ts.length===0)X.fillText("Sem horrios disponveis",1080/2,Bo);else if(hs.length===1)X.fillStyle="#FFFFFF",X.font="800 76px system-ui, -apple-system, Segoe UI, Roboto, Arial",X.fillText(hs[0],1080/2,Bo+12);else{for(const oa of Ts)X.fillText(oa,1080/2,Bo),Bo+=mo;Ys>0&&(X.fillStyle="rgba(255,255,255,0.80)",X.font="600 34px system-ui, -apple-system, Segoe UI, Roboto, Arial",X.fillText(`+${Ys} intervalos`,1080/2,Bo+10))}X.restore();try{const oa=(ve||"").replace(/^https?:\/\//,"").trim();if(oa){X.save(),X.textAlign="center",X.textBaseline="middle",X.font="700 32px system-ui, -apple-system, Segoe UI, Roboto, Arial";const Ds=X.measureText(oa).width,ho=Math.min(1080-200,Math.max(520,Ds+30*2)),bs=(1080-ho)/2;X.fillStyle="rgba(0,0,0,0.55)",X.strokeStyle="rgba(245,166,35,0.55)",X.lineWidth=2;const Oo=24;X.beginPath(),X.moveTo(bs+Oo,1560),X.lineTo(bs+ho-Oo,1560),X.quadraticCurveTo(bs+ho,1560,bs+ho,1560+Oo),X.lineTo(bs+ho,1560+64-Oo),X.quadraticCurveTo(bs+ho,1560+64,bs+ho-Oo,1560+64),X.lineTo(bs+Oo,1560+64),X.quadraticCurveTo(bs,1560+64,bs,1560+64-Oo),X.lineTo(bs,1560+Oo),X.quadraticCurveTo(bs,1560,bs+Oo,1560),X.closePath(),X.fill(),X.stroke(),X.fillStyle="#F5A623",X.shadowColor="rgba(0,0,0,0.55)",X.shadowBlur=10,X.shadowOffsetX=0,X.shadowOffsetY=4,X.fillText(oa,1080/2,1560+64/2),X.restore()}}catch{}return le.toDataURL("image/png")},[O?.logo_url,Me,Ut,Fe,ve]);p.useEffect(()=>{er.current=!!De},[De]),p.useEffect(()=>{_e.current=ie||""},[ie]);const Yt=p.useCallback(async()=>{if(!er.current){if(_e.current)return _e.current;er.current=!0,ne(!0);try{const M=await et();_e.current=M,ht(M);try{pt.current=await Qe(M)}catch{pt.current=null}return M}finally{er.current=!1,ne(!1)}}},[et,Qe]);p.useEffect(()=>{if(oe){try{pt.current=null}catch{}ht("");try{_e.current=""}catch{}try{er.current=!1}catch{}Yt()}},[wt,oe,Yt]),p.useEffect(()=>{oe&&Yt()},[oe,Yt]);const xr=p.useCallback(async()=>{const H=await(async le=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(le);else{const X=document.createElement("textarea");X.value=le,X.style.position="fixed",X.style.top="0",X.style.left="0",X.style.opacity="0",document.body.appendChild(X),X.focus(),X.select(),document.execCommand("copy"),document.body.removeChild(X)}return!0}catch{return!1}})(xt);t({title:H?"Legenda copiada":"No foi possvel copiar",description:H?"Cole no story/status.":"Tente novamente.",variant:H?"success":"destructive"})},[xt,t]),Jt=p.useCallback(async()=>{const M=await ae(ve),H=(ve||"").replace(/^https?:\/\//,"");t({title:M?"Link copiado":"No foi possvel copiar",description:H,variant:M?"success":"destructive"})},[ae,ve,t]),kr=p.useCallback(async()=>{try{const M=ie||await et(),H=document.createElement("a");H.href=M;const X=sr(new Date,"yyyy-MM-dd-HH-mm");H.download=`horarios-${X}.png`,document.body.appendChild(H),H.click(),document.body.removeChild(H),t({title:"Imagem baixada",description:"Agora  s postar no story/status.",variant:"success"})}catch{t({title:"Erro ao baixar imagem",description:"Tente novamente.",variant:"destructive"})}},[ie,et,t]),_r=p.useCallback(async()=>{try{if(typeof window<"u"&&window.isSecureContext&&navigator.share){const M=await Yt()||ie||await et(),H=pt.current||await Qe(M),X=sr(new Date,"yyyy-MM-dd-HH-mm"),we={files:[new File([H],`horarios-${X}.png`,{type:"image/png"})]};try{if(!navigator.canShare||navigator.canShare(we)){await navigator.share(we);try{window.location.href="whatsapp://app"}catch{}return}}catch{}}await kr();try{typeof window<"u"&&window.innerWidth<768?window.location.href="whatsapp://app":window.open("https://web.whatsapp.com/","_blank","noopener,noreferrer")}catch{}t({title:"Imagem pronta",description:"Imagem baixada. Abra o WhatsApp e envie no Status.",variant:"success"})}catch{await kr()}},[ie,Yt,et,Qe,kr,t]),Rr=p.useCallback(async()=>{try{if(typeof window<"u"&&window.isSecureContext&&navigator.share){const M=await Yt()||ie||await et(),H=pt.current||await Qe(M),X=sr(new Date,"yyyy-MM-dd-HH-mm"),we={files:[new File([H],`horarios-${X}.png`,{type:"image/png"})]};try{!navigator.canShare||navigator.canShare(we)?await navigator.share(we):await kr()}catch{await kr()}}else await kr();try{typeof window<"u"&&window.innerWidth<768?window.location.href="instagram://story-camera":window.open("https://www.instagram.com/","_blank","noopener,noreferrer")}catch{}}catch{await kr()}},[ie,Yt,et,Qe,kr]);p.useCallback(async()=>{try{const M=ie||await et(),H=pt.current||await Qe(M),X=sr(new Date,"yyyy-MM-dd-HH-mm"),Ce=new File([H],`horarios-${X}.png`,{type:"image/png"}),we={text:xt,files:[Ce]};if(navigator.share&&navigator.canShare&&navigator.canShare(we)){await navigator.share(we);return}if(navigator.share){await navigator.share({text:xt,url:ve});return}const ye=`https://wa.me/?text=${encodeURIComponent(xt)}`;window.open(ye,"_blank","noopener,noreferrer"),await xr(),await kr()}catch{await xr(),await kr()}},[ve,xt,ie,et,Qe,xr,kr]),p.useEffect(()=>{const M=H=>{if(H.key==="Escape"&&L){W(!1);return}if(H.key==="F10"){try{H.preventDefault()}catch{}W(le=>!le)}};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[L]),p.useEffect(()=>{if(L&&window.innerWidth<768)if(screen.orientation&&screen.orientation.lock)screen.orientation.lock("landscape").catch(()=>{const M=document.getElementById("screen-orientation-meta");M&&M.setAttribute("content","landscape")});else{const M=document.getElementById("screen-orientation-meta");M&&M.setAttribute("content","landscape")}else if(!L&&window.innerWidth<768){screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock();const M=document.getElementById("screen-orientation-meta");M&&M.setAttribute("content","portrait-primary")}},[L]),p.useEffect(()=>{const M=I.get("date");if(M)try{const H=new Date(M+"T00:00:00");isNaN(H.getTime())||(B(H),I.delete("date"),T(I,{replace:!0}))}catch(H){console.error("[AgendaPage] Erro ao parsear date da URL:",H)}},[I,T]);const[nn,rn]=p.useState([]),Ke=p.useRef([]);p.useEffect(()=>{Ke.current=Array.isArray(nn)?nn:[]},[nn]);const[qe,ze]=p.useState(!1),[Je,kt]=p.useState(""),ct=p.useRef(0),tr=p.useRef(""),dt=p.useRef(!1),Mt=p.useRef(0),[ce,Xe]=p.useState(!1),[Qt,Tt]=p.useState(!1),Ar=p.useRef(!1);p.useEffect(()=>{Ar.current||!F||!P?.codigo_empresa||k&&(Ar.current=!0,(async()=>{try{const M=so(k),H=rs(M,1),{data:le,error:X}=await re.from("agendamentos").select("id, codigo, inicio, fim, status, modalidade, quadra_id, cliente_id, auto_disabled, clientes, valor_total, created_by_isis").eq("codigo_empresa",P.codigo_empresa).gte("inicio",M.toISOString()).lt("inicio",H.toISOString()).order("inicio",{ascending:!0});if(X)return;const Ce=(le||[]).map(we=>({id:we.id,code:we.codigo,start:new Date(we.inicio),end:new Date(we.fim),status:we.status||"scheduled",modality:we.modalidade||"",customer:Array.isArray(we.clientes)&&we.clientes.length>0?we.clientes[0]:"",court:String(we.quadra_id||""),court_id:we.quadra_id,valor_total:we.valor_total??null,auto_disabled:!!we.auto_disabled,created_by_isis:!!we.created_by_isis}));rn(we=>Array.isArray(we)&&we.length>0?we:Ce)}catch{}})())},[F,P?.codigo_empresa,k,re]);const[nr,Jr]=p.useState(4),[gn,tt]=p.useState(!1),[jr,ua]=p.useState(!1),Oe=f,Wt=h,[Ht,mr]=p.useState({}),Gt=p.useRef(0),pn=p.useRef("");p.useEffect(()=>{const M=H=>{try{const le=H?.detail||{},X=le.agendamentoId,Ce=le.participants;if(!X||!Array.isArray(Ce))return;mr(we=>{const Z=we[X]||[],ye=Ce.map((Ne,Re)=>{const bt=Z[Re]||{};return{...bt,cliente_id:Ne.cliente_id,nome:Ne.nome,codigo:Ne.codigo!==void 0?Ne.codigo:bt.codigo??null,valor_cota:typeof Ne.valor_cota=="string"?Ne.valor_cota:bt.valor_cota??"",status_pagamento:Ne.status_pagamento??bt.status_pagamento??"Pendente",finalizadora_id:Ne.finalizadora_id??bt.finalizadora_id??null,aplicar_taxa:Ne.aplicar_taxa??bt.aplicar_taxa??!1,ordem:Re+1}});return{...we,[X]:ye}})}catch{}};return window.addEventListener("payments:saved",M),()=>window.removeEventListener("payments:saved",M)},[]);const jt=p.useRef(!1);p.useEffect(()=>{jt.current=ce,_("Modal state change:",{isModalOpen:ce}),S("modal",{open:ce})},[ce,_]);const ur=p.useRef("init"),rt=p.useRef(0),Dt=p.useRef(!1),Xt=p.useRef(0),Tr=p.useRef(!1),qn=p.useRef(0),[Gr,ar]=p.useState(!1),kn=p.useRef(0),Xn=p.useRef(!1),aa=p.useRef(0),pa=p.useCallback((M=800)=>{aa.current=Date.now()+M,_("UI:busy set",{ms:M})},[_]),te=p.useCallback(()=>Date.now()<aa.current,[]),Te=p.useRef(0),at=p.useRef(0),ee=p.useRef(!1),Se=p.useCallback(()=>{const M=Date.now();ce||M-at.current<350||(at.current=M,Xe(!0),ee.current=!0)},[ce]),$e=p.useRef(!1);p.useEffect(()=>{n.state?.openModal&&!ce&&!$e.current&&($e.current=!0,Se(),window.history.replaceState({},document.title))},[n.state?.openModal,ce,Se]);const[Be,Ge]=p.useState({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),[Ye,ft]=p.useState(null),[yt,Et]=p.useState(!0),br=p.useRef(!0);p.useEffect(()=>{br.current=!!yt},[yt]);const Ue=p.useMemo(()=>Object.fromEntries((Ye??[]).map(M=>[M.nome,M])),[Ye]),St=p.useMemo(()=>(Ye??[]).map(M=>M.nome),[Ye]),[Nr,an]=p.useState([]);p.useEffect(()=>{try{if(yt)return;const M=Ye||[];if(!Array.isArray(M)||M.length===0||!Array.isArray(nn)||nn.length===0)return;let H=!1;const le=nn.map(X=>{if(!X)return X;const Ce=X.court_id;if(Ce==null)return X;const we=M.find(Z=>String(Z.id)===String(Ce));return we?.nome&&X.court!==we.nome&&!(St||[]).includes(X.court)?(H=!0,{...X,court:we.nome}):X});H&&rn(le)}catch{}},[yt,Ye,nn,St]);const Lr=P?.codigo_empresa,On=p.useMemo(()=>Lr?`quadras:list:${Lr}`:"quadras:list",[Lr]),Qn=p.useMemo(()=>Lr?`agenda:selectedCourts:${Lr}`:"agenda:selectedCourts",[Lr]),Ta=p.useMemo(()=>Lr?`agenda:viewFilter:${Lr}`:"agenda:viewFilter",[Lr]),[zn,Fn]=p.useState(null),[en,Wa]=p.useState(0);p.useEffect(()=>{try{Pt.current=zn}catch{}},[zn]),p.useEffect(()=>{try{Lt.current=Array.isArray(Nr)?Nr:[]}catch{}},[Nr]),p.useEffect(()=>{try{gr.current=Ue||{}}catch{}},[Ue]),p.useEffect(()=>{try{fr.current=Array.isArray(nn)?nn:[]}catch{}},[nn]),p.useEffect(()=>{Nr.length>0&&zn===null&&Fn(Nr[0])},[Nr,zn]);const[Ya,za]=p.useState([]),vs=p.useRef(null),Os=p.useRef({scheduled:!0,canceledOnly:!1}),[ss,Io]=p.useState(null),[Vs,ii]=p.useState(""),Rl=p.useRef(0),li=p.useRef(!1),pl=p.useRef(!1),[Fc,mc]=p.useState(!1),[ci,Lc]=p.useState(()=>{try{return localStorage.getItem("agenda:hideCanceledInfo")==="1"}catch{return!1}});p.useEffect(()=>{try{localStorage.setItem("agenda:hideCanceledInfo",ci?"1":"0")}catch{}},[ci]);const Ks=p.useMemo(()=>{if(!P?.codigo_empresa)return null;const M=sr(z==="week"?lh(k):k,"yyyy-MM-dd"),H=z==="week"?"week":"day";return`agenda:bookings:${P.codigo_empresa}:${H}:${M}`},[P?.codigo_empresa,k,z]),_o=p.useMemo(()=>{if(!P?.codigo_empresa)return null;const M=sr(k,"yyyy-MM-dd");return`agenda:participants:${P.codigo_empresa}:${M}`},[P?.codigo_empresa,k]),[$c,gl]=p.useState(!1),_i=p.useMemo(()=>({autoConfirmEnabled:!1,autoConfirmMinutesBefore:120,autoStartEnabled:!0,autoFinishEnabled:!0}),[]),[ts,xl]=p.useState(_i),[Ba,Qi]=p.useState(_i),[Xr,fu]=p.useState(!1),[vl,Xo]=p.useState(0),Zi=p.useCallback(()=>Date.now()+(Number.isFinite(vl)?vl:0),[vl]),[R,pe]=p.useState(null);p.useEffect(()=>{(async()=>{if(console.log("[AgendaSettings][LOAD] Iniciando carregamento...",{authReady:F,company_id:O?.id}),!F||!O?.id){console.warn("[AgendaSettings][LOAD] Aguardando autenticao...");return}try{console.log("[AgendaSettings][LOAD] Modo:","PRODUO (wrapper)"),console.log("[AgendaSettings][LOAD] Buscando para empresa_id:",O.id);const{data:H,error:le}=await re.from("agenda_settings").select("*").eq("empresa_id",O.id).maybeSingle();if(console.log("[AgendaSettings][LOAD] Resultado da query:",{data:H,error:le}),console.log("[AgendaSettings][LOAD] Data type:",H===null?"null":typeof H),le){console.error("[AgendaSettings][LOAD] ERRO ao carregar:",le);return}if(!H){console.warn("[AgendaSettings][LOAD] Nenhum registro encontrado (ainda no criado)");return}console.log("[AgendaSettings][LOAD]  Registro encontrado:",H);const X={autoConfirmEnabled:!!H.auto_confirm_enabled,autoConfirmMinutesBefore:H.auto_confirm_enabled&&Number.isFinite(Number(H.auto_confirm_hours))?Number(H.auto_confirm_hours)*60:_i.autoConfirmMinutesBefore,autoStartEnabled:!!H.auto_start_enabled,autoFinishEnabled:!!H.auto_finish_enabled};console.log("[AgendaSettings][LOAD]  Estado mapeado:",X),xl(Ce=>({...Ce,...X})),Qi(X),console.log("[AgendaSettings][LOAD]  Estados atualizados com sucesso!")}catch(H){console.warn("[AgendaSettings] unexpected load error",H)}})()},[F,O?.id]),p.useEffect(()=>{let M=!0,H=null,le=!1;const X=async()=>{try{const{data:Ce,error:we}=await re.functions.invoke("time-br",{body:{}});if(!we&&Ce&&M){const Z=Number(Ce.nowMs);if(Number.isFinite(Z)){const ye=Z-Date.now();Xo(ye),pe(Date.now());return}}if(!le){le=!0;try{console.warn("[TimeSync] time-br sem dados vlidos; usando relgio local.")}catch{}}}catch{if(!le){le=!0;try{console.warn("[TimeSync] time-br falhou; usando relgio local.")}catch{}}}};return X(),H=setInterval(X,5*60*1e3),()=>{M=!1,H&&clearInterval(H)}},[]);const[He,mt]=p.useState({}),zt=2*60*60*1e3,Dr=p.useCallback(M=>{mt(H=>({...H,[M]:Date.now()}))},[]),Qr=p.useCallback(M=>{mt(H=>{if(!H||!(M in H))return H;const le={...H};return delete le[M],le})},[]),de=p.useCallback(M=>{const H=He?.[M];return typeof H=="number"&&Date.now()-H<zt},[He]),[ke,st]=p.useState(null),ot=p.useCallback(()=>new Promise(M=>{st({resolve:M})}),[]),Nt=p.useRef(new Map),or=async()=>{console.log(" [AgendaSettings][SAVE] FUNO CHAMADA! "),console.log("[AgendaSettings][SAVE] Linha 509 - Antes do try");try{if(console.log("[AgendaSettings][SAVE] Linha 511 - Dentro do try"),console.log("[AgendaSettings][SAVE] authReady:",F),console.log("[AgendaSettings][SAVE] company:",O),!F||!O?.id){console.error("[AgendaSettings][SAVE] ERRO: No autenticado",{authReady:F,company:O}),t({title:"No autenticado",description:"Faa login para salvar as configuraes.",variant:"destructive"});return}console.log("[AgendaSettings][SAVE]  Autenticado! Preparando payload..."),console.log("[AgendaSettings][SAVE] automation atual:",ts),fu(!0);const M={empresa_id:O.id,auto_confirm_enabled:!!ts.autoConfirmEnabled,auto_confirm_hours:ts.autoConfirmEnabled?Math.max(0,Math.round(Number(ts.autoConfirmMinutesBefore||0)/60)):null,auto_start_enabled:!!ts.autoStartEnabled,auto_finish_enabled:!!ts.autoFinishEnabled};console.log("[AgendaSettings][SAVE] Payload preparado:",M),console.log("[AgendaSettings][SAVE] Modo:","PRODUO (wrapper)"),console.log("[AgendaSettings][SAVE] Supabase client type:",typeof re.from);const{data:H,error:le}=await re.from("agenda_settings").upsert(M,{onConflict:"empresa_id"}).select();if(console.log("[AgendaSettings][SAVE] Resultado do upsert:",{data:H,error:le}),console.log("[AgendaSettings][SAVE] Data type:",Array.isArray(H)?"array":typeof H),console.log("[AgendaSettings][SAVE] Data length:",H?.length),le)throw console.error("[AgendaSettings][SAVE]  ERRO no upsert:",le),le;!H||H.length===0?console.error("[AgendaSettings][SAVE]  AVISO: Upsert no retornou dados!"):console.log("[AgendaSettings][SAVE]  Dados salvos com sucesso:",H[0]),Qi(ts),console.log("[AgendaSettings][SAVE]  savedAutomation atualizado:",ts),t({title:"Configuraes salvas",description:"As automaes da agenda foram atualizadas com sucesso."}),gl(!1),console.log("[AgendaSettings][SAVE]  Salvamento concludo!")}catch(M){console.error(" [AgendaSettings][SAVE] ERRO CAPTURADO:",M),console.error("[AgendaSettings][SAVE] Stack:",M?.stack),console.error("[AgendaSettings][SAVE] Message:",M?.message);const H=M?.message||"Falha ao salvar as configuraes.";t({title:"Erro ao salvar",description:H,variant:"destructive"})}finally{console.log("[AgendaSettings][SAVE] Finally executado"),fu(!1)}},Bt=p.useCallback(async(M,H,le="user")=>{try{const X=["canceled","finished","absent"],Ce=["scheduled","confirmed","in_progress"],we=X.includes(H),Z=H==="canceled";let ye=!1;if(le==="user"&&Ce.includes(H)){const Rt=(nn||[]).find(rr=>rr.id===M),dr=Rt?X.includes(Rt.status):!1,qt=Rt?!!Rt.auto_disabled:!1;(dr||qt)&&(ye=!!await ot())}const Ne=Z?{canceled_by:le||"user",canceled_at:new Date().toISOString()}:{},Re=we?{status:H,auto_disabled:!0,...Ne}:ye?{status:H,auto_disabled:!1}:{status:H},{error:bt}=await re.from("agendamentos").update(Re).eq("codigo_empresa",P.codigo_empresa).eq("id",M).select("id");if(bt)throw bt;rn(Rt=>Rt.map(dr=>{if(dr.id!==M)return dr;const qt={...dr,status:H,customer:dr.customer||""};return we?qt.auto_disabled=!0:ye&&(qt.auto_disabled=!1),qt}));try{Nt.current.set(M,{status:H,ts:Date.now(),src:le})}catch{}try{const Rt=JSON.parse(localStorage.getItem(Ks)||"[]");if(Array.isArray(Rt)&&Rt.length>0){const dr=Array.isArray(Rt)?Rt.map(qt=>{if(qt.id!==M)return qt;const rr={...qt,status:H,customer:qt.customer||""};return we?rr.auto_disabled=!0:ye&&(rr.auto_disabled=!1),rr}):Rt;localStorage.setItem(Ks,JSON.stringify(dr))}}catch{}if(le==="user")try{ye?Qr(M):Dr(M)}catch{}}catch(X){console.error("Auto-status: falha ao atualizar",M,H,X)}},[nn,Ks,Dr,Qr,ot,Be]),vr=p.useRef(!1),yr=p.useRef(null),It=p.useRef(null),Hr=p.useRef(null),Vr=p.useRef(!1),pr=p.useCallback(()=>{try{yr.current&&(clearTimeout(yr.current),yr.current=null)}catch{}},[]),ln=p.useCallback(()=>{if(!F||!P?.codigo_empresa)return;if(Date.now()<(Te.current||0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AutoDiag] scheduleNextAutomation:deferred returning-from-hidden")}catch{}It.current||(It.current=setTimeout(()=>{It.current=null;try{ln()}catch{}},800));return}if(It.current){try{clearTimeout(It.current)}catch{}It.current=null}if(!Vr.current){_("scheduleNextAutomation:skipped (initial data not ready)"),setTimeout(()=>ln(),800);return}if(jt.current){_("scheduleNextAutomation:skipped (modal open)");return}S("auto:schedule"),pr();const H=Zi();let le=1/0;const X=Ce=>{Number.isFinite(Ce)&&Ce>H&&Ce<le&&(le=Ce)};try{for(const Ce of nn||[]){if(!Ce||Ce.auto_disabled||de(Ce.id))continue;const we=Ce.start instanceof Date?Ce.start.getTime():new Date(Ce.start).getTime(),Z=Ce.end instanceof Date?Ce.end.getTime():new Date(Ce.end).getTime();if(Ce.status==="scheduled"&&Ba.autoConfirmEnabled){const ye=Number(Ba.autoConfirmMinutesBefore||0)*6e4;X(we-ye),Ba.autoFinishEnabled&&X(Z)}Ce.status==="confirmed"&&(Ba.autoStartEnabled&&X(we),Ba.autoFinishEnabled&&X(Z)),Ce.status==="in_progress"&&Ba.autoFinishEnabled&&X(Z)}}catch{}if(le!==1/0){const Ce=Math.max(0,Math.min(le-H+250,6e5));try{console.debug("[Auto] next schedule in ms",Ce)}catch{}try{tn(le)}catch{}yr.current=setTimeout(()=>{try{Hr.current&&Hr.current()}catch{}},Ce)}},[F,P?.codigo_empresa,nn,Ba,de,pr,Zi]),hr=p.useCallback(async M=>{try{if(!(typeof R=="number"&&Date.now()-R<6e5))try{const{data:X}=await re.functions.invoke("time-br",{body:{}}),Ce=Number(X?.nowMs);Number.isFinite(Ce)&&(Xo(Ce-Date.now()),pe(Date.now()))}catch{}try{ln()}catch{}let le=null;if(M?.id&&P?.codigo_empresa){const{data:X}=await re.from("agendamentos").select("id, inicio, fim, status, modalidade, quadra_id, cliente_id, auto_disabled").eq("codigo_empresa",P.codigo_empresa).eq("id",M.id).single();if(X){const Ce={...M,start:new Date(X.inicio),end:new Date(X.fim),status:X.status||M.status,modality:X.modalidade||M.modality,auto_disabled:!!X.auto_disabled,customer:M.customer||""};le=Ce,rn(we=>we.map(Z=>Z.id===M.id?Ce:Z))}}try{const X=le||M;if(X&&X.id){const Ce=Zi(),we=X.start instanceof Date?X.start.getTime():new Date(X.start).getTime(),Z=X.end instanceof Date?X.end.getTime():new Date(X.end).getTime();if(!X.auto_disabled&&!de(X.id))if(X.status==="in_progress"&&Ba.autoFinishEnabled&&Number.isFinite(Z)&&Ce>=Z)await Bt(X.id,"finished","automation");else if(X.status==="scheduled"&&Ba.autoStartEnabled&&Number.isFinite(we)&&Ce>=we)await Bt(X.id,"in_progress","automation");else if(X.status==="confirmed"&&Ba.autoStartEnabled&&Number.isFinite(we)&&Ce>=we)await Bt(X.id,"in_progress","automation");else if(X.status==="scheduled"&&Ba.autoConfirmEnabled&&Number.isFinite(we)){const Ne=Number(Ba.autoConfirmMinutesBefore||0)*6e4;Ce>=we-Ne&&await Bt(X.id,"confirmed","automation")}else(X.status==="scheduled"||X.status==="confirmed")&&Ba.autoFinishEnabled&&Number.isFinite(Z)&&Ce>=Z&&await Bt(X.id,"finished","automation")}}catch{}try{Hr.current&&Hr.current()}catch{}try{console.log(" EditGuard | ok | tempo=",typeof R=="number"?"Servidor":"Local")}catch{}return{booking:le}}catch(H){try{console.warn(" EditGuard | falha leve",H?.message||H)}catch{}return{booking:null}}},[R,re,P,rn,ln,Zi,ts,de,Bt]);p.useEffect(()=>{if(!(!F||!P?.codigo_empresa)&&R&&!Vr.current){Vr.current=!0,_("initial-data:ready",{at:R});try{ln()}catch{}}},[R,F,P,ln,_]);const Zr=p.useCallback(async()=>{if(!(!F||!P?.codigo_empresa)){if(jt.current){_("runAutomation:skipped (modal open)");return}if(Date.now()<(Te.current||0)){_("runAutomation:skipped (returning-from-hidden grace)");try{ln()}catch{}return}if(!Vr.current){_("runAutomation:skipped (initial data not ready)");try{ln()}catch{}return}if(!vr.current){vr.current=!0;try{try{console.debug("[Auto] tick")}catch{}S("auto:tick");const M=Zi(),H=new Date(M),le=sr(H,"yyyy-MM-dd");let X=(nn||[]).filter(we=>sr(we.start,"yyyy-MM-dd")===le);if(X.length===0)try{const we=so(H),Z=rs(we,1),{data:ye,error:Ne}=await re.from("agendamentos").select("id, inicio, fim, status, auto_disabled").eq("codigo_empresa",P.codigo_empresa).gte("inicio",we.toISOString()).lt("inicio",Z.toISOString());!Ne&&Array.isArray(ye)&&(X=ye.map(Re=>({id:Re.id,start:new Date(Re.inicio),end:new Date(Re.fim),status:Re.status||"scheduled",auto_disabled:!!Re.auto_disabled})))}catch{}try{const{data:we,error:Z}=await re.from("agendamentos").select("id, inicio, fim, status, auto_disabled").eq("codigo_empresa",P.codigo_empresa).lt("fim",H.toISOString()).in("status",["scheduled","confirmed","in_progress"]);if(!Z&&Array.isArray(we)&&we.length>0){const ye=we.map(Re=>({id:Re.id,start:new Date(Re.inicio),end:new Date(Re.fim),status:Re.status||"scheduled",auto_disabled:!!Re.auto_disabled})),Ne=new Map(X.map(Re=>[Re.id,Re]));for(const Re of ye)Ne.has(Re.id)||Ne.set(Re.id,Re);X=Array.from(Ne.values())}}catch{}let Ce=!1;for(const we of X){if(we.auto_disabled||de(we.id))continue;const Z=we.start instanceof Date?we.start.getTime():new Date(we.start).getTime(),ye=we.end instanceof Date?we.end.getTime():new Date(we.end).getTime();if(we.status==="in_progress"&&Ba.autoFinishEnabled&&M>=ye){try{console.debug("[Auto] finish",{id:we.id})}catch{}await Bt(we.id,"finished","automation"),Ce=!0;continue}if(we.status==="scheduled"&&Ba.autoStartEnabled&&M>=Z){try{console.debug("[Auto] start-direct (skip confirm)",{id:we.id})}catch{}await Bt(we.id,"in_progress","automation"),Ce=!0;continue}if(we.status==="confirmed"&&Ba.autoStartEnabled&&M>=Z){try{console.debug("[Auto] start",{id:we.id})}catch{}await Bt(we.id,"in_progress","automation"),Ce=!0;continue}if(we.status==="scheduled"&&Ba.autoConfirmEnabled){const Ne=Number(Ba.autoConfirmMinutesBefore||0)*6e4;if(M>=Z-Ne){try{console.debug("[Auto] confirm",{id:we.id})}catch{}await Bt(we.id,"confirmed","automation"),Ce=!0;continue}}if((we.status==="scheduled"||we.status==="confirmed")&&Ba.autoFinishEnabled&&M>=ye){try{console.debug("[Auto] catchup-finish",{id:we.id})}catch{}await Bt(we.id,"finished","automation"),Ce=!0;continue}}if(Ce)try{setTimeout(()=>{try{cr()}catch{}},800)}catch{}try{ln()}catch{}}finally{vr.current=!1}}}},[F,P?.codigo_empresa,nn,Ba,Bt,de,ln,Zi]);p.useEffect(()=>{Hr.current=Zr},[Zr]),p.useEffect(()=>{const M=setInterval(Zr,1e4);try{Hr.current&&Hr.current()}catch{}try{ln()}catch{}return()=>clearInterval(M)},[Zr]),p.useEffect(()=>{const M=setInterval(()=>{try{if(!!!(Ba?.autoConfirmEnabled||Ba?.autoStartEnabled||Ba?.autoFinishEnabled))return;Hr.current&&(console.debug("[Auto][Watchdog] forcing periodic automation run"),Hr.current())}catch{}},18e5);return()=>clearInterval(M)},[Ba]),p.useEffect(()=>{if(Ks)try{const M=JSON.parse(localStorage.getItem(Ks)||"[]");if(Array.isArray(M)&&M.length>0){const H=M.map(le=>({...le,start:new Date(le.start),end:new Date(le.end),customer:le.customer||"",created_by_isis:!!le.created_by_isis}));_("cache:bookings:hydrate",{count:H.length,sample:H[0]}),S("cache:hydrate",{count:H.length}),rn(le=>le&&le.length>0?le:H),pa(1200)}}catch{}},[Ks,_]),p.useEffect(()=>{const M=()=>{try{const X=new Date().toISOString();if(document.visibilityState==="visible"){const Ce=Date.now();Te.current=Ce+800}}catch{}},H=()=>{try{const X=new Date().toISOString()}catch{}},le=()=>{try{const X=new Date().toISOString()}catch{}};return document.addEventListener("visibilitychange",M),window.addEventListener("focus",H),window.addEventListener("blur",le),()=>{document.removeEventListener("visibilitychange",M),window.removeEventListener("focus",H),window.removeEventListener("blur",le)}},[ce,nn]),p.useEffect(()=>{try{ln()}catch{}return()=>{try{pr()}catch{}}},[nn,ts,ln,pr]),p.useEffect(()=>{if(_o)try{const M=JSON.parse(localStorage.getItem(_o)||"{}");if(M&&typeof M=="object"){const H={};for(const[le,X]of Object.entries(M||{})){const Ce=Array.isArray(X)?X.slice():[];Ce.sort((we,Z)=>{const ye=Number.isFinite(Number(we?.ordem))?Number(we.ordem):Number.MAX_SAFE_INTEGER,Ne=Number.isFinite(Number(Z?.ordem))?Number(Z.ordem):Number.MAX_SAFE_INTEGER;return ye!==Ne?ye-Ne:String(we?.id||"").localeCompare(String(Z?.id||""))}),H[le]=Ce}mr(H),pn.current=sr(k,"yyyy-MM-dd")}}catch{}},[_o]);const Pr=p.useCallback(async(M,H)=>{if(!F||!P?.codigo_empresa)return{map:{},ids:[]};const le=(Array.isArray(M)?M:[]).filter(Boolean);if(le.length===0)return{map:{},ids:[]};try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] fetchParticipantsBatch:start",{reqId:H,ids:le.length})}catch{}const{data:X,error:Ce}=await re.from("agendamento_participantes").select("id, agendamento_id, codigo_empresa, cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey(nome, codigo)").in("agendamento_id",le).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(ct.current!==H)return{map:{},ids:le};if(Ce)throw Ce;const we={};for(const Z of X||[]){const ye=Z.agendamento_id;we[ye]||(we[ye]=[]);const Ne=Z.nome||(Array.isArray(Z.cliente)?Z.cliente[0]?.nome:Z.cliente?.nome)||"",Re=(Array.isArray(Z.cliente)?Z.cliente[0]?.codigo:Z.cliente?.codigo)||null;we[ye].push({...Z,nome:Ne,codigo:Re})}for(const Z of le){const ye=Array.isArray(we[Z])?we[Z].slice():[];ye.sort((Ne,Re)=>{const bt=Number.isFinite(Number(Ne?.ordem))?Number(Ne.ordem):Number.MAX_SAFE_INTEGER,Rt=Number.isFinite(Number(Re?.ordem))?Number(Re.ordem):Number.MAX_SAFE_INTEGER;return bt!==Rt?bt-Rt:String(Ne?.id||"").localeCompare(String(Re?.id||""))}),we[Z]=ye}mr(Z=>{const ye={...Z};for(const Ne of le)ye[Ne]=we[Ne]||[];try{_o&&localStorage.setItem(_o,JSON.stringify(ye))}catch{}return ye}),rn(Z=>{const ye=Z||[];let Ne=!1;const Re=ye.map(bt=>{const Rt=we[bt.id];if(Array.isArray(Rt)&&Rt.length>0){const dr=(Rt.find(qt=>qt?.is_representante)||Rt[0])?.nome||"";if(dr&&dr!==bt.customer)return Ne=!0,{...bt,customer:dr}}return bt});return Ne?Re:Z});try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] fetchParticipantsBatch:done",{reqId:H,rows:(X||[]).length})}catch{}return{map:we,ids:le}},[F,P?.codigo_empresa,_o,mr,rn]),cr=p.useCallback(async()=>{if(!F||!P?.codigo_empresa||ce)return;_("fetchBookings:start",{date:sr(k,"yyyy-MM-dd"),empresa:P?.codigo_empresa}),S("fetch:start",{day:sr(k,"yyyy-MM-dd")});const M=so(k),H=z==="week"?lh(k):M,le=z==="week"?rs(H,7):rs(H,1),{data:X,error:Ce}=await re.from("agendamentos").select(`
        id, codigo, codigo_empresa, quadra_id, cliente_id, clientes, valor_total, inicio, fim, modalidade, status, auto_disabled, created_by_isis,
        quadra:quadra_id ( nome )
      `).eq("codigo_empresa",P.codigo_empresa).gte("inicio",H.toISOString()).lt("inicio",le.toISOString()).order("inicio",{ascending:!0});if(Ce){_("fetchBookings:error",{message:Ce?.message,code:Ce?.code,status:Ce?.status}),S("fetch:error",{message:Ce?.message,code:Ce?.code,status:Ce?.status}),t({title:"Erro ao carregar agendamentos",description:Ce.message,variant:"destructive"}),li.current||(li.current=!0,setTimeout(cr,900));return}if(!X||X.length===0)return _("fetchBookings:empty-hit"),S("fetch:empty"),li.current?li.current=!1:(li.current=!0,setTimeout(cr,700)),Ke.current;li.current=!1;const we=Date.now(),Z=(()=>{try{const Ne=Array.isArray(Ke.current)?Ke.current:[];return new Map(Ne.map(Re=>[Re.id,Re]))}catch{return new Map}})(),ye=(X||[]).map(Ne=>{const Re=new Date(Ne.inicio),bt=new Date(Ne.fim),Rt=Z.get(Ne.id),dr=Ne.quadra?.[0]?.nome||Ne.quadra?.nome||Object.values(Ue).find($r=>$r.id===Ne.quadra_id)?.nome||"",qt=Ne.quadra_id!=null?String(Ne.quadra_id):"";let rr="";if(!rr&&Ne.clientes)try{const $r=typeof Ne.clientes=="string"?JSON.parse(Ne.clientes):Ne.clientes;Array.isArray($r)&&$r.length>0&&(rr=$r[0]?.nome||$r[0]||"")}catch{}const qr=Nt.current.get(Ne.id),Dn=qr&&we-qr.ts<4e3;return{id:Ne.id,code:Ne.codigo,court:dr||qt,court_id:Ne.quadra_id,customer:Rt&&Rt.customer?Rt.customer:rr,valor_total:Ne.valor_total!==void 0?Ne.valor_total:Rt?.valor_total??null,start:Re,end:bt,status:Dn?qr.status:Ne.status||"scheduled",modality:Ne.modalidade||"",auto_disabled:!!Ne.auto_disabled,created_by_isis:!!Ne.created_by_isis}});rn(Ne=>{const Re=Array.isArray(Ne)?Ne:[],bt=Array.isArray(ye)?ye:[];if(Re.length!==bt.length)return ye;for(let Rt=0;Rt<Re.length;Rt++){const dr=Re[Rt],qt=bt[Rt];if(!dr||!qt)return ye;const rr=dr.start instanceof Date?dr.start.getTime():new Date(dr.start).getTime(),qr=dr.end instanceof Date?dr.end.getTime():new Date(dr.end).getTime(),Dn=qt.start instanceof Date?qt.start.getTime():new Date(qt.start).getTime(),$r=qt.end instanceof Date?qt.end.getTime():new Date(qt.end).getTime();if(dr.id!==qt.id||dr.status!==qt.status||dr.modality!==qt.modality||String(dr.court||"")!==String(qt.court||"")||String(dr.court_id||"")!==String(qt.court_id||"")||String(dr.customer||"")!==String(qt.customer||"")||Number(dr.valor_total??NaN)!==Number(qt.valor_total??NaN)||!!dr.auto_disabled!=!!qt.auto_disabled||rr!==Dn||qr!==$r)return ye}return Ne});try{if(Ks){const Ne=ye.map(Re=>({id:Re.id,code:Re.code,court:Re.court,court_id:Re.court_id,customer:Re.customer,valor_total:Re.valor_total??null,start:Re.start.toISOString(),end:Re.end.toISOString(),status:Re.status,modality:Re.modality,auto_disabled:Re.auto_disabled,created_by_isis:!!Re.created_by_isis}));localStorage.setItem(Ks,JSON.stringify(Ne))}}catch{}return ye},[F,P?.codigo_empresa,k,Ue,Ks,t,_,w,z,ce]);p.useEffect(()=>{(async()=>{if(!F||!P?.codigo_empresa||!k||ce)return;const H=sr(z==="week"?lh(k):k,"yyyy-MM-dd"),le=`${P.codigo_empresa}:${z}:${H}`;if(tr.current===le||dt.current)return;dt.current=!0;const X=++ct.current;Mt.current=Date.now();try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] start",{reqId:X,bootKey:le,ts:new Date().toISOString()})}catch{}ze(!0),kt("Carregando quadras");try{if(br.current){const qt=Date.now();let rr=!1;await new Promise(qr=>{const Dn=setInterval(()=>{if(ct.current!==X){clearInterval(Dn),qr();return}if(br.current||(clearInterval(Dn),qr()),!rr&&Date.now()-qt>5e3){rr=!0;try{console.warn("[AgendaBoot] aguardando courtsLoading >5s",{reqId:X,bootKey:le})}catch{}}if(Date.now()-qt>6500){try{console.warn("[AgendaBoot] timeout aguardando courtsLoading, prosseguindo boot",{reqId:X,bootKey:le})}catch{}clearInterval(Dn),qr()}},50)})}if(ct.current!==X)return;kt("Carregando agendamentos");try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] stage",{reqId:X,stage:"bookings"})}catch{}const Ce=Date.now();let we=!1;const Z=setInterval(()=>{if(!we&&ct.current===X&&Date.now()-Ce>5e3){we=!0;try{console.warn("[AgendaBoot] aguardando fetchBookings >5s",{reqId:X,bootKey:le})}catch{}}},250);let ye=await cr();try{clearInterval(Z)}catch{}if(ct.current!==X)return;let Ne=Array.isArray(ye)?ye:[];if(Ne.length===0){try{localStorage.getItem("debug:agenda")==="1"&&console.warn("[AgendaBoot] fetchBookings vazio, tentando novamente",{reqId:X,bootKey:le})}catch{}if(await new Promise(qt=>setTimeout(qt,750)),ye=await cr(),ct.current!==X)return;Ne=Array.isArray(ye)?ye:[]}const Re=Ne.map(qt=>qt.id).filter(Boolean);try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] bookings loaded",{reqId:X,count:Ne.length,idsCount:Re.length})}catch{}kt("Carregando participantes");try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] stage",{reqId:X,stage:"participants"})}catch{}const bt=Date.now();let Rt=!1;const dr=setInterval(()=>{if(!Rt&&ct.current===X&&Date.now()-bt>5e3){Rt=!0;try{console.warn("[AgendaBoot] aguardando fetchParticipantsBatch >5s",{reqId:X,bootKey:le,ids:Re.length})}catch{}}},250);await Pr(Re,X);try{clearInterval(dr)}catch{}tr.current=le}catch(Ce){try{console.warn("[AgendaBoot] erro ao carregar agenda:",{reqId:X,bootKey:le,message:Ce?.message,e:Ce})}catch{}}finally{if(dt.current=!1,ct.current===X){ze(!1),kt("");try{const Ce=Date.now()-(Mt.current||Date.now());localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] done",{reqId:X,bootKey:le,ms:Ce})}catch{}}}})()},[F,P?.codigo_empresa,k,z,ce,yt,cr,Pr]),p.useEffect(()=>{if(w)try{const M=(nn||[]).map(H=>`${H.id}:${sr(H.start,"HH:mm")}-${sr(H.end,"HH:mm")}:${H.status}`).join(" | ");console.log("[AgendaDbg] bookings:changed",{count:Array.isArray(nn)?nn.length:0,summary:M})}catch{}},[nn,w]),p.useEffect(()=>{try{const M=Date.now()+1800;Xt.current=M,_("Picker:suppressClose window set",{until:M})}catch{}},[nn]),p.useEffect(()=>{F&&P?.codigo_empresa&&cr()},[F,P?.codigo_empresa,k,Ue,Ks]);const Mr=p.useRef(null),[bn,ca]=p.useState("idle"),[os,ys]=p.useState(null),cn=p.useRef(!1);p.useEffect(()=>{if(!F||!P?.codigo_empresa)return;const M=so(k),H=rs(M,1),le=Ne=>{try{const Re=new Date(Ne);return Re>=M&&Re<H}catch{return!1}},X=Ne=>{const Re=Ne?.new||Ne?.old;if(Re&&Re.codigo_empresa===P.codigo_empresa&&(le(Re.inicio)||le(Re.fim))){try{console.debug("[Realtime] agendamentos change",{event:Ne.eventType,id:Re.id})}catch{}Mr.current&&clearTimeout(Mr.current);try{ys(Date.now())}catch{}if(jt.current){_("Realtime:onChange deferred due to modal open"),cn.current=!0,S("rt:change:deferred",{id:Re.id,event:Ne.eventType});return}_("Realtime:onChange scheduling fetchBookings"),S("rt:change",{id:Re.id,event:Ne.eventType}),Mr.current=setTimeout(()=>{try{_("Realtime:debounced fetchBookings fire"),S("rt:debounced:fire"),pa(300),cr()}catch{}},400)}},Ce=Ne=>{const Re=Ne?.new||Ne?.old;if(Re&&Re.codigo_empresa===P.codigo_empresa){try{console.debug("[Realtime] agendamento_participantes change",{event:Ne.eventType,agendamento_id:Re.agendamento_id})}catch{}Mr.current&&clearTimeout(Mr.current);try{ys(Date.now())}catch{}if(jt.current){_("Realtime:onParticipantsChange deferred due to modal open"),cn.current=!0,S("rt:participants:deferred",{agendamento_id:Re.agendamento_id,event:Ne.eventType});return}_("Realtime:onParticipantsChange scheduling fetchBookings"),S("rt:participants",{agendamento_id:Re.agendamento_id,event:Ne.eventType}),Mr.current=setTimeout(()=>{try{_("Realtime:participants debounced fetchBookings fire"),S("rt:participants:debounced:fire"),pa(300),cr()}catch{}},400)}},we=re.channel(`agendamentos:${P.codigo_empresa}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamentos",filter:`codigo_empresa=eq.${P.codigo_empresa}`},X).subscribe(Ne=>{try{console.debug("[Realtime] channel status",Ne)}catch{}try{ca(String(Ne||"unknown"))}catch{}}),Z=re.channel(`agendamento_participantes:${P.codigo_empresa}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamento_participantes",filter:`codigo_empresa=eq.${P.codigo_empresa}`},Ce).subscribe(),ye=setInterval(()=>{jt.current||cr()},3e4);return()=>{try{Mr.current&&clearTimeout(Mr.current)}catch{}try{re.removeChannel(we)}catch{}try{re.removeChannel(Z)}catch{}try{clearInterval(ye)}catch{}try{ca("polling")}catch{}}},[F,P?.codigo_empresa,k,cr]),p.useEffect(()=>{if(!ce&&cn.current){cn.current=!1;try{_("Modal closed: flushing pending realtime refresh"),S("rt:flushAfterModalClose"),cr()}catch{}}},[ce,cr,_]);const[Kr,tn]=p.useState(null),An=p.useRef("");p.useEffect(()=>{try{const M=typeof R=="number"&&Date.now()-R<6e5,H=Re=>typeof Re=="number"?sr(new Date(Re),"HH:mm:ss",{locale:ga}):"",le=Re=>typeof Re=="number"?sr(new Date(Re),"HH:mm",{locale:ga}):"",X=M?"":"",we=String(bn).toUpperCase()==="SUBSCRIBED"||String(bn).toLowerCase()==="polling"?"":"",Z=typeof Kr=="number"?"":"",ye=Array.isArray(nn)?nn.length:0,Ne=` Agenda | ${X} Tempo=${M?"Servidor":"Local"} (${Math.round(vl)}ms, sync ${H(R)}) |  Realtime=${we} ${bn}${os?` (${H(os)})`:""} | ${Z} Prximo=${le(Kr)} |  Agendamentos=${ye}`;An.current!==Ne&&(An.current=Ne,console.log(Ne)),typeof window<"u"&&(window.__AgendaConn={usingServer:M,serverOffsetMs:vl,lastTimeSyncAtMs:R,realtimeStatus:bn,lastRealtimeEventAtMs:os,nextAutoAtMs:Kr})}catch{}},[vl,R,bn,os,ts,Kr,P?.codigo_empresa,k,Array.isArray(nn)?nn.length:0]),p.useEffect(()=>{const M=setInterval(()=>{try{const H=Date.now();if(H<(Te.current||0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AutoDiag] reconcile:skipped returning-from-hidden")}catch{}return}if(ce){console.log("[AutoDiag] reconcile:skipped modal-open");return}const le=String(bn||"").toUpperCase()==="SUBSCRIBED",X=typeof os=="number"?H-os:1/0,Ce=!le||X>7*60*1e3,we=typeof Kr=="number"?H>Kr+60*1e3:!1;if(Ce||we){console.debug("[Reconcile] forcing fetchBookings (stale=",Ce," tickDue=",we,")"),cr();try{ln()}catch{}}}catch{}},3e5);return()=>clearInterval(M)},[bn,os,Kr,cr,ln]),p.useEffect(()=>{(async()=>{if(!F||!P?.codigo_empresa||Date.now()<(Te.current||0))return;if(jt.current){_("Participants:skipped (modal open)");return}_("Participants:load start"),S("parts:start");const H=(nn||[]).map(ye=>ye.id).filter(Boolean),le=sr(k,"yyyy-MM-dd");if(!H.length){if(pn.current!==le){mr({});try{_o&&localStorage.setItem(_o,"{}")}catch{}}pn.current=le;return}const X=++Gt.current,{data:Ce,error:we}=await re.from("agendamento_participantes").select("id, agendamento_id, codigo_empresa, cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey(nome, codigo)").in("agendamento_id",H).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(Gt.current!==X)return;if(we){console.warn("[Participants] load error",we),_("Participants:error",{message:we?.message,code:we?.code,status:we?.status}),S("parts:error",{code:we?.code});return}const Z={};for(const ye of Ce||[]){const Ne=ye.agendamento_id;Z[Ne]||(Z[Ne]=[]);const Re=ye.nome||(Array.isArray(ye.cliente)?ye.cliente[0]?.nome:ye.cliente?.nome)||"",bt=(Array.isArray(ye.cliente)?ye.cliente[0]?.codigo:ye.cliente?.codigo)||null;Z[Ne].push({...ye,nome:Re,codigo:bt})}for(const ye of H){const Ne=Array.isArray(Z[ye])?Z[ye].slice():[];Ne.sort((Re,bt)=>{const Rt=Number.isFinite(Number(Re?.ordem))?Number(Re.ordem):Number.MAX_SAFE_INTEGER,dr=Number.isFinite(Number(bt?.ordem))?Number(bt.ordem):Number.MAX_SAFE_INTEGER;return Rt!==dr?Rt-dr:String(Re?.id||"").localeCompare(String(bt?.id||""))}),Z[ye]=Ne}_("Participants:loaded",{bookings:H.length,rows:(Ce||[]).length}),S("parts:loaded",{rows:(Ce||[]).length}),pn.current=le,mr(ye=>{const Ne={...ye};for(const Re of H)Ne[Re]=Z[Re]||[];try{_o&&localStorage.setItem(_o,JSON.stringify(Ne))}catch{}return _("Participants:set state for ids",{ids:H}),S("parts:set",{idsCount:H.length}),Ne}),rn(ye=>{const Ne=ye||[];let Re=!1;const bt=Ne.map(Rt=>{const dr=Z[Rt.id];if(Array.isArray(dr)&&dr.length>0){const qt=(dr.find(rr=>rr?.is_representante)||dr[0])?.nome||"";if(qt&&qt!==Rt.customer)return Re=!0,{...Rt,customer:qt}}return Rt});return Re?bt:ye})})()},[F,P?.codigo_empresa,nn,k,_o,_]),p.useEffect(()=>{(async()=>{if(!(!F||!P?.codigo_empresa||!St.length)){$(!0);try{const H=sr(k,"yyyy-MM-dd"),le=k.getDay(),{data:X,error:Ce}=await re.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",P.codigo_empresa).or(`and(tipo.eq.data_fechamento,data_fechamento.eq.${H}),and(tipo.eq.dia_semana,dia_semana.eq.${le})`);if(Ce){console.error("Erro ao carregar dias de funcionamento:",Ce);return}const we={};St.forEach(Z=>{const ye=Ue[Z];if(!ye)return;const Ne=X?.find(bt=>bt.quadra_id===ye.id&&bt.tipo==="data_fechamento"&&bt.data_fechamento===H);if(Ne&&!Ne.funciona){we[Z]={funciona:!1,motivo:"data_especifica",observacao:Ne.observacao||"Fechamento especial"};return}const Re=X?.find(bt=>bt.quadra_id===ye.id&&bt.tipo==="dia_semana"&&bt.dia_semana===le);Re?we[Z]={funciona:Re.funciona,motivo:Re.funciona?"normal":"dia_semana",observacao:Re.funciona?null:"Fechado neste dia da semana"}:we[Z]={funciona:!0,motivo:"normal",observacao:null}}),Ae(we)}catch(H){console.error("Erro ao verificar dias de funcionamento:",H)}finally{$(!1)}}})()},[F,P?.codigo_empresa,k,St,Ue]),p.useEffect(()=>{if(!F||!P?.codigo_empresa||St.length===0)return;(async()=>{try{const H=new Date(k);H.setDate(H.getDate()-H.getDay());const{data:le,error:X}=await re.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",P.codigo_empresa);if(X){console.error("Erro ao carregar funcionamento da semana:",X);return}const Ce={};for(let we=0;we<7;we++){const Z=new Date(H);Z.setDate(Z.getDate()+we);const ye=sr(Z,"yyyy-MM-dd"),Ne=Z.getDay(),Re={};St.forEach(bt=>{const Rt=Ue[bt];if(!Rt)return;const dr=le?.find(rr=>rr.quadra_id===Rt.id&&rr.tipo==="data_fechamento"&&rr.data_fechamento===ye);if(dr&&!dr.funciona){Re[bt]={funciona:!1,motivo:"data_especifica",observacao:dr.observacao||"Fechamento especial"};return}const qt=le?.find(rr=>rr.quadra_id===Rt.id&&rr.tipo==="dia_semana"&&rr.dia_semana===Ne);qt?Re[bt]={funciona:qt.funciona,motivo:qt.funciona?"normal":"dia_semana",observacao:qt.funciona?null:"Fechado neste dia da semana"}:Re[bt]={funciona:!0,motivo:"normal",observacao:null}}),Ce[ye]=Re}he(Ce)}catch(H){console.error("Erro ao carregar funcionamento da semana:",H)}})()},[F,P?.codigo_empresa,k,St,Ue]),p.useEffect(()=>{Object.values(ge).some(H=>!H.funciona)&&vs.current},[ge]),p.useEffect(()=>{if(Lr)try{const M=JSON.parse(localStorage.getItem(On)||"[]");Array.isArray(M)&&M.length&&(!Ye||Ye.length===0)&&(ft(M),Et(!1))}catch{}},[Lr,On]),p.useEffect(()=>{const M=async()=>{if(!P?.codigo_empresa)return;try{localStorage.getItem("debug:agenda")==="1"&&console.log("[Agenda][Courts] loadCourts:start",{empresa:P.codigo_empresa,hasCache:!!localStorage.getItem(On)})}catch{}try{const Ce=JSON.parse(localStorage.getItem(On)||"[]");if(Array.isArray(Ce)&&Ce.length>0){const we=Ce[0]?.codigo_empresa;if(we&&we!==P.codigo_empresa){console.warn(" [Cache Limpo] Quadras de outra empresa detectadas e removidas"),localStorage.removeItem(On),localStorage.removeItem(Qn),ft([]);try{an([])}catch{}try{Fn(null)}catch{}try{setForm(Z=>({...Z,court:""}))}catch{}}}}catch{}(!Ye||Ye.length===0)&&Et(!0);const{data:H,error:le}=await re.from("quadras").select("id, nome, modalidades, hora_inicio, hora_fim, valor, codigo_empresa, status").eq("codigo_empresa",P.codigo_empresa).eq("status","Ativa").order("nome",{ascending:!0});if(le){console.error("Erro ao buscar quadras:",le),pl.current?Et(!1):(pl.current=!0,setTimeout(M,900));try{localStorage.getItem("debug:agenda")==="1"&&console.warn("[Agenda][Courts] loadCourts:error",{empresa:P.codigo_empresa,message:le?.message,code:le?.code})}catch{}return}const X=H||[];if(X.length===0){let Ce=0;try{const we=JSON.parse(localStorage.getItem("quadras:list")||"[]");Ce=Array.isArray(we)?we.length:0}catch{}if(Ce>0&&!pl.current){pl.current=!0,Et(!1),setTimeout(M,700);return}}pl.current=!1,ft(X);try{localStorage.setItem(On,JSON.stringify(X))}catch{}Et(!1);try{localStorage.getItem("debug:agenda")==="1"&&console.log("[Agenda][Courts] loadCourts:done",{empresa:P.codigo_empresa,count:Array.isArray(X)?X.length:0})}catch{}};F&&P?.codigo_empresa&&M()},[F,P?.codigo_empresa,On,Qn]),p.useEffect(()=>{try{if(yt)return;const M=St||[];form?.court&&!M.includes(form.court)&&setForm(H=>({...H,court:M[0]||""})),(!form?.court||form.court==="")&&M.length>0&&setForm(H=>({...H,court:M[0]}))}catch{}},[yt,St,P?.codigo_empresa]),p.useEffect(()=>{if(yt)return;const M=(()=>{try{return JSON.parse(localStorage.getItem(Qn)||"[]")}catch{return[]}})(),H=(()=>{try{return JSON.parse(localStorage.getItem(Ta)||"{}")}catch{return{}}})(),le=M.filter(X=>St.includes(X));le.length>0?an(le):Nr.length===0&&an(St),H&&typeof H=="object"&&Ge(X=>({...X,canceledOnly:!1,...H}))},[yt,St.length]),p.useEffect(()=>{try{localStorage.setItem(Qn,JSON.stringify(Nr))}catch{}},[Nr,Qn]),p.useEffect(()=>{try{localStorage.setItem(Ta,JSON.stringify(Be))}catch{}},[Be,Ta]);const dn=p.useMemo(()=>{const M=Nr.map(le=>Ue[le]?.hora_inicio||"06:00:00").map(le=>{const[X,Ce]=String(le).split(":").map(Number);return(X||0)*60+(Ce||0)});if(!M.length)return ZS;const H=Math.min(...M);return Math.floor(H/60)},[Nr,Ue]),Yn=p.useMemo(()=>{const M=Nr.map(le=>Ue[le]?.hora_fim||"24:00:00").map(le=>{const[X,Ce]=String(le).split(":").map(Number);return(X===0&&Ce===0?24:X||0)*60+(Ce||0)});if(!M.length)return I3;const H=Math.max(...M);return Math.ceil(H/60)},[Nr,Ue]);p.useEffect(()=>{try{je.current=dn}catch{}},[dn]),p.useEffect(()=>{try{nt.current=Yn}catch{}},[Yn]),p.useEffect(()=>{const M=new Date,H=kd(M),le=Id(M);setTimeout(()=>{if(!vs.current)return;const Ce=Math.max(0,(H-dn)*60+le)/es;vs.current.scrollTop=Math.max(0,Ce*sl-120)},150)},[dn]);const Ir=({booking:M,courtGridStart:H,courtGridEnd:le})=>{const X=sl,Ce=Ts=>{const Ys=kd(Ts),Bo=Id(Ts);return Ys===0&&Bo===0?1440:Ys*60+Bo},we=Ce(M.start),Z=Ce(M.end),ye=H!==void 0?H:zn?Q.start*60:dn*60,Ne=le!==void 0?le:zn?Q.end*60:Yn*60,Re=we-ye,bt=(Ne-ye)/es;let Rt=Math.floor(Re/es);const dr=Math.max(0,Z-we),qt=Math.max(1,Math.ceil(dr/es));let rr=Rt+qt;Rt=Math.max(0,Math.min(Rt,bt-1)),rr=Math.max(0,Math.min(rr,bt)),rr<=Rt&&(rr=Rt+1),rr=Math.min(rr,bt);const qr=Rt*X;let Dn=(rr-Rt)*X;const $r=$i[M.status]||$i.confirmed,xn=$r.icon,$n=$r.border,_n=qt===1,Ca=_n?4:NZe,Zn=qr+Ca,Mn=Math.max(_n?40:32,Dn-Ca*2),Yr=dr>=90,Sn=2,Da=1.15,Ha=Yr?(()=>{const Ts=Math.min(Math.max((dr-90)/90,0),1);return Math.min(Da+Ts*(Sn-Da),Sn)})():1,Xs=16,jo=14,jn=_n?16:24,Pn=Math.round(Xs*(Yr?Ha:1)),Rn=Math.round(jo*(Yr?Ha:1)),va=Math.round(jn*(Yr?Ha:1)),Ga=Ht[M.id]||[],hs=Ga.filter(Ts=>String(Ts.status_pagamento||"").toLowerCase()==="pago").length,to=Ga.length;return a.jsxs(Er.div,{layout:ce?!1:"position",initial:ce?!1:{opacity:0,y:6},animate:ce?!1:{opacity:1,y:0},exit:ce?!1:{opacity:0,y:6},id:`booking-${M.id}`,className:Sr("absolute left-2 right-2 rounded-md border-2 bg-surface text-sm shadow-sm z-0 cursor-pointer",$n,"overflow-hidden transition-all duration-150 hover:bg-surface-2 hover:shadow-md"),style:{top:`${Zn}px`,height:`${Mn}px`},onClick:async()=>{const Ts=hr(M),Ys=new Promise(oa=>setTimeout(oa,600));let Bo=null;try{Bo=await Promise.race([Ts,Ys])}catch{}const mo=Bo&&Bo.booking||nn.find(oa=>oa.id===M.id)||M;try{const oa=Ht[M.id]||[];console.log("[ORDER:CLICK] booking",{id:M.id,customer:mo?.customer||M.customer,partsCount:oa.length}),oa.length>0&&console.table(oa.map((is,No)=>({idx:No+1,ordem:is?.ordem,nome:is?.nome,cliente_id:is?.cliente_id}))),console.log("[ORDER:CLICK] agendamento.clientes",mo?.clientes??"(sem campo clientes)")}catch{}Wt(mo),Se()},children:[a.jsx("div",{className:Sr("absolute left-0 top-0 h-full w-[6px] rounded-l-md",$r.accent)}),a.jsxs(Er.div,{className:"flex-1 flex flex-col overflow-hidden pl-4 pr-3 py-2.5 md:pr-4 md:py-3",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[a.jsx("p",{className:"font-semibold text-text-primary truncate text-base",style:{fontSize:Pn,lineHeight:1.15},children:bU(M.customer)}),_n&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded-md px-2 py-0.5 whitespace-nowrap shadow-md",style:{fontSize:Rn},children:M.modality})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("span",{className:Sr("text-text-muted font-semibold text-base whitespace-nowrap"),style:{fontSize:Pn},children:[sr(M.start,"HH:mm"),"",sr(M.end,"HH:mm")]}),_n&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(xn,{className:Sr($r.text),style:{width:va,height:va}}),a.jsx("span",{className:Sr("truncate font-semibold",$r.text,"text-base"),style:{fontSize:Pn},children:$r.label})]}),_n&&to>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-2 py-0.5 border ${hs===to?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(11,Math.round(11*(Yr?Ha:1)))},children:[hs,"/",to]})]}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2 flex-wrap",children:[!_n&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded-md px-2.5 py-1 shadow-md",style:{fontSize:Rn},children:M.modality}),!_n&&a.jsxs("div",{className:"flex items-center gap-1.5 text-base flex-wrap justify-end",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(xn,{className:Sr($r.text),style:{width:va,height:va}}),a.jsx("span",{className:Sr("truncate font-semibold",$r.text),style:{fontSize:Pn},children:(()=>typeof window<"u"&&window.innerWidth<768&&M.status==="in_progress"?"Andamento":$r.label)()})]}),to>0&&(()=>{const Ts=typeof window<"u"&&window.innerWidth<768;return a.jsxs("span",{className:Sr("font-bold rounded-full border flex items-center gap-1 whitespace-nowrap",_n?"px-2 py-0.5 text-xs":"px-2.5 py-1 text-sm",hs===to?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"),style:{fontSize:Math.max(_n?11:13,Math.round((_n?11:13)*(Yr?Ha:1)))},children:[a.jsx(Oi,{className:"w-3 h-3 flex-shrink-0"}),a.jsxs("span",{className:"whitespace-nowrap",children:[hs,"/",to,Ts?"":" pagos"]})]})})()]})]})]})]})},wn=()=>{p.useRef(Math.random().toString(36).slice(2)),DN();const M=p.useRef(0),H=p.useRef(""),le=Le=>{if(!Le)return"";if(typeof Le=="string")return Le;const ut=Le.nome||Le.name||"",Ft=Le.codigo??Le.code;return Ft!=null?`[${Ft}] ${ut}`:ut},X=Le=>Le?typeof Le=="string"?Le:Le.nome||Le.name||"":"",Ce=Le=>{const ut=Ue[Le];if(!ut)return{start:dn*60,end:Yn*60};const[Ft,Kt]=String(ut.hora_inicio||"06:00:00").split(":").map(Number),[lr,zr]=String(ut.hora_fim||"24:00:00").split(":").map(Number),hn=lr===0&&zr===0?24:lr;return{start:Ft*60+(Kt||0),end:hn*60+(zr||0)}},we=()=>{const Le=kd(new Date),ut=Id(new Date),Ft=Le*60+ut,Kt=St[0]||"",lr=Ce(Kt);return Math.max(lr.start,Math.min(lr.end-es,Math.round(Ft/es)*es))},[Z,ye]=p.useState(()=>{let Le=[];try{if(Array.isArray(va)&&va.length>0?Le=va:Array.isArray(jn.current)&&jn.current.length>0&&(Le=jn.current),Le.length>0)try{Re.current=!0}catch{}}catch{}return{selectedClients:Le,court:(()=>St.find(Kt=>!ge[Kt]||ge[Kt].funciona)||St[0]||"")(),modality:zp[0],status:"scheduled",date:k,startMinutes:we(),endMinutes:we()+60}}),Ne=p.useRef([]),Re=p.useRef(!1),bt=p.useRef(null);p.useEffect(()=>{Ne.current=Array.isArray(Z.selectedClients)?Z.selectedClients:[];try{(Ne.current||[]).length>0&&(Re.current=!0)}catch{}},[Z.selectedClients]);const[Rt,dr]=p.useState(!1),[qt,rr]=p.useState(""),qr=p.useRef(""),Dn=p.useRef(""),$r=p.useCallback(Le=>{try{qr.current=String(Le||""),Dn.current=new Error("selectedClients:set").stack||""}catch{}},[]),xn=p.useRef(!1);p.useEffect(()=>{try{if(!ce||!Oe?.id||xn.current)return;const Le=Ht[Oe.id]||[];if(!Array.isArray(Le)||Le.length===0)return;const ut=Le.map(lr=>({id:lr.cliente_id,nome:lr.nome,codigo:lr.codigo??null})),Ft=Array.isArray(Z.selectedClients)?Z.selectedClients:[];if(!(Ft.length===ut.length&&Ft.every((lr,zr)=>lr&&ut[zr]&&lr.id===ut[zr].id))){try{$r("edit:apply-from-participants")}catch{}ye(lr=>({...lr,selectedClients:ut}));try{jn.current=ut}catch{}try{hs(ut)}catch{}try{Re.current=!0}catch{}try{kn.current=Date.now()+1500}catch{}try{console.log("[ORDER:OPEN_MODAL] chips (aplicados)",ut.map(lr=>lr.nome)),console.table(Le.map((lr,zr)=>({idx:zr+1,ordem:lr?.ordem,nome:lr?.nome,cliente_id:lr?.cliente_id})))}catch{}}xn.current=!0}catch{}},[ce,Oe?.id,Ht]),p.useEffect(()=>{try{if(!ce)return;const Le=Array.isArray(Z.selectedClients)?Z.selectedClients:[];if(Le.length>0&&console.log("[ORDER:CHIPS] atual:",Le.map(ut=>ut.nome)),Oe?.id){const ut=Array.isArray(Ht?.[Oe.id])?Ht[Oe.id]:[],Ft=ut.map(zr=>String(zr?.cliente_id??"")),Kt=Le.map(zr=>String(zr?.id??""));if(Ft.length>0&&Ft.join("|")!==Kt.join("|")){console.warn("[ORDER:CHIPS][MISMATCH]",{bookingId:Oe.id,ref:ut.map(zr=>({ordem:zr?.ordem,nome:zr?.nome,id:zr?.cliente_id})),cur:Le.map((zr,hn)=>({idx:hn+1,nome:zr?.nome,id:zr?.id})),lastReason:qr.current});try{console.warn(Dn.current)}catch{}}}}catch{}},[ce,Z.selectedClients,Oe?.id,Ht]);const[$n,_n]=p.useState(0),un=p.useRef(0),Ca=p.useRef(!1);p.useEffect(()=>{const Le=()=>{try{if(document.visibilityState==="hidden"){Ca.current=!!(Gr||Rt);const ut=Date.now();try{kn.current=ut+1200}catch{}try{Xt.current=ut+1200}catch{}try{un.current=ut+800}catch{}}else if(document.visibilityState==="visible"){const ut=Ca.current;Ca.current=!1;const Ft=Date.now();try{kn.current=Math.max(kn.current||0,Ft+600)}catch{}try{Xt.current=Math.max(Xt.current||0,Ft+600)}catch{}try{un.current=Math.max(un.current||0,Ft+400)}catch{}ut&&!jt.current&&setTimeout(()=>{jt.current||(dr(!0),ar(!0))},60)}}catch{}};return document.addEventListener("visibilitychange",Le),()=>document.removeEventListener("visibilitychange",Le)},[Gr,Rt,ce]),p.useEffect(()=>{},[Rt,Gr]);const Zn=p.useRef(0);p.useEffect(()=>{const Le=Array.isArray(Z.selectedClients)?Z.selectedClients.length:-1,ut=Zn.current;Le!==ut&&(Zn.current=Le)},[Z.selectedClients,Rt,Gr]);const[Mn,Yr]=p.useState(!1),[Sn,Da]=p.useState(null),[Ha,Xs]=p.useState(!1),jo=p.useRef(!1),jn=p.useRef([]),Pn=p.useRef("init"),Rn=p.useRef(!1),[va,Ga]=p.useState([]),hs=p.useCallback(Le=>{Ga(Le)},[]),to=p.useRef(null),Ts=p.useRef(null),Ys=p.useRef([]);p.useEffect(()=>{Gr&&Ys.current[$n]&&Ys.current[$n]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[$n,Gr]),p.useEffect(()=>{Gr&&_n(0)},[Gr]);const[Bo,mo]=p.useState(!1),[oa,is]=p.useState(!1);p.useState(!1);const[No,el]=p.useState(!1);p.useEffect(()=>{if(!s)return;let Le=!1;return(async()=>{try{if(!F||!P?.codigo_empresa)return;const ut=await Ah({somenteAtivas:!0,codigoEmpresa:P.codigo_empresa});Le||b(Array.isArray(ut)?ut:[])}catch{}})(),()=>{Le=!0}},[s,F,P?.codigo_empresa]),p.useEffect(()=>{if(!s||!Array.isArray(v)||v.length===0)return;const Le=String(v[0].id);x(ut=>ut.length===0&&Array.isArray(Z.selectedClients)&&Z.selectedClients.length>0?Z.selectedClients.map(lr=>({cliente_id:lr.id,nome:lr.nome,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:Le})):ut.map(Kt=>({...Kt,finalizadora_id:Kt.finalizadora_id&&Kt.finalizadora_id!==""?Kt.finalizadora_id:Le})))},[s,v]);const Ds=p.useCallback((Le,ut)=>{try{const Ft=Date.now(),Kt=Ft<(Rl.current||0)||Ft<(Xt.current||0),lr=!Gr,zr=!!Rn.current;let hn=Array.isArray(ut)?ut:[];if(hn.length===0&&lr&&Kt&&!zr){const fn=Array.isArray(jn.current)?jn.current:[];fn.length>0&&(hn=fn)}try{if(!Oe&&Array.isArray(hn)&&hn.length>0&&bt.current){const fn=hn.findIndex(ya=>ya&&ya.id===bt.current);fn>0&&(hn=[hn[fn],...hn.filter((Za,Fa)=>Fa!==fn)])}}catch{}try{$r(`applySelectedClients:${Le}`)}catch{}ye(fn=>({...fn,selectedClients:hn})),Array.isArray(hn)&&hn.length>0&&(jn.current=hn,hs(hn),Rn.current=!1);try{Pn.current=Le}catch{}}catch{}},[Gr,ye,hs]);p.useState(""),p.useRef(null),p.useEffect(()=>{try{rt.current=Date.now()}catch{}},[Rt,oa]),p.useEffect(()=>{if(w){if(Dt.current=Rt,Rt)A("customer-picker",6e3),S("picker:open"),Tr.current=!0,ar(!0);else if(S("picker:close"),C("picker-close"),cn.current){cn.current=!1;try{_("Picker closed: flushing pending refresh"),S("picker:flush"),cr()}catch{}}}},[Rt]);const ho=p.useCallback((Le,ut={})=>{if(w)try{const Ft=new Date().toISOString(),Kt=ur.current,lr=!!Tr.current,zr=!!jo.current}catch{}},[w,ce,Rt,Gr,oa,Mn]);p.useEffect(()=>{w&&ho("state-change",{isCustomerPickerOpen:Rt,effectiveCustomerPickerOpen:Gr})},[w,Rt,Gr]),p.useEffect(()=>{if(!ce||Gr)return;const Le=Array.isArray(Z.selectedClients)?Z.selectedClients:[],ut=Array.isArray(jn.current)?jn.current:[],Ft=Date.now()<(kn.current||0);if(Le.length===0&&ut.length>0&&!Rn.current&&Ft)Pn.current="global:restore",ye(Kt=>({...Kt,selectedClients:ut}));else if(Le.length===0&&ut.length>0&&Rn.current&&!Ft)try{jn.current=[]}catch{}},[ce,Gr,Z.selectedClients]),p.useEffect(()=>{if(!ce)return;let Le=Tr.current;try{const Ft=localStorage.getItem("agenda:customerPicker:desiredAt");if(Ft){const Kt=Number(Ft);Number.isFinite(Kt)&&Date.now()-Kt<3e3&&(Le=!0)}}catch{}if(!Le||Rt||Date.now()<Xt.current||te())return;const ut=Date.now();ut-qn.current<800||(qn.current=ut,ur.current="open",dr(!0),ar(!0))},[Rt,ce]),p.useEffect(()=>{const Le=Array.isArray(Z.selectedClients)?Z.selectedClients:[];Le.length>0&&(jn.current=Le,hs(Le))},[Z.selectedClients]),p.useEffect(()=>{if(!ce||Gr||Tr.current)return;const Le=Array.isArray(Z.selectedClients)?Z.selectedClients:[],ut=(()=>{const Ft=Array.isArray(jn.current)?jn.current:[];return Ft&&Ft.length>0?Ft:[]})();Le.length===0&&ut.length>0&&!Rn.current&&(ye(Ft=>({...Ft,selectedClients:ut})),jo.current=!1)},[Gr,ce]);const bs=p.useRef(0);p.useEffect(()=>{try{const Le=Date.now(),ut=Array.isArray(Ne.current)?Ne.current:[],Ft=Array.isArray(jn.current)?jn.current:[];if(Le-bs.current>300&&(bs.current=Le),ce&&!Gr&&ut.length===0&&Ft.length>0&&!Rn.current){try{Rl.current=Date.now()+2e3}catch{}try{const Kt=Xt?.current||0,lr={ts:new Date().toISOString(),reason:"empty-after-close",modalOpen:ce,pickerOpen:Gr,formLen:Array.isArray(Z?.selectedClients)?Z.selectedClients.length:NaN,curLen:ut.length,lastLen:Ft.length,clearedByUser:!!Rn?.current,lastAction:Pn?.current,chipsLen:Array.isArray(va)?va.length:NaN,clientsLoading:!!oa,suppressUntil:Kt}}catch{}hs(Ft),ye(Kt=>({...Kt,selectedClients:[...Ft]}));try{Promise.resolve().then(()=>{ye(Kt=>({...Kt,selectedClients:[...jn.current]}))})}catch{}try{requestAnimationFrame(()=>{ye(Kt=>({...Kt,selectedClients:[...jn.current||[]]}))})}catch{}setTimeout(()=>{const Kt=Array.isArray(Ne.current)?Ne.current:[],lr=Array.isArray(jn.current)?jn.current:[];Kt.length===0&&lr.length>0&&ye(zr=>({...zr,selectedClients:[...lr]}))},25),setTimeout(()=>{const Kt=Array.isArray(Ne.current)?Ne.current:[],lr=Array.isArray(jn.current)?jn.current:[];Kt.length===0&&lr.length>0&&ye(zr=>({...zr,selectedClients:[...lr]}))},120),setTimeout(()=>{const Kt=Array.isArray(Ne.current)?Ne.current:[],lr=Array.isArray(jn.current)?jn.current:[];Kt.length===0&&lr.length>0&&ye(zr=>({...zr,selectedClients:[...lr]}))},240)}}catch{}},[Z.selectedClients,Gr,ce]),p.useEffect(()=>{try{const Le=now<(Rl.current||0),ut=Array.isArray(Ne.current)?Ne.current:[],Ft=Array.isArray(jn.current)?jn.current:[],Kt=now<(kn.current||0);if(ce&&!Gr&&(Le||Kt)&&ut.length===0&&Ft.length>0&&!Rn.current){Ga(Ft),ye(lr=>({...lr,selectedClients:[...Ft]}));try{requestAnimationFrame(()=>ye(lr=>({...lr,selectedClients:[...jn.current||[]]})))}catch{}setTimeout(()=>ye(lr=>({...lr,selectedClients:[...jn.current||[]]})),32),setTimeout(()=>ye(lr=>({...lr,selectedClients:[...jn.current||[]]})),96)}}catch{}},[Z.selectedClients,Gr,ce]),p.useEffect(()=>{Date.now()<(Te.current||0)},[Z.selectedClients,ce,Gr]);const[Oo,wx]=p.useState([]);p.useEffect(()=>{s&&wx([])},[s]);const Fl=p.useRef(!1),Ll=p.useRef(!1),[_x,mu]=p.useState(null);p.useState(null);const ef=p.useRef(!1);p.useEffect(()=>{const Le=Array.isArray(Z.selectedClients)?Z.selectedClients:[],ut=_x,Ft=ut&&Le.some(Kt=>Kt&&Kt.id===ut);if(Le.length>0&&!Ft){let Kt=Le[0]?.id||null;try{if(Oe?.id){const lr=Ht?.[Oe.id]||[],zr=Array.isArray(lr)?lr.find(hn=>hn?.is_representante===!0):null;zr?.cliente_id&&Le.some(hn=>String(hn?.id)===String(zr.cliente_id))&&(Kt=zr.cliente_id)}}catch{}mu(Kt)}else Le.length===0&&ut&&mu(null)},[Z.selectedClients,ce,Oe,Ht]);const zf=p.useRef(!1),tf=p.useRef(!1),[ji,rf]=p.useState(Ya),Ip=p.useRef(0);p.useEffect(()=>{if(!(Date.now()<(Te.current||0)))if(oa){Ip.current||(Ip.current=Date.now());const ut=setTimeout(()=>{oa&&(!Array.isArray(ji)||ji.length===0)&&is(!1)},2e3);return()=>clearTimeout(ut)}else Ip.current=0},[oa,ji]);const Um=p.useMemo(()=>Array.isArray(Z.selectedClients)?Z.selectedClients:[],[Z.selectedClients]),BA=p.useMemo(()=>{const Le=Um||[];if(Le.length===0)return"Adicionar clientes";const ut=Le[0]?.nome||"Cliente",Ft=Le.length-1;return Ft>0?`${ut} +${Ft}`:ut},[Um]),by=p.useMemo(()=>{const Le=Array.isArray(Z.selectedClients)?Z.selectedClients:[],ut=Array.isArray(Ne.current)?Ne.current:[],Ft=Array.isArray(jn.current)?jn.current:[],Kt=Array.isArray(va)?va:[];return Le.length>0&&Le.every(lr=>lr?.nome)?Le:Le.length>0?Le.map(lr=>{if(lr?.nome)return lr;const zr=ut.find(Za=>Za?.id===lr?.id),hn=Ft.find(Za=>Za?.id===lr?.id),fn=Kt.find(Za=>Za?.id===lr?.id),ya=(ji||[]).find(Za=>Za?.id===lr?.id);return{...lr,nome:zr?.nome||hn?.nome||fn?.nome||ya?.nome||lr?.nome||"Cliente"}}):ut.length>0&&ut.every(lr=>lr?.nome)?ut:Kt.length>0&&Kt.every(lr=>lr?.nome)?Kt:Ft.length>0&&Ft.every(lr=>lr?.nome)?Ft:Le},[Z.selectedClients,va,ji]),qA=!!(ce&&Oe?.id&&!(Array.isArray(Ht?.[Oe.id])&&Ht[Oe.id].length>0));p.useEffect(()=>{if(!(Date.now()<(Te.current||0)))try{_("Chips:effective change",{effectiveLen:Array.isArray(Um)?Um.length:0,formLen:Array.isArray(Z.selectedClients)?Z.selectedClients.length:0,lastLen:Array.isArray(jn.current)?jn.current.length:0,pickerOpen:Rt})}catch{}},[Um,Z.selectedClients,Rt]);const wy=p.useRef(null),_y=p.useRef(!1);p.useEffect(()=>{if(ce){Array.isArray(Ya)&&Ya.length>0&&rf(Ya);try{if(!ji||ji.length===0){const Le=P?.codigo_empresa?`clientes:list:${P.codigo_empresa}`:null;if(Le){const ut=JSON.parse(localStorage.getItem(Le)||"[]");Array.isArray(ut)&&ut.length>0&&rf(ut)}}}catch{}}},[ce,Ya]),p.useEffect(()=>{ce||(wy.current=null,is(!1))},[ce]),p.useEffect(()=>{ce||(Fl.current=!1,Ll.current=!1,el(!1),tf.current=!1)},[ce]);const jy=p.useRef(!1);p.useEffect(()=>{if(ce&&!jy.current?jy.current=!0:!ce&&jy.current,Oe)Uf.current=!1;else{if(Uf.current)return;Uf.current=!0;try{if(Date.now()<(M.current||0))return}catch{}try{Tr.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{Rn.current=!1}catch{}try{try{jn.current=[]}catch{}try{Ga([])}catch{}ye(Le=>({...Le,selectedClients:[]}))}catch{}}},[ce,Oe]);const Uf=p.useRef(!1);p.useEffect(()=>{if(!ce){Uf.current=!1;try{H.current="";try{jn.current=[]}catch{}try{Ga([])}catch{}try{Re.current=!1}catch{}try{M.current=0}catch{}try{kn.current=0}catch{}Tt(!1),Jr(4);try{Xt.current=0}catch{}try{ur.current=null}catch{}try{Tr.current=!1}catch{}ye(Le=>({...Le,selectedClients:[]})),mu(null)}catch{}return}if(Oe)Uf.current=!1;else{if(Uf.current)return;Uf.current=!0;try{if(Date.now()<(M.current||0))return}catch{}try{Tr.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{Rn.current=!1}catch{}try{try{jn.current=[]}catch{}try{Ga([])}catch{}ye(Le=>({...Le,selectedClients:[]}))}catch{}}},[ce,Oe]);const Sd=p.useCallback(async(Le={})=>{const{autoSave:ut=!1}=Le;if(!No){el(!0);try{const Ft=Ue[Z.court];if(!Ft){t({title:"Selecione uma quadra",variant:"destructive"}),Fl.current=!1,Ll.current=!1;return}const Kt=Z.startMinutes,lr=Z.endMinutes;if(!(Number.isFinite(Kt)&&Number.isFinite(lr)&&lr>Kt)){t({title:"Horrio invlido",variant:"destructive"}),Fl.current=!1,Ll.current=!1;return}if(!nf(Kt,lr)){t({title:"Conflito de horrio",description:"O horrio selecionado est ocupado.",variant:"destructive"}),Fl.current=!1,Ll.current=!1;return}const hn=(ws,Ws)=>new Date(ws.getFullYear(),ws.getMonth(),ws.getDate(),Math.floor(Ws/60),Ws%60,0,0),fn=hn(Z.date,Kt),ya=hn(Z.date,lr);let Za=Array.isArray(Z.selectedClients)&&Z.selectedClients.length>0?Z.selectedClients:Array.isArray(Ne.current)?Ne.current:[];if((!Za||Za.length===0)&&Oe?.id)try{const ws=Array.isArray(jn.current)?jn.current:[];ws&&ws.length>0&&(Za=ws,ye(Ws=>({...Ws,selectedClients:ws})))}catch{}const Fa=[...Za];console.log(" [FIX] selNowSnapshot criado:",Fa.length,"participantes"),console.log(" [FIX] form.selectedClients:",Z.selectedClients?.length||0),console.log(" [FIX] editingBooking.id:",Oe?.id),console.log(" [LOG 3 - FECHAR MODAL AGENDAMENTO] Estado ao salvar:"),console.log("   Participantes selecionados:",Fa.length),Fa.forEach((ws,Ws)=>{console.log(`   #${Ws+1}: ${ws.nome}`)}),console.log("   participantsForm (contexto):",(m||[]).length),(m||[]).forEach((ws,Ws)=>{console.log(`   #${Ws+1}: ${ws.nome} | Status: ${ws.status_pagamento} | Valor: ${ws.valor_cota}`)});let Jn=Fa,di=!1,Li=!1;if(Oe?.id){const Ws=(Ht[Oe.id]||[]).map(E=>String(E?.cliente_id??"")),bl=Fa.map(E=>String(E?.id??"")),Yo=Ws.join("|"),Bl=bl.join("|");Li=Yo!==Bl;const ds=[...Ws].sort().join("|"),N=[...bl].sort().join("|");di=ds!==N,console.log(" [DEBUG] Comparao de ordem:"),console.log("   ordemAtual:",Bl),console.log("   ordemBanco:",Yo),console.log("   mudouOrdem:",Li),console.log("   mudouParticipantes:",di)}const yl=di||Li;let Ad=0;(!Number.isFinite(Ad)||Ad<0||Ad>=(Jn||[]).length)&&(Ad=0);const $l=Jn[0],Pd=Jn.map(X).filter(Boolean);if(!Oe?.id&&!$l?.id){t({title:"Selecione um cliente",description:"Para criar um agendamento, selecione pelo menos um cliente.",variant:"destructive"});return}if(Oe?.id){const ws=Oe.status,Ws=Z.status!==ws,bl={quadra_id:Ft.id,cliente_id:$l?.id??null,clientes:Pd,inicio:fn.toISOString(),fim:ya.toISOString(),modalidade:Z.modality};if(!Ws){let K=Z.status;try{const fe=Zi(),be=fn.getTime();if(!!ts?.autoConfirmEnabled&&Number.isFinite(Number(ts?.autoConfirmMinutesBefore))){const Pe=Number(ts.autoConfirmMinutesBefore)*6e4,Ie=be-Pe;K==="confirmed"&&fe<Ie?K="scheduled":K==="scheduled"&&fe>=Ie&&(K="confirmed")}}catch{}bl.status=K}const{error:Yo}=await re.from("agendamentos").update(bl).eq("codigo_empresa",P.codigo_empresa).eq("id",Oe.id);if(Yo)throw Yo;const{data:Bl}=await re.from("agendamento_participantes").select("*").eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0}),ds=Bl||[],N=(ds||[]).some(K=>{const fe=Number(K?.valor_cota)||0,be=K?.status_pagamento||"Pendente";return fe>0||be==="Pago"});if(console.log(" [SAVE-BOOKING] houveMudancaDeParticipantes:",di),console.log(" [SAVE-BOOKING] currentArray.length:",ds.length),console.log(" [SAVE-BOOKING] selNowFinal.length:",Jn.length),console.log(" [SAVE-BOOKING] hasPayments:",N),yl)if(!Jn||Jn.length===0)console.error(" [SAVE-BOOKING] PROTEO ACIONADA: No vou deletar participantes com selNowFinal vazio!"),console.error(" [SAVE-BOOKING] Isso evita perda de dados. Verifique por que selNowFinal est vazio.");else if(N){try{const xe=(ds||[]).map(Pe=>Pe?.id).filter(Boolean);if(xe.length>0){const{error:Pe}=await re.from("agendamento_participantes").update({ordem:null,is_representante:!1}).in("id",xe).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id).is("deleted_at",null);Pe&&console.error("Erro ao liberar ordens antes do update (com pagamentos):",Pe)}}catch(xe){console.error("Erro inesperado ao liberar ordens antes do update (com pagamentos):",xe)}const K=new Map;try{(ds||[]).forEach(xe=>{const Pe=String(xe?.cliente_id??""),Ie=K.get(Pe)||[];Ie.push(xe),K.set(Pe,Ie)})}catch{}const fe=new Map,be=new Set;for(let xe=0;xe<Jn.length;xe++){const Pe=Jn[xe];if(!Pe?.id)continue;const Ie=String(Pe.id),We=fe.get(Ie)||0,Vt=(K.get(Ie)||[])[We]||null;if(fe.set(Ie,We+1),Vt?.id){be.add(Vt.id);const Ve={cliente_id:Pe.id,nome:Vt.nome??Pe.nome,ordem:xe+1,is_representante:xe===Ad,deleted_at:null},{error:At}=await re.from("agendamento_participantes").update(Ve).eq("id",Vt.id).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id);At&&console.error("Erro ao atualizar participante (com pagamentos):",At)}else{const Ve={codigo_empresa:P.codigo_empresa,agendamento_id:Oe.id,cliente_id:Pe.id,nome:Pe.nome,ordem:xe+1,valor_cota:0,status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1,pago_em:null,is_representante:xe===Ad,deleted_at:null},{error:At}=await re.from("agendamento_participantes").insert([Ve]);At&&console.error("Erro ao inserir participante (com pagamentos):",At)}}try{const xe=(ds||[]).filter(Pe=>Pe?.id&&!be.has(Pe.id)).map(Pe=>Pe.id);if(xe.length>0){const{error:Pe}=await re.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).in("id",xe).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id);Pe&&console.error("Erro ao remover participantes (com pagamentos):",Pe)}}catch{}}else{const K=Math.min(ds.length,Jn.length);try{const fe=(ds||[]).map(be=>be?.id).filter(Boolean);if(fe.length>0){const{error:be}=await re.from("agendamento_participantes").update({ordem:null,is_representante:!1}).in("id",fe).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id).is("deleted_at",null);be&&console.error("Erro ao liberar ordens antes do update:",be)}}catch(fe){console.error("Erro inesperado ao liberar ordens antes do update:",fe)}try{await re.from("agendamento_participantes").update({is_representante:!1}).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id).is("deleted_at",null)}catch{}for(let fe=0;fe<K;fe++){const be=ds[fe],xe=Jn[fe];if(!be?.id||!xe?.id)continue;const Pe=String(be.cliente_id)===String(xe.id),Ie={cliente_id:xe.id,nome:xe.nome,ordem:fe+1,is_representante:!1,deleted_at:null};Pe||(Ie.valor_cota=0,Ie.status_pagamento="Pendente",Ie.finalizadora_id=null,Ie.aplicar_taxa=!1,Ie.pago_em=null);const{error:We}=await re.from("agendamento_participantes").update(Ie).eq("id",be.id).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id);We&&console.error("Erro ao atualizar participante:",We)}if(Jn.length<ds.length){const fe=ds.slice(Jn.length).map(be=>be?.id).filter(Boolean);if(fe.length>0){const{error:be}=await re.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).in("id",fe).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id);be&&console.error("Erro ao remover participantes:",be)}}if(Jn.length>ds.length){const fe=ds.length,be=Jn.slice(fe).map((xe,Pe)=>({codigo_empresa:P.codigo_empresa,agendamento_id:Oe.id,cliente_id:xe.id,nome:xe.nome,ordem:fe+Pe+1,valor_cota:0,status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1,pago_em:null,is_representante:!1,deleted_at:null}));if(be.length>0){const{error:xe}=await re.from("agendamento_participantes").insert(be);xe&&console.error("Erro ao inserir participantes:",xe)}}try{const fe=Ad+1;if(Number.isFinite(fe)&&fe>0){const{error:be}=await re.from("agendamento_participantes").update({is_representante:!0}).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id).eq("ordem",fe).is("deleted_at",null);be&&console.error("Erro ao marcar representante:",be)}}catch{}}const E=$l?.nome||$l?.name||X($l)||Pd[0]||Oe.customer,q={...Oe,court:Z.court,customer:E,start:fn,end:ya,modality:Z.modality,...Ws?{}:{status:bl.status??Z.status}};if(rn(K=>K.map(fe=>fe.id===Oe.id?q:fe)),Wt(q),Ws)try{Xe(!1),await Bt(Oe.id,Z.status,"user")}catch{}if(ut||t({title:"Agendamento atualizado"}),Ll.current=!0,Fl.current=!1,!N||yl){const K=new Map;try{(ds||[]).forEach(xe=>{const Pe=String(xe?.cliente_id??""),Ie=K.get(Pe)||[];Ie.push(xe),K.set(Pe,Ie)})}catch{}const fe=new Map,be=Jn.map((xe,Pe)=>{const Ie=String(xe?.id??""),We=fe.get(Ie)||0,Vt=(K.get(Ie)||[])[We]||null;fe.set(Ie,We+1);const Ve=!!Vt;return{cliente_id:xe.id,nome:xe.nome,codigo:xe.codigo||null,valor_cota:Ve?Vt.valor_cota??0:0,status_pagamento:Ve?Vt.status_pagamento??"Pendente":"Pendente",finalizadora_id:Ve?Vt.finalizadora_id??null:null,aplicar_taxa:Ve?Vt.aplicar_taxa??!1:!1,ordem:Pe+1,is_representante:Pe===Ad,deleted_at:null}});mr(xe=>({...xe,[Oe.id]:be})),console.log(" [FIX] houveMudancaDeParticipantes =",di),di?(console.log(" [FIX] Mudana de participantes detectada - reconstruindo participantsForm"),x(be.map(xe=>({cliente_id:xe.cliente_id,nome:xe.nome,codigo:xe.codigo,valor_cota:xe.valor_cota?qp(String(Number(xe.valor_cota).toFixed(2))):"",status_pagamento:xe.status_pagamento,finalizadora_id:xe.finalizadora_id?String(xe.finalizadora_id):v?.[0]?.id?String(v[0].id):null,aplicar_taxa:xe.aplicar_taxa})))):(console.log(" [FIX] Sem mudana de participantes - preservando dados de pagamento do contexto"),x(xe=>{const Pe=Array.isArray(xe)?xe:[],Ie=new Map;try{Pe.forEach(Vt=>{const Ve=String(Vt?.cliente_id??""),At=Ie.get(Ve)||[];At.push(Vt),Ie.set(Ve,At)})}catch{}const We=new Map,_t=be.map(Vt=>{const Ve=String(Vt?.cliente_id??""),At=We.get(Ve)||0,Or=(Ie.get(Ve)||[])[At]||null;return We.set(Ve,At+1),Or?{cliente_id:Vt.cliente_id,nome:Or.nome||Vt.nome,codigo:Or.codigo??Vt.codigo,valor_cota:Or.valor_cota||Vt.valor_cota,status_pagamento:Or.status_pagamento||Vt.status_pagamento,finalizadora_id:Or.finalizadora_id??Vt.finalizadora_id,aplicar_taxa:Or.aplicar_taxa??Vt.aplicar_taxa}:Vt});return console.log(" [FIX] Dados de pagamento preservados:",_t),_t.length>0?_t:be})),console.log(" [LOG 3 - RESULTADO FINAL] participantsForm aps atualizao:"),console.log("   Total:",be.length),be.forEach((xe,Pe)=>{console.log(`   #${Pe+1}: ${xe.nome} | Status: ${xe.status_pagamento} | Valor: ${xe.valor_cota}`)})}if(r().catch(K=>{console.error("[AgendaPage] Erro ao recarregar alertas:",K)}),!ut){try{jn.current=[]}catch{}try{Ga([])}catch{}Xe(!1)}return}let Vm=null;try{const{data:ws}=await re.from("agendamentos").select("id, status, codigo").eq("codigo_empresa",P.codigo_empresa).eq("quadra_id",Ft.id).eq("inicio",fn.toISOString()).eq("fim",ya.toISOString()).limit(1);Array.isArray(ws)&&ws.length>0&&(Vm=ws[0])}catch{}if(Vm?.id&&Vm.status!=="canceled"){const ws={id:Vm.id,code:Vm.codigo,court:Z.court,customer:$l?.nome||Pd[0]||"",start:fn,end:ya,status:Z.status,modality:Z.modality};rn(Ws=>Ws.some(Yo=>Yo.id===Vm.id)?Ws:[...Ws,ws]),t({title:"Agendamento confirmado"}),Ll.current=!0,Xe(!1);return}if(Qt&&nr>1){const ws=[],Ws=[];for(let ds=0;ds<nr;ds++){const N=rs(Z.date,ds*7),E=new Date(N);E.setHours(Math.floor(Z.startMinutes/60),Z.startMinutes%60,0,0);const q=new Date(N);q.setHours(Math.floor(Z.endMinutes/60),Z.endMinutes%60,0,0),ws.push({codigo_empresa:P.codigo_empresa,quadra_id:Ft.id,cliente_id:$l?.id??null,clientes:Pd,inicio:E.toISOString(),fim:q.toISOString(),modalidade:Z.modality,status:Z.status})}const{data:bl,error:Yo}=await re.from("agendamentos").insert(ws).select("id, codigo, inicio, fim");if(Yo)throw Yo;const Bl=[];for(const ds of bl){const N=Jn.map((E,q)=>({codigo_empresa:P.codigo_empresa,agendamento_id:ds.id,cliente_id:E.id,nome:E.nome,valor_cota:0,status_pagamento:"Pendente",ordem:q+1}));Bl.push(...N),Ws.push({id:ds.id,code:ds.codigo,court:Z.court,customer:$l?.nome||Pd[0]||"",start:new Date(ds.inicio),end:new Date(ds.fim),status:Z.status,modality:Z.modality})}Bl.length>0&&await re.from("agendamento_participantes").insert(Bl),rn(ds=>[...ds,...Ws]),t({title:`${nr} Agendamentos criados!`,description:"Agendamentos recorrentes criados com sucesso.",variant:"success"}),Tt(!1),Jr(4)}else{const{data:ws,error:Ws}=await re.from("agendamentos").insert({codigo_empresa:P.codigo_empresa,quadra_id:Ft.id,cliente_id:$l?.id??null,clientes:Pd,inicio:fn.toISOString(),fim:ya.toISOString(),modalidade:Z.modality,status:Z.status}).select("id, codigo").single();if(Ws)throw Ws;const bl={id:ws.id,code:ws.codigo,court:Z.court,customer:$l?.nome||Pd[0]||"",start:fn,end:ya,status:Z.status,modality:Z.modality};rn(Yo=>[...Yo,bl]),t({title:"Agendamento criado",variant:"success",duration:2e3}),r().catch(Yo=>{console.error("[AgendaPage] Erro ao recarregar alertas:",Yo)});try{const Yo=Jn.map((Bl,ds)=>({codigo_empresa:P.codigo_empresa,agendamento_id:ws.id,cliente_id:Bl.id,nome:Bl.nome,valor_cota:0,status_pagamento:"Pendente",ordem:ds+1,is_representante:ds===0,deleted_at:null}));if(Yo.length>0){const{error:Bl}=await re.from("agendamento_participantes").insert(Yo);if(!Bl){const ds=Yo.map(N=>({agendamento_id:N.agendamento_id,cliente_id:N.cliente_id,nome:N.nome,codigo:Jn.find(E=>E.id===N.cliente_id)?.codigo||null,valor_cota:N.valor_cota,status_pagamento:N.status_pagamento,ordem:N.ordem}));mr(N=>({...N,[ws.id]:ds}))}}}catch{}}Ll.current=!0,Fl.current=!1;try{jn.current=[]}catch{}try{Ga([])}catch{}Xe(!1)}catch(Ft){t({title:"Erro ao salvar agendamento",description:Ft?.message||"Tentando novamente automaticamente",variant:"destructive"})}finally{el(!1)}}},[No,Ue,Z,Oe,P,nf,rn,t,Xe,Bt]),Op=p.useCallback(async()=>{if(!Oe?.id){Xe(!1),Wt(null),Io(null),ef.current=!1,Tt(!1),Jr(4);return}try{await Sd({autoSave:!0})}catch(Le){console.error(" [Close] Erro ao salvar ao fechar modal:",Le)}finally{try{jn.current=[]}catch{}try{Ga([])}catch{}Xe(!1),Wt(null),Io(null),ef.current=!1,Tt(!1),Jr(4)}},[Oe?.id,Sd,Ga,Wt,Xe,Io]);p.useEffect(()=>{const Le=async()=>{if(!ce||!P?.codigo_empresa)return;const ut=String(P.codigo_empresa);if(wy.current!==ut)try{is(!0);try{const lr=`clientes:list:${P.codigo_empresa}`,zr=JSON.parse(localStorage.getItem(lr)||"[]");if(Array.isArray(zr)&&zr.length>0){rf(zr);try{za(hn=>JSON.stringify(hn)===JSON.stringify(zr)?hn:zr)}catch{}}}catch{}const{data:Ft,error:Kt}=await re.from("clientes").select("id, nome, codigo, email, telefone, status, codigo_empresa, is_consumidor_final").eq("codigo_empresa",P.codigo_empresa).eq("status","active").eq("flag_cliente",!0).order("nome",{ascending:!0});if(Kt){console.error("Falha ao carregar clientes:",Kt);return}if(Array.isArray(Ft)){if(Ft.length===0){let lr=0;try{const zr=`clientes:list:${P.codigo_empresa}`,hn=JSON.parse(localStorage.getItem(zr)||"[]");lr=Array.isArray(hn)?hn.length:0}catch{}if(lr>0&&!_y.current){_y.current=!0,setTimeout(Le,700);return}}_y.current=!1,wy.current=ut,rf(Ft);try{const lr=`clientes:list:${P.codigo_empresa}`;localStorage.setItem(lr,JSON.stringify(Ft))}catch{}try{za(lr=>JSON.stringify(lr)===JSON.stringify(Ft)?lr:Ft)}catch{}}}catch{}finally{is(!1)}};Le()},[ce,P?.codigo_empresa]),p.useEffect(()=>{try{if(Oe?.id){const zr=Oe?.valor_total,hn=Number(zr);if(zr!=null&&zr!==""&&Number.isFinite(hn)){y(qp(String(hn.toFixed(2))));return}}}catch{}const Le=Ue[Z.court];if(!Le)return;const ut=Number(Le.valor||0);if(!Number.isFinite(ut)||ut<=0)return;const Ft=Math.max(0,Z.endMinutes-Z.startMinutes);if(Ft<=0)return;const Kt=Ft/es,lr=Math.round(ut*Kt*100)/100;y(qp(String(lr.toFixed(2))))},[Ue,Z.court,Z.startMinutes,Z.endMinutes]),p.useEffect(()=>{if(ce&&!tf.current)if(Oe){const Le=kd(Oe.start)*60+Id(Oe.start),ut=kd(Oe.end)*60+Id(Oe.end),Ft=(()=>{try{if((St||[]).includes(Oe.court))return Oe.court;const fn=Oe.court_id;if(fn!=null){const ya=(Ye||[]).find(Za=>String(Za.id)===String(fn));if(ya?.nome)return ya.nome}}catch{}return(St||[])[0]||""})(),Kt=Ht[Oe.id]||[],lr=Kt.filter(fn=>fn&&fn.cliente_id).map(fn=>({id:fn.cliente_id,nome:fn.nome,codigo:fn.codigo||null})),zr=Ue[Ft]?.modalidades||zp,hn=zr.includes(Oe.modality)?Oe.modality:zr[0]||"";try{$r("edit:init-from-cache")}catch{}ye({selectedClients:lr,court:Ft,modality:hn,status:Oe.status,date:so(Oe.start),startMinutes:Le,endMinutes:ut}),zf.current=!0,x(Kt.map(fn=>({cliente_id:fn.cliente_id,nome:fn.nome,codigo:fn.codigo,valor_cota:(()=>{const ya=Number.isFinite(Number(fn.valor_cota))?Number(fn.valor_cota):Jf(fn.valor_cota);return qp(String((Number.isFinite(ya)?ya:0).toFixed(2)))})(),status_pagamento:fn.status_pagamento||"Pendente",finalizadora_id:fn.finalizadora_id||null,aplicar_taxa:fn.aplicar_taxa||!1}))),mu(lr[0]?.id||null),(async()=>{try{const{data:fn,error:ya}=await re.from("agendamento_participantes").select("cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey ( nome, codigo )").eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",Oe.id).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(!ya&&Array.isArray(fn)){const Za=fn.slice();try{mu(String(Za[0]?.cliente_id||"")||null)}catch{}const Fa=Za.filter(Jn=>Jn&&Jn.cliente_id).map(Jn=>({id:Jn.cliente_id,nome:Jn.nome||Jn.cliente?.nome||"",codigo:Jn.cliente?.codigo||null}));ye(Jn=>{try{$r("edit:background-refresh")}catch{}return(Array.isArray(Jn.selectedClients)?Jn.selectedClients:[]).length>0?Jn:{...Jn,selectedClients:Fa}}),x(Za.map(Jn=>({cliente_id:Jn.cliente_id,nome:Jn.nome||Jn.cliente?.nome||"",codigo:Jn.cliente?.codigo||null,valor_cota:(()=>{const di=Number.isFinite(Number(Jn.valor_cota))?Number(Jn.valor_cota):Jf(Jn.valor_cota);return qp(String((Number.isFinite(di)?di:0).toFixed(2)))})(),status_pagamento:Jn.status_pagamento||"Pendente",finalizadora_id:Jn.finalizadora_id?String(Jn.finalizadora_id):null,aplicar_taxa:Jn.aplicar_taxa||!1})))}}catch(fn){console.error("Falha ao carregar participantes (refresh)",fn)}})(),tf.current=!0}else if(ss){const Le=(St||[]).includes(ss.court)?ss.court:(St||[])[0]||"",ut={selectedClients:Re.current?Array.isArray(Z.selectedClients)?Z.selectedClients:[]:[],court:Le,modality:(()=>(Ue[Le]?.modalidades||zp)[0]||"")(),status:"scheduled",date:ss.date??k,startMinutes:ss.startMinutes??we(),endMinutes:ss.endMinutes??we()+60};ye(ut),x([]),zf.current=!0,tf.current=!0}else{const Le=St[0]||"",ut=Ue[Le]?.modalidades||zp,Ft=Array.isArray(va)?va:[],Kt=Re.current?Array.isArray(Z.selectedClients)?Z.selectedClients:[]:Ft.length>0?Ft:[];if(!Re.current&&Ft.length>0)try{Re.current=!0}catch{}ye({selectedClients:Kt,court:Le,modality:ut[0]||"",status:"scheduled",date:k,startMinutes:we(),endMinutes:we()+60}),x([]),zf.current=!0,tf.current=!0}},[ce,Oe,k,ss,St,zp,Ht]),p.useEffect(()=>{if(ce&&Oe){tf.current=!1,ef.current=!1,Re.current||ye(Le=>({...Le,selectedClients:[]}));try{Rn.current=!1}catch{}}},[Oe,ce]),p.useEffect(()=>{if(ce)try{ef.current=!1}catch{}},[ce]),p.useEffect(()=>{if(!ce||!Oe||ef.current)return;const Le=Ht[Oe.id]||[];if(!Le.length)return;const ut=Le.slice();try{mu(String(ut[0]?.cliente_id||"")||null)}catch{}const Ft=ut.filter(Kt=>Kt&&Kt.cliente_id).map(Kt=>({id:Kt.cliente_id,nome:Kt.nome,codigo:Kt.codigo||null}));if(Ft.length>0){try{localStorage.getItem("debug:agenda")==="1"&&(console.log("[ORDER-AGENDA] chipsIdsNow:",chipsNow.map(Kt=>Kt.id)),console.log("[ORDER-AGENDA] selectedFromPartsIds:",Ft.map(Kt=>Kt.id)))}catch{}ye(Kt=>{try{$r("edit:prefill-tardy")}catch{}return(Array.isArray(Kt.selectedClients)?Kt.selectedClients:[]).length>0?Kt:{...Kt,selectedClients:Ft}}),x(ut.map(Kt=>({cliente_id:Kt.cliente_id,nome:Kt.nome,codigo:Kt.codigo||null,valor_cota:(()=>{const lr=Number.isFinite(Number(Kt.valor_cota))?Number(Kt.valor_cota):Jf(Kt.valor_cota);return qp(String((Number.isFinite(lr)?lr:0).toFixed(2)))})(),status_pagamento:Kt.status_pagamento||"Pendente",finalizadora_id:Kt.finalizadora_id||null,aplicar_taxa:Kt.aplicar_taxa||!1}))),ef.current=!0}},[ce,Oe,Ht]);const Vf=p.useCallback(async()=>{try{if(s)return;if(!Oe?.id){o();return}if(No)return;try{try{Fl.current=!1}catch{}try{Ll.current=!1}catch{}await Sd({autoSave:!0}),await Promise.resolve()}catch{}Ll.current&&o()}catch{}},[s,Oe?.id,No,Sd,o]);p.useEffect(()=>{const Le=ut=>{ce&&(s||Oe&&(ut.key==="F3"&&(ut.preventDefault(),mo(!0)),ut.key==="F4"&&(ut.preventDefault(),Vf())))};return window.addEventListener("keydown",Le),()=>window.removeEventListener("keydown",Le)},[ce,Oe,s,Vf,mo,Sd,Fl,Ll,Xe,Z]);const hc=p.useMemo(()=>{const Le=Ue[Z.court];if(!Le)return{start:dn*60,end:Yn*60};const[ut,Ft]=String(Le.hora_inicio||"06:00:00").split(":").map(Number),[Kt,lr]=String(Le.hora_fim||"24:00:00").split(":").map(Number),zr=Kt===0&&lr===0?24:Kt;return{start:ut*60+(Ft||0),end:zr*60+(lr||0)}},[Ue,Z.court,dn,Yn]),O2=p.useCallback((Le,ut)=>{const Ft=sr(Z.date,"yyyy-MM-dd"),Kt=zr=>{const hn=kd(zr),fn=Id(zr);return hn===0&&fn===0?1440:hn*60+fn},lr=Ue?.[Z.court]?.id;return nn.filter(zr=>{const hn=zr.court===Z.court,fn=lr!=null&&String(zr.court_id||"")===String(lr);return(hn||fn)&&sr(zr.start,"yyyy-MM-dd")===Ft&&zr.status!=="canceled"&&(!Oe||zr.id!==Oe.id)}).map(zr=>[Kt(zr.start),Kt(zr.end)]).sort((zr,hn)=>zr[0]-hn[0])},[nn,Z.court,Z.date,Oe]),Tp=p.useMemo(()=>{try{return O2()}catch{return[]}},[O2]),zA=(Le,ut,Ft,Kt)=>Le<Kt&&Ft<ut;function nf(Le,ut){if(ut<=Le||Le<hc.start||ut>hc.end)return!1;for(const[Ft,Kt]of Tp)if(zA(Le,ut,Ft,Kt))return!1;return!0}const T2=Le=>{let ut=Le+es;if(!nf(Le,ut))return null;for(;ut+es<=hc.end&&nf(Le,ut+es);)ut+=es;return ut},UA=p.useMemo(()=>{const Le=hc,ut=[];for(let Ft=Le.start;Ft<=Le.end;Ft+=es){const Kt=nf(Ft,Ft+es);let lr=Math.floor(Ft/60);const zr=Ft%60;lr>=24&&Ft===1440&&(lr=0),ut.push({value:Ft,label:`${String(lr).padStart(2,"0")}:${String(zr).padStart(2,"0")}`,available:Kt})}return ut},[hc,Tp]),af=p.useMemo(()=>{const Le=T2(Z.startMinutes),ut=[];for(let Ft=Z.startMinutes+es;Ft<=hc.end;Ft+=es){const Kt=!!Le&&Ft<=Le;let lr=Math.floor(Ft/60);const zr=Ft%60;lr>=24&&(lr=lr%24),ut.push({value:Ft,label:`${String(lr).padStart(2,"0")}:${String(zr).padStart(2,"0")}`,available:Kt})}return ut},[Z.startMinutes,Tp,hc]);p.useEffect(()=>{if(zf.current){zf.current=!1;return}const ut=(()=>{if(nf(Z.startMinutes,Z.startMinutes+es))return Z.startMinutes;for(let lr=Math.max(hc.start,Z.startMinutes);lr<=hc.end-es;lr+=es)if(nf(lr,lr+es))return lr;for(let lr=hc.start;lr<=hc.end-es;lr+=es)if(nf(lr,lr+es))return lr;return Z.startMinutes})();if(ut!==Z.startMinutes){ye(lr=>({...lr,startMinutes:ut}));return}const Ft=T2(ut);if(!Ft)return;let Kt=Z.endMinutes;(!Number.isFinite(Kt)||Kt<=ut||Kt>Ft)&&(Kt=Math.min(ut+60,Ft),Kt<ut+es&&(Kt=ut+es),ye(lr=>({...lr,endMinutes:Kt})))},[Z.startMinutes,Z.court,Z.date,Tp,hc]);const Bc=p.useMemo(()=>Ue[Z.court]?.modalidades||zp,[Ue,Z.court]);p.useEffect(()=>{const Le=Ue[Z.court]?.modalidades||zp;Le.includes(Z.modality)||ye(ut=>({...ut,modality:Le[0]||""}))},[Z.court,Ue]),p.useEffect(()=>{if(zf.current||!Dl(Z.date,k))return;if(ge[Z.court]&&!ge[Z.court].funciona){const Ft=St.find(Kt=>!ge[Kt]||ge[Kt].funciona);Ft&&ye(Kt=>({...Kt,court:Ft}))}},[Z.court,Z.date,ge,St,k]);const hu=p.useMemo(()=>{const Le=Math.max(0,Z.endMinutes-Z.startMinutes),ut=Math.floor(Le/60),Ft=Le%60;return ut>0&&Ft>0?`${ut}h ${Ft}min`:ut>0?`${ut}h`:`${Ft}min`},[Z.startMinutes,Z.endMinutes]),D2=p.useMemo(()=>{if(!ce)return"";const Le=new Date,ut=kd(Le)*60+Id(Le),Ft=Number(Z.startMinutes),Kt=Number(Z.endMinutes),lr=zr=>{let hn=Math.floor(zr/60);const fn=zr%60;return hn>=24&&(hn=hn%24),`${String(hn).padStart(2,"0")}:${String(fn).padStart(2,"0")}`};if(ts.autoConfirmEnabled&&Z.status==="scheduled"){const zr=Math.max(0,Ft-Number(ts.autoConfirmMinutesBefore||0));if(ut<zr)return`Este agendamento est com automao ativa (Confirmar automaticamente s ${lr(zr)})`}return ts.autoStartEnabled&&Z.status==="confirmed"&&ut<Ft?`Este agendamento est com automao ativa (Iniciar automaticamente s ${lr(Ft)})`:ts.autoFinishEnabled&&Z.status==="in_progress"&&ut<Kt?`Este agendamento est com automao ativa (Finalizar automaticamente s ${lr(Kt)})`:""},[ce,Z.startMinutes,Z.endMinutes,Z.status,ts]),Ny=p.useMemo(()=>(m||[]).length,[m]),Cd=p.useMemo(()=>{const ut=(m||[]).map(fn=>{const ya=Jf(fn?.valor_cota);return Number.isFinite(ya)?ya:0}).reduce((fn,ya)=>fn+ya,0),Ft=Jf(g),Kt=Number.isFinite(Ft)?Ft:0,lr=Number((Kt-ut).toFixed(2));let zr=0,hn=0;for(const fn of m||[])(fn?.status_pagamento||"Pendente")==="Pago"?zr++:hn++;return{totalAssigned:ut,totalTarget:Kt,diff:lr,paid:zr,pending:hn}},[m,g]);p.useEffect(()=>{const Le=Jf(g);if(!Number.isFinite(Le)||Le<=0)return;(m||[]).some(Ft=>Jf(Ft?.valor_cota)>=Le)&&(m||[]).some(Ft=>Ft.status_pagamento!=="Pago")&&x(Ft=>Ft.map(Kt=>({...Kt,status_pagamento:"Pago"})))},[m,g]),p.useCallback(()=>{const Le=(Z.selectedClients||[]).length;if(!Le)return;const ut=Jf(g);if(!Number.isFinite(ut)||ut<0)return;const Ft=Math.round(ut*100),Kt=Math.floor(Ft/Le);let lr=Ft-Kt*Le;x(zr=>{const hn=(Z.selectedClients||[]).slice(),fn=new Map,ya=new Map;return(zr||[]).forEach(Fa=>{const Jn=ya.get(Fa.cliente_id)||[];Jn.push(Fa),ya.set(Fa.cliente_id,Jn)}),hn.map(Fa=>{const Jn=fn.get(Fa.id)||0,Li=(ya.get(Fa.id)||[])[Jn];fn.set(Fa.id,Jn+1);const yl=Kt+(lr>0?1:0);lr>0&&lr--;const Ad=(yl/100).toFixed(2),$l=qp(String(Ad)),Pd=Jf($l);return{cliente_id:Fa.id,nome:Fa.nome,codigo:Li?.codigo??Fa.codigo??null,valor_cota:$l,status_pagamento:Number.isFinite(Pd)&&Pd>0?"Pago":"Pendente",finalizadora_id:Li?.finalizadora_id??null,aplicar_taxa:Li?.aplicar_taxa??!1}})})},[Z.selectedClients,g,x]),p.useCallback(()=>{x(Le=>Le.map(ut=>({...ut,valor_cota:"",status_pagamento:"Pendente"})))},[x]);const Fi=p.useCallback(async()=>{try{Tr.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{ur.current="close"}catch{}try{dr(!1),ar(!1)}catch{}},[Oe?.id,Sd]);return a.jsxs(a.Fragment,{children:[ke&&a.jsx(In,{open:!0,onOpenChange:Le=>{if(!Le&&ke){try{ke.resolve(!1)}catch{}st(null)}},children:a.jsxs(En,{onOpenAutoFocus:Le=>Le.preventDefault(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Reativar automao?"}),a.jsx(Hn,{children:"Ao reativar, este agendamento voltar a ser atualizado automaticamente (incio e trmino) pelas regras da agenda."})]}),a.jsx(Na,{children:a.jsxs("div",{className:"ml-auto flex gap-2",children:[a.jsx(se,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>{try{ke?.resolve(!1)}catch{}st(null)},children:"Cancelar"}),a.jsx(se,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:()=>{try{ke?.resolve(!0)}catch{}st(null)},children:"Reativar"})]})})]})}),ce&&a.jsx(In,{open:!0,onOpenChange:async Le=>{if(Le)Xe(!0);else{try{const ut=Date.now()<(Xt.current||0);if(Gr||Mn||ut){try{const Ft={ts:new Date().toISOString(),hook:"Dialog:onOpenChange(blocked)",effectiveCustomerPickerOpen:Gr,isClientFormOpen:Mn,suppressUntil:Xt.current,formLen:Array.isArray(Z?.selectedClients)?Z.selectedClients.length:NaN,curLen:Array.isArray(Ne.current)?Ne.current.length:NaN,lastLen:Array.isArray(jn.current)?jn.current.length:NaN};console.warn("[CustomerPicker][DIALOG:block-close]",Ft)}catch{}return}}catch{}try{const ut={ts:new Date().toISOString(),hook:"Dialog:onOpenChange(allow-close)",effectiveCustomerPickerOpen:Gr,isClientFormOpen:Mn,suppressUntil:Xt.current,formLen:Array.isArray(Z?.selectedClients)?Z.selectedClients.length:NaN,curLen:Array.isArray(Ne.current)?Ne.current.length:NaN,lastLen:Array.isArray(jn.current)?jn.current.length:NaN};console.warn("[CustomerPicker][DIALOG:allow-close]",ut)}catch{}if(s&&console.log("[Dialog] Fechamento solicitado com PaymentModal aberto - iniciando coordenao"),console.log(" [FLUXO CRTICO] Solicitao de fechamento do modal de agendamento recebida"),console.log(" Estado atual:",{isPaymentModalOpen:s,editingBooking:Oe?.id,timestamp:new Date().toISOString()}),s&&typeof window<"u"){console.log(" [FLUXO CRTICO] PaymentModal aberto - solicitando save-and-close");try{await new Promise(ut=>{const Ft=()=>{window.removeEventListener("paymentmodal:closed",Ft),console.log(" [FLUXO CRTICO] PaymentModal confirmou fechamento"),ut()},Kt=setTimeout(()=>{window.removeEventListener("paymentmodal:closed",Ft),console.warn(" [FLUXO CRTICO] Timeout aguardando PaymentModal fechar"),ut()},3e3),lr=()=>{clearTimeout(Kt),Ft()};window.addEventListener("paymentmodal:closed",lr,{once:!0}),window.dispatchEvent(new Event("paymentmodal:save-and-close"))})}catch{}}await Op(),console.log(" [FLUXO CRTICO] Modal de agendamento fechado")}},children:a.jsxs(En,{forceMount:!0,disableAnimations:!0,alignTop:!0,className:"sm:max-w-[960px] max-h-[85vh] min-h-[360px] flex flex-col p-0",onOpenAutoFocus:Le=>Le.preventDefault(),onInteractOutside:async Le=>{try{const ut=Date.now()<(Xt.current||0);if(s||Gr||Mn||ut){try{const Ft={ts:new Date().toISOString(),hook:"DialogContent:onInteractOutside(blocked)",effectiveCustomerPickerOpen:Gr,isClientFormOpen:Mn,isPaymentModalOpen:s,suppressUntil:Xt.current,formLen:Array.isArray(Z?.selectedClients)?Z.selectedClients.length:NaN,curLen:Array.isArray(Ne.current)?Ne.current.length:NaN,lastLen:Array.isArray(jn.current)?jn.current.length:NaN}}catch{}Le.preventDefault();return}if(Oe?.id){Le.preventDefault(),await Op();return}}catch{}},onEscapeKeyDown:Le=>{try{const ut=Date.now()<(Xt.current||0);if(s||Gr||Mn||ut){Le.preventDefault();return}}catch{}},children:[a.jsxs(Cn,{className:"px-6 pt-6 pb-4 flex-shrink-0",children:[a.jsxs(Nn,{className:"flex items-center justify-between gap-3 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{children:Oe?(()=>{const Le=Oe?.code,ut=typeof Le=="number"?String(Le).padStart(3,"0"):null;return ut?`Editar agendamento - ${ut}`:"Editar Agendamento"})():"Novo Agendamento"}),Oe?.created_by_isis&&a.jsxs("span",{className:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs bg-fuchsia-600/10 text-fuchsia-400 border-fuchsia-700/30",title:"Criado pela sis",children:[a.jsx("span",{className:"rounded-full overflow-hidden bg-background w-4 h-4 flex items-center justify-center shadow-[0_0_0_2px_rgba(0,0,0,0.25)]",children:a.jsx(Hi,{size:"xs",className:"w-4 h-4"})}),"Criado pela sis"]})]}),Oe&&(()=>{Cd?.pending===0&&Ny>0;const Le=(Cd?.pending||0)>0,ut="inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs",Ft="bg-emerald-600/10 text-emerald-400 border-emerald-700/30",Kt="bg-amber-600/15 text-amber-400 border-amber-700/30",lr=zr=>a.jsx("span",{"aria-hidden":!0,className:`inline-block w-2 h-2 rounded-full ${zr}`});return a.jsxs("span",{className:`${ut} ${Le?Kt:Ft}`,title:Le?"H pagamentos pendentes":"Todos participantes pagos","aria-live":"polite",children:[lr(Le?"bg-amber-400":"bg-emerald-400"),a.jsx("span",{className:"tracking-wide",children:"Pagos"}),a.jsx("strong",{className:"text-base font-semibold tabular-nums",children:Cd?.paid||0}),a.jsx("span",{className:"opacity-60",children:"/"}),a.jsx("span",{className:"text-base font-semibold tabular-nums",children:Ny})]})})(),a.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md border text-sm bg-white/5 border-white/10 text-text-primary mr-12 max-w-full",title:"Data do agendamento",children:[a.jsx(lo,{className:"w-4 h-4 opacity-80"}),a.jsxs("span",{className:"font-semibold",children:[sr(Z.date,"dd/MM/yyyy"),(()=>{const Le=Number(Z?.startMinutes),ut=Number(Z?.endMinutes);if(!(Number.isFinite(Le)&&Number.isFinite(ut)&&ut>Le))return"";const Kt=lr=>{let zr=Math.floor(lr/60);const hn=lr%60;return zr>=24&&(zr=zr%24),`${String(zr).padStart(2,"0")}:${String(hn).padStart(2,"0")}`};return`  ${Kt(Le)}${Kt(ut)}`})()]})]})]}),a.jsx(Hn,{children:Oe?"As alteraes so salvas automaticamente enquanto voc edita.":"Preencha os detalhes para criar uma nova reserva."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-4 pb-4",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"clientes-field",className:"font-bold",children:"Clientes"}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsxs(ai,{modal:!1,open:Gr,onOpenChange:Le=>{const ut=Date.now(),Ft=ut<(kn.current||0)||ut<(Xt.current||0)||ut<(un.current||0)||te();if(!((Mn||oa)&&Le===!1)){if(!Le&&Ft){ho("onOpenChange:blocked:guard-window");return}if(!Le&&ur.current!=="close"){ho("onOpenChange:blocked:sticky-close");return}if(Le){Tr.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}ar(!0),ho("open:accepted")}else{Tr.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{const Kt=Array.isArray(Ne.current)?[...Ne.current]:[];Kt.length>0?(Pn.current="onOpenChange:close:preserve",hs(Kt),Ds("onOpenChange:close:preserve",Kt)):Rn.current||(Pn.current="onOpenChange:close:empty",Ds("onOpenChange:close:empty",[]))}catch{}try{Xt.current=Date.now()+1500}catch{}try{const Kt={ts:new Date().toISOString(),hook:"onOpenChange(false)",formLen:Array.isArray(Z?.selectedClients)?Z.selectedClients.length:NaN,curLen:Array.isArray(Ne.current)?Ne.current.length:NaN,lastLen:Array.isArray(jn.current)?jn.current.length:NaN,chipsLen:Array.isArray(va)?va.length:NaN,clientsLoading:!!oa,lastAction:Pn?.current,clearedByUser:!!Rn?.current,suppressUntil:Xt.current};console.warn("[CustomerPicker][CLOSE:onOpenChange]",Kt)}catch{}ar(!1),ho("close:accepted")}!Le&&jo.current&&(Xs(!0),jo.current=!1,setTimeout(()=>Xs(!1),1200)),ur.current=Le?"open":"close",dr(Le)}},children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{type:"button",variant:"outline",className:Sr("min-w-[180px] justify-between",Ha&&"ring-2 ring-emerald-500/40 ring-offset-2 ring-offset-transparent transition-shadow"),onClick:()=>{ho("trigger:click");try{ur.current="open"}catch{}try{Tr.current=!0,localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}dr(!0),ar(!0),setTimeout(()=>{dr(!0),ar(!0),ho("trigger:reassert-open")},30),ho("trigger:after-set-open")},children:[BA,a.jsx(ix,{className:"w-4 h-4 ml-2 opacity-60"})]})}),a.jsx(Go,{forceMount:!0,side:"bottom",align:"start",className:"w-[360px] p-2 z-[9999]",onPointerDownOutside:Le=>{const ut=Date.now();if(ut<(kn.current||0)||ut<(Xt.current||0)||ut<(un.current||0)||te()){Le.preventDefault();return}if(Mn||oa){Le.preventDefault();return}try{const Kt=Array.isArray(Ne.current)?[...Ne.current]:[];Kt.length>0?(Pn.current="outside:close:snapshot",jn.current=Kt,hs(Kt),Ds("outside:close:apply",Kt),Rn.current=!1):(Pn.current="outside:close:empty",Rn.current&&(jn.current=[],console.warn("[CustomerPicker][outside:close:empty:cleared]",{ts:new Date().toISOString()})),Ds("outside:close:empty",[]))}catch{}try{Xt.current=Date.now()+1500}catch{}try{const Kt={ts:new Date().toISOString(),hook:"onPointerDownOutside",formLen:Array.isArray(Z?.selectedClients)?Z.selectedClients.length:NaN,curLen:Array.isArray(Ne.current)?Ne.current.length:NaN,lastLen:Array.isArray(jn.current)?jn.current.length:NaN,chipsLen:Array.isArray(va)?va.length:NaN,clientsLoading:!!oa,lastAction:Pn?.current,clearedByUser:!!Rn?.current,suppressUntil:Xt.current}}catch{}jo.current=!0,ur.current="close",Tr.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}dr(!1),ar(!1)},onFocusOutside:Le=>{ho("focusOutside"),(Mn||oa)&&Le.preventDefault()},onEscapeKeyDown:Le=>{ho("escapeKeyDown"),(Mn||oa)&&Le.preventDefault()},children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{ref:to,placeholder:"Buscar por cdigo ou nome...",value:qt,onChange:Le=>{rr(Le.target.value),_n(0)},onKeyDown:Le=>{if(Le.key==="ArrowDown"||Le.key==="ArrowUp"){Le.preventDefault();const ut=(ji||[]).filter(hn=>{const fn=qt.trim().toLowerCase();return fn?String(le(hn)||"").toLowerCase().includes(fn):!0}),Ft=ut.find(hn=>hn?.is_consumidor_final===!0),lr=ut.filter(hn=>hn?.is_consumidor_final!==!0).slice().sort((hn,fn)=>{const ya=typeof hn=="object"&&Number.isFinite(Number(hn?.codigo))?Number(hn.codigo):1/0,Za=typeof fn=="object"&&Number.isFinite(Number(fn?.codigo))?Number(fn.codigo):1/0;if(ya!==Za)return ya-Za;const Fa=String(X(hn)||"").toLowerCase(),Jn=String(X(fn)||"").toLowerCase();return Fa.localeCompare(Jn)}),zr=Ft?[Ft,...lr]:lr;Le.key==="ArrowDown"?_n(hn=>Math.min(hn+1,zr.length-1)):_n(hn=>Math.max(hn-1,0))}if(Le.key==="Enter"){Le.preventDefault();const ut=(ji||[]).filter(fn=>{const ya=qt.trim().toLowerCase();return ya?String(le(fn)||"").toLowerCase().includes(ya):!0}),Ft=ut.find(fn=>fn?.is_consumidor_final===!0),lr=ut.filter(fn=>fn?.is_consumidor_final!==!0).slice().sort((fn,ya)=>{const Za=typeof fn=="object"&&Number.isFinite(Number(fn?.codigo))?Number(fn.codigo):1/0,Fa=typeof ya=="object"&&Number.isFinite(Number(ya?.codigo))?Number(ya.codigo):1/0;if(Za!==Fa)return Za-Fa;const Jn=String(X(fn)||"").toLowerCase(),di=String(X(ya)||"").toLowerCase();return Jn.localeCompare(di)}),hn=(Ft?[Ft,...lr]:lr)[$n];if(hn){const fn=hn.id,ya=X(hn),Za=hn.codigo,Fa={id:fn,nome:ya,codigo:Za},Jn=[...Array.isArray(Ne.current)?Ne.current:[],Fa];try{(Ne.current||[]).length===0&&(bt.current=fn||null)}catch{}try{Rn.current=!1}catch{}try{Jn.length>0&&(jn.current=Jn)}catch{}try{Ne.current=Jn}catch{}Ds("keyboard:enter",Jn),Tr.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}}}},className:"pl-10 pr-10"}),qt&&a.jsx("button",{type:"button","aria-label":"Limpar busca",className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary p-1 rounded hover:bg-white/10",onClick:()=>{rr(""),to.current?.focus()},children:a.jsx(lc,{className:"w-4 h-4"})})]}),a.jsxs("div",{ref:Ts,className:"max-h-[260px] overflow-y-auto divide-y divide-border rounded-md border border-border",onWheel:Le=>{Le.stopPropagation()},onTouchMove:Le=>{Le.stopPropagation()},style:{overscrollBehavior:"contain"},children:[oa&&(ji||[]).length===0&&a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Carregando clientes"}),!oa&&(ji||[]).length===0&&a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Nenhum cliente encontrado"}),!oa&&(()=>{const Le=(ji||[]).filter(zr=>{const hn=qt.trim().toLowerCase();return hn?String(le(zr)||"").toLowerCase().includes(hn):!0}),ut=Le.find(zr=>zr?.is_consumidor_final===!0),Kt=Le.filter(zr=>zr?.is_consumidor_final!==!0).slice().sort((zr,hn)=>{const fn=typeof zr=="object"&&Number.isFinite(Number(zr?.codigo))?Number(zr.codigo):1/0,ya=typeof hn=="object"&&Number.isFinite(Number(hn?.codigo))?Number(hn.codigo):1/0;if(fn!==ya)return fn-ya;const Za=String(X(zr)||"").toLowerCase(),Fa=String(X(hn)||"").toLowerCase();return Za.localeCompare(Fa)});return ut?[ut,...Kt]:Kt})().map((Le,ut)=>{const Ft=Le?.is_consumidor_final===!0,Kt=typeof Le=="object"?Le.id:null,lr=X(Le),zr=typeof Le=="object"?Le.codigo:null,hn=String(lr||"").toLowerCase(),fn=Fa=>Fa.id&&Kt?Fa.id===Kt:String(Fa.nome||"").toLowerCase()===hn,ya=(Z.selectedClients||[]).some(fn),Za=ut===$n;return a.jsxs("button",{ref:Fa=>{Ys.current[ut]=Fa},type:"button",className:`w-full text-left py-3 px-4 flex items-center gap-3 transition-all border-b border-border last:border-0 ${Za?"ring-2 ring-blue-500 ring-inset z-10":""} ${Ft?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":ya?"bg-emerald-600/20 hover:bg-emerald-600/30":"hover:bg-surface-2"}`,onMouseEnter:()=>_n(ut),onMouseDown:Fa=>{Fa.stopPropagation()},role:"option","aria-checked":ya,onClick:()=>{const Fa={id:Kt,nome:lr,codigo:zr},Jn=[...Array.isArray(Ne.current)?Ne.current:[],Fa];try{(Ne.current||[]).length===0&&(bt.current=Kt||null)}catch{}try{Rn.current=!1}catch{}try{Jn.length>0&&(jn.current=Jn)}catch{}try{Ne.current=Jn}catch{}Ds("list:add",Jn),Tr.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[zr!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors ${Ft?"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20":"bg-emerald-600/20 text-emerald-400"}`,children:["#",zr]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:`font-medium truncate ${Ft?"text-amber-100/90":""}`,children:lr}),Ft&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),(()=>{const Fa=(Z.selectedClients||[]).filter(Jn=>fn(Jn)).length;return Fa>0?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-rose-600 hover:bg-rose-500 text-white text-base font-bold transition-colors",onClick:Jn=>{Jn.stopPropagation();const di=Array.isArray(Ne.current)?Ne.current:[],Li=di.findIndex(yl=>fn(yl));if(Li!==-1){const yl=[...di];yl.splice(Li,1);try{Rn.current=yl.length===0}catch{}try{yl.length===0&&(bt.current=null)}catch{}try{yl.length>0&&(jn.current=yl)}catch{}try{Ne.current=yl}catch{}Ds("list:remove-one",yl)}},children:"-"}),a.jsx("span",{className:"inline-flex items-center justify-center min-w-[32px] h-7 px-2 rounded-full bg-sky-600 text-white text-base font-bold",children:Fa}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-emerald-600 hover:bg-emerald-500 text-white text-base font-bold transition-colors",onClick:Jn=>{Jn.stopPropagation();const di={id:Kt,nome:lr,codigo:zr},Li=[...Array.isArray(Ne.current)?Ne.current:[],di];try{(Ne.current||[]).length===0&&(bt.current=Kt||null)}catch{}try{Rn.current=!1}catch{}try{Li.length>0&&(jn.current=Li)}catch{}try{Ne.current=Li}catch{}Ds("list:add-one",Li)},children:"+"})]}):null})()]},Kt||hn)})]}),a.jsxs("div",{className:"flex items-center justify-between pt-1",children:[a.jsx(se,{type:"button",size:"sm",className:"bg-emerald-600 hover:bg-emerald-500 text-white shadow-md ring-2 ring-emerald-400/40 ring-offset-2 ring-offset-transparent",onMouseDown:Le=>{try{Xt.current=Date.now()+3e3}catch{}try{kn.current=Date.now()+3500}catch{}try{M.current=Date.now()+5e3}catch{}try{ur.current="close"}catch{}try{Tr.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}Le.stopPropagation()},onClick:()=>{ur.current="close",Tr.current=!1;try{M.current=Date.now()+5e3}catch{}try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}Xn.current=!0;const ut=Array.isArray(Ne.current)?[...Ne.current]:[];try{ut.length>0&&(Pn.current="conclude:close:snapshot",jn.current=ut)}catch{}hs(ut);try{kn.current=Date.now()+3e3}catch{}Ds("conclude:close:apply",ut),ye(Ft=>({...Ft,selectedClients:[...ut]}));try{Rn.current=!1}catch{}try{Xt.current=Date.now()+2500}catch{}dr(!1),ar(!1),setTimeout(()=>{try{Xt.current=Date.now()+2500}catch{}dr(!1),ar(!1)},15),setTimeout(()=>{try{Xt.current=Date.now()+2500}catch{}dr(!1),ar(!1)},120);try{Xt.current=Date.now()+2500}catch{}try{const Ft={ts:new Date().toISOString(),hook:"conclude:click",formLen:Array.isArray(Z?.selectedClients)?Z.selectedClients.length:NaN,curLen:Array.isArray(Ne.current)?Ne.current.length:NaN,lastLen:Array.isArray(jn.current)?jn.current.length:NaN,chipsLen:Array.isArray(va)?va.length:NaN,clientsLoading:!!oa,lastAction:Pn?.current,clearedByUser:!!Rn?.current,suppressUntil:Xt.current,selectionLockUntil:kn.current,restoreGuardUntil:Rl.current,modalSessionId:H.current||"",closingAt:null,pickerOpen:!!Gr,modalOpen:!!ce}}catch{}setTimeout(()=>{try{Xn.current=!1}catch{}},3e3)},children:"Concluir"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:"text-xs text-text-muted",children:[(Um||[]).length," selecionado(s)"]})})]})]})})]}),a.jsx(se,{type:"button",onClick:()=>{try{const Le=Array.isArray(Ne.current)?Ne.current:[];Le.length>0&&(jn.current=Le,hs(Le))}catch{}Tr.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}ur.current="close",dr(!1),ar(!1),Da(null),Yr(!0)},children:"+ Novo"})]}),qA?a.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-text-muted",children:[a.jsx(Zl,{className:"w-4 h-4 animate-spin"}),"Carregando participantes..."]}):by.length>0?a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:by.map((Le,ut)=>{const Ft=String(Le?.nome||"").toLowerCase(),Kt=`${Le?.id||Ft}-${ut}`,lr=Le?.id||`__name:${Ft}`;return a.jsxs("span",{className:"text-sm font-medium bg-white/5 border border-white/10 rounded px-2 py-1 flex items-center gap-2",children:[bU(Le.nome),a.jsxs("button",{type:"button","aria-label":"Remover cliente",title:"Remover cliente",className:"text-text-muted hover:text-red-400 p-1 rounded hover:bg-red-500/10",onClick:()=>{_("CustomerPicker:chip:remove",{token:lr,chipIdx:ut});const zr=(Array.isArray(Ne.current)?Ne.current:[]).filter((hn,fn)=>fn!==ut);try{Rn.current=zr.length===0}catch{}try{jn.current=zr}catch{}try{Ne.current=zr}catch{}Ds("chips:remove",zr)},children:[a.jsx(lc,{className:"w-5 h-5"}),a.jsx("span",{className:"sr-only",children:"Remover"})]})]},Kt)})}):null]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"quadra-select",className:"font-bold",children:"Quadra"}),a.jsxs(Gn,{value:Z.court,onValueChange:Le=>ye(ut=>({...ut,court:Le})),children:[a.jsx(Vn,{className:"mt-1",onMouseDown:()=>{Gr&&setTimeout(Fi,0)},children:a.jsx(Kn,{children:Z.court&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:uh(Z.court)}}),a.jsx("span",{children:Z.court})]})})}),a.jsx(Wn,{className:"z-[60]",children:St.map(Le=>{const ut=sr(Z.date,"yyyy-MM-dd"),Ft=Y[ut]||{},Kt=Ft[Le]&&!Ft[Le].funciona;return a.jsx(lt,{value:Le,disabled:Kt,className:Kt?"opacity-50 cursor-not-allowed":"",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:uh(Le)}}),a.jsx("span",{children:Le}),Kt&&a.jsx("span",{className:"text-xs text-text-muted ml-auto",children:"(Fechada)"})]})},Le)})})]})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"modalidade-select",className:"font-bold",children:"Modalidade"}),a.jsxs(Gn,{value:Z.modality,onValueChange:Le=>ye(ut=>({...ut,modality:Le})),children:[a.jsx(Vn,{className:"mt-1",onMouseDown:()=>{Gr&&setTimeout(Fi,0)},children:a.jsx(Kn,{})}),a.jsx(Wn,{children:(Bc||[]).map(Le=>a.jsx(lt,{value:Le,children:Le},Le))})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"status-select",className:"font-bold",children:"Status"}),a.jsxs(Gn,{value:Z.status,onValueChange:Le=>ye(ut=>({...ut,status:Le})),children:[a.jsx(Vn,{className:"mt-1",onMouseDown:()=>{Gr&&setTimeout(Fi,0)},children:a.jsx(Kn,{})}),a.jsx(Wn,{children:Object.keys($i).map(Le=>a.jsx(lt,{value:Le,children:a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{"aria-hidden":!0,className:`inline-block h-4 w-1 rounded ${$i[Le].accent}`}),$i[Le].label]})},Le))})]}),D2&&a.jsx("div",{className:"mt-1.5 text-xs text-text-primary font-medium bg-brand/5 border border-brand/20 rounded px-2 py-1.5",children:D2})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"horario-inicio",className:"font-bold",children:"Horrio"}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsxs(Gn,{value:String(Z.startMinutes),onValueChange:Le=>ye(ut=>({...ut,startMinutes:Number(Le)})),children:[a.jsx(Vn,{className:"w-32","aria-label":"Hora incio",onMouseDown:()=>{Gr&&setTimeout(Fi,0)},children:a.jsx(Kn,{})}),a.jsx(Wn,{className:"max-h-[300px] z-[60] [&>div]:scrollbar-thin [&>div]:scrollbar-track-surface [&>div]:scrollbar-thumb-brand/40 [&>div]:hover:scrollbar-thumb-brand/60",children:UA.map(Le=>a.jsx(lt,{value:String(Le.value),disabled:!Le.available,className:Sr(!Le.available&&"opacity-60"),children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[Le.available?a.jsx(eu,{className:"w-4 h-4 opacity-80"}):a.jsx(e0,{className:"w-4 h-4 opacity-80"}),Le.label]})},Le.value))})]}),a.jsxs(Gn,{value:String(Z.endMinutes),onValueChange:Le=>ye(ut=>({...ut,endMinutes:Number(Le)})),children:[a.jsx(Vn,{className:"w-32","aria-label":"Hora fim",onMouseDown:()=>{Gr&&setTimeout(Fi,0)},children:a.jsx(Kn,{})}),a.jsx(Wn,{className:"max-h-[300px] z-[60] [&>div]:scrollbar-thin [&>div]:scrollbar-track-surface [&>div]:scrollbar-thumb-brand/40 [&>div]:hover:scrollbar-thumb-brand/60",children:af.map(Le=>a.jsx(lt,{value:String(Le.value),disabled:!Le.available,className:Sr(!Le.available&&"opacity-60"),children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[Le.available?a.jsx(eu,{className:"w-4 h-4 opacity-80"}):a.jsx(e0,{className:"w-4 h-4 opacity-80"}),Le.label]})},Le.value))})]})]}),a.jsxs("div",{className:"mt-1 inline-block text-xs font-semibold text-text-secondary bg-white/5 border border-white/10 rounded px-2 py-0.5",children:["Durao: ",hu]})]}),!Oe&&a.jsxs("div",{className:"border-t border-border pt-4 mt-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("input",{type:"checkbox",id:"is-recorrente",checked:Qt,onChange:Le=>Tt(Le.target.checked),className:"mt-1 h-4 w-4 rounded border-gray-300 text-brand focus:ring-brand"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"is-recorrente",className:"font-semibold text-text-primary cursor-pointer",children:"Agendamento Fixo (Recorrente)"}),a.jsx("p",{className:"text-xs text-text-secondary mt-0.5",children:"Criar este agendamento automaticamente nas prximas semanas, no mesmo dia e horrio"})]})]}),Qt&&a.jsxs("div",{className:"ml-7 mt-3 space-y-3",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"quantidade-semanas",className:"text-sm font-medium",children:"Repetir por quantas semanas?"}),a.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-md bg-surface-2",children:[a.jsx("button",{type:"button",onClick:()=>Jr(Le=>Math.max(2,(Le||2)-1)),className:"px-3 py-2 hover:bg-surface-3 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:nr<=2,children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),a.jsx("div",{className:"px-4 py-2 min-w-[60px] text-center font-semibold border-x border-border",children:nr}),a.jsx("button",{type:"button",onClick:()=>Jr(Le=>(Le||2)+1),className:"px-3 py-2 hover:bg-surface-3 transition-colors",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),a.jsxs("span",{className:"text-sm text-text-secondary",children:["semanas (",nr," agendamentos)"]})]})]}),Z.date&&nr>=2&&a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-slate-300 mb-2 uppercase tracking-wide",children:"Datas que sero criadas:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:nr}).map((Le,ut)=>{const Ft=rs(Z.date,ut*7);return a.jsxs("div",{className:"inline-flex items-center gap-1.5 bg-slate-700/50 border border-slate-600 rounded px-2 py-1",children:[a.jsx("svg",{className:"w-3.5 h-3.5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),a.jsx("span",{className:"text-xs font-medium text-white",children:sr(Ft,"dd/MM/yyyy '('EEEE')'",{locale:ga})})]},ut)})})]}),a.jsx("div",{className:"bg-slate-800/50 border-l-4 border-blue-600 rounded-r-lg p-3",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),a.jsxs("div",{className:"text-xs text-gray-300",children:[a.jsx("p",{className:"font-semibold mb-1 text-blue-300",children:"Importante: Revise os dados antes de salvar"}),a.jsxs("p",{children:["Sero criados ",a.jsxs("strong",{className:"text-white",children:[nr," agendamentos"]})," incluindo a data selecionada e as prximas ",nr-1," semanas. Editar ou cancelar depois exigir alterar cada agendamento individualmente."]})]})]})})]})]})]})]})}),a.jsx(Na,{className:"flex-shrink-0 border-t border-border bg-surface px-6 py-3",children:a.jsxs("div",{className:"w-full flex flex-col gap-3 sm:flex-row sm:items-center",children:[Oe&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:mr-auto w-full sm:w-auto",children:[a.jsxs(se,{type:"button",variant:"destructive",className:"bg-red-600 hover:bg-red-500 text-white border border-red-700 w-full sm:w-auto justify-center",onClick:()=>mo(!0),children:[a.jsx(Sg,{className:"w-4 h-4 mr-2 opacity-90"}),"Cancelar agendamento",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-red-700/50 rounded border border-red-500/30",children:"F3"})]}),a.jsxs(se,{type:"button",variant:"secondary",className:"bg-teal-600 hover:bg-teal-500 text-white border-teal-700 w-full sm:w-auto justify-center",onClick:()=>{Vf()},children:[a.jsx(Oi,{className:"w-4 h-4 mr-2 opacity-90"}),a.jsx("span",{className:"hidden sm:inline",children:"Gerenciar Pagamentos"}),a.jsx("span",{className:"sm:hidden",children:"Pagamentos"}),a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-teal-700/50 rounded border border-teal-500/30",children:"F4"})]})]}),a.jsx(ku,{open:Bo,onOpenChange:mo,children:a.jsxs(Bd,{children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Cancelar agendamento?"}),a.jsx(Vd,{children:'Ao cancelar, este agendamento deixar de aparecer na agenda padro. Ele s ser visvel ao selecionar o filtro "Cancelados".'})]}),a.jsxs(zd,{children:[a.jsx(Wd,{children:"Voltar"}),a.jsx(Iu,{className:"bg-red-600 hover:bg-red-500",onClick:async()=>{try{mo(!1),Xe(!1),await Bt(Oe.id,"canceled","user"),t({title:"Agendamento cancelado"})}catch(Le){t({title:"Erro ao cancelar",description:Le?.message||"Tente novamente."})}},children:"Confirmar cancelamento"})]})]})})]}),a.jsxs("div",{className:"flex gap-2 w-full sm:w-auto sm:ml-auto",children:[a.jsxs(se,{type:"button",variant:"ghost",className:"border border-white/10 flex-1 sm:flex-none",onClick:async()=>{await Op()},children:["Fechar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]}),!Oe?.id&&a.jsxs(se,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white disabled:opacity-60 disabled:cursor-not-allowed flex-1 sm:flex-none",disabled:No,onClick:async()=>{try{if(No)return;if(Qt&&!Oe){tt(!0);return}Fl.current=!0,Ll.current=!1,await Sd()}catch{}},children:["Salvar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-emerald-700/50 rounded border border-emerald-500/30",children:""})]})]})]})})]})}),a.jsx(ku,{open:gn,onOpenChange:tt,children:a.jsxs(Bd,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(qd,{children:[a.jsxs(Ud,{className:"flex items-center gap-3 text-xl",children:[a.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-lg bg-orange-600/20 border border-orange-600/40",children:a.jsx("svg",{className:"w-6 h-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),"Confirmar Criao de Agendamentos Recorrentes"]}),a.jsxs(Vd,{className:"space-y-4 mt-4",children:[Z.date&&nr>=2&&a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-slate-300 mb-2 uppercase tracking-wide",children:" Datas que sero criadas:"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from({length:nr}).map((Le,ut)=>{const Ft=rs(Z.date,ut*7);return a.jsxs("div",{className:"flex items-center gap-2 bg-slate-700/50 border border-slate-600 rounded px-2 py-1.5",children:[a.jsxs("span",{className:"text-xs font-semibold text-slate-400",children:["#",ut+1]}),a.jsx("span",{className:"text-xs font-medium text-white",children:sr(Ft,"dd/MM/yyyy '('EEEE')'",{locale:ga})})]},ut)})})]}),a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wide",children:"Resumo do Agendamento"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Quadra"}),a.jsx("span",{className:"font-semibold text-white",children:Ue[Z.court]?.name||Z.court})]}),a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Horrio"}),a.jsxs("span",{className:"font-semibold text-white font-mono",children:[_U(Z.startMinutes)," - ",_U(Z.endMinutes)]})]}),a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Modalidade"}),a.jsx("span",{className:"font-semibold text-white",children:Z.modality})]}),a.jsxs("div",{className:"flex items-start justify-between py-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Participantes"}),a.jsx("div",{className:"text-right max-w-xs",children:Z.selectedClients?.length>0?a.jsxs("div",{className:"font-semibold text-white",children:[jr?Z.selectedClients.map(Le=>Le.nome).join(", "):Z.selectedClients.slice(0,3).map(Le=>Le.nome).join(", "),!jr&&Z.selectedClients.length>3&&a.jsxs("span",{className:"text-slate-400",children:[" +",Z.selectedClients.length-3]}),Z.selectedClients.length>3&&a.jsxs(a.Fragment,{children:[" ",a.jsx("button",{type:"button",onClick:()=>ua(!jr),className:"text-xs text-blue-400 hover:text-blue-300 underline inline",children:jr?"Ver menos":"Ver todos"})]})]}):a.jsx("span",{className:"font-semibold text-white",children:"Nenhum participante"})})]})]})]}),a.jsx("div",{className:"bg-red-900/30 border-l-4 border-red-600 rounded-r-lg p-4",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-red-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsx("div",{children:a.jsxs("p",{className:"text-sm text-gray-300",children:[a.jsx("strong",{className:"text-red-300",children:"Importante:"})," Aps criar, editar ou cancelar exigir alterar cada agendamento individualmente. Certifique-se de que todos os dados esto corretos!"]})})]})})]})]}),a.jsxs(zd,{className:"gap-2",children:[a.jsx(Wd,{onClick:()=>{tt(!1),ua(!1)},className:"border-slate-600 hover:bg-slate-800",children:"Cancelar e Revisar"}),a.jsxs(Iu,{className:"bg-emerald-700 hover:bg-emerald-600 text-white font-semibold",onClick:async()=>{tt(!1),ua(!1),Fl.current=!0,Ll.current=!1,await Sd()},children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirmar e Criar ",nr," Agendamentos"]})]})]})}),Mn&&a.jsx(_ne,{open:Mn,onOpenChange:Le=>{Yr(Le),Le||(Da(null),window.__paymentModalCallback&&(window.__paymentModalCallback=null))},client:Sn,onSaved:Le=>{try{if(Le&&typeof Le=="object"){console.warn("[CustomerPicker][onSaved:START]",{clientId:Le.id,clientName:Le.nome,currentSelection:Array.isArray(Ne.current)?Ne.current.length:0});try{M.current=Date.now()+3e3,kn.current=Date.now()+3e3,Rl.current=Date.now()+3e3}catch{}(ji||[]).some(Ft=>typeof Ft=="object"?Ft.id===Le.id:!1)||(rf(Ft=>[...Ft||[],Le]),za(Ft=>[...Ft||[],Le])),ye(Ft=>{const Kt=Array.isArray(Ft.selectedClients)?Ft.selectedClients:[],lr={id:Le.id,nome:Le.nome||Le.name||X(Le),codigo:Le.codigo},zr=Kt.filter(fn=>fn.id!==Le.id),hn=[lr,...zr];try{Ne.current=hn}catch{}try{jn.current=hn}catch{}try{hs(hn)}catch{}try{Rn.current=!1}catch{}return console.warn("[CustomerPicker][onSaved:COMPLETE]",{newClientId:Le.id,newClientName:Le.nome,totalSelected:hn.length,refsSynced:!0,protectionActive:!0}),{...Ft,selectedClients:hn}}),Promise.resolve().then(()=>{try{const Ft=Array.isArray(Ne.current)?Ne.current:[];ye(Kt=>(Array.isArray(Kt.selectedClients)?Kt.selectedClients:[]).length>0?Kt:Ft.length>0?(console.warn("[CustomerPicker][onSaved:REASSERT]",{count:Ft.length}),{...Kt,selectedClients:[...Ft]}):Kt)}catch{}})}if(window.__paymentModalCallback&&typeof window.__paymentModalCallback=="function")try{window.__protectPaymentModal&&window.__protectPaymentModal(3e3),window.__paymentModalCallback(),window.__paymentModalCallback=null}catch(ut){console.error("[PaymentModal][callback:ERROR]",ut)}}catch(ut){console.error("[CustomerPicker][onSaved:ERROR]",ut)}}}),s&&a.jsx(vZe,{setIsModalOpen:Xe,setBookings:rn,form:Z,setForm:ye,localCustomers:ji,onOpenClientModal:Le=>{Yr(!0),window.__paymentModalCallback=Le}}),l&&a.jsx(yZe,{form:Z,setForm:ye,localCustomers:ji})]})},wr=p.useMemo(()=>{const M=sr(k,"yyyy-MM-dd");let H=nn.filter(Ce=>sr(Ce.start,"yyyy-MM-dd")===M);if(!!!R){if(H=H.filter(Ce=>Ce.status!=="canceled"),Vs.trim()){const Ce=Vs.trim().toLowerCase();H=H.filter(we=>(we.customer||"").toLowerCase().includes(Ce)||(we.court||"").toLowerCase().includes(Ce)||($i[we.status]?.label||"").toLowerCase().includes(Ce))}return H}let X=Be.canceledOnly?H.filter(Ce=>Ce.status==="canceled"):H.filter(Ce=>Ce.status!=="canceled");if(Be.pendingPayments&&(X=X.filter(Ce=>{const we=Ht[Ce.id]||[];return we.some(ye=>String(ye.status_pagamento||"").toLowerCase()!=="pago")&&we.length>0})),Vs.trim()){const Ce=Vs.trim().toLowerCase();X=X.filter(we=>(we.customer||"").toLowerCase().includes(Ce)||(we.court||"").toLowerCase().includes(Ce)||($i[we.status]?.label||"").toLowerCase().includes(Ce))}try{const Ce=Date.now(),we=(nn||[]).filter(ye=>sr(ye.start,"yyyy-MM-dd")===M).filter(ye=>ye.status!=="canceled").filter(ye=>{const Ne=Nt.current.get(ye.id);return Ne&&Ne.src==="automation"&&Ce-Ne.ts<2e3}),Z=new Map(X.map(ye=>[ye.id,ye]));for(const ye of we)Z.has(ye.id)||Z.set(ye.id,ye);X=Array.from(Z.values())}catch{}return X},[nn,k,Be.scheduled,Be.canceledOnly,Be.pendingPayments,Vs,Ht,R]),Wr=p.useMemo(()=>{const M=sr(k,"yyyy-MM-dd"),H=zn||Nr[0],le=nn.filter(Ce=>sr(Ce.start,"yyyy-MM-dd")===M&&Ce.status!=="canceled"&&Ce.court===H);let X=0;return le.forEach(Ce=>{const Z=(Ht[Ce.id]||[]).filter(ye=>String(ye.status_pagamento||"").toLowerCase()!=="pago").length;X+=Z}),{totalBookings:le.length,totalPendingPayments:X}},[nn,k,Ht,zn,Nr]),D=p.useMemo(()=>{const M=lh(k),H=rs(M,6);let le=nn.filter(we=>{const Z=so(we.start),ye=so(M),Ne=so(H);return Z>=ye&&Z<=Ne});if(!!!R){if(le=le.filter(we=>we.status!=="canceled"),Vs.trim()){const we=Vs.trim().toLowerCase();le=le.filter(Z=>(Z.customer||"").toLowerCase().includes(we)||(Z.court||"").toLowerCase().includes(we)||($i[Z.status]?.label||"").toLowerCase().includes(we))}return le}let Ce=Be.canceledOnly?le.filter(we=>we.status==="canceled"):le.filter(we=>we.status!=="canceled");if(Be.pendingPayments&&(Ce=Ce.filter(we=>{const Z=Ht[we.id]||[];return Z.some(Ne=>String(Ne.status_pagamento||"").toLowerCase()!=="pago")&&Z.length>0})),Vs.trim()){const we=Vs.trim().toLowerCase();Ce=Ce.filter(Z=>(Z.customer||"").toLowerCase().includes(we)||(Z.court||"").toLowerCase().includes(we)||($i[Z.status]?.label||"").toLowerCase().includes(we))}try{const we=Date.now(),Z=(nn||[]).filter(Ne=>{const Re=so(Ne.start);return Re>=so(M)&&Re<=so(H)}).filter(Ne=>Ne.status!=="canceled").filter(Ne=>{const Re=Nt.current.get(Ne.id);return Re&&Re.src==="automation"&&we-Re.ts<2e3}),ye=new Map(Ce.map(Ne=>[Ne.id,Ne]));for(const Ne of Z)ye.has(Ne.id)||ye.set(Ne.id,Ne);Ce=Array.from(ye.values())}catch{}return Ce},[nn,k,Be.scheduled,Be.canceledOnly,Be.pendingPayments,Vs,Ht,R]);p.useEffect(()=>{if(!Vs.trim()||!(Be.scheduled||Be.canceledOnly||Be.pendingPayments)||!wr||wr.length===0)return;const M=[...wr].sort((le,X)=>le.start-X.start)[0];if(!M?.id)return;const H=document.getElementById(`booking-${M.id}`);H?.scrollIntoView&&H.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},[Vs,wr,Be.scheduled,Be.canceledOnly,Be.pendingPayments]),p.useEffect(()=>{const M=vs.current,H=Os.current||{},le=Be.canceledOnly&&!H.canceledOnly,X=Be.scheduled&&!H.scheduled&&!Be.canceledOnly,Ce=Be.pendingPayments&&!H.pendingPayments;if(!M||!le&&!X&&!Ce){Os.current={scheduled:Be.scheduled,canceledOnly:Be.canceledOnly,pendingPayments:Be.pendingPayments};return}const we=wr||[];if(we.length===0){Os.current={scheduled:Be.scheduled,canceledOnly:Be.canceledOnly,pendingPayments:Be.pendingPayments};return}const Z=M.getBoundingClientRect();if(!we.some(Ne=>{const Re=document.getElementById(`booking-${Ne.id}`);if(!Re)return!1;const bt=Re.getBoundingClientRect();return bt.bottom>Z.top&&bt.top<Z.bottom})){const Ne=[...we].sort((bt,Rt)=>bt.start-Rt.start)[0],Re=Ne&&document.getElementById(`booking-${Ne.id}`);Re?.scrollIntoView&&Re.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}Os.current={scheduled:Be.scheduled,canceledOnly:Be.canceledOnly,pendingPayments:Be.pendingPayments}},[Be.scheduled,Be.canceledOnly,Be.pendingPayments,wr]);const Q=p.useMemo(()=>{if(!zn||!Ue[zn])return{start:dn,end:Yn};const M=Ue[zn],H=M.hora_inicio||`${dn}:00:00`,le=M.hora_fim||`${Yn}:00:00`,[X,Ce]=String(H).split(":").map(Number),[we,Z]=String(le).split(":").map(Number),ye=we===0&&Z===0?24:we,Ne=ye*60+(Z||0);return{start:X||dn,end:ye||Yn,startMinutes:(X||0)*60+(Ce||0),endMinutes:Ne}},[zn,Ue,dn,Yn]);return p.useMemo(()=>{const M=Q.start,H=Q.end;return Array.from({length:Math.max(0,H-M)},(le,X)=>M+X)},[Q]),p.useMemo(()=>{const M=Q.start,H=Q.end;return Math.max(0,H-M)*(60/es)*sl},[Q]),a.jsxs(a.Fragment,{children:[a.jsxs(Er.div,{variants:ce?void 0:CZe,initial:ce?!1:"hidden",animate:ce?!1:"visible",className:Sr("h-full w-full flex flex-col md:px-0",L&&"fixed inset-0 z-40 bg-surface"),children:[a.jsx(Er.div,{variants:wU,className:"p-3 bg-surface mb-6 md:rounded-lg",children:a.jsxs("div",{className:"max-w-[1200px] mx-auto w-full flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>B(z==="day"?Fv(k,1):Fv(k,7)),children:a.jsx(qI,{className:"h-5 w-5"})}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"ghost",className:"w-full sm:w-auto max-w-full justify-center text-base font-semibold whitespace-nowrap truncate",children:[a.jsx(lo,{className:"mr-2 h-5 w-5"}),z==="day"?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden sm:inline",children:sr(k,"EEE, dd 'de' MMMM 'de' yyyy",{locale:ga})}),a.jsx("span",{className:"sm:hidden",children:sr(k,"EEE, dd/MM/yyyy",{locale:ga})})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden sm:inline",children:SZe(k)}),a.jsxs("span",{className:"sm:hidden",children:[sr(lh(k),"dd/MM/yyyy")," - ",sr(rs(lh(k),6),"dd/MM/yyyy")]})]})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(oi,{mode:"single",selected:k,onSelect:M=>M&&B(M),initialFocus:!0})})]}),a.jsx(se,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>B(z==="day"?rs(k,1):rs(k,7)),children:a.jsx(qg,{className:"h-5 w-5"})})]}),Nr.length>0&&a.jsx("div",{className:"hidden md:flex md:justify-center md:flex-1",children:Nr.length===1?a.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 rounded-lg w-52 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:uh(Nr[0])}}),a.jsx("span",{className:"font-semibold text-sm",children:Nr[0]})]}):a.jsxs(Gn,{value:zn||Nr[0],onValueChange:M=>{Fn(M)},children:[a.jsx(Vn,{className:"w-52 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10 hover:border-brand/50 hover:bg-gradient-to-r hover:from-brand/10 hover:to-brand/15 transition-all shadow-sm",children:a.jsx(Kn,{placeholder:"Selecionar quadra"})}),a.jsx(Wn,{className:"border-brand/30",children:Nr.map(M=>{const H=uh(M);return a.jsx(lt,{value:M,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:H}}),a.jsx("span",{className:"font-semibold",children:M})]})},M)})})]})}),a.jsxs("div",{className:"flex flex-col gap-3 w-full md:w-auto md:ml-auto",children:[a.jsxs("div",{className:"flex items-center gap-3 justify-center md:hidden",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-lg bg-surface-2/30 p-0.5",children:[a.jsx(se,{variant:z==="day"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>U("day"),children:"Dia"}),a.jsx(se,{variant:z==="week"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>U("week"),children:"Semana"})]}),a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsxs(se,{variant:"outline",size:"sm",className:"gap-2",disabled:St.length===0,children:[a.jsx(f$,{className:"h-4 w-4"})," Filtros"]})}),a.jsxs(bm,{align:"end",className:"w-64",children:[a.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[a.jsx(l3,{className:"p-0",children:"Exibio"}),a.jsx(se,{variant:"ghost",size:"sm",className:"h-7 text-xs text-text-muted hover:text-text-primary",onClick:()=>Ge({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),children:"Limpar"})]}),a.jsx(Oj,{}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(lo,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Agendados"})]}),a.jsx(Is,{checked:Be.scheduled,onCheckedChange:M=>Ge(H=>({...H,scheduled:!!M,canceledOnly:M?!1:H.canceledOnly}))})]})}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(UI,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Livres"})]}),a.jsx(Is,{checked:Be.available,onCheckedChange:M=>Ge(H=>({...H,available:!!M,canceledOnly:M?!1:H.canceledOnly}))})]})}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Sg,{className:"h-4 w-4 text-rose-400"}),a.jsx("span",{children:"Cancelados"})]}),a.jsx(Is,{checked:Be.canceledOnly,onCheckedChange:M=>{const H=!!M;Ge(le=>({...le,canceledOnly:H,scheduled:H?!1:le.scheduled,available:H?!1:le.available})),H&&!ci&&mc(!0)}})]})}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Oi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{children:"Pagamentos Pendentes"})]}),a.jsx(Is,{checked:Be.pendingPayments,onCheckedChange:M=>Ge(H=>({...H,pendingPayments:!!M}))})]})})]})]}),a.jsxs("div",{className:"relative inline-block group",children:[a.jsx(se,{variant:L?"default":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>W(!L),"aria-label":L?"Minimizar grid":"Expandir grid",children:L?a.jsx(i$,{className:"h-4 w-4"}):a.jsx(o$,{className:"h-4 w-4"})}),a.jsx("div",{className:"hidden group-hover:block absolute right-0 mt-1 z-50 pointer-events-none",children:a.jsx("div",{className:"px-2 py-1 rounded-md bg-surface-2 text-xs text-text-primary border border-border shadow",children:L?"Minimizar (F10)":"Expandir (F10)"})})]}),a.jsx(se,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>gl(!0),disabled:St.length===0,"aria-label":"Configurar agenda",title:"Configurar agenda",children:a.jsx(fd,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"flex items-center gap-3 justify-end flex-shrink-0",children:[a.jsxs("div",{className:"relative w-full sm:w-56",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar agendamento...",className:"pl-9",value:Vs,onChange:M=>ii(M.target.value),onBlur:()=>ii("")}),Vs&&a.jsx("button",{type:"button","aria-label":"Limpar busca",className:"absolute right-2 top-1/2 -translate-y-1/2 px-2 py-0.5 rounded text-xs font-medium text-primary hover:bg-surface-2",onClick:()=>ii(""),children:"Limpar"})]}),a.jsxs(se,{size:"sm",onClick:()=>{Wt(null),Io(null),Se()},"aria-label":"Novo agendamento",className:"gap-2",disabled:St.length===0||Nr.every(M=>ge[M]&&!ge[M].funciona),children:[a.jsx(Es,{className:"h-4 w-4"})," Agendar"]})]}),Nr.length>0&&a.jsxs("div",{className:"md:hidden flex items-center justify-center gap-2",children:[Nr.length===1?a.jsxs("div",{className:"inline-flex items-center justify-center gap-3 px-4 py-2 rounded-lg w-auto h-10 max-w-full border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:uh(Nr[0])}}),a.jsx("span",{className:"font-semibold text-sm text-center whitespace-nowrap truncate",children:Nr[0]})]}):a.jsxs(Gn,{value:Nr[en%Nr.length],onValueChange:M=>{const H=Nr.indexOf(M);H!==-1&&Wa(H)},children:[a.jsx(Vn,{className:"w-48 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10 hover:border-brand/50 hover:bg-gradient-to-r hover:from-brand/10 hover:to-brand/15 transition-all shadow-sm",children:a.jsx(Kn,{placeholder:"Selecionar quadra"})}),a.jsx(Wn,{className:"border-brand/30",children:Nr.map(M=>{const H=uh(M);return a.jsx(lt,{value:M,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:H}}),a.jsx("span",{className:"font-semibold",children:M})]})},M)})})]}),ve&&a.jsx("button",{type:"button",onClick:async()=>{try{navigator.vibrate&&navigator.vibrate(30)}catch{}Ot()},className:"inline-flex items-center justify-center p-2 rounded-md border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-colors","aria-label":"Compartilhar",title:"Compartilhar",children:a.jsx(d$,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"hidden md:flex items-center gap-3 justify-end",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-lg bg-surface-2/30 p-0.5",children:[a.jsx(se,{variant:z==="day"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>U("day"),children:"Dia"}),a.jsx(se,{variant:z==="week"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>U("week"),children:"Semana"})]}),a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsxs(se,{variant:"outline",size:"sm",className:"gap-2",disabled:St.length===0,children:[a.jsx(f$,{className:"h-4 w-4"})," Filtros"]})}),a.jsxs(bm,{align:"end",className:"w-64",children:[a.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[a.jsx(l3,{className:"p-0",children:"Exibio"}),a.jsx(se,{variant:"ghost",size:"sm",className:"h-7 text-xs text-text-muted hover:text-text-primary",onClick:()=>Ge({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),children:"Limpar"})]}),a.jsx(Oj,{}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(lo,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Agendados"})]}),a.jsx(Is,{checked:Be.scheduled,onCheckedChange:M=>Ge(H=>({...H,scheduled:!!M,canceledOnly:M?!1:H.canceledOnly}))})]})}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(UI,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Livres"})]}),a.jsx(Is,{checked:Be.available,onCheckedChange:M=>Ge(H=>({...H,available:!!M,canceledOnly:M?!1:H.canceledOnly}))})]})}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Sg,{className:"h-4 w-4 text-rose-400"}),a.jsx("span",{children:"Cancelados"})]}),a.jsx(Is,{checked:Be.canceledOnly,onCheckedChange:M=>{const H=!!M;Ge(le=>({...le,canceledOnly:H,scheduled:H?!1:le.scheduled,available:H?!1:le.available})),H&&!ci&&mc(!0)}})]})}),a.jsx(Po,{onClick:M=>M.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Oi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{children:"Pagamentos Pendentes"})]}),a.jsx(Is,{checked:Be.pendingPayments,onCheckedChange:M=>Ge(H=>({...H,pendingPayments:!!M}))})]})})]})]}),a.jsxs("div",{className:"relative inline-block group",children:[a.jsx(se,{variant:L?"default":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>W(!L),"aria-label":L?"Minimizar grid":"Expandir grid",children:L?a.jsx(i$,{className:"h-4 w-4"}):a.jsx(o$,{className:"h-4 w-4"})}),a.jsx("div",{className:"hidden group-hover:block absolute right-0 mt-1 z-50 pointer-events-none",children:a.jsx("div",{className:"px-2 py-1 rounded-md bg-surface-2 text-xs text-text-primary border border-border shadow",children:L?"Minimizar (F10)":"Expandir (F10)"})})]}),a.jsx(se,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>gl(!0),disabled:St.length===0,"aria-label":"Configurar agenda",title:"Configurar agenda",children:a.jsx(fd,{className:"h-5 w-5"})})]})]})]})}),a.jsx(In,{open:$c,onOpenChange:M=>{M||xl(Ba),gl(M)},children:a.jsxs(En,{className:"sm:max-w-[680px]",onOpenAutoFocus:M=>M.preventDefault(),children:[a.jsx(Cn,{className:"pb-3 border-b border-border bg-surface-2/40 rounded-t-lg px-2 -mx-2 -mt-2",children:a.jsx(Nn,{className:"text-base font-semibold tracking-tight",children:"Configuraes da Agenda"})}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[a.jsx(vi,{className:"h-4 w-4",style:{color:$i.confirmed.hex}}),a.jsx("span",{className:"text-sm font-medium",children:"Confirmao automtica"})]}),a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-3",style:{borderLeftWidth:3,borderLeftColor:$i.confirmed.hex},children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Is,{id:"autoConfirmEnabled",checked:ts.autoConfirmEnabled,onCheckedChange:M=>xl(H=>({...H,autoConfirmEnabled:!!M}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:$i.confirmed.hex}}),a.jsx(it,{htmlFor:"autoConfirmEnabled",className:"font-medium",children:"Confirmao automtica"})]})]})}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(it,{htmlFor:"autoconfirm-hours",className:"text-sm text-text-muted",children:"Confirmar se faltar"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(Gn,{value:String(Math.max(0,Math.round((ts.autoConfirmMinutesBefore||0)/60))),onValueChange:M=>xl(H=>({...H,autoConfirmMinutesBefore:Math.max(0,Number(M))*60})),disabled:!ts.autoConfirmEnabled,children:[a.jsx(Vn,{className:"w-32",children:a.jsx(Kn,{placeholder:"Horas"})}),a.jsxs(Wn,{align:"start",children:[a.jsx(lt,{value:"0",children:"Imediato"}),a.jsx(lt,{value:"1",children:"1 h"}),a.jsx(lt,{value:"2",children:"2 h"}),a.jsx(lt,{value:"3",children:"3 h"}),a.jsx(lt,{value:"4",children:"4 h"}),a.jsx(lt,{value:"6",children:"6 h"}),a.jsx(lt,{value:"8",children:"8 h"}),a.jsx(lt,{value:"12",children:"12 h"}),a.jsx(lt,{value:"24",children:"24 h"})]})]}),a.jsx("span",{className:"text-sm text-text-muted",children:"antes"})]})]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[a.jsx(_G,{className:"h-4 w-4",style:{color:$i.in_progress.hex}}),a.jsx("span",{className:"text-sm font-medium",children:"Transies automticas"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-2",style:{borderLeftWidth:3,borderLeftColor:$i.in_progress.hex},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Is,{id:"autoStartEnabled",checked:ts.autoStartEnabled,onCheckedChange:M=>xl(H=>({...H,autoStartEnabled:!!M}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:$i.in_progress.hex}}),a.jsx(it,{htmlFor:"autoStartEnabled",className:"font-medium",children:"Iniciar no horrio"})]})]}),a.jsx("p",{className:"text-xs text-text-muted ml-7",children:"Confirmado  Em andamento no horrio de incio."})]}),a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-2",style:{borderLeftWidth:3,borderLeftColor:$i.finished.hex},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Is,{id:"autoFinishEnabled",checked:ts.autoFinishEnabled,onCheckedChange:M=>xl(H=>({...H,autoFinishEnabled:!!M}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:$i.finished.hex}}),a.jsx(it,{htmlFor:"autoFinishEnabled",className:"font-medium",children:"Finalizar ao trmino"})]})]}),a.jsx("p",{className:"text-xs text-text-muted ml-7",children:"Em andamento  Finalizado no horrio de trmino."})]})]})]})]}),a.jsxs(Na,{className:"mt-2 gap-2",children:[a.jsx(se,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>gl(!1),children:"Cancelar"}),a.jsx(se,{type:"button",variant:"default",onClick:()=>{console.log(" BOTO SALVAR CLICADO!"),or()},disabled:Xr,children:Xr?"Salvando":"Salvar"})]})]})}),a.jsx(In,{open:Fc,onOpenChange:mc,children:a.jsxs(En,{className:"sm:max-w-[520px]",onOpenAutoFocus:M=>M.preventDefault(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Sobre agendamentos cancelados"}),a.jsx(Hn,{children:"Agendamentos cancelados no aparecem na agenda quando o filtro no est selecionado e no ocupam horrio."})]}),a.jsxs("div",{className:"flex items-start gap-3 mt-2",children:[a.jsx(Is,{id:"hide-canceled-info",checked:ci,onCheckedChange:M=>Lc(!!M),className:"mt-0.5"}),a.jsx(it,{htmlFor:"hide-canceled-info",className:"text-sm cursor-pointer text-text-secondary",children:"No mostrar novamente"})]}),a.jsx(Na,{className:"mt-4",children:a.jsx(se,{type:"button",onClick:()=>mc(!1),children:"Entendi"})})]})}),!yt&&St.length===0&&a.jsxs("div",{className:"mb-4 p-4 rounded-lg border border-border bg-surface text-sm flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:"Nenhuma quadra encontrada"}),a.jsx("div",{className:"text-text-muted",children:"Cadastre suas quadras para comear a usar a agenda."})]}),a.jsx(se,{asChild:!0,className:"w-full sm:w-auto",children:a.jsxs(H4,{to:"/quadras",children:[a.jsx("span",{className:"hidden sm:inline",children:"Ir para Cadastros  Quadras"}),a.jsx("span",{className:"sm:hidden",children:"Adicionar"})]})})]}),qe?a.jsx("div",{className:"mt-4 rounded-xl border border-border bg-surface/70 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-surface/60",children:a.jsxs("div",{className:"flex items-center justify-center gap-4 px-6 py-8",children:[a.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full border-2 border-border/60 border-t-brand animate-spin"}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Carregando agenda"}),a.jsx("div",{className:"text-xs text-text-muted truncate",children:Je||"Aguarde um instante"}),a.jsx("div",{className:"mt-3 h-1.5 w-56 max-w-[70vw] rounded-full bg-border/40 overflow-hidden",children:a.jsx("div",{className:"h-full w-1/2 bg-gradient-to-r from-brand/30 via-brand to-brand/30 animate-pulse"})})]})]})}):a.jsxs(a.Fragment,{children:[Nr.length>0&&z==="week"&&(()=>{const M=zn||Nr[0],H=R?D.filter(le=>{const X=le.court===M,Ce=Ue?.[M]||{},we=String(Ce.id||Ce.codigo||""),Z=we&&String(le.court_id||"")===we;return X||Z}):D;return a.jsx(a.Fragment,{children:a.jsx(jZe,{weekStart:lh(k),weekBookings:H,activeCourtFilter:M,courtsMap:Ue,participantsByAgendamento:Ht,onBookingClick:le=>{Wt(le),Xe(!0)},onSlotClick:(le,X)=>{Wt(null);const Ce=le.getHours()*60+le.getMinutes(),we=X||zn||Nr[0],Z=sr(le,"yyyy-MM-dd"),ye=Ue?.[we]?.id,Ne=(()=>{try{return(nn||[]).filter(qt=>{const rr=qt.court===we,qr=ye!=null&&String(qt.court_id||"")===String(ye);return(rr||qr)&&sr(qt.start,"yyyy-MM-dd")===Z&&qt.status!=="canceled"}).map(qt=>kd(qt.start)*60+Id(qt.start)).filter(qt=>qt>Ce).sort((qt,rr)=>qt-rr)[0]}catch{}})(),Re=(()=>{const qt=Ue[we]?.hora_fim;if(!qt)return Yn*60;const[rr,qr]=String(qt).split(":").map(Number);return(rr===0&&(qr||0)===0?24:rr)*60+(qr||0)})(),bt=typeof Ne=="number"?Ne:Re;let Rt=Math.min(Ce+60,bt);Rt-Ce<30&&(bt-30>=Ce?Rt=bt:Rt=Math.min(Re,Ce+30));const dr={date:so(le),court:we,startMinutes:Ce,endMinutes:Rt};console.log("onSlotClick in AgendaPage - BEFORE setPrefill",{slotDate:le,court:X,activeCourtFilter:zn,selectedCourts:Nr,startMinutes:Ce,endMinutes:Rt,prefillData:dr}),Io(dr),console.log("onSlotClick in AgendaPage - AFTER setPrefill (state not updated yet)"),Se()},statusConfig:$i,dayStartHour:dn,dayEndHourExclusive:Yn,weekDiasFuncionamento:Y,sidebarVisible:e},`weekly-${M}`)})})(),Nr.length>0&&z==="day"&&(()=>{const M=typeof window<"u"&&window.innerWidth<768,H=M?[Nr[en%Nr.length]]:zn?[zn]:Nr,le=M?H[0]:zn,X=(()=>{if(le&&Ue[le]){const Z=Ue[le],ye=Z.hora_inicio||`${dn}:00:00`,Ne=Z.hora_fim||`${Yn}:00:00`,[Re]=String(ye).split(":").map(Number),[bt,Rt]=String(Ne).split(":").map(Number);let dr=bt===0&&Rt===0?24:bt;return Rt>0&&dr<24&&(dr+=1),{start:Re||dn,end:dr||Yn}}return{start:dn,end:Yn}})(),Ce=Array.from({length:Math.max(0,X.end-X.start)},(Z,ye)=>X.start+ye),we=Math.max(0,X.end-X.start)*(60/es)*sl;return H.some(Z=>ge[Z]&&!ge[Z].funciona),a.jsx(a.Fragment,{children:a.jsx(Er.div,{variants:ce?void 0:wU,className:Sr("bg-surface fx-scroll","overflow-auto",M?"":"rounded-lg border border-border"),ref:vs,style:{flex:"1 1 auto",minWidth:0},children:a.jsxs("div",{className:Sr("grid",!M&&"mx-auto"),style:{gridTemplateColumns:M?"60px 1fr":H.length===1?"120px 760px":H.length===2?"120px repeat(2, 520px)":`120px repeat(${H.length}, 1fr)`,width:M?"100%":H.length<=2?"fit-content":void 0,columnGap:M?"4px":"16px"},children:[a.jsxs("div",{className:"sticky left-0 bg-surface z-20",children:[a.jsx("div",{className:"sticky top-0 z-20 h-14 border-b border-r border-border bg-surface flex items-center justify-center px-2",children:a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsx(se,{size:"sm",variant:"ghost",className:"hover:bg-surface-2/50 text-lg font-semibold",children:Dl(k,new Date)?"Hoje":sr(k,"EEEE",{locale:ga})})}),a.jsxs(bm,{align:"center",children:[a.jsx(Po,{onClick:()=>B(new Date),children:"Hoje"}),a.jsx(Oj,{}),(()=>{const Z=["Segunda","Tera","Quarta","Quinta","Sexta","Sbado","Domingo"],ye=ou(k,{weekStartsOn:1,locale:ga});return Z.map((Ne,Re)=>a.jsx(Po,{onClick:()=>B(rs(ye,Re)),children:Ne},Ne))})()]})]})}),Ce.map(Z=>a.jsxs("div",{className:Sr("border-r border-border",Z%2===1&&"bg-surface-2/30"),children:[a.jsx("div",{className:"relative border-b border-border/80",style:{height:sl},children:a.jsxs("span",{className:Sr("absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded font-bold",M?"px-1 text-sm":"px-2 text-lg"),children:[String(Z).padStart(2,"0"),":00"]})}),a.jsx("div",{className:"relative border-b border-border/80",style:{height:sl},children:a.jsxs("span",{className:Sr("absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded font-bold",M?"px-1 text-sm":"px-2 text-lg"),children:[String(Z).padStart(2,"0"),":30"]})})]},`time-${Z}`))]}),H.map((Z,ye)=>a.jsxs("div",{className:"relative border-r border-border",children:[a.jsx("div",{className:"h-14 border-b border-border sticky top-0 bg-surface z-10 flex items-center justify-center",children:ye===0&&a.jsxs("div",{className:"flex items-center justify-center gap-4 px-3",children:[Wr.totalBookings>0&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-surface-2/50",children:[a.jsx("span",{className:"text-lg",children:""}),a.jsx("span",{className:"font-bold text-text-primary",children:Wr.totalBookings}),a.jsxs("span",{className:"font-semibold text-xs text-text-muted",children:["agendamento",Wr.totalBookings!==1?"s":""]})]}),Wr.totalPendingPayments>0&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-surface-2/50",children:[a.jsx("span",{className:"text-lg",children:""}),a.jsx("span",{className:"font-bold text-text-primary",children:Wr.totalPendingPayments}),a.jsxs("span",{className:"font-semibold text-xs text-text-muted",children:["pendente",Wr.totalPendingPayments!==1?"s":""]})]}),ve&&!M&&a.jsxs("button",{type:"button",onClick:async()=>{try{navigator.vibrate&&navigator.vibrate(30)}catch{}Ot()},className:Sr("inline-flex items-center rounded-md text-xs border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-colors",M?"p-2":"gap-2 px-3 py-1.5"),"aria-label":"Compartilhar",title:"Compartilhar",children:[a.jsx(d$,{className:"w-4 h-4"}),!M&&a.jsx("span",{className:"hidden sm:inline",children:"Compartilhar"})]})]})}),a.jsxs("div",{className:Sr("relative"),style:{height:we},children:[ge[Z]&&!ge[Z].funciona?(()=>Ce.map(Ne=>a.jsx("div",{className:"absolute w-full cursor-not-allowed bg-surface/60 flex items-center justify-center border-b border-border/30 transition-colors",style:{height:sl*2,top:Ce.indexOf(Ne)*sl*2},children:a.jsxs("div",{className:"text-center pointer-events-none",children:[a.jsx(X4,{className:"h-5 w-5 text-text-primary mx-auto mb-1"}),a.jsx("div",{className:"text-xs font-medium text-text-primary mb-1",children:"Fechada"}),ge[Z].observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:ge[Z].observacao})]})},`closed-${Z}-${Ne}`)))():null,(Be.scheduled||Be.canceledOnly||Be.pendingPayments)&&(()=>{const Ne=X.start*60,Re=X.end*60,bt=(()=>{const $n=Ue[Z]?.hora_inicio,_n=Ue[Z]?.hora_fim,[un,Ca]=String($n||`${X.start}:00:00`).split(":").map(Number),[Zn,Mn]=String(_n||`${X.end}:00:00`).split(":").map(Number),Yr=Zn===0&&Mn===0?24:Zn||0;return{start:(un||0)*60+(Ca||0),end:Yr*60+(Mn||0)}})(),Rt=Math.max(bt.start,Ne),dr=Math.min(bt.end,Re),qt=Math.max(0,Math.floor((Rt-Ne)/es)),rr=Math.max(qt,Math.ceil((dr-Ne)/es)),qr=Math.max(0,(Re-Ne)/es),Dn=qt*sl,$r=Math.min(qr,Math.max(0,rr-qt)),xn=Math.max(0,(qr-rr)*sl);return a.jsxs(a.Fragment,{children:[Dn>0&&a.jsx("div",{style:{height:Dn}}),Array.from({length:$r},($n,_n)=>{const un=qt+_n,Zn=(Math.floor(un/(60/es))+Math.floor(Ne/60))%2===1;return a.jsx("div",{className:Sr("border-b border-border/80",Zn&&"bg-surface-2/30"),style:{height:sl}},`base-${Z}-slot-${un}`)}),xn>0&&a.jsx("div",{style:{height:xn}})]})})(),wr.filter(Ne=>{if(!R)return!0;const Re=Ne.court===Z,bt=Ue?.[Z]||{},Rt=String(bt.id||bt.codigo||""),dr=Rt&&String(Ne.court_id||"")===Rt;return Re||dr}).map(Ne=>a.jsx(Ir,{booking:Ne,courtGridStart:X.start*60,courtGridEnd:X.end*60},Ne.id)),Be.available&&!(ge[Z]&&!ge[Z].funciona)&&(()=>{const Ne=(()=>{const $r=Ue[Z]?.hora_inicio;if(!$r)return dn*60;const[xn,$n]=String($r).split(":").map(Number);return xn*60+($n||0)})(),Re=(()=>{const $r=Ue[Z]?.hora_fim;if(!$r)return Yn*60;const[xn,$n]=String($r).split(":").map(Number);return(xn===0&&$n===0?24:xn)*60+($n||0)})(),bt=$r=>{const xn=kd($r),$n=Id($r);return xn===0&&$n===0?1440:xn*60+$n},Rt=sr(k,"yyyy-MM-dd"),dr=Ue?.[Z]?.id,qt=nn.filter($r=>{const xn=$r.court===Z,$n=dr!=null&&String($r.court_id||"")===String(dr);return(xn||$n)&&sr($r.start,"yyyy-MM-dd")===Rt&&$r.status!=="canceled"}).map($r=>[bt($r.start),bt($r.end)]).sort(($r,xn)=>$r[0]-xn[0]),rr=[];let qr=Ne;for(const[$r,xn]of qt)$r>qr&&rr.push([qr,$r]),qr=Math.max(qr,xn);qr<Re&&rr.push([qr,Re]);const Dn=({startM:$r,endM:xn})=>{const[$n,_n]=p.useState(null),un=X.start*60,Ca=Math.floor(($r-un)/es),Zn=Math.max(1,Math.ceil((xn-$r)/es)),Mn=Ca+Zn,Yr=Ca*sl-1,Sn=(Mn-Ca)*sl+2;let Da=Math.floor($r/60),Ha=Math.floor(xn/60);Da>=24&&(Da=Da%24),Ha>=24&&(Ha=Ha%24);const Xs=`${String(Da).padStart(2,"0")}:${String($r%60).padStart(2,"0")}`,jo=`${String(Ha).padStart(2,"0")}:${String(xn%60).padStart(2,"0")}`;return a.jsxs("div",{className:Sr("absolute left-2 right-2 rounded-md border-2 border-dashed text-sm z-0 cursor-pointer","border-[#10B981]","bg-transparent hover:border-[#10B981]/80 hover:shadow-sm"),style:{top:`${Yr}px`,height:`${Sn}px`},onMouseMove:jn=>{const Pn=jn.currentTarget.getBoundingClientRect(),Rn=Math.min(Math.max(0,jn.clientY-Pn.top),Pn.height);let va=Math.floor(Rn/sl);va=Math.max(0,Math.min(va,Zn-1)),_n(va)},onMouseLeave:()=>_n(null),onClick:jn=>{const Pn=jn.currentTarget.getBoundingClientRect(),Rn=Math.min(Math.max(0,jn.clientY-Pn.top),Pn.height),va=Math.floor(Rn/sl);let Ga=$r+va*es;Ga=Math.max($r,Math.min(Ga,xn-es));const hs=(()=>{const Ys=Ue?.[Z]?.id;return nn.filter(mo=>{const oa=mo.court===Z,is=Ys!=null&&String(mo.court_id||"")===String(Ys);return(oa||is)&&sr(mo.start,"yyyy-MM-dd")===Rt}).map(mo=>kd(mo.start)*60+Id(mo.start)).filter(mo=>mo>Ga).sort((mo,oa)=>mo-oa)[0]})(),to=typeof hs=="number"?hs:Re;let Ts=Math.min(Ga+60,to);if(Ts-Ga<30){const Ys=to-30;Ys>=$r?(Ga=Math.max($r,Math.min(Ga,Ys)),Ts=to):(Ga=$r,Ts=Math.min(to,xn))}Wt(null);{const Ys=St||[],Bo=Ys.includes(Z)?Z:Ys[0]||"";Io({court:Bo,date:k,startMinutes:Ga,endMinutes:Ts})}try{lastNonEmptySelectionRef.current=[],setChipsSnapshot([])}catch{}Se()},title:`Livre: ${Xs}${jo}`,children:[$n!==null&&a.jsx("div",{className:"pointer-events-none absolute left-[6px] right-[6px] rounded-md border border-white/10 bg-white/5",style:{top:`${$n*sl}px`,height:`${sl}px`}}),a.jsxs("div",{className:"h-full px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"font-medium text-[#10B981]",children:"Livre"}),a.jsxs("span",{className:"text-text-muted",children:[Xs,"",jo]})]})]})};return rr.map(([$r,xn],$n)=>a.jsx(Dn,{startM:$r,endM:xn},`free-${Z}-${$n}`))})()]})]},Z))]})})})})()]})]}),wn(),a.jsx(In,{open:oe,onOpenChange:M=>{M||Cr()},children:a.jsxs(En,{className:"w-[calc(100vw-24px)] sm:w-full max-w-[980px] max-h-[85vh] overflow-y-auto mx-auto p-4 sm:p-6",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Compartilhar"}),a.jsx(Hn,{children:"Gere uma imagem pronta para Story/Status."})]}),a.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[a.jsx(se,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>gt(M=>Fv(M||new Date,1)),"aria-label":"Dia anterior",title:"Dia anterior",children:a.jsx(qI,{className:"h-5 w-5"})}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"ghost",className:"w-full sm:w-auto max-w-full justify-center text-base font-semibold whitespace-nowrap truncate",children:[a.jsx(lo,{className:"mr-2 h-5 w-5"}),a.jsx("span",{className:"sm:hidden",children:`${sr(wt||new Date,"EEEE",{locale:ga}).replace(/-feira\b/gi,"").trim()}, ${sr(wt||new Date,"dd/MM",{locale:ga})}`}),a.jsx("span",{className:"hidden sm:inline",children:`${sr(wt||new Date,"EEEE",{locale:ga}).replace(/-feira\b/gi,"").trim()}, ${sr(wt||new Date,"dd 'de' MMMM 'de' yyyy",{locale:ga})}`})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(oi,{mode:"single",selected:wt||new Date,onSelect:M=>M&&gt(M),initialFocus:!0})})]}),a.jsx(se,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>gt(M=>rs(M||new Date,1)),"aria-label":"Prximo dia",title:"Prximo dia",children:a.jsx(qg,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[a.jsx("div",{className:"w-full",children:a.jsx("div",{className:"w-full rounded-xl border border-white/10 bg-black/25 overflow-hidden shadow-[0_0_0_1px_rgba(255,255,255,0.06)]",children:a.jsx("div",{className:"w-full aspect-[9/16] flex items-center justify-center",children:ie?a.jsx("img",{src:ie,alt:"Prvia",className:"w-full h-full object-cover"}):a.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 text-text-muted",children:[a.jsx(Zl,{className:"w-5 h-5 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Gerando imagem"})]})})})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Legenda"}),a.jsxs("button",{type:"button",onClick:xr,className:"inline-flex items-center gap-2 px-2 py-1 rounded-md border border-white/10 bg-black/10 hover:bg-black/20 transition-colors","aria-label":"Copiar legenda",title:"Copiar legenda",children:[a.jsx(Q4,{className:"w-4 h-4"}),a.jsx("span",{className:"text-xs",children:"Copiar"})]})]}),a.jsx("pre",{className:"whitespace-pre-wrap text-sm text-text-primary font-sans leading-relaxed",children:xt})]}),a.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[a.jsx("div",{className:"text-xs text-text-muted mb-3",children:"Compartilhar"}),a.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-1",children:[a.jsxs("button",{type:"button",onClick:kr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:a.jsx("img",{src:"/imagem.png",alt:"Imagem",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Imagem"})]}),a.jsxs("button",{type:"button",onClick:_r,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-emerald-500/15 border border-emerald-400/20 flex items-center justify-center",children:a.jsx("img",{src:"/whattsapp.png",alt:"WhatsApp",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"WhatsApp"})]}),a.jsxs("button",{type:"button",onClick:Rr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-fuchsia-500/15 border border-fuchsia-400/20 flex items-center justify-center",children:a.jsx("img",{src:"/instagram.png",alt:"Instagram",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Instagram"})]}),a.jsxs("button",{type:"button",onClick:Jt,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:a.jsx(Hue,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Link"})]})]})]})]})]}),a.jsx(Na,{children:a.jsx(se,{type:"button",variant:"outline",onClick:Cr,children:"Fechar"})})]})})]})}function jU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function NU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jU(Object(r),!0).forEach(function(n){u2e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bc(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var SU=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),gk=function(){return Math.random().toString(36).substring(7).split("").join(".")},CU={INIT:"@@redux/INIT"+gk(),REPLACE:"@@redux/REPLACE"+gk(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+gk()}};function PZe(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function zae(e,t,r){var n;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(bc(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(bc(1));return r(zae)(e,t)}if(typeof e!="function")throw new Error(bc(2));var s=e,o=t,i=[],l=i,c=!1;function d(){l===i&&(l=i.slice())}function u(){if(c)throw new Error(bc(3));return o}function f(g){if(typeof g!="function")throw new Error(bc(4));if(c)throw new Error(bc(5));var y=!0;return d(),l.push(g),function(){if(y){if(c)throw new Error(bc(6));y=!1,d();var b=l.indexOf(g);l.splice(b,1),i=null}}}function h(g){if(!PZe(g))throw new Error(bc(7));if(typeof g.type>"u")throw new Error(bc(8));if(c)throw new Error(bc(9));try{c=!0,o=s(o,g)}finally{c=!1}for(var y=i=l,v=0;v<y.length;v++){var b=y[v];b()}return g}function m(g){if(typeof g!="function")throw new Error(bc(10));s=g,h({type:CU.REPLACE})}function x(){var g,y=f;return g={subscribe:function(b){if(typeof b!="object"||b===null)throw new Error(bc(11));function w(){b.next&&b.next(u())}w();var _=y(w);return{unsubscribe:_}}},g[SU]=function(){return this},g}return h({type:CU.INIT}),n={dispatch:h,subscribe:f,getState:u,replaceReducer:m},n[SU]=x,n}function AU(e,t){return function(){return t(e.apply(this,arguments))}}function PU(e,t){if(typeof e=="function")return AU(e,t);if(typeof e!="object"||e===null)throw new Error(bc(16));var r={};for(var n in e){var s=e[n];typeof s=="function"&&(r[n]=AU(s,t))}return r}function Uae(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?function(n){return n}:t.length===1?t[0]:t.reduce(function(n,s){return function(){return n(s.apply(void 0,arguments))}})}function EZe(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return function(){var s=n.apply(void 0,arguments),o=function(){throw new Error(bc(15))},i={getState:s.getState,dispatch:function(){return o.apply(void 0,arguments)}},l=t.map(function(c){return c(i)});return o=Uae.apply(void 0,l)(s.dispatch),NU(NU({},s),{},{dispatch:o})}}}var Vae=Ee.createContext(null);function kZe(e){e()}var Wae=kZe,IZe=function(t){return Wae=t},OZe=function(){return Wae};function TZe(){var e=OZe(),t=null,r=null;return{clear:function(){t=null,r=null},notify:function(){e(function(){for(var s=t;s;)s.callback(),s=s.next})},get:function(){for(var s=[],o=t;o;)s.push(o),o=o.next;return s},subscribe:function(s){var o=!0,i=r={callback:s,next:null,prev:r};return i.prev?i.prev.next=i:t=i,function(){!o||t===null||(o=!1,i.next?i.next.prev=i.prev:r=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}var EU={notify:function(){},get:function(){return[]}};function Hae(e,t){var r,n=EU;function s(f){return c(),n.subscribe(f)}function o(){n.notify()}function i(){u.onStateChange&&u.onStateChange()}function l(){return!!r}function c(){r||(r=t?t.addNestedSub(i):e.subscribe(i),n=TZe())}function d(){r&&(r(),r=void 0,n.clear(),n=EU)}var u={addNestedSub:s,notifyNestedSubs:o,handleChangeWrapper:i,isSubscribed:l,trySubscribe:c,tryUnsubscribe:d,getListeners:function(){return n}};return u}var Gae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?p.useLayoutEffect:p.useEffect;function DZe(e){var t=e.store,r=e.context,n=e.children,s=p.useMemo(function(){var l=Hae(t);return{store:t,subscription:l}},[t]),o=p.useMemo(function(){return t.getState()},[t]);Gae(function(){var l=s.subscription;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==t.getState()&&l.notifyNestedSubs(),function(){l.tryUnsubscribe(),l.onStateChange=null}},[s,o]);var i=r||Vae;return Ee.createElement(i.Provider,{value:s},n)}var Kae={exports:{}},Us={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ji=typeof Symbol=="function"&&Symbol.for,VR=Ji?Symbol.for("react.element"):60103,WR=Ji?Symbol.for("react.portal"):60106,vA=Ji?Symbol.for("react.fragment"):60107,yA=Ji?Symbol.for("react.strict_mode"):60108,bA=Ji?Symbol.for("react.profiler"):60114,wA=Ji?Symbol.for("react.provider"):60109,_A=Ji?Symbol.for("react.context"):60110,HR=Ji?Symbol.for("react.async_mode"):60111,jA=Ji?Symbol.for("react.concurrent_mode"):60111,NA=Ji?Symbol.for("react.forward_ref"):60112,SA=Ji?Symbol.for("react.suspense"):60113,MZe=Ji?Symbol.for("react.suspense_list"):60120,CA=Ji?Symbol.for("react.memo"):60115,AA=Ji?Symbol.for("react.lazy"):60116,RZe=Ji?Symbol.for("react.block"):60121,FZe=Ji?Symbol.for("react.fundamental"):60117,LZe=Ji?Symbol.for("react.responder"):60118,$Ze=Ji?Symbol.for("react.scope"):60119;function Nd(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case VR:switch(e=e.type,e){case HR:case jA:case vA:case bA:case yA:case SA:return e;default:switch(e=e&&e.$$typeof,e){case _A:case NA:case AA:case CA:case wA:return e;default:return t}}case WR:return t}}}function Xae(e){return Nd(e)===jA}Us.AsyncMode=HR;Us.ConcurrentMode=jA;Us.ContextConsumer=_A;Us.ContextProvider=wA;Us.Element=VR;Us.ForwardRef=NA;Us.Fragment=vA;Us.Lazy=AA;Us.Memo=CA;Us.Portal=WR;Us.Profiler=bA;Us.StrictMode=yA;Us.Suspense=SA;Us.isAsyncMode=function(e){return Xae(e)||Nd(e)===HR};Us.isConcurrentMode=Xae;Us.isContextConsumer=function(e){return Nd(e)===_A};Us.isContextProvider=function(e){return Nd(e)===wA};Us.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===VR};Us.isForwardRef=function(e){return Nd(e)===NA};Us.isFragment=function(e){return Nd(e)===vA};Us.isLazy=function(e){return Nd(e)===AA};Us.isMemo=function(e){return Nd(e)===CA};Us.isPortal=function(e){return Nd(e)===WR};Us.isProfiler=function(e){return Nd(e)===bA};Us.isStrictMode=function(e){return Nd(e)===yA};Us.isSuspense=function(e){return Nd(e)===SA};Us.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===vA||e===jA||e===bA||e===yA||e===SA||e===MZe||typeof e=="object"&&e!==null&&(e.$$typeof===AA||e.$$typeof===CA||e.$$typeof===wA||e.$$typeof===_A||e.$$typeof===NA||e.$$typeof===FZe||e.$$typeof===LZe||e.$$typeof===$Ze||e.$$typeof===RZe)};Us.typeOf=Nd;Kae.exports=Us;var BZe=Kae.exports,GR=BZe,qZe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},zZe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},UZe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Yae={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},KR={};KR[GR.ForwardRef]=UZe;KR[GR.Memo]=Yae;function kU(e){return GR.isMemo(e)?Yae:KR[e.$$typeof]||qZe}var VZe=Object.defineProperty,WZe=Object.getOwnPropertyNames,IU=Object.getOwnPropertySymbols,HZe=Object.getOwnPropertyDescriptor,GZe=Object.getPrototypeOf,OU=Object.prototype;function Jae(e,t,r){if(typeof t!="string"){if(OU){var n=GZe(t);n&&n!==OU&&Jae(e,n,r)}var s=WZe(t);IU&&(s=s.concat(IU(t)));for(var o=kU(e),i=kU(t),l=0;l<s.length;++l){var c=s[l];if(!zZe[c]&&!(r&&r[c])&&!(i&&i[c])&&!(o&&o[c])){var d=HZe(t,c);try{VZe(e,c,d)}catch{}}}}return e}var KZe=Jae;const TU=xs(KZe);var Qae={exports:{}},eo={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PA=60103,EA=60106,b2=60107,w2=60108,_2=60114,j2=60109,N2=60110,S2=60112,C2=60113,XR=60120,A2=60115,P2=60116,Zae=60121,ese=60122,tse=60117,rse=60129,nse=60131;if(typeof Symbol=="function"&&Symbol.for){var ol=Symbol.for;PA=ol("react.element"),EA=ol("react.portal"),b2=ol("react.fragment"),w2=ol("react.strict_mode"),_2=ol("react.profiler"),j2=ol("react.provider"),N2=ol("react.context"),S2=ol("react.forward_ref"),C2=ol("react.suspense"),XR=ol("react.suspense_list"),A2=ol("react.memo"),P2=ol("react.lazy"),Zae=ol("react.block"),ese=ol("react.server.block"),tse=ol("react.fundamental"),rse=ol("react.debug_trace_mode"),nse=ol("react.legacy_hidden")}function Ju(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case PA:switch(e=e.type,e){case b2:case _2:case w2:case C2:case XR:return e;default:switch(e=e&&e.$$typeof,e){case N2:case S2:case P2:case A2:case j2:return e;default:return t}}case EA:return t}}}var XZe=j2,YZe=PA,JZe=S2,QZe=b2,ZZe=P2,eet=A2,tet=EA,ret=_2,net=w2,aet=C2;eo.ContextConsumer=N2;eo.ContextProvider=XZe;eo.Element=YZe;eo.ForwardRef=JZe;eo.Fragment=QZe;eo.Lazy=ZZe;eo.Memo=eet;eo.Portal=tet;eo.Profiler=ret;eo.StrictMode=net;eo.Suspense=aet;eo.isAsyncMode=function(){return!1};eo.isConcurrentMode=function(){return!1};eo.isContextConsumer=function(e){return Ju(e)===N2};eo.isContextProvider=function(e){return Ju(e)===j2};eo.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===PA};eo.isForwardRef=function(e){return Ju(e)===S2};eo.isFragment=function(e){return Ju(e)===b2};eo.isLazy=function(e){return Ju(e)===P2};eo.isMemo=function(e){return Ju(e)===A2};eo.isPortal=function(e){return Ju(e)===EA};eo.isProfiler=function(e){return Ju(e)===_2};eo.isStrictMode=function(e){return Ju(e)===w2};eo.isSuspense=function(e){return Ju(e)===C2};eo.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===b2||e===_2||e===rse||e===w2||e===C2||e===XR||e===nse||typeof e=="object"&&e!==null&&(e.$$typeof===P2||e.$$typeof===A2||e.$$typeof===j2||e.$$typeof===N2||e.$$typeof===S2||e.$$typeof===tse||e.$$typeof===Zae||e[0]===ese)};eo.typeOf=Ju;Qae.exports=eo;var set=Qae.exports,oet=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],iet=["reactReduxForwardedRef"],cet=[],det=[null,null];function uet(e,t){var r=e[1];return[t.payload,r+1]}function DU(e,t,r){Gae(function(){return e.apply(void 0,t)},r)}function fet(e,t,r,n,s,o,i){e.current=n,t.current=s,r.current=!1,o.current&&(o.current=null,i())}function met(e,t,r,n,s,o,i,l,c,d){if(e){var u=!1,f=null,h=function(){if(!u){var g=t.getState(),y,v;try{y=n(g,s.current)}catch(b){v=b,f=b}v||(f=null),y===o.current?i.current||c():(o.current=y,l.current=y,i.current=!0,d({type:"STORE_UPDATED",payload:{error:v}}))}};r.onStateChange=h,r.trySubscribe(),h();var m=function(){if(u=!0,r.tryUnsubscribe(),r.onStateChange=null,f)throw f};return m}}var het=function(){return[null,0]};function pet(e,t){t===void 0&&(t={});var r=t,n=r.getDisplayName,s=n===void 0?function(w){return"ConnectAdvanced("+w+")"}:n,o=r.methodName,i=o===void 0?"connectAdvanced":o,l=r.renderCountProp,c=l===void 0?void 0:l,d=r.shouldHandleStateChanges,u=d===void 0?!0:d,f=r.storeKey,h=f===void 0?"store":f;r.withRef;var m=r.forwardRef,x=m===void 0?!1:m,g=r.context,y=g===void 0?Vae:g,v=gS(r,oet),b=y;return function(_){var j=_.displayName||_.name||"Component",S=s(j),C=Sa({},v,{getDisplayName:s,methodName:i,renderCountProp:c,shouldHandleStateChanges:u,storeKey:h,displayName:S,wrappedComponentName:j,WrappedComponent:_}),A=v.pure;function P(k){return e(k.dispatch,C)}var F=A?p.useMemo:function(k){return k()};function O(k){var B=p.useMemo(function(){var vt=k.reactReduxForwardedRef,wt=gS(k,iet);return[k.context,vt,wt]},[k]),z=B[0],U=B[1],L=B[2],W=p.useMemo(function(){return z&&z.Consumer&&set.isContextConsumer(Ee.createElement(z.Consumer,null))?z:b},[z,b]),ge=p.useContext(W),Ae=!!k.store&&!!k.store.getState&&!!k.store.dispatch;ge&&ge.store;var V=Ae?k.store:ge.store,$=p.useMemo(function(){return P(V)},[V]),Y=p.useMemo(function(){if(!u)return det;var vt=Hae(V,Ae?null:ge.subscription),wt=vt.notifyNestedSubs.bind(vt);return[vt,wt]},[V,Ae,ge]),he=Y[0],J=Y[1],G=p.useMemo(function(){return Ae?ge:Sa({},ge,{subscription:he})},[Ae,ge,he]),ue=p.useReducer(uet,cet,het),ve=ue[0],ae=ve[0],oe=ue[1];if(ae&&ae.error)throw ae.error;var me=p.useRef(),De=p.useRef(L),ne=p.useRef(),ie=p.useRef(!1),ht=F(function(){return ne.current&&L===De.current?ne.current:$(V.getState(),L)},[V,ae,L]);DU(fet,[De,me,ie,L,ht,ne,J]),DU(met,[u,V,he,$,De,me,ie,ne,J,oe],[V,he,$]);var pt=p.useMemo(function(){return Ee.createElement(_,Sa({},ht,{ref:U}))},[U,_,ht]),Ze=p.useMemo(function(){return u?Ee.createElement(W.Provider,{value:G},pt):pt},[W,pt,G]);return Ze}var I=A?Ee.memo(O):O;if(I.WrappedComponent=_,I.displayName=O.displayName=S,x){var T=Ee.forwardRef(function(B,z){return Ee.createElement(I,Sa({},B,{reactReduxForwardedRef:z}))});return T.displayName=S,T.WrappedComponent=_,TU(T,_)}return TU(I,_)}}function MU(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function xk(e,t){if(MU(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var s=0;s<r.length;s++)if(!Object.prototype.hasOwnProperty.call(t,r[s])||!MU(e[r[s]],t[r[s]]))return!1;return!0}function get(e,t){var r={},n=function(i){var l=e[i];typeof l=="function"&&(r[i]=function(){return t(l.apply(void 0,arguments))})};for(var s in e)n(s);return r}function YR(e){return function(r,n){var s=e(r,n);function o(){return s}return o.dependsOnOwnProps=!1,o}}function RU(e){return e.dependsOnOwnProps!==null&&e.dependsOnOwnProps!==void 0?!!e.dependsOnOwnProps:e.length!==1}function ase(e,t){return function(n,s){s.displayName;var o=function(l,c){return o.dependsOnOwnProps?o.mapToProps(l,c):o.mapToProps(l)};return o.dependsOnOwnProps=!0,o.mapToProps=function(l,c){o.mapToProps=e,o.dependsOnOwnProps=RU(e);var d=o(l,c);return typeof d=="function"&&(o.mapToProps=d,o.dependsOnOwnProps=RU(d),d=o(l,c)),d},o}}function xet(e){return typeof e=="function"?ase(e):void 0}function vet(e){return e?void 0:YR(function(t){return{dispatch:t}})}function yet(e){return e&&typeof e=="object"?YR(function(t){return get(e,t)}):void 0}const bet=[xet,vet,yet];function wet(e){return typeof e=="function"?ase(e):void 0}function _et(e){return e?void 0:YR(function(){return{}})}const jet=[wet,_et];function Net(e,t,r){return Sa({},r,e,t)}function Cet(e){return function(r,n){n.displayName;var s=n.pure,o=n.areMergedPropsEqual,i=!1,l;return function(d,u,f){var h=e(d,u,f);return i?(!s||!o(h,l))&&(l=h):(i=!0,l=h),l}}}function Aet(e){return typeof e=="function"?Cet(e):void 0}function Pet(e){return e?void 0:function(){return Net}}const Eet=[Aet,Pet];var ket=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function Iet(e,t,r,n){return function(o,i){return r(e(o,i),t(n,i),i)}}function Oet(e,t,r,n,s){var o=s.areStatesEqual,i=s.areOwnPropsEqual,l=s.areStatePropsEqual,c=!1,d,u,f,h,m;function x(w,_){return d=w,u=_,f=e(d,u),h=t(n,u),m=r(f,h,u),c=!0,m}function g(){return f=e(d,u),t.dependsOnOwnProps&&(h=t(n,u)),m=r(f,h,u),m}function y(){return e.dependsOnOwnProps&&(f=e(d,u)),t.dependsOnOwnProps&&(h=t(n,u)),m=r(f,h,u),m}function v(){var w=e(d,u),_=!l(w,f);return f=w,_&&(m=r(f,h,u)),m}function b(w,_){var j=!i(_,u),S=!o(w,d,_,u);return d=w,u=_,j&&S?g():j?y():S?v():m}return function(_,j){return c?b(_,j):x(_,j)}}function Tet(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,s=t.initMergeProps,o=gS(t,ket),i=r(e,o),l=n(e,o),c=s(e,o),d=o.pure?Oet:Iet;return d(i,l,c,e,o)}var Det=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function vk(e,t,r){for(var n=t.length-1;n>=0;n--){var s=t[n](e);if(s)return s}return function(o,i){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+i.wrappedComponentName+".")}}function Met(e,t){return e===t}function Ret(e){var t=e===void 0?{}:e,r=t.connectHOC,n=r===void 0?pet:r,s=t.mapStateToPropsFactories,o=s===void 0?jet:s,i=t.mapDispatchToPropsFactories,l=i===void 0?bet:i,c=t.mergePropsFactories,d=c===void 0?Eet:c,u=t.selectorFactory,f=u===void 0?Tet:u;return function(m,x,g,y){y===void 0&&(y={});var v=y,b=v.pure,w=b===void 0?!0:b,_=v.areStatesEqual,j=_===void 0?Met:_,S=v.areOwnPropsEqual,C=S===void 0?xk:S,A=v.areStatePropsEqual,P=A===void 0?xk:A,F=v.areMergedPropsEqual,O=F===void 0?xk:F,I=gS(v,Det),T=vk(m,o,"mapStateToProps"),k=vk(x,l,"mapDispatchToProps"),B=vk(g,d,"mergeProps");return n(f,Sa({methodName:"connect",getDisplayName:function(U){return"Connect("+U+")"},shouldHandleStateChanges:!!m,initMapStateToProps:T,initMapDispatchToProps:k,initMergeProps:B,pure:w,areStatesEqual:j,areOwnPropsEqual:C,areStatePropsEqual:P,areMergedPropsEqual:O},I))}}const sse=Ret();IZe(Rm.unstable_batchedUpdates);function Fet(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function ose(e,t){var r=p.useState(function(){return{inputs:t,result:e()}})[0],n=p.useRef(!0),s=p.useRef(r),o=n.current||!!(t&&s.current.inputs&&Fet(t,s.current.inputs)),i=o?s.current:{inputs:t,result:e()};return p.useEffect(function(){n.current=!1,s.current=i},[i]),i.result}function Let(e,t){return ose(function(){return e},t)}var js=ose,xa=Let,Tu=function(t){var r=t.top,n=t.right,s=t.bottom,o=t.left,i=n-o,l=s-r,c={top:r,right:n,bottom:s,left:o,width:i,height:l,x:o,y:r,center:{x:(n+o)/2,y:(s+r)/2}};return c},JR=function(t,r){return{top:t.top-r.top,left:t.left-r.left,bottom:t.bottom+r.bottom,right:t.right+r.right}},FU=function(t,r){return{top:t.top+r.top,left:t.left+r.left,bottom:t.bottom-r.bottom,right:t.right-r.right}},$et=function(t,r){return{top:t.top+r.y,left:t.left+r.x,bottom:t.bottom+r.y,right:t.right+r.x}},yk={top:0,right:0,bottom:0,left:0},QR=function(t){var r=t.borderBox,n=t.margin,s=n===void 0?yk:n,o=t.border,i=o===void 0?yk:o,l=t.padding,c=l===void 0?yk:l,d=Tu(JR(r,s)),u=Tu(FU(r,i)),f=Tu(FU(u,c));return{marginBox:d,borderBox:Tu(r),paddingBox:u,contentBox:f,margin:s,border:i,padding:c}},Md=function(t){var r=t.slice(0,-2),n=t.slice(-2);if(n!=="px")return 0;var s=Number(r);return isNaN(s)&&dp(!1),s},Bet=function(){return{x:window.pageXOffset,y:window.pageYOffset}},eC=function(t,r){var n=t.borderBox,s=t.border,o=t.margin,i=t.padding,l=$et(n,r);return QR({borderBox:l,border:s,margin:o,padding:i})},tC=function(t,r){return r===void 0&&(r=Bet()),eC(t,r)},ise=function(t,r){var n={top:Md(r.marginTop),right:Md(r.marginRight),bottom:Md(r.marginBottom),left:Md(r.marginLeft)},s={top:Md(r.paddingTop),right:Md(r.paddingRight),bottom:Md(r.paddingBottom),left:Md(r.paddingLeft)},o={top:Md(r.borderTopWidth),right:Md(r.borderRightWidth),bottom:Md(r.borderBottomWidth),left:Md(r.borderLeftWidth)};return QR({borderBox:t,margin:n,padding:s,border:o})},lse=function(t){var r=t.getBoundingClientRect(),n=window.getComputedStyle(t);return ise(r,n)},LU=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function qet(e,t){return!!(e===t||LU(e)&&LU(t))}function zet(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!qet(e[r],t[r]))return!1;return!0}function Ki(e,t){t===void 0&&(t=zet);var r,n=[],s,o=!1;function i(){for(var l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];return o&&r===this&&t(l,n)||(s=e.apply(this,l),o=!0,r=this,n=l),s}return i}var Uet=function(t){var r=[],n=null,s=function(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];r=l,!n&&(n=requestAnimationFrame(function(){n=null,t.apply(void 0,r)}))};return s.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},s};const T1=Uet;function cse(e,t){}cse.bind(null,"warn");cse.bind(null,"error");function ep(){}function Vet(e,t){return Sa({},e,{},t)}function Qd(e,t,r){var n=t.map(function(s){var o=Vet(r,s.options);return e.addEventListener(s.eventName,s.fn,o),function(){e.removeEventListener(s.eventName,s.fn,o)}});return function(){n.forEach(function(o){o()})}}var Wet="Invariant failed";function rC(e){this.message=e}rC.prototype.toString=function(){return this.message};function Tn(e,t){if(!e)throw new rC(Wet)}var Het=function(e){BZ(t,e);function t(){for(var n,s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.callbacks=null,n.unbind=ep,n.onWindowError=function(l){var c=n.getCallbacks();c.isDragging()&&c.tryAbort();var d=l.error;d instanceof rC&&l.preventDefault()},n.getCallbacks=function(){if(!n.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return n.callbacks},n.setCallbacks=function(l){n.callbacks=l},n}var r=t.prototype;return r.componentDidMount=function(){this.unbind=Qd(window,[{eventName:"error",fn:this.onWindowError}])},r.componentDidCatch=function(s){if(s instanceof rC){this.setState({});return}throw s},r.componentWillUnmount=function(){this.unbind()},r.render=function(){return this.props.children(this.setCallbacks)},t}(Ee.Component),Get=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,nC=function(t){return t+1},Ket=function(t){return`
  You have lifted an item in position `+nC(t.source.index)+`
`},dse=function(t,r){var n=t.droppableId===r.droppableId,s=nC(t.index),o=nC(r.index);return n?`
      You have moved the item from position `+s+`
      to position `+o+`
    `:`
    You have moved the item from position `+s+`
    in list `+t.droppableId+`
    to list `+r.droppableId+`
    in position `+o+`
  `},use=function(t,r,n){var s=r.droppableId===n.droppableId;return s?`
      The item `+t+`
      has been combined with `+n.draggableId:`
      The item `+t+`
      in list `+r.droppableId+`
      has been combined with `+n.draggableId+`
      in list `+n.droppableId+`
    `},Xet=function(t){var r=t.destination;if(r)return dse(t.source,r);var n=t.combine;return n?use(t.draggableId,t.source,n):"You are over an area that cannot be dropped on"},$U=function(t){return`
  The item has returned to its starting position
  of `+nC(t.index)+`
`},Yet=function(t){if(t.reason==="CANCEL")return`
      Movement cancelled.
      `+$U(t.source)+`
    `;var r=t.destination,n=t.combine;return r?`
      You have dropped the item.
      `+dse(t.source,r)+`
    `:n?`
      You have dropped the item.
      `+use(t.draggableId,t.source,n)+`
    `:`
    The item has been dropped while not over a drop area.
    `+$U(t.source)+`
  `},Fj={dragHandleUsageInstructions:Get,onDragStart:Ket,onDragUpdate:Xet,onDragEnd:Yet},Xi={x:0,y:0},dl=function(t,r){return{x:t.x+r.x,y:t.y+r.y}},cd=function(t,r){return{x:t.x-r.x,y:t.y-r.y}},tp=function(t,r){return t.x===r.x&&t.y===r.y},xy=function(t){return{x:t.x!==0?-t.x:0,y:t.y!==0?-t.y:0}},nx=function(t,r,n){var s;return n===void 0&&(n=0),s={},s[t]=r,s[t==="x"?"y":"x"]=n,s},D1=function(t,r){return Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))},BU=function(t,r){return Math.min.apply(Math,r.map(function(n){return D1(t,n)}))},fse=function(t){return function(r){return{x:t(r.x),y:t(r.y)}}},Jet=function(e,t){var r=Tu({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return r.width<=0||r.height<=0?null:r},E2=function(t,r){return{top:t.top+r.y,left:t.left+r.x,bottom:t.bottom+r.y,right:t.right+r.x}},qU=function(t){return[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.bottom}]},Qet={top:0,right:0,bottom:0,left:0},Zet=function(t,r){return r?E2(t,r.scroll.diff.displacement):t},ett=function(t,r,n){if(n&&n.increasedBy){var s;return Sa({},t,(s={},s[r.end]=t[r.end]+n.increasedBy[r.line],s))}return t},ttt=function(t,r){return r&&r.shouldClipSubject?Jet(r.pageMarginBox,t):Tu(t)},F0=function(e){var t=e.page,r=e.withPlaceholder,n=e.axis,s=e.frame,o=Zet(t.marginBox,s),i=ett(o,n,r),l=ttt(i,s);return{page:t,withPlaceholder:r,active:l}},ZR=function(e,t){e.frame||Tn(!1);var r=e.frame,n=cd(t,r.scroll.initial),s=xy(n),o=Sa({},r,{scroll:{initial:r.scroll.initial,current:t,diff:{value:n,displacement:s},max:r.scroll.max}}),i=F0({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:o}),l=Sa({},e,{frame:o,subject:i});return l};function aC(e){return Object.values?Object.values(e):Object.keys(e).map(function(t){return e[t]})}function eF(e,t){if(e.findIndex)return e.findIndex(t);for(var r=0;r<e.length;r++)if(t(e[r]))return r;return-1}function kp(e,t){if(e.find)return e.find(t);var r=eF(e,t);if(r!==-1)return e[r]}function mse(e){return Array.prototype.slice.call(e)}var hse=Ki(function(e){return e.reduce(function(t,r){return t[r.descriptor.id]=r,t},{})}),pse=Ki(function(e){return e.reduce(function(t,r){return t[r.descriptor.id]=r,t},{})}),kA=Ki(function(e){return aC(e)}),rtt=Ki(function(e){return aC(e)}),vy=Ki(function(e,t){var r=rtt(t).filter(function(n){return e===n.descriptor.droppableId}).sort(function(n,s){return n.descriptor.index-s.descriptor.index});return r});function tF(e){return e.at&&e.at.type==="REORDER"?e.at.destination:null}function IA(e){return e.at&&e.at.type==="COMBINE"?e.at.combine:null}var OA=Ki(function(e,t){return t.filter(function(r){return r.descriptor.id!==e.descriptor.id})}),ntt=function(e){var t=e.isMovingForward,r=e.draggable,n=e.destination,s=e.insideDestination,o=e.previousImpact;if(!n.isCombineEnabled)return null;var i=tF(o);if(!i)return null;function l(g){var y={type:"COMBINE",combine:{draggableId:g,droppableId:n.descriptor.id}};return Sa({},o,{at:y})}var c=o.displaced.all,d=c.length?c[0]:null;if(t)return d?l(d):null;var u=OA(r,s);if(!d){if(!u.length)return null;var f=u[u.length-1];return l(f.descriptor.id)}var h=eF(u,function(g){return g.descriptor.id===d});h===-1&&Tn(!1);var m=h-1;if(m<0)return null;var x=u[m];return l(x.descriptor.id)},yy=function(e,t){return e.descriptor.droppableId===t.descriptor.id},gse={point:Xi,value:0},M1={invisible:{},visible:{},all:[]},att={displaced:M1,displacedBy:gse,at:null},ru=function(e,t){return function(r){return e<=r&&r<=t}},xse=function(e){var t=ru(e.top,e.bottom),r=ru(e.left,e.right);return function(n){var s=t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right);if(s)return!0;var o=t(n.top)||t(n.bottom),i=r(n.left)||r(n.right),l=o&&i;if(l)return!0;var c=n.top<e.top&&n.bottom>e.bottom,d=n.left<e.left&&n.right>e.right,u=c&&d;if(u)return!0;var f=c&&i||d&&o;return f}},stt=function(e){var t=ru(e.top,e.bottom),r=ru(e.left,e.right);return function(n){var s=t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right);return s}},rF={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},vse={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},ott=function(e){return function(t){var r=ru(t.top,t.bottom),n=ru(t.left,t.right);return function(s){return e===rF?r(s.top)&&r(s.bottom):n(s.left)&&n(s.right)}}},itt=function(t,r){var n=r.frame?r.frame.scroll.diff.displacement:Xi;return E2(t,n)},ltt=function(t,r,n){return r.subject.active?n(r.subject.active)(t):!1},ctt=function(t,r,n){return n(r)(t)},nF=function(t){var r=t.target,n=t.destination,s=t.viewport,o=t.withDroppableDisplacement,i=t.isVisibleThroughFrameFn,l=o?itt(r,n):r;return ltt(l,n,i)&&ctt(l,s,i)},dtt=function(t){return nF(Sa({},t,{isVisibleThroughFrameFn:xse}))},yse=function(t){return nF(Sa({},t,{isVisibleThroughFrameFn:stt}))},utt=function(t){return nF(Sa({},t,{isVisibleThroughFrameFn:ott(t.destination.axis)}))},ftt=function(t,r,n){if(typeof n=="boolean")return n;if(!r)return!0;var s=r.invisible,o=r.visible;if(s[t])return!1;var i=o[t];return i?i.shouldAnimate:!0};function mtt(e,t){var r=e.page.marginBox,n={top:t.point.y,right:0,bottom:0,left:t.point.x};return Tu(JR(r,n))}function R1(e){var t=e.afterDragging,r=e.destination,n=e.displacedBy,s=e.viewport,o=e.forceShouldAnimate,i=e.last;return t.reduce(function(c,d){var u=mtt(d,n),f=d.descriptor.id;c.all.push(f);var h=dtt({target:u,destination:r,viewport:s,withDroppableDisplacement:!0});if(!h)return c.invisible[d.descriptor.id]=!0,c;var m=ftt(f,i,o),x={draggableId:f,shouldAnimate:m};return c.visible[f]=x,c},{all:[],visible:{},invisible:{}})}function htt(e,t){if(!e.length)return 0;var r=e[e.length-1].descriptor.index;return t.inHomeList?r:r+1}function zU(e){var t=e.insideDestination,r=e.inHomeList,n=e.displacedBy,s=e.destination,o=htt(t,{inHomeList:r});return{displaced:M1,displacedBy:n,at:{type:"REORDER",destination:{droppableId:s.descriptor.id,index:o}}}}function sC(e){var t=e.draggable,r=e.insideDestination,n=e.destination,s=e.viewport,o=e.displacedBy,i=e.last,l=e.index,c=e.forceShouldAnimate,d=yy(t,n);if(l==null)return zU({insideDestination:r,inHomeList:d,displacedBy:o,destination:n});var u=kp(r,function(g){return g.descriptor.index===l});if(!u)return zU({insideDestination:r,inHomeList:d,displacedBy:o,destination:n});var f=OA(t,r),h=r.indexOf(u),m=f.slice(h),x=R1({afterDragging:m,destination:n,displacedBy:o,last:i,viewport:s.frame,forceShouldAnimate:c});return{displaced:x,displacedBy:o,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:l}}}}function pp(e,t){return!!t.effected[e]}var ptt=function(e){var t=e.isMovingForward,r=e.destination,n=e.draggables,s=e.combine,o=e.afterCritical;if(!r.isCombineEnabled)return null;var i=s.draggableId,l=n[i],c=l.descriptor.index,d=pp(i,o);return d?t?c:c-1:t?c+1:c},gtt=function(e){var t=e.isMovingForward,r=e.isInHomeList,n=e.insideDestination,s=e.location;if(!n.length)return null;var o=s.index,i=t?o+1:o-1,l=n[0].descriptor.index,c=n[n.length-1].descriptor.index,d=r?c:c+1;return i<l||i>d?null:i},xtt=function(e){var t=e.isMovingForward,r=e.isInHomeList,n=e.draggable,s=e.draggables,o=e.destination,i=e.insideDestination,l=e.previousImpact,c=e.viewport,d=e.afterCritical,u=l.at;if(u||Tn(!1),u.type==="REORDER"){var f=gtt({isMovingForward:t,isInHomeList:r,location:u.destination,insideDestination:i});return f==null?null:sC({draggable:n,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:f})}var h=ptt({isMovingForward:t,destination:o,displaced:l.displaced,draggables:s,combine:u.combine,afterCritical:d});return h==null?null:sC({draggable:n,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:h})},vtt=function(e){var t=e.displaced,r=e.afterCritical,n=e.combineWith,s=e.displacedBy,o=!!(t.visible[n]||t.invisible[n]);return pp(n,r)?o?Xi:xy(s.point):o?s.point:Xi},ytt=function(e){var t=e.afterCritical,r=e.impact,n=e.draggables,s=IA(r);s||Tn(!1);var o=s.draggableId,i=n[o].page.borderBox.center,l=vtt({displaced:r.displaced,afterCritical:t,combineWith:o,displacedBy:r.displacedBy});return dl(i,l)},bse=function(t,r){return r.margin[t.start]+r.borderBox[t.size]/2},btt=function(t,r){return r.margin[t.end]+r.borderBox[t.size]/2},aF=function(t,r,n){return r[t.crossAxisStart]+n.margin[t.crossAxisStart]+n.borderBox[t.crossAxisSize]/2},UU=function(t){var r=t.axis,n=t.moveRelativeTo,s=t.isMoving;return nx(r.line,n.marginBox[r.end]+bse(r,s),aF(r,n.marginBox,s))},VU=function(t){var r=t.axis,n=t.moveRelativeTo,s=t.isMoving;return nx(r.line,n.marginBox[r.start]-btt(r,s),aF(r,n.marginBox,s))},wtt=function(t){var r=t.axis,n=t.moveInto,s=t.isMoving;return nx(r.line,n.contentBox[r.start]+bse(r,s),aF(r,n.contentBox,s))},_tt=function(e){var t=e.impact,r=e.draggable,n=e.draggables,s=e.droppable,o=e.afterCritical,i=vy(s.descriptor.id,n),l=r.page,c=s.axis;if(!i.length)return wtt({axis:c,moveInto:s.page,isMoving:l});var d=t.displaced,u=t.displacedBy,f=d.all[0];if(f){var h=n[f];if(pp(f,o))return VU({axis:c,moveRelativeTo:h.page,isMoving:l});var m=eC(h.page,u.point);return VU({axis:c,moveRelativeTo:m,isMoving:l})}var x=i[i.length-1];if(x.descriptor.id===r.descriptor.id)return l.borderBox.center;if(pp(x.descriptor.id,o)){var g=eC(x.page,xy(o.displacedBy.point));return UU({axis:c,moveRelativeTo:g,isMoving:l})}return UU({axis:c,moveRelativeTo:x.page,isMoving:l})},O3=function(e,t){var r=e.frame;return r?dl(t,r.scroll.diff.displacement):t},jtt=function(t){var r=t.impact,n=t.draggable,s=t.droppable,o=t.draggables,i=t.afterCritical,l=n.page.borderBox.center,c=r.at;return!s||!c?l:c.type==="REORDER"?_tt({impact:r,draggable:n,draggables:o,droppable:s,afterCritical:i}):ytt({impact:r,draggables:o,afterCritical:i})},TA=function(e){var t=jtt(e),r=e.droppable,n=r?O3(r,t):t;return n},wse=function(e,t){var r=cd(t,e.scroll.initial),n=xy(r),s=Tu({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),o={frame:s,scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:r,displacement:n}}};return o};function WU(e,t){return e.map(function(r){return t[r]})}function Ntt(e,t){for(var r=0;r<t.length;r++){var n=t[r].visible[e];if(n)return n}return null}var Stt=function(e){var t=e.impact,r=e.viewport,n=e.destination,s=e.draggables,o=e.maxScrollChange,i=wse(r,dl(r.scroll.current,o)),l=n.frame?ZR(n,dl(n.frame.scroll.current,o)):n,c=t.displaced,d=R1({afterDragging:WU(c.all,s),destination:n,displacedBy:t.displacedBy,viewport:i.frame,last:c,forceShouldAnimate:!1}),u=R1({afterDragging:WU(c.all,s),destination:l,displacedBy:t.displacedBy,viewport:r.frame,last:c,forceShouldAnimate:!1}),f={},h={},m=[c,d,u];c.all.forEach(function(g){var y=Ntt(g,m);if(y){h[g]=y;return}f[g]=!0});var x=Sa({},t,{displaced:{all:c.all,invisible:f,visible:h}});return x},Ctt=function(e,t){return dl(e.scroll.diff.displacement,t)},sF=function(e){var t=e.pageBorderBoxCenter,r=e.draggable,n=e.viewport,s=Ctt(n,t),o=cd(s,r.page.borderBox.center);return dl(r.client.borderBox.center,o)},_se=function(e){var t=e.draggable,r=e.destination,n=e.newPageBorderBoxCenter,s=e.viewport,o=e.withDroppableDisplacement,i=e.onlyOnMainAxis,l=i===void 0?!1:i,c=cd(n,t.page.borderBox.center),d=E2(t.page.borderBox,c),u={target:d,destination:r,withDroppableDisplacement:o,viewport:s};return l?utt(u):yse(u)},Att=function(e){var t=e.isMovingForward,r=e.draggable,n=e.destination,s=e.draggables,o=e.previousImpact,i=e.viewport,l=e.previousPageBorderBoxCenter,c=e.previousClientSelection,d=e.afterCritical;if(!n.isEnabled)return null;var u=vy(n.descriptor.id,s),f=yy(r,n),h=ntt({isMovingForward:t,draggable:r,destination:n,insideDestination:u,previousImpact:o})||xtt({isMovingForward:t,isInHomeList:f,draggable:r,draggables:s,destination:n,insideDestination:u,previousImpact:o,viewport:i,afterCritical:d});if(!h)return null;var m=TA({impact:h,draggable:r,droppable:n,draggables:s,afterCritical:d}),x=_se({draggable:r,destination:n,newPageBorderBoxCenter:m,viewport:i.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});if(x){var g=sF({pageBorderBoxCenter:m,draggable:r,viewport:i});return{clientSelection:g,impact:h,scrollJumpRequest:null}}var y=cd(m,l),v=Stt({impact:h,viewport:i,destination:n,draggables:s,maxScrollChange:y});return{clientSelection:c,impact:v,scrollJumpRequest:y}},Vl=function(t){var r=t.subject.active;return r||Tn(!1),r},Ptt=function(e){var t=e.isMovingForward,r=e.pageBorderBoxCenter,n=e.source,s=e.droppables,o=e.viewport,i=n.subject.active;if(!i)return null;var l=n.axis,c=ru(i[l.start],i[l.end]),d=kA(s).filter(function(f){return f!==n}).filter(function(f){return f.isEnabled}).filter(function(f){return!!f.subject.active}).filter(function(f){return xse(o.frame)(Vl(f))}).filter(function(f){var h=Vl(f);return t?i[l.crossAxisEnd]<h[l.crossAxisEnd]:h[l.crossAxisStart]<i[l.crossAxisStart]}).filter(function(f){var h=Vl(f),m=ru(h[l.start],h[l.end]);return c(h[l.start])||c(h[l.end])||m(i[l.start])||m(i[l.end])}).sort(function(f,h){var m=Vl(f)[l.crossAxisStart],x=Vl(h)[l.crossAxisStart];return t?m-x:x-m}).filter(function(f,h,m){return Vl(f)[l.crossAxisStart]===Vl(m[0])[l.crossAxisStart]});if(!d.length)return null;if(d.length===1)return d[0];var u=d.filter(function(f){var h=ru(Vl(f)[l.start],Vl(f)[l.end]);return h(r[l.line])});return u.length===1?u[0]:u.length>1?u.sort(function(f,h){return Vl(f)[l.start]-Vl(h)[l.start]})[0]:d.sort(function(f,h){var m=BU(r,qU(Vl(f))),x=BU(r,qU(Vl(h)));return m!==x?m-x:Vl(f)[l.start]-Vl(h)[l.start]})[0]},HU=function(t,r){var n=t.page.borderBox.center;return pp(t.descriptor.id,r)?cd(n,r.displacedBy.point):n},Ett=function(t,r){var n=t.page.borderBox;return pp(t.descriptor.id,r)?E2(n,xy(r.displacedBy.point)):n},ktt=function(e){var t=e.pageBorderBoxCenter,r=e.viewport,n=e.destination,s=e.insideDestination,o=e.afterCritical,i=s.filter(function(l){return yse({target:Ett(l,o),destination:n,viewport:r.frame,withDroppableDisplacement:!0})}).sort(function(l,c){var d=D1(t,O3(n,HU(l,o))),u=D1(t,O3(n,HU(c,o)));return d<u?-1:u<d?1:l.descriptor.index-c.descriptor.index});return i[0]||null},k2=Ki(function(t,r){var n=r[t.line];return{value:n,point:nx(t.line,n)}}),Itt=function(t,r,n){var s=t.axis;if(t.descriptor.mode==="virtual")return nx(s.line,r[s.line]);var o=t.subject.page.contentBox[s.size],i=vy(t.descriptor.id,n),l=i.reduce(function(u,f){return u+f.client.marginBox[s.size]},0),c=l+r[s.line],d=c-o;return d<=0?null:nx(s.line,d)},jse=function(t,r){return Sa({},t,{scroll:Sa({},t.scroll,{max:r})})},Nse=function(t,r,n){var s=t.frame;yy(r,t)&&Tn(!1),t.subject.withPlaceholder&&Tn(!1);var o=k2(t.axis,r.displaceBy).point,i=Itt(t,o,n),l={placeholderSize:o,increasedBy:i,oldFrameMaxScroll:t.frame?t.frame.scroll.max:null};if(!s){var c=F0({page:t.subject.page,withPlaceholder:l,axis:t.axis,frame:t.frame});return Sa({},t,{subject:c})}var d=i?dl(s.scroll.max,i):s.scroll.max,u=jse(s,d),f=F0({page:t.subject.page,withPlaceholder:l,axis:t.axis,frame:u});return Sa({},t,{subject:f,frame:u})},Ott=function(t){var r=t.subject.withPlaceholder;r||Tn(!1);var n=t.frame;if(!n){var s=F0({page:t.subject.page,axis:t.axis,frame:null,withPlaceholder:null});return Sa({},t,{subject:s})}var o=r.oldFrameMaxScroll;o||Tn(!1);var i=jse(n,o),l=F0({page:t.subject.page,axis:t.axis,frame:i,withPlaceholder:null});return Sa({},t,{subject:l,frame:i})},Ttt=function(e){var t=e.previousPageBorderBoxCenter,r=e.moveRelativeTo,n=e.insideDestination,s=e.draggable,o=e.draggables,i=e.destination,l=e.viewport,c=e.afterCritical;if(!r){if(n.length)return null;var d={displaced:M1,displacedBy:gse,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:0}}},u=TA({impact:d,draggable:s,droppable:i,draggables:o,afterCritical:c}),f=yy(s,i)?i:Nse(i,s,o),h=_se({draggable:s,destination:f,newPageBorderBoxCenter:u,viewport:l.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});return h?d:null}var m=t[i.axis.line]<=r.page.borderBox.center[i.axis.line],x=function(){var y=r.descriptor.index;return r.descriptor.id===s.descriptor.id||m?y:y+1}(),g=k2(i.axis,s.displaceBy);return sC({draggable:s,insideDestination:n,destination:i,viewport:l,displacedBy:g,last:M1,index:x})},Dtt=function(e){var t=e.isMovingForward,r=e.previousPageBorderBoxCenter,n=e.draggable,s=e.isOver,o=e.draggables,i=e.droppables,l=e.viewport,c=e.afterCritical,d=Ptt({isMovingForward:t,pageBorderBoxCenter:r,source:s,droppables:i,viewport:l});if(!d)return null;var u=vy(d.descriptor.id,o),f=ktt({pageBorderBoxCenter:r,viewport:l,destination:d,insideDestination:u,afterCritical:c}),h=Ttt({previousPageBorderBoxCenter:r,destination:d,draggable:n,draggables:o,moveRelativeTo:f,insideDestination:u,viewport:l,afterCritical:c});if(!h)return null;var m=TA({impact:h,draggable:n,droppable:d,draggables:o,afterCritical:c}),x=sF({pageBorderBoxCenter:m,draggable:n,viewport:l});return{clientSelection:x,impact:h,scrollJumpRequest:null}},gd=function(e){var t=e.at;return t?t.type==="REORDER"?t.destination.droppableId:t.combine.droppableId:null},Mtt=function(t,r){var n=gd(t);return n?r[n]:null},Rtt=function(e){var t=e.state,r=e.type,n=Mtt(t.impact,t.dimensions.droppables),s=!!n,o=t.dimensions.droppables[t.critical.droppable.id],i=n||o,l=i.axis.direction,c=l==="vertical"&&(r==="MOVE_UP"||r==="MOVE_DOWN")||l==="horizontal"&&(r==="MOVE_LEFT"||r==="MOVE_RIGHT");if(c&&!s)return null;var d=r==="MOVE_DOWN"||r==="MOVE_RIGHT",u=t.dimensions.draggables[t.critical.draggable.id],f=t.current.page.borderBoxCenter,h=t.dimensions,m=h.draggables,x=h.droppables;return c?Att({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,destination:i,draggables:m,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):Dtt({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,isOver:i,draggables:m,droppables:x,viewport:t.viewport,afterCritical:t.afterCritical})};function tg(e){return e.phase==="DRAGGING"||e.phase==="COLLECTING"}function Sse(e){var t=ru(e.top,e.bottom),r=ru(e.left,e.right);return function(s){return t(s.y)&&r(s.x)}}function Ftt(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top}function Ltt(e){var t=e.pageBorderBox,r=e.draggable,n=e.candidates,s=r.page.borderBox.center,o=n.map(function(i){var l=i.axis,c=nx(i.axis.line,t.center[l.line],i.page.borderBox.center[l.crossAxisLine]);return{id:i.descriptor.id,distance:D1(s,c)}}).sort(function(i,l){return l.distance-i.distance});return o[0]?o[0].id:null}function $tt(e){var t=e.pageBorderBox,r=e.draggable,n=e.droppables,s=kA(n).filter(function(o){if(!o.isEnabled)return!1;var i=o.subject.active;if(!i||!Ftt(t,i))return!1;if(Sse(i)(t.center))return!0;var l=o.axis,c=i.center[l.crossAxisLine],d=t[l.crossAxisStart],u=t[l.crossAxisEnd],f=ru(i[l.crossAxisStart],i[l.crossAxisEnd]),h=f(d),m=f(u);return!h&&!m?!0:h?d<c:u>c});return s.length?s.length===1?s[0].descriptor.id:Ltt({pageBorderBox:t,draggable:r,candidates:s}):null}var Cse=function(t,r){return Tu(E2(t,r))},Btt=function(e,t){var r=e.frame;return r?Cse(t,r.scroll.diff.value):t};function Ase(e){var t=e.displaced,r=e.id;return!!(t.visible[r]||t.invisible[r])}function qtt(e){var t=e.draggable,r=e.closest,n=e.inHomeList;return r?n&&r.descriptor.index>t.descriptor.index?r.descriptor.index-1:r.descriptor.index:null}var ztt=function(e){var t=e.pageBorderBoxWithDroppableScroll,r=e.draggable,n=e.destination,s=e.insideDestination,o=e.last,i=e.viewport,l=e.afterCritical,c=n.axis,d=k2(n.axis,r.displaceBy),u=d.value,f=t[c.start],h=t[c.end],m=OA(r,s),x=kp(m,function(y){var v=y.descriptor.id,b=y.page.borderBox.center[c.line],w=pp(v,l),_=Ase({displaced:o,id:v});return w?_?h<=b:f<b-u:_?h<=b+u:f<b}),g=qtt({draggable:r,closest:x,inHomeList:yy(r,n)});return sC({draggable:r,insideDestination:s,destination:n,viewport:i,last:o,displacedBy:d,index:g})},Utt=4,Vtt=function(e){var t=e.draggable,r=e.pageBorderBoxWithDroppableScroll,n=e.previousImpact,s=e.destination,o=e.insideDestination,i=e.afterCritical;if(!s.isCombineEnabled)return null;var l=s.axis,c=k2(s.axis,t.displaceBy),d=c.value,u=r[l.start],f=r[l.end],h=OA(t,o),m=kp(h,function(g){var y=g.descriptor.id,v=g.page.borderBox,b=v[l.size],w=b/Utt,_=pp(y,i),j=Ase({displaced:n.displaced,id:y});return _?j?f>v[l.start]+w&&f<v[l.end]-w:u>v[l.start]-d+w&&u<v[l.end]-d-w:j?f>v[l.start]+d+w&&f<v[l.end]+d-w:u>v[l.start]+w&&u<v[l.end]-w});if(!m)return null;var x={displacedBy:c,displaced:n.displaced,at:{type:"COMBINE",combine:{draggableId:m.descriptor.id,droppableId:s.descriptor.id}}};return x},Pse=function(e){var t=e.pageOffset,r=e.draggable,n=e.draggables,s=e.droppables,o=e.previousImpact,i=e.viewport,l=e.afterCritical,c=Cse(r.page.borderBox,t),d=$tt({pageBorderBox:c,draggable:r,droppables:s});if(!d)return att;var u=s[d],f=vy(u.descriptor.id,n),h=Btt(u,c);return Vtt({pageBorderBoxWithDroppableScroll:h,draggable:r,previousImpact:o,destination:u,insideDestination:f,afterCritical:l})||ztt({pageBorderBoxWithDroppableScroll:h,draggable:r,destination:u,insideDestination:f,last:o.displaced,viewport:i,afterCritical:l})},oF=function(e,t){var r;return Sa({},e,(r={},r[t.descriptor.id]=t,r))},Wtt=function(t){var r=t.previousImpact,n=t.impact,s=t.droppables,o=gd(r),i=gd(n);if(!o||o===i)return s;var l=s[o];if(!l.subject.withPlaceholder)return s;var c=Ott(l);return oF(s,c)},Htt=function(e){var t=e.draggable,r=e.draggables,n=e.droppables,s=e.previousImpact,o=e.impact,i=Wtt({previousImpact:s,impact:o,droppables:n}),l=gd(o);if(!l)return i;var c=n[l];if(yy(t,c)||c.subject.withPlaceholder)return i;var d=Nse(c,t,r);return oF(i,d)},ow=function(e){var t=e.state,r=e.clientSelection,n=e.dimensions,s=e.viewport,o=e.impact,i=e.scrollJumpRequest,l=s||t.viewport,c=n||t.dimensions,d=r||t.current.client.selection,u=cd(d,t.initial.client.selection),f={offset:u,selection:d,borderBoxCenter:dl(t.initial.client.borderBoxCenter,u)},h={selection:dl(f.selection,l.scroll.current),borderBoxCenter:dl(f.borderBoxCenter,l.scroll.current),offset:dl(f.offset,l.scroll.diff.value)},m={client:f,page:h};if(t.phase==="COLLECTING")return Sa({phase:"COLLECTING"},t,{dimensions:c,viewport:l,current:m});var x=c.draggables[t.critical.draggable.id],g=o||Pse({pageOffset:h.offset,draggable:x,draggables:c.draggables,droppables:c.droppables,previousImpact:t.impact,viewport:l,afterCritical:t.afterCritical}),y=Htt({draggable:x,impact:g,previousImpact:t.impact,draggables:c.draggables,droppables:c.droppables}),v=Sa({},t,{current:m,dimensions:{draggables:c.draggables,droppables:y},impact:g,viewport:l,scrollJumpRequest:i||null,forceShouldAnimate:i?!1:null});return v};function Gtt(e,t){return e.map(function(r){return t[r]})}var Ese=function(e){var t=e.impact,r=e.viewport,n=e.draggables,s=e.destination,o=e.forceShouldAnimate,i=t.displaced,l=Gtt(i.all,n),c=R1({afterDragging:l,destination:s,displacedBy:t.displacedBy,viewport:r.frame,forceShouldAnimate:o,last:i});return Sa({},t,{displaced:c})},kse=function(e){var t=e.impact,r=e.draggable,n=e.droppable,s=e.draggables,o=e.viewport,i=e.afterCritical,l=TA({impact:t,draggable:r,draggables:s,droppable:n,afterCritical:i});return sF({pageBorderBoxCenter:l,draggable:r,viewport:o})},Ise=function(e){var t=e.state,r=e.dimensions,n=e.viewport;t.movementMode!=="SNAP"&&Tn(!1);var s=t.impact,o=n||t.viewport,i=r||t.dimensions,l=i.draggables,c=i.droppables,d=l[t.critical.draggable.id],u=gd(s);u||Tn(!1);var f=c[u],h=Ese({impact:s,viewport:o,destination:f,draggables:l}),m=kse({impact:h,draggable:d,droppable:f,draggables:l,viewport:o,afterCritical:t.afterCritical});return ow({impact:h,clientSelection:m,state:t,dimensions:i,viewport:o})},Ktt=function(e){return{index:e.index,droppableId:e.droppableId}},Ose=function(e){var t=e.draggable,r=e.home,n=e.draggables,s=e.viewport,o=k2(r.axis,t.displaceBy),i=vy(r.descriptor.id,n),l=i.indexOf(t);l===-1&&Tn(!1);var c=i.slice(l+1),d=c.reduce(function(m,x){return m[x.descriptor.id]=!0,m},{}),u={inVirtualList:r.descriptor.mode==="virtual",displacedBy:o,effected:d},f=R1({afterDragging:c,destination:r,displacedBy:o,last:null,viewport:s.frame,forceShouldAnimate:!1}),h={displaced:f,displacedBy:o,at:{type:"REORDER",destination:Ktt(t.descriptor)}};return{impact:h,afterCritical:u}},Xtt=function(e,t){return{draggables:e.draggables,droppables:oF(e.droppables,t)}},Ytt=function(e){var t=e.draggable,r=e.offset,n=e.initialWindowScroll,s=eC(t.client,r),o=tC(s,n),i=Sa({},t,{placeholder:Sa({},t.placeholder,{client:s}),client:s,page:o});return i},Jtt=function(e){var t=e.frame;return t||Tn(!1),t},Qtt=function(e){var t=e.additions,r=e.updatedDroppables,n=e.viewport,s=n.scroll.diff.value;return t.map(function(o){var i=o.descriptor.droppableId,l=r[i],c=Jtt(l),d=c.scroll.diff.value,u=dl(s,d),f=Ytt({draggable:o,offset:u,initialWindowScroll:n.scroll.initial});return f})},Ztt=function(e){var t=e.state,r=e.published,n=r.modified.map(function(w){var _=t.dimensions.droppables[w.droppableId],j=ZR(_,w.scroll);return j}),s=Sa({},t.dimensions.droppables,{},hse(n)),o=pse(Qtt({additions:r.additions,updatedDroppables:s,viewport:t.viewport})),i=Sa({},t.dimensions.draggables,{},o);r.removals.forEach(function(w){delete i[w]});var l={droppables:s,draggables:i},c=gd(t.impact),d=c?l.droppables[c]:null,u=l.draggables[t.critical.draggable.id],f=l.droppables[t.critical.droppable.id],h=Ose({draggable:u,home:f,draggables:i,viewport:t.viewport}),m=h.impact,x=h.afterCritical,g=d&&d.isCombineEnabled?t.impact:m,y=Pse({pageOffset:t.current.page.offset,draggable:l.draggables[t.critical.draggable.id],draggables:l.draggables,droppables:l.droppables,previousImpact:g,viewport:t.viewport,afterCritical:x}),v=Sa({phase:"DRAGGING"},t,{phase:"DRAGGING",impact:y,onLiftImpact:m,dimensions:l,afterCritical:x,forceShouldAnimate:!1});if(t.phase==="COLLECTING")return v;var b=Sa({phase:"DROP_PENDING"},v,{phase:"DROP_PENDING",reason:t.reason,isWaiting:!1});return b},T3=function(t){return t.movementMode==="SNAP"},bk=function(t,r,n){var s=Xtt(t.dimensions,r);return!T3(t)||n?ow({state:t,dimensions:s}):Ise({state:t,dimensions:s})};function wk(e){return e.isDragging&&e.movementMode==="SNAP"?Sa({phase:"DRAGGING"},e,{scrollJumpRequest:null}):e}var GU={phase:"IDLE",completed:null,shouldFlush:!1},ert=function(e,t){if(e===void 0&&(e=GU),t.type==="FLUSH")return Sa({},GU,{shouldFlush:!0});if(t.type==="INITIAL_PUBLISH"){e.phase!=="IDLE"&&Tn(!1);var r=t.payload,n=r.critical,s=r.clientSelection,o=r.viewport,i=r.dimensions,l=r.movementMode,c=i.draggables[n.draggable.id],d=i.droppables[n.droppable.id],u={selection:s,borderBoxCenter:c.client.borderBox.center,offset:Xi},f={client:u,page:{selection:dl(u.selection,o.scroll.initial),borderBoxCenter:dl(u.selection,o.scroll.initial),offset:dl(u.selection,o.scroll.diff.value)}},h=kA(i.droppables).every(function(oe){return!oe.isFixedOnPage}),m=Ose({draggable:c,home:d,draggables:i.draggables,viewport:o}),x=m.impact,g=m.afterCritical,y={phase:"DRAGGING",isDragging:!0,critical:n,movementMode:l,dimensions:i,initial:f,current:f,isWindowScrollAllowed:h,impact:x,afterCritical:g,onLiftImpact:x,viewport:o,scrollJumpRequest:null,forceShouldAnimate:null};return y}if(t.type==="COLLECTION_STARTING"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&Tn(!1);var v=Sa({phase:"COLLECTING"},e,{phase:"COLLECTING"});return v}if(t.type==="PUBLISH_WHILE_DRAGGING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"||Tn(!1),Ztt({state:e,published:t.payload});if(t.type==="MOVE"){if(e.phase==="DROP_PENDING")return e;tg(e)||Tn(!1);var b=t.payload.client;return tp(b,e.current.client.selection)?e:ow({state:e,clientSelection:b,impact:T3(e)?e.impact:null})}if(t.type==="UPDATE_DROPPABLE_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="COLLECTING")return wk(e);tg(e)||Tn(!1);var w=t.payload,_=w.id,j=w.newScroll,S=e.dimensions.droppables[_];if(!S)return e;var C=ZR(S,j);return bk(e,C,!1)}if(t.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(e.phase==="DROP_PENDING")return e;tg(e)||Tn(!1);var A=t.payload,P=A.id,F=A.isEnabled,O=e.dimensions.droppables[P];O||Tn(!1),O.isEnabled===F&&Tn(!1);var I=Sa({},O,{isEnabled:F});return bk(e,I,!0)}if(t.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(e.phase==="DROP_PENDING")return e;tg(e)||Tn(!1);var T=t.payload,k=T.id,B=T.isCombineEnabled,z=e.dimensions.droppables[k];z||Tn(!1),z.isCombineEnabled===B&&Tn(!1);var U=Sa({},z,{isCombineEnabled:B});return bk(e,U,!0)}if(t.type==="MOVE_BY_WINDOW_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="DROP_ANIMATING")return e;tg(e)||Tn(!1),e.isWindowScrollAllowed||Tn(!1);var L=t.payload.newScroll;if(tp(e.viewport.scroll.current,L))return wk(e);var W=wse(e.viewport,L);return T3(e)?Ise({state:e,viewport:W}):ow({state:e,viewport:W})}if(t.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!tg(e))return e;var ge=t.payload.maxScroll;if(tp(ge,e.viewport.scroll.max))return e;var Ae=Sa({},e.viewport,{scroll:Sa({},e.viewport.scroll,{max:ge})});return Sa({phase:"DRAGGING"},e,{viewport:Ae})}if(t.type==="MOVE_UP"||t.type==="MOVE_DOWN"||t.type==="MOVE_LEFT"||t.type==="MOVE_RIGHT"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&Tn(!1);var V=Rtt({state:e,type:t.type});return V?ow({state:e,impact:V.impact,clientSelection:V.clientSelection,scrollJumpRequest:V.scrollJumpRequest}):e}if(t.type==="DROP_PENDING"){var $=t.payload.reason;e.phase!=="COLLECTING"&&Tn(!1);var Y=Sa({phase:"DROP_PENDING"},e,{phase:"DROP_PENDING",isWaiting:!0,reason:$});return Y}if(t.type==="DROP_ANIMATE"){var he=t.payload,J=he.completed,G=he.dropDuration,ue=he.newHomeClientOffset;e.phase==="DRAGGING"||e.phase==="DROP_PENDING"||Tn(!1);var ve={phase:"DROP_ANIMATING",completed:J,dropDuration:G,newHomeClientOffset:ue,dimensions:e.dimensions};return ve}if(t.type==="DROP_COMPLETE"){var ae=t.payload.completed;return{phase:"IDLE",completed:ae,shouldFlush:!1}}return e},trt=function(t){return{type:"BEFORE_INITIAL_CAPTURE",payload:t}},rrt=function(t){return{type:"LIFT",payload:t}},nrt=function(t){return{type:"INITIAL_PUBLISH",payload:t}},art=function(t){return{type:"PUBLISH_WHILE_DRAGGING",payload:t}},srt=function(){return{type:"COLLECTION_STARTING",payload:null}},ort=function(t){return{type:"UPDATE_DROPPABLE_SCROLL",payload:t}},irt=function(t){return{type:"UPDATE_DROPPABLE_IS_ENABLED",payload:t}},lrt=function(t){return{type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:t}},Tse=function(t){return{type:"MOVE",payload:t}},crt=function(t){return{type:"MOVE_BY_WINDOW_SCROLL",payload:t}},drt=function(t){return{type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:t}},urt=function(){return{type:"MOVE_UP",payload:null}},frt=function(){return{type:"MOVE_DOWN",payload:null}},mrt=function(){return{type:"MOVE_RIGHT",payload:null}},hrt=function(){return{type:"MOVE_LEFT",payload:null}},iF=function(){return{type:"FLUSH",payload:null}},prt=function(t){return{type:"DROP_ANIMATE",payload:t}},lF=function(t){return{type:"DROP_COMPLETE",payload:t}},Dse=function(t){return{type:"DROP",payload:t}},grt=function(t){return{type:"DROP_PENDING",payload:t}},Mse=function(){return{type:"DROP_ANIMATION_FINISHED",payload:null}},xrt=function(e){return function(t){var r=t.getState,n=t.dispatch;return function(s){return function(o){if(o.type!=="LIFT"){s(o);return}var i=o.payload,l=i.id,c=i.clientSelection,d=i.movementMode,u=r();u.phase==="DROP_ANIMATING"&&n(lF({completed:u.completed})),r().phase!=="IDLE"&&Tn(!1),n(iF()),n(trt({draggableId:l,movementMode:d}));var f={shouldPublishImmediately:d==="SNAP"},h={draggableId:l,scrollOptions:f},m=e.startPublishing(h),x=m.critical,g=m.dimensions,y=m.viewport;n(nrt({critical:x,dimensions:g,clientSelection:c,movementMode:d,viewport:y}))}}}},vrt=function(e){return function(){return function(t){return function(r){r.type==="INITIAL_PUBLISH"&&e.dragging(),r.type==="DROP_ANIMATE"&&e.dropping(r.payload.completed.result.reason),(r.type==="FLUSH"||r.type==="DROP_COMPLETE")&&e.resting(),t(r)}}}},cF={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},F1={opacity:{drop:0,combining:.7},scale:{drop:.75}},dF={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},Up=dF.outOfTheWay+"s "+cF.outOfTheWay,iw={fluid:"opacity "+Up,snap:"transform "+Up+", opacity "+Up,drop:function(t){var r=t+"s "+cF.drop;return"transform "+r+", opacity "+r},outOfTheWay:"transform "+Up,placeholder:"height "+Up+", width "+Up+", margin "+Up},KU=function(t){return tp(t,Xi)?null:"translate("+t.x+"px, "+t.y+"px)"},D3={moveTo:KU,drop:function(t,r){var n=KU(t);return n?r?n+" scale("+F1.scale.drop+")":n:null}},M3=dF.minDropTime,Rse=dF.maxDropTime,yrt=Rse-M3,XU=1500,brt=.6,wrt=function(e){var t=e.current,r=e.destination,n=e.reason,s=D1(t,r);if(s<=0)return M3;if(s>=XU)return Rse;var o=s/XU,i=M3+yrt*o,l=n==="CANCEL"?i*brt:i;return Number(l.toFixed(2))},_rt=function(e){var t=e.impact,r=e.draggable,n=e.dimensions,s=e.viewport,o=e.afterCritical,i=n.draggables,l=n.droppables,c=gd(t),d=c?l[c]:null,u=l[r.descriptor.droppableId],f=kse({impact:t,draggable:r,draggables:i,afterCritical:o,droppable:d||u,viewport:s}),h=cd(f,r.client.borderBox.center);return h},jrt=function(e){var t=e.draggables,r=e.reason,n=e.lastImpact,s=e.home,o=e.viewport,i=e.onLiftImpact;if(!n.at||r!=="DROP"){var l=Ese({draggables:t,impact:i,destination:s,viewport:o,forceShouldAnimate:!0});return{impact:l,didDropInsideDroppable:!1}}if(n.at.type==="REORDER")return{impact:n,didDropInsideDroppable:!0};var c=Sa({},n,{displaced:M1});return{impact:c,didDropInsideDroppable:!0}},Nrt=function(e){var t=e.getState,r=e.dispatch;return function(n){return function(s){if(s.type!=="DROP"){n(s);return}var o=t(),i=s.payload.reason;if(o.phase==="COLLECTING"){r(grt({reason:i}));return}if(o.phase!=="IDLE"){var l=o.phase==="DROP_PENDING"&&o.isWaiting;l&&Tn(!1),o.phase==="DRAGGING"||o.phase==="DROP_PENDING"||Tn(!1);var c=o.critical,d=o.dimensions,u=d.draggables[o.critical.draggable.id],f=jrt({reason:i,lastImpact:o.impact,afterCritical:o.afterCritical,onLiftImpact:o.onLiftImpact,home:o.dimensions.droppables[o.critical.droppable.id],viewport:o.viewport,draggables:o.dimensions.draggables}),h=f.impact,m=f.didDropInsideDroppable,x=m?tF(h):null,g=m?IA(h):null,y={index:c.draggable.index,droppableId:c.droppable.id},v={draggableId:u.descriptor.id,type:u.descriptor.type,source:y,reason:i,mode:o.movementMode,destination:x,combine:g},b=_rt({impact:h,draggable:u,dimensions:d,viewport:o.viewport,afterCritical:o.afterCritical}),w={critical:o.critical,afterCritical:o.afterCritical,result:v,impact:h},_=!tp(o.current.client.offset,b)||!!v.combine;if(!_){r(lF({completed:w}));return}var j=wrt({current:o.current.client.offset,destination:b,reason:i}),S={newHomeClientOffset:b,dropDuration:j,completed:w};r(prt(S))}}}},Fse=function(){return{x:window.pageXOffset,y:window.pageYOffset}};function Srt(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(r){r.target!==window&&r.target!==window.document||e()}}}function Crt(e){var t=e.onWindowScroll;function r(){t(Fse())}var n=T1(r),s=Srt(n),o=ep;function i(){return o!==ep}function l(){i()&&Tn(!1),o=Qd(window,[s])}function c(){i()||Tn(!1),n.cancel(),o(),o=ep}return{start:l,stop:c,isActive:i}}var Art=function(t){return t.type==="DROP_COMPLETE"||t.type==="DROP_ANIMATE"||t.type==="FLUSH"},Prt=function(e){var t=Crt({onWindowScroll:function(n){e.dispatch(crt({newScroll:n}))}});return function(r){return function(n){!t.isActive()&&n.type==="INITIAL_PUBLISH"&&t.start(),t.isActive()&&Art(n)&&t.stop(),r(n)}}},Ert=function(e){var t=!1,r=!1,n=setTimeout(function(){r=!0}),s=function(i){t||r||(t=!0,e(i),clearTimeout(n))};return s.wasCalled=function(){return t},s},krt=function(){var e=[],t=function(o){var i=eF(e,function(d){return d.timerId===o});i===-1&&Tn(!1);var l=e.splice(i,1),c=l[0];c.callback()},r=function(o){var i=setTimeout(function(){return t(i)}),l={timerId:i,callback:o};e.push(l)},n=function(){if(e.length){var o=[].concat(e);e.length=0,o.forEach(function(i){clearTimeout(i.timerId),i.callback()})}};return{add:r,flush:n}},Irt=function(t,r){return t==null&&r==null?!0:t==null||r==null?!1:t.droppableId===r.droppableId&&t.index===r.index},Ort=function(t,r){return t==null&&r==null?!0:t==null||r==null?!1:t.draggableId===r.draggableId&&t.droppableId===r.droppableId},Trt=function(t,r){if(t===r)return!0;var n=t.draggable.id===r.draggable.id&&t.draggable.droppableId===r.draggable.droppableId&&t.draggable.type===r.draggable.type&&t.draggable.index===r.draggable.index,s=t.droppable.id===r.droppable.id&&t.droppable.type===r.droppable.type;return n&&s},tb=function(t,r){r()},Q_=function(t,r){return{draggableId:t.draggable.id,type:t.droppable.type,source:{droppableId:t.droppable.id,index:t.draggable.index},mode:r}},_k=function(t,r,n,s){if(!t){n(s(r));return}var o=Ert(n),i={announce:o};t(r,i),o.wasCalled()||n(s(r))},Drt=function(e,t){var r=krt(),n=null,s=function(h,m){n&&Tn(!1),tb("onBeforeCapture",function(){var x=e().onBeforeCapture;if(x){var g={draggableId:h,mode:m};x(g)}})},o=function(h,m){n&&Tn(!1),tb("onBeforeDragStart",function(){var x=e().onBeforeDragStart;x&&x(Q_(h,m))})},i=function(h,m){n&&Tn(!1);var x=Q_(h,m);n={mode:m,lastCritical:h,lastLocation:x.source,lastCombine:null},r.add(function(){tb("onDragStart",function(){return _k(e().onDragStart,x,t,Fj.onDragStart)})})},l=function(h,m){var x=tF(m),g=IA(m);n||Tn(!1);var y=!Trt(h,n.lastCritical);y&&(n.lastCritical=h);var v=!Irt(n.lastLocation,x);v&&(n.lastLocation=x);var b=!Ort(n.lastCombine,g);if(b&&(n.lastCombine=g),!(!y&&!v&&!b)){var w=Sa({},Q_(h,n.mode),{combine:g,destination:x});r.add(function(){tb("onDragUpdate",function(){return _k(e().onDragUpdate,w,t,Fj.onDragUpdate)})})}},c=function(){n||Tn(!1),r.flush()},d=function(h){n||Tn(!1),n=null,tb("onDragEnd",function(){return _k(e().onDragEnd,h,t,Fj.onDragEnd)})},u=function(){if(n){var h=Sa({},Q_(n.lastCritical,n.mode),{combine:null,destination:null,reason:"CANCEL"});d(h)}};return{beforeCapture:s,beforeStart:o,start:i,update:l,flush:c,drop:d,abort:u}},Mrt=function(e,t){var r=Drt(e,t);return function(n){return function(s){return function(o){if(o.type==="BEFORE_INITIAL_CAPTURE"){r.beforeCapture(o.payload.draggableId,o.payload.movementMode);return}if(o.type==="INITIAL_PUBLISH"){var i=o.payload.critical;r.beforeStart(i,o.payload.movementMode),s(o),r.start(i,o.payload.movementMode);return}if(o.type==="DROP_COMPLETE"){var l=o.payload.completed.result;r.flush(),s(o),r.drop(l);return}if(s(o),o.type==="FLUSH"){r.abort();return}var c=n.getState();c.phase==="DRAGGING"&&r.update(c.critical,c.impact)}}}},Rrt=function(e){return function(t){return function(r){if(r.type!=="DROP_ANIMATION_FINISHED"){t(r);return}var n=e.getState();n.phase!=="DROP_ANIMATING"&&Tn(!1),e.dispatch(lF({completed:n.completed}))}}},Frt=function(e){var t=null,r=null;function n(){r&&(cancelAnimationFrame(r),r=null),t&&(t(),t=null)}return function(s){return function(o){if((o.type==="FLUSH"||o.type==="DROP_COMPLETE"||o.type==="DROP_ANIMATION_FINISHED")&&n(),s(o),o.type==="DROP_ANIMATE"){var i={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){var c=e.getState();c.phase==="DROP_ANIMATING"&&e.dispatch(Mse())}};r=requestAnimationFrame(function(){r=null,t=Qd(window,[i])})}}}},Lrt=function(e){return function(){return function(t){return function(r){(r.type==="DROP_COMPLETE"||r.type==="FLUSH"||r.type==="DROP_ANIMATE")&&e.stopPublishing(),t(r)}}}},$rt=function(e){var t=!1;return function(){return function(r){return function(n){if(n.type==="INITIAL_PUBLISH"){t=!0,e.tryRecordFocus(n.payload.critical.draggable.id),r(n),e.tryRestoreFocusRecorded();return}if(r(n),!!t){if(n.type==="FLUSH"){t=!1,e.tryRestoreFocusRecorded();return}if(n.type==="DROP_COMPLETE"){t=!1;var s=n.payload.completed.result;s.combine&&e.tryShiftRecord(s.draggableId,s.combine.draggableId),e.tryRestoreFocusRecorded()}}}}}},Brt=function(t){return t.type==="DROP_COMPLETE"||t.type==="DROP_ANIMATE"||t.type==="FLUSH"},qrt=function(e){return function(t){return function(r){return function(n){if(Brt(n)){e.stop(),r(n);return}if(n.type==="INITIAL_PUBLISH"){r(n);var s=t.getState();s.phase!=="DRAGGING"&&Tn(!1),e.start(s);return}r(n),e.scroll(t.getState())}}}},zrt=function(e){return function(t){return function(r){if(t(r),r.type==="PUBLISH_WHILE_DRAGGING"){var n=e.getState();n.phase==="DROP_PENDING"&&(n.isWaiting||e.dispatch(Dse({reason:n.reason})))}}}},Urt=Uae,Vrt=function(e){var t=e.dimensionMarshal,r=e.focusMarshal,n=e.styleMarshal,s=e.getResponders,o=e.announce,i=e.autoScroller;return zae(ert,Urt(EZe(vrt(n),Lrt(t),xrt(t),Nrt,Rrt,Frt,zrt,qrt(i),Prt,$rt(r),Mrt(s,o))))},jk=function(){return{additions:{},removals:{},modified:{}}};function Wrt(e){var t=e.registry,r=e.callbacks,n=jk(),s=null,o=function(){s||(r.collectionStarting(),s=requestAnimationFrame(function(){s=null;var u=n,f=u.additions,h=u.removals,m=u.modified,x=Object.keys(f).map(function(v){return t.draggable.getById(v).getDimension(Xi)}).sort(function(v,b){return v.descriptor.index-b.descriptor.index}),g=Object.keys(m).map(function(v){var b=t.droppable.getById(v),w=b.callbacks.getScrollWhileDragging();return{droppableId:v,scroll:w}}),y={additions:x,removals:Object.keys(h),modified:g};n=jk(),r.publish(y)}))},i=function(u){var f=u.descriptor.id;n.additions[f]=u,n.modified[u.descriptor.droppableId]=!0,n.removals[f]&&delete n.removals[f],o()},l=function(u){var f=u.descriptor;n.removals[f.id]=!0,n.modified[f.droppableId]=!0,n.additions[f.id]&&delete n.additions[f.id],o()},c=function(){s&&(cancelAnimationFrame(s),s=null,n=jk())};return{add:i,remove:l,stop:c}}var Lse=function(e){var t=e.scrollHeight,r=e.scrollWidth,n=e.height,s=e.width,o=cd({x:r,y:t},{x:s,y:n}),i={x:Math.max(0,o.x),y:Math.max(0,o.y)};return i},$se=function(){var e=document.documentElement;return e||Tn(!1),e},Bse=function(){var e=$se(),t=Lse({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight});return t},Hrt=function(){var e=Fse(),t=Bse(),r=e.y,n=e.x,s=$se(),o=s.clientWidth,i=s.clientHeight,l=n+o,c=r+i,d=Tu({top:r,left:n,right:l,bottom:c}),u={frame:d,scroll:{initial:e,current:e,max:t,diff:{value:Xi,displacement:Xi}}};return u},Grt=function(e){var t=e.critical,r=e.scrollOptions,n=e.registry,s=Hrt(),o=s.scroll.current,i=t.droppable,l=n.droppable.getAllByType(i.type).map(function(f){return f.callbacks.getDimensionAndWatchScroll(o,r)}),c=n.draggable.getAllByType(t.draggable.type).map(function(f){return f.getDimension(o)}),d={draggables:pse(c),droppables:hse(l)},u={dimensions:d,critical:t,viewport:s};return u};function YU(e,t,r){if(r.descriptor.id===t.id||r.descriptor.type!==t.type)return!1;var n=e.droppable.getById(r.descriptor.droppableId);return n.descriptor.mode==="virtual"}var Krt=function(e,t){var r=null,n=Wrt({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),s=function(m,x){e.droppable.exists(m)||Tn(!1),r&&t.updateDroppableIsEnabled({id:m,isEnabled:x})},o=function(m,x){r&&(e.droppable.exists(m)||Tn(!1),t.updateDroppableIsCombineEnabled({id:m,isCombineEnabled:x}))},i=function(m,x){r&&(e.droppable.exists(m)||Tn(!1),t.updateDroppableScroll({id:m,newScroll:x}))},l=function(m,x){r&&e.droppable.getById(m).callbacks.scroll(x)},c=function(){if(r){n.stop();var m=r.critical.droppable;e.droppable.getAllByType(m.type).forEach(function(x){return x.callbacks.dragStopped()}),r.unsubscribe(),r=null}},d=function(m){r||Tn(!1);var x=r.critical.draggable;m.type==="ADDITION"&&YU(e,x,m.value)&&n.add(m.value),m.type==="REMOVAL"&&YU(e,x,m.value)&&n.remove(m.value)},u=function(m){r&&Tn(!1);var x=e.draggable.getById(m.draggableId),g=e.droppable.getById(x.descriptor.droppableId),y={draggable:x.descriptor,droppable:g.descriptor},v=e.subscribe(d);return r={critical:y,unsubscribe:v},Grt({critical:y,registry:e,scrollOptions:m.scrollOptions})},f={updateDroppableIsEnabled:s,updateDroppableIsCombineEnabled:o,scrollDroppable:l,updateDroppableScroll:i,startPublishing:u,stopPublishing:c};return f},qse=function(e,t){return e.phase==="IDLE"?!0:e.phase!=="DROP_ANIMATING"||e.completed.result.draggableId===t?!1:e.completed.result.reason==="DROP"},Xrt=function(e){window.scrollBy(e.x,e.y)},Yrt=Ki(function(e){return kA(e).filter(function(t){return!(!t.isEnabled||!t.frame)})}),Jrt=function(t,r){var n=kp(Yrt(r),function(s){return s.frame||Tn(!1),Sse(s.frame.pageMarginBox)(t)});return n},Qrt=function(e){var t=e.center,r=e.destination,n=e.droppables;if(r){var s=n[r];return s.frame?s:null}var o=Jrt(t,n);return o},rp={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:function(t){return Math.pow(t,2)},durationDampening:{stopDampeningAt:1200,accelerateAt:360}},Zrt=function(e,t){var r=e[t.size]*rp.startFromPercentage,n=e[t.size]*rp.maxScrollAtPercentage,s={startScrollingFrom:r,maxScrollValueAt:n};return s},zse=function(e){var t=e.startOfRange,r=e.endOfRange,n=e.current,s=r-t;if(s===0)return 0;var o=n-t,i=o/s;return i},uF=1,ent=function(e,t){if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return rp.maxPixelScroll;if(e===t.startScrollingFrom)return uF;var r=zse({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),n=1-r,s=rp.maxPixelScroll*rp.ease(n);return Math.ceil(s)},JU=rp.durationDampening.accelerateAt,QU=rp.durationDampening.stopDampeningAt,tnt=function(e,t){var r=t,n=QU,s=Date.now(),o=s-r;if(o>=QU)return e;if(o<JU)return uF;var i=zse({startOfRange:JU,endOfRange:n,current:o}),l=e*rp.ease(i);return Math.ceil(l)},ZU=function(e){var t=e.distanceToEdge,r=e.thresholds,n=e.dragStartTime,s=e.shouldUseTimeDampening,o=ent(t,r);return o===0?0:s?Math.max(tnt(o,n),uF):o},eV=function(e){var t=e.container,r=e.distanceToEdges,n=e.dragStartTime,s=e.axis,o=e.shouldUseTimeDampening,i=Zrt(t,s),l=r[s.end]<r[s.start];return l?ZU({distanceToEdge:r[s.end],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o}):-1*ZU({distanceToEdge:r[s.start],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o})},rnt=function(e){var t=e.container,r=e.subject,n=e.proposedScroll,s=r.height>t.height,o=r.width>t.width;return!o&&!s?n:o&&s?null:{x:o?0:n.x,y:s?0:n.y}},nnt=fse(function(e){return e===0?0:e}),Use=function(e){var t=e.dragStartTime,r=e.container,n=e.subject,s=e.center,o=e.shouldUseTimeDampening,i={top:s.y-r.top,right:r.right-s.x,bottom:r.bottom-s.y,left:s.x-r.left},l=eV({container:r,distanceToEdges:i,dragStartTime:t,axis:rF,shouldUseTimeDampening:o}),c=eV({container:r,distanceToEdges:i,dragStartTime:t,axis:vse,shouldUseTimeDampening:o}),d=nnt({x:c,y:l});if(tp(d,Xi))return null;var u=rnt({container:r,subject:n,proposedScroll:d});return u?tp(u,Xi)?null:u:null},ant=fse(function(e){return e===0?0:e>0?1:-1}),fF=function(){var e=function(r,n){return r<0?r:r>n?r-n:0};return function(t){var r=t.current,n=t.max,s=t.change,o=dl(r,s),i={x:e(o.x,n.x),y:e(o.y,n.y)};return tp(i,Xi)?null:i}}(),Vse=function(t){var r=t.max,n=t.current,s=t.change,o={x:Math.max(n.x,r.x),y:Math.max(n.y,r.y)},i=ant(s),l=fF({max:o,current:n,change:i});return!l||i.x!==0&&l.x===0||i.y!==0&&l.y===0},mF=function(t,r){return Vse({current:t.scroll.current,max:t.scroll.max,change:r})},snt=function(t,r){if(!mF(t,r))return null;var n=t.scroll.max,s=t.scroll.current;return fF({current:s,max:n,change:r})},hF=function(t,r){var n=t.frame;return n?Vse({current:n.scroll.current,max:n.scroll.max,change:r}):!1},ont=function(t,r){var n=t.frame;return!n||!hF(t,r)?null:fF({current:n.scroll.current,max:n.scroll.max,change:r})},int=function(e){var t=e.viewport,r=e.subject,n=e.center,s=e.dragStartTime,o=e.shouldUseTimeDampening,i=Use({dragStartTime:s,container:t.frame,subject:r,center:n,shouldUseTimeDampening:o});return i&&mF(t,i)?i:null},lnt=function(e){var t=e.droppable,r=e.subject,n=e.center,s=e.dragStartTime,o=e.shouldUseTimeDampening,i=t.frame;if(!i)return null;var l=Use({dragStartTime:s,container:i.pageMarginBox,subject:r,center:n,shouldUseTimeDampening:o});return l&&hF(t,l)?l:null},tV=function(e){var t=e.state,r=e.dragStartTime,n=e.shouldUseTimeDampening,s=e.scrollWindow,o=e.scrollDroppable,i=t.current.page.borderBoxCenter,l=t.dimensions.draggables[t.critical.draggable.id],c=l.page.marginBox;if(t.isWindowScrollAllowed){var d=t.viewport,u=int({dragStartTime:r,viewport:d,subject:c,center:i,shouldUseTimeDampening:n});if(u){s(u);return}}var f=Qrt({center:i,destination:gd(t.impact),droppables:t.dimensions.droppables});if(f){var h=lnt({dragStartTime:r,droppable:f,subject:c,center:i,shouldUseTimeDampening:n});h&&o(f.descriptor.id,h)}},cnt=function(e){var t=e.scrollWindow,r=e.scrollDroppable,n=T1(t),s=T1(r),o=null,i=function(u){o||Tn(!1);var f=o,h=f.shouldUseTimeDampening,m=f.dragStartTime;tV({state:u,scrollWindow:n,scrollDroppable:s,dragStartTime:m,shouldUseTimeDampening:h})},l=function(u){o&&Tn(!1);var f=Date.now(),h=!1,m=function(){h=!0};tV({state:u,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:m,scrollDroppable:m}),o={dragStartTime:f,shouldUseTimeDampening:h},h&&i(u)},c=function(){o&&(n.cancel(),s.cancel(),o=null)};return{start:l,stop:c,scroll:i}},dnt=function(e){var t=e.move,r=e.scrollDroppable,n=e.scrollWindow,s=function(d,u){var f=dl(d.current.client.selection,u);t({client:f})},o=function(d,u){if(!hF(d,u))return u;var f=ont(d,u);if(!f)return r(d.descriptor.id,u),null;var h=cd(u,f);r(d.descriptor.id,h);var m=cd(u,h);return m},i=function(d,u,f){if(!d||!mF(u,f))return f;var h=snt(u,f);if(!h)return n(f),null;var m=cd(f,h);n(m);var x=cd(f,m);return x},l=function(d){var u=d.scrollJumpRequest;if(u){var f=gd(d.impact);f||Tn(!1);var h=o(d.dimensions.droppables[f],u);if(h){var m=d.viewport,x=i(d.isWindowScrollAllowed,m,h);x&&s(d,x)}}};return l},unt=function(e){var t=e.scrollDroppable,r=e.scrollWindow,n=e.move,s=cnt({scrollWindow:r,scrollDroppable:t}),o=dnt({move:n,scrollWindow:r,scrollDroppable:t}),i=function(d){if(d.phase==="DRAGGING"){if(d.movementMode==="FLUID"){s.scroll(d);return}d.scrollJumpRequest&&o(d)}},l={scroll:i,start:s.start,stop:s.stop};return l},L0="data-rbd",$0=function(){var e=L0+"-drag-handle";return{base:e,draggableId:e+"-draggable-id",contextId:e+"-context-id"}}(),R3=function(){var e=L0+"-draggable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),fnt=function(){var e=L0+"-droppable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),rV={contextId:L0+"-scroll-container-context-id"},mnt=function(t){return function(r){return"["+r+'="'+t+'"]'}},rb=function(t,r){return t.map(function(n){var s=n.styles[r];return s?n.selector+" { "+s+" }":""}).join(" ")},hnt="pointer-events: none;",pnt=function(e){var t=mnt(e),r=function(){var l=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:t($0.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:l,dragging:hnt,dropAnimating:l}}}(),n=function(){var l=`
      transition: `+iw.outOfTheWay+`;
    `;return{selector:t(R3.contextId),styles:{dragging:l,dropAnimating:l,userCancel:l}}}(),s={selector:t(fnt.contextId),styles:{always:"overflow-anchor: none;"}},o={selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}},i=[n,r,s,o];return{always:rb(i,"always"),resting:rb(i,"resting"),dragging:rb(i,"dragging"),dropAnimating:rb(i,"dropAnimating"),userCancel:rb(i,"userCancel")}},xd=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?p.useLayoutEffect:p.useEffect,Nk=function(){var t=document.querySelector("head");return t||Tn(!1),t},nV=function(t){var r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.type="text/css",r};function gnt(e,t){var r=js(function(){return pnt(e)},[e]),n=p.useRef(null),s=p.useRef(null),o=xa(Ki(function(f){var h=s.current;h||Tn(!1),h.textContent=f}),[]),i=xa(function(f){var h=n.current;h||Tn(!1),h.textContent=f},[]);xd(function(){!n.current&&!s.current||Tn(!1);var f=nV(t),h=nV(t);return n.current=f,s.current=h,f.setAttribute(L0+"-always",e),h.setAttribute(L0+"-dynamic",e),Nk().appendChild(f),Nk().appendChild(h),i(r.always),o(r.resting),function(){var m=function(g){var y=g.current;y||Tn(!1),Nk().removeChild(y),g.current=null};m(n),m(s)}},[t,i,o,r.always,r.resting,e]);var l=xa(function(){return o(r.dragging)},[o,r.dragging]),c=xa(function(f){if(f==="DROP"){o(r.dropAnimating);return}o(r.userCancel)},[o,r.dropAnimating,r.userCancel]),d=xa(function(){s.current&&o(r.resting)},[o,r.resting]),u=js(function(){return{dragging:l,dropping:c,resting:d}},[l,c,d]);return u}var Wse=function(e){return e&&e.ownerDocument?e.ownerDocument.defaultView:window};function DA(e){return e instanceof Wse(e).HTMLElement}function xnt(e,t){var r="["+$0.contextId+'="'+e+'"]',n=mse(document.querySelectorAll(r));if(!n.length)return null;var s=kp(n,function(o){return o.getAttribute($0.draggableId)===t});return!s||!DA(s)?null:s}function vnt(e){var t=p.useRef({}),r=p.useRef(null),n=p.useRef(null),s=p.useRef(!1),o=xa(function(h,m){var x={id:h,focus:m};return t.current[h]=x,function(){var y=t.current,v=y[h];v!==x&&delete y[h]}},[]),i=xa(function(h){var m=xnt(e,h);m&&m!==document.activeElement&&m.focus()},[e]),l=xa(function(h,m){r.current===h&&(r.current=m)},[]),c=xa(function(){n.current||s.current&&(n.current=requestAnimationFrame(function(){n.current=null;var h=r.current;h&&i(h)}))},[i]),d=xa(function(h){r.current=null;var m=document.activeElement;m&&m.getAttribute($0.draggableId)===h&&(r.current=h)},[]);xd(function(){return s.current=!0,function(){s.current=!1;var h=n.current;h&&cancelAnimationFrame(h)}},[]);var u=js(function(){return{register:o,tryRecordFocus:d,tryRestoreFocusRecorded:c,tryShiftRecord:l}},[o,d,c,l]);return u}function ynt(){var e={draggables:{},droppables:{}},t=[];function r(f){return t.push(f),function(){var m=t.indexOf(f);m!==-1&&t.splice(m,1)}}function n(f){t.length&&t.forEach(function(h){return h(f)})}function s(f){return e.draggables[f]||null}function o(f){var h=s(f);return h||Tn(!1),h}var i={register:function(h){e.draggables[h.descriptor.id]=h,n({type:"ADDITION",value:h})},update:function(h,m){var x=e.draggables[m.descriptor.id];x&&x.uniqueId===h.uniqueId&&(delete e.draggables[m.descriptor.id],e.draggables[h.descriptor.id]=h)},unregister:function(h){var m=h.descriptor.id,x=s(m);x&&h.uniqueId===x.uniqueId&&(delete e.draggables[m],n({type:"REMOVAL",value:h}))},getById:o,findById:s,exists:function(h){return!!s(h)},getAllByType:function(h){return aC(e.draggables).filter(function(m){return m.descriptor.type===h})}};function l(f){return e.droppables[f]||null}function c(f){var h=l(f);return h||Tn(!1),h}var d={register:function(h){e.droppables[h.descriptor.id]=h},unregister:function(h){var m=l(h.descriptor.id);m&&h.uniqueId===m.uniqueId&&delete e.droppables[h.descriptor.id]},getById:c,findById:l,exists:function(h){return!!l(h)},getAllByType:function(h){return aC(e.droppables).filter(function(m){return m.descriptor.type===h})}};function u(){e.draggables={},e.droppables={},t.length=0}return{draggable:i,droppable:d,subscribe:r,clean:u}}function bnt(){var e=js(ynt,[]);return p.useEffect(function(){return function(){requestAnimationFrame(e.clean)}},[e]),e}var pF=Ee.createContext(null),oC=function(){var e=document.body;return e||Tn(!1),e},wnt={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},_nt=function(t){return"rbd-announcement-"+t};function jnt(e){var t=js(function(){return _nt(e)},[e]),r=p.useRef(null);p.useEffect(function(){var o=document.createElement("div");return r.current=o,o.id=t,o.setAttribute("aria-live","assertive"),o.setAttribute("aria-atomic","true"),Sa(o.style,wnt),oC().appendChild(o),function(){setTimeout(function(){var c=oC();c.contains(o)&&c.removeChild(o),o===r.current&&(r.current=null)})}},[t]);var n=xa(function(s){var o=r.current;if(o){o.textContent=s;return}},[]);return n}var Nnt=0,Snt={separator:"::"};function gF(e,t){return t===void 0&&(t=Snt),js(function(){return""+e+t.separator+Nnt++},[t.separator,e])}function Cnt(e){var t=e.contextId,r=e.uniqueId;return"rbd-hidden-text-"+t+"-"+r}function Ant(e){var t=e.contextId,r=e.text,n=gF("hidden-text",{separator:"-"}),s=js(function(){return Cnt({contextId:t,uniqueId:n})},[n,t]);return p.useEffect(function(){var i=document.createElement("div");return i.id=s,i.textContent=r,i.style.display="none",oC().appendChild(i),function(){var c=oC();c.contains(i)&&c.removeChild(i)}},[s,r]),s}var MA=Ee.createContext(null);function Hse(e){var t=p.useRef(e);return p.useEffect(function(){t.current=e}),t}function Pnt(){var e=null;function t(){return!!e}function r(i){return i===e}function n(i){e&&Tn(!1);var l={abandon:i};return e=l,l}function s(){e||Tn(!1),e=null}function o(){e&&(e.abandon(),s())}return{isClaimed:t,isActive:r,claim:n,release:s,tryAbandon:o}}var Ent=9,knt=13,xF=27,Gse=32,Int=33,Ont=34,Tnt=35,Dnt=36,Mnt=37,Rnt=38,Fnt=39,Lnt=40,Z_,$nt=(Z_={},Z_[knt]=!0,Z_[Ent]=!0,Z_),Kse=function(e){$nt[e.keyCode]&&e.preventDefault()},RA=function(){var e="visibilitychange";if(typeof document>"u")return e;var t=[e,"ms"+e,"webkit"+e,"moz"+e,"o"+e],r=kp(t,function(n){return"on"+n in document});return r||e}(),Xse=0,aV=5;function Bnt(e,t){return Math.abs(t.x-e.x)>=aV||Math.abs(t.y-e.y)>=aV}var sV={type:"IDLE"};function qnt(e){var t=e.cancel,r=e.completed,n=e.getPhase,s=e.setPhase;return[{eventName:"mousemove",fn:function(i){var l=i.button,c=i.clientX,d=i.clientY;if(l===Xse){var u={x:c,y:d},f=n();if(f.type==="DRAGGING"){i.preventDefault(),f.actions.move(u);return}f.type!=="PENDING"&&Tn(!1);var h=f.point;if(Bnt(h,u)){i.preventDefault();var m=f.actions.fluidLift(u);s({type:"DRAGGING",actions:m})}}}},{eventName:"mouseup",fn:function(i){var l=n();if(l.type!=="DRAGGING"){t();return}i.preventDefault(),l.actions.drop({shouldBlockNextClick:!0}),r()}},{eventName:"mousedown",fn:function(i){n().type==="DRAGGING"&&i.preventDefault(),t()}},{eventName:"keydown",fn:function(i){var l=n();if(l.type==="PENDING"){t();return}if(i.keyCode===xF){i.preventDefault(),t();return}Kse(i)}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(){n().type==="PENDING"&&t()}},{eventName:"webkitmouseforcedown",fn:function(i){var l=n();if(l.type==="IDLE"&&Tn(!1),l.actions.shouldRespectForcePress()){t();return}i.preventDefault()}},{eventName:RA,fn:t}]}function znt(e){var t=p.useRef(sV),r=p.useRef(ep),n=js(function(){return{eventName:"mousedown",fn:function(f){if(!f.defaultPrevented&&f.button===Xse&&!(f.ctrlKey||f.metaKey||f.shiftKey||f.altKey)){var h=e.findClosestDraggableId(f);if(h){var m=e.tryGetLock(h,i,{sourceEvent:f});if(m){f.preventDefault();var x={x:f.clientX,y:f.clientY};r.current(),d(m,x)}}}}}},[e]),s=js(function(){return{eventName:"webkitmouseforcewillbegin",fn:function(f){if(!f.defaultPrevented){var h=e.findClosestDraggableId(f);if(h){var m=e.findOptionsForDraggable(h);m&&(m.shouldRespectForcePress||e.canGetLock(h)&&f.preventDefault())}}}}},[e]),o=xa(function(){var f={passive:!1,capture:!0};r.current=Qd(window,[s,n],f)},[s,n]),i=xa(function(){var u=t.current;u.type!=="IDLE"&&(t.current=sV,r.current(),o())},[o]),l=xa(function(){var u=t.current;i(),u.type==="DRAGGING"&&u.actions.cancel({shouldBlockNextClick:!0}),u.type==="PENDING"&&u.actions.abort()},[i]),c=xa(function(){var f={capture:!0,passive:!1},h=qnt({cancel:l,completed:i,getPhase:function(){return t.current},setPhase:function(x){t.current=x}});r.current=Qd(window,h,f)},[l,i]),d=xa(function(f,h){t.current.type!=="IDLE"&&Tn(!1),t.current={type:"PENDING",point:h,actions:f},c()},[c]);xd(function(){return o(),function(){r.current()}},[o])}var Hx;function Unt(){}var Vnt=(Hx={},Hx[Ont]=!0,Hx[Int]=!0,Hx[Dnt]=!0,Hx[Tnt]=!0,Hx);function Wnt(e,t){function r(){t(),e.cancel()}function n(){t(),e.drop()}return[{eventName:"keydown",fn:function(o){if(o.keyCode===xF){o.preventDefault(),r();return}if(o.keyCode===Gse){o.preventDefault(),n();return}if(o.keyCode===Lnt){o.preventDefault(),e.moveDown();return}if(o.keyCode===Rnt){o.preventDefault(),e.moveUp();return}if(o.keyCode===Fnt){o.preventDefault(),e.moveRight();return}if(o.keyCode===Mnt){o.preventDefault(),e.moveLeft();return}if(Vnt[o.keyCode]){o.preventDefault();return}Kse(o)}},{eventName:"mousedown",fn:r},{eventName:"mouseup",fn:r},{eventName:"click",fn:r},{eventName:"touchstart",fn:r},{eventName:"resize",fn:r},{eventName:"wheel",fn:r,options:{passive:!0}},{eventName:RA,fn:r}]}function Hnt(e){var t=p.useRef(Unt),r=js(function(){return{eventName:"keydown",fn:function(o){if(o.defaultPrevented||o.keyCode!==Gse)return;var i=e.findClosestDraggableId(o);if(!i)return;var l=e.tryGetLock(i,u,{sourceEvent:o});if(!l)return;o.preventDefault();var c=!0,d=l.snapLift();t.current();function u(){c||Tn(!1),c=!1,t.current(),n()}t.current=Qd(window,Wnt(d,u),{capture:!0,passive:!1})}}},[e]),n=xa(function(){var o={passive:!1,capture:!0};t.current=Qd(window,[r],o)},[r]);xd(function(){return n(),function(){t.current()}},[n])}var Sk={type:"IDLE"},Gnt=120,Knt=.15;function Xnt(e){var t=e.cancel,r=e.getPhase;return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:function(s){s.preventDefault()}},{eventName:"keydown",fn:function(s){if(r().type!=="DRAGGING"){t();return}s.keyCode===xF&&s.preventDefault(),t()}},{eventName:RA,fn:t}]}function Ynt(e){var t=e.cancel,r=e.completed,n=e.getPhase;return[{eventName:"touchmove",options:{capture:!1},fn:function(o){var i=n();if(i.type!=="DRAGGING"){t();return}i.hasMoved=!0;var l=o.touches[0],c=l.clientX,d=l.clientY,u={x:c,y:d};o.preventDefault(),i.actions.move(u)}},{eventName:"touchend",fn:function(o){var i=n();if(i.type!=="DRAGGING"){t();return}o.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),r()}},{eventName:"touchcancel",fn:function(o){if(n().type!=="DRAGGING"){t();return}o.preventDefault(),t()}},{eventName:"touchforcechange",fn:function(o){var i=n();i.type==="IDLE"&&Tn(!1);var l=o.touches[0];if(l){var c=l.force>=Knt;if(c){var d=i.actions.shouldRespectForcePress();if(i.type==="PENDING"){d&&t();return}if(d){if(i.hasMoved){o.preventDefault();return}t();return}o.preventDefault()}}}},{eventName:RA,fn:t}]}function Jnt(e){var t=p.useRef(Sk),r=p.useRef(ep),n=xa(function(){return t.current},[]),s=xa(function(m){t.current=m},[]),o=js(function(){return{eventName:"touchstart",fn:function(m){if(!m.defaultPrevented){var x=e.findClosestDraggableId(m);if(x){var g=e.tryGetLock(x,l,{sourceEvent:m});if(g){var y=m.touches[0],v=y.clientX,b=y.clientY,w={x:v,y:b};r.current(),f(g,w)}}}}}},[e]),i=xa(function(){var m={capture:!0,passive:!1};r.current=Qd(window,[o],m)},[o]),l=xa(function(){var h=t.current;h.type!=="IDLE"&&(h.type==="PENDING"&&clearTimeout(h.longPressTimerId),s(Sk),r.current(),i())},[i,s]),c=xa(function(){var h=t.current;l(),h.type==="DRAGGING"&&h.actions.cancel({shouldBlockNextClick:!0}),h.type==="PENDING"&&h.actions.abort()},[l]),d=xa(function(){var m={capture:!0,passive:!1},x={cancel:c,completed:l,getPhase:n},g=Qd(window,Ynt(x),m),y=Qd(window,Xnt(x),m);r.current=function(){g(),y()}},[c,n,l]),u=xa(function(){var m=n();m.type!=="PENDING"&&Tn(!1);var x=m.actions.fluidLift(m.point);s({type:"DRAGGING",actions:x,hasMoved:!1})},[n,s]),f=xa(function(m,x){n().type!=="IDLE"&&Tn(!1);var g=setTimeout(u,Gnt);s({type:"PENDING",point:x,actions:m,longPressTimerId:g}),d()},[d,n,s,u]);xd(function(){return i(),function(){r.current();var x=n();x.type==="PENDING"&&(clearTimeout(x.longPressTimerId),s(Sk))}},[n,i,s]),xd(function(){var m=Qd(window,[{eventName:"touchmove",fn:function(){},options:{capture:!1,passive:!1}}]);return m},[])}var Qnt={input:!0,button:!0,textarea:!0,select:!0,option:!0,optgroup:!0,video:!0,audio:!0};function Yse(e,t){if(t==null)return!1;var r=!!Qnt[t.tagName.toLowerCase()];if(r)return!0;var n=t.getAttribute("contenteditable");return n==="true"||n===""?!0:t===e?!1:Yse(e,t.parentElement)}function Znt(e,t){var r=t.target;return DA(r)?Yse(e,r):!1}var eat=function(e){return Tu(e.getBoundingClientRect()).center};function tat(e){return e instanceof Wse(e).Element}var rat=function(){var e="matches";if(typeof document>"u")return e;var t=[e,"msMatchesSelector","webkitMatchesSelector"],r=kp(t,function(n){return n in Element.prototype});return r||e}();function Jse(e,t){return e==null?null:e[rat](t)?e:Jse(e.parentElement,t)}function nat(e,t){return e.closest?e.closest(t):Jse(e,t)}function aat(e){return"["+$0.contextId+'="'+e+'"]'}function sat(e,t){var r=t.target;if(!tat(r))return null;var n=aat(e),s=nat(r,n);return!s||!DA(s)?null:s}function oat(e,t){var r=sat(e,t);return r?r.getAttribute($0.draggableId):null}function iat(e,t){var r="["+R3.contextId+'="'+e+'"]',n=mse(document.querySelectorAll(r)),s=kp(n,function(o){return o.getAttribute(R3.id)===t});return!s||!DA(s)?null:s}function lat(e){e.preventDefault()}function ej(e){var t=e.expected,r=e.phase,n=e.isLockActive;return e.shouldWarn,!(!n()||t!==r)}function Qse(e){var t=e.lockAPI,r=e.store,n=e.registry,s=e.draggableId;if(t.isClaimed())return!1;var o=n.draggable.findById(s);return!(!o||!o.options.isEnabled||!qse(r.getState(),s))}function cat(e){var t=e.lockAPI,r=e.contextId,n=e.store,s=e.registry,o=e.draggableId,i=e.forceSensorStop,l=e.sourceEvent,c=Qse({lockAPI:t,store:n,registry:s,draggableId:o});if(!c)return null;var d=s.draggable.getById(o),u=iat(r,d.descriptor.id);if(!u||l&&!d.options.canDragInteractiveElements&&Znt(u,l))return null;var f=t.claim(i||ep),h="PRE_DRAG";function m(){return d.options.shouldRespectForcePress}function x(){return t.isActive(f)}function g(S,C){ej({expected:S,phase:h,isLockActive:x,shouldWarn:!0})&&n.dispatch(C())}var y=g.bind(null,"DRAGGING");function v(S){function C(){t.release(),h="COMPLETED"}h!=="PRE_DRAG"&&(C(),h!=="PRE_DRAG"&&Tn(!1)),n.dispatch(rrt(S.liftActionArgs)),h="DRAGGING";function A(P,F){if(F===void 0&&(F={shouldBlockNextClick:!1}),S.cleanup(),F.shouldBlockNextClick){var O=Qd(window,[{eventName:"click",fn:lat,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(O)}C(),n.dispatch(Dse({reason:P}))}return Sa({isActive:function(){return ej({expected:"DRAGGING",phase:h,isLockActive:x,shouldWarn:!1})},shouldRespectForcePress:m,drop:function(F){return A("DROP",F)},cancel:function(F){return A("CANCEL",F)}},S.actions)}function b(S){var C=T1(function(P){y(function(){return Tse({client:P})})}),A=v({liftActionArgs:{id:o,clientSelection:S,movementMode:"FLUID"},cleanup:function(){return C.cancel()},actions:{move:C}});return Sa({},A,{move:C})}function w(){var S={moveUp:function(){return y(urt)},moveRight:function(){return y(mrt)},moveDown:function(){return y(frt)},moveLeft:function(){return y(hrt)}};return v({liftActionArgs:{id:o,clientSelection:eat(u),movementMode:"SNAP"},cleanup:ep,actions:S})}function _(){var S=ej({expected:"PRE_DRAG",phase:h,isLockActive:x,shouldWarn:!0});S&&t.release()}var j={isActive:function(){return ej({expected:"PRE_DRAG",phase:h,isLockActive:x,shouldWarn:!1})},shouldRespectForcePress:m,fluidLift:b,snapLift:w,abort:_};return j}var dat=[znt,Hnt,Jnt];function uat(e){var t=e.contextId,r=e.store,n=e.registry,s=e.customSensors,o=e.enableDefaultSensors,i=[].concat(o?dat:[],s||[]),l=p.useState(function(){return Pnt()})[0],c=xa(function(b,w){b.isDragging&&!w.isDragging&&l.tryAbandon()},[l]);xd(function(){var b=r.getState(),w=r.subscribe(function(){var _=r.getState();c(b,_),b=_});return w},[l,r,c]),xd(function(){return l.tryAbandon},[l.tryAbandon]);for(var d=xa(function(v){return Qse({lockAPI:l,registry:n,store:r,draggableId:v})},[l,n,r]),u=xa(function(v,b,w){return cat({lockAPI:l,registry:n,contextId:t,store:r,draggableId:v,forceSensorStop:b,sourceEvent:w&&w.sourceEvent?w.sourceEvent:null})},[t,l,n,r]),f=xa(function(v){return oat(t,v)},[t]),h=xa(function(v){var b=n.draggable.findById(v);return b?b.options:null},[n.draggable]),m=xa(function(){l.isClaimed()&&(l.tryAbandon(),r.getState().phase!=="IDLE"&&r.dispatch(iF()))},[l,r]),x=xa(l.isClaimed,[l]),g=js(function(){return{canGetLock:d,tryGetLock:u,findClosestDraggableId:f,findOptionsForDraggable:h,tryReleaseLock:m,isLockClaimed:x}},[d,u,f,h,m,x]),y=0;y<i.length;y++)i[y](g)}var fat=function(t){return{onBeforeCapture:t.onBeforeCapture,onBeforeDragStart:t.onBeforeDragStart,onDragStart:t.onDragStart,onDragEnd:t.onDragEnd,onDragUpdate:t.onDragUpdate}};function nb(e){return e.current||Tn(!1),e.current}function mat(e){var t=e.contextId,r=e.setCallbacks,n=e.sensors,s=e.nonce,o=e.dragHandleUsageInstructions,i=p.useRef(null),l=Hse(e),c=xa(function(){return fat(l.current)},[l]),d=jnt(t),u=Ant({contextId:t,text:o}),f=gnt(t,s),h=xa(function(P){nb(i).dispatch(P)},[]),m=js(function(){return PU({publishWhileDragging:art,updateDroppableScroll:ort,updateDroppableIsEnabled:irt,updateDroppableIsCombineEnabled:lrt,collectionStarting:srt},h)},[h]),x=bnt(),g=js(function(){return Krt(x,m)},[x,m]),y=js(function(){return unt(Sa({scrollWindow:Xrt,scrollDroppable:g.scrollDroppable},PU({move:Tse},h)))},[g.scrollDroppable,h]),v=vnt(t),b=js(function(){return Vrt({announce:d,autoScroller:y,dimensionMarshal:g,focusMarshal:v,getResponders:c,styleMarshal:f})},[d,y,g,v,c,f]);i.current=b;var w=xa(function(){var P=nb(i),F=P.getState();F.phase!=="IDLE"&&P.dispatch(iF())},[]),_=xa(function(){var P=nb(i).getState();return P.isDragging||P.phase==="DROP_ANIMATING"},[]),j=js(function(){return{isDragging:_,tryAbort:w}},[_,w]);r(j);var S=xa(function(P){return qse(nb(i).getState(),P)},[]),C=xa(function(){return tg(nb(i).getState())},[]),A=js(function(){return{marshal:g,focus:v,contextId:t,canLift:S,isMovementAllowed:C,dragHandleUsageInstructionsId:u,registry:x}},[t,g,u,v,S,C,x]);return uat({contextId:t,store:b,registry:x,customSensors:n,enableDefaultSensors:e.enableDefaultSensors!==!1}),p.useEffect(function(){return w},[w]),Ee.createElement(MA.Provider,{value:A},Ee.createElement(DZe,{context:pF,store:b},e.children))}var hat=0;function pat(){return js(function(){return""+hat++},[])}function gat(e){var t=pat(),r=e.dragHandleUsageInstructions||Fj.dragHandleUsageInstructions;return Ee.createElement(Het,null,function(n){return Ee.createElement(mat,{nonce:e.nonce,contextId:t,setCallbacks:n,dragHandleUsageInstructions:r,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd},e.children)})}var Zse=function(t){return function(r){return t===r}},xat=Zse("scroll"),vat=Zse("auto"),oV=function(t,r){return r(t.overflowX)||r(t.overflowY)},yat=function(t){var r=window.getComputedStyle(t),n={overflowX:r.overflowX,overflowY:r.overflowY};return oV(n,xat)||oV(n,vat)},bat=function(){return!1},wat=function e(t){return t==null?null:t===document.body?bat()?t:null:t===document.documentElement?null:yat(t)?t:e(t.parentElement)},F3=function(e){return{x:e.scrollLeft,y:e.scrollTop}},_at=function e(t){if(!t)return!1;var r=window.getComputedStyle(t);return r.position==="fixed"?!0:e(t.parentElement)},jat=function(e){var t=wat(e),r=_at(e);return{closestScrollable:t,isFixedOnPage:r}},Nat=function(e){var t=e.descriptor,r=e.isEnabled,n=e.isCombineEnabled,s=e.isFixedOnPage,o=e.direction,i=e.client,l=e.page,c=e.closest,d=function(){if(!c)return null;var m=c.scrollSize,x=c.client,g=Lse({scrollHeight:m.scrollHeight,scrollWidth:m.scrollWidth,height:x.paddingBox.height,width:x.paddingBox.width});return{pageMarginBox:c.page.marginBox,frameClient:x,scrollSize:m,shouldClipSubject:c.shouldClipSubject,scroll:{initial:c.scroll,current:c.scroll,max:g,diff:{value:Xi,displacement:Xi}}}}(),u=o==="vertical"?rF:vse,f=F0({page:l,withPlaceholder:null,axis:u,frame:d}),h={descriptor:t,isCombineEnabled:n,isFixedOnPage:s,axis:u,isEnabled:r,client:i,page:l,frame:d,subject:f};return h},Sat=function(t,r){var n=lse(t);if(!r||t!==r)return n;var s=n.paddingBox.top-r.scrollTop,o=n.paddingBox.left-r.scrollLeft,i=s+r.scrollHeight,l=o+r.scrollWidth,c={top:s,right:l,bottom:i,left:o},d=JR(c,n.border),u=QR({borderBox:d,margin:n.margin,border:n.border,padding:n.padding});return u},Cat=function(e){var t=e.ref,r=e.descriptor,n=e.env,s=e.windowScroll,o=e.direction,i=e.isDropDisabled,l=e.isCombineEnabled,c=e.shouldClipSubject,d=n.closestScrollable,u=Sat(t,d),f=tC(u,s),h=function(){if(!d)return null;var x=lse(d),g={scrollHeight:d.scrollHeight,scrollWidth:d.scrollWidth};return{client:x,page:tC(x,s),scroll:F3(d),scrollSize:g,shouldClipSubject:c}}(),m=Nat({descriptor:r,isEnabled:!i,isCombineEnabled:l,isFixedOnPage:n.isFixedOnPage,direction:o,client:u,page:f,closest:h});return m},Aat={passive:!1},Pat={passive:!0},iV=function(e){return e.shouldPublishImmediately?Aat:Pat};function iC(e){var t=p.useContext(e);return t||Tn(!1),t}var tj=function(t){return t&&t.env.closestScrollable||null};function Eat(e){var t=p.useRef(null),r=iC(MA),n=gF("droppable"),s=r.registry,o=r.marshal,i=Hse(e),l=js(function(){return{id:e.droppableId,type:e.type,mode:e.mode}},[e.droppableId,e.mode,e.type]),c=p.useRef(l),d=js(function(){return Ki(function(_,j){t.current||Tn(!1);var S={x:_,y:j};o.updateDroppableScroll(l.id,S)})},[l.id,o]),u=xa(function(){var _=t.current;return!_||!_.env.closestScrollable?Xi:F3(_.env.closestScrollable)},[]),f=xa(function(){var _=u();d(_.x,_.y)},[u,d]),h=js(function(){return T1(f)},[f]),m=xa(function(){var _=t.current,j=tj(_);_&&j||Tn(!1);var S=_.scrollOptions;if(S.shouldPublishImmediately){f();return}h()},[h,f]),x=xa(function(_,j){t.current&&Tn(!1);var S=i.current,C=S.getDroppableRef();C||Tn(!1);var A=jat(C),P={ref:C,descriptor:l,env:A,scrollOptions:j};t.current=P;var F=Cat({ref:C,descriptor:l,env:A,windowScroll:_,direction:S.direction,isDropDisabled:S.isDropDisabled,isCombineEnabled:S.isCombineEnabled,shouldClipSubject:!S.ignoreContainerClipping}),O=A.closestScrollable;return O&&(O.setAttribute(rV.contextId,r.contextId),O.addEventListener("scroll",m,iV(P.scrollOptions))),F},[r.contextId,l,m,i]),g=xa(function(){var _=t.current,j=tj(_);return _&&j||Tn(!1),F3(j)},[]),y=xa(function(){var _=t.current;_||Tn(!1);var j=tj(_);t.current=null,j&&(h.cancel(),j.removeAttribute(rV.contextId),j.removeEventListener("scroll",m,iV(_.scrollOptions)))},[m,h]),v=xa(function(_){var j=t.current;j||Tn(!1);var S=tj(j);S||Tn(!1),S.scrollTop+=_.y,S.scrollLeft+=_.x},[]),b=js(function(){return{getDimensionAndWatchScroll:x,getScrollWhileDragging:g,dragStopped:y,scroll:v}},[y,x,g,v]),w=js(function(){return{uniqueId:n,descriptor:l,callbacks:b}},[b,l,n]);xd(function(){return c.current=w.descriptor,s.droppable.register(w),function(){t.current&&y(),s.droppable.unregister(w)}},[b,l,y,w,o,s.droppable]),xd(function(){t.current&&o.updateDroppableIsEnabled(c.current.id,!e.isDropDisabled)},[e.isDropDisabled,o]),xd(function(){t.current&&o.updateDroppableIsCombineEnabled(c.current.id,e.isCombineEnabled)},[e.isCombineEnabled,o])}function Ck(){}var lV={width:0,height:0,margin:Qet},kat=function(t){var r=t.isAnimatingOpenOnMount,n=t.placeholder,s=t.animate;return r||s==="close"?lV:{height:n.client.borderBox.height,width:n.client.borderBox.width,margin:n.client.margin}},Iat=function(t){var r=t.isAnimatingOpenOnMount,n=t.placeholder,s=t.animate,o=kat({isAnimatingOpenOnMount:r,placeholder:n,animate:s});return{display:n.display,boxSizing:"border-box",width:o.width,height:o.height,marginTop:o.margin.top,marginRight:o.margin.right,marginBottom:o.margin.bottom,marginLeft:o.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:s!=="none"?iw.placeholder:null}};function Oat(e){var t=p.useRef(null),r=xa(function(){t.current&&(clearTimeout(t.current),t.current=null)},[]),n=e.animate,s=e.onTransitionEnd,o=e.onClose,i=e.contextId,l=p.useState(e.animate==="open"),c=l[0],d=l[1];p.useEffect(function(){return c?n!=="open"?(r(),d(!1),Ck):t.current?Ck:(t.current=setTimeout(function(){t.current=null,d(!1)}),r):Ck},[n,c,r]);var u=xa(function(h){h.propertyName==="height"&&(s(),n==="close"&&o())},[n,o,s]),f=Iat({isAnimatingOpenOnMount:c,animate:e.animate,placeholder:e.placeholder});return Ee.createElement(e.placeholder.tagName,{style:f,"data-rbd-placeholder-context-id":i,onTransitionEnd:u,ref:e.innerRef})}var Tat=Ee.memo(Oat),vF=Ee.createContext(null),Dat=function(e){BZ(t,e);function t(){for(var n,s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.state={isVisible:!!n.props.on,data:n.props.on,animate:n.props.shouldAnimate&&n.props.on?"open":"none"},n.onClose=function(){n.state.animate==="close"&&n.setState({isVisible:!1})},n}t.getDerivedStateFromProps=function(s,o){return s.shouldAnimate?s.on?{isVisible:!0,data:s.on,animate:"open"}:o.isVisible?{isVisible:!0,data:o.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!s.on,data:s.on,animate:"none"}};var r=t.prototype;return r.render=function(){if(!this.state.isVisible)return null;var s={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(s)},t}(Ee.PureComponent),cV={dragging:5e3,dropAnimating:4500},Mat=function(t,r){return r?iw.drop(r.duration):t?iw.snap:iw.fluid},Rat=function(t,r){return t?r?F1.opacity.drop:F1.opacity.combining:null},Fat=function(t){return t.forceShouldAnimate!=null?t.forceShouldAnimate:t.mode==="SNAP"};function Lat(e){var t=e.dimension,r=t.client,n=e.offset,s=e.combineWith,o=e.dropping,i=!!s,l=Fat(e),c=!!o,d=c?D3.drop(n,i):D3.moveTo(n),u={position:"fixed",top:r.marginBox.top,left:r.marginBox.left,boxSizing:"border-box",width:r.borderBox.width,height:r.borderBox.height,transition:Mat(l,o),transform:d,opacity:Rat(i,c),zIndex:c?cV.dropAnimating:cV.dragging,pointerEvents:"none"};return u}function $at(e){return{transform:D3.moveTo(e.offset),transition:e.shouldAnimateDisplacement?null:"none"}}function Bat(e){return e.type==="DRAGGING"?Lat(e):$at(e)}function qat(e,t,r){r===void 0&&(r=Xi);var n=window.getComputedStyle(t),s=t.getBoundingClientRect(),o=ise(s,n),i=tC(o,r),l={client:o,tagName:t.tagName.toLowerCase(),display:n.display},c={x:o.marginBox.width,y:o.marginBox.height},d={descriptor:e,placeholder:l,displaceBy:c,client:o,page:i};return d}function zat(e){var t=gF("draggable"),r=e.descriptor,n=e.registry,s=e.getDraggableRef,o=e.canDragInteractiveElements,i=e.shouldRespectForcePress,l=e.isEnabled,c=js(function(){return{canDragInteractiveElements:o,shouldRespectForcePress:i,isEnabled:l}},[o,l,i]),d=xa(function(m){var x=s();return x||Tn(!1),qat(r,x,m)},[r,s]),u=js(function(){return{uniqueId:t,descriptor:r,options:c,getDimension:d}},[r,d,c,t]),f=p.useRef(u),h=p.useRef(!0);xd(function(){return n.draggable.register(f.current),function(){return n.draggable.unregister(f.current)}},[n.draggable]),xd(function(){if(h.current){h.current=!1;return}var m=f.current;f.current=u,n.draggable.update(u,m)},[u,n.draggable])}function Uat(e){e.preventDefault()}function Vat(e){var t=p.useRef(null),r=xa(function(P){t.current=P},[]),n=xa(function(){return t.current},[]),s=iC(MA),o=s.contextId,i=s.dragHandleUsageInstructionsId,l=s.registry,c=iC(vF),d=c.type,u=c.droppableId,f=js(function(){return{id:e.draggableId,index:e.index,type:d,droppableId:u}},[e.draggableId,e.index,d,u]),h=e.children,m=e.draggableId,x=e.isEnabled,g=e.shouldRespectForcePress,y=e.canDragInteractiveElements,v=e.isClone,b=e.mapped,w=e.dropAnimationFinished;if(!v){var _=js(function(){return{descriptor:f,registry:l,getDraggableRef:n,canDragInteractiveElements:y,shouldRespectForcePress:g,isEnabled:x}},[f,l,n,y,g,x]);zat(_)}var j=js(function(){return x?{tabIndex:0,role:"button","aria-describedby":i,"data-rbd-drag-handle-draggable-id":m,"data-rbd-drag-handle-context-id":o,draggable:!1,onDragStart:Uat}:null},[o,i,m,x]),S=xa(function(P){b.type==="DRAGGING"&&b.dropping&&P.propertyName==="transform"&&w()},[w,b]),C=js(function(){var P=Bat(b),F=b.type==="DRAGGING"&&b.dropping?S:null,O={innerRef:r,draggableProps:{"data-rbd-draggable-context-id":o,"data-rbd-draggable-id":m,style:P,onTransitionEnd:F},dragHandleProps:j};return O},[o,j,m,b,S,r]),A=js(function(){return{draggableId:f.id,type:f.type,source:{index:f.index,droppableId:f.droppableId}}},[f.droppableId,f.id,f.index,f.type]);return h(C,b.snapshot,A)}var eoe=function(e,t){return e===t},toe=function(e){var t=e.combine,r=e.destination;return r?r.droppableId:t?t.droppableId:null},Wat=function(t){return t.combine?t.combine.draggableId:null},Hat=function(t){return t.at&&t.at.type==="COMBINE"?t.at.combine.draggableId:null};function Gat(){var e=Ki(function(s,o){return{x:s,y:o}}),t=Ki(function(s,o,i,l,c){return{isDragging:!0,isClone:o,isDropAnimating:!!c,dropAnimation:c,mode:s,draggingOver:i,combineWith:l,combineTargetFor:null}}),r=Ki(function(s,o,i,l,c,d,u){return{mapped:{type:"DRAGGING",dropping:null,draggingOver:c,combineWith:d,mode:o,offset:s,dimension:i,forceShouldAnimate:u,snapshot:t(o,l,c,d,null)}}}),n=function(o,i){if(o.isDragging){if(o.critical.draggable.id!==i.draggableId)return null;var l=o.current.client.offset,c=o.dimensions.draggables[i.draggableId],d=gd(o.impact),u=Hat(o.impact),f=o.forceShouldAnimate;return r(e(l.x,l.y),o.movementMode,c,i.isClone,d,u,f)}if(o.phase==="DROP_ANIMATING"){var h=o.completed;if(h.result.draggableId!==i.draggableId)return null;var m=i.isClone,x=o.dimensions.draggables[i.draggableId],g=h.result,y=g.mode,v=toe(g),b=Wat(g),w=o.dropDuration,_={duration:w,curve:cF.drop,moveTo:o.newHomeClientOffset,opacity:b?F1.opacity.drop:null,scale:b?F1.scale.drop:null};return{mapped:{type:"DRAGGING",offset:o.newHomeClientOffset,dimension:x,dropping:_,draggingOver:v,combineWith:b,mode:y,forceShouldAnimate:null,snapshot:t(y,m,v,b,_)}}}return null};return n}function roe(e){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}var Kat={mapped:{type:"SECONDARY",offset:Xi,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:roe(null)}};function Xat(){var e=Ki(function(i,l){return{x:i,y:l}}),t=Ki(roe),r=Ki(function(i,l,c){return l===void 0&&(l=null),{mapped:{type:"SECONDARY",offset:i,combineTargetFor:l,shouldAnimateDisplacement:c,snapshot:t(l)}}}),n=function(l){return l?r(Xi,l,!0):null},s=function(l,c,d,u){var f=d.displaced.visible[l],h=!!(u.inVirtualList&&u.effected[l]),m=IA(d),x=m&&m.draggableId===l?c:null;if(!f){if(!h)return n(x);if(d.displaced.invisible[l])return null;var g=xy(u.displacedBy.point),y=e(g.x,g.y);return r(y,x,!0)}if(h)return n(x);var v=d.displacedBy.point,b=e(v.x,v.y);return r(b,x,f.shouldAnimate)},o=function(l,c){if(l.isDragging)return l.critical.draggable.id===c.draggableId?null:s(c.draggableId,l.critical.draggable.id,l.impact,l.afterCritical);if(l.phase==="DROP_ANIMATING"){var d=l.completed;return d.result.draggableId===c.draggableId?null:s(c.draggableId,d.result.draggableId,d.impact,d.afterCritical)}return null};return o}var Yat=function(){var t=Gat(),r=Xat(),n=function(o,i){return t(o,i)||r(o,i)||Kat};return n},Jat={dropAnimationFinished:Mse},Qat=sse(Yat,Jat,null,{context:pF,pure:!0,areStatePropsEqual:eoe})(Vat);function noe(e){var t=iC(vF),r=t.isUsingCloneFor;return r===e.draggableId&&!e.isClone?null:Ee.createElement(Qat,e)}function Zat(e){var t=typeof e.isDragDisabled=="boolean"?!e.isDragDisabled:!0,r=!!e.disableInteractiveElementBlocking,n=!!e.shouldRespectForcePress;return Ee.createElement(noe,Sa({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:r,shouldRespectForcePress:n}))}function est(e){var t=p.useContext(MA);t||Tn(!1);var r=t.contextId,n=t.isMovementAllowed,s=p.useRef(null),o=p.useRef(null),i=e.children,l=e.droppableId,c=e.type,d=e.mode,u=e.direction,f=e.ignoreContainerClipping,h=e.isDropDisabled,m=e.isCombineEnabled,x=e.snapshot,g=e.useClone,y=e.updateViewportMaxScroll,v=e.getContainerForClone,b=xa(function(){return s.current},[]),w=xa(function(O){s.current=O},[]);xa(function(){return o.current},[]);var _=xa(function(O){o.current=O},[]),j=xa(function(){n()&&y({maxScroll:Bse()})},[n,y]);Eat({droppableId:l,type:c,mode:d,direction:u,isDropDisabled:h,isCombineEnabled:m,ignoreContainerClipping:f,getDroppableRef:b});var S=Ee.createElement(Dat,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},function(O){var I=O.onClose,T=O.data,k=O.animate;return Ee.createElement(Tat,{placeholder:T,onClose:I,innerRef:_,animate:k,contextId:r,onTransitionEnd:j})}),C=js(function(){return{innerRef:w,placeholder:S,droppableProps:{"data-rbd-droppable-id":l,"data-rbd-droppable-context-id":r}}},[r,l,S,w]),A=g?g.dragging.draggableId:null,P=js(function(){return{droppableId:l,type:c,isUsingCloneFor:A}},[l,A,c]);function F(){if(!g)return null;var O=g.dragging,I=g.render,T=Ee.createElement(noe,{draggableId:O.draggableId,index:O.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},function(k,B){return I(k,B,O)});return U4.createPortal(T,v())}return Ee.createElement(vF.Provider,{value:P},i(C,x),F())}var Ak=function(t,r){return t===r.droppable.type},dV=function(t,r){return r.draggables[t.draggable.id]},tst=function(){var t={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},r=Sa({},t,{shouldAnimatePlaceholder:!1}),n=Ki(function(i){return{draggableId:i.id,type:i.type,source:{index:i.index,droppableId:i.droppableId}}}),s=Ki(function(i,l,c,d,u,f){var h=u.descriptor.id,m=u.descriptor.droppableId===i;if(m){var x=f?{render:f,dragging:n(u.descriptor)}:null,g={isDraggingOver:c,draggingOverWith:c?h:null,draggingFromThisWith:h,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!1,snapshot:g,useClone:x}}if(!l)return r;if(!d)return t;var y={isDraggingOver:c,draggingOverWith:h,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!0,snapshot:y,useClone:null}}),o=function(l,c){var d=c.droppableId,u=c.type,f=!c.isDropDisabled,h=c.renderClone;if(l.isDragging){var m=l.critical;if(!Ak(u,m))return r;var x=dV(m,l.dimensions),g=gd(l.impact)===d;return s(d,f,g,g,x,h)}if(l.phase==="DROP_ANIMATING"){var y=l.completed;if(!Ak(u,y.critical))return r;var v=dV(y.critical,l.dimensions);return s(d,f,toe(y.result)===d,gd(y.impact)===d,v,h)}if(l.phase==="IDLE"&&l.completed&&!l.shouldFlush){var b=l.completed;if(!Ak(u,b.critical))return r;var w=gd(b.impact)===d,_=!!(b.impact.at&&b.impact.at.type==="COMBINE"),j=b.critical.droppable.id===d;return w?_?t:r:j?t:r}return r};return o},rst={updateViewportMaxScroll:drt};function nst(){return document.body||Tn(!1),document.body}var ast={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:nst},aoe=sse(tst,rst,null,{context:pF,pure:!0,areStatePropsEqual:eoe})(est);aoe.defaultProps=ast;function Gx({className:e,...t}){return a.jsx("div",{className:Sr("animate-pulse rounded-md bg-muted/20",e),...t})}function FA(e){return{id:e.id,code:e.codigo_produto??"",name:e.nome,category:e.categoria??"",type:e.tipo_produto==="uso_interno"?"Uso Interno":"Venda",cost:Number(e.valor_custo??e.preco_custo??0),price:Number(e.valor_venda??e.preco_venda??0),stock:Number(e.estoque??e.estoque_atual??0),minStock:Number(e.estoque_minimo??0),status:e.status??(e.ativo===!1||Number(e.estoque??0)===0?"inactive":Number(e.estoque??0)>0&&Number(e.estoque??0)<=Number(e.estoque_minimo??0)?"low_stock":"active"),validade:e.validade?new Date(e.validade):null,barcode:e.codigo_barras??"",barcodeBox:e.codigo_barras_caixa??"",reference:e.referencia??"",brand:e.marca??"",group:e.grupo??"",unit:e.unidade??"UN",initialStock:Number(e.estoque_inicial??0),currentStock:Number(e.estoque_atual??e.estoque??0),weight:e.peso!=null?Number(e.peso):null,buyPrice:e.preco_compra!=null?Number(e.preco_compra):null,costsPercent:e.custos_percent!=null?Number(e.custos_percent):null,costPrice:e.preco_custo!=null?Number(e.preco_custo):null,marginPercent:e.lucro_percent!=null?Number(e.lucro_percent):null,salePrice:e.preco_venda!=null?Number(e.preco_venda):null,wholesaleQty:e.qtd_atacado!=null?Number(e.qtd_atacado):null,wholesalePrice:e.preco_atacado!=null?Number(e.preco_atacado):null,commissionPercent:e.comissao_percent!=null?Number(e.comissao_percent):null,discountPercent:e.desconto_percent!=null?Number(e.desconto_percent):null,cfopInterno:e.cfop_interno??"",cstIcmsInterno:e.cst_icms_interno??"",csosnInterno:e.csosn_interno??"",aliqIcmsInterno:e.aliquota_icms_interno!=null?Number(e.aliquota_icms_interno):null,cfopExterno:e.cfop_externo??"",cstIcmsExterno:e.cst_icms_externo??"",csosnExterno:e.csosn_externo??"",aliqIcmsExterno:e.aliquota_icms_externo!=null?Number(e.aliquota_icms_externo):null,cstPisEntrada:e.cst_pis_entrada??"",cstPisSaida:e.cst_pis_saida??"",aliqPisPercent:e.aliquota_pis_percent!=null?Number(e.aliquota_pis_percent):null,aliqCofinsPercent:e.aliquota_cofins_percent!=null?Number(e.aliquota_cofins_percent):null,cstIpi:e.cst_ipi??"",aliqIpiPercent:e.aliquota_ipi_percent!=null?Number(e.aliquota_ipi_percent):null,fcpPercent:e.fcp_percent!=null?Number(e.fcp_percent):null,mvaPercent:e.mva_percent!=null?Number(e.mva_percent):null,baseReduzidaPercent:e.base_reduzida_percent!=null?Number(e.base_reduzida_percent):null,ncm:e.ncm??"",ncmDescription:e.descricao_ncm??"",cest:e.cest??"",active:e.ativo??!0,allowSale:e.permite_venda??!0,payCommission:e.paga_comissao??!1,variablePrice:e.preco_variavel??!1,composition:e.composicao??!1,service:e.servico??!1,hasGrid:e.grade??!1,usePriceTable:e.usar_tabela_preco??!1,fuel:e.combustivel??!1,useImei:e.usa_imei??!1,stockByGrid:e.controle_estoque_por_grade??!1,showInApp:e.mostrar_no_app??!1,dataImportacao:e.data_importacao?new Date(e.data_importacao):null,importadoViaXml:e.importado_via_xml??!1}}async function sst({from:e,to:t,codigoEmpresa:r,limit:n=1e3}={}){if(!e||!t)throw new Error("Perodo invlido");const s=(e instanceof Date?e:new Date(e)).toISOString(),o=(t instanceof Date?t:new Date(t)).toISOString(),{data:i,error:l}=await bi(x=>{let g=re.from("comanda_itens").select("produto_id, quantidade, created_at").gte("created_at",s).lte("created_at",o).limit(n).abortSignal(x);return r&&(g=g.eq("codigo_empresa",r)),g},2e4,"Timeout getSoldProductsByPeriod (20s)");if(l)throw l;const c=new Map;for(const x of i||[]){const g=x.produto_id,y=Number(x.quantidade||0);c.set(g,(c.get(g)||0)+y)}const d=Array.from(c.entries()).sort((x,g)=>g[1]-x[1]);if(d.length===0)return[];const u=d.map(([x])=>x),{data:f,error:h}=await bi(x=>{let g=re.from("produtos").select("id, nome").in("id",u).abortSignal(x);return r&&(g=g.eq("codigo_empresa",r)),g},15e3,"Timeout getSoldProductsByPeriod:produtos (15s)");if(h)throw h;const m=new Map((f||[]).map(x=>[x.id,x.nome]));return d.map(([x,g])=>({id:x,name:m.get(x)||String(x),total:g}))}async function Uv({productId:e,delta:t,codigoEmpresa:r}){const n=Number(t);if(!e||!Number.isFinite(n)||n===0)throw new Error("Parmetros invlidos para ajuste de estoque");const{data:s,error:o}=await bi(d=>{let u=re.from("produtos").select("id, estoque, estoque_atual").eq("id",e).single().abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},1e4,"Timeout get current stock (10s)");if(o)throw o;const l=Number(s?.estoque??s?.estoque_atual??0)+n,{error:c}=await bi(d=>{let u=re.from("produtos").update({estoque:l,estoque_atual:l}).eq("id",e).abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},1e4,"Timeout update stock (10s)");if(c)throw c;return{id:e,stock:l}}async function ost({limit:e=5,codigoEmpresa:t}={}){const r=new Date;r.setHours(0,0,0,0);const n=r.toISOString(),{data:s,error:o}=await bi(h=>{let m=re.from("comanda_itens").select("produto_id, quantidade, created_at").gte("created_at",n).abortSignal(h);return t&&(m=m.eq("codigo_empresa",t)),m},15e3,"Timeout getMostSoldProductsToday (15s)");if(o)throw o;const i=new Map;for(const h of s||[]){const m=h.produto_id,x=Number(h.quantidade||0);i.set(m,(i.get(m)||0)+x)}const l=Array.from(i.entries()).sort((h,m)=>m[1]-h[1]).slice(0,e);if(l.length===0)return[];const c=l.map(([h])=>h),{data:d,error:u}=await bi(h=>{let m=re.from("produtos").select("id, nome").in("id",c).abortSignal(h);return t&&(m=m.eq("codigo_empresa",t)),m},15e3,"Timeout getMostSoldProductsToday:produtos (15s)");if(u)throw u;const f=new Map((d||[]).map(h=>[h.id,h.nome]));return l.map(([h,m])=>({id:h,name:f.get(h)||String(h),total:m}))}async function uV({codigoEmpresa:e}={}){if(!e)throw new Error("codigoEmpresa  obrigatrio");const{data:t,error:r}=await bi(l=>re.from("produtos").select("codigo_produto").eq("codigo_empresa",e).order("codigo_produto",{ascending:!0}).abortSignal(l),15e3,"Timeout getNextProductCode (15s)");if(r)throw r;const n=new Set;for(const l of t||[]){const c=(l.codigo_produto||"").trim();if(/^\d+$/.test(c)){const d=parseInt(c,10);Number.isFinite(d)&&d>0&&n.add(d)}}let s=1;const o=(n.size||0)+1e3;let i=0;for(;n.has(s)&&i<o;)s+=1,i+=1;return(!Number.isFinite(s)||s<=0)&&(s=1),String(s).padStart(4,"0")}function soe(e){return{codigo_produto:e.code||null,nome:e.name,categoria:e.category||null,tipo_produto:e.type==="Uso Interno"?"uso_interno":"venda",valor_custo:e.cost!=null?Number(e.cost):0,valor_venda:e.price!=null?Number(e.price):0,estoque:e.stock!=null?Number(e.stock):0,estoque_minimo:e.minStock!=null?Number(e.minStock):0,status:e.status||null,validade:e.validade?new Date(e.validade).toISOString().slice(0,10):null,codigo_barras:e.barcode||null,codigo_barras_caixa:e.barcodeBox||null,referencia:e.reference||null,marca:e.brand||null,grupo:e.group||null,unidade:e.unit||null,estoque_inicial:e.initialStock!=null?Number(e.initialStock):null,estoque_atual:e.currentStock!=null?Number(e.currentStock):null,peso:e.weight!=null?Number(e.weight):null,preco_compra:e.buyPrice!=null?Number(e.buyPrice):null,custos_percent:e.costsPercent!=null?Number(e.costsPercent):null,preco_custo:e.costPrice!=null?Number(e.costPrice):null,lucro_percent:e.marginPercent!=null?Number(e.marginPercent):null,preco_venda:e.salePrice!=null?Number(e.salePrice):null,qtd_atacado:e.wholesaleQty!=null?Number(e.wholesaleQty):null,preco_atacado:e.wholesalePrice!=null?Number(e.wholesalePrice):null,comissao_percent:e.commissionPercent!=null?Number(e.commissionPercent):null,desconto_percent:e.discountPercent!=null?Number(e.discountPercent):null,cfop_interno:e.cfopInterno||null,cst_icms_interno:e.cstIcmsInterno||null,csosn_interno:e.csosnInterno||null,aliquota_icms_interno:e.aliqIcmsInterno!=null?Number(e.aliqIcmsInterno):null,cfop_externo:e.cfopExterno||null,cst_icms_externo:e.cstIcmsExterno||null,csosn_externo:e.csosnExterno||null,aliquota_icms_externo:e.aliqIcmsExterno!=null?Number(e.aliqIcmsExterno):null,cst_pis_entrada:e.cstPisEntrada||null,cst_pis_saida:e.cstPisSaida||null,aliquota_pis_percent:e.aliqPisPercent!=null?Number(e.aliqPisPercent):null,aliquota_cofins_percent:e.aliqCofinsPercent!=null?Number(e.aliqCofinsPercent):null,cst_ipi:e.cstIpi||null,aliquota_ipi_percent:e.aliqIpiPercent!=null?Number(e.aliqIpiPercent):null,fcp_percent:e.fcpPercent!=null?Number(e.fcpPercent):null,mva_percent:e.mvaPercent!=null?Number(e.mvaPercent):null,base_reduzida_percent:e.baseReduzidaPercent!=null?Number(e.baseReduzidaPercent):null,ncm:e.ncm||null,descricao_ncm:e.ncmDescription||null,cest:e.cest||null,ativo:e.active!=null?!!e.active:!0,permite_venda:e.allowSale!=null?!!e.allowSale:!0,paga_comissao:e.payCommission!=null?!!e.payCommission:!1,preco_variavel:e.variablePrice!=null?!!e.variablePrice:!1,composicao:e.composition!=null?!!e.composition:!1,servico:e.service!=null?!!e.service:!1,grade:e.hasGrid!=null?!!e.hasGrid:!1,usar_tabela_preco:e.usePriceTable!=null?!!e.usePriceTable:!1,combustivel:e.fuel!=null?!!e.fuel:!1,usa_imei:e.useImei!=null?!!e.useImei:!1,controle_estoque_por_grade:e.stockByGrid!=null?!!e.stockByGrid:!1,mostrar_no_app:e.showInApp!=null?!!e.showInApp:!1,importado_via_xml:e.importedViaXML===!0,data_importacao:e.dataImportacao?e.dataImportacao instanceof Date?e.dataImportacao.toISOString():new Date(e.dataImportacao).toISOString():null,xml_chave:e.xmlChave||null,xml_numero:e.xmlNumero||null,xml_serie:e.xmlSerie||null,xml_emissao:e.xmlEmissao?new Date(e.xmlEmissao).toISOString():null}}async function Hu(e={}){const{includeInactive:t=!1,search:r="",codigoEmpresa:n}=e;console.log("[products.api] ====== listProducts INICIO ======"),console.log("[products.api] Parametros:",{includeInactive:t,search:r,codigoEmpresa:n});const{data:s,error:o}=await bi(c=>{let d=re.from("produtos").select("*").eq("codigo_empresa",n).order("nome",{ascending:!0}).abortSignal(c);if(t||(d=d.neq("status","inactive"),d=d.or("ativo.is.null,ativo.eq.true"),console.log("[products.api] Filtro aplicado: status != inactive AND (ativo IS NULL OR ativo = true)")),r&&r.trim().length>0){const u=r.trim();d=d.or(`nome.ilike.%${u}%,codigo_produto.ilike.%${u}%`)}return d},15e3,"Timeout listProducts (15s)");if(o)throw console.error("[products.api] listProducts:error",o),o;const i=(s||[]).map(FA);console.log("[products.api] listProducts RETORNOU:",i.length,"produtos"),console.log("[products.api] includeInactive:",t),console.log("[products.api] Produtos:",i.map(c=>({id:c.id,name:c.name,code:c.code})));const l=i.filter(c=>!c.code||c.code.trim()==="");return console.log("[products.api] Produtos SEM cdigo:",l.length),l.length>0&&l.forEach(c=>{console.log("  -",c.name,"| active:",c.active,"| status:",c.status,"| code:",c.code||"NULL")}),i}async function ist(e={}){const{includeInactive:t=!1,search:r="",codigoEmpresa:n,page:s=1,pageSize:o=100}=e;if(!n)return{data:[],count:0};const i=s>0?s:1,l=o>0?o:100,c=(i-1)*l,d=c+l-1;console.log("[products.api] ====== listProductsPaged INICIO ======",{includeInactive:t,search:r,codigoEmpresa:n,page:i,pageSize:l});try{const{data:u,error:f,count:h}=await bi(x=>{let g=re.from("produtos").select("*",{count:"exact"}).eq("codigo_empresa",n).order("nome",{ascending:!0}).range(c,d).abortSignal(x);if(t||(g=g.neq("status","inactive"),g=g.or("ativo.is.null,ativo.eq.true")),r&&r.trim().length>0){const y=r.trim();g=g.or(`nome.ilike.%${y}%,codigo_produto.ilike.%${y}%`)}return g},2e4,"Timeout listProductsPaged (20s)");if(f)throw console.error("[products.api] listProductsPaged:error",f),f;const m=(u||[]).map(FA);return console.log("[products.api] listProductsPaged RETORNOU:",m.length,"produtos de",h||0),{data:m,count:h||0}}catch(u){return console.error("[products.api] listProductsPaged:exception",u),{data:[],count:0}}}async function lC(e,t={}){const{codigoEmpresa:r}=t,n=soe(e);r&&(n.codigo_empresa=r),console.info("[products.api] createProduct: payload",n);const s=async()=>bi(d=>re.from("produtos").insert(n).select("*").single().abortSignal(d),15e3,"Timeout createProduct (15s)"),o=d=>{if(!d)return!1;if(d.code&&String(d.code)==="23505")return!0;const u=[d.message,d.details,d.hint].filter(Boolean).join(" ").toLowerCase();return u.includes("duplicate key")||u.includes("unique constraint")||u.includes("ux_produtos_empresa_codigo_produto")||u.includes("codigo_produto")};let i,l;if({data:i,error:l}=await s(),l&&o(l)&&n.codigo_produto){console.warn("[products.api] createProduct: duplicate code, trying to free code from inactive product");const{data:d,error:u}=await bi(h=>re.from("produtos").select("id,status").eq("codigo_produto",n.codigo_produto).eq("status","inactive").limit(1).abortSignal(h),15e3,"Timeout find duplicate product (15s)"),f=Array.isArray(d)&&d.length>0?d[0]:null;if(!u&&f&&f.status==="inactive"){const{error:h}=await bi(m=>re.from("produtos").update({codigo_produto:null}).eq("id",f.id).abortSignal(m),15e3,"Timeout clear duplicate code (15s)");h||({data:i,error:l}=await s())}else{const h=n.codigo_produto;n.codigo_produto=null,console.warn("[products.api] createProduct: no inactive found for duplicate code, retrying with codigo_produto = null (original:",h,")"),{data:i,error:l}=await s()}}if(l)throw console.error("[products.api] createProduct:error",l),l;const c=FA(i);return console.info("[products.api] createProduct: ok",c),c}async function L1(e,t,r={}){const n=soe(t);n.data_importacao=null,console.info("[products.api] updateProduct: id",e,"payload",n);const{data:s,error:o}=await bi(l=>re.from("produtos").update(n).eq("id",e).select("*").single().abortSignal(l),15e3,"Timeout updateProduct (15s)");if(o)throw console.error("[products.api] updateProduct:error",o),o;const i=FA(s);return console.info("[products.api] updateProduct: ok",i),i}async function bi(e,t,r){const n=new AbortController,s=setTimeout(()=>n.abort(new Error(r)),t);try{return await e(n.signal)}catch(o){throw o?.name==="AbortError"?new Error(r):o}finally{clearTimeout(s)}}async function yF(e){console.info("[products.api] deleteProduct (soft): id",e);const{error:t}=await bi(r=>re.from("produtos").update({status:"inactive",codigo_produto:null}).eq("id",e).abortSignal(r),15e3,"Timeout deleteProduct (15s)");if(t)throw console.error("[products.api] deleteProduct:error",t),t;return console.info("[products.api] deleteProduct: ok (inativado)"),!0}async function lst({ids:e,status:t}){const r=Array.isArray(e)?e.filter(Boolean):[];if(!r.length)throw new Error("Nenhum produto selecionado para atualizao em massa");if(!["active","inactive","low_stock"].includes(t))throw new Error("Status invlido para atualizao em massa");const n=t!=="inactive";console.info("[products.api] bulkUpdateProductStatus:start",{count:r.length,status:t});const{error:s}=await bi(o=>re.from("produtos").update({status:t,ativo:n}).in("id",r).abortSignal(o),2e4,"Timeout bulkUpdateProductStatus (20s)");if(s)throw console.error("[products.api] bulkUpdateProductStatus:error",s),s;return console.info("[products.api] bulkUpdateProductStatus:ok",{count:r.length,status:t}),!0}async function cst({ids:e}){const t=Array.isArray(e)?e.filter(Boolean):[];if(!t.length)throw new Error("Nenhum produto selecionado para limpar flag de novo");console.info("[products.api] bulkClearNewFlag:start",{count:t.length});const{error:r}=await bi(n=>re.from("produtos").update({data_importacao:null}).in("id",t).abortSignal(n),2e4,"Timeout bulkClearNewFlag (20s)");if(r)throw console.error("[products.api] bulkClearNewFlag:error",r),r;return console.info("[products.api] bulkClearNewFlag:ok",{count:t.length}),!0}async function fV(e={}){const{codigoEmpresa:t}=e;console.info("[products.api] listCategories: start");const{data:r,error:n}=await bi(i=>{let l=re.from("produto_categorias").select("nome").eq("ativa",!0).order("nome",{ascending:!0}).abortSignal(i);return t&&(l=l.eq("codigo_empresa",t)),l},15e3,"Timeout listCategories (15s)");if(n)throw console.error("[products.api] listCategories:error",n),n;const s=[],o=new Set;for(const i of r||[]){const l=(i?.nome||"").trim();if(!l)continue;const c=l.toLowerCase();o.has(c)||(o.add(c),s.push(l))}return console.info("[products.api] listCategories: ok",{count:s.length}),s}async function dst(e,t={}){const{codigoEmpresa:r}=t,n=String(e||"").trim();if(!n)throw new Error("Nome da categoria invlido");console.info("[products.api] createCategory:",n);const s={nome:n};r&&(s.codigo_empresa=r);const{data:o,error:i}=await bi(l=>re.from("produto_categorias").insert(s).select("nome").single().abortSignal(l),15e3,"Timeout createCategory (15s)");if(i)throw console.error("[products.api] createCategory:error",i),i;return o?.nome||n}async function ust(e,t={}){const{codigoEmpresa:r}=t,n=String(e||"").trim();if(!n)throw new Error("Nome da categoria invlido");console.info("[products.api] removeCategory:",n);const{count:s,error:o}=await bi(d=>{let u=re.from("produtos").select("id",{count:"exact",head:!0}).eq("categoria",n).neq("status","inactive").abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},15e3,"Timeout removeCategory:count (15s)");if(o)throw console.error("[products.api] removeCategory:count:error",o),o;if((s??0)>0){const d=new Error("Categoria possui produtos ativos vinculados");throw console.warn("[products.api] removeCategory: blocked by active products",{nome:n,prodCount:s}),d}const{data:i,error:l}=await bi(d=>{let u=re.from("produto_categorias").update({ativa:!1}).eq("nome",n).select("nome").abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},15e3,"Timeout removeCategory (15s)");if(l)throw console.error("[products.api] removeCategory:error",l),l;if((Array.isArray(i)?i.length:0)===0){const d=new Error("Categoria no encontrada para desativar");throw console.warn("[products.api] removeCategory: no rows affected",{nome:n}),d}return!0}function fst({item:e,onApply:t,onClose:r,codigoEmpresa:n}){const{toast:s}=Ss(),[o,i]=p.useState(e?.desconto_tipo||"percentual"),[l,c]=p.useState(e?.desconto_valor||0),[d,u]=p.useState(e?.desconto_motivo||""),[f,h]=p.useState(!1);if(!e)return null;const m=Number(e.price||e.preco_unitario||0),x=Number(e.quantity||e.quantidade||1),g=m*x,y=o==="percentual"?g*(1-l/100):g-l,v=async()=>{try{if(h(!0),l<0){s({title:"Erro",description:"Desconto no pode ser negativo",variant:"destructive"});return}if(o==="percentual"&&l>100){s({title:"Erro",description:"Desconto percentual no pode ser maior que 100%",variant:"destructive"});return}console.log("Aplicando desconto:",{itemId:e.id,desconto_tipo:o,desconto_valor:Number(l),desconto_motivo:d||null,codigoEmpresa:n});const w=await gKe({itemId:e.id,desconto_tipo:o,desconto_valor:Number(l),desconto_motivo:d||null,codigoEmpresa:n});console.log("Resultado:",w),s({title:"Sucesso",description:"Desconto aplicado!",variant:"success"}),t(),r()}catch(w){console.error("Erro ao aplicar desconto:",w),s({title:"Erro",description:w.message||"Falha ao aplicar desconto",variant:"destructive"})}finally{h(!1)}},b=async()=>{try{h(!0),await vKe({itemId:e.id,codigoEmpresa:n}),s({title:"Sucesso",description:"Desconto removido!",variant:"success"}),t(),r()}catch(w){console.error("Erro ao remover desconto:",w),s({title:"Erro",description:w.message||"Falha ao remover desconto",variant:"destructive"})}finally{h(!1)}};return a.jsx(In,{open:!0,onOpenChange:r,children:a.jsxs(En,{overlayClassName:"z-[90]",className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[91]",children:[a.jsx(Cn,{children:a.jsxs(Nn,{className:"text-lg font-bold",children:["Desconto - ",e.name]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(it,{className:"text-sm font-semibold mb-2 block",children:"Tipo de Desconto"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{variant:o==="percentual"?"default":"outline",onClick:()=>i("percentual"),disabled:f,className:"flex-1",children:"Percentual (%)"}),a.jsx(se,{variant:o==="fixo"?"default":"outline",onClick:()=>i("fixo"),disabled:f,className:"flex-1",children:"Fixo (R$)"})]})]}),a.jsxs("div",{children:[a.jsxs(it,{htmlFor:"desconto-valor",className:"text-sm font-semibold",children:["Valor ",o==="percentual"?"(%)":"(R$)"]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx(Ct,{id:"desconto-valor",type:"text",value:o==="percentual"?l===0?"":l:l===0?"":`R$ ${l.toFixed(2)}`,onChange:w=>{let _=w.target.value.trim();if(_===""){c(0);return}o==="fixo"&&(_=_.replace(/[^\d.,]/g,"").replace(",","."));let j=Number(_);isNaN(j)&&(j=0),o==="percentual"&&j>100&&(j=100),j<0&&(j=0),c(j)},placeholder:o==="percentual"?"0":"0,00",disabled:f,className:"mt-1"}),o==="percentual"&&a.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary font-semibold",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"desconto-motivo",className:"text-sm font-semibold",children:"Motivo"}),a.jsxs("select",{id:"desconto-motivo",value:d,onChange:w=>u(w.target.value),className:"w-full border border-border rounded-md p-2 mt-1 text-sm bg-background",disabled:f,children:[a.jsx("option",{value:"",children:"Selecione um motivo..."}),a.jsx("option",{value:"Promoo",children:"Promoo"}),a.jsx("option",{value:"Meia entrada",children:"Meia entrada"}),a.jsx("option",{value:"Cortesia",children:"Cortesia"}),a.jsx("option",{value:"Ajuste",children:"Ajuste"}),a.jsx("option",{value:"Outro",children:"Outro"})]})]}),a.jsxs("div",{className:"bg-surface-2 p-4 rounded-lg space-y-2 border border-border",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:"Preo Original:"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",g.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm text-destructive font-semibold",children:[a.jsx("span",{children:"Desconto:"}),a.jsxs("span",{children:["-R$ ",(g-y).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-base font-bold border-t border-border pt-2",children:[a.jsx("span",{children:"Total do Item:"}),a.jsxs("span",{className:"text-brand",children:["R$ ",Math.max(0,y).toFixed(2)]})]})]}),d&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded",children:[a.jsx("strong",{children:"Motivo:"})," ",d]})]}),a.jsxs(Na,{className:"flex gap-2",children:[a.jsx(se,{variant:"outline",onClick:r,disabled:f,children:"Cancelar"}),e.desconto_valor>0&&a.jsxs(se,{variant:"destructive",onClick:b,disabled:f,size:"sm",className:"gap-2",children:[a.jsx(Sf,{className:"w-4 h-4"}),"Remover"]}),a.jsx(se,{onClick:v,disabled:f,className:"gap-2",children:f?"Aplicando...":"Aplicar Desconto"})]})]})})}function mst({comanda:e,subtotal:t,onApply:r,onClose:n,codigoEmpresa:s}){const{toast:o}=Ss(),[i,l]=p.useState(e?.desconto_tipo||"percentual"),[c,d]=p.useState(e?.desconto_valor||0),[u,f]=p.useState(e?.desconto_motivo||""),[h,m]=p.useState(!1);if(!e)return null;const x=i==="percentual"?t*c/100:c,g=Math.max(0,t-x),y=async()=>{try{if(m(!0),c<0){o({title:"Erro",description:"Desconto no pode ser negativo",variant:"destructive"});return}if(i==="percentual"&&c>100){o({title:"Erro",description:"Desconto percentual no pode ser maior que 100%",variant:"destructive"});return}if(x>t){o({title:"Erro",description:"Desconto no pode ser maior que o subtotal",variant:"destructive"});return}console.log("Aplicando desconto comanda:",{comandaId:e.id,desconto_tipo:i,desconto_valor:Number(c),desconto_motivo:u||null,codigoEmpresa:s});const b=await xKe({comandaId:e.id,desconto_tipo:i,desconto_valor:Number(c),desconto_motivo:u||null,codigoEmpresa:s});console.log("Resultado comanda:",b),o({title:"Sucesso",description:"Desconto aplicado na comanda!",variant:"success"}),r(),n()}catch(b){console.error("Erro ao aplicar desconto:",b),o({title:"Erro",description:b.message||"Falha ao aplicar desconto",variant:"destructive"})}finally{m(!1)}},v=async()=>{try{m(!0),await yKe({comandaId:e.id,codigoEmpresa:s}),o({title:"Sucesso",description:"Desconto removido!",variant:"success"}),r(),n()}catch(b){console.error("Erro ao remover desconto:",b),o({title:"Erro",description:b.message||"Falha ao remover desconto",variant:"destructive"})}finally{m(!1)}};return a.jsx(In,{open:!0,onOpenChange:n,children:a.jsxs(En,{className:"sm:max-w-[420px]",children:[a.jsx(Cn,{children:a.jsx(Nn,{className:"text-lg font-bold",children:"Desconto da Comanda"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(it,{className:"text-sm font-semibold mb-2 block",children:"Tipo de Desconto"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{variant:i==="percentual"?"default":"outline",onClick:()=>l("percentual"),disabled:h,className:"flex-1",children:"Percentual (%)"}),a.jsx(se,{variant:i==="fixo"?"default":"outline",onClick:()=>l("fixo"),disabled:h,className:"flex-1",children:"Fixo (R$)"})]})]}),a.jsxs("div",{children:[a.jsxs(it,{htmlFor:"desconto-valor",className:"text-sm font-semibold",children:["Valor ",i==="percentual"?"(%)":"(R$)"]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx(Ct,{id:"desconto-valor",type:"text",name:"desconto-valor",autoComplete:"off",autoCorrect:"off",spellCheck:!1,value:i==="percentual"?c===0?"":c:c===0?"":`R$ ${c.toFixed(2)}`,onChange:b=>{let w=b.target.value.trim();if(w===""){d(0);return}i==="fixo"&&(w=w.replace(/[^\d.,]/g,"").replace(",","."));let _=Number(w);isNaN(_)&&(_=0),i==="percentual"&&_>100&&(_=100),_<0&&(_=0),d(_)},placeholder:i==="percentual"?"0":"0,00",disabled:h,className:"mt-1"}),i==="percentual"&&a.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary font-semibold",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"desconto-motivo",className:"text-sm font-semibold",children:"Motivo"}),a.jsxs("select",{id:"desconto-motivo",value:u,onChange:b=>f(b.target.value),className:"w-full border border-border rounded-md p-2 mt-1 text-sm bg-background",disabled:h,children:[a.jsx("option",{value:"",children:"Selecione um motivo..."}),a.jsx("option",{value:"Promoo",children:"Promoo"}),a.jsx("option",{value:"Cortesia",children:"Cortesia"}),a.jsx("option",{value:"Ajuste",children:"Ajuste"}),a.jsx("option",{value:"Outro",children:"Outro"})]})]}),a.jsxs("div",{className:"bg-surface-2 p-4 rounded-lg space-y-2 border border-border",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:"Subtotal:"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",t.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm text-destructive font-semibold",children:[a.jsx("span",{children:"Desconto:"}),a.jsxs("span",{children:["-R$ ",x.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-base font-bold border-t border-border pt-2",children:[a.jsx("span",{children:"Total da Comanda:"}),a.jsxs("span",{className:"text-brand",children:["R$ ",g.toFixed(2)]})]})]}),u&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded",children:[a.jsx("strong",{children:"Motivo:"})," ",u]})]}),a.jsxs(Na,{className:"flex gap-2",children:[a.jsx(se,{variant:"outline",onClick:n,disabled:h,children:"Cancelar"}),e.desconto_valor>0&&a.jsxs(se,{variant:"destructive",onClick:v,disabled:h,size:"sm",className:"gap-2",children:[a.jsx(Sf,{className:"w-4 h-4"}),"Remover"]}),a.jsx(se,{onClick:y,disabled:h,className:"gap-2",children:h?"Aplicando...":"Aplicar Desconto"})]})]})})}const hst={available:{label:"Livre",color:"border-success/50 bg-success/10 text-success",icon:vi},"in-use":{label:"Em Uso",color:"border-warning/50 bg-warning/10 text-warning",icon:eu},"awaiting-payment":{label:"Pagamento",color:"border-info/50 bg-info/10 text-info",icon:Vi}};function pst(){const{toast:e}=Ss(),{userProfile:t,authReady:r}=qs(),n=hl(),[s,o]=p.useState([]),[i,l]=p.useState(null),[c,d]=p.useState(!1),[u,f]=p.useState(0);p.useRef(!1);const[h,m]=p.useState(!1);p.useState([]);const[x,g]=p.useState(!1),[y,v]=p.useState(new Map),[b,w]=p.useState(!1);p.useRef(null),p.useRef(null);const _=p.useRef([]),j=p.useRef(null),[S,C]=p.useState(0),[A,P]=p.useState("tables");p.useRef(null);const[F,O]=p.useState("order");p.useRef(null),p.useRef(null),p.useState(!1);const[I,T]=p.useState(null),[k,B]=p.useState(null),[z,U]=p.useState(!1),[L,W]=p.useState(!1),[ge,Ae]=p.useState(!1),[V,$]=p.useState(null),[Y,he]=p.useState(!1),[J,G]=p.useState([]),[ue,ve]=p.useState(!1),[ae,oe]=p.useState(!1),[me,De]=p.useState(!1),[ne,ie]=p.useState(!1),[ht,pt]=p.useState(!1),[Ze,vt]=p.useState(!1),[wt,gt]=p.useState(!1),[er,_e]=p.useState(!1),[Pt,Lt]=p.useState(null),[gr,fr]=p.useState(""),[je,nt]=p.useState(!1),[$t,Ut]=p.useState(!1),[Fe,xt]=p.useState([]),[Ot,Cr]=p.useState(null),[Me,Qe]=p.useState(null),[et,Yt]=p.useState(!1),xr=p.useRef(""),[Jt,kr]=p.useState(!1),[_r,Rr]=p.useState(!1),[nn,rn]=p.useState("order"),[Ke,qe]=p.useState(!1),[ze,Je]=p.useState(""),[kt,ct]=p.useState(()=>{try{return typeof window<"u"&&window.innerWidth<=640}catch{return!1}}),[tr,dt]=p.useState(null),[Mt,ce]=p.useState(null),[Xe,Qt]=p.useState(!1);p.useEffect(()=>{const de=t?.codigo_empresa;de&&(async()=>{try{if(Array.isArray(Fe)&&Fe.length>0)return;const ke=await Ah({somenteAtivas:!0,codigoEmpresa:de});xt(Array.isArray(ke)?ke:[])}catch{}})()},[t?.codigo_empresa]);const Tt=p.useMemo(()=>{const de=new Map,ke=i?.order||[];for(const st of ke){const ot=String(st.productId);de.set(ot,(de.get(ot)||0)+Number(st.quantity||0))}return de},[i?.order]),Ar=async de=>{try{const ke=i?.order||[],st=ke.find(pr=>String(pr.productId)===String(de.id));if(!st)return;const ot=Number(st.quantity||0)-1;if(String(st.id||"").startsWith("tmp-")){const pr=ot>0?ke.map(Zr=>Zr.id===st.id?{...Zr,quantity:ot}:Zr):ke.filter(Zr=>Zr.id!==st.id),ln=pr.reduce((Zr,Pr)=>Zr+Number(Pr.price||0)*Number(Pr.quantity||0),0),hr={...i,order:pr,totalHint:ln};l(hr),o(Zr=>Zr.map(Pr=>Pr.id===hr.id?{...Pr,totalHint:ln}:Pr)),setTimeout(async()=>{try{const Pr=(await To({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(bn=>({id:bn.id,productId:bn.produto_id,name:bn.descricao||"Item",price:Number(bn.preco_unitario||0),quantity:Number(bn.quantidade||1)})),cr=(Pr||[]).reduce((bn,ca)=>bn+Number(ca.price||0)*Number(ca.quantity||0),0),Mr={...i,order:Pr,totalHint:cr};l(Mr),o(bn=>bn.map(ca=>ca.id===Mr.id?{...ca,totalHint:cr}:ca))}catch{}},300);return}const or=i,Bt=s,vr=ot>0?ke.map(pr=>pr.id===st.id?{...pr,quantity:ot}:pr):ke.filter(pr=>pr.id!==st.id),yr=vr.reduce((pr,ln)=>pr+Number(ln.price||0)*Number(ln.quantity||0),0),It={...i,order:vr,totalHint:yr};l(It),o(pr=>pr.map(ln=>ln.id===It.id?{...ln,totalHint:yr}:ln));try{ot>0?await Fd({itemId:st.id,quantidade:ot,codigoEmpresa:t?.codigo_empresa}):await Sv({itemId:st.id,codigoEmpresa:t?.codigo_empresa})}catch(pr){throw l(or),o(Bt),pr}const Hr=Math.max(ot,0);let Vr=!1;for(let pr=0;pr<3&&!Vr;pr++){const hr=(await To({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Pr=>({id:Pr.id,productId:Pr.produto_id,name:Pr.descricao||"Item",price:Number(Pr.preco_unitario||0),quantity:Number(Pr.quantidade||1)}));if((hr.find(Pr=>String(Pr.productId)===String(de.id))?.quantity||0)===Hr){const Pr=hr.reduce((Mr,bn)=>Mr+Number(bn.price||0)*Number(bn.quantity||0),0),cr={...i,order:hr,totalHint:Pr};l(cr),o(Mr=>Mr.map(bn=>bn.id===cr.id?cr:bn)),Vr=!0;break}await new Promise(Pr=>setTimeout(Pr,180*(pr+1)))}try{const pr=await vh({codigoEmpresa:t?.codigo_empresa}),ln=new Map;for(const hr of pr||[]){const Zr=String(hr.produto_id),Pr=Number(hr.quantidade||0);ln.set(Zr,(ln.get(Zr)||0)+Pr)}v(ln)}catch(pr){console.error("[decProduct] Erro ao atualizar estoque reservado:",pr)}}catch(ke){console.error("[decProduct] Erro:",ke),e({title:"Falha ao alterar quantidade",description:ke?.message||"Tente novamente",variant:"destructive"})}},nr=p.useRef(null),Jr=p.useCallback(()=>{try{const de=nr.current;if(!de)return 1;const st=window.getComputedStyle(de).gridTemplateColumns||"";if(st){const Nt=st.split(" ").filter(Boolean).length;if(Nt>0)return Nt}const ot=de.querySelector("[data-table-id]");if(ot){const Nt=ot.getBoundingClientRect().width,or=de.getBoundingClientRect().width;if(Nt>0)return Math.max(1,Math.floor(or/Nt))}return 1}catch{return 1}},[]),[gn,tt]=p.useState(!1),jr=p.useRef(!1);p.useEffect(()=>{jr.current=je},[je]);const ua=p.useRef(0),Oe=p.useRef(null),Wt=p.useRef(null),Ht=p.useRef(null),mr=p.useRef(null),Gt=p.useRef([]);p.useRef(null);const pn=p.useRef(!1),jt=p.useRef(null),ur=p.useRef(null);wi();const rt=p.useMemo(()=>(s||[]).find(de=>de.status==="available")?.id||null,[s]),Dt=ae||ht||L||x||je||et||h||z||_r||ge||b||!1,Xt=async de=>{try{if(!de)return;if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}if($t)return;if(Ut(!0),l(ke=>!ke||ke.id!==de.id?de:ke),de.status==="available"||!de.comandaId){Lt(de),pt(!0);return}try{await Se(de)}catch{try{const ot=(await To({comandaId:de.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Bt=>({id:Bt.id,productId:Bt.produto_id,name:Bt.descricao||"Item",price:Number(Bt.preco_unitario||0),quantity:Number(Bt.quantidade||1)}));let Nt=null;try{const vr=(await Bi({comandaId:de.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(yr=>yr?.nome).filter(Boolean);Nt=vr.length?vr.join(", "):null}catch{}const or={...de,order:ot,customer:Nt};l(or),o(Bt=>Bt.map(vr=>vr.id===or.id?or:vr))}catch{}}}finally{Ut(!1)}};p.useEffect(()=>{const de=()=>{try{ct(typeof window<"u"&&window.innerWidth<=640)}catch{ct(!1)}};return de(),window.addEventListener("resize",de),()=>window.removeEventListener("resize",de)},[]),p.useEffect(()=>{const de=async ke=>{try{if(b)return;const st=String(ke.target?.tagName||"").toLowerCase();if(["input","textarea","select"].includes(st)||ke.target?.isContentEditable||Dt)return;if(ke.key==="F1"){ke.preventDefault();try{const Nt=(s||[]).filter(or=>or.status==="available");Nt.length>0?(l(Nt[0]),Lt?.(Nt[0])):!i&&Array.isArray(s)&&s.length>0&&(l(s[0]),Lt?.(s[0]))}catch{}pt(!0);return}if(ke.key==="F2"){ke.preventDefault(),i?.comandaId?await pa():e({title:"Nenhuma comanda selecionada",description:"Selecione uma mesa com comanda aberta antes de fechar.",variant:"warning"});return}if(ke.key==="F10"){ke.preventDefault(),c?e({title:"Caixa j est aberto",description:"Use F11 para ver detalhes do caixa.",variant:"info"}):Yt(!0);return}if(ke.key==="F11"){ke.preventDefault(),g(!0);return}if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(ke.key)){if(A!=="tables"||!i||!Array.isArray(s)||s.length===0)return;ke.preventDefault(),ke.stopPropagation();let Nt=Math.max(0,s.findIndex(It=>It.id===i?.id));Nt<0&&(Nt=0);let or=Jr(),Bt=Nt;ke.key==="ArrowRight"&&(Bt=Nt+1),ke.key==="ArrowLeft"&&(Bt=Nt-1),ke.key==="ArrowDown"&&(Bt=Nt+or),ke.key==="ArrowUp"&&(Bt=Nt-or);const vr=s.length;Bt=(Bt%vr+vr)%vr;const yr=s[Bt];yr&&yr.id!==i?.id&&(l(yr),setTimeout(()=>{try{document.querySelector(`[data-table-id="${yr.id}"]`)?.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}catch{}},0));return}if(ke.key==="Enter"){if(A!=="tables")return;ke.preventDefault(),ke.stopPropagation(),i&&!$t&&await Xt(i);return}if(ke.key==="Escape"){if(ke.preventDefault(),i&&(F==="products"||nn==="products")){O("order"),rn("order");return}if(i){l(null);return}return}if(ke.key==="p"||ke.key==="P"){if(ke.preventDefault(),h){setTimeout(()=>{try{j.current?.focus()}catch{}},0);return}if(i){w(!0);try{Rr(!1)}catch{}return}m(!0),setTimeout(()=>{try{j.current?.focus()}catch{}},50);return}}catch{}};return window.addEventListener("keydown",de),()=>window.removeEventListener("keydown",de)},[Dt,i?.id,s,Jr,b]),p.useEffect(()=>{try{i?.id&&t?.codigo_empresa&&localStorage.setItem(`vendas:selected:${t.codigo_empresa}`,String(i.id))}catch{}},[i?.id,t?.codigo_empresa]),p.useEffect(()=>{(async()=>{try{if(!i&&t?.codigo_empresa&&Array.isArray(s)&&s.length>0){const ke=localStorage.getItem(`vendas:selected:${t.codigo_empresa}`);if(ke){const st=s.find(ot=>String(ot.id)===String(ke));if(st)if(P("tables"),st.comandaId)try{await Se(st),P("tables")}catch(ot){console.error("[Restore Selection] Erro ao carregar detalhes:",ot),localStorage.removeItem(`vendas:selected:${t.codigo_empresa}`)}else localStorage.removeItem(`vendas:selected:${t.codigo_empresa}`)}}}catch(ke){console.error("[Restore Selection] Erro:",ke)}})()},[s,i,t?.codigo_empresa]);const Tr=p.useCallback(async()=>{try{const de=await Eh({codigoEmpresa:t?.codigo_empresa});d(!!(de&&(de.id||de?.length)))}catch{d(!1)}},[t?.codigo_empresa]),qn=async()=>{const de=t?.codigo_empresa||null;try{if(!de)return;const[ke,st]=await Promise.all([j1({codigoEmpresa:de}).catch(()=>null),Eh({codigoEmpresa:de}).catch(()=>null)]);if(!st?.id){T(null);return}let ot=0,Nt=[];try{Nt=await kg({caixaSessaoId:st.id,codigoEmpresa:de}),ot=(Nt||[]).filter(Bt=>(Bt?.tipo||"")==="sangria").reduce((Bt,vr)=>Bt+Number(vr?.valor||0),0)}catch{}const or={saldo_inicial:st.saldo_inicial||0,totalPorFinalizadora:ke?.totalPorFinalizadora||ke?.porFinalizadora||{},totalEntradas:ke?.totalEntradas||ke?.entradas||0,totalSangria:ot,totalSaidas:ot,sessaoId:st.id,movimentacoes:Nt};Ee.startTransition(()=>{T(or)})}catch{Ee.startTransition(()=>{T(null)})}finally{}},Gr=p.useRef(!1);p.useEffect(()=>{x&&!Gr.current?(Gr.current=!0,qn().catch(()=>{})):x||(Gr.current=!1)},[x]);const ar=p.useRef(!0);p.useEffect(()=>(ar.current=!0,()=>{ar.current=!1}),[]);const kn=p.useRef(0),Xn=p.useRef(0),aa=p.useRef(0);p.useEffect(()=>{const de=t?.codigo_empresa||null,ke=de?`vendas:tables:${de}`:null,st=()=>{try{if(!ke)return;const Nt=JSON.parse(localStorage.getItem(ke)||"[]");Array.isArray(Nt)&&Nt.length>0&&o(Nt)}catch{}};de&&st();const ot=async()=>{try{if(!r||!de)return;const Nt=++aa.current,or=setTimeout(()=>{ar.current&&st()},2e3),Bt=setTimeout(()=>{ar.current&&aa.current===Nt&&st()},1e4),[vr,yr]=await Promise.all([Ph(de),vh({codigoEmpresa:de}).catch(()=>[])]);if(ar.current&&aa.current===Nt){const cr=new Map;for(const Mr of yr||[]){const bn=String(Mr.produto_id),ca=Number(Mr.quantidade||0);cr.set(bn,(cr.get(bn)||0)+ca)}v(cr)}let It=[];try{It=await rd({codigoEmpresa:de})}catch(cr){console.error("[VendasPage:load] Erro ao carregar comandas abertas:",cr)}const Hr=await(async()=>{try{return await VS((It||[]).map(cr=>cr.id),de)}catch{return{}}})(),Vr=await(async()=>{try{const cr=await Promise.all((It||[]).map(async Mr=>{try{const ca=(await Bi({comandaId:Mr.id,codigoEmpresa:de})||[]).map(os=>os?.nome).filter(Boolean);return[Mr.id,ca.length?ca.join(", "):null]}catch{return[Mr.id,null]}}));return Object.fromEntries(cr)}catch{return{}}})(),pr=new Map;(It||[]).forEach(cr=>pr.set(cr.mesa_id,cr));const hr=(vr||[]).map(cr=>{const Mr=pr.get(cr.id);let bn,ca=null,os=null,ys=0,cn=null;return Mr?(bn=Mr.status==="awaiting-payment"||Mr.status==="awaiting_payment"?"awaiting-payment":"in-use",ca=Mr.id,os=Vr[Mr.id]||null,ys=Hr[Mr.id]||0,cn=Mr.aberto_em||null):bn="available",{id:cr.id,number:cr.numero,name:cr.nome||null,status:bn,order:[],customer:os,comandaId:ca,totalHint:ys,aberto_em:cn}}).map(cr=>i&&cr.id===i.id?{...cr,order:i.order||[],customer:i.customer||cr.customer}:cr);if(!ar.current||aa.current!==Nt){clearTimeout(or),clearTimeout(Bt);return}if(o(hr),(hr||[]).length===0)try{ke&&localStorage.removeItem(ke)}catch{}else try{ke&&localStorage.setItem(ke,JSON.stringify(hr))}catch{}const Zr=de?`vendas:selected:${de}`:null;if(Zr)try{const cr=localStorage.getItem(Zr);if(cr){const Mr=hr.find(bn=>String(bn.id)===String(cr));Mr&&!Mr.comandaId&&localStorage.removeItem(Zr)}}catch{}Xn.current=Array.isArray(hr)?hr.length:0,kn.current=Date.now();let Pr=null;try{const cr=de?`vendas:selected:${de}`:null,Mr=cr?localStorage.getItem(cr):null;if(Mr){const bn=hr.find(ca=>String(ca.id)===String(Mr));bn&&(Pr=bn)}}catch{}Pr?je||l(cr=>!cr||cr.id!==Pr.id?Pr:{...Pr,order:cr.order||Pr.order||[],customer:cr.customer||Pr.customer||null,observacoes:cr.observacoes??Pr.observacoes??null,desconto_tipo:cr.desconto_tipo??Pr.desconto_tipo??null,desconto_valor:cr.desconto_valor??Pr.desconto_valor??0,desconto_motivo:cr.desconto_motivo??Pr.desconto_motivo??null}):je||l(cr=>{const Mr=cr?hr.find(ca=>ca.id===cr.id):null;return Mr?{...Mr,order:cr.order||Mr.order||[],customer:cr.customer||Mr.customer||null,observacoes:cr.observacoes??Mr.observacoes??null,desconto_tipo:cr.desconto_tipo??Mr.desconto_tipo??null,desconto_valor:cr.desconto_valor??Mr.desconto_valor??0,desconto_motivo:cr.desconto_motivo??Mr.desconto_motivo??null}:hr[0]||null}),clearTimeout(or),clearTimeout(Bt)}catch(Nt){console.error("Erro ao carregar mesas:",Nt)}};return st(),r&&de&&ot(),()=>{}},[r,t?.codigo_empresa]),p.useEffect(()=>{if(!r||!t?.codigo_empresa)return;let de=!1;const ke=t.codigo_empresa;return(async()=>{try{const st=await Hu({includeInactive:!1,codigoEmpresa:ke});de||G(st||[])}catch(st){console.warn("Falha ao carregar produtos:",st?.message||st),de||G([])}})(),()=>{de=!0}},[r,t?.codigo_empresa]),p.useEffect(()=>{!r||!t?.codigo_empresa||Tr()},[r,t?.codigo_empresa,Tr]),p.useEffect(()=>{let de=!0;return(async()=>{try{if(!t?.codigo_empresa){de&&f(0);return}const ke=await rd({codigoEmpresa:t?.codigo_empresa});if(!de)return;f(Array.isArray(ke)?ke.length:0)}catch{de&&f(0)}})(),()=>{de=!1}},[t?.codigo_empresa,s.length]),p.useEffect(()=>{const de=t?.codigo_empresa||null,ke=de?`vendas:selected:${de}`:null;try{ke&&i?.id&&localStorage.setItem(ke,String(i.id))}catch{}i?.comandaId&&(!i.order||i.order.length===0)&&Se(i)},[i?.id,i?.comandaId]),p.useEffect(()=>()=>{},[i?.comandaId,Dt,ge]);const pa=async()=>{try{if(!i?.comandaId){e({title:"Selecione uma mesa com comanda aberta",variant:"warning"});return}await im({codigoEmpresa:t?.codigo_empresa});try{const ot=(await To({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(or=>({id:or.id,productId:or.produto_id,name:or.descricao||"Item",price:Number(or.preco_unitario||0),quantity:Number(or.quantidade||1),desconto_tipo:or.desconto_tipo||null,desconto_valor:Number(or.desconto_valor||0),desconto_motivo:or.desconto_motivo||null})),Nt={...i,order:ot};l(Nt),o(or=>or.map(Bt=>Bt.id===Nt.id?Nt:Bt))}catch{}const de=await Ah({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa});xt(de||[]);const ke=de&&de[0]&&de[0].id?de[0].id:null;Cr(ke),Qe(ke),nt(!0)}catch(de){e({title:"Falha ao carregar finalizadoras",description:de?.message||"Tente novamente",variant:"destructive"})}},te=de=>{if(!de.destination)return;const ke=Array.from(s),[st]=ke.splice(de.source.index,1);ke.splice(de.destination.index,0,st),o(ke),e({title:"Layout das mesas atualizado!",description:"As posies foram salvas temporariamente.",variant:"success"})},Te=(de,ke)=>{let st=0;for(const Nt of de||[]){let or=(Nt.price||0)*(Nt.quantity||1);Nt.desconto_tipo==="percentual"&&Nt.desconto_valor>0?or*=1-Nt.desconto_valor/100:Nt.desconto_tipo==="fixo"&&Nt.desconto_valor>0&&(or-=Nt.desconto_valor),st+=Math.max(0,or)}let ot=st;return ke?.desconto_tipo==="percentual"&&ke?.desconto_valor>0?ot*=1-ke.desconto_valor/100:ke?.desconto_tipo==="fixo"&&ke?.desconto_valor>0&&(ot-=ke.desconto_valor),Math.max(0,ot)},at=de=>{if(!de)return"";const ke=de.trim().split(/\s+/);return ke.length<=2?de:ke.slice(0,2).join(" ")},ee=de=>{if(!de)return"";const ke=ot=>String(ot).replace(/^\s*[\[]+\s*/g,"").replace(/\s*[\]]+\s*$/g,"").trim(),st=de.split(",").map(ot=>ke(ot)).filter(Boolean);return st.length===0?"":st.length===1?at(st[0]):`${at(st[0])} +${st.length-1}`},Se=async de=>{try{if(!de?.comandaId)return;const st=(await To({comandaId:de.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Bt=>({id:Bt.id,productId:Bt.produto_id,name:Bt.descricao||"Item",price:Number(Bt.preco_unitario||0),quantity:Number(Bt.quantidade||1),desconto_tipo:Bt.desconto_tipo||null,desconto_valor:Number(Bt.desconto_valor||0),desconto_motivo:Bt.desconto_motivo||null}));let ot=de.customer||null;try{const vr=(await Bi({comandaId:de.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(yr=>yr?.nome).filter(Boolean);ot=vr.length?vr.join(", "):null}catch{}let Nt=de;try{const vr=(await rd({codigoEmpresa:t?.codigo_empresa}))?.find(yr=>yr.id===de.comandaId);vr&&(Nt={...de,desconto_tipo:vr.desconto_tipo||null,desconto_valor:Number(vr.desconto_valor||0),desconto_motivo:vr.desconto_motivo||null,observacoes:vr.observacoes||null})}catch{}const or={...Nt,status:de.status==="awaiting-payment"?"awaiting-payment":"in-use",order:st,customer:ot};l(or),o(Bt=>Bt.map(vr=>vr.id===or.id?or:vr))}catch(ke){console.warn("[VendasPage] Falha ao recarregar detalhes da mesa selecionada:",ke)}},$e=async({showToast:de=!1}={})=>{try{const ke=t?.codigo_empresa;if(!ke)return;const st=await Ph(ke);let ot=[];try{ot=await rd({codigoEmpresa:ke})}catch(It){console.error("[refreshTablesLight] Erro ao carregar comandas:",It)}const Nt=new Map((ot||[]).map(It=>[It.mesa_id,It])),or={},Bt={};try{const It=(ot||[]).map(pr=>pr.id);(await Promise.all(It.map(async pr=>{try{return{id:pr,vinculos:await Bi({comandaId:pr,codigoEmpresa:ke})}}catch{return{id:pr,vinculos:[]}}}))).forEach(({id:pr,vinculos:ln})=>{const hr=(ln||[]).map(Zr=>Zr?.nome).filter(Boolean);or[pr]=hr.length?hr.join(", "):null}),(await Promise.all(It.map(async pr=>{try{const hr=(await To({comandaId:pr,codigoEmpresa:ke})||[]).reduce((Zr,Pr)=>{const cr=(Pr.quantidade||0)*(Pr.preco_unitario||0)-(Pr.desconto||0);return Zr+cr},0);return{comandaId:pr,total:hr}}catch(ln){return console.error(`[refreshTablesLight] Erro ao buscar itens da comanda ${pr}:`,ln),{comandaId:pr,total:0}}}))).forEach(({comandaId:pr,total:ln})=>{Bt[pr]=ln})}catch(It){console.error("[refreshTablesLight] Erro ao carregar clientes/totais:",It)}const yr=(st||[]).map(It=>{const Hr=Nt.get(It.id);let Vr,pr=null,ln=null,hr=0;return Hr?(Vr=Hr.status==="awaiting-payment"||Hr.status==="awaiting_payment"?"awaiting-payment":"in-use",pr=Hr.id,ln=or[Hr.id]||null,hr=Bt[Hr.id]||0):Vr="available",{id:It.id,number:It.numero,name:It.nome||null,status:Vr,order:[],customer:ln,comandaId:pr,totalHint:hr}}).map(It=>{if(i&&It.id===i.id)return i.status==="available"?{...It,status:"available",comandaId:null,order:[],customer:null,totalHint:0}:It.comandaId?{...It,order:i.order||[],customer:i.customer||It.customer}:{...It,order:[],customer:null};try{const Hr=yt.current.get(It.id);if(Hr&&Date.now()-Hr<3e4)return{...It,status:"available",comandaId:null,order:[],customer:null,totalHint:0}}catch{}return It});if(o(yr),i){const It=yr.find(Hr=>Hr.id===i.id);It&&!It.comandaId&&l({...It,order:[],customer:null})}}catch(ke){console.error("[refreshTablesLight] Erro fatal:",ke),de&&e({title:"Erro ao atualizar mesas",description:"Recarregue a pgina se o problema persistir",variant:"destructive"})}},Be=p.useRef(null);p.useEffect(()=>{Be.current=i},[i]);const Ge=p.useRef(null),Ye=p.useRef(null),ft=p.useRef(null),yt=p.useRef(new Map);p.useEffect(()=>{const de=t?.codigo_empresa;if(!de)return;try{const ot=typeof window<"u"?window.localStorage.getItem("custom-auth-token"):null;if(ot&&ot.trim())re.realtime.setAuth(ot.trim());else{let Nt="";try{Nt=(new URL(re.supabaseUrl||"").host||"").split(".")[0]||""}catch{}const or=Nt?`sb-${Nt}-auth-token`:"sb-auth-token",Bt=typeof window<"u"?window.localStorage.getItem(or):null;if(Bt)try{const vr=JSON.parse(Bt),yr=vr?.access_token||vr?.currentSession?.access_token;yr&&re.realtime.setAuth(yr)}catch{}}}catch{}const ke=re.channel(`loja:${de}`),st=ot=>{const Nt=ot?.table||ot?.table_name||"",or=ot?.new||ot?.old||{},Bt=ot?.eventType||ot?.type||ot?.event||"";let vr=!0;if(Nt!=="comanda_itens"&&Nt!=="comanda_clientes"){const yr=or?.codigo_empresa;yr!=null&&yr!==""&&(vr=String(yr)===String(de||""))}if(!vr){try{console.log("[Realtime][Vendas] IGNORADO por empresa",{t:Nt,evt:Bt,rowEmpresa:or?.codigo_empresa,codigoEmpresa:de})}catch{}return}try{console.log("[Realtime][Vendas] payload recebido",{t:Nt,evt:Bt,row:or,codigoEmpresa:de})}catch{}(async()=>{try{await $e({showToast:!1})}catch{}})()};if(ke.on("postgres_changes",{event:"*",schema:"public",table:"comandas"},st).on("postgres_changes",{event:"*",schema:"public",table:"comanda_itens"},st).on("postgres_changes",{event:"*",schema:"public",table:"comanda_clientes"},st).on("postgres_changes",{event:"*",schema:"public",table:"pagamentos",filter:`codigo_empresa=eq.${de}`},st).on("postgres_changes",{event:"*",schema:"public",table:"mesas"},st).subscribe(),Ge.current=ke,ft.current)try{clearInterval(ft.current)}catch{}return ft.current=setInterval(async()=>{if(!jr.current)try{await $e({showToast:!1})}catch{}},6e4),()=>{if(Ge.current){try{re.removeChannel(Ge.current)}catch{}Ge.current=null}if(Ye.current){try{clearTimeout(Ye.current)}catch{}Ye.current=null}if(ft.current){try{clearInterval(ft.current)}catch{}ft.current=null}}},[t?.codigo_empresa]);const Et=({table:de,provided:ke,isDragging:st})=>{const ot=hst[de.status],Nt=ot.icon,or=Array.isArray(de.order)?de.order:[],Bt=or.filter(pr=>String(pr.id||"").startsWith("tmp-")).reduce((pr,ln)=>pr+Number(ln.quantity||0)*Number(ln.price||0),0),vr=or.filter(pr=>!String(pr.id||"").startsWith("tmp-")).reduce((pr,ln)=>pr+Number(ln.quantity||0)*Number(ln.price||0),0),yr=Number(de.totalHint||0);ee(de.customer);const It=de.status==="available"&&de.id===rt,Hr=de.status==="in-use"||de.status==="awaiting-payment"?(yr>0?yr:vr)+Bt:0,Vr=de.status==="available"?"text-success bg-success/10 border-success/30":de.status==="in-use"?"text-warning bg-warning/10 border-warning/30":"text-info bg-info/10 border-info/30";return a.jsxs("div",{ref:ke?.innerRef,"data-table-id":de.id,...ke?.draggableProps||{},className:Sr("p-4 rounded-lg border bg-surface flex flex-col relative h-44 shadow-sm min-w-[240px]",st&&"shadow-lg",A==="tables"&&i?.id===de.id&&"ring-2 ring-brand/60 bg-surface-2",c?"cursor-pointer":"cursor-not-allowed opacity-60"),onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}Xt(de)},children:[a.jsx("div",{...ke?.dragHandleProps||{},className:"absolute top-2 right-2 text-text-muted opacity-60 hover:opacity-100",children:a.jsx($ue,{size:14})}),a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Nt,{className:"w-5 h-5 text-text-secondary"}),a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("span",{className:"text-lg font-semibold text-text-primary truncate",children:de.name?de.name:`Mesa ${de.number}`}),It&&a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F1"})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(de.status==="in-use"||de.status==="awaiting-payment")&&de.aberto_em&&a.jsxs("div",{className:"flex items-center gap-0.5 text-xs text-text-secondary",children:[a.jsx(eu,{className:"w-3.5 h-3.5 text-text-muted"}),a.jsx("span",{className:"font-medium",children:(()=>{try{const pr=new Date(de.aberto_em),hr=new Date-pr,Zr=Math.floor(hr/6e4),Pr=Math.floor(Zr/60),cr=Zr%60;return Zr<1?"agora":Pr===0?`${cr}m`:Pr>0&&cr===0?`${Pr}h`:`${Pr}h${cr}m`}catch{return""}})()})]}),a.jsx("span",{className:Sr("text-[11px] font-medium px-2 py-0.5 rounded-full border flex-shrink-0",Vr),children:ot.label})]})]}),a.jsx("div",{className:Sr("flex-1 flex items-center justify-center"),children:de.status==="available"?a.jsx("img",{src:"/mesalivre.png",alt:"Mesa livre",className:Sr("w-16 h-16 object-contain opacity-80",i?.id===de.id&&"opacity-100")}):de.status==="in-use"?a.jsx("img",{src:"/mesaocupada.png",alt:"Mesa ocupada",className:Sr("w-16 h-16 object-contain opacity-80",i?.id===de.id&&"opacity-100")}):a.jsx("div",{className:Sr("w-16 h-16 rounded-lg bg-info/20 border-2 border-info/40 flex items-center justify-center",i?.id===de.id&&"bg-info/30 border-info/60"),children:a.jsx(Vi,{className:"w-8 h-8 text-info"})})}),a.jsx("div",{className:"w-full mt-auto",children:de.status==="in-use"||de.status==="awaiting-payment"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[a.jsx(tc,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),a.jsx("div",{className:"text-sm sm:text-base font-medium text-text-primary truncate",title:de.customer||"",children:ee(de.customer)||""})]}),a.jsxs("div",{className:"flex items-center gap-1 justify-between",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Oi,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),a.jsxs("div",{className:"text-sm font-bold text-text-secondary",children:["R$ ",Hr.toFixed(2)]})]}),a.jsx("button",{onClick:pr=>{pr.stopPropagation(),n(`/historico?mesa=${de.id}`)},className:"p-1 hover:bg-surface-2 rounded transition-colors",title:"Ver histrico desta mesa",children:a.jsx(Vi,{className:"w-4 h-4 text-text-secondary hover:text-text-primary"})})]})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Sem comanda"}),a.jsx("button",{onClick:pr=>{pr.stopPropagation(),n(`/historico?mesa=${de.id}`)},className:"p-1 hover:bg-surface-2 rounded transition-colors",title:"Ver histrico desta mesa",children:a.jsx(Vi,{className:"w-4 h-4 text-text-secondary hover:text-text-primary"})})]})})]})},br=()=>{const de=i?Te(i.order,i):0,[ke,st]=p.useState(!1),[ot,Nt]=p.useState([]),[or,Bt]=p.useState(1),[vr,yr]=p.useState([]),It=p.useRef(new Map),Hr=typeof window<"u"&&window.innerWidth<=640,Vr=p.useRef(!1),pr=Kr=>{const tn=String(Kr||"").replace(/\D/g,"");return tn?Number(tn)/100:0},ln=Kr=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.max(0,Number(Kr)||0)),hr=Kr=>{const tn=(Fe||[]).find(dn=>String(dn.id)===String(Kr.methodId)),An=tn&&tn.taxa_percentual!=null?Number(tn.taxa_percentual):0;return Number.isFinite(An)?An/100:0},Zr=()=>(ot||[]).reduce((Kr,tn)=>Kr+pr(tn.value),0);p.useEffect(()=>(Wt.current=Nt,Ht.current=Bt,mr.current=i?.comandaId||null,()=>{Wt.current=null,Ht.current=null,mr.current=null}),[i?.comandaId]),p.useEffect(()=>{Gt.current=ot||[]},[ot]);const Pr=(Kr,tn)=>{try{if(Hr)return;const An=(ot||[]).findIndex(dn=>dn.id===tn);if(An>=0){const dn=(ot||[])[An+1]||null;if(dn&&It.current.get(dn.id)){const Yn=It.current.get(dn.id);setTimeout(()=>{try{Yn.focus(),Yn.select?.()}catch{}},0);return}}if(Kr&&Kr instanceof HTMLElement){const dn=Array.from(document.querySelectorAll('input[data-pay-value="1"]')),Yn=dn.indexOf(Kr);if(Yn>=0&&dn[Yn+1]){const Ir=dn[Yn+1];setTimeout(()=>{try{Ir.focus(),Ir.select?.()}catch{}},0);return}}Vr.current=!0,Nt(dn=>{const Yn=vr[0]?.id||"",Ir=Fe&&Fe[0]&&Fe[0].id?Fe[0].id:null,wn=or,wr=[...dn,{id:wn,clientId:Yn,methodId:Ir,value:"",chargeFee:!0}];return Bt(Wr=>Wr+1),Hr||setTimeout(()=>{const Wr=It.current.get(wn);if(Wr)try{Wr.focus(),Wr.select?.()}catch{}},0),wr})}catch{}};p.useEffect(()=>{let Kr=!0;return(async()=>{try{if(!je||!i?.comandaId)return;let An=[],dn=[];try{const[M,H]=await Promise.all([cKe({comandaId:i.comandaId,status:"Pendente",codigoEmpresa:t?.codigo_empresa}).catch(()=>[]),Bi({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa}).catch(()=>[])]);An=Array.isArray(M)?M:[],dn=(Array.isArray(H)?H:[]).map(X=>{const Ce=X?.cliente_id??X?.clientes?.id??X?.id??null,we=X?.clientes?.nome??X?.nome??X?.nome_livre??"";return!Ce&&we?{id:`livre-${X?.id||Math.random()}`,nome:we}:Ce?{id:Ce,nome:we}:null}).filter(Boolean)}catch{}if(!Kr)return;if(yr(dn),Array.isArray(An)&&An.length>0){const M=An.map((H,le)=>{const X=Number(H.valor||0),we={id:le+1,clientId:H.cliente_id||null,methodId:H.finalizadora_id||null,chargeFee:!0},Z=hr(we),ye=X,Ne=we.chargeFee!==!1?ye*(1+Z):ye;return{...we,baseValue:ye,value:ln(Ne)}});Nt(M),Bt(M.length+1),Vr.current=!1;return}let Yn=Fe&&Fe[0]&&Fe[0].id?Fe[0].id:null,Ir=dn[0]?.id||null,wn="";try{const H=(await To({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).reduce((le,X)=>le+Number(X.quantidade||0)*Number(X.preco_unitario||0),0);H>0&&(wn=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(H))}catch{}const wr=pr(wn),Wr={id:1,clientId:Ir,methodId:Yn,baseValue:wr,chargeFee:!0},D=hr(Wr),Q=Wr.chargeFee?wr*(1+D):wr;Nt([{...Wr,value:ln(Q)}]),Bt(2),Vr.current=!1}catch(An){console.error(An)}})(),()=>{Kr=!1}},[je,i?.comandaId]),p.useEffect(()=>{if(!je||!i?.comandaId||!Array.isArray(ot)||ot.length===0||!Vr.current)return;Oe.current&&clearTimeout(Oe.current);const Kr=setTimeout(async()=>{if(Vr.current)try{const tn=(ot||[]).map(An=>{const dn=Number(An.baseValue||0),Yn=(Fe||[]).find(wn=>String(wn.id)===String(An.methodId)),Ir=Yn?.tipo||Yn?.nome||"outros";return{clienteId:An.clientId||null,finalizadoraId:An.methodId||null,metodo:Ir,valor:dn}});ua.current=Date.now(),await B_({comandaId:i.comandaId,linhas:tn,codigoEmpresa:t?.codigo_empresa})}catch(tn){console.warn("[PayDialog] Falha ao salvar rascunho de pagamentos (debounced):",tn)}},400);return Oe.current=Kr,()=>{clearTimeout(Kr),Oe.current===Kr&&(Oe.current=null)}},[je,i?.comandaId,ot,Fe,t?.codigo_empresa]),p.useEffect(()=>{let Kr=!0;return(async()=>{try{if(!je||Array.isArray(Fe)&&Fe.length>0)return;const An=await Ah({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa});if(!Kr)return;xt(An||[])}catch{}})(),()=>{Kr=!1}},[je]),p.useEffect(()=>{je&&(!Array.isArray(Fe)||Fe.length===0||Nt(Kr=>{if(!Array.isArray(Kr)||Kr.length===0)return Kr;const tn=Fe&&Fe[0]&&Fe[0].id?Fe[0].id:null;if(!tn)return Kr;let An=!1;const dn=Kr.map(Yn=>{if(!Yn.methodId){An=!0;const Ir={...Yn,methodId:tn},wn=hr(Ir),wr=Ir.chargeFee!==!1?Number(Ir.baseValue||0)*(1+wn):Number(Ir.baseValue||0);return{...Ir,value:ln(wr)}}return Yn});return An?dn:Kr}))},[je,Fe]);const cr=async()=>{try{if(!i?.comandaId)return;const Kr=t?.codigo_empresa;if(!Kr){e({title:"Empresa no definida",variant:"destructive"});return}if(!Array.isArray(ot)||ot.length===0){e({title:"Informe os pagamentos",description:"Adicione pelo menos uma forma de pagamento.",variant:"warning"});return}for(const M of ot){if(!M.methodId){e({title:"Forma de pagamento faltando",description:"Selecione a finalizadora em todas as linhas.",variant:"warning"});return}if(pr(M.value)<=0){e({title:"Valor invlido",description:"Informe valores maiores que zero.",variant:"warning"});return}}_e(!0);const tn=de>0?de:0,An=(ot||[]).reduce((M,H)=>M+pr(H.value),0),dn=(ot||[]).reduce((M,H)=>{const le=Number(H.baseValue||0),X=hr(H);return M+(H.chargeFee!==!1&&X>0?le*X:0)},0),Yn=tn+dn,Ir=An-Yn,wn=Math.abs(Ir),wr=i.comandaId,Wr=i.id;o(M=>M.map(H=>H.id===Wr?{...H,status:"available",order:[],comandaId:null,customer:null,totalHint:0}:H)),l(M=>M&&M.id===Wr?null:M),nt(!1);try{Rr(!1)}catch{}let D=de;if(D<=0)try{D=(await To({comandaId:wr,codigoEmpresa:t?.codigo_empresa})||[]).reduce((le,X)=>le+Number(X.quantidade||0)*Number(X.preco_unitario||0),0)}catch{}st(!0),_e(!0),await im({codigoEmpresa:t?.codigo_empresa});try{const M=(ot||[]).map(H=>{const le=Number(H.baseValue||0),X=(Fe||[]).find(we=>String(we.id)===String(H.methodId)),Ce=X?.tipo||X?.nome||"outros";return{clienteId:H.clientId||null,finalizadoraId:H.methodId||null,metodo:Ce,valor:le}});await B_({comandaId:wr,linhas:M,codigoEmpresa:Kr})}catch(M){console.warn("[PayDialog] Falha ao salvar rascunho antes de promover:",M)}await dKe({comandaId:wr,codigoEmpresa:Kr}),await T0({comandaId:wr,codigoEmpresa:t?.codigo_empresa,diferencaPagamento:Ir});try{t?.codigo_empresa&&localStorage.removeItem(`vendas:tables:${t.codigo_empresa}`)}catch{}try{const M=await Ph(t?.codigo_empresa),H=await rd({codigoEmpresa:t?.codigo_empresa}),le={};await Promise.all((H||[]).map(async Ce=>{try{const Z=(await Bi({comandaId:Ce.id,codigoEmpresa:t?.codigo_empresa})||[]).map(ye=>ye?.nome).filter(Boolean);le[Ce.id]=Z.length?Z.join(", "):null}catch{le[Ce.id]=null}}));const X=(M||[]).map(Ce=>{const we=(H||[]).find(Z=>Z.mesa_id===Ce.id);return{id:Ce.id,name:Ce.nome||`Mesa ${Ce.numero}`,status:we?"in-use":"available",comandaId:we?.id||null,customer:we?le[we.id]:null,order:[],totalHint:0,aberto_em:we?.aberto_em||null}});o(X)}catch{}const Q=wn>.009?Ir>0?` | Diferena cobrada a mais: R$ ${wn.toFixed(2)}`:` | Diferena cobrada a menos: R$ ${wn.toFixed(2)}`:"";e({title:"Pagamento registrado",description:`Total itens R$ ${D.toFixed(2)} | Pagamentos R$ ${An.toFixed(2)}${Q}`,variant:"success"})}catch(Kr){e({title:"Falha ao registrar pagamento",description:Kr?.message||"Tente novamente",variant:"destructive"})}finally{st(!1),_e(!1)}};ot&&ot.length>0;const Mr=de>0?de:0,bn=(ot||[]).reduce((Kr,tn)=>Kr+pr(tn.value),0),ca=(ot||[]).reduce((Kr,tn)=>{const An=Number(tn.baseValue||0),dn=hr(tn);return Kr+(tn.chargeFee!==!1&&dn>0?An*dn:0)},0),os=Mr+ca,ys=bn-os,cn=Math.abs(ys);return a.jsx(In,{open:je,onOpenChange:nt,children:a.jsxs(En,{className:"sm:max-w-xl w-[92vw] h-[85vh] animate-none flex flex-col overflow-hidden",onKeyDown:Kr=>Kr.stopPropagation(),onKeyDownCapture:Kr=>Kr.stopPropagation(),onPointerDownOutside:Kr=>Kr.stopPropagation(),onInteractOutside:Kr=>Kr.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Fechar Conta"}),a.jsx(Hn,{children:"Divida o pagamento entre clientes e vrias finalizadoras, se necessrio."})]}),a.jsxs("div",{className:"space-y-2",children:[(()=>{let Kr=0,tn=0,An=0;for(const Ir of i?.order||[]){const wn=(Ir.price||0)*(Ir.quantity||1);Kr+=wn,Ir.desconto_tipo==="percentual"&&Ir.desconto_valor>0?tn+=wn*(Ir.desconto_valor/100):Ir.desconto_tipo==="fixo"&&Ir.desconto_valor>0&&(tn+=Ir.desconto_valor)}const dn=Kr-tn;i?.desconto_tipo==="percentual"&&i?.desconto_valor>0?An=dn*(i.desconto_valor/100):i?.desconto_tipo==="fixo"&&i?.desconto_valor>0&&(An=i.desconto_valor);const Yn=tn+An;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-8 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-secondary",children:"Subtotal"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Kr.toFixed(2)]})]}),Yn>0&&a.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[a.jsx("span",{children:"Descontos"}),a.jsxs("span",{className:"font-semibold",children:["-R$ ",Yn.toFixed(2)]})]})]}),a.jsxs("div",{className:"border-t border-border pt-1 flex items-center justify-between",children:[a.jsx("div",{className:"font-semibold",children:"Total"}),a.jsxs("div",{className:"font-bold text-lg",children:["R$ ",de.toFixed(2)]})]})]})})(),a.jsxs("div",{className:"flex items-center gap-8 text-xs text-text-muted pt-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:"Pagamentos"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",bn.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:"Diferena"}),a.jsx("span",{className:cn>.009?ys>0?"font-semibold text-emerald-600":"font-semibold text-amber-600":"font-semibold",children:cn>.009?`${ys>0?"+":"-"} R$ ${cn.toFixed(2)}`:"R$ 0,00"})]})]}),a.jsxs("div",{className:"flex-1 space-y-2 overflow-y-auto thin-scroll pr-1",children:[a.jsx(it,{className:"block",children:"Pagamentos"}),(ot||[]).map((Kr,tn)=>{const An=Ir=>{if(!Ir)return"Cliente";const wn=(vr||[]).find(wr=>String(wr.id)===String(Ir));return wn?.nome?wn.nome:"Cliente"},dn=(vr||[]).length>1,Yn=(vr||[])[0]||null;return(vr||[]).filter(Ir=>String(Ir.id)!==String(Yn?.id||"")),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-2 items-center",children:[a.jsx("div",{className:"sm:col-span-1 flex sm:justify-start",children:ot.length>1&&tn>0&&a.jsx(se,{type:"button",variant:"outline",size:"sm",className:"h-8 w-8",onClick:()=>{Vr.current=!0,Nt(Ir=>{const wn=Ir.filter(Q=>Q.id!==Kr.id);if(wn.length===0)return[];const wr=de>0?de:0,Wr=Math.floor(wr/wn.length*100)/100,D=wr-Wr*wn.length;return wn.map((Q,M)=>{const H=M===wn.length-1?Wr+D:Wr,le={...Q},X=hr(le),we=le.chargeFee!==!1&&X>0?H/(1+X):H;return{...le,baseValue:we,value:ln(H)}})})},children:""})}),tn===0?a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:An(Yn?.id||Kr.clientId)})}):dn?a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(Gn,{value:Kr.clientId||"",onValueChange:Ir=>Nt(wn=>wn.map(wr=>wr.id===Kr.id?{...wr,clientId:Ir}:wr)),children:[a.jsx(Vn,{className:"w-full truncate",children:a.jsx(Kn,{placeholder:"Cliente"})}),a.jsx(Wn,{children:(vr||[]).map(Ir=>a.jsx(lt,{value:Ir.id,children:Ir.nome},Ir.id))})]})}):a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:An(Yn?.id||Kr.clientId)})}),a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(Gn,{value:String(Kr.methodId||""),onValueChange:Ir=>{Vr.current=!0;const wn=(ot||[]).map(wr=>{if(wr.id!==Kr.id)return wr;const Wr=String(Ir),D={...wr,methodId:Wr},Q=hr(D),M=D.chargeFee!==!1?Number(D.baseValue||0)*(1+Q):Number(D.baseValue||0);return{...D,value:ln(M)}});Nt(wn);try{const wr=i?.comandaId,Wr=t?.codigo_empresa;if(wr&&Wr){const D=wn.map(Q=>{const M=Number(Q.baseValue||0),H=(Fe||[]).find(X=>String(X.id)===String(Q.methodId)),le=H?.tipo||H?.nome||"outros";return{clienteId:Q.clientId||null,finalizadoraId:Q.methodId||null,metodo:le,valor:M}});ua.current=Date.now(),B_({comandaId:wr,linhas:D,codigoEmpresa:Wr}).then(()=>{}).catch(Q=>{console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora (bg):",Q),Vr.current=!0}),Vr.current=!1}}catch(wr){console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora:",wr)}},children:[a.jsx(Vn,{className:"w-full truncate",children:a.jsx(Kn,{placeholder:"Forma de pagamento"})}),a.jsx(Wn,{children:(Fe||[]).map(Ir=>a.jsx(lt,{value:String(Ir.id),children:Ir.nome},String(Ir.id)))})]})}),a.jsx("div",{className:"sm:col-span-3",children:a.jsx(Ct,{placeholder:"0,00",inputMode:"numeric",value:Kr.value,"data-pay-value":"1",ref:Ir=>{Ir?It.current.set(Kr.id,Ir):It.current.delete(Kr.id)},onChange:Ir=>{Vr.current=!0;const wn=(Ir.target.value||"").replace(/\D/g,""),wr=wn?Number(wn)/100:0;Nt(Wr=>Wr.map(D=>{if(D.id!==Kr.id)return D;const Q=hr(D),M=D.chargeFee!==!1&&Q>0?wr/(1+Q):wr,H=D.chargeFee!==!1?M*(1+Q):M;return{...D,baseValue:M,value:ln(H)}}))},onKeyDown:Ir=>{if(Ir.stopPropagation(),Ir.key==="Enter"){Ir.preventDefault(),Pr(Ir.currentTarget,Kr.id);return}["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ir.key)||/^[0-9]$/.test(Ir.key)||Ir.preventDefault()},onBeforeInput:Ir=>{const wn=Ir.data??"";wn&&/\D/.test(wn)&&Ir.preventDefault()}})}),a.jsx("div",{className:"sm:col-span-12 -mt-1 pl-1",children:(()=>{const Ir=hr(Kr),wn=Ir*100,wr=Kr.chargeFee!==!1,Wr=Kr.baseValue!=null?Number(Kr.baseValue):(()=>{const M=(Kr.value||"").toString().replace(/\D/g,""),H=M?Number(M)/100:0;return wr&&Ir>0?H/(1+Ir):H})();if(!wn||wn<=0||!Number.isFinite(Wr)||Wr<=0)return null;const D=wr?Wr*Ir:0;return a.jsxs("button",{type:"button",onClick:async()=>{Vr.current=!0;const Q=(ot||[]).map(M=>{if(M.id!==Kr.id)return M;const H=hr(M),le=M.chargeFee!==!1,X=M.baseValue!=null?Number(M.baseValue):pr(M.value),Ce=le?X:X*(1+H);return{...M,chargeFee:!le,baseValue:X,value:ln(Ce)}});Nt(Q);try{const M=i?.comandaId,H=t?.codigo_empresa;if(M&&H){const le=Q.map(X=>({clienteId:X.clientId||null,finalizadoraId:X.methodId||null,metodo:(Fe||[]).find(Ce=>String(Ce.id)===String(X.methodId))?.tipo||(Fe||[]).find(Ce=>String(Ce.id)===String(X.methodId))?.nome||"outros",valor:Number(X.baseValue||0)}));ua.current=Date.now(),await B_({comandaId:M,linhas:le,codigoEmpresa:H}),Vr.current=!1}}catch(M){console.warn("[PayDialog] Falha ao salvar rascunho aps alternar taxa:",M)}},className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",wr?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:wr?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",wr?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",D.toFixed(2)]})]})})()})]},Kr.id)}),a.jsx("div",{children:a.jsx(se,{type:"button",variant:"secondary",size:"sm",className:"pointer-events-auto",onPointerUp:Kr=>{Kr.preventDefault(),Kr.stopPropagation(),Vr.current=!0,Nt(tn=>{const An=vr[0]?.id||"",dn=Fe&&Fe[0]&&Fe[0].id?Fe[0].id:null,Yn=[...tn,{id:or,clientId:An,methodId:dn,value:"",chargeFee:!0}],Ir=de>0?de:0,wn=Math.floor(Ir/Yn.length*100)/100,wr=Ir-wn*Yn.length;return Yn.map((Wr,D)=>{const Q=D===Yn.length-1?wn+wr:wn,M=hr(Wr),le=Wr.chargeFee!==!1&&M>0?Q/(1+M):Q;return{...Wr,baseValue:le,value:ln(Q)}})}),Bt(tn=>tn+1)},children:"Adicionar forma"})}),(()=>{const Kr=Zr(),tn=(ot||[]).reduce((Yn,Ir)=>{const wn=Number(Ir.baseValue||0),wr=hr(Ir);return Yn+(Ir.chargeFee!==!1&&wr>0?wn*wr:0)},0),dn=(de>0?de:0)+tn-Kr;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"text-sm text-text-secondary flex justify-between",children:[a.jsx("span",{children:"Soma"}),a.jsxs("span",{children:["R$ ",Kr.toFixed(2)]})]}),a.jsxs("div",{className:"text-sm font-semibold flex justify-between",children:[a.jsx("span",{children:"Restante"}),a.jsxs("span",{className:Math.abs(dn)<.005?"text-success":"text-warning",children:["R$ ",dn.toFixed(2)]})]})]})})()]})]}),a.jsxs(Na,{className:"sticky bottom-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/75",children:[a.jsx(se,{type:"button",variant:"outline",onClick:()=>nt(!1),disabled:ke,children:"Cancelar"}),a.jsx(se,{type:"button",onClick:cr,disabled:!(ot&&ot.length>0&&!ke),children:ke?"Processando...":"Confirmar Pagamento"})]})]})})},Ue=Ee.memo(({open:de,onOpenChange:ke,cashSummary:st})=>{const ot=Mr=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Mr||0)),[Nt,or]=p.useState(!0);p.useEffect(()=>{or(!!de)},[de]);const Bt=p.useMemo(()=>{const Mr=Number(st?.saldo_inicial??st?.saldoInicial??0),bn=st?.totalPorFinalizadora||st?.porFinalizadora||{},ca=Number(st?.totalEntradas??st?.entradas??0),os=ca>0?ca:Object.values(bn||{}).reduce((tn,An)=>tn+Number(An||0),0),ys=Number(st?.sangria??st?.totalSangria??0),cn=Number(st?.totalSaidas??st?.saidas??ys),Kr=Math.max(0,Mr+os-cn);return{saldoInicial:Mr,porFinalizadora:bn,entradasInformadas:ca,entradasCalc:os,sangriaVal:ys,saidas:cn,saldoAtual:Kr}},[st]);p.useEffect(()=>{if(de&&st){const Mr=setTimeout(()=>or(!1),50);return()=>clearTimeout(Mr)}},[de,st]);const{porFinalizadora:vr,sangriaVal:yr}=Bt,[It,Hr]=p.useState(!1),[Vr,pr]=p.useState(""),[ln,hr]=p.useState(""),[Zr,Pr]=p.useState(!1),cr=async()=>{try{Pr(!0);const Mr=String(Vr||"").replace(/\D/g,""),bn=Mr?Number(Mr)/100:0;if(bn<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await im({codigoEmpresa:t?.codigo_empresa}),await u3({tipo:"sangria",valor:bn,observacao:ln,codigoEmpresa:t?.codigo_empresa}),Hr(!1),pr(""),hr(""),await qn(),e({title:"Sangria registrada",variant:"success"})}catch(Mr){e({title:"Falha ao registrar sangria",description:Mr?.message||"Tente novamente",variant:"destructive"})}finally{Pr(!1)}};return a.jsx(In,{open:de,onOpenChange:ke,children:a.jsxs(En,{forceMount:!0,className:"sm:max-w-lg w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden",onOpenAutoFocus:Mr=>Mr.preventDefault(),onKeyDown:Mr=>Mr.stopPropagation(),onKeyDownCapture:Mr=>Mr.stopPropagation(),onPointerDownOutside:Mr=>Mr.stopPropagation(),onInteractOutside:Mr=>Mr.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),a.jsx(Hn,{children:"Resumo da sesso atual do caixa."})]}),Nt||!st?a.jsxs("div",{className:"px-4 space-y-3",children:[a.jsx(Gx,{className:"h-16 w-full"}),a.jsx(Gx,{className:"h-16 w-full"}),a.jsx(Gx,{className:"h-12 w-full"})]}):a.jsxs("div",{className:"px-1",children:[Object.keys(vr).length===0?a.jsx("div",{className:"p-3 text-sm text-text-muted border rounded-md",children:"Nenhuma finalizadora registrada ainda."}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"rounded-md border border-border overflow-hidden divide-y divide-border",children:Object.entries(vr).map(([Mr,bn])=>a.jsxs("li",{className:"bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:String(Mr)}),a.jsx("span",{className:"text-sm font-semibold tabular-nums",children:ot(bn)})]},Mr))}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Sangrias"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-danger",children:ot(yr)})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted leading-relaxed px-1",children:'Sadas incluem sangrias e ajustes. Use "Registrar Sangria" para lanar uma retirada.'})]}),a.jsxs(Na,{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"mr-auto"}),a.jsx(se,{variant:"destructive",onClick:()=>Hr(!0),children:"Registrar Sangria"}),a.jsx(se,{variant:"secondary",onClick:()=>ke(!1),children:"Fechar"})]}),a.jsx(In,{open:It,onOpenChange:Hr,children:a.jsxs(En,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Mr=>Mr.stopPropagation(),onKeyDownCapture:Mr=>Mr.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold",children:"Registrar Sangria"}),a.jsx(Hn,{children:"Informe o valor a retirar do caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"sangria-valor",children:"Valor"}),a.jsx(Ct,{id:"sangria-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:Vr,onChange:Mr=>{const bn=(Mr.target.value||"").replace(/\D/g,""),ca=bn?Number(bn)/100:0,os=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(ca);pr(os)},onKeyDown:Mr=>{Mr.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Mr.key)&&(/^[0-9]$/.test(Mr.key)||Mr.preventDefault())},onBeforeInput:Mr=>{const bn=Mr.data??"";bn&&/\D/.test(bn)&&Mr.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"sangria-obs",children:"Observao"}),a.jsx(Ct,{id:"sangria-obs",placeholder:"Opcional",value:ln,onChange:Mr=>hr(Mr.target.value)})]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>Hr(!1),disabled:Zr,children:"Cancelar"}),a.jsx(se,{onClick:cr,disabled:Zr,children:Zr?"Registrando...":"Confirmar"})]})]})})]})})}),St=()=>{const de=async()=>{if(V)try{await Sv({itemId:V.id,codigoEmpresa:t?.codigo_empresa});try{await Se(i)}catch{}e({title:"Item removido",description:V.name,variant:"warning"})}catch(ke){e({title:"Falha ao remover item",description:ke?.message||"Tente novamente",variant:"destructive"})}finally{he(!1),$(null)}};return a.jsx(ku,{open:Y,onOpenChange:he,children:a.jsxs(Bd,{children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Remover item?"}),a.jsxs(Vd,{children:['Tem certeza que deseja remover "',V?.name,'" da comanda? Esta ao no pode ser desfeita.']})]}),a.jsxs(zd,{children:[a.jsx(Wd,{children:"Cancelar"}),a.jsx(Iu,{onClick:de,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})})},Nr=()=>{const de=i,ke=de?.order||[],st=de?Te(ke):0;return a.jsx(In,{open:L,onOpenChange:W,children:a.jsxs(En,{className:"sm:max-w-xl w-[92vw] animate-none",onKeyDown:ot=>ot.stopPropagation(),onKeyDownCapture:ot=>ot.stopPropagation(),onPointerDownOutside:ot=>ot.stopPropagation(),onInteractOutside:ot=>ot.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsxs(Nn,{className:"text-2xl font-bold",children:["Comanda da Mesa ",de?.number??""]}),a.jsx(Hn,{children:de?.customer?`Cliente: ${de.customer}`:"Sem cliente vinculado"})]}),a.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto thin-scroll",children:ke.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum item na comanda."}):a.jsx("ul",{className:"divide-y divide-border",children:ke.map(ot=>a.jsxs("li",{className:"py-2 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:ot.name}),a.jsxs("div",{className:"text-xs text-text-muted",children:["Qtd: ",ot.quantity,"  Unit: R$ ",Number(ot.price||0).toFixed(2)]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"font-semibold",children:["R$ ",(Number(ot.price||0)*Number(ot.quantity||0)).toFixed(2)]})})]},ot.id))})}),a.jsxs(Na,{children:[a.jsxs("div",{className:"mr-auto text-sm font-semibold",children:["Total: R$ ",st.toFixed(2)]}),a.jsx(se,{variant:"secondary",onClick:()=>W(!1),children:"Fechar"}),de?.comandaId&&a.jsxs(se,{variant:"outline",onClick:()=>window.open(`/print-comanda?comanda=${de.comandaId}`,"_blank"),children:[a.jsx(jG,{className:"mr-2 h-4 w-4"})," Imprimir"]}),a.jsxs(se,{onClick:async()=>{W(!1),await pa()},disabled:!de||ke.length===0,children:[a.jsx(Oi,{className:"mr-2 h-4 w-4"})," Fechar Conta",a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-amber-600 border border-amber-700 rounded shadow-sm",children:"F2"})]})]})]})})},an=p.useMemo(()=>Nr,[i?.id,L]),Lr=({table:de})=>{const[ke,st]=p.useState(""),[ot,Nt]=p.useState(!1),[or,Bt]=p.useState(!1),vr=async()=>{if(!(!de?.comandaId||ot))try{Nt(!0),await bKe({comandaId:de.comandaId,observacoes:ke,codigoEmpresa:Number(t?.codigo_empresa)}),e({title:"Observaes salvas",description:"As observaes da comanda foram atualizadas."});try{await Se(de)}catch(yr){console.error("Erro ao recarregar detalhes da comanda aps salvar observaes:",yr)}}catch(yr){yr?.code!=="42804"&&(console.error("Erro ao salvar observao:",yr),e({title:"Erro ao salvar observaes",description:"Tente novamente mais tarde.",variant:"destructive"}))}finally{Nt(!1)}};return p.useEffect(()=>{if(!de?.comandaId){st("");return}st(de.observacoes||"")},[de?.comandaId,de?.observacoes]),de?a.jsxs("div",{className:"flex flex-col h-full p-4 space-y-4 overflow-y-auto thin-scroll",children:[de.order&&de.order.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(it,{className:"text-sm font-semibold",children:"Descontos por Item"}),a.jsx(se,{size:"xs",variant:"ghost",className:"h-6 px-2 text-[11px]",onClick:()=>Bt(yr=>!yr),children:or?"Esconder":`Mostrar (${de.order.length})`})]}),or&&a.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:de.order.map(yr=>a.jsx("button",{onClick:()=>ce(yr),className:"w-full p-3 rounded border border-border bg-surface hover:bg-surface-2 transition text-left",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm font-semibold truncate",children:yr.name}),a.jsxs("p",{className:"text-xs text-text-secondary",children:["Qtd: ",yr.quantity,"  R$ ",(yr.price||0).toFixed(2)]})]}),a.jsx("div",{className:"text-right flex-shrink-0",children:yr.desconto_valor>0?a.jsxs("span",{className:"text-xs font-bold text-destructive",children:["-",yr.desconto_tipo==="percentual"?yr.desconto_valor+"%":"R$"+(yr.desconto_valor||0).toFixed(2)]}):a.jsx("span",{className:"text-xs text-text-muted",children:"Sem desconto"})})]})},yr.id))})]}),de.comandaId&&a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx(it,{className:"text-sm font-semibold",children:"Observaes"}),ot&&a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Salvando..."})]}),a.jsx("textarea",{className:"border border-border rounded p-3 text-sm resize-none bg-background min-h-20",placeholder:"Ex: sem cebola, urgente, etc.",value:ke,onChange:yr=>{const It=yr.target.value;st(It)},onKeyDown:async yr=>{yr.key==="Enter"&&!yr.shiftKey&&(yr.preventDefault(),await vr())}})]}),de.comandaId&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{className:"text-sm font-semibold",children:"Desconto da Comanda"}),a.jsx(se,{size:"sm",variant:de.desconto_valor>0?"default":"outline",onClick:()=>Qt(!0),className:"w-full gap-2",children:de.desconto_valor>0?a.jsxs(a.Fragment,{children:[a.jsx("span",{children:"Desconto Ativo:"}),a.jsxs("span",{className:"font-bold",children:["-",de.desconto_tipo==="percentual"?de.desconto_valor+"%":"R$"+de.desconto_valor.toFixed(2)]})]}):"Aplicar Desconto"}),de.desconto_motivo&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded border border-border",children:[a.jsx("strong",{children:"Motivo:"})," ",de.desconto_motivo]})]})]}):a.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Vi,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),a.jsx("p",{children:"Selecione uma mesa"})]})})},On=({table:de})=>{if(!de)return a.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Tb,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),a.jsx("p",{children:"Selecione uma mesa para ver a comanda"})]})});if(gn)return a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2",children:[a.jsx("div",{className:"h-0 w-0","aria-hidden":"true"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(se,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap",disabled:!c,onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de abrir uma mesa.",variant:"warning"});return}Lt(de),pt(!0)},children:"Abrir Mesa"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 thin-scroll",children:[a.jsx(Gx,{className:"h-20 w-full"}),a.jsx(Gx,{className:"h-20 w-full"}),a.jsx(Gx,{className:"h-20 w-full"})]}),a.jsxs("div",{className:"p-4 border-t border-border mt-auto",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm font-semibold text-text-secondary mb-2",children:[a.jsx("span",{children:"Total"}),a.jsx("span",{children:"R$ 0,00"})]}),a.jsx(se,{size:"lg",className:"w-full",disabled:!c,children:"Fechar Conta"})]})]});const ke=Te(de.order,de),st=ee(de.customer),ot=async()=>{if(!de?.comandaId)return;const vr=(await To({comandaId:de.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Vr=>({id:Vr.id,productId:Vr.produto_id,name:Vr.descricao||"Item",price:Number(Vr.preco_unitario||0),quantity:Number(Vr.quantidade||1)})),yr=(vr||[]).reduce((Vr,pr)=>Vr+Number(pr.price||0)*Number(pr.quantity||0),0);let It=de.customer||null;try{const pr=(await Bi({comandaId:de.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(ln=>ln?.nome).filter(Boolean);It=pr.length?pr.join(", "):null}catch{}const Hr={...de,order:vr,customer:It,totalHint:yr};l(Hr),o(Vr=>Vr.map(pr=>pr.id===Hr.id?Hr:pr))},Nt=async(Bt,vr)=>{try{const It=Number(Bt.quantity||1)+vr;if(It<=0){$(Bt),he(!0),setTimeout(async()=>{Y||await ot()},100);return}const Hr=Number(Bt.price||0)*Number(vr||0);Hr&&(l(Vr=>Vr&&{...Vr,totalHint:Math.max(0,Number(Vr.totalHint||0)+Hr)}),o(Vr=>Vr.map(pr=>pr.id===i?.id?{...pr,totalHint:Math.max(0,Number(pr.totalHint||0)+Hr)}:pr))),await Fd({itemId:Bt.id,quantidade:It,codigoEmpresa:t?.codigo_empresa}),await ot(),e({title:"Quantidade atualizada",description:`${Bt.name}: ${It}`,variant:"success"})}catch(yr){e({title:"Falha ao atualizar quantidade",description:yr?.message||"Tente novamente",variant:"destructive"})}},or=async Bt=>{$(Bt),he(!0),setTimeout(async()=>{Y||await ot()},100)};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col h-full",onMouseDown:Bt=>{Bt.target===Bt.currentTarget&&Bt.preventDefault()},children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-center md:justify-between gap-2",children:[st?a.jsx("div",{className:"hidden sm:block text-sm font-medium text-text-primary leading-none truncate",title:de.customer||"",children:st}):a.jsx("div",{className:"h-0 w-0","aria-hidden":"true"}),a.jsx("div",{className:"flex items-center gap-2",children:de.comandaId?a.jsxs(a.Fragment,{children:[a.jsxs(se,{size:"sm",className:"h-8 px-3 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-black/60 text-white border border-white/10 shadow-sm hover:bg-black/80 hover:shadow transition-all flex items-center",onClick:()=>{Ae(!0);try{w(!1)}catch{}try{U(!1)}catch{}try{nt(!1)}catch{}try{Rr(!1)}catch{}try{W(!1)}catch{}},children:[a.jsx(tc,{size:12,className:"text-white/80 mr-1.5"}),"Clientes"]}),a.jsxs(se,{size:"sm",variant:"outline",className:"h-8 px-3 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-black/60 text-white border border-white/10 shadow-sm hover:bg-black/80 hover:shadow transition-all",onClick:()=>W(!0),children:[a.jsx("span",{className:"inline-flex items-center justify-center h-5 w-5 rounded-full bg-black/40 border border-white/10 mr-1.5",children:a.jsx(Vi,{size:12,className:"text-white/80"})}),"Comanda"]}),a.jsxs(ku,{children:[a.jsx(gg,{asChild:!0,children:a.jsx(se,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-red-600 hover:bg-red-500 text-white border border-red-600/70 focus:outline-none focus:ring-0 focus-visible:ring-0 shadow-none",children:"Cancelar"})}),a.jsxs(Bd,{className:"sm:max-w-[420px] animate-none",onKeyDown:Bt=>Bt.stopPropagation(),children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Cancelar comanda?"}),a.jsx(Vd,{children:"Esta ao no pode ser desfeita. Os itens sero descartados e a mesa voltar a ficar livre."})]}),a.jsxs(zd,{children:[a.jsx(Wd,{children:"Voltar"}),a.jsx(Iu,{disabled:wt,onClick:async Bt=>{const vr=Bt.currentTarget.closest('[role="alertdialog"]');vr&&vr.querySelector("[data-radix-collection-item]")?.click();try{gt(!0);const yr=t?.codigo_empresa;if(yr)try{localStorage.removeItem(`vendas:selected:${yr}`),localStorage.removeItem(`vendas:tables:${yr}`)}catch{}await Uz({comandaId:de.comandaId,codigoEmpresa:yr}),l(null);try{Rr(!1)}catch{}await $e({showToast:!1}),e({title:"Comanda cancelada",variant:"success"})}catch(yr){console.error("[Cancelar Comanda] Erro:",yr),e({title:"Falha ao cancelar comanda",description:yr?.message||"Tente novamente",variant:"destructive"});try{await $e({showToast:!1})}catch(It){console.error("[Cancelar Comanda] Erro ao recarregar aps falha:",It)}}finally{gt(!1)}},children:"Confirmar Cancelamento"})]})]})]})]}):a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(se,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap",disabled:!c,onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de abrir uma mesa.",variant:"warning"});return}Lt(de),pt(!0)},children:"Abrir Mesa"})})})]}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-3 thin-scroll",children:de.order.length===0?a.jsx("div",{className:"text-center text-text-muted pt-16",children:a.jsx("p",{children:"Comanda vazia. Adicione produtos na aba ao lado."})}):a.jsx("ul",{className:"space-y-3",children:de.order.map(Bt=>a.jsxs("li",{className:"p-2 rounded-md border border-border/30 bg-surface",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("p",{className:"text-sm font-semibold text-text-primary truncate",title:Bt.name,children:Bt.name})}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(se,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>Nt(Bt,-1),children:a.jsx(hv,{size:12})}),a.jsx("span",{className:"w-7 text-center font-semibold text-sm",children:Bt.quantity}),a.jsx(se,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>Nt(Bt,1),children:a.jsx(Es,{size:12})})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-right flex-1",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsxs("span",{className:"font-bold text-text-primary",children:["R$ ",(Bt.price*Bt.quantity).toFixed(2)]}),Bt.desconto_valor>0&&a.jsxs("span",{className:"text-xs font-semibold text-destructive",children:["-",Bt.desconto_tipo==="percentual"?Bt.desconto_valor+"%":"R$"+(Bt.desconto_valor||0).toFixed(2)]})]})}),a.jsx(se,{variant:"ghost",size:"icon",className:"text-danger/80 hover:text-danger h-7 w-7",onClick:()=>or(Bt),children:a.jsx(Sf,{size:14})})]})]})]},Bt.id))})}),a.jsxs("div",{className:"p-3 border-t border-border mt-auto space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm font-semibold text-text-secondary",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",ke.toFixed(2)]})]}),a.jsxs(se,{size:"lg",className:"w-full",onClick:pa,children:[a.jsx(Oi,{className:"mr-2"})," Fechar Conta",a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-amber-600 border border-amber-700 rounded shadow-sm",children:"F2"})]})]})]}),a.jsx(br,{})]})},Qn=()=>{const[de,ke]=p.useState(""),[st,ot]=p.useState(""),Nt=async()=>{try{if(ue)return;ve(!0);const or=(de??"").toString().trim(),Bt=or?Number(or):void 0;if(Bt!==void 0&&(Number.isNaN(Bt)||Bt<=0)){e({title:"Nmero invlido",description:"Informe um nmero positivo.",variant:"warning"});return}const vr=await uKe({numero:Bt,nome:(st||"").trim()||void 0,codigoEmpresa:t?.codigo_empresa}),yr={id:vr.id,number:vr.numero,name:vr.nome,status:"available",order:[],customer:null,comandaId:null,totalHint:0};o(It=>(It.some(pr=>pr.id===yr.id)?It.map(pr=>pr.id===yr.id?yr:pr):[...It,yr]).slice().sort((pr,ln)=>Number(pr.number)-Number(ln.number))),Ee.startTransition(()=>{l(yr),De(!1)}),e({title:"Mesa criada",description:`Mesa ${vr.numero} adicionada`,variant:"success"}),ke(""),ot("")}catch(or){e({title:"Falha ao criar mesa",description:or?.message||"Tente novamente",variant:"destructive"})}finally{ve(!1)}};return a.jsx(In,{open:me,onOpenChange:or=>{De(or),or||(ke(""),ot(""))},children:a.jsxs(En,{className:"sm:max-w-md w-[92vw]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Nova Mesa"}),a.jsx(Hn,{children:"Informe o nome da mesa. Se deixar em branco, ser criada com numerao automtica."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(it,{htmlFor:"nova-mesa-nome",children:"Nome da mesa"}),a.jsx(Ct,{id:"nova-mesa-nome",type:"text",placeholder:"Ex: Mesa 1, Varanda, etc.",value:st,onChange:or=>ot(or.target.value),onKeyDown:or=>{or.stopPropagation(),or.key==="Enter"&&!ue&&(or.preventDefault(),Nt())},onKeyPress:or=>or.stopPropagation()})]}),a.jsxs(Na,{children:[a.jsx(se,{type:"button",variant:"outline",onClick:()=>De(!1),disabled:ue,children:"Cancelar"}),a.jsx(se,{type:"button",onClick:Nt,disabled:ue,children:ue?"Criando...":"Criar Mesa"})]})]})})},Ta=()=>{const[de,ke]=p.useState([]),[st,ot]=p.useState(new Set),[Nt,or]=p.useState(!1),{userProfile:Bt}=qs(),{toast:vr}=Ss(),yr=async()=>{try{or(!0);const hr=await iKe(Bt?.codigo_empresa);ke(Array.isArray(hr)?hr:[])}catch(hr){vr({title:"Falha ao listar mesas",description:hr?.message||"Tente novamente",variant:"destructive"})}finally{or(!1)}};p.useEffect(()=>{ne&&yr()},[ne]);const It=hr=>{const Zr=new Set(st);Zr.has(hr)?Zr.delete(hr):Zr.add(hr),ot(Zr)},Hr=(de||[]).length>0&&(de||[]).every(hr=>st.has(hr.id)),Vr=()=>{(de||[]).length!==0&&ot(Hr?new Set:new Set((de||[]).map(hr=>hr.id)))},pr=async()=>{const hr=de.filter(Zr=>st.has(Zr.id)&&Zr.status==="available").map(Zr=>Zr.id);if(hr.length===0){vr({title:"Selecione mesas disponveis",variant:"warning"});return}try{for(const Zr of hr)await oKe({mesaId:Zr,codigoEmpresa:Bt?.codigo_empresa});vr({title:"Mesas inativadas",description:`${hr.length} mesa(s)`,variant:"success"});try{await $e({showToast:!1})}catch{}await yr()}catch(Zr){vr({title:"Falha ao inativar",description:Zr?.message||"Tente novamente",variant:"destructive"})}},ln=async()=>{const hr=de.filter(Zr=>st.has(Zr.id)&&Zr.status==="inactive").map(Zr=>Zr.id);if(hr.length===0){vr({title:"Selecione mesas inativas",variant:"warning"});return}try{for(const Zr of hr)await lKe({mesaId:Zr,codigoEmpresa:Bt?.codigo_empresa});vr({title:"Mesas reativadas",description:`${hr.length} mesa(s)`,variant:"success"});try{await $e({showToast:!1})}catch{}await yr()}catch(Zr){vr({title:"Falha ao reativar",description:Zr?.message||"Tente novamente",variant:"destructive"})}};return a.jsx(In,{open:ne,onOpenChange:hr=>{ie(hr),hr||ot(new Set)},children:a.jsxs(En,{className:"sm:max-w-xl w-[92vw]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Gerenciar Mesas"}),a.jsx(Hn,{children:"Selecione mesas e ative/inative."})]}),a.jsxs("div",{className:"space-y-3 max-h-[50vh] overflow-auto thin-scroll",children:[a.jsxs("div",{className:"flex items-center gap-2 px-1",children:[a.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded-sm border border-amber-500/60 bg-black accent-amber-400",checked:Hr,onChange:Vr}),a.jsx("span",{className:"text-sm select-none",children:"Selecionar todas"})]}),Nt?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando..."}):a.jsx("ul",{className:"space-y-1",children:de.map(hr=>{const Zr=String(hr.status||"").toLowerCase(),Pr=Zr==="inactive",cr=Pr?"Inativa":Zr==="available"?"Disponvel":Zr==="occupied"?"Ocupada":Zr==="awaiting-payment"?"Aguardando Pagamento":hr.status||"",Mr=Pr?"bg-slate-500/15 text-slate-300 border border-slate-500/30":Zr==="available"?"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30":"bg-amber-500/15 text-amber-300 border border-amber-500/30";return a.jsxs("li",{className:"flex items-center justify-between gap-3 border border-border/40 rounded px-2 py-1.5",children:[a.jsxs("label",{className:"flex items-center gap-2 select-none min-w-0",children:[a.jsx("input",{type:"checkbox",checked:st.has(hr.id),onChange:()=>It(hr.id),className:"h-4 w-4 rounded-sm border border-amber-500/60 bg-black accent-amber-400"}),a.jsx("span",{className:"text-sm whitespace-nowrap truncate max-w-[55vw] md:max-w-[32rem]",children:hr.nome||`Mesa ${hr.numero}`})]}),a.jsx("span",{className:`text-[11px] px-2 py-0.5 rounded-full font-semibold whitespace-nowrap ${Mr}`,children:cr})]},hr.id)})})]}),a.jsxs(Na,{className:"flex items-center justify-end gap-2",children:[a.jsx(se,{type:"button",variant:"destructive",onClick:pr,disabled:Nt,children:"Inativar"}),a.jsx(se,{type:"button",onClick:ln,disabled:Nt,children:"Ativar"})]})]})})},zn=async de=>{try{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}if(!i?.comandaId){e({title:"Selecione uma mesa",description:"Abra a comanda clicando na mesa primeiro.",variant:"destructive"});return}const ke=Number(de.stock??de.currentStock??0),st=y.get(String(de.id))||0,ot=Math.max(0,ke-st);if(((i?.order||[]).find(hr=>String(hr.productId)===String(de.id))?.quantity||0)+1>ot){e({title:"Estoque insuficiente",description:`${de.name} - Estoque disponvel: ${ot} (${ke} total, ${st} reservado em outras comandas)`,variant:"destructive"});return}const Bt=Number(de.salePrice??de.price??0),yr=(await To({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).find(hr=>String(hr.produto_id)===String(de.id));let It;if(yr){const hr=Number(yr.quantidade||0);await Fd({itemId:yr.id,quantidade:hr+1,codigoEmpresa:t?.codigo_empresa}),It={id:yr.id,productId:yr.produto_id,name:yr.descricao||de.name,price:Bt,quantity:hr+1}}else It=await f3({comandaId:i.comandaId,produtoId:de.id,descricao:de.name,quantidade:1,precoUnitario:Bt,codigoEmpresa:t?.codigo_empresa});const Vr=(await To({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(hr=>({id:hr.id,productId:hr.produto_id,name:hr.descricao||"Item",price:Number(hr.preco_unitario||0),quantity:Number(hr.quantidade||1)})),pr=(Vr||[]).reduce((hr,Zr)=>hr+Number(Zr.price||0)*Number(Zr.quantity||0),0),ln={...i,order:Vr,totalHint:pr};l(ln),o(hr=>hr.map(Zr=>Zr.id===ln.id?ln:Zr));try{const hr=await vh({codigoEmpresa:t?.codigo_empresa}),Zr=new Map;for(const Pr of hr||[]){const cr=String(Pr.produto_id),Mr=Number(Pr.quantidade||0);Zr.set(cr,(Zr.get(cr)||0)+Mr)}v(Zr)}catch(hr){console.error("[addProductToComanda] Erro ao atualizar estoque reservado:",hr)}dt(de.id),setTimeout(()=>{dt(hr=>hr===de.id?null:hr)},500),e({title:"Produto adicionado",variant:"success"})}catch(ke){console.error("[addProductToComanda] EXCEPTION:",ke),e({title:"Falha ao adicionar produto",description:ke?.message||"Tente novamente",variant:"destructive"})}},Fn=()=>{const[de,ke]=p.useState(""),[st,ot]=p.useState("all"),Nt=p.useRef(null),or=p.useRef(0),Bt=p.useRef(null),yr=(J||[]).slice().sort((It,Hr)=>{const Vr=It.code||"",pr=Hr.code||"";return/^\d+$/.test(Vr)&&/^\d+$/.test(pr)?parseInt(Vr,10)-parseInt(pr,10):Vr.localeCompare(pr)}).filter(It=>{const Hr=de.trim().toLowerCase(),Vr=!Hr||(It.name||"").toLowerCase().includes(Hr)||String(It.code||"").toLowerCase().includes(Hr);if(st==="all")return Vr;const pr=Number(It.stock??It.currentStock??0),ln=y.get(String(It.id))||0,hr=Math.max(0,pr-ln);return st==="available"?Vr&&hr>0:st==="low"?Vr&&hr>0&&hr<=5:st==="out"?Vr&&hr<=0:Vr});return i?a.jsx(In,{open:b,onOpenChange:It=>{if(w(It),P(It?"panel":"tables"),It)try{Rr(!1)}catch{}},children:a.jsxs(En,{overlayClassName:"z-[88]",className:"w-[95vw] sm:max-w-4xl max-h-[80vh] sm:max-h-[85vh] flex flex-col p-0 gap-0 focus:outline-none focus-visible:outline-none !overflow-visible z-[89]",style:{scrollBehavior:"auto"},onOpenAutoFocus:It=>{It.preventDefault(),P("panel")},onWheel:It=>{It.stopPropagation()},onKeyDown:It=>{const Hr=It.target,Vr=Hr&&(Hr.tagName==="INPUT"||Hr.closest("input")),pr=Hr&&Hr.closest("[data-product-card]");if(!["ArrowDown","ArrowUp","Home","End","Enter","Delete","Escape"].includes(It.key)||Vr||pr)return;It.preventDefault(),It.stopPropagation();const ln=S||0,hr=yr.length;if(It.key==="ArrowDown"){const Zr=Math.min(ln+1,hr-1);C(Zr),or.current=Zr,requestAnimationFrame(()=>_.current[Zr]?.focus());return}if(It.key==="ArrowUp"){const Zr=Math.max(ln-1,0);C(Zr),or.current=Zr,requestAnimationFrame(()=>_.current[Zr]?.focus());return}if(It.key==="Home"){C(0),or.current=0,requestAnimationFrame(()=>_.current[0]?.focus());return}if(It.key==="End"){const Zr=Math.max(0,hr-1);C(Zr),or.current=Zr,requestAnimationFrame(()=>_.current[Zr]?.focus());return}if(It.key==="Escape"){w(!1);return}},children:[a.jsxs(Cn,{className:"px-6 py-4 border-b border-border",children:[a.jsxs(Nn,{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(Tb,{className:"w-6 h-6 text-brand"}),"Adicionar Produtos"]}),a.jsxs(Hn,{className:"text-base mt-2",children:["Mesa ",i.number,"  ",ee(i.customer)||"Sem cliente"]})]}),a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-border bg-surface/50",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-text-muted"}),a.jsx("input",{ref:Nt,type:"text",className:"w-full pl-10 pr-4 py-3 text-base rounded-lg bg-background border-2 border-border focus:border-brand focus:ring-2 focus:ring-brand/20 transition-all outline-none",placeholder:"Digite o nome ou cdigo do produto...",value:de,onChange:It=>ke(It.target.value),onClick:It=>{It.stopPropagation(),It.currentTarget.focus(),P("panel")},onFocus:It=>{It.stopPropagation(),P("panel")},onKeyDown:It=>{if(It.stopPropagation(),It.nativeEvent&&typeof It.nativeEvent.stopImmediatePropagation=="function"&&It.nativeEvent.stopImmediatePropagation(),P("panel"),["ArrowDown","ArrowUp","Home","End","Escape"].includes(It.key)){It.preventDefault();const Hr=S||0,Vr=yr.length;if(It.key==="ArrowDown"){C(Math.min(Hr+1,Vr-1));return}if(It.key==="ArrowUp"){C(Math.max(Hr-1,0));return}if(It.key==="Home"){C(0);return}if(It.key==="End"){C(Vr-1);return}if(It.key==="Escape"){w(!1);return}}}})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4 mt-3",children:[a.jsx("button",{onClick:()=>ot("all"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${st==="all"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Todos"}),a.jsx("button",{onClick:()=>ot("available"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${st==="available"?"bg-success text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Disponvel"}),a.jsx("button",{onClick:()=>ot("low"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${st==="low"?"bg-warning text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Estoque Baixo"}),a.jsx("button",{onClick:()=>ot("out"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${st==="out"?"bg-destructive text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Sem Estoque"}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2 ml-auto text-xs text-text-muted flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface border border-border rounded text-xs font-mono",children:""}),a.jsx("span",{children:"Navegar"})]}),a.jsx("div",{className:"w-px h-3 bg-border"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface border border-border rounded text-xs font-mono",children:"Esc"}),a.jsx("span",{children:"Fechar"})]})]})]})]}),a.jsx("div",{ref:Bt,className:"flex-1 overflow-y-auto px-6 py-4 focus:outline-none",tabIndex:-1,onKeyDown:It=>{["ArrowDown","ArrowUp","Home","End","PageDown","PageUp","Space"].includes(It.key)&&(It.preventDefault(),It.stopPropagation(),It.nativeEvent&&typeof It.nativeEvent.stopImmediatePropagation=="function"&&It.nativeEvent.stopImmediatePropagation()),It.stopPropagation();const Hr=It.target,Vr=Hr&&(Hr.tagName==="INPUT"||Hr.closest("input"));if(!["ArrowDown","ArrowUp","Home","End","Escape"].includes(It.key)||Vr)return;const pr=S||0,ln=yr.length;if(It.key==="ArrowDown"){const hr=Math.min(pr+1,ln-1);C(hr),or.current=hr,requestAnimationFrame(()=>_.current[hr]?.focus());return}if(It.key==="ArrowUp"){const hr=Math.max(pr-1,0);C(hr),or.current=hr,requestAnimationFrame(()=>_.current[hr]?.focus());return}if(It.key==="Home"){C(0),or.current=0,requestAnimationFrame(()=>_.current[0]?.focus());return}if(It.key==="End"){const hr=Math.max(0,ln-1);C(hr),or.current=hr,requestAnimationFrame(()=>_.current[hr]?.focus());return}if(It.key==="Escape"){w(!1);return}},children:yr.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[a.jsx(Tb,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhum produto encontrado"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Tente ajustar sua busca ou cadastre novos produtos"}),a.jsxs(se,{onClick:()=>{w(!1),n("/produtos")},children:[a.jsx(Es,{className:"w-4 h-4 mr-2"}),"Cadastrar Produtos"]})]}):a.jsx("div",{className:"flex flex-col gap-1.5",children:yr.map((It,Hr)=>{const Vr=(i?.order||[]).reduce((cr,Mr)=>cr+(String(Mr.productId)===String(It.id)?Number(Mr.quantity||0):0),0),pr=Number(It.stock??It.currentStock??0),ln=y.get(String(It.id))||0,hr=Math.max(0,pr-ln),Zr=Hr===S,Pr=It.id===tr;return a.jsxs("div",{ref:cr=>{_.current[Hr]=cr},"data-product-card":!0,className:Sr("flex items-center gap-2 sm:gap-4 p-2.5 sm:p-3 rounded-lg border-2 transition-colors duration-500 outline-none focus:outline-none focus-visible:outline-none",hr===0&&Vr===0?"opacity-50 cursor-not-allowed bg-surface-2 border-border":"cursor-pointer",Zr?"border-brand bg-brand/5 shadow-md":hr>0?"border-border bg-surface hover:border-brand/50 hover:bg-surface-2":Vr>0?"border-border bg-surface":"border-border",Pr&&"bg-brand/8"),tabIndex:hr>0||Vr>0?0:-1,onKeyDown:cr=>{if(["ArrowDown","ArrowUp","Home","End","PageDown","PageUp","Space"].includes(cr.key)&&(cr.preventDefault(),cr.stopPropagation(),cr.nativeEvent&&typeof cr.nativeEvent.stopImmediatePropagation=="function"&&cr.nativeEvent.stopImmediatePropagation()),!["ArrowDown","ArrowUp","Home","End","Escape"].includes(cr.key))return;cr.stopPropagation();const Mr=yr.length;if(cr.key==="ArrowDown"){const bn=Math.min(Hr+1,Mr-1);C(bn),or.current=bn,requestAnimationFrame(()=>_.current[bn]?.focus());return}if(cr.key==="ArrowUp"){const bn=Math.max(Hr-1,0);C(bn),or.current=bn,requestAnimationFrame(()=>_.current[bn]?.focus());return}if(cr.key==="Home"){C(0),or.current=0,requestAnimationFrame(()=>_.current[0]?.focus());return}if(cr.key==="End"){const bn=Math.max(0,Mr-1);C(bn),or.current=bn,requestAnimationFrame(()=>_.current[bn]?.focus());return}if(cr.key==="Escape"){w(!1);return}},onClick:()=>{hr===0&&Vr===0||(C(Hr),or.current=Hr,requestAnimationFrame(()=>_.current[Hr]?.focus()))},onMouseDown:cr=>{if(hr===0&&Vr===0){cr.preventDefault();return}cr.currentTarget.focus()},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[It.code&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-mono font-semibold bg-surface-2 border border-border rounded",children:It.code}),a.jsx("h4",{className:"font-semibold text-sm sm:text-base text-text-primary truncate",children:It.name})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] sm:text-xs mt-0.5",children:[a.jsx("span",{className:Sr("font-bold",hr===0?"text-text-muted":"text-brand"),children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(It.salePrice??It.price??0))}),a.jsxs("span",{className:"text-text-muted whitespace-nowrap",children:["Estoque: ",a.jsx("span",{className:Sr("font-semibold",hr<=5?"text-destructive":"text-text-secondary"),children:hr})]}),Vr>0&&a.jsxs("span",{className:"px-2 py-0.5 bg-brand/10 text-brand text-[11px] font-semibold rounded whitespace-nowrap",children:[Vr,"x na comanda"]})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[a.jsx(se,{size:"icon",variant:"outline",onClick:cr=>{cr.stopPropagation(),Ar(It)},disabled:Vr===0,className:"h-8 w-8 p-0",children:a.jsx(hv,{className:"w-4 h-4"})}),a.jsx(se,{size:"icon",onClick:cr=>{cr.stopPropagation(),zn(It)},disabled:hr===0,className:"h-8 w-8 p-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",children:a.jsx(Es,{className:"w-4 h-4"})})]})]},It.id)})},(i?.order||[]).map(It=>`${String(It.productId)}:${Number(It.quantity||0)}`).join("|"))}),a.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-t border-border bg-surface/50",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2",children:[a.jsxs("div",{className:"hidden sm:block text-sm text-text-muted",children:[yr.length," produto",yr.length!==1?"s":"","  ",(i.order||[]).length," ite",(i.order||[]).length!==1?"ns":"m"," na comanda"]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 w-full sm:w-auto",children:[a.jsxs("div",{className:"text-left sm:text-right",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Total"}),a.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.totalHint||0)})]}),a.jsx(se,{onClick:()=>w(!1),className:"px-4 sm:px-6 min-w-[96px] sm:min-w-[120px]",size:"sm",children:"Concluir"})]})]})})]})]})}):null},[en,Wa]=p.useState(null),[Ya,za]=p.useState([]),[vs,Os]=p.useState(!1),[ss,Io]=p.useState(""),[Vs,ii]=p.useState(!1),[Rl,li]=p.useState([]),[pl,Fc]=p.useState(!1),[mc,ci]=p.useState(null),[Lc,Ks]=p.useState([]),[_o,$c]=p.useState(!1),[gl,_i]=p.useState(null),ts=p.useRef(null);p.useEffect(()=>{ts.current=en},[en]);const xl=p.useMemo(()=>{const de=new Map;for(const ke of Ya||[]){const st=ke.productId,ot=Number(ke.quantity||0);de.set(st,(de.get(st)||0)+ot)}return de},[Ya]),Ba=async de=>{if(!de)return;const st=(await To({comandaId:de,codigoEmpresa:t?.codigo_empresa})||[]).map(ot=>({id:ot.id,productId:ot.produto_id,name:ot.descricao||"Item",price:Number(ot.preco_unitario||0),quantity:Number(ot.quantidade||1)}));za(st)},Qi=async de=>{try{const ke=t?.codigo_empresa;if(!ke){e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}let st=en;if(!st){if(st=(await Tj({codigoEmpresa:ke}))?.id,!st){e({title:"Falha ao iniciar venda no balco",description:"No foi possvel criar ou recuperar a comanda.",variant:"destructive"});return}Wa(st)}const ot=Number(de.salePrice??de.price??0);await f3({comandaId:st,produtoId:de.id,descricao:de.name,quantidade:1,precoUnitario:ot,codigoEmpresa:ke}),await Ba(st),e({title:"Produto adicionado (balco)",description:de.name,variant:"success"})}catch(ke){e({title:"Falha ao adicionar produto (balco)",description:ke?.message||"Tente novamente",variant:"destructive"})}},Xr=async de=>{if(!(!en||!de)){ii(!1);try{await Jb({comandaId:en,clienteIds:[de],nomesLivres:[],codigoEmpresa:t?.codigo_empresa}),ci(de),Ks(ke=>{const st=new Set((ke||[]).map(ot=>String(ot)));return st.add(String(de)),Array.from(st)}),Io(""),li([]),e({title:"Cliente associado",variant:"success"})}catch(ke){e({title:"Falha ao associar cliente",description:ke?.message||"Tente novamente",variant:"destructive"}),ii(!0)}}},fu=async()=>{if(en)try{const de=Te(Ya,null);if(de<=0){e({title:"Sem itens",description:"Adicione itens antes de pagar.",variant:"warning"});return}Os(!0),await im({codigoEmpresa:t?.codigo_empresa});let ke=Fe;if(!Array.isArray(ke)||ke.length===0)try{ke=await Ah({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa}),xt(ke)}catch{}const st=ke?.[0],ot=st?.tipo||st?.nome||"outros";await PR({comandaId:en,finalizadoraId:st?.id,metodo:ot,valor:de,codigoEmpresa:t?.codigo_empresa}),await T0({comandaId:en,codigoEmpresa:t?.codigo_empresa}),e({title:"Pagamento registrado (balco)",description:`R$ ${de.toFixed(2)}`,variant:"success"}),za([]),Wa(null),m(!1)}catch(de){e({title:"Falha no pagamento (balco)",description:de?.message||"Tente novamente",variant:"destructive"})}finally{Os(!1)}},vl=()=>{p.useEffect(()=>{let ke=!0;return(async()=>{if(h)try{Os(!0);const ot=t?.codigo_empresa;if(!ot){ke&&e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}const Nt=await Nv({codigoEmpresa:ot});if(!ke)return;if(Nt?.id){Wa(Nt.id),await Ba(Nt.id);try{const or=await Bi({comandaId:Nt.id,codigoEmpresa:ot}),Bt=(or||[]).map(yr=>yr?.cliente_id).filter(Boolean).map(yr=>String(yr));Ks(Bt);const vr=Array.isArray(or)&&or.length>0?or[0]:null;vr?.cliente_id&&ci(vr.cliente_id)}catch{}}else Wa(null),za([])}catch(ot){ke&&e({title:"Falha ao abrir Modo Balco",description:ot?.message||"Tente novamente",variant:"destructive"})}finally{ke&&Os(!1)}})(),()=>{ke=!1}},[h]),p.useEffect(()=>{if(!Vs)return;let ke=!0;const ot=setTimeout(async()=>{try{Fc(!0);const Nt=await Yb({searchTerm:ss,limit:20,codigoEmpresa:t?.codigo_empresa});ke&&li(Nt||[])}catch{ke&&li([])}finally{ke&&Fc(!1)}},250);return()=>{ke=!1,clearTimeout(ot)}},[Vs,ss]);const de=Te(Ya,null);return a.jsx(In,{open:h,onOpenChange:m,children:a.jsxs(En,{className:"max-w-4xl h-[90vh]",onKeyDown:ke=>ke.stopPropagation(),onKeyDownCapture:ke=>ke.stopPropagation(),onPointerDownOutside:ke=>ke.stopPropagation(),onInteractOutside:ke=>ke.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Modo Balco"}),a.jsx(Hn,{children:"Venda rpida para clientes sem mesa."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-6 h-full overflow-hidden pt-4",children:[a.jsxs("div",{className:"col-span-1 flex flex-col border-r border-border pr-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Catlogo de Produtos"}),a.jsx(se,{variant:"outline",size:"sm",onClick:()=>ii(!0),children:mc?a.jsxs(a.Fragment,{children:[a.jsx(vi,{className:"mr-1 h-4 w-4 text-success"})," Cliente"]}):"Cliente"})]}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar produto...",className:"pl-9",value:ss,onChange:ke=>Io(ke.target.value),ref:j})]}),a.jsx("div",{className:"flex-1 overflow-y-auto -mr-4 pr-4 thin-scroll",children:a.jsxs("ul",{className:"space-y-2",children:[(J||[]).filter(ke=>{const st=ss.trim().toLowerCase();return st?(ke.name||"").toLowerCase().includes(st)||(ke.code||"").toLowerCase().includes(st):!0}).sort((ke,st)=>{const ot=ke.code||"",Nt=st.code||"";return/^\d+$/.test(ot)&&/^\d+$/.test(Nt)?parseInt(ot,10)-parseInt(Nt,10):ot.localeCompare(Nt)}).map(ke=>{const st=(Ya||[]).reduce((Bt,vr)=>Bt+(String(vr.productId)===String(ke.id)?Number(vr.quantity||0):0),0),ot=Number(ke.stock??ke.currentStock??0),Nt=y.get(String(ke.id))||0,or=Math.max(0,ot-Nt);return a.jsxs("li",{className:"flex items-center p-2 rounded-md hover:bg-surface-2 transition-colors",onClick:()=>{_i(ke),$c(!0)},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"font-semibold truncate",title:`${ke.code?`[${ke.code}] `:""}${ke.name}`,children:[ke.code&&a.jsxs("span",{className:"text-text-muted",children:["[",ke.code,"]"]})," ",ke.name]}),st>0&&a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-brand/15 text-brand border border-brand/30 flex-shrink-0",children:["x",st]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["R$ ",Number(ke.salePrice??ke.price??0).toFixed(2)]}),a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-surface-2 text-text-secondary border border-border flex-shrink-0",children:["Qtd ",or]})]})]}),a.jsx(se,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:Bt=>{Bt.stopPropagation(),Qi(ke)},"aria-label":`Adicionar ${ke.name}`,children:a.jsx(Es,{size:16})})]},ke.id)}),(!J||J.length===0)&&a.jsxs("li",{className:"text-center text-text-muted py-8",children:[a.jsx("div",{className:"mb-3",children:"Nenhum produto cadastrado. Cadastre produtos para vender no balco."}),a.jsx(se,{size:"sm",onClick:()=>n("/produtos"),children:"Cadastrar Produtos"})]})]})})]}),a.jsxs("div",{className:"col-span-1 flex flex-col",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Comanda do Balco"}),a.jsx("div",{className:"flex-1 overflow-y-auto bg-surface-2 rounded-lg p-4 thin-scroll",children:Ya.length===0?a.jsx("p",{className:"text-center text-text-muted pt-16",children:"Adicione produtos  comanda."}):a.jsx("ul",{className:"divide-y divide-border",children:Ya.map(ke=>a.jsxs("li",{className:"py-2 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:ke.name}),a.jsxs("div",{className:"text-xs text-text-muted",children:["Qtd: ",ke.quantity,"  Unit: R$ ",Number(ke.price||0).toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"font-semibold mr-2",children:["R$ ",(Number(ke.price||0)*Number(ke.quantity||0)).toFixed(2)]}),a.jsx(se,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:async()=>{const st=Number(ke.quantity||1)-1;if(st<=0)$(ke),he(!0),setTimeout(async()=>{Y||await Ba(en)},100);else try{await Fd({itemId:ke.id,quantidade:st,codigoEmpresa:t?.codigo_empresa}),await Ba(en)}catch(ot){e({title:"Falha ao atualizar",description:ot?.message||"Tente novamente",variant:"destructive"})}},children:a.jsx(hv,{size:14})}),a.jsx("span",{className:"w-8 text-center font-semibold",children:ke.quantity}),a.jsx(se,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:async()=>{try{await Fd({itemId:ke.id,quantidade:Number(ke.quantity||1)+1,codigoEmpresa:t?.codigo_empresa}),await Ba(en)}catch(st){e({title:"Falha ao atualizar",description:st?.message||"Tente novamente",variant:"destructive"})}},children:a.jsx(Es,{size:14})})]})]},ke.id))})}),a.jsxs("div",{className:"p-4 border-t border-border mt-auto",children:[a.jsxs("div",{className:"flex justify-between items-center text-xl font-bold mb-4",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",de.toFixed(2)]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(ku,{children:[a.jsx(gg,{asChild:!0,children:a.jsx(se,{size:"lg",className:"flex-1 bg-red-600 hover:bg-red-500 text-white border border-red-600/70",children:"Cancelar"})}),a.jsxs(Bd,{className:"sm:max-w-[420px] animate-none",onKeyDown:ke=>ke.stopPropagation(),children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Cancelar comanda do balco?"}),a.jsx(Vd,{children:"Os itens sero descartados e o balco ser limpo. Esta ao no pode ser desfeita."})]}),a.jsxs(zd,{children:[a.jsx(Wd,{children:"Voltar"}),a.jsx(Iu,{onClick:async()=>{try{if(!en){m(!1);return}await Uz({comandaId:en,codigoEmpresa:t?.codigo_empresa}),za([]),Wa(null),m(!1),e({title:"Comanda cancelada (balco)",variant:"success"})}catch(ke){e({title:"Falha ao cancelar",description:ke?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar Cancelamento"})]})]})]}),a.jsxs(se,{size:"lg",className:"flex-1",onClick:fu,disabled:vs||de<=0,children:[a.jsx(Oi,{className:"mr-2"})," Finalizar Pagamento"]})]})]})]})]}),Vs&&a.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center",onClick:ke=>{ke.target===ke.currentTarget&&ii(!1)},onKeyDown:ke=>{ke.key==="Escape"&&ii(!1)},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border shadow-lg w-full max-w-md p-4",role:"dialog","aria-modal":"true",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"text-lg font-semibold",children:"Selecionar Cliente"}),a.jsx(se,{variant:"ghost",size:"sm",onClick:()=>ii(!1),children:"Fechar"})]}),a.jsxs("div",{className:"relative mb-2",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Nome, e-mail, telefone ou cdigo",className:"pl-9",value:ss,onChange:ke=>Io(ke.target.value)})]}),a.jsx("div",{className:"max-h-64 overflow-auto thin-scroll border rounded-md",children:pl?a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Carregando clientes..."}):Rl.length>0?a.jsx("ul",{children:Rl.map(ke=>{const st=Array.isArray(Lc)&&Lc.includes(String(ke.id));return a.jsxs("li",{className:Sr("p-2 flex items-center justify-between cursor-pointer hover:bg-surface-2",st&&"bg-surface-2"),onClick:()=>Xr(ke.id),children:[a.jsx("div",{children:a.jsxs("div",{className:"font-medium",children:[ke.codigo!=null?String(ke.codigo)+" - ":"",ke.nome]})}),st&&a.jsx(vi,{size:16,className:"text-success"})]},ke.id)})}):a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum cliente encontrado."})})]})})]})})},Xo=()=>{const de=gl,ke=de&&xl.get(de.id)||0,st=de?Number(de.salePrice??de.price??0):0,ot=Nt=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Nt||0));return a.jsx(In,{open:_o,onOpenChange:Nt=>{$c(Nt),Nt||_i(null)},children:a.jsxs(En,{className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[61]",onKeyDown:Nt=>Nt.stopPropagation(),onPointerDownOutside:Nt=>Nt.stopPropagation(),onInteractOutside:Nt=>Nt.stopPropagation(),onEscapeKeyDown:Nt=>{Nt.preventDefault(),Nt.stopPropagation()},children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold break-words",title:de?.name||"",children:de?.name||"Produto"}),a.jsx(Hn,{children:"Detalhes do produto (Balco)."})]}),de?a.jsxs("div",{className:"space-y-3 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:ot(st)})]}),de.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:de.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof de.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:de.stock})]}),typeof de.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:de.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",ke]})]})]})]}):null,a.jsxs(Na,{className:"flex items-center justify-between gap-2",children:[a.jsxs(se,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{de&&n("/produtos",{state:{productId:de.id,productName:de.name}})},children:[a.jsx(Vi,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(se,{variant:"outline",onClick:()=>{$c(!1),_i(null)},children:"Fechar"}),a.jsx(se,{onClick:async()=>{de&&(await Qi(de),$c(!1),_i(null))},children:"Adicionar"})]})]})})},Zi=()=>{const[de,ke]=p.useState(""),[st,ot]=p.useState(!1),[Nt,or]=p.useState([]),[Bt,vr]=p.useState([]),[yr,It]=p.useState(0),[Hr,Vr]=p.useState(!1),[pr,ln]=p.useState(0),hr=p.useRef([]),Zr=p.useRef(null),Pr=p.useRef(null),cr=p.useRef(null),Mr=p.useRef(null),bn=p.useRef(0),ca=p.useRef(0);p.useEffect(()=>{let cn=!0;return(async()=>{try{ot(!0);const tn=await Yb({searchTerm:de,limit:20});if(!cn)return;const An=(tn||[]).slice(),dn=String(de||"").trim().toLowerCase(),Yn=Ir=>{const wn=String(Ir?.nome||"").toLowerCase();return dn?wn.startsWith(dn)?0:wn.includes(dn)?1:2:2};An.sort((Ir,wn)=>{const wr=Yn(Ir),Wr=Yn(wn);if(wr!==Wr)return wr-Wr;const D=Number(Ir?.codigo||0),Q=Number(wn?.codigo||0);return D-Q}),or(An),ln(0)}catch{if(!cn)return;or([])}finally{cn&&ot(!1)}})(),()=>{cn=!1}},[de]);const os=p.useRef(!1);p.useEffect(()=>{try{ht&&!os.current&&(os.current=!0,cr.current&&(cr.current.scrollTop=0),Zr.current&&(Zr.current.scrollTop=0),Pr.current&&(Pr.current.scrollTop=0)),ht||(os.current=!1)}catch{}},[ht]),p.useEffect(()=>{try{ht&&Array.isArray(Nt)&&Nt.length>0&&(ln(0),setTimeout(()=>{try{Zr.current?.focus(),Pr.current&&(Pr.current.scrollTop=0)}catch{}},0))}catch{}},[ht,Nt.length]);const ys=async(cn=null)=>{try{if(!Pt)return;vt(!0);const Kr=await hKe({mesaId:Pt.id,codigoEmpresa:t?.codigo_empresa}),An=Array.isArray(cn)?cn:Bt,dn=Array.isArray(An)?Array.from(new Set(An)):[];let Yn=[],Ir=Math.max(0,Number(yr||0));dn.length===0&&Ir===0&&(Ir=1);for(let Wr=0;Wr<Ir;Wr++)Yn.push("Consumidor");await Jb({comandaId:Kr.id,clienteIds:dn,nomesLivres:Yn,codigoEmpresa:t?.codigo_empresa,replace:!0});let wn=null;try{const Wr=await Bi({comandaId:Kr.id,codigoEmpresa:t?.codigo_empresa}),Q=(Array.isArray(Wr)?Wr:[]).map(M=>M?.nome).filter(Boolean);wn=Q.length?Q.join(", "):null}catch(Wr){console.error("[confirmOpen] Erro ao buscar vnculos:",Wr)}if(!wn){const Wr=Array.isArray(dn)?dn:[],D=Array.isArray(Nt)?Nt:[];wn=Wr.length?Wr.map(Q=>D.find(M=>M.id===Q)?.nome).filter(Boolean).join(", "):Yn.length>0?Yn.join(", "):""}const wr={...Pt,comandaId:Kr.id,status:"in-use",customer:wn||null,order:[]};l(wr),o(Wr=>Wr.map(D=>D.id===wr.id?wr:D)),await new Promise(Wr=>setTimeout(Wr,500));try{const Wr=await Ph(t?.codigo_empresa),D=await rd({codigoEmpresa:t?.codigo_empresa}),Q={},M={},H=Array.isArray(D)?D:[];await Promise.all(H.map(async X=>{try{const Ce=await Bi({comandaId:X.id,codigoEmpresa:t?.codigo_empresa}),Z=(Array.isArray(Ce)?Ce:[]).map(bt=>bt?.nome).filter(Boolean);Q[X.id]=Z.length?Z.join(", "):null;const ye=await To({comandaId:X.id,codigoEmpresa:t?.codigo_empresa}),Re=(Array.isArray(ye)?ye:[]).reduce((bt,Rt)=>{const dr=(Rt.quantidade||0)*(Rt.preco_unitario||0)-(Rt.desconto||0);return bt+dr},0);M[X.id]=Re}catch(Ce){console.error("[confirmOpen] Erro ao buscar dados da comanda:",Ce),Q[X.id]=null,M[X.id]=0}}));const le=(Wr||[]).map(X=>{const Ce=(D||[]).find(Z=>Z.mesa_id===X.id),we=Ce?Q[Ce.id]!==null?Q[Ce.id]:wn:null;return{id:X.id,name:X.nome||`Mesa ${X.numero}`,status:Ce?"in-use":"available",comandaId:Ce?.id||null,customer:we,order:[],totalHint:Ce&&M[Ce.id]||0,aberto_em:Ce?.aberto_em||null}});o(le)}catch(Wr){console.error("[confirmOpen] Erro ao atualizar mesas:",Wr)}pt(!1),Lt(null),fr(""),vr([]),It(0),Vr(!1),e({title:"Mesa aberta",description:wn?`Comanda criada para: ${wn}`:"Comanda criada.",variant:"success"})}catch(Kr){console.error("[confirmOpen] Falha ao abrir mesa:",Kr?.message||Kr,Kr?.stack),e({title:"Falha ao abrir mesa",description:Kr?.message||"Tente novamente",variant:"destructive"})}finally{vt(!1)}};return a.jsx(In,{open:ht,onOpenChange:cn=>{pt(cn),cn||(Lt(null),fr(""),vr([]),It(0),Vr(!1))},children:a.jsxs(En,{className:"w-[95vw] max-w-md h-[560px] max-h-[75vh] flex flex-col animate-none overflow-hidden",onOpenAutoFocus:cn=>cn.preventDefault(),onPointerDownOutside:cn=>{cn.preventDefault(),cn.stopPropagation()},onInteractOutside:cn=>{cn.preventDefault(),cn.stopPropagation()},onEscapeKeyDown:cn=>{cn.preventDefault(),pt(!1)},onKeyDown:cn=>{cn.key==="Escape"&&(cn.preventDefault(),cn.stopPropagation(),pt(!1))},ref:cr,children:[a.jsxs(Cn,{className:"flex-shrink-0",children:[a.jsxs(Nn,{className:"text-xl font-bold",children:["Abrir Mesa ",Pt?`#${Pt.number}`:""]}),a.jsx(Hn,{className:"text-sm",children:"Selecione um ou mais clientes para a mesa."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto thin-scroll min-h-0 space-y-2 py-2",ref:Pr,children:[a.jsxs("div",{children:[a.jsx(it,{className:"text-sm font-medium mb-1.5 block",children:"Buscar cliente"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Mo,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Nome, telefone ou cdigo",className:"pl-8 h-9 text-sm",value:de,ref:Mr,onChange:cn=>{ca.current=Date.now(),ke(cn.target.value)},onKeyDown:cn=>{if(cn.key==="Enter"){cn.preventDefault();try{if(Array.isArray(Nt)&&Nt.length>0){const Kr=Math.min(Math.max(pr||0,0),Nt.length-1),tn=Nt[Kr];tn?.id&&vr(An=>An.includes(tn.id)?An.filter(dn=>dn!==tn.id):[...An,tn.id])}}catch{}ke(""),setTimeout(()=>{try{Zr.current?.focus()}catch{}},0)}else ca.current=Date.now()}})]}),a.jsx(se,{type:"button",size:"icon",title:"Cadastrar cliente",className:"h-9 w-9 flex-shrink-0 bg-brand text-black hover:bg-brand/90",onClick:()=>{window.location.href="/clientes"},children:a.jsx(Es,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"mt-1.5 text-[12px] text-text-muted flex items-center gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:""})," seleciona"]}),a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:""})," desmarca"]}),a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:"Enter"})," confirma"]}),a.jsx("span",{className:"inline-flex items-center gap-1",children:"Digite para buscar"})]})]}),a.jsx("div",{className:"min-h-[8px]",children:Bt.length>0&&a.jsxs("div",{className:"bg-success/10 border border-success/30 rounded-md p-2.5",children:[a.jsxs("div",{className:"text-xs font-medium text-success mb-1",children:[Bt.length," cliente",Bt.length>1?"s":""," selecionado",Bt.length>1?"s":""]}),a.jsx("div",{className:"text-sm text-text-primary",children:Nt.filter(cn=>Bt.includes(cn.id)).map(cn=>cn.nome).join(", ")})]})}),a.jsx("div",{className:"border rounded-md focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0",role:"listbox","aria-label":"Clientes","aria-activedescendant":Nt&&Nt.length>0&&Nt[pr]&&Nt[pr].id?`ot-option-${Nt[pr].id}`:void 0,ref:Zr,tabIndex:0,onKeyDown:cn=>{try{if(cn.key&&cn.key.length===1&&!cn.ctrlKey&&!cn.metaKey&&!cn.altKey||cn.key==="Backspace"){cn.preventDefault(),cn.stopPropagation();let tn=String(de||"");cn.key==="Backspace"?tn=tn.slice(0,-1):tn+=cn.key,ke(tn),ca.current=Date.now();try{Pr.current&&(Pr.current.scrollTop=0)}catch{}setTimeout(()=>{try{if(Mr.current){Mr.current.focus();const An=tn.length;Mr.current.setSelectionRange?.(An,An)}}catch{}},0);return}if(["ArrowDown","ArrowUp","Home","End","ArrowRight","ArrowLeft"," "].includes(cn.key)){let tn=pr||0;const An=Nt.length;cn.key==="ArrowDown"&&(tn=Math.min(tn+1,An-1)),cn.key==="ArrowUp"&&(tn=Math.max(tn-1,0)),cn.key==="Home"&&(tn=0),cn.key==="End"&&(tn=An-1),ln(tn),setTimeout(()=>{try{hr.current[tn]?.scrollIntoView({block:"nearest"})}catch{}},0);const dn=Nt[tn],Yn=dn?.codigo===0;if(cn.key==="ArrowRight"&&dn?.id&&(Yn?(Vr(!0),It(Ir=>Ir+1)):(fr(""),vr(Ir=>Ir.includes(dn.id)?Ir:[...Ir,dn.id]))),cn.key==="ArrowLeft"&&dn?.id)if(Yn){const Ir=Math.max(0,yr-1);It(Ir),Ir===0&&Vr(!1)}else vr(Ir=>Ir.filter(wn=>wn!==dn.id));cn.key===" "&&dn?.id&&(fr(""),vr(Ir=>Ir.includes(dn.id)?Ir.filter(wn=>wn!==dn.id):[...Ir,dn.id]));return}if(cn.key==="Enter"){cn.preventDefault();const tn=Math.min(Math.max(pr||0,0),Nt.length-1),An=Nt[tn];if(Date.now()-ca.current<600||document.activeElement===Mr.current||de&&de.length>0){An?.id&&(fr(""),vr(Ir=>Ir.includes(An.id)?Ir.filter(wn=>wn!==An.id):[...Ir,An.id])),ke(""),setTimeout(()=>{try{Zr.current?.focus(),Pr.current&&(Pr.current.scrollTop=0)}catch{}},0);return}if(An?.id){const Ir=Bt.includes(An.id)?Bt:[...Bt,An.id];Bt.includes(An.id)||vr(wn=>[...wn,An.id]),setTimeout(()=>{try{ys(Ir)}catch{}},0);return}setTimeout(()=>{try{ys(Bt)}catch{}},0);return}}catch{}},children:st?a.jsx("div",{className:"p-3 text-center text-sm text-text-muted",children:"Carregando..."}):Nt.length>0?a.jsx("ul",{className:"divide-y divide-border",children:Nt.map((cn,Kr)=>{const tn=cn.codigo===0,An=Bt.includes(cn.id),dn=Kr===(pr||0),Yn=tn?yr:0;return a.jsxs("li",{id:`ot-option-${cn.id}`,ref:Ir=>{hr.current[Kr]=Ir},role:"option","aria-selected":dn,className:Sr("p-2.5 flex items-center gap-2 cursor-pointer transition-colors outline-none focus:outline-none focus-visible:outline-none border border-transparent",tn?"bg-amber-500/5 border-l-2 border-l-amber-500/40":"",An&&!tn?"bg-success/10 hover:bg-success/15":"hover:bg-surface-2",Hr&&tn?"bg-amber-500/10":"",dn?"bg-brand/10":""),onClick:()=>{tn?Hr||(Vr(!0),It(1)):(fr(""),vr(Ir=>Ir.includes(cn.id)?Ir.filter(wn=>wn!==cn.id):[...Ir,cn.id]))},onDoubleClick:()=>{if(!tn){const Ir=Bt.includes(cn.id)?Bt:[...Bt,cn.id];vr(Ir),setTimeout(()=>{try{ys(Ir)}catch{}},0)}},onMouseEnter:()=>{Date.now()-(bn.current||0)>300&&ln(Kr)},tabIndex:-1,children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[!tn&&a.jsx("span",{className:Sr("w-2 h-2 rounded-full flex-shrink-0",An?"bg-success":dn?"bg-brand":"bg-border")}),a.jsxs("div",{className:"font-medium text-sm truncate",children:[cn.codigo!=null&&cn.codigo!==0?`${cn.codigo} - `:"",cn.nome,tn&&a.jsx("span",{className:"ml-2 text-xs text-amber-600",children:"Cliente Padro"})]})]}),tn?Hr?a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx(se,{type:"button",size:"sm",variant:"ghost",className:"h-7 w-7 p-0 hover:bg-red-500/10",onClick:Ir=>{Ir.stopPropagation();const wn=Math.max(0,yr-1);It(wn),wn===0&&Vr(!1)},children:a.jsx(hv,{className:"h-4 w-4"})}),a.jsx("div",{className:"w-8 h-7 flex items-center justify-center bg-surface-2 rounded text-sm font-medium",children:Yn}),a.jsx(se,{type:"button",size:"sm",variant:"ghost",className:"h-7 w-7 p-0 hover:bg-green-500/10",onClick:Ir=>{Ir.stopPropagation(),It(wn=>wn+1)},children:a.jsx(Es,{className:"h-4 w-4"})})]}):null:a.jsx("div",{className:"ml-2 flex-shrink-0",children:An?a.jsx(vi,{size:18,className:"text-success"}):a.jsx("div",{className:"w-[18px] h-[18px] rounded-full border-2 border-border"})})]},cn.id)})}):a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:"Nenhum cliente encontrado"})})]}),a.jsxs(Na,{className:"flex-shrink-0 pt-3",children:[a.jsx(se,{type:"button",variant:"outline",onClick:()=>{pt(!1),Lt(null),fr(""),vr([])},children:"Cancelar"}),a.jsx(se,{onClick:()=>ys(),disabled:!Pt||Ze,children:Ze?"Abrindo...":"Confirmar Abertura"})]})]})})},R=()=>{const[de,ke]=p.useState("");return p.useEffect(()=>{xr.current&&ke(xr.current)},[]),a.jsxs(a.Fragment,{children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Abrir Caixa"}),a.jsx(Vd,{children:"Insira o valor inicial (suprimento) para abrir o caixa."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(it,{htmlFor:"initial-value",children:"Valor Inicial"}),a.jsxs("div",{className:"relative mt-2",children:[a.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:"R$"}),a.jsx(Ct,{id:"initial-value",type:"text",inputMode:"numeric",pattern:"[0-9.,]*",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,name:"cash-open-initial",placeholder:"0,00",className:"pl-9 font-semibold",value:de,onChange:st=>{const ot=(st.target.value||"").replace(/\D/g,""),Nt=ot?Number(ot)/100:0,or=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Nt);ke(or),xr.current=or},onKeyDown:st=>{st.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(st.key)&&(/^[0-9]$/.test(st.key)||st.preventDefault())},onBeforeInput:st=>{const ot=st.data??"";ot&&/\D/.test(ot)&&st.preventDefault()},onMouseDown:st=>st.stopPropagation()})]})]}),a.jsxs(zd,{children:[a.jsx(Wd,{onClick:()=>Yt(!1),children:"Cancelar"}),a.jsx(Iu,{onClick:async()=>{if(!Jt){kr(!0);try{const st=String(de).replace(/\./g,"").replace(",","."),ot=Number(st)||0;try{localStorage.setItem("cash:opening",String(Date.now()))}catch{}await im({saldoInicial:ot,codigoEmpresa:t?.codigo_empresa}),await Tr(),await $e({showToast:!1}),Yt(!1),e({title:"Caixa aberto com sucesso!",variant:"success"}),xr.current="",ke("")}catch(st){e({title:"Falha ao abrir caixa",description:st?.message||"Tente novamente",variant:"destructive"})}finally{try{localStorage.removeItem("cash:opening")}catch{}kr(!1)}}},children:"Confirmar Abertura"})]})]})},pe=()=>a.jsxs(ku,{open:et,onOpenChange:Yt,children:[a.jsx(gg,{asChild:!0,children:a.jsxs(se,{variant:"success",size:"sm",disabled:c||Jt,onClick:()=>Yt(!0),className:"px-3 whitespace-nowrap",children:[a.jsx(NG,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Abrir"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Abrir Caixa"}),a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-emerald-700 border border-emerald-800 rounded shadow-sm",children:"F10"})]})}),a.jsx(Bd,{className:"sm:max-w-[425px] animate-none",onKeyDown:de=>de.stopPropagation(),onKeyDownCapture:de=>de.stopPropagation(),onEscapeKeyDown:de=>de.preventDefault(),onPointerDownOutside:de=>{de.preventDefault(),de.stopPropagation()},onInteractOutside:de=>{de.preventDefault(),de.stopPropagation()},children:a.jsx(R,{})})]}),He=()=>{const[de,ke]=p.useState({loading:!1,saldoInicial:0,resumo:null}),[st,ot]=p.useState(!1),[Nt,or]=p.useState(!1),[Bt,vr]=p.useState(!1),[yr,It]=p.useState(!1),[Hr,Vr]=p.useState(""),pr=async()=>{try{ke({loading:!0,saldoInicial:0,resumo:null});const Pr=await Eh({codigoEmpresa:t?.codigo_empresa}),cr=await j1({codigoEmpresa:t?.codigo_empresa});ke({loading:!1,saldoInicial:Number(Pr?.saldo_inicial||0),resumo:cr||{totalPorFinalizadora:{}}})}catch{ke({loading:!1,saldoInicial:0,resumo:{totalPorFinalizadora:{}}})}},ln=de?.resumo?.totalPorFinalizadora||{},hr=Object.values(ln).reduce((Pr,cr)=>Pr+Number(cr||0),0),Zr=Number(de.saldoInicial||0)+hr;return a.jsxs(a.Fragment,{children:[a.jsxs(ku,{open:st,onOpenChange:Pr=>{ot(Pr),Pr&&pr()},children:[a.jsx(gg,{asChild:!0,children:a.jsxs(se,{variant:"destructive",size:"sm",disabled:!c,onClick:()=>ot(!0),className:"px-3 whitespace-nowrap",children:[a.jsx(e0,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Fechar"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Fechar Caixa"})]})}),a.jsxs(Bd,{className:"sm:max-w-[425px] w-[92vw] max-h-[85vh] animate-none",onOpenAutoFocus:Pr=>Pr.preventDefault(),onKeyDown:Pr=>Pr.stopPropagation(),onKeyDownCapture:Pr=>Pr.stopPropagation(),onPointerDownOutside:Pr=>{Pr.preventDefault(),Pr.stopPropagation()},onInteractOutside:Pr=>{Pr.preventDefault(),Pr.stopPropagation()},children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Fechar Caixa"}),a.jsx(Vd,{children:"Confira os valores e confirme o fechamento do caixa. Esta ao  irreversvel."})]}),Bt&&a.jsxs("div",{className:"md:hidden mb-2 text-[12px] text-warning bg-warning/10 border border-warning/30 rounded px-2 py-1 flex items-center gap-1",children:[a.jsx(ud,{className:"h-3.5 w-3.5"}),"Existem comandas abertas. Finalize-as antes de fechar o caixa."]}),de.loading?a.jsx("div",{className:"py-4 text-text-muted",children:"Carregando resumo"}):a.jsxs("div",{className:"py-4 space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial:"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(de.saldoInicial||0).toFixed(2)]})]}),Object.keys(ln).length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos nesta sesso."}):Object.entries(ln).map(([Pr,cr])=>a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"text-text-secondary",children:[String(Pr),":"]})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(cr||0).toFixed(2)]})]},Pr)),a.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[a.jsx("span",{className:"text-text-primary",children:"Total em Caixa:"})," ",a.jsxs("span",{className:"font-mono text-success",children:["R$ ",Number(Zr||0).toFixed(2)]})]})]}),a.jsxs(zd,{children:[a.jsx(Wd,{onClick:()=>ot(!1),disabled:yr,children:"Cancelar"}),a.jsx(Iu,{onClick:()=>{or(!0)},disabled:yr,children:"Continuar"})]})]})]}),a.jsx(ku,{open:Nt,onOpenChange:Pr=>{yr||or(Pr)},children:a.jsxs(Bd,{className:"sm:max-w-[425px] w-[92vw] max-h-[85vh] animate-none",onOpenAutoFocus:Pr=>Pr.preventDefault(),onEscapeKeyDown:Pr=>{yr||Pr.preventDefault()},onKeyDown:Pr=>Pr.stopPropagation(),onKeyDownCapture:Pr=>Pr.stopPropagation(),onPointerDownOutside:Pr=>{yr||(Pr.preventDefault(),Pr.stopPropagation())},onInteractOutside:Pr=>{yr||(Pr.preventDefault(),Pr.stopPropagation())},children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Confirmar Fechamento do Caixa"}),a.jsx(Vd,{children:"Informe o saldo final para finalizar o fechamento."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(it,{htmlFor:"valor-contado-final",className:"text-sm font-medium text-text-primary mb-2 block",children:"Saldo Final (opcional)"}),a.jsx("input",{id:"valor-contado-final",type:"text",placeholder:"R$ 0,00",value:Hr,onChange:Pr=>{let cr=Pr.target.value.replace(/\D/g,"");cr.length>0&&(cr=(Number(cr)/100).toFixed(2),cr=cr.replace(".",","),cr="R$ "+cr),Vr(cr)},className:"w-full px-3 py-2 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),a.jsxs(zd,{children:[a.jsx(Wd,{onClick:()=>{or(!1)},disabled:yr,children:"Voltar"}),a.jsx(Iu,{onClick:async()=>{try{if(yr)return;It(!0);const Pr=Number(de.saldoInicial||0)+hr,cr=Hr?Number(Hr.replace(/[^0-9,]/g,"").replace(",",".")):null;await ine({saldoFinal:Pr,valorFinalDinheiro:cr,codigoEmpresa:t?.codigo_empresa}),d(!1),typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{or(!1),ot(!1),Vr(""),e({title:"Caixa fechado!",description:`Saldo final: R$ ${Pr.toFixed(2)}`,duration:4e3})}):(or(!1),ot(!1),Vr(""),e({title:"Caixa fechado!",description:`Saldo final: R$ ${Pr.toFixed(2)}`,duration:4e3})),setTimeout(async()=>{try{await Eh({codigoEmpresa:t?.codigo_empresa})}catch{}},0)}catch(Pr){console.error(Pr);const cr=Pr?.message||"Tente novamente";if(kt){Je(cr.includes("Existem")?cr:`Falha ao fechar caixa: ${cr}`);try{or(!1),ot(!1)}catch{}typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{qe(!0)}):qe(!0),setTimeout(()=>qe(!1),2600)}else e({title:"Falha ao fechar caixa",description:cr,variant:"destructive"})}finally{It(!1)}},children:"Confirmar Fechamento"})]})]})})]})},mt=()=>{const[de,ke]=p.useState(""),[st,ot]=p.useState([]),[Nt,or]=p.useState([]),[Bt,vr]=p.useState(!1),[yr,It]=p.useState(new Set),Hr=p.useRef([]),Vr=p.useRef(!1),[pr,ln]=p.useState(0);p.useRef([]);const hr=p.useRef(null);p.useRef(0);const[Zr,Pr]=p.useState(!1),[cr,Mr]=p.useState(null),[bn,ca]=p.useState(null),[os,ys]=p.useState("");p.useEffect(()=>{let wr=!0;const Wr=async()=>{if(!(!ge||!i?.comandaId)&&!(Vr.current&&de===""))try{vr(!0);const D=await Bi({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa});if(!wr)return;const Q=(D||[]).map(le=>({id:le.id,cliente_id:le.cliente_id,nome:le.nome||"",tipo:le.tipo||(le.cliente_id?"cadastrado":"livre")}));or(Q),Hr.current=JSON.parse(JSON.stringify(Q)),It(new Set);const M=await Yb({searchTerm:de,limit:50,codigoEmpresa:t?.codigo_empresa});if(!wr)return;const H=(M||[]).slice().sort((le,X)=>Number(le?.codigo||0)-Number(X?.codigo||0));ot(H),ln(0),Vr.current=!0}catch(D){console.error("Erro ao carregar clientes:",D)}finally{wr&&vr(!1)}};return ge?(Wr(),()=>{wr=!1}):(Vr.current=!1,ke(""),()=>{wr=!1})},[ge,i?.comandaId]),p.useEffect(()=>{ge&&Array.isArray(st)&&st.length>0&&(ln(0),setTimeout(()=>{try{const wr=document.querySelector('[role="dialog"]');if(wr){const Wr=wr.querySelector(".overflow-y-auto");Wr&&(Wr.scrollTop=0)}}catch{}},0))},[ge,st.length]),p.useEffect(()=>(ge&&i?.comandaId?(pn.current=!0,jt.current=i.comandaId,ur.current=wr=>{or(wr||[]),cn(wr||[])}):ge||pn.current&&jt.current===i?.comandaId&&(pn.current=!1,jt.current=null,ur.current=null),()=>{ge||(pn.current=!1,jt.current=null,ur.current=null)}),[ge,i?.comandaId]);const cn=wr=>{try{if(!i?.id)return;const Wr=(wr||[]).map(Q=>Q?.nome).filter(Boolean),D=Wr.length?Wr.join(", "):null;l(Q=>Q&&Q.id===i.id?{...Q,customer:D}:Q),o(Q=>Q.map(M=>M.id===i.id?{...M,customer:D}:M))}catch(Wr){console.error("[ManageClientsDialog] Erro ao sincronizar nomes na mesa:",Wr)}},Kr=()=>{try{console.log("[ManageClientsDialog] addConsumidor clicado")}catch{}i?.comandaId&&(async()=>{try{vr(!0);const{data:wr,error:Wr}=await re.from("comanda_clientes").insert({comanda_id:i.comandaId,nome_livre:"Consumidor",codigo_empresa:t?.codigo_empresa}).select("id, cliente_id, nome_livre").single();if(Wr)throw Wr;const D={id:wr.id,cliente_id:wr.cliente_id,nome:wr.nome_livre||"Consumidor",tipo:"livre"};or(Q=>{const M=[...Q,D];return cn(M),M}),ca(D.id),ys(D.nome||"Consumidor")}catch(wr){console.error("[ManageClientsDialog] Erro ao adicionar consumidor:",wr),e({title:"Falha ao adicionar consumidor",description:wr?.message||"Tente novamente",variant:"destructive"})}finally{vr(!1)}})()},tn=wr=>{try{console.log("[ManageClientsDialog] addClientFromModal clicado:",wr)}catch{}if(!i?.comandaId)return;const Wr=st.find(D=>D.id===wr);Wr&&(async()=>{try{vr(!0);const{data:D,error:Q}=await re.from("comanda_clientes").insert({comanda_id:i.comandaId,cliente_id:wr,codigo_empresa:t?.codigo_empresa}).select("id, cliente_id").single();if(Q)throw Q;const M={id:D.id,cliente_id:D.cliente_id,nome:Wr.nome,tipo:"cadastrado"};or(H=>{const le=[...H,M];return cn(le),le}),Pr(!1)}catch(D){console.error("[ManageClientsDialog] Erro ao adicionar cliente:",D),e({title:"Falha ao adicionar cliente",description:D?.message||"Tente novamente",variant:"destructive"})}finally{vr(!1)}})()},An=(wr,Wr)=>{const D=st.find(M=>M.id===Wr);!D||!Nt.find(M=>M.id===wr)||(async()=>{try{if(vr(!0),String(wr).startsWith("temp-")){const{data:M,error:H}=await re.from("comanda_clientes").insert({comanda_id:i.comandaId,cliente_id:Wr,codigo_empresa:t?.codigo_empresa}).select("id, cliente_id").single();if(H)throw H;const le={id:M.id,cliente_id:M.cliente_id,nome:D.nome,tipo:"cadastrado"};or(X=>{const Ce=[...X.filter(we=>we.id!==wr),le];return cn(Ce),Ce})}else{const{error:M}=await re.from("comanda_clientes").update({cliente_id:Wr,nome_livre:null}).eq("id",wr).eq("codigo_empresa",t?.codigo_empresa);if(M)throw M;or(H=>{const le=H.map(X=>X.id===wr?{...X,cliente_id:Wr,nome:D.nome,tipo:"cadastrado"}:X);return cn(le),le})}Mr(null),Pr(!1)}catch(M){console.error("[ManageClientsDialog] Erro ao trocar cliente:",M),e({title:"Falha ao trocar cliente",description:M?.message||"Tente novamente",variant:"destructive"})}finally{vr(!1)}})()},dn=wr=>{if(Nt.find(D=>D.id===wr)){if(String(wr).startsWith("temp-")||!i?.comandaId){or(D=>{const Q=D.filter(M=>M.id!==wr);return cn(Q),Q});return}(async()=>{try{vr(!0);const{error:D}=await re.from("comanda_clientes").delete().eq("id",wr).eq("codigo_empresa",t?.codigo_empresa);if(D)throw D;or(Q=>{const M=Q.filter(H=>H.id!==wr);return cn(M),M})}catch(D){console.error("[ManageClientsDialog] Erro ao remover cliente:",D),e({title:"Falha ao remover cliente",description:D?.message||"Tente novamente",variant:"destructive"})}finally{vr(!1)}})()}},Yn=wr=>{try{console.log("[ManageClientsDialog] startEditConsumidor clicado:",wr)}catch{}const Wr=Nt.find(D=>D.id===wr);Wr&&(ca(wr),ys(Wr.nome||"Consumidor"))},Ir=()=>{if(!bn||!i?.comandaId)return;const wr=os.trim()||"Consumidor";(async()=>{try{if(vr(!0),!String(bn).startsWith("temp-")){const{error:Wr}=await re.from("comanda_clientes").update({nome_livre:wr}).eq("id",bn).eq("codigo_empresa",t?.codigo_empresa);if(Wr)throw Wr}or(Wr=>{const D=Wr.map(Q=>Q.id===bn?{...Q,nome:wr}:Q);return cn(D),D})}catch(Wr){console.error("[ManageClientsDialog] Erro ao salvar consumidor:",Wr),e({title:"Falha ao salvar cliente",description:Wr?.message||"Tente novamente",variant:"destructive"})}finally{vr(!1),ca(null),ys("")}})()},wn=async()=>{Ae(!1)};return a.jsxs(In,{open:ge,onOpenChange:Ae,children:[a.jsxs(En,{className:"sm:max-w-[480px] w-[92vw] max-h-[85vh] h-[85vh] animate-none flex flex-col overflow-hidden",onOpenAutoFocus:wr=>wr.preventDefault(),onPointerDownOutside:wr=>{wr.preventDefault(),wr.stopPropagation()},onInteractOutside:wr=>{wr.preventDefault(),wr.stopPropagation()},onEscapeKeyDown:wr=>wr.preventDefault(),children:[a.jsxs(Cn,{className:"flex-shrink-0",children:[a.jsx(Nn,{children:"Gerenciar Clientes da Mesa"}),a.jsx(Hn,{children:"Gerencie os clientes vinculados a esta mesa."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 space-y-4 thin-scroll",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-sm font-medium text-text-primary",children:["Clientes vinculados (",Nt.length,"):"]}),Nt.length===0?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted border border-dashed rounded-md",children:"Nenhum cliente vinculado ainda"}):a.jsx("div",{className:"space-y-2",children:Nt.map(wr=>{const Wr=wr.tipo==="livre",D=bn===wr.id;return a.jsx("div",{className:Sr("flex items-center gap-2 p-2 rounded-md border",Wr?"bg-amber-500/10 border-amber-500/30":"bg-surface-2 border-border"),children:D?a.jsxs(a.Fragment,{children:[a.jsx(Ct,{value:os,onChange:Q=>ys(Q.target.value),onKeyDown:Q=>{Q.key==="Enter"&&Ir(),Q.key==="Escape"&&(ca(null),ys("")),Q.stopPropagation()},className:"flex-1 h-8",autoFocus:!0}),a.jsx(se,{size:"sm",onClick:Ir,className:"h-8 px-2",children:a.jsx(vi,{className:"h-4 w-4"})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:Sr("flex-1 text-sm truncate p-1 rounded",Wr?"cursor-pointer hover:bg-amber-500/10":"cursor-default"),onClick:()=>Wr&&Yn(wr.id),title:Wr?"Clique para editar":"",children:[a.jsx("span",{children:wr.nome}),Wr&&a.jsx("span",{className:"ml-2 text-[11px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-600 border border-amber-500/30 align-middle",children:"Cliente Padro"})]}),!Wr&&a.jsx(se,{size:"sm",variant:"ghost",onClick:()=>{Mr(wr.id),Pr(!0)},className:"h-7 px-2",title:"Trocar cliente",children:a.jsx(ec,{className:"h-4 w-4"})}),a.jsx(se,{size:"sm",variant:"ghost",onClick:()=>dn(wr.id),className:"h-7 px-2 text-destructive hover:text-destructive",children:a.jsx(lc,{className:"h-4 w-4"})})]})},wr.id)})})]}),a.jsxs(se,{onClick:()=>{Mr(null),Pr(!0)},className:"w-full",size:"sm",children:[a.jsx(Es,{className:"h-4 w-4 mr-2"}),"Adicionar Cliente"]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>Ae(!1),disabled:Bt,children:"Cancelar"}),a.jsx(se,{onClick:wn,disabled:Bt,children:Bt?"Salvando...":`Confirmar ${yr.size>0?`(${yr.size} alteraes)`:""}`})]})]}),a.jsx(In,{open:Zr,onOpenChange:Pr,children:a.jsxs(En,{className:"sm:max-w-[500px] max-h-[80vh] flex flex-col",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:cr?"Trocar Cliente":"Adicionar Cliente"}),a.jsx(Hn,{children:"Selecione um cliente da lista"})]}),a.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar cliente...",className:"pl-9",value:de,onChange:wr=>ke(wr.target.value)})]}),a.jsx("div",{className:"flex-1 border rounded-md overflow-y-auto thin-scroll",role:"listbox","aria-label":"Clientes disponveis",ref:hr,tabIndex:0,children:Bt?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Carregando..."}):st.length===0?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Nenhum cliente encontrado"}):a.jsx("ul",{className:"divide-y divide-border",children:st.map(wr=>{const Wr=wr.codigo===0,D=Nt.some(Q=>Q.cliente_id===wr.id&&Q.tipo==="cadastrado");return a.jsxs("li",{className:Sr("p-3 cursor-pointer transition-colors flex items-center justify-between",Wr?"bg-amber-500/5 hover:bg-amber-500/10":"hover:bg-surface-2"),onClick:()=>{Wr?cr?(Mr(null),Pr(!1)):(Kr(),Pr(!1)):cr?An(cr,wr.id):tn(wr.id)},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"font-medium truncate flex items-center gap-2",children:[Wr?"Cliente Consumidor":`${wr?.codigo?`${wr.codigo} - `:""}${wr?.nome||""}`,Wr&&a.jsx("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-600 border border-amber-500/30",children:"Cliente Padro"})]}),!Wr&&wr.telefone&&a.jsx("div",{className:"text-xs text-text-muted",children:wr.telefone}),Wr&&a.jsx("div",{className:"text-xs text-text-muted",children:"Clique para adicionar consumidor"})]}),D&&!Wr&&a.jsx(vi,{className:"h-5 w-5 text-success ml-2 flex-shrink-0"})]},wr.id)})})})]}),a.jsx(Na,{children:a.jsx(se,{variant:"outline",onClick:()=>Pr(!1),children:"Cancelar"})})]})})]})},zt=()=>{const de=ke=>ke==="available"?"bg-success/10 border-success/30 text-success":ke==="in-use"?"bg-warning/10 border-warning/30 text-warning":ke==="awaiting-payment"?"bg-info/10 border-info/30 text-info":"bg-surface-2 border-border text-text-secondary";return a.jsx("div",{className:"md:hidden space-y-2",children:s.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("div",{className:"text-text-muted mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhuma mesa encontrada"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Crie sua primeira mesa para comear"})]}):s.map(ke=>{const st=Te(ke.order||[],ke),ot=ke.totalHint>0?ke.totalHint:st;return a.jsx("div",{onClick:async()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}await Xt(ke),ke.status!=="available"&&Rr(!0)},className:Sr("p-3 rounded-lg border-2 bg-surface transition-all active:scale-[0.98]",de(ke.status),i?.id===ke.id&&"ring-2 ring-brand/60",c?"cursor-pointer":"cursor-not-allowed opacity-60"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("h3",{className:"font-bold text-base truncate",children:ke.name||`Mesa ${ke.number}`}),ke.status==="available"&&ke.id===rt&&a.jsx("kbd",{className:"hidden md:inline px-2 py-1 text-xs font-bold font-mono text-gray-400 bg-transparent border border-gray-300/50 rounded flex-shrink-0",children:"F1"})]})}),ke.status==="in-use"||ke.status==="awaiting-payment"?a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-text-secondary",children:[a.jsx(tc,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:ee(ke.customer)||"Sem cliente"})]}),a.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-semibold text-text-primary",children:[a.jsx(Oi,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsxs("span",{children:["R$ ",ot.toFixed(2)]})]})]}):a.jsx("div",{className:"text-xs text-text-muted",children:"Mesa disponvel"})]}),a.jsx("div",{className:"w-12 flex items-center justify-center ml-1 mr-1",children:ke.status==="available"?a.jsx("img",{src:"/mesalivre.png",alt:"Mesa livre",className:"w-10 h-10 object-contain opacity-80"}):a.jsx("img",{src:"/mesaocupada.png",alt:"Mesa ocupada",className:"w-10 h-10 object-contain opacity-80"})}),a.jsx(qg,{className:"w-5 h-5 text-text-muted flex-shrink-0 ml-1"})]})},ke.id)})})},Dr=()=>i?a.jsx(In,{open:_r,modal:!z,onOpenChange:de=>{!de&&z||(Rr(de),de||ce(null),de&&P("tables"))},children:a.jsxs(En,{className:"w-[95vw] sm:max-w-2xl max-h-[85vh] flex flex-col p-0 gap-0 animate-none",children:[a.jsxs("div",{className:"p-4 border-b border-border bg-surface-2",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(Nn,{className:"text-xl font-bold",children:i.name||`Mesa ${i.number}`})}),a.jsx(Hn,{className:"sr-only",children:"Visualizao da comanda e produtos da mesa selecionada"}),(i.status==="in-use"||i.status==="awaiting-payment")&&a.jsxs("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(tc,{className:"w-4 h-4"}),a.jsx("span",{children:ee(i.customer)||"Sem cliente"})]}),i.order&&i.order.length>0&&a.jsxs("div",{className:"flex items-center gap-1 font-semibold text-text-primary",children:[a.jsx(Oi,{className:"w-4 h-4"}),a.jsxs("span",{children:["R$ ",(i.totalHint>0?i.totalHint:Te(i.order||[])).toFixed(2)]})]})]})]}),a.jsxs(od,{value:nn,onValueChange:de=>{if(rn(de),ce(null),de==="products"&&i){w(!0);try{Rr(!1)}catch{}rn("order")}},className:"flex flex-col flex-1 min-h-0",children:[a.jsxs(sc,{className:"grid w-full grid-cols-3 m-2 rounded-lg",children:[a.jsx(Pa,{value:"order",className:"text-sm flex items-center justify-center gap-2",children:"Comanda"}),a.jsx(Pa,{value:"details",className:"text-sm flex items-center justify-center gap-2",children:"Detalhes"}),a.jsxs(Pa,{value:"products",className:"text-sm flex items-center justify-center gap-2",onClick:()=>{if(i){w(!0);try{Rr(!1)}catch{}}},children:["Produtos",a.jsx("kbd",{className:"hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"P"})]})]}),a.jsx(Gs,{value:"order",className:"flex-1 overflow-hidden min-h-0 m-0",onKeyDown:de=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(de.key)&&P("tables")},children:a.jsx(On,{table:i})}),a.jsx(Gs,{value:"details",className:"flex-1 overflow-hidden min-h-0 m-0",children:a.jsx(Lr,{table:i})})]})]})}):null,Qr=()=>{const de=k,ke=de&&Tt.get(de.id)||0,st=de?Number(de.salePrice??de.price??0):0,ot=Nt=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Nt||0));return a.jsx(In,{open:z,onOpenChange:Nt=>{U(Nt),Nt||B(null)},children:a.jsxs(En,{overlayClassName:"z-[70]",className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[71]",onOpenAutoFocus:Nt=>{},onKeyDown:Nt=>Nt.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold break-words",title:de?.name||"",children:de?.name||"Produto"}),a.jsx(Hn,{children:"Detalhes do produto e aes rpidas."})]}),de?a.jsxs("div",{className:"space-y-3 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:ot(st)})]}),de.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:de.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof de.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:de.stock})]}),typeof de.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:de.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",ke]})]})]})]}):null,a.jsxs(Na,{className:"flex items-center justify-between gap-2",children:[a.jsxs(se,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{de&&n("/produtos",{state:{productId:de.id,productName:de.name}})},children:[a.jsx(Vi,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(se,{variant:"outline",onClick:()=>{U(!1),B(null)},children:"Fechar"}),a.jsx(se,{onClick:async()=>{de&&(await zn(de),U(!1),B(null))},children:"Adicionar"})]})]})})};return a.jsxs(a.Fragment,{children:[a.jsx(Qr,{}),a.jsx(Xo,{}),a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"md:hidden mb-2 w-full",children:a.jsx(od,{value:"mesas",onValueChange:de=>{de==="mesas"&&n("/vendas"),de==="balcao"&&n("/balcao"),de==="historico"&&n("/historico")},children:a.jsxs(sc,{className:"grid w-full grid-cols-3",children:[a.jsx(Pa,{value:"mesas",className:"text-xs",title:"Pressione B para alternar",children:"Mesas"}),a.jsx(Pa,{value:"balcao",className:"text-xs",title:"Pressione B para alternar",children:"Balco"}),a.jsx(Pa,{value:"historico",className:"text-xs",title:"Pressione H para ir ao histrico",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center justify-between mb-2 md:mb-6 gap-2 md:gap-3 pr-2",children:[a.jsx("div",{className:"hidden md:flex items-center gap-2 md:gap-3",children:a.jsx(od,{value:"mesas",onValueChange:de=>{de==="mesas"&&n("/vendas"),de==="balcao"&&n("/balcao"),de==="historico"&&n("/historico")},children:a.jsxs(sc,{className:"inline-flex",children:[a.jsx(Pa,{value:"mesas",className:"text-sm",title:"Pressione B para alternar",children:"Mesas"}),a.jsx(Pa,{value:"balcao",className:"text-sm",title:"Pressione B para alternar",children:"Balco"}),a.jsx(Pa,{value:"historico",className:"text-sm",title:"Pressione H para ir ao histrico",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[a.jsx(pe,{}),a.jsx(He,{}),a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>g(!0),className:"px-2.5",children:[a.jsx(Y4,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Detalhes"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Detalhes do Caixa"}),a.jsx("kbd",{className:"ml-2 hidden lg:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F11"})]}),a.jsx("div",{className:"hidden md:block w-px h-6 bg-border mx-1"}),a.jsx(se,{onClick:()=>ie(!0),className:"inline-flex h-9 w-9 p-0 items-center justify-center shrink-0",size:"icon",variant:"outline",title:"Gerenciar Mesas",children:a.jsx(fd,{className:"h-4 w-4"})}),a.jsxs(se,{onClick:()=>De(!0),className:"hidden md:flex px-3",size:"sm",children:[a.jsx(Es,{className:"mr-2 h-4 w-4"})," Nova Mesa",a.jsx("kbd",{className:"ml-2 hidden lg:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F1"})]})]})]}),!c&&u>0&&a.jsxs("div",{className:"md:hidden mb-3 text-[11px] text-warning flex items-center gap-2",children:[a.jsx(ud,{className:"h-3 w-3"}),"H comandas abertas, mas o caixa parece fechado.",a.jsx(se,{size:"sm",variant:"outline",className:"h-6 px-2 text-[11px]",onClick:()=>Yt(!0),children:"Reabrir sesso"})]}),a.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-visible min-h-0",children:[a.jsxs("div",{className:"lg:col-span-2 bg-surface rounded-lg border border-border p-4 md:p-6 overflow-y-auto thin-scroll min-h-0",tabIndex:0,onKeyDown:de=>{A==="tables"&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(de.key)&&de.preventDefault()},onClick:de=>{de.stopPropagation(),de.preventDefault(),P("tables"),!i&&s.length>0&&l(s[0]),de.currentTarget.focus()},onFocus:()=>{P("tables"),!i&&s.length>0&&l(s[0])},style:{outline:A==="tables"?"2px solid rgba(148, 163, 184, 0.4)":"none",outlineOffset:"-2px",transition:"outline 0.15s ease"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 gap-4",children:[a.jsx("h2",{className:"text-xl font-bold",children:"Mapa de Mesas"}),a.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-text-muted flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:""}),a.jsx("span",{children:"Navegar"})]}),a.jsx("div",{className:"w-px h-3 bg-border"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"Enter"}),a.jsx("span",{children:"Selecionar"})]})]}),a.jsx(se,{type:"button",className:"md:hidden h-9 w-9 p-0 bg-amber-400 text-black hover:bg-amber-300 flex-shrink-0",size:"icon",title:"Nova Mesa",onClick:()=>De(!0),children:a.jsx(Es,{className:"h-5 w-5"})})]}),a.jsx(zt,{}),a.jsx("div",{className:"hidden md:block",children:a.jsx(gat,{onDragEnd:te,children:a.jsx(aoe,{droppableId:"tables",children:de=>a.jsxs("div",{...de.droppableProps,ref:ke=>{de.innerRef(ke),nr.current=ke},role:"grid","aria-label":"Lista de mesas",className:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(240px,1fr))]",children:[s.length===0?a.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("div",{className:"text-text-muted mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhuma mesa encontrada"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Crie sua primeira mesa para comear a receber pedidos"}),a.jsxs(se,{onClick:()=>De(!0),className:"flex items-center gap-2",children:[a.jsx(Es,{size:16}),"Criar Nova Mesa"]})]}):s.map((ke,st)=>a.jsx(Zat,{draggableId:ke.id,index:st,children:(ot,Nt)=>a.jsx(Et,{table:ke,provided:ot,isDragging:Nt.isDragging})},ke.id)),de.placeholder]})})})})]}),a.jsx("div",{className:"hidden md:flex bg-surface rounded-lg border border-border flex-col min-h-0 transition-all overflow-hidden",style:{boxShadow:A==="panel"?"inset 0 0 0 2px rgba(148, 163, 184, 0.4)":"none"},children:a.jsxs(od,{value:F,onValueChange:de=>{O(de),de==="products"&&i&&(w(!0),O("order"))},className:"flex flex-col h-full",children:[a.jsxs(sc,{className:"grid w-full grid-cols-3 m-2",children:[a.jsx(Pa,{value:"order",className:"flex items-center justify-center gap-2 text-xs",children:"Comanda"}),a.jsx(Pa,{value:"details",className:"flex items-center justify-center gap-2 text-xs",children:"Detalhes"}),a.jsxs(Pa,{value:"products",onClick:()=>{i&&w(!0)},className:"flex items-center justify-center gap-2 text-xs",children:["Produtos",a.jsx("kbd",{className:"hidden md:inline px-1 py-0.5 text-[10px] font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"P"})]})]}),a.jsx(Gs,{value:"order",className:"flex-1 overflow-hidden min-h-0",children:a.jsx(On,{table:i})}),a.jsx(Gs,{value:"details",className:"flex-1 overflow-hidden min-h-0",children:a.jsx(Lr,{table:i})})]})})]})]}),a.jsx(Dr,{}),a.jsx(vl,{}),a.jsx(Ue,{open:x,onOpenChange:g,cashSummary:I}),a.jsx(an,{}),a.jsx(St,{}),ge?a.jsx(mt,{}):null,a.jsx(Zi,{}),a.jsx(Qn,{}),a.jsx(Ta,{}),Ke&&a.jsx("div",{className:"fixed left-3 right-3 z-[9999]",role:"alert","aria-live":"assertive",style:{bottom:"calc(12px + env(safe-area-inset-bottom, 0px))"},children:a.jsxs("div",{className:"pointer-events-none flex items-start gap-2 rounded-md border border-amber-500 bg-amber-400 text-black px-3 py-2 shadow-lg",children:[a.jsx(ud,{className:"h-4 w-4 mt-0.5","aria-hidden":"true"}),a.jsx("div",{className:"text-sm font-semibold leading-snug drop-shadow-[0_1px_0_rgba(255,255,255,0.25)]",children:ze||"Ateno"})]})}),Mt&&a.jsx(fst,{item:Mt,onApply:()=>{i&&Se(i)},onClose:()=>{ce(null)},codigoEmpresa:t?.codigo_empresa}),i&&Xe&&a.jsx(mst,{comanda:i,subtotal:Te(i.order||[],i),onApply:()=>{i&&Se(i)},onClose:()=>Qt(!1),codigoEmpresa:t?.codigo_empresa}),(Ze||wt||er)&&a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80",children:a.jsxs("div",{className:"px-8 py-6 rounded-xl bg-surface border border-border shadow-2xl flex flex-col items-center gap-4 max-w-sm w-[85vw] text-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-brand border-t-transparent animate-spin","aria-hidden":"true"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"block text-base font-semibold text-text-primary",children:Ze?"Abrindo mesa...":wt?"Cancelando comanda...":"Fechando conta..."}),a.jsx("span",{className:"block text-xs text-text-muted",children:Ze?"Aguarde, estamos criando a comanda e sincronizando com os outros dispositivos.":wt?"Aguarde, estamos cancelando a comanda e liberando a mesa em todos os dispositivos.":"Aguarde, estamos registrando os pagamentos e liberando a mesa em todos os dispositivos."})]})]})}),p.useMemo(()=>a.jsx(Fn,{},(i?.order||[]).map(de=>`${String(de.productId)}:${Number(de.quantity||0)}`).join("|")),[b,i?.id,i?.order])]})}function gst(){const{toast:e}=Ss(),t=hl(),{userProfile:r}=qs(),[n,s]=p.useState(null),[o,i]=p.useState([]),[l,c]=p.useState([]),[d,u]=p.useState(!0),[f,h]=p.useState(!1),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,b]=p.useState(""),[w,_]=p.useState(""),[j,S]=p.useState(null),[C,A]=p.useState(null),[P,F]=p.useState(!1),O=p.useRef(!1),[I,T]=p.useState(new Map),[k,B]=p.useState(!1),[z,U]=p.useState(!1),[L,W]=p.useState(!1),[ge,Ae]=p.useState(!1),[V,$]=p.useState(null),[Y,he]=p.useState(!1),[J,G]=p.useState(!1),[ue,ve]=p.useState([]);p.useState(null);const[ae,oe]=p.useState(!1),[me,De]=p.useState([]),[ne,ie]=p.useState(1),[ht,pt]=p.useState([]),[Ze,vt]=p.useState(null),[wt,gt]=p.useState(!1),[er,_e]=p.useState(null),[Pt,Lt]=p.useState(!1),[gr,fr]=p.useState(""),[je,nt]=p.useState(!1),[$t,Ut]=p.useState(""),[Fe,xt]=p.useState(()=>{try{return typeof window<"u"&&window.innerWidth<=640}catch{return!1}});p.useEffect(()=>{const ee=()=>{try{xt(typeof window<"u"&&window.innerWidth<=640)}catch{xt(!1)}};return ee(),window.addEventListener("resize",ee),()=>window.removeEventListener("resize",ee)},[]),p.useState("cadastrado");const[Ot,Cr]=p.useState(""),[Me,Qe]=p.useState([]),[et,Yt]=p.useState([]);p.useState(!1),p.useState(!1);const[xr,Jt]=p.useState(!1),[kr,_r]=p.useState(!1),[Rr,nn]=p.useState(0),[rn,Ke]=p.useState("all"),[qe,ze]=p.useState(()=>{try{return localStorage.getItem("balcao_sort_order")||"code"}catch{return"code"}}),Je=p.useRef([]),kt=p.useRef(null),[ct,tr]=p.useState(()=>{try{const ee=localStorage.getItem("balcao_left_panel_width");return ee?parseFloat(ee):50}catch{return 50}}),[dt,Mt]=p.useState(!1),ce=p.useRef(null),Xe=p.useRef(0),Qt=p.useRef([]);p.useEffect(()=>{Qt.current=l},[l]);const Tt=p.useRef(!1);p.useEffect(()=>(Tt.current=!0,()=>{Tt.current=!1}),[]);const Ar=p.useRef(null),nr=p.useRef(null),Jr=p.useRef(null),gn=p.useRef(null);p.useEffect(()=>{gn.current=n},[n]),p.useEffect(()=>{const ee=r?.codigo_empresa;if(!ee)return;try{const Be=typeof window<"u"?window.localStorage.getItem("custom-auth-token"):null;if(Be&&Be.trim())re.realtime.setAuth(Be.trim());else{let Ge="";try{Ge=(new URL(re.supabaseUrl||"").host||"").split(".")[0]||""}catch{}const Ye=Ge?`sb-${Ge}-auth-token`:"sb-auth-token",ft=typeof window<"u"?window.localStorage.getItem(Ye):null;if(ft)try{const yt=JSON.parse(ft),Et=yt?.access_token||yt?.currentSession?.access_token;Et&&re.realtime.setAuth(Et)}catch{}}}catch{}const Se=re.channel(`loja:${ee}`),$e=async Be=>{const Ge=Be?.table||Be?.table_name||"",Ye=Be?.new||Be?.old||{},ft=Be?.eventType||Be?.type||Be?.event||"";try{if(Ge==="comanda_itens"){const yt=Be?.new?.comanda_id||Be?.old?.comanda_id||Ye?.comanda_id||null;if(yt){const Et=gn.current;if(Et&&String(Et)===String(yt)){try{await kn(Et,2)}catch{}try{const br=await vh({codigoEmpresa:ee}),Ue=new Map;for(const St of br||[])Ue.set(St.produto_id,(Ue.get(St.produto_id)||0)+Number(St.quantidade||0));T(Ue)}catch{}return}try{const br=await Nv({codigoEmpresa:ee});if(br?.id&&String(br.id)===String(yt)){s(br.id);try{await kn(br.id,2)}catch{}try{const Ue=await vh({codigoEmpresa:ee}),St=new Map;for(const Nr of Ue||[])St.set(Nr.produto_id,(St.get(Nr.produto_id)||0)+Number(Nr.quantidade||0));T(St)}catch{}return}}catch{}}}if(Ge==="comanda_clientes"){const yt=Be?.new?.comanda_id||Be?.old?.comanda_id||Ye?.comanda_id||null;if(yt&&gn.current&&String(gn.current)===String(yt)){try{await kn(yt,2)}catch{}return}}if(Ge==="comandas"){const yt=Ye?.mesa_id,Et=Ye?.id||Be?.old?.id||null,br=String(Ye?.status||"").toLowerCase(),Ue=String(ft||"").toUpperCase()==="DELETE"||br.includes("fechad")||br.includes("closed")||br.includes("encerr"),St=String(ft||"").toUpperCase()==="INSERT";if(Ue&&yt==null&&gn.current&&Et&&String(gn.current)===String(Et)){c([]),s(null),Yt([]),b(""),_r(!1);try{localStorage.removeItem(ar.comandaId),localStorage.removeItem(ar.items),localStorage.removeItem(ar.customerName),localStorage.removeItem(ar.pendingClientIds),localStorage.removeItem(ar.clientChosen)}catch{}}if(St&&yt==null&&["open","awaiting-payment","awaiting_payment"].includes(br)){s(Et);try{await kn(Et,2)}catch{}}}}catch{}if(nr.current)try{clearTimeout(nr.current)}catch{}nr.current=setTimeout(async()=>{const yt=gn.current;if(yt)try{await kn(yt,2)}catch{}else try{const Et=await Nv({codigoEmpresa:ee});if(Et?.id){s(Et.id);try{await kn(Et.id,2)}catch{}}}catch{}},250)};if(Se.on("postgres_changes",{event:"*",schema:"public",table:"comandas",filter:`codigo_empresa=eq.${ee}`},$e).on("postgres_changes",{event:"*",schema:"public",table:"comanda_itens"},$e).on("postgres_changes",{event:"*",schema:"public",table:"comanda_clientes"},$e).subscribe(),Ar.current=Se,Jr.current)try{clearInterval(Jr.current)}catch{}return Jr.current=setInterval(async()=>{const Be=gn.current;if(Be)try{await kn(Be,1)}catch{}else try{const Ge=await Nv({codigoEmpresa:ee});if(Ge?.id){s(Ge.id);try{await kn(Ge.id,1)}catch{}}}catch{}},6e4),()=>{if(Ar.current){try{re.removeChannel(Ar.current)}catch{}Ar.current=null}if(nr.current){try{clearTimeout(nr.current)}catch{}nr.current=null}if(Jr.current){try{clearInterval(Jr.current)}catch{}Jr.current=null}}},[r?.codigo_empresa]),p.useEffect(()=>{(l||[]).length>0&&(O.current=!0)},[l]),p.useEffect(()=>{n&&O.current&&(l||[]).length===0&&kn(n,2)},[n,l?.length]),p.useEffect(()=>{if(Y)return;let ee=!0;return(async()=>{try{const Se=await Eh({codigoEmpresa:r?.codigo_empresa});ee&&B(!!Se)}catch{ee&&B(!1)}})(),()=>{ee=!1}},[r?.codigo_empresa,Y]);const tt=async()=>{const ee=r?.codigo_empresa||null;try{if(!ee)return;Ae(!0);const[Se,$e]=await Promise.all([j1({codigoEmpresa:ee}).catch(()=>null),Eh({codigoEmpresa:ee}).catch(()=>null)]);if(!$e?.id){$(null);return}let Be=0,Ge=0,Ye=[];try{Ye=await kg({caixaSessaoId:$e.id,codigoEmpresa:ee}),Be=(Ye||[]).filter(yt=>String(yt?.tipo||"").toLowerCase()==="sangria").reduce((yt,Et)=>yt+Number(Et?.valor||0),0),Ge=(Ye||[]).filter(yt=>String(yt?.tipo||"").toLowerCase()==="suprimento").reduce((yt,Et)=>yt+Number(Et?.valor||0),0)}catch{}const ft={saldo_inicial:$e.saldo_inicial||0,totalPorFinalizadora:Se?.totalPorFinalizadora||Se?.porFinalizadora||{},totalEntradas:Se?.totalEntradas||Se?.entradas||0,totalSangria:Be,totalSuprimento:Ge,totalSaidas:Be,sessaoId:$e.id,movimentacoes:Ye};$(ft)}catch{$(null)}finally{Ae(!1)}};p.useEffect(()=>{let ee=!0;return(async()=>{try{if(!J||!n)return;const $e=r?.codigo_empresa;let Be=[];try{const ft=await Bi({comandaId:n,codigoEmpresa:$e});Be=(Array.isArray(ft)?ft:[]).map(Et=>{const br=Et?.clientes?.id??Et?.cliente_id??Et?.id??null,Ue=Et?.clientes?.nome??Et?.nome??Et?.nome_livre??"";return br?{id:br,nome:Ue}:null}).filter(Boolean)}catch{Be=[]}if(!ee)return;pt(Be);const Ye=Array.isArray(et)&&et.length>0?et:Be.map(ft=>ft.id);if(!Array.isArray(Ye)||Ye.length===0)return;De(ft=>{let yt=ft&&ft.length?[...ft]:[{id:1,clientId:Ye[0],methodId:ue[0]?.id||"",value:""}];yt[0]||(yt[0]={id:1,clientId:Ye[0],methodId:ue[0]?.id||"",value:""}),yt[0].clientId=Ye[0];const Et=new Set([yt[0].clientId].filter(Boolean));for(let br=1;br<yt.length;br++){if(!yt[br].clientId||Et.has(yt[br].clientId)){const Ue=(Ye||[]).find(St=>!Et.has(St));yt[br].clientId=Ue||Ye[0]}Et.add(yt[br].clientId)}return yt})}catch{}})(),()=>{ee=!1}},[J,et,n,r?.codigo_empresa]);const jr=ee=>{const Se=String(ee||"").replace(/\D/g,"");return Se?Number(Se)/100:0},ua=ee=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(ee),Oe=ee=>(ue||[]).find(Se=>String(Se.id)===String(ee)),Wt=ee=>Number(Oe(ee.methodId)?.taxa_percentual||0),Ht=ee=>{const Se=jr(ee.value),$e=Wt(ee);return!ee.chargeFee||!$e?Se:Se/(1+$e/100)},mr=ee=>{const Se=Ht(ee),$e=Wt(ee);return!ee.chargeFee||!$e||Se<=0?0:Se*($e/100)},Gt=(ee,Se)=>{const $e=Wt(ee);if(ee.chargeFee&&$e>0){const Be=Se*(1+$e/100);return{...ee,value:ua(Be)}}return{...ee,value:ua(Se)}},pn=()=>(me||[]).reduce((ee,Se)=>ee+Ht(Se),0),jt=()=>(me||[]).reduce((ee,Se)=>ee+mr(Se),0),ur=()=>pn()+jt();p.useEffect(()=>{try{if(!J)return;let ee=0;try{ee=(l||[]).reduce((Be,Ge)=>Be+Number(Ge.quantity||0)*Number(Ge.price||0),0)}catch{}const Se=pn(),$e=ee-Se;Math.abs($e)>.009&&Math.abs($e)<=.05&&Array.isArray(me)&&me.length>0&&De(Be=>Be.map((Ge,Ye,ft)=>{if(Ye!==ft.length-1)return Ge;const yt=Ht(Ge)+$e;return Gt(Ge,yt)}))}catch{}},[me,J]);const rt=async()=>{try{if(y(!0),!n){e({title:"Nenhuma comanda aberta",description:"Adicione itens para abrir uma comanda.",variant:"warning"});return}const ee=r?.codigo_empresa;if(!ee){e({title:"Empresa no definida",variant:"destructive"});return}try{const{data:Ge,error:Ye}=await re.from("comandas").select("id").eq("id",n).eq("codigo_empresa",ee).single();if(Ye||!Ge){console.error("[confirmPay] Comanda no encontrada no banco:",n),e({title:"Comanda invlida",description:"A comanda no existe mais. Criando nova comanda...",variant:"warning"}),s(null),c([]);try{localStorage.removeItem(ar.comandaId),localStorage.removeItem(ar.items)}catch{}await Xn();return}}catch(Ge){console.error("[confirmPay] Erro ao validar comanda:",Ge),e({title:"Erro de validao",description:"No foi possvel validar a comanda.",variant:"destructive"});return}if(!Array.isArray(me)||me.length===0){e({title:"Informe os pagamentos",description:"Adicione pelo menos uma forma de pagamento.",variant:"warning"});return}for(const Ge of me){if(!Ge.methodId){e({title:"Forma de pagamento faltando",description:"Selecione a finalizadora em todas as linhas.",variant:"warning"});return}if(!String(Ge.value||"").replace(/\D/g,"")){e({title:"Valor invlido",description:"Informe valores maiores que zero.",variant:"warning"});return}}let Se=0;try{Se=(await To({comandaId:n,codigoEmpresa:ee})||[]).reduce((Ye,ft)=>Ye+Number(ft.quantidade||0)*Number(ft.preco_unitario||0),0)}catch{}const $e=pn(),Be=Math.abs($e-Se);if(Be>.009&&Be<=.05){const Ge=Se-$e;De(Ye=>Ye.map((ft,yt,Et)=>{if(yt!==Et.length-1)return ft;const br=Ht(ft)+Ge;return Gt(ft,br)}))}else if(Be>.05){const Ge=Se-$e;Ge>0?e({title:"Valor insuficiente",description:`Faltam R$ ${Ge.toFixed(2)} para fechar o total.`,variant:"warning"}):e({title:"Valor excedente",description:`Excedeu em R$ ${Math.abs(Ge).toFixed(2)}. Ajuste os valores.`,variant:"warning"});return}oe(!0),await im({codigoEmpresa:ee});for(const Ge of me){const Ye=jr(Ge.value),ft=ue.find(Et=>String(Et.id)===String(Ge.methodId)),yt=ft?.nome||ft?.tipo||"outros";await PR({comandaId:n,finalizadoraId:Ge.methodId,metodo:yt,valor:Ye,status:"Pago",codigoEmpresa:ee,clienteId:Ge.clientId||null})}await T0({comandaId:n,codigoEmpresa:ee}),s(null),c([]),Yt([]),b(""),_r(!1),De([]);try{localStorage.removeItem(ar.comandaId),localStorage.removeItem(ar.items),localStorage.removeItem(ar.customerName)}catch{}e({title:"Pagamento concludo",description:`Total R$ ${Se.toFixed(2)}`,variant:"success"}),G(!1)}catch(ee){e({title:"Falha ao concluir",description:ee?.message||"Tente novamente",variant:"destructive"})}finally{oe(!1),y(!1)}};p.useEffect(()=>{(async()=>{try{if(!z)return;await tt()}catch{}})()},[z,r?.codigo_empresa]);const Dt=()=>{const[ee,Se]=p.useState(""),$e=p.useRef(null);return p.useEffect(()=>{if(typeof window<"u"&&window.innerWidth<=640)return;const Ge=setTimeout(()=>{try{$e.current?.focus()}catch{}},0);return()=>clearTimeout(Ge)},[]),a.jsxs(a.Fragment,{children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Abrir Caixa"}),a.jsx(Vd,{children:"Insira o valor inicial (suprimento) para abrir o caixa."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(it,{className:"mb-2 block",htmlFor:"open-cash-initial",children:"Saldo inicial"}),a.jsx(Ct,{id:"open-cash-initial",ref:$e,type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:ee,onChange:Be=>{const Ge=(Be.target.value||"").replace(/\D/g,""),Ye=Ge?Number(Ge)/100:0,ft=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Ye);Se(ft)},onKeyDown:Be=>{Be.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Be.key)&&(/^[0-9]$/.test(Be.key)||Be.preventDefault())},onBeforeInput:Be=>{const Ge=Be.data??"";Ge&&/\D/.test(Ge)&&Be.preventDefault()}}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Digite nmeros; a mscara formata em reais automaticamente."})]}),a.jsxs(zd,{children:[a.jsx(Wd,{onClick:()=>W(!1),children:"Cancelar"}),a.jsx(Iu,{onClick:async()=>{try{const Be=String(ee||"").replace(/\D/g,""),Ge=Be?Number(Be)/100:0;await im({saldoInicial:Ge,codigoEmpresa:r?.codigo_empresa}),B(!0),W(!1),e({title:"Caixa aberto com sucesso!",variant:"success"})}catch(Be){e({title:"Falha ao abrir caixa",description:Be?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar Abertura"})]})]})},Xt=()=>a.jsxs(ku,{open:L,onOpenChange:W,children:[a.jsx(gg,{asChild:!0,children:a.jsxs(se,{variant:"success",size:"sm",disabled:k,onClick:()=>W(!0),className:"px-3",children:[a.jsx(NG,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Abrir"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Abrir Caixa"})]})}),a.jsx(Bd,{className:"sm:max-w-[425px] w-[92vw] animate-none",onKeyDown:ee=>ee.stopPropagation(),onEscapeKeyDown:ee=>{ee.preventDefault(),ee.stopPropagation()},onPointerDownOutside:ee=>{ee.preventDefault(),ee.stopPropagation()},onFocusOutside:ee=>{ee.preventDefault(),ee.stopPropagation()},onInteractOutside:ee=>{ee.preventDefault(),ee.stopPropagation()},onOpenAutoFocus:ee=>{ee.preventDefault()},onCloseAutoFocus:ee=>{ee.preventDefault()},children:a.jsx(Dt,{})})]}),Tr=()=>{const[ee,Se]=p.useState({loading:!1,saldoInicial:0,resumo:null}),[$e,Be]=p.useState(!1),[Ge,Ye]=p.useState(""),[ft,yt]=p.useState(!1),Et=async()=>{try{Se({loading:!0,saldoInicial:0,resumo:null});const Lr=await Eh({codigoEmpresa:r?.codigo_empresa}),On=await j1({codigoEmpresa:r?.codigo_empresa});Se({loading:!1,saldoInicial:Number(Lr?.saldo_inicial||0),resumo:On||{totalPorFinalizadora:{}}})}catch{Se({loading:!1,saldoInicial:0,resumo:{totalPorFinalizadora:{}}})}},br=ee?.resumo?.totalPorFinalizadora||{},Ue=Object.values(br).reduce((Lr,On)=>Lr+Number(On||0),0),St=Number(ee.saldoInicial||0)+Ue,Nr=Number(V?.totalSuprimento||0),an=Number(V?.totalSangria||0);return a.jsxs(ku,{open:Y,onOpenChange:Lr=>{Lr&&(he(!0),yt(!1),Et())},children:[a.jsx(gg,{asChild:!0,children:a.jsxs(se,{variant:"destructive",size:"sm",disabled:!k,onClick:()=>{he(!0)},className:"px-3",children:[a.jsx(e0,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2",children:"Fechar Caixa"})]})}),a.jsxs(Bd,{className:"sm-max-w-[425px] animate-none",onKeyDown:Lr=>Lr.stopPropagation(),onEscapeKeyDown:Lr=>{Lr.preventDefault(),Lr.stopPropagation()},onPointerDownOutside:Lr=>{Lr.preventDefault(),Lr.stopPropagation()},onFocusOutside:Lr=>{Lr.preventDefault(),Lr.stopPropagation()},onInteractOutside:Lr=>{Lr.preventDefault(),Lr.stopPropagation()},onOpenAutoFocus:Lr=>{Lr.preventDefault()},onCloseAutoFocus:Lr=>{Lr.preventDefault()},children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Fechar Caixa"}),a.jsx(Vd,{children:"Confira os valores e confirme o fechamento do caixa. Esta ao  irreversvel."})]}),$e&&a.jsxs("div",{className:"md:hidden mb-2 text-[12px] text-warning bg-warning/10 border border-warning/30 rounded px-2 py-1 flex items-center gap-1",children:[a.jsx(ud,{className:"h-3.5 w-3.5"}),"Existem comandas abertas. Finalize-as antes de fechar o caixa."]}),ee.loading?a.jsx("div",{className:"py-4 text-text-muted",children:"Carregando resumo"}):a.jsx("div",{className:"py-4 space-y-2",children:ft?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(ee.saldoInicial||0).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Final"})," ",a.jsx("span",{className:"font-mono",children:(()=>{const Lr=String(Ge||"").replace(/\D/g,""),On=Lr?Number(Lr)/100:0;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(On)})()})]})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx(it,{className:"mb-1 block",children:"Saldo Final (opcional)"}),a.jsx(Ct,{type:"text",inputMode:"numeric",placeholder:"0,00",value:Ge,onChange:Lr=>{const On=(Lr.target.value||"").replace(/\D/g,""),Qn=On?Number(On)/100:0,Ta=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Qn);Ye(Ta)},onKeyDown:Lr=>{Lr.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Lr.key)&&(/^[0-9]$/.test(Lr.key)||Lr.preventDefault())},onBeforeInput:Lr=>{const On=Lr.data??"";On&&/\D/.test(On)&&Lr.preventDefault()}})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mb-1",children:"Resumo"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(ee.saldoInicial||0).toFixed(2)]})]}),Object.keys(br).length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos nesta sesso."}):a.jsx("div",{className:"space-y-1",children:Object.entries(br).map(([Lr,On])=>a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:String(Lr)})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(On||0).toFixed(2)]})]},Lr))}),a.jsx("div",{className:"my-2 h-px bg-border"}),a.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mb-1",children:"Conferncia"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Suprimentos"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Nr.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Sangrias"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",an.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between font-medium text-base",children:[a.jsx("span",{className:"text-text-secondary",children:"Total em Caixa"})," ",a.jsxs("span",{className:"font-mono text-success",children:["R$ ",Number(St||0).toFixed(2)]})]})]})}),a.jsx(zd,{children:ft?a.jsxs(a.Fragment,{children:[a.jsx(se,{variant:"outline",onClick:()=>yt(!1),children:"Voltar"}),a.jsx(se,{onClick:async()=>{try{try{const Qn=await rd({codigoEmpresa:r?.codigo_empresa});if(Array.isArray(Qn)&&Qn.length>0){Fe?(Be(!0),e({title:"Fechamento bloqueado",description:`Existem ${Qn.length} comandas abertas. Feche todas antes de encerrar o caixa.`,variant:"warning"})):e({title:"Fechamento bloqueado",description:`Existem ${Qn.length} comandas abertas. Feche todas antes de encerrar o caixa.`,variant:"warning",duration:2500});return}}catch{}const Lr=String(Ge||"").replace(/\D/g,""),On=Lr?Number(Lr)/100:0;await ine({codigoEmpresa:r?.codigo_empresa,valorFinalDinheiro:On}),B(!1),he(!1),e({title:"Caixa fechado!",description:"Fechamento registrado com sucesso.",variant:"success"})}catch(Lr){e({title:"Falha ao fechar caixa",description:Lr?.message||"Tente novamente",variant:"destructive"})}},children:"Fechar Caixa"})]}):a.jsxs(a.Fragment,{children:[a.jsx(Wd,{onClick:()=>he(!1),children:"Cancelar"}),a.jsx(se,{onClick:()=>yt(!0),children:"Confirmar Fechamento"})]})})]})]})},qn=()=>{const ee=Fn=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Fn||0)),[Se,$e]=p.useState(!1),[Be,Ge]=p.useState(!1),[Ye,ft]=p.useState(""),[yt,Et]=p.useState(""),[br,Ue]=p.useState(!1),St=async()=>{try{Ue(!0);const Fn=String(Ye||"").replace(/\D/g,""),en=Fn?Number(Fn)/100:0;if(en<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await im({codigoEmpresa:r?.codigo_empresa}),await u3({tipo:"sangria",valor:en,observacao:yt,codigoEmpresa:r?.codigo_empresa}),$e(!1),ft(""),Et(""),await tt(),e({title:"Sangria registrada",variant:"success"})}catch(Fn){e({title:"Falha ao registrar sangria",description:Fn?.message||"Tente novamente",variant:"destructive"})}finally{Ue(!1)}},[Nr,an]=p.useState(""),[Lr,On]=p.useState(""),[Qn,Ta]=p.useState(!1),zn=async()=>{try{Ta(!0);const Fn=String(Nr||"").replace(/\D/g,""),en=Fn?Number(Fn)/100:0;if(en<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await im({codigoEmpresa:r?.codigo_empresa}),await u3({tipo:"suprimento",valor:en,observacao:Lr,codigoEmpresa:r?.codigo_empresa}),Ge(!1),an(""),On(""),await tt(),e({title:"Suprimento registrado",variant:"success"})}catch(Fn){e({title:"Falha ao registrar suprimento",description:Fn?.message||"Tente novamente",variant:"destructive"})}finally{Ta(!1)}};return a.jsx(In,{open:z,onOpenChange:U,children:a.jsxs(En,{className:"sm:max-w-lg w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden",onKeyDown:Fn=>Fn.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),a.jsx(Hn,{children:ge?"Carregando resumo...":V?"Resumo da sesso atual do caixa.":"Nenhuma sesso de caixa aberta."})]}),V?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex-1 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Saldo Inicial"}),a.jsx("div",{className:"text-base md:text-lg font-bold tabular-nums leading-tight",children:ee(V.saldo_inicial)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Entradas"}),a.jsx("div",{className:"text-base md:text-lg font-bold text-success tabular-nums leading-tight",children:ee(V.totalEntradas)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Sadas"}),a.jsx("div",{className:"text-base md:text-lg font-bold text-danger tabular-nums leading-tight",children:ee(V.totalSangria)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Saldo Atual"}),a.jsx("div",{className:"text-base md:text-lg font-bold tabular-nums leading-tight",children:ee((V.saldo_inicial||0)+(V.totalEntradas||0)-(V.totalSangria||0))})]})]}),a.jsxs("div",{className:"mt-5",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h4",{className:"text-sm font-semibold text-text-secondary",children:"Totais por Finalizadora"})}),Object.keys(V.totalPorFinalizadora||{}).length===0?a.jsx("div",{className:"p-3 text-sm text-text-muted border rounded-md",children:"Nenhuma finalizadora registrada ainda."}):a.jsx("ul",{className:"rounded-md border border-border overflow-hidden divide-y divide-border",children:Object.entries(V.totalPorFinalizadora||{}).map(([Fn,en])=>a.jsxs("li",{className:"bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:String(Fn)}),a.jsx("span",{className:"text-sm font-semibold tabular-nums",children:ee(en)})]},Fn))}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Suprimentos"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-success",children:ee(V.totalSuprimento||0)})]}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Sangrias"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-danger",children:ee(V.totalSangria||0)})]})]})]}),a.jsxs(Na,{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"mr-auto"}),a.jsx(se,{variant:"outline",onClick:()=>Ge(!0),children:"Registrar Suprimento"}),a.jsx(se,{variant:"destructive",onClick:()=>$e(!0),children:"Registrar Sangria"}),a.jsx(se,{variant:"secondary",onClick:()=>U(!1),children:"Fechar"})]}),a.jsx(In,{open:Be,onOpenChange:Ge,children:a.jsxs(En,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Fn=>Fn.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold",children:"Registrar Suprimento"}),a.jsx(Hn,{children:"Informe o valor de entrada no caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"flex-1 flex flex-col space-y-3",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"r-valor",children:"Valor"}),a.jsx(Ct,{id:"r-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:Nr,onChange:Fn=>{const en=(Fn.target.value||"").replace(/\D/g,""),Wa=en?Number(en)/100:0,Ya=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Wa);an(Ya)},onKeyDown:Fn=>{Fn.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Fn.key)&&(/^[0-9]$/.test(Fn.key)||Fn.preventDefault())},onBeforeInput:Fn=>{const en=Fn.data??"";en&&/\D/.test(en)&&Fn.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"r-obs",children:"Observao"}),a.jsx(Ct,{id:"r-obs",placeholder:"Opcional",value:Lr,onChange:Fn=>On(Fn.target.value)})]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>Ge(!1),disabled:Qn,children:"Cancelar"}),a.jsx(se,{onClick:zn,disabled:Qn,children:Qn?"Registrando...":"Confirmar"})]})]})}),a.jsx(In,{open:Se,onOpenChange:$e,children:a.jsxs(En,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Fn=>Fn.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold",children:"Registrar Sangria"}),a.jsx(Hn,{children:"Informe o valor a retirar do caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"s-valor",children:"Valor"}),a.jsx(Ct,{id:"s-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:Ye,onChange:Fn=>{const en=(Fn.target.value||"").replace(/\D/g,""),Wa=en?Number(en)/100:0,Ya=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Wa);ft(Ya)},onKeyDown:Fn=>{Fn.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Fn.key)&&(/^[0-9]$/.test(Fn.key)||Fn.preventDefault())},onBeforeInput:Fn=>{const en=Fn.data??"";en&&/\D/.test(en)&&Fn.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"s-obs",children:"Observao"}),a.jsx(Ct,{id:"s-obs",placeholder:"Opcional",value:yt,onChange:Fn=>Et(Fn.target.value)})]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>$e(!1),disabled:br,children:"Cancelar"}),a.jsx(se,{onClick:St,disabled:br,children:br?"Registrando...":"Confirmar"})]})]})})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma sesso de caixa aberta."})]})})},Gr=r?.codigo_empresa||"anon",ar={comandaId:`balcao:comandaId:${Gr}`,items:`balcao:items:${Gr}`,customerName:`balcao:customer:${Gr}`,clientChosen:`balcao:clientChosen:${Gr}`,pendingClientIds:`balcao:pendingClientIds:${Gr}`,missCount:`balcao:missCount:${Gr}`,lastMissTs:`balcao:lastMissTs:${Gr}`},kn=async(ee,Se=3)=>{if(!ee)return;const $e=r?.codigo_empresa,Be=++Xe.current;for(let Ge=0;Ge<Se;Ge++)try{const Ye=await To({comandaId:ee,codigoEmpresa:$e});if(Be!==Xe.current)return;const ft=(Ye||[]).map(yt=>({id:yt.id,productId:yt.produto_id,name:yt.descricao||"Item",price:Number(yt.preco_unitario||0),quantity:Number(yt.quantidade||1)}));c(ft);try{const yt=await Bi({comandaId:ee,codigoEmpresa:$e});if(Be!==Xe.current)return;const Et=(yt||[]).map(St=>St?.nome).filter(Boolean),br=Et.length?Et.join(", "):"";b(br),_r(!!br);const Ue=Array.from(new Set((yt||[]).map(St=>St?.cliente_id).filter(Boolean)));Ue.length>0&&Yt(Ue)}catch{b(""),_r(!1)}break}catch(Ye){if(Ge===Se-1)e({title:"Falha ao atualizar itens",description:Ye?.message||"Tente novamente",variant:"destructive"});else{const ft=350*(Ge+1),yt=Math.floor(Math.random()*120);await new Promise(Et=>setTimeout(Et,ft+yt))}}},Xn=async()=>{try{u(!0);let ee=setTimeout(()=>{Tt.current&&u(!1)},1e4);const Se=r?.codigo_empresa;if(!Se){Tt.current&&u(!1);return}try{const Ye=localStorage.getItem(ar.comandaId),ft=JSON.parse(localStorage.getItem(ar.items)||"[]"),yt=localStorage.getItem(ar.customerName)||"",Et=localStorage.getItem(ar.clientChosen),br=JSON.parse(localStorage.getItem(ar.pendingClientIds)||"[]");Ye&&s(Number.isNaN(+Ye)?Ye:Number(Ye)),Array.isArray(ft)&&ft.length>0&&c(ft),yt&&b(yt),Et==="true"&&_r(!0),Array.isArray(br)&&br.length>0&&Yt(br)}catch{}const $e=localStorage.getItem(ar.comandaId),Be=$e?Number.isNaN(+$e)?$e:Number($e):null,Ge=await Nv({codigoEmpresa:Se}).catch(()=>null);if(Ge?.id)s(Ge.id),await kn(Ge.id);else if(Be)s(Be),await kn(Be,3);else{let Ye=0,ft=0;try{Ye=Number(localStorage.getItem(ar.missCount)||"0"),ft=Number(localStorage.getItem(ar.lastMissTs)||"0")}catch{}const yt=Date.now(),br=yt-ft<9e4?Ye+1:1;try{localStorage.setItem(ar.missCount,String(br)),localStorage.setItem(ar.lastMissTs,String(yt))}catch{}try{const Ue=localStorage.getItem(ar.customerName)||"",St=localStorage.getItem(ar.clientChosen)==="true",Nr=JSON.parse(localStorage.getItem(ar.pendingClientIds)||"[]");b(Ue||""),_r(!!St),Yt(Array.isArray(Nr)?Nr:[])}catch{}if(s(null),br>=2){c([]);try{localStorage.removeItem(ar.comandaId),localStorage.removeItem(ar.items)}catch{}}else try{const Ue=JSON.parse(localStorage.getItem(ar.items)||"[]");Array.isArray(Ue)&&Ue.length>0&&c(Ue)}catch{}}try{const Ye=await Hu({includeInactive:!1,search:w?.trim()||void 0,codigoEmpresa:Se});Tt.current&&i(Ye||[])}catch{i([])}clearTimeout(ee)}catch(ee){e({title:"Falha ao carregar Modo Balco",description:ee?.message||"Tente novamente",variant:"destructive"})}finally{Tt.current&&u(!1)}},aa=async()=>{try{F(!0),x(!0);const ee=r?.codigo_empresa;if(n&&ee)try{try{await re.from("comanda_itens").delete().eq("comanda_id",n).eq("codigo_empresa",ee)}catch{}try{await re.from("comanda_clientes").delete().eq("comanda_id",n).eq("codigo_empresa",ee)}catch{}await re.from("comandas").delete().eq("id",n).eq("codigo_empresa",ee)}catch{}}finally{s(null),c([]),Yt([]),b(""),_r(!1),A(null);try{localStorage.removeItem(ar.comandaId),localStorage.removeItem(ar.items),localStorage.removeItem(ar.customerName)}catch{}F(!1),e({title:"Venda cancelada",variant:"success"}),x(!1)}};p.useEffect(()=>{let ee=!1;(async()=>{await Xn(),!ee&&Tt.current&&!n&&(Qt.current||[]).length===0&&(ee=!0,setTimeout(()=>{Tt.current&&Xn()},700))})()},[r?.codigo_empresa]),p.useEffect(()=>{try{n&&localStorage.setItem(ar.comandaId,String(n)),localStorage.setItem(ar.items,JSON.stringify(l||[])),localStorage.setItem(ar.customerName,v||""),localStorage.setItem(ar.clientChosen,kr?"true":"false"),n?localStorage.removeItem(ar.pendingClientIds):localStorage.setItem(ar.pendingClientIds,JSON.stringify(et||[]))}catch{}},[n,l,v,kr,et]),p.useEffect(()=>{const ee=()=>{n&&kn(n,2)},Se=()=>{document.visibilityState==="visible"&&n&&kn(n,2)};return window.addEventListener("focus",ee),document.addEventListener("visibilitychange",Se),()=>{window.removeEventListener("focus",ee),document.removeEventListener("visibilitychange",Se)}},[n]),p.useEffect(()=>{const ee=Se=>{const $e=Se.target;if(!($e&&($e.tagName==="INPUT"||$e.tagName==="TEXTAREA"))){if(Se.key==="p"||Se.key==="P"){Se.preventDefault(),kt.current?.focus();return}if((Se.key==="c"||Se.key==="C")&&k&&kr){Se.preventDefault(),Jt(!0);return}if(Se.key==="Escape"){if(Pt){Lt(!1);return}if(xr){Jt(!1);return}if(J){G(!1);return}if(wt){gt(!1);return}}}};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[k,kr,Pt,xr,J,wt]),p.useEffect(()=>{const ee=$e=>{if(!dt||!ce.current)return;const Ge=ce.current.getBoundingClientRect(),Ye=18;Ge.width-Ye;const yt=($e.clientX-Ge.left)/Ge.width*100;yt>=20&&yt<=80&&tr(yt)},Se=()=>{if(dt){Mt(!1);try{localStorage.setItem("balcao_left_panel_width",String(ct))}catch{}}};return dt&&(document.addEventListener("mousemove",ee),document.addEventListener("mouseup",Se),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",Se),document.body.style.cursor="",document.body.style.userSelect=""}},[dt,ct]),p.useEffect(()=>{let ee=!0;const Se=setTimeout(async()=>{try{const $e=await Hu({includeInactive:!1,search:w?.trim()||void 0,codigoEmpresa:r?.codigo_empresa});if(!ee)return;let Be=$e||[];if(w?.trim()){const Ge=w.trim().toLowerCase();Be=Be.filter(Ye=>(Ye.name||"").toLowerCase().includes(Ge)||(Ye.code||"").toLowerCase().includes(Ge))}Be.sort((Ge,Ye)=>{const ft=Ge.code||"",yt=Ye.code||"";return/^\d+$/.test(ft)&&/^\d+$/.test(yt)?parseInt(ft,10)-parseInt(yt,10):ft.localeCompare(yt)}),i(Be)}catch{ee&&i([])}},300);return()=>{ee=!1,clearTimeout(Se)}},[w]),p.useEffect(()=>{if(Y)return;let ee=!0;const Se=async()=>{try{const Be=r?.codigo_empresa;if(!Be)return;const Ge=await vh({codigoEmpresa:Be});if(!ee)return;const Ye=new Map;for(const ft of Ge||[]){const yt=ft.produto_id,Et=Number(ft.quantidade||0);Ye.set(yt,(Ye.get(yt)||0)+Et)}T(Ye)}catch(Be){console.error("[BalcaoPage] Erro ao buscar estoque reservado:",Be),ee&&T(new Map)}};Se();const $e=setInterval(Se,5e3);return()=>{ee=!1,clearInterval($e)}},[r?.codigo_empresa,l,Y]),p.useEffect(()=>{if(Y)return;let ee=!0;const Se=setTimeout(async()=>{try{const $e=await Yb({searchTerm:Ot,limit:20,codigoEmpresa:r?.codigo_empresa});if(!ee)return;const Be=($e||[]).slice().sort((Ge,Ye)=>Number(Ge?.codigo||0)-Number(Ye?.codigo||0));if(Qe(Be),!n&&!kr&&xr&&(!et||et.length===0)){const Ge=Be?.find(Ye=>Ye?.codigo===0);if(Ge){Yt([Ge.id]);try{localStorage.setItem(ar.pendingClientIds,JSON.stringify([Ge.id]))}catch{}}}}catch{ee&&Qe([])}},250);return()=>{ee=!1,clearTimeout(Se)}},[Ot,xr,Y]);const pa=p.useMemo(()=>l.reduce((ee,Se)=>ee+Number(Se.price||0)*Number(Se.quantity||0),0),[l]),te=p.useMemo(()=>{const ee=new Map;for(const Se of l||[]){const $e=Se.productId;if(!$e)continue;const Be=Number(Se.quantity||0);ee.set($e,(ee.get($e)||0)+Be)}return ee},[l]),Te=async(ee,Se={})=>{try{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}if(!kr&&!Se.skipClientCheck){A(ee),Jt(!0),e({title:"Selecione o cliente",description:"Escolha um cliente cadastrado antes de vender.",variant:"warning"});return}const $e=r?.codigo_empresa;if(!$e){e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}if(j)return;const Be=Number(ee.stock??ee.currentStock??0),Ge=I.get(ee.id)||0,Ye=Math.max(0,Be-Ge),ft=Number(ee.minStock??0);if(Ye<=0){e({title:"Sem estoque disponvel",description:`Produto "${ee.name}" est sem estoque (${Be} total, ${Ge} reservado em outras comandas).`,variant:"destructive"});return}S(ee.id);let yt=n;const Et=!yt;if(!yt)try{h(!0);const St=await Tj({codigoEmpresa:$e});yt=St.id,s(St.id),await new Promise(an=>setTimeout(an,300));const{data:Nr}=await re.from("comandas").select("id").eq("id",yt).eq("codigo_empresa",$e).single();if(!Nr)throw new Error("Comanda criada mas no acessvel via RLS")}catch(St){if(St?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para vender",description:"Voc precisa abrir o caixa antes de iniciar uma comanda no Balco.",variant:"warning"});return}throw St}finally{h(!1)}const br=Number(ee.salePrice??ee.price??0),Ue=(Qt.current||[]).find(St=>St.productId===ee.id);Ue?await Fd({itemId:Ue.id,quantidade:Number(Ue.quantity||0)+1,codigoEmpresa:$e}):await f3({comandaId:yt,produtoId:ee.id,descricao:ee.name,quantidade:1,precoUnitario:br,codigoEmpresa:$e}),await kn(yt);try{const St=await vh({codigoEmpresa:$e}),Nr=new Map;for(const an of St||[]){const Lr=an.produto_id,On=Number(an.quantidade||0);Nr.set(Lr,(Nr.get(Lr)||0)+On)}T(Nr)}catch(St){console.error("[BalcaoPage:addProduct] Erro ao atualizar estoque reservado:",St)}if(Et)try{const St=Array.from(new Set(et||[]));if(St.length>0){await Jb({comandaId:yt,clienteIds:St,nomesLivres:[],codigoEmpresa:$e,replace:!0}),await kn(yt);const an=(await Bi({comandaId:yt,codigoEmpresa:$e})||[]).map(Lr=>Lr?.nome).filter(Boolean);b(an.length?an.join(", "):""),_r(!0);try{localStorage.removeItem(ar.pendingClientIds),localStorage.setItem(ar.customerName,an.length?an.join(", "):""),localStorage.setItem(ar.clientChosen,"true")}catch(Lr){console.error("Erro ao atualizar cache local:",Lr)}}}catch(St){console.error("Erro ao associar clientes:",St)}Be-1<=0?e({title:"ltima unidade vendida",description:`"${ee.name}" esgotou aps esta venda.`,variant:"warning"}):Be-1<=ft?e({title:"Estoque baixo",description:`"${ee.name}" atingiu nvel de estoque baixo.`,variant:"warning"}):e({title:"Produto adicionado",description:ee.name,variant:"success"})}catch($e){const Be=String($e?.message||"").toLowerCase();$e?.code==="OUT_OF_STOCK"||Be.includes("sem estoque")?e({title:"Sem estoque",description:"Este produto est sem estoque.",variant:"destructive"}):$e?.code==="INSUFFICIENT_STOCK"||Be.includes("insuficiente")?e({title:"Estoque insuficiente",description:$e?.message||"Quantidade maior que o disponvel.",variant:"destructive"}):e({title:"Falha ao adicionar",description:$e?.message||"Tente novamente",variant:"destructive"})}finally{S(null)}},at=async()=>{try{if(oe(!0),!kr){Jt(!0),e({title:"Selecione o cliente",description:"Escolha um cliente cadastrado antes de pagar.",variant:"warning"}),oe(!1);return}const ee=r?.codigo_empresa;if(!ee){e({title:"Empresa no definida",variant:"destructive"});return}if(!n)try{h(!0);const St=await Tj({codigoEmpresa:ee});if(!St?.id){e({title:"Comanda no encontrada",description:"Abra uma comanda antes de pagar.",variant:"destructive"}),oe(!1);return}s(St.id)}catch(St){if(St?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para pagar",description:" necessrio abrir o caixa antes de iniciar/confirmar uma venda.",variant:"warning"}),oe(!1);return}throw St}finally{h(!1)}try{await sKe({comandaId:n,codigoEmpresa:ee})}catch(St){const Nr=Array.isArray(St?.items)&&St.items.length?St.items.map(an=>`${an.name} (solicitado ${an.solicitado}, estoque ${an.estoque})`).join("; "):St?.message||"Estoque insuficiente na comanda";e({title:"Estoque insuficiente",description:Nr,variant:"destructive",duration:7e3}),oe(!1);return}const Se=await Ah({somenteAtivas:!0,codigoEmpresa:ee});ve(Se||[]);let $e=[];try{const St=await Bi({comandaId:n,codigoEmpresa:ee});$e=(Array.isArray(St)?St:[]).map(an=>{const Lr=an?.cliente_id??an?.clientes?.id??null,On=an?.clientes?.nome??an?.nome??an?.nome_livre??"";return Lr?{id:Lr,nome:On}:null}).filter(Boolean)}catch{$e=[]}pt($e);const Be=Se&&Se[0]&&Se[0].id?Se[0].id:null,Ge=et&&et.length>0?et[0]:$e[0]?.id||null;let Ye=0;try{Ye=(await To({comandaId:n,codigoEmpresa:ee})||[]).reduce((Nr,an)=>Nr+Number(an.quantidade||0)*Number(an.preco_unitario||0),0)}catch{}const ft=(Se||[]).find(St=>String(St.id)===String(Be)),yt=Number(ft?.taxa_percentual||0),Et=yt>0,br=Et?Ye*(1+yt/100):Ye,Ue=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(br);De([{id:1,clientId:Ge,methodId:Be,value:Ue,chargeFee:Et}]),ie(2),G(!0),oe(!1);return}catch(ee){if(ee?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para pagar",description:" necessrio abrir o caixa antes de iniciar/confirmar uma venda.",variant:"warning"}),oe(!1);return}e({title:"Falha ao iniciar pagamento",description:ee?.message||"Tente novamente",variant:"destructive"})}finally{oe(!1)}};return a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"md:hidden mb-2 w-full",children:a.jsx(od,{value:"balcao",onValueChange:ee=>{ee==="mesas"&&t("/vendas"),ee==="balcao"&&t("/balcao"),ee==="historico"&&t("/historico")},children:a.jsxs(sc,{className:"grid w-full grid-cols-3",children:[a.jsx(Pa,{value:"mesas",className:"text-xs",children:"Mesas"}),a.jsx(Pa,{value:"balcao",className:"text-xs",children:"Balco"}),a.jsx(Pa,{value:"historico",className:"text-xs",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center justify-between mb-2 md:mb-6 gap-2 md:gap-4",children:[a.jsx("div",{className:"hidden md:flex items-center gap-2 md:gap-3",children:a.jsx(od,{value:"balcao",onValueChange:ee=>{ee==="mesas"&&t("/vendas"),ee==="balcao"&&t("/balcao"),ee==="historico"&&t("/historico")},children:a.jsxs(sc,{className:"inline-flex",children:[a.jsx(Pa,{value:"mesas",className:"text-sm",children:"Mesas"}),a.jsx(Pa,{value:"balcao",className:"text-sm",children:"Balco"}),a.jsx(Pa,{value:"historico",className:"text-sm",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-3 md:ml-auto",children:[a.jsx(Xt,{}),a.jsx(Tr,{}),a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>U(!0),className:"px-3",children:[a.jsx(Y4,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Detalhes"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Detalhes do Caixa"})]})]})]}),a.jsx("div",{className:"md:hidden flex-1 flex flex-col",children:a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden bg-surface flex-1 min-h-0",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Comanda"}),a.jsx("div",{className:"text-base font-bold truncate",children:"Balco"}),kr&&v&&a.jsx("div",{className:"text-[11px] text-text-muted truncate mt-0.5",children:v})]}),a.jsx("div",{className:"flex flex-col items-end gap-1",children:kr?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsxs(se,{size:"sm",className:"h-8 px-2 text-xs bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}Lt(!0)},children:[a.jsx(Es,{className:"h-4 w-4 mr-1"})," Produto"]}),a.jsx(se,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs",onClick:()=>Jt(!0),children:"+ Cliente"})]}),a.jsxs("span",{className:"text-xs text-text-muted whitespace-nowrap",children:["Total: R$ ",pa.toFixed(2)]})]}):a.jsx(se,{size:"sm",className:"h-8 px-3 text-xs bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}Jt(!0)},children:"Iniciar venda"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3 thin-scroll min-h-0",children:kr?l.length===0?a.jsxs("div",{className:"text-center pt-8 text-xs text-text-muted space-y-2",children:[a.jsx("div",{children:"Comanda criada para o cliente."}),a.jsxs("div",{children:["Use o boto ",a.jsx("span",{className:"font-semibold",children:"Produto"})," para adicionar itens."]})]}):a.jsx("ul",{className:"space-y-2",children:l.map(ee=>a.jsxs("li",{className:"p-2 rounded-md border border-border/40 bg-surface-2",children:[a.jsx("div",{className:"text-sm font-medium truncate",title:ee.name,children:ee.name}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(se,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Se=>{Se.stopPropagation();const $e=r?.codigo_empresa;if(!$e){e({title:"Empresa no definida",variant:"destructive"});return}const Be=Number(ee.quantity||1)-1;try{Be<=0?(await Sv({itemId:ee.id,codigoEmpresa:$e}),c(Ge=>Ge.filter(Ye=>Ye.id!==ee.id))):(await Fd({itemId:ee.id,quantidade:Be,codigoEmpresa:$e}),c(Ge=>Ge.map(Ye=>Ye.id===ee.id?{...Ye,quantity:Be}:Ye)))}catch(Ge){e({title:"Falha ao atualizar item",description:Ge?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-7 text-center text-sm font-semibold",children:ee.quantity}),a.jsx(se,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Se=>{Se.stopPropagation();const $e=r?.codigo_empresa;if(!$e){e({title:"Empresa no definida",variant:"destructive"});return}const Be=Number(ee.quantity||1)+1;try{await Fd({itemId:ee.id,quantidade:Be,codigoEmpresa:$e}),c(Ge=>Ge.map(Ye=>Ye.id===ee.id?{...Ye,quantity:Be}:Ye))}catch(Ge){e({title:"Falha ao atualizar item",description:Ge?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]}),a.jsxs("span",{className:"text-sm font-semibold whitespace-nowrap",children:["R$ ",(Number(ee.quantity)*Number(ee.price)).toFixed(2)]})]})]},ee.id))}):a.jsx("div",{className:"text-center pt-8 text-xs text-text-muted space-y-2",children:a.jsxs("div",{children:["Para comear, toque em ",a.jsx("span",{className:"font-semibold",children:"Iniciar venda"})," e selecione o cliente."]})})}),a.jsx("div",{className:"p-3 border-t border-border flex gap-2",children:kr?a.jsxs(a.Fragment,{children:[a.jsx(se,{className:"flex-1",variant:"outline",size:"sm",onClick:aa,disabled:P,children:"Cancelar"}),a.jsx(se,{className:"flex-1",size:"sm",disabled:pa<=0,onClick:at,children:"Finalizar"})]}):a.jsx(se,{className:"flex-1",size:"sm",variant:"outline",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}Jt(!0)},children:"Iniciar venda"})})]})}),a.jsx(qn,{}),a.jsx(In,{open:wt,onOpenChange:ee=>{gt(ee),ee||vt(null)},children:a.jsxs(En,{className:"sm:max-w-[420px] w-full max-h-[85vh] flex flex-col animate-none",onKeyDown:ee=>ee.stopPropagation(),onPointerDownOutside:ee=>ee.stopPropagation(),onInteractOutside:ee=>ee.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold break-words",title:Ze?.name||"",children:Ze?.name||"Produto"}),a.jsx(Hn,{children:"Detalhes do produto e aes rpidas."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Ze?.price??Ze?.salePrice??0))})]}),Ze?.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:Ze.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof Ze?.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:Ze.stock})]}),typeof Ze?.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:Ze.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",te.get(Ze?.id)||0]})]})]})]}),a.jsxs(Na,{className:"flex items-center justify-between gap-2",children:[a.jsxs(se,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{Ze&&t("/produtos",{state:{productId:Ze.id,productName:Ze.name}})},children:[a.jsx(Vi,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(se,{variant:"outline",onClick:()=>{gt(!1),vt(null)},children:"Fechar"}),a.jsx(se,{onClick:async()=>{Ze&&(await Te(Ze,{skipClientCheck:!1}),gt(!1),vt(null))},children:"Adicionar"})]})]})}),(f||m||g)&&a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80",children:a.jsxs("div",{className:"px-8 py-6 rounded-xl bg-surface border border-border shadow-2xl flex flex-col items-center gap-4 max-w-sm w-[85vw] text-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-brand border-t-transparent animate-spin","aria-hidden":"true"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"block text-base font-semibold text-text-primary",children:f?"Abrindo venda...":m?"Cancelando venda...":"Fechando conta..."}),a.jsx("span",{className:"block text-xs text-text-muted",children:f?"Aguarde, estamos iniciando a venda e sincronizando com os dispositivos.":m?"Aguarde, estamos cancelando a venda e limpando os itens.":"Aguarde, estamos registrando o pagamento e encerrando a venda."})]})]})}),a.jsx(In,{open:Pt,onOpenChange:Lt,children:a.jsxs(En,{className:"sm:max-w-xl w-[92vw] max-h-[85vh] flex flex-col overflow-hidden animate-none",onOpenAutoFocus:ee=>ee.preventDefault(),onKeyDown:ee=>ee.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold",children:"Adicionar Produtos"}),a.jsx(Hn,{children:"Busque e adicione produtos  comanda do balco."})]}),a.jsx("div",{className:"p-4 pt-0",children:a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar produto...",className:"pl-9",value:gr,onChange:ee=>fr(ee.target.value)})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4 thin-scroll",children:[a.jsx("ul",{className:"space-y-2",children:(o||[]).filter(ee=>{const Se=(gr||"").toLowerCase();if(!Se)return!0;const $e=String(ee.name||ee.descricao||"").toLowerCase(),Be=String(ee.code||ee.codigo||"").toLowerCase();return $e.includes(Se)||Be.includes(Se)}).sort((ee,Se)=>{const $e=ee.code?parseInt(ee.code,10):999999,Be=Se.code?parseInt(Se.code,10):999999;return $e-Be}).map(ee=>{const Se=te.get(ee.id)||0,$e=Number(ee.stock??ee.currentStock??0),Be=Math.max(0,$e-Se),Ge=Number(ee.salePrice??ee.price??0);return a.jsxs("li",{className:"flex items-center p-2 rounded-md hover:bg-surface-2 transition-colors border border-border/40",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"font-semibold truncate max-w-[200px]",title:`${ee.code?`[${ee.code}] `:""}${ee.name}`,children:[ee.code&&a.jsxs("span",{className:"text-text-muted",children:["[",ee.code,"]"]})," ",ee.name]}),Se>0&&a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-brand/15 text-brand border border-brand/30 flex-shrink-0",children:["x",Se]}),a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-surface-2 text-text-secondary border border-border flex-shrink-0",children:["Qtd ",Be]})]}),a.jsxs("p",{className:"text-sm text-text-muted",children:["R$ ",Ge.toFixed(2)]})]}),a.jsx(se,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:async()=>{await Te(ee)},"aria-label":`Adicionar ${ee.name}`,children:a.jsx(Es,{className:"h-4 w-4"})})]},ee.id)})}),Array.isArray(o)&&o.length===0&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(Tb,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Nenhum produto encontrado."})]})]}),a.jsx(Na,{children:a.jsx(se,{variant:"outline",onClick:()=>Lt(!1),children:"Fechar"})})]})}),a.jsxs("div",{ref:ce,className:"hidden md:flex gap-0 h-full overflow-hidden relative",children:[a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden",style:{width:`${ct}%`},children:[a.jsxs("div",{className:"p-4 border-b border-border space-y-3 cursor-pointer",onClick:ee=>{ee.target.tagName==="INPUT"||ee.target.tagName==="BUTTON"||ee.target.closest("button")||kt.current?.focus()},children:[a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar produto...",className:"pl-9",value:w,onChange:ee=>_(ee.target.value),onKeyDown:ee=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(ee.key)&&ee.stopPropagation()}})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("button",{onClick:()=>Ke("all"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${rn==="all"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Todos"}),a.jsx("button",{onClick:()=>Ke("available"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${rn==="available"?"bg-success text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Disponvel"}),a.jsx("button",{onClick:()=>Ke("low"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${rn==="low"?"bg-warning text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Estoque Baixo"}),a.jsx("button",{onClick:()=>Ke("out"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${rn==="out"?"bg-destructive text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Sem Estoque"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{ze("code");try{localStorage.setItem("balcao_sort_order","code")}catch{}},className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${qe==="code"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,title:"Ordenar por cdigo",children:"Cdigo"}),a.jsx("button",{onClick:()=>{ze("name");try{localStorage.setItem("balcao_sort_order","name")}catch{}},className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${qe==="name"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,title:"Ordenar por nome",children:"A-Z"})]})]}),a.jsx("div",{className:"flex items-center gap-4 text-sm text-text-muted cursor-pointer",onClick:()=>kt.current?.focus(),children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("kbd",{className:"px-2 py-1 bg-surface border border-border rounded text-xs font-mono",children:""}),a.jsx("span",{children:"Navegar"})]})})]}),a.jsx("div",{ref:kt,className:"flex-1 overflow-y-auto p-4 thin-scroll focus:outline-none focus:ring-2 focus:ring-brand/20",tabIndex:0,onClick:()=>kt.current?.focus(),onKeyDown:ee=>{const Se=o.filter(Ge=>{const Ye=w.trim().toLowerCase(),ft=!Ye||(Ge.name||"").toLowerCase().includes(Ye)||String(Ge.code||"").toLowerCase().includes(Ye);if(rn==="all")return ft;const yt=I.get(Ge.id)||0,Et=Number(Ge.stock??Ge.currentStock??0),br=Math.max(0,Et-yt);return rn==="available"?ft&&br>0:rn==="low"?ft&&br>0&&br<=5:rn==="out"?ft&&br<=0:ft}).sort((Ge,Ye)=>{if(qe==="name"){const ft=(Ge.name||"").toLowerCase(),yt=(Ye.name||"").toLowerCase();return ft.localeCompare(yt)}else{const ft=Ge.code?parseInt(Ge.code,10):999999,yt=Ye.code?parseInt(Ye.code,10):999999;return ft-yt}});if(!["ArrowDown","ArrowUp","Home","End"].includes(ee.key))return;ee.preventDefault();const $e=Rr||0,Be=Se.length;if(ee.key==="ArrowDown"){const Ge=Math.min($e+1,Be-1);nn(Ge),requestAnimationFrame(()=>Je.current[Ge]?.scrollIntoView({block:"nearest"}))}if(ee.key==="ArrowUp"){const Ge=Math.max($e-1,0);nn(Ge),requestAnimationFrame(()=>Je.current[Ge]?.scrollIntoView({block:"nearest"}))}if(ee.key==="Home"&&(nn(0),requestAnimationFrame(()=>Je.current[0]?.scrollIntoView({block:"nearest"}))),ee.key==="End"){const Ge=Math.max(0,Be-1);nn(Ge),requestAnimationFrame(()=>Je.current[Ge]?.scrollIntoView({block:"nearest"}))}},children:(o||[]).length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12",children:[a.jsx(Tb,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("p",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhum produto cadastrado"}),a.jsx("p",{className:"text-sm text-text-muted mb-6 text-center",children:"Cadastre produtos para comear a vender"}),a.jsxs(se,{onClick:()=>t("/produtos"),children:[a.jsx(Es,{className:"mr-2 h-4 w-4"}),"Cadastrar Produto"]})]}):a.jsx("ul",{className:"space-y-2",children:o.filter(ee=>{const Se=w.trim().toLowerCase(),$e=!Se||(ee.name||"").toLowerCase().includes(Se)||String(ee.code||"").toLowerCase().includes(Se);if(rn==="all")return $e;const Be=I.get(ee.id)||0,Ge=Number(ee.stock??ee.currentStock??0),Ye=Math.max(0,Ge-Be);return rn==="available"?$e&&Ye>0:rn==="low"?$e&&Ye>0&&Ye<=5:rn==="out"?$e&&Ye<=0:$e}).sort((ee,Se)=>{if(qe==="name"){const $e=(ee.name||"").toLowerCase(),Be=(Se.name||"").toLowerCase();return $e.localeCompare(Be)}else{const $e=ee.code?parseInt(ee.code,10):999999,Be=Se.code?parseInt(Se.code,10):999999;return $e-Be}}).map((ee,Se)=>{const $e=te.get(ee.id)||0,Be=I.get(ee.id)||0,Ge=Number(ee.stock??ee.currentStock??0),Ye=Math.max(0,Ge-Be),ft=Number(ee.salePrice??ee.price??0),yt=Se===Rr;return a.jsx(Ee.Fragment,{children:a.jsxs("li",{ref:Et=>{Je.current[Se]=Et},className:`flex items-center gap-3 p-2 rounded-md transition-colors border-2 ${yt?"border-brand bg-brand/5":"border-transparent hover:bg-surface-2"} ${Ye===0&&$e===0?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{nn(Se),kt.current?.focus()},children:[a.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:Et=>{Et.stopPropagation(),vt({...ee,qty:$e,remaining:Ye,price:ft}),gt(!0)},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsxs("p",{className:"font-semibold truncate",title:`${ee.code?`[${ee.code}] `:""}${ee.name}`,children:[ee.code&&a.jsxs("span",{className:"text-text-muted",children:["[",ee.code,"]"]})," ",ee.name]}),$e>0&&a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-brand/15 text-brand border border-brand/30 flex-shrink-0",children:["x",$e]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["R$ ",ft.toFixed(2)]}),a.jsxs("span",{className:`text-xs font-medium whitespace-nowrap ${Ye<=0?"text-destructive":Ye<=5?"text-warning":"text-text-secondary"}`,children:["Estoque: ",Ye]})]})]}),a.jsx(se,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:Et=>{Et.stopPropagation(),Te(ee)},disabled:Ye===0,"aria-label":`Adicionar ${ee.name}`,children:a.jsx(Es,{className:"h-4 w-4"})})]})},ee.id)})})})]}),a.jsx("div",{className:"w-2 bg-border hover:bg-brand cursor-col-resize transition-colors flex-shrink-0 mx-2",onMouseDown:()=>Mt(!0),title:"Arraste para redimensionar"}),a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden",style:{width:`${100-ct}%`},children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2 flex-wrap",children:[a.jsxs("div",{className:"min-w-0 flex-shrink",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Comanda"}),a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"text-base font-bold whitespace-nowrap",children:"Balco"}),v?a.jsx("span",{className:"truncate text-[11px] px-2 py-0.5 rounded-full border border-border bg-surface-2 text-text-secondary",children:v}):null]})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 flex-wrap",children:[a.jsxs(se,{size:"sm",className:"md:hidden h-8 px-2 text-xs whitespace-nowrap bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}Lt(!0)},title:"Adicionar produto",children:[a.jsx(Es,{className:"h-4 w-4 mr-1"}),"Produto"]}),kr&&a.jsx(se,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs whitespace-nowrap",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar clientes.",variant:"warning"});return}Jt(!0)},children:"+ Cliente"}),kr?a.jsxs(ku,{children:[a.jsx(gg,{asChild:!0,children:a.jsx(se,{size:"sm",className:"h-8 px-2 text-xs whitespace-nowrap bg-red-600 hover:bg-red-500 text-white border border-red-600/70 focus:outline-none focus:ring-0 focus-visible:ring-0 shadow-none",disabled:P,children:P?"Cancelando...":"Cancelar"})}),a.jsxs(Bd,{className:"sm:max-w-[420px] animate-none",onKeyDown:ee=>ee.stopPropagation(),children:[a.jsxs(qd,{children:[a.jsx(Ud,{children:"Cancelar venda do balco?"}),a.jsx(Vd,{children:"Os itens sero descartados e a venda ser limpa. Esta ao no pode ser desfeita."})]}),a.jsxs(zd,{children:[a.jsx(Wd,{children:"Voltar"}),a.jsx(Iu,{onClick:aa,children:"Confirmar Cancelamento"})]})]})]}):a.jsx(se,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs opacity-60 cursor-not-allowed whitespace-nowrap",disabled:!0,children:"Cancelar"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 thin-scroll",children:kr?l.length===0?a.jsx("div",{className:"text-center text-text-muted pt-16",children:'Comanda vazia. Use o boto "+" para adicionar produtos.'}):a.jsx("ul",{className:"space-y-3 pr-1",children:l.map(ee=>a.jsxs("li",{className:"p-2 rounded-md border border-border/30 bg-surface hover:bg-surface-2 transition-colors",children:[a.jsx("div",{className:"min-w-0 flex-1",children:a.jsx("div",{className:"font-medium truncate",title:ee.name,children:ee.name})}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(se,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Se=>{Se.stopPropagation();const $e=r?.codigo_empresa;if(!$e){e({title:"Empresa no definida",variant:"destructive"});return}const Be=Number(ee.quantity||1)-1;try{Be<=0?(await Sv({itemId:ee.id,codigoEmpresa:$e}),c(Ge=>Ge.filter(Ye=>Ye.id!==ee.id))):(await Fd({itemId:ee.id,quantidade:Be,codigoEmpresa:$e}),c(Ge=>Ge.map(Ye=>Ye.id===ee.id?{...Ye,quantity:Be}:Ye)));try{const Ge=await vh({codigoEmpresa:$e}),Ye=new Map;for(const ft of Ge||[]){const yt=ft.produto_id,Et=Number(ft.quantidade||0);Ye.set(yt,(Ye.get(yt)||0)+Et)}T(Ye)}catch(Ge){console.error("[BalcaoPage:removeItem] Erro ao atualizar estoque reservado:",Ge)}}catch(Ge){const Ye=String(Ge?.message||"").toLowerCase();Ge?.code==="INSUFFICIENT_STOCK"||Ye.includes("insuficiente")?e({title:"Estoque insuficiente",description:Ge?.message||"Quantidade maior que o disponvel.",variant:"warning"}):e({title:"Falha ao atualizar item",description:Ge?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-7 text-center font-semibold",children:ee.quantity}),a.jsx(se,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Se=>{Se.stopPropagation();const $e=r?.codigo_empresa;if(!$e){e({title:"Empresa no definida",variant:"destructive"});return}const Be=Number(ee.quantity||1)+1;try{await Fd({itemId:ee.id,quantidade:Be,codigoEmpresa:$e}),c(Ge=>Ge.map(Ye=>Ye.id===ee.id?{...Ye,quantity:Be}:Ye))}catch(Ge){const Ye=String(Ge?.message||"").toLowerCase();Ge?.code==="INSUFFICIENT_STOCK"||Ye.includes("insuficiente")?e({title:"Estoque insuficiente",description:Ge?.message||"Quantidade maior que o disponvel.",variant:"warning"}):e({title:"Falha ao atualizar item",description:Ge?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"font-semibold whitespace-nowrap",children:["R$ ",(Number(ee.quantity)*Number(ee.price)).toFixed(2)]}),a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-surface text-text-secondary border border-border",children:["x",ee.quantity]})]})]})]},ee.id))}):a.jsxs("div",{className:"text-center pt-12",children:[a.jsx("div",{className:"text-sm text-text-secondary mb-3",children:"Para comear, inicie uma nova venda e selecione o cliente."}),a.jsx(se,{disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}Jt(!0)},children:"Iniciar nova venda"})]})}),a.jsxs("div",{className:"p-4 border-t border-border",children:[a.jsxs("div",{className:"flex justify-between items-center text-lg font-bold mb-3",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",pa.toFixed(2)]})]}),a.jsx(se,{size:"lg",className:"w-full",onClick:at,disabled:pa<=0,children:"Finalizar Pagamento"})]})]})]}),a.jsx(In,{open:J,onOpenChange:G,children:a.jsxs(En,{className:"sm:max-w-xl w-[92vw] max-h-[90vh] flex flex-col overflow-hidden animate-none",onKeyDown:ee=>ee.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Fechar Conta"}),a.jsx(Hn,{children:"Divida o pagamento entre clientes e vrias finalizadoras, se necessrio."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",pa.toFixed(2)]})]}),a.jsxs("div",{className:"flex-1 space-y-2 overflow-y-auto thin-scroll pr-1",children:[a.jsx(it,{className:"block",children:"Pagamentos"}),(()=>null)(),(()=>null)(),(me||[]).map((ee,Se)=>{const $e=Ye=>{if(!Ye)return v||"Cliente";const ft=String(Ye),yt=(ht||[]).find(br=>String(br.id)===ft);if(yt?.nome)return yt.nome;const Et=(Me||[]).find(br=>String(br.id)===ft);return Et?.nome?Et.nome:v||"Cliente"},Be=(ht||[]).length>1,Ge=(ht||[])[0]||null;return(ht||[]).filter(Ye=>String(Ye.id)!==String(Ge?.id||"")),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-2 items-start",children:[a.jsx("div",{className:"sm:col-span-1 flex sm:justify-start",children:me.length>1&&Se>0&&a.jsx(se,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>{De(Ye=>{const ft=Ye.filter(Ue=>Ue.id!==ee.id);if(ft.length===0)return[];const yt=(l||[]).reduce((Ue,St)=>Ue+Number(St.quantity||0)*Number(St.price||0),0),Et=Math.floor(yt/ft.length*100)/100,br=yt-Et*ft.length;return ft.map((Ue,St)=>{const Nr=St===ft.length-1?Et+br:Et;return Gt(Ue,Nr)})})},children:a.jsx(lc,{className:"h-4 w-4"})})}),Se===0?a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:$e(Ge?.id||ee.clientId)})}):Be?a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(Gn,{value:ee.clientId||"",onValueChange:Ye=>De(ft=>ft.map(yt=>yt.id===ee.id?{...yt,clientId:Ye}:yt)),children:[a.jsx(Vn,{className:"w-full truncate",children:a.jsx(Kn,{placeholder:"Cliente"})}),a.jsx(Wn,{children:(ht||[]).map(Ye=>a.jsx(lt,{value:Ye.id,children:Ye.nome},Ye.id))})]})}):a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:$e(Ge?.id||ee.clientId)})}),a.jsxs("div",{className:"sm:col-span-4",children:[a.jsxs(Gn,{value:ee.methodId||"",onValueChange:Ye=>De(ft=>ft.map(yt=>{if(yt.id!==ee.id)return yt;const Et=Oe(Ye),br=Number(Et?.taxa_percentual||0);if(br>0){const St=Ht(yt)*(1+br/100);return{...yt,methodId:Ye,chargeFee:!0,value:ua(St)}}else{const Ue=Ht(yt);return{...yt,methodId:Ye,chargeFee:!1,value:ua(Ue)}}})),children:[a.jsx(Vn,{className:"w-full h-9 truncate",children:a.jsx(Kn,{placeholder:"Forma de pagamento"})}),a.jsx(Wn,{children:(ue||[]).map(Ye=>a.jsx(lt,{value:Ye.id,children:Ye.nome},Ye.id))})]}),(()=>{const Ye=Wt(ee);if(!Ye)return null;const ft=mr(ee),yt=!!ee.chargeFee;return a.jsx("div",{className:"mt-1",children:a.jsxs("button",{type:"button",onClick:()=>De(Et=>Et.map(br=>{if(br.id!==ee.id)return br;const Ue=Ht(br);if(!yt){const St=Ue*(1+Ye/100);return{...br,chargeFee:!0,value:ua(St)}}return{...br,chargeFee:!1,value:ua(Ue)}})),className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",yt?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:yt?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",yt?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",ft.toFixed(2)]})]})})})()]}),a.jsx("div",{className:"sm:col-span-3",children:a.jsx(Ct,{placeholder:"0,00",inputMode:"numeric",value:ee.value,className:"h-9",onChange:Ye=>{const ft=(Ye.target.value||"").replace(/\D/g,""),yt=ft?Number(ft)/100:0,Et=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(yt);De(br=>br.map(Ue=>Ue.id===ee.id?{...Ue,value:Et}:Ue))},onKeyDown:Ye=>{Ye.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ye.key)&&(/^[0-9]$/.test(Ye.key)||Ye.preventDefault())},onBeforeInput:Ye=>{const ft=Ye.data??"";ft&&/\D/.test(ft)&&Ye.preventDefault()}})})]},ee.id)}),a.jsx("div",{children:a.jsx(se,{type:"button",variant:"secondary",size:"sm",onClick:()=>{De(ee=>{const $e=Array.isArray(et)&&et.length>0?et:(ht||[]).map(an=>an.id),Be=new Set(ee.map(an=>an.clientId).filter(Boolean)),Ye=($e||[]).filter(an=>!Be.has(an))[0]||$e[0]||"",ft=ue[0]?.id||"",yt=Oe(ft),Et=Number(yt?.taxa_percentual||0)>0,br=[...ee,{id:ne,clientId:Ye,methodId:ft,value:"",chargeFee:Et}],Ue=(l||[]).reduce((an,Lr)=>an+Number(Lr.quantity||0)*Number(Lr.price||0),0),St=Math.floor(Ue/br.length*100)/100,Nr=Ue-St*br.length;return br.map((an,Lr)=>{const On=Lr===br.length-1?St+Nr:St;return Gt(an,On)})}),ie(ee=>ee+1)},children:"Adicionar forma"})}),(()=>{const ee=ur(),Se=jt(),Ge=(l||[]).reduce((Ye,ft)=>Ye+Number(ft.quantity||0)*Number(ft.price||0),0)+Se-ee;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"text-sm text-text-secondary flex justify-between",children:[a.jsx("span",{children:"Soma"}),a.jsxs("span",{children:["R$ ",ee.toFixed(2)]})]}),a.jsxs("div",{className:"text-sm text-text-secondary flex justify-between",children:[a.jsx("span",{children:"Taxas"}),a.jsxs("span",{children:["R$ ",Se.toFixed(2)]})]}),a.jsxs("div",{className:"text-sm font-semibold flex justify-between",children:[a.jsx("span",{children:"Restante"}),a.jsxs("span",{className:Math.abs(Ge)<.005?"text-success":"text-warning",children:["R$ ",Ge.toFixed(2)]})]})]})})()]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>G(!1),disabled:ae,children:"Cancelar"}),a.jsx(se,{onClick:rt,disabled:ae,children:ae?"Processando...":"Confirmar Pagamento"})]})]})}),a.jsx(In,{open:xr,onOpenChange:ee=>Jt(ee),children:a.jsxs(En,{className:"max-w-lg",onOpenAutoFocus:ee=>ee.preventDefault(),onKeyDown:ee=>ee.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Identificar Cliente"}),a.jsx(Hn,{children:"Selecione um cliente cadastrado para esta venda."})]}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"w-full",children:[a.jsx(it,{className:"mb-1 block",children:"Buscar cliente"}),a.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Nome, e-mail, telefone ou cdigo",className:"pl-9",value:Ot,onChange:ee=>Cr(ee.target.value),onKeyDown:ee=>ee.stopPropagation()})]}),a.jsx(se,{type:"button",size:"icon",title:"Cadastrar cliente",className:"ml-2 bg-brand text-black hover:bg-brand/90 border border-brand",onClick:()=>{window.location.href="/clientes"},children:a.jsx(Es,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"mt-2 max-h-48 overflow-auto border rounded-md thin-scroll",children:a.jsxs("ul",{children:[(Me||[]).map(ee=>{const Se=(et||[]).includes(ee.id);return a.jsxs("li",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-surface-2 ${ee?.codigo===0?"bg-warning/10 border-l-4 border-warning":""} ${Se?"bg-surface-2":""}`,onClick:()=>{Yt($e=>{const Be=new Set($e||[]);Be.has(ee.id)?Be.delete(ee.id):Be.add(ee.id);const Ge=Array.from(Be);try{localStorage.setItem(ar.pendingClientIds,JSON.stringify(Ge))}catch{}return Ge})},children:[a.jsx("div",{children:a.jsxs("div",{className:"font-medium",children:[ee.codigo!=null?String(ee.codigo)+" - ":"",ee.nome,ee?.codigo===0&&a.jsx("span",{className:"ml-2 text-xs text-warning",children:"(Padro)"})]})}),a.jsx(vi,{size:16,className:Se?"text-success":"text-text-muted opacity-40"})]},ee.id)}),(!Me||Me.length===0)&&a.jsx("li",{className:"p-2 text-sm text-text-muted",children:"Nenhum cliente encontrado."})]})})]})}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>Jt(!1),children:"Fechar"}),a.jsx(se,{onClick:async()=>{try{const ee=Array.from(new Set(et||[]));if(ee.length===0){e({title:"Selecione pelo menos um cliente",variant:"warning"});return}const Se=r?.codigo_empresa;if(n){try{const{data:Ge,error:Ye}=await re.from("comandas").select("id").eq("id",n).eq("codigo_empresa",Se).single();if(Ye||!Ge){console.error("[ClientWizard] Comanda no encontrada:",n),e({title:"Comanda invlida",description:"A comanda no existe mais. Reiniciando...",variant:"warning"}),s(null),c([]),_r(!1),b("");try{localStorage.removeItem(ar.comandaId),localStorage.removeItem(ar.items),localStorage.removeItem(ar.customerName),localStorage.removeItem(ar.clientChosen)}catch{}Jt(!1);return}}catch(Ge){console.error("[ClientWizard] Erro ao validar comanda:",Ge),e({title:"Erro de validao",variant:"destructive"});return}try{await Jb({comandaId:n,clienteIds:ee,nomesLivres:[],codigoEmpresa:Se,replace:!0})}catch(Ge){if(Ge?.message?.includes("violates foreign key")){console.error("[ClientWizard] Foreign key error, limpando cache:",Ge),s(null),c([]);try{localStorage.removeItem(ar.comandaId),localStorage.removeItem(ar.items)}catch{}e({title:"Comanda invlida",description:"Reinicie a venda.",variant:"destructive"}),Jt(!1);return}if(!Ge?.message?.includes("duplicate"))throw Ge}const Be=(await Bi({comandaId:n,codigoEmpresa:Se})||[]).map(Ge=>Ge?.nome).filter(Boolean);b(Be.length?Be.join(", "):""),_r(!0),Jt(!1)}else{if(!Se){e({title:"Empresa no definida",variant:"destructive"});return}try{h(!0);const $e=await Tj({codigoEmpresa:Se});if(!$e?.id){e({title:"Falha ao abrir venda",description:"No foi possvel criar a comanda.",variant:"destructive"});return}const Be=$e.id;await Jb({comandaId:Be,clienteIds:ee,nomesLivres:[],codigoEmpresa:Se,replace:!0}),s(Be);const Ge=(Me||[]).filter(ft=>ee.includes(ft.id)).map(ft=>ft?.nome).filter(Boolean),Ye=Ge.length?Ge.join(", "):"";b(Ye),_r(!0);try{localStorage.setItem(ar.comandaId,String(Be)),localStorage.setItem(ar.customerName,Ye||""),localStorage.setItem(ar.clientChosen,"true"),localStorage.removeItem(ar.pendingClientIds)}catch{}try{await kn(Be,2)}catch{}Jt(!1)}catch($e){console.error("[ClientWizard] Erro ao criar comanda de balco:",$e),e({title:"Falha ao iniciar venda",description:$e?.message||"Tente novamente.",variant:"destructive"});return}finally{h(!1)}}if(C){const $e=C;A(null),await Te($e,{skipClientCheck:!0})}}catch(ee){e({title:"Falha ao iniciar venda",description:ee?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar"})]})]})}),a.jsx(In,{open:!!er,onOpenChange:ee=>!ee&&_e(null),children:a.jsx(En,{className:"sm:max-w-[425px]",children:er&&a.jsxs(a.Fragment,{children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-lg",children:er.name}),a.jsx(Hn,{className:"text-sm",children:"Detalhes do item"})]}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Preo Unitrio"}),a.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Number(er.price).toFixed(2)]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:async ee=>{ee.stopPropagation();const Se=r?.codigo_empresa;if(!Se){e({title:"Empresa no definida",variant:"destructive"});return}const $e=Math.max(0,er.quantity-1);try{$e<=0?(await Sv({itemId:er.id,codigoEmpresa:Se}),_e(null)):(await Fd({itemId:er.id,quantidade:$e,codigoEmpresa:Se}),_e({...er,quantity:$e}));const Be=await To({comandaId:n,codigoEmpresa:Se});c((Be||[]).map(Ge=>({id:Ge.id,productId:Ge.produto_id,name:Ge.descricao||"Item",price:Number(Ge.preco_unitario||0),quantity:Number(Ge.quantidade||1)})))}catch(Be){e({title:"Erro ao atualizar quantidade",description:Be?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-8 text-center font-semibold",children:er.quantity}),a.jsx(se,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:async ee=>{ee.stopPropagation();const Se=r?.codigo_empresa;if(!Se){e({title:"Empresa no definida",variant:"destructive"});return}const $e=er.quantity+1;try{await Fd({itemId:er.id,quantidade:$e,codigoEmpresa:Se}),_e({...er,quantity:$e});const Be=await To({comandaId:n,codigoEmpresa:Se});c((Be||[]).map(Ge=>({id:Ge.id,productId:Ge.produto_id,name:Ge.descricao||"Item",price:Number(Ge.preco_unitario||0),quantity:Number(Ge.quantidade||1)})))}catch(Be){e({title:"Erro ao atualizar quantidade",description:Be?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Subtotal"}),a.jsxs("p",{className:"text-lg font-bold",children:["R$ ",(er.quantity*er.price).toFixed(2)]})]})]}),a.jsx(Na,{children:a.jsx(se,{variant:"destructive",onClick:async()=>{try{const ee=r?.codigo_empresa;if(!ee){e({title:"Empresa no definida",variant:"destructive"});return}await Sv({itemId:er.id,codigoEmpresa:ee});const Se=await To({comandaId:n,codigoEmpresa:ee});c((Se||[]).map($e=>({id:$e.id,productId:$e.produto_id,name:$e.descricao||"Item",price:Number($e.preco_unitario||0),quantity:Number($e.quantidade||1)}))),_e(null),e({title:"Item removido",variant:"success"})}catch(ee){e({title:"Falha ao remover item",description:ee?.message||"Tente novamente",variant:"destructive"})}},children:"Remover Item"})})]})})}),je&&a.jsx("div",{className:"fixed left-3 right-3 z-[9999] md:hidden",role:"alert","aria-live":"assertive",style:{bottom:"calc(12px + env(safe-area-inset-bottom, 0px))"},children:a.jsxs("div",{className:"pointer-events-none flex items-start gap-2 rounded-md border border-amber-500 bg-amber-400 text-black px-3 py-2 shadow-lg",children:[a.jsx(ud,{className:"h-4 w-4 mt-0.5","aria-hidden":"true"}),a.jsx("div",{className:"text-sm font-semibold leading-snug drop-shadow-[0_1px_0_rgba(255,255,255,0.25)]",children:$t||"Ateno"})]})})]})}async function ooe({userId:e,scope:t}){if(!e||!t)return null;try{const{data:r,error:n}=await re.from("user_ui_settings").select("settings").eq("user_id",e).eq("scope",t).maybeSingle();return n?(console.error("[user_ui_settings] getUserUISettings:error",n),null):r?.settings||null}catch(r){return console.error("[user_ui_settings] getUserUISettings:exception",r),null}}async function ioe({userId:e,scope:t,settings:r}){if(!(!e||!t))try{const n={user_id:e,scope:t,settings:r||{},updated_at:new Date().toISOString()},{error:s}=await re.from("user_ui_settings").upsert(n,{onConflict:"user_id,scope"});s&&console.error("[user_ui_settings] saveUserUISettings:error",s)}catch(n){console.error("[user_ui_settings] saveUserUISettings:exception",n)}}function cC(e){try{const r=new DOMParser().parseFromString(e,"text/xml"),n=r.querySelector("parsererror");if(n)throw new Error("XML invlido: "+n.textContent);const s=xst(r),o=vst(r),i=yst(r),l=bst(r),c=i.reduce((u,f)=>u+(f.valorTotal||0),0),d={produtos:i,fornecedor:o,pagamentos:l,nfe:{...s,totalNota:c},success:!0};return console.log("[XMLParser] Resultado final:",d),{data:d,success:!0}}catch(t){return console.error("[XMLParser] Erro ao fazer parse do XML:",t),{produtos:[],fornecedor:null,nfe:null,success:!1,error:t.message}}}function xst(e){const t=e.querySelector("ide");if(!t)return null;let r="";const n=e.querySelector("chNFe");if(n&&(r=n.textContent.trim()),!r){const s=e.querySelector("infNFe");if(s){const o=s.getAttribute("Id");o&&(r=o.replace("NFe",""))}}return{numero:wa(t,"nNF"),serie:wa(t,"serie"),dataEmissao:wa(t,"dhEmi"),chaveAcesso:r,tipo:wa(t,"tpNF")==="0"?"Entrada":"Sada",naturezaOperacao:wa(t,"natOp"),modelo:wa(t,"mod")||null}}function vst(e){const t=e.querySelector("emit");return t?{cnpj:wa(t,"CNPJ"),razaoSocial:wa(t,"xNome"),nomeFantasia:wa(t,"xFant"),endereco:{logradouro:wa(t,"xLgr"),numero:wa(t,"nro"),bairro:wa(t,"xBairro"),cidade:wa(t,"xMun"),uf:wa(t,"UF"),cep:wa(t,"CEP"),codigoIBGE:wa(t,"cMun"),fone:wa(t,"fone")},ie:wa(t,"IE"),iest:wa(t,"IEST"),im:wa(t,"IM"),crt:wa(t,"CRT")}:null}function yst(e){const t=e.querySelectorAll("det"),r=new Map;return t.forEach((n,s)=>{const o=n.querySelector("prod"),i=n.querySelector("imposto");if(!o)return;const l=wa(o,"cProd"),c=wa(o,"cEAN"),d=wa(o,"xProd"),u=parseFloat(wa(o,"qCom")||"0"),f=c&&c!=="SEM GTIN"?`ean:${c}`:l?`cod:${l}`:`nome:${d.toLowerCase().trim()}`;if(r.has(f)){const h=r.get(f);h.quantidade+=u,h.valorTotal+=parseFloat(wa(o,"vProd")||"0")}else{const h={codigo:l,ean:c,nome:d,ncm:wa(o,"NCM"),cest:wa(o,"CEST"),cfop:wa(o,"CFOP"),unidade:wa(o,"uCom"),quantidade:u,valorUnitario:parseFloat(wa(o,"vUnCom")||"0"),precoVenda:parseFloat(wa(o,"vUnCom")||"0"),valorTotal:parseFloat(wa(o,"vProd")||"0"),desconto:parseFloat(wa(o,"vDesc")||"0"),impostos:_st(i),descricao:d,origem:s+1};r.set(f,h)}}),Array.from(r.values())}function bst(e){const t=e.querySelectorAll("pag"),r=[];return t.forEach(n=>{const s=wa(n,"tPag"),o=parseFloat(wa(n,"vPag")||"0");s&&r.push({codigoSefaz:s,valor:o,nome:wst(s)})}),console.log("[XMLParser] Pagamentos extrados:",r),r}function wst(e){return{"01":"Dinheiro","02":"Cheque","03":"Carto de Crdito","04":"Carto de Dbito","05":"Carto da Loja",10:"Vale Alimentao",11:"Vale Refeio",12:"Vale Presente",13:"Vale Combustvel",14:"Duplicata Mercantil",15:"Boleto Bancrio",16:"Depsito Bancrio",17:"PIX Dinmico",18:"Transferncia Bancria",19:"Programa de Fidelidade",20:"PIX Esttico",21:"Crdito em Loja",22:"Pagamento Eletrnico",90:"Sem Pagamento",99:"Outros"}[e]||"Outros"}function _st(e){if(!e)return{};const t={},r=e.querySelector("ICMS");if(r){const i=r.children[0];i&&(t.icms={cst:wa(i,"CST"),csosn:wa(i,"CSOSN"),aliquota:parseFloat(wa(i,"pICMS")||"0"),valor:parseFloat(wa(i,"vICMS")||"0"),orig:wa(i,"orig"),fcpAliquota:parseFloat(wa(i,"pFCP")||"0"),mva:parseFloat(wa(i,"pMVAST")||"0"),pRedBC:parseFloat(wa(i,"pRedBC")||"0")})}const n=e.querySelector("PIS");if(n){const i=n.children[0];i&&(t.pis={cst:wa(i,"CST"),aliquota:parseFloat(wa(i,"pPIS")||"0"),valor:parseFloat(wa(i,"vPIS")||"0")})}const s=e.querySelector("COFINS");if(s){const i=s.children[0];i&&(t.cofins={cst:wa(i,"CST"),aliquota:parseFloat(wa(i,"pCOFINS")||"0"),valor:parseFloat(wa(i,"vCOFINS")||"0")})}const o=e.querySelector("IPI");if(o){const i=o.querySelector("IPITrib");i&&(t.ipi={cst:wa(i,"CST"),aliquota:parseFloat(wa(i,"pIPI")||"0"),valor:parseFloat(wa(i,"vIPI")||"0")})}return t}function wa(e,t){if(!e)return"";const r=e.querySelector(t);return r?r.textContent.trim():""}function dC(e,t){const r=e.unidade?.toUpperCase().trim()||"";if(e.ean&&e.ean!=="SEM GTIN"){const s=t.find(i=>{const l=i.unit?.toUpperCase().trim()||"";return i.barcode===e.ean&&l===r});if(s)return s;const o=t.find(i=>i.barcode===e.ean);o&&console.log("[xmlParser] EAN igual mas unidade diferente (no considerar o mesmo produto):",{ean:e.ean,unidadeXML:r,unidadeSistema:(o.unit||"").toUpperCase()})}if(e.codigo){const s=t.find(i=>{const l=i.unit?.toUpperCase().trim()||"";return i.code===e.codigo&&l===r});if(s)return s;const o=t.find(i=>i.code===e.codigo);o&&console.log("[xmlParser] Cdigo igual mas unidade diferente (no considerar o mesmo produto):",{codigo:e.codigo,unidadeXML:r,unidadeSistema:(o.unit||"").toUpperCase()})}const n=e.nome?.toLowerCase().trim()||"";if(n){const s=t.find(o=>{const i=o.name?.toLowerCase().trim()||"",l=o.unit?.toUpperCase().trim()||"",c=i===n,d=l===r,u=c&&d;return c&&!d&&(console.log("[xmlParser] Nome igual mas UNIDADE diferente - NO  o mesmo produto:"),console.log("  Nome XML:",n,"| Unidade XML:",r),console.log("  Nome Sistema:",i,"| Unidade Sistema:",l)),u&&(console.log("[xmlParser] MATCH ENCONTRADO (nome + unidade):"),console.log("  XML:",n,"| Unidade:",r),console.log("  Sistema:",i,"| Unidade:",l),console.log("  Produto:",o)),u});if(s)return console.log("[xmlParser] Produto existente encontrado por nome + unidade:",s.name,s.unit),s}return console.log("[xmlParser] Nenhum produto encontrado para:",n,"| Unidade:",r),null}function L3(e,t){const r=e.valorUnitario||0,n=30,s=r>0?r/(1-n/100):0;return{code:e.codigo||"",name:e.nome||"",barcode:e.ean&&e.ean!=="SEM GTIN"?e.ean:"",ncm:e.ncm||"",cest:e.cest||"",unit:e.unidade||"UN",costPrice:r,salePrice:s,price:s,stock:0,minStock:0,status:"active",active:!0,type:"Venda",category:"Importados",cfopInterno:e.cfop||"",cstIcmsInterno:e.impostos?.icms?.cst||"",csosnInterno:e.impostos?.icms?.csosn||"",aliqIcmsInterno:e.impostos?.icms?.aliquota||0,fcpPercent:e.impostos?.icms?.fcpAliquota||0,mvaPercent:e.impostos?.icms?.mva||0,baseReduzidaPercent:e.impostos?.icms?.pRedBC||0,cstPisEntrada:e.impostos?.pis?.cst||"",aliqPisPercent:e.impostos?.pis?.aliquota||0,aliqCofinsPercent:e.impostos?.cofins?.aliquota||0,cstIpi:e.impostos?.ipi?.cst||"",aliqIpiPercent:e.impostos?.ipi?.aliquota||0,codigo_empresa:t,importedViaXML:!0,dataImportacao:new Date,xmlChave:e?.xmlChave||null,xmlNumero:e?.xmlNumero||null,xmlSerie:e?.xmlSerie||null,xmlEmissao:e?.xmlEmissao||null}}async function jst(e,t){if(!e||!t)return null;const r=e.replace(/\D/g,"");try{const{data:n,error:s}=await re.from("clientes").select("*").eq("codigo_empresa",t).eq("cnpj",r).eq("flag_fornecedor",!0).maybeSingle();if(s)throw s;return n}catch(n){throw console.error("[Suppliers] Erro ao buscar fornecedor:",n),n}}async function Nst(e,t){if(!e||!t)throw new Error("Dados do fornecedor e cdigo da empresa so obrigatrios");const r=e.cnpj?.replace(/\D/g,"")||"";if(!r)throw new Error("CNPJ do fornecedor no encontrado no XML");const n={codigo_empresa:t,tipo_pessoa:"PJ",cnpj:r,nome:e.razaoSocial||"Fornecedor Importado",apelido:e.nomeFantasia||e.razaoSocial,flag_fornecedor:!0,flag_cliente:!1,status:"active",endereco:e.endereco?.logradouro||null,numero:e.endereco?.numero||null,complemento:e.endereco?.complemento||null,bairro:e.endereco?.bairro||null,cidade:e.endereco?.cidade||null,uf:e.endereco?.uf||null,cep:e.endereco?.cep?.replace(/\D/g,"")||null,cidade_ibge:e.endereco?.codigoIBGE||null,telefone:e.endereco?.fone||null,ie:e.ie||null,iest:e.iest||null,im:e.im||null};try{const{data:s,error:o}=await re.from("clientes").insert(n).select().single();if(o)throw o;return console.log("[Suppliers] Fornecedor criado:",s),s}catch(s){throw console.error("[Suppliers] Erro ao criar fornecedor:",s),s}}async function Sst(e,t){if(!e?.cnpj)throw new Error("CNPJ do fornecedor no encontrado no XML");try{const r=await jst(e.cnpj,t);if(r){console.log("[Suppliers] Fornecedor encontrado:",r.razao_social||r.nome);const s={},o=e.endereco||{},i=l=>l==null||String(l).trim()===""?null:l;return!i(r.ie)&&i(e.ie)&&(s.ie=e.ie),!i(r.iest)&&i(e.iest)&&(s.iest=e.iest),!i(r.im)&&i(e.im)&&(s.im=e.im),!i(r.endereco)&&i(o.logradouro)&&(s.endereco=o.logradouro),!i(r.numero)&&i(o.numero)&&(s.numero=o.numero),!i(r.complemento)&&i(o.complemento)&&(s.complemento=o.complemento),!i(r.bairro)&&i(o.bairro)&&(s.bairro=o.bairro),!i(r.cidade)&&i(o.cidade)&&(s.cidade=o.cidade),!i(r.uf)&&i(o.uf)&&(s.uf=o.uf),!i(r.cep)&&i(o.cep)&&(s.cep=String(o.cep).replace(/\D/g,"")),!i(r.cidade_ibge)&&i(o.codigoIBGE)&&(s.cidade_ibge=o.codigoIBGE),!i(r.telefone)&&i(o.fone)&&(s.telefone=o.fone),!i(r.nome)&&i(e.razaoSocial)&&(s.nome=e.razaoSocial),!i(r.apelido)&&(i(e.nomeFantasia)||i(e.razaoSocial))&&(s.apelido=e.nomeFantasia||e.razaoSocial),Object.keys(s).length>0?(await re.from("clientes").update(s).eq("id",r.id),console.log("[Suppliers] Fornecedor atualizado com campos faltantes:",s),{...r,...s}):r}return console.log("[Suppliers] Criando novo fornecedor:",e.razaoSocial),await Nst(e,t)}catch(r){throw console.error("[Suppliers] Erro ao buscar/criar fornecedor:",r),r}}async function Cst(e){if(!e)return[];try{const{data:t,error:r}=await re.from("clientes").select("*").eq("codigo_empresa",e).eq("flag_fornecedor",!0).order("nome",{ascending:!0});if(r)throw r;return t||[]}catch(t){return console.error("[Suppliers] Erro ao listar fornecedores:",t),[]}}async function Ast(e,t){if(!e||!t)return null;try{const{data:r,error:n}=await re.from("compras").select("*").eq("codigo_empresa",t).eq("chave_nfe",e).order("ativo",{ascending:!1}).maybeSingle();if(n)throw n;return r}catch(r){throw console.error("[Purchases] Erro ao buscar compra:",r),r}}async function Pst(e){const t={codigo_empresa:e.codigoEmpresa,fornecedor_id:e.fornecedorId,chave_nfe:e.chaveNfe,numero_nfe:e.numeroNfe,serie_nfe:e.serieNfe,data_emissao:e.dataEmissao,tipo_operacao:e.tipoOperacao,natureza_operacao:e.naturezaOperacao,valor_produtos:e.valorProdutos,valor_total:e.valorTotal,forma_pagamento:e.formaPagamento||null,status:"processada",observacoes:e.observacoes||null,xml_completo:e.xmlCompleto||null};try{const{data:r,error:n}=await re.from("compras").insert(t).select().single();if(n)throw n;return console.log("[Purchases] Compra criada:",r.numero_nfe,"ID:",r.id),r}catch(r){throw console.error("[Purchases] Erro ao criar compra:",r),r}}async function loe(e,t){if(!e||!t||t.length===0)throw new Error("ID da compra e itens so obrigatrios");const r=t.map(n=>({compra_id:e,produto_id:n.produtoId||null,codigo_produto_xml:n.codigoProdutoXML||null,nome_produto_xml:n.nomeProdutoXML,ean_xml:n.eanXML||null,ncm_xml:n.ncmXML||null,cfop_xml:n.cfopXML||null,unidade_xml:n.unidadeXML||null,quantidade:n.quantidade,valor_unitario:n.valorUnitario,valor_total:n.valorTotal,valor_desconto:n.valorDesconto||0,valor_frete:n.valorFrete||0,valor_seguro:n.valorSeguro||0,valor_outras_despesas:n.valorOutrasDespesas||0,icms_aliquota:n.icmsAliquota||null,icms_valor:n.icmsValor||null,ipi_aliquota:n.ipiAliquota||null,ipi_valor:n.ipiValor||null,pis_aliquota:n.pisAliquota||null,pis_valor:n.pisValor||null,cofins_aliquota:n.cofinsAliquota||null,cofins_valor:n.cofinsValor||null,vinculado_manualmente:n.vinculadoManualmente||!1,observacoes:n.observacoes||null,selecionado_na_importacao:n.selecionadoNaImportacao||!1}));try{const{data:n,error:s}=await re.from("compras_itens").insert(r).select();if(s)throw s;return console.log("[Purchases] Itens criados:",n.length),n}catch(n){throw console.error("[Purchases] Erro ao criar itens:",n),n}}async function Est(e,t={}){if(!e)return{data:[],count:0};try{const r=t.page&&t.page>0?t.page:1,n=t.pageSize&&t.pageSize>0?t.pageSize:100,s=(r-1)*n,o=s+n-1;let i=re.from("compras").select("*,fornecedor:clientes!compras_fornecedor_id_fkey(id,nome,cnpj)",{count:"exact"}).eq("codigo_empresa",e);t.apenasInativas?i=i.eq("ativo",!1):t.incluirInativas||(i=i.eq("ativo",!0)),t.status&&(i=i.eq("status",t.status)),t.fornecedorId&&(i=i.eq("fornecedor_id",t.fornecedorId)),t.dataInicio&&(i=i.gte("data_emissao",t.dataInicio)),t.dataFim&&(i=i.lte("data_emissao",t.dataFim)),i=i.order("data_emissao",{ascending:!1}).range(s,o);const{data:l,error:c,count:d}=await i;if(c)throw c;return{data:l||[],count:d??0}}catch(r){return console.error("[Purchases] Erro ao listar compras:",r),{data:[],count:0}}}async function coe(e){try{const{data:t,error:r}=await re.from("compras_itens").select(`
        *,
        produto:produto_id(id, nome, codigo_produto, codigo_barras, data_importacao)
      `).eq("compra_id",e).order("criado_em",{ascending:!0});if(r)throw console.error("[Purchases] Erro ao buscar itens:",r),r;return t}catch(t){throw console.error("[Purchases] Erro ao buscar itens:",t),t}}async function kst(e,t,r){if(!e||!t)throw new Error("ID da compra e motivo so obrigatrios");try{const{data:n,error:s}=await re.from("compras").update({ativo:!1,motivo_inativacao:t,inativado_em:new Date().toISOString(),inativado_por:r}).eq("id",e).select().single();if(s)throw s;return console.log("[Purchases] Compra inativada:",e),n}catch(n){throw console.error("[Purchases] Erro ao inativar compra:",n),n}}async function Ist(e){try{console.log("[Purchases] Deletando itens da compra:",e);const{error:t}=await re.from("compras_itens").delete().eq("compra_id",e);if(t)throw console.error("[Purchases] Erro ao deletar itens:",t),t;return console.log("[Purchases] Itens deletados com sucesso"),!0}catch(t){throw console.error("[Purchases] Erro ao deletar itens:",t),t}}async function Ost(e,t){try{return console.log("[Purchases] Reprocessando XML da compra:",e),await Ist(e),await loe(e,t),console.log("[Purchases] XML reprocessado com sucesso"),!0}catch(r){throw console.error("[Purchases] Erro ao reprocessar XML:",r),r}}async function Tst(e,t){try{console.log("[Purchases] Atualizando compra:",e,t);const{data:r,error:n}=await re.from("compras").update({fornecedor_id:t.fornecedorId,numero_nfe:t.numeroNfe,serie_nfe:t.serieNfe,data_emissao:t.dataEmissao,tipo_operacao:t.tipoOperacao,natureza_operacao:t.naturezaOperacao,valor_produtos:t.valorProdutos,valor_total:t.valorTotal,forma_pagamento:t.formaPagamento,observacoes:t.observacoes,atualizado_em:new Date().toISOString()}).eq("id",e).select().single();if(n)throw console.error("[Purchases] Erro ao atualizar compra:",n),n;return console.log("[Purchases] Compra atualizada:",r),r}catch(r){throw console.error("[Purchases] Erro ao atualizar compra:",r),r}}function doe({isOpen:e,onClose:t,onSelect:r,currentProduct:n}){const{userProfile:s}=qs(),[o,i]=p.useState([]),[l,c]=p.useState(!0),[d,u]=p.useState(""),[f,h]=p.useState(null);p.useEffect(()=>{e&&s?.codigo_empresa&&m()},[e,s?.codigo_empresa]);const m=async()=>{try{c(!0),console.log("[ProductSelectionModal] Carregando produtos para empresa:",s.codigo_empresa);const v=await Hu({codigoEmpresa:s.codigo_empresa,includeInactive:!1,search:""});console.log("[ProductSelectionModal] Produtos carregados:",v?.length||0),console.log("[ProductSelectionModal] Primeiro produto:",v?.[0]),console.log("[ProductSelectionModal] Estrutura do produto:",Object.keys(v?.[0]||{})),i(v||[])}catch(v){console.error("[ProductSelectionModal] Erro ao carregar produtos:",v),i([])}finally{c(!1)}},x=p.useMemo(()=>{if(console.log("[ProductSelectionModal] Filtrando produtos. Total:",o.length,"Busca:",d),!d.trim())return o;const v=d.toLowerCase().trim(),b=o.filter(w=>(w.name||w.nome)?.toLowerCase().includes(v)||(w.code||w.codigo_produto)?.toLowerCase().includes(v)||(w.barcode||w.codigo_barras)?.toLowerCase().includes(v));return console.log("[ProductSelectionModal] Produtos filtrados:",b.length),b},[o,d]),g=()=>{f?(console.log("[ProductSelectionModal] Produto selecionado para vinculao:",f),console.log("[ProductSelectionModal] ID do produto:",f.id),console.log("[ProductSelectionModal] Nome do produto:",f.name),r(f),y()):console.log("[ProductSelectionModal] ERRO: Nenhum produto selecionado")},y=()=>{u(""),h(null),t()};return a.jsx(In,{open:e,onOpenChange:y,children:a.jsxs(En,{className:"w-[95vw] sm:max-w-3xl max-h-[80vh] overflow-hidden flex flex-col bg-black text-white border border-neutral-700",children:[a.jsxs(Cn,{className:"bg-neutral-900 -mx-6 -mt-6 mb-4 px-6 py-4 border-b border-neutral-600",children:[a.jsxs(Nn,{className:"flex items-center gap-2 text-white",children:[a.jsx(su,{className:"h-5 w-5 text-yellow-500"}),"Selecionar Produto para Vinculao"]}),a.jsx(Hn,{className:"text-neutral-300",children:"Busque e selecione um produto cadastrado para vincular ao item do XML"})]}),a.jsx("div",{className:"px-6 pb-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-400"}),a.jsx(Ct,{placeholder:"Buscar por nome, cdigo do produto ou cdigo de barras...",value:d,onChange:v=>u(v.target.value),className:"pl-10 bg-neutral-900 border-neutral-600 text-white placeholder-neutral-400 focus:border-yellow-500",autoFocus:!0})]})}),a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col px-6",children:l?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500 mb-4"}),a.jsx("p",{className:"text-neutral-400",children:"Carregando produtos..."})]})}):x.length===0?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(su,{className:"h-12 w-12 text-neutral-400 mx-auto mb-4"}),a.jsx("p",{className:"text-neutral-400",children:d?"Nenhum produto encontrado":"Nenhum produto cadastrado"}),d&&a.jsx("p",{className:"text-sm text-neutral-500 mt-2",children:"Tente buscar por nome, cdigo ou cdigo de barras"})]})}):a.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:a.jsx("ul",{className:"space-y-2",children:x.map(v=>{const b=v.code||v.codigo_produto,w=v.name||v.nome||"Produto sem nome",_=v.stock||v.estoque||0,j=Number(v.salePrice||v.preco_venda||0),S=f?.id===v.id;return a.jsxs("li",{className:`flex items-center gap-3 p-3 rounded-lg transition-all cursor-pointer border-2 ${S?"border-yellow-500 bg-yellow-500/10":"border-neutral-600 bg-black hover:border-yellow-400 hover:bg-neutral-900"}`,onClick:()=>h(v),children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsxs("p",{className:"font-semibold text-white truncate",title:`${b?`[${b}] `:""}${w}`,children:[b&&a.jsxs("span",{className:"text-neutral-400",children:["[",b,"]"]})," ",w]})}),a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("p",{className:"text-sm text-neutral-300",children:["R$ ",j.toFixed(2)]}),a.jsxs("span",{className:"text-xs font-medium text-neutral-400 whitespace-nowrap",children:["Estoque: ",_]})]})]}),S&&a.jsx(Sm,{className:"h-5 w-5 text-yellow-500 flex-shrink-0"})]},v.id)})})})}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-600 px-6 pb-6",children:[a.jsxs("div",{className:"text-sm text-neutral-400",children:[x.length," produto",x.length!==1?"s":"",d&&` encontrado${x.length!==1?"s":""}`]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{variant:"outline",onClick:y,className:"border-neutral-600 text-neutral-300 hover:bg-neutral-700",children:"Cancelar"}),a.jsxs(se,{onClick:g,disabled:!f,className:"gap-2 bg-yellow-600 hover:bg-yellow-700 text-black",children:[a.jsx(Sm,{className:"h-4 w-4"}),"Vincular Produto"]})]})]})]})})}function uoe({isOpen:e,onClose:t,onConfirm:r,products:n,editedProducts:s,isReprocess:o=!1,allProducts:i=[]}){if(!e||!n)return null;const l=n.filter(d=>d.selected),c=l.reduce((d,u,f)=>{const h=u.originalIndex!==void 0?u.originalIndex:f,m=s[h]||{},x=m.linkedProductId,g=m.updatePrice,y=Number(m.quantity||m.qty||u.xml?.quantidade||0);let v=0;if(m.salePrice!=null?v=Number(m.salePrice):m.margin!=null&&u.xml?.valorUnitario?v=Number(u.xml.valorUnitario)*(1+m.margin/100):u.xml?.precoVenda&&(v=Number(u.xml.precoVenda)),u.isNew&&!x)d.newProducts.push({name:m.name||u.xml?.nome,quantity:y,price:v,total:y*(u.xml?.valorUnitario||0),xmlName:u.xml?.nome});else if(x||u.existing){const b=x&&i.find(C=>C.id===x)||u.existing,w=Number(b?.stock||0),_=Number(b?.preco_venda||b?.salePrice||b?.price||0),j=o?0:y,S=o?w:w+y;d.updatedProducts.push({name:b?.name||m.name||u.xml?.nome,currentStock:w,newStock:S,stockChange:j,currentPrice:_,newPrice:g?v:_,priceChange:g?v-_:0,willUpdatePrice:g,total:y*(u.xml?.valorUnitario||0),xmlName:u.xml?.nome,isLinked:!!x,linkedProductId:x,linkedProductName:x?b?.name:null})}else x&&d.linkedProducts.push({xmlName:u.xml?.nome,linkedName:m.name||u.xml?.nome,quantity:y,total:y*(u.xml?.valorUnitario||0),linkedProductId:x});return d.totalValue+=y*(u.xml?.valorUnitario||0),d.totalItems+=y,d},{newProducts:[],updatedProducts:[],linkedProducts:[],totalValue:0,totalItems:0});return a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsx(Cn,{children:a.jsxs(Nn,{className:"flex items-center gap-2",children:[a.jsx(Df,{className:"h-5 w-5 text-warning"}),"Confirmar ",o?"Reprocessamento":"Importao"]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(su,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Total de Produtos"})]}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:l.length})]}),a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(Bue,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Total de Itens"})]}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:c.totalItems})]}),a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(Oi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Valor Total"})]}),a.jsxs("p",{className:"text-2xl font-bold text-text-primary",children:["R$ ",c.totalValue.toFixed(2)]})]})]}),!o&&c.newProducts.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Es,{className:"h-4 w-4 text-success"}),"Produtos que sero criados (",c.newProducts.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:c.newProducts.map((d,u)=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-text-primary",children:d.name}),a.jsxs("p",{className:"text-sm text-text-muted",children:["Quantidade: ",d.quantity,"  Preo unit.: R$ ",(d.total/d.quantity).toFixed(2),"  Total: R$ ",d.total.toFixed(2)]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",d.total.toFixed(2)]})})]},u))})]}),!o&&c.updatedProducts.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Ng,{className:"h-4 w-4 text-info"}),"Produtos que sero atualizados (",c.updatedProducts.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:c.updatedProducts.map((d,u)=>a.jsx("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[d.isLinked?a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(wG,{className:"h-4 w-4 text-warning"}),a.jsxs("p",{className:"font-medium text-text-primary",children:[d.xmlName,"  ",d.linkedProductName||d.name]})]}):a.jsx("p",{className:"font-medium text-text-primary",children:d.name}),a.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[o?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Estoque:"}),a.jsx("span",{className:"font-medium text-text-primary",children:d.currentStock}),a.jsx("span",{className:"text-text-muted",children:"(sem alterao no reprocesso)"})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Estoque:"}),a.jsx("span",{className:"font-medium text-text-primary",children:d.currentStock}),a.jsx(Cm,{className:"h-3 w-3 text-success"}),a.jsx("span",{className:"font-medium text-success",children:d.newStock}),a.jsxs("span",{className:"text-success",children:["(+",d.stockChange,")"]})]}),d.willUpdatePrice&&d.priceChange!==0&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Preo:"}),a.jsxs("span",{className:"font-medium text-text-primary",children:["R$ ",d.currentPrice.toFixed(2)]}),d.priceChange>0?a.jsx(Cm,{className:"h-3 w-3 text-success"}):a.jsx(rfe,{className:"h-3 w-3 text-destructive"}),a.jsxs("span",{className:`font-medium ${d.priceChange>0?"text-success":"text-destructive"}`,children:["R$ ",d.newPrice.toFixed(2)]}),a.jsxs("span",{className:d.priceChange>0?"text-success":"text-destructive",children:["(",d.priceChange>0?"+":"","R$ ",d.priceChange.toFixed(2),")"]})]})]})]}),a.jsxs("div",{className:"text-right",children:[o?a.jsxs("p",{className:"text-xs text-text-muted",children:["Total NF-e (custo): R$ ",d.total.toFixed(2)]}):a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit.: R$ ",(d.total/d.stockChange).toFixed(2)]}),a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",d.total.toFixed(2)]})]})]})},u))})]}),o&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Ng,{className:"h-4 w-4 text-info"}),"Itens da NF-e que sero reprocessados (",l.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:l.map((d,u)=>{const f=d.originalIndex!==void 0?d.originalIndex:u,h=s[f]||{},m=Number(h.quantity||h.qty||d.xml?.quantidade||0),x=Number(d.xml?.valorUnitario||0),g=m*x;return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-text-primary",children:d.xml?.nome}),a.jsxs("p",{className:"text-sm text-text-muted",children:["Quantidade: ",m,"  Valor unit.: R$ ",x.toFixed(2),"  Total: R$ ",g.toFixed(2)]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",g.toFixed(2)]})})]},u)})})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Df,{className:"h-5 w-5 text-warning flex-shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-warning mb-2",children:o?"Ateno - Reprocessamento":"Ateno - Importao"}),a.jsxs("ul",{className:"text-sm text-text-muted space-y-1",children:[o?a.jsxs(a.Fragment,{children:[a.jsx("li",{children:" Os itens atuais da compra sero substitudos pelos selecionados"}),a.jsx("li",{children:" As quantidades de estoque sero ajustadas conforme as mudanas"}),a.jsx("li",{children:" Esta ao no pode ser desfeita automaticamente"})]}):a.jsxs(a.Fragment,{children:[a.jsx("li",{children:" Os produtos selecionados sero criados ou atualizados no sistema"}),a.jsx("li",{children:" As quantidades sero adicionadas ao estoque atual"}),a.jsx("li",{children:" Uma nova compra ser registrada no histrico"})]}),a.jsx("li",{children:" Verifique cuidadosamente as informaes antes de confirmar"})]})]})]})})]}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[a.jsxs("div",{className:"text-sm text-text-muted",children:[l.length," produto",l.length!==1?"s":""," selecionado",l.length!==1?"s":""]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{variant:"outline",onClick:t,children:"Cancelar"}),a.jsxs(se,{onClick:r,className:"gap-2",children:[a.jsx(Ng,{className:"h-4 w-4"}),"Confirmar ",o?"Reprocessamento":"Importao"]})]})]})]})})}function Dst({open:e,onOpenChange:t,products:r,codigoEmpresa:n,onSuccess:s}){const{toast:o}=Ss(),[i,l]=p.useState("upload"),[c,d]=p.useState(null),[u,f]=p.useState(null),[h,m]=p.useState([]),[x,g]=p.useState(!1),[y,v]=p.useState({created:0,updated:0,errors:0,details:[]}),[b,w]=p.useState({}),[_,j]=p.useState({}),[S,C]=p.useState({isOpen:!1,productIndex:null,currentProduct:null}),[A,P]=p.useState({isOpen:!1}),F=()=>{const $=u?.nfe?.modelo;return $==="55"?"NF-e":$==="65"?"NFC-e":"NF-e / NFC-e"},O=async $=>{const Y=$.target.files?.[0];if(!Y){console.log("[XMLImport] Nenhum arquivo selecionado");return}if(console.log("[XMLImport] Arquivo selecionado:",Y.name),!Y.name.endsWith(".xml")){o({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}d(Y);try{console.log("[XMLImport] Lendo contedo do arquivo...");const he=await Y.text();console.log("[XMLImport] Arquivo lido, parseando XML...");const J=cC(he);if(console.log("[XMLImport] XML parseado:",J),!J.success){o({title:"Erro ao ler XML",description:J.error||"XML invlido",variant:"destructive"});return}if(!J.data?.produtos||J.data.produtos.length===0){o({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}f(J.data);let G=r;try{G=await Hu({search:"",codigoEmpresa:n,includeInactive:!0})||r,console.log("[XMLImport] Produtos carregados para validao:",G.length),console.log("[XMLImport] Nomes dos produtos:",G.map(oe=>oe.name))}catch(ae){console.warn("[XMLImport] No foi possvel carregar lista completa, usando cache:",ae)}const ue=J.data.produtos.map((ae,oe)=>{const me=dC(ae,G),De={...ae};if(ae.impostos){const{icms:ne,pis:ie,cofins:ht,ipi:pt}=ae.impostos;ne&&(De.icmsAliquota=ne.aliquota??De.icmsAliquota,De.icmsValor=ne.valor??De.icmsValor),pt&&(De.ipiAliquota=pt.aliquota??De.ipiAliquota,De.ipiValor=pt.valor??De.ipiValor),ie&&(De.pisAliquota=ie.aliquota??De.pisAliquota,De.pisValor=ie.valor??De.pisValor),ht&&(De.cofinsAliquota=ht.aliquota??De.cofinsAliquota,De.cofinsValor=ht.valor??De.cofinsValor)}return{xml:De,existing:me,isNew:!me,willCreate:!me,willUpdate:!!me,selected:!0,index:oe}});m(ue);const ve={};ue.forEach((ae,oe)=>{ae.xml.precoVenda&&(ve[oe]={salePrice:Number(ae.xml.precoVenda)})}),console.log("[XMLImport] Pr-populando editedProducts:",ve),w(ve),console.log("[XMLImport] Preview preparado, mudando para step preview. Total produtos:",ue.length),l("preview")}catch(he){console.error("[XMLImport] Erro ao processar arquivo:",he),o({title:"Erro ao processar XML",description:he.message,variant:"destructive"})}},I=()=>{P({isOpen:!0})},T=async()=>{P({isOpen:!1});let $="";if(c)try{$=await c.text()}catch(G){console.error("[XMLImport] Erro ao ler XML:",G),o({title:"Erro ao ler XML",description:"No foi possvel ler o arquivo XML.",variant:"destructive"});return}l("processing"),g(!0);const Y={created:0,updated:0,errors:0,skipped:0,details:[],supplierId:null},he=h.filter(G=>G.selected);if(he.length===0){o({title:"Nenhum produto selecionado",description:"Selecione ao menos um produto para importar.",variant:"warning"}),g(!1),l("preview");return}let J=null;if(u?.fornecedor)try{J=await Sst(u.fornecedor,n),Y.supplierId=J.id,console.log("[XMLImport] Fornecedor processado:",J.razao_social,"ID:",J.id)}catch(G){console.error("[XMLImport] Erro ao processar fornecedor:",G),o({title:"Aviso",description:"No foi possvel criar/vincular o fornecedor, mas os produtos sero importados.",variant:"warning"})}console.log("[XMLImport] Processando apenas produtos selecionados:",he.length);for(const G of he){const ue=b[G.index]||{},ve=ue.name||G.xml.nome,ae=ue.qty!==void 0?ue.qty:Number(G.xml.quantidade),oe=ue.margin,me=ue.salePrice,De=ue.linkedProductId;try{if(De&&De!=="force-new"){ae>0&&await Uv({productId:De,delta:ae,codigoEmpresa:n}),Y.updated++,Y.details.push({produto:ve,acao:`Vinculado - Estoque atualizado (+${ae})`,status:"success"});continue}if(G.isNew||De==="force-new"){const ne=L3(G.xml,n);if(ue.name&&(ne.name=ue.name),me!=null)ne.salePrice=me,ne.price=me;else if(oe!=null&&oe>0){const ie=ne.costPrice||0;if(ie>0){const ht=ie*(1+oe/100);ne.salePrice=ht,ne.price=ht}}else ne.salePrice!=null&&ne.price==null&&(ne.price=ne.salePrice);ne.stock=ae,ne.initialStock=ae,ne.currentStock=ae,ne.importedViaXML=!0,ne.category="Importados",u?.nfe&&(ne.xmlChave=u.nfe.chaveAcesso||null,ne.xmlNumero=u.nfe.numero||null,ne.xmlSerie=u.nfe.serie||null,ne.xmlEmissao=u.nfe.dataEmissao||null);try{await lC(ne,{codigoEmpresa:n}),Y.created++,Y.details.push({produto:ve,acao:"Criado",status:"success"})}catch(ie){if(ie.message?.includes("duplicate")||ie.message?.includes("unique constraint")){console.warn("[XMLImport] Produto j existe, tentando atualizar estoque:",G.xml.nome);const pt=(await Hu({search:G.xml.nome,codigoEmpresa:n,includeInactive:!0})).find(Ze=>{const vt=(Ze.name||"").toLowerCase().trim()===(G.xml.nome||"").toLowerCase().trim(),wt=(Ze.unit||"").toUpperCase().trim()===(G.xml.unidade||"").toUpperCase().trim(),gt=(Ze.barcode||"")===(G.xml.ean||""),er=(Ze.code||"")===(G.xml.codigo||""),_e=vt&&wt||gt&&wt||er&&wt;return!_e&&(gt||er)&&!wt&&console.log("[XMLImport] Encontrado mesmo EAN/Cdigo porm unidade diferente. NO unir:",{nomeSistema:Ze.name,unidadeSistema:Ze.unit,nomeXML:G.xml.nome,unidadeXML:G.xml.unidade,ean:G.xml.ean,codigo:G.xml.codigo}),_e});if(pt&&Number(G.xml.quantidade)>0)await Uv({productId:pt.id,delta:Number(G.xml.quantidade)||0,codigoEmpresa:n}),Y.updated++,Y.details.push({produto:G.xml.nome,acao:"J existe - Estoque atualizado",status:"success"});else if(pt)Y.skipped++,Y.details.push({produto:G.xml.nome,acao:"Sem quantidade para ajustar",status:"warning"});else try{console.log("[XMLImport] Duplicate report mas no encontrou por nome+unidade/EAN+unidade/cdigo+unidade. Tentando criar novo produto.");const Ze=L3(G.xml,n);Ze.salePrice!=null&&Ze.price==null&&(Ze.price=Ze.salePrice);const vt=Number(G.xml.quantidade)||0;Ze.stock=vt,Ze.initialStock=vt,Ze.currentStock=vt,await lC(Ze,{codigoEmpresa:n}),Y.created++,Y.details.push({produto:G.xml.nome,acao:"Criado aps checagem",status:"success"})}catch(Ze){console.warn("[XMLImport] Falhou ao criar aps duplicate:",Ze),Y.skipped++,Y.details.push({produto:G.xml.nome,acao:"Falha ao criar aps duplicate",status:"warning"})}}else throw ie}}else{const ne=Number(G.xml.quantidade)||0;if(ne>0&&await Uv({productId:G.existing.id,delta:ne,codigoEmpresa:n}),ue.updatePrice===!0){const ht=Number(G.xml.valorUnitario)||0;if(ht>0)try{const pt={costPrice:ht};if(me!=null)pt.salePrice=me,pt.price=me;else if(oe!=null&&oe>0){const Ze=ht*(1+oe/100);pt.salePrice=Ze,pt.price=Ze}await L1(G.existing.id,pt)}catch(pt){console.warn("[XMLImport] Falha ao atualizar preo do produto existente",pt)}}try{const ht=G.existing||{},pt=G.xml.impostos||{},Ze=pt.icms||{},vt=pt.pis||{},wt=pt.cofins||{},gt=pt.ipi||{},er={},_e=Pt=>Pt==null||typeof Pt=="string"&&Pt.trim()==="";_e(ht.ncm)&&G.xml.ncm&&(er.ncm=G.xml.ncm),_e(ht.cfopInterno)&&G.xml.cfop&&(er.cfopInterno=G.xml.cfop),_e(ht.cstIcmsInterno)&&Ze.cst&&(er.cstIcmsInterno=Ze.cst),_e(ht.csosnInterno)&&Ze.csosn&&(er.csosnInterno=Ze.csosn),_e(ht.cstIpi)&&gt.cst&&(er.cstIpi=gt.cst),_e(ht.cstPisEntrada)&&vt.cst&&(er.cstPisEntrada=vt.cst),ht.aliqIcmsInterno==null&&Number(Ze.aliquota||0)>0&&(er.aliqIcmsInterno=Number(Ze.aliquota)),ht.aliqIpiPercent==null&&Number(gt.aliquota||0)>=0&&(er.aliqIpiPercent=Number(gt.aliquota)),ht.aliqPisPercent==null&&Number(vt.aliquota||0)>=0&&(er.aliqPisPercent=Number(vt.aliquota)),ht.aliqCofinsPercent==null&&Number(wt.aliquota||0)>=0&&(er.aliqCofinsPercent=Number(wt.aliquota)),ht.fcpPercent==null&&Number(Ze.fcpAliquota||0)>0&&(er.fcpPercent=Number(Ze.fcpAliquota)),ht.mvaPercent==null&&Number(Ze.mva||0)>0&&(er.mvaPercent=Number(Ze.mva)),ht.baseReduzidaPercent==null&&Number(Ze.pRedBC||0)>0&&(er.baseReduzidaPercent=Number(Ze.pRedBC)),Object.keys(er).length>0&&(await L1(G.existing.id,er),console.log("[XMLImport] Produto existente atualizado com fiscais faltantes",{id:G.existing.id,patch:er}))}catch(ht){console.warn("[XMLImport] Falha ao completar fiscais no produto existente",ht)}Y.updated++,Y.details.push({produto:G.xml.nome,acao:ne>0?`Estoque +${ne} (somado)`:"Verificado",status:"success"})}}catch(ne){console.error("[XMLImport] Erro ao processar produto:",G.xml.nome,ne),Y.errors++,Y.details.push({produto:G.xml.nome,acao:"Erro",status:"error",error:ne.message})}}if(u?.nfe?.chaveAcesso&&J)try{const G=await Ast(u.nfe.chaveAcesso,n);let ue=G;if(!G||!G.ativo){const ae={codigoEmpresa:n,fornecedorId:J.id,chaveNfe:u.nfe.chaveAcesso,numeroNfe:u.nfe.numero,serieNfe:u.nfe.serie,dataEmissao:u.nfe.dataEmissao,tipoOperacao:u.nfe.tipo||"Entrada",naturezaOperacao:u.nfe.naturezaOperacao,valorProdutos:u.nfe.totalNota||0,valorTotal:u.nfe.totalNota||0,xmlCompleto:$,formaPagamento:u.pagamentos&&u.pagamentos.length>0?u.pagamentos.map(oe=>oe.nome).join(", "):null};ue=await Pst(ae),console.log("[XMLImport] Nova compra registrada:",ue.numero_nfe)}else console.log("[XMLImport] NF-e j existe, adicionando novos itens:",G.numero_nfe),Y.purchaseAlreadyExists=!0;const ve=he.map(ae=>{const oe=b[ae.index]||{},me=oe.linkedProductId;let De=null;return me&&me!=="force-new"?De=me:ae.existing&&!me&&(De=ae.existing.id),{produtoId:De,codigoProdutoXML:ae.xml.codigo,nomeProdutoXML:ae.xml.nome,eanXML:ae.xml.ean,ncmXML:ae.xml.ncm,cfopXML:ae.xml.cfop,unidadeXML:ae.xml.unidade,quantidade:oe.qty!==void 0?oe.qty:Number(ae.xml.quantidade),valorUnitario:Number(ae.xml.valorUnitario)||0,valorTotal:Number(ae.xml.valorTotal)||0,valorDesconto:ae.xml.valorDesconto||0,valorFrete:ae.xml.valorFrete||0,valorSeguro:ae.xml.valorSeguro||0,valorOutrasDespesas:ae.xml.valorOutrasDespesas||0,icmsAliquota:ae.xml.icmsAliquota,icmsValor:ae.xml.icmsValor,ipiAliquota:ae.xml.ipiAliquota,ipiValor:ae.xml.ipiValor,pisAliquota:ae.xml.pisAliquota,pisValor:ae.xml.pisValor,cofinsAliquota:ae.xml.cofinsAliquota,cofinsValor:ae.xml.cofinsValor,vinculadoManualmente:!!oe.linkedProductId,observacoes:oe.observacoes||null,selecionadoNaImportacao:ae.selected}});await loe(ue.id,ve),console.log("[XMLImport] Itens adicionados  compra:",ve.length),Y.purchaseId=ue.id}catch(G){console.error("[XMLImport] Erro ao registrar compra:",G)}v(Y),g(!1),l("done"),Y.purchaseAlreadyExists?o({title:"NF-e j importada!",description:`Esta NF-e j existe no sistema. ${Y.created} produto(s) criado(s), ${Y.updated} atualizado(s).`,variant:"warning"}):Y.errors===0?o({title:"Importao concluda!",description:`${Y.created} produto(s) criado(s), ${Y.updated} atualizado(s).`,variant:"success"}):o({title:"Importao concluda com erros",description:`${Y.created} criado(s), ${Y.updated} atualizado(s), ${Y.errors} erro(s).`,variant:"warning"}),s&&s()},k=()=>{console.log("[XMLImport] Fechando modal"),l("upload"),d(null),f(null),m([]),w({}),j({}),v({created:0,updated:0,errors:0,details:[]}),t(!1)};Ee.useEffect(()=>{e&&console.log("[XMLImport] Modal aberto. Step atual:",i)},[e,i]);const B=()=>{l("upload"),d(null),f(null),m([]),w({}),j({})},z=$=>{m(Y=>Y.map((he,J)=>J===$?{...he,selected:!he.selected}:he))},U=()=>{const $=h.every(Y=>Y.selected);m(Y=>Y.map(he=>({...he,selected:!$})))},L=($,Y,he)=>{w(J=>({...J,[$]:{...J[$],[Y]:he}}))},W=($,Y)=>{console.log("[XMLImportModal] handleLinkProduct chamado:",{index:$,productId:Y}),console.log("[XMLImportModal] Estado editedProducts completo antes:",b),console.log("[XMLImportModal] Estado editedProducts[index] antes:",b[$]),w(he=>{console.log("[XMLImportModal] Estado prev no setEditedProducts:",he);const J={...he,[$]:{...he[$],linkedProductId:Y}};return console.log("[XMLImportModal] Novo estado editedProducts:",J),J})},ge=($,Y)=>!$||!Y?0:$*(1+Y/100),Ae=($,Y,he)=>b[$]?.[Y]??he,V=$=>{j(Y=>({...Y,[$]:!Y[$]}))};return a.jsxs(In,{open:e,onOpenChange:k,children:[a.jsxs(En,{className:"w-[95vw] sm:max-w-4xl max-h-[85vh] flex flex-col",children:[a.jsxs(Cn,{className:"flex-shrink-0",children:[a.jsxs(Nn,{className:"flex items-center gap-2 text-2xl font-bold",children:[a.jsx("span",{children:"Importar XML de Compra"}),u?.nfe&&a.jsx("span",{className:"inline-flex items-center rounded-full bg-surface-2 border border-border px-2 py-0.5 text-xs font-semibold text-text-muted uppercase tracking-wide",children:F()})]}),a.jsxs(Hn,{children:[i==="upload"&&"Selecione o arquivo XML da nota fiscal de entrada",i==="preview"&&"Revise os produtos que sero importados",i==="processing"&&"Processando produtos...",i==="done"&&"Importao finalizada"]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-2 py-1",children:[i==="upload"&&a.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:a.jsx("div",{className:"w-full max-w-md",children:a.jsxs("label",{htmlFor:"xml-upload",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-border rounded-lg cursor-pointer bg-surface hover:bg-surface-2 transition-colors",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(tD,{className:"w-12 h-12 mb-4 text-text-muted"}),a.jsx("p",{className:"mb-2 text-sm text-text-primary font-semibold",children:"Clique para selecionar ou arraste o arquivo"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Arquivo XML de NF-e (Nota Fiscal Eletrnica)"})]}),a.jsx("input",{id:"xml-upload",type:"file",accept:".xml",className:"hidden",onChange:O})]})})}),i==="preview"&&a.jsxs("div",{className:"space-y-4",children:[u?.nfe&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"font-semibold mb-2",children:["Informaes da ",F()]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",a.jsx("span",{className:"font-mono",children:u.nfe.numero})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",a.jsx("span",{className:"font-mono",children:u.nfe.serie})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Tipo:"})," ",a.jsx("span",{children:u.nfe.tipo})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Fornecedor:"})," ",a.jsx("span",{children:u.fornecedor?.razaoSocial})]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2 min-w-[200px]",children:[a.jsxs("div",{className:"bg-brand/10 rounded-lg p-3 border border-brand/20",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Valor Total NF-e"}),a.jsxs("p",{className:"text-xl font-bold text-brand",children:["R$ ",Number(u.nfe.totalNota||0).toFixed(2)]})]}),u.pagamentos&&u.pagamentos.length>0&&a.jsxs("div",{className:"bg-success/10 rounded-lg p-2.5 border border-success/20",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Forma de Pagamento"}),a.jsx("p",{className:"text-sm font-semibold text-success",children:u.pagamentos.map($=>$.nome).join(", ")})]})]})]}),u.nfe.chaveAcesso&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-border",children:[a.jsx("span",{className:"text-text-muted text-xs",children:"Chave de Acesso:"}),a.jsx("p",{className:"font-mono text-xs break-all",children:u.nfe.chaveAcesso})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4 px-2",children:[a.jsx(se,{variant:"outline",size:"sm",onClick:U,children:h.every($=>$.selected)?"Desmarcar Todos":"Selecionar Todos"}),a.jsxs("span",{className:"text-sm text-text-muted",children:[h.filter($=>$.selected).length," de ",h.length," selecionados"]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3 text-base",children:"Produtos Encontrados"}),a.jsx("div",{className:"space-y-2",children:h.map(($,Y)=>{const he=Ae(Y,"linkedProductId",null),J=Ae(Y,"name",$.xml.nome),G=Ae(Y,"quantity",$.xml.quantidade),ue=Ae(Y,"margin",$.xml.margem),ve=Ae(Y,"salePrice",null),ae=$.xml.valorUnitario||0;let oe=ve;oe==null&&!$.isNew&&$.existing&&(oe=Number($.existing.preco_venda||$.existing.salePrice||$.existing.price||0)),oe==null&&ue!=null&&(oe=ge(ae,ue)),oe==null&&$.xml.precoVenda&&(oe=Number($.xml.precoVenda));let me=null;if(ue!=null)me=ue;else if(oe!=null&&ae>0&&oe>0){const ne=(oe-ae)/ae*100;me=Math.max(-999,Math.min(9999,ne))}const De=_[Y];return a.jsxs("div",{className:Sr("rounded-lg border transition-all",$.selected?$.isNew?"bg-success/10 border-success/30":"bg-info/10 border-info/30":"bg-surface opacity-60 border-border"),children:[a.jsxs("div",{className:"p-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("input",{type:"checkbox",checked:$.selected,onChange:()=>z(Y),className:"w-4 h-4 rounded border-border accent-warning cursor-pointer"}),a.jsx("button",{onClick:()=>V(Y),className:"p-0.5 hover:bg-surface-2 rounded transition-colors",children:De?a.jsx(ix,{className:"w-4 h-4 text-text-muted"}):a.jsx(qg,{className:"w-4 h-4 text-text-muted"})}),a.jsx("div",{children:$.isNew?a.jsx(Es,{className:"w-5 h-5 text-success"}):a.jsx(Ng,{className:"w-5 h-5 text-info"})})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:J}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-text-muted mt-0.5",children:[$.xml.codigo&&a.jsxs("span",{className:"flex-shrink-0",children:["#",$.xml.codigo]}),a.jsxs("span",{children:["Qtd: ",G]})]})]}),a.jsx("div",{className:"flex-shrink-0 ml-2",children:$.isNew?a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-success/20 text-success font-medium",children:"Novo"}):a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-info/20 text-info font-medium",children:"Cadastrado"})})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-muted",children:[a.jsxs("span",{children:["R$ ",Number(ae).toFixed(2),oe?`  R$ ${oe.toFixed(2)}`:""]}),me!=null&&a.jsxs("span",{className:"ml-2 "+(me>0?"text-success":me<0?"text-destructive":"text-text-muted"),children:[me.toFixed(1),"%"]})]})]})]}),De&&a.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3 border-t border-border/50",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Nome do Produto"}),a.jsx("input",{type:"text",value:J,onChange:ne=>L(Y,"name",ne.target.value),disabled:!$.selected,className:"w-full px-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>L(Y,"qty",Math.max(0,G-1)),disabled:!$.selected||G<=0,className:"w-9 h-9 rounded-md border border-border bg-surface hover:bg-surface-2 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:a.jsx(hv,{className:"w-4 h-4"})}),a.jsx("input",{type:"text",value:G,onChange:ne=>{const ie=ne.target.value.replace(/\D/g,"");L(Y,"qty",ie===""?0:Number(ie))},disabled:!$.selected,className:"w-14 text-center px-2 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50"}),a.jsx("button",{type:"button",onClick:()=>L(Y,"qty",G+1),disabled:!$.selected,className:"w-9 h-9 rounded-md bg-warning hover:bg-warning/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center text-black font-bold shadow-sm",children:a.jsx(Es,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Margem %"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:(()=>{const ne=Ae(Y,"margin",null);if(ne!=null)return String(ne);if(!$.isNew&&$.existing&&ae>0){const ie=Number($.existing.preco_venda||$.existing.salePrice||$.existing.price||0);if(ie>0)return((ie-ae)/ae*100).toFixed(1)}return""})(),onChange:ne=>{const ie=ne.target.value;if(ie===""){L(Y,"margin",null);return}const ht=ie.replace(/[^0-9.,\-]/g,"").replace(",",".");if(ht==="."||ht==="-"||ht==="-.")return;const pt=parseFloat(ht);if(!isNaN(pt)&&(L(Y,"margin",pt),ae>0)){const Ze=ge(ae,pt);L(Y,"salePrice",Ze)}},disabled:!$.selected,placeholder:"0",className:"w-24 pl-3 pr-6 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right"}),a.jsx("span",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Custo"}),a.jsx("div",{className:"px-3 py-2 bg-surface/50 rounded-md border border-border",children:a.jsxs("span",{className:"text-sm font-semibold",children:["R$ ",ae.toFixed(2)]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Preo Venda"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"R$"}),a.jsx("input",{type:"text",value:(()=>{const ne=Ae(Y,"salePrice",oe);return ne==null?"":Number(ne).toFixed(2).replace(".",",")})(),onChange:ne=>{const ie=ne.target.value.replace(/\D/g,"");if(ie===""){L(Y,"salePrice",null);return}const ht=Number(ie)/100;if(L(Y,"salePrice",ht),ht>0&&ae>0){const pt=(ht-ae)/ae*100;L(Y,"margin",Math.round(pt*100)/100)}},disabled:!$.selected,placeholder:"0,00",className:"w-28 pl-7 pr-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right font-semibold text-success"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:$.isNew?"Vincular a Produto Existente (Opcional)":"Ao para este Produto"}),a.jsx("div",{className:"flex gap-2",children:a.jsxs(Gn,{value:he==="force-new"?"force-new":he||($.isNew?"new":$.existing?.id||"new"),onValueChange:ne=>{ne==="new"||ne===$.existing?.id?W(Y,null):ne==="search"?C({isOpen:!0,productIndex:Y,currentProduct:$}):W(Y,ne)},disabled:!$.selected,children:[a.jsx(Vn,{className:"flex-1 hover:bg-white/5 transition-colors text-xs sm:text-sm",children:a.jsx(Kn,{placeholder:$.isNew?"Criar novo":"Atualizar existente",children:he&&he!=="force-new"&&he!=="new"?(()=>{const ne=r?.find(ie=>ie.id===he);return ne?`Vinculado: ${ne.name}`:$.isNew?"Criar novo":"Atualizar existente"})():he==="force-new"?"Criar novo (ignorar)":$.isNew?"Criar novo":"Atualizar existente"})}),a.jsxs(Wn,{className:"max-h-[300px] overflow-y-auto text-xs sm:text-sm",children:[$.isNew?a.jsx(lt,{value:"new",children:"Criar novo produto"}):a.jsxs(lt,{value:$.existing?.id||"new",children:["Atualizar: ",$.existing?.name," (Estoque: ",$.existing?.stock||0,")"]}),!$.isNew&&a.jsx(lt,{value:"force-new",children:"Criar novo (ignorar existente)"}),a.jsx(lt,{value:"search",children:"Buscar produto para vincular"})]})]})})]}),!$.isNew&&a.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:Ae(Y,"updatePrice",!1),onChange:ne=>L(Y,"updatePrice",ne.target.checked),disabled:!$.selected,className:"w-4 h-4 rounded border-border bg-surface text-brand focus:ring-2 focus:ring-brand/50 disabled:opacity-50 disabled:cursor-not-allowed"}),a.jsx("span",{className:"text-text-secondary",children:"Atualizar preo de custo e venda deste produto"})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[$.xml.codigo&&a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["Cdigo: ",$.xml.codigo]}),$.xml.ean&&$.xml.ean!=="SEM GTIN"&&a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["EAN: ",$.xml.ean]}),a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["Unidade: ",$.xml.unidade]})]})]})]},Y)})})]}),a.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-success"}),a.jsxs("span",{children:[h.filter($=>$.isNew&&$.selected).length," novos"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-info"}),a.jsxs("span",{children:[h.filter($=>!$.isNew&&$.selected).length," existentes"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-warning"}),a.jsxs("span",{children:[h.filter($=>b[$.index]?.linkedProductId).length," vinculados"]})]})]})]}),i==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(Zl,{className:"w-12 h-12 animate-spin text-warning mb-4"}),a.jsx("p",{className:"text-lg font-semibold",children:"Processando produtos..."}),a.jsx("p",{className:"text-sm text-text-muted",children:"Aguarde enquanto importamos os produtos"})]}),i==="done"&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-6 border border-border text-center",children:[a.jsx(vi,{className:"w-16 h-16 text-success mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Importao Concluda!"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-success",children:y.created}),a.jsx("p",{className:"text-sm text-text-muted",children:"Criados"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-info",children:y.updated}),a.jsx("p",{className:"text-sm text-text-muted",children:"Atualizados"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-danger",children:y.errors}),a.jsx("p",{className:"text-sm text-text-muted",children:"Erros"})]})]})]}),y.details.length>0&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Detalhes"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:y.details.map(($,Y)=>a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[$.status==="success"?a.jsx(vi,{className:"w-4 h-4 text-success flex-shrink-0"}):a.jsx(ud,{className:"w-4 h-4 text-danger flex-shrink-0"}),a.jsx("span",{className:"flex-1 truncate",children:$.produto}),a.jsx("span",{className:Sr("text-xs px-2 py-1 rounded",$.status==="success"?"bg-success/20 text-success":"bg-danger/20 text-danger"),children:$.acao})]},Y))})]})]})]}),a.jsxs(Na,{children:[i==="upload"&&a.jsx(se,{variant:"outline",onClick:k,children:"Cancelar"}),i==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(se,{variant:"outline",onClick:B,children:"Voltar"}),a.jsxs(se,{onClick:I,disabled:h.filter($=>$.selected).length===0,children:["Confirmar Importao (",h.filter($=>$.selected).length," de ",h.length," produtos)"]})]}),i==="done"&&a.jsx(se,{onClick:k,children:"Fechar"})]})]}),a.jsx(doe,{isOpen:S.isOpen,onClose:()=>C({isOpen:!1,productIndex:null,currentProduct:null}),onSelect:$=>{console.log("[XMLImportModal] onSelect chamado com produto:",$),console.log("[XMLImportModal] Index do produto:",S.productIndex),W(S.productIndex,$.id),C({isOpen:!1,productIndex:null,currentProduct:null})},currentProduct:S.currentProduct}),a.jsx(uoe,{isOpen:A.isOpen,onClose:()=>P({isOpen:!1}),onConfirm:T,products:h.map(($,Y)=>({...$,originalIndex:Y})),editedProducts:b,allProducts:r,isReprocess:!1})]})}const Mst=[],Rst=[],Fst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},$3={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},mV="produtosPage:settings";function Lst(e){const t=["Cdigo","Produto","Categoria","Tipo","Unidade","Preo Custo","Preo Venda","% Lucro","Estoque","Estoque Mn.","Validade","Status","Ativo","EAN-13","EAN-13 Caixa","Referncia","Marca","Grupo","NCM","Descrio NCM","CEST","Usar CSOSN","CFOP Interno","CST ICMS Interno","CSOSN Interno","Aliq ICMS Interno (%)","CFOP Externo","CST ICMS Externo","CSOSN Externo","Aliq ICMS Externo (%)","CST PIS Entrada","CST PIS Sada","Aliq PIS (%)","Aliq COFINS (%)","CST IPI","Aliq IPI (%)","FCP (%)","MVA (%)","Base Reduzida (%)"],r=";",n=g=>{const y=Number(g??0);return Number.isFinite(y)?y.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):"0,00"},s=g=>`R$ ${n(g)}`,o=g=>{const y=Number(g??0);return Number.isFinite(y)?y.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},i=g=>{if(!g)return"";try{if(typeof g=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(g)){const[v,b,w]=g.split("-");return`${w}/${b}/${v}`}const y=new Date(g);if(!isNaN(y)){const v=String(y.getDate()).padStart(2,"0"),b=String(y.getMonth()+1).padStart(2,"0"),w=y.getFullYear();return`${v}/${b}/${w}`}}catch{}return String(g)},l=g=>g==="active"?"Ativo":g==="low_stock"?"Estoque Baixo":g==="inactive"?"Inativo":"",c=g=>g?"Sim":"No",d=g=>g??"",u=g=>{const y=g==null?"":String(g);return/[";\n]/.test(y)?`"${y.replace(/"/g,'""')}"`:y},f=[];f.push("\uFEFF"+t.join(r));for(const g of e){const y=[d(g.code),d(g.name),d(g.category),d(g.type),d(g.unit),s(g.costPrice),s(g.price??g.salePrice),o(g.marginPercent),Number(g.stock??0),Number(g.minStock??0),i(g.validade),l(g.status),c(g.active!==!1),d(g.barcode),d(g.barcodeBox),d(g.reference),d(g.brand),d(g.group),d(g.ncm),d(g.ncmDescription),d(g.cest),g.useCsosn?"Sim":"",d(g.cfopInterno),d(g.cstIcmsInterno),d(g.csosnInterno),o(g.aliqIcmsInterno),d(g.cfopExterno),d(g.cstIcmsExterno),d(g.csosnExterno),o(g.aliqIcmsExterno),d(g.cstPisEntrada),d(g.cstPisSaida),o(g.aliqPisPercent),o(g.aliqCofinsPercent),d(g.cstIpi),o(g.aliqIpiPercent),o(g.fcpPercent),o(g.mvaPercent),o(g.baseReduzidaPercent)].map(u).join(r);f.push(y)}const h=new Blob([f.join(`
`)],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(h),x=document.createElement("a");x.href=m,x.download="produtos.csv",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m)}function Qc(e,{action:t}={}){const r=String(e?.message||e||"").toLowerCase();if(r.includes("categoria possui produtos ativos vinculados"))return{title:"No  possvel remover",description:"Existem produtos ativos vinculados a esta categoria. Inative ou recategoriz-os antes."};if(r.includes("categoria no encontrada"))return{title:"Categoria no encontrada",description:"No foi possvel localizar a categoria para desativao."};if(r.includes("duplicate key")&&r.includes("ux_produtos_empresa_codigo_produto"))return{title:"Cdigo j cadastrado",description:"J existe um produto com este cdigo na sua empresa. Informe outro cdigo."};if(r.includes("duplicate key")&&r.includes("unique constraint"))return{title:"Registro j existe",description:"J existe um registro com estes dados."};if(r.includes("permission denied")||r.includes("violates row-level security")||r.includes("rls"))return{title:"Sem permisso",description:"Voc no tem permisso para executar esta ao."};const n=r.match(/null value in column "([^"]+)" violates not-null constraint/);return n?{title:"Campo obrigatrio",description:`Preencha o campo "${n[1].replace(/_/g," ")}".`}:r.includes("invalid input syntax")||r.includes("invalid input value")?{title:"Valor invlido",description:"Revise os valores informados (formato invlido)."}:r.includes("violates check constraint")?{title:"Valor invlido",description:"Os dados informados no atendem s regras do sistema."}:r.includes("violates foreign key constraint")?r.includes("update or delete on table")?{title:"No  possvel excluir",description:"Existem registros vinculados que impedem a excluso."}:{title:"Relao invlida",description:"O registro relacionado no foi encontrado ou  invlido."}:r.includes("failed to fetch")||r.includes("networkerror")||r.includes("network error")?{title:"Falha de conexo",description:"Verifique sua internet e tente novamente."}:r.includes("timeout")?{title:"Tempo esgotado",description:"A operao demorou demais. Tente novamente."}:r.includes("rate limit")||r.includes("too many requests")||r.includes("status code 429")?{title:"Muitas solicitaes",description:"Aguarde alguns segundos e tente novamente."}:t==="save"?{title:"Falha ao salvar",description:"No foi possvel salvar o produto. Tente novamente."}:t==="delete"?{title:"Falha ao inativar",description:"No foi possvel inativar o produto."}:t==="fetch"?{title:"Erro ao carregar",description:"No foi possvel atualizar a lista de produtos."}:t==="export"?{title:"Falha ao exportar",description:"No foi possvel gerar o arquivo."}:{title:"Erro",description:e?.message||"Ocorreu um erro."}}const Pk=({icon:e,title:t,value:r,subtitle:n,color:s,onClick:o,isActive:i})=>{const l=e;return a.jsxs(Er.div,{variants:$3,className:Sr("bg-surface rounded-2xl border-2 p-3 sm:p-4 flex flex-col justify-between gap-2 cursor-pointer transition-all duration-300",i?`${s}/30 border-${s}`:"border-border hover:border-border-hover"),onClick:o,children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[a.jsx("p",{className:"text-text-secondary text-xs sm:text-sm font-semibold leading-snug whitespace-nowrap overflow-hidden text-ellipsis",children:t}),a.jsx(l,{className:Sr("w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0",s)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold text-text-primary leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:r}),a.jsx("p",{className:"hidden sm:block text-xs text-text-muted",children:n})]})]})};function $st({open:e,onOpenChange:t,product:r,onSave:n,categories:s,onCreateCategory:o,suggestedCode:i,onRefreshProducts:l,products:c}){const{toast:d}=Ss(),{userProfile:u}=qs(),[f,h]=p.useState("dados"),[m,x]=p.useState(r?.code||""),[g,y]=p.useState(r?.name||""),[v,b]=p.useState(r?.category||""),[w,_]=p.useState(r?.type||"Venda"),[j,S]=p.useState(r?.unit||"UN"),[C,A]=p.useState(r?.active??!0),[P,F]=p.useState(r?.barcode||""),[O,I]=p.useState(r?.barcodeBox||""),[T,k]=p.useState(r?.reference||""),[B,z]=p.useState(r?.brand||""),[U,L]=p.useState(r?.group||""),[W,ge]=p.useState(!!r?.allowSale),[Ae,V]=p.useState(!!r?.payCommission),[$,Y]=p.useState(!!r?.variablePrice),[he,J]=p.useState(!!r?.composition),[G,ue]=p.useState(!!r?.service),[ve,ae]=p.useState(!!r?.hasGrid),[oe,me]=p.useState(!!r?.usePriceTable),[De,ne]=p.useState(!!r?.fuel),[ie,ht]=p.useState(!!r?.useImei),[pt,Ze]=p.useState(!!r?.stockByGrid),[vt,wt]=p.useState(!!r?.showInApp),[gt,er]=p.useState(r?.costPrice!=null?Number(r.costPrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.cost!=null?Number(r.cost).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),[_e,Pt]=p.useState(r?.salePrice!=null?Number(r.salePrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.price!=null?Number(r.price).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),[Lt,gr]=p.useState(r?.marginPercent!=null?String(Number(r.marginPercent).toFixed(2)).replace(".",","):""),[fr,je]=p.useState(r?.stock?String(r.stock):""),[nt,$t]=p.useState(r?.minStock?String(r.minStock):""),[Ut,Fe]=p.useState(r?.status||"active"),[xt,Ot]=p.useState(r?.validade||null),[Cr,Me]=p.useState(!1),[Qe,et]=p.useState(!1),[Yt,xr]=p.useState(""),[Jt,kr]=p.useState(!0),[_r,Rr]=p.useState(!!(r?.csosnInterno||r?.csosnExterno)),[nn,rn]=p.useState(r?.cfopInterno||""),[Ke,qe]=p.useState(r?.cstIcmsInterno||""),[ze,Je]=p.useState(r?.csosnInterno||""),[kt,ct]=p.useState(r?.aliqIcmsInterno!=null?String(r.aliqIcmsInterno).replace(".",","):""),[tr,dt]=p.useState(r?.cfopExterno||""),[Mt,ce]=p.useState(r?.cstIcmsExterno||""),[Xe,Qt]=p.useState(r?.csosnExterno||""),[Tt,Ar]=p.useState(r?.aliqIcmsExterno!=null?String(r.aliqIcmsExterno).replace(".",","):""),[nr,Jr]=p.useState(r?.cstPisEntrada||""),[gn,tt]=p.useState(r?.cstPisSaida||""),[jr,ua]=p.useState(r?.aliqPisPercent!=null?String(r.aliqPisPercent).replace(".",","):""),[Oe,Wt]=p.useState(r?.aliqCofinsPercent!=null?String(r.aliqCofinsPercent).replace(".",","):""),[Ht,mr]=p.useState(r?.cstIpi||""),[Gt,pn]=p.useState(r?.aliqIpiPercent!=null?String(r.aliqIpiPercent).replace(".",","):""),[jt,ur]=p.useState(r?.fcpPercent!=null?String(r.fcpPercent).replace(".",","):""),[rt,Dt]=p.useState(r?.mvaPercent!=null?String(r.mvaPercent).replace(".",","):""),[Xt,Tr]=p.useState(r?.baseReduzidaPercent!=null?String(r.baseReduzidaPercent).replace(".",","):""),[qn,Gr]=p.useState(r?.ncm||""),[ar,kn]=p.useState(r?.ncmDescription||""),[Xn,aa]=p.useState(r?.cest||""),[pa,te]=p.useState(!1),[Te,at]=p.useState(!1),ee=Ue=>{const St=String(Ue||"").replace(/\D/g,"");return(St?Number(St)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},Se=Ue=>{if(!Ue)return 0;const St=String(Ue).replace(/\./g,"").replace(",","."),Nr=Number(St);return Number.isFinite(Nr)?Nr:0},$e=Ue=>{const St=String(Ue||"").replace(/[^\d,]/g,"");return St?`% ${St}`:""},Be=Ue=>{if(Ue==null||Ue==="")return 0;const St=String(Ue).replace(/\./g,"").replace(",","."),Nr=Number(St);return Number.isFinite(Nr)?Nr:0},Ge=Ue=>String(Ue||"").replace(/\D/g,"").slice(0,13),Ye=Ue=>String(Ue||"").replace(/\D/g,"").slice(0,4),ft=Ue=>String(Ue||"").replace(/\D/g,"").slice(0,8),yt=Ue=>String(Ue||"").replace(/\D/g,"").slice(0,7);p.useEffect(()=>{x(r?.code||""),y(r?.name||""),b(r?.category||""),_(r?.type||"Venda"),S(r?.unit||"UN"),A(r?.active??!0),F(r?.barcode||""),I(r?.barcodeBox||""),k(r?.reference||""),z(r?.brand||""),L(r?.group||""),ge(!!r?.allowSale),V(!!r?.payCommission),Y(!!r?.variablePrice),J(!!r?.composition),ue(!!r?.service),ae(!!r?.hasGrid),me(!!r?.usePriceTable),ne(!!r?.fuel),ht(!!r?.useImei),Ze(!!r?.stockByGrid),wt(!!r?.showInApp),er(r?.costPrice!=null?Number(r.costPrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.cost!=null?Number(r.cost).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),Pt(r?.salePrice!=null?Number(r.salePrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.price!=null?Number(r.price).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),gr(r?.marginPercent!=null?String(Number(r.marginPercent).toFixed(2)).replace(".",","):""),je(r?.stock?String(r.stock):""),$t(r?.minStock?String(r.minStock):""),Fe(r?.status||"active"),Ot(r?.validade||null),Rr(!!(r?.csosnInterno||r?.csosnExterno)),rn(r?.cfopInterno||""),qe(r?.cstIcmsInterno||""),Je(r?.csosnInterno||""),ct(r?.aliqIcmsInterno!=null?String(r.aliqIcmsInterno).replace(".",","):""),dt(r?.cfopExterno||""),ce(r?.cstIcmsExterno||""),Qt(r?.csosnExterno||""),Ar(r?.aliqIcmsExterno!=null?String(r.aliqIcmsExterno).replace(".",","):""),Jr(r?.cstPisEntrada||""),tt(r?.cstPisSaida||""),ua(r?.aliqPisPercent!=null?String(r.aliqPisPercent).replace(".",","):""),Wt(r?.aliqCofinsPercent!=null?String(r.aliqCofinsPercent).replace(".",","):""),mr(r?.cstIpi||""),pn(r?.aliqIpiPercent!=null?String(r.aliqIpiPercent).replace(".",","):""),ur(r?.fcpPercent!=null?String(r.fcpPercent).replace(".",","):""),Dt(r?.mvaPercent!=null?String(r.mvaPercent).replace(".",","):""),Tr(r?.baseReduzidaPercent!=null?String(r.baseReduzidaPercent).replace(".",","):""),Gr(r?.ncm||""),kn(r?.ncmDescription||""),aa(r?.cest||""),kr(!0),!r&&i&&!m&&x(i),te(!1),at(!1)},[r,e]);const Et=p.useRef("salePrice");p.useEffect(()=>{if(Et.current==="salePrice"){const Ue=Se(gt),St=Se(_e);if(St>0){const Nr=(St-Ue)/St*100;gr(Nr.toFixed(2).replace(".",","))}else gr("")}},[gt,_e]),p.useEffect(()=>{if(Et.current==="marginPercent"){const Ue=setTimeout(()=>{const St=Se(gt),Nr=Be(Lt);if(console.log("[Margem] Custo:",St,"Margem:",Nr),St>0&&Nr>0)if(Nr>=100){const an=St*(1+Nr/100);console.log("[Margem] Preo calculado (markup):",an),Pt(an.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}else{const an=St/(1-Nr/100);console.log("[Margem] Preo calculado (margem):",an),Pt(an.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}},500);return()=>clearTimeout(Ue)}},[Lt,gt]);const br=async Ue=>{if(Ue.preventDefault(),Cr)return;const St=[];if(g?.trim()||St.push("Descrio"),j?.trim()||St.push("Unidade"),w||St.push("Tipo de Produto"),Se(_e)<=0&&St.push("Preo de Venda"),St.length){d({title:"Preencha os campos obrigatrios",description:St.join(", "),variant:"destructive"});return}console.log("[ProdutosPage] handleSave - Estado active antes de salvar:",C);let Nr=Ut;C?Ut==="inactive"&&C&&(Nr="active"):Nr="inactive",console.log("[ProdutosPage] handleSave - Status ajustado:",Nr);const an={id:r?.id,code:m?.trim()||"",name:g,category:v,type:w,stock:Number(fr||0),minStock:Number(nt||0),status:Nr,validade:xt,unit:j,active:C,barcode:Ge(P),barcodeBox:Ge(O),reference:T?.trim()||null,brand:B?.trim()||null,group:U?.trim()||null,cost:Se(gt),price:Se(_e),buyPrice:null,costsPercent:null,costPrice:Se(gt),salePrice:Se(_e),marginPercent:Be(Lt),allowSale:W,payCommission:Ae,variablePrice:$,composition:he,service:G,hasGrid:ve,usePriceTable:oe,fuel:De,useImei:ie,stockByGrid:pt,showInApp:vt,cfopInterno:Ye(nn)||null,cstIcmsInterno:_r?null:Ke||null,csosnInterno:_r&&ze||null,aliqIcmsInterno:Be(kt),cfopExterno:Ye(tr)||null,cstIcmsExterno:_r?null:Mt||null,csosnExterno:_r&&Xe||null,aliqIcmsExterno:Be(Tt),cstPisEntrada:nr||null,cstPisSaida:gn||null,aliqPisPercent:Be(jr),aliqCofinsPercent:Be(Oe),cstIpi:Ht||null,aliqIpiPercent:Be(Gt),fcpPercent:Be(jt),mvaPercent:Be(rt),baseReduzidaPercent:Be(Xt),ncm:ft(qn)||null,ncmDescription:ar||null,cest:yt(Xn)||null};try{Me(!0),console.log("[Produtos] Salvando produto",an);const Lr=2e4,On=new Promise((Qn,Ta)=>setTimeout(()=>Ta(new Error("Timeout ao salvar produto (20s)")),Lr));await Promise.race([n(an),On]),d({title:"Produto salvo",description:"O produto foi salvo com sucesso.",variant:"success",duration:4e3,className:"bg-amber-500 text-black shadow-xl"}),t(!1)}catch(Lr){console.error("[Produtos] Erro ao salvar",Lr);const On=Qc(Lr,{action:"save"});d({title:On.title,description:On.description,variant:"destructive",duration:6e3})}finally{Me(!1)}};return p.useEffect(()=>{e||Me(!1)},[e]),a.jsxs(In,{open:e,onOpenChange:t,children:[a.jsxs(En,{className:"w-[90vw] sm:max-w-[780px] max-h-[80vh] sm:max-h-[85vh] flex flex-col",onKeyDown:Ue=>{Ue.key==="F5"&&(Ue.preventDefault(),br(Ue)),Ue.key==="Escape"&&(Ue.preventDefault(),t(!1))},children:[a.jsx(Cn,{children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{children:[a.jsx(Nn,{className:"text-lg sm:text-xl",children:r?"Detalhes do Produto":"Novo Produto"}),a.jsx(Hn,{className:"text-xs sm:text-sm",children:"Preencha as informaes e use as abas para navegar."})]})})}),a.jsx("form",{onSubmit:br,className:"grid gap-4 py-2 flex-1 overflow-y-auto pr-1 fx-scroll",children:a.jsxs(od,{value:f,onValueChange:h,className:"w-full",children:[a.jsx("div",{className:"sm:hidden mb-4",children:a.jsxs(Gn,{value:f,onValueChange:h,children:[a.jsx(Vn,{className:"w-full",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"dados",children:"Dados"}),a.jsx(lt,{value:"estoque",children:"Estoque"}),a.jsx(lt,{value:"preco",children:"Preo e Lucro"}),a.jsx(lt,{value:"impostos",children:"Impostos"}),a.jsx(lt,{value:"outras",children:"Outras Info"})]})]})}),a.jsxs(sc,{className:"hidden sm:grid grid-cols-5 gap-1",children:[a.jsx(Pa,{value:"dados",children:"Dados"}),a.jsx(Pa,{value:"estoque",children:"Estoque"}),a.jsx(Pa,{value:"preco",children:"Preo e Lucro"}),a.jsx(Pa,{value:"impostos",children:"Impostos"}),a.jsx(Pa,{value:"outras",children:"Outras Info"})]}),a.jsx("div",{className:"mt-2 text-[10px] sm:text-[11px] text-text-muted",children:"* Campo obrigatrio"}),a.jsxs(Gs,{value:"dados",className:"space-y-3 mt-2",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(it,{htmlFor:"code",className:"text-left sm:text-right text-xs sm:text-sm",children:["Cdigo ",a.jsx("span",{className:"text-text-muted text-[10px] sm:text-xs",children:"(auto)"})]}),a.jsx(Ct,{id:"code",value:m,onChange:Ue=>x(Ue.target.value.replace(/\D/g,"")),className:"col-span-1 sm:col-span-3 text-sm",placeholder:i||"Ex.: 0001",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(it,{htmlFor:"name",className:"text-left sm:text-right text-xs sm:text-sm",children:["Descrio ",!g?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(Ct,{id:"name",value:g,onChange:Ue=>y(Ue.target.value),className:"col-span-1 sm:col-span-3 text-sm",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"category",className:"text-left sm:text-right text-xs sm:text-sm",children:"Categoria"}),a.jsxs("div",{className:"col-span-3 flex gap-2 items-center",children:[a.jsxs(Gn,{value:v,onValueChange:Ue=>Jt&&b(Ue),children:[a.jsx(Vn,{className:"w-full",disabled:!Jt,children:a.jsx(Kn,{placeholder:"Selecione..."})}),a.jsx(Wn,{children:s.map(Ue=>a.jsx(lt,{value:Ue,children:Ue},Ue))})]}),a.jsxs(se,{type:"button",onClick:()=>et(Ue=>!Ue),className:"bg-amber-500 hover:bg-amber-400 text-black inline-flex items-center gap-2 whitespace-nowrap px-3",title:Qe?"Fechar":"Adicionar nova categoria",disabled:!Jt,children:[a.jsx("span",{className:"font-bold",children:"+"}),a.jsx("span",{children:"Novo"})]})]})]}),Qe&&a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx("div",{className:"col-span-1"}),a.jsxs("div",{className:"col-span-3 flex gap-2",children:[a.jsx(Ct,{value:Yt,onChange:Ue=>xr(Ue.target.value),placeholder:"Nome da nova categoria"}),a.jsx(se,{type:"button",onClick:async()=>{const Ue=Yt.trim();if(Ue)try{if(s.includes(Ue)){d({title:"Categoria j existe",description:"Escolha outro nome.",variant:"destructive"});return}await o?.(Ue),b(Ue),xr(""),et(!1),d({title:"Categoria adicionada",description:"Ela j est selecionada no formulrio.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(St){console.error("[Produto] add category inline:error",St);const Nr=Qc(St,{action:"save"});d({title:Nr.title,description:Nr.description,variant:"destructive"})}},children:"Adicionar"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(it,{htmlFor:"unit",className:"text-left sm:text-right text-xs sm:text-sm",children:["Unidade ",!j?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsxs(Gn,{value:j,onValueChange:Ue=>Jt&&S(Ue),children:[a.jsx(Vn,{className:"col-span-1 sm:col-span-3 text-sm",disabled:!Jt,children:a.jsx(Kn,{placeholder:"Selecione a unidade"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"UN",children:"UN - Unidade"}),a.jsx(lt,{value:"CX",children:"CX - Caixa"}),a.jsx(lt,{value:"PC",children:"PC - Pea"}),a.jsx(lt,{value:"KG",children:"KG - Quilograma"}),a.jsx(lt,{value:"G",children:"G - Grama"}),a.jsx(lt,{value:"L",children:"L - Litro"}),a.jsx(lt,{value:"ML",children:"ML - Mililitro"}),a.jsx(lt,{value:"M",children:"M - Metro"}),a.jsx(lt,{value:"M2",children:"M - Metro Quadrado"}),a.jsx(lt,{value:"M3",children:"M - Metro Cbico"}),a.jsx(lt,{value:"PAR",children:"PAR - Par"}),a.jsx(lt,{value:"DZ",children:"DZ - Dzia"}),a.jsx(lt,{value:"FD",children:"FD - Fardo"}),a.jsx(lt,{value:"SC",children:"SC - Saco"}),a.jsx(lt,{value:"PT",children:"PT - Pacote"}),a.jsx(lt,{value:"SERV",children:"SERV - Servio"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(it,{className:"text-left sm:text-right text-xs sm:text-sm",children:["Tipo ",!w&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsxs(Gn,{value:w,onValueChange:Ue=>Jt&&_(Ue),children:[a.jsx(Vn,{className:"col-span-1 sm:col-span-3 text-sm",disabled:!Jt,children:a.jsx(Kn,{placeholder:"Selecione o tipo"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"Venda",children:"Produto para Venda"}),a.jsx(lt,{value:"Uso Interno",children:"Produto de Uso Interno"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-left sm:text-right text-xs sm:text-sm",children:"Ativo"}),a.jsx("div",{className:"col-span-1 sm:col-span-3",children:r?a.jsxs(a.Fragment,{children:[a.jsx(Is,{checked:C,onCheckedChange:Ue=>{console.log("[ProdutosPage] Checkbox active mudou para:",Ue),A(!!Ue)},disabled:!Jt}),a.jsx("span",{className:"ml-2 text-xs sm:text-sm",children:"Ativo"})]}):a.jsxs(Gn,{value:C?"ativo":"inativo",onValueChange:Ue=>{console.log("[ProdutosPage] Select active mudou para:",Ue),A(Ue==="ativo")},children:[a.jsx(Vn,{className:"w-full sm:w-48 text-sm",disabled:!Jt,children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"ativo",children:"Ativo"}),a.jsx(lt,{value:"inativo",children:"Inativo"})]})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"barcode",className:"text-left sm:text-right text-xs sm:text-sm",children:"EAN-13"}),a.jsx(Ct,{id:"barcode",value:P,onChange:Ue=>F(Ge(Ue.target.value)),className:"col-span-1 sm:col-span-3 text-sm",placeholder:"789...",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(it,{htmlFor:"validade",className:"text-left sm:text-right text-xs sm:text-sm",children:["Validade ",a.jsx("span",{className:"text-text-muted text-[10px] sm:text-xs",children:"(Opcional)"})]}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:Sr("col-span-1 sm:col-span-3 justify-start text-left font-normal text-xs sm:text-sm",!xt&&"text-muted-foreground"),disabled:!Jt,children:[a.jsx(wj,{className:"mr-2 h-3 w-3 sm:h-4 sm:w-4"}),xt?sr(xt,"dd/MM/yyyy"):a.jsx("span",{children:"Selecione a data"})]})}),a.jsx(Go,{className:"p-0 w-[280px] sm:w-[300px]",children:a.jsx("div",{className:"w-[280px] sm:w-[300px] min-h-[300px] sm:min-h-[332px]",children:a.jsx(oi,{mode:"single",selected:xt,onSelect:Ot,initialFocus:!0,fixedWeeks:!0})})})]})]})]}),a.jsx(Gs,{value:"estoque",className:"space-y-3 mt-2",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"grid grid-cols-2 items-center gap-2",children:[a.jsx(it,{htmlFor:"stock",className:"text-right",children:"Estoque"}),a.jsx(Ct,{id:"stock",value:fr,onChange:Ue=>je(Ue.target.value.replace(/[^0-9]/g,"")),disabled:!Jt,className:"col-span-1",inputMode:"numeric"})]}),a.jsxs("div",{className:"grid grid-cols-2 items-center gap-4",children:[a.jsx(it,{htmlFor:"minStock",className:"text-right",children:"Estoque Mn."}),a.jsx(Ct,{id:"minStock",value:nt,onChange:Ue=>$t(Ue.target.value.replace(/[^0-9]/g,"")),disabled:!Jt,inputMode:"numeric"})]})]})}),a.jsxs(Gs,{value:"preco",className:"space-y-3 mt-2",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"costPrice",className:"text-xs sm:text-right",children:"Preo de Custo (R$)"}),a.jsx(Ct,{id:"costPrice",inputMode:"numeric",placeholder:"Ex.: 10,00",value:`R$ ${gt||"0,00"}`,onChange:Ue=>{er(ee(Ue.target.value))},disabled:!Jt,className:"sm:col-span-3 text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(it,{htmlFor:"salePrice",className:"text-xs sm:text-right",children:["Preo de Venda (R$) ",(!_e||Se(_e)<=0)&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(Ct,{id:"salePrice",inputMode:"numeric",placeholder:"Ex.: 15,00",value:`R$ ${_e||"0,00"}`,onChange:Ue=>{Et.current="salePrice",Pt(ee(Ue.target.value))},disabled:!Jt,className:"sm:col-span-3 text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"marginPercent",className:"text-xs sm:text-right",children:"% de Lucro (Margem)"}),a.jsx(Ct,{id:"marginPercent",type:"text",placeholder:"Ex.: 40",value:Lt?`% ${Lt}`:"",onChange:Ue=>{Et.current="marginPercent";const St=Ue.target.value.replace(/[^\d,]/g,"");gr(St)},onBlur:()=>{if(Et.current==="marginPercent"){const Ue=Se(gt),St=Be(Lt);if(Ue>0&&St>0)if(St>=100){const Nr=Ue*(1+St/100);Pt(Nr.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}else{const Nr=Ue/(1-St/100);Pt(Nr.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}}},disabled:!Jt,className:"sm:col-span-3 text-xs sm:text-sm"})]})]}),a.jsxs(Gs,{value:"impostos",className:"space-y-4 mt-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Is,{id:"useCsosn",checked:_r,onCheckedChange:Ue=>Rr(!!Ue),disabled:!Jt}),a.jsx(it,{htmlFor:"useCsosn",className:"cursor-pointer text-xs sm:text-sm",children:"Usar CSOSN (Simples Nacional)"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"ICMS - Operao Interna"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CFOP"}),a.jsx(Ct,{value:nn,onChange:Ue=>rn(Ye(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"5102",disabled:!Jt})]}),!_r&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CST"}),a.jsx(Ct,{value:Ke,onChange:Ue=>qe(Ue.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"00, 20, 40...",disabled:!Jt})]}),_r&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CSOSN"}),a.jsx(Ct,{value:ze,onChange:Ue=>Je(Ue.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"101, 102...",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"Alquota ICMS (%)"}),a.jsx(Ct,{value:`${kt||""}`,onChange:Ue=>ct($e(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!Jt})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"ICMS - Operao Externa"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CFOP"}),a.jsx(Ct,{value:tr,onChange:Ue=>dt(Ye(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"6102",disabled:!Jt})]}),!_r&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CST"}),a.jsx(Ct,{value:Mt,onChange:Ue=>ce(Ue.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"00, 20, 40...",disabled:!Jt})]}),_r&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CSOSN"}),a.jsx(Ct,{value:Xe,onChange:Ue=>Qt(Ue.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"101, 102...",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"Alquota ICMS (%)"}),a.jsx(Ct,{value:`${Tt||""}`,onChange:Ue=>Ar($e(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!Jt})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"PIS/COFINS"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CST PIS Entrada"}),a.jsx(Ct,{value:nr,onChange:Ue=>Jr(Ue.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"50, 70...",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CST PIS Sada"}),a.jsx(Ct,{value:gn,onChange:Ue=>tt(Ue.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"01, 04...",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"Alquota PIS (%)"}),a.jsx(Ct,{value:`${jr||""}`,onChange:Ue=>ua($e(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,65",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"Alquota COFINS (%)"}),a.jsx(Ct,{value:`${Oe||""}`,onChange:Ue=>Wt($e(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"3,00",disabled:!Jt})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"IPI"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CST IPI"}),a.jsx(Ct,{value:Ht,onChange:Ue=>mr(Ue.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"50, 99...",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"Alquota IPI (%)"}),a.jsx(Ct,{value:`${Gt||""}`,onChange:Ue=>pn($e(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!Jt})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"FCP (%)"}),a.jsx(Ct,{value:`${jt||""}`,onChange:Ue=>ur($e(Ue.target.value)),placeholder:"2,00",disabled:!Jt,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"MVA (%)"}),a.jsx(Ct,{value:`${rt||""}`,onChange:Ue=>Dt($e(Ue.target.value)),placeholder:"40,00",disabled:!Jt,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"Base Reduzida (%)"}),a.jsx(Ct,{value:`${Xt||""}`,onChange:Ue=>Tr($e(Ue.target.value)),placeholder:"0,00",disabled:!Jt,className:"text-xs sm:text-sm"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"NCM"}),a.jsx(Ct,{value:qn,onChange:Ue=>Gr(ft(Ue.target.value)),placeholder:"00000000",disabled:!Jt,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"CEST"}),a.jsx(Ct,{value:Xn,onChange:Ue=>aa(yt(Ue.target.value)),placeholder:"0000000",disabled:!Jt,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4 sm:col-span-2",children:[a.jsx(it,{className:"text-xs sm:text-right",children:"Descrio NCM"}),a.jsx(Ct,{value:ar,onChange:Ue=>kn(Ue.target.value),placeholder:"Descrio do NCM",disabled:!Jt,className:"text-sm"})]})]})]}),a.jsxs(Gs,{value:"outras",className:"space-y-3 mt-2",children:[r&&a.jsxs("div",{className:"pb-4 mb-4 border-b border-border",children:[a.jsx(se,{type:"button",onClick:()=>te(!0),disabled:!Jt,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:"Desmembrar e Unir Produto"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Divida o preo por quantidade e opcionalmente una com outro produto"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"barcode2",className:"text-xs sm:text-right",children:"Cdigo de Barras"}),a.jsx(Ct,{id:"barcode2",value:P,onChange:Ue=>F(Ge(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"EAN-13",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"barcodeBox",className:"text-xs sm:text-right",children:"Cdigo Barras (Caixa)"}),a.jsx(Ct,{id:"barcodeBox",value:O,onChange:Ue=>I(Ge(Ue.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"EAN-13 da caixa",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"reference",className:"text-xs sm:text-right",children:"Referncia"}),a.jsx(Ct,{id:"reference",value:T,onChange:Ue=>k(Ue.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: REF-123",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"brand",className:"text-xs sm:text-right",children:"Marca"}),a.jsx(Ct,{id:"brand",value:B,onChange:Ue=>z(Ue.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: Nike",disabled:!Jt})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(it,{htmlFor:"group",className:"text-xs sm:text-right",children:"Grupo"}),a.jsx(Ct,{id:"group",value:U,onChange:Ue=>L(Ue.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: Calados",disabled:!Jt})]})]}),!1]})}),a.jsxs(Na,{children:[a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",children:"Cancelar"})}),a.jsx(se,{type:"button",onClick:br,disabled:Cr||!Jt,title:"F5 para salvar",children:Cr?"Salvando...":"Salvar Produto"})]})]}),a.jsx(Bst,{open:pa,onOpenChange:te,product:r,currentPrice:_e,allProducts:c,userProfile:u,onApply:async(Ue,St,Nr,an)=>{if(!Nr)Pt(Ue),je(St),te(!1),d({title:"Preo desmembrado!",description:`Preo unitrio: R$ ${Se(Ue).toFixed(2)} | Estoque: ${St}`,variant:"success"});else try{const Lr=Number(St),On=await Uv({productId:Nr.id,delta:Lr,codigoEmpresa:u?.codigo_empresa}),Qn=Number(On?.stock??Number(Nr.stock||0)+Lr);if(an){const Ta={...Nr,stock:Qn,salePrice:Se(Ue),price:Se(Ue)};await L1(Nr.id,Ta)}await yF(r.id),d({title:"Produto desmembrado e unido!",description:`${Nr.name}: novo estoque = ${Qn} | preo unitrio = R$ ${Se(Ue).toFixed(2)}`,variant:"success"}),te(!1),t(!1);try{typeof l=="function"&&l()}catch{}}catch(Lr){console.error("[Desmembrar e Unir] Erro:",Lr),d({title:"Erro ao processar",description:Lr?.message||"Tente novamente",variant:"destructive"})}}})]})}function Bst({open:e,onOpenChange:t,product:r,currentPrice:n,allProducts:s,userProfile:o,onApply:i}){const[l,c]=p.useState(""),[d,u]=p.useState(""),[f,h]=p.useState(!1),[m,x]=p.useState(""),[g,y]=p.useState(null),[v,b]=p.useState(!1),w=A=>{const P=String(A||"").replace(/\D/g,"");return(P?Number(P)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},_=A=>{if(!A)return 0;const P=String(A).replace(/\./g,"").replace(",","."),F=Number(P);return Number.isFinite(F)?F:0};p.useEffect(()=>{e&&n&&(c(n),u(""),h(!1),x(""),y(null),b(!1))},[e,n]);const j=l&&d&&Number(d)>0?_(l)/Number(d):0,S=(s||[]).filter(A=>{if(!r||A.id===r.id)return!1;if(!m.trim())return!0;const P=m.toLowerCase();return(A.name||"").toLowerCase().includes(P)||(A.code||"").toLowerCase().includes(P)}).slice(0,10),C=g?Number(d||0)+Number(g.stock||0):0;return a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"w-[95vw] sm:max-w-[650px] max-h-[85vh] flex flex-col overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Desmembrar e Unir Produto"}),a.jsx(Hn,{children:"Divida o preo por quantidade e opcionalmente una com outro produto"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-sm font-semibold",children:"1. Desmembrar Preo"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{children:"Valor Total (R$)"}),a.jsx(Ct,{inputMode:"numeric",placeholder:"0,00",value:`R$ ${l||"0,00"}`,onChange:A=>c(w(A.target.value))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{children:"Quantidade de Unidades"}),a.jsx(Ct,{type:"text",inputMode:"numeric",placeholder:"0",value:d,onChange:A=>u(A.target.value.replace(/[^0-9]/g,""))})]}),j>0&&a.jsx("div",{className:"bg-muted/50 border border-border p-3 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Preo Unitrio:"}),a.jsxs("span",{className:"text-lg font-bold",children:["R$ ",j.toFixed(2)]})]})})]}),j>0&&a.jsxs("div",{className:"space-y-3 border-t pt-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Is,{id:"wantToMerge",checked:f,onCheckedChange:A=>{h(!!A),A||(y(null),x(""),b(!1))}}),a.jsx(it,{htmlFor:"wantToMerge",className:"cursor-pointer text-sm font-semibold",children:"2. Unir com outro produto (opcional)"})]}),f&&a.jsxs("div",{className:"space-y-3 ml-6",children:[a.jsx("div",{className:"bg-muted/30 border border-border p-3 rounded-lg",children:a.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.jsx("strong",{children:"Produto atual:"})," ",r?.name," (ser inativado aps unio)"]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{children:"Buscar Produto Destino"}),a.jsx(Ct,{placeholder:"Digite o nome ou cdigo...",value:m,onChange:A=>x(A.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(it,{className:"text-xs",children:["Produtos Disponveis (",S.length,")"]}),a.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:S.length===0?a.jsx("p",{className:"text-xs text-muted-foreground p-2 text-center",children:"Nenhum produto encontrado"}):S.map(A=>a.jsx("div",{onClick:()=>y(A),className:Sr("p-2 rounded-md cursor-pointer border transition-colors",g?.id===A.id?"bg-primary/10 border-primary":"bg-background hover:bg-muted/50 border-transparent"),children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium truncate",children:A.name}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[A.code&&`Cdigo: ${A.code}  `,"Estoque: ",A.stock||0,"  R$ ",Number(A.price||A.salePrice||0).toFixed(2)]})]}),g?.id===A.id&&a.jsx(vi,{className:"w-4 h-4 text-primary flex-shrink-0"})]})},A.id))})]}),g&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"bg-primary/5 border border-primary/20 p-3 rounded-lg",children:[a.jsx("p",{className:"text-xs font-medium mb-1",children:"Resumo da Unio:"}),a.jsxs("div",{className:"text-xs space-y-0.5 text-muted-foreground",children:[a.jsxs("p",{children:[" Destino: ",a.jsx("strong",{children:g.name})]}),a.jsxs("p",{children:[" Estoque atual: ",g.stock||0]}),a.jsxs("p",{children:[" Estoque a somar: +",d]}),a.jsxs("p",{className:"text-primary font-bold",children:[" Novo estoque: ",C]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Is,{id:"updatePrice",checked:v,onCheckedChange:A=>b(!!A)}),a.jsxs(it,{htmlFor:"updatePrice",className:"cursor-pointer text-xs",children:["Atualizar preo do destino para R$ ",j.toFixed(2)]})]})]})]})]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),a.jsx(se,{onClick:()=>{if(j>0){const A=j.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});i(A,d,f?g:null,v)}},disabled:j<=0||f&&!g,children:f&&g?"Desmembrar e Unir":"Aplicar Desmembramento"})]})]})})}function qst({open:e,onOpenChange:t,categories:r,onAddCategory:n,onRemoveCategory:s}){const{toast:o}=Ss(),[i,l]=p.useState(""),[c,d]=p.useState(!1),u=async()=>{const h=i.trim();if(h){if(r.includes(h)){o({title:"Categoria j existe",description:"Escolha outro nome.",variant:"destructive"});return}try{d(!0),await n(h),l(""),o({title:"Categoria adicionada",description:"Ela j aparece na lista.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(m){console.error("[Categorias] add:error",m);const x=Qc(m,{action:"save"});o({title:x.title,description:x.description,variant:"destructive"})}finally{d(!1)}}},f=async h=>{try{d(!0),await s(h),o({title:"Categoria desativada",description:"A categoria foi marcada como inativa.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(m){console.error("[Categorias] remove:error",m);const x=Qc(m,{action:"save"});o({title:x.title,description:x.description,variant:"destructive"})}finally{d(!1)}};return a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"w-[90vw] sm:max-w-[480px]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Gerenciar Categorias"}),a.jsx(Hn,{children:"Adicione ou remova categorias de produtos."})]}),a.jsxs("div",{className:"py-4 space-y-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Ct,{value:i,onChange:h=>l(h.target.value),placeholder:"Nome da nova categoria"}),a.jsx(se,{onClick:u,disabled:c,children:c?"Processando...":"Adicionar"})]}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map(h=>a.jsxs("div",{className:"flex items-center justify-between bg-surface-2 p-2 rounded-md",children:[a.jsx("span",{className:"font-semibold",children:h}),a.jsx(se,{variant:"ghost",size:"icon",className:"h-8 w-8 text-danger/80 hover:text-danger",onClick:()=>f(h),disabled:c,children:a.jsx(Sf,{size:14})})]},h))})]})]})})}function zst(){const{toast:e}=Ss(),{userProfile:t,authReady:r}=qs();wi();const[n,s]=p.useState(Mst),[o,i]=p.useState(Rst),[l,c]=p.useState([]),[d,u]=p.useState("");p.useState("list");const[f,h]=p.useState(!0),[m,x]=p.useState(null),[g,y]=p.useState(!1),[v,b]=p.useState(!1),[w,_]=p.useState("all"),[j,S]=p.useState(""),[C,A]=p.useState({type:"all",category:"all",status:"active",newOnly:!1}),[P,F]=p.useState(!1),[O,I]=p.useState(!1),[T,k]=p.useState(!1),[B,z]=p.useState(null),[U,L]=p.useState({by:"code",dir:"asc"}),W=p.useRef(!0),ge=p.useRef(0),Ae=p.useRef(0);p.useRef(!1);const[V,$]=p.useState(!1),[Y,he]=p.useState("paged"),J=Y==="paged",[G,ue]=p.useState(1),[ve]=p.useState(100),[ae,oe]=p.useState(0);p.useEffect(()=>(W.current=!0,()=>{W.current=!1}),[]),p.useEffect(()=>{try{const ce=localStorage.getItem(mV);if(!ce)return;const Xe=JSON.parse(ce);Xe&&typeof Xe=="object"&&((Xe.listMode==="paged"||Xe.listMode==="all")&&he(Xe.listMode),typeof Xe.showStats=="boolean"&&h(Xe.showStats))}catch{}},[]),p.useEffect(()=>{(async()=>{if(!t?.codigo_empresa||!t?.id&&!t?.user_id)return;const Xe=t.id||t.user_id,Qt=`produtos:${t.codigo_empresa}`,Tt=await ooe({userId:Xe,scope:Qt});Tt&&((Tt.listMode==="paged"||Tt.listMode==="all")&&he(Tt.listMode),typeof Tt.showStats=="boolean"&&h(Tt.showStats))})()},[t?.codigo_empresa,t?.id]),p.useEffect(()=>{try{const ce={listMode:Y,showStats:f};localStorage.setItem(mV,JSON.stringify(ce))}catch{}if(t?.codigo_empresa&&(t?.id||t?.user_id)){const ce=t.id||t.user_id,Xe=`produtos:${t.codigo_empresa}`;ioe({userId:ce,scope:Xe,settings:{listMode:Y,showStats:f}})}},[Y,f,t?.codigo_empresa,t?.id]);const me=async()=>{const ce=t?.codigo_empresa||null;if(!r||!ce)return;const Xe=`produtos:list:${ce}`;F(!0);const Qt=setTimeout(()=>{if(W.current)try{const Tt=JSON.parse(localStorage.getItem(Xe)||"[]");Array.isArray(Tt)&&Tt.length>0&&(console.warn("[Produtos] slow fallback: using cached snapshot"),s(Tt))}catch{}},2e3);try{const Tt=C.status==="all"||C.status==="inactive";let Ar=[];if(J){console.log("[Produtos] refetchProducts - modo paginado - Filtro status:",C.status,"includeInactive:",Tt,"page:",G,"pageSize:",ve);const nr=await ist({includeInactive:Tt,search:j,codigoEmpresa:ce,page:G,pageSize:ve});if(!W.current)return;Ar=nr?.data||[];const Jr=nr?.count||0;console.log("[Produtos] refetchProducts - Produtos carregados (paginado):",Ar.length,"de",Jr),s(Ar),oe(Jr)}else{if(console.log("[Produtos] refetchProducts - modo TODOS - Filtro status:",C.status,"includeInactive:",Tt),Ar=await Hu({includeInactive:Tt,search:j,codigoEmpresa:ce}),!W.current)return;console.log("[Produtos] refetchProducts - Produtos carregados (todos):",Ar.length),s(Ar),oe(Ar.length)}try{localStorage.setItem(Xe,JSON.stringify(Ar))}catch{}Ae.current=Ar.length,ge.current=Date.now()}catch(Tt){console.error("[Produtos] refetchProducts:error",Tt);const Ar=Qc(Tt,{action:"fetch"});e({title:Ar.title,description:Ar.description,variant:"destructive"})}finally{clearTimeout(Qt),F(!1)}};p.useEffect(()=>{const ce=(()=>{try{const nr=localStorage.getItem("auth:userProfile");return nr&&JSON.parse(nr)?.codigo_empresa||null}catch{return null}})(),Xe=t?.codigo_empresa||ce;if(!Xe)return;const Qt=`produtos:list:${Xe}`,Tt=(()=>{try{return JSON.parse(localStorage.getItem(Qt)||"[]")}catch{return[]}})();Array.isArray(Tt)&&Tt.length>0&&(s(Tt),Ae.current=Tt.length);const Ar=async(nr=3)=>{for(let Jr=0;Jr<nr;Jr++)try{if(W.current){await me();break}}catch(gn){console.warn(`[ProdutosPage] Tentativa ${Jr+1} falhou:`,gn),Jr===nr-1?console.error("[ProdutosPage] Todas as tentativas falharam"):await new Promise(tt=>setTimeout(tt,1e3*(Jr+1)))}};try{const nr=JSON.parse(localStorage.getItem(`produtos:cats:${Xe}`)||"[]");Array.isArray(nr)&&nr.length>0&&i(nr)}catch{}if(r&&t?.codigo_empresa){const nr=setTimeout(()=>Ar(),100);return(async()=>{try{const Jr=await fV({codigoEmpresa:t.codigo_empresa});if(!W.current)return;i(Jr);try{localStorage.setItem(`produtos:cats:${t.codigo_empresa}`,JSON.stringify(Jr))}catch{}}catch(Jr){console.error("[Categorias] load on mount:error",Jr)}})(),()=>clearTimeout(nr)}},[r,t?.codigo_empresa]),p.useEffect(()=>{const ce=()=>{(Date.now()-(ge.current||0)>3e4||Ae.current===0)&&me()},Xe=()=>{document.visibilityState==="visible"&&(Date.now()-(ge.current||0)>3e4||Ae.current===0)&&me()};return window.addEventListener("focus",ce),document.addEventListener("visibilitychange",Xe),()=>{window.removeEventListener("focus",ce),document.removeEventListener("visibilitychange",Xe)}},[r,t?.codigo_empresa]),p.useEffect(()=>{ue(1),r&&me()},[C.status,r]),p.useEffect(()=>{const ce=setTimeout(()=>{ue(1),r&&me()},300);return()=>clearTimeout(ce)},[j,r]),p.useEffect(()=>{ue(1),r&&me()},[Y,r]);const[De,ne]=p.useState("N/A");p.useEffect(()=>{let ce=!0;return(async()=>{try{const Xe=await ost({limit:1,codigoEmpresa:t?.codigo_empresa});if(!ce)return;if(Array.isArray(Xe)&&Xe.length>0){const Qt=Xe[0];ne(`${Qt.name} (${Qt.total})`)}else ne("")}catch{ce&&ne("N/A")}})(),()=>{ce=!1}},[t?.codigo_empresa]);const[ie,ht]=p.useState(!1),[pt,Ze]=p.useState(()=>{const ce=new Date;return ce.setHours(0,0,0,0),ce}),[vt,wt]=p.useState(!1),[gt,er]=p.useState(()=>new Date),[_e,Pt]=p.useState(!1),[Lt,gr]=p.useState([]),[fr,je]=p.useState(!1),nt=async()=>{try{Pt(!0);const ce=await sst({from:pt,to:gt,codigoEmpresa:t?.codigo_empresa});gr(ce||[])}catch(ce){e({title:"Falha ao carregar vendas do perodo",description:ce?.message||"Tente novamente",variant:"destructive"})}finally{Pt(!1)}},$t=p.useMemo(()=>{const ce=new Date;return{mostSold:De,lowStock:n.filter(Xe=>Xe.status==="low_stock"||Xe.stock>0&&Xe.stock<=Xe.minStock).length,expired:n.filter(Xe=>Xe.validade&&Xe.validade<ce).length}},[n,De]),Ut=p.useMemo(()=>{const ce=new Date;return n.filter(Xe=>{const Qt=w==="all"?!0:w==="low_stock"?Xe.status==="low_stock"||Xe.stock>0&&Xe.stock<=Xe.minStock:w==="expired"?Xe.validade&&Xe.validade<ce:!1,Tt=C.status==="all"?!0:Xe.status===C.status,Ar=C.type==="all"||Xe.type===C.type,nr=C.category==="all"||Xe.category===C.category,Jr=!C.newOnly||Xe.dataImportacao&&(()=>Math.floor((new Date-Xe.dataImportacao)/864e5)<=7)();return Qt&&Tt&&Ar&&nr&&Jr})},[n,w,C]),Fe=ce=>ce?.dataImportacao?Math.floor((new Date-ce.dataImportacao)/(1e3*60*60*24))<=7:!1,xt=p.useMemo(()=>{const ce=[...Ut],Xe=U.dir==="asc"?1:-1,Qt=(Ar,nr)=>Number.isFinite(Ar)?Ar:nr,Tt=Ar=>{if(!Ar)return NaN;if(Ar instanceof Date)return Ar.getTime();const nr=new Date(Ar);return Number.isNaN(nr.getTime())?NaN:nr.getTime()};return ce.sort((Ar,nr)=>{if(U.by==="code"){const Jr=Qt(parseInt((Ar.code||"").trim(),10),1/0),gn=Qt(parseInt((nr.code||"").trim(),10),1/0);return Jr===gn?0:Jr>gn?Xe:-Xe}if(U.by==="name"){const Jr=(Ar.name||"").toString(),gn=(nr.name||"").toString();return Jr.localeCompare(gn,"pt-BR",{sensitivity:"base"})*Xe}if(U.by==="validade"){const Jr=Qt(Tt(Ar.validade),1/0),gn=Qt(Tt(nr.validade),1/0);return Jr===gn?0:Jr>gn?Xe:-Xe}return 0}),ce},[Ut,U]),Ot=p.useMemo(()=>{if(!ve)return 1;const ce=Math.ceil((ae||0)/ve);return ce>0?ce:1},[ae,ve]),Cr=ce=>{L(Xe=>Xe.by===ce?{by:ce,dir:Xe.dir==="asc"?"desc":"asc"}:{by:ce,dir:"asc"})},Me=ce=>{_(Xe=>Xe===ce?"all":ce)},Qe=()=>{Ze(()=>{const ce=new Date;return ce.setHours(0,0,0,0),ce}),er(new Date),ht(!0),setTimeout(nt,0)},et=(ce,Xe)=>{A(Qt=>({...Qt,[ce]:Xe}))},Yt=async()=>{x(null);const ce=t?.codigo_empresa||null;let Xe="";if(ce)try{Xe=await uV({codigoEmpresa:ce})}catch(Qt){console.error("[Produtos] handleAddNew: falha ao obter prximo cdigo",Qt)}u(Xe||""),y(!0)},xr=ce=>{x(ce),y(!0)},Jt=()=>{try{Lst(xt),e({title:"Exportao concluda",description:`${xt.length} produto(s) exportado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(ce){console.error("[Produtos] export:error",ce);const Xe=Qc(ce,{action:"export"});e({title:Xe.title,description:Xe.description,variant:"destructive"})}},kr=ce=>{c(Xe=>Xe.includes(ce)?Xe.filter(Qt=>Qt!==ce):[...Xe,ce])},_r=()=>{const ce=xt.map(Xe=>Xe.id);ce.length&&c(ce)},Rr=()=>{c([])},nn=ce=>{ce?_r():Rr()},rn=p.useMemo(()=>xt.filter(ce=>l.includes(ce.id)),[xt,l]),Ke=p.useMemo(()=>rn.some(Fe),[rn]),qe=async ce=>{if(l.length)try{await lst({ids:l,status:ce}),await me(),Rr(),e({title:ce==="inactive"?"Produtos inativados":"Produtos atualizados",description:`${l.length} produto(s) atualizado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(Xe){const Qt=Qc(Xe,{action:"save"});e({title:Qt.title,description:Qt.description,variant:"destructive"})}},ze=async()=>{if(!(!l.length||!Ke))try{await cst({ids:l}),await me(),Rr(),e({title:"Novos removidos",description:"A etiqueta de novo foi removida dos produtos selecionados.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(ce){const Xe=Qc(ce,{action:"save"});e({title:Xe.title,description:Xe.description,variant:"destructive"})}},Je=async()=>{const ce=t?.codigo_empresa||null;if(!(!r||!ce))try{const Xe=await fV({codigoEmpresa:ce});if(!W.current)return;i(Xe);try{localStorage.setItem(`produtos:cats:${ce}`,JSON.stringify(Xe))}catch{}}catch(Xe){console.error("[Categorias] load on mount:error",Xe)}},kt=async ce=>{i(Xe=>{if(Xe.includes(ce))return Xe;const Qt=[...Xe,ce];return Qt.sort((Tt,Ar)=>Tt.localeCompare(Ar,"pt-BR")),Qt});try{await dst(ce,{codigoEmpresa:t?.codigo_empresa}),await Je()}catch(Xe){i(Tt=>Tt.filter(Ar=>Ar!==ce)),console.error("[Categorias] add:error",Xe);const Qt=Qc(Xe,{action:"save"});e({title:Qt.title,description:Qt.description,variant:"destructive"})}},ct=async ce=>{if(n.some(Tt=>Tt.category===ce&&Tt.status!=="inactive"))throw new Error("Categoria possui produtos ativos vinculados");const Qt=o;i(Tt=>Tt.filter(Ar=>Ar!==ce));try{await ust(ce,{codigoEmpresa:t?.codigo_empresa}),await Je()}catch(Tt){i(Qt),console.error("[Categorias] remove:error",Tt);const Ar=Qc(Tt,{action:"save"});e({title:Ar.title,description:Ar.description,variant:"destructive"})}},tr=async ce=>{try{if(console.log("[Produtos] handleSaveProduct",ce),!ce||typeof ce!="object"){console.warn("[Produtos] handleSaveProduct chamado sem payload vlido. Ignorando.");return}const Xe=t?.codigo_empresa||null;if(!ce.code&&Xe)try{const Tt=await uV({codigoEmpresa:Xe});ce.code=Tt}catch(Tt){console.error("[Produtos] Falha ao obter prximo cdigo automtico",Tt)}const Qt=async Tt=>{const nr=new Promise((Jr,gn)=>setTimeout(()=>gn(new Error("Timeout update/create (12s)")),12e3));return Promise.race([Tt,nr])};if(ce.id){const Tt=await Qt(L1(ce.id,ce,{codigoEmpresa:Xe}));console.log("[Produtos] Produto atualizado - active:",Tt.active,"status:",Tt.status),s(Ar=>Ar.map(nr=>nr.id===Tt.id?Tt:nr)),await me(),console.log("[Produtos] Refetch concludo aps update")}else{ce.dataImportacao||(ce.dataImportacao=new Date);const Tt=await Qt(lC(ce,{codigoEmpresa:Xe}));console.log("[Produtos] Produto criado",Tt),s(Ar=>[Tt,...Ar]),setTimeout(()=>{me().catch(Ar=>console.error("[Produtos] refetch ps-create falhou",Ar))},0)}}catch(Xe){console.error("[Produtos] Erro no handleSaveProduct",Xe);const Qt=Qc(Xe,{action:"save"});throw e({title:Qt.title,description:Qt.description,variant:"destructive"}),Xe}},dt=ce=>{z(ce),I(!0)},Mt=async()=>{if(B?.id)try{k(!0),await yF(B.id),s(Xe=>Xe.filter(Qt=>Qt.id!==B.id)),await me();const ce=Qc(null,{action:"delete"});e({variant:"success",title:ce.title,description:`Produto "${B.name}" foi inativado com sucesso.`})}catch(ce){const Xe=Qc(ce,{action:"delete"});e({variant:"destructive",...Xe})}finally{k(!1),I(!1),z(null)}};return a.jsxs(a.Fragment,{children:[a.jsxs(Er.div,{variants:Fst,initial:"hidden",animate:"visible",className:"flex flex-col",children:[a.jsxs(Er.div,{variants:$3,className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-black text-text-primary tracking-tighter",children:"Controle de Produtos"}),a.jsx("p",{className:"text-text-secondary hidden md:block",children:"Controle total sobre seu inventrio e estoque."})]}),a.jsx(se,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full hidden md:flex items-center justify-center",onClick:()=>$(!0),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(fd,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"hidden md:flex items-center gap-2 flex-wrap",children:[a.jsx(se,{variant:"outline",size:"icon",onClick:()=>h(ce=>!ce),title:f?"Ocultar resumo":"Mostrar resumo","aria-label":f?"Ocultar resumo":"Mostrar resumo",children:f?a.jsx(jg,{className:"h-4 w-4"}):a.jsx(zg,{className:"h-4 w-4"})}),a.jsxs(se,{variant:"outline",onClick:Jt,children:[a.jsx(ks,{className:"mr-2 h-4 w-4"})," Exportar"]}),a.jsxs(se,{variant:"secondary",onClick:()=>wt(!0),children:[a.jsx(Vi,{className:"mr-2 h-4 w-4"})," Importar XML"]}),a.jsxs(se,{onClick:Yt,children:[a.jsx(Es,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]}),a.jsxs("div",{className:"mt-2 flex md:hidden items-center gap-2",children:[a.jsxs(se,{variant:"outline",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:Jt,title:"Exportar CSV","aria-label":"Exportar CSV",children:[a.jsx(ks,{className:"h-4 w-4"}),a.jsx("span",{children:"CSV"})]}),a.jsxs(se,{variant:"secondary",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:()=>wt(!0),title:"Importar XML","aria-label":"Importar XML",children:[a.jsx(Vi,{className:"h-4 w-4"}),a.jsx("span",{children:"XML"})]}),a.jsxs(se,{className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:Yt,title:"Novo Produto","aria-label":"Novo Produto",children:[a.jsx(Es,{className:"h-4 w-4"}),a.jsx("span",{children:"Prod"})]}),a.jsxs(se,{variant:"outline",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:()=>b(!0),title:"Gerenciar categorias","aria-label":"Gerenciar categorias",children:[a.jsx(i_,{className:"h-4 w-4"}),a.jsx("span",{children:"Cat."})]}),a.jsx(se,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-xl flex items-center justify-center ml-auto",onClick:()=>$(!0),title:"Configuraes da aba","aria-label":"Configuraes da aba",children:a.jsx(fd,{className:"h-4 w-4"})}),a.jsx(se,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-xl flex items-center justify-center ml-auto",onClick:()=>h(ce=>!ce),title:f?"Ocultar resumo":"Mostrar resumo","aria-label":f?"Ocultar resumo":"Mostrar resumo",children:f?a.jsx(jg,{className:"h-5 w-5"}):a.jsx(zg,{className:"h-5 w-5"})})]})]}),f&&a.jsxs("div",{className:"grid grid-cols-3 gap-3 md:gap-6 mb-6",children:[a.jsx(Pk,{icon:sd,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Mais Vendido (Dia)"}),a.jsx("span",{className:"md:hidden",children:"+ vendidos"})]}),value:$t.mostSold,subtitle:"Produto com mais sadas hoje",color:"text-brand",onClick:Qe}),a.jsx(Pk,{icon:Df,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Estoque Baixo"}),a.jsx("span",{className:"md:hidden",children:"Est. baixo"})]}),value:$t.lowStock,subtitle:"Produtos precisando de reposio",color:"text-warning",onClick:()=>Me("low_stock"),isActive:w==="low_stock"}),a.jsx(Pk,{icon:wj,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Vendidos"}),a.jsx("span",{className:"md:hidden",children:"Vencidos"})]}),value:$t.expired,subtitle:"Produtos fora da data de validade",color:"text-danger",onClick:()=>Me("expired"),isActive:w==="expired"})]}),a.jsx(In,{open:ie,onOpenChange:ht,children:a.jsxs(En,{className:"max-w-2xl",onKeyDown:ce=>ce.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold",children:"Vendas por Perodo"}),a.jsx(Hn,{children:"Selecione o intervalo de datas e visualize os produtos vendidos."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Incio"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:"w-full justify-start",children:[a.jsx(wj,{className:"mr-2 h-4 w-4"}),pt?sr(pt,"dd/MM/yyyy"):"Incio"]})}),a.jsx(Go,{className:"p-0 w-[300px]",children:a.jsx("div",{className:"w-[300px] min-h-[332px]",children:a.jsx(oi,{mode:"single",selected:pt,onSelect:ce=>ce&&Ze(ce),initialFocus:!0,fixedWeeks:!0})})})]})]}),a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Fim"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:"w-full justify-start",children:[a.jsx(wj,{className:"mr-2 h-4 w-4"}),gt?sr(gt,"dd/MM/yyyy"):"Fim"]})}),a.jsx(Go,{className:"p-0 w-[300px]",children:a.jsx("div",{className:"w-[300px] min-h-[332px]",children:a.jsx(oi,{mode:"single",selected:gt,onSelect:ce=>ce&&er(ce),initialFocus:!0,fixedWeeks:!0})})})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{type:"button",onClick:nt,disabled:_e,className:"w-full",children:_e?"Carregando...":"Aplicar"}),a.jsx(se,{type:"button",variant:"secondary",onClick:()=>{try{const ce=Lt||[],Xe=";",Qt=()=>{const Jr=["Produto;Quantidade"];for(const gn of ce)Jr.push(`${(gn.name||"").replace(/;/g,",")}${Xe}${Number(gn.total||0)}`);return Jr.join(`
`)},Tt=new Blob(["\uFEFF"+Qt()],{type:"text/csv;charset=utf-8;"}),Ar=URL.createObjectURL(Tt),nr=document.createElement("a");nr.href=Ar,nr.download="vendas-periodo.csv",document.body.appendChild(nr),nr.click(),document.body.removeChild(nr),URL.revokeObjectURL(Ar),e({title:"Exportao concluda",description:`${ce.length} linha(s)`,variant:"success"})}catch(ce){e({title:"Falha ao exportar",description:ce?.message||"Tente novamente",variant:"destructive"})}},children:"Exportar CSV"})]})]}),a.jsx("div",{className:"mt-3 border rounded-md max-h-[50vh] overflow-auto thin-scroll",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-surface-2",children:[a.jsx("th",{className:"text-left p-2",children:"Produto"}),a.jsx("th",{className:"text-right p-2",children:"Quantidade"})]})}),a.jsxs("tbody",{children:[(Lt||[]).length===0&&!_e&&a.jsx("tr",{children:a.jsx("td",{colSpan:2,className:"p-3 text-text-muted",children:"Nenhum item no perodo."})}),(Lt||[]).map(ce=>a.jsxs("tr",{className:"border-t border-border",children:[a.jsx("td",{className:"p-2",children:ce.name}),a.jsx("td",{className:"p-2 text-right font-mono",children:Number(ce.total||0)})]},ce.id))]})]})}),a.jsx(Na,{children:a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",children:"Fechar"})})})]})}),a.jsx(In,{open:V,onOpenChange:$,children:a.jsxs(En,{className:"max-w-2xl",children:[a.jsx(Cn,{children:a.jsx(Nn,{children:"Configuraes da aba"})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[11px] font-medium text-text-muted",children:"Modo de listagem"}),a.jsxs(Gn,{value:Y,onValueChange:he,children:[a.jsx(Vn,{className:"w-[200px] h-8 text-xs",children:a.jsx(Kn,{placeholder:"Paginado"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"paged",children:"Paginado (100 por pgina)"}),a.jsx(lt,{value:"all",children:"Todos (sem paginao)"})]})]})]}),a.jsx("div",{className:"flex items-center justify-between pt-1",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Is,{id:"produtos-show-stats",checked:f,onCheckedChange:h}),a.jsx("label",{htmlFor:"produtos-show-stats",className:"text-xs font-medium text-text-primary",children:"Mostrar cards de resumo no topo"})]})})]}),a.jsx(Na,{children:a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",children:"Fechar"})})})]})}),a.jsxs(Er.div,{variants:$3,className:"bg-surface rounded-lg border border-border flex flex-col",children:[a.jsxs("div",{className:"p-3 pb-4 sm:p-4 border-b border-border space-y-3 flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar por nome ou cdigo...",className:"pl-9 text-sm",value:j,onChange:ce=>S(ce.target.value)})]}),a.jsx(se,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex md:hidden items-center justify-center",onClick:()=>je(!0),"aria-label":"Abrir filtros",title:"Filtros",children:a.jsx(zI,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"hidden md:flex w-full items-center gap-3",children:[a.jsx("div",{className:"flex-1 min-w-[120px]",children:a.jsxs(Gn,{value:C.type,onValueChange:ce=>et("type",ce),children:[a.jsx(Vn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Tipos"}),a.jsx(lt,{value:"Venda",children:"Venda"}),a.jsx(lt,{value:"Uso Interno",children:"Uso Interno"})]})]})}),a.jsx("div",{className:"flex-1 min-w-[140px]",children:a.jsxs(Gn,{value:C.category,onValueChange:ce=>et("category",ce),children:[a.jsx(Vn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Categorias"}),o.map(ce=>a.jsx(lt,{value:ce,children:ce},ce))]})]})}),a.jsx("div",{className:"flex-1 max-w-[180px]",children:a.jsxs(Gn,{value:C.status,onValueChange:ce=>et("status",ce),children:[a.jsx(Vn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Status"}),a.jsx(lt,{value:"active",children:"Ativo"}),a.jsx(lt,{value:"low_stock",children:"Estoque Baixo"}),a.jsx(lt,{value:"inactive",children:"Inativo"})]})]})}),a.jsxs("div",{className:"flex-1 flex justify-end gap-2 min-w-[160px]",children:[a.jsxs(se,{variant:"outline",onClick:()=>et("newOnly",!C.newOnly),className:Sr("text-xs sm:text-sm rounded-full px-3 border border-border bg-surface-2 hover:bg-surface flex items-center gap-1 whitespace-nowrap",C.newOnly&&"bg-amber-500 text-black border-amber-500 hover:bg-amber-400"),size:"sm",children:[a.jsx("span",{className:"mr-1",children:""}),a.jsx("span",{children:"Novos"})]}),a.jsxs(se,{variant:"outline",onClick:()=>b(!0),className:"text-xs sm:text-sm rounded-full px-3 border border-border bg-surface-2 hover:bg-surface flex items-center gap-1 whitespace-nowrap",size:"sm",children:[a.jsx(i_,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.jsx("span",{children:"Categorias"})]}),a.jsx(se,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex items-center justify-center",onClick:()=>$(ce=>!ce),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(fd,{className:"h-4 w-4"})})]})]})]}),l.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"px-3 sm:px-4 py-2.5 border-b border-border flex md:hidden items-center gap-2 text-xs",children:[a.jsxs("span",{className:"font-medium mr-2",children:[l.length," sel."]}),a.jsxs("button",{type:"button",className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border bg-surface-2",onClick:()=>{const ce=xt.length>0&&xt.every(Xe=>l.includes(Xe.id));nn(!ce)},children:[a.jsx(Is,{checked:xt.length>0&&xt.every(ce=>l.includes(ce.id)),className:"h-4 w-4"}),a.jsx("span",{children:"Todos"})]}),a.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[a.jsx(se,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>qe("active"),children:a.jsx(vi,{className:"h-4 w-4"})}),a.jsx(se,{variant:"outline",size:"icon",className:"h-8 w-8 text-danger border-danger/60 hover:bg-danger/10",onClick:()=>qe("inactive"),children:a.jsx(Sf,{className:"h-4 w-4"})}),Ke&&a.jsx(se,{variant:"outline",size:"icon",className:"h-8 w-8 border-amber-500/70 text-amber-700 hover:bg-amber-500/10",onClick:ze,children:a.jsx(i_,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"hidden md:flex px-4 py-2 border-b border-border items-center gap-3 text-xs",children:[a.jsx("span",{className:"font-medium text-text-secondary whitespace-nowrap",children:l.length===0?"Nenhum item selecionado":`${l.length} produto${l.length>1?"s":""} selecionado${l.length>1?"s":""}`}),a.jsxs("div",{className:"flex flex-1 flex-wrap items-center justify-end gap-2",children:[a.jsxs(se,{variant:"outline",size:"xs",className:"h-7 px-3 rounded-full border border-border bg-surface-2 hover:bg-surface flex items-center gap-1",onClick:_r,children:[a.jsx(vi,{className:"h-3 w-3"}),a.jsx("span",{children:"Marcar filtrados"})]}),a.jsxs(se,{variant:"outline",size:"xs",className:"h-7 px-3 rounded-full border border-border bg-surface-2 hover:bg-surface flex items-center gap-1",onClick:Rr,children:[a.jsx(zI,{className:"h-3 w-3"}),a.jsx("span",{children:"Limpar seleo"})]}),a.jsxs(se,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full border-emerald-500/70 text-emerald-300 bg-emerald-500/10 hover:bg-emerald-500/20 flex items-center gap-1",onClick:()=>qe("active"),children:[a.jsx(vi,{className:"h-3 w-3"}),a.jsx("span",{children:"Ativar itens"})]}),a.jsxs(se,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full text-danger border-danger/60 hover:bg-danger/10 flex items-center gap-1",onClick:()=>qe("inactive"),children:[a.jsx(jg,{className:"h-3 w-3"}),a.jsx("span",{children:"Desativar itens"})]}),Ke&&a.jsxs(se,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full border-amber-500/70 text-amber-500 hover:bg-amber-500/10 flex items-center gap-1",onClick:ze,children:[a.jsx(i_,{className:"h-3 w-3"}),a.jsx("span",{children:'Limpar tag "Novo"'})]})]})]})]}),a.jsx("div",{children:xt.length===0?a.jsxs("div",{className:"p-10 text-center text-text-secondary",children:[a.jsx("p",{className:"text-lg mb-3",children:"Nenhum produto cadastrado."}),a.jsxs(se,{onClick:Yt,children:[a.jsx(Es,{className:"mr-2 h-4 w-4"}),"Cadastrar primeiro produto"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden p-3 space-y-3",children:xt.map(ce=>{const Xe=l.includes(ce.id);return a.jsxs("div",{className:Sr("rounded-lg border bg-surface p-4 space-y-3 cursor-pointer",Xe?"border-brand/70 bg-brand/5":"border-border"),onClick:()=>xr(ce),children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsx("button",{type:"button",className:"pt-1 pr-2 -ml-1 flex items-center justify-center w-9 h-9",onClick:Qt=>{Qt.stopPropagation(),kr(ce.id)},children:a.jsx(Is,{checked:Xe,className:"h-5 w-5 border-2"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-semibold text-base text-text-primary truncate",title:ce.name,children:ce.name}),ce.dataImportacao&&(()=>Math.floor((new Date-ce.dataImportacao)/864e5)<=7?a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand text-xs font-medium flex-shrink-0",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Novo"})]}):null)()]}),a.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:ce.category||"Sem categoria"})]}),a.jsx("span",{className:Sr("inline-flex px-2 py-0.5 rounded-full text-xs border flex-shrink-0",ce.status==="active"&&"bg-emerald-50/5 border-emerald-500/30 text-emerald-400",ce.status==="low_stock"&&"bg-amber-50/5 border-amber-500/30 text-amber-400",ce.status==="inactive"&&"bg-surface-2 border-border text-text-muted"),children:ce.status==="active"?"Ativo":ce.status==="low_stock"?"Estoque Baixo":"Inativo"})]}),a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-text-muted",children:[ce.code&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Cd."}),a.jsx("span",{className:"font-mono text-text-primary text-xs",children:ce.code})]}),a.jsx("span",{className:"mx-1 text-text-muted",children:""}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"R$"}),a.jsx("span",{className:"font-semibold text-text-primary",children:ce.price.toFixed(2)})]}),a.jsx("span",{className:"mx-1 text-text-muted",children:""}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Est."}),a.jsx("span",{className:"font-medium text-text-primary",children:ce.stock})]}),ce.validade&&a.jsx("span",{className:"mx-1 text-text-muted",children:""}),ce.validade&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Val."}),a.jsx("span",{className:"text-text-primary",children:(()=>{const Qt=ce.validade instanceof Date?ce.validade:x8(String(ce.validade));return isNaN(Qt)?"-":sr(Qt,"dd/MM/yy")})()})]}),a.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[a.jsx(se,{variant:"outline",size:"icon",onClick:Qt=>{Qt.stopPropagation(),xr(ce)},className:"h-7 w-7",children:a.jsx(ec,{className:"h-3.5 w-3.5"})}),a.jsx(se,{variant:"outline",size:"icon",onClick:Qt=>{Qt.stopPropagation(),dt(ce)},className:"h-7 w-7 text-danger hover:text-danger",children:a.jsx(Sf,{className:"h-3.5 w-3.5"})})]})]})]},ce.id)})}),a.jsx("div",{className:"hidden md:block rounded-lg border border-border overflow-hidden",children:a.jsxs("table",{className:"w-full text-sm bg-surface table-fixed",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{className:"border-b border-border",children:[a.jsx("th",{className:"p-3 w-10 text-center",children:a.jsx(Is,{checked:xt.length>0&&xt.every(ce=>l.includes(ce.id)),onCheckedChange:ce=>nn(!!ce)})}),a.jsxs("th",{className:"p-3 text-left font-semibold select-none cursor-pointer whitespace-nowrap w-[110px]",onClick:()=>Cr("code"),children:["Cdigo ",U.by==="code"?U.dir==="asc"?"":"":""]}),a.jsxs("th",{className:"p-3 text-left font-semibold select-none cursor-pointer whitespace-nowrap w-[40%]",onClick:()=>Cr("name"),children:["Produto ",U.by==="name"?U.dir==="asc"?"":"":""]}),a.jsx("th",{className:"p-3 text-left font-semibold whitespace-nowrap w-[18%]",children:"Categoria"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[120px]",children:"Preo"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[110px]",children:"Estoque"}),a.jsxs("th",{className:"p-3 text-center font-semibold select-none cursor-pointer whitespace-nowrap w-[120px]",onClick:()=>Cr("validade"),children:["Validade ",U.by==="validade"?U.dir==="asc"?"":"":""]}),a.jsx("th",{className:"p-3 text-center font-semibold whitespace-nowrap w-[140px]",children:"Status"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[90px]",children:"Aes"})]})}),a.jsx("tbody",{className:"text-text-primary divide-y divide-border",children:xt.map(ce=>a.jsxs("tr",{className:"hover:bg-surface-2 transition-colors group cursor-pointer align-middle",children:[a.jsx("td",{className:"p-3 text-center align-middle",children:a.jsx(Is,{checked:l.includes(ce.id),onCheckedChange:()=>kr(ce.id)})}),a.jsx("td",{className:"p-3 font-mono text-sm text-text-secondary align-middle whitespace-nowrap",onClick:()=>xr(ce),children:ce.code||"-"}),a.jsx("td",{className:"p-3 font-semibold align-middle text-text-primary whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>xr(ce),title:ce.name,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"truncate",children:ce.name}),ce.dataImportacao&&(()=>Math.floor((new Date-ce.dataImportacao)/864e5)<=7?a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand text-xs font-medium flex-shrink-0",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Novo"})]}):null)()]})}),a.jsx("td",{className:"p-3 text-text-secondary align-middle whitespace-nowrap",onClick:()=>xr(ce),children:ce.category}),a.jsxs("td",{className:"p-3 text-right font-mono tabular-nums align-middle whitespace-nowrap",onClick:()=>xr(ce),children:["R$ ",ce.price.toFixed(2)]}),a.jsx("td",{className:"p-3 text-right font-mono tabular-nums align-middle whitespace-nowrap",onClick:()=>xr(ce),children:ce.stock}),a.jsx("td",{className:"p-3 text-center font-mono tabular-nums whitespace-nowrap",onClick:()=>xr(ce),children:(()=>{if(!ce.validade)return"-";const Xe=ce.validade instanceof Date?ce.validade:x8(String(ce.validade));return isNaN(Xe)?"-":sr(Xe,"dd/MM/yy")})()}),a.jsx("td",{className:"p-3 text-center whitespace-nowrap",onClick:()=>xr(ce),children:a.jsx("span",{className:Sr("px-2 py-1 text-xs font-bold rounded-full",ce.status==="active"&&"bg-success/10 text-success",ce.status==="low_stock"&&"bg-warning/10 text-warning",ce.status==="inactive"&&"bg-danger/10 text-danger"),children:ce.status==="active"?"Ativo":ce.status==="low_stock"?"Estoque Baixo":"Inativo"})}),a.jsx("td",{className:"p-3 whitespace-nowrap",children:a.jsx("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(se,{variant:"ghost",size:"icon",className:"h-8 w-8 text-text-muted hover:text-danger",onClick:Xe=>{Xe.stopPropagation(),dt(ce)},children:a.jsx(Sf,{size:14})})})})]},ce.id))})]})})]})}),J&&a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-2 text-xs sm:text-sm text-text-muted px-3 sm:px-4 pb-3",children:[a.jsxs("span",{children:["Pgina ",G," de ",Ot," (",ae," produto(s))"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>ue(ce=>Math.max(1,ce-1)),disabled:G<=1,children:"Anterior"}),a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>ue(ce=>Math.min(Ot,ce+1)),disabled:G>=Ot,children:"Prxima"})]})]})]})]}),a.jsx($st,{open:g,onOpenChange:y,product:m,categories:o,onSave:tr,onCreateCategory:kt,suggestedCode:m?void 0:d,onRefreshProducts:me,products:n}),a.jsx(In,{open:O,onOpenChange:I,children:a.jsxs(En,{className:"sm:max-w-[480px]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Excluir produto"}),a.jsxs(Hn,{children:["Tem certeza que deseja excluir o produto",B?` "${B.name}"`:"","? Esta ao no pode ser desfeita."]})]}),a.jsxs(Na,{children:[a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",disabled:T,children:"Cancelar"})}),a.jsx(se,{type:"button",variant:"destructive",onClick:Mt,disabled:T,children:T?"Excluindo...":"Excluir"})]})]})}),a.jsx(Dst,{open:vt,onOpenChange:wt,products:n,codigoEmpresa:t?.codigo_empresa,onSuccess:()=>{me(),wt(!1)}}),a.jsx(In,{open:fr,onOpenChange:je,children:a.jsxs(En,{className:"w-[90vw] sm:max-w-[420px]",children:[a.jsx(Cn,{children:a.jsx(Nn,{className:"text-base",children:"Filtros de Produtos"})}),a.jsxs("div",{className:"space-y-3 py-2 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(it,{className:"text-xs",children:"Tipo"}),a.jsxs(Gn,{value:C.type,onValueChange:ce=>et("type",ce),children:[a.jsx(Vn,{className:"text-xs",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todos"}),a.jsx(lt,{value:"Venda",children:"Venda"}),a.jsx(lt,{value:"Uso Interno",children:"Uso Interno"})]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(it,{className:"text-xs",children:"Categoria"}),a.jsxs(Gn,{value:C.category,onValueChange:ce=>et("category",ce),children:[a.jsx(Vn,{className:"text-xs",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todas"}),o.map(ce=>a.jsx(lt,{value:ce,children:ce},ce))]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(it,{className:"text-xs",children:"Status"}),a.jsxs(Gn,{value:C.status,onValueChange:ce=>et("status",ce),children:[a.jsx(Vn,{className:"text-xs",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todos"}),a.jsx(lt,{value:"active",children:"Ativo"}),a.jsx(lt,{value:"low_stock",children:"Estoque Baixo"}),a.jsx(lt,{value:"inactive",children:"Inativo"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[a.jsx(Is,{id:"mobileNewOnly",checked:!!C.newOnly,onCheckedChange:ce=>et("newOnly",!!ce)}),a.jsx(it,{htmlFor:"mobileNewOnly",className:"text-xs flex items-center gap-1",children:a.jsx("span",{children:"Somente Novos"})})]})]}),a.jsxs(Na,{className:"flex justify-between mt-2",children:[a.jsx(se,{type:"button",variant:"outline",size:"sm",className:"text-xs",onClick:()=>{A({type:"all",category:"all",status:"active",newOnly:!1}),je(!1)},children:"Limpar"}),a.jsx(se,{type:"button",size:"sm",className:"text-xs",onClick:()=>je(!1),children:"Aplicar"})]})]})}),a.jsx(qst,{open:v,onOpenChange:b,categories:o,onAddCategory:kt,onRemoveCategory:ct})]})}function Ust({purchase:e,items:t,onClose:r,onEdit:n,onReprocess:s,onDownloadXML:o,onInactivate:i}){if(!e)return null;const l=t.reduce((d,u)=>d+Number(u.valor_total||0),0),c=d=>d?.data_importacao?qwe(new Date,new Date(d.data_importacao))<=7:!1;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-3 py-4 bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"relative w-[95vw] sm:w-full sm:max-w-4xl max-h-[85vh] bg-surface rounded-xl shadow-2xl border border-border overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"relative bg-surface border-b border-border p-4",children:[a.jsx("button",{onClick:r,className:"absolute top-3 right-3 p-1.5 hover:bg-surface-2 rounded-lg transition-colors",children:a.jsx(lc,{className:"h-4 w-4 text-text-muted"})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4 pr-0 sm:pr-10",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 bg-brand/10 rounded-lg",children:a.jsx(Vi,{className:"h-5 w-5 text-brand"})}),a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-bold text-text-primary mb-0.5",children:["NF-e ",e.numero_nfe,e.serie_nfe&&` / Srie ${e.serie_nfe}`]}),a.jsx("p",{className:"text-text-muted text-xs",children:e.natureza_operacao||"Nota Fiscal Eletrnica"})]})]}),a.jsxs("div",{className:"mt-3 sm:mt-0 sm:text-right",children:[a.jsx("p",{className:"text-text-muted text-xs mb-0.5",children:"Valor Total"}),a.jsxs("p",{className:"text-xl sm:text-2xl font-bold text-success whitespace-nowrap",children:["R$ ",Number(e.valor_total||0).toFixed(2)]})]})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-6",children:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-surface-2 rounded-lg border border-border p-4",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a.jsx(xf,{className:"h-4 w-4 text-brand"})}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-0.5",children:"Fornecedor"}),a.jsx("p",{className:"font-semibold text-base text-text-primary leading-snug break-words",children:e.fornecedor?.nome||"No identificado"}),e.fornecedor?.cnpj&&a.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:["CNPJ: ",e.fornecedor.cnpj]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-5 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(lo,{className:"h-3.5 w-3.5 text-info"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Emisso"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.data_emissao?sr(new Date(e.data_emissao),"dd/MM/yyyy",{locale:ga}):"No informada"})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(nfe,{className:"h-3.5 w-3.5 text-warning"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Operao"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.tipo_operacao||"Entrada"})]}),e.forma_pagamento&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(Nh,{className:"h-3.5 w-3.5 text-success"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Pagamento"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.forma_pagamento})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-1",children:"Valor dos Produtos"}),a.jsxs("p",{className:"font-semibold text-text-primary",children:["R$ ",l.toFixed(2)]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-1",children:"Valor Total NF-e"}),a.jsxs("p",{className:"font-semibold text-brand",children:["R$ ",Number(e.valor_total||0).toFixed(2)]})]})]})]})}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-base font-semibold text-text-primary flex items-center gap-2 mb-3",children:[a.jsx(su,{className:"h-4 w-4 text-brand"}),"Produtos da NF-e",a.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-brand/10 text-brand font-medium ml-2",children:t.length})]}),a.jsx("div",{className:"space-y-2",children:t.map((d,u)=>a.jsx("div",{className:"p-3 bg-surface-2 rounded-lg border border-border hover:border-brand/30 transition-colors",children:a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-brand/10 text-brand text-xs font-bold flex items-center justify-center mt-0.5",children:u+1}),a.jsxs("div",{className:"flex-1",children:[d.produto?.nome?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"font-medium text-base text-text-primary mb-0.5",children:["Produto atual: ",d.produto.nome]}),d.nome_produto_xml&&a.jsxs("p",{className:"text-xs text-text-muted mb-1",children:["XML original: ",a.jsx("span",{className:"font-medium text-text-primary",children:d.nome_produto_xml})]})]}):a.jsx("p",{className:"font-medium text-sm text-text-primary mb-1",children:d.nome_produto_xml}),a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-0.5 text-xs text-text-muted mb-1.5",children:[(d.produto?.codigo_produto||d.codigo_produto_xml)&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"Cd:"})," ",d.produto?.codigo_produto||d.codigo_produto_xml]}),d.ean_xml&&d.ean_xml!=="SEM GTIN"&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"EAN:"})," ",d.ean_xml]}),d.ncm_xml&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"NCM:"})," ",d.ncm_xml]}),d.unidade_xml&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"Un:"})," ",d.unidade_xml]}),d.produto&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-success/20 text-success font-medium",children:" Cadastrado"}),d.produto&&c(d.produto)&&a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand font-medium",children:[a.jsx(UI,{className:"h-3 w-3"}),"Novo"]}),d.vinculado_manualmente&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-warning/20 text-warning font-medium",children:" Vinculado"}),!d.produto&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-text-muted/20 text-text-muted font-medium",children:" No importado"})]})]})]})}),a.jsxs("div",{className:"flex-shrink-0 text-right",children:[a.jsxs("div",{className:"mb-1.5",children:[a.jsx("span",{className:"text-xs text-text-muted mr-1",children:"Qtd:"}),a.jsx("span",{className:"font-bold text-base text-warning",children:d.quantidade})]}),a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit: ",a.jsxs("span",{className:"font-semibold text-success",children:["R$ ",Number(d.valor_unitario||0).toFixed(2)]})]}),a.jsxs("p",{className:"text-sm font-bold text-text-primary",children:["Total: R$ ",Number(d.valor_total||0).toFixed(2)]})]})]})]})},u))})]}),e.chave_nfe&&a.jsxs("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("p",{className:"text-xs font-medium text-text-muted mb-1.5 flex items-center gap-1.5",children:[a.jsx(Vi,{className:"h-3 w-3"}),"Chave de Acesso NF-e:"]}),a.jsx("p",{className:"font-mono text-xs text-text-primary break-all leading-relaxed select-all",children:e.chave_nfe})]})]})}),a.jsxs("div",{className:"p-3 sm:p-4 bg-surface-2 border-t border-border flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsx("div",{className:"flex flex-wrap gap-2",children:e.ativo&&a.jsxs(a.Fragment,{children:[a.jsxs(se,{onClick:()=>n?.(e),size:"sm",variant:"outline",className:"gap-2",children:[a.jsx(ec,{className:"h-4 w-4"}),"Editar"]}),a.jsxs(se,{onClick:()=>s?.(e),size:"sm",variant:"outline",className:"gap-2",disabled:!e.xml_completo,children:[a.jsx(Ng,{className:"h-4 w-4"}),"Reprocessar"]}),e.xml_completo&&a.jsx(a.Fragment,{children:a.jsxs(se,{onClick:()=>o?.(e),size:"sm",variant:"outline",className:"gap-2",children:[a.jsx(ks,{className:"h-4 w-4"}),"XML"]})}),a.jsxs(se,{onClick:()=>i?.(e),size:"sm",variant:"outline",className:"gap-2 text-destructive hover:text-destructive",children:[a.jsx(Sf,{className:"h-4 w-4"}),"Inativar"]})]})}),a.jsx(se,{onClick:r,variant:"outline",className:"w-full sm:w-auto",children:"Fechar"})]})]})})}function Vst({open:e,onOpenChange:t,purchase:r,products:n,codigoEmpresa:s,onSuccess:o,autoFile:i}){const{toast:l}=Ss(),[c,d]=p.useState("upload"),[u,f]=p.useState(null),[h,m]=p.useState(null),[x,g]=p.useState([]),[y,v]=p.useState(!1),[b,w]=p.useState({created:0,updated:0,errors:0,details:[]}),[_,j]=p.useState({}),[S,C]=p.useState({}),[A,P]=p.useState({}),[F,O]=p.useState({isOpen:!1,productIndex:null,currentProduct:null}),[I,T]=p.useState({isOpen:!1}),k=()=>{const G=h?.nfe?.modelo||r?.modelo_nfe;return G==="55"?"NF-e":G==="65"?"NFC-e":"NF-e / NFC-e"},B=(G,ue,ve)=>_[G]?.[ue]??ve,z=(G,ue)=>!G||!ue?0:G*(1+ue/100),U=G=>{C(ue=>({...ue,[G]:!ue[G]}))},L=(G,ue,ve)=>{console.log("[XMLReprocessModal] handleEditProduct chamado:",{index:G,field:ue,value:ve}),j(ae=>{const oe={...ae,[G]:{...ae[G],[ue]:ve}};return console.log("[XMLReprocessModal] Novo estado editedProducts:",oe),oe})},W=G=>{g(ue=>ue.map((ve,ae)=>{if(ae===G){const oe=!ve.selected;return P(me=>({...me,[G]:oe})),{...ve,selected:oe}}return ve}))},ge=(G,ue)=>{console.log("[XMLReprocessModal] handleLinkProduct chamado:",{index:G,productId:ue}),console.log("[XMLReprocessModal] Estado editedProducts antes:",_[G]),L(G,"linkedProductId",ue),console.log("[XMLReprocessModal] Estado editedProducts depois:",{..._,[G]:{..._[G],linkedProductId:ue}})};p.useEffect(()=>{i&&e&&Ae(i)},[i,e]);const Ae=async G=>{f(G);try{console.log("[XMLReprocess] Processando arquivo automtico..."),console.log("[XMLReprocess] Purchase data:",r);const ve=await G.text();console.log("[XMLReprocess] XML content length:",ve.length);const ae=cC(ve);if(!ae.success){l({title:"Erro ao ler XML",description:ae.error||"XML invlido",variant:"destructive"});return}console.log("[XMLReprocess] Dados parseados:",ae.data),console.log("[XMLReprocess] Produtos encontrados:",ae.data?.produtos?.length||0),console.log("[XMLReprocess] Comparando chaves:",{xmlChave:ae.data?.nfe?.chaveAcesso,purchaseChave:r?.chave_nfe,match:ae.data?.nfe?.chaveAcesso===r?.chave_nfe}),m(ae.data);const oe=await coe(r.id);console.log("[XMLReprocess] Itens da compra original:",oe.length);const me=ae.data?.produtos?.map((ne,ie)=>{const ht=dC(ne,n),pt=!ht,Ze=oe.find(gt=>ne.codigo&&gt.codigo_produto_xml?gt.codigo_produto_xml===ne.codigo:gt.nome_produto_xml===ne.nome),vt=!!Ze,wt=Ze?.selecionado_na_importacao||!1;return console.log(`[XMLReprocess] Produto ${ie+1}: ${ne.nome}`),console.log(`  - Cdigo XML: ${ne.codigo}`),console.log("  - originalItem encontrado:",Ze?`${Ze.nome_produto_xml} (cdigo: ${Ze.codigo_produto_xml})`:"NO ENCONTRADO"),console.log(`  - wasImported: ${vt}`),console.log(`  - wasSelectedInOriginalImport: ${wt}`),{index:ie,xml:ne,existing:ht,isNew:pt,wasImported:vt,selected:A[ie]!==void 0?A[ie]:vt}})||[];console.log("[XMLReprocess] Preview preparado:",me.length,"produtos"),console.log("[XMLReprocess] Produtos marcados:",me.filter(ne=>ne.selected).length),console.log("[XMLReprocess] Produtos importados originalmente:",me.filter(ne=>ne.wasImported).length),console.log("[XMLReprocess] Items da compra original detalhado:"),oe.forEach((ne,ie)=>{console.log(`  ${ie+1}. ${ne.nome_produto_xml} (cdigo: ${ne.codigo_produto_xml}) - selecionado_na_importacao: ${ne.selecionado_na_importacao}`)}),g(me);const De={};me.forEach((ne,ie)=>{ne.xml.precoVenda&&(De[ie]={salePrice:Number(ne.xml.precoVenda)})}),console.log("[XMLReprocess] Pr-populando editedProducts:",De),j(De),d("preview")}catch(ve){console.error("[XMLReprocess] Erro ao processar arquivo automtico:",ve),l({title:"Erro",description:"Erro ao processar o XML salvo.",variant:"destructive"})}},V=async G=>{const ue=G.target.files?.[0];if(!ue){console.log("[XMLReprocess] Nenhum arquivo selecionado");return}if(console.log("[XMLReprocess] Arquivo selecionado:",ue.name),!ue.name.endsWith(".xml")){l({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}f(ue);try{console.log("[XMLReprocess] Lendo contedo do arquivo...");const ve=await ue.text();console.log("[XMLReprocess] Arquivo lido, parseando XML...");const ae=cC(ve);if(console.log("[XMLReprocess] XML parseado:",ae),!ae.success){l({title:"Erro ao ler XML",description:ae.error||"XML invlido",variant:"destructive"});return}if(!ae.data?.produtos||ae.data.produtos.length===0){l({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}if(ae.data?.nfe?.chaveAcesso!==r?.chave_nfe){l({title:"XML incompatvel",description:"Este XML no corresponde  NF-e selecionada. Verifique a chave de acesso.",variant:"destructive"});return}m(ae.data);let oe=n;try{oe=await Hu({search:"",codigoEmpresa:s,includeInactive:!0})||n,console.log("[XMLReprocess] Produtos carregados para validao:",oe.length)}catch(ne){console.warn("[XMLReprocess] No foi possvel carregar lista completa, usando cache:",ne)}const me=ae.data.produtos.map((ne,ie)=>{const ht=dC(ne,oe);return{xml:ne,existing:ht,isNew:!ht,willCreate:!ht,willUpdate:!!ht,selected:!0,index:ie}});g(me);const De={};me.forEach((ne,ie)=>{ne.xml.precoVenda&&(De[ie]={salePrice:Number(ne.xml.precoVenda)})}),console.log("[XMLReprocess] Pr-populando editedProducts:",De),j(De),console.log("[XMLReprocess] Preview preparado, mudando para step preview. Total produtos:",me.length),d("preview")}catch(ve){console.error("[XMLReprocess] Erro ao processar arquivo:",ve),l({title:"Erro",description:"Erro ao processar o arquivo XML.",variant:"destructive"})}},$=()=>{T({isOpen:!0})},Y=async()=>{if(T({isOpen:!1}),!h||!r){l({title:"Erro",description:"Dados insuficientes para reprocessamento.",variant:"destructive"});return}v(!0),d("processing");const G={created:0,updated:0,removed:0,errors:0,details:[]},ue=x.filter(ae=>ae.selected),ve=x.filter(ae=>!ae.selected);console.log("[XMLReprocess] Iniciando reprocessamento para compra:",r.id),console.log("[XMLReprocess] Produtos selecionados:",ue.length),console.log("[XMLReprocess] Produtos desmarcados:",ve.length);try{for(const ae of ve){const me=(_[ae.index]||{}).name||ae.xml.nome,De=Number(ae.xml.quantidade);try{if(ae.isNew){const ne=ae.existing;ne&&(await yF(ne.id),G.removed++,G.details.push({produto:me,acao:"Produto removido (era novo e foi desmarcado)",status:"success"}))}else{const ne=ae.existing;ne&&De>0&&(await Uv({productId:ne.id,delta:-De,codigoEmpresa:r.codigo_empresa}),G.updated++,G.details.push({produto:me,acao:`Estoque revertido -${De}`,status:"success"}))}}catch(ne){console.error(`[XMLReprocess] Erro ao processar produto desmarcado: ${me}`,ne),G.errors++,G.details.push({produto:me,acao:`Erro ao reverter: ${ne.message}`,status:"error"})}}for(const ae of ue){const oe=_[ae.index]||{},me=oe.name||ae.xml.nome,De=oe.qty!==void 0?oe.qty:Number(ae.xml.quantidade),ne=oe.margin,ie=oe.salePrice,ht=oe.linkedProductId;try{if(ae.isNew&&(!ht||ht==="new")){const pt=L3(ae.xml,r.codigo_empresa);if(me&&(pt.name=me),ie!=null)pt.salePrice=ie,pt.price=ie;else if(ne!=null&&ne>0){const vt=pt.costPrice||0;if(vt>0){const wt=vt*(1+ne/100);pt.salePrice=wt,pt.price=wt}}else pt.salePrice!=null&&pt.price==null&&(pt.price=pt.salePrice);const Ze=await lC(pt,{codigoEmpresa:r.codigo_empresa});De>0&&await Uv({productId:Ze.id,delta:De,codigoEmpresa:r.codigo_empresa}),G.created++,G.details.push({produto:me,acao:De>0?`Criado com estoque ${De}`:"Criado",status:"success"})}else{const pt=ht&&ht!=="force-new"&&ht!=="new"?n.find(Ze=>Ze.id===ht):ae.existing;if(oe.updatePrice&&pt){const Ze=Number(ae.xml.valorUnitario)||0,vt={};if(Ze>0&&(vt.costPrice=Ze),ie!=null)vt.salePrice=ie,vt.price=ie;else if(ne!=null&&ne>0&&Ze>0){const wt=Ze*(1+ne/100);vt.salePrice=wt,vt.price=wt}await L1(pt.id,vt)}G.updated++,G.details.push({produto:me,acao:oe.updatePrice?"Preo atualizado":"Mantido sem alteraes",status:"success"})}}catch(pt){console.error(`[XMLReprocess] Erro ao processar produto: ${me}`,pt),G.errors++,G.details.push({produto:me,acao:`Erro: ${pt.message}`,status:"error"})}}}catch(ae){console.error("[XMLReprocess] Erro geral no reprocessamento:",ae),G.errors++,G.details.push({produto:"Sistema",acao:`Erro geral: ${ae.message}`,status:"error",error:ae.message})}try{const ae=ue.map(oe=>{const me=_[oe.index]||{},De=me.linkedProductId;let ne=null;return De&&De!=="force-new"?ne=De:!oe.isNew&&De!=="force-new"&&(ne=oe.existing?.id||null),{produtoId:ne,codigoProdutoXML:oe.xml.codigo,nomeProdutoXML:oe.xml.nome,eanXML:oe.xml.ean,ncmXML:oe.xml.ncm,cfopXML:oe.xml.cfop,unidadeXML:oe.xml.unidade,quantidade:me.qty!==void 0?me.qty:Number(oe.xml.quantidade),valorUnitario:Number(oe.xml.valorUnitario)||0,valorTotal:Number(oe.xml.valorTotal)||0,vinculadoManualmente:!!De&&De!=="force-new"}});await Ost(r.id,ae),console.log("[XMLReprocess] Itens reprocessados:",ae.length)}catch(ae){console.error("[XMLReprocess] Erro ao reprocessar itens da compra:",ae),G.errors++,G.details.push({produto:"Itens da NF-e",acao:"Erro ao reprocessar",status:"error",error:ae.message})}w(G),v(!1),d("done"),G.errors===0?l({title:"Reprocessamento concludo!",description:`${G.created} produto(s) criado(s), ${G.updated} atualizado(s).`,variant:"success"}):l({title:"Reprocessamento com erros",description:`${G.errors} erro(s) encontrado(s). Verifique os detalhes.`,variant:"destructive"}),o&&o()};p.useEffect(()=>{e||(d("upload"),f(null),m(null),g([]),j({}),C({}),w({created:0,updated:0,errors:0,details:[]}),v(!1),P({}))},[e]);const he=()=>{t(!1)},J=x.filter(G=>G.selected).length;return a.jsxs(In,{open:e,onOpenChange:he,children:[a.jsxs(En,{className:"w-[95vw] sm:max-w-4xl max-h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs(Cn,{children:[a.jsxs(Nn,{className:"flex items-center gap-2",children:[a.jsx(Ng,{className:"h-5 w-5"}),a.jsx("span",{children:"Reprocessar XML"}),a.jsx("span",{className:"inline-flex items-center rounded-full bg-surface-2 border border-border px-2 py-0.5 text-xs font-semibold text-text-muted uppercase tracking-wide",children:k()}),a.jsx("span",{className:"text-sm text-text-muted",children:r?.numero_nfe})]}),a.jsx(Hn,{children:"Reimporte o XML para atualizar os produtos e itens desta NF-e. Os itens atuais sero substitudos pelos novos."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto",children:[c==="upload"&&a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center",children:[a.jsx(tD,{className:"h-12 w-12 mx-auto text-text-muted mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Selecione o arquivo XML"}),a.jsxs("p",{className:"text-text-muted mb-4",children:["Faa upload do XML da NF-e ",r?.numero_nfe," para reprocessar os produtos"]}),a.jsx("input",{type:"file",accept:".xml",onChange:V,className:"hidden",id:"xml-reprocess-upload"}),a.jsx("label",{htmlFor:"xml-reprocess-upload",children:a.jsx(se,{asChild:!0,children:a.jsx("span",{children:"Selecionar XML"})})})]})}),c==="preview"&&h&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Informaes da NF-e"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",h.nfe.numero]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",h.nfe.serie]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Modelo:"})," ",k()]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Fornecedor:"})," ",h.fornecedor?.nome]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Total:"})," R$ ",Number(h.nfe.totalNota||0).toFixed(2)]})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"font-semibold text-base",children:"Produtos Encontrados"}),a.jsxs("span",{className:"text-sm text-text-muted",children:[x.filter(G=>G.selected).length," de ",x.length," selecionados"]})]}),a.jsx("div",{className:"space-y-2",children:x.map((G,ue)=>{const ve=B(ue,"name",G.xml.nome),ae=B(ue,"qty",Number(G.xml.quantidade)),oe=B(ue,"linkedProductId",null),me=G.xml.valorUnitario||0,De=B(ue,"margin",null);let ie=B(ue,"salePrice",null);ie==null&&!G.isNew&&G.existing&&(ie=Number(G.existing.preco_venda||G.existing.salePrice||G.existing.price||0)),ie==null&&De!=null&&(ie=z(me,De)),ie==null&&G.xml.precoVenda&&(ie=Number(G.xml.precoVenda));let ht=null;if(De!=null)ht=De;else if(ie!=null&&me>0&&ie>0){const Ze=(ie-me)/me*100;ht=Math.max(-999,Math.min(9999,Ze))}const pt=S[ue];return a.jsxs("div",{className:Sr("rounded-lg border transition-all",G.selected?"bg-info/10 border-info/30":"bg-surface opacity-60 border-border"),children:[a.jsxs("div",{className:"p-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("input",{type:"checkbox",checked:G.selected,onChange:()=>W(ue),className:"w-4 h-4 rounded border-border accent-warning cursor-pointer"}),a.jsx("button",{onClick:()=>U(ue),className:"p-0.5 hover:bg-surface-2 rounded transition-colors",children:pt?a.jsx(ix,{className:"w-4 h-4 text-text-muted"}):a.jsx(qg,{className:"w-4 h-4 text-text-muted"})}),a.jsx("div",{children:oe?a.jsx(wG,{className:"w-5 h-5 text-warning"}):a.jsx(Ng,{className:"w-5 h-5 text-info"})})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:oe&&oe!=="force-new"&&oe!=="new"?(()=>{const Ze=n.find(vt=>vt.id===oe);return Ze?Ze.name:ve})():ve}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-text-muted mt-0.5",children:[G.xml.codigo&&a.jsxs("span",{className:"flex-shrink-0",children:["#",G.xml.codigo]}),a.jsxs("span",{children:["Qtd: ",ae]})]})]}),a.jsx("div",{className:"flex-shrink-0 ml-2",children:oe?a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-warning/20 text-warning font-medium",children:"Vinculado"}):a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-info/20 text-info font-medium",children:"Cadastrado"})})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-muted",children:[a.jsxs("span",{children:["R$ ",me.toFixed(2),ie?`  R$ ${ie.toFixed(2)}`:""]}),ht!=null&&a.jsxs("span",{className:"ml-2 "+(ht>0?"text-success":ht<0?"text-destructive":"text-text-muted"),children:[ht.toFixed(1),"%"]})]})]})]}),pt&&a.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3 border-t border-border/50",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Nome do Produto"}),a.jsx("input",{type:"text",value:ve,onChange:Ze=>L(ue,"name",Ze.target.value),disabled:!G.selected,className:"w-full px-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>L(ue,"qty",Math.max(0,ae-1)),disabled:!G.selected||ae<=0,className:"w-9 h-9 rounded-md border border-border bg-surface hover:bg-surface-2 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:a.jsx(hv,{className:"w-4 h-4"})}),a.jsx("input",{type:"text",value:ae,onChange:Ze=>{const vt=Ze.target.value.replace(/\D/g,"");L(ue,"qty",vt===""?0:Number(vt))},disabled:!G.selected,className:"w-14 text-center px-2 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50"}),a.jsx("button",{type:"button",onClick:()=>L(ue,"qty",ae+1),disabled:!G.selected,className:"w-9 h-9 rounded-md bg-warning hover:bg-warning/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center text-black font-bold shadow-sm",children:a.jsx(Es,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Margem %"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:(()=>{const Ze=B(ue,"margin",null);return Ze!=null?String(Ze):""})(),onChange:Ze=>{const vt=Ze.target.value;if(vt===""){L(ue,"margin",null),L(ue,"salePrice",null);return}const wt=vt.replace(/[^0-9.,\-]/g,"").replace(",",".");if(wt==="."||wt==="-"||wt==="-.")return;const gt=parseFloat(wt);if(!isNaN(gt)&&(L(ue,"margin",gt),me>0)){const er=z(me,gt);L(ue,"salePrice",er)}},disabled:!G.selected,placeholder:"0",className:"w-24 pl-3 pr-6 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right"}),a.jsx("span",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Custo"}),a.jsx("div",{className:"px-3 py-2 bg-surface/50 rounded-md border border-border",children:a.jsxs("span",{className:"text-sm font-semibold",children:["R$ ",me.toFixed(2)]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Preo Venda"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"R$"}),a.jsx("input",{type:"text",value:(()=>{const Ze=B(ue,"salePrice",ie);return Ze==null?"":Number(Ze).toFixed(2).replace(".",",")})(),onChange:Ze=>{const vt=Ze.target.value.replace(/\D/g,"");if(vt===""){L(ue,"salePrice",null);return}const wt=Number(vt)/100;if(L(ue,"salePrice",wt),wt>0&&me>0){const gt=(wt-me)/me*100;L(ue,"margin",Math.round(gt*100)/100)}},disabled:!G.selected,placeholder:"0,00",className:"w-28 pl-7 pr-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right font-semibold text-success"})]})]})]}),a.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[a.jsx("input",{type:"checkbox",id:`update-price-${ue}`,checked:B(ue,"updatePrice",!1),onChange:Ze=>L(ue,"updatePrice",Ze.target.checked),disabled:!G.selected,className:"w-4 h-4 text-brand bg-surface border-border rounded focus:ring-brand focus:ring-2 disabled:opacity-50"}),a.jsx("label",{htmlFor:`update-price-${ue}`,className:"text-sm text-text-primary select-none cursor-pointer",children:"Atualizar preo do produto no sistema"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Vincular a Produto Existente (Opcional)"}),a.jsxs(Gn,{value:oe==="force-new"?"force-new":oe||(G.isNew?"new":G.existing?.id||"new"),onValueChange:Ze=>{Ze==="new"||Ze===G.existing?.id?ge(ue,null):Ze==="search"?O({isOpen:!0,productIndex:ue,currentProduct:G}):ge(ue,Ze)},disabled:!G.selected,children:[a.jsx(Vn,{className:"w-full hover:bg-white/5 transition-colors",children:a.jsx(Kn,{placeholder:G.isNew?" Criar como novo produto":" Atualizar produto existente"})}),a.jsxs(Wn,{className:"max-h-[300px] overflow-y-auto",children:[G.isNew?a.jsx(lt,{value:"new",children:" Criar como novo produto"}):a.jsxs(lt,{value:G.existing?.id||"new",children:[" Atualizar: ",G.existing?.name," (Estoque atual: ",G.existing?.stock||0,")"]}),!G.isNew&&a.jsx(lt,{value:"force-new",children:" Criar como novo produto (ignorar existente)"}),a.jsx(lt,{value:"search",children:" Buscar produto para vincular..."})]})]})]})]})]},ue)})})]})]}),c==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(Zl,{className:"h-12 w-12 animate-spin text-brand mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Reprocessando XML..."}),a.jsx("p",{className:"text-text-muted",children:"Atualizando produtos e itens da NF-e"})]}),c==="done"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center py-6",children:[b.errors===0?a.jsx(vi,{className:"h-12 w-12 text-success mx-auto mb-4"}):a.jsx(ud,{className:"h-12 w-12 text-warning mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:b.errors===0?"Reprocessamento Concludo!":"Reprocessamento com Erros"}),a.jsxs("div",{className:"text-text-muted",children:[b.created," produto(s) criado(s), ",b.updated," atualizado(s)",b.errors>0&&`, ${b.errors} erro(s)`]})]}),b.details.length>0&&a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-3",children:"Detalhes do Reprocessamento"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:b.details.map((G,ue)=>a.jsxs("div",{className:Sr("flex items-center gap-3 p-2 rounded",G.status==="success"?"bg-green-50 text-green-800":G.status==="error"?"bg-red-50 text-red-800":"bg-gray-50 text-gray-800"),children:[G.status==="success"?a.jsx(vi,{className:"h-4 w-4 flex-shrink-0"}):a.jsx(ud,{className:"h-4 w-4 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:G.produto}),a.jsx("div",{className:"text-xs",children:G.acao}),G.error&&a.jsx("div",{className:"text-xs mt-1 opacity-75",children:G.error})]})]},ue))})]})]})]}),a.jsxs(Na,{children:[c==="upload"&&a.jsx(se,{variant:"outline",onClick:he,children:"Cancelar"}),c==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(se,{variant:"outline",onClick:()=>d("upload"),children:"Voltar"}),a.jsxs(se,{onClick:$,disabled:J===0,children:["Reprocessar (",J," produtos)"]})]}),c==="done"&&a.jsx(se,{onClick:he,children:"Fechar"})]})]}),a.jsx(doe,{isOpen:F.isOpen,onClose:()=>O({isOpen:!1,productIndex:null,currentProduct:null}),onSelect:G=>{console.log("[XMLReprocessModal] onSelect chamado com produto:",G),console.log("[XMLReprocessModal] Index do produto:",F.productIndex),ge(F.productIndex,G.id),O({isOpen:!1,productIndex:null,currentProduct:null})},currentProduct:F.currentProduct}),a.jsx(uoe,{isOpen:I.isOpen,onClose:()=>T({isOpen:!1}),onConfirm:Y,products:x.map((G,ue)=>({...G,originalIndex:ue})),editedProducts:_,allProducts:n,isReprocess:!0})]})}const hV="comprasPage:settings";function foe(){const{user:e,userProfile:t}=qs(),[r,n]=p.useState([]),[s,o]=p.useState(!0),[i,l]=p.useState(""),[c,d]=p.useState(null),[u,f]=p.useState([]),[h,m]=p.useState(!1),[x,g]=p.useState(()=>cc(new Date)),[y,v]=p.useState(()=>i5(new Date)),[b,w]=p.useState("all"),[_,j]=p.useState(!0),[S,C]=p.useState(!1),[A,P]=p.useState("active"),[F,O]=p.useState({show:!1,purchase:null}),[I,T]=p.useState(""),[k,B]=p.useState({show:!1,purchase:null}),[z,U]=p.useState({}),[L,W]=p.useState({show:!1,purchase:null}),[ge,Ae]=p.useState([]),[V,$]=p.useState(!1),[Y,he]=p.useState(!1),[J,G]=p.useState("paged"),ue=J==="paged",[ve,ae]=p.useState(1),[oe]=p.useState(100),[me,De]=p.useState(0),[ne,ie]=p.useState(!1),ht=Fe=>{const xt=String(Fe||"").replace(/\D/g,"");return(xt?Number(xt)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},pt=async()=>{try{ie(!0);const Fe=(je||[]).filter(kr=>!!kr.xml_completo).map(kr=>({tipo:"entrada",chave:kr.chave_nfe,xml:kr.xml_completo}));if(!Fe.length){alert("Nenhum XML disponvel nos resultados filtrados.");return}const xt=kr=>String(kr||"").replace(/[^0-9A-Za-z_-]/g,""),Ot=x?sr(x,"yyyy-MM-dd"):"",Cr=y?sr(y,"yyyy-MM-dd"):"",Me=`nfe-entrada-filtrados-${xt(Ot)}_a_${xt(Cr)}-xml.zip`,{data:Qe,error:et}=await re.functions.invoke("emissor",{body:{acao:"export_zip",ambiente:"homologacao",cnpj:"",dados:{items:Fe,includePdf:!1,zipName:Me}},responseType:"arrayBuffer"});if(et)throw et;const Yt=new Blob([Qe],{type:"application/zip"}),xr=URL.createObjectURL(Yt),Jt=document.createElement("a");Jt.href=xr,Jt.download=Me,document.body.appendChild(Jt),Jt.click(),document.body.removeChild(Jt),URL.revokeObjectURL(xr)}catch(Fe){alert(`Falha ao exportar ZIP: ${Fe?.message||Fe}`)}finally{ie(!1)}},Ze=Fe=>{if(!Fe.xml_completo){alert("XML no disponvel para esta NF-e");return}const xt=new Blob([Fe.xml_completo],{type:"text/xml;charset=utf-8"}),Ot=URL.createObjectURL(xt),Cr=document.createElement("a");Cr.href=Ot,Cr.download=`${Fe.chave_nfe}.xml`,document.body.appendChild(Cr),Cr.click(),document.body.removeChild(Cr),URL.revokeObjectURL(Ot)},vt=async Fe=>{if(!Fe.xml_completo){alert("XML no disponvel para reprocessamento automtico");return}if(confirm("Deseja reprocessar esta NF-e? Isso substituir todos os itens atuais pelos dados do XML original."))try{console.log("[ComprasPage] Iniciando reprocessamento para purchase:",Fe),console.log("[ComprasPage] Chave NF-e:",Fe.chave_nfe),console.log("[ComprasPage] XML disponvel:",!!Fe.xml_completo);const xt=new Blob([Fe.xml_completo],{type:"text/xml"}),Ot=new File([xt],`${Fe.chave_nfe}.xml`,{type:"text/xml"});W({show:!0,purchase:Fe,autoFile:Ot})}catch(xt){console.error("Erro no reprocessamento automtico:",xt),alert("Erro ao iniciar reprocessamento automtico")}},wt=Fe=>{if(!Fe)return 0;const xt=String(Fe).replace(/\./g,"").replace(",",".");return parseFloat(xt)||0};p.useEffect(()=>{try{const Fe=localStorage.getItem(hV);if(!Fe)return;const xt=JSON.parse(Fe);xt&&typeof xt=="object"&&((xt.listMode==="paged"||xt.listMode==="all")&&G(xt.listMode),typeof xt.showStats=="boolean"&&j(xt.showStats))}catch{}},[]),p.useEffect(()=>{(async()=>{if(!e?.id||!t?.codigo_empresa)return;const xt=`compras:${t.codigo_empresa}`,Ot=await ooe({userId:e.id,scope:xt});Ot&&((Ot.listMode==="paged"||Ot.listMode==="all")&&G(Ot.listMode),typeof Ot.showStats=="boolean"&&j(Ot.showStats))})()},[e?.id,t?.codigo_empresa]),p.useEffect(()=>{try{const Fe={listMode:J,showStats:_};localStorage.setItem(hV,JSON.stringify(Fe))}catch{}if(e?.id&&t?.codigo_empresa){const Fe=`compras:${t.codigo_empresa}`;ioe({userId:e.id,scope:Fe,settings:{listMode:J,showStats:_}})}},[J,_,e?.id,t?.codigo_empresa]),p.useEffect(()=>{t?.codigo_empresa&&(er(),gt())},[t,A,b,x,y,ve,J]),p.useEffect(()=>{ae(1)},[A,b,x,y,J]);const gt=async()=>{try{const Fe=await Hu({codigoEmpresa:t.codigo_empresa});Ae(Fe||[])}catch(Fe){console.error("[Compras] Erro ao carregar produtos:",Fe)}},er=async()=>{try{o(!0);let Fe=null,xt=null;if(x){const et=new Date(x);et.setHours(0,0,0,0),Fe=et.toISOString()}if(y){const et=new Date(y);et.setHours(23,59,59,999),xt=et.toISOString()}const Me={incluirInativas:A==="all"||A==="inactive",apenasInativas:A==="inactive",fornecedorId:b!=="all"?b:void 0,dataInicio:Fe,dataFim:xt,page:ue?ve:1,pageSize:ue?oe:1e4},Qe=await Est(t.codigo_empresa,Me);n(Qe?.data||[]),De(Qe?.count||0)}catch(Fe){console.error("[Compras] Erro ao carregar compras:",Fe)}finally{o(!1)}},_e=async Fe=>{d(Fe),m(!0);try{const xt=await coe(Fe.id);f(xt||[])}catch(xt){console.error("[Compras] Erro ao carregar itens:",xt),f([])}finally{m(!1)}},Pt=()=>{d(null),f([])},Lt=Fe=>{B({show:!0,purchase:Fe}),U({numeroNfe:Fe.numero_nfe||"",serieNfe:Fe.serie_nfe||"",dataEmissao:Fe.data_emissao?Fe.data_emissao.split("T")[0]:"",tipoOperacao:Fe.tipo_operacao||"",naturezaOperacao:Fe.natureza_operacao||"",valorProdutos:ht((Fe.valor_produtos||0)*100),valorTotal:ht((Fe.valor_total||0)*100),formaPagamento:Fe.forma_pagamento||"",observacoes:Fe.observacoes||""})},gr=async()=>{try{await Tst(k.purchase.id,{...z,valorProdutos:wt(z.valorProdutos),valorTotal:wt(z.valorTotal),fornecedorId:k.purchase.fornecedor_id}),await er(),B({show:!1,purchase:null}),U({}),console.log("Compra editada com sucesso!")}catch(Fe){console.error("Erro ao editar compra:",Fe)}},fr=p.useMemo(()=>{const Fe=new Map;return r.forEach(xt=>{xt.fornecedor?.id&&Fe.set(xt.fornecedor.id,xt.fornecedor)}),Array.from(Fe.values())},[r]),je=p.useMemo(()=>r.filter(Fe=>{if(i){const xt=i.toLowerCase();if(!(Fe.numero_nfe?.toLowerCase().includes(xt)||Fe.fornecedor?.nome?.toLowerCase().includes(xt)||Fe.chave_nfe?.toLowerCase().includes(xt)))return!1}return!0}),[r,i]),nt=p.useMemo(()=>{const Fe=je.reduce((Qe,et)=>Qe+Number(et.valor_total||0),0),xt=je.length,Ot=xt>0?Fe/xt:0,Cr={};je.forEach(Qe=>{const et=Qe.fornecedor?.id||"unknown",Yt=Qe.fornecedor?.nome||"No identificado";Cr[et]||(Cr[et]={name:Yt,total:0,count:0}),Cr[et].total+=Number(Qe.valor_total||0),Cr[et].count+=1});const Me=Object.values(Cr).sort((Qe,et)=>et.total-Qe.total).slice(0,5);return{total:Fe,count:xt,avgTicket:Ot,topSuppliers:Me}},[je]),$t=p.useMemo(()=>{if(!oe)return 1;const Fe=Math.ceil((me||0)/oe);return Fe>0?Fe:1},[me,oe]),Ut=()=>{const Fe=["NF-e","Serie","Data Emissao","Fornecedor","CNPJ","Tipo","Valor Total","Valor Produtos","Forma Pagamento"],xt=je.map(Qe=>[Qe.numero_nfe||"",Qe.serie_nfe||"",Qe.data_emissao?sr(new Date(Qe.data_emissao),"dd/MM/yyyy"):"",(Qe.fornecedor?.nome||"").replace(/,/g," "),Qe.fornecedor?.cnpj||"",Qe.tipo_operacao||"",Number(Qe.valor_total||0).toFixed(2),Number(Qe.valor_produtos||0).toFixed(2),(Qe.forma_pagamento||"").replace(/,/g," ")]),Ot=[Fe,...xt].map(Qe=>Qe.join(";")).join(`
`),Cr=new Blob(["\uFEFF"+Ot],{type:"text/csv;charset=utf-8;"}),Me=document.createElement("a");Me.href=URL.createObjectURL(Cr),Me.download=`compras_${sr(new Date,"yyyy-MM-dd")}.csv`,Me.click()};return a.jsxs("div",{className:"px-3 py-4 md:p-6 max-w-7xl mx-auto",children:[a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx("h1",{className:"text-3xl font-bold text-text-primary",children:"Compras (NF-e)"}),a.jsx(se,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex items-center justify-center",onClick:()=>he(!0),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(fd,{className:"h-4 w-4"})}),a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"outline",size:"sm",className:"h-9",disabled:ne,children:"Aes"})}),a.jsx(bm,{align:"end",children:a.jsxs(Po,{disabled:je.length===0,onClick:pt,children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]})})]})]}),a.jsxs("div",{className:"flex flex-row flex-wrap items-end gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted block mb-1",children:"Perodo Inicial"}),a.jsxs(ai,{modal:!0,children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:"w-full justify-start text-left font-normal h-9 text-sm",children:[a.jsx(lo,{className:"mr-2 h-4 w-4"}),x?sr(x,"dd/MM/yyyy"):a.jsx("span",{children:"Selecionar"})]})}),a.jsx(Go,{className:"w-auto p-0 z-50",align:"end",children:a.jsx(oi,{mode:"single",selected:x,onSelect:g,locale:ga})})]})]}),a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted block mb-1",children:"Perodo Final"}),a.jsxs(ai,{modal:!0,children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:"w-full justify-start text-left font-normal h-9 text-sm",children:[a.jsx(lo,{className:"mr-2 h-4 w-4"}),y?sr(y,"dd/MM/yyyy"):a.jsx("span",{children:"Selecionar"})]})}),a.jsx(Go,{className:"w-auto p-0 z-50",align:"end",children:a.jsx(oi,{mode:"single",selected:y,onSelect:v,locale:ga})})]})]}),(x||y)&&a.jsx(se,{variant:"ghost",size:"sm",onClick:()=>{g(null),v(null)},className:"h-8 px-3 text-xs",children:"Limpar"})]})]})}),_&&je.length>0&&a.jsxs("div",{className:"mb-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(Vi,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"NF-es"})]}),a.jsx("p",{className:"text-lg md:text-2xl font-bold text-text-primary leading-none",children:nt.count})]}),a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(Oi,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"Total"})]}),a.jsxs("p",{className:"text-base md:text-2xl font-bold text-success leading-none whitespace-nowrap",children:["R$ ",nt.total.toFixed(2)]})]}),a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(xf,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"Fornec."})]}),a.jsx("p",{className:"text-lg md:text-2xl font-bold text-info leading-none",children:fr.length})]})]}),nt.topSuppliers.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(bj,{className:"h-4 w-4"}),"Top 5 Fornecedores"]}),a.jsx(se,{variant:"ghost",size:"sm",onClick:()=>C(!0),className:"text-xs",children:"Ver Todos"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:nt.topSuppliers.map((Fe,xt)=>{const Ot=Fe.total/nt.total*100;return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsx("span",{className:"text-text-primary font-medium truncate flex-1",title:Fe.name,children:Fe.name}),a.jsxs("span",{className:"text-text-muted text-xs ml-2 flex-shrink-0",children:["R$ ",Fe.total.toFixed(2)]})]}),a.jsx("div",{className:"w-full bg-surface-2 rounded-full h-1.5",children:a.jsx("div",{className:"bg-brand rounded-full h-1.5 transition-all",style:{width:`${Ot}%`}})})]},xt)})})]})]}),a.jsx("div",{className:"mb-6 space-y-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3 md:gap-4 md:flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2 w-full md:flex-1 md:min-w-[250px]",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar por NF-e, fornecedor ou chave...",value:i,onChange:Fe=>l(Fe.target.value),className:"pl-10"})]}),a.jsx(se,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex md:hidden items-center justify-center",onClick:()=>$(Fe=>!Fe),"aria-label":"Filtros",children:a.jsx(zI,{className:"h-4 w-4"})})]}),V&&a.jsxs("div",{className:"md:hidden mt-1 space-y-3 px-0.5",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Fornecedor"}),a.jsxs(Gn,{value:b,onValueChange:w,children:[a.jsxs(Vn,{className:"w-full text-sm",children:[a.jsx(xf,{className:"h-4 w-4 mr-2 flex-shrink-0"}),a.jsx("div",{className:"truncate",children:a.jsx(Kn,{placeholder:"Todos"})})]}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todos"}),fr.map(Fe=>a.jsx(lt,{value:Fe.id,children:a.jsx("div",{className:"truncate max-w-[220px]",title:Fe.nome,children:Fe.nome})},Fe.id))]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Status"}),a.jsxs(Gn,{value:A,onValueChange:P,children:[a.jsx(Vn,{className:"w-full text-sm",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"active",children:"Apenas ativas"}),a.jsx(lt,{value:"all",children:"Todas"}),a.jsx(lt,{value:"inactive",children:"Apenas inativas"})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1 border-t border-border/60",children:[a.jsxs(se,{type:"button",variant:"ghost",size:"sm",className:"gap-2 text-xs px-2",onClick:()=>j(!_),children:[a.jsx(bj,{className:"h-4 w-4"}),_?"Ocultar estatsticas":"Mostrar estatsticas"]}),a.jsxs(se,{type:"button",variant:"outline",size:"sm",onClick:Ut,disabled:je.length===0,className:"gap-1 text-xs px-3",children:[a.jsx(ks,{className:"h-4 w-4"}),"CSV"]})]})]}),a.jsxs("div",{className:"hidden md:flex md:items-center md:gap-4 md:flex-wrap w-full",children:[a.jsxs(Gn,{value:b,onValueChange:w,children:[a.jsxs(Vn,{className:"w-full md:w-[220px]",children:[a.jsx(xf,{className:"h-4 w-4 mr-2 flex-shrink-0"}),a.jsx("div",{className:"truncate",children:a.jsx(Kn,{placeholder:"Fornecedor"})})]}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todos"}),fr.map(Fe=>a.jsx(lt,{value:Fe.id,children:a.jsx("div",{className:"truncate max-w-[180px]",title:Fe.nome,children:Fe.nome})},Fe.id))]})]}),a.jsxs(se,{variant:"outline",onClick:Ut,disabled:je.length===0,className:"gap-2 w-full sm:w-auto justify-center",children:[a.jsx(ks,{className:"h-4 w-4"}),"Exportar CSV"]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs(se,{variant:"ghost",size:"sm",onClick:()=>j(!_),className:"gap-2",children:[a.jsx(bj,{className:"h-4 w-4"}),_?"Ocultar":"Mostrar"]}),a.jsxs(Gn,{value:A,onValueChange:P,children:[a.jsx(Vn,{className:"w-[140px]",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"active",children:"Apenas ativas"}),a.jsx(lt,{value:"all",children:"Todas"}),a.jsx(lt,{value:"inactive",children:"Apenas inativas"})]})]})]})]})]})}),s?a.jsxs("div",{className:"text-center py-12 bg-surface rounded-lg border border-border",children:[a.jsx(su,{className:"h-12 w-12 mx-auto text-text-muted mb-4"}),a.jsx("p",{className:"text-text-muted",children:i?"Nenhuma compra encontrada":"Nenhuma NF-e importada ainda"}),a.jsx("p",{className:"text-sm text-text-muted mt-2",children:"Importe XMLs de NF-e na pgina de Produtos"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid gap-3",children:je.map(Fe=>a.jsx("div",{className:`rounded-lg border overflow-hidden transition-all hover:shadow-lg ${Fe.ativo===!1?"bg-gray-900/60 border-red-500 shadow-red-500/20":"bg-surface border-border hover:border-brand/50"}`,onClick:()=>_e(Fe),children:a.jsx("div",{className:"p-4",children:a.jsx("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:a.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[a.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[a.jsx(Vi,{className:"h-6 w-6 text-brand mt-0.5 flex-shrink-0"}),a.jsx("div",{className:"min-w-0",children:a.jsxs("h3",{className:`font-semibold text-sm md:text-base leading-snug ${Fe.ativo===!1?"text-red-600":"text-text-primary"}`,children:["NF-e ",Fe.numero_nfe," / Srie ",Fe.serie_nfe,Fe.ativo===!1&&a.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 bg-red-100 text-red-700 text-[10px] rounded-full font-medium align-middle",children:"INATIVA"})]})})]}),a.jsx("div",{className:"sm:hidden flex items-center",children:a.jsxs("span",{className:"text-success font-semibold text-xs whitespace-nowrap pr-2",children:["R$ ",Number(Fe.valor_total||0).toFixed(2)]})})]}),a.jsxs("div",{className:"space-y-2.5",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[a.jsx(xf,{className:"h-5 w-5 flex-shrink-0 text-brand"}),a.jsx("span",{className:"font-medium text-text-primary text-sm md:text-base overflow-hidden truncate",title:Fe.fornecedor?.nome||"Fornecedor no identificado",children:Fe.fornecedor?.nome||"Fornecedor no identificado"})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1.5 text-xs md:text-sm text-text-muted",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(lo,{className:"h-4 w-4"}),a.jsx("span",{children:Fe.data_emissao?sr(new Date(Fe.data_emissao),"dd/MM/yyyy",{locale:ga}):"Data no informada"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(su,{className:"h-4 w-4"}),a.jsx("span",{children:Fe.tipo_operacao||"Entrada"})]}),Fe.chave_nfe&&a.jsxs("div",{className:"text-[10px] md:text-xs max-w-[180px] md:max-w-xs overflow-hidden whitespace-nowrap truncate",children:[a.jsx("span",{className:"font-medium",children:"Chave:"})," ",Fe.chave_nfe.length>20?Fe.chave_nfe.slice(0,20)+"...":Fe.chave_nfe]})]}),Fe.natureza_operacao&&a.jsx("p",{className:"text-[10px] md:text-xs text-text-muted overflow-hidden whitespace-nowrap truncate",title:Fe.natureza_operacao,children:Fe.natureza_operacao})]})]}),a.jsxs("div",{className:"hidden sm:flex sm:flex-col sm:gap-3 sm:mt-0 sm:w-auto",children:[a.jsx("div",{className:"w-full flex justify-end",children:a.jsxs("div",{className:"text-right text-text-muted",children:[a.jsxs("span",{className:"text-success font-semibold text-base md:text-lg whitespace-nowrap",children:["R$ ",Number(Fe.valor_total||0).toFixed(2)]}),a.jsxs("p",{className:"text-[11px] md:text-xs mt-0.5",children:["Produtos: R$ ",Number(Fe.valor_produtos||0).toFixed(2)]})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full justify-end",children:[a.jsxs(se,{onClick:xt=>{xt.stopPropagation(),_e(Fe)},size:"sm",className:"gap-2 w-full justify-center",children:[a.jsx(zg,{className:"h-4 w-4"}),a.jsx("span",{className:"text-xs sm:text-sm",children:"Detalhes"})]}),Fe.ativo&&a.jsxs(se,{onClick:xt=>{xt.stopPropagation(),Lt(Fe)},size:"sm",variant:"outline",className:"gap-2 w-full justify-center",children:[a.jsx(ec,{className:"h-4 w-4"}),a.jsx("span",{className:"text-xs sm:text-sm",children:"Editar"})]})]})]})]})})})},Fe.id))}),ue&&a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-2 text-xs sm:text-sm text-text-muted",children:[a.jsxs("span",{children:["Pgina ",ve," de ",$t," (",me," NF-es)"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>ae(Fe=>Math.max(1,Fe-1)),disabled:ve<=1,children:"Anterior"}),a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>ae(Fe=>Math.min($t,Fe+1)),disabled:ve>=$t,children:"Prxima"})]})]})]}),a.jsx(In,{open:Y,onOpenChange:he,children:a.jsxs(En,{className:"w-[90vw] sm:max-w-md max-h-[80vh] flex flex-col",children:[a.jsx(Cn,{children:a.jsx(Nn,{children:"Configuraes de Compras"})}),a.jsxs("div",{className:"space-y-4 text-sm",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Modo de listagem"}),a.jsxs(Gn,{value:J,onValueChange:G,children:[a.jsx(Vn,{className:"w-full h-9 text-sm",children:a.jsx(Kn,{placeholder:"Paginado"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"paged",children:"Paginado (100 por pgina)"}),a.jsx(lt,{value:"all",children:"Todos (sem paginao)"})]})]})]}),a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Is,{id:"compras-show-stats",checked:_,onCheckedChange:j}),a.jsx("label",{htmlFor:"compras-show-stats",className:"text-xs font-medium text-text-primary",children:"Mostrar cards de estatsticas"})]})})]})]})}),a.jsx(In,{open:F.show,onOpenChange:Fe=>O({show:Fe,purchase:null}),children:a.jsxs(En,{className:"w-[90vw] sm:max-w-md",children:[a.jsx(Cn,{children:a.jsx(Nn,{children:"Inativar NF-e"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["Tem certeza que deseja inativar a NF-e ",a.jsx("strong",{children:F.purchase?.numero_nfe}),"?"]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Motivo da inativao:"}),a.jsx(Ct,{value:I,onChange:Fe=>T(Fe.target.value),placeholder:"Ex: NF-e duplicada, erro na importao...",className:"w-full"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx(se,{variant:"outline",onClick:()=>{O({show:!1,purchase:null}),T("")},children:"Cancelar"}),a.jsx(se,{variant:"destructive",onClick:async()=>{if(!I.trim()){alert("Por favor, informe o motivo da inativao");return}try{await kst(F.purchase.id,I.trim(),t.id),O({show:!1,purchase:null}),T(""),er()}catch(Fe){console.error("Erro ao inativar compra:",Fe),alert("Erro ao inativar NF-e. Tente novamente.")}},disabled:!I.trim(),children:"Inativar"})]})]})]})}),c&&a.jsx(Ust,{purchase:c,items:h?[]:u,onClose:Pt,onEdit:Lt,onReprocess:vt,onDownloadXML:Ze,onInactivate:Fe=>O({show:!0,purchase:Fe})}),a.jsx(In,{open:S,onOpenChange:C,children:a.jsxs(En,{className:"w-[90vw] sm:max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[a.jsx(Cn,{children:a.jsx(Nn,{children:"Todos os Fornecedores"})}),a.jsx("div",{className:"px-6 py-3 bg-surface-2 border-y border-border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-muted",children:"Valor Total Geral"}),a.jsxs("span",{className:"text-2xl font-bold text-success",children:["R$ ",nt.total.toFixed(2)]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:a.jsx("div",{className:"space-y-3 pr-2",children:Object.entries(je.reduce((Fe,xt)=>{const Ot=xt.fornecedor?.id||"unknown",Cr=xt.fornecedor?.nome||"No identificado";return Fe[Ot]||(Fe[Ot]={name:Cr,total:0,count:0}),Fe[Ot].total+=Number(xt.valor_total||0),Fe[Ot].count+=1,Fe},{})).sort(([,Fe],[,xt])=>xt.total-Fe.total).map(([Fe,xt],Ot)=>{const Cr=xt.total/nt.total*100;return a.jsxs("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-brand/10 text-brand text-xs font-bold flex items-center justify-center",children:Ot+1}),a.jsx("span",{className:"font-medium text-text-primary",children:xt.name})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"font-bold text-success",children:["R$ ",xt.total.toFixed(2)]}),a.jsxs("p",{className:"text-xs text-text-muted",children:[xt.count," NF-es"]})]})]}),a.jsx("div",{className:"w-full bg-surface rounded-full h-2",children:a.jsx("div",{className:"bg-brand rounded-full h-2 transition-all",style:{width:`${Cr}%`}})})]},Fe)})})})]})}),a.jsx(In,{open:k.show,onOpenChange:Fe=>B({show:Fe,purchase:null}),children:a.jsxs(En,{className:"w-[90vw] sm:max-w-2xl max-h-[80vh] flex flex-col",onOpenAutoFocus:Fe=>Fe.preventDefault(),children:[a.jsx(Cn,{children:a.jsx(Nn,{children:"Editar NF-e"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Nmero NF-e"}),a.jsx(Ct,{value:z.numeroNfe||"",onChange:Fe=>U(xt=>({...xt,numeroNfe:Fe.target.value})),placeholder:"Nmero da NF-e"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Srie"}),a.jsx(Ct,{value:z.serieNfe||"",onChange:Fe=>U(xt=>({...xt,serieNfe:Fe.target.value})),placeholder:"Srie"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Data de Emisso"}),a.jsx(Ct,{type:"date",value:z.dataEmissao||"",onChange:Fe=>U(xt=>({...xt,dataEmissao:Fe.target.value}))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Tipo de Operao"}),a.jsxs(Gn,{value:z.tipoOperacao||"",onValueChange:Fe=>U(xt=>({...xt,tipoOperacao:Fe})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione o tipo"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"Entrada",children:"0 - Entrada"}),a.jsx(lt,{value:"Sada",children:"1 - Sada"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Natureza da Operao"}),a.jsxs(Gn,{value:z.naturezaOperacao||"",onValueChange:Fe=>U(xt=>({...xt,naturezaOperacao:Fe})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione a natureza"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"Compra para comercializao",children:"Compra para comercializao"}),a.jsx(lt,{value:"Compra para industrializao",children:"Compra para industrializao"}),a.jsx(lt,{value:"Compra para uso ou consumo",children:"Compra para uso ou consumo"}),a.jsx(lt,{value:"Compra de ativo imobilizado",children:"Compra de ativo imobilizado"}),a.jsx(lt,{value:"Compra de material para uso ou consumo",children:"Compra de material para uso ou consumo"}),a.jsx(lt,{value:"Devoluo de venda de produo do estabelecimento",children:"Devoluo de venda de produo do estabelecimento"}),a.jsx(lt,{value:"Devoluo de venda de mercadoria adquirida ou recebida de terceiros",children:"Devoluo de venda de mercadoria adquirida ou recebida de terceiros"}),a.jsx(lt,{value:"Remessa de mercadoria por conta e ordem de terceiros",children:"Remessa de mercadoria por conta e ordem de terceiros"}),a.jsx(lt,{value:"Retorno de mercadoria remetida por conta e ordem de terceiros",children:"Retorno de mercadoria remetida por conta e ordem de terceiros"}),a.jsx(lt,{value:"Remessa para industrializao por encomenda",children:"Remessa para industrializao por encomenda"}),a.jsx(lt,{value:"Retorno de mercadoria remetida para industrializao por encomenda",children:"Retorno de mercadoria remetida para industrializao por encomenda"}),a.jsx(lt,{value:"Transferncia de produo do estabelecimento",children:"Transferncia de produo do estabelecimento"}),a.jsx(lt,{value:"Transferncia de mercadoria adquirida ou recebida de terceiros",children:"Transferncia de mercadoria adquirida ou recebida de terceiros"})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Valor dos Produtos"}),a.jsx(Ct,{inputMode:"numeric",placeholder:"R$ 0,00",value:`R$ ${z.valorProdutos||"0,00"}`,onChange:Fe=>U(xt=>({...xt,valorProdutos:ht(Fe.target.value)}))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Valor Total"}),a.jsx(Ct,{inputMode:"numeric",placeholder:"R$ 0,00",value:`R$ ${z.valorTotal||"0,00"}`,onChange:Fe=>U(xt=>({...xt,valorTotal:ht(Fe.target.value)}))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Forma de Pagamento"}),a.jsxs(Gn,{value:z.formaPagamento||"",onValueChange:Fe=>U(xt=>({...xt,formaPagamento:Fe})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione a forma de pagamento"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"01 - Dinheiro",children:"01 - Dinheiro"}),a.jsx(lt,{value:"02 - Cheque",children:"02 - Cheque"}),a.jsx(lt,{value:"03 - Carto de Crdito",children:"03 - Carto de Crdito"}),a.jsx(lt,{value:"04 - Carto de Dbito",children:"04 - Carto de Dbito"}),a.jsx(lt,{value:"05 - Carto da Loja (Private Label)",children:"05 - Carto da Loja (Private Label)"}),a.jsx(lt,{value:"10 - Vale Alimentao",children:"10 - Vale Alimentao"}),a.jsx(lt,{value:"11 - Vale Refeio",children:"11 - Vale Refeio"}),a.jsx(lt,{value:"12 - Vale Presente",children:"12 - Vale Presente"}),a.jsx(lt,{value:"13 - Vale Combustvel",children:"13 - Vale Combustvel"}),a.jsx(lt,{value:"14 - Duplicata Mercantil",children:"14 - Duplicata Mercantil"}),a.jsx(lt,{value:"15 - Boleto Bancrio",children:"15 - Boleto Bancrio"}),a.jsx(lt,{value:"16 - Depsito Bancrio",children:"16 - Depsito Bancrio"}),a.jsx(lt,{value:"17 - PIX Dinmico (QR-Code)",children:"17 - PIX Dinmico (QR-Code)"}),a.jsx(lt,{value:"18 - Transferncia Bancria / Carteira Digital",children:"18 - Transferncia Bancria / Carteira Digital"}),a.jsx(lt,{value:"19 - Programa de Fidelidade / Cashback",children:"19 - Programa de Fidelidade / Cashback"}),a.jsx(lt,{value:"20 - PIX Esttico",children:"20 - PIX Esttico"}),a.jsx(lt,{value:"21 - Crdito em Loja",children:"21 - Crdito em Loja"}),a.jsx(lt,{value:"22 - Pagamento Eletrnico no Informado",children:"22 - Pagamento Eletrnico no Informado"}),a.jsx(lt,{value:"90 - Sem Pagamento",children:"90 - Sem Pagamento"}),a.jsx(lt,{value:"99 - Outros",children:"99 - Outros"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Observaes"}),a.jsx(Ct,{value:z.observacoes||"",onChange:Fe=>U(xt=>({...xt,observacoes:Fe.target.value})),placeholder:"Observaes adicionais"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(se,{variant:"outline",onClick:()=>B({show:!1,purchase:null}),children:"Cancelar"}),a.jsx(se,{onClick:gr,children:"Salvar Alteraes"})]})]})]})}),a.jsx(Vst,{open:L.show,onOpenChange:Fe=>W({show:Fe,purchase:null}),purchase:L.purchase,products:ge,codigoEmpresa:t?.codigo_empresa,autoFile:L.autoFile,onSuccess:()=>{er(),W({show:!1,purchase:null})}})]})}const Gl=Ee.forwardRef(({className:e,...t},r)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:r,className:Sr("w-full caption-bottom text-sm",e),...t})}));Gl.displayName="Table";const Kl=Ee.forwardRef(({className:e,...t},r)=>a.jsx("thead",{ref:r,className:Sr("[&_tr]:border-b",e),...t}));Kl.displayName="TableHeader";const Xl=Ee.forwardRef(({className:e,...t},r)=>a.jsx("tbody",{ref:r,className:Sr("[&_tr:last-child]:border-0",e),...t}));Xl.displayName="TableBody";const Wst=Ee.forwardRef(({className:e,...t},r)=>a.jsx("tfoot",{ref:r,className:Sr("bg-primary font-medium text-primary-foreground",e),...t}));Wst.displayName="TableFooter";const gs=Ee.forwardRef(({className:e,...t},r)=>a.jsx("tr",{ref:r,className:Sr("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));gs.displayName="TableRow";const sa=Ee.forwardRef(({className:e,...t},r)=>a.jsx("th",{ref:r,className:Sr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));sa.displayName="TableHead";const Un=Ee.forwardRef(({className:e,...t},r)=>a.jsx("td",{ref:r,className:Sr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));Un.displayName="TableCell";const Hst=Ee.forwardRef(({className:e,...t},r)=>a.jsx("caption",{ref:r,className:Sr("mt-4 text-sm text-muted-foreground",e),...t}));Hst.displayName="TableCaption";const Gst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},moe={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},rj=({icon:e,title:t,value:r,color:n,onClick:s,isActive:o})=>{const i=e;return a.jsxs(Er.div,{variants:moe,className:Sr("bg-surface rounded-lg border p-4 flex items-center gap-4 cursor-pointer transition-all duration-200",o?"border-brand ring-2 ring-brand/50":"border-border hover:border-brand/50"),onClick:s,children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${n}/20`,children:a.jsx(i,{className:`w-6 h-6 ${n}`})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary text-sm font-medium",children:t}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r})]})]})};function Kst({open:e,onOpenChange:t,client:r,onEdit:n,onInactivate:s,codigoEmpresa:o}){const{toast:i}=Ss(),l={scheduled:{bg:"bg-[#3B82F6]/10",text:"text-[#3B82F6]",border:"border-[#3B82F6]/30"},confirmed:{bg:"bg-[#22C55E]/10",text:"text-[#22C55E]",border:"border-[#22C55E]/30"},in_progress:{bg:"bg-[#FACC15]/10",text:"text-[#FACC15]",border:"border-[#FACC15]/30"},finished:{bg:"bg-[#6B7280]/10",text:"text-[#6B7280]",border:"border-[#6B7280]/30"},canceled:{bg:"bg-[#EF4444]/10",text:"text-[#EF4444]",border:"border-[#EF4444]/30"},absent:{bg:"bg-[#F97316]/10",text:"text-[#F97316]",border:"border-[#F97316]/30"}},c=({label:T,value:k})=>a.jsxs("div",{className:"grid grid-cols-12 items-start gap-3 py-2 border-b border-border/50",children:[a.jsx("div",{className:"col-span-5 sm:col-span-4",children:a.jsx("span",{className:"block text-[11px] uppercase tracking-wide text-text-muted font-semibold",children:T})}),a.jsx("div",{className:"col-span-7 sm:col-span-8",children:a.jsx("span",{className:"block text-sm font-medium text-text-primary break-words",children:k})})]}),[d,u]=p.useState(!1),[f,h]=p.useState([]),[m,x]=p.useState(!1),[g,y]=p.useState([]),v=p.useRef(!1),b=p.useRef(!1),[w,_]=p.useState(!1),[j,S]=p.useState(null),[C,A]=p.useState(!1),[P,F]=p.useState(null),O=p.useMemo(()=>{try{const T=(f||[]).map(B=>({kind:"comanda",ts:new Date(B.aberto_em||B.created_at||0).getTime(),data:B})),k=(g||[]).map(B=>({kind:"agendamento",ts:new Date(B.inicio||0).getTime(),data:B}));return[...T,...k].sort((B,z)=>z.ts-B.ts).slice(0,10)}catch{return[]}},[f,g]),I=async T=>{try{if(_(!0),S(T?.kind||null),A(!0),F(null),T?.kind==="comanda"){const k=T?.data?.comanda_id;if(!k){A(!1);return}let B=re.from("comanda_itens").select("id, quantidade, preco_unitario, desconto, produto:produtos!comanda_itens_produto_id_fkey ( nome )").eq("comanda_id",k);o&&(B=B.eq("codigo_empresa",o));const{data:z}=await B,U=(z||[]).map(G=>({id:G.id,quantidade:G.quantidade,preco_unitario:G.preco_unitario,desconto:G.desconto,produto_nome:G.produto?.[0]?.nome||G.produto?.nome||"Item"}));let L=re.from("pagamentos").select("id, valor, status, recebido_em, metodo").eq("comanda_id",k);o&&(L=L.eq("codigo_empresa",o));const{data:W}=await L,ge=W||[];let Ae=re.from("comanda_clientes").select("cliente:clientes!comanda_clientes_cliente_id_fkey ( id, nome, email, telefone )").eq("comanda_id",k);o&&(Ae=Ae.eq("codigo_empresa",o));const{data:V}=await Ae,$=(V||[]).map(G=>G.cliente?.[0]||G.cliente).filter(Boolean),Y=(U||[]).reduce((G,ue)=>G+(Number(ue.quantidade||0)*Number(ue.preco_unitario||0)-Number(ue.desconto||0)),0),he=(ge||[]).filter(G=>(G.status||"Pago")!=="Cancelado"&&(G.status||"Pago")!=="Estornado").reduce((G,ue)=>G+Number(ue.valor||0),0),J=Math.max(0,Y-he);F({comandaId:k,mesa_title:T?.data?.mesa_title||"Balco",status:T?.data?.status||"open",itens:U||[],pagamentos:ge||[],clientes:$,totalItens:Y,totalPagos:he,saldo:J,aberto_em:T?.data?.aberto_em||T?.data?.created_at||null,fechado_em:T?.data?.fechado_em||null})}else if(T?.kind==="agendamento"){const k=T?.data?.id;if(!k){A(!1);return}let B=[];try{const{data:L}=await re.from("agendamento_participantes").select("cliente_id, nome, valor_cota, status_pagamento").eq("agendamento_id",k).limit(200);B=L||[]}catch{B=[]}const z=Array.from(new Set((B||[]).map(L=>L.cliente_id).filter(Boolean)));let U=[];if(U=(B||[]).map(L=>({id:L.cliente_id,nome:L.nome||null,email:null,telefone:null,codigo:null,valor_cota:L.valor_cota??null,status_pagamento:L.status_pagamento||null})),z.length>0)try{const{data:L}=await re.from("clientes").select("id,nome,email,telefone,codigo").in("id",z),W=new Map((L||[]).map(ge=>[String(ge.id),ge]));U=U.map(ge=>{const Ae=W.get(String(ge.id));return Ae?{...ge,nome:ge.nome||Ae.nome,email:Ae.email,telefone:Ae.telefone,codigo:Ae.codigo}:ge})}catch{}F({id:k,inicio:T?.data?.inicio||null,fim:T?.data?.fim||null,status:T?.data?.status||null,modalidade:T?.data?.modalidade||null,quadra_nome:T?.data?.quadra_nome||null,participantes:U})}}catch{}finally{A(!1)}};return p.useEffect(()=>{let T=!1;if(e&&(v.current=!1,b.current=!1),e&&r?.id&&!o)return u(!1),x(!1),()=>{T=!0};const k=async()=>{if(!e||!r?.id)return;u(!0);const z=Number(r?.codigo??-1)===0;let U=re.from("comanda_clientes").select("comanda_id, created_at");z?U=U.is("cliente_id",null):U=U.eq("cliente_id",r.id),U=U.order("created_at",{ascending:!1}).limit(50),o&&(U=U.eq("codigo_empresa",o));const{data:L,error:W}=await U;if(W)throw W;const ge=Array.from(new Set((L||[]).map(he=>he.comanda_id).filter(Boolean)));let Ae=[];if(!z){let he=re.from("comandas").select("id, status, aberto_em, fechado_em").eq("cliente_id",r.id).order("aberto_em",{ascending:!1}).limit(10);o&&(he=he.eq("codigo_empresa",o));const{data:J,error:G}=await he;if(G)throw G;Ae=J||[]}const V=Array.from(new Set((Ae||[]).map(he=>he.id))),$=Array.from(new Set([...ge,...V]));if($.length===0){h([]),u(!1);return}let Y;try{Y=setTimeout(()=>u(!1),1e4)}catch{}try{let he=re.from("comandas").select("id,status,aberto_em,fechado_em, mesa:mesas!comandas_mesa_id_fkey ( nome, numero )").in("id",$);o&&(he=he.eq("codigo_empresa",o));const{data:J,error:G}=await he;if(G)throw G;const ue=new Map((J||[]).map(gt=>[gt.id,gt]));let ve=re.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",$);o&&(ve=ve.eq("codigo_empresa",o));const{data:ae,error:oe}=await ve;if(oe)throw oe;const me={};for(const gt of ae||[]){const er=Number(gt.quantidade||0)*Number(gt.preco_unitario||0),_e=Number(gt.desconto||0);me[gt.comanda_id]=(me[gt.comanda_id]||0)+Math.max(0,er-_e)}let De=re.from("pagamentos").select("comanda_id, valor, status, recebido_em, metodo").in("comanda_id",$);o&&(De=De.eq("codigo_empresa",o));const{data:ne,error:ie}=await De;if(ie)throw ie;const ht={};for(const gt of ne||[])(gt.status||"Pago")!=="Cancelado"&&(gt.status||"Pago")!=="Estornado"&&(ht[gt.comanda_id]=(ht[gt.comanda_id]||0)+Number(gt.valor||0));const pt=(gt,er=null)=>{const _e=ue.get(gt)||{},Pt=Number(me[gt]||0),Lt=Number(ht[gt]||0),gr=Math.max(0,Pt-Lt),fr=_e.mesa?.[0]?.nome||_e.mesa?.nome||null,je=_e.mesa?.[0]?.numero||_e.mesa?.numero||null,nt=fr||(je!=null?`Mesa ${je}`:"Balco");return{comanda_id:gt,created_at:er,aberto_em:_e.aberto_em||null,fechado_em:_e.fechado_em||null,status:_e.status||"open",total:Pt,pago:Lt,saldo:gr,mesa_title:nt}},Ze=(L||[]).map(gt=>pt(gt.comanda_id,gt.created_at)),vt=(Ae||[]).filter(gt=>!(ge||[]).includes(gt.id)).map(gt=>pt(gt.id,gt.aberto_em)),wt=[...Ze,...vt].sort((gt,er)=>{const _e=new Date(gt.aberto_em||gt.created_at||0).getTime();return new Date(er.aberto_em||er.created_at||0).getTime()-_e}).slice(0,10);if(!T&&wt.length===0&&!v.current){v.current=!0,console.debug("[ClientDetailsModal] loadHistory: empty result, retrying once..."),setTimeout(()=>{e&&r?.id&&k()},700);return}T||h(wt)}catch(he){i({title:"Falha ao carregar histrico do cliente",description:he?.message||"Tente novamente",variant:"destructive"})}finally{try{clearTimeout(Y)}catch{}T||u(!1)}},B=async()=>{if(!e||!r?.id)return;x(!0);let z;try{z=setTimeout(()=>x(!1),1e4)}catch{}try{console.debug("[ClientDetailsModal] loadBookings: start",{clientId:r.id,codigoEmpresa:o});let U=re.from("agendamentos").select(`
            id, inicio, fim, status, modalidade,
            quadra:quadra_id ( nome )
          `).eq("cliente_id",r.id).order("inicio",{ascending:!1}).limit(10);o&&(U=U.eq("codigo_empresa",o));const{data:L,error:W}=await U;if(W)throw W;const ge=(L||[]).map(ve=>({id:ve.id,inicio:ve.inicio,fim:ve.fim,status:ve.status,modalidade:ve.modalidade,quadra_nome:ve.quadra?.[0]?.nome||ve.quadra?.nome||null}));let Ae=re.from("v_agendamento_participantes").select("agendamento_id").eq("cliente_id",r.id).limit(30);const{data:V,error:$}=await Ae;if($)throw $;const Y=Array.from(new Set((V||[]).map(ve=>ve.agendamento_id).filter(Boolean))),he=new Set((ge||[]).map(ve=>ve.id)),J=Y.filter(ve=>!he.has(ve));let G=[];if(J.length>0){let ve=re.from("agendamentos").select(`
              id, inicio, fim, status, modalidade,
              quadra:quadra_id ( nome )
            `).in("id",J);o&&(ve=ve.eq("codigo_empresa",o));const{data:ae,error:oe}=await ve;if(oe)throw oe;G=(ae||[]).map(me=>({id:me.id,inicio:me.inicio,fim:me.fim,status:me.status,modalidade:me.modalidade,quadra_nome:me.quadra?.[0]?.nome||me.quadra?.nome||null}))}const ue=[...ge,...G].sort((ve,ae)=>new Date(ae.inicio)-new Date(ve.inicio)).slice(0,10);if(!T&&ue.length===0&&!b.current){b.current=!0,console.debug("[ClientDetailsModal] loadBookings: empty result, retrying once..."),setTimeout(()=>{e&&r?.id&&B()},700);return}T||y(ue)}catch(U){console.warn("[ClientDetailsModal] Falha ao carregar agendamentos do cliente:",U)}finally{try{clearTimeout(z)}catch{}T||x(!1)}};return k(),B(),()=>{T=!0,e||(u(!1),x(!1))}},[e,r?.id,o]),r?a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto w-full",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Detalhes do Cliente"}),a.jsx(Hn,{children:"Informaes cadastrais e histrico recente deste cliente."})]}),a.jsxs("div",{className:"p-4 sm:p-6 space-y-6 sm:space-y-8",children:[a.jsx("div",{className:"overflow-hidden",children:a.jsx("div",{className:"flex items-start justify-between gap-4",children:a.jsxs("div",{className:"min-w-0",children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-extrabold tracking-tight text-text-primary truncate",children:r.nome}),a.jsxs("div",{className:"mt-2 flex items-center flex-wrap gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-surface-2 border border-border text-text-secondary",children:["Cdigo: ",a.jsx("span",{className:"text-text-primary font-mono",children:r.codigo})]}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold border ${r.status==="active"?"bg-emerald-500/10 text-emerald-400 border-emerald-400/30":"bg-rose-500/10 text-rose-400 border-rose-400/30"}`,children:r.status==="active"?"Ativo":"Inativo"}),r.flag_cliente&&a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),r.flag_fornecedor&&a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]}),a.jsx("span",{className:"mt-2 block text-sm text-text-secondary truncate",children:r.email||""})]})})}),a.jsx("div",{className:"grid grid-cols-1 gap-8",children:a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-text-secondary mb-2",children:"Informaes Cadastrais"}),a.jsxs("div",{className:"bg-surface-2 p-3 sm:p-4 rounded-lg space-y-1",children:[a.jsx(c,{label:"Cdigo",value:r.codigo}),a.jsx(c,{label:"CPF/CNPJ",value:r.cpf||r.cnpj||""}),a.jsx(c,{label:"Telefone",value:r.telefone||""}),a.jsx(c,{label:"Aniversrio",value:r.aniversario?new Date(r.aniversario).toLocaleDateString("pt-BR"):""}),a.jsx(c,{label:"Email",value:r.email||""}),a.jsx(c,{label:"Status",value:r.status==="active"?"Ativo":"Inativo"})]})]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary",children:[a.jsx(que,{className:"w-5 h-5 text-text-secondary"}),a.jsx("h4",{className:"font-semibold",children:"Histrico Recente"})]}),a.jsx("div",{className:"bg-surface-2 p-3 sm:p-4 rounded-lg",children:d&&m?a.jsx("div",{className:"text-center py-8 text-sm text-text-muted",children:"Carregando histrico..."}):O&&O.length>0?a.jsx("div",{className:"max-h-64 overflow-y-auto thin-scroll pr-1",children:a.jsx("div",{className:"space-y-3",children:O.map((T,k)=>a.jsxs("div",{className:"group flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 p-3 rounded-md border border-border/60 bg-background cursor-pointer transition-colors transition-shadow hover:bg-surface-2/60 hover:shadow-md hover:border-brand/30",title:"Clique para ver detalhes",onClick:()=>I(T),children:[a.jsx("div",{className:"min-w-0",children:T.kind==="comanda"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:T.data.mesa_title||"Balco"}),a.jsx("div",{className:"text-xs text-text-secondary truncate",children:(()=>{const B=T.data;return B.aberto_em?new Date(B.aberto_em).toLocaleString("pt-BR"):new Date(B.created_at).toLocaleString("pt-BR")})()})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:T.data.modalidade||"Agendamento"}),a.jsxs("div",{className:"text-xs text-text-secondary truncate",children:[new Date(T.data.inicio).toLocaleString("pt-BR"),"  ",T.data.quadra_nome||"Quadra"]})]})}),a.jsx("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-end",children:T.kind==="comanda"?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:Sr("px-2 py-1 text-[11px] font-semibold rounded-full border",T.data.status==="closed"||T.data.fechado_em?"bg-success/10 text-success border-success/30":T.data.status==="awaiting-payment"?"bg-info/10 text-info border-info/30":"bg-warning/10 text-warning border-warning/30"),children:T.data.status==="closed"||T.data.fechado_em?"Fechada":T.data.status==="awaiting-payment"?"Pagamento":"Em uso"}),a.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[11px] text-text-secondary whitespace-nowrap",children:"Clique para detalhes"})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:Sr("px-2 py-1 text-[11px] font-semibold rounded-full border",(()=>{const B=String(T.data.status||"").toLowerCase(),z=l[B]||l.scheduled;return`${z.bg} ${z.text} ${z.border}`})()),children:(()=>{switch(T.data.status){case"finished":return"Finalizado";case"canceled":return"Cancelado";case"in_progress":return"Em andamento";case"confirmed":return"Confirmado";case"absent":return"Ausente";case"scheduled":default:return"Agendado"}})()}),a.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[11px] text-text-secondary whitespace-nowrap",children:"Clique para detalhes"})]})})]},`${T.kind}-${k}`))})}):a.jsx("div",{className:"text-center py-8 text-sm text-text-muted",children:"Sem registros recentes para este cliente."})})]}),a.jsx(In,{open:w,onOpenChange:_,children:a.jsxs(En,{className:"sm:max-w-[700px] w-full max-h-[85vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:j==="comanda"?P?.mesa_title||"Detalhes da Comanda":"Detalhes do Agendamento"}),a.jsx(Hn,{children:j==="comanda"?"Itens e pagamentos desta comanda.":"Informaes do agendamento e participantes."}),a.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:"Cliente:"}),a.jsx("span",{className:"text-sm font-medium text-text-primary",children:r?.nome||""}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-surface-2 border border-border text-text-secondary",children:["Cdigo: ",a.jsx("span",{className:"text-text-primary font-mono",children:r?.codigo??""})]})]})]}),a.jsx("div",{className:"space-y-4",children:C?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando detalhes..."}):j==="comanda"&&P?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Status"}),a.jsx("p",{className:"font-semibold",children:(()=>{const T=String(P.status||"").toLowerCase();return T==="closed"||P.fechado_em?"Fechada":T==="awaiting-payment"?"Aguardando pagamento":"Aberta"})()})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Abertura"}),a.jsx("p",{className:"font-semibold",children:P.aberto_em?new Date(P.aberto_em).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Fechamento"}),a.jsx("p",{className:"font-semibold",children:P.fechado_em?new Date(P.fechado_em).toLocaleString("pt-BR"):""})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Itens"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(P.itens||[]).map(T=>a.jsxs("div",{className:"p-2 flex flex-col sm:grid sm:grid-cols-12 gap-1 sm:gap-2 text-sm",children:[a.jsx("div",{className:"sm:col-span-6 font-medium",children:T.produto_nome||"Item"}),a.jsxs("div",{className:"sm:col-span-2 sm:text-right text-text-muted",children:["Qtd: ",Number(T.quantidade||0)]}),a.jsxs("div",{className:"sm:col-span-2 sm:text-right",children:["R$ ",Number(T.preco_unitario||0).toFixed(2)]}),a.jsx("div",{className:"sm:col-span-2 sm:text-right text-text-secondary",children:Number(T.desconto||0)?`- R$ ${Number(T.desconto||0).toFixed(2)}`:""})]},T.id)),(!P.itens||P.itens.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum item."})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Pagamentos"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(P.pagamentos||[]).map(T=>a.jsxs("div",{className:"p-2 flex items-center justify-between text-sm",children:[a.jsxs("span",{className:"truncate",children:[T.metodo||""," ",T.status?`(${T.status})`:""]}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Number(T.valor||0).toFixed(2)]})]},T.id)),(!P.pagamentos||P.pagamentos.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum pagamento registrado."})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total de Itens"}),a.jsxs("p",{className:"font-bold",children:["R$ ",Number(P.totalItens||0).toFixed(2)]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total Pago"}),a.jsxs("p",{className:"font-bold text-success",children:["R$ ",Number(P.totalPagos||0).toFixed(2)]})]})]})]}):j==="agendamento"&&P?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Modalidade"}),a.jsx("p",{className:"font-semibold",children:P.modalidade||""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Quadra"}),a.jsx("p",{className:"font-semibold",children:P.quadra_nome||""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Incio"}),a.jsx("p",{className:"font-semibold",children:P.inicio?new Date(P.inicio).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Fim"}),a.jsx("p",{className:"font-semibold",children:P.fim?new Date(P.fim).toLocaleString("pt-BR"):""})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Participantes"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(P.participantes||[]).map((T,k)=>a.jsxs("div",{className:"p-2 text-sm flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3",children:[a.jsx("div",{className:"min-w-0",children:a.jsxs("div",{className:"flex items-center gap-2",children:[T.codigo!==null&&T.codigo!==void 0&&a.jsxs("span",{className:`text-xs font-bold rounded px-1.5 py-0.5 shrink-0 ${String(T.status_pagamento||"").toLowerCase()==="pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",T.codigo]}),a.jsx("span",{className:"font-medium truncate",children:T.nome||"Participante"})]})}),a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-end",children:[T.valor_cota!=null&&a.jsxs("span",{className:"text-xs font-semibold text-text-secondary",children:["R$ ",Number(T.valor_cota||0).toFixed(2)]}),a.jsx("span",{className:`text-[11px] font-semibold rounded-full px-2 py-0.5 border ${String(T.status_pagamento||"").toLowerCase()==="pago"?"bg-success/10 text-success border-success/30":"bg-warning/10 text-warning border-warning/30"}`,children:String(T.status_pagamento||T.status_pagamento_text||"Pendente")})]})]},`${T.id}-${k}`)),(!P.participantes||P.participantes.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum participante encontrado."})]})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma informao para exibir."})}),a.jsx(Na,{children:a.jsx(se,{variant:"outline",onClick:()=>_(!1),children:"Fechar"})})]})})]}),a.jsxs(Na,{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-0 sm:justify-between",children:[!r?.is_consumidor_final&&a.jsx("div",{className:"w-full sm:flex-1",children:a.jsxs(se,{type:"button",variant:"destructive",className:"bg-red-600 hover:bg-red-500 text-white w-full sm:w-auto",onClick:()=>s?.(r),children:[a.jsx(SG,{className:"mr-2 h-4 w-4"})," Inativar Cliente"]})}),a.jsxs("div",{className:"flex gap-2 w-full sm:w-auto sm:ml-auto",children:[a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",className:"flex-1 sm:flex-none",children:"Fechar"})}),!r?.is_consumidor_final&&a.jsxs(se,{onClick:()=>n(r),className:"flex-1 sm:flex-none",children:[a.jsx(ec,{className:"mr-2 h-4 w-4"})," Editar Cliente"]})]})]})]})}):null}function Xst(){const{toast:e}=Ss(),{userProfile:t,authReady:r}=qs(),n=wi(),[s,o]=p.useState(()=>{try{const $=localStorage.getItem("auth:userProfile"),Y=$&&JSON.parse($)?.codigo_empresa||null,he=Y?`clientes:list:${Y}`:"clientes:list",J=JSON.parse(localStorage.getItem(he)||"[]");return Array.isArray(J)?J:[]}catch{return[]}}),[i,l]=p.useState(!1),[c,d]=p.useState(!0),[u,f]=p.useState(!1),[h,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(null),[b,w]=p.useState({searchTerm:"",status:"all",tipo:"todos"}),_=p.useRef(!1),j=p.useRef(0),S=p.useRef(0),C=p.useRef(!1);p.useEffect(()=>{n.state?.openModal&&!u&&!C.current&&(C.current=!0,f(!0),window.history.replaceState({},document.title))},[n.state?.openModal,u]);const A=async()=>{try{const $=s&&s.length>0;if($||l(!0),!t?.codigo_empresa)return;const Y=`clientes:list:${t.codigo_empresa}`;let he=re.from("clientes").select("*, is_consumidor_final").eq("codigo_empresa",t.codigo_empresa).order("codigo",{ascending:!0});if(b.searchTerm.trim()!==""){const ae=b.searchTerm.trim();/^\d+$/.test(ae)?he=he.or(`codigo.eq.${ae},nome.ilike.%${ae}%,email.ilike.%${ae}%,telefone.ilike.%${ae}%`):he=he.or(`nome.ilike.%${ae}%,email.ilike.%${ae}%,telefone.ilike.%${ae}%`)}b.status!=="all"&&(he=he.eq("status",b.status));const J=setTimeout(()=>{try{if(!$){const ae=JSON.parse(localStorage.getItem(Y)||"[]");Array.isArray(ae)&&ae.length>0&&(console.warn("[Clientes] slow fallback: using cached snapshot"),o(ae),S.current=ae.length)}}catch{}},2e3),{data:G,error:ue}=await he;if(ue){if(!_.current){_.current=!0,setTimeout(A,900);return}throw ue}const ve=G||[];if(ve.length===0&&$&&!_.current){_.current=!0,setTimeout(A,700);return}_.current=!1,o(ve);try{localStorage.setItem(Y,JSON.stringify(ve))}catch{}S.current=ve.length,j.current=Date.now()}catch($){e({title:"Erro ao carregar clientes",description:$.message,variant:"destructive"})}finally{l(!1);try{clearTimeout(slowFallback)}catch{}}};p.useEffect(()=>{try{const $=localStorage.getItem("auth:userProfile"),Y=t?.codigo_empresa||$&&JSON.parse($)?.codigo_empresa||null;if(Y){const he=`clientes:list:${Y}`,J=JSON.parse(localStorage.getItem(he)||"[]");Array.isArray(J)&&J.length&&s.length===0&&(o(J),S.current=J.length)}}catch{}if(r&&t?.codigo_empresa){const $=setTimeout(A,50);return()=>clearTimeout($)}return()=>{}},[r,t?.codigo_empresa]),p.useEffect(()=>{if(r&&t?.codigo_empresa){const $=setTimeout(A,200);return()=>clearTimeout($)}return()=>{}},[b.searchTerm,b.status,r,t?.codigo_empresa]),p.useEffect(()=>{const $=()=>{(Date.now()-(j.current||0)>3e4||S.current===0)&&r&&t?.codigo_empresa&&A()},Y=()=>{document.visibilityState==="visible"&&(Date.now()-(j.current||0)>3e4||S.current===0)&&r&&t?.codigo_empresa&&A()};return window.addEventListener("focus",$),document.addEventListener("visibilitychange",Y),()=>{window.removeEventListener("focus",$),document.removeEventListener("visibilitychange",Y)}},[r,t?.codigo_empresa]);const P=p.useMemo(()=>{const Y=new Date().getMonth();return{total:s.length,birthdays:s.filter(he=>he.aniversario&&new Date(he.aniversario).getMonth()===Y).length,active:s.filter(he=>he.status==="active").length}},[s]);function F($){const Y=["Cdigo","Tipo Pessoa","Nome/Razo Social","Apelido/Nome Fantasia","CPF","CNPJ","RG","IE","Email","Telefone","Fone 2","Celular 1","Celular 2","WhatsApp","CEP","Endereo","Nmero","Complemento","Bairro","Cidade","UF","Cidade IBGE","Limite Crdito","Tipo Recebimento","Regime Tributrio","Tipo Contribuinte","Aniversrio","Sexo","Estado Civil","Nome da Me","Nome do Pai","Observaes"," Cliente"," Fornecedor"," Funcionrio"," Administradora"," Parceiro","CCF/SPC","Status"],he=";",J=ne=>{if(!ne)return"";try{const ie=new Date(ne);if(!isNaN(ie)){const ht=String(ie.getDate()).padStart(2,"0"),pt=String(ie.getMonth()+1).padStart(2,"0"),Ze=ie.getFullYear();return`${ht}/${pt}/${Ze}`}}catch{}return String(ne)},G=ne=>{const ie=Number(ne??0);return Number.isFinite(ie)?ie.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},ue=ne=>ne?"Sim":"No",ve=ne=>{const ie=ne==null?"":String(ne);return/[";\n]/.test(ie)?`"${ie.replace(/"/g,'""')}"`:ie},ae=[];ae.push("\uFEFF"+Y.join(he));for(const ne of $){const ie=[ne.codigo??"",ne.tipo_pessoa||"",ne.nome||"",ne.apelido||"",ne.cpf||"",ne.cnpj||"",ne.rg||"",ne.ie||"",ne.email||"",ne.telefone||"",ne.fone2||"",ne.celular1||"",ne.celular2||"",ne.whatsapp||"",ne.cep||"",ne.endereco||"",ne.numero||"",ne.complemento||"",ne.bairro||"",ne.cidade||"",ne.uf||"",ne.cidade_ibge||"",G(ne.limite_credito),ne.tipo_recebimento||"",ne.regime_tributario||"",ne.tipo_contribuinte||"",J(ne.aniversario),ne.sexo||"",ne.estado_civil||"",ne.nome_mae||"",ne.nome_pai||"",ne.observacoes||"",ue(!!ne.flag_cliente),ue(!!ne.flag_fornecedor),ue(!!ne.flag_funcionario),ue(!!ne.flag_administradora),ue(!!ne.flag_parceiro),ue(!!ne.flag_ccf_spc),ne.status==="active"?"Ativo":"Inativo"].map(ve).join(he);ae.push(ie)}const oe=new Blob([ae.join(`
`)],{type:"text/csv;charset=utf-8;"}),me=URL.createObjectURL(oe),De=document.createElement("a");De.href=me,De.download="clientes.csv",document.body.appendChild(De),De.click(),document.body.removeChild(De),URL.revokeObjectURL(me)}const O=()=>{try{F(I),e({title:"Exportao concluda",description:`${I.length} cliente(s) exportado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch($){e({title:"Falha ao exportar",description:$?.message||"No foi possvel gerar o arquivo.",variant:"destructive"})}},I=p.useMemo(()=>(new Date().getMonth(),s.filter(Y=>{const he=b.searchTerm.toLowerCase()===""||(Y.nome||"").toLowerCase().includes(b.searchTerm.toLowerCase())||(Y.cpf||"").includes(b.searchTerm)||(Y.telefone||"").includes(b.searchTerm),J=b.status==="all"||Y.status===b.status;let G=!0;return b.tipo==="clientes"?G=Y.flag_cliente===!0:b.tipo==="fornecedores"?G=Y.flag_fornecedor===!0:b.tipo==="ambos"&&(G=Y.flag_cliente===!0&&Y.flag_fornecedor===!0),he&&J&&G})),[s,b]),[T,k]=p.useState({by:"codigo",dir:"asc"}),B=$=>{k(Y=>Y.by===$&&Y.dir==="asc"?{by:$,dir:"desc"}:{by:$,dir:"asc"})},z=p.useMemo(()=>{const $=I.find(ue=>ue?.is_consumidor_final===!0),he=[...I.filter(ue=>ue?.is_consumidor_final!==!0)],J=T.dir==="asc"?1:-1,G=(ue,ve)=>Number.isFinite(ue)?ue:ve;return he.sort((ue,ve)=>{if(T.by==="codigo"){const ae=G(parseInt(String(ue.codigo||"").trim(),10),1/0),oe=G(parseInt(String(ve.codigo||"").trim(),10),1/0);return ae===oe?0:ae>oe?J:-J}if(T.by==="nome"){const ae=(ue.nome||"").toString(),oe=(ve.nome||"").toString();return ae.localeCompare(oe,"pt-BR",{sensitivity:"base"})*J}return 0}),$?[$,...he]:he},[I,T]),U=$=>{g($),m(!0)},L=()=>{v(null),f(!0)},W=$=>{m(!1),v($),f(!0)},ge=async $=>{try{const{error:Y}=await re.from("clientes").update({status:"inactive"}).eq("id",$.id);if(Y)throw Y;m(!1),e({title:"Cliente inativado",description:`${$.nome} foi marcado como inativo.`}),A()}catch(Y){e({title:"Erro ao inativar cliente",description:Y.message,variant:"destructive"})}},Ae=()=>{w({searchTerm:"",status:"all",tipo:"todos"})},V=b.searchTerm!==""||b.status!=="all"||b.tipo!=="todos";return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-full flex flex-col",children:a.jsxs(Er.div,{variants:Gst,initial:"hidden",animate:"visible",children:[a.jsxs(Er.div,{variants:moe,className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary tracking-tighter",children:"Clientes & Fornecedores"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Gesto completa de clientes e fornecedores"})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto",children:[a.jsx(se,{variant:"outline",size:"icon",onClick:()=>d($=>!$),title:c?"Ocultar resumo":"Mostrar resumo","aria-label":c?"Ocultar resumo":"Mostrar resumo",className:"flex-shrink-0",children:c?a.jsx(jg,{className:"h-4 w-4"}):a.jsx(zg,{className:"h-4 w-4"})}),a.jsxs(se,{variant:"outline",onClick:O,className:"text-sm",children:[a.jsx(ks,{className:"mr-2 h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),a.jsx("span",{className:"sm:hidden",children:"CSV"})]}),a.jsxs(se,{onClick:L,className:"text-sm",children:[a.jsx(Es,{className:"mr-2 h-4 w-4"})," ",a.jsx("span",{className:"hidden xs:inline",children:"Novo"}),a.jsx("span",{className:"xs:hidden",children:"Novo"})]})]})]}),c&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[a.jsx(rj,{icon:tc,title:"Total de Clientes",value:s.filter($=>$.flag_cliente).length,color:"text-brand",onClick:()=>w($=>({...$,tipo:"clientes"})),isActive:b.tipo==="clientes"}),a.jsx(rj,{icon:tc,title:"Total de Fornecedores",value:s.filter($=>$.flag_fornecedor).length,color:"text-purple-500",onClick:()=>w($=>({...$,tipo:"fornecedores"})),isActive:b.tipo==="fornecedores"}),a.jsx(rj,{icon:Lue,title:"Aniversariantes do Ms",value:P.birthdays,color:"text-info",onClick:()=>w($=>({...$,tipo:"todos"})),isActive:b.tipo==="todos"}),a.jsx(rj,{icon:Cm,title:"Ativos",value:P.active,color:"text-success",onClick:()=>w($=>({...$,status:"active"})),isActive:b.status==="active"})]}),a.jsx(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsxs("div",{className:"p-4 border-b border-border flex flex-col gap-4",children:[a.jsxs("div",{className:"relative w-full",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar por nome, CPF ou telefone...",className:"pl-9",value:b.searchTerm,onChange:$=>w(Y=>({...Y,searchTerm:$.target.value}))})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[a.jsxs(Gn,{value:b.tipo,onValueChange:$=>w(Y=>({...Y,tipo:$})),children:[a.jsx(Vn,{className:"w-full sm:w-[200px]",children:a.jsx(Kn,{placeholder:"Tipo"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"todos",children:"Todos"}),a.jsx(lt,{value:"clientes",children:"Apenas Clientes"}),a.jsx(lt,{value:"fornecedores",children:"Apenas Fornecedores"}),a.jsx(lt,{value:"ambos",children:"Clientes e Fornecedores"})]})]}),a.jsxs(Gn,{value:b.status,onValueChange:$=>w(Y=>({...Y,status:$})),children:[a.jsx(Vn,{className:"w-full sm:w-[180px]",children:a.jsx(Kn,{placeholder:"Status"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todos os Status"}),a.jsx(lt,{value:"active",children:"Ativos"}),a.jsx(lt,{value:"inactive",children:"Inativos"})]})]}),V&&a.jsxs(se,{variant:"ghost",onClick:Ae,className:"w-full sm:w-auto",children:[a.jsx(Sg,{className:"mr-2 h-4 w-4"}),"Limpar Filtros"]})]})]}),a.jsx("div",{className:"md:hidden space-y-3 p-4",children:i?a.jsx("div",{className:"text-center py-8 text-text-muted",children:"Carregando..."}):z.length>0?z.map($=>{const Y=$?.is_consumidor_final===!0;return a.jsxs("div",{className:Sr("rounded-lg border bg-surface p-4 space-y-3 cursor-pointer transition-all",Y?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-4 border-l-amber-500/40 border-t-border border-r-border border-b-border":"border-border hover:border-brand/50"),onClick:()=>U($),children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx("span",{className:Sr("font-mono text-sm font-semibold",Y?"text-amber-300/90":"text-text-primary"),children:$.codigo}),a.jsx("span",{className:Sr("px-2 py-0.5 text-xs font-semibold rounded-full flex-shrink-0",$.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:$.status==="active"?"Ativo":"Inativo"})]}),a.jsxs("div",{children:[a.jsx("h3",{className:Sr("font-semibold text-base mb-1",Y?"text-amber-100/90":"text-text-primary"),children:$.nome||""}),Y&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium mb-1",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]}),a.jsx("p",{className:"text-sm text-text-muted",children:$.cpf&&`CPF: ${$.cpf}`||$.cnpj&&`CNPJ: ${$.cnpj}`||($.apelido?`Apelido: ${$.apelido}`:" ")})]}),a.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[$.flag_cliente&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),$.flag_fornecedor&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]}),($.telefone||$.email)&&a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Contato"}),a.jsx("span",{className:"text-sm font-medium",children:$.telefone||$.email})]}),a.jsx("div",{className:"text-xs text-text-muted text-center pt-2 border-t border-border/50",children:"Toque para ver detalhes"})]},$.id)}):a.jsx("div",{className:"text-center py-8 text-text-muted",children:"Nenhum cliente encontrado com os filtros aplicados."})}),a.jsx("div",{className:"hidden md:block",children:a.jsxs(Gl,{children:[a.jsx(Kl,{className:"sticky top-0 bg-surface-2 z-10",children:a.jsxs(gs,{className:"border-b border-border",children:[a.jsxs(sa,{className:"select-none cursor-pointer text-text-secondary",onClick:()=>B("codigo"),title:"Ordenar por cdigo",children:["Cdigo ",T.by==="codigo"?T.dir==="asc"?"":"":""]}),a.jsxs(sa,{className:"text-text-secondary select-none cursor-pointer",onClick:()=>B("nome"),title:"Ordenar por nome",children:["Cliente ",T.by==="nome"?T.dir==="asc"?"":"":""]}),a.jsx(sa,{className:"text-text-secondary",children:"Contato"}),a.jsx(sa,{className:"text-text-secondary",children:"Tipo"}),a.jsx(sa,{className:"text-text-secondary",children:"Status"})]})}),a.jsx(Xl,{children:i?a.jsx(gs,{children:a.jsx(Un,{colSpan:5,className:"h-24 text-center",children:"Carregando..."})}):z.length>0?z.map($=>{const Y=$?.is_consumidor_final===!0;return a.jsxs(gs,{className:Sr("cursor-pointer transition-all",Y?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":"hover:bg-surface-2"),onClick:()=>U($),children:[a.jsx(Un,{className:Sr("font-mono text-base font-semibold",Y?"text-amber-300/90":"text-text-primary"),children:$.codigo}),a.jsx(Un,{children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:Sr("text-base font-semibold truncate",Y?"text-amber-100/90":"text-text-primary"),children:$.nome||""}),Y&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]}),a.jsx("span",{className:"text-xs text-text-muted truncate",children:$.cpf&&`CPF: ${$.cpf}`||$.cnpj&&`CNPJ: ${$.cnpj}`||($.apelido?`Apelido: ${$.apelido}`:" ")})]})}),a.jsx(Un,{children:a.jsx("div",{className:"flex flex-col",children:a.jsx("span",{className:"text-sm truncate",children:$.telefone||$.email||""})})}),a.jsx(Un,{children:a.jsxs("div",{className:"flex flex-wrap gap-1",children:[$.flag_cliente&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),$.flag_fornecedor&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]})}),a.jsx(Un,{children:a.jsx("span",{className:Sr("px-2 py-1 text-xs font-semibold rounded-full",$.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:$.status==="active"?"Ativo":"Inativo"})})]},$.id)}):a.jsx(gs,{children:a.jsx(Un,{colSpan:5,className:"h-24 text-center",children:"Nenhum cliente encontrado com os filtros aplicados."})})})]})})]})})]})}),a.jsx(_ne,{open:u,onOpenChange:f,client:y,onSaved:A}),a.jsx(Kst,{open:h,onOpenChange:m,client:x,onEdit:W,onInactivate:ge,codigoEmpresa:t?.codigo_empresa})]})}const Yst=[],Jst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},hoe={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},Ek=({icon:e,title:t,value:r,color:n})=>{const s=e;return a.jsxs(Er.div,{variants:hoe,className:"bg-surface rounded-lg border border-border p-4 flex items-center gap-4",children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${n}/20`,children:a.jsx(s,{className:`w-6 h-6 ${n}`})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary text-sm font-medium",children:t}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r})]})]})};function Qst({open:e,onOpenChange:t,member:r,onEdit:n}){return r?a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"sm:max-w-[500px] w-full",children:[a.jsx(Cn,{children:a.jsx(Nn,{children:"Detalhes do Funcionrio"})}),a.jsxs("div",{className:"p-4 sm:p-6 space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-xl font-bold",children:r.name}),a.jsx("p",{className:"text-brand font-semibold",children:r.role})]}),a.jsxs("div",{className:"bg-surface-2 p-8 rounded-lg text-center border border-border",children:[a.jsx("p",{className:"text-lg font-semibold text-text-secondary",children:" Em desenvolvimento"}),a.jsx("p",{className:"text-sm text-text-muted mt-2",children:"Detalhes completos do funcionrio estaro disponveis em breve."})]})]}),a.jsxs(Na,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Fechar"})}),a.jsxs(se,{onClick:()=>n(r),className:"w-full sm:w-auto",children:[a.jsx(ec,{className:"mr-2 h-4 w-4"})," Editar"]})]})]})}):null}function Zst({open:e,onOpenChange:t,member:r,onSave:n,loading:s}){const{toast:o}=Ss(),[i,l]=p.useState(r?.name||""),[c,d]=p.useState(r?.role||"");p.useEffect(()=>{e&&(l(r?.name||""),d(r?.role||""))},[r,e]);const u=async f=>{if(f.preventDefault(),!i.trim()){o({title:"Nome  obrigatrio",variant:"destructive"});return}await n({name:i.trim(),role:c.trim()})};return a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"sm:max-w-[700px] w-full",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:r?"Editar Funcionrio":"Novo Funcionrio"}),a.jsx(Hn,{children:"Informe apenas nome e cargo. O cargo  livre (texto)."})]}),a.jsx("form",{onSubmit:u,className:"py-2",children:a.jsx("div",{className:"bg-surface-2 border border-border rounded-lg p-4 space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{htmlFor:"name",children:"Nome"}),a.jsxs("div",{className:"relative",children:[a.jsx(xf,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{id:"name",value:i,onChange:f=>l(f.target.value),className:"pl-9",placeholder:"Ex.: Maria Silva"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{htmlFor:"role",children:"Cargo"}),a.jsxs("div",{className:"relative",children:[a.jsx(Uue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{id:"role",value:c,onChange:f=>d(f.target.value),className:"pl-9",placeholder:"Ex.: Gerente, Caixa, ..."})]})]})]})})}),a.jsxs(Na,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(Uh,{asChild:!0,children:a.jsx(se,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Cancelar"})}),a.jsx(se,{type:"submit",onClick:u,disabled:!!s,className:"w-full sm:w-auto",children:s?"Salvando...":"Salvar"})]})]})})}function eot(){const{company:e,authReady:t,userProfile:r}=qs(),{toast:n}=Ss(),[s,o]=p.useState(Yst),[i,l]=p.useState(!1),[c,d]=p.useState(!1),[u,f]=p.useState(null),[h,m]=p.useState(null),[x,g]=p.useState(""),[y,v]=p.useState(!1),b=p.useRef(!1),w=p.useRef(!0);p.useEffect(()=>(w.current=!0,()=>{w.current=!1}),[]);const _=async()=>{try{const T=e?.codigo_empresa||null;if(!T&&!e?.id)return;const k=T?`team:list:${T}`:"team:list",B=setTimeout(()=>{if(w.current)try{const V=localStorage.getItem(k),$=V?JSON.parse(V):[];Array.isArray($)&&$.length>0&&(console.warn("[Equipe] slow fallback: using cached snapshot"),o($))}catch{}},5e3);let z=re.from("colaboradores").select("*").order("nome",{ascending:!0});T&&(z=z.eq("codigo_empresa",T));const{data:U,error:L}=await z;if(L){if(!b.current){b.current=!0,setTimeout(_,800);return}throw L}let ge=(U||[]).map(V=>({id:V.id,name:V.nome||"",role:V.cargo||"user",status:V.ativo===!1?"inactive":"active",online:!1,permissions:{}}));const Ae=r?.codigo_empresa&&e?.codigo_empresa&&r.codigo_empresa===e.codigo_empresa;if(r?.id&&Ae&&(ge.some($=>$.id===r.id)||(ge=[{id:r.id,name:r.nome||"Voc",role:r.cargo||"user",status:"active",online:!1,permissions:{}},...ge])),!w.current)return;o(ge);try{localStorage.setItem(k,JSON.stringify(ge))}catch{}}catch(T){console.error("Falha ao carregar equipe:",T);const k=e?.codigo_empresa||null,B=k?`team:list:${k}`:"team:list";try{const z=localStorage.getItem(B);z&&w.current&&o(JSON.parse(z))}catch{}}finally{b.current=!1}};p.useEffect(()=>{const T=e?.codigo_empresa||null;if(!(!t||!T)){try{const k=localStorage.getItem(`team:list:${T}`),B=k?JSON.parse(k):[];Array.isArray(B)&&B.length>0&&o(B)}catch{}_()}},[t,e?.codigo_empresa]),p.useEffect(()=>{const T=()=>{document.visibilityState==="visible"&&t&&(e?.codigo_empresa||e?.id)&&_()},k=()=>{t&&(e?.codigo_empresa||e?.id)&&_()};return document.addEventListener("visibilitychange",T),window.addEventListener("focus",k),()=>{document.removeEventListener("visibilitychange",T),window.removeEventListener("focus",k)}},[t,e?.codigo_empresa,e?.id]);const j=p.useMemo(()=>({total:s.length,active:s.filter(T=>T.status==="active").length,inactive:s.filter(T=>T.status==="inactive").length}),[s]),S=p.useMemo(()=>s.filter(T=>T.name.toLowerCase().includes(x.toLowerCase())||T.role.toLowerCase().includes(x.toLowerCase())),[s,x]),C=T=>{f(T),d(!0)},A=()=>{m(null),l(!0)},P=T=>{d(!1),m(T),l(!0)},F=T=>{m(T),l(!0)},O=async({name:T,role:k})=>{try{if(v(!0),!e?.codigo_empresa&&!e?.id)throw new Error("Empresa no encontrada para o usurio atual.");let B=e?.codigo_empresa||null;if(!B&&e?.id){const{data:z}=await re.from("empresas").select("codigo_empresa").eq("id",e.id).single();B=z?.codigo_empresa||null}if(!B)throw new Error("Empresa sem cdigo. Defina o cdigo da empresa antes de adicionar colaboradores.");if(h){const{error:z}=await re.from("colaboradores").update({nome:T,cargo:k}).eq("id",h.id);if(z)throw z;n({title:"Funcionrio atualizado",description:h.name,variant:"default"})}else{const{error:z}=await re.from("colaboradores").insert({codigo_empresa:B,nome:T,cargo:k,ativo:!0});if(z)throw z;n({title:"Funcionrio criado com sucesso",description:T,variant:"success"})}await _(),l(!1),m(null)}catch(B){n({title:"Erro ao salvar funcionrio",description:B.message||String(B),variant:"destructive"})}finally{v(!1)}},I=async T=>{try{if(!(e?.id||e?.codigo_empresa))return;const k=s[0]?.id;if(T.id===k){n({title:"Ao no permitida",description:"No  possvel desativar o primeiro funcionrio.",variant:"destructive"});return}if(r?.id&&T.id===r.id){n({title:"Ao no permitida",description:"Voc no pode desativar o seu prprio usurio.",variant:"destructive"});return}if(s.filter(z=>z.status==="active").length<=1){n({title:"Ao no permitida",description:"Deve haver pelo menos um funcionrio ativo.",variant:"destructive"});return}const{error:B}=await re.from("colaboradores").update({ativo:!1}).eq("id",T.id);if(B)throw B;n({title:"Funcionrio desativado",description:T.name}),await _()}catch(k){n({title:"Erro ao desativar",description:k.message||String(k),variant:"destructive"})}};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-full flex flex-col",children:a.jsxs(Er.div,{variants:Jst,initial:"hidden",animate:"visible",children:[a.jsxs(Er.div,{variants:hoe,className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary tracking-tighter",children:"Gesto de Equipe"}),a.jsx("p",{className:"text-sm sm:text-base text-text-secondary",children:"Controle de funcionrios, permisses e logs."})]}),a.jsxs(se,{onClick:A,disabled:!t||!e?.codigo_empresa,title:t?e?.codigo_empresa?"":"Empresa sem cdigo. Defina o cdigo da empresa antes.":"Aguardando autenticao...",children:[a.jsx(Es,{className:"mr-2 h-4 w-4"})," Novo Funcionrio"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsx(Ek,{icon:tc,title:"Total",value:j.total,color:"text-brand"}),a.jsx(Ek,{icon:afe,title:"Ativos",value:j.active,color:"text-success"}),a.jsx(Ek,{icon:efe,title:"Desativados",value:j.inactive,color:"text-danger"})]}),a.jsx(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar por nome ou cargo...",className:"pl-9",value:x,onChange:T=>g(T.target.value)})]})}),a.jsx("div",{className:"md:hidden p-4 space-y-3",children:S.length===0?a.jsx("div",{className:"text-center py-10 text-text-muted",children:"Nenhum funcionrio cadastrado."}):S.map((T,k)=>a.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4 space-y-3",onClick:()=>C(T),children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-base text-text-primary truncate",children:T.name}),a.jsx("p",{className:"text-sm text-text-muted mt-0.5",children:T.role})]}),a.jsx("span",{className:Sr("inline-flex px-2 py-0.5 rounded-full text-xs font-semibold flex-shrink-0",T.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:T.status==="active"?"Ativo":"Inativo"})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx(se,{variant:"outline",size:"sm",onClick:B=>{B.stopPropagation(),C(T)},className:"flex-1",children:"Ver Detalhes"}),a.jsx(se,{variant:"outline",size:"sm",onClick:B=>{B.stopPropagation(),F(T)},children:a.jsx(ec,{className:"h-3 w-3"})}),a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsx(se,{variant:"outline",size:"sm",onClick:B=>B.stopPropagation(),children:a.jsx(l$,{className:"h-3 w-3"})})}),a.jsx(bm,{align:"end",children:a.jsx(Po,{className:"text-danger",disabled:k===0||s.filter(B=>B.status==="active").length<=1||r?.id&&T.id===r.id,onClick:B=>{B.stopPropagation(),I(T)},children:"Desativar"})})]})]})]},T.id))}),a.jsx("div",{className:"hidden md:block",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Funcionrio"}),a.jsx(sa,{children:"Cargo"}),a.jsx(sa,{children:"Status"}),a.jsx(sa,{className:"w-[80px] text-center",children:"Aes"})]})}),a.jsxs(Xl,{children:[S.length===0&&a.jsx(gs,{children:a.jsx(Un,{colSpan:4,className:"text-center py-10 text-text-muted",children:"Nenhum funcionrio cadastrado."})}),S.map((T,k)=>a.jsxs(gs,{className:"cursor-pointer",onClick:()=>C(T),children:[a.jsx(Un,{className:"font-medium",children:a.jsx("div",{className:"flex items-center gap-3",children:a.jsx("span",{children:T.name})})}),a.jsx(Un,{children:T.role}),a.jsx(Un,{children:a.jsx("span",{className:Sr("px-2 py-1 text-xs font-semibold rounded-full",T.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:T.status==="active"?"Ativo":"Inativo"})}),a.jsx(Un,{className:"text-center",children:a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsx(se,{variant:"ghost",className:"h-8 w-8 p-0 mx-auto",onClick:B=>B.stopPropagation(),children:a.jsx(l$,{className:"h-4 w-4"})})}),a.jsxs(bm,{align:"end",children:[a.jsx(Po,{onClick:B=>{B.stopPropagation(),C(T)},children:"Ver Detalhes"}),a.jsx(Po,{onClick:B=>{B.stopPropagation(),F(T)},children:"Editar"}),a.jsx(Po,{className:"text-danger",disabled:k===0||s.filter(B=>B.status==="active").length<=1||r?.id&&T.id===r.id,onClick:B=>{B.stopPropagation(),I(T)},children:"Desativar"})]})]})})]},T.id))]})]})})]})})]})}),a.jsx(Zst,{open:i,onOpenChange:l,member:h,onSave:O,loading:y}),a.jsx(Qst,{open:c,onOpenChange:d,member:u,onEdit:P})]})}const tot="v2.0.2";function rh({title:e,icon:t,children:r,className:n="",collapsible:s=!1,defaultOpen:o=!0}){return s?a.jsx("div",{className:`bg-surface rounded-lg border border-border shadow-sm ${n}`,children:a.jsxs("details",{className:"group",open:o,children:[a.jsxs("summary",{className:"list-none cursor-pointer select-none p-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[t&&a.jsx(t,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"text-base font-semibold",children:e})]}),a.jsx("span",{className:"text-xs text-text-secondary group-open:rotate-180 transition-transform",children:""})]}),a.jsx("div",{className:"px-4 pb-4",children:r})]})}):a.jsxs("div",{className:`bg-surface rounded-lg border border-border shadow-sm p-4 ${n}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t&&a.jsx(t,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"text-base font-semibold",children:e})]}),r]})}function nh({label:e,value:t}){return a.jsxs("div",{className:"flex items-center justify-between gap-3 py-1 text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:e}),a.jsx("span",{className:"font-medium truncate",children:t||""})]})}function rot(){const{userProfile:e,company:t,authReady:r,loading:n}=qs();wi();const[s,o]=p.useState("Agenda"),[i,l]=p.useState("Mdia"),[c,d]=p.useState(""),[u,f]=p.useState(""),[h,m]=p.useState(!0),[x,g]=p.useState(()=>window.__installPrompt||null),[y,v]=p.useState(!1),[b,w]=p.useState(!1),[_,j]=p.useState(!1),[S,C]=p.useState("unknown"),A="Fluxo7 Arena",P="fluxo7team@gmail.com",F="https://wa.me/5534998936088",O="tel:+5534998936088",I="+55 (34) 99893-6088";p.useEffect(()=>{try{const W=window.matchMedia("(pointer:fine)"),ge=()=>m(W.matches);return ge(),W.addEventListener?.("change",ge),()=>W.removeEventListener?.("change",ge)}catch{m(!0)}},[]),p.useEffect(()=>{const W=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;w(W);const ge=navigator.userAgent;ge.includes("Chrome")&&!ge.includes("Edg")?C("chrome"):ge.includes("Edg")?C("edge"):ge.includes("Firefox")?C("firefox"):ge.includes("Safari")&&!ge.includes("Chrome")?C("safari"):C("other"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&v(!0),window.__installPrompt&&!x&&g(window.__installPrompt);const Ae=()=>{v(!0),g(null),j(!1)};return window.addEventListener("appinstalled",Ae),()=>{window.removeEventListener("appinstalled",Ae)}},[x]);const T=async()=>{if(x)try{await x.prompt();const{outcome:W}=await x.userChoice;W==="accepted"?(v(!0),j(!1)):j(!0),g(null),window.__installPrompt=null}catch(W){console.error("Erro ao mostrar prompt de instalao:",W),j(!0)}else j(!0)},k=()=>{navigator.share?navigator.share({title:"F7 Arena",text:"Adicione F7 Arena  sua tela inicial",url:window.location.href}).catch(()=>{alert(`Para adicionar  tela inicial:

1. Toque no boto de Compartilhar (cone de quadrado com seta)
2. Role para baixo
3. Toque em "Adicionar  Tela de Incio"`)}):alert(`Para adicionar  tela inicial:

1. Toque no boto de Compartilhar (cone de quadrado com seta)
2. Role para baixo
3. Toque em "Adicionar  Tela de Incio"`)},B=p.useMemo(()=>{try{return{empresa:t?.nome||t?.fantasia||t?.razao_social||t?.razaoSocial||t?.displayName||t?.codigo_empresa||"",usuario:e?.nome||e?.name||e?.email||"",dataHora:new Date().toLocaleString("pt-BR")}}catch{return{empresa:"",usuario:"",dataHora:new Date().toLocaleString("pt-BR")}}},[t?.nome,t?.fantasia,t?.razao_social,t?.razaoSocial,t?.displayName,t?.codigo_empresa,e?.nome,e?.name,e?.email]),z=p.useMemo(()=>[`[${A} - Suporte]`,`Assunto: ${c||"(sem assunto)"} `,`Categoria: ${s} `,`Severidade: ${i}`,"","Descrio:",(u||"(adicione uma descrio detalhada, passos para reproduzir, prints se possvel)")+`
`," Dados ",`Empresa: ${B.empresa}`,`Usurio: ${B.usuario}`,`Data e Hora: ${B.dataHora}`].join(`
`),[c,s,i,u,B]),U=`${F}?text=${encodeURIComponent(z)}`,L=`mailto:${P}?subject=${encodeURIComponent(`[Suporte] ${c||"Assunto"}`)}&body=${encodeURIComponent(z)}`;return a.jsxs("div",{className:"px-4 md:px-6 lg:px-8 py-4 md:py-6",children:[a.jsxs("div",{className:"bg-surface rounded-xl border border-border p-5 md:p-6 mb-6",children:[a.jsxs("div",{className:"flex items-start md:items-center justify-between gap-4 flex-col md:flex-row",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand/10 border border-brand/30 flex items-center justify-center",children:a.jsx(bG,{className:"w-5 h-5 text-brand"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl md:text-2xl font-semibold",children:"Suporte"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Precisa de ajuda? Fale com a gente ou consulte as respostas rpidas abaixo."})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center",children:a.jsx(sd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-base md:text-xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-base md:text-xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-base md:text-xl",style:{color:"#B0B0B0"},children:" Arena"})]})]}),a.jsxs("div",{className:"text-xs text-text-secondary mt-1",children:["Verso ",tot]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4",children:[a.jsx(rh,{title:"Status",icon:hb,children:a.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[a.jsx(nh,{label:"Empresa",value:B.empresa}),a.jsx(nh,{label:"Usurio",value:`${B.usuario}`})]})}),a.jsx(rh,{title:"Fale com a gente",icon:SP,children:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("a",{href:F,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-brand text-black hover:opacity-90 transition",children:[a.jsx(SP,{className:"w-4 h-4"})," WhatsApp"]}),a.jsxs("a",{href:`mailto:${P}`,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(t0,{className:"w-4 h-4"})," E-mail"]}),a.jsxs("a",{href:O,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(Pw,{className:"w-4 h-4"})," ",h?I:"Telefone"]})]})}),!y&&b&&a.jsx(rh,{title:"Adicionar  Tela Inicial",icon:CP,children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-text-secondary",children:"Crie um atalho do F7 Arena na sua tela inicial para acesso rpido."}),a.jsxs("button",{onClick:k,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-md bg-brand text-black font-medium hover:opacity-90 transition",children:[a.jsx(u$,{className:"w-4 h-4"})," Criar Atalho"]}),a.jsxs("details",{className:"text-xs text-text-muted",children:[a.jsx("summary",{className:"cursor-pointer hover:text-text-secondary",children:"Como fazer manualmente?"}),a.jsxs("div",{className:"mt-2 space-y-1 pl-2",children:[a.jsxs("p",{children:["1. Toque no boto ",a.jsx(u$,{className:"inline w-3 h-3"})," (Compartilhar)"]}),a.jsx("p",{children:'2. Role para baixo e toque em "Adicionar  Tela de Incio"'}),a.jsx("p",{children:'3. Toque em "Adicionar"'})]})]})]})}),!y&&!b&&a.jsx(rh,{title:"Instalar Aplicativo",icon:CP,children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-text-secondary",children:"Instale o F7 Arena no seu dispositivo para acesso rpido e experincia completa de aplicativo."}),a.jsxs("button",{onClick:T,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-md bg-brand text-black font-medium hover:opacity-90 transition",children:[a.jsx(ks,{className:"w-4 h-4"})," Instalar App"]}),a.jsx("p",{className:"text-xs text-text-muted text-center",children:"Pode demorar alguns segundos. Se no aparecer nada, veja as instrues no tutorial."})]})}),y&&a.jsx(rh,{title:"Aplicativo Instalado",icon:hb,children:a.jsxs("div",{className:"flex items-center gap-2 text-sm text-success",children:[a.jsx(hb,{className:"w-4 h-4"}),a.jsx("span",{children:"F7 Arena est instalado no seu dispositivo!"})]})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2 space-y-3",children:a.jsx(rh,{title:"Perguntas Frequentes (FAQ)",children:a.jsxs("div",{className:"divide-y divide-border/60",children:[a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como abrir comanda de balco?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Abra o caixa antes. A tela de balco utiliza uma comanda sem mesa (mesa_id nulo). Se no existir, o sistema cria ao abrir o balco; caso o caixa esteja fechado, a abertura da comanda  bloqueada."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Por que no consigo fechar o caixa?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"O fechamento  bloqueado se houver comandas com itens em aberto (inclui balco e mesas). Finalize ou feche as comandas pendentes antes de encerrar o caixa."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como adicionar participantes no agendamento?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"No modal de agendamento, selecione um ou mais clientes. Aps salvar, o chip de pagamentos  atualizado imediatamente. Se no visualizar, recarregue os dados da agenda."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como ver o histrico completo do cliente?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Abra o cliente e utilize o Histrico Recente, que combina comandas e agendamentos em uma nica timeline com totais e status."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como ajustar estoque mnimo e ver mais vendidos?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Na aba de Produtos voc pode gerenciar estoque, preos e relatrios. Utilize filtros e exportaes para anlise."})]})]})})}),a.jsx("div",{className:"lg:col-span-1",children:a.jsxs("div",{className:"space-y-3 lg:sticky lg:top-6",children:[a.jsx(rh,{title:"Reportar um problema",icon:Eue,collapsible:!0,defaultOpen:!1,children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Categoria"}),a.jsxs("select",{value:s,onChange:W=>o(W.target.value),className:"w-full mt-1 px-2 py-2 rounded-md bg-background border border-border",children:[a.jsx("option",{children:"Agenda"}),a.jsx("option",{children:"Vendas"}),a.jsx("option",{children:"Clientes"}),a.jsx("option",{children:"Produtos"}),a.jsx("option",{children:"Financeiro"}),a.jsx("option",{children:"Outros"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Severidade"}),a.jsxs("select",{value:i,onChange:W=>l(W.target.value),className:"w-full mt-1 px-2 py-2 rounded-md bg-background border border-border",children:[a.jsx("option",{children:"Baixa"}),a.jsx("option",{children:"Mdia"}),a.jsx("option",{children:"Alta"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Assunto"}),a.jsx("input",{value:c,onChange:W=>d(W.target.value),placeholder:"Ex.: Erro ao salvar agendamento",className:"w-full mt-1 px-3 py-2 rounded-md bg-background border border-border"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Descrio"}),a.jsx("textarea",{value:u,onChange:W=>f(W.target.value),rows:4,placeholder:"Descreva o que aconteceu, passos para reproduzir, expectativa.",className:"w-full mt-1 px-3 py-2 rounded-md bg-background border border-border resize-y"})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 pt-1",children:[a.jsxs("a",{href:U,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-brand text-black hover:opacity-90 transition",children:[a.jsx(SP,{className:"w-4 h-4"})," Enviar no WhatsApp"]}),a.jsxs("a",{href:L,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(t0,{className:"w-4 h-4"})," Enviar por E-mail"]}),a.jsxs("a",{href:O,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(Pw,{className:"w-4 h-4"})," ",h?I:"Ligar agora"]})]})]})}),a.jsx(rh,{title:"Diagnstico",icon:Mue,children:a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsx(nh,{label:"Empresa",value:B.empresa}),a.jsx(nh,{label:"Usurio",value:`${B.usuario}`}),a.jsx(nh,{label:"Data/Hora",value:B.dataHora}),a.jsx(nh,{label:"Canal - WhatsApp",value:"(34) 99893-6088"}),a.jsx(nh,{label:"Canal - E-mail",value:"fluxo7team@gmail.com"}),a.jsx(nh,{label:"Canal - Telefone",value:"(34) 99893-6088"})]})})]})})]}),a.jsx(In,{open:_,onOpenChange:j,children:a.jsxs(En,{className:"max-w-2xl max-h-[85vh] overflow-y-auto",children:[a.jsx(Cn,{children:a.jsxs(Nn,{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-xl bg-brand/10 border border-brand/30 flex items-center justify-center",children:a.jsx(ks,{className:"w-6 h-6 text-brand"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold",children:"Como Instalar o F7 Arena"}),a.jsx("p",{className:"text-sm text-text-secondary font-normal",children:"Siga as instrues para o seu navegador"})]})]})}),a.jsxs("div",{className:"mt-6 space-y-6",children:[(S==="chrome"||S==="edge")&&a.jsxs("div",{className:"bg-gradient-to-br from-brand/10 to-brand/5 rounded-xl p-6 border-2 border-brand/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand flex items-center justify-center",children:a.jsx(Tue,{className:"w-6 h-6 text-black"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Chrome (Celular)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Siga os passos abaixo"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"1"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-semibold mb-2",children:["Toque nos 3 pontinhos ",a.jsx("span",{className:"text-2xl",children:""})]}),a.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"No canto superior direito da tela"}),a.jsx("div",{className:"bg-background/50 rounded-md p-3 border border-border/50",children:a.jsx("p",{className:"text-xs text-text-muted",children:" Os 3 pontinhos ficam ao lado da barra de endereo"})})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"2"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure uma destas opes:"}),a.jsxs("div",{className:"space-y-2 mb-3",children:[a.jsx("div",{className:"bg-brand/20 rounded-md p-3 border-2 border-brand/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Instalar aplicativo"'})}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-text-muted text-sm font-medium",children:[a.jsx("div",{className:"h-px bg-border flex-1"}),a.jsx("span",{children:"OU"}),a.jsx("div",{className:"h-px bg-border flex-1"})]}),a.jsx("div",{className:"bg-brand/20 rounded-md p-3 border-2 border-brand/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Adicionar  tela inicial"'})})]}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Toque em qualquer uma dessas opes no menu"})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"3"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-2",children:"Confirme a instalao"}),a.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"Aparecer uma janela perguntando se deseja instalar"}),a.jsx("div",{className:"bg-success/10 rounded-md p-3 border border-success/30",children:a.jsx("p",{className:"text-sm font-medium text-center",children:' Toque em "Instalar"'})})]})]})}),a.jsxs("div",{className:"bg-success/5 rounded-lg p-4 border border-success/20",children:[a.jsx("p",{className:"text-sm font-medium text-success mb-1",children:" Pronto!"}),a.jsx("p",{className:"text-xs text-text-secondary",children:"O app aparecer na sua tela inicial e voc poder abri-lo como qualquer outro aplicativo!"})]})]})]}),S==="firefox"&&a.jsxs("div",{className:"bg-gradient-to-br from-orange-500/10 to-orange-500/5 rounded-xl p-6 border-2 border-orange-500/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-500 flex items-center justify-center",children:a.jsx(Jue,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Firefox (Celular)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Siga os passos abaixo"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold",children:"1"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-semibold mb-2",children:["Toque nos 3 pontinhos ",a.jsx("span",{className:"text-2xl",children:""})]}),a.jsx("p",{className:"text-sm text-text-secondary",children:"No canto inferior direito da tela"})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold",children:"2"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure uma destas opes:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-orange-500/20 rounded-md p-3 border-2 border-orange-500/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Instalar"'})}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-text-muted text-sm font-medium",children:[a.jsx("div",{className:"h-px bg-border flex-1"}),a.jsx("span",{children:"OU"}),a.jsx("div",{className:"h-px bg-border flex-1"})]}),a.jsx("div",{className:"bg-orange-500/20 rounded-md p-3 border-2 border-orange-500/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Adicionar  tela inicial"'})})]})]})]})}),a.jsxs("div",{className:"bg-success/5 rounded-lg p-4 border border-success/20",children:[a.jsx("p",{className:"text-sm font-medium text-success mb-1",children:" Pronto!"}),a.jsx("p",{className:"text-xs text-text-secondary",children:"O app ser adicionado  sua tela inicial!"})]})]})]}),(S==="safari"||S==="other")&&a.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-500/5 rounded-xl p-6 border-2 border-purple-500/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center",children:a.jsx(CP,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Outros Navegadores"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Instrues gerais"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-surface rounded-lg p-4 border border-border",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure no menu do navegador:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Instalar aplicativo"'})}),a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Adicionar  tela inicial"'})}),a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Criar atalho"'})})]})]}),a.jsx("div",{className:"bg-background/50 rounded-lg p-4 border border-border/50",children:a.jsx("p",{className:"text-sm text-text-muted",children:" Geralmente a opo est no menu de 3 pontos ou 3 linhas do navegador"})})]})]}),a.jsxs("div",{className:"bg-brand/5 rounded-lg p-4 border border-brand/20",children:[a.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[a.jsx(hb,{className:"w-5 h-5 text-brand"}),"Benefcios do App Instalado"]}),a.jsxs("ul",{className:"space-y-1.5 text-sm text-text-secondary",children:[a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Acesso rpido direto da rea de trabalho ou menu iniciar"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Funciona em tela cheia, sem barras do navegador"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Notificaes e atualizaes automticas"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Melhor desempenho e experincia de uso"]})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{onClick:()=>j(!1),className:"px-6 py-2.5 rounded-md bg-surface-2 hover:bg-surface text-text-primary font-medium transition",children:"Entendi"})})]})]})})]})}function poe(e,t,r,n,s){n=n||{};var o=1.15,i=s.internal.scaleFactor,l=s.internal.getFontSize()/i,c=s.getLineHeightFactor?s.getLineHeightFactor():o,d=l*c,u=/\r\n|\r|\n/g,f="",h=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(f=typeof e=="string"?e.split(u):e,h=f.length||1),r+=l*(2-o),n.valign==="middle"?r-=h/2*d:n.valign==="bottom"&&(r-=h*d),n.halign==="center"||n.halign==="right"){var m=l;if(n.halign==="center"&&(m*=.5),f&&h>=1){for(var x=0;x<f.length;x++)s.text(f[x],t-s.getStringUnitWidth(f[x])*m,r),r+=d;return s}t-=s.getStringUnitWidth(e)*m}return n.halign==="justify"?s.text(e,t,r,{maxWidth:n.maxWidth||100,align:"justify"}):s.text(e,t,r),s}var pV={},Vv=function(){function e(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return e.setDefaults=function(t,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=t:pV=t},e.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},e.prototype.applyStyles=function(t,r){var n,s,o;r===void 0&&(r=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var i=this.jsPDFDocument.internal.getFont(),l=i.fontStyle,c=i.fontName;if(t.font&&(c=t.font),t.fontStyle){l=t.fontStyle;var d=this.getFontList()[c];d&&d.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(d[0]),l=d[0])}if(this.jsPDFDocument.setFont(c,l),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!r){var u=e.unifyColor(t.fillColor);u&&(n=this.jsPDFDocument).setFillColor.apply(n,u),u=e.unifyColor(t.textColor),u&&(s=this.jsPDFDocument).setTextColor.apply(s,u),u=e.unifyColor(t.lineColor),u&&(o=this.jsPDFDocument).setDrawColor.apply(o,u),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(t,r,n){return this.jsPDFDocument.splitTextToSize(t,r,n)},e.prototype.rect=function(t,r,n,s,o){return this.jsPDFDocument.rect(t,r,n,s,o)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return pV||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},e.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},e.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}(),B3=function(e,t){return B3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},B3(e,t)};function goe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");B3(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var xoe=function(e){goe(t,e);function t(r){var n=e.call(this)||this;return n._element=r,n}return t}(Array);function not(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function aot(e){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[e]}function uC(e,t,r){r.applyStyles(t,!0);var n=Array.isArray(e)?e:[e],s=n.map(function(o){return r.getTextWidth(o)}).reduce(function(o,i){return Math.max(o,i)},0);return s}function voe(e,t,r,n){var s=t.settings.tableLineWidth,o=t.settings.tableLineColor;e.applyStyles({lineWidth:s,lineColor:o});var i=yoe(s,!1);i&&e.rect(r.x,r.y,t.getWidth(e.pageSize().width),n.y-r.y,i)}function yoe(e,t){var r=e>0,n=t||t===0;return r&&n?"DF":r?"S":n?"F":null}function LA(e,t){var r,n,s,o;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===3)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e.length===1?e=e[0]:e=t}return typeof e=="object"?(typeof e.vertical=="number"&&(e.top=e.vertical,e.bottom=e.vertical),typeof e.horizontal=="number"&&(e.right=e.horizontal,e.left=e.horizontal),{left:(r=e.left)!==null&&r!==void 0?r:t,top:(n=e.top)!==null&&n!==void 0?n:t,right:(s=e.right)!==null&&s!==void 0?s:t,bottom:(o=e.bottom)!==null&&o!==void 0?o:t}):(typeof e!="number"&&(e=t),{top:e,right:e,bottom:e,left:e})}function boe(e,t){var r=LA(t.settings.margin,0);return e.pageSize().width-(r.left+r.right)}function sot(e,t,r,n,s){var o={},i=1.3333333333333333,l=kk(t,function(w){return s.getComputedStyle(w).backgroundColor});l!=null&&(o.fillColor=l);var c=kk(t,function(w){return s.getComputedStyle(w).color});c!=null&&(o.textColor=c);var d=iot(n,r);d&&(o.cellPadding=d);var u="borderTopColor",f=i*r,h=n.borderTopWidth;if(n.borderBottomWidth===h&&n.borderRightWidth===h&&n.borderLeftWidth===h){var m=(parseFloat(h)||0)/f;m&&(o.lineWidth=m)}else o.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/f,right:(parseFloat(n.borderRightWidth)||0)/f,bottom:(parseFloat(n.borderBottomWidth)||0)/f,left:(parseFloat(n.borderLeftWidth)||0)/f},o.lineWidth.top||(o.lineWidth.right?u="borderRightColor":o.lineWidth.bottom?u="borderBottomColor":o.lineWidth.left&&(u="borderLeftColor"));var x=kk(t,function(w){return s.getComputedStyle(w)[u]});x!=null&&(o.lineColor=x);var g=["left","right","center","justify"];g.indexOf(n.textAlign)!==-1&&(o.halign=n.textAlign),g=["middle","bottom","top"],g.indexOf(n.verticalAlign)!==-1&&(o.valign=n.verticalAlign);var y=parseInt(n.fontSize||"");isNaN(y)||(o.fontSize=y/i);var v=oot(n);v&&(o.fontStyle=v);var b=(n.fontFamily||"").toLowerCase();return e.indexOf(b)!==-1&&(o.font=b),o}function oot(e){var t="";return(e.fontWeight==="bold"||e.fontWeight==="bolder"||parseInt(e.fontWeight)>=700)&&(t="bold"),(e.fontStyle==="italic"||e.fontStyle==="oblique")&&(t+="italic"),t}function kk(e,t){var r=woe(e,t);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var s=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],o=parseInt(n[4]);return o===0||isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function woe(e,t){var r=t(e);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?e.parentElement==null?null:woe(e.parentElement,t):r}function iot(e,t){var r=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],n=96/(72/t),s=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,o=r.map(function(l){return parseInt(l||"0")/n}),i=LA(o,0);return s>i.top&&(i.top=s),s>i.bottom&&(i.bottom=s),i}function _oe(e,t,r,n,s){var o,i;n===void 0&&(n=!1),s===void 0&&(s=!1);var l;typeof t=="string"?l=r.document.querySelector(t):l=t;var c=Object.keys(e.getFontList()),d=e.scaleFactor(),u=[],f=[],h=[];if(!l)return console.error("Html table could not be found with input: ",t),{head:u,body:f,foot:h};for(var m=0;m<l.rows.length;m++){var x=l.rows[m],g=(i=(o=x?.parentElement)===null||o===void 0?void 0:o.tagName)===null||i===void 0?void 0:i.toLowerCase(),y=lot(c,d,r,x,n,s);y&&(g==="thead"?u.push(y):g==="tfoot"?h.push(y):f.push(y))}return{head:u,body:f,foot:h}}function lot(e,t,r,n,s,o){for(var i=new xoe(n),l=0;l<n.cells.length;l++){var c=n.cells[l],d=r.getComputedStyle(c);if(s||d.display!=="none"){var u=void 0;o&&(u=sot(e,c,t,d,r)),i.push({rowSpan:c.rowSpan,colSpan:c.colSpan,styles:u,_element:c,content:cot(c)})}}var f=r.getComputedStyle(n);if(i.length>0&&(s||f.display!=="none"))return i}function cot(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),t.innerText||t.textContent||""}function dot(e,t,r){for(var n=0,s=[e,t,r];n<s.length;n++){var o=s[n];o&&typeof o!="object"&&console.error("The options parameter should be of type object, is: "+typeof o),o.startY&&typeof o.startY!="number"&&(console.error("Invalid value for startY option",o.startY),delete o.startY)}}function hm(e,t,r,n,s){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),i=1;i<arguments.length;i++){var l=arguments[i];if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c])}return o}function bF(e,t){var r=new Vv(e),n=r.getDocumentOptions(),s=r.getGlobalOptions();dot(s,n,t);var o=hm({},s,n,t),i;typeof window<"u"&&(i=window);var l=uot(s,n,t),c=fot(s,n,t),d=mot(r,o),u=pot(r,o,i);return{id:t.tableId,content:u,hooks:c,styles:l,settings:d}}function uot(e,t,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},s=function(c){if(c==="columnStyles"){var d=e[c],u=t[c],f=r[c];n.columnStyles=hm({},d,u,f)}else{var h=[e,t,r],m=h.map(function(x){return x[c]||{}});n[c]=hm({},m[0],m[1],m[2])}},o=0,i=Object.keys(n);o<i.length;o++){var l=i[o];s(l)}return n}function fot(e,t,r){for(var n=[e,t,r],s={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},o=0,i=n;o<i.length;o++){var l=i[o];l.didParseCell&&s.didParseCell.push(l.didParseCell),l.willDrawCell&&s.willDrawCell.push(l.willDrawCell),l.didDrawCell&&s.didDrawCell.push(l.didDrawCell),l.willDrawPage&&s.willDrawPage.push(l.willDrawPage),l.didDrawPage&&s.didDrawPage.push(l.didDrawPage)}return s}function mot(e,t){var r,n,s,o,i,l,c,d,u,f,h,m,x=LA(t.margin,40/e.scaleFactor()),g=(r=hot(e,t.startY))!==null&&r!==void 0?r:x.top,y;t.showFoot===!0?y="everyPage":t.showFoot===!1?y="never":y=(n=t.showFoot)!==null&&n!==void 0?n:"everyPage";var v;t.showHead===!0?v="everyPage":t.showHead===!1?v="never":v=(s=t.showHead)!==null&&s!==void 0?s:"everyPage";var b=(o=t.useCss)!==null&&o!==void 0?o:!1,w=t.theme||(b?"plain":"striped"),_=!!t.horizontalPageBreak,j=(i=t.horizontalPageBreakRepeat)!==null&&i!==void 0?i:null;return{includeHiddenHtml:(l=t.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:b,theme:w,startY:g,margin:x,pageBreak:(c=t.pageBreak)!==null&&c!==void 0?c:"auto",rowPageBreak:(d=t.rowPageBreak)!==null&&d!==void 0?d:"auto",tableWidth:(u=t.tableWidth)!==null&&u!==void 0?u:"auto",showHead:v,showFoot:y,tableLineWidth:(f=t.tableLineWidth)!==null&&f!==void 0?f:0,tableLineColor:(h=t.tableLineColor)!==null&&h!==void 0?h:200,horizontalPageBreak:_,horizontalPageBreakRepeat:j,horizontalPageBreakBehaviour:(m=t.horizontalPageBreakBehaviour)!==null&&m!==void 0?m:"afterAllRows"}}function hot(e,t){var r=e.getLastAutoTable(),n=e.scaleFactor(),s=e.pageNumber(),o=!1;if(r&&r.startPageNumber){var i=r.startPageNumber+r.pageNumber-1;o=i===s}return typeof t=="number"?t:(t==null||t===!1)&&o&&r?.finalY!=null?r.finalY+20/n:null}function pot(e,t,r){var n=t.head||[],s=t.body||[],o=t.foot||[];if(t.html){var i=t.includeHiddenHtml;if(r){var l=_oe(e,t.html,r,i,t.useCss)||{};n=l.head||n,s=l.body||n,o=l.foot||n}else console.error("Cannot parse html in non browser environment")}var c=t.columns||got(n,s,o);return{columns:c,head:n,body:s,foot:o}}function got(e,t,r){var n=e[0]||t[0]||r[0]||[],s=[];return Object.keys(n).filter(function(o){return o!=="_element"}).forEach(function(o){var i=1,l;Array.isArray(n)?l=n[parseInt(o)]:l=n[o],typeof l=="object"&&!Array.isArray(l)&&(i=l?.colSpan||1);for(var c=0;c<i;c++){var d=void 0;Array.isArray(n)?d=s.length:d=o+(c>0?"_".concat(c):"");var u={dataKey:d};s.push(u)}}),s}var fC=function(){function e(t,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=t.getDocument()}return e}(),joe=function(e){goe(t,e);function t(r,n,s,o,i,l){var c=e.call(this,r,n,l)||this;return c.cell=s,c.row=o,c.column=i,c.section=o.section,c}return t}(fC),Noe=function(){function e(t,r){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return e.prototype.getHeadHeight=function(t){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.getFootHeight=function(t){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(t,r,n,s,o,i){for(var l=0,c=r;l<c.length;l++){var d=c[l],u=new joe(t,this,n,s,o,i),f=d(u)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],f)return!1}return!0},e.prototype.callEndPageHooks=function(t,r){t.applyStyles(t.userStyles);for(var n=0,s=this.hooks.didDrawPage;n<s.length;n++){var o=s[n];o(new fC(t,this,r))}},e.prototype.callWillDrawPageHooks=function(t,r){for(var n=0,s=this.hooks.willDrawPage;n<s.length;n++){var o=s[n];o(new fC(t,this,r))}},e.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(s,o){return s+o.wrappedWidth},0);return r}else{var n=this.settings.margin;return t-n.left-n.right}},e}(),wF=function(){function e(t,r,n,s,o){o===void 0&&(o=!1),this.height=0,this.raw=t,t instanceof xoe&&(this.raw=t._element,this.element=t._element),this.index=r,this.section=n,this.cells=s,this.spansMultiplePages=o}return e.prototype.getMaxCellHeight=function(t){var r=this;return t.reduce(function(n,s){var o;return Math.max(n,((o=r.cells[s.index])===null||o===void 0?void 0:o.height)||0)},0)},e.prototype.hasRowSpan=function(t){var r=this;return t.filter(function(n){var s=r.cells[n.index];return s?s.rowSpan>1:!1}).length>0},e.prototype.canEntireRowFit=function(t,r){return this.getMaxCellHeight(r)<=t},e.prototype.getMinimumRowHeight=function(t,r){var n=this;return t.reduce(function(s,o){var i=n.cells[o.index];if(!i)return 0;var l=r.getLineHeight(i.styles.fontSize),c=i.padding("vertical"),d=c+l;return d>s?d:s},0)},e}(),_F=function(){function e(t,r,n){var s;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=t;var o=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,o=(s=t.content)!==null&&s!==void 0?s:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var i=o!=null?""+o:"",l=/\r\n|\r|\n/g;this.text=i.split(l)}return e.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");t=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var s=this.width-this.padding("horizontal");n=this.x+s/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:t}},e.prototype.getContentHeight=function(t,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,s=this.styles.fontSize/t*r,o=n*s+this.padding("vertical");return Math.max(o,this.styles.minCellHeight)},e.prototype.padding=function(t){var r=LA(this.styles.cellPadding,0);return t==="vertical"?r.top+r.bottom:t==="horizontal"?r.left+r.right:r[t]},e}(),Soe=function(){function e(t,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=r,this.index=n}return e.prototype.getMaxCustomCellWidth=function(t){for(var r=0,n=0,s=t.allRows();n<s.length;n++){var o=s[n],i=o.cells[this.index];i&&typeof i.styles.cellWidth=="number"&&(r=Math.max(r,i.styles.cellWidth))}return r},e}();function xot(e,t){vot(e,t);var r=[],n=0;t.columns.forEach(function(o){var i=o.getMaxCustomCellWidth(t);i?o.width=i:(o.width=o.wrappedWidth,r.push(o)),n+=o.width});var s=t.getWidth(e.pageSize().width)-n;s&&(s=q3(r,s,function(o){return Math.max(o.minReadableWidth,o.minWidth)})),s&&(s=q3(r,s,function(o){return o.minWidth})),s=Math.abs(s),!t.settings.horizontalPageBreak&&s>.1/e.scaleFactor()&&(s=s<1?s:Math.round(s),console.warn("Of the table content, ".concat(s," units width could not fit page"))),bot(t),wot(t,e),yot(t)}function vot(e,t){var r=e.scaleFactor(),n=t.settings.horizontalPageBreak,s=boe(e,t);t.allRows().forEach(function(o){for(var i=0,l=t.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d){var u=t.hooks.didParseCell;t.callCellHooks(e,u,d,o,c,null);var f=d.padding("horizontal");d.contentWidth=uC(d.text,d.styles,e)+f;var h=uC(d.text.join(" ").split(/[^\S\u00A0]+/),d.styles,e);if(d.minReadableWidth=h+d.padding("horizontal"),typeof d.styles.cellWidth=="number")d.minWidth=d.styles.cellWidth,d.wrappedWidth=d.styles.cellWidth;else if(d.styles.cellWidth==="wrap"||n===!0)d.contentWidth>s?(d.minWidth=s,d.wrappedWidth=s):(d.minWidth=d.contentWidth,d.wrappedWidth=d.contentWidth);else{var m=10/r;d.minWidth=d.styles.minCellWidth||m,d.wrappedWidth=d.contentWidth,d.minWidth>d.wrappedWidth&&(d.wrappedWidth=d.minWidth)}}}}),t.allRows().forEach(function(o){for(var i=0,l=t.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d&&d.colSpan===1)c.wrappedWidth=Math.max(c.wrappedWidth,d.wrappedWidth),c.minWidth=Math.max(c.minWidth,d.minWidth),c.minReadableWidth=Math.max(c.minReadableWidth,d.minReadableWidth);else{var u=t.styles.columnStyles[c.dataKey]||t.styles.columnStyles[c.index]||{},f=u.cellWidth||u.minCellWidth;f&&typeof f=="number"&&(c.minWidth=f,c.wrappedWidth=f)}d&&(d.colSpan>1&&!c.minWidth&&(c.minWidth=d.minWidth),d.colSpan>1&&!c.wrappedWidth&&(c.wrappedWidth=d.minWidth))}})}function q3(e,t,r){for(var n=t,s=e.reduce(function(m,x){return m+x.wrappedWidth},0),o=0;o<e.length;o++){var i=e[o],l=i.wrappedWidth/s,c=n*l,d=i.width+c,u=r(i),f=d<u?u:d;t-=f-i.width,i.width=f}if(t=Math.round(t*1e10)/1e10,t){var h=e.filter(function(m){return t<0?m.width>r(m):!0});h.length&&(t=q3(h,t,r))}return t}function yot(e){for(var t={},r=1,n=e.allRows(),s=0;s<n.length;s++)for(var o=n[s],i=0,l=e.columns;i<l.length;i++){var c=l[i],d=t[c.index];if(r>1)r--,delete o.cells[c.index];else if(d)d.cell.height+=o.height,r=d.cell.colSpan,delete o.cells[c.index],d.left--,d.left<=1&&delete t[c.index];else{var u=o.cells[c.index];if(!u)continue;if(u.height=o.height,u.rowSpan>1){var f=n.length-s,h=u.rowSpan>f?f:u.rowSpan;t[c.index]={cell:u,left:h,row:o}}}}}function bot(e){for(var t=e.allRows(),r=0;r<t.length;r++)for(var n=t[r],s=null,o=0,i=0,l=0;l<e.columns.length;l++){var c=e.columns[l];if(i-=1,i>1&&e.columns[l+1])o+=c.width,delete n.cells[c.index];else if(s){var d=s;delete n.cells[c.index],s=null,d.width=c.width+o}else{var d=n.cells[c.index];if(!d)continue;if(i=d.colSpan,o=0,d.colSpan>1){s=d,o+=c.width;continue}d.width=c.width+o}}}function wot(e,t){for(var r={count:0,height:0},n=0,s=e.allRows();n<s.length;n++){for(var o=s[n],i=0,l=e.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d){t.applyStyles(d.styles,!0);var u=d.width-d.padding("horizontal");if(d.styles.overflow==="linebreak")d.text=t.splitTextToSize(d.text,u+1/t.scaleFactor(),{fontSize:d.styles.fontSize});else if(d.styles.overflow==="ellipsize")d.text=gV(d.text,u,d.styles,t,"...");else if(d.styles.overflow==="hidden")d.text=gV(d.text,u,d.styles,t,"");else if(typeof d.styles.overflow=="function"){var f=d.styles.overflow(d.text,u);typeof f=="string"?d.text=[f]:d.text=f}d.contentHeight=d.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var h=d.contentHeight/d.rowSpan;d.rowSpan>1&&r.count*r.height<h*d.rowSpan?r={height:h,count:d.rowSpan}:r&&r.count>0&&r.height>h&&(h=r.height),h>o.height&&(o.height=h)}}r.count--}}function gV(e,t,r,n,s){return e.map(function(o){return _ot(o,t,r,n,s)})}function _ot(e,t,r,n,s){var o=1e4*n.scaleFactor();if(t=Math.ceil(t*o)/o,t>=uC(e,r,n))return e;for(;t<uC(e+s,r,n)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+s}function jF(e,t){var r=new Vv(e),n=jot(t,r.scaleFactor()),s=new Noe(t,n);return xot(r,s),r.applyStyles(r.userStyles),s}function jot(e,t){var r=e.content,n=Sot(r.columns);if(r.head.length===0){var s=xV(n,"head");s&&r.head.push(s)}if(r.foot.length===0){var s=xV(n,"foot");s&&r.foot.push(s)}var o=e.settings.theme,i=e.styles;return{columns:n,head:Ik("head",r.head,n,i,o,t),body:Ik("body",r.body,n,i,o,t),foot:Ik("foot",r.foot,n,i,o,t)}}function Ik(e,t,r,n,s,o){var i={},l=t.map(function(c,d){for(var u=0,f={},h=0,m=0,x=0,g=r;x<g.length;x++){var y=g[x];if(i[y.index]==null||i[y.index].left===0)if(m===0){var v=void 0;Array.isArray(c)?v=c[y.index-h-u]:v=c[y.dataKey];var b={};typeof v=="object"&&!Array.isArray(v)&&(b=v?.styles||{});var w=Cot(e,y,d,s,n,o,b),_=new _F(v,w,e);f[y.dataKey]=_,f[y.index]=_,m=_.colSpan-1,i[y.index]={left:_.rowSpan-1,times:m}}else m--,h++;else i[y.index].left--,m=i[y.index].times,u++}return new wF(c,d,e,f)});return l}function xV(e,t){var r={};return e.forEach(function(n){if(n.raw!=null){var s=Not(t,n.raw);s!=null&&(r[n.dataKey]=s)}}),Object.keys(r).length>0?r:null}function Not(e,t){if(e==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(e==="foot"&&typeof t=="object")return t.footer;return null}function Sot(e){return e.map(function(t,r){var n,s;return typeof t=="object"?s=(n=t.dataKey)!==null&&n!==void 0?n:r:s=r,new Soe(s,t,r)})}function Cot(e,t,r,n,s,o,i){var l=aot(n),c;e==="head"?c=s.headStyles:e==="body"?c=s.bodyStyles:e==="foot"&&(c=s.footStyles);var d=hm({},l.table,l[e],s.styles,c),u=s.columnStyles[t.dataKey]||s.columnStyles[t.index]||{},f=e==="body"?u:{},h=e==="body"&&r%2===0?hm({},l.alternateRow,s.alternateRowStyles):{},m=not(o),x=hm({},m,d,h,f);return hm(x,i)}function Aot(e,t,r){var n;r===void 0&&(r={});var s=boe(e,t),o=new Map,i=[],l=[],c=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?c=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(c=[t.settings.horizontalPageBreakRepeat]),c.forEach(function(h){var m=t.columns.find(function(x){return x.dataKey===h||x.index===h});m&&!o.has(m.index)&&(o.set(m.index,!0),i.push(m.index),l.push(t.columns[m.index]),s-=m.wrappedWidth)});for(var d=!0,u=(n=r?.start)!==null&&n!==void 0?n:0;u<t.columns.length;){if(o.has(u)){u++;continue}var f=t.columns[u].wrappedWidth;if(d||s>=f)d=!1,i.push(u),l.push(t.columns[u]),s-=f;else break;u++}return{colIndexes:i,columns:l,lastIndex:u-1}}function Pot(e,t){for(var r=[],n=0;n<t.columns.length;n++){var s=Aot(e,t,{start:n});s.columns.length&&(r.push(s),n=s.lastIndex)}return r}function NF(e,t){var r=t.settings,n=r.startY,s=r.margin,o={x:s.left,y:n},i=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),l=n+s.bottom+i;if(r.pageBreak==="avoid"){var c=t.body,d=c.reduce(function(h,m){return h+m.height},0);l+=d}var u=new Vv(e);(r.pageBreak==="always"||r.startY!=null&&l>u.pageSize().height)&&(Aoe(u),o.y=s.top),t.callWillDrawPageHooks(u,o);var f=hm({},o);t.startPageNumber=u.pageNumber(),r.horizontalPageBreak?Eot(u,t,f,o):(u.applyStyles(u.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&t.head.forEach(function(h){return Dm(u,t,h,o,t.columns)}),u.applyStyles(u.userStyles),t.body.forEach(function(h,m){var x=m===t.body.length-1;mC(u,t,h,x,f,o,t.columns)}),u.applyStyles(u.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&t.foot.forEach(function(h){return Dm(u,t,h,o,t.columns)})),voe(u,t,f,o),t.callEndPageHooks(u,o),t.finalY=o.y,e.lastAutoTable=t,u.applyStyles(u.userStyles)}function Eot(e,t,r,n){var s=Pot(e,t),o=t.settings;if(o.horizontalPageBreakBehaviour==="afterAllRows")s.forEach(function(d,u){e.applyStyles(e.userStyles),u>0?lw(e,t,r,n,d.columns,!0):vV(e,t,n,d.columns),kot(e,t,r,n,d.columns),Ok(e,t,n,d.columns)});else for(var i=-1,l=s[0],c=function(){var d=i;if(l){e.applyStyles(e.userStyles);var u=l.columns;i>=0?lw(e,t,r,n,u,!0):vV(e,t,n,u),d=yV(e,t,i+1,n,u),Ok(e,t,n,u)}var f=d-i;s.slice(1).forEach(function(h){e.applyStyles(e.userStyles),lw(e,t,r,n,h.columns,!0),yV(e,t,i+1,n,h.columns,f),Ok(e,t,n,h.columns)}),i=d};i<t.body.length-1;)c()}function vV(e,t,r,n){var s=t.settings;e.applyStyles(e.userStyles),(s.showHead==="firstPage"||s.showHead==="everyPage")&&t.head.forEach(function(o){return Dm(e,t,o,r,n)})}function kot(e,t,r,n,s){e.applyStyles(e.userStyles),t.body.forEach(function(o,i){var l=i===t.body.length-1;mC(e,t,o,l,r,n,s)})}function yV(e,t,r,n,s,o){e.applyStyles(e.userStyles),o=o??t.body.length;var i=Math.min(r+o,t.body.length),l=-1;return t.body.slice(r,i).forEach(function(c,d){var u=r+d===t.body.length-1,f=Coe(e,t,u,n);c.canEntireRowFit(f,s)&&(Dm(e,t,c,n,s),l=r+d)}),l}function Ok(e,t,r,n){var s=t.settings;e.applyStyles(e.userStyles),(s.showFoot==="lastPage"||s.showFoot==="everyPage")&&t.foot.forEach(function(o){return Dm(e,t,o,r,n)})}function Iot(e,t,r){var n=r.getLineHeight(e.styles.fontSize),s=e.padding("vertical"),o=Math.floor((t-s)/n);return Math.max(0,o)}function Oot(e,t,r,n){var s={};e.spansMultiplePages=!0,e.height=0;for(var o=0,i=0,l=r.columns;i<l.length;i++){var c=l[i],d=e.cells[c.index];if(d){Array.isArray(d.text)||(d.text=[d.text]);var u=new _F(d.raw,d.styles,d.section);u=hm(u,d),u.text=[];var f=Iot(d,t,n);d.text.length>f&&(u.text=d.text.splice(f,d.text.length));var h=n.scaleFactor(),m=n.getLineHeightFactor();d.contentHeight=d.getContentHeight(h,m),d.contentHeight>=t&&(d.contentHeight=t,u.styles.minCellHeight-=t),d.contentHeight>e.height&&(e.height=d.contentHeight),u.contentHeight=u.getContentHeight(h,m),u.contentHeight>o&&(o=u.contentHeight),s[c.index]=u}}var x=new wF(e.raw,-1,e.section,s,!0);x.height=o;for(var g=0,y=r.columns;g<y.length;g++){var c=y[g],u=x.cells[c.index];u&&(u.height=x.height);var d=e.cells[c.index];d&&(d.height=e.height)}return x}function Tot(e,t,r,n){var s=e.pageSize().height,o=n.settings.margin,i=o.top+o.bottom,l=s-i;t.section==="body"&&(l-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var c=t.getMinimumRowHeight(n.columns,e),d=c<r;if(c>l)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!d)return!1;var u=t.hasRowSpan(n.columns),f=t.getMaxCellHeight(n.columns)>l;return f?(u&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(u||n.settings.rowPageBreak==="avoid")}function mC(e,t,r,n,s,o,i){var l=Coe(e,t,n,o);if(r.canEntireRowFit(l,i))Dm(e,t,r,o,i);else if(Tot(e,r,l,t)){var c=Oot(r,l,t,e);Dm(e,t,r,o,i),lw(e,t,s,o,i),mC(e,t,c,n,s,o,i)}else lw(e,t,s,o,i),mC(e,t,r,n,s,o,i)}function Dm(e,t,r,n,s){n.x=t.settings.margin.left;for(var o=0,i=s;o<i.length;o++){var l=i[o],c=r.cells[l.index];if(!c){n.x+=l.width;continue}e.applyStyles(c.styles),c.x=n.x,c.y=n.y;var d=t.callCellHooks(e,t.hooks.willDrawCell,c,r,l,n);if(d===!1){n.x+=l.width;continue}Dot(e,c,n);var u=c.getTextPos();poe(c.text,u.x,u.y,{halign:c.styles.halign,valign:c.styles.valign,maxWidth:Math.ceil(c.width-c.padding("left")-c.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,c,r,l,n),n.x+=l.width}n.y+=r.height}function Dot(e,t,r){var n=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),typeof n.lineWidth=="number"){var s=yoe(n.lineWidth,n.fillColor);s&&e.rect(t.x,r.y,t.width,t.height,s)}else typeof n.lineWidth=="object"&&(n.fillColor&&e.rect(t.x,r.y,t.width,t.height,"F"),Mot(e,t,r,n.lineWidth))}function Mot(e,t,r,n){var s,o,i,l;n.top&&(s=r.x,o=r.y,i=r.x+t.width,l=r.y,n.right&&(i+=.5*n.right),n.left&&(s-=.5*n.left),c(n.top,s,o,i,l)),n.bottom&&(s=r.x,o=r.y+t.height,i=r.x+t.width,l=r.y+t.height,n.right&&(i+=.5*n.right),n.left&&(s-=.5*n.left),c(n.bottom,s,o,i,l)),n.left&&(s=r.x,o=r.y,i=r.x,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.left,s,o,i,l)),n.right&&(s=r.x+t.width,o=r.y,i=r.x+t.width,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.right,s,o,i,l));function c(d,u,f,h,m){e.getDocument().setLineWidth(d),e.getDocument().line(u,f,h,m,"S")}}function Coe(e,t,r,n){var s=t.settings.margin.bottom,o=t.settings.showFoot;return(o==="everyPage"||o==="lastPage"&&r)&&(s+=t.getFootHeight(t.columns)),e.pageSize().height-n.y-s}function lw(e,t,r,n,s,o){s===void 0&&(s=[]),o===void 0&&(o=!1),e.applyStyles(e.userStyles),t.settings.showFoot==="everyPage"&&!o&&t.foot.forEach(function(l){return Dm(e,t,l,n,s)}),t.callEndPageHooks(e,n);var i=t.settings.margin;voe(e,t,r,n),Aoe(e),t.pageNumber++,n.x=i.left,n.y=i.top,r.y=i.top,t.callWillDrawPageHooks(e,n),t.settings.showHead==="everyPage"&&(t.head.forEach(function(l){return Dm(e,t,l,n,s)}),e.applyStyles(e.userStyles))}function Aoe(e){var t=e.pageNumber();e.setPage(t+1);var r=e.pageNumber();return r===t?(e.addPage(),!0):!1}function Poe(e){e.API.autoTable=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0],s=bF(this,n),o=jF(this,s);return NF(this,o),this},e.API.lastAutoTable=!1,e.API.autoTableText=function(t,r,n,s){poe(t,r,n,s,this)},e.API.autoTableSetDefaults=function(t){return Vv.setDefaults(t,this),this},e.autoTableSetDefaults=function(t,r){Vv.setDefaults(t,r)},e.API.autoTableHtmlToJson=function(t,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var s=new Vv(this),o=_oe(s,t,window,r,!1),i=o.head,l=o.body,c=((n=i[0])===null||n===void 0?void 0:n.map(function(d){return d.content}))||[];return{columns:c,rows:l,data:l}}}var Tk;function bV(e,t){var r=bF(e,t),n=jF(e,r);NF(e,n)}function Rot(e,t){var r=bF(e,t);return jF(e,r)}function Fot(e,t){NF(e,t)}try{if(typeof window<"u"&&window){var wV=window,_V=wV.jsPDF||((Tk=wV.jspdf)===null||Tk===void 0?void 0:Tk.jsPDF);_V&&Poe(_V)}}catch(e){console.error("Could not apply autoTable plugin",e)}const Lot=Object.freeze(Object.defineProperty({__proto__:null,Cell:_F,CellHookData:joe,Column:Soe,HookData:fC,Row:wF,Table:Noe,__createTable:Rot,__drawTable:Fot,applyPlugin:Poe,autoTable:bV,default:bV},Symbol.toStringTag,{value:"Module"})),$ot={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.08,delayChildren:.1}}},Hl={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};function nj({icon:e,label:t,value:r,delta:n,positive:s=!0,color:o="brand"}){return a.jsxs(Er.div,{variants:Hl,className:"fx-card border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(e,{className:`w-4 h-4 text-${o}`}),a.jsx("span",{children:t})]}),n!=null&&a.jsxs("div",{className:`text-xs font-bold ${s?"text-success":"text-danger"}`,children:[s?"+":"",n]})]}),a.jsx("div",{className:"text-3xl font-bold text-text-primary tabular-nums",children:r})]})}function Bot(){const{toast:e}=Ss(),{userProfile:t}=qs(),[r,n]=DC(),[s,o]=p.useState(r.get("tab")||"visao-geral"),[i,l]=p.useState(!1),[c,d]=p.useState(()=>{const te=new Date;return new Date(te.getFullYear(),te.getMonth(),1).toISOString().slice(0,10)}),[u,f]=p.useState(()=>new Date().toISOString().slice(0,10)),[h,m]=p.useState(null),[x,g]=p.useState(0),[y,v]=p.useState(0),[b,w]=p.useState([]),[_,j]=p.useState([]),[S,C]=p.useState([]),[A,P]=p.useState([]),[F,O]=p.useState([]),[I,T]=p.useState(0),[k,B]=p.useState(0),[z,U]=p.useState(!1),[L,W]=p.useState(!1),[ge,Ae]=p.useState(null),[V,$]=p.useState([]),[Y,he]=p.useState(!1),[J,G]=p.useState(!1),[ue,ve]=p.useState(!1),[ae,oe]=p.useState(null),[me,De]=p.useState([]),[ne,ie]=p.useState([]);p.useState({open:!1,tipo:"suprimento",valor:"",observacao:"",loading:!1});const[ht,pt]=p.useState(!1),[Ze,vt]=p.useState(!1),[wt,gt]=p.useState(null),[er,_e]=p.useState([]),[Pt,Lt]=p.useState(""),[gr,fr]=p.useState("all"),[je,nt]=p.useState("all"),[$t,Ut]=p.useState([]),[Fe,xt]=p.useState(""),[Ot,Cr]=p.useState("all"),[Me,Qe]=p.useState("all"),[et,Yt]=p.useState(new Set),[xr,Jt]=p.useState(!1),[kr,_r]=p.useState(!1),[Rr,nn]=p.useState(null),[rn,Ke]=p.useState([]),[qe,ze]=p.useState(!1),[Je,kt]=p.useState([]);p.useState("");const ct=te=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(te||0)),tr=te=>Number(te||0).toFixed(2),dt=async(te,Te,at,ee)=>{try{const{default:Se}=await Pf(()=>Promise.resolve().then(()=>xZe),void 0);await Pf(()=>Promise.resolve().then(()=>Lot),void 0);const $e=new Se("p","mm","a4"),Be=$e.internal.pageSize.getWidth();if($e.setFontSize(20),$e.setTextColor(245,158,11),$e.text(te,14,20),$e.setDrawColor(245,158,11),$e.setLineWidth(.5),$e.line(14,23,Be-14,23),$e.setFontSize(10),$e.setTextColor(100,100,100),$e.text(`Perodo: ${c||"N/A"} at ${u||"N/A"}`,14,30),$e.text(`Gerado em: ${new Date().toLocaleString("pt-BR")}`,14,35),typeof $e.autoTable=="function"){$e.autoTable({head:[Te],body:at,startY:42,theme:"striped",headStyles:{fillColor:[245,158,11],textColor:[255,255,255],fontStyle:"bold",fontSize:11},bodyStyles:{fontSize:10,textColor:[50,50,50]},alternateRowStyles:{fillColor:[249,249,249]},margin:{top:42,left:14,right:14}});const Ge=$e.lastAutoTable.finalY||50;$e.setFontSize(8),$e.setTextColor(150,150,150),$e.text("Relatrio gerado por Fluxo7Arena - Sistema de Gesto de Quadras Esportivas",Be/2,Ge+15,{align:"center"})}else{let Ge=45;$e.setFontSize(11),$e.setTextColor(0,0,0),Te.forEach((Ye,ft)=>{const yt=14+ft*60;$e.text(Ye,yt,Ge)}),Ge+=7,$e.setFontSize(10),at.forEach(Ye=>{Ye.forEach((ft,yt)=>{const Et=14+yt*60;$e.text(String(ft),Et,Ge)}),Ge+=6})}$e.save(`${ee}_${sr(new Date,"yyyy-MM-dd")}.pdf`),e({title:"PDF baixado com sucesso!",description:"O arquivo foi salvo na sua pasta de downloads"})}catch(Se){console.error("Erro ao gerar PDF:",Se),e({title:"Erro ao gerar PDF",description:Se.message,variant:"destructive"})}},Mt=async()=>{try{const te=["Abertura","Fechamento","Saldo Inicial","Saldo Final","Valor Final (Dinheiro)","Diferena","Status"],Te=(ne||[]).map(at=>[at?.aberto_em?new Date(at.aberto_em).toLocaleString("pt-BR"):"-",at?.fechado_em?new Date(at.fechado_em).toLocaleString("pt-BR"):"-",ct(at?.saldo_inicial||0),at?.saldo_final!=null?ct(at.saldo_final):ct(0),at?.valor_final_dinheiro!=null?ct(at.valor_final_dinheiro):"",at?.diferenca_dinheiro!=null?ct(at.diferenca_dinheiro):"",String(at?.status||"").toUpperCase()]);await dt("Fechamentos de Caixa",te,Te,"fechamentos_caixa")}catch(te){e({title:"Erro ao exportar PDF",description:te?.message||"Tente novamente",variant:"destructive"})}},ce=()=>{try{const te=";",at=[["Abertura","Fechamento","Saldo Inicial","Saldo Final","Valor Final (Dinheiro)","Diferena","Status"].join(te)];(ne||[]).forEach(Be=>{const Ge=Be?.aberto_em?new Date(Be.aberto_em).toLocaleString("pt-BR"):"-",Ye=Be?.fechado_em?new Date(Be.fechado_em).toLocaleString("pt-BR"):"-",ft=Number(Be?.saldo_inicial||0).toFixed(2).replace(".",","),yt=(Be?.saldo_final!=null?Number(Be.saldo_final):0).toFixed(2).replace(".",","),Et=Be?.valor_final_dinheiro!=null?Number(Be.valor_final_dinheiro):null,br=Be?.diferenca_dinheiro!=null?Number(Be.diferenca_dinheiro):null,Ue=String(Be?.status||"").toUpperCase();at.push([Ge,Ye,ft,yt,Et!=null?Et.toFixed(2).replace(".",","):"",br!=null?br.toFixed(2).replace(".",","):"",Ue].join(te))});const ee=new Blob(["\uFEFF"+at.join(`
`)],{type:"text/csv;charset=utf-8;"}),Se=URL.createObjectURL(ee),$e=document.createElement("a");$e.href=Se,$e.download=`fechamentos_caixa_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild($e),$e.click(),document.body.removeChild($e),URL.revokeObjectURL(Se),e({title:"CSV baixado com sucesso!"})}catch(te){e({title:"Erro ao exportar CSV",description:te?.message||"Tente novamente",variant:"destructive"})}},Xe=({cx:te,cy:Te,midAngle:at,outerRadius:ee,percent:Se})=>{const $e=Math.PI/180,Be=(ee||0)+12,Ge=te+Be*Math.cos(-at*$e),Ye=Te+Be*Math.sin(-at*$e);return a.jsx("text",{x:Ge,y:Ye,fill:"#fff",textAnchor:Ge>te?"start":"end",dominantBaseline:"central",style:{pointerEvents:"none",fontSize:15,fontWeight:700},children:`${Math.round((Se||0)*100)}%`})},Qt=te=>{const Te=Wt!=null&&Wt!==te;return{transition:"opacity 320ms ease-in-out, filter 320ms ease-in-out",opacity:Te?.25:1,filter:Te?"grayscale(15%)":"none",cursor:"pointer"}};p.useEffect(()=>{(async()=>{if(!kr||!Rr||Rr.origem!=="Comanda"||!Rr.comanda_id){Ke([]),kt([]);return}try{ze(!0);const Te=t?.codigo_empresa;let at=re.from("comanda_itens").select("descricao, quantidade, preco_unitario").eq("comanda_id",Rr.comanda_id);Te&&(at=at.eq("codigo_empresa",Te));const{data:ee}=await at;Ke(ee||[]);let Se=re.from("pagamentos").select("id, valor, metodo, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").eq("comanda_id",Rr.comanda_id);Te&&(Se=Se.eq("codigo_empresa",Te));const{data:$e}=await Se;kt($e||[])}catch(Te){console.warn("[Financeiro][RecebimentoModal] Falha ao carregar itens da comanda:",Te?.message),Ke([]),kt([])}finally{ze(!1)}})()},[kr,Rr,t?.codigo_empresa]);const Tt=async()=>{try{l(!0);const te=gn(c)||void 0,Te=tt(u)||void 0,at=t?.codigo_empresa;console.debug("[Financeiro][VisaoGeral] Carregando com perodo:",{fromISO:te,toISO:Te,codigo:at});const ee=await Jd({from:te,to:Te}).catch(()=>null);m(ee||{totalPorFinalizadora:{},totalEntradas:0,totalVendasBrutas:0,totalDescontos:0,totalVendasLiquidas:0}),console.debug("[Financeiro][VisaoGeral] Resumo calculado:",ee);try{let Se=re.from("pagamentos").select("valor, status").eq("codigo_empresa",at);te&&(Se=Se.gte("recebido_em",te)),Te&&(Se=Se.lte("recebido_em",Te));const{data:$e}=await Se,Be=($e||[]).reduce((yt,Et)=>{const br=Et.status||"Pago";return br==="Cancelado"||br==="Estornado"?yt:yt+Number(Et.valor||0)},0);g(Be);let Ge=re.from("agendamentos").select("id").eq("codigo_empresa",at);te&&(Ge=Ge.gte("inicio",te)),Te&&(Ge=Ge.lte("inicio",Te));const{data:Ye}=await Ge;let ft=0;if(Ye&&Ye.length>0){const yt=Ye.map(br=>br.id),{data:Et}=await re.from("agendamento_participantes").select("valor_cota, aplicar_taxa, finalizadoras!agp_finalizadora_id_fkey(taxa_percentual)").eq("codigo_empresa",at).in("agendamento_id",yt).eq("status_pagamento","Pago");ft=(Et||[]).reduce((br,Ue)=>{let St=Number(Ue.valor_cota||0);if(Ue.aplicar_taxa===!0){const Nr=Number(Ue.finalizadoras?.taxa_percentual||0);Nr>0&&(St=St/(1+Nr/100))}return br+St},0)}v(ft),console.debug("[Financeiro][VisaoGeral] Receitas por origem:",{totalComandas:Be,totalAg:ft})}catch(Se){console.warn("[Financeiro][VisaoGeral] Falha ao calcular KPIs por origem:",Se?.message),g(0),v(0)}try{let Se=re.from("pagamentos").select("valor, status, origem").eq("codigo_empresa",at).eq("origem","xml");te&&(Se=Se.gte("recebido_em",te)),Te&&(Se=Se.lte("recebido_em",Te));const{data:$e}=await Se,Be=($e||[]).reduce((Ye,ft)=>["Cancelado","Estornado"].includes(ft.status)?Ye:Ye+Number(ft.valor||0),0);T(Be);const{count:Ge}=await re.from("produtos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",at).or("importado_via_xml.is.true,categoria.ilike.Importados").gte("criado_em",te).lte("criado_em",Te);B(Ge||0)}catch(Se){console.warn("[Financeiro][VisaoGeral] Falha KPIs XML:",Se?.message),T(0),B(0)}if(at){let Se=re.from("comandas").select("id").eq("status","closed");at&&(Se=Se.eq("codigo_empresa",at)),te&&(Se=Se.gte("fechado_em",te)),Te&&(Se=Se.lte("fechado_em",Te));const{data:$e,error:Be}=await Se;if(Be)throw Be;const Ge=($e||[]).map(Et=>Et.id);console.debug("[Financeiro][VisaoGeral] Comandas fechadas:",Ge.length);let Ye=[];if(Ge.length>0){let Et=re.from("comanda_itens").select("produto_id, quantidade, preco_unitario, produtos!comanda_itens_produto_id_fkey(nome)").in("comanda_id",Ge);at&&(Et=Et.eq("codigo_empresa",at));const{data:br}=await Et;Ye=br||[]}const ft={};(Ye||[]).forEach(Et=>{const br=Et.produtos?.nome||"Produto sem nome",Ue=Number(Et.quantidade||0),St=Ue*Number(Et.preco_unitario||0);ft[br]||(ft[br]={quantidade:0,valor:0}),ft[br].quantidade+=Ue,ft[br].valor+=St});const yt=Object.entries(ft).map(([Et,br])=>({nome:Et,quantidade:br.quantidade,valor:br.valor})).sort((Et,br)=>br.valor-Et.valor);C(yt),w(yt.slice(0,5)),console.debug("[Financeiro][VisaoGeral] Produtos agregados:",{total:yt.length,top5:yt.slice(0,5)})}if(at)try{let Se=re.from("pagamentos").select("comanda_id, valor, status").eq("codigo_empresa",at).neq("status","Cancelado").neq("status","Estornado");te&&(Se=Se.gte("recebido_em",te)),Te&&(Se=Se.lte("recebido_em",Te));const{data:$e}=await Se;console.debug("[Financeiro][VisaoGeral] Pagamentos carregados:",($e||[]).length);const Be=Array.from(new Set(($e||[]).map(Ue=>Ue.comanda_id).filter(Boolean)));let Ge=[];if(Be.length>0){let Ue=re.from("comanda_clientes").select("comanda_id, cliente_id, nome_livre").in("comanda_id",Be).eq("codigo_empresa",at);const{data:St}=await Ue;Ge=St||[]}console.debug("[Financeiro][VisaoGeral] Vinculos comanda_clientes:",Ge.length);const Ye=Array.from(new Set(Ge.map(Ue=>Ue.cliente_id).filter(Boolean))),ft={};if(Ye.length>0){const{data:Ue}=await re.from("clientes").select("id, nome").in("id",Ye).eq("codigo_empresa",at);(Ue||[]).forEach(St=>{ft[St.id]=St.nome})}const yt={};Ge.forEach(Ue=>{const St=Ue.nome_livre||ft[Ue.cliente_id]||`Cliente ${Ue.cliente_id||""}`;yt[Ue.comanda_id]||(yt[Ue.comanda_id]=new Set),St&&yt[Ue.comanda_id].add(St)});const Et={};($e||[]).forEach(Ue=>{const St=Array.from(yt[Ue.comanda_id]||[]),Nr=Number(Ue.valor||0);if(St.length===0){const an="Sem cliente";Et[an]||(Et[an]={id:null,nome:an,valor:0}),Et[an].valor+=Nr}else St.forEach(an=>{Et[an]||(Et[an]={id:null,nome:an,valor:0}),Et[an].valor+=Nr})});try{const Ue=new Map(Object.values(ft).map((zn,Fn)=>[Object.keys(ft)[Fn],zn]));let St=re.from("v_agendamento_participantes").select("agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text");at&&(St=St.eq("codigo_empresa",at));let{data:Nr}=await St;Nr=Nr||[];const an=Array.from(new Set(Nr.map(zn=>zn.agendamento_id).filter(Boolean)));let Lr=new Set;if(an.length>0){let zn=re.from("agendamentos").select("id, inicio").in("id",an);at&&(zn=zn.eq("codigo_empresa",at));const{data:Fn}=await zn,en=te?new Date(te).getTime():null,Wa=Te?new Date(Te).getTime():null;(Fn||[]).forEach(Ya=>{const za=Ya?.inicio?new Date(Ya.inicio).getTime():null;za!=null&&(en==null||za>=en)&&(Wa==null||za<=Wa)&&Lr.add(Ya.id)})}const On=Nr.filter(zn=>Lr.has(zn.agendamento_id));console.debug("[Financeiro][Agendamentos] participantes no perodo (by agendamento.inicio):",On.length);const Ta=Array.from(new Set((On||[]).map(zn=>zn.cliente_id).filter(Boolean).map(String))).filter(zn=>!Ue.has(zn));if(Ta.length>0){const{data:zn}=await re.from("clientes").select("id,nome").in("id",Ta);(zn||[]).forEach(Fn=>Ue.set(String(Fn.id),Fn.nome))}(On||[]).forEach(zn=>{const Fn=String(zn.status_pagamento||zn.status_pagamento_text||"pago").toLowerCase();if(["cancelado","estornado"].includes(Fn))return;const en=zn.cliente_id,Wa=en?Ue.get(String(en))||`Cliente ${en}`:null;if(!Wa)return;const Ya=Number(zn.valor_cota||0);Et[Wa]||(Et[Wa]={id:en||null,nome:Wa,valor:0}),Et[Wa].valor+=Ya})}catch{}const br=Object.values(Et).sort((Ue,St)=>St.valor-Ue.valor);P(br),j(br.slice(0,5)),console.debug("[Financeiro][VisaoGeral] Clientes agregados:",{total:br.length,top5:br.slice(0,5)})}catch(Se){console.error("Erro ao carregar top clientes:",Se),j([]),P([])}if(at&&te&&Te)try{let Se=re.from("pagamentos").select("recebido_em, valor, status").eq("codigo_empresa",at).gte("recebido_em",te).lte("recebido_em",Te).order("recebido_em",{ascending:!0});const{data:$e}=await Se;let Be=re.from("v_agendamentos_detalhado").select("inicio, valor_pago, status_pagamento").eq("codigo_empresa",at).eq("status_pagamento","Pago").gte("inicio",te).lte("inicio",Te).order("inicio",{ascending:!0});const{data:Ge}=await Be,Ye={};($e||[]).forEach(yt=>{if(["Cancelado","Estornado"].includes(yt.status))return;const Et=new Date(yt.recebido_em).toLocaleDateString("pt-BR");Ye[Et]=(Ye[Et]||0)+Number(yt.valor||0)}),(Ge||[]).forEach(yt=>{const Et=new Date(yt.inicio).toLocaleDateString("pt-BR");Ye[Et]=(Ye[Et]||0)+Number(yt.valor_pago||0)});const ft=Object.entries(Ye).map(([yt,Et])=>({data:yt,valor:Et})).sort((yt,Et)=>{const[br,Ue,St]=yt.data.split("/").map(Number),[Nr,an,Lr]=Et.data.split("/").map(Number);return new Date(St,Ue-1,br).getTime()-new Date(Lr,an-1,Nr).getTime()});O(ft),console.debug("[Financeiro][VisaoGeral] Evoluo diria:",ft.length,"dias")}catch(Se){console.warn("[Financeiro][VisaoGeral] Falha ao calcular evoluo diria:",Se?.message),O([])}else O([])}catch(te){e({title:"Falha ao carregar viso geral",description:te?.message||"Tente novamente",variant:"destructive"})}finally{l(!1)}},Ar=async()=>{try{const te=t?.codigo_empresa,Te=await Eh({codigoEmpresa:te});if(ve(!!Te),Te){const[ee,Se]=await Promise.all([j1({codigoEmpresa:te}),kg({caixaSessaoId:Te.id,codigoEmpresa:te})]);oe(ee||null),De(Se||[])}else oe(null),De([]);const at=await lne({limit:50,codigoEmpresa:te});if(console.log("[FinanceiroPage][loadCaixa] Histrico recebido de listarFechamentosCaixa:",at?.length,"sesses"),at&&at.length>0){console.log("[FinanceiroPage][loadCaixa] Primeira sesso do histrico:",at[0]);const ee=at.filter(Se=>Se.valor_final_dinheiro!=null);console.log("[FinanceiroPage][loadCaixa] Sesses com valor_final_dinheiro:",ee.length,"/",at.length)}ie(at||[])}catch(te){e({title:"Falha ao carregar caixa",description:te?.message,variant:"destructive"})}},nr=async()=>{try{l(!0);const te=t?.codigo_empresa,Te=gn(c)||void 0,at=tt(u)||void 0;let ee=re.from("pagamentos").select("id, comanda_id, valor, status, metodo, recebido_em, origem, xml_chave, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").eq("codigo_empresa",te).order("recebido_em",{ascending:!1});Te&&(ee=ee.gte("recebido_em",Te)),at&&(ee=ee.lte("recebido_em",at));const{data:Se}=await ee;let $e=new Map,Be=new Map;try{const Et=Array.from(new Set((Se||[]).map(br=>br.comanda_id).filter(Boolean)));if(Et.length>0){const{data:br}=await re.from("comandas").select("id, cliente_id, tipo").in("id",Et).eq("codigo_empresa",te),Ue=Array.from(new Set((br||[]).map(an=>an.cliente_id).filter(Boolean)));let St=new Map;if(Ue.length>0){const{data:an}=await re.from("clientes").select("id, nome").in("id",Ue).eq("codigo_empresa",te);St=new Map((an||[]).map(Lr=>[Lr.id,Lr.nome]))}for(const an of br||[]){if(!an)continue;const Lr=St.get(an.cliente_id)||null;$e.set(an.id,Lr),Be.set(an.id,an.tipo||null)}const Nr=(br||[]).filter(an=>!an?.cliente_id).map(an=>an.id);if(Nr.length>0)try{const{data:an}=await re.from("comanda_clientes").select("comanda_id, cliente_id").in("comanda_id",Nr).eq("codigo_empresa",te),Lr=Array.from(new Set((an||[]).map(On=>On.cliente_id).filter(Boolean)));if(Lr.length>0){const{data:On}=await re.from("clientes").select("id, nome").in("id",Lr).eq("codigo_empresa",te),Qn=new Map((On||[]).map(Ta=>[Ta.id,Ta.nome]));for(const Ta of an||[]){const zn=Qn.get(Ta.cliente_id)||null;zn&&!$e.get(Ta.comanda_id)&&$e.set(Ta.comanda_id,zn)}}}catch{console.debug("[Financeiro][Recebimentos] comanda_clientes indisponvel (ok)")}}}catch(Et){console.warn("[Financeiro][Recebimentos] Falha ao buscar clientes de comandas:",Et?.message)}let Ge=re.from("v_agendamentos_detalhado").select("agendamento_id, agendamento_codigo, inicio, quadra_nome, participante_nome, valor_cota, status_pagamento, finalizadora_nome").eq("codigo_empresa",te).eq("status_pagamento","Pago").order("inicio",{ascending:!1});Te&&(Ge=Ge.gte("inicio",Te)),at&&(Ge=Ge.lte("inicio",at));const{data:Ye}=await Ge,ft=(Se||[]).map(Et=>({id:Et.id,origem:Be.get(Et.comanda_id||"")==="balcao"?"Balco":"Comanda",comanda_id:Et.comanda_id||null,recebido_em:Et.recebido_em,finalizadoras:Et.finalizadoras,metodo:Et.metodo,valor:Et.valor,status:Et.status,descricao:$e.get(Et.comanda_id||"")||null,fonte:Et.origem||"manual",xml_chave:Et.xml_chave||null})),yt=(Ye||[]).map((Et,br)=>({id:`ag-${Et.agendamento_id}-${br}`,origem:"Agendamento",recebido_em:Et.inicio,finalizadoras:Et.finalizadora_nome?{nome:Et.finalizadora_nome}:null,metodo:Et.finalizadora_nome||null,valor:Et.valor_cota,status:Et.status_pagamento,descricao:`#${Et.agendamento_codigo} - ${Et.participante_nome} (${Et.quadra_nome||""})`,agendamento_codigo:Et.agendamento_codigo,quadra_nome:Et.quadra_nome,participante_nome:Et.participante_nome,fonte:null}));_e([...ft,...yt])}catch(te){e({title:"Falha ao carregar recebimentos",description:te?.message,variant:"destructive"})}finally{l(!1)}},Jr=async()=>{try{l(!0);const te=t?.codigo_empresa,Te=gn(c)||void 0,at=tt(u)||void 0;let ee=re.from("v_agendamentos_detalhado").select("agendamento_id, agendamento_codigo, inicio, fim, quadra_nome, participante_nome, cliente_id, valor_cota, finalizadora_nome, status_pagamento").eq("codigo_empresa",te).order("inicio",{ascending:!1});Te&&(ee=ee.gte("inicio",Te)),at&&(ee=ee.lte("inicio",at));const{data:Se}=await ee,$e=[...new Set((Se||[]).map(Ye=>Ye.cliente_id).filter(Boolean))];let Be={};if($e.length>0){const{data:Ye}=await re.from("clientes").select("id, is_consumidor_final, codigo").in("id",$e).eq("codigo_empresa",te);Ye&&(Be=Object.fromEntries(Ye.map(ft=>[ft.id,ft])))}const Ge=(Se||[]).map(Ye=>({...Ye,is_consumidor_final:Be[Ye.cliente_id]?.is_consumidor_final||!1,cliente_codigo:Be[Ye.cliente_id]?.codigo||null}));Ut(Ge)}catch(te){e({title:"Falha ao carregar agendamentos",description:te?.message,variant:"destructive"})}finally{l(!1)}};p.useEffect(()=>{n({tab:s})},[s]);const gn=te=>{if(!te)return null;if(typeof te=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(te)){const[Te,at,ee]=te.split("-").map(Number);return new Date(Te,at-1,ee,0,0,0,0).toISOString()}return new Date(te).toISOString()},tt=te=>{if(!te)return null;if(typeof te=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(te)){const[Te,at,ee]=te.split("-").map(Number);return new Date(Te,at-1,ee,23,59,59,999).toISOString()}return new Date(te).toISOString()};p.useEffect(()=>{t?.codigo_empresa&&(s==="visao-geral"||s==="relatorios"?Tt():s==="caixa"?Ar():s==="recebimentos"?nr():s==="agendamentos"&&Jr())},[s,c,u,t?.codigo_empresa]);const jr=p.useMemo(()=>{const te=h?.totalPorFinalizadora||{},Te=Object.entries(te).map(([at,ee])=>({name:at,valor:Number(ee||0)}));return Te.sort((at,ee)=>ee.valor-at.valor),Te},[h]),[ua,Oe]=p.useState(null),[Wt,Ht]=p.useState(null),mr={start:90,end:-270},Gt=(te,Te,at)=>te+(Te-te)*at,pn=te=>te<.5?4*te*te*te:1-Math.pow(-2*te+2,3)/2,jt=te=>{const Te=Number(x||0),at=Number(y||0),ee=Math.max(1e-4,Te+at),Se=360*(Te/ee);return te===0?{a:mr.start,b:mr.start-Se}:{a:mr.start-Se,b:mr.end}},[ur,rt]=p.useState({from:null,to:null,t:1}),Dt=Wt??ua;p.useEffect(()=>{if(Dt==null)return;const te=jt(Dt);rt($e=>({from:$e.to||te,to:te,t:0}));let Te;const at=performance.now(),ee=380,Se=$e=>{const Be=Math.min(1,($e-at)/ee),Ge=pn(Be);rt(Ye=>({...Ye,t:Ge})),Be<1&&(Te=requestAnimationFrame(Se))};return Te=requestAnimationFrame(Se),()=>Te&&cancelAnimationFrame(Te)},[Dt,x,y]);const Xt=86,Tr=94,qn=80,[Gr,ar]=p.useState({from:[Xt,Xt],to:[Xt,Xt],t:1});p.useEffect(()=>{const te=Dt===0?[Tr,qn]:Dt===1?[qn,Tr]:[Xt,Xt];ar($e=>({from:$e.to||te,to:te,t:0}));let Te;const at=performance.now(),ee=380,Se=$e=>{const Be=Math.min(1,($e-at)/ee),Ge=pn(Be);ar(Ye=>({...Ye,t:Ge})),Be<1&&(Te=requestAnimationFrame(Se))};return Te=requestAnimationFrame(Se),()=>Te&&cancelAnimationFrame(Te)},[Dt]);const kn=({cx:te,cy:Te,outerRadius:at})=>{if(!ur.from||!ur.to)return null;const ee=Gt(ur.from.a,ur.to.a,ur.t),Se=Gt(ur.from.b,ur.to.b,ur.t),$e=Dt===0?"#22C55E":"#F59E0B";return a.jsx(JM,{cx:te,cy:Te,innerRadius:0,outerRadius:(at||0)+4,startAngle:ee,endAngle:Se,fill:$e,fillOpacity:.18,stroke:"transparent"})},Xn=p.useMemo(()=>{let te=er;if(Pt){const Te=Pt.toLowerCase();te=te.filter(at=>(at.descricao||"").toLowerCase().includes(Te)||(at.finalizadoras?.nome||"").toLowerCase().includes(Te)||String(at.valor||"").includes(Te)||(at.origem||"").toLowerCase().includes(Te))}return gr!=="all"&&(te=te.filter(Te=>(Te.finalizadoras?.nome||Te.metodo)===gr)),je!=="all"&&(te=te.filter(Te=>(Te.fonte||"manual")===je)),te},[er,Pt,gr,je]),aa=p.useMemo(()=>{const te={};return($t||[]).forEach(Te=>{const at=Te.agendamento_id||Te.agendamento_codigo;te[at]||(te[at]={agendamento_id:Te.agendamento_id,agendamento_codigo:Te.agendamento_codigo,inicio:Te.inicio,fim:Te.fim,quadra_nome:Te.quadra_nome,participantes:[],total:0,totalPago:0,totalPendente:0,statusGeral:"Pendente",representante:"",representanteClienteId:null,representanteCodigo:null,isRepresentanteConsumidor:!1}),te[at].participantes.push(Te),te[at].total+=Number(Te.valor_cota||0),Te.status_pagamento==="Pago"?te[at].totalPago+=Number(Te.valor_cota||0):te[at].totalPendente+=Number(Te.valor_cota||0)}),Object.values(te).forEach(Te=>{const at=Te.participantes.every(Se=>Se.status_pagamento==="Pago");if(Te.participantes.every(Se=>Se.status_pagamento==="Cancelado")?Te.statusGeral="Cancelado":at?Te.statusGeral="Pago":Te.statusGeral="Pendente",Te.participantes.length>0){let Se=Te.participantes.find(Be=>!Be.is_consumidor_final);Se||(Se=Te.participantes[0]);let $e=Se?.participante_nome||"";Se?.is_consumidor_final&&$e&&($e.toLowerCase().includes("cliente consumidor")||($e=$e)),Te.representante=$e,Te.representanteClienteId=Se?.cliente_id||null,Te.representanteCodigo=Se?.is_consumidor_final?0:Se?.cliente_codigo??null,Te.isRepresentanteConsumidor=Se?.is_consumidor_final||!1}}),Object.values(te).sort((Te,at)=>new Date(at.inicio)-new Date(Te.inicio))},[$t]),pa=p.useMemo(()=>{const te=Fe.toLowerCase().trim();return aa.filter(Te=>{if(Ot!=="all"&&(Ot==="Pago"&&Te.statusGeral!=="Pago"||Ot==="Pendente"&&Te.statusGeral!=="Pendente"||Ot==="Cancelado"&&Te.statusGeral!=="Cancelado")||Me!=="all"&&!Te.participantes.some(Be=>Be.finalizadora_nome===Me))return!1;if(!te)return!0;const at=String(Te.agendamento_codigo||""),ee=String(Te.quadra_nome||"").toLowerCase(),Se=Te.participantes.map($e=>String($e.participante_nome||"").toLowerCase()).join(" ");return at.includes(te)||ee.includes(te)||Se.includes(te)})},[aa,Fe,Ot,Me]);return a.jsx(a.Fragment,{children:a.jsxs(Er.div,{variants:$ot,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsx(Er.div,{variants:Hl,className:"fx-card p-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Financeiro"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Gesto completa das finanas da empresa"})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-stretch sm:items-center gap-3 w-full sm:w-auto",children:[a.jsxs("div",{className:"flex flex-col justify-center flex-1 sm:flex-initial",children:[a.jsx("label",{className:"text-xs text-text-secondary mb-1",children:"Incio"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:"h-9 w-full sm:w-[160px] pl-3 pr-3 flex items-center gap-2 justify-start text-left font-medium bg-black border-warning/40 text-white hover:bg-black/80 hover:border-warning",children:[a.jsx(lo,{className:"h-5 w-5 text-warning flex-shrink-0"}),a.jsx("span",{className:"font-mono tracking-wide text-sm leading-none",children:c?sr(new Date(c+"T00:00:00"),"dd/MM/yyyy",{locale:ga}):"Selecione"})]})}),a.jsx(Go,{className:"w-auto p-0 bg-black border-warning/40",align:"start",children:a.jsx(oi,{mode:"single",selected:c?new Date(c+"T00:00:00"):void 0,onSelect:te=>te&&d(sr(te,"yyyy-MM-dd")),initialFocus:!0,classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md border-warning/40"}})})]})]}),a.jsxs("div",{className:"flex flex-col justify-center flex-1 sm:flex-initial",children:[a.jsx("label",{className:"text-xs text-text-secondary mb-1",children:"Fim"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:"h-9 w-full sm:w-[160px] pl-3 pr-3 flex items-center gap-2 justify-start text-left font-medium bg-black border-warning/40 text-white hover:bg-black/80 hover:border-warning",children:[a.jsx(lo,{className:"h-5 w-5 text-warning flex-shrink-0"}),a.jsx("span",{className:"font-mono tracking-wide text-sm leading-none",children:u?sr(new Date(u+"T00:00:00"),"dd/MM/yyyy",{locale:ga}):"Selecione"})]})}),a.jsx(Go,{className:"w-auto p-0 bg-black border-warning/40",align:"start",children:a.jsx(oi,{mode:"single",selected:u?new Date(u+"T00:00:00"):void 0,onSelect:te=>te&&f(sr(te,"yyyy-MM-dd")),initialFocus:!0,classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md border-warning/40"}})})]})]})]})]})}),a.jsxs(od,{value:s,onValueChange:o,children:[a.jsx("div",{className:"md:hidden mb-4",children:a.jsxs(Gn,{value:s,onValueChange:o,children:[a.jsx(Vn,{className:"w-full h-11 bg-black border-warning/40 text-white",children:a.jsx(Kn,{placeholder:"Selecione uma aba"})}),a.jsxs(Wn,{className:"bg-black text-white border-warning/40",children:[a.jsx(lt,{value:"visao-geral",children:"Viso Geral"}),a.jsx(lt,{value:"caixa",children:"Caixa"}),a.jsx(lt,{value:"recebimentos",children:"Recebimentos"}),a.jsx(lt,{value:"agendamentos",children:"Agendamentos"}),a.jsx(lt,{value:"relatorios",children:"Relatrios"})]})]})}),a.jsxs(sc,{className:"hidden md:grid w-full grid-cols-5",children:[a.jsx(Pa,{value:"visao-geral",children:"Viso Geral"}),a.jsx(Pa,{value:"caixa",children:"Caixa"}),a.jsx(Pa,{value:"recebimentos",children:"Recebimentos"}),a.jsx(Pa,{value:"agendamentos",children:"Agendamentos"}),a.jsx(Pa,{value:"relatorios",children:"Relatrios"})]}),a.jsxs(Gs,{value:"visao-geral",className:"space-y-6 mt-6",children:[a.jsxs(Er.div,{variants:Hl,className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[a.jsx(nj,{icon:CG,label:"Total Geral",value:ct(Number(x||0)+Number(y||0)),color:"brand"}),a.jsx(nj,{icon:W1,label:"Comandas",value:ct(x),color:"success"}),a.jsx(nj,{icon:lo,label:"Agendamentos",value:ct(y),color:"success"}),a.jsx(nj,{icon:Nh,label:"XML (Recebimentos)",value:ct(I),color:"success"})]}),a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(Nh,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Proporo de Receita"})]})}),Number(x||0)+Number(y||0)===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem receitas no perodo."}):a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[a.jsx("div",{className:"w-full md:flex-1 h-[280px]",children:a.jsx(zb,{width:"100%",height:"100%",children:a.jsxs(xUe,{children:[a.jsxs(Ff,{data:function(){const te=Gt(Gr.from?.[0]??Xt,Gr.to?.[0]??Xt,Gr.t),Te=Gt(Gr.from?.[1]??Xt,Gr.to?.[1]??Xt,Gr.t);return[{name:"Comandas",value:Number(x||0),fill:"#22C55E",outerRadius:te},{name:"Agendamentos",value:Number(y||0),fill:"#F59E0B",outerRadius:Te}]}(),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:0,stroke:"transparent",label:!1,labelLine:!1,isAnimationActive:!0,animationBegin:50,animationDuration:500,startAngle:mr.start,endAngle:mr.end,activeIndex:Dt,activeShape:void 0,onMouseEnter:(te,Te)=>Oe(Te),onMouseLeave:()=>Oe(null),onClick:(te,Te)=>{Ht(at=>at===Te?null:Te),Oe(Te)},children:[a.jsx(Vw,{fill:"#22C55E",style:Qt(0)},"c"),a.jsx(Vw,{fill:"#F59E0B",style:Qt(1)},"a")]}),kn({cx:"50%",cy:"50%",outerRadius:92}),a.jsx(Ff,{data:function(){const te=Gt(Gr.from?.[0]??Xt,Gr.to?.[0]??Xt,Gr.t),Te=Gt(Gr.from?.[1]??Xt,Gr.to?.[1]??Xt,Gr.t);return[{name:"Comandas",value:Number(x||0),fill:"transparent",outerRadius:te},{name:"Agendamentos",value:Number(y||0),fill:"transparent",outerRadius:Te}]}(),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:0,stroke:"transparent",label:Xe,labelLine:!1,isAnimationActive:!1,startAngle:mr.start,endAngle:mr.end}),a.jsx(wc,{formatter:te=>ct(te),contentStyle:{background:"rgba(10, 10, 10, 0.95)",border:"1px solid #fbbf24",borderRadius:"8px",padding:"8px 10px",color:"#fff"},labelStyle:{color:"#fff"},itemStyle:{color:"#fff"},cursor:{fill:"rgba(251, 191, 36, 0.06)"}})]})})}),a.jsx("div",{className:"w-full md:w-64 space-y-3 md:pr-2",children:[{name:"Comandas",value:Number(x||0),color:"#22C55E"},{name:"Agendamentos",value:Number(y||0),color:"#F59E0B"}].map((te,Te)=>a.jsxs("div",{className:`flex items-center justify-between px-3 py-2 rounded-md transition-all duration-200 ${ua===Te?"bg-white/5":"hover:bg-white/5"} cursor-pointer ${Wt!=null&&Wt!==Te?"opacity-60":""}`,onMouseEnter:()=>Oe(Te),onMouseLeave:()=>Oe(null),onClick:()=>Ht(at=>at===Te?null:Te),role:"button",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-sm",style:{backgroundColor:te.color}}),a.jsx("span",{className:"text-sm text-text-secondary",children:te.name})]}),a.jsx("div",{className:`text-sm font-semibold ${Wt!=null&&Wt!==Te?"opacity-70":""}`,children:ct(te.value)})]},te.name))})]})]}),a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(Nh,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Entradas por Finalizadora"})]})}),jr.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos no perodo."}):a.jsx("div",{className:"h-[280px]",children:a.jsx(zb,{width:"100%",height:"100%",children:a.jsxs(gUe,{data:jr,margin:{top:8,right:8,left:8,bottom:8},children:[a.jsx(TS,{strokeDasharray:"3 3",stroke:"#333"}),a.jsx(fp,{dataKey:"name",stroke:"#aaa"}),a.jsx(mp,{stroke:"#aaa",tickFormatter:te=>ct(te),width:80}),a.jsx(wc,{formatter:te=>ct(te),labelFormatter:te=>`Finalizadora: ${te}`,contentStyle:{background:"rgba(10, 10, 10, 0.95)",border:"1px solid #fbbf24",borderRadius:"8px",padding:"8px 12px",color:"#fff"},cursor:{fill:"rgba(251, 191, 36, 0.1)"}}),a.jsx(Cg,{}),a.jsx(gx,{dataKey:"valor",name:"Valor",fill:"#fbbf24"})]})})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4 border-0 ring-0 outline-none focus-visible:outline-none shadow-none cursor-pointer",onClick:()=>U(!0),children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider mb-3",children:[a.jsx(su,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Produtos mais vendidos"}),S.length>5&&a.jsx(se,{variant:"outline",size:"xs",className:"ml-auto h-7 px-2",onClick:()=>U(!0),children:"Ver todos"})]}),b.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados no perodo."}):a.jsx("div",{className:"space-y-2",children:b.map((te,Te)=>a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border last:border-0",children:[a.jsxs("span",{className:"text-sm text-text-primary",children:[Te+1,". ",te.nome]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:ct(te.valor)}),a.jsxs("span",{className:"text-sm font-bold text-brand",children:["x",te.quantidade]})]})]},Te))})]}),a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4 border-0 ring-0 outline-none focus-visible:outline-none shadow-none cursor-pointer",onClick:()=>W(!0),children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider mb-3",children:[a.jsx(tc,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Clientes (por valor pago)"}),A.length>5&&a.jsx(se,{variant:"outline",size:"xs",className:"ml-auto h-7 px-2",onClick:()=>W(!0),children:"Ver todos"})]}),_.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados no perodo."}):a.jsx("div",{className:"space-y-2",children:_.map((te,Te)=>a.jsxs("button",{className:"w-full flex items-center justify-between py-2 border-b border-border last:border-0 hover:bg-surface-2 rounded-sm px-2 text-left",onClick:()=>{Ae(te),W(!0)},children:[a.jsxs("span",{className:"text-sm text-text-primary",children:[Te+1,". ",te.nome]}),a.jsx("span",{className:"text-sm font-bold text-success",children:ct(te.valor)})]},Te))})]})]})]}),a.jsx(Gs,{value:"agendamentos",className:"space-y-6 mt-6",children:a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"Agendamentos (Pagamentos por Participante)"}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:items-center",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar (#cdigo, participante, quadra)",value:Fe,onChange:te=>xt(te.target.value),className:"pl-10 pr-10 w-full md:w-[260px] bg-black border-warning/40 text-white placeholder:text-white/60"}),a.jsxs(ai,{open:xr,onOpenChange:Jt,children:[a.jsx(si,{asChild:!0,children:a.jsx(se,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0 hover:bg-warning/20",title:"Selecionar cliente",children:a.jsx("svg",{className:"h-4 w-4 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})}),a.jsx(Go,{className:"w-[280px] p-2 bg-surface border-border",align:"end",children:a.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto",children:[a.jsx("div",{className:"text-xs font-semibold text-text-secondary px-2 py-1 sticky top-0 bg-surface z-10",children:"Selecionar Cliente"}),(()=>{const te=new Map;$t.forEach(at=>{const ee=at.participante_nome;ee&&!te.has(ee)&&te.set(ee,{nome:ee,codigo:at.cliente_codigo||0,is_consumidor:at.is_consumidor_final||!1})});const Te=Array.from(te.values()).sort((at,ee)=>at.is_consumidor!==ee.is_consumidor?at.is_consumidor?1:-1:at.nome.localeCompare(ee.nome));return Te.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-4",children:"Nenhum participante encontrado"}):Te.map((at,ee)=>a.jsxs("button",{onClick:()=>{xt(at.nome),Jt(!1)},className:"w-full flex items-center gap-2 px-2 py-2 hover:bg-surface-2 rounded text-left transition-colors",children:[a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[24px] h-5 px-1 rounded text-[10px] font-bold ${at.codigo===0?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",at.codigo]}),a.jsx("span",{className:"text-sm text-text-primary flex-1 truncate",children:at.nome})]},ee))})()]})})]})]}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[a.jsxs(Gn,{value:Ot,onValueChange:Cr,children:[a.jsx(Vn,{className:"w-full md:w-[170px] h-9 bg-black border-warning/40 text-white",children:a.jsx(Kn,{placeholder:"Todos os Status"})}),a.jsxs(Wn,{className:"bg-black text-white border-warning/40",children:[a.jsx(lt,{value:"all",children:"Todos os Status"}),a.jsx(lt,{value:"Pago",children:"Pago"}),a.jsx(lt,{value:"Pendente",children:"Pendente"}),a.jsx(lt,{value:"Cancelado",children:"Cancelado"})]})]}),a.jsxs(Gn,{value:Me,onValueChange:Qe,children:[a.jsx(Vn,{className:"w-full md:w-[220px] h-9 bg-black border-warning/40 text-white",children:a.jsx(Kn,{placeholder:"Todas as Finalizadoras"})}),a.jsxs(Wn,{className:"bg-black text-white border-warning/40",children:[a.jsx(lt,{value:"all",children:"Todas as Finalizadoras"}),[...new Set(($t||[]).map(te=>te.finalizadora_nome).filter(Boolean))].map(te=>a.jsx(lt,{value:te,children:te},te))]})]})]}),a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>{try{const te=";",at=[["Data","Horrio","Cdigo","Representante","Quadra","Participantes","Total","Pago","Pendente","Status"].join(te)];pa.forEach(ft=>{const yt=ft.inicio?new Date(ft.inicio).toLocaleDateString("pt-BR"):"",Et=ft.inicio&&ft.fim?`${new Date(ft.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}-${new Date(ft.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:"",br=ft.participantes.length,Ue=ft.participantes.filter(Lr=>Lr.status_pagamento==="Pago").length,St=ft.participantes.filter(Lr=>Lr.status_pagamento==="Pendente").length,Nr=String(tr(ft.total)).replace(".",","),an=[yt,Et,ft.agendamento_codigo??"",(ft.representante??"").replace(/"/g,'""'),(ft.quadra_nome??"").replace(/"/g,'""'),br,Nr,Ue,St,ft.statusGeral??""].map(Lr=>`"${Lr}"`).join(te);at.push(an)});const ee="\uFEFF"+at.join(`
`),Se=new Blob([ee],{type:"text/csv;charset=utf-8;"}),$e=URL.createObjectURL(Se),Be=document.createElement("a");Be.href=$e;const Ge=c?new Date(c+"T00:00:00").toLocaleDateString("pt-BR").replace(/\//g,"-"):"",Ye=u?new Date(u+"T00:00:00").toLocaleDateString("pt-BR").replace(/\//g,"-"):"";Be.download=`agendamentos_${Ge}_a_${Ye}.csv`,document.body.appendChild(Be),Be.click(),document.body.removeChild(Be),URL.revokeObjectURL($e),e({title:"CSV exportado com sucesso!"})}catch(te){e({title:"Falha ao exportar CSV",description:te?.message,variant:"destructive"})}},children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Exportar CSV"]})]})]}),i?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):pa.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros no perodo."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{className:"w-12"}),a.jsx(sa,{children:"Data/Hora"}),a.jsx(sa,{children:"Cdigo"}),a.jsx(sa,{children:"Representante"}),a.jsx(sa,{children:"Quadra"}),a.jsx(sa,{className:"text-right",children:"Participantes"}),a.jsx(sa,{className:"text-right",children:"Total"}),a.jsx(sa,{children:"Status"})]})}),a.jsx(Xl,{children:pa.map(te=>{const Te=et.has(te.agendamento_id||te.agendamento_codigo);return a.jsxs(Ee.Fragment,{children:[a.jsxs(gs,{className:"cursor-pointer hover:bg-surface-2",onClick:()=>{const at=te.agendamento_id||te.agendamento_codigo;Yt(ee=>{const Se=new Set(ee);return Se.has(at)?Se.delete(at):Se.add(at),Se})},children:[a.jsx(Un,{children:a.jsx("div",{className:`transition-transform ${Te?"rotate-90":""}`,children:""})}),a.jsx(Un,{children:te.inicio?a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:new Date(te.inicio).toLocaleDateString("pt-BR")}),a.jsxs("span",{className:"font-medium",children:[new Date(te.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),te.fim&&` - ${new Date(te.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`]})]}):""}),a.jsxs(Un,{className:"font-semibold",children:["#",te.agendamento_codigo||""]}),a.jsx(Un,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[te.representanteCodigo!==null&&te.representanteCodigo!==void 0&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[32px] h-6 px-1.5 rounded text-xs font-bold ${te.representanteCodigo===0||te.representanteCodigo==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",te.representanteCodigo]}),a.jsx("span",{className:"text-text-primary",children:te.representante||""})]})}),a.jsx(Un,{children:te.quadra_nome||""}),a.jsx(Un,{className:"text-right",children:te.participantes.length}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.total)}),a.jsx(Un,{children:a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${te.statusGeral==="Pago"?"bg-success/20 text-success":te.statusGeral==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:te.statusGeral==="Parcial"?"Pendente":te.statusGeral})})]}),Te&&te.participantes.map((at,ee)=>{const Se=at.is_consumidor_final?0:at.cliente_codigo??null;return a.jsxs(gs,{className:"bg-surface-2/30 hover:bg-surface-2/50 transition-colors",children:[a.jsx(Un,{}),a.jsx(Un,{colSpan:2}),a.jsx(Un,{className:"pl-8 text-sm text-text-secondary",children:a.jsxs("div",{className:"flex items-center gap-2",children:[Se!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[28px] h-5 px-1 rounded text-[10px] font-bold ${Se===0||Se==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Se]}),a.jsx("span",{children:at.participante_nome||""})]})}),a.jsx(Un,{className:"text-sm text-text-secondary",children:at.finalizadora_nome||""}),a.jsx(Un,{}),a.jsx(Un,{className:"text-right text-sm font-medium",children:ct(at.valor_cota)}),a.jsx(Un,{className:"text-sm",children:a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs ${at.status_pagamento==="Pago"?"bg-success/20 text-success":at.status_pagamento==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:at.status_pagamento||"Pendente"})})]},`${te.agendamento_codigo}-${ee}`)})]},te.agendamento_id||te.agendamento_codigo)})})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:pa.map(te=>{const Te=et.has(te.agendamento_id||te.agendamento_codigo);return a.jsxs("div",{className:"bg-surface-2 rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>{const at=te.agendamento_id||te.agendamento_codigo;Yt(ee=>{const Se=new Set(ee);return Se.has(at)?Se.delete(at):Se.add(at),Se})},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`transition-transform text-text-secondary ${Te?"rotate-90":""}`,children:""}),a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["#",te.agendamento_codigo||""]})]}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${te.statusGeral==="Pago"?"bg-success/20 text-success":te.statusGeral==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:te.statusGeral==="Parcial"?"Pendente":te.statusGeral})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Data:"}),a.jsx("span",{className:"text-text-primary",children:te.inicio?new Date(te.inicio).toLocaleDateString("pt-BR"):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Horrio:"}),a.jsx("span",{className:"text-text-primary font-medium",children:te.inicio&&te.fim?`${new Date(te.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})} - ${new Date(te.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:""})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Representante:"}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[te.representanteCodigo!==null&&te.representanteCodigo!==void 0&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[28px] h-5 px-1 rounded text-[10px] font-bold ${te.representanteCodigo===0||te.representanteCodigo==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",te.representanteCodigo]}),a.jsx("span",{className:"text-text-primary font-medium",children:te.representante||""})]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Quadra:"}),a.jsx("span",{className:"text-text-primary font-medium",children:te.quadra_nome||""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"}),a.jsx("span",{className:"text-text-primary",children:te.participantes.length})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border/50",children:[a.jsx("span",{className:"text-text-secondary",children:"Total:"}),a.jsx("span",{className:"font-bold text-lg text-success",children:ct(te.total)})]})]})]}),Te&&a.jsx("div",{className:"border-t border-border/50 bg-surface-2/20",children:te.participantes.map((at,ee)=>{const Se=at.is_consumidor_final?0:at.cliente_codigo??null;return a.jsxs("div",{className:"px-4 py-3 border-b border-border/30 last:border-b-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[Se!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[24px] h-4 px-1 rounded text-[9px] font-bold ${Se===0||Se==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Se]}),a.jsx("div",{className:"font-medium text-sm",children:at.participante_nome||""})]}),a.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full ${at.status_pagamento==="Pago"?"bg-success/20 text-success":at.status_pagamento==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:at.status_pagamento||"Pendente"})]}),a.jsxs("div",{className:"flex justify-between text-xs",children:[a.jsx("span",{className:"text-text-secondary",children:at.finalizadora_nome||""}),a.jsx("span",{className:"font-semibold text-success",children:ct(at.valor_cota)})]})]},ee)})})]},te.agendamento_id||te.agendamento_codigo)})})]})]})}),a.jsx(Gs,{value:"caixa",className:"space-y-6 mt-6",children:a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[a.jsx("h3",{className:"text-base font-bold",children:"Fechamentos Anteriores"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",onClick:ce,children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," CSV"]}),a.jsxs(se,{variant:"outline",size:"sm",onClick:Mt,children:[a.jsx(Sx,{className:"h-4 w-4 mr-2"})," PDF"]})]})]}),ne.length===0?a.jsx("div",{className:"text-sm text-text-secondary",children:"Nenhum fechamento encontrado."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Aberto em"}),a.jsx(sa,{children:"Fechado em"}),a.jsx(sa,{className:"text-right",children:"Saldo Inicial"}),a.jsx(sa,{className:"text-right",children:"Saldo Final (contado)"}),a.jsx(sa,{children:"Status"})]})}),a.jsxs(Xl,{children:[(()=>{console.log("[FinanceiroPage][Render] Renderizando histrico, total de sesses:",ne.length);const te=ne.filter(Te=>Te.valor_final_dinheiro!=null);return console.log("[FinanceiroPage][Render] Sesses com valor_final_dinheiro no render:",te.length),ne.length>0&&console.log("[FinanceiroPage][Render] Primeira sesso no array history:",ne[0]),null})(),ne.map(te=>a.jsxs(gs,{className:"cursor-pointer hover:bg-surface-2",onClick:async()=>{pt(!0),vt(!0),gt(null);try{const Te=t?.codigo_empresa,at=typeof performance<"u"&&performance.now?performance.now():Date.now();console.log("[Caixa][Fechamento][Open]",{sessaoId:te.id,from:te.aberto_em,to:te.fechado_em,codigo:Te});let ee=await WS({caixaSessaoId:te.id,codigoEmpresa:Te}),$e=(On=>{if(!On)return null;if(On.total_bruto!=null||On.por_finalizadora!=null){let Qn=On.por_finalizadora;if(Qn&&typeof Qn=="string")try{Qn=JSON.parse(Qn)}catch{Qn={}}return{from:On.periodo_de||null,to:On.periodo_ate||null,totalPorFinalizadora:Qn||{},totalEntradas:Number(On.total_entradas||0),totalVendasBrutas:Number(On.total_bruto||0),totalDescontos:Number(On.total_descontos||0),totalVendasLiquidas:Number(On.total_liquido||0)}}return On})(ee);$e||(console.log("[Caixa][Fechamento] Snapshot ausente, calculando resumo por perodo..."),$e=await Jd({from:te.aberto_em,to:te.fechado_em||new Date().toISOString(),codigoEmpresa:Te}));const Be={...te,saldo_inicial:ee&&typeof ee.saldo_inicial<"u"?Number(ee.saldo_inicial):te.saldo_inicial,saldo_final:ee&&typeof ee.saldo_final<"u"?Number(ee.saldo_final):te.saldo_final};if(!$e||!$e.totalPorFinalizadora||Object.keys($e.totalPorFinalizadora).length===0)try{const On=te.aberto_em,Qn=te.fechado_em||new Date().toISOString();let Ta=re.from("pagamentos").select("metodo, valor, status, recebido_em, finalizadoras:finalizadoras!pagamentos_finalizadora_id_fkey(nome)").gte("recebido_em",On).lte("recebido_em",Qn);Te&&(Ta=Ta.eq("codigo_empresa",Te));const{data:zn}=await Ta,Fn={};let en=0;for(const Wa of zn||[]){if(!((Wa.status||"Pago")!=="Cancelado"&&(Wa.status||"Pago")!=="Estornado"))continue;const za=Wa.finalizadoras?.nome||Wa.metodo||"Outros",vs=Number(Wa.valor||0);Fn[za]=(Fn[za]||0)+vs,en+=vs}$e={...$e||{},totalPorFinalizadora:Fn,totalEntradas:Number($e?.totalEntradas||0)||en},console.log("[Caixa][Fechamento][FallbackPF]",{methods:Object.keys(Fn).length})}catch{}const Ye=await kg({caixaSessaoId:te.id,codigoEmpresa:Te}),ft=ee&&ee.movimentos?ee.movimentos:null,yt=te.aberto_em,Et=te.fechado_em||new Date().toISOString();let br=re.from("pagamentos").select("id, valor, status, metodo, recebido_em, finalizadoras:finalizadoras!pagamentos_finalizadora_id_fkey(nome)").gte("recebido_em",yt).lte("recebido_em",Et).order("recebido_em",{ascending:!1});Te&&(br=br.eq("codigo_empresa",Te));const{data:Ue}=await br;console.log("[Caixa][Fechamento][Pays]",{count:(Ue||[]).length});const St=ee&&typeof ee.valor_final_dinheiro<"u"?Number(ee.valor_final_dinheiro):null;gt({resumo:$e,movimentacoes:Ye,movimentosAgg:ft,pagamentos:Ue||[],sessao:Be,valorFinalContado:St});const Nr=typeof performance<"u"&&performance.now?performance.now():Date.now(),an=Array.isArray(Ye)?Ye.length:0,Lr=$e&&$e.totalPorFinalizadora?Object.keys($e.totalPorFinalizadora).length:0;console.log("[Caixa][Fechamento][Loaded]",{sessaoId:te.id,finCount:Lr,movCount:an,ms:Math.round(Nr-at)})}catch(Te){console.error("[Caixa][Fechamento][Error]",{sessaoId:te.id,message:Te?.message,code:Te?.code}),e({title:"Falha ao carregar fechamento",description:Te?.message||"Tente novamente",variant:"destructive"})}finally{vt(!1)}},children:[a.jsx(Un,{children:te.aberto_em?new Date(te.aberto_em).toLocaleString("pt-BR"):""}),a.jsx(Un,{children:te.fechado_em?new Date(te.fechado_em).toLocaleString("pt-BR"):""}),a.jsx(Un,{className:"text-right",children:ct(te.saldo_inicial)}),a.jsx(Un,{className:"text-right",children:te.valor_final_dinheiro!=null?ct(te.valor_final_dinheiro):""}),a.jsx(Un,{children:String(te.status||"").toLowerCase()==="open"?"Aberto":"Fechado"})]},te.id))]})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:ne.map(te=>a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 cursor-pointer hover:bg-surface-2/80 transition-colors",onClick:async()=>{pt(!0),vt(!0),gt(null);try{const Te=t?.codigo_empresa;let at=await WS({caixaSessaoId:te.id,codigoEmpresa:Te}),Se=(ft=>{if(!ft)return null;if(ft.total_bruto!=null||ft.por_finalizadora!=null){let yt=ft.por_finalizadora;if(yt&&typeof yt=="string")try{yt=JSON.parse(yt)}catch{yt={}}return{from:ft.periodo_de||null,to:ft.periodo_ate||null,totalPorFinalizadora:yt||{},totalEntradas:Number(ft.total_entradas||0),totalVendasBrutas:Number(ft.total_bruto||0),totalDescontos:Number(ft.total_descontos||0),totalVendasLiquidas:Number(ft.total_liquido||0)}}return ft})(at);Se||(Se=await Jd({from:te.aberto_em,to:te.fechado_em||new Date().toISOString(),codigoEmpresa:Te}));const $e={...te,saldo_inicial:at&&typeof at.saldo_inicial<"u"?Number(at.saldo_inicial):te.saldo_inicial,saldo_final:at&&typeof at.saldo_final<"u"?Number(at.saldo_final):te.saldo_final},Be=await kg({caixaSessaoId:te.id,codigoEmpresa:Te}),Ge=at&&at.movimentos?at.movimentos:null,Ye=at&&typeof at.valor_final_dinheiro<"u"?Number(at.valor_final_dinheiro):null;gt({resumo:Se,movimentacoes:Be,movimentosAgg:Ge,sessao:$e,pagamentos:[],valorFinalContado:Ye})}catch(Te){console.error("[Caixa][Fechamento][Error]",Te),e({title:"Erro ao carregar detalhes",description:Te?.message,variant:"destructive"})}finally{vt(!1)}},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["Sesso #",te.id]}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${te.status==="fechado"?"bg-success/20 text-success":"bg-warning/20 text-warning"}`,children:String(te.status||"").toLowerCase()==="open"?"Aberto":"Fechado"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Aberto em:"}),a.jsx("span",{className:"text-text-primary",children:te.aberto_em?new Date(te.aberto_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Fechado em:"}),a.jsx("span",{className:"text-text-primary",children:te.fechado_em?new Date(te.fechado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Saldo Inicial:"}),a.jsx("span",{className:"font-semibold text-info",children:ct(te.saldo_inicial)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Saldo Final (contado):"}),a.jsx("span",{className:"font-semibold text-success",children:te.valor_final_dinheiro!=null?ct(te.valor_final_dinheiro):""})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted text-center",children:"Toque para ver detalhes"})]},te.id))})]})]})}),a.jsx(Gs,{value:"recebimentos",className:"space-y-6 mt-6",children:a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"Todos os Recebimentos"}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar...",value:Pt,onChange:te=>Lt(te.target.value),className:"pl-10 w-full md:w-[200px]"})]}),a.jsxs(Gn,{value:je,onValueChange:nt,children:[a.jsx(Vn,{className:"w-full md:w-[160px] h-9 bg-black border-warning/40 text-white",children:a.jsx(Kn,{placeholder:"Todas as Fontes"})}),a.jsxs(Wn,{className:"bg-black text-white border-warning/40",children:[a.jsx(lt,{value:"all",children:"Todas as Fontes"}),a.jsx(lt,{value:"manual",children:"Manual"}),a.jsx(lt,{value:"xml",children:"XML"})]})]}),a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>{try{const te=Xn||[],at=[["Data/Hora","Origem","Fonte","Descrio","Finalizadora","Valor","Status"].join(";")];for(const ft of te){const yt=[ft.recebido_em?new Date(ft.recebido_em).toLocaleString("pt-BR"):"",ft.origem??"",ft.fonte??"",(ft.descricao??"").replaceAll('"','""'),(ft.finalizadoras?.nome||ft.metodo||"").replaceAll('"','""'),String(tr(ft.valor)).replace(".",","),ft.status??""].map(Et=>`"${String(Et)}"`).join(";");at.push(yt)}const ee="\uFEFF"+at.join(`
`),Se=new Blob([ee],{type:"text/csv;charset=utf-8;"}),$e=URL.createObjectURL(Se),Be=c?new Date(c+"T00:00:00").toLocaleDateString("pt-BR"):"",Ge=u?new Date(u+"T00:00:00").toLocaleDateString("pt-BR"):"",Ye=document.createElement("a");Ye.href=$e,Ye.download=`recebimentos_${Be}_a_${Ge}.csv`,document.body.appendChild(Ye),Ye.click(),document.body.removeChild(Ye),URL.revokeObjectURL($e)}catch(te){e({title:"Falha ao exportar CSV",description:te?.message,variant:"destructive"})}},children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Exportar CSV"]})]})]}),i?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):Xn.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros no perodo."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Data/Hora"}),a.jsx(sa,{children:"Origem"}),a.jsx(sa,{children:"Fonte"}),a.jsx(sa,{children:"Descrio"}),a.jsx(sa,{children:"Finalizadora"}),a.jsx(sa,{className:"text-right",children:"Valor"}),a.jsx(sa,{children:"Status"})]})}),a.jsx(Xl,{children:Xn.map(te=>a.jsxs(gs,{className:"cursor-pointer hover:bg-surface-2",onClick:()=>{nn(te),_r(!0)},children:[a.jsx(Un,{children:te.recebido_em?new Date(te.recebido_em).toLocaleString("pt-BR"):""}),a.jsx(Un,{children:te.origem||""}),a.jsx(Un,{children:te.fonte?te.fonte.toUpperCase():""}),a.jsx(Un,{className:"truncate max-w-[260px]",title:te.descricao||"",children:te.descricao||""}),a.jsx(Un,{children:te.finalizadoras?.nome||te.metodo||""}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.valor)}),a.jsx(Un,{children:te.status||""})]},te.id))})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:Xn.map(te=>a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 cursor-pointer hover:bg-surface-2/80 transition-colors",onClick:()=>{nn(te),_r(!0)},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary",children:te.origem||"Recebimento"}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${te.status==="Pago"?"bg-success/20 text-success":te.status==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:te.status||"Pendente"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Data/Hora:"}),a.jsx("span",{className:"text-text-primary",children:te.recebido_em?new Date(te.recebido_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Fonte:"}),a.jsx("span",{className:"text-text-primary font-medium",children:te.fonte?te.fonte.toUpperCase():""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Finalizadora:"}),a.jsx("span",{className:"text-text-primary",children:te.finalizadoras?.nome||te.metodo||""})]}),te.descricao&&a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:"text-text-secondary",children:"Descrio:"}),a.jsx("span",{className:"text-text-primary text-xs bg-surface/50 p-2 rounded",children:te.descricao})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border/50",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor:"}),a.jsx("span",{className:"font-bold text-lg text-success",children:ct(te.valor)})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted text-center",children:"Toque para ver detalhes"})]},te.id))})]})]})}),a.jsxs(Gs,{value:"relatorios",className:"space-y-6 mt-6",children:[a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Oi,{className:"w-5 h-5 text-success"}),"Faturamento Consolidado"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Resumo geral das receitas no perodo"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const Te=[["Mtrica","Valor"],["Receita de Comandas",ct(x)],["Receita de Agendamentos",ct(y)],["Receita Total",ct(Number(x||0)+Number(y||0))],["Perodo",`${c||"N/A"} at ${u||"N/A"}`]].map($e=>$e.map(Be=>`"${Be}"`).join(";")).join(`
`),at=new Blob(["\uFEFF"+Te],{type:"text/csv;charset=utf-8;"}),ee=URL.createObjectURL(at),Se=document.createElement("a");Se.href=ee,Se.download=`faturamento_consolidado_${sr(new Date,"yyyy-MM-dd")}.csv`,Se.click(),URL.revokeObjectURL(ee),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ks,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(se,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const te=[["Receita de Comandas",ct(x)],["Receita de Agendamentos",ct(y)],["Receita Total",ct(Number(x||0)+Number(y||0))]];dt("Faturamento Consolidado",["Mtrica","Valor"],te,"faturamento_consolidado")},children:[a.jsx(Sx,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"p-4 bg-success/5 border border-success/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Comandas"}),a.jsx("div",{className:"text-2xl font-bold text-success",children:ct(x)}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Vendas no perodo"})]}),a.jsxs("div",{className:"p-4 bg-purple-500/5 border border-purple-500/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Agendamentos"}),a.jsx("div",{className:"text-2xl font-bold text-purple-400",children:ct(y)}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Reservas pagas"})]}),a.jsxs("div",{className:"p-4 bg-brand/5 border border-brand/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Total"}),a.jsx("div",{className:"text-2xl font-bold text-brand",children:ct(Number(x||0)+Number(y||0))}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Perodo selecionado"})]})]})]}),a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Nh,{className:"w-5 h-5 text-info"}),"Pagamentos por Mtodo"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Distribuio por finalizadora"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",className:"bg-info/10 border-info/40 text-info hover:bg-info/20",onClick:()=>{const te=h?.totalPorFinalizadora||{},Te=Object.entries(te).map(([Ye,ft])=>[Ye,ct(ft)]).sort((Ye,ft)=>{const yt=Number(String(Ye[1]).replace(/[^\d,]/g,"").replace(",","."));return Number(String(ft[1]).replace(/[^\d,]/g,"").replace(",","."))-yt}),at=Object.values(te).reduce((Ye,ft)=>Ye+ft,0),Se=[["Mtodo de Pagamento","Valor","% do Total"],...Te.map(([Ye,ft])=>{const Et=((Object.entries(te).find(([br])=>br===Ye)?.[1]||0)/at*100).toFixed(1)+"%";return[Ye,ft,Et]}),["TOTAL",ct(at),"100%"]].map(Ye=>Ye.map(ft=>`"${ft}"`).join(";")).join(`
`),$e=new Blob(["\uFEFF"+Se],{type:"text/csv;charset=utf-8;"}),Be=URL.createObjectURL($e),Ge=document.createElement("a");Ge.href=Be,Ge.download=`pagamentos_por_metodo_${sr(new Date,"yyyy-MM-dd")}.csv`,Ge.click(),URL.revokeObjectURL(Be),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ks,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(se,{variant:"outline",size:"sm",className:"bg-info/10 border-info/40 text-info hover:bg-info/20",onClick:()=>{const te=h?.totalPorFinalizadora||{},Te=Object.values(te).reduce((ee,Se)=>ee+Se,0),at=Object.entries(te).sort(([,ee],[,Se])=>Se-ee).map(([ee,Se])=>[ee,ct(Se),(Se/Te*100).toFixed(1)+"%"]);at.push(["TOTAL",ct(Te),"100%"]),dt("Pagamentos por Mtodo",["Mtodo","Valor","% do Total"],at,"pagamentos_por_metodo")},children:[a.jsx(Sx,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),Object.keys(h?.totalPorFinalizadora||{}).length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem pagamentos no perodo."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Mtodo de Pagamento"}),a.jsx(sa,{className:"text-right",children:"Valor"}),a.jsx(sa,{className:"text-right",children:"% do Total"})]})}),a.jsxs(Xl,{children:[Object.entries(h?.totalPorFinalizadora||{}).sort(([,te],[,Te])=>Te-te).map(([te,Te])=>{const at=Object.values(h?.totalPorFinalizadora||{}).reduce((Se,$e)=>Se+$e,0),ee=(Te/at*100).toFixed(1);return a.jsxs(gs,{children:[a.jsx(Un,{className:"font-medium",children:te}),a.jsx(Un,{className:"text-right font-semibold",children:ct(Te)}),a.jsxs(Un,{className:"text-right text-text-secondary",children:[ee,"%"]})]},te)}),a.jsxs(gs,{className:"bg-surface-2 font-bold",children:[a.jsx(Un,{children:"TOTAL"}),a.jsx(Un,{className:"text-right",children:ct(Object.values(h?.totalPorFinalizadora||{}).reduce((te,Te)=>te+Te,0))}),a.jsx(Un,{className:"text-right",children:"100%"})]})]})]})})]}),a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(su,{className:"w-5 h-5 text-purple-400"}),"Produtos Mais Vendidos"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Top produtos por faturamento"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",className:"bg-purple-500/10 border-purple-500/40 text-purple-400 hover:bg-purple-500/20",onClick:()=>{const Te=[["Posio","Produto","Faturamento"],...S.slice(0,50).map(($e,Be)=>[Be+1,$e.nome,ct($e.valor)])].map($e=>$e.map(Be=>`"${Be}"`).join(";")).join(`
`),at=new Blob(["\uFEFF"+Te],{type:"text/csv;charset=utf-8;"}),ee=URL.createObjectURL(at),Se=document.createElement("a");Se.href=ee,Se.download=`produtos_vendidos_${sr(new Date,"yyyy-MM-dd")}.csv`,Se.click(),URL.revokeObjectURL(ee),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ks,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(se,{variant:"outline",size:"sm",className:"bg-purple-500/10 border-purple-500/40 text-purple-400 hover:bg-purple-500/20",onClick:()=>{const te=S.slice(0,50).map((Te,at)=>[at+1,Te.nome,ct(Te.valor)]);dt("Produtos Mais Vendidos",["#","Produto","Faturamento"],te,"produtos_vendidos")},children:[a.jsx(Sx,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),S.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem produtos vendidos no perodo."}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{className:"w-16",children:"#"}),a.jsx(sa,{children:"Produto"}),a.jsx(sa,{className:"text-right",children:"Faturamento"})]})}),a.jsx(Xl,{children:S.slice(0,20).map((te,Te)=>a.jsxs(gs,{children:[a.jsx(Un,{className:"text-text-secondary font-mono",children:Te+1}),a.jsx(Un,{className:"font-medium",children:te.nome}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.valor)})]},`${te.nome}-${Te}`))})]}),S.length>20&&a.jsx("div",{className:"text-center mt-4",children:a.jsxs(se,{variant:"ghost",size:"sm",className:"text-brand hover:text-brand/80",onClick:()=>U(!0),children:["Ver todos os ",S.length," produtos"]})})]})]}),a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(tc,{className:"w-5 h-5 text-warning"}),"Clientes que Mais Consomem"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Ranking por faturamento total"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",className:"bg-warning/10 border-warning/40 text-warning hover:bg-warning/20",onClick:()=>{const Te=[["Posio","Cliente","Faturamento"],...A.slice(0,50).map(($e,Be)=>[Be+1,$e.nome,ct($e.valor)])].map($e=>$e.map(Be=>`"${Be}"`).join(";")).join(`
`),at=new Blob(["\uFEFF"+Te],{type:"text/csv;charset=utf-8;"}),ee=URL.createObjectURL(at),Se=document.createElement("a");Se.href=ee,Se.download=`clientes_top_${sr(new Date,"yyyy-MM-dd")}.csv`,Se.click(),URL.revokeObjectURL(ee),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ks,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(se,{variant:"outline",size:"sm",className:"bg-warning/10 border-warning/40 text-warning hover:bg-warning/20",onClick:()=>{const te=A.slice(0,50).map((Te,at)=>[at+1,Te.nome,ct(Te.valor)]);dt("Clientes que Mais Consomem",["#","Cliente","Total Gasto"],te,"clientes_top")},children:[a.jsx(Sx,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),A.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem dados de clientes no perodo."}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{className:"w-16",children:"#"}),a.jsx(sa,{children:"Cliente"}),a.jsx(sa,{className:"text-right",children:"Total Gasto"})]})}),a.jsx(Xl,{children:A.slice(0,20).map((te,Te)=>a.jsxs(gs,{children:[a.jsx(Un,{className:"text-text-secondary font-mono",children:Te+1}),a.jsx(Un,{className:"font-medium",children:te.nome}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.valor)})]},`${te.nome}-${Te}`))})]}),A.length>20&&a.jsx("div",{className:"text-center mt-4",children:a.jsxs(se,{variant:"ghost",size:"sm",className:"text-brand hover:text-brand/80",onClick:()=>W(!0),children:["Ver todos os ",A.length," clientes"]})})]})]}),a.jsxs(Er.div,{variants:Hl,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Cm,{className:"w-5 h-5 text-success"}),"Evoluo Diria de Receitas"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Faturamento dia a dia no perodo"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const Te=[["Data","Receita"],...F.map($e=>[$e.data,ct($e.valor)])].map($e=>$e.map(Be=>`"${Be}"`).join(";")).join(`
`),at=new Blob(["\uFEFF"+Te],{type:"text/csv;charset=utf-8;"}),ee=URL.createObjectURL(at),Se=document.createElement("a");Se.href=ee,Se.download=`evolucao_diaria_${sr(new Date,"yyyy-MM-dd")}.csv`,Se.click(),URL.revokeObjectURL(ee),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ks,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(se,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const te=F.map(Te=>[Te.data,ct(Te.valor)]);dt("Evoluo Diria de Receitas",["Data","Receita"],te,"evolucao_diaria")},children:[a.jsx(Sx,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),F.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem dados de evoluo no perodo."}):a.jsx("div",{className:"h-80",children:a.jsx(zb,{width:"100%",height:"100%",children:a.jsxs(Uee,{data:F,margin:{top:5,right:20,bottom:5,left:0},children:[a.jsx(TS,{strokeDasharray:"3 3",stroke:"#2a2a2a"}),a.jsx(fp,{dataKey:"data",stroke:"#888",tick:{fill:"#888",fontSize:11},tickFormatter:te=>{const Te=te.split("/");return`${Te[0]}/${Te[1]}`}}),a.jsx(mp,{stroke:"#888",tick:{fill:"#888",fontSize:11},tickFormatter:te=>`R$ ${(te/1e3).toFixed(0)}k`}),a.jsx(wc,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px"},labelStyle:{color:"#fff"},itemStyle:{color:"#22C55E"},formatter:te=>[ct(te),"Receita"]}),a.jsx(fy,{type:"monotone",dataKey:"valor",stroke:"#22C55E",strokeWidth:2,dot:{fill:"#22C55E",r:4},activeDot:{r:6}})]})})})]})]})]}),a.jsx(In,{open:kr,onOpenChange:_r,children:a.jsxs(En,{className:"max-w-lg",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-xl font-bold",children:"Detalhes do Recebimento"}),a.jsx(Hn,{children:Rr?.origem==="Comanda"?"Operao de comanda":Rr?.origem==="Agendamento"?"Operao de agendamento":"Operao"})]}),Rr&&a.jsxs("div",{className:"space-y-3 text-sm",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Data/Hora"}),a.jsx("div",{className:"font-medium",children:Rr.recebido_em?new Date(Rr.recebido_em).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Valor"}),a.jsx("div",{className:"font-semibold",children:ct(Rr.valor)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Origem"}),a.jsx("div",{children:Rr.origem||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Fonte"}),a.jsx("div",{children:Rr.fonte?Rr.fonte.toUpperCase():""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Finalizadora"}),a.jsx("div",{children:Rr.finalizadoras?.nome||Rr.metodo||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Status"}),a.jsx("div",{children:Rr.status||""})]})]}),Rr.origem==="Comanda"&&a.jsxs("div",{className:"mt-2 p-3 rounded border border-border",children:[a.jsx("div",{className:"font-semibold mb-2",children:"Comanda"}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Cliente"}),a.jsx("div",{children:Rr.descricao||""})]})}),a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"text-text-muted mb-1",children:"Produtos"}),qe?a.jsx("div",{className:"text-xs text-text-muted",children:"Carregando itens..."}):rn.length===0?a.jsx("div",{className:"text-xs text-text-muted",children:"Sem itens encontrados."}):a.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:rn.map((te,Te)=>a.jsxs("div",{className:"text-xs flex justify-between gap-3",children:[a.jsxs("div",{className:"truncate",children:[a.jsx("span",{className:"font-mono",children:tr(te.quantidade)}),a.jsx("span",{children:" x "}),a.jsx("span",{className:"font-medium",children:te.descricao})]}),a.jsx("div",{className:"whitespace-nowrap",children:ct(Number(te.preco_unitario||0)*Number(te.quantidade||0))})]},Te))})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("div",{className:"text-text-muted mb-1",children:"Pagamentos"}),Je.length===0?a.jsx("div",{className:"text-xs text-text-muted",children:"Sem pagamentos adicionais."}):a.jsxs("div",{className:"space-y-1",children:[Je.map((te,Te)=>a.jsxs("div",{className:"text-xs flex justify-between gap-3",children:[a.jsx("div",{className:"truncate",children:a.jsx("span",{className:"font-medium",children:te.finalizadoras?.nome||te.metodo||""})}),a.jsx("div",{className:"whitespace-nowrap",children:ct(te.valor)})]},te.id||Te)),a.jsxs("div",{className:"text-xs flex justify-between gap-3 pt-2 border-t border-border",children:[a.jsx("div",{className:"font-semibold",children:"Total"}),a.jsx("div",{className:"font-semibold",children:ct(Je.reduce((te,Te)=>te+Number(Te.valor||0),0))})]})]})]})]}),Rr.origem==="Agendamento"&&a.jsxs("div",{className:"mt-2 p-3 rounded border border-border",children:[a.jsx("div",{className:"font-semibold mb-2",children:"Agendamento"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Cdigo"}),a.jsxs("div",{className:"font-mono",children:["#",Rr.agendamento_codigo]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Participante"}),a.jsx("div",{children:Rr.participante_nome})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("div",{className:"text-text-muted",children:"Quadra"}),a.jsx("div",{children:Rr.quadra_nome||""})]})]})]})]})]})}),a.jsx(In,{open:z,onOpenChange:U,children:a.jsxs(En,{className:"max-w-2xl bg-surface text-text-primary border-0",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Todos os Produtos"}),a.jsx(Hn,{children:"Ordenados por valor de vendas"})]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Produto"}),a.jsx(sa,{className:"text-center",children:"Quantidade"}),a.jsx(sa,{className:"text-right",children:"Valor Total"})]})}),a.jsx(Xl,{children:S.map((te,Te)=>a.jsxs(gs,{children:[a.jsxs(Un,{children:[Te+1,". ",te.nome]}),a.jsxs(Un,{className:"text-center",children:["x",te.quantidade]}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.valor)})]},`${te.nome}-${Te}`))})]})})]})}),a.jsx(In,{open:ht,onOpenChange:pt,children:a.jsxs(En,{className:"sm:max-w-[900px] w-full max-h-[85vh] overflow-y-auto bg-surface text-text-primary border-0",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Fechamento do Caixa"}),a.jsxs(Hn,{children:[wt?.sessao?.aberto_em?`${new Date(wt.sessao.aberto_em).toLocaleString("pt-BR")}`:"",wt?.sessao?.fechado_em?`  ${new Date(wt.sessao.fechado_em).toLocaleString("pt-BR")}`:""]})]}),Ze?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando..."}):wt?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Inicial"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:ct(wt.sessao?.saldo_inicial)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total do Dia"}),a.jsx("p",{className:"text-2xl font-bold text-success tabular-nums",children:(()=>{const te=Number(wt.resumo?.totalEntradas||0),Te=Array.isArray(wt.movimentacoes)?wt.movimentacoes:[];let at=0,ee=0,Se=0,$e=0;for(const Ge of Te){const Ye=String(Ge?.tipo||"").toLowerCase(),ft=Number(Ge?.valor||0);Ye==="suprimento"?at+=ft:Ye==="sangria"?ee+=ft:Ye==="troco"?Se+=ft:Ye==="ajuste"&&($e+=ft)}const Be=te+at+$e-ee-Se;return ct(Be)})()})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:(()=>{const te=wt&&typeof wt.valorFinalContado=="number"?wt.valorFinalContado:null;return te!=null?ct(te):""})()})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Descontos"}),a.jsx("p",{className:"text-2xl font-bold text-warning tabular-nums",children:ct(wt.resumo?.totalDescontos)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Lquido"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:ct(wt.resumo?.totalVendasLiquidas)})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Entradas por Finalizadora"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:wt.resumo?.totalPorFinalizadora&&Object.keys(wt.resumo.totalPorFinalizadora).length>0?Object.entries(wt.resumo.totalPorFinalizadora).map(([te,Te])=>a.jsxs("div",{className:"bg-surface-2 rounded-md p-2 border border-border flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate",children:String(te)}),a.jsx("span",{className:"text-sm font-semibold",children:ct(Te)})]},te)):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos."})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Movimentaes"}),!wt.movimentacoes||wt.movimentacoes.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem movimentaes nesta sesso."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Data"}),a.jsx(sa,{children:"Tipo"}),a.jsx(sa,{children:"Obs"}),a.jsx(sa,{className:"text-right",children:"Valor"})]})}),a.jsx(Xl,{children:wt.movimentacoes.map(te=>a.jsxs(gs,{children:[a.jsx(Un,{children:te.created_at?new Date(te.created_at).toLocaleString("pt-BR"):""}),a.jsx(Un,{className:"capitalize",children:te.tipo||""}),a.jsx(Un,{className:"truncate max-w-[280px]",title:te.observacao||"",children:te.observacao||""}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.valor)})]},te.id))})]})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Recebimentos"}),!wt.pagamentos||wt.pagamentos.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem recebimentos no perodo deste caixa."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Data/Hora"}),a.jsx(sa,{children:"Finalizadora"}),a.jsx(sa,{className:"text-right",children:"Valor"}),a.jsx(sa,{children:"Status"})]})}),a.jsx(Xl,{children:wt.pagamentos.map(te=>a.jsxs(gs,{children:[a.jsx(Un,{children:te.recebido_em?new Date(te.recebido_em).toLocaleString("pt-BR"):""}),a.jsx(Un,{children:te.finalizadoras?.nome||te.metodo||""}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.valor)}),a.jsx(Un,{children:te.status||""})]},te.id))})]})})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados."})]})}),a.jsx(In,{open:L,onOpenChange:te=>{W(te),te||(Ae(null),$([]))},children:a.jsxs(En,{className:"max-w-2xl bg-surface text-text-primary border-0",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Clientes"}),a.jsx(Hn,{children:"Ordenados por valor pago no perodo selecionado"})]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto border border-border rounded-md",children:a.jsxs(Gl,{children:[a.jsx(Kl,{children:a.jsxs(gs,{children:[a.jsx(sa,{children:"Cliente"}),a.jsx(sa,{className:"text-right",children:"Pago"})]})}),a.jsx(Xl,{children:A.map((te,Te)=>a.jsxs(gs,{className:"cursor-pointer hover:bg-brand/10",onClick:async()=>{G(!0),Ae(te),he(!0);try{const at=gn(c),ee=tt(u),Se=(te.nome||"").trim(),$e=t?.codigo_empresa;let Be=re.from("clientes").select("id, nome").eq("codigo_empresa",$e).ilike("nome",`%${Se}%`);const{data:Ge}=await Be,Ye=new Set((Ge||[]).map(Qn=>Qn.id));let ft=re.from("comanda_clientes").select("comanda_id").eq("codigo_empresa",$e).ilike("nome_livre",`%${Se}%`);const{data:yt}=await ft;let Et=new Set((yt||[]).map(Qn=>Qn.comanda_id));if(Ye.size>0){let Qn=re.from("comanda_clientes").select("comanda_id, cliente_id").eq("codigo_empresa",$e).in("cliente_id",Array.from(Ye));const{data:Ta}=await Qn;(Ta||[]).forEach(zn=>Et.add(zn.comanda_id))}const br=Array.from(Et);let Ue=re.from("pagamentos").select("id, valor, recebido_em, metodo, finalizadoras!pagamentos_finalizadora_id_fkey(nome), comanda_id, status").in("comanda_id",br).neq("status","Cancelado").neq("status","Estornado").order("recebido_em",{ascending:!1}).limit(50);at&&(Ue=Ue.gte("recebido_em",at)),ee&&(Ue=Ue.lte("recebido_em",ee));const{data:St}=await Ue,Nr=St||[],an=Array.from(new Set(Nr.map(Qn=>Qn.comanda_id).filter(Boolean))),Lr={};if(an.length>0){let Qn=re.from("comandas").select("id, tipo, mesa_id").in("id",an);const{data:Ta}=await Qn,zn=Array.from(new Set((Ta||[]).map(en=>en.mesa_id).filter(Boolean))),Fn={};if(zn.length>0){let en=re.from("mesas").select("id, numero, nome").in("id",zn);const{data:Wa}=await en;(Wa||[]).forEach(Ya=>{Fn[Ya.id]=(Ya.nome||`Mesa ${Ya.numero||""}`).trim()})}(Ta||[]).forEach(en=>{let Wa="";const Ya=String(en?.tipo||"").toLowerCase();Ya==="balcao"||Ya==="balco"?Wa="Balco":Ya==="mesa"||en.mesa_id?Wa=Fn[en.mesa_id]||"Mesa":Ya==="agendamento"&&(Wa="Agendamento"),Lr[en.id]=Wa})}let On=Nr.map(Qn=>({...Qn,origem:Qn.comanda_id&&Lr[Qn.comanda_id]||""}));try{const Qn=t?.codigo_empresa;let Ta=[];if(Ye&&Ye.size>0){let za=re.from("v_agendamento_participantes").select("id, agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text").in("cliente_id",Array.from(Ye));Qn&&(za=za.eq("codigo_empresa",Qn));const{data:vs}=await za;if(Ta=vs||[],Ta.length===0&&Qn){let Os=re.from("v_agendamento_participantes").select("id, agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text").in("cliente_id",Array.from(Ye));const{data:ss}=await Os;Ta=ss||[]}}let zn=[...Ta];const Fn=Array.from(new Set(zn.map(za=>za.agendamento_id).filter(Boolean)));let en=new Set;const Wa={};if(Fn.length>0){let za=re.from("agendamentos").select("id, inicio").in("id",Fn);Qn&&(za=za.eq("codigo_empresa",Qn));const{data:vs}=await za,Os=at?new Date(at).getTime():null,ss=ee?new Date(ee).getTime():null;(vs||[]).forEach(Io=>{const Vs=Io?.inicio?new Date(Io.inicio).getTime():null;Vs!=null&&(Os==null||Vs>=Os)&&(ss==null||Vs<=ss)&&en.add(Io.id),Io?.id&&(Wa[Io.id]=Io.inicio||null)})}zn=zn.filter(za=>en.has(za.agendamento_id));const Ya=new Set;console.debug("[Financeiro][Agendamentos][Detalhe] encontrados:",zn.length),zn.forEach(za=>{const vs=`${za.id}`;if(Ya.has(vs))return;Ya.add(vs);const Os=String(za.status_pagamento||za.status_pagamento_text||"pago").toLowerCase();if(["cancelado","estornado"].includes(Os))return;const ss=za.finalizadora_nome||za.metodo||za.metodo_pagamento||za.forma_pagamento||"Agendamento";On.push({id:`ag-${za.id}`,recebido_em:Wa[za.agendamento_id]||null,finalizadoras:ss?{nome:ss}:null,metodo:ss,origem:"Agendamento",valor:za.valor_cota})})}catch{}$(On)}finally{he(!1)}},children:[a.jsx(Un,{children:te.nome}),a.jsx(Un,{className:"text-right font-semibold",children:ct(te.valor)})]},`${te.nome}-${Te}`))})]})})]})}),a.jsx(In,{open:J,onOpenChange:G,children:a.jsxs(En,{className:"max-w-5xl w-[95vw] md:w-[90vw] max-h-[85vh] bg-surface text-text-primary border-0 overflow-hidden flex flex-col",children:[a.jsxs(Cn,{className:"flex-shrink-0",children:[a.jsx(Nn,{className:"text-lg md:text-xl",children:"Detalhes do Cliente"}),a.jsx(Hn,{className:"text-sm md:text-base",children:ge?.nome})]}),ge?a.jsxs("div",{className:"space-y-4 flex-1 overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 bg-surface-2 rounded-lg flex-shrink-0",children:[a.jsx("span",{className:"text-sm md:text-base text-text-secondary",children:"Total Pago no Perodo"}),a.jsx("span",{className:"text-lg md:text-2xl font-bold text-success",children:ct(ge.valor)})]}),Y?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Carregando detalhes..."}):V.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem pagamentos no perodo selecionado."}):a.jsx("div",{className:"flex-1 overflow-auto border border-border rounded-md",children:a.jsxs(Gl,{children:[a.jsx(Kl,{className:"sticky top-0 bg-surface z-10",children:a.jsxs(gs,{children:[a.jsx(sa,{className:"text-xs md:text-sm w-[70px] md:w-auto",children:"Data"}),a.jsx(sa,{className:"text-xs md:text-sm w-[80px] md:w-auto",children:"Finaliz."}),a.jsx(sa,{className:"text-xs md:text-sm w-[60px] md:w-auto",children:"Origem"}),a.jsx(sa,{className:"text-right text-xs md:text-sm w-[70px] md:w-auto",children:"Valor"})]})}),a.jsx(Xl,{children:V.map(te=>a.jsxs(gs,{children:[a.jsx(Un,{className:"text-xs md:text-sm w-[70px] md:w-auto",children:a.jsx("div",{className:"text-[10px] md:text-xs leading-tight",children:te.recebido_em?new Date(te.recebido_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""})}),a.jsx(Un,{className:"text-xs md:text-sm w-[80px] md:w-auto",children:a.jsx("div",{className:"truncate max-w-[80px] md:max-w-[200px] text-[10px] md:text-xs",title:te.finalizadoras?.nome||te.metodo||"",children:te.finalizadoras?.nome||te.metodo||""})}),a.jsx(Un,{className:"text-xs md:text-sm w-[60px] md:w-auto",children:a.jsx("div",{className:"truncate max-w-[60px] md:max-w-[150px] text-[10px] md:text-xs",title:te.origem||"",children:te.origem||""})}),a.jsx(Un,{className:"text-right font-semibold text-xs md:text-sm w-[70px] md:w-auto",children:a.jsx("div",{className:"text-[10px] md:text-xs whitespace-nowrap",children:ct(te.valor)})})]},te.id))})]})})]}):a.jsx("div",{className:"text-sm text-text-muted py-8 text-center",children:"Nenhum cliente selecionado"})]})})]})})}const qot={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.06,delayChildren:.05}}},SF={hidden:{opacity:0,y:12},visible:{opacity:1,y:0,transition:{duration:.35}}};function zot({children:e,className:t=""}){return a.jsx(Er.div,{variants:SF,className:`fx-card ${t}`,children:e})}const Dk=({icon:e,title:t,value:r,subtitle:n,color:s})=>{const o=e;return a.jsxs(Er.div,{variants:SF,className:"bg-surface rounded-lg border-2 border-border hover:border-border-hover p-4 flex flex-col justify-between gap-2 transition-all duration-300",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("p",{className:"text-text-secondary text-sm font-semibold",children:t}),a.jsx(o,{className:`w-5 h-5 ${s}`})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r}),a.jsx("p",{className:"text-xs text-text-muted",children:n})]})]})};function jV({label:e,...t}){return a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:e}),a.jsx("input",{...t,className:`bg-surface-2 border border-border rounded-md px-3 py-2 text-sm ${t.className||""}`})]})}function Uot(){const{toast:e}=Ss(),{userProfile:t,authReady:r}=qs(),n=p.useRef(!1),[s,o]=p.useState(()=>{try{const _e=JSON.parse(localStorage.getItem("quadras:list")||"[]");return Array.isArray(_e)?_e:[]}catch{return[]}}),[i,l]=p.useState(()=>{try{const _e=JSON.parse(localStorage.getItem("quadras:list")||"[]");return!(Array.isArray(_e)&&_e.length>0)}catch{return!0}}),[c,d]=p.useState(!1),[u,f]=p.useState(!1),[h,m]=p.useState({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),[x,g]=p.useState(""),[y,v]=p.useState(!1),[b,w]=p.useState(null),[_,j]=p.useState({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),[S,C]=p.useState(""),[A,P]=p.useState(!0),[F,O]=p.useState({mostUsed:"-",topClient:"-",totalBookings:"-"}),[I,T]=p.useState(!1),[k,B]=p.useState(null),[z,U]=p.useState({0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0}),[L,W]=p.useState([]),[ge,Ae]=p.useState(""),[V,$]=p.useState(""),[Y,he]=p.useState(!1),J=_e=>{if(!_e)return null;const[Pt,Lt]=String(_e).split(":");return`${Pt.padStart(2,"0")}:${Lt.padStart(2,"0")}:00`},G=_e=>{const Pt=String(_e??"").replace(/\D/g,"");if(!Pt)return"";const Lt=(Number(Pt)/100).toFixed(2),[gr,fr]=Lt.split(".");return`${gr.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${fr}`},ue=_e=>{if(_e==null||_e==="")return NaN;const Pt=String(_e).replace(/\./g,"").replace(",","."),Lt=parseFloat(Pt);return Number.isFinite(Lt)?Lt:NaN},ve=(_e,Pt=!1)=>{if(_e==null||!Number.isFinite(Number(_e)))return"-";const gr=Number(_e).toFixed(2).split("."),fr=gr[0],je=gr[1],$t=`${fr.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${je}`;return Pt?`R$ ${$t}`:$t},ae=_e=>{if(!_e)return"";const[Pt,Lt]=String(_e).split(":");return`${String(Pt).padStart(2,"0")}:${String(Lt).padStart(2,"0")}`},oe=_e=>{if(!_e)return 0;const[Pt,Lt]=String(_e).split(":").map(Number);return(Pt===0&&Lt===0?24:Pt||0)*60+(Lt||0)},me=_e=>{if(!_e)return!1;const Pt=String(_e).split(":");if(Pt.length<2)return!1;const Lt=Number(Pt[1]);return Lt===0||Lt===30},De=_e=>{if(!_e)return"";const[Pt,Lt]=String(_e).split(":");let gr=Math.max(0,Math.min(23,parseInt(Pt||"0",10))),fr=Math.max(0,Math.min(59,parseInt(Lt||"0",10)));const je=Math.round(fr/30);if(je>=2?(gr+=1,fr=0):fr=je*30,gr>=24)return"23:59";const nt=String(gr).padStart(2,"0"),$t=String(fr).padStart(2,"0");return`${nt}:${$t}`};p.useEffect(()=>{if(!c)return;const _e=setTimeout(()=>{console.error("[Quadras] add/update stuck >15s",{route:"/quadras",codigo_empresa:t?.codigo_empresa,editingId:b,formQuadra:h,editForm:_})},15e3);return()=>clearTimeout(_e)},[c,t?.codigo_empresa,b,h,_]);const ne=async()=>{if(!t?.codigo_empresa)return;const _e=s&&s.length>0;_e||l(!0);const{data:Pt,error:Lt}=await re.from("quadras").select("*").eq("codigo_empresa",t.codigo_empresa).order("nome",{ascending:!0});if(Lt){if(!n.current){n.current=!0,setTimeout(ne,800),_e||l(!1);return}e({title:"Erro ao carregar quadras",description:Lt.message}),_e||l(!1);return}const gr=Pt||[];if(gr.length===0&&_e&&!n.current){n.current=!0,setTimeout(ne,600),_e||l(!1);return}n.current=!1,o(gr);try{localStorage.setItem("quadras:list",JSON.stringify(gr))}catch{}_e||l(!1)},ie=_e=>{w(_e.id),j({nome:_e.nome||"",descricao:_e.descricao||"",modalidades:Array.isArray(_e.modalidades)?_e.modalidades:_e.modalidades?[_e.modalidades]:[],tipo:_e.tipo||"Descoberta",status:_e.status||"Ativa",hora_inicio:ae(_e.hora_inicio||"06:00:00"),hora_fim:ae(_e.hora_fim||"24:00:00")||"23:59",valor_hora:_e.valor!=null&&_e.valor!==""?G(String((Number(_e.valor)*2).toFixed(2))):""}),C(""),v(!0)},ht=async()=>{if(!_.nome?.trim()){e({title:"Nome obrigatrio",description:"Informe um nome para a quadra."});return}if(!_.hora_inicio||!_.hora_fim){e({title:"Horrio obrigatrio",description:"Informe horrio de abertura e fechamento."});return}if(!me(_.hora_inicio)||!me(_.hora_fim)){e({title:"Intervalo invlido",description:"Use apenas horrios em horas cheias ou :30."});return}if(oe(_.hora_fim)<=oe(_.hora_inicio)){e({title:"Horrio invlido",description:"Fechamento deve ser depois da abertura."});return}if(!_.modalidades?.length){e({title:"Adicione ao menos uma modalidade",description:"Informe e adicione uma modalidade usando o boto +."});return}if(!t?.codigo_empresa||!b){e({title:"Atualizao indisponvel",description:"Dados insuficientes para atualizar."});return}d(!0);const _e={nome:_.nome.trim(),descricao:_.descricao?.trim()||null,modalidades:_.modalidades,tipo:_.tipo,status:_.status,hora_inicio:J(_.hora_inicio),hora_fim:J(_.hora_fim==="24:00"?"23:59":_.hora_fim)};if(_.valor_hora!=null&&String(_.valor_hora).trim()!==""){const fr=ue(_.valor_hora);!Number.isNaN(fr)&&Number.isFinite(fr)&&(_e.valor=Math.round(fr/2*100)/100)}else _e.valor=null;const Pt=(fr,je)=>Promise.race([fr,new Promise((nt,$t)=>setTimeout(()=>$t(new Error("Timeout ao atualizar quadra (>12s)")),je))]);let Lt,gr;try{({data:Lt,error:gr}=await Pt(re.from("quadras").update(_e).eq("codigo_empresa",t.codigo_empresa).eq("id",b).select("id,nome,descricao,modalidades,tipo,status,hora_inicio,hora_fim,valor").single(),12e3))}catch(fr){console.error("update timeout/error",fr),e({title:"Tempo excedido",description:"Sem resposta do servidor ao atualizar. Verifique conexo e tente novamente."}),d(!1);return}if(d(!1),gr){e({title:"Erro ao atualizar quadra",description:gr.message});return}if(!Lt){await ne(),e({title:"Quadra atualizada",description:`${_e.nome} foi atualizada.`}),v(!1),w(null),C("");return}e({title:"Quadra atualizada",description:`${Lt.nome} foi atualizada.`}),v(!1),w(null),C(""),o(fr=>fr.map(je=>je.id===Lt.id?Lt:je).sort((je,nt)=>je.nome.localeCompare(nt.nome)))};p.useEffect(()=>{try{const _e=JSON.parse(localStorage.getItem("quadras:list")||"[]");Array.isArray(_e)&&_e.length&&s.length===0&&(o(_e),l(!1))}catch{}},[]),p.useEffect(()=>{r&&t?.codigo_empresa&&(ne(),pt())},[r,t?.codigo_empresa]);const pt=async()=>{if(t?.codigo_empresa)try{const _e=new Date;_e.setDate(_e.getDate()-30);const{data:Pt}=await re.from("agendamentos").select("quadra_id, cliente_id, quadras!inner(nome), clientes(nome, codigo)").eq("codigo_empresa",t.codigo_empresa).gte("inicio",_e.toISOString()).neq("status","canceled");if(!Pt||Pt.length===0){O({mostUsed:"Sem dados",topClient:"Sem dados",totalBookings:"0"});return}const Lt={};Pt.forEach(nt=>{const $t=nt.quadras?.nome||"Sem nome";Lt[$t]=(Lt[$t]||0)+1});const gr=Object.entries(Lt).sort((nt,$t)=>$t[1]-nt[1])[0],fr={};Pt.forEach(nt=>{if(nt.cliente_id&&nt.clientes?.nome){const $t=nt.clientes?.codigo;if($t===0||$t==="0")return;const Ut=nt.clientes.nome;fr[Ut]=(fr[Ut]||0)+1}});const je=Object.entries(fr).sort((nt,$t)=>$t[1]-nt[1])[0];O({mostUsed:gr?`${gr[0]} (${gr[1]})`:"Sem dados",topClient:je?`${je[0]} (${je[1]})`:"Sem dados",totalBookings:Pt.length.toString()})}catch(_e){console.error("Erro ao carregar stats:",_e),O({mostUsed:"Erro",topClient:"Erro",totalBookings:"0"})}},Ze=async()=>{if(console.groupCollapsed("[Quadras] addQuadra: CLICK"),console.time("[Quadras] addQuadra duration"),console.log("pre-validate",{codigo_empresa:t?.codigo_empresa,formQuadra:h}),!h.nome?.trim()){e({title:"Nome obrigatrio",description:"Informe um nome para a quadra."}),console.warn("validation: missing nome"),console.groupEnd();return}if(!h.modalidades?.length){e({title:"Adicione ao menos uma modalidade",description:"Informe e adicione uma modalidade usando o boto +."});return}if(!h.hora_inicio||!h.hora_fim){e({title:"Horrio obrigatrio",description:"Informe horrio de abertura e fechamento."});return}if(!me(h.hora_inicio)||!me(h.hora_fim)){e({title:"Intervalo invlido",description:"Use apenas horrios em horas cheias ou :30."});return}if(oe(h.hora_fim)<=oe(h.hora_inicio)){e({title:"Horrio invlido",description:"Fechamento deve ser depois da abertura."});return}if(!t?.codigo_empresa){e({title:"Empresa no localizada",description:"Associe o usurio a uma empresa para cadastrar quadras."});return}d(!0),console.log("validated, building payload");const _e={codigo_empresa:t.codigo_empresa,nome:h.nome.trim(),descricao:h.descricao?.trim()||null,modalidades:h.modalidades,tipo:h.tipo,status:h.status,hora_inicio:J(h.hora_inicio),hora_fim:J(h.hora_fim==="24:00"?"23:59":h.hora_fim)};if(h.valor_hora!=null&&String(h.valor_hora).trim()!==""){const fr=ue(h.valor_hora);!Number.isNaN(fr)&&Number.isFinite(fr)&&(_e.valor=Math.round(fr/2*100)/100)}console.log("payload",_e);const Pt=(fr,je)=>Promise.race([fr,new Promise((nt,$t)=>setTimeout(()=>$t(new Error("Timeout ao inserir quadra (>12s)")),je))]);let Lt,gr;try{({data:Lt,error:gr}=await Pt(re.from("quadras").insert(_e).select("id,nome,descricao,modalidades,tipo,status,hora_inicio,hora_fim,valor").single(),12e3))}catch(fr){d(!1),console.error("insert timeout/error",fr),e({title:"Tempo excedido",description:"Sem resposta do servidor ao cadastrar. Verifique conexo e tente novamente."}),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}if(d(!1),gr){e({title:"Erro ao cadastrar quadra",description:gr.message}),console.error("insert error",{code:gr.code,message:gr.message,details:gr.details}),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}if(!Lt){console.warn("insert success sem representao; recarregando lista"),await ne(),e({title:"Quadra adicionada",description:`${_e.nome} foi cadastrada.`}),m({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),f(!1),g(""),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}console.log("insert success",{id:Lt?.id,nome:Lt?.nome}),e({title:"Quadra adicionada",description:`${Lt.nome} foi cadastrada.`}),m({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),f(!1),g(""),o(fr=>[Lt,...fr].sort((je,nt)=>je.nome.localeCompare(nt.nome))),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd()},vt=async _e=>{B(_e),he(!0);try{const{data:Pt,error:Lt}=await re.from("quadras_dias_funcionamento").select("*").eq("quadra_id",_e.id).eq("codigo_empresa",t.codigo_empresa);if(Lt)throw Lt;const gr={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0},fr=[];Pt?.forEach(je=>{je.tipo==="dia_semana"?gr[je.dia_semana]=je.funciona:je.tipo==="data_fechamento"&&fr.push(je)}),U(gr),W(fr),T(!0)}catch(Pt){console.error("Erro ao carregar dias de funcionamento:",Pt),e({title:"Erro",description:"No foi possvel carregar as configuraes."})}finally{he(!1)}},wt=async()=>{if(k){he(!0);try{await re.from("quadras_dias_funcionamento").delete().eq("quadra_id",k.id).eq("tipo","dia_semana");const _e=Object.entries(z).map(([Lt,gr])=>({quadra_id:k.id,codigo_empresa:t.codigo_empresa,tipo:"dia_semana",dia_semana:parseInt(Lt),funciona:gr,observacao:"Configurao de dias da semana"})),{error:Pt}=await re.from("quadras_dias_funcionamento").insert(_e);if(Pt)throw Pt;e({title:"Sucesso",description:"Dias da semana salvos com sucesso!"})}catch(_e){console.error("Erro ao salvar dias da semana:",_e),e({title:"Erro",description:"No foi possvel salvar as configuraes."})}finally{he(!1)}}},gt=async()=>{if(!(!k||!ge)){he(!0);try{const{data:_e,error:Pt}=await re.from("quadras_dias_funcionamento").insert({quadra_id:k.id,codigo_empresa:t.codigo_empresa,tipo:"data_fechamento",data_fechamento:ge,funciona:!1,observacao:V||"Fechamento especial"}).select().single();if(Pt)throw Pt;W(Lt=>[...Lt,_e]),Ae(""),$(""),e({title:"Sucesso",description:"Data de fechamento adicionada!"})}catch(_e){console.error("Erro ao adicionar data de fechamento:",_e),e({title:"Erro",description:"No foi possvel adicionar a data de fechamento."})}finally{he(!1)}}},er=async _e=>{he(!0);try{const{error:Pt}=await re.from("quadras_dias_funcionamento").delete().eq("id",_e);if(Pt)throw Pt;W(Lt=>Lt.filter(gr=>gr.id!==_e)),e({title:"Sucesso",description:"Data de fechamento removida!"})}catch(Pt){console.error("Erro ao remover data de fechamento:",Pt),e({title:"Erro",description:"No foi possvel remover a data de fechamento."})}finally{he(!1)}};return a.jsx(a.Fragment,{children:a.jsxs(Er.div,{variants:qot,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsxs(Er.div,{variants:SF,className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-black text-text-primary tracking-tighter",children:"Controle de Quadras"}),a.jsx("p",{className:"text-text-secondary",children:"Gerencie as quadras e horrios disponveis."})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{variant:"outline",size:"icon",onClick:()=>P(_e=>!_e),title:A?"Ocultar resumo":"Mostrar resumo","aria-label":A?"Ocultar resumo":"Mostrar resumo",children:A?a.jsx(jg,{className:"h-4 w-4"}):a.jsx(zg,{className:"h-4 w-4"})}),a.jsx(se,{onClick:()=>f(!0),className:"shadow-sm",children:"Adicionar Quadra"})]})]}),A&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsx(Dk,{icon:sd,title:"Quadra Mais Usada",value:F.mostUsed,subtitle:"ltimos 30 dias",color:"text-brand"}),a.jsx(Dk,{icon:tc,title:"Cliente Top",value:F.topClient,subtitle:"Mais agendamentos no ms",color:"text-purple"}),a.jsx(Dk,{icon:Cm,title:"Total de Agendamentos",value:F.totalBookings,subtitle:"ltimos 30 dias",color:"text-success"})]}),a.jsxs(zot,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Quadras"}),a.jsx("div",{className:"text-xs text-text-muted",children:i?"Carregando...":`${s.length} registro(s)`})]}),!i&&s.length===0?a.jsxs("div",{className:"text-sm text-text-muted py-8 text-center",children:[a.jsx("div",{className:"font-medium mb-1",children:"Nenhuma quadra cadastrada"}),a.jsx("div",{className:"mb-4",children:'Clique em "Adicionar Quadra" para cadastrar a primeira.'}),a.jsx(se,{onClick:()=>f(!0),children:"Adicionar Quadra"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden space-y-3",children:s.map(_e=>a.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:uh(_e.nome),boxShadow:"0 0 0 2px rgba(255,255,255,0.06)"},"aria-hidden":"true"}),a.jsx("span",{className:"font-semibold text-base text-text-primary truncate",children:_e.nome})]}),a.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs border flex-shrink-0 ${_e.status==="Ativa"?"bg-emerald-50/5 border-emerald-500/30 text-emerald-400":_e.status==="Manuteno"?"bg-amber-50/5 border-amber-500/30 text-amber-400":"bg-surface-2 border-border text-text-muted"}`,children:_e.status})]}),Array.isArray(_e.modalidades)&&_e.modalidades.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted mb-1 block",children:"Modalidades"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:_e.modalidades.map(Pt=>a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-xs",children:Pt},Pt))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Valor/hora"}),a.jsx("span",{className:"text-sm font-medium",children:_e.valor==null||_e.valor===""?"-":ve(Number(_e.valor)*2,!0)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Funcionamento"}),a.jsxs("span",{className:"text-sm font-medium",children:[ae(_e.hora_inicio)," - ",ae(_e.hora_fim==="24:00:00"?"23:59:00":_e.hora_fim)]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>vt(_e),className:"flex items-center gap-1",children:[a.jsx(lo,{className:"h-3 w-3"}),"Dias"]}),a.jsx(se,{variant:"outline",size:"sm",onClick:()=>ie(_e),children:"Editar"})]})]},_e.id))}),a.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-border bg-surface-0",children:a.jsxs(Gl,{children:[a.jsx(Kl,{className:"bg-surface-2/60 backdrop-blur supports-[backdrop-filter]:bg-surface-2/70",children:a.jsxs(gs,{children:[a.jsx(sa,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Nome"}),a.jsx(sa,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Modalidades"}),a.jsx(sa,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Valor por hora"}),a.jsx(sa,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Funcionamento"}),a.jsx(sa,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Status"}),a.jsx(sa,{className:"text-right text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Aes"})]})}),a.jsx(Xl,{children:s.map(_e=>a.jsxs(gs,{className:"hover:bg-surface-2/40 transition-colors",children:[a.jsx(Un,{className:"font-medium text-sm md:text-base text-text-primary",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:uh(_e.nome),boxShadow:"0 0 0 2px rgba(255,255,255,0.06)"},"aria-hidden":"true"}),a.jsx("span",{children:_e.nome})]})}),a.jsx(Un,{className:"text-sm md:text-base",children:Array.isArray(_e.modalidades)&&_e.modalidades.length>0?a.jsx("div",{className:"flex flex-wrap gap-1",children:_e.modalidades.map(Pt=>a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-[11px] md:text-xs",children:Pt},Pt))}):_e.modalidades||""}),a.jsx(Un,{className:"text-sm md:text-base",children:_e.valor==null||_e.valor===""?"-":a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-[11px] md:text-xs",children:ve(Number(_e.valor)*2,!0)})}),a.jsxs(Un,{className:"text-sm md:text-base",children:[ae(_e.hora_inicio)," - ",ae(_e.hora_fim==="24:00:00"?"23:59:00":_e.hora_fim)]}),a.jsx(Un,{className:"text-sm md:text-base",children:a.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-[11px] md:text-xs border ${_e.status==="Ativa"?"bg-emerald-50/5 border-emerald-500/30 text-emerald-400":_e.status==="Manuteno"?"bg-amber-50/5 border-amber-500/30 text-amber-400":"bg-surface-2 border-border text-text-muted"}`,children:_e.status})}),a.jsx(Un,{className:"text-right",children:a.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[a.jsxs(se,{variant:"outline",size:"sm",onClick:()=>vt(_e),className:"text-sm",children:[a.jsx(lo,{className:"h-3 w-3 mr-1"}),"Dias"]}),a.jsx(se,{variant:"outline",size:"sm",onClick:()=>ie(_e),className:"text-sm",children:"Editar"})]})})]},_e.id))})]})})]})]}),a.jsx(In,{open:u,onOpenChange:f,children:a.jsxs(En,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Adicionar Quadra"}),a.jsx(Hn,{children:"Cadastre uma nova quadra da sua empresa."})]}),a.jsxs("div",{className:"grid gap-4 py-2",children:[a.jsx(jV,{label:"Nome",value:h.nome,onChange:_e=>m({...h,nome:_e.target.value}),placeholder:"Ex.: Quadra Society 2"}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Descrio (opcional)"}),a.jsx("textarea",{value:h.descricao,onChange:_e=>m({...h,descricao:_e.target.value}),placeholder:"Ex.: Quadra oficial com grama sinttica, iluminao LED, vestirios completos",rows:3,className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm resize-none"})]}),a.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Modalidades"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:x,onChange:_e=>g(_e.target.value),onKeyDown:_e=>{if(_e.key==="Enter"){_e.preventDefault();const Pt=x.trim();if(!Pt)return;m(Lt=>Lt.modalidades.some(fr=>fr.toLowerCase()===Pt.toLowerCase())?Lt:{...Lt,modalidades:[...Lt.modalidades,Pt]}),g("")}},placeholder:"Ex.: Society",className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-60 sm:w-72 focus:outline-none focus:ring-2 focus:ring-primary/30"}),a.jsx(se,{type:"button",variant:"secondary",className:"bg-amber-500 hover:bg-amber-400 text-black disabled:opacity-50 disabled:cursor-not-allowed",disabled:!x.trim(),onClick:()=>{const _e=x.trim();_e&&(m(Pt=>Pt.modalidades.some(gr=>gr.toLowerCase()===_e.toLowerCase())?Pt:{...Pt,modalidades:[...Pt.modalidades,_e]}),g(""))},"aria-label":"Adicionar modalidade",title:"Adicionar modalidade",children:"+"})]}),h.modalidades.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:h.modalidades.map(_e=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border bg-surface-2 text-xs",children:[a.jsx("span",{className:"px-0.5",children:_e}),a.jsx("button",{type:"button",className:"text-text-muted hover:text-destructive/80",onClick:()=>m(Pt=>({...Pt,modalidades:Pt.modalidades.filter(Lt=>Lt!==_e)})),"aria-label":`Remover ${_e}`,title:`Remover ${_e}`,children:""})]},_e))})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Tipo"}),a.jsxs("select",{value:h.tipo,onChange:_e=>m({...h,tipo:_e.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Descoberta"}),a.jsx("option",{children:"Coberta"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Valor por hora (R$)"}),a.jsx("input",{type:"text",inputMode:"decimal",step:"0.01",placeholder:"0,00",value:h.valor_hora,onChange:_e=>m({...h,valor_hora:G(_e.target.value)}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-40"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Abertura"}),a.jsx("input",{type:"time",step:"1800",value:h.hora_inicio,onChange:_e=>m({...h,hora_inicio:_e.target.value}),onBlur:_e=>m(Pt=>({...Pt,hora_inicio:De(_e.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Fechamento"}),a.jsx("input",{type:"time",step:"1800",value:h.hora_fim,onChange:_e=>m({...h,hora_fim:_e.target.value}),onBlur:_e=>m(Pt=>({...Pt,hora_fim:De(_e.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Status"}),a.jsxs("select",{value:h.status,onChange:_e=>m({...h,status:_e.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Ativa"}),a.jsx("option",{children:"Inativa"}),a.jsx("option",{children:"Manuteno"})]})]})]}),a.jsx(Na,{children:a.jsx(se,{onClick:Ze,disabled:c||h.modalidades.length===0,children:c?"Adicionando...":"Salvar"})})]})}),a.jsx(In,{open:y,onOpenChange:v,children:a.jsxs(En,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Editar Quadra"}),a.jsx(Hn,{children:"Atualize os dados da quadra selecionada."})]}),a.jsxs("div",{className:"grid gap-4 py-2",children:[a.jsx(jV,{label:"Nome",value:_.nome,onChange:_e=>j({..._,nome:_e.target.value}),placeholder:"Ex.: Quadra Society 2"}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Descrio (opcional)"}),a.jsx("textarea",{value:_.descricao,onChange:_e=>j({..._,descricao:_e.target.value}),placeholder:"Ex.: Quadra oficial com grama sinttica, iluminao LED, vestirios completos",rows:3,className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm resize-none"})]}),a.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Modalidades"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:S,onChange:_e=>C(_e.target.value),onKeyDown:_e=>{if(_e.key==="Enter"){_e.preventDefault();const Pt=S.trim();if(!Pt)return;j(Lt=>Lt.modalidades.some(fr=>fr.toLowerCase()===Pt.toLowerCase())?Lt:{...Lt,modalidades:[...Lt.modalidades,Pt]}),C("")}},placeholder:"Ex.: Society",className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-60 sm:w-72 focus:outline-none focus:ring-2 focus:ring-primary/30"}),a.jsx(se,{type:"button",variant:"secondary",onClick:()=>{const _e=S.trim();_e&&(j(Pt=>Pt.modalidades.some(gr=>gr.toLowerCase()===_e.toLowerCase())?Pt:{...Pt,modalidades:[...Pt.modalidades,_e]}),C(""))},children:"+"})]}),_.modalidades.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:_.modalidades.map(_e=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border bg-surface-2 text-xs",children:[a.jsx("span",{className:"px-0.5",children:_e}),a.jsx("button",{type:"button",className:"text-text-muted hover:text-destructive/80",onClick:()=>j(Pt=>({...Pt,modalidades:Pt.modalidades.filter(Lt=>Lt!==_e)})),"aria-label":`Remover ${_e}`,title:`Remover ${_e}`,children:""})]},_e))})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Tipo"}),a.jsxs("select",{value:_.tipo,onChange:_e=>j({..._,tipo:_e.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Descoberta"}),a.jsx("option",{children:"Coberta"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Valor por hora (R$)"}),a.jsx("input",{type:"text",inputMode:"decimal",step:"0.01",placeholder:"0,00",value:_.valor_hora,onChange:_e=>j({..._,valor_hora:G(_e.target.value)}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-40"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Abertura"}),a.jsx("input",{type:"time",step:"1800",value:_.hora_inicio,onChange:_e=>j({..._,hora_inicio:_e.target.value}),onBlur:_e=>j(Pt=>({...Pt,hora_inicio:De(_e.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Fechamento"}),a.jsx("input",{type:"time",step:"1800",value:_.hora_fim,onChange:_e=>j({..._,hora_fim:_e.target.value}),onBlur:_e=>j(Pt=>({...Pt,hora_fim:De(_e.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Status"}),a.jsxs("select",{value:_.status,onChange:_e=>j({..._,status:_e.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Ativa"}),a.jsx("option",{children:"Inativa"}),a.jsx("option",{children:"Manuteno"})]})]})]}),a.jsx(Na,{children:a.jsx(se,{onClick:ht,disabled:c||_.modalidades.length===0,children:c?"Salvando...":"Salvar alteraes"})})]})}),a.jsx(In,{open:I,onOpenChange:T,children:a.jsxs(En,{className:"sm:max-w-[600px] max-h-[90vh] overflow-hidden pointer-events-none",children:[a.jsx("div",{className:"fixed inset-0 z-50 backdrop-blur-lg bg-black/60 flex items-center justify-center pointer-events-auto",children:a.jsx("div",{className:"rounded-2xl border border-white/30 bg-slate-900 shadow-2xl max-w-sm w-full text-center mx-4",children:a.jsxs("div",{className:"px-8 py-10",children:[a.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[a.jsx("div",{className:"w-14 h-14 bg-brand rounded-xl flex items-center justify-center flex-shrink-0",children:a.jsx(sd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline select-none",children:[a.jsx("span",{className:"font-extrabold text-3xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-3xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-3xl",style:{color:"#FFFFFF"},children:" Arena"})]})]}),a.jsx("div",{className:"text-2xl font-bold text-white mb-3",children:"Em Desenvolvimento"}),a.jsx("p",{className:"text-base text-gray-200",children:"Esta funcionalidade est sendo desenvolvida e em breve estar disponvel."}),a.jsx("div",{className:"mt-8 flex items-center justify-center",children:a.jsx(se,{variant:"outline",onClick:()=>T(!1),children:"Fechar"})})]})})}),a.jsxs(Cn,{children:[a.jsxs(Nn,{className:"flex items-center gap-2",children:[a.jsx(lo,{className:"h-5 w-5"}),"Dias de Funcionamento - ",k?.nome]}),a.jsx(Hn,{children:"Configure os dias da semana que a quadra funciona e adicione datas especficas de fechamento."})]}),Y?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando configuraes..."})}):a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:"Dias da Semana"}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{key:0,label:"Domingo",short:"Dom"},{key:1,label:"Segunda",short:"Seg"},{key:2,label:"Tera",short:"Ter"},{key:3,label:"Quarta",short:"Qua"},{key:4,label:"Quinta",short:"Qui"},{key:5,label:"Sexta",short:"Sex"},{key:6,label:"Sbado",short:"Sb"}].map(_e=>a.jsxs("label",{className:"flex items-center gap-2 p-3 rounded-lg border border-border hover:bg-surface-2/50 cursor-pointer transition-colors",children:[a.jsx("input",{type:"checkbox",checked:z[_e.key],onChange:Pt=>U(Lt=>({...Lt,[_e.key]:Pt.target.checked})),className:"w-4 h-4 text-primary bg-surface-2 border-border rounded focus:ring-primary focus:ring-2"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-medium text-text-primary",children:_e.short}),a.jsx("span",{className:"text-xs text-text-muted hidden sm:block",children:_e.label})]})]},_e.key))}),a.jsx("div",{className:"mt-4",children:a.jsx(se,{onClick:wt,disabled:Y,size:"sm",children:Y?"Salvando...":"Salvar Dias da Semana"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:"Datas de Fechamento"}),a.jsx("div",{className:"bg-surface-2/30 rounded-lg p-4 mb-4",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Data"}),a.jsx("input",{type:"date",value:ge,onChange:_e=>Ae(_e.target.value),className:"w-full bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Observao"}),a.jsx("input",{type:"text",placeholder:"Ex: Feriado, Manuteno",value:V,onChange:_e=>$(_e.target.value),className:"w-full bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx(se,{onClick:gt,disabled:!ge||Y,size:"sm",className:"w-full sm:w-auto",children:"Adicionar"})})]})}),L.length>0?a.jsx("div",{className:"space-y-2",children:L.map(_e=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2/50 rounded-lg border border-border",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(eu,{className:"h-4 w-4 text-text-muted"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-text-primary",children:new Date(_e.data_fechamento+"T00:00:00").toLocaleDateString("pt-BR")}),_e.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:_e.observacao})]})]}),a.jsx(se,{variant:"outline",size:"sm",onClick:()=>er(_e.id),disabled:Y,className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:a.jsx(lc,{className:"h-3 w-3"})})]},_e.id))}):a.jsx("div",{className:"text-center py-6 text-sm text-text-muted",children:"Nenhuma data de fechamento configurada"})]})]}),a.jsx(Na,{children:a.jsx(se,{variant:"outline",onClick:()=>T(!1),children:"Fechar"})})]})})]})})}function Qu(e){const t=String(e||"").toLowerCase();return t.includes("/producao")||t.includes("/produo")?"producao":"homologacao"}async function Zu({acao:e,ambiente:t,cnpj:r,dados:n}){const s={acao:e,ambiente:t||"homologacao",cnpj:(r||"").replace(/\D/g,""),dados:n||{}},{data:o,error:i}=await re.functions.invoke("emissor",{body:s});if(i){const l=new Error(i.message||"Erro na API fiscal");throw l.response=i,l}if(o&&o.status&&o.status>=400&&!o.ok){const l=new Error(o.message||"Erro na API fiscal");throw l.status=o.status,l.response=o.response,l}return o}async function Vot({baseUrl:e,apiKey:t,cnpj:r}){try{const n=Qu(e),s=await Zu({acao:"teste_conexao",ambiente:n,cnpj:r,dados:{}}),o=s?.status,i={via:s?.via||"edge",ambiente:s?.ambiente||n};return o===200?{reachable:!0,authorized:!0,status:o,response:s?.response,meta:i}:o===400?{reachable:!0,authorized:!0,status:o,response:s?.response,meta:i}:o===401||o===403?{reachable:!0,authorized:!1,status:o,response:s?.response,meta:i}:o===404?{reachable:!1,authorized:!1,status:o,response:s?.response,meta:i}:{reachable:!0,authorized:null,status:o,response:s?.response,meta:i}}catch(n){return{reachable:!1,authorized:!1,error:n?.message||String(n)}}}async function NV({baseUrl:e,apiKey:t,cnpj:r,dados:n}){if(!r)throw new Error("cnpj obrigatrio");if(!n)throw new Error("dados obrigatrio");const s=Qu(e);return Zu({acao:"nfce_enviar",ambiente:s,cnpj:r,dados:n})}async function ab({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfce_consultar",ambiente:s,cnpj:r,dados:n})}async function SV({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfce_cancelar",ambiente:s,cnpj:r,dados:n})}async function sb({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfce_pdf",ambiente:s,cnpj:r,dados:n})}async function ob({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfce_xml",ambiente:s,cnpj:r,dados:n})}async function Wot({baseUrl:e,apiKey:t,cnpj:r,dados:n}){if(!r)throw new Error("cnpj obrigatrio");if(!n)throw new Error("dados obrigatrio");const s=Qu(e),o={...n};try{delete o.Numero}catch{}try{delete o.Serie}catch{}return Zu({acao:"nfe_enviar",ambiente:s,cnpj:r,dados:o})}async function Mk({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfe_consultar",ambiente:s,cnpj:r,dados:n})}async function Hot({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfe_cancelar",ambiente:s,cnpj:r,dados:n})}async function Rk({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfe_pdf",ambiente:s,cnpj:r,dados:n})}async function Fk({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=Qu(e);return Zu({acao:"nfe_xml",ambiente:s,cnpj:r,dados:n})}function lf(e){const t=(e?.ambiente||"homologacao").toLowerCase(),r=t==="producao",n=r?e?.transmitenota_base_url_prod||e?.transmitenota_base_url||"":e?.transmitenota_base_url_hml||e?.transmitenota_base_url||"",s=r?e?.transmitenota_apikey_prod||e?.transmitenota_apikey||"":e?.transmitenota_apikey_hml||e?.transmitenota_apikey||"";return{baseUrl:n||(r?"/api/producao":"/api/homologacao"),apiKey:s,ambiente:t,cnpj:(e?.cnpj||"").replace(/\D/g,"")}}const Got={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.06,delayChildren:.05}}},Kot={hidden:{opacity:0,y:12},visible:{opacity:1,y:0,transition:{duration:.35}}};function CV({children:e,className:t=""}){return a.jsx(Er.div,{variants:Kot,className:`fx-card ${t}`,children:e})}function fi({label:e,...t}){return a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:e}),a.jsx("input",{...t,className:`bg-surface-2 border border-border rounded-md px-3 py-2 text-sm ${t.className||""}`})]})}function Xot(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,18)}function Yot(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,15)}function Qf(e){return String(e||"").replace(/\D/g,"")}function Jot(){const{toast:e}=Ss(),{company:t,userProfile:r,reloadCompany:n}=qs(),[s,o]=p.useState(!1),[i,l]=p.useState({razao_social:"",nome_fantasia:"",cnpj:"",email:"",telefone:"",endereco:"",logo_url:"",inscricao_estadual:"",regime_tributario:"",ambiente:"homologacao",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",nfce_serie:"1",nfce_numeracao:"1",nfce_itoken:"",nfe_serie:"",nfe_numeracao:"",transmitenota_apikey:"",transmitenota_base_url:"",transmitenota_base_url_hml:"",transmitenota_apikey_hml:"",transmitenota_base_url_prod:"",transmitenota_apikey_prod:""}),c=p.useRef(null),[d,u]=p.useState(""),f=p.useRef(!0);p.useEffect(()=>(f.current=!0,()=>{f.current=!1}),[]),p.useEffect(()=>{(async()=>{try{const v=r?.codigo_empresa||null;if(!v)return;const b=`empresa:form:${v}`;try{const C=localStorage.getItem(b);if(C){const A=JSON.parse(C);A&&typeof A=="object"&&(l(P=>({...P,...A})),A.logo_url&&u(`${A.logo_url.split("?")[0]}?v=${Date.now()}`))}}catch{}const w=setTimeout(()=>{if(f.current)try{const C=localStorage.getItem(b);if(C){const A=JSON.parse(C);A&&typeof A=="object"&&(console.warn("[Empresas] slow fallback: using cached form"),l(P=>({...P,...A})),A.logo_url&&u(`${A.logo_url.split("?")[0]}?v=${Date.now()}`))}}catch{}},5e3),{data:_,error:j}=await re.from("empresas").select("*").eq("codigo_empresa",v).single();if(clearTimeout(w),j)throw j;if(!f.current)return;const S={razao_social:_?.razao_social||"",nome_fantasia:_?.nome_fantasia||_?.nome||"",cnpj:_?.cnpj||"",email:_?.email||"",telefone:_?.telefone||"",endereco:_?.endereco||"",logo_url:_?.logo_url||"",inscricao_estadual:_?.inscricao_estadual||"",regime_tributario:_?.regime_tributario!=null?String(_.regime_tributario):"",ambiente:_?.ambiente||"homologacao",logradouro:_?.logradouro||"",numero:_?.numero||"",complemento:_?.complemento||"",bairro:_?.bairro||"",cidade:_?.cidade||"",uf:_?.uf||"",cep:_?.cep||"",codigo_municipio_ibge:_?.codigo_municipio_ibge||"",nfce_serie:_?.nfce_serie!=null?String(_.nfce_serie):"1",nfce_numeracao:_?.nfce_numeracao!=null?String(_.nfce_numeracao):"1",nfce_itoken:_?.nfce_itoken||"",nfe_serie:_?.nfe_serie!=null?String(_.nfe_serie):"",nfe_numeracao:_?.nfe_numeracao!=null?String(_.nfe_numeracao):"",transmitenota_apikey:_?.transmitenota_apikey||"",transmitenota_base_url:_?.transmitenota_base_url||"",transmitenota_base_url_hml:_?.transmitenota_base_url_hml||"",transmitenota_apikey_hml:_?.transmitenota_apikey_hml||"",transmitenota_base_url_prod:_?.transmitenota_base_url_prod||"",transmitenota_apikey_prod:_?.transmitenota_apikey_prod||""};l(S),u(S.logo_url?`${S.logo_url.split("?")[0]}?v=${Date.now()}`:"");try{localStorage.setItem(b,JSON.stringify(S))}catch{}}catch(v){console.warn("Falha ao carregar empresa:",v)}})()},[r?.codigo_empresa]),p.useEffect(()=>{if(!i.logo_url){u("");return}const y=i.logo_url.split("?")[0];u(`${y}?v=${Date.now()}`)},[i.logo_url]);const h=async y=>{if(y.preventDefault(),!s){if(!i.razao_social?.trim()||!i.cnpj?.trim()){e({title:"Campos obrigatrios",description:"Preencha Razo Social e CNPJ."});return}if(!r?.codigo_empresa){e({title:"Empresa no vinculada",description:"No foi possvel identificar a empresa do usurio para salvar."});return}try{o(!0);const v={nome:i.nome_fantasia||i.razao_social||"Empresa",razao_social:i.razao_social||null,nome_fantasia:i.nome_fantasia||null,cnpj:i.cnpj?.replace(/\D/g,"")||null,email:i.email||null,telefone:i.telefone||null,endereco:i.endereco||null,logo_url:i.logo_url||null,inscricao_estadual:i.inscricao_estadual?.trim()||null,regime_tributario:i.regime_tributario?Number(i.regime_tributario):null,ambiente:i.ambiente||"homologacao",logradouro:i.logradouro?.trim()||null,numero:i.numero?.trim()||null,complemento:i.complemento?.trim()||null,bairro:i.bairro?.trim()||null,cidade:i.cidade?.trim()||null,uf:(i.uf||"").toUpperCase().slice(0,2)||null,cep:Qf(i.cep)||null,codigo_municipio_ibge:i.codigo_municipio_ibge?.trim()||null,nfce_serie:i.nfce_serie?Number(i.nfce_serie):null,nfce_numeracao:i.nfce_numeracao?Number(i.nfce_numeracao):null,nfce_itoken:i.nfce_itoken?.trim()||null,nfe_serie:i.nfe_serie?Number(i.nfe_serie):null,nfe_numeracao:i.nfe_numeracao?Number(i.nfe_numeracao):null,transmitenota_apikey:i.transmitenota_apikey?.trim()||null,transmitenota_base_url:i.transmitenota_base_url?.trim()||null,transmitenota_base_url_hml:i.transmitenota_base_url_hml?.trim()||null,transmitenota_apikey_hml:i.transmitenota_apikey_hml?.trim()||null,transmitenota_base_url_prod:i.transmitenota_base_url_prod?.trim()||null,transmitenota_apikey_prod:i.transmitenota_apikey_prod?.trim()||null},b=async(w,_=1)=>{try{const{error:j}=await re.from("empresas").upsert({codigo_empresa:r.codigo_empresa,...w},{onConflict:"codigo_empresa"}).select("id").single();if(j)throw j;return!0}catch(j){const C=String(j?.message||"").match(/the '([^']+)' column|column\s+"([^"]+)"\s+of/i),A=C&&(C[1]||C[2])?C[1]||C[2]:null;if(A&&w.hasOwnProperty(A)&&_<=5){console.warn("[Empresas] Removendo coluna inexistente e tentando novamente:",A);const P={...w};return delete P[A],await b(P,_+1)}throw j}};await b(v),await n?.(),e({title:"Dados salvos",description:"As informaes da empresa foram atualizadas."})}catch(v){console.error(v);const b=(v?.message||v?.hint||"").toString()||"No foi possvel salvar os dados. Verifique as permisses e tente novamente.";e({title:"Erro ao salvar",description:b})}finally{o(!1)}}},m=async y=>{try{const v=y.target.files?.[0];if(!v)return;if(!r?.codigo_empresa){e({title:"Empresa no vinculada",description:"Seu usurio no est associado a uma empresa."});return}const b=v.name.split(".").pop()?.toLowerCase()||"png",w=`${r.codigo_empresa}/logo.${b}`,_=(()=>{try{return(localStorage.getItem("custom-auth-token")||"").trim()}catch{return""}})();if(_){const C=`${yO}/storage/v1/object/logos/${w}`,A=await fetch(C,{method:"POST",headers:{Authorization:`Bearer ${_}`,apikey:bO,"x-upsert":"true","Content-Type":v.type||"application/octet-stream"},body:v});if(!A.ok){const P=await A.text();let F;try{F=P?JSON.parse(P):null}catch{}const O=F?.message||F?.error||A.statusText||"Falha no upload",I=new Error(O);throw I.status=A.status,I.response=F||P,I}}else{const{data:{session:C}}=await re.auth.getSession(),A=C?.access_token||"";if(A){const P=`${yO}/storage/v1/object/logos/${w}`,F=await fetch(P,{method:"POST",headers:{Authorization:`Bearer ${A}`,apikey:bO,"x-upsert":"true","Content-Type":v.type||"application/octet-stream"},body:v});if(!F.ok){const O=await F.text();let I;try{I=O?JSON.parse(O):null}catch{}const T=I?.message||I?.error||F.statusText||"Falha no upload",k=new Error(T);throw k.status=F.status,k.response=I||O,k}}else{const{error:P}=await re.storage.from("logos").upload(w,v,{upsert:!0,contentType:v.type||void 0});if(P)throw P}}const{data:j}=re.storage.from("logos").getPublicUrl(w),S=j?.publicUrl||"";l(C=>({...C,logo_url:S})),u(S?`${S}?v=${Date.now()}`:""),e({title:"Logo enviada",description:"A imagem foi carregada com sucesso. Lembre-se de salvar."})}catch(v){console.error("Falha no upload da logo:",v),e({title:"Erro no upload",description:"No foi possvel enviar a logo. Tente outro arquivo."})}finally{c.current&&(c.current.value="")}};function x(y){return String(y||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim()}async function g(){const y=Qf(i.cnpj);if(y.length!==14){e({title:"CNPJ invlido",description:"Informe 14 dgitos para buscar.",variant:"destructive"});return}try{o(!0);const v=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${y}`);if(!v.ok){let k="Falha ao consultar CNPJ";try{const B=await v.json();B?.message&&(k=B.message)}catch{}throw new Error(k)}const b=await v.json();try{console.info("[empresas] BuscarCNPJ:payload",b)}catch{}const w=b.razao_social||b.nome||"",_=b.nome_fantasia||"",j=b.logradouro||"",S=(b.numero||"").toString(),C=b.complemento||"",A=b.bairro||"",P=b.municipio||b.localidade||"",F=b.uf||"",O=Qf(b.cep);let I="";try{if(P&&F){const k=await fetch(`https://brasilapi.com.br/api/ibge/municipios/v1/${F}`);if(k.ok){const B=await k.json(),z=x(P),U=(B||[]).find(L=>x(L.nome)===z);(U?.codigo_ibge||U?.codigo)&&(I=String(U.codigo_ibge||U.codigo))}}}catch{}const T=`${j}${S?", "+S:""}${A?" - "+A:""}${P||F?" - "+P+"/"+F:""}`;l(k=>({...k,razao_social:w,nome_fantasia:_||w,logradouro:j,numero:S,complemento:C,bairro:A,cidade:P,uf:F,cep:O,endereco:T||k.endereco,codigo_municipio_ibge:I||""}));try{console.info("[empresas] BuscarCNPJ:setForm",{razao:w,fantasia:_,logradouro:j,numero:S,complemento:C,bairro:A,cidade:P,uf:F,cep:O,codigoIBGE:I,enderecoFull:T})}catch{}e({title:"CNPJ carregado",description:"Dados preenchidos automaticamente."})}catch(v){e({title:"Falha ao buscar CNPJ",description:v.message||"Tente novamente.",variant:"destructive"})}finally{o(!1)}}return a.jsx(a.Fragment,{children:a.jsxs(Er.div,{variants:Got,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsx(CV,{children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Cadastros  Empresa"})})}),a.jsxs(CV,{children:[a.jsx("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Dados da Empresa"}),a.jsxs("form",{onSubmit:h,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsx(fi,{label:"Razo Social",value:i.razao_social,onChange:y=>l({...i,razao_social:y.target.value}),placeholder:"Ex.: Fluxo7 Arena LTDA"}),a.jsx(fi,{label:"Nome Fantasia",value:i.nome_fantasia,onChange:y=>l({...i,nome_fantasia:y.target.value}),placeholder:"Ex.: Fluxo7 Arena"}),a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx(fi,{label:"CNPJ",type:"text",inputMode:"numeric",value:i.cnpj,onChange:y=>l({...i,cnpj:Xot(y.target.value)}),placeholder:"00.000.000/0000-00"})}),a.jsx(se,{type:"button",variant:"outline",onClick:g,disabled:s,children:"Buscar CNPJ"})]}),a.jsx(fi,{label:"Email",type:"email",value:i.email,onChange:y=>l({...i,email:y.target.value}),placeholder:"contato@empresa.com"}),a.jsx(fi,{label:"Telefone",type:"tel",inputMode:"tel",value:i.telefone,onChange:y=>l({...i,telefone:Yot(y.target.value)}),placeholder:"(11) 99999-9999"}),a.jsx(fi,{label:"Endereo",value:i.endereco,onChange:y=>l({...i,endereco:y.target.value}),placeholder:"Rua, nmero, bairro, cidade",className:"md:col-span-2 lg:col-span-2"}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(fi,{label:"Inscrio Estadual",value:i.inscricao_estadual,onChange:y=>l({...i,inscricao_estadual:y.target.value})}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Regime Tributrio (CRT)"}),a.jsxs("select",{value:i.regime_tributario,onChange:y=>l({...i,regime_tributario:y.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Selecione"}),a.jsx("option",{value:"1",children:"1 - Simples Nacional"}),a.jsx("option",{value:"2",children:"2 - Simples (excesso sublimite)"}),a.jsx("option",{value:"3",children:"3 - Regime Normal"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Ambiente"}),a.jsxs("select",{value:i.ambiente,onChange:y=>l({...i,ambiente:y.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{value:"homologacao",children:"Homologao"}),a.jsx("option",{value:"producao",children:"Produo"})]})]})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-6 gap-4",children:[a.jsx("div",{className:"md:col-span-3",children:a.jsx(fi,{label:"Logradouro",value:i.logradouro,onChange:y=>l({...i,logradouro:y.target.value})})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(fi,{label:"Nmero",value:i.numero,onChange:y=>l({...i,numero:y.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(fi,{label:"Complemento",value:i.complemento,onChange:y=>l({...i,complemento:y.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(fi,{label:"Bairro",value:i.bairro,onChange:y=>l({...i,bairro:y.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(fi,{label:"Cidade",value:i.cidade,onChange:y=>l({...i,cidade:y.target.value})})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(fi,{label:"UF",value:i.uf,onChange:y=>l({...i,uf:(y.target.value||"").toUpperCase().slice(0,2)}),placeholder:"UF"})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(fi,{label:"CEP",value:i.cep,onChange:y=>l({...i,cep:Qf(y.target.value).slice(0,8)}),placeholder:"00000000"})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(fi,{label:"Cdigo IBGE Municpio (cMun)",value:i.codigo_municipio_ibge,onChange:y=>l({...i,codigo_municipio_ibge:Qf(y.target.value).slice(0,7)})})})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(fi,{label:"NFC-e Srie",value:i.nfce_serie,onChange:y=>l({...i,nfce_serie:Qf(y.target.value).slice(0,3)})}),a.jsx(fi,{label:"NFC-e Numerao Inicial",value:i.nfce_numeracao,onChange:y=>l({...i,nfce_numeracao:Qf(y.target.value).slice(0,9)})}),a.jsx(fi,{label:"NFC-e IToken (CSC)",value:i.nfce_itoken,onChange:y=>l({...i,nfce_itoken:y.target.value})})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(fi,{label:"NF-e Srie (opcional)",value:i.nfe_serie,onChange:y=>l({...i,nfe_serie:Qf(y.target.value).slice(0,3)})}),a.jsx(fi,{label:"NF-e Numerao (opcional)",value:i.nfe_numeracao,onChange:y=>l({...i,nfe_numeracao:Qf(y.target.value).slice(0,9)})})]}),!1,a.jsx("div",{className:"md:col-span-2 lg:col-span-2 grid grid-cols-1 gap-3",children:a.jsxs("div",{className:"flex items-center gap-4",children:[d||i.logo_url?a.jsx("img",{src:d||i.logo_url,alt:"Logo da empresa",className:"w-16 h-16 rounded-md object-cover border border-border"}):a.jsx("div",{className:"w-16 h-16 rounded-md border border-dashed border-border/60 bg-surface-2/40 flex items-center justify-center text-xs text-text-muted",children:"Sem logo"}),a.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Upload da Logo"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{type:"button",variant:"outline",onClick:()=>c.current?.click(),className:"px-3",children:"Escolher imagem"}),a.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:m,className:"hidden"}),(d||i.logo_url)&&a.jsx("span",{className:"text-xs text-text-muted truncate max-w-[260px]",title:i.logo_url||d,children:"Logo selecionada"})]}),a.jsx("span",{className:"text-[11px] text-text-muted",children:"Formatos: PNG/JPG. Tamanho recomendado: 256x256."})]})]})}),a.jsx("div",{className:"flex items-end",children:a.jsx(se,{type:"submit",className:"w-full md:w-auto",disabled:s,children:s?"Salvando...":"Salvar"})})]})]})]})})}const Qot={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},Lj={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},AV=[{codigo:"01",nome:"Dinheiro"},{codigo:"02",nome:"Cheque"},{codigo:"03",nome:"Carto de Crdito"},{codigo:"04",nome:"Carto de Dbito"},{codigo:"05",nome:"Carto da Loja (Private Label)"},{codigo:"10",nome:"Vale Alimentao"},{codigo:"11",nome:"Vale Refeio"},{codigo:"12",nome:"Vale Presente"},{codigo:"13",nome:"Vale Combustvel"},{codigo:"14",nome:"Duplicata Mercantil"},{codigo:"15",nome:"Boleto Bancrio"},{codigo:"16",nome:"Depsito Bancrio"},{codigo:"17",nome:"PIX Dinmico (QR-Code)"},{codigo:"18",nome:"Transferncia Bancria / Carteira Digital"},{codigo:"19",nome:"Programa de Fidelidade / Cashback"},{codigo:"20",nome:"PIX Esttico"},{codigo:"21",nome:"Crdito em Loja"},{codigo:"22",nome:"Pagamento Eletrnico no Informado"},{codigo:"90",nome:"Sem Pagamento"},{codigo:"99",nome:"Outros"}],Lk=({icon:e,title:t,value:r,subtitle:n,color:s,onClick:o,isActive:i})=>a.jsx(Er.div,{variants:Lj,onClick:o,className:Sr("bg-surface rounded-lg border md:border-2 p-3 md:p-4 transition-all text-center h-[90px] md:h-auto",o?"cursor-pointer hover:shadow-md":"",i?`border-${s} bg-${s}/5`:"border-border",o&&!i?"hover:border-border-hover":""),children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 md:flex-row md:items-center md:gap-3 h-full",children:[a.jsx("div",{className:Sr("p-1.5 md:p-2 rounded-lg",`bg-${s}/10`),children:a.jsx(e,{className:Sr("w-4 h-4 md:w-5 md:h-5",`text-${s}`)})}),a.jsxs("div",{className:"flex-1 md:text-left",children:[a.jsx("p",{className:"text-base md:text-2xl font-bold text-text-primary leading-none",children:r}),a.jsx("p",{className:"text-[10px] md:text-xs font-semibold text-text-secondary md:mt-0.5",children:t}),a.jsx("p",{className:"hidden md:block text-xs text-text-muted",children:n})]})]})});function Zot(){const{toast:e}=Ss(),{userProfile:t,authReady:r}=qs(),[n,s]=p.useState([]),[o,i]=p.useState(!1),[l,c]=p.useState(!1),[d,u]=p.useState(""),[f,h]=p.useState("all"),[m,x]=p.useState("all"),[g,y]=p.useState(!0),[v,b]=p.useState(null),[w,_]=p.useState(!1),[j,S]=p.useState(null),[C,A]=p.useState({codigo_interno:"",codigo_sefaz:"",nome:"",taxa_percentual:"",ativo:!0}),[P,F]=p.useState(!1),[O,I]=p.useState(""),[T,k]=p.useState(!1),[B,z]=p.useState(null),[U,L]=p.useState(null),[W,ge]=p.useState(!1),[Ae,V]=p.useState("mes"),[$,Y]=p.useState(!1),[he,J]=p.useState([]),[G,ue]=p.useState("customizado"),[ve,ae]=p.useState(""),[oe,me]=p.useState(""),[De,ne]=p.useState(!1),[ie,ht]=p.useState(!1);p.useEffect(()=>{const je=()=>{try{ht(typeof window<"u"&&window.innerWidth<=640)}catch{}};return je(),window.addEventListener("resize",je),()=>window.removeEventListener("resize",je)},[]);const pt=async()=>{try{i(!0);const je=t?.codigo_empresa;if(!je)return;const nt=await Ah({somenteAtivas:!1,codigoEmpresa:je});console.log(" Finalizadoras carregadas:",nt),console.log(" Primeira finalizadora:",nt?.[0]),s(Array.isArray(nt)?nt:[])}catch(je){e({title:"Erro ao carregar",description:je?.message,variant:"destructive"})}finally{i(!1)}},Ze=p.useMemo(()=>{const je=n.length,nt=n.filter(xt=>xt.ativo).length,$t=n.length>0?n.reduce((xt,Ot)=>{const Cr=Ot.nome||"Sem nome";return xt[Cr]=(xt[Cr]||0)+1,xt},{}):{},Ut=Object.entries($t).sort((xt,Ot)=>Ot[1]-xt[1])[0],Fe=Ut?Ut[0]:"-";return{total:je,ativas:nt,maisUsada:Fe}},[n]),vt=p.useMemo(()=>{let je=[...n];if(d){const nt=d.toLowerCase();je=je.filter($t=>{const Ut=String($t.tipo||"").toLowerCase(),Fe=String($t.nome||"").toLowerCase(),xt=String($t.codigo_interno||"").toLowerCase(),Ot=nt.replace(/\D/g,""),Cr=String($t.codigo_interno||"").replace(/\D/g,"");return Ut.includes(nt)||Fe.includes(nt)||xt.includes(nt)||!!Ot&&Cr===Ot})}return f!=="all"&&(je=je.filter(nt=>nt.tipo===f)),m!=="all"&&(je=je.filter(nt=>m==="active"?nt.ativo:!nt.ativo)),v==="ativas"&&(je=je.filter(nt=>nt.ativo)),je.sort((nt,$t)=>{const Ut=parseInt(nt.codigo_interno)||0,Fe=parseInt($t.codigo_interno)||0;return Ut-Fe}),je},[n,d,f,m,v]),wt=()=>{S(null);const je=n.reduce(($t,Ut)=>{const Fe=parseInt(Ut.codigo_interno)||0;return Fe>$t?Fe:$t},0),nt=String(je+1).padStart(2,"0");A({codigo_interno:nt,codigo_sefaz:"",nome:"",taxa_percentual:"",ativo:!0}),_(!0)},gt=je=>{S(je),A({codigo_interno:je.codigo_interno||"",codigo_sefaz:je.codigo_sefaz||"",nome:je.nome||"",taxa_percentual:je.taxa_percentual!=null?String(je.taxa_percentual):"",ativo:je.ativo!==!1}),_(!0)},er=async(je,nt="mes")=>{try{ge(!0);const $t=t?.codigo_empresa;if(!$t)return;const Ut=new Date;let Fe,xt=Ut.toISOString();switch(nt){case"hoje":Fe=new Date(Ut.setHours(0,0,0,0)).toISOString();break;case"semana":Fe=new Date(Ut.setDate(Ut.getDate()-7)).toISOString();break;case"mes":Fe=new Date(Ut.setMonth(Ut.getMonth()-1)).toISOString();break;default:Fe=new Date(Ut.setMonth(Ut.getMonth()-1)).toISOString()}const{data:Ot,error:Cr}=await re.from("pagamentos").select("valor, recebido_em, status").eq("finalizadora_id",je).eq("codigo_empresa",$t).gte("recebido_em",Fe).lte("recebido_em",xt).neq("status","Cancelado").neq("status","Estornado");if(Cr)throw Cr;const Me=Ot?.length||0,Qe=Ot?.reduce((xr,Jt)=>xr+(Number(Jt.valor)||0),0)||0,et=Me>0?Qe/Me:0,Yt=Ot?.[Ot.length-1]?.recebido_em||null;L({transacoes:Me,faturamento:Qe,ticketMedio:et,ultimaUtilizacao:Yt})}catch($t){console.error("Erro ao carregar estatsticas:",$t),e({title:"Erro ao carregar estatsticas",description:$t?.message,variant:"destructive"})}finally{ge(!1)}},_e=async(je="customizado",nt=null,$t=null)=>{try{ne(!0);const Ut=t?.codigo_empresa;if(!Ut)return;let Fe,xt;if(je==="customizado"&&nt&&$t)Fe=new Date(nt).toISOString(),xt=new Date($t+"T23:59:59").toISOString();else{const et=new Date;switch(xt=et.toISOString(),je){case"hoje":Fe=new Date(et.setHours(0,0,0,0)).toISOString();break;case"semana":Fe=new Date(et.setDate(et.getDate()-7)).toISOString();break;case"mes":Fe=new Date(et.setMonth(et.getMonth()-1)).toISOString();break;default:Fe=new Date(et.setMonth(et.getMonth()-1)).toISOString()}}const{data:Ot,error:Cr}=await re.from("pagamentos").select("finalizadora_id, valor, finalizadoras!pagamentos_finalizadora_id_fkey(id, codigo_interno, nome)").eq("codigo_empresa",Ut).gte("recebido_em",Fe).lte("recebido_em",xt).neq("status","Cancelado").neq("status","Estornado");if(Cr)throw Cr;const Me={};Ot?.forEach(et=>{const Yt=et.finalizadora_id;Yt&&(Me[Yt]||(Me[Yt]={id:Yt,codigo:et.finalizadoras?.codigo_interno||"-",nome:et.finalizadoras?.nome||"Sem nome",total:0,transacoes:0}),Me[Yt].total+=Number(et.valor)||0,Me[Yt].transacoes+=1)});const Qe=Object.values(Me).sort((et,Yt)=>Yt.total-et.total);J(Qe)}catch(Ut){console.error("Erro ao carregar ranking:",Ut),e({title:"Erro ao carregar ranking",description:Ut?.message,variant:"destructive"})}finally{ne(!1)}},Pt=()=>{Y(!0),ue("customizado");const je=new Date,nt=new Date;nt.setMonth(nt.getMonth()-1),ae(nt.toISOString().split("T")[0]),me(je.toISOString().split("T")[0]),_e("customizado",nt.toISOString().split("T")[0],je.toISOString().split("T")[0])},Lt=je=>{z(je),k(!0),V("mes"),er(je.id,"mes")},gr=async()=>{try{if(!C.nome?.trim()){e({title:"Nome  obrigatrio",variant:"warning"});return}if(!C.codigo_sefaz){e({title:"Cdigo SEFAZ  obrigatrio",variant:"warning"});return}if(C.codigo_interno?.trim()&&n.some(Ut=>Ut.codigo_interno===C.codigo_interno.trim()&&(!j||Ut.id!==j.id))){e({title:"Cdigo j existe",description:"Este cdigo interno j est em uso por outra finalizadora",variant:"warning"});return}c(!0);const je=t?.codigo_empresa,nt={codigo_interno:C.codigo_interno?.trim()||null,codigo_sefaz:C.codigo_sefaz,nome:C.nome.trim(),tipo:"outros",taxa_percentual:C.taxa_percentual===""?null:Number(C.taxa_percentual),ativo:C.ativo};j?(await nKe(j.id,nt,je),e({title:"Finalizadora atualizada!",variant:"success"})):(await rKe(nt,je),e({title:"Finalizadora criada!",variant:"success"})),_(!1),await pt()}catch(je){e({title:"Erro ao salvar",description:je?.message,variant:"destructive"})}finally{c(!1)}},fr=async je=>{try{await aKe(je.id,!je.ativo,t?.codigo_empresa),e({title:je.ativo?"Desativada":"Ativada",variant:"success"}),await pt()}catch(nt){e({title:"Erro ao alterar status",description:nt?.message,variant:"destructive"})}};return p.useEffect(()=>{r&&t?.codigo_empresa&&pt()},[r,t?.codigo_empresa]),a.jsxs(a.Fragment,{children:[a.jsxs(Er.div,{variants:Qot,initial:"hidden",animate:"visible",className:"flex-1 space-y-6 p-4 md:p-6",children:[a.jsxs(Er.div,{variants:Lj,className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"min-w-0",children:a.jsx("h1",{className:"text-2xl md:text-3xl font-black text-text-primary tracking-tight leading-tight",children:"Finalizadoras"})}),a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx(se,{variant:"ghost",size:"icon",onClick:()=>y(!g),className:"h-9 w-9",children:g?a.jsx(jg,{className:"h-5 w-5"}):a.jsx(zg,{className:"h-5 w-5"})}),a.jsxs(se,{onClick:wt,className:"gap-2 h-9 px-3 whitespace-nowrap",children:[a.jsx(Es,{className:"h-4 w-4"}),a.jsx("span",{className:"md:hidden",children:"Nova"}),a.jsx("span",{className:"hidden md:inline",children:"Nova Finalizadora"})]})]})]}),g&&a.jsxs("div",{className:"grid grid-cols-3 gap-3 md:grid-cols-3 md:gap-6",children:[a.jsx(Lk,{icon:Nh,title:"Total",value:Ze.total,subtitle:"Finalizadoras cadastradas",color:"brand"}),a.jsx(Lk,{icon:Oi,title:"Ativas",value:Ze.ativas,subtitle:"Disponveis para uso",color:"success",onClick:()=>b(v==="ativas"?null:"ativas"),isActive:v==="ativas"}),a.jsx(Lk,{icon:Cm,title:"Mais Usada",value:Ze.maisUsada,subtitle:"Mtodo mais popular",color:"warning",onClick:Pt})]}),a.jsx(Er.div,{variants:Lj,className:"bg-surface rounded-lg border border-border p-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative min-w-0 basis-0 flex-grow",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar finalizadora...",value:d,onChange:je=>u(je.target.value),className:"pl-10 h-11"})]}),a.jsxs(Gn,{value:m,onValueChange:x,children:[a.jsx(Vn,{className:"w-[110px] md:w-[180px]",children:a.jsx(Kn,{placeholder:"Filtrar por status"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todos"}),a.jsx(lt,{value:"active",children:"Ativas"}),a.jsx(lt,{value:"inactive",children:"Inativas"})]})]})]})}),a.jsx(Er.div,{variants:Lj,className:"bg-surface rounded-lg border border-border overflow-hidden",children:o?a.jsxs("div",{className:"p-12 text-center",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):vt.length===0?a.jsxs("div",{className:"p-12 text-center text-text-muted",children:[a.jsx(Nh,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"Nenhuma finalizadora encontrada"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden divide-y divide-border",children:vt.map(je=>a.jsxs("div",{className:"p-3 flex flex-col gap-2 hover:bg-surface-2/50 cursor-pointer",onClick:()=>Lt(je),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"px-2 py-0.5 rounded-md bg-surface-2 border border-border font-mono text-xs text-text-secondary",children:je.codigo_interno||"-"}),a.jsx("span",{className:"font-semibold text-sm text-text-primary truncate",title:je.nome,children:je.nome})]}),a.jsxs("span",{className:Sr("inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[11px] font-medium",je.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Sr("w-1.5 h-1.5 rounded-full",je.ativo?"bg-success":"bg-muted")}),je.ativo?"Ativa":"Inativa"]})]}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsxs("span",{children:["Taxa: ",je.taxa_percentual?`${je.taxa_percentual}%`:"-"]})}),a.jsxs("div",{className:"flex items-center gap-2",onClick:nt=>nt.stopPropagation(),children:[a.jsx(se,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>gt(je),children:a.jsx(ec,{className:"h-4 w-4"})}),a.jsx(se,{variant:je.ativo?"ghost":"default",size:"sm",className:"h-7 px-2",onClick:()=>fr(je),children:je.ativo?"Desativar":"Ativar"})]})]})]},je.id))}),a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-surface-2 border-b border-border",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Cdigo"}),a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Descrio"}),a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Taxa (%)"}),a.jsx("th",{className:"text-center px-6 py-4 text-sm font-semibold text-text-secondary",children:"Status"}),a.jsx("th",{className:"text-right px-6 py-4 text-sm font-semibold text-text-secondary",children:"Aes"})]})}),a.jsx("tbody",{className:"divide-y divide-border",children:vt.map(je=>a.jsxs("tr",{className:"hover:bg-surface-2/50 transition-colors cursor-pointer",onClick:()=>Lt(je),children:[a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"font-mono text-sm text-text-primary",children:je.codigo_interno||"-"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"font-semibold text-text-primary",children:je.nome})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-text-secondary",children:je.taxa_percentual?`${je.taxa_percentual}%`:"-"})}),a.jsx("td",{className:"px-6 py-4 text-center",children:a.jsxs("span",{className:Sr("inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium",je.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Sr("w-2 h-2 rounded-full",je.ativo?"bg-success":"bg-muted")}),je.ativo?"Ativa":"Inativa"]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex justify-end gap-2",onClick:nt=>nt.stopPropagation(),children:[a.jsx(se,{variant:"ghost",size:"sm",onClick:()=>gt(je),children:a.jsx(ec,{className:"h-4 w-4"})}),a.jsx(se,{variant:je.ativo?"ghost":"default",size:"sm",onClick:()=>fr(je),children:je.ativo?"Desativar":"Ativar"})]})})]},je.id))})]})})]})})]}),a.jsx(In,{open:w,onOpenChange:_,children:a.jsxs(En,{className:"sm:max-w-[500px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:j?"Editar Finalizadora":"Nova Finalizadora"}),a.jsx(Hn,{children:j?"Atualize as informaes da finalizadora":"Adicione um novo mtodo de pagamento"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{htmlFor:"codigo_interno",children:"Cdigo Finalizadora"}),a.jsx(Ct,{id:"codigo_interno",type:"text",placeholder:"Ex: 01, 02, 03...",value:C.codigo_interno,onChange:je=>A({...C,codigo_interno:je.target.value})}),a.jsx("p",{className:"text-xs text-text-muted",children:"Gerado automaticamente, mas pode ser editado"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{htmlFor:"nome",children:"Descrio *"}),a.jsx(Ct,{id:"nome",placeholder:"Ex: PIX, Dinheiro, Carto de Crdito...",value:C.nome,onChange:je=>A({...C,nome:je.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{htmlFor:"codigo_sefaz",children:"Forma de Pagamento NF-e/NFC-e *"}),a.jsx(se,{type:"button",variant:"outline",className:"justify-between w-full",onClick:()=>F(!0),children:C.codigo_sefaz?`${C.codigo_sefaz} - ${AV.find(je=>je.codigo===C.codigo_sefaz)?.nome||""}`:"Selecione a forma de pagamento"}),a.jsx("p",{className:"text-xs text-text-muted",children:"A lista abrir em um modal com rolagem."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(it,{htmlFor:"taxa",children:"Taxa"}),a.jsxs("div",{className:"relative",children:[a.jsx(Ct,{id:"taxa",inputMode:"decimal",placeholder:"0,00",className:"pr-10",value:C.taxa_percentual,onChange:je=>{const nt=String(je.target.value).replace(/[^0-9.,]/g,"").replace(/,/g,".");if(nt===""){A({...C,taxa_percentual:""});return}const $t=Number(nt);if(Number.isFinite($t)){const Ut=Math.max(0,Math.min(100,$t));A({...C,taxa_percentual:String(Ut)})}},onBlur:()=>{const je=String(C.taxa_percentual||"").replace(/,/g,".");if(je==="")return;const nt=Number(je);if(Number.isFinite(nt)){const $t=Math.max(0,Math.min(100,nt));A(Ut=>({...Ut,taxa_percentual:$t.toFixed(2)}))}}}),a.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-text-muted text-sm",children:"%"})]}),a.jsx("p",{className:"text-xs text-text-muted",children:"Deixe vazio se no houver taxa"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"ativo",checked:C.ativo,onChange:je=>A({...C,ativo:je.target.checked}),className:"h-4 w-4 rounded border-border"}),a.jsx(it,{htmlFor:"ativo",className:"text-sm font-normal cursor-pointer",children:"Finalizadora ativa"})]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>_(!1),disabled:l,children:"Cancelar"}),a.jsx(se,{onClick:gr,disabled:l,children:l?"Salvando...":"Salvar"})]})]})}),a.jsx(In,{open:P,onOpenChange:F,children:a.jsxs(En,{className:"sm:max-w-[520px] w-[92vw]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Selecionar Forma de Pagamento (SEFAZ)"}),a.jsx(Hn,{children:"Busque por cdigo ou nome"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(Ct,{placeholder:"Ex.: 03, crdito, pix...",value:O,onChange:je=>I(je.target.value)}),a.jsx("div",{className:"max-h-[420px] overflow-auto fx-scroll rounded-md border border-border",children:a.jsx("ul",{className:"divide-y divide-border",children:AV.filter(je=>{const nt=(O||"").toLowerCase();return nt?je.codigo.includes(nt)||String(je.nome).toLowerCase().includes(nt):!0}).map(je=>a.jsx("li",{children:a.jsxs("button",{type:"button",className:`w-full text-left px-3 py-2 hover:bg-surface-2 ${C.codigo_sefaz===je.codigo?"bg-surface-2":""}`,onClick:()=>{A(nt=>({...nt,codigo_sefaz:je.codigo})),F(!1)},children:[a.jsx("span",{className:"font-mono mr-2 text-text-secondary",children:je.codigo}),a.jsx("span",{children:je.nome})]})},je.codigo))})})]})]})}),a.jsx(In,{open:T,onOpenChange:k,children:a.jsxs(En,{className:"sm:max-w-[700px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Detalhes da Finalizadora"}),a.jsx(Hn,{children:"Estatsticas e informaes completas"})]}),B&&a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Informaes"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Cdigo Finalizadora"}),a.jsx("p",{className:"font-mono text-sm text-text-primary",children:B.codigo_interno||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Forma de Pagamento NF-e/NFC-e"}),a.jsx("p",{className:"font-mono text-sm text-text-primary",children:B.codigo_sefaz||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Descrio"}),a.jsx("p",{className:"font-medium text-text-primary",children:B.nome})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Taxa"}),a.jsx("p",{className:"font-medium text-text-primary",children:B.taxa_percentual?`${B.taxa_percentual}%`:"Sem taxa"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Status"}),a.jsxs("span",{className:Sr("inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium",B.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Sr("w-2 h-2 rounded-full",B.ativo?"bg-success":"bg-muted")}),B.ativo?"Ativa":"Inativa"]})]})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Perodo de Anlise"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{variant:Ae==="hoje"?"default":"outline",size:"sm",onClick:()=>{V("hoje"),er(B.id,"hoje")},children:"Hoje"}),a.jsx(se,{variant:Ae==="semana"?"default":"outline",size:"sm",onClick:()=>{V("semana"),er(B.id,"semana")},children:"7 Dias"}),a.jsx(se,{variant:Ae==="mes"?"default":"outline",size:"sm",onClick:()=>{V("mes"),er(B.id,"mes")},children:"30 Dias"})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Estatsticas de Uso"}),W?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-brand border-t-transparent"})}):U?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Total de Transaes"}),a.jsx("span",{className:"font-semibold text-text-primary",children:U.transacoes})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Faturamento Total"}),a.jsxs("span",{className:"font-semibold text-success",children:["R$ ",U.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Ticket Mdio"}),a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",U.ticketMedio.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"ltima Utilizao"}),a.jsx("span",{className:"font-medium text-text-muted",children:U.ultimaUtilizacao?new Date(U.ultimaUtilizacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Nunca utilizada"})]})]}):a.jsx("div",{className:"text-center py-8 text-text-muted",children:a.jsx("p",{className:"text-sm",children:"Nenhum dado disponvel"})})]})]}),a.jsxs(Na,{children:[a.jsx(se,{variant:"outline",onClick:()=>k(!1),children:"Fechar"}),a.jsxs(se,{onClick:()=>{k(!1),gt(B)},children:[a.jsx(ec,{className:"h-4 w-4 mr-2"}),"Editar"]})]})]})}),a.jsx(In,{open:$,onOpenChange:Y,children:a.jsxs(En,{className:"sm:max-w-[700px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Ranking de Finalizadoras"}),a.jsx(Hn,{children:"Faturamento por forma de pagamento"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx(se,{variant:G==="hoje"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{ue("hoje"),_e("hoje")},children:"Hoje"}),a.jsx(se,{variant:G==="semana"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{ue("semana"),_e("semana")},children:"7 Dias"}),a.jsx(se,{variant:G==="mes"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{ue("mes"),_e("mes")},children:"30 Dias"}),a.jsx(se,{variant:G==="customizado"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>ue("customizado"),children:"Perodo"})]}),G==="customizado"&&(ie?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx(it,{className:"text-xs",children:"Data Inicial"}),a.jsx("input",{type:"date",className:"mt-1 h-9 w-full rounded-md border border-border bg-surface px-2 text-sm text-text-primary",value:ve,onChange:je=>ae(je.target.value)})]}),a.jsxs("div",{children:[a.jsx(it,{className:"text-xs",children:"Data Final"}),a.jsx("input",{type:"date",className:"mt-1 h-9 w-full rounded-md border border-border bg-surface px-2 text-sm text-text-primary",value:oe,onChange:je=>me(je.target.value)})]})]}),a.jsx(se,{className:"w-full",onClick:()=>_e("customizado",ve,oe),disabled:!ve||!oe||De,children:De?"Buscando...":"Buscar"})]}):a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(it,{children:"Data Inicial"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:Sr("w-full justify-start text-left font-normal",!ve&&"text-text-muted"),children:[a.jsx(lo,{className:"mr-2 h-4 w-4"}),ve?new Date(ve+"T12:00:00").toLocaleDateString("pt-BR"):"Selecione"]})}),a.jsx(Go,{className:"w-auto p-0 bg-surface border border-border",align:"start",children:a.jsx(e3,{mode:"single",selected:ve?new Date(ve+"T12:00:00"):void 0,onSelect:je=>{if(je){const nt=je.getFullYear(),$t=String(je.getMonth()+1).padStart(2,"0"),Ut=String(je.getDate()).padStart(2,"0");ae(`${nt}-${$t}-${Ut}`)}},className:"p-3"})})]})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx(it,{children:"Data Final"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{variant:"outline",className:Sr("w-full justify-start text-left font-normal",!oe&&"text-text-muted"),children:[a.jsx(lo,{className:"mr-2 h-4 w-4"}),oe?new Date(oe+"T12:00:00").toLocaleDateString("pt-BR"):"Selecione"]})}),a.jsx(Go,{className:"w-auto p-0 bg-surface border border-border",align:"start",children:a.jsx(e3,{mode:"single",selected:oe?new Date(oe+"T12:00:00"):void 0,onSelect:je=>{if(je){const nt=je.getFullYear(),$t=String(je.getMonth()+1).padStart(2,"0"),Ut=String(je.getDate()).padStart(2,"0");me(`${nt}-${$t}-${Ut}`)}},className:"p-3"})})]})]}),a.jsx(se,{onClick:()=>_e("customizado",ve,oe),disabled:!ve||!oe||De,children:"Buscar"})]}))]}),De?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-brand border-t-transparent"})}):he.length===0?a.jsx("div",{className:"text-center py-12 text-text-muted",children:a.jsx("p",{children:"Nenhuma transao no perodo selecionado"})}):a.jsx("div",{className:"space-y-3",children:he.map((je,nt)=>a.jsx("div",{className:"bg-surface-2 rounded-lg p-3 md:p-4 border border-border",children:a.jsxs("div",{className:"flex items-start md:items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-start md:items-center gap-2 md:gap-3 flex-1 min-w-0",children:[a.jsxs("div",{className:Sr("flex items-center justify-center w-7 h-7 md:w-8 md:h-8 rounded-full font-bold text-xs md:text-sm flex-shrink-0",nt===0?"bg-warning/20 text-warning":nt===1?"bg-info/20 text-info":nt===2?"bg-success/20 text-success":"bg-muted/20 text-muted"),children:[nt+1,""]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[a.jsx("span",{className:"font-mono text-[10px] md:text-xs text-text-muted",children:je.codigo}),a.jsx("span",{className:"font-semibold text-sm md:text-base text-text-primary truncate",children:je.nome})]}),a.jsxs("p",{className:"text-[10px] md:text-xs text-text-muted",children:[je.transacoes," transaes"]})]})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsxs("p",{className:"text-base md:text-lg font-bold text-success whitespace-nowrap",children:["R$ ",je.total.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),a.jsxs("p",{className:"text-[10px] md:text-xs text-text-muted whitespace-nowrap",children:["Mdia: R$ ",(je.total/je.transacoes).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})},je.id))})]}),a.jsx(Na,{children:a.jsx(se,{variant:"outline",onClick:()=>Y(!1),children:"Fechar"})})]})})]})}function eit(){return a.jsxs("div",{className:"p-8",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Pgina de Teste"}),a.jsx("p",{children:"Esta  uma pgina de teste para verificar se o roteamento est funcionando corretamente."})]})}function tit(){const[e,t]=p.useState(!1),[r,n]=p.useState(""),[s,o]=p.useState("Manuteno em andamento. Volte em breve!"),[i,l]=p.useState(!1),[c,d]=p.useState("");p.useEffect(()=>{try{const h=localStorage.getItem("maintenance:active")==="false",m=localStorage.getItem("maintenance:end")||"",x=localStorage.getItem("maintenance:message")||"Manuteno em andamento. Volte em breve!";t(h),n(m),o(x)}catch{}},[]);const u=h=>{if(h?.preventDefault(),e&&!r){alert("Defina uma data de trmino para a manuteno");return}localStorage.setItem("maintenance:active",e),localStorage.setItem("maintenance:end",r),localStorage.setItem("maintenance:message",s),window.dispatchEvent(new Event("storage")),l(!1),d(" Configuraes salvas!"),setTimeout(()=>d(""),3e3)},f=()=>{const h=!e;if(t(h),localStorage.setItem("maintenance:active",String(h)),h&&!r){const m=new Date;m.setDate(m.getDate()+1);const x=m.toISOString().slice(0,16);n(x),localStorage.setItem("maintenance:end",x)}window.dispatchEvent(new Event("storage")),d(h?" Modo manuteno ATIVADO":" Modo manuteno DESATIVADO"),setTimeout(()=>d(""),3e3)};return a.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg mt-10",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Controle de Manuteno"}),a.jsx("button",{onClick:f,className:`inline-flex items-center px-4 py-2 rounded-md font-medium ${e?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:e?"Manuteno ATIVA":"Manuteno INATIVA"})]}),e&&a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"font-medium text-lg",children:"Configuraes"}),a.jsxs("button",{onClick:()=>l(!i),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-sm",children:[a.jsx(ec,{className:"w-4 h-4"}),i?"Ocultar":"Editar"]})]}),i?a.jsxs("form",{onSubmit:u,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Trmino"}),a.jsx("div",{className:"relative",children:a.jsx("input",{type:"datetime-local",value:r,onChange:h=>n(h.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",min:new Date().toISOString().slice(0,16),required:!0})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensagem de Manuteno"}),a.jsx("textarea",{value:s,onChange:h=>o(h.target.value),rows:3,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Ex: Estamos em manuteno programada. Volte em breve!",required:!0})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[a.jsx(Zue,{className:"inline w-4 h-4 mr-1"}),"Salvar"]})]})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Trmino:"}),a.jsx("p",{className:"text-gray-900",children:r?new Date(r).toLocaleString():"No definido"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Mensagem:"}),a.jsx("p",{className:"text-gray-900 whitespace-pre-line",children:s})]})]})]}),a.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600",children:[a.jsx("h3",{className:"font-medium mb-2",children:"Como usar:"}),a.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[a.jsx("li",{children:"Ative/desative o boto no topo"}),a.jsx("li",{children:"Defina a data de trmino e uma mensagem amigvel"}),a.jsx("li",{children:"Salve as configuraes"}),a.jsx("li",{children:"Para acessar durante a manuteno, use a senha no link"})]})]}),c&&a.jsx("div",{className:"fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg",children:c})]})}function rit(e){const t=new URLSearchParams(e.startsWith("#")?e.slice(1):e),r=t.get("access_token"),n=t.get("refresh_token");return{access_token:r,refresh_token:n}}const nit=()=>{const{toast:e}=Ss(),t=hl(),[r,n]=p.useState(""),[s,o]=p.useState(""),[i,l]=p.useState(!1),[c,d]=p.useState(!1),u=p.useMemo(()=>rit(window.location.hash),[]);p.useEffect(()=>{(async()=>{const{data:{session:m}}=await re.auth.getSession();if(m){d(!0);return}if(u.access_token&&u.refresh_token){const{data:x,error:g}=await re.auth.setSession({access_token:u.access_token,refresh_token:u.refresh_token});g&&e({title:"Link invlido ou expirado",description:"Abra o link do email novamente.",variant:"destructive"}),d(!!x?.session)}else e({title:"Link invlido",description:"Abra o link de redefinio enviado por email.",variant:"destructive"})})()},[]);const f=async h=>{if(h.preventDefault(),r.length<6){e({title:"Senha muito curta",description:"A senha deve ter pelo menos 6 caracteres.",variant:"destructive"});return}if(r!==s){e({title:"Senhas no conferem",description:"As senhas digitadas so diferentes.",variant:"destructive"});return}l(!0);const{data:m,error:x}=await re.auth.updateUser({password:r});if(l(!1),x){e({title:"Erro ao redefinir senha",description:x.message||"Tente novamente.",variant:"destructive"});return}e({title:"Senha redefinida",description:"Voc j pode acessar o sistema.",variant:"default"}),t("/")};return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:a.jsxs("div",{className:"w-full max-w-md bg-surface rounded-xl border border-border p-6 shadow",children:[a.jsx("h1",{className:"text-2xl font-semibold mb-2 text-text-primary",children:"Redefinir senha"}),a.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"Defina uma nova senha para sua conta."}),a.jsxs("form",{onSubmit:f,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1 text-text-secondary",children:"Nova senha"}),a.jsx(Ct,{type:"password",value:r,onChange:h=>n(h.target.value),placeholder:"",disabled:!c||i})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1 text-text-secondary",children:"Confirmar nova senha"}),a.jsx(Ct,{type:"password",value:s,onChange:h=>o(h.target.value),placeholder:"",disabled:!c||i})]}),a.jsx(se,{type:"submit",className:"w-full",disabled:!c||i,children:i?"Salvando...":"Salvar nova senha"})]})]})})};function ait(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Eoe=p,sit=ait(Eoe);function PV(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oit(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var iit=!!(typeof window<"u"&&window.document&&window.document.createElement);function lit(e,t,r){if(typeof e!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof t!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof r<"u"&&typeof r!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function n(s){return s.displayName||s.name||"Component"}return function(o){if(typeof o!="function")throw new Error("Expected WrappedComponent to be a React component.");var i=[],l;function c(){l=e(i.map(function(u){return u.props})),d.canUseDOM?t(l):r&&(l=r(l))}var d=function(u){oit(f,u);function f(){return u.apply(this,arguments)||this}f.peek=function(){return l},f.rewind=function(){if(f.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var x=l;return l=void 0,i=[],x};var h=f.prototype;return h.UNSAFE_componentWillMount=function(){i.push(this),c()},h.componentDidUpdate=function(){c()},h.componentWillUnmount=function(){var x=i.indexOf(this);i.splice(x,1),c()},h.render=function(){return sit.createElement(o,this.props)},f}(Eoe.PureComponent);return PV(d,"displayName","SideEffect("+n(o)+")"),PV(d,"canUseDOM",iit),d}}var cit=lit;const dit=xs(cit);var uit=typeof Element<"u",fit=typeof Map=="function",mit=typeof Set=="function",hit=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function $j(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,s;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!$j(e[n],t[n]))return!1;return!0}var o;if(fit&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(o=e.entries();!(n=o.next()).done;)if(!t.has(n.value[0]))return!1;for(o=e.entries();!(n=o.next()).done;)if(!$j(n.value[1],t.get(n.value[0])))return!1;return!0}if(mit&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(o=e.entries();!(n=o.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(hit&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[n]))return!1;if(uit&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((s[n]==="_owner"||s[n]==="__v"||s[n]==="__o")&&e.$$typeof)&&!$j(e[s[n]],t[s[n]]))return!1;return!0}return e!==e&&t!==t}var pit=function(t,r){try{return $j(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}};const git=xs(pit);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var EV=Object.getOwnPropertySymbols,xit=Object.prototype.hasOwnProperty,vit=Object.prototype.propertyIsEnumerable;function yit(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function bit(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(o){return t[o]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(o){s[o]=o}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var wit=bit()?Object.assign:function(e,t){for(var r,n=yit(e),s,o=1;o<arguments.length;o++){r=Object(arguments[o]);for(var i in r)xit.call(r,i)&&(n[i]=r[i]);if(EV){s=EV(r);for(var l=0;l<s.length;l++)vit.call(r,s[l])&&(n[s[l]]=r[s[l]])}}return n};const _it=xs(wit);var Mg={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},Xa={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(Xa).map(function(e){return Xa[e]});var Co={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},hC={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},$1={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},jit=Object.keys(hC).reduce(function(e,t){return e[hC[t]]=t,e},{}),Nit=[Xa.NOSCRIPT,Xa.SCRIPT,Xa.STYLE],Du="data-react-helmet",Sit=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cit=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ait=function(){function e(t,r){for(var n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),yc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pit=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},kV=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},Eit=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e},z3=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},kit=function(t){var r=Wv(t,Xa.TITLE),n=Wv(t,$1.TITLE_TEMPLATE);if(n&&r)return n.replace(/%s/g,function(){return Array.isArray(r)?r.join(""):r});var s=Wv(t,$1.DEFAULT_TITLE);return r||s||void 0},Iit=function(t){return Wv(t,$1.ON_CHANGE_CLIENT_STATE)||function(){}},$k=function(t,r){return r.filter(function(n){return typeof n[t]<"u"}).map(function(n){return n[t]}).reduce(function(n,s){return yc({},n,s)},{})},Oit=function(t,r){return r.filter(function(n){return typeof n[Xa.BASE]<"u"}).map(function(n){return n[Xa.BASE]}).reverse().reduce(function(n,s){if(!n.length)for(var o=Object.keys(s),i=0;i<o.length;i++){var l=o[i],c=l.toLowerCase();if(t.indexOf(c)!==-1&&s[c])return n.concat(s)}return n},[])},ib=function(t,r,n){var s={};return n.filter(function(o){return Array.isArray(o[t])?!0:(typeof o[t]<"u"&&Rit("Helmet: "+t+' should be of type "Array". Instead found type "'+Sit(o[t])+'"'),!1)}).map(function(o){return o[t]}).reverse().reduce(function(o,i){var l={};i.filter(function(h){for(var m=void 0,x=Object.keys(h),g=0;g<x.length;g++){var y=x[g],v=y.toLowerCase();r.indexOf(v)!==-1&&!(m===Co.REL&&h[m].toLowerCase()==="canonical")&&!(v===Co.REL&&h[v].toLowerCase()==="stylesheet")&&(m=v),r.indexOf(y)!==-1&&(y===Co.INNER_HTML||y===Co.CSS_TEXT||y===Co.ITEM_PROP)&&(m=y)}if(!m||!h[m])return!1;var b=h[m].toLowerCase();return s[m]||(s[m]={}),l[m]||(l[m]={}),s[m][b]?!1:(l[m][b]=!0,!0)}).reverse().forEach(function(h){return o.push(h)});for(var c=Object.keys(l),d=0;d<c.length;d++){var u=c[d],f=_it({},s[u],l[u]);s[u]=f}return o},[]).reverse()},Wv=function(t,r){for(var n=t.length-1;n>=0;n--){var s=t[n];if(s.hasOwnProperty(r))return s[r]}return null},Tit=function(t){return{baseTag:Oit([Co.HREF,Co.TARGET],t),bodyAttributes:$k(Mg.BODY,t),defer:Wv(t,$1.DEFER),encode:Wv(t,$1.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:$k(Mg.HTML,t),linkTags:ib(Xa.LINK,[Co.REL,Co.HREF],t),metaTags:ib(Xa.META,[Co.NAME,Co.CHARSET,Co.HTTPEQUIV,Co.PROPERTY,Co.ITEM_PROP],t),noscriptTags:ib(Xa.NOSCRIPT,[Co.INNER_HTML],t),onChangeClientState:Iit(t),scriptTags:ib(Xa.SCRIPT,[Co.SRC,Co.INNER_HTML],t),styleTags:ib(Xa.STYLE,[Co.CSS_TEXT],t),title:kit(t),titleAttributes:$k(Mg.TITLE,t)}},U3=function(){var e=Date.now();return function(t){var r=Date.now();r-e>16?(e=r,t(r)):setTimeout(function(){U3(t)},0)}}(),IV=function(t){return clearTimeout(t)},Dit=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||U3:global.requestAnimationFrame||U3,Mit=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||IV:global.cancelAnimationFrame||IV,Rit=function(t){return console&&typeof console.warn=="function"&&console.warn(t)},lb=null,Fit=function(t){lb&&Mit(lb),t.defer?lb=Dit(function(){OV(t,function(){lb=null})}):(OV(t),lb=null)},OV=function(t,r){var n=t.baseTag,s=t.bodyAttributes,o=t.htmlAttributes,i=t.linkTags,l=t.metaTags,c=t.noscriptTags,d=t.onChangeClientState,u=t.scriptTags,f=t.styleTags,h=t.title,m=t.titleAttributes;V3(Xa.BODY,s),V3(Xa.HTML,o),Lit(h,m);var x={baseTag:Kx(Xa.BASE,n),linkTags:Kx(Xa.LINK,i),metaTags:Kx(Xa.META,l),noscriptTags:Kx(Xa.NOSCRIPT,c),scriptTags:Kx(Xa.SCRIPT,u),styleTags:Kx(Xa.STYLE,f)},g={},y={};Object.keys(x).forEach(function(v){var b=x[v],w=b.newTags,_=b.oldTags;w.length&&(g[v]=w),_.length&&(y[v]=x[v].oldTags)}),r&&r(),d(t,g,y)},koe=function(t){return Array.isArray(t)?t.join(""):t},Lit=function(t,r){typeof t<"u"&&document.title!==t&&(document.title=koe(t)),V3(Xa.TITLE,r)},V3=function(t,r){var n=document.getElementsByTagName(t)[0];if(n){for(var s=n.getAttribute(Du),o=s?s.split(","):[],i=[].concat(o),l=Object.keys(r),c=0;c<l.length;c++){var d=l[c],u=r[d]||"";n.getAttribute(d)!==u&&n.setAttribute(d,u),o.indexOf(d)===-1&&o.push(d);var f=i.indexOf(d);f!==-1&&i.splice(f,1)}for(var h=i.length-1;h>=0;h--)n.removeAttribute(i[h]);o.length===i.length?n.removeAttribute(Du):n.getAttribute(Du)!==l.join(",")&&n.setAttribute(Du,l.join(","))}},Kx=function(t,r){var n=document.head||document.querySelector(Xa.HEAD),s=n.querySelectorAll(t+"["+Du+"]"),o=Array.prototype.slice.call(s),i=[],l=void 0;return r&&r.length&&r.forEach(function(c){var d=document.createElement(t);for(var u in c)if(c.hasOwnProperty(u))if(u===Co.INNER_HTML)d.innerHTML=c.innerHTML;else if(u===Co.CSS_TEXT)d.styleSheet?d.styleSheet.cssText=c.cssText:d.appendChild(document.createTextNode(c.cssText));else{var f=typeof c[u]>"u"?"":c[u];d.setAttribute(u,f)}d.setAttribute(Du,"true"),o.some(function(h,m){return l=m,d.isEqualNode(h)})?o.splice(l,1):i.push(d)}),o.forEach(function(c){return c.parentNode.removeChild(c)}),i.forEach(function(c){return n.appendChild(c)}),{oldTags:o,newTags:i}},Ioe=function(t){return Object.keys(t).reduce(function(r,n){var s=typeof t[n]<"u"?n+'="'+t[n]+'"':""+n;return r?r+" "+s:s},"")},$it=function(t,r,n,s){var o=Ioe(n),i=koe(r);return o?"<"+t+" "+Du+'="true" '+o+">"+z3(i,s)+"</"+t+">":"<"+t+" "+Du+'="true">'+z3(i,s)+"</"+t+">"},Bit=function(t,r,n){return r.reduce(function(s,o){var i=Object.keys(o).filter(function(d){return!(d===Co.INNER_HTML||d===Co.CSS_TEXT)}).reduce(function(d,u){var f=typeof o[u]>"u"?u:u+'="'+z3(o[u],n)+'"';return d?d+" "+f:f},""),l=o.innerHTML||o.cssText||"",c=Nit.indexOf(t)===-1;return s+"<"+t+" "+Du+'="true" '+i+(c?"/>":">"+l+"</"+t+">")},"")},Ooe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(n,s){return n[hC[s]||s]=t[s],n},r)},qit=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(n,s){return n[jit[s]||s]=t[s],n},r)},zit=function(t,r,n){var s,o=(s={key:r},s[Du]=!0,s),i=Ooe(n,o);return[Ee.createElement(Xa.TITLE,i,r)]},Uit=function(t,r){return r.map(function(n,s){var o,i=(o={key:s},o[Du]=!0,o);return Object.keys(n).forEach(function(l){var c=hC[l]||l;if(c===Co.INNER_HTML||c===Co.CSS_TEXT){var d=n.innerHTML||n.cssText;i.dangerouslySetInnerHTML={__html:d}}else i[c]=n[l]}),Ee.createElement(t,i)})},Zf=function(t,r,n){switch(t){case Xa.TITLE:return{toComponent:function(){return zit(t,r.title,r.titleAttributes)},toString:function(){return $it(t,r.title,r.titleAttributes,n)}};case Mg.BODY:case Mg.HTML:return{toComponent:function(){return Ooe(r)},toString:function(){return Ioe(r)}};default:return{toComponent:function(){return Uit(t,r)},toString:function(){return Bit(t,r,n)}}}},Toe=function(t){var r=t.baseTag,n=t.bodyAttributes,s=t.encode,o=t.htmlAttributes,i=t.linkTags,l=t.metaTags,c=t.noscriptTags,d=t.scriptTags,u=t.styleTags,f=t.title,h=f===void 0?"":f,m=t.titleAttributes;return{base:Zf(Xa.BASE,r,s),bodyAttributes:Zf(Mg.BODY,n,s),htmlAttributes:Zf(Mg.HTML,o,s),link:Zf(Xa.LINK,i,s),meta:Zf(Xa.META,l,s),noscript:Zf(Xa.NOSCRIPT,c,s),script:Zf(Xa.SCRIPT,d,s),style:Zf(Xa.STYLE,u,s),title:Zf(Xa.TITLE,{title:h,titleAttributes:m},s)}},Vit=function(t){var r,n;return n=r=function(s){Pit(o,s);function o(){return Cit(this,o),Eit(this,s.apply(this,arguments))}return o.prototype.shouldComponentUpdate=function(l){return!git(this.props,l)},o.prototype.mapNestedChildrenToProps=function(l,c){if(!c)return null;switch(l.type){case Xa.SCRIPT:case Xa.NOSCRIPT:return{innerHTML:c};case Xa.STYLE:return{cssText:c}}throw new Error("<"+l.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},o.prototype.flattenArrayTypeChildren=function(l){var c,d=l.child,u=l.arrayTypeChildren,f=l.newChildProps,h=l.nestedChildren;return yc({},u,(c={},c[d.type]=[].concat(u[d.type]||[],[yc({},f,this.mapNestedChildrenToProps(d,h))]),c))},o.prototype.mapObjectTypeChildren=function(l){var c,d,u=l.child,f=l.newProps,h=l.newChildProps,m=l.nestedChildren;switch(u.type){case Xa.TITLE:return yc({},f,(c={},c[u.type]=m,c.titleAttributes=yc({},h),c));case Xa.BODY:return yc({},f,{bodyAttributes:yc({},h)});case Xa.HTML:return yc({},f,{htmlAttributes:yc({},h)})}return yc({},f,(d={},d[u.type]=yc({},h),d))},o.prototype.mapArrayTypeChildrenToProps=function(l,c){var d=yc({},c);return Object.keys(l).forEach(function(u){var f;d=yc({},d,(f={},f[u]=l[u],f))}),d},o.prototype.warnOnInvalidChildren=function(l,c){return!0},o.prototype.mapChildrenToProps=function(l,c){var d=this,u={};return Ee.Children.forEach(l,function(f){if(!(!f||!f.props)){var h=f.props,m=h.children,x=kV(h,["children"]),g=qit(x);switch(d.warnOnInvalidChildren(f,m),f.type){case Xa.LINK:case Xa.META:case Xa.NOSCRIPT:case Xa.SCRIPT:case Xa.STYLE:u=d.flattenArrayTypeChildren({child:f,arrayTypeChildren:u,newChildProps:g,nestedChildren:m});break;default:c=d.mapObjectTypeChildren({child:f,newProps:c,newChildProps:g,nestedChildren:m});break}}}),c=this.mapArrayTypeChildrenToProps(u,c),c},o.prototype.render=function(){var l=this.props,c=l.children,d=kV(l,["children"]),u=yc({},d);return c&&(u=this.mapChildrenToProps(c,u)),Ee.createElement(t,u)},Ait(o,null,[{key:"canUseDOM",set:function(l){t.canUseDOM=l}}]),o}(Ee.Component),r.propTypes={base:ba.object,bodyAttributes:ba.object,children:ba.oneOfType([ba.arrayOf(ba.node),ba.node]),defaultTitle:ba.string,defer:ba.bool,encodeSpecialCharacters:ba.bool,htmlAttributes:ba.object,link:ba.arrayOf(ba.object),meta:ba.arrayOf(ba.object),noscript:ba.arrayOf(ba.object),onChangeClientState:ba.func,script:ba.arrayOf(ba.object),style:ba.arrayOf(ba.object),title:ba.string,titleAttributes:ba.object,titleTemplate:ba.string},r.defaultProps={defer:!0,encodeSpecialCharacters:!0},r.peek=t.peek,r.rewind=function(){var s=t.rewind();return s||(s=Toe({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),s},n},Wit=function(){return null},Hit=dit(Tit,Fit,Toe)(Wit),B0=Vit(Hit);B0.renderStatic=B0.rewind;function Wl(e){return e??""}function aj(e){return String(e||"").replace(/\D/g,"")}function Git(){const{userProfile:e}=qs(),{toast:t}=Ss(),r=hl(),[n,s]=p.useState(!0),[o,i]=p.useState(!1),[l,c]=p.useState(null),[d,u]=p.useState({inscricao_estadual:"",regime_tributario:"",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",nfce_serie:"1",nfce_numeracao:"1",nfce_itoken:"",nfe_serie:"",nfe_numeracao:"",ambiente:"homologacao",transmitenota_apikey:"",transmitenota_base_url:"",transmitenota_base_url_hml:"",transmitenota_apikey_hml:"",transmitenota_base_url_prod:"",transmitenota_apikey_prod:""}),[f,h]=p.useState(!1),[m,x]=p.useState(!1),[g,y]=p.useState(""),[v,b]=p.useState(""),[w,_]=p.useState(!1);p.useEffect(()=>{async function T(){if(!e?.codigo_empresa)return;s(!0);const{data:k,error:B}=await re.from("empresas").select("*").eq("codigo_empresa",e.codigo_empresa).single();B?t({title:"Erro ao carregar",description:B.message,variant:"destructive"}):k&&(c(k),u({inscricao_estadual:Wl(k.inscricao_estadual),regime_tributario:k.regime_tributario?String(k.regime_tributario):"",logradouro:Wl(k.logradouro),numero:Wl(k.numero),complemento:Wl(k.complemento),bairro:Wl(k.bairro),cidade:Wl(k.cidade),uf:Wl(k.uf),cep:aj(k.cep),codigo_municipio_ibge:Wl(k.codigo_municipio_ibge),nfce_serie:k.nfce_serie!=null?String(k.nfce_serie):"1",nfce_numeracao:k.nfce_numeracao!=null?String(k.nfce_numeracao):"1",nfce_itoken:Wl(k.nfce_itoken),nfe_serie:k.nfe_serie!=null?String(k.nfe_serie):"",nfe_numeracao:k.nfe_numeracao!=null?String(k.nfe_numeracao):"",ambiente:k.ambiente||"homologacao",transmitenota_apikey:Wl(k.transmitenota_apikey),transmitenota_base_url:Wl(k.transmitenota_base_url),transmitenota_base_url_hml:Wl(k.transmitenota_base_url_hml),transmitenota_apikey_hml:Wl(k.transmitenota_apikey_hml),transmitenota_base_url_prod:Wl(k.transmitenota_base_url_prod),transmitenota_apikey_prod:Wl(k.transmitenota_apikey_prod)})),s(!1)}T()},[e?.codigo_empresa]),p.useEffect(()=>{if(l?.codigo_empresa)try{const T=`cfgfiscal_hash_${l.codigo_empresa}`,k=!!l?.cfgfiscal_hash,B=!!localStorage.getItem(T);x(k||B)}catch{}},[l?.codigo_empresa]);const j=T=>k=>{const B=k?.target?k.target.value:k;u(z=>({...z,[T]:B}))};async function S(T){try{const k=(typeof window<"u"?window.crypto:typeof globalThis<"u"?globalThis.crypto:null)||null;if(k&&k.subtle&&typeof TextEncoder<"u"){const z=new TextEncoder().encode(T),U=await k.subtle.digest("SHA-256",z);return Array.from(new Uint8Array(U)).map(L=>L.toString(16).padStart(2,"0")).join("")}}catch{}return C(T)}function C(T){const k=unescape(encodeURIComponent(T));return A(k)}function A(T){for(var k=function(pt,Ze){return pt>>>Ze|pt<<32-Ze},B=Math.pow,z=B(2,32),U="length",L,W,ge="",Ae=[],V=T[U]*8,$=A.h=A.h||[],Y=A.k=A.k||[],he=Y[U],J={},G=2;he<64;G++)if(!J[G]){for(L=0;L<313;L+=G)J[L]=G;$[he]=B(G,.5)*z|0,Y[he++]=B(G,1/3)*z|0}for(T+="";T[U]%64-56;)T+="\0";for(L=0;L<T[U];L++)W=T.charCodeAt(L),Ae[L>>2]|=W<<(3-L)%4*8;for(Ae[Ae[U]]=V/z|0,Ae[Ae[U]]=V,W=0;W<Ae[U];){var ue=Ae.slice(W,W+=16),ve=$;for($=$.slice(0),L=0;L<64;L++){var ae=ue[L-15],oe=ue[L-2],me=$[0],De=$[4],ne=$[7]+(k(De,6)^k(De,11)^k(De,25))+(De&$[5]^~De&$[6])+Y[L]+(ue[L]=L<16?ue[L]:ue[L-16]+(k(ae,7)^k(ae,18)^ae>>>3)+ue[L-7]+(k(oe,17)^k(oe,19)^oe>>>10)|0),ie=(k(me,2)^k(me,13)^k(me,22))+(me&$[1]^me&$[2]^$[1]&$[2]);$=[ne+ie|0,me,$[1],$[2],$[3]+ne|0,$[4],$[5],$[6]]}for(L=0;L<8;L++)$[L]=$[L]+ve[L]|0}for(L=0;L<8;L++)for(W=3;W+1;W--){var ht=$[L]>>W*8&255;ge+=(ht<16?0:"")+ht.toString(16)}return ge}async function P(T){if(T?.preventDefault?.(),!(w||!l?.cnpj))try{_(!0);const k=`cfgfiscal_hash_${l.codigo_empresa}`,B=l?.cfgfiscal_hash||"",z=localStorage.getItem(k)||"",U=B||z;if(!U){t({title:"Nenhuma senha definida",variant:"destructive"});return}await S(String(g||"")+"|"+String(l.cnpj||""))===U?(h(!0),y(""),t({title:"Acesso liberado"})):t({title:"Senha incorreta",variant:"destructive"})}finally{_(!1)}}async function F(T){if(T?.preventDefault?.(),!(w||!l?.cnpj)){if(!g||g.length<8){t({title:"Defina uma senha com 8+ caracteres",variant:"destructive"});return}if(g!==v){t({title:"Senhas no conferem",variant:"destructive"});return}try{_(!0);const k=`cfgfiscal_hash_${l.codigo_empresa}`,B=await S(String(g)+"|"+String(l.cnpj||""));let z=!1;try{const{error:U}=await re.from("empresas").update({cfgfiscal_hash:B}).eq("codigo_empresa",l.codigo_empresa).select("id").single();if(!U){z=!0,c(L=>({...L,cfgfiscal_hash:B}));try{localStorage.removeItem(k)}catch{}}}catch{}if(!z)try{localStorage.setItem(k,B)}catch{}h(!0),y(""),b(""),t({title:"Senha definida"})}finally{_(!1)}}}async function O(T){if(T?.preventDefault?.(),!e?.codigo_empresa)return;const k={inscricao_estadual:d.inscricao_estadual?.trim()||null,regime_tributario:d.regime_tributario?Number(d.regime_tributario):null,logradouro:d.logradouro?.trim()||null,numero:d.numero?.trim()||null,complemento:d.complemento?.trim()||null,bairro:d.bairro?.trim()||null,cidade:d.cidade?.trim()||null,uf:d.uf?.trim().toUpperCase()||null,cep:aj(d.cep)||null,codigo_municipio_ibge:d.codigo_municipio_ibge?.trim()||null,nfce_serie:d.nfce_serie?Number(d.nfce_serie):null,nfce_numeracao:d.nfce_numeracao?Number(d.nfce_numeracao):null,nfce_itoken:d.nfce_itoken?.trim()||null,nfe_serie:d.nfe_serie?Number(d.nfe_serie):null,nfe_numeracao:d.nfe_numeracao?Number(d.nfe_numeracao):null,ambiente:d.ambiente||"homologacao",transmitenota_apikey:d.transmitenota_apikey?.trim()||null,transmitenota_base_url:d.transmitenota_base_url?.trim()||null,transmitenota_base_url_hml:d.transmitenota_base_url_hml?.trim()||null,transmitenota_apikey_hml:d.transmitenota_apikey_hml?.trim()||null,transmitenota_base_url_prod:d.transmitenota_base_url_prod?.trim()||null,transmitenota_apikey_prod:d.transmitenota_apikey_prod?.trim()||null};try{i(!0);const{error:B}=await re.from("empresas").update(k).eq("codigo_empresa",e.codigo_empresa).select("id").single();if(B)throw B;t({title:"Configuraes salvas",description:"Dados fiscais atualizados."})}catch(B){t({title:"Erro ao salvar",description:B.message,variant:"destructive"})}finally{i(!1)}}async function I(T){const k=aj(l?.cnpj||"");if(k.length!==14){t({title:"CNPJ invlido",description:"Salve um CNPJ vlido (14 dgitos) nos dados da empresa.",variant:"destructive"});return}const B=T==="prod",z=B?"/api/producao":"/api/homologacao";try{const U=await Vot({baseUrl:z,apiKey:"",cnpj:k});if(!U.reachable){t({title:"Sem conexo",description:U.error||`Endpoint inacessvel (${U.status||"sem status"})`,variant:"destructive"});return}if(U.authorized===!1){t({title:"Credenciais invlidas",description:`HTTP ${U.status}. Verifique ApiKey e CNPJ.`,variant:"destructive"});return}const L=U.status===200?"OK":U.status===400?"Conectado (dados mnimos ausentes; credenciais vlidas)":`Conectado (HTTP ${U.status})`,W=U.meta?`  via ${U.meta.via||"edge"}  ambiente ${U.meta.ambiente||(B?"producao":"homologacao")}`:"";t({title:`Conexo ${B?"PROD":"HML"}: sucesso`,description:L+W})}catch(U){t({title:"Falha no teste",description:U.message||"Erro inesperado",variant:"destructive"})}}return f?a.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[a.jsx(B0,{children:a.jsx("title",{children:"Configurao Fiscal"})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>r(-1),children:"Voltar"}),a.jsxs("div",{className:"text-right",children:[a.jsx("h1",{className:"text-2xl font-semibold leading-tight",children:"Configurao Fiscal"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Dados que sero usados na emisso de NFC-e/NF-e."})]})]}),a.jsxs("form",{onSubmit:O,className:"grid gap-6 bg-surface border border-border rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{children:"Inscrio Estadual"}),a.jsx(Ct,{value:d.inscricao_estadual,onChange:j("inscricao_estadual")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Regime Tributrio (CRT)"}),a.jsxs(Gn,{value:d.regime_tributario,onValueChange:j("regime_tributario"),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"1",children:"1 - Simples Nacional"}),a.jsx(lt,{value:"2",children:"2 - Simples Nacional (excesso sublimite)"}),a.jsx(lt,{value:"3",children:"3 - Regime Normal"})]})]})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Ambiente"}),a.jsxs(Gn,{value:d.ambiente,onValueChange:j("ambiente"),children:[a.jsx(Vn,{children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"homologacao",children:"Homologao"}),a.jsx(lt,{value:"producao",children:"Produo"})]})]})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"sm:col-span-3",children:[a.jsx(it,{children:"Logradouro"}),a.jsx(Ct,{value:d.logradouro,onChange:j("logradouro")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Nmero"}),a.jsx(Ct,{value:d.numero,onChange:j("numero")})]}),a.jsxs("div",{className:"sm:col-span-2",children:[a.jsx(it,{children:"Complemento"}),a.jsx(Ct,{value:d.complemento,onChange:j("complemento")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Bairro"}),a.jsx(Ct,{value:d.bairro,onChange:j("bairro")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"CEP"}),a.jsx(Ct,{value:d.cep,onChange:T=>j("cep")({target:{value:aj(T.target.value)}})})]}),a.jsxs("div",{className:"sm:col-span-2",children:[a.jsx(it,{children:"Cidade"}),a.jsx(Ct,{value:d.cidade,onChange:j("cidade")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"UF"}),a.jsx(Ct,{value:d.uf,onChange:T=>j("uf")({target:{value:String(T.target.value||"").toUpperCase().slice(0,2)}})})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Cdigo IBGE Municpio (cMun)"}),a.jsx(Ct,{value:d.codigo_municipio_ibge,onChange:j("codigo_municipio_ibge")})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{children:"NFC-e Srie"}),a.jsx(Ct,{value:d.nfce_serie,onChange:j("nfce_serie")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"NFC-e Numerao Inicial"}),a.jsx(Ct,{value:d.nfce_numeracao,onChange:j("nfce_numeracao")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"NFC-e IToken (CSC)"}),a.jsx(Ct,{value:d.nfce_itoken,onChange:j("nfce_itoken")})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{children:"NF-e Srie (opcional)"}),a.jsx(Ct,{value:d.nfe_serie,onChange:j("nfe_serie")})]}),a.jsxs("div",{children:[a.jsx(it,{children:"NF-e Numerao (opcional)"}),a.jsx(Ct,{value:d.nfe_numeracao,onChange:j("nfe_numeracao")})]}),a.jsxs("div",{className:"hidden",children:[a.jsx(it,{children:"ApiKey do Emissor"}),a.jsx(Ct,{value:d.transmitenota_apikey,readOnly:!0,disabled:!0})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"border border-border rounded-md p-3",children:[a.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Emissor Fiscal  Homologao"}),a.jsxs("div",{className:"hidden",children:[a.jsx(it,{className:"text-xs",children:"Base URL (HML)"}),a.jsx(Ct,{value:d.transmitenota_base_url_hml,readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3"})]}),a.jsx(it,{className:"text-xs",children:"ApiKey (HML)  Gerenciado no servidor"}),a.jsx(Ct,{value:d.transmitenota_apikey_hml?"":"",readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3",children:a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>I("hml"),disabled:o||n,children:n?"Testando...":"Testar conexo HML"})})]}),a.jsxs("div",{className:"border border-border rounded-md p-3",children:[a.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Emissor Fiscal  Produo"}),a.jsxs("div",{className:"hidden",children:[a.jsx(it,{className:"text-xs",children:"Base URL (PROD)"}),a.jsx(Ct,{value:d.transmitenota_base_url_prod,readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3"})]}),a.jsx(it,{className:"text-xs",children:"ApiKey (PROD)  Gerenciado no servidor"}),a.jsx(Ct,{value:d.transmitenota_apikey_prod?"":"",readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3",children:a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>I("prod"),disabled:o||n,children:n?"Testando...":"Testar conexo PROD"})})]})]}),a.jsx("div",{className:"flex gap-3 mt-4",children:a.jsx(se,{type:"submit",disabled:o||n,children:o?"Salvando...":"Salvar Configuraes"})})]})]}):a.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[a.jsx(B0,{children:a.jsx("title",{children:"Configurao Fiscal"})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx(se,{type:"button",variant:"outline",size:"sm",onClick:()=>r(-1),children:"Voltar"}),a.jsxs("div",{className:"text-right",children:[a.jsx("h1",{className:"text-2xl font-semibold leading-tight",children:"Configurao Fiscal"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Acesso restrito."})]})]}),a.jsx("div",{className:"max-w-md mx-auto grid gap-4 bg-surface border border-border rounded-lg p-4 shadow-sm",children:n?a.jsx("div",{className:"text-sm text-text-secondary",children:"Carregando..."}):m?a.jsxs(a.Fragment,{children:[a.jsx(it,{children:"Senha"}),a.jsx(Ct,{type:"password",value:g,onChange:T=>y(T.target.value)}),a.jsx(se,{type:"button",onClick:P,disabled:w||!g,children:w?"Verificando...":"Desbloquear"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm",children:"Defina uma senha para proteger esta aba."}),a.jsx(it,{children:"Nova senha"}),a.jsx(Ct,{type:"password",value:g,onChange:T=>y(T.target.value)}),a.jsx(it,{children:"Confirmar senha"}),a.jsx(Ct,{type:"password",value:v,onChange:T=>b(T.target.value)}),a.jsx(se,{type:"button",onClick:F,disabled:w||!g||!v,children:w?"Salvando...":"Definir senha"})]})})]})}function vd(e){return String(e||"").replace(/\D/g,"")}function kl(e){if(e==null)return 0;let t=String(e).trim();if(!t)return 0;t.includes(",")&&t.includes(".")?t=t.replace(/\./g,"").replace(",","."):t.includes(",")&&(t=t.replace(",","."));const r=Number(t);return Number.isFinite(r)?r:0}function Doe(e){return(Array.isArray(e?.itens)?e.itens:[]).map((r,n)=>{const s=kl(r.quantidade),o=kl(r.preco_unitario),i=kl(r.desconto_percent),l=kl(r.desconto_valor),c=kl(r.acrescimos_valor),d=kl(r.frete_valor),u=kl(r.seguro_valor),f=s*o,h=i?f*i/100:l,m=Math.max(0,f-h+c+d+u),x=r.impostos||{},g=x.icms||{},y=x.pis||{},v=x.cofins||{},b={numero_item:n+1,codigo_produto:r.codigo||n+1,descricao:r.descricao||`Item ${n+1}`,cfop:Number(r.cfop||5102),unidade_comercial:r.unidade||"UN",quantidade_comercial:s,valor_unitario_comercial:Ao(o),codigo_ncm:vd(r.ncm).slice(0,8)||"",valor_desconto:h?Ao(h):"",valor_frete:d?Ao(d):"",valor_seguro:u?Ao(u):"",valor_outras_despesas:c?Ao(c):"",valor_total:Ao(m),valor_total_sem_desconto:Ao(f),icms_orig:Number(x.origem||0)};if(g.csosn&&(b.icms_csosn=Number(g.csosn)),g.cst&&(b.icms_cst=Number(g.cst)),y.cst&&(b.pis_situacao_tributaria=y.cst),v.cst&&(b.cofins_situacao_tributaria=v.cst),y.aliquota){const w=kl(y.aliquota);b.base_calculo_pis=Ao(m),b.aliquota_pis=TV(w/100),b.valor_pis=Ao(m*w/100)}if(v.aliquota){const w=kl(v.aliquota);b.base_calculo_cofins=Ao(m),b.aliquota_cofins=TV(w/100),b.valor_cofins=Ao(m*w/100)}return b})}function Kit({form:e,finalizadoras:t=[]}){const r=Doe(e),n=r.reduce((h,m)=>h+Number(m.valor_total||0),0),s=kl(e?.totais?.frete),o=kl(e?.totais?.outras_despesas),i=kl(e?.totais?.desconto_geral),l=n-i+s+o,c=Array.isArray(e?.pagamentos)?e.pagamentos:[],d=c.reduce((h,m)=>h+kl(m.valor),0),u=Math.max(0,d-l),f=(()=>{if(!c.length)return"90";const h=c[0];return t.find(x=>String(x.id)===String(h.finalizadora_id))?.codigo_sefaz||"99"})();return{tipo_operacao:e?.tipo_nota==="entrada"?0:1,natureza_operacao:e?.natOp||"Venda de mercadoria",forma_pagamento:0,meio_pagamento:f,data_emissao:e?.data_emissao?new Date(e.data_emissao+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),data_saida_entrada:e?.data_saida?new Date(e.data_saida+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),hora_saida_entrada:new Date().toTimeString().slice(0,8),finalidade_emissao:Number(e?.finNFe||1),modalidade_frete:e?.transporte?.tipo_frete||"9",valor_frete:s?Ao(s):"0",valor_seguro:"0",valor_ipi:"0",valor_total:Ao(l),valor_total_sem_desconto:Ao(n),valor_troco:u?Ao(u):"",...e?.cpf_cnpj?{nome_destinatario:e?.nome||"",cnpj_destinatario:vd(e?.cpf_cnpj),inscricao_estadual_destinatario:e?.ie_isento?"ISENTO":e?.inscricao_estadual||"",email_destinatario:e?.email||"",telefone_destinatario:vd(e?.telefone||""),logradouro_destinatario:e?.logradouro||"",numero_destinatario:e?.numero||"",complemento_destinatario:"",bairro_destinatario:e?.bairro||"",municipio_destinatario:e?.cidade||"",codigo_cidade:e?.codigo_municipio_ibge||"",uf_destinatario:e?.uf||"",pais_destinatario:"Brasil",cep_destinatario:vd(e?.cep||""),indicador_ie_destinatario:Number(e?.indIEDest||9)}:{},Itens:[r]}}function Xit({form:e}){const t=Doe(e),r=t.reduce((l,c)=>l+Number(c.valor_total||0),0),n=kl(e?.totais?.frete),s=kl(e?.totais?.outras_despesas),o=kl(e?.totais?.desconto_geral),i=r-o+n+s;return{tipo_operacao:e?.tipo_nota==="entrada"?0:1,natureza_operacao:e?.natOp||"Venda de mercadoria",forma_pagamento:0,meio_pagamento:"01",data_emissao:e?.data_emissao?new Date(e.data_emissao+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),data_saida_entrada:e?.data_saida?new Date(e.data_saida+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),hora_saida_entrada:new Date().toTimeString().slice(0,8),finalidade_emissao:Number(e?.finNFe||1),modalidade_frete:Number(e?.transporte?.tipo_frete??9),valor_frete:n?Ao(n):"0",valor_seguro:"0",valor_ipi:"0",valor_total:Ao(i),valor_total_sem_desconto:Ao(r),icms_base_calculo:"0",icms_valor_total:"0",icms_base_calculo_st:"0",icms_valor_total_st:"0",icms_modalidade_base_calculo:0,icms_valor:"0",informacoes_adicionais_contribuinte:e?.adicionais?.obs_gerais||"",nome_transportadora:e?.transporte?.transportadora||"",cnpj_transportadora:"",endereco_transportadora:"",municipio_transportadora:"",uf_transportadora:"",inscricao_estadual_transportadora:"",nome_destinatario:e?.nome||"",cnpj_destinatario:vd(e?.cpf_cnpj||""),inscricao_estadual_destinatario:e?.ie_isento?"ISENTO":e?.inscricao_estadual||"",email_destinatario:e?.email||"",telefone_destinatario:vd(e?.telefone||""),logradouro_destinatario:e?.logradouro||"",numero_destinatario:e?.numero||"",complemento_destinatario:"",bairro_destinatario:e?.bairro||"",municipio_destinatario:e?.cidade||"",uf_destinatario:e?.uf||"",pais_destinatario:"Brasil",cep_destinatario:vd(e?.cep||""),indicador_ie_destinatario:Number(e?.indIEDest??1),Itens:t.map(l=>[l])}}function Ao(e){const t=Number(e??0);return Number.isFinite(t)?t.toFixed(2):"0.00"}function TV(e){const t=Number(e??0);return Number.isFinite(t)?t.toFixed(4):"0.0000"}function Yit(e){return e==null?"":String(e)}function Jit(e){return e?.length,0}function Qit(e,t){if(!e?.length)return"90";const r=e[0];return t.find(s=>s.id===r.finalizadora_id)?.codigo_sefaz||"99"}function Zit(e,t){if(t){const r=vd(t.cpf||t.cnpj||t.cpf_cnpj||t.cpf_cnpj_limpo);return{nome:t.nome||t.nome_completo||t.razao_social||"",cpf_cnpj:r||void 0,ie:t.inscricao_estadual||void 0,email:t.email||void 0,telefone:vd(t.telefone)||void 0,endereco:{logradouro:t.logradouro||t.endereco||"",numero:Yit(t.numero||""),complemento:t.complemento||"",bairro:t.bairro||"",municipio:t.municipio||t.cidade||"",uf:t.uf||"",cep:vd(t.cep),codigo_cidade:t.codigo_municipio||t.codigo_municipio_ibge||void 0,pais:t.pais||"Brasil"},indicador_ie_destinatario:t.indicador_ie_destinatario||9}}return null}async function tv({comandaId:e,codigoEmpresa:t}){if(!e)throw new Error("comandaId obrigatrio");if(!t)throw new Error("codigoEmpresa obrigatrio");const{data:r,error:n}=await re.from("empresas").select("*").eq("codigo_empresa",t).single();if(n)throw n;const{data:s,error:o}=await re.from("comandas").select("*").eq("codigo_empresa",t).eq("id",e).single();if(o)throw o;let i=null;if(s.cliente_id){const{data:j}=await re.from("clientes").select("*").eq("id",s.cliente_id).single();i=j||null}else{const{data:j}=await re.from("comanda_clientes").select("clientes:clientes!comanda_clientes_cliente_id_fkey(*)").eq("comanda_id",s.id).limit(1),S=Array.isArray(j)&&j.length?j[0]:null;S?.clientes&&(i=S.clientes)}const{data:l,error:c}=await re.from("comanda_itens").select("*").eq("comanda_id",s.id);if(c)throw c;const d=Array.from(new Set(l.map(j=>j.produto_id).filter(Boolean)));let u=new Map;if(d.length){const{data:j}=await re.from("produtos").select("*").in("id",d);(j||[]).forEach(S=>u.set(S.id,S))}const{data:f}=await re.from("pagamentos").select("*").eq("comanda_id",s.id),h=Array.from(new Set((f||[]).map(j=>j.finalizadora_id).filter(Boolean)));let m=[];if(h.length){const{data:j}=await re.from("finalizadoras").select("*").in("id",h);m=j||[]}const x=l.reduce((j,S)=>j+Number(S.quantidade||0)*Number(S.preco_unitario||0),0),g=l.reduce((j,S)=>j+Number(S.desconto||0),0),y=x-g,v=Zit(s,i),b={tipo_operacao:1,natureza_operacao:"Venda de mercadoria",forma_pagamento:Jit(f),meio_pagamento:Qit(f,m),data_emissao:new Date(s.fechado_em||s.updated_at||Date.now()).toLocaleDateString("pt-BR"),data_saida_entrada:new Date(s.fechado_em||Date.now()).toLocaleDateString("pt-BR"),hora_saida_entrada:new Date(s.fechado_em||Date.now()).toTimeString().slice(0,8),finalidade_emissao:1,modalidade_frete:"9",valor_frete:"0",valor_seguro:"0",valor_ipi:"0",valor_total:Ao(y),valor_total_sem_desconto:Ao(x),...v?{nome_destinatario:v.nome,cnpj_destinatario:v.cpf_cnpj,inscricao_estadual_destinatario:v.ie,email_destinatario:v.email,telefone_destinatario:v.telefone,logradouro_destinatario:v.endereco.logradouro,numero_destinatario:v.endereco.numero,complemento_destinatario:v.endereco.complemento,bairro_destinatario:v.endereco.bairro,municipio_destinatario:v.endereco.municipio,codigo_cidade:v.endereco.codigo_cidade,uf_destinatario:v.endereco.uf,pais_destinatario:v.endereco.pais,cep_destinatario:v.endereco.cep,indicador_ie_destinatario:v.indicador_ie_destinatario}:{},Itens:[l.map((j,S)=>{const C=u.get(j.produto_id)||{},A=Number(j.quantidade||0),P=Number(j.preco_unitario||0),F=Number(j.desconto||0),O=A*P-F,I=C.cfop_interno||C.cfop||5102,T=(C.ncm||"").replace(/\D/g,"").slice(0,8)||"",k=C.unidade||C.unit||"UN",B=C.csosn_interno||C.csosn||null;C.cst_icms_interno||C.cstIcmsInterno;const z=C.cst_pis_saida||C.cstPisSaida||"07",U=C.cst_cofins_saida||C.cstCofinsSaida||"07",L=C.icms_origem??0;return{numero_item:S+1,codigo_produto:C.code||C.codigo||C.id,descricao:C.name||C.descricao||j.descricao||"Item",cfop:Number(I),unidade_comercial:k,quantidade_comercial:A,valor_unitario_comercial:Ao(P),codigo_ncm:T,valor_desconto:F?Ao(F):"",valor_frete:"",valor_seguro:"",valor_outras_despesas:"",valor_total:Ao(O),valor_total_sem_desconto:Ao(A*P),icms_csosn:B?Number(B):void 0,icms_orig:Number(L)||0,pis_situacao_tributaria:z,base_calculo_pis:"",aliquota_pis:"",valor_pis:"",cofins_situacao_tributaria:U,base_calculo_cofins:"",aliquota_cofins:"",valor_cofins:""}})]},w=[];r?.inscricao_estadual||w.push("Inscrio Estadual (empresa)"),r?.regime_tributario||w.push("CRT/Regime Tributrio (empresa)"),(!r?.cidade||!r?.uf)&&w.push("Cidade/UF (empresa)"),r?.codigo_municipio_ibge||w.push("Cdigo IBGE do municpio (empresa)"),r?.nfce_serie||w.push("NFC-e Srie (empresa)"),!r?.nfce_itoken&&r?.ambiente==="producao"&&w.push("NFC-e IToken/CSC (produo)"),vd(r?.cnpj)||w.push("CNPJ da empresa"),l.forEach(j=>{const S=u.get(j.produto_id)||{},C=vd(S.ncm||"").slice(0,8);(!C||/^0+$/.test(C))&&w.push(`Produto ${S.name||S.id}: NCM vlido`),!S.cfop_interno&&!S.cfop&&w.push(`Produto ${S.name||S.id}: CFOP interno`)});const _={ApiKey:r?.transmitenota_apikey||"",Cnpj:vd(r?.cnpj),Dados:b};return{empresa:r,comanda:s,cliente:i,itens:l,pagamentos:f,finalizadoras:m,payload:_,missing:w}}async function elt({comandaId:e,codigoEmpresa:t,modelo:r="65",overrides:n={}}){if(!e)throw new Error("ID da comanda  obrigatrio");if(!t)throw new Error("Cdigo da empresa  obrigatrio");const{data:s,error:o}=await re.from("vendas").select("*").eq("id",e).eq("codigo_empresa",t).single();if(o)throw new Error(`Erro ao buscar comanda: ${o.message}`);if(!s)throw new Error("Comanda no encontrada");const{data:i,error:l}=await re.from("itens_venda").select(`
      *,
      produtos!itens_venda_produto_id_fkey (
        id,
        nome,
        codigo,
        ncm,
        cest,
        cfopInterno,
        cfopExterno,
        cstIcmsInterno,
        cstIcmsExterno,
        csosnInterno,
        csosnExterno,
        aliqIcmsInterno,
        aliqIcmsExterno,
        cstPisEntrada,
        cstPisSaida,
        aliqPisPercent,
        aliqCofinsPercent,
        cstIpi,
        aliqIpiPercent
      )
    `).eq("comanda_id",e).eq("codigo_empresa",t);if(l)throw new Error(`Erro ao buscar itens: ${l.message}`);const{data:c,error:d}=await re.from("pagamentos").select(`
      *,
      finalizadoras!pagamentos_finalizadora_id_fkey (
        id,
        codigo_sefaz,
        nome
      )
    `).eq("comanda_id",e).eq("codigo_empresa",t).neq("status","Cancelado").neq("status","Estornado");if(d)throw new Error(`Erro ao buscar pagamentos: ${d.message}`);const{data:u,error:f}=await re.from("empresas").select("*").eq("codigo_empresa",t).single();if(f)throw new Error(`Erro ao buscar empresa: ${f.message}`);let h=null;if(s.cliente_id){const{data:m}=await re.from("clientes").select("*").eq("id",s.cliente_id).eq("codigo_empresa",t).single();h=m}return tlt({comanda:s,itens:i||[],pagamentos:c||[],empresa:u,cliente:h,modelo:r,overrides:n})}function tlt({comanda:e,itens:t,pagamentos:r,empresa:n,cliente:s,modelo:o="65",overrides:i={}}){const c=new Date().toISOString(),d=String(i.nNF||e.numero||"1"),u=o==="55"?"55":"65",f=u==="55"?"NF-e":"NFC-e",h=t.reduce((k,B)=>k+(Number(B.preco_total)||0),0),m=Number(e.desconto)||0,x=h-m,g=String(i.natOp||"VENDA"),y=String(i.serie||"1"),v=String(i.tpAmb||(n.ambiente==="producao"?"1":"2")),b=String(i.tpNF||"1"),w=String(i.indFinal||"1"),_=String(i.indPres||"1"),j=s&&s.uf&&n.uf&&s.uf!==n.uf?"2":"1",S=String(i.idDest||j),A=String({AC:"12",AL:"27",AM:"13",AP:"16",BA:"29",CE:"23",DF:"53",ES:"32",GO:"52",MA:"21",MG:"31",MS:"50",MT:"51",PA:"15",PB:"25",PE:"26",PI:"22",PR:"41",RJ:"33",RN:"24",RO:"11",RR:"14",RS:"43",SC:"42",SE:"28",SP:"35",TO:"17"}[(n.uf||"").toUpperCase()]||n.codigo_uf||"35"),P=String(n.codigo_municipio_ibge||n.codigo_municipio||""),F=s?`
    <dest>
      <${s.tipo_pessoa==="PJ"?"CNPJ":"CPF"}>${s.cpf_cnpj||""}</${s.tipo_pessoa==="PJ"?"CNPJ":"CPF"}>
      <xNome>${vc(s.nome||s.razao_social||"")}</xNome>
      <enderDest>
        <xLgr>${vc(s.logradouro||"")}</xLgr>
        <nro>${vc(s.numero||"S/N")}</nro>
        <xBairro>${vc(s.bairro||"")}</xBairro>
        <cMun>${s.codigo_municipio||s.codigo_municipio_ibge||""}</cMun>
        <xMun>${vc(s.municipio||s.cidade||"")}</xMun>
        <UF>${s.uf||""}</UF>
        <CEP>${(s.cep||"").replace(/\D/g,"")}</CEP>
        <cPais>1058</cPais>
        <xPais>BRASIL</xPais>
      </enderDest>
      <indIEDest>9</indIEDest>
      ${s.email?`<email>${vc(s.email)}</email>`:""}
    </dest>`:`
    <dest>
      <indIEDest>9</indIEDest>
    </dest>`,O=t.map((k,B)=>{const z=k.produtos||{},U=Number(k.preco_unitario)||0,L=Number(k.quantidade)||1,W=Number(k.preco_total)||U*L;return`
    <det nItem="${B+1}">
      <prod>
        <cProd>${vc(z.codigo||k.produto_id)}</cProd>
        <cEAN>SEM GTIN</cEAN>
        <xProd>${vc(z.nome||"Produto")}</xProd>
        <NCM>${z.ncm||"00000000"}</NCM>
        ${z.cest?`<CEST>${z.cest}</CEST>`:""}
        <CFOP>${z.cfopInterno||"5102"}</CFOP>
        <uCom>UN</uCom>
        <qCom>${L.toFixed(4)}</qCom>
        <vUnCom>${U.toFixed(10)}</vUnCom>
        <vProd>${W.toFixed(2)}</vProd>
        <cEANTrib>SEM GTIN</cEANTrib>
        <uTrib>UN</uTrib>
        <qTrib>${L.toFixed(4)}</qTrib>
        <vUnTrib>${U.toFixed(10)}</vUnTrib>
        <indTot>1</indTot>
      </prod>
      <imposto>
        <ICMS>
          ${z.csosnInterno?`
          <ICMSSN102>
            <orig>0</orig>
            <CSOSN>${z.csosnInterno}</CSOSN>
          </ICMSSN102>`:`
          <ICMS00>
            <orig>0</orig>
            <CST>${z.cstIcmsInterno||"00"}</CST>
            <modBC>3</modBC>
            <vBC>${W.toFixed(2)}</vBC>
            <pICMS>${z.aliqIcmsInterno||"0.00"}</pICMS>
            <vICMS>${(W*(Number(z.aliqIcmsInterno)||0)/100).toFixed(2)}</vICMS>
          </ICMS00>`}
        </ICMS>
        <PIS>
          <PISAliq>
            <CST>${z.cstPisSaida||"01"}</CST>
            <vBC>${W.toFixed(2)}</vBC>
            <pPIS>${z.aliqPisPercent||"0.00"}</pPIS>
            <vPIS>${(W*(Number(z.aliqPisPercent)||0)/100).toFixed(2)}</vPIS>
          </PISAliq>
        </PIS>
        <COFINS>
          <COFINSAliq>
            <CST>${z.cstPisSaida||"01"}</CST>
            <vBC>${W.toFixed(2)}</vBC>
            <pCOFINS>${z.aliqCofinsPercent||"0.00"}</pCOFINS>
            <vCOFINS>${(W*(Number(z.aliqCofinsPercent)||0)/100).toFixed(2)}</vCOFINS>
          </COFINSAliq>
        </COFINS>
      </imposto>
    </det>`}).join(""),I=r.map(k=>{const B=k.finalizadoras?.codigo_sefaz||"99",z=Number(k.valor)||0;return`
    <pag>
      <detPag>
        <tPag>${B}</tPag>
        <vPag>${z.toFixed(2)}</vPag>
      </detPag>
    </pag>`}).join("");return`<?xml version="1.0" encoding="UTF-8"?>
<nfeProc versao="4.00" xmlns="http://www.portalfiscal.inf.br/nfe">
  <NFe xmlns="http://www.portalfiscal.inf.br/nfe">
    <infNFe versao="4.00" Id="NFe${n.cnpj||""}${d.padStart(9,"0")}">
      <ide>
        <cUF>${A}</cUF>
        <cNF>${d.padStart(8,"0")}</cNF>
        <natOp>${g}</natOp>
        <mod>${u}</mod>
        <serie>${y}</serie>
        <nNF>${d}</nNF>
        <dhEmi>${c}</dhEmi>
        <tpNF>${b}</tpNF>
        <idDest>${S}</idDest>
        <cMunFG>${P}</cMunFG>
        <tpImp>4</tpImp>
        <tpEmis>1</tpEmis>
        <tpAmb>${v}</tpAmb>
        <finNFe>1</finNFe>
        <indFinal>${w}</indFinal>
        <indPres>${_}</indPres>
        <procEmi>0</procEmi>
        <verProc>1.0.0</verProc>
      </ide>
      <emit>
        <CNPJ>${n.cnpj||""}</CNPJ>
        <xNome>${vc(n.razao_social||n.nome_fantasia||"")}</xNome>
        <xFant>${vc(n.nome_fantasia||"")}</xFant>
        <enderEmit>
          <xLgr>${vc(n.logradouro||"")}</xLgr>
          <nro>${vc(n.numero||"S/N")}</nro>
          <xBairro>${vc(n.bairro||"")}</xBairro>
          <cMun>${n.codigo_municipio_ibge||n.codigo_municipio||""}</cMun>
          <xMun>${vc(n.municipio||n.cidade||"")}</xMun>
          <UF>${n.uf||""}</UF>
          <CEP>${(n.cep||"").replace(/\D/g,"")}</CEP>
          <cPais>1058</cPais>
          <xPais>BRASIL</xPais>
          <fone>${(n.telefone||"").replace(/\D/g,"")}</fone>
        </enderEmit>
        <IE>${n.inscricao_estadual||""}</IE>
        <CRT>${n.regime_tributario||"1"}</CRT>
      </emit>
      ${F}
      ${O}
      <total>
        <ICMSTot>
          <vBC>0.00</vBC>
          <vICMS>0.00</vICMS>
          <vICMSDeson>0.00</vICMSDeson>
          <vFCP>0.00</vFCP>
          <vBCST>0.00</vBCST>
          <vST>0.00</vST>
          <vFCPST>0.00</vFCPST>
          <vFCPSTRet>0.00</vFCPSTRet>
          <vProd>${h.toFixed(2)}</vProd>
          <vFrete>0.00</vFrete>
          <vSeg>0.00</vSeg>
          <vDesc>${m.toFixed(2)}</vDesc>
          <vII>0.00</vII>
          <vIPI>0.00</vIPI>
          <vIPIDevol>0.00</vIPIDevol>
          <vPIS>0.00</vPIS>
          <vCOFINS>0.00</vCOFINS>
          <vOutro>0.00</vOutro>
          <vNF>${x.toFixed(2)}</vNF>
        </ICMSTot>
      </total>
      <transp>
        <modFrete>9</modFrete>
      </transp>
      ${I}
      <infAdic>
        <infCpl>Comanda: ${e.id} | Modelo: ${f}</infCpl>
      </infAdic>
    </infNFe>
  </NFe>
</nfeProc>`}function vc(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}const DV=[{code:"1102",desc:"Compra para industrializao, comercializao ou prestao de servios"},{code:"5101",desc:"Venda de produo do estabelecimento"},{code:"5102",desc:"Venda de mercadoria adquirida de terceiros"},{code:"5103",desc:"Venda de produo do estabelecimento, efetuada fora do estabelecimento"},{code:"5104",desc:"Venda de mercadoria adquirida de terceiros, efetuada fora do estabelecimento"},{code:"5405",desc:"Venda de mercadoria adquirida de terceiros, sujeita a ST"},{code:"5949",desc:"Outras sadas de mercadorias no especificadas"},{code:"5915",desc:"Remessa em bonificao, doao ou brinde"},{code:"5109",desc:"Venda de produo do estabelecimento, destinada a no contribuinte"},{code:"5110",desc:"Venda de mercadoria adquirida de terceiros, destinada a no contribuinte"},{code:"5401",desc:"Venda de produo do estabelecimento, sujeita a ST"},{code:"5403",desc:"Venda de mercadoria, de terceiros, sujeita a ST, efetuada pelo industrial substituto"},{code:"2102",desc:"Compra para industrializao, comercializao ou prestao de servios (fora do estado)"},{code:"6101",desc:"Venda de produo do estabelecimento (fora do estado)"},{code:"6102",desc:"Venda de mercadoria adquirida de terceiros (fora do estado)"},{code:"6403",desc:"Venda de produo do estabelecimento, sujeita a ST (fora do estado)"},{code:"6915",desc:"Remessa em bonificao, doao ou brinde (fora do estado)"}];function Ls(e){return Number(e||0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}function Bk(e){if(!e)return"";try{return new Date(e).toLocaleString("pt-BR")}catch{return""}}const Ia=e=>e==null||String(e).trim()==="";function MV({label:e,value:t,onChange:r}){const[n,s]=Ee.useState(!1),o=Ee.useRef(null),i=Ee.useRef(null),[l,c]=Ee.useState({top:0,left:0}),d=m=>{try{const[x,g,y]=String(m||"").split("-").map(Number);return x&&g&&y?new Date(x,g-1,y):null}catch{return null}},u=m=>{const x=g=>String(g).padStart(2,"0");return`${m.getFullYear()}-${x(m.getMonth()+1)}-${x(m.getDate())}`},f=Ee.useCallback(()=>{if(!i.current)return;const m=i.current.getBoundingClientRect(),x=320,g=Math.min(Math.max(8,m.left),window.innerWidth-x-8),y=Math.min(m.bottom+6,window.innerHeight-8-300);c({top:y,left:g})},[]);Ee.useEffect(()=>{if(!n)return;f();const m=()=>f(),x=()=>f();return window.addEventListener("scroll",m,!0),window.addEventListener("resize",x),()=>{window.removeEventListener("scroll",m,!0),window.removeEventListener("resize",x)}},[n,f]);const h=d(t);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"relative",ref:o,children:a.jsx("button",{ref:i,type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs",onClick:()=>s(m=>!m),children:t?new Date(t+"T00:00:00").toLocaleDateString("pt-BR"):e})}),n&&U4.createPortal(a.jsx("div",{className:"fixed z-[1000] p-2 bg-black text-white border border-warning/40 rounded-md shadow-xl",style:{top:l.top,left:l.left},children:a.jsx(oi,{mode:"single",selected:h||void 0,onSelect:m=>{m&&(r(u(m)),s(!1))},showOutsideDays:!0,classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}),document.body)]})}function rlt(){const{userProfile:e}=qs(),t=e?.codigo_empresa,{toast:r}=Ss(),n=hl(),[s,o]=p.useState([]),[i,l]=p.useState(!1),[c,d]=p.useState([]),[u,f]=p.useState(!1),[h,m]=p.useState(""),[x,g]=p.useState(""),[y,v]=p.useState("all"),b=D=>String(D).padStart(2,"0"),w=new Date,_=w.getFullYear(),j=w.getMonth()+1,S=`${_}-${b(j)}-01`,C=`${_}-${b(j)}-${b(new Date(_,j,0).getDate())}`,[A,P]=p.useState(S),[F,O]=p.useState(C),[I,T]=p.useState(!1),[k,B]=p.useState(null),[z,U]=p.useState("nfce");e&&(e.cargo||e.papel);const[L,W]=p.useState("aberto_em"),[ge,Ae]=p.useState("desc"),[V,$]=p.useState(1),[Y,he]=p.useState(50),[J,G]=p.useState([]),ue=D=>J.includes(D),ve=(D,Q)=>{G(M=>Q?Array.from(new Set([...M||[],D])):(M||[]).filter(H=>H!==D)),B(M=>Q?D:M===D?null:M)},ae=async D=>{try{if(!Te){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:Q,cnpj:M}=lf(Te);if(!M){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const H=D.xml_chave||"";let le;if(H)le={chave_nota:H,chave:H};else if(D.numero&&D.serie)le={numero:D.numero,serie:D.serie};else{r({title:"Sem referncia para consultar",description:"Preencha nmero/srie ou emita para obter a chave",variant:"warning"});return}r({title:"Consultando status...",description:`NF-e ${D.numero||""}/${D.serie||""}`});let X=null,Ce="",we="",Z=!1,ye=D.xml_url||null,Ne=D.pdf_url||null,Re=D.xml_chave||null,bt=D.numero||null,Rt=D.serie||null;try{X=await Mk({baseUrl:Q,cnpj:M,dados:le}),Ce=String(X?.status||X?.cStat||""),we=X?.xMotivo||X?.mensagem||X?.message||"Retorno da consulta",Z=Ce==="100"||/autorizad/i.test(we),ye=X?.url_xml||X?.xml_url||ye,Ne=X?.url_pdf||X?.pdf_url||Ne,Re=X?.chave_nota||X?.chave||X?.Chave||Re,bt=X?.numero||X?.Numero||bt,Rt=X?.serie||X?.Serie||Rt}catch(qt){we=qt?.message||String(qt)}if(!Z||!Ne&&!ye){try{const qt=await Rk({baseUrl:Q,cnpj:M,dados:le});Ne=qt?.url_pdf||qt?.pdf_url||Ne,Re=qt?.chave||qt?.Chave||Re}catch{}try{const qt=await Fk({baseUrl:Q,cnpj:M,dados:le});ye=qt?.url_xml||qt?.xml_url||ye,Re=Re||qt?.chave||qt?.Chave||Re}catch{}(Ne||ye)&&(Z=!0)}const dr=Z?"autorizada":/rejeit/i.test(we)?"rejeitada":Ce||D.status||"pendente";await re.from("notas_fiscais").update({status:dr,xml_url:ye,pdf_url:Ne,xml_chave:Re,numero:bt,serie:Rt}).eq("id",D.id).eq("codigo_empresa",t),await Bt(),r({title:Z?"Autorizada":`Status ${Ce||""}`.trim(),description:we||"Consulta concluda",variant:Z?"success":"default"})}catch(Q){r({title:"Falha ao consultar",description:Q?.message||String(Q),variant:"destructive"})}},oe=async D=>{try{if(!D)return;const Q=(Lr||"").trim();if(!Q){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}if(!Te){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:M,cnpj:H}=lf(Te);if(!H){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const le=D.xml_chave?{chave_nota:D.xml_chave,chave:D.xml_chave,motivo:Q}:{numero:D.numero,serie:D.serie,motivo:Q};await Hot({baseUrl:M,cnpj:H,dados:le}),await re.from("notas_fiscais").update({status:"cancelada"}).eq("id",D.id).eq("codigo_empresa",t),await Bt(),r({title:"NF-e cancelada"}),an(null),On("")}catch(Q){r({title:"Falha ao cancelar",description:Q?.message||String(Q),variant:"destructive"})}},me=async()=>{try{const D=c||[],Q=k||J&&J[0];if(!Q){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const M=D.find(H=>H.id===Q);if(!M){r({title:"NF-e no encontrada na lista",variant:"warning"});return}await ae(M)}catch(D){r({title:"Falha ao consultar NF-e",description:D?.message||String(D),variant:"destructive"})}},De=async()=>{try{const D=c||[],Q=k||J&&J[0];if(!Q){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const M=D.find(H=>H.id===Q);if(!M){r({title:"NF-e no encontrada na lista",variant:"warning"});return}an(M),On("")}catch(D){r({title:"Falha ao cancelar NF-e",description:D?.message||String(D),variant:"destructive"})}},ne=async()=>{try{const D=c||[],Q=k||J&&J[0];if(!Q){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const M=D.find(le=>le.id===Q);if(!M){r({title:"NF-e no encontrada na lista",variant:"warning"});return}const H=M?.draft_data;if(!H||!Array.isArray(H.itens)||H.itens.length===0){Oe(M.id),M.draft_data&&jr(M.draft_data),Tt(!0),r({title:"Rascunho incompleto",description:"Abra o rascunho para revisar e emitir.",variant:"warning"});return}await Zi(H,M.id)}catch(D){r({title:"Falha ao emitir NF-e",description:D?.message||String(D),variant:"destructive"})}},ie=async D=>{try{if(!D||!D.id)return;if(Oe(D.id),Gr("cliente"),D.draft_data){jr(D.draft_data),Tt(!0);return}if(D.origem==="comanda"&&D.comanda_id)try{await pe(D.comanda_id)}catch{}Tt(!0)}catch{}},ht=async()=>{if(!ua||!t){r({title:"Rascunho no iniciado",variant:"warning"});return}try{Ht(!0);const M=(tt.itens||[]).map(le=>{const X=Xr(le.preco_unitario)||0,Ce=Xr(le.quantidade)||1,we=X*Ce,Z=Xr(le.desconto_percent)||0,ye=Xr(le.desconto_valor)||0,Ne=Xr(le.acrescimos_valor)||0,Re=Z?we*Z/100:ye;return{preco_total:we-Re+Ne}}).reduce((le,X)=>le+(Number(X.preco_total)||0),0)-(Xr(tt.totais?.desconto_geral)||0)+(Xr(tt.totais?.frete)||0)+(Xr(tt.totais?.outras_despesas)||0),H={tipo_pessoa:tt.tipo_pessoa,cpf_cnpj:tt.cpf_cnpj,nome:tt.nome,email:tt.email,telefone:tt.telefone,inscricao_estadual:tt.ie_isento?"ISENTO":tt.inscricao_estadual,logradouro:tt.logradouro,numero:tt.numero,bairro:tt.bairro,cidade:tt.cidade,uf:tt.uf,cep:tt.cep,codigo_municipio_ibge:tt.codigo_municipio_ibge};await re.from("notas_fiscais").update({draft_data:tt,valor_total:Number.isFinite(M)?M:null,destinatario:H,numero:tt.nNF?Number(tt.nNF):null,serie:tt.serie?Number(tt.serie):null}).eq("id",ua).eq("codigo_empresa",t),await Bt(),r({title:"Rascunho salvo"}),Tt(!1)}catch(D){r({title:"Falha ao salvar rascunho",description:D?.message||String(D),variant:"destructive"})}finally{Ht(!1)}},pt=async D=>{if(!D||!t)return null;try{const Q=(s||[]).find(Ce=>Ce.id===D),M=Number(Q?.total||Q?.total_com_desconto||0)||0,{data:H,error:le}=await re.from("notas_fiscais").insert({codigo_empresa:t,origem:"comanda",comanda_id:D,modelo:"55",numero:null,serie:null,status:"rascunho",xml_url:null,pdf_url:null,valor_total:M,destinatario:null}).select("id").single();if(le)throw le;await Bt();const X=H?.id||null;return X&&Oe(X),X}catch(Q){return r({title:"Falha ao criar rascunho",description:Q?.message||String(Q),variant:"destructive"}),null}},Ze=async()=>{if(!t)return null;try{const{data:D,error:Q}=await re.from("notas_fiscais").insert({codigo_empresa:t,origem:"manual",comanda_id:null,modelo:"55",numero:null,serie:null,status:"rascunho",xml_url:null,pdf_url:null,valor_total:null,destinatario:null}).select("id").single();if(Q)throw Q;await Bt();const M=D?.id||null;return M&&Oe(M),jr({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:gn,data_saida:gn,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{tipo:"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:"",parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}),nr(""),Tt(!0),M}catch(D){return r({title:"Falha ao criar rascunho manual",description:D?.message||String(D),variant:"destructive"}),null}},[vt,wt]=p.useState([]),gt=D=>vt.includes(D);p.useEffect(()=>{const D=setTimeout(()=>g(h),300);return()=>clearTimeout(D)},[h]);const[er,_e]=p.useState(!1),[Pt,Lt]=p.useState(!1);p.useEffect(()=>{try{const D=String({}.VITE_MAINTENANCE_MODE||"").toLowerCase()==="true",Q=localStorage.getItem("maintenance:active")==="true",M=localStorage.getItem("maintenance:end"),H=M?new Date>new Date(M):!1,le=(D||Q)&&!H,X=(()=>{try{const Ce=localStorage.getItem("maintenance:bypass")==="1",we=sessionStorage.getItem("maintenance:bypass")==="1",Z=document.cookie.split(";").some(ye=>ye.trim()==="fx_maint_bypass=1");return Ce||we||Z}catch{return!1}})();_e(!1),Lt(!0)}catch{_e(!1),Lt(!0)}},[]);const[gr,fr]=p.useState(!1),[je,nt]=p.useState(!1),[$t,Ut]=p.useState(null),[Fe,xt]=p.useState([]),[Ot,Cr]=p.useState(!1),[Me,Qe]=p.useState(null),[et,Yt]=p.useState(!1),[xr,Jt]=p.useState(!1),[kr,_r]=p.useState({}),[Rr,nn]=p.useState([]),[rn,Ke]=p.useState(!1),[qe,ze]=p.useState(!1),[Je,kt]=p.useState(""),[ct,tr]=p.useState(null),[dt,Mt]=p.useState({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:""}),[ce,Xe]=p.useState(!1),[Qt,Tt]=p.useState(!1),[Ar,nr]=p.useState(""),Jr=new Date,gn=`${Jr.getFullYear()}-${b(Jr.getMonth()+1)}-${b(Jr.getDate())}`,[tt,jr]=p.useState({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:gn,data_saida:gn,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{tipo:"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:"",parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}),[ua,Oe]=p.useState(null),[Wt,Ht]=p.useState(!1);p.useState(!1);const[mr,Gt]=p.useState(!1),[pn,jt]=p.useState(null),[ur,rt]=p.useState("");p.useState(!1);const[Dt,Xt]=p.useState(!1);p.useState(!1);const Tr=p.useMemo(()=>{const D=tt||{},Q=D.itens||[],M=D.pagamentos||[],H=String(D.modelo)==="65",le=!!(D.modelo&&D.serie&&D.natOp&&D.data_emissao&&D.tipo_nota&&D.finNFe),X=Array.isArray(Q)&&Q.length>0,Ce=X&&Q.every(Ne=>{const Re=Ne.impostos||{},bt=Re.icms||{},Rt=Re.pis||{},dr=Re.cofins||{},qt=!!(Re.origem&&(bt.cst||bt.csosn)),rr=Rt.aliquota!==void 0&&String(Rt.aliquota).trim()!=="",qr=dr.aliquota!==void 0&&String(dr.aliquota).trim()!=="";return qt&&rr&&qr}),we=X&&Ce,Z=!!(D.transporte&&D.transporte.tipo_frete);let ye=!0;if(H){const Ne=Q.reduce((rr,qr)=>{const Dn=Xr(qr.preco_unitario)||0,$r=Xr(qr.quantidade)||1,xn=Dn*$r,$n=Xr(qr.desconto_percent)||0,_n=Xr(qr.desconto_valor)||0,un=$n?xn*$n/100:_n,Ca=Xr(qr.acrescimos_valor)||0,Zn=Math.max(0,xn-un+Ca);return rr+Zn},0),Re=Xr(D.totais?.desconto_geral)||0,bt=Xr(D.totais?.frete)||0,Rt=Xr(D.totais?.outras_despesas)||0,dr=Ne-Re+bt+Rt,qt=M.reduce((rr,qr)=>rr+(Xr(qr.valor)||0),0);ye=M.length>0&&qt+.009>=dr}return{identOk:le,produtosOk:we,pagamentosOk:ye,totaisOk:!0,transpOk:Z}},[tt]),[qn,Gr]=p.useState("cliente"),[ar,kn]=p.useState("ident"),[Xn,aa]=p.useState(!1),[pa,te]=p.useState(""),[Te,at]=p.useState(null),[ee,Se]=p.useState([]),[$e,Be]=p.useState(""),[Ge,Ye]=p.useState(null),[ft,yt]=p.useState(!1),[Et,br]=p.useState(null),[Ue,St]=p.useState(null),[Nr,an]=p.useState(null),[Lr,On]=p.useState(""),[Qn,Ta]=p.useState(!1);p.useState(!1);const[zn,Fn]=p.useState("");p.useState("");const[en,Wa]=p.useState([]),[Ya,za]=p.useState("cliente"),[vs,Os]=p.useState([]),[ss,Io]=p.useState(null);p.useState("");const[Vs,ii]=p.useState(!1),[Rl,li]=p.useState(!1),[pl,Fc]=p.useState(""),[mc,ci]=p.useState(null),[Lc,Ks]=p.useState(""),[_o,$c]=p.useState(!0),[gl,_i]=p.useState(!1),[ts,xl]=p.useState(!1),Ba=async({tipo:D,scope:Q,includePdf:M})=>{try{if(!Te){r({title:"Empresa no carregada",variant:"warning"});return}const H=lf(Te),le=H?.ambiente||"homologacao",X=H?.cnpj||"";if(!X){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}xl(!0);let Ce=[];if(D==="nfce"){let qt=[];if(Q==="selected"){const rr=new Set(J);k&&rr.add(k),qt=(s||[]).filter(qr=>rr.has(qr.id))}else qt=vr||[];Ce=qt.map(rr=>({tipo:"nfce",chave:rr.xml_chave,numero:rr.nf_numero,serie:rr.nf_serie,searchkey:rr.xml_protocolo}))}else if(D==="nfe"){let qt=[];if(Q==="selected"){const rr=new Set(J);k&&rr.add(k),qt=(c||[]).filter(qr=>rr.has(qr.id))}else qt=Hr||[];Ce=qt.map(rr=>({tipo:"nfe",chave:rr.xml_chave,numero:rr.numero,serie:rr.serie}))}if(Ce=Ce.filter(qt=>qt.chave||qt.numero&&qt.serie||qt.searchkey),!Ce.length){r({title:"Nada para exportar",description:"Nenhum documento elegvel encontrado.",variant:"warning"});return}const we=qt=>String(qt||"").replace(/[^0-9A-Za-z_-]/g,""),Z=`${D}-${Q}-${we(A)}_a_${we(F)}${M?"-xml-pdf":"-xml"}.zip`,ye=`${re.supabaseUrl}/functions/v1/emissor`,Ne=await fetch(ye,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${re.supabaseKey}`,apikey:re.supabaseKey,Accept:"application/zip"},body:JSON.stringify({acao:"export_zip",ambiente:le,cnpj:X,dados:{items:Ce,includePdf:M,zipName:Z}})});if(!Ne.ok){const qt=await Ne.text();throw new Error(qt||"Falha ao gerar ZIP")}const Re=await Ne.arrayBuffer(),bt=new Blob([Re],{type:"application/zip"}),Rt=URL.createObjectURL(bt),dr=document.createElement("a");dr.href=Rt,dr.download=Z,document.body.appendChild(dr),dr.click(),document.body.removeChild(dr),URL.revokeObjectURL(Rt),r({title:"Exportao iniciada",description:`${Ce.length} documentos adicionados ao ZIP`})}catch(H){r({title:"Falha na exportao",description:H?.message||String(H),variant:"destructive"})}finally{xl(!1)}},Qi=D=>String(D||"").replace(/\D/g,""),Xr=D=>{if(D==null)return 0;let Q=String(D).trim();if(!Q)return 0;const M=Q.includes(","),H=Q.includes(".");M&&H?Q=Q.replace(/\./g,"").replace(",","."):M&&(Q=Q.replace(",","."));const le=Number(Q);return Number.isFinite(le)?le:0},fu=D=>{try{const Q=Xr(D?.totais?.desconto_geral)||0,M=Array.isArray(D?.itens)?D.itens:[];if(!Q||!M.length)return D;const H=M.map(Ne=>{const Re=Xr(Ne.quantidade),bt=Xr(Ne.preco_unitario),Rt=Re*bt,dr=Xr(Ne.desconto_percent),qt=Xr(Ne.desconto_valor),rr=Xr(Ne.acrescimos_valor),qr=Xr(Ne.frete_valor),Dn=Xr(Ne.seguro_valor),$r=dr?Rt*dr/100:qt;return Math.max(0,Rt-$r+rr+qr+Dn)}),le=H.reduce((Ne,Re)=>Ne+Re,0);if(!(le>0))return D;const Ce=H.map(Ne=>Q*(Ne/le)).map(Ne=>Number(Ne.toFixed(2)));let we=Ce.reduce((Ne,Re)=>Ne+Re,0),Z=Number((Q-we).toFixed(2));if(Math.abs(Z)>=.01){const Ne=Ce.length-1;Ce[Ne]=Number((Ce[Ne]+Z).toFixed(2)),we=Ce.reduce((Re,bt)=>Re+bt,0)}const ye=M.map((Ne,Re)=>{const bt=Xr(Ne.desconto_percent),Rt=Xr(Ne.preco_unitario),qt=Xr(Ne.quantidade)*Rt,rr=bt?qt*bt/100:Xr(Ne.desconto_valor),qr=Number((rr+(Ce[Re]||0)).toFixed(2));return{...Ne,desconto_percent:"",desconto_valor:qr.toFixed(2)}});return{...D,itens:ye,totais:{...D?.totais||{},desconto_geral:"0.00"}}}catch{return D}};p.useEffect(()=>{jr(D=>({...D,baixar_estoque:D.tipo_nota!=="entrada"}))},[tt.tipo_nota]),p.useEffect(()=>{za(tt.tipo_nota==="entrada"?"fornecedor":"cliente")},[tt.tipo_nota]),p.useEffect(()=>{jr(D=>({...D,cfop_padrao:zt(D.uf)}))},[tt.tipo_nota,pa,tt.uf]);const vl=p.useRef(tt.cfop_padrao);p.useEffect(()=>{const D=vl.current,Q=tt.cfop_padrao||"";vl.current=Q,!(!_o||!Q)&&jr(M=>{const H=M.itens||[];let le=!1;const X=H.map(Ce=>{const we=String(Ce.cfop||"");return we===""||D&&we===D?(le=!0,{...Ce,cfop:Q}):Ce});return le?{...M,itens:X}:M})},[tt.cfop_padrao,_o]);const Xo=D=>{const Q=String(D||"").replace(/\D/g,""),M=Q?Number(Q)/100:0;return new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(M)},Zi=async(D=null,Q=null)=>{try{const M=D&&typeof D=="object"&&("nativeEvent"in D||"preventDefault"in D||"target"in D),H=!D||M?tt:D,le=H.itens||[];try{console.log("[FiscalHub][emitirNota] start",{modelo:H.modelo,itensLen:Array.isArray(le)?le.length:0})}catch{}if(!Array.isArray(le)||le.length===0){try{console.warn("[FiscalHub][emitirNota] itens ausentes",{form:H})}catch{}r({title:"Sem itens",variant:"warning"});return}if(!Te){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:X,cnpj:Ce}=lf(Te);if(!Ce){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const we=String(H.modelo)==="65",Z=fu(H);let ye=we?Kit({form:Z,finalizadoras:vs||[]}):Xit({form:Z});try{console.log("[FiscalHub][emitirNota] payload gerado (antes do preflight)",{isNFCe:we,Dados:ye})}catch{}if(!we){if((!ye||typeof ye!="object")&&(ye={}),"forma_pagamento"in ye||(ye.forma_pagamento=0),!("meio_pagamento"in ye)||!ye.meio_pagamento){let Yr="99";const Sn=Array.isArray(Z?.pagamentos)?Z.pagamentos[0]:null;if(Sn?.finalizadora_id&&Array.isArray(vs)&&vs.length){const Da=vs.find(Ha=>String(Ha.id)===String(Sn.finalizadora_id));Da?.codigo_sefaz&&(Yr=String(Da.codigo_sefaz).padStart(2,"0"))}ye.meio_pagamento=Yr}else ye.meio_pagamento=String(ye.meio_pagamento).padStart(2,"0");(!ye.natureza_operacao||String(ye.natureza_operacao).trim().length<15)&&(ye.natureza_operacao="Venda de mercadoria");try{const Sn=(Array.isArray(ye.Itens)?ye.Itens:[]).reduce((Da,Ha)=>Da+(Number(Ha?.valor_total_sem_desconto)||0),0);Sn>0&&(ye.valor_total_sem_desconto=Sn.toFixed(2))}catch{}if("numero_destinatario"in ye){const Yr=String(ye.numero_destinatario||"").trim();(!Yr||/^s\/?n$/i.test(Yr))&&(ye.numero_destinatario="0")}let _n=Number(Z?.serie||1)||1;if(Z?.nNF)ye.Numero=Number(Z.nNF),ye.Serie=_n;else try{try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"start",mensagem:`serie=${_n}`})}catch{}const{data:Yr,error:Sn}=await re.rpc("reservar_numero_fiscal",{p_modelo:"55",p_serie:_n,p_codigo_empresa:t});if(Sn)throw Sn;const Da=Number(Yr);jr(Ha=>({...Ha,nNF:String(Da),serie:String(_n)})),ye.Numero=Da,ye.Serie=_n;try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"success",mensagem:`numero=${Da}`})}catch{}}catch(Yr){try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"error",mensagem:Yr?.message||String(Yr)})}catch{}r({title:"Falha ao reservar numerao NF-e",description:Yr?.message||String(Yr),variant:"destructive"});return}try{const Yr=String(Z?.cpf_cnpj||"").replace(/\D/g,""),Sn=String(Z?.inscricao_estadual||"").trim();Yr.length===14?Z?.ie_isento?ye.indicador_ie_destinatario=2:Sn&&Sn.toUpperCase()!=="ISENTO"?ye.indicador_ie_destinatario=1:ye.indicador_ie_destinatario=9:ye.indicador_ie_destinatario=9}catch{}const un=[],Zn=(Yr=>String(Yr||"").replace(/\D/g,""))(Z?.cpf_cnpj);if(Zn||un.push("Informe CPF/CNPJ do destinatrio"),Z?.nome||un.push("Informe o nome/razo social do destinatrio"),Z?.logradouro||un.push("Informe o logradouro do destinatrio"),Z?.bairro||un.push("Informe o bairro do destinatrio"),Z?.cidade||un.push("Informe a cidade do destinatrio"),Z?.uf||un.push("Informe a UF do destinatrio"),Z?.cep||un.push("Informe o CEP do destinatrio"),Z?.codigo_municipio_ibge||un.push("Informe o cdigo IBGE do municpio do destinatrio"),Zn.length===14){const Yr=String(Z?.inscricao_estadual||"").trim();!Z?.ie_isento&&(!Yr||Yr.toUpperCase()==="ISENTO")&&un.push("Informe a IE do destinatrio ou marque ISENTO")}const Mn=Array.isArray(Z?.itens)?Z.itens:[];Mn.length||un.push("Adicione ao menos 1 item"),Mn.forEach((Yr,Sn)=>{const Da=String(Yr?.ncm||"").trim(),Ha=Number((Yr?.quantidade||"").toString().replace(",",".")),Xs=String(Yr?.preco_unitario||"").trim(),jo=String(Yr?.cfop||"").trim(),jn=(Yr?.impostos||{}).icms||{},Pn=(Yr?.impostos||{}).pis||{},Rn=(Yr?.impostos||{}).cofins||{};(!Da||/^0+$/.test(Da))&&un.push(`Item ${Sn+1}: NCM invlido`),jo||un.push(`Item ${Sn+1}: CFOP obrigatrio`),(!Ha||Ha<=0)&&un.push(`Item ${Sn+1}: quantidade invlida`),(Xs===""||Xs==null)&&un.push(`Item ${Sn+1}: preo unitrio obrigatrio`),jn.cst||jn.csosn||un.push(`Item ${Sn+1}: preencha ICMS (CST/CSOSN)`);const va=String(Pn.cst||"").trim(),Ga=String(Rn.cst||"").trim();va==="01"&&String(Pn.aliquota||"").trim()===""&&un.push(`Item ${Sn+1}: preencha alquota de PIS (CST 01)`),Ga==="01"&&String(Rn.aliquota||"").trim()===""&&un.push(`Item ${Sn+1}: preencha alquota de COFINS (CST 01)`)});try{Array.isArray(ye?.Itens)&&(Array.isArray(ye.Itens[0])?ye.Itens[0]=ye.Itens[0].map(Yr=>{const Sn={...Yr},Da=Number(String(Sn.aliquota_pis||"").replace(",","."))||0,Ha=Number(String(Sn.aliquota_cofins||"").replace(",","."))||0;return String(Sn.pis_situacao_tributaria||"").trim()==="01"&&Da<=0&&(Sn.pis_situacao_tributaria="07",Sn.base_calculo_pis="",Sn.aliquota_pis="",Sn.valor_pis=""),String(Sn.cofins_situacao_tributaria||"").trim()==="01"&&Ha<=0&&(Sn.cofins_situacao_tributaria="07",Sn.base_calculo_cofins="",Sn.aliquota_cofins="",Sn.valor_cofins=""),Sn}):ye.Itens=ye.Itens.map(Yr=>{const Sn={...Yr},Da=Number(String(Sn.aliquota_pis||"").replace(",","."))||0,Ha=Number(String(Sn.aliquota_cofins||"").replace(",","."))||0;return String(Sn.pis_situacao_tributaria||"").trim()==="01"&&Da<=0&&(Sn.pis_situacao_tributaria="07",Sn.base_calculo_pis="",Sn.aliquota_pis="",Sn.valor_pis=""),String(Sn.cofins_situacao_tributaria||"").trim()==="01"&&Ha<=0&&(Sn.cofins_situacao_tributaria="07",Sn.base_calculo_cofins="",Sn.aliquota_cofins="",Sn.valor_cofins=""),Sn}))}catch{}if(un.length){r({title:"Faltam dados para emitir NF-e",description:un.slice(0,6).join("  ")+(un.length>6?`  (+${un.length-6} itens)`:""),variant:"destructive"});return}}const Ne=Q??ua;if(Ne&&t)try{await re.from("notas_fiscais").update({status:"processando"}).eq("id",Ne).eq("codigo_empresa",t)}catch{}r({title:"Enviando nota...",description:`Modelo ${H.modelo}`});try{we&&Array.isArray(ye?.Itens)&&!Array.isArray(ye.Itens[0])&&(ye.Itens=[ye.Itens]),console.log("[FiscalHub][emitirNota] payload final (antes do envio)",{Dados:ye})}catch{}let Re,bt=null;try{we?Re=await NV({baseUrl:X,cnpj:Ce,dados:ye}):Re=await Wot({baseUrl:X,cnpj:Ce,dados:ye})}catch(_n){bt=_n}try{console.log("[FiscalHub][emitirNota] resposta envio",{ok:!bt,resp:Re,envioErro:bt})}catch{}if(!bt&&Re&&typeof Re?.status=="string"&&/erro/i.test(Re.status)){const _n=Re?.codigo||Re?.Codigo||"",un=Re?.campo||Re?.Campo||"",Ca=Re?.descricao||Re?.Descricao||Re?.mensagem||Re?.message||"Falha na emisso",Zn=[un,Ca].filter(Boolean).join("  ");r({title:`Erro na emisso${_n?` ${_n}`:""}`,description:Zn,variant:"destructive"});const Mn=Q??ua;if(Mn&&t)try{await re.from("notas_fiscais").update({status:"erro"}).eq("id",Mn).eq("codigo_empresa",t),await Bt()}catch{}return}if(bt){if(!we){const _n=bt?.status?`HTTP ${bt.status}`:"Erro de transporte",un=typeof bt?.response=="string"&&bt.response||bt?.response?.message||bt?.message||"Tentando consultar status";r({title:"Envio com erro",description:`${_n}. ${un}`.trim(),variant:"warning"})}}else r({title:"Envio solicitado",description:"Consultando status..."});const Rt=Re?.chave_nota||Re?.chave||Re?.Chave||"";let dr=null;const qt=_n=>new Promise(un=>setTimeout(un,_n));for(let _n=0;_n<5;_n++){const un=Rt?{chave_nota:Rt,chave:Rt}:{numero:Z?.nNF,serie:Z?.serie};try{we?dr=await ab({baseUrl:X,cnpj:Ce,dados:un}):dr=await Mk({baseUrl:X,cnpj:Ce,dados:un})}catch{}const Ca=String(dr?.status||dr?.cStat||""),Zn=dr?.xMotivo||dr?.mensagem||dr?.message||"";if(Ca==="100"||/autorizad/i.test(Zn))break;await qt(2e3)}let rr=dr?.url_xml||dr?.xml_url||Re?.url_xml||null,qr=dr?.url_pdf||dr?.pdf_url||Re?.url_pdf||null,Dn=Rt||dr?.chave_nota||dr?.chave||dr?.Chave||"";if(!qr||!rr){const _n=Dn?{chave_nota:Dn,chave:Dn}:{numero:Z?.nNF,serie:Z?.serie};try{if(we){const un=await sb({baseUrl:X,cnpj:Ce,dados:_n});qr=qr||un?.url_pdf||un?.pdf_url||null,Dn=Dn||un?.chave||un?.Chave||""}else{const un=await Rk({baseUrl:X,cnpj:Ce,dados:_n});qr=qr||un?.url_pdf||un?.pdf_url||null,Dn=Dn||un?.chave||un?.Chave||""}}catch{}try{if(we){const un=await ob({baseUrl:X,cnpj:Ce,dados:_n});rr=rr||un?.url_xml||un?.xml_url||null,Dn=Dn||un?.chave||un?.Chave||""}else{const un=await Fk({baseUrl:X,cnpj:Ce,dados:_n});rr=rr||un?.url_xml||un?.xml_url||null,Dn=Dn||un?.chave||un?.Chave||""}}catch{}}const $r=String(dr?.status||dr?.cStat||""),xn=dr?.xMotivo||dr?.mensagem||dr?.message||"Status retornado",$n=$r==="100"||/autorizad/i.test(xn);if(r($n?{title:"Autorizada",description:xn,variant:"success"}:$r?{title:`Status: ${$r}`,description:xn,variant:"warning"}:{title:"Consulta retornada",description:xn}),Ne&&t)try{const _n=$n||qr||rr?"autorizada":/rejeit/i.test(xn)?"rejeitada":bt?"processando":"pendente";await re.from("notas_fiscais").update({status:_n,xml_chave:Dn||Rt||null,xml_url:rr||null,pdf_url:qr||null,numero:H?.nNF?Number(H.nNF):null,serie:H?.serie?Number(H.serie):null}).eq("id",Ne).eq("codigo_empresa",t),await Bt()}catch{}}catch(M){r({title:"Falha na emisso",description:M?.message||String(M),variant:"destructive"})}},R=async D=>{try{const Q=D||pl;if(!Q){r({title:"Selecione uma comanda para importar",variant:"warning"});return}const M=await To({comandaId:Q,codigoEmpresa:t});if(!M||!M.length){r({title:"Nenhum item encontrado nesta comanda",variant:"warning"});return}console.log("[FiscalHub][NF-e manual] Itens da comanda para importao:",{comandaId:Q,itens:M});const H=Array.from(new Set((M||[]).map(we=>we.produto_id).filter(Boolean)));let le=[];if(H.length)try{let we=re.from("produtos").select("id, nome, codigo_produto, unidade, ncm, cest, cfop_interno, cfop_externo, cst_icms_interno, csosn_interno, aliquota_icms_interno, cst_pis_saida, aliquota_pis_percent, aliquota_cofins_percent, cst_ipi, aliquota_ipi_percent").in("id",H);t&&(we=we.eq("codigo_empresa",t));const{data:Z}=await we;le=Z||[]}catch{le=[]}console.log("[FiscalHub][NF-e manual] Produtos carregados para os itens da comanda:",{prodIds:H,prods:le});const X=new Map((le||[]).map(we=>[we.id,we])),Ce=(M||[]).map(we=>{const Z=X.get(we.produto_id)||null,ye=Z?.cfop_interno||Z?.cfop_externo||zt(tt.uf),Ne=(Z?.unidade||"UN").toString().toUpperCase(),Re=Number(we.preco_unitario||0)||0,bt=Z?.aliquota_pis_percent,Rt=Z?.aliquota_cofins_percent,dr=Z?.cst_pis_saida||((bt??null)!=null?"01":""),qt=(Rt??null)!=null?"01":"",rr=Number(we.quantidade||1)||1,qr=Re*rr,Dn=qr>0?qr.toFixed(2):"",$r=Ca=>{const Zn=Number(Ca??0);return!Zn||!qr?"":(qr*(Zn/100)).toFixed(2)},xn=$r(Z?.aliquota_icms_interno),$n=$r(bt),_n=$r(Rt),un=$r(Z?.aliquota_ipi_percent);return{descricao:we.descricao||Z?.nome||"Item",codigo:Z?.codigo_produto||"",ncm:Z?.ncm||"",cest:Z?.cest||"",cfop:ye||"5102",unidade:Ne,quantidade:String(rr),preco_unitario:Re.toFixed(2),desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",obs:"",impostos:{origem:"",icms:{cst:Z?.cst_icms_interno||"",csosn:Z?.csosn_interno||"",base:Dn,aliquota:Z?.aliquota_icms_interno!=null?String(Z.aliquota_icms_interno):"",valor:xn},icmsst:{base:"",aliquota:"",valor:""},pis:{cst:dr,aliquota:bt!=null?String(bt):"",valor:$n},cofins:{cst:qt,aliquota:Rt!=null?String(Rt):"",valor:_n},ipi:{cst:Z?.cst_ipi||"",aliquota:Z?.aliquota_ipi_percent!=null?String(Z.aliquota_ipi_percent):"",valor:un},iss:{aliquota:"",valor:""}}}});if(console.log("[FiscalHub][NF-e manual] Itens mapeados para o construtor manual:",Ce),!Ce.length){r({title:"Nenhum item encontrado nesta comanda",variant:"warning"});return}jr(we=>({...we,itens:Ce})),li(!1),r({title:"Itens importados"})}catch(Q){r({title:"Falha ao importar itens",description:Q?.message||"Tente novamente",variant:"destructive"})}},pe=async D=>{if(console.log("[FiscalHub][NF-e manual] openManualFromComanda called with id:",D),!D){r({title:"Selecione uma comanda",variant:"warning"});return}const Q=(s||[]).find(M=>M.id===D);console.log("[FiscalHub][NF-e manual] Comanda selecionada para NF-e:",Q),Gr("cliente"),Tt(!0),jr(()=>{const M=new Date,H=`${M.getFullYear()}-${b(M.getMonth()+1)}-${b(M.getDate())}`,le=Number(Q?.total||0)||0,X=(Q?.finalizadorasStr||"").trim(),Ce=(vs||[]).find(we=>{const Z=(we?.nome||"").trim().toLowerCase(),ye=X.toLowerCase();return!Z||!ye?!1:ye===Z||ye.startsWith(Z)||Z.startsWith(ye)});return{natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:H,data_saida:H,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{finalizadora_id:Ce?.id||"",tipo:Ce?.nome||Q?.finalizadorasStr||"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:Xo(le.toFixed(2)),parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}});try{const M=(Q?.clientesStr||"").split(",")[0].trim();if(M&&t){const{data:H}=await re.from("clientes").select("*").eq("codigo_empresa",t).ilike("nome",M).limit(1).single();H&&(console.log("[FiscalHub][NF-e manual] Cliente principal encontrado para pr-preenchimento do destinatrio:",H),ke(H))}}catch(M){console.warn("[FiscalHub][NF-e manual] Falha ao pr-preencher destinatrio a partir da comanda:",M)}Fc(String(D)),console.log("[FiscalHub][NF-e manual] Preparando importao de itens da comanda para NF-e, comandaId=",String(D));try{await R(String(D))}catch(M){console.error("[FiscalHub][NF-e manual] Erro ao importar itens da comanda para NF-e:",M)}},He=Array.isArray(DV)?DV:[];p.useEffect(()=>{let D=!1;async function Q(){if(t)try{const{data:M}=await re.from("empresas").select("uf").eq("codigo_empresa",t).single();D||te(M?.uf||"")}catch{}}return Q(),()=>{D=!0}},[t]),p.useEffect(()=>{let D=!1;async function Q(){if(t)try{const{data:M}=await re.from("empresas").select("razao_social, nome_fantasia, cnpj, inscricao_estadual, regime_tributario, endereco, logradouro, numero, bairro, cidade, uf, cep, codigo_municipio_ibge, nfe_serie, nfce_serie, ambiente, transmitenota_apikey, transmitenota_base_url, transmitenota_apikey_hml, transmitenota_base_url_hml, transmitenota_apikey_prod, transmitenota_base_url_prod").eq("codigo_empresa",t).single();D||at(M||null)}catch{D||at(null)}}return Q(),()=>{D=!0}},[t]),p.useEffect(()=>{Te&&jr(D=>{const Q=D.modelo==="65"?Te.nfce_serie||D.serie:Te.nfe_serie||D.serie,M=String(Q||D.serie||"1");return String(D.serie||"")===M?D:{...D,serie:M}})},[Te,tt.modelo]),p.useEffect(()=>{let D=!0;async function Q(){if(!(!Qt||!t))try{const M=await Hu({includeInactive:!1,codigoEmpresa:t});D&&Se(M||[])}catch{D&&Se([])}}return Q(),()=>{D=!1}},[Qt,t]);const mt=p.useMemo(()=>{const D=($e||"").trim().toLowerCase(),Q=(ee||[]).slice().sort((M,H)=>{const le=Number(String(M.code||0).replace(/\D/g,""))||0,X=Number(String(H.code||0).replace(/\D/g,""))||0;return le-X});return D?Q.filter(M=>(M.name||"").toLowerCase().includes(D)||(M.code||"").toLowerCase().includes(D)).slice(0,100):Q.slice(0,100)},[ee,$e]),zt=(D,Q=tt.tipo_nota)=>{const M=String(pa||"").toUpperCase(),H=String(D||"").toUpperCase(),X=!!M&&!!H?H===M:!0;return Q!=="entrada"?X?"5102":"6102":X?"1102":"2102"},Dr=D=>{const M=(He.find(H=>H.code===D)?.desc||"").toLowerCase();return tt.tipo_nota==="entrada"&&(M.includes("compra")||M.includes("entrada"))?"COMPRA":M.includes("venda")?"VENDA":M.includes("devolu")?"DEVOLUCAO":M.includes("transfer")?"TRANSFERENCIA":M.includes("bonifica")?"BONIFICACAO":M.includes("remessa")?"REMESSA":M.includes("demonstra")?"DEMONSTRACAO":tt.natOp||"VENDA"},Qr=(D,Q)=>{jr(M=>{const H=[...M.itens],le=Q?.cfopInterno||Q?.cfopExterno||zt(M.uf),X=Number(Q?.price??Q?.salePrice??0)||0,Ce=String(M.uf||"").toUpperCase()===String(pa||"").toUpperCase(),we=Ce?Q?.cstIcmsInterno||"":Q?.cstIcmsExterno||"",Z=Ce?Q?.csosnInterno||"":Q?.csosnExterno||"",ye=Ce?Q?.aliqIcmsInterno??null:Q?.aliqIcmsExterno??null,Ne=Q?.cstPisSaida||((Q?.aliqPisPercent??null)!=null?"01":""),Re=Q?.aliqPisPercent??null,bt=(Q?.aliqCofinsPercent??null)!=null?"01":"",Rt=Q?.aliqCofinsPercent??null,dr=Q?.cstIpi||"",qt=Q?.aliqIpiPercent??null;H[D]={...H[D],descricao:Q?.name||H[D].descricao,codigo:Q?.code||H[D].codigo,cod_barras:Q?.barcode||Q?.ean||Q?.gtin||Q?.bar_code||H[D].cod_barras,unidade:(Q?.unit||"UN").toString().toUpperCase(),ncm:Q?.ncm||H[D].ncm,cest:Q?.cest||H[D].cest,cfop:le||H[D].cfop,preco_unitario:X?X.toFixed(2):H[D].preco_unitario,impostos:{...H[D].impostos||{},icms:{...H[D].impostos?.icms||{},cst:we||H[D].impostos?.icms?.cst||"",csosn:Z||H[D].impostos?.icms?.csosn||"",aliquota:ye!=null?String(ye):H[D].impostos?.icms?.aliquota||""},pis:{...H[D].impostos?.pis||{},cst:Ne||H[D].impostos?.pis?.cst||"",aliquota:Re!=null?String(Re):H[D].impostos?.pis?.aliquota||""},cofins:{...H[D].impostos?.cofins||{},cst:bt||H[D].impostos?.cofins?.cst||"",aliquota:Rt!=null?String(Rt):H[D].impostos?.cofins?.aliquota||""},ipi:{...H[D].impostos?.ipi||{},cst:dr||H[D].impostos?.ipi?.cst||"",aliquota:qt!=null?String(qt):H[D].impostos?.ipi?.aliquota||""}}};const rr=Dr(le||H[D].cfop);return{...M,itens:H,natOp:rr}}),Ye(null)};p.useEffect(()=>{let D=!0;async function Q(){if(!(!Qn&&!Qt||!t))try{const[M,H]=await Promise.all([Yb({searchTerm:null,limit:200,codigoEmpresa:t}),Cst(t)]),le=[...M||[],...H||[]];D&&Wa(le)}catch{D&&Wa([])}}return Q(),()=>{D=!1}},[Qn,Qt,t]),p.useEffect(()=>{Qn&&Fn("")},[Qn]);const de=p.useMemo(()=>{const D=(zn||"").trim().toLowerCase(),Q=(en||[]).slice().sort((M,H)=>{const le=Number(String(M.codigo||M.codigo_cliente||M.codigo_fornecedor||M.code||0).replace(/\D/g,""))||0,X=Number(String(H.codigo||H.codigo_cliente||H.codigo_fornecedor||H.code||0).replace(/\D/g,""))||0;return le-X});return D?Q.filter(M=>{const H=String(M.codigo||M.codigo_cliente||M.codigo_fornecedor||M.code||"").toLowerCase(),le=String(M.nome||M.razao_social||M.apelido||"").toLowerCase(),X=String(M.cnpj||M.cpf||"").toLowerCase();return H.includes(D)||le.includes(D)||X.includes(D)}):Q},[en,zn]),ke=D=>{if(!D)return;const Q=(D.tipo_pessoa||"PJ")==="PJ"||!!D.cnpj;jr(M=>({...M,parte_tipo:D.is_fornecedor?"fornecedor":"cliente",party_id:D.id||"",party_codigo:String(D.codigo||D.codigo_cliente||D.codigo_fornecedor||D.code||""),tipo_pessoa:Q?"PJ":"PF",cpf_cnpj:(D.cnpj||D.cpf||"").toString(),nome:D.nome||D.razao_social||D.apelido||"",email:D.email||"",telefone:D.telefone||"",logradouro:D.endereco||D.logradouro||"",numero:D.numero||"",bairro:D.bairro||"",cidade:D.cidade||"",uf:D.uf||"",cep:D.cep||"",codigo_municipio_ibge:D.cidade_ibge||D.codigo_municipio_ibge||"",inscricao_estadual:D.ie||D.inscricao_estadual||"",ie_isento:D.ie==="ISENTO"||!1})),Ta(!1)};p.useEffect(()=>{let D=!0;async function Q(){if(!(!Qt||ar!=="pagamentos"))try{const M=await Ah({somenteAtivas:!0,codigoEmpresa:t});D&&Os(Array.isArray(M)?M:[])}catch{D&&Os([])}}return Q(),()=>{D=!1}},[Qt,ar,t]);const st=async D=>{const Q=Qi(D);if(Q.length===8)try{aa(!0);let M=null;try{const H=await fetch(`https://brasilapi.com.br/api/cep/v2/${Q}`);H.ok&&(M=await H.json())}catch{}if(!M)try{const H=await fetch(`https://viacep.com.br/ws/${Q}/json/`);H.ok&&(M=await H.json())}catch{}if(M){const H=M.street||M.logradouro||"",le=M.neighborhood||M.bairro||"",X=M.city||M.localidade||"",Ce=(M.state||M.uf||"").toString().toUpperCase().slice(0,2),we=M.city_ibge_code||M.ibge||"";jr(Z=>({...Z,logradouro:H||Z.logradouro,bairro:le||Z.bairro,cidade:X||Z.cidade,uf:Ce||Z.uf,codigo_municipio_ibge:we||Z.codigo_municipio_ibge}))}}finally{aa(!1)}},ot=()=>{try{const D=localStorage.getItem("auth:userProfile");return D&&JSON.parse(D)?.codigo_empresa||null}catch{return null}},Nt=()=>{let D=null,Q=null;if(A&&(D=new Date(A+"T00:00:00").toISOString()),F){const M=new Date(F+"T00:00:00");M.setDate(M.getDate()+1),Q=M.toISOString()}return{fromISO:D,toISOExclusive:Q}},or=async()=>{if(t){l(!0);try{let D=re.from("comandas").select("*").eq("codigo_empresa",t).not("fechado_em","is",null).neq("status","cancelled").order("aberto_em",{ascending:!1}).limit(300);const{fromISO:Q,toISOExclusive:M}=Nt();Q&&(D=D.gte("aberto_em",Q)),M&&(D=D.lt("aberto_em",M));const{data:H,error:le}=await D;if(le)throw le;const X=H||[],Ce=X.map(Rt=>Rt.id);let we={};if(Ce.length)try{we=await VS(Ce,t)}catch{we={}}let Z=[];try{Z=await Ph(t)}catch{Z=[]}const ye=new Map((Z||[]).map(Rt=>[Rt.id,Rt.numero]));let Ne={},Re={};try{Ne=await c3(Ce)}catch{Ne={}}try{Re=await d3(Ce)}catch{Re={}}const bt=X.map(Rt=>({...Rt,total:Number(we[Rt.id]||0),mesaNumero:ye.get(Rt.mesa_id),clientesStr:Array.isArray(Ne[Rt.id])?Ne[Rt.id].join(", "):Ne[Rt.id]||"",finalizadorasStr:Array.isArray(Re[Rt.id])?Re[Rt.id].join(", "):Re[Rt.id]||""}));o(bt)}catch(D){r({title:"Erro ao carregar",description:D.message,variant:"destructive"})}finally{l(!1)}}};p.useEffect(()=>{or()},[t,A,F]);const Bt=async()=>{if(t){f(!0);try{let D=re.from("notas_fiscais").select("*").eq("codigo_empresa",t).eq("modelo","55").order("id",{ascending:!1});const{data:Q,error:M}=await D;if(M)throw M;d(Q||[])}catch(D){r({title:"Erro ao carregar NF-e",description:D.message,variant:"destructive"})}finally{f(!1)}}};p.useEffect(()=>{Bt()},[t]),p.useEffect(()=>{let D=!1;async function Q(){if(t)try{const{data:M}=await re.from("empresas").select("cnpj, inscricao_estadual, regime_tributario, cidade, uf, codigo_municipio_ibge, nfce_serie, nfce_itoken, ambiente, transmitenota_apikey, transmitenota_base_url, transmitenota_apikey_hml, transmitenota_base_url_hml, transmitenota_apikey_prod, transmitenota_base_url_prod").eq("codigo_empresa",t).single();if(D)return;const H=[],le=Ce=>String(Ce||"").replace(/\D/g,"");(!le(M?.cnpj)||le(M?.cnpj).length!==14)&&H.push("CNPJ"),M?.inscricao_estadual||H.push("Inscrio Estadual"),M?.regime_tributario||H.push("CRT"),(!M?.cidade||!M?.uf)&&H.push("Cidade/UF"),M?.codigo_municipio_ibge||H.push("cMun IBGE"),M?.nfce_serie||H.push("Srie NFC-e"),String(M?.ambiente||"homologacao")==="producao"&&!M?.nfce_itoken&&H.push("CSC/IToken"),nn(H)}catch{}}return Q(),()=>{D=!0}},[t]),p.useEffect(()=>{if(!t)return;const D=setInterval(()=>{or()},2e4);return()=>clearInterval(D)},[t,A,F]);const vr=p.useMemo(()=>{const D=(x||"").trim().toLowerCase(),Q=M=>{const H=M.nf_status||"pendente";return I?H==="pendente"||H==="rejeitada":y==="all"?!0:H===y};return(s||[]).filter(M=>Q(M)).filter(M=>{if(!D)return!0;const H=String(M.mesaNumero||""),le=String(M.clientesStr||""),X=String(M.finalizadorasStr||"");return(M.xml_chave||"").toLowerCase().includes(D)||String(M.nf_numero||"").includes(D)||H.toLowerCase().includes(D)||le.toLowerCase().includes(D)||X.toLowerCase().includes(D)})},[s,x,y,I]),yr=p.useMemo(()=>{const D=(x||"").trim().toLowerCase();return(c||[]).filter(Q=>{const M=(Q.status||"pendente").toLowerCase();if(I&&!["pendente","rejeitada","rascunho"].includes(M))return!1;if(y!=="all"){if(y==="pendente"){if(!["pendente","rascunho"].includes(M))return!1}else if(y==="processando"){if(M!=="processando")return!1}else if(y==="autorizada"){if(!["autorizada","emitida"].includes(M))return!1}else if(y==="rejeitada"){if(M!=="rejeitada")return!1}else if(y==="cancelada"&&M!=="cancelada")return!1}if(A||F){const Z=Q.data_emissao||Q.criado_em||Q.created_at||null;if(Z){const ye=new Date(Z);if(A){const Ne=new Date(A+"T00:00:00");if(ye<Ne)return!1}if(F){const Ne=new Date(F+"T23:59:59.999");if(ye>Ne)return!1}}}if(!D)return!0;const H=String(Q.numero??"").toLowerCase(),le=String(Q.serie??"").toLowerCase(),X=String(Q.destinatario?.nome||"").toLowerCase(),we=(Q.origem==="comanda"?`comanda ${Q.comanda_id??""}`:"manual").toLowerCase();return H.includes(D)||le.includes(D)||X.includes(D)||we.includes(D)})},[c,x,y,I,A,F]),It=p.useMemo(()=>{const D=[...vr||[]],Q=ge==="asc"?1:-1;return D.sort((M,H)=>{const le=Ce=>Ce==null?"":String(Ce).toLowerCase(),X=Ce=>Ce==null?0:Number(Ce)||0;return L==="aberto_em"?(new Date(M.aberto_em).getTime()-new Date(H.aberto_em).getTime())*Q:L==="nf_status"?le(M.nf_status).localeCompare(le(H.nf_status))*Q:L==="mesa"?(X(M.mesaNumero)-X(H.mesaNumero))*Q:L==="nf_numero"?(X(M.nf_numero)-X(H.nf_numero))*Q:L==="total"?(Number(M.total||M.total_com_desconto||0)-Number(H.total||H.total_com_desconto||0))*Q:0})},[vr,L,ge]),Hr=p.useMemo(()=>[...yr||[]].sort((Q,M)=>{const H=Q.data_emissao||Q.criado_em||Q.created_at||null,le=M.data_emissao||M.criado_em||M.created_at||null,X=H?new Date(H).getTime():0;return(le?new Date(le).getTime():0)-X}),[yr]),Vr=Math.max(1,Math.ceil((It||[]).length/Y));p.useEffect(()=>{V>Vr&&$(Vr)},[Vr]);const pr=p.useMemo(()=>{const D=(V-1)*Y;return(It||[]).slice(D,D+Y)},[It,V,Y]),ln=p.useMemo(()=>{const D=(V-1)*Y;return(Hr||[]).slice(D,D+Y)},[Hr,V,Y]),hr=p.useMemo(()=>!pr||pr.length===0?!1:pr.every(D=>J.includes(D.id)),[pr,J]),Zr=D=>{G(Q=>{if(D){const H=(pr||[]).map(le=>le.id);return Array.from(new Set([...Q||[],...H]))}const M=new Set((pr||[]).map(H=>H.id));return(Q||[]).filter(H=>!M.has(H))})},Pr=D=>{B(D),wt(Q=>Q.includes(D)?Q.filter(M=>M!==D):[...Q,D])},cr=p.useMemo(()=>(s||[]).filter(D=>J.includes(D.id)),[s,J]),Mr=p.useMemo(()=>cr.filter(D=>["pendente","rejeitada"].includes(D.nf_status||"pendente")).map(D=>D.id),[cr]),bn=p.useMemo(()=>cr.filter(D=>["processando","rejeitada","pendente","erro"].includes(String(D.nf_status||"").toLowerCase())).map(D=>D.id),[cr]),ca=p.useMemo(()=>cr.filter(D=>(D.nf_status||"")==="autorizada").map(D=>D.id),[cr]),os=async()=>{if(!Mr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}const D=J.length-Mr.length,Q=`Emitindo ${Mr.length} NFC-e elegveis${D>0?` (ignorando ${D} no elegveis)`:""}...`;r({title:"Emisso de NFC-e",description:Q});for(const M of Mr)await wn(M)},ys=async()=>{if(!bn.length){r({title:"Nenhum elegvel",description:"Selecione notas para consultar.",variant:"destructive"});return}const D=J.length-bn.length,Q=`Consultando ${bn.length} NFC-e${D>0?` (ignorando ${D})`:""}...`;r({title:"Consulta de NFC-e",description:Q});for(const M of bn)await wr(M)},cn=async()=>{if(!ca.length){r({title:"Nenhum elegvel",description:"Selecione NFC-e autorizadas para cancelar.",variant:"destructive"});return}const D=ca[0];ci(D),Ks("")},Kr=()=>{const D=";",Q=we=>{let Z=String(we??"");return Z=Z.replaceAll('"','""'),Z=Z.replaceAll(";","|"),`"${Z}"`},H=[["ComandaID","Mesa","Clientes","Finalizadoras","StatusNF","Numero","Serie","Chave","AutorizadoEm","CanceladoEm","Total"].join(D)];(vr||[]).forEach(we=>{const Z=[we.id,we.mesaNumero??"",we.clientesStr||"",we.finalizadorasStr||"",we.nf_status??"",we.nf_numero??"",we.nf_serie??"",we.xml_chave??"",we.nf_autorizado_em??"",we.nf_cancelado_em??"",String(we.total??"")];H.push(Z.map(Q).join(D))});const le=new Blob(["\uFEFF"+H.join(`\r
`)],{type:"text/csv;charset=utf-8;"}),X=URL.createObjectURL(le),Ce=document.createElement("a");Ce.href=X,Ce.download=`central-fiscal-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(Ce),Ce.click(),document.body.removeChild(Ce),URL.revokeObjectURL(X)},tn=D=>{const Q=(D||"pendente").toLowerCase(),M={rascunho:"bg-gray-500/15 text-gray-300 border border-gray-400/30",pendente:"bg-amber-500/15 text-amber-400 border border-amber-400/30",processando:"bg-blue-500/15 text-blue-400 border border-blue-400/30",autorizada:"bg-emerald-500/15 text-emerald-400 border border-emerald-400/30",rejeitada:"bg-red-500/15 text-red-400 border border-red-400/30",cancelada:"bg-violet-500/15 text-violet-400 border border-violet-400/30"};return M[Q]||M.pendente},An=async D=>{try{nt(!0),Qe(D);const Q=t||ot(),{empresa:M,payload:H,missing:le}=await tv({comandaId:D,codigoEmpresa:Q});Ut(H),xt(le||[]);try{const X=lf(M||{}),Ce=!!X&&(X.cnpj||"").length===14&&!!X.apiKey&&!!X.baseUrl;Yt(Ce),Jt(Ce&&(!le||le.length===0))}catch{Yt(!1),Jt(!1)}_r(X=>({...X,[D]:(le||[]).length})),fr(!0)}catch(Q){r({title:"Falha ao gerar prvia",description:Q.message,variant:"destructive"})}finally{nt(!1)}},dn=async(D,Q)=>{await re.from("comandas").update(Q).eq("id",D).eq("codigo_empresa",t)},Yn=async()=>{if(ct)try{ze(!0);const D=Number(dt.serie||1)||1;let Q=null;try{try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ct,status:"start",mensagem:`serie=${D}`})}catch{}const{data:le,error:X}=await re.rpc("reservar_numero_fiscal",{p_modelo:"55",p_serie:D,p_codigo_empresa:t});if(X)throw X;Q=Number(le);try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ct,status:"success",mensagem:`numero=${Q}`})}catch{}}catch(le){try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ct,status:"error",mensagem:le?.message||String(le)})}catch{}r({title:"Falha ao reservar numerao NF-e",description:le?.message||String(le),variant:"destructive"}),ze(!1);return}Mt(le=>({...le,nNF:String(Q),serie:String(D)}));const M={...dt,nNF:String(Q),serie:String(D),idDest:dt.idDest==="auto"||!dt.idDest?void 0:dt.idDest};try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ct,status:"start",request:M})}catch{}const H=await elt({comandaId:ct,codigoEmpresa:t,modelo:"55",overrides:M});kt(H);try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ct,status:"success"})}catch{}r({title:"XML NF-e gerado"})}catch(D){try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ct,status:"error",mensagem:D?.message||String(D)})}catch{}r({title:"Falha ao gerar XML",description:D.message,variant:"destructive"})}finally{ze(!1)}},Ir=async()=>{if(!(!Je||!ct))try{Xe(!0);try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ct,status:"start"})}catch{}const D=`nfe/${t}/${ct}-${Date.now()}.xml`,Q=new Blob([Je],{type:"text/xml;charset=utf-8"}),{error:M}=await re.storage.from("fiscal").upload(D,Q,{contentType:"text/xml"});if(M)throw M;const{data:H}=await re.storage.from("fiscal").getPublicUrl(D),le=H?.publicUrl||null;await re.from("comandas").update({nf_xml_url:le||D,nf_status:"pendente"}).eq("id",ct).eq("codigo_empresa",t);try{const X=s.find(we=>we.id===ct),Ce=Number(X?.total||0);await re.from("notas_fiscais").insert({codigo_empresa:t,origem:"comanda",comanda_id:ct,modelo:"55",numero:dt.nNF?Number(dt.nNF):null,serie:dt.serie?Number(dt.serie):null,status:"pendente",xml_url:le||D,pdf_url:null,valor_total:isFinite(Ce)?Ce:null,destinatario:null})}catch{}try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ct,status:"success"})}catch{}r({title:"XML salvo",description:le?"Link pblico gerado.":"Arquivo salvo no Storage."}),await or()}catch(D){try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ct,status:"error",mensagem:D?.message||String(D)})}catch{}r({title:"Falha ao salvar XML",description:D.message,variant:"destructive"})}finally{Xe(!1)}},wn=async D=>{try{l(!0);const{empresa:Q,payload:M,missing:H}=await tv({comandaId:D,codigoEmpresa:t});if(H&&H.length){r({title:"Pendncias para emisso",description:H.join(", "),variant:"destructive"});return}try{const rr=s.find($n=>$n.id===D),qr=rr&&(rr.nf_status==="erro"||rr.nf_status==="rejeitada"),Dn=!rr?.xml_chave,$r=!rr?.nf_numero,xn=!rr?.nf_serie;rr&&qr&&Dn&&$r&&xn&&await dn(D,{nf_status:null,nf_modelo:null,nf_serie:null,nf_numero:null,nf_protocolo:null,xml_chave:null,nf_xml_url:null,nf_pdf_url:null,xml_protocolo:null})}catch{}try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"start",request:M?.Dados||null})}catch{}const le=lf(Q);if(!le.cnpj||le.cnpj.length!==14){r({title:"CNPJ invlido",description:"CNPJ da empresa est ausente ou invlido (14 dgitos).",variant:"destructive"});return}const X=Number(Q?.nfce_serie||Q?.nfe_serie||1)||1;let Ce=null;try{const{data:rr,error:qr}=await re.rpc("reservar_numero_fiscal",{p_modelo:"65",p_serie:X,p_codigo_empresa:t});if(qr)throw qr;Ce=Number(rr)}catch(rr){r({title:"Falha ao reservar numerao",description:rr?.message||String(rr),variant:"destructive"});return}await dn(D,{nf_numero:Ce,nf_serie:X});try{M&&M.Dados&&(M.Dados.Numero=Ce,M.Dados.Serie=X)}catch{}await dn(D,{nf_status:"processando"});let we;try{we=await NV({baseUrl:le.baseUrl,cnpj:le.cnpj,dados:M.Dados}),console.log("[FiscalHub][NFC-e emitir] resposta completa:",we)}catch(rr){console.error("[FiscalHub][NFC-e emitir] erro ao enviar NFC-e:",rr),await dn(D,{nf_status:"processando"});try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"error",mensagem:rr?.message||String(rr)})}catch{}try{const qr=s.find(Yr=>Yr.id===D)||{};let Dn=qr.xml_protocolo||null,$r=null;if(Dn)$r=await ab({baseUrl:le.baseUrl,cnpj:le.cnpj,dados:{searchkey:Dn,SearchKey:Dn}});else{const Yr=qr.nf_numero||Ce,Sn=qr.nf_serie||X,Da=Yr&&Sn?{numero:Yr,Numero:Yr,serie:Sn,Serie:Sn}:qr.xml_chave?{chave:qr.xml_chave,Chave:qr.xml_chave}:{};$r=await ab({baseUrl:le.baseUrl,cnpj:le.cnpj,dados:Da});const Ha=$r?.searchkey||$r?.SearchKey||$r?.searchKey||null;Ha&&(Dn=Ha,await dn(D,{xml_protocolo:Ha}))}const xn=String($r?.status||$r?.Status||$r?.cStat||"").toLowerCase();if(!!($r?.autorizada||$r?.Autorizada||$r?.sucesso||$r?.Sucesso||xn==="100")){const Yr=$r?.chave||$r?.Chave||qr.xml_chave||null,Sn=$r?.pdf_url||$r?.PdfUrl||null,Da=$r?.xml_url||$r?.XmlUrl||null,Ha=$r?.numero||$r?.Numero||qr.nf_numero||null,Xs=$r?.serie||$r?.Serie||qr.nf_serie||null;await dn(D,{nf_status:"autorizada",xml_chave:Yr,nf_pdf_url:Sn,nf_xml_url:Da,nf_numero:Ha,nf_serie:Xs});try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"success",response:$r||null})}catch{}r({title:"NFC-e autorizada",description:"Documento autorizado aps fallback de consulta.",variant:"success"}),await or();return}const _n=qr.nf_numero||Ce,un=qr.nf_serie||X;let Ca=null,Zn=null,Mn=qr.xml_chave||null;if(Dn){try{const Yr=await sb({baseUrl:le.baseUrl,cnpj:le.cnpj,dados:{searchkey:Dn,SearchKey:Dn}});console.log("[FiscalHub][NFC-e emitir->PDF fallback] resp:",Yr),Ca=Yr?.pdf_url||Yr?.PdfUrl||null,Mn=Yr?.chave||Yr?.Chave||Mn}catch{}try{const Yr=await ob({baseUrl:le.baseUrl,cnpj:le.cnpj,dados:{searchkey:Dn,SearchKey:Dn}});console.log("[FiscalHub][NFC-e emitir->XML fallback] resp:",Yr),Zn=Yr?.xml_url||Yr?.XmlUrl||null,Mn=Mn||Yr?.chave||Yr?.Chave||Mn}catch{}}else{try{const Yr=await sb({baseUrl:le.baseUrl,cnpj:le.cnpj,dados:{numero:_n,Numero:_n,serie:un,Serie:un}});console.log("[FiscalHub][NFC-e emitir->PDF fallback] resp:",Yr),Ca=Yr?.pdf_url||Yr?.PdfUrl||null,Mn=Yr?.chave||Yr?.Chave||Mn}catch{}try{const Yr=await ob({baseUrl:le.baseUrl,cnpj:le.cnpj,dados:{numero:_n,Numero:_n,serie:un,Serie:un}});console.log("[FiscalHub][NFC-e emitir->XML fallback] resp:",Yr),Zn=Yr?.xml_url||Yr?.XmlUrl||null,Mn=Mn||Yr?.chave||Yr?.Chave||Mn}catch{}}if(Ca||Zn||Mn){await dn(D,{nf_status:Ca||Zn?"autorizada":"processando",nf_pdf_url:Ca||qr.nf_pdf_url,nf_xml_url:Zn||qr.nf_xml_url,xml_chave:Mn||qr.xml_chave,nf_numero:_n,nf_serie:un}),Ca&&(r({title:"NFC-e autorizada",description:"DANFE encontrada (fallback).",variant:"success"}),window.open(Ca,"_blank")),await or();return}}catch{}throw rr}const Z=we?.chave||we?.Chave||we?.chaveAcesso||null,ye=we?.numero||we?.Numero||null,Ne=we?.serie||we?.Serie||null,Re=we?.pdf_url||we?.PdfUrl||null,bt=we?.xml_url||we?.XmlUrl||null,Rt=we?.protocolo||we?.Protocolo||null,dr=we?.searchkey||we?.SearchKey||we?.searchKey||null,qt=!!(we?.autorizada||we?.Autorizada||we?.sucesso||we?.Sucesso||Z);await dn(D,{nf_status:qt?"autorizada":"processando",xml_chave:Z,nf_numero:ye,nf_serie:Ne,nf_pdf_url:Re,nf_xml_url:bt,xml_protocolo:Rt||dr});try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"success",response:we||null})}catch{}r({title:qt?"NFC-e autorizada":"Emisso enviada",description:qt?"Documento autorizado.":"Aguardando autorizao."}),await or()}catch(Q){r({title:"Falha ao emitir",description:Q.message,variant:"destructive"})}finally{l(!1)}},wr=async D=>{try{l(!0);const Q=s.find(qt=>qt.id===D);if(!Q)return;const{empresa:M}=await tv({comandaId:D,codigoEmpresa:t}),H=lf(M);try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"start",request:Q.xml_protocolo?{searchkey:Q.xml_protocolo}:{numero:Q.nf_numero,serie:Q.nf_serie}})}catch{}let le=null,X=!1,Ce="",we="Consulta retornada",Z=Q.nf_pdf_url,ye=Q.nf_xml_url,Ne=Q.xml_chave,Re=Q.nf_numero,bt=Q.nf_serie;const Rt=!!Q.xml_protocolo;if(Rt)try{le=await ab({baseUrl:H.baseUrl,cnpj:H.cnpj,dados:{SearchKey:Q.xml_protocolo,searchkey:Q.xml_protocolo}}),console.log("[FiscalHub][NFC-e consulta] resposta completa:",le),Ce=String(le?.status||le?.Status||le?.cStat||"").toLowerCase(),we=le?.xMotivo||le?.mensagem||le?.message||we,X=!!(le?.autorizada||le?.Autorizada||le?.sucesso||le?.Sucesso||Ce==="100"),Z=le?.pdf_url||le?.PdfUrl||Z,ye=le?.xml_url||le?.XmlUrl||ye,Ne=le?.chave||le?.Chave||Ne,Re=le?.numero||le?.Numero||Re,bt=le?.serie||le?.Serie||bt}catch(qt){console.warn("[FiscalHub][NFC-e consulta] consulta por SearchKey falhou, tentando PDF/XML direto",qt)}if(!Z&&!ye){const qt=Rt?{searchkey:Q.xml_protocolo||"",SearchKey:Q.xml_protocolo||""}:{numero:Re,Numero:Re,serie:bt,Serie:bt};try{const rr=await sb({baseUrl:H.baseUrl,cnpj:H.cnpj,dados:qt});console.log("[FiscalHub][NFC-e consulta] PDF resp:",rr),Z=rr?.pdf_url||rr?.PdfUrl||Z,Ne=rr?.chave||rr?.Chave||Ne}catch(rr){console.warn("[FiscalHub][NFC-e consulta] PDF erro:",rr)}try{const rr=await ob({baseUrl:H.baseUrl,cnpj:H.cnpj,dados:qt});console.log("[FiscalHub][NFC-e consulta] XML resp:",rr),ye=rr?.xml_url||rr?.XmlUrl||ye,Ne=Ne||rr?.chave||rr?.Chave||Ne}catch(rr){console.warn("[FiscalHub][NFC-e consulta] XML erro:",rr)}X=!!(Z||ye||X),Ce=X?"100":Q.nf_status||"pendente",we=X?"Documento localizado":we}let dr=Q.nf_status||"processando";X?dr="autorizada":Ce&&Ce.includes&&Ce.includes("rejeit")?dr="rejeitada":Ce==="erro"?dr=Q.nf_status||"pendente":typeof Ce=="string"&&Ce&&(dr=Ce),await dn(D,{nf_status:dr,nf_pdf_url:Z,nf_xml_url:ye,xml_chave:Ne,nf_numero:Re,nf_serie:bt});try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"success",response:le||null})}catch{}r({title:X?"NFC-e autorizada":`Status: ${Ce||dr}`,description:we,variant:X?"success":"warning"}),await or()}catch(Q){r({title:"Falha ao consultar",description:Q.message,variant:"destructive"})}finally{l(!1)}},Wr=async(D,Q)=>{try{const M=(Q||"").trim();if(!M){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}l(!0);const{empresa:H}=await tv({comandaId:D,codigoEmpresa:t}),le=lf(H),X=s.find(ye=>ye.id===D),Ce=X&&X.xml_chave?{chave:X.xml_chave,motivo:M}:{numero:X?.nf_numero,serie:X?.nf_serie,motivo:M};try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"start",request:Ce})}catch{}let we=await SV({baseUrl:le.baseUrl,apiKey:le.apiKey,cnpj:le.cnpj,dados:Ce});try{const ye=we&&typeof we.status=="string"&&/erro/i.test(we.status),Ne=we?.codigo||we?.Codigo||"",Re=(we?.campo||we?.Campo||"").toString().toLowerCase();if(ye&&(Ne==="1301"||Re==="searchkey")&&X?.xml_protocolo){const Rt={searchkey:X.xml_protocolo,SearchKey:X.xml_protocolo,motivo:M};try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"retry_searchkey",request:Rt})}catch{}we=await SV({baseUrl:le.baseUrl,apiKey:le.apiKey,cnpj:le.cnpj,dados:Rt})}}catch{}if(we&&typeof we.status=="string"&&/erro/i.test(we.status)){const ye=we?.codigo||we?.Codigo||"",Ne=we?.campo||we?.Campo||"",Re=we?.descricao||we?.Descricao||we?.mensagem||we?.message||"Falha ao cancelar NFC-e",bt=[Ne,Re].filter(Boolean).join("  ");r({title:`Erro ao cancelar${ye?` ${ye}`:""}`,description:bt,variant:"destructive"});try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"business_error",response:we||null})}catch{}return}await dn(D,{nf_status:"cancelada"});try{await re.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"success",response:we||null})}catch{}r({title:"NFC-e cancelada"}),await or()}catch(M){r({title:"Falha ao cancelar",description:M.message,variant:"destructive"})}finally{l(!1)}};return a.jsxs("div",{className:"relative p-4",children:[a.jsx(B0,{children:a.jsx("title",{children:"Central Fiscal"})}),!1,a.jsxs(od,{value:z,onValueChange:U,className:"w-full",children:[a.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Central Fiscal"}),a.jsx("p",{className:"text-xs text-text-secondary mt-1 hidden sm:block",children:"Acompanhe NFC-e e NF-e, pendncias e cancelamentos em um s lugar."})]}),a.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[a.jsxs(sc,{className:"hidden sm:inline-flex rounded-full bg-surface-2 px-1 py-0.5",children:[a.jsx(Pa,{value:"nfce",children:"NFC-e"}),a.jsx(Pa,{value:"nfe",children:"NF-e Sada"}),a.jsx(Pa,{value:"compras",children:"NF-e Entrada (Compras)"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:Kr,title:"Exportar CSV das comandas/NF",children:"Exportar CSV"}),a.jsx(se,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>n("/configuracao-fiscal"),title:"Configurao Fiscal da Empresa",children:a.jsx(fd,{className:"w-4 h-4"})})]})]})]}),a.jsxs(sc,{className:"sm:hidden w-full justify-start rounded-lg bg-surface-2 px-1 py-1 overflow-x-auto",children:[a.jsx(Pa,{value:"nfce",className:"flex-1 min-w-[90px]",children:"NFC-e"}),a.jsx(Pa,{value:"nfe",className:"flex-1 min-w-[100px]",children:"NF-e Sada"}),a.jsx(Pa,{value:"compras",className:"flex-1 min-w-[130px]",children:"NF-e Entrada"})]}),a.jsxs("div",{className:"bg-surface-2/60 border border-border/70 rounded-xl px-3 py-3 flex flex-wrap items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-[220px]",children:[a.jsx(it,{className:"text-xs text-text-secondary",children:"Buscar"}),a.jsx(Ct,{value:h,onChange:D=>m(D.target.value),placeholder:"Chave, nmero, cliente...",className:"w-[200px] sm:w-60 h-8 text-xs"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(it,{className:"text-xs text-text-secondary",children:"Status"}),a.jsxs(Gn,{value:y,onValueChange:v,children:[a.jsx(Vn,{className:"w-[150px] h-8 rounded-full text-xs",children:a.jsx(Kn,{placeholder:"Selecionar status"})}),a.jsxs(Wn,{className:"rounded-xl text-xs",children:[a.jsx(lt,{value:"all",children:"Todos"}),a.jsx(lt,{value:"pendente",children:"Pendente"}),a.jsx(lt,{value:"processando",children:"Em andamento"}),a.jsx(lt,{value:"autorizada",children:"Autorizada"}),a.jsx(lt,{value:"rejeitada",children:"Rejeitada"}),a.jsx(lt,{value:"cancelada",children:"Cancelada"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(it,{className:"text-xs text-text-secondary",children:"Perodo"}),a.jsxs("div",{className:"inline-flex items-center gap-2",children:[a.jsxs(ai,{modal:!0,children:[a.jsx(si,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:A?new Date(A+"T00:00:00").toLocaleDateString("pt-BR"):"Incio"})})}),a.jsx(Go,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(oi,{mode:"single",selected:A?new Date(A+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const Q=D.getFullYear(),M=b(D.getMonth()+1),H=b(D.getDate());P(`${Q}-${M}-${H}`)}})})]}),a.jsx("span",{className:"text-text-secondary text-xs",children:"at"}),a.jsxs(ai,{modal:!0,children:[a.jsx(si,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:F?new Date(F+"T00:00:00").toLocaleDateString("pt-BR"):"Fim"})})}),a.jsx(Go,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(oi,{mode:"single",selected:F?new Date(F+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const Q=D.getFullYear(),M=b(D.getMonth()+1),H=b(D.getDate());O(`${Q}-${M}-${H}`)}})})]})]})]}),a.jsxs("div",{className:"inline-flex items-center gap-2 text-xs ml-auto",children:[a.jsx(Is,{checked:I,onCheckedChange:T,className:"rounded-full border-warning data-[state=checked]:bg-warning"}),a.jsx("span",{children:"Somente pendentes/rejeitadas"})]})]})]}),Rr.length>0&&a.jsx("div",{className:"mb-4 p-3 rounded-md border border-warning/40 bg-warning/10 text-warning",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm",children:"Pendncias fiscais da empresa"}),a.jsxs("p",{className:"text-xs",children:["Preencha: ",Rr.join(", "),"."]})]}),a.jsx(se,{size:"sm",className:"bg-warning text-black hover:bg-warning/90",onClick:()=>n("/configuracao-fiscal"),children:"Corrigir agora"})]})}),a.jsxs(Gs,{value:"nfce",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-nowrap whitespace-nowrap relative z-10",children:[a.jsxs("div",{className:"ml-auto flex items-center gap-2 text-xs text-text-secondary",children:[a.jsxs("span",{children:["Selecionadas: ",a.jsx("strong",{className:"text-text-primary",children:J.length})]}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>G([]),disabled:J.length===0,children:"Limpar"}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>G(Array.from(new Set((vr||[]).map(D=>D.id)))),disabled:(vr||[]).length===0,children:"Selecionar filtrados"})]}),a.jsx(se,{size:"sm",variant:"outline",disabled:J.length===0&&!k,onClick:()=>(async()=>{const D=k||J[0],Q=s.find(M=>M.id===D);if(Q){if(Q.nf_pdf_url){window.open(Q.nf_pdf_url,"_blank");return}try{l(!0);const{empresa:M}=await tv({comandaId:Q.id,codigoEmpresa:t}),H=lf(M);let le=null,X=null,Ce=Q.xml_chave||null,we=!1;if(Q.xml_protocolo)try{const Z=await ab({baseUrl:H.baseUrl,cnpj:H.cnpj,dados:{SearchKey:Q.xml_protocolo,searchkey:Q.xml_protocolo}});console.log("[FiscalHub][NFC-e visualizar->consulta] resposta completa:",Z);const ye=String(Z?.status||Z?.Status||Z?.cStat||"").toLowerCase();we=!!(Z?.autorizada||Z?.Autorizada||Z?.sucesso||Z?.Sucesso||ye==="100"),le=Z?.pdf_url||Z?.PdfUrl||null,X=Z?.xml_url||Z?.XmlUrl||null,Ce=Z?.chave||Z?.Chave||Ce}catch(Z){console.warn("[FiscalHub][NFC-e visualizar] consulta por SearchKey falhou, tentando PDF/XML direto",Z)}if(!le&&!X){const Z={numero:Q.nf_numero,Numero:Q.nf_numero,serie:Q.nf_serie,Serie:Q.nf_serie};try{const ye=await sb({baseUrl:H.baseUrl,cnpj:H.cnpj,dados:Z});le=ye?.pdf_url||ye?.PdfUrl||le,Ce=ye?.chave||ye?.Chave||Ce}catch{}try{const ye=await ob({baseUrl:H.baseUrl,cnpj:H.cnpj,dados:Z});X=ye?.xml_url||ye?.XmlUrl||X,Ce=Ce||ye?.chave||ye?.Chave||Ce}catch{}we=!!(le||X||we)}(le||X||we||Ce)&&await re.from("comandas").update({nf_pdf_url:le||Q.nf_pdf_url,nf_xml_url:X||Q.nf_xml_url,xml_chave:Ce||Q.xml_chave,nf_status:we?"autorizada":Q.nf_status||null}).eq("id",Q.id).eq("codigo_empresa",t),le?window.open(le,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"}),await or()}catch(M){r({title:"Falha ao visualizar",description:M.message,variant:"destructive"})}finally{l(!1)}}})(),children:"Visualizar"}),a.jsxs(se,{size:"sm",disabled:J.length===0,onClick:()=>{if(!Mr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}_i(!0)},children:["Emitir (",Mr.length||0,")"]}),a.jsxs(se,{size:"sm",variant:"outline",disabled:J.length===0,onClick:ys,children:["Consultar (",bn.length||0,")"]}),a.jsxs(se,{size:"sm",variant:"destructive",disabled:J.length===0,onClick:cn,children:["Cancelar (",ca.length||0,")"]}),a.jsx(se,{size:"sm",variant:"outline",onClick:Kr,children:"Exportar CSV"}),a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsx(se,{size:"sm",variant:"outline",disabled:ts,children:"Aes"})}),a.jsxs(bm,{align:"end",children:[a.jsxs(Po,{disabled:J.length===0&&!k,onClick:()=>Ba({tipo:"nfce",scope:"selected",includePdf:!1}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(Po,{disabled:J.length===0&&!k,onClick:()=>Ba({tipo:"nfce",scope:"selected",includePdf:!0}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(Po,{disabled:(vr||[]).length===0,onClick:()=>Ba({tipo:"nfce",scope:"filtered",includePdf:!1}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(Po,{disabled:(vr||[]).length===0,onClick:()=>Ba({tipo:"nfce",scope:"filtered",includePdf:!0}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]}),a.jsx("div",{className:"bg-surface rounded border border-border overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"w-8 px-3 py-2",children:a.jsx(Is,{checked:hr,onCheckedChange:D=>Zr(!!D)})}),a.jsxs("th",{className:"text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{Ae(L==="aberto_em"&&ge==="asc"?"desc":"asc"),W("aberto_em")},children:["Abertura ",L==="aberto_em"?ge==="asc"?"":"":""]}),a.jsxs("th",{className:"text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{Ae(L==="nf_status"&&ge==="asc"?"desc":"asc"),W("nf_status")},children:["Status ",L==="nf_status"?ge==="asc"?"":"":""]}),a.jsxs("th",{className:"hidden text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{Ae(L==="mesa"&&ge==="asc"?"desc":"asc"),W("mesa")},children:["Mesa ",L==="mesa"?ge==="asc"?"":"":""]}),a.jsx("th",{className:"text-left px-3 py-2",children:"Clientes"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Finalizadoras"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Nmero/Srie"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Chave"}),a.jsxs("th",{className:"text-right px-3 py-2 cursor-pointer select-none",onClick:()=>{Ae(L==="total"&&ge==="asc"?"desc":"asc"),W("total")},children:["Total ",L==="total"?ge==="asc"?"":"":""]})]})}),a.jsxs("tbody",{children:[(!pr||pr.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"px-3 py-4 text-center text-text-muted",children:i?"Carregando...":"Nada por aqui"})}),pr.map(D=>{const Q=D.nf_status||"pendente";return a.jsxs(Ee.Fragment,{children:[a.jsxs("tr",{className:`border-t border-border/60 transition-colors ${k===D.id?"bg-surface-2 ring-2 ring-[#FF7A1A]/60 rounded-md":"hover:bg-surface-2/50"}`,onClick:()=>Pr(D.id),children:[a.jsx("td",{className:"px-3 py-2",onClick:M=>M.stopPropagation(),children:a.jsx(Is,{checked:ue(D.id),onCheckedChange:M=>ve(D.id,!!M)})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:Bk(D.aberto_em)}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${tn(Q)}`,children:Q})}),a.jsx("td",{className:"hidden px-3 py-2 whitespace-nowrap",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.clientesStr||"",children:D.clientesStr||""}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.finalizadorasStr||"",children:D.finalizadorasStr||""}),a.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[D.nf_numero??"","/",D.nf_serie??""]}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[220px] truncate",title:D.xml_chave||"",children:D.xml_chave?`${String(D.xml_chave).slice(0,8)}...${String(D.xml_chave).slice(-4)}`:""}),a.jsxs("td",{className:"px-3 py-2 text-right whitespace-nowrap",children:["R$ ",Ls(D.total||D.total_com_desconto)]})]}),gt(D.id)&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"px-3 py-3 bg-surface-2/40 border-t border-border",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Mesa: "}),a.jsx("span",{className:"text-text-primary",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Clientes: "}),a.jsx("span",{className:"text-text-primary",children:D.clientesStr||""})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Finalizadoras: "}),a.jsx("span",{className:"text-text-primary",children:D.finalizadorasStr||""})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Nmero/Srie: "}),a.jsxs("span",{className:"text-text-primary",children:[D.nf_numero??"","/",D.nf_serie??""]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-secondary",children:"Chave: "}),a.jsx("span",{className:"text-text-primary",title:D.xml_chave||"",children:D.xml_chave||""})]}),a.jsxs("div",{className:"text-text-secondary mt-1",children:["Total: ",a.jsxs("span",{className:"text-text-primary",children:["R$ ",Ls(D.total||D.total_com_desconto)]})]})]}),a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"flex gap-2",children:[D.nf_pdf_url&&a.jsx("a",{className:"inline-flex",href:D.nf_pdf_url,target:"_blank",rel:"noreferrer",children:a.jsx(se,{size:"sm",variant:"outline",children:"Abrir DANFE"})}),D.nf_xml_url&&a.jsx("a",{className:"inline-flex",href:D.nf_xml_url,target:"_blank",rel:"noreferrer",children:a.jsx(se,{size:"sm",variant:"outline",children:"Baixar XML"})})]})})]})})})]},D.id)})]})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:["Pgina ",V," de ",Vr,"  ",It.length," registros"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Itens por pgina"}),a.jsxs("select",{className:"h-7 rounded-md bg-surface border border-border text-xs px-2",value:Y,onChange:D=>{$(1),he(Number(D.target.value)||50)},children:[a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]}),a.jsx(se,{size:"sm",variant:"outline",disabled:V<=1,onClick:()=>$(D=>Math.max(1,D-1)),children:"Anterior"}),a.jsx(se,{size:"sm",variant:"outline",disabled:V>=Vr,onClick:()=>$(D=>Math.min(Vr,D+1)),children:"Prxima"})]})]})]}),a.jsxs(Gs,{value:"nfe",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap whitespace-nowrap relative z-10",children:[a.jsxs("div",{className:"ml-auto flex items-center gap-2 text-xs text-text-secondary",children:[a.jsxs("span",{children:["Selecionadas: ",a.jsx("strong",{className:"text-text-primary",children:J.length})]}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>G([]),disabled:J.length===0,children:"Limpar"}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>{const D=Hr||[];G(Array.from(new Set(D.map(Q=>Q.id))))},disabled:(Hr||[]).length===0,children:"Selecionar filtrados"})]}),a.jsx(se,{size:"sm",variant:"outline",disabled:J.length===0&&!k,onClick:()=>(async()=>{try{const D=c||[],Q=k||J&&J[0],M=D.find(ye=>ye.id===Q);if(!M){r({title:"NF-e no encontrada",variant:"warning"});return}if(M.pdf_url){window.open(M.pdf_url,"_blank");return}if(!Te){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:H,cnpj:le}=lf(Te),X=M.xml_chave?{chave:M.xml_chave,chave_nota:M.xml_chave}:{numero:M.numero,serie:M.serie};l(!0);let Ce=null,we=null,Z=M.xml_chave||null;try{const ye=await Mk({baseUrl:H,cnpj:le,dados:X});Ce=ye?.url_pdf||ye?.pdf_url||null,we=ye?.url_xml||ye?.xml_url||null,Z=ye?.chave||ye?.Chave||Z}catch{}if(!Ce)try{const ye=await Rk({baseUrl:H,cnpj:le,dados:X});Ce=ye?.url_pdf||ye?.pdf_url||null,Z=ye?.chave||ye?.Chave||Z}catch{}if(!we)try{const ye=await Fk({baseUrl:H,cnpj:le,dados:X});we=ye?.url_xml||ye?.xml_url||null,Z=Z||ye?.chave||ye?.Chave||Z}catch{}(Ce||we||Z)&&await re.from("notas_fiscais").update({pdf_url:Ce||M.pdf_url,xml_url:we||M.xml_url,xml_chave:Z||M.xml_chave,status:Ce||we?"autorizada":M.status}).eq("id",M.id).eq("codigo_empresa",t),await Bt(),Ce?window.open(Ce,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"})}catch(D){r({title:"Falha ao visualizar NF-e",description:D?.message||String(D),variant:"destructive"})}finally{l(!1)}})(),children:"Visualizar"}),a.jsx(se,{size:"sm",disabled:J.length===0&&!k||Dt,onClick:async()=>{Xt(!0);try{await ne()}finally{Xt(!1)}},children:Dt?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(Zl,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Emitir NF-e"}),a.jsx(se,{size:"sm",variant:"outline",disabled:J.length===0&&!k,onClick:me,children:"Consultar"}),a.jsx(se,{size:"sm",variant:"destructive",disabled:J.length===0&&!k,onClick:De,children:"Cancelar"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(se,{size:"sm",onClick:async()=>{B(null),G([]),await Ze()&&(nr(""),Tt(!0))},children:"Nova NF-e"})}),a.jsxs(Gh,{children:[a.jsx(Kh,{asChild:!0,children:a.jsx(se,{size:"sm",variant:"outline",disabled:ts,children:"Aes"})}),a.jsxs(bm,{align:"end",children:[a.jsxs(Po,{disabled:J.length===0&&!k,onClick:()=>Ba({tipo:"nfe",scope:"selected",includePdf:!1}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(Po,{disabled:J.length===0&&!k,onClick:()=>Ba({tipo:"nfe",scope:"selected",includePdf:!0}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(Po,{disabled:(Hr||[]).length===0,onClick:()=>Ba({tipo:"nfe",scope:"filtered",includePdf:!1}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(Po,{disabled:(Hr||[]).length===0,onClick:()=>Ba({tipo:"nfe",scope:"filtered",includePdf:!0}),children:[a.jsx(ks,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]}),a.jsx("div",{className:"bg-surface rounded border border-border overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"w-8 px-3 py-2",children:a.jsx(Is,{checked:!1,onCheckedChange:()=>{}})}),a.jsx("th",{className:"text-left px-3 py-2",children:"Data"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Status"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Destinatrio"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Nmero/Srie"}),a.jsx("th",{className:"text-right px-3 py-2",children:"Valor"})]})}),a.jsxs("tbody",{children:[(!ln||ln.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-text-muted",children:u?"Carregando...":"Nada por aqui"})}),ln.map(D=>{const Q=String(D.status||"rascunho").toLowerCase(),M=tn(Q==="emitida"?"autorizada":Q),H=D.data_emissao||D.criado_em||D.created_at||null;return a.jsx(Ee.Fragment,{children:a.jsxs("tr",{className:`border-t border-border/60 transition-colors ${k===D.id?"bg-surface-2 ring-2 ring-[#FF7A1A]/60 rounded-md":"hover:bg-surface-2/50"}`,onClick:()=>{B(D.id),G(le=>!le||le.length===0?[D.id]:(le.length===1&&le[0]===D.id,le))},children:[a.jsx("td",{className:"px-3 py-2",onClick:le=>le.stopPropagation(),children:a.jsx(Is,{checked:ue(D.id),onCheckedChange:le=>ve(D.id,!!le)})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:H?Bk(H):""}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${M} ${Q==="rascunho"?"cursor-pointer hover:opacity-80":""}`,onClick:le=>{le.stopPropagation(),Q==="rascunho"&&ie(D)},title:Q==="rascunho"?"Clique para editar rascunho":void 0,children:Q}),Q==="rascunho"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-surface-2 text-text-secondary hover:text-text-primary",onClick:le=>{le.stopPropagation(),ie(D)},title:"Editar rascunho",children:a.jsx(Que,{className:"w-3 h-3"})}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-surface-2 text-text-secondary hover:text-destructive",onClick:le=>{le.stopPropagation(),St(D.id)},title:"Excluir rascunho",children:a.jsx(Sf,{className:"w-3 h-3"})})]})]})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.destinatario?.nome||"",children:D.destinatario?.nome||""}),a.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[D.numero??"","/",D.serie??"",D.xml_chave&&a.jsxs("div",{className:"text-[10px] text-text-secondary truncate max-w-[220px] flex items-center gap-1",children:[a.jsx("span",{className:"truncate",children:`${String(D.xml_chave).slice(0,8)}...${String(D.xml_chave).slice(-4)}`}),a.jsx("button",{type:"button",className:"p-0.5 hover:text-text-primary",onClick:le=>{le.stopPropagation(),navigator.clipboard.writeText(D.xml_chave||""),r({title:"Chave copiada"})},title:"Copiar chave",children:a.jsx(Q4,{className:"w-3 h-3"})})]})]}),a.jsxs("td",{className:"px-3 py-2 text-right whitespace-nowrap",children:["R$ ",Ls(D.valor_total||0)]})]})},D.id)})]})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:["Pgina ",V," de ",Math.max(1,Math.ceil((Hr||[]).length/Y)),"  ",(Hr||[]).length," registros"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Itens por pgina"}),a.jsxs("select",{className:"h-7 rounded-md bg-surface border border-border text-xs px-2",value:Y,onChange:D=>{$(1),he(Number(D.target.value)||50)},children:[a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]}),a.jsx(se,{size:"sm",variant:"outline",disabled:V<=1,onClick:()=>$(D=>Math.max(1,D-1)),children:"Anterior"}),a.jsx(se,{size:"sm",variant:"outline",disabled:V>=Math.max(1,Math.ceil((Hr||[]).length/Y)),onClick:()=>$(D=>D+1),children:"Prxima"})]})]})]}),a.jsx(Gs,{value:"compras",children:a.jsx(foe,{})})]}),a.jsx(In,{open:gl,onOpenChange:_i,children:a.jsxs(En,{className:"sm:max-w-[520px]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Confirmar emisso de NFC-e"}),a.jsx(Hn,{children:"As seguintes comandas sero enviadas para emisso agora. Revise rapidamente antes de confirmar."})]}),a.jsxs("div",{className:"max-h-[320px] overflow-y-auto mt-2 border border-border/60 rounded-md divide-y divide-border/40 text-xs",children:[Mr.map(D=>{const Q=s.find(H=>H.id===D)||{},M=Q.mesaNumero?`Mesa ${Q.mesaNumero}`:"Balco";return a.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-2 bg-surface/40",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx("div",{className:"font-medium text-text-primary",children:M}),a.jsx("div",{className:"text-text-secondary truncate max-w-[260px]",children:Q.clientesStr||"Cliente Consumidor"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-[11px] text-text-secondary",children:"Total"}),a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["R$ ",Ls(Q.total||Q.total_com_desconto)]})]})]},D)}),!Mr.length&&a.jsx("div",{className:"px-3 py-2 text-text-secondary",children:"Nenhuma NFC-e elegvel selecionada."})]}),a.jsxs("div",{className:"flex justify-between items-center mt-3 text-[11px] text-text-secondary",children:[a.jsxs("span",{children:[Mr.length," NFC-e sero emitidas agora."]}),J.length>Mr.length&&a.jsxs("span",{children:[J.length-Mr.length," seleo(es) sero ignoradas por no estarem pendentes/rejeitadas."]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(se,{variant:"outline",size:"sm",onClick:()=>_i(!1),children:"Cancelar"}),a.jsx(se,{size:"sm",className:"bg-[#FF7A1A] hover:bg-[#ff8f3b] text-black",onClick:async()=>{_i(!1),await os()},children:"Confirmar emisso"})]})]})}),a.jsx(In,{open:mr,onOpenChange:Gt,children:a.jsxs(En,{className:"w-[95vw] sm:max-w-[760px] max-h-[80vh] flex flex-col",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Selecionar Comanda"}),a.jsx(Hn,{children:"Escolha a comanda de origem para criar o rascunho de NF-e."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto mt-2 space-y-2",children:(()=>{const D=(ur||"").trim().toLowerCase(),M=(Array.isArray(It)?It:[]).filter(le=>D?`${le.mesaNumero?`mesa ${le.mesaNumero}`:"balcao"} ${le.clientesStr||""}`.toLowerCase().includes(D):!0),H=new Set((c||[]).filter(le=>le.origem==="comanda"&&le.comanda_id).map(le=>le.comanda_id));return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[a.jsx("div",{className:"flex-1 min-w-[180px] flex items-center gap-2",children:a.jsx(Ct,{className:"h-8 text-xs",placeholder:"Filtrar por cliente ou mesa",value:ur,onChange:le=>rt(le.target.value)})}),a.jsxs("div",{className:"text-xs text-text-secondary whitespace-nowrap",children:[M.length," comandas filtradas"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[M.slice(0,100).map(le=>{const X=H.has(le.id);return a.jsxs("label",{className:"grid grid-cols-12 items-center px-3 py-2 hover:bg-surface-2 cursor-pointer gap-2",children:[a.jsx("div",{className:"col-span-1 flex items-center justify-center",children:a.jsx(Is,{checked:pn===le.id,onCheckedChange:Ce=>{jt(we=>Ce?le.id:we===le.id?null:we)}})}),a.jsx("div",{className:"col-span-3 text-sm",children:Bk(le.aberto_em)}),a.jsx("div",{className:"col-span-4 text-sm truncate",title:le.clientesStr||"",children:le.clientesStr||""}),a.jsxs("div",{className:"col-span-2 flex flex-col text-xs text-text-secondary",children:[a.jsx("span",{children:le.mesaNumero?`Mesa ${le.mesaNumero}`:"Balco"}),X&&a.jsx("span",{className:"text-[10px] text-amber-500",children:"J possui NF-e vinculada"})]}),a.jsxs("div",{className:"col-span-2 text-right text-sm",children:["R$ ",Ls(le.total||le.total_com_desconto)]})]},le.id)}),M.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhuma comanda encontrada"})]})]})})()}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3 pt-2 border-t border-border/60",children:[a.jsx(se,{variant:"outline",onClick:()=>Gt(!1),children:"Cancelar"}),a.jsx(se,{onClick:async()=>{if(!pn){r({title:"Selecione uma comanda",variant:"warning"});return}await pt(pn)&&(nr(""),await pe(pn),Gt(!1))},children:"Continuar"})]})]})}),a.jsx(In,{open:!!Nr,onOpenChange:D=>{D||(an(null),On(""))},children:a.jsxs(En,{className:"max-w-sm",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Cancelar NF-e"}),a.jsx(Hn,{children:"Informe o motivo do cancelamento. Essa ao ser enviada para a API fiscal e a nota ser marcada como cancelada."})]}),a.jsxs("div",{className:"space-y-2 mt-2",children:[a.jsx(it,{htmlFor:"motivo-cancel-nfe",children:"Motivo do cancelamento"}),a.jsx(Ct,{id:"motivo-cancel-nfe",value:Lr,onChange:D=>On(D.target.value),placeholder:"Ex.: Nota emitida em duplicidade"})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(se,{variant:"outline",onClick:()=>{an(null),On("")},children:"Cancelar"}),a.jsx(se,{variant:"destructive",onClick:async()=>{if(!Nr){an(null);return}await oe(Nr)},children:"Confirmar cancelamento"})]})]})}),a.jsx(In,{open:!!mc,onOpenChange:D=>{D||(ci(null),Ks(""))},children:a.jsxs(En,{className:"max-w-sm",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Cancelar NFC-e"}),a.jsx(Hn,{children:"Informe o motivo do cancelamento."})]}),a.jsxs("div",{className:"space-y-2 mt-2",children:[a.jsx(it,{htmlFor:"motivo-nfce",children:"Motivo"}),a.jsx(Ct,{id:"motivo-nfce",value:Lc,onChange:D=>Ks(D.target.value),placeholder:"Ex.: Cliente desistiu da compra"})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(se,{variant:"outline",onClick:()=>{ci(null),Ks("")},children:"Voltar"}),a.jsx(se,{variant:"destructive",onClick:async()=>{if(!mc){ci(null);return}const D=(Lc||"").trim();if(!D){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}await Wr(mc,D),ci(null),Ks("")},children:"Confirmar cancelamento"})]})]})}),a.jsx(In,{open:gr,onOpenChange:fr,children:a.jsxs(En,{className:"max-w-[880px]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Pr-Emisso NFC-e"}),a.jsx(Hn,{children:"Revise os dados e pendncias antes de emitir."})]}),je?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Gerando prvia"}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Pendncias"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(se,{size:"sm",variant:"outline",onClick:()=>Cr(D=>!D),children:Ot?"Ocultar JSON":"Ver JSON"}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>n("/configuracao-fiscal"),children:"Corrigir Empresa"}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>Ta(!0),children:"Selecionar Cliente"}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>{k&&An(k)},children:"Recarregar Prvia"})]})]}),!Fe||Fe.length===0?a.jsx("div",{className:"text-sm text-emerald-500",children:"Nenhuma pendncia encontrada."}):a.jsx("ul",{className:"list-disc pl-5 text-sm",children:Fe.map((D,Q)=>a.jsx("li",{children:D},Q))})]}),Ot&&a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"JSON (EnviarNfce)"}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto",children:$t?JSON.stringify($t,null,2):""})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(se,{variant:"outline",onClick:()=>fr(!1),children:"Fechar"}),a.jsx(se,{disabled:!0,children:"Emitir (desabilitado)"})]})]})}),a.jsx(In,{open:Qn,onOpenChange:Ta,children:a.jsxs(En,{className:"w-[95vw] sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Selecionar destinatrio"}),a.jsx(Hn,{children:"Busque pelo cdigo, nome ou documento e escolha a parte."})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[a.jsx("div",{className:"flex-1 min-w-[200px]",children:a.jsx(Ct,{placeholder:"Buscar por cdigo, nome ou documento",value:zn,onChange:D=>Fn(D.target.value)})}),a.jsxs("span",{className:"text-xs text-text-secondary",children:[de.length," itens"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[de.map(D=>a.jsxs("div",{className:"grid grid-cols-12 items-center px-3 py-2 hover:bg-surface-2 cursor-pointer",onClick:()=>ke(D),children:[a.jsx("div",{className:"col-span-2 text-xs font-medium",children:String(D.codigo||D.codigo_cliente||D.codigo_fornecedor||D.code||"")}),a.jsx("div",{className:"col-span-6 text-sm truncate",title:D.nome||D.razao_social||"",children:D.nome||D.razao_social||"Sem nome"}),a.jsxs("div",{className:"col-span-4 text-xs text-text-secondary text-right",children:[(D.cnpj||D.cpf||"").toString()," ",D.cidade?` ${D.cidade}/${D.uf||""}`:""]})]},D.id)),de.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhum registro encontrado"})]}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsx(se,{variant:"outline",onClick:()=>Ta(!1),children:"Fechar"})})]})}),a.jsx(In,{open:ft,onOpenChange:yt,children:a.jsxs(En,{className:"w-[95vw] sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Selecionar produto"}),a.jsx(Hn,{children:"Busque pelo nome ou cdigo para preencher o item."})]}),a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ct,{placeholder:"Buscar produto por nome ou cdigo",value:$e,onChange:D=>Be(D.target.value)}),a.jsxs("span",{className:"text-xs text-text-secondary",children:[mt.length," itens"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[mt.map(D=>a.jsx("div",{className:"flex items-center justify-between px-3 py-2 hover:bg-surface-2 cursor-pointer",onClick:()=>{Et!=null&&Qr(Et,D),yt(!1)},children:a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"text-sm",children:[D.code&&a.jsxs("span",{className:"text-text-secondary mr-1",children:["[",D.code,"]"]}),a.jsx("span",{children:D.name})]}),a.jsxs("div",{className:"text-[11px] text-text-secondary",children:["R$ ",Ls(D.price??D.salePrice??0)]})]})},D.id)),mt.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhum produto encontrado"})]}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsx(se,{variant:"outline",onClick:()=>yt(!1),children:"Fechar"})})]})}),a.jsx(In,{open:!!Ue,onOpenChange:D=>{D||St(null)},children:a.jsxs(En,{className:"max-w-sm",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Remover rascunho"}),a.jsx(Hn,{children:"Essa ao remove definitivamente o rascunho de NF-e selecionado. Os dados no podero ser recuperados."})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(se,{variant:"outline",onClick:()=>St(null),children:"Cancelar"}),a.jsx(se,{variant:"destructive",onClick:async()=>{if(!Ue||!t){St(null);return}try{await re.from("notas_fiscais").delete().eq("id",Ue).eq("codigo_empresa",t),await Bt(),r({title:"Rascunho removido"})}catch(D){r({title:"Falha ao remover rascunho",description:D.message,variant:"destructive"})}finally{St(null)}},children:"Remover rascunho"})]})]})}),a.jsx(In,{open:Qt,onOpenChange:Tt,children:a.jsxs(En,{className:"w-[960px] max-w-[96vw] h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Criar NF-e (manual)"}),a.jsx(Hn,{children:"Vamos montar do zero."})]}),a.jsxs(od,{value:ar,onValueChange:kn,className:"flex-1 overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[a.jsxs(sc,{children:[a.jsx(Pa,{value:"ident",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Tr.identOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Identificao"})]})}),a.jsx(Pa,{value:"produtos",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Tr.produtosOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Produtos"})]})}),a.jsx(Pa,{value:"pagamentos",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Tr.pagamentosOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Pagamentos"})]})}),a.jsx(Pa,{value:"totais",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Tr.totaisOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Totais & Impostos"})]})}),a.jsx(Pa,{value:"transporte",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Tr.transpOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Transporte"})]})}),a.jsx(Pa,{value:"resumo",children:"Resumo & Emisso"})]}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>{jt(null),Gt(!0)},children:"Selecionar comanda"})]}),a.jsx(Gs,{value:"ident",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Identificao da Nota"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[a.jsxs("div",{className:"md:col-span-1 max-w-[210px]",children:[a.jsx(it,{className:Ia(tt.modelo)?"text-red-400":"",children:"Tipo de Documento"}),a.jsxs(Gn,{value:tt.modelo,onValueChange:D=>jr(Q=>({...Q,modelo:D})),children:[a.jsx(Vn,{className:`h-8 text-xs ${Ia(tt.modelo)?"border-red-500 text-red-400":""}`,children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"55",children:"55 - NF-e"}),a.jsx(lt,{value:"65",children:"65 - NFC-e"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[190px]",children:[a.jsx(it,{className:Ia(tt.tipo_nota)?"text-red-400":"",children:"Tipo de Operao"}),a.jsxs(Gn,{value:tt.tipo_nota,onValueChange:D=>jr(Q=>({...Q,tipo_nota:D})),children:[a.jsx(Vn,{className:`h-8 text-xs ${Ia(tt.tipo_nota)?"border-red-500 text-red-400":""}`,children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"saida",children:"Sada"}),a.jsx(lt,{value:"entrada",children:"Entrada"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[210px]",children:[a.jsx(it,{className:Ia(tt.finNFe)?"text-red-400":"",children:"Finalidade"}),a.jsxs(Gn,{value:tt.finNFe,onValueChange:D=>jr(Q=>({...Q,finNFe:D})),children:[a.jsx(Vn,{className:`h-8 text-xs ${Ia(tt.finNFe)?"border-red-500 text-red-400":""}`,children:a.jsx(Kn,{placeholder:"Normal"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"1",children:"1 - Normal"}),a.jsx(lt,{value:"2",children:"2 - Complementar"}),a.jsx(lt,{value:"3",children:"3 - Ajuste"}),a.jsx(lt,{value:"4",children:"4 - Devoluo"})]})]})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(it,{className:Ia(tt.natOp)?"text-red-400":"",children:"Natureza da Operao"}),a.jsx(Ct,{className:`h-8 text-xs ${Ia(tt.natOp)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:tt.natOp,onChange:D=>jr(Q=>({...Q,natOp:D.target.value})),placeholder:"Ex.: Venda de mercadoria"})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(it,{className:Ia(tt.data_emissao)?"text-red-400":"",children:"Data de Emisso"}),a.jsx(MV,{label:"Selecione",value:tt.data_emissao,onChange:D=>jr(Q=>({...Q,data_emissao:D}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(it,{children:"Data Sada/Entrada"}),a.jsx(MV,{label:"Selecione",value:tt.data_saida,onChange:D=>jr(Q=>({...Q,data_saida:D}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[120px]",children:[a.jsx(it,{className:Ia(tt.serie)?"text-red-400":"",children:"Srie"}),a.jsx(Ct,{className:`h-8 text-xs ${Ia(tt.serie)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:tt.serie,onChange:D=>jr(Q=>({...Q,serie:D.target.value}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[140px]",children:[a.jsx(it,{children:"Nmero"}),a.jsx(Ct,{className:"h-8 text-xs",value:tt.nNF,onChange:D=>jr(Q=>({...Q,nNF:D.target.value})),placeholder:"automtico"})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(it,{className:Ia(tt.idDest)?"text-red-400":"",children:"Destino da Operao"}),a.jsxs(Gn,{value:tt.idDest||"auto",onValueChange:D=>jr(Q=>({...Q,idDest:D==="auto"?"":D})),children:[a.jsx(Vn,{className:`h-8 text-xs ${Ia(tt.idDest)?"border-red-500 text-red-400":""}`,children:a.jsx(Kn,{placeholder:"Automtico"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"auto",children:"Automtico"}),a.jsx(lt,{value:"1",children:"1 - Interna (mesmo estado)"}),a.jsx(lt,{value:"2",children:"2 - Interestadual"}),a.jsx(lt,{value:"3",children:"3 - Exterior"})]})]})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(it,{className:Ia(tt.indFinal)?"text-red-400":"",children:"Consumidor Final"}),a.jsxs(Gn,{value:tt.indFinal??"",onValueChange:D=>jr(Q=>({...Q,indFinal:D})),children:[a.jsx(Vn,{className:`h-8 text-xs ${Ia(tt.indFinal)?"border-red-500 text-red-400":""}`,children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"1",children:"Sim"}),a.jsx(lt,{value:"0",children:"No"})]})]})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(it,{className:Ia(tt.indPres)?"text-red-400":"",children:"Presena do Comprador"}),a.jsxs(Gn,{value:tt.indPres??"",onValueChange:D=>jr(Q=>({...Q,indPres:D})),children:[a.jsx(Vn,{className:`h-8 text-xs ${Ia(tt.indPres)?"border-red-500 text-red-400":""}`,children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"1",children:"1 - Operao presencial"}),a.jsx(lt,{value:"2",children:"2 - No presencial, internet"}),a.jsx(lt,{value:"4",children:"4 - Entrega em domiclio"}),a.jsx(lt,{value:"9",children:"9 - No se aplica"})]})]})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Emitente (Empresa)"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"CNPJ"}),a.jsx("div",{className:"text-text-primary",children:Te?.cnpj||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"Inscrio Estadual"}),a.jsx("div",{className:"text-text-primary",children:Te?.inscricao_estadual||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"Regime Tributrio"}),a.jsx("div",{className:"text-text-primary",children:Te?.regime_tributario||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Razo Social"}),a.jsx("div",{className:"text-text-primary",children:Te?.razao_social||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Nome Fantasia"}),a.jsx("div",{className:"text-text-primary",children:Te?.nome_fantasia||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Endereo"}),a.jsx("div",{className:"text-text-primary",children:Te?`${Te.logradouro||Te.endereco||""} ${Te.numero||""} ${Te.bairro||""} - ${Te.cidade||""}/${Te.uf||""}  CEP ${Te.cep||""}`.trim():""})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Destinatrio"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Ct,{className:"w-[260px] h-8 text-xs",placeholder:"Nome, cdigo, CPF ou CNPJ",value:zn,onChange:D=>Fn(D.target.value)}),a.jsx(se,{size:"icon",variant:"outline",className:"h-8 w-8",onClick:()=>Ta(!0),children:a.jsx(Mo,{className:"w-4 h-4"})})]})})]}),(zn||"").trim().length>0&&de.length>0&&a.jsx("div",{className:"border border-border rounded-md mb-3 max-h-40 overflow-y-auto text-xs",children:de.slice(0,8).map(D=>a.jsxs("div",{className:"flex items-center justify-between px-2 py-1 hover:bg-surface-2 cursor-pointer",onClick:()=>ke(D),children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium truncate max-w-[220px]",children:D.nome||D.razao_social||"Sem nome"}),a.jsx("span",{className:"text-text-secondary truncate max-w-[220px]",children:(D.cnpj||D.cpf||"").toString()})]}),a.jsx("span",{className:"text-[10px] text-text-secondary ml-2",children:D.is_fornecedor?"Fornecedor":"Cliente"})]},D.id))}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{children:"Tipo de Pessoa"}),a.jsxs(Gn,{value:tt.tipo_pessoa,onValueChange:D=>jr(Q=>({...Q,tipo_pessoa:D})),children:[a.jsx(Vn,{children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"PF",children:"Pessoa Fsica"}),a.jsx(lt,{value:"PJ",children:"Pessoa Jurdica"})]})]})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.cpf_cnpj)?"text-red-400":"",children:tt.tipo_pessoa==="PF"?"CPF":"CNPJ"}),a.jsx(Ct,{className:Ia(tt.cpf_cnpj)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.cpf_cnpj,onChange:D=>jr(Q=>({...Q,cpf_cnpj:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.nome)?"text-red-400":"",children:"Nome/Razo Social"}),a.jsx(Ct,{className:Ia(tt.nome)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.nome,onChange:D=>jr(Q=>({...Q,nome:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.indIEDest)?"text-red-400":"",children:"Indicador de IE"}),a.jsxs(Gn,{value:tt.indIEDest||"9",onValueChange:D=>jr(Q=>({...Q,indIEDest:D,ie_isento:D==="2",inscricao_estadual:D==="2"?"ISENTO":Q.inscricao_estadual})),children:[a.jsx(Vn,{className:Ia(tt.indIEDest)?"border-red-500 text-red-400":"",children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"1",children:"Contribuinte"}),a.jsx(lt,{value:"2",children:"Isento"}),a.jsx(lt,{value:"9",children:"No Contribuinte"})]})]})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Inscrio Estadual"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ct,{value:tt.ie_isento?"ISENTO":tt.inscricao_estadual||"",onChange:D=>jr(Q=>({...Q,inscricao_estadual:D.target.value,ie_isento:String(D.target.value||"").toUpperCase()==="ISENTO"}))}),a.jsx(se,{type:"button",size:"sm",variant:tt.ie_isento?"default":"outline",onClick:()=>jr(D=>({...D,ie_isento:!0,inscricao_estadual:"ISENTO",indIEDest:"2"})),children:"ISENTO"})]})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.cep)?"text-red-400":"",children:"CEP"}),a.jsx(Ct,{className:Ia(tt.cep)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.cep,onChange:D=>jr(Q=>({...Q,cep:D.target.value})),onBlur:()=>st(tt.cep)})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(it,{className:Ia(tt.logradouro)?"text-red-400":"",children:"Logradouro"}),a.jsx(Ct,{className:Ia(tt.logradouro)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.logradouro,onChange:D=>jr(Q=>({...Q,logradouro:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.numero)?"text-red-400":"",children:"Nmero"}),a.jsx(Ct,{className:Ia(tt.numero)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.numero,onChange:D=>jr(Q=>({...Q,numero:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.bairro)?"text-red-400":"",children:"Bairro"}),a.jsx(Ct,{className:Ia(tt.bairro)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.bairro,onChange:D=>jr(Q=>({...Q,bairro:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.cidade)?"text-red-400":"",children:"Cidade"}),a.jsx(Ct,{className:Ia(tt.cidade)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.cidade,onChange:D=>jr(Q=>({...Q,cidade:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.uf)?"text-red-400":"",children:"UF"}),a.jsx(Ct,{className:Ia(tt.uf)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:tt.uf,onChange:D=>jr(Q=>({...Q,uf:(D.target.value||"").toUpperCase().slice(0,2)}))})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.codigo_municipio_ibge)?"text-red-400":"",children:"Cdigo IBGE"}),a.jsx(Ct,{className:`h-8 text-xs ${Ia(tt.codigo_municipio_ibge)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:tt.codigo_municipio_ibge,onChange:D=>jr(Q=>({...Q,codigo_municipio_ibge:D.target.value})),placeholder:"Ex.: 3550308"})]})]})]})]})}),a.jsx(Gs,{value:"produtos",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(se,{size:"sm",onClick:()=>{jr(D=>{const Q={descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:D.cfop_padrao||"5102",unidade:"UN",quantidade:"1",preco_unitario:"0,00",desconto_valor:"0,00",desconto_percent:"",acrescimos_valor:"0,00",frete_valor:"0,00",seguro_valor:"0,00",obs:"",impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""}}};return{...D,itens:[...D.itens,Q]}})},children:"Adicionar item"})}),a.jsx("div",{className:"border border-border rounded-md overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 py-2",children:"Produto"}),a.jsx("th",{className:"text-center px-2 py-2 w-[80px]",children:"Qtd"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"V. Unit"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"Desconto"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"Total"}),a.jsx("th",{className:"text-center px-2 py-2 w-[180px]",children:"Aes"})]})}),a.jsxs("tbody",{children:[tt.itens.map((D,Q)=>{const M=Xr(D.preco_unitario)||0,H=Xr(D.quantidade)||1,le=M*H,X=Xr(D.desconto_percent)||0,Ce=Xr(D.desconto_valor)||0,we=X?le*X/100:Ce,Z=Math.max(0,le-we+(Xr(D.acrescimos_valor)||0));return a.jsxs(Ee.Fragment,{children:[a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsxs("td",{className:"px-2 py-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Ct,{className:"h-7 text-xs flex-1",value:D.descricao,onChange:ye=>jr(Ne=>{const Re=[...Ne.itens];return Re[Q]={...Re[Q],descricao:ye.target.value},{...Ne,itens:Re}}),placeholder:"Descrio"}),a.jsx(se,{size:"icon",variant:"outline",className:"h-7 w-7 flex-shrink-0",title:"Buscar produto",onClick:()=>{br(Q),yt(!0)},children:a.jsx(Mo,{className:"w-3.5 h-3.5"})})]}),a.jsxs("div",{className:"text-[10px] text-text-secondary",children:[D.codigo||"","  UN ",String(D.unidade||"UN")]})]}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[80px] mx-auto",children:a.jsx(Ct,{className:"h-7 text-right text-xs",value:D.quantidade,onChange:ye=>jr(Ne=>{const Re=[...Ne.itens];return Re[Q]={...Re[Q],quantidade:ye.target.value},{...Ne,itens:Re}})})})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[110px] mx-auto",children:a.jsx(Ct,{className:"h-7 text-right text-xs",value:D.preco_unitario,onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt=Xo(ye.target.value||"");return Re[Q]={...Re[Q],preco_unitario:bt},{...Ne,itens:Re}}),onKeyDown:ye=>{ye.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(ye.key)&&(/^[0-9]$/.test(ye.key)||ye.preventDefault())},onBeforeInput:ye=>{const Ne=ye.data??"";Ne&&/\D/.test(Ne)&&ye.preventDefault()}})})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[110px] mx-auto",children:a.jsx(Ct,{className:"h-7 text-right text-xs",value:D.desconto_valor,onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt=Xo(ye.target.value||"");return Re[Q]={...Re[Q],desconto_valor:bt,desconto_percent:""},{...Ne,itens:Re}}),onKeyDown:ye=>{ye.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(ye.key)&&(/^[0-9]$/.test(ye.key)||ye.preventDefault())},onBeforeInput:ye=>{const Ne=ye.data??"";Ne&&/\D/.test(Ne)&&ye.preventDefault()}})})}),a.jsxs("td",{className:"px-2 py-1 text-right",children:["R$ ",Ls(Z)]}),a.jsx("td",{className:"px-2 py-1 text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(()=>{const ye=D.impostos||{},Ne=ye.icms||{},Re=ye.pis||{},bt=ye.cofins||{};return ye.origem&&(Ne.cst||Ne.csosn)&&Re.aliquota!==void 0&&String(Re.aliquota).trim()!==""&&bt.aliquota!==void 0&&String(bt.aliquota).trim()!==""?null:a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"})})(),a.jsx(se,{size:"sm",variant:"outline",className:"h-7",onClick:()=>Io(ss===Q?null:Q),children:ss===Q?"Ocultar":"Detalhes"}),a.jsx(se,{size:"sm",variant:"outline",className:"h-7",onClick:()=>{jr(ye=>{const Ne=[...ye.itens];return Ne.splice(Q,1),{...ye,itens:Ne}})},children:"Remover"})]})})]}),ss===Q&&a.jsx("tr",{className:"border-t border-border/60 bg-surface-2/40",children:a.jsx("td",{colSpan:6,className:"px-2 py-2",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2",children:[a.jsxs("div",{children:[a.jsx(it,{children:"NCM"}),a.jsx(Ct,{className:"h-7 text-xs",value:D.ncm||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens];return Re[Q]={...Re[Q],ncm:ye.target.value},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{children:"CFOP"}),a.jsx(Ct,{className:"h-7 text-xs",value:D.cfop||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens];return Re[Q]={...Re[Q],cfop:ye.target.value},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(D.impostos?.icms?.cst)&&Ia(D.impostos?.icms?.csosn)?"text-red-400":"",children:"CST/CSOSN"}),a.jsx(Ct,{className:`h-7 text-xs ${Ia(D.impostos?.icms?.cst)&&Ia(D.impostos?.icms?.csosn)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.icms?.cst||D.impostos?.icms?.csosn||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt={...Re[Q].impostos||{},icms:{...Re[Q].impostos?.icms||{},cst:ye.target.value,csosn:ye.target.value}};return Re[Q]={...Re[Q],impostos:bt},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(D.impostos?.origem)?"text-red-400":"",children:"Origem"}),a.jsx(Ct,{className:`h-7 text-xs ${Ia(D.impostos?.origem)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.origem||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt={...Re[Q].impostos||{},origem:ye.target.value};return Re[Q]={...Re[Q],impostos:bt},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{children:"ICMS %"}),a.jsx(Ct,{className:"h-7 text-xs",value:D.impostos?.icms?.aliquota||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt={...Re[Q].impostos?.icms||{},aliquota:ye.target.value};return Re[Q]={...Re[Q],impostos:{...Re[Q].impostos||{},icms:bt}},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{children:"ICMS Base"}),a.jsx(Ct,{className:"h-7 text-xs",value:D.impostos?.icms?.base||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt={...Re[Q].impostos?.icms||{},base:ye.target.value};return Re[Q]={...Re[Q],impostos:{...Re[Q].impostos||{},icms:bt}},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(D.impostos?.pis?.aliquota)?"text-red-400":"",children:"PIS %"}),a.jsx(Ct,{className:`h-7 text-xs ${Ia(D.impostos?.pis?.aliquota)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.pis?.aliquota||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt={...Re[Q].impostos?.pis||{},aliquota:ye.target.value};return Re[Q]={...Re[Q],impostos:{...Re[Q].impostos||{},pis:bt}},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{className:Ia(D.impostos?.cofins?.aliquota)?"text-red-400":"",children:"COFINS %"}),a.jsx(Ct,{className:`h-7 text-xs ${Ia(D.impostos?.cofins?.aliquota)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.cofins?.aliquota||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt={...Re[Q].impostos?.cofins||{},aliquota:ye.target.value};return Re[Q]={...Re[Q],impostos:{...Re[Q].impostos||{},cofins:bt}},{...Ne,itens:Re}})})]}),a.jsxs("div",{children:[a.jsx(it,{children:"IPI %"}),a.jsx(Ct,{className:"h-7 text-xs",value:D.impostos?.ipi?.aliquota||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens],bt={...Re[Q].impostos?.ipi||{},aliquota:ye.target.value};return Re[Q]={...Re[Q],impostos:{...Re[Q].impostos||{},ipi:bt}},{...Ne,itens:Re}})})]}),a.jsxs("div",{className:"md:col-span-4",children:[a.jsx(it,{children:"Observao do item"}),a.jsx(Ct,{className:"h-7 text-xs",value:D.obs||"",onChange:ye=>jr(Ne=>{const Re=[...Ne.itens];return Re[Q]={...Re[Q],obs:ye.target.value},{...Ne,itens:Re}})})]})]})})})]},Q)}),tt.itens.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"px-2 py-3 text-center text-text-secondary",children:'Nenhum item. Use "Adicionar item" para inserir.'})})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{children:"Desconto Geral"}),a.jsx(Ct,{className:"h-8 text-xs text-right",value:tt.totais.desconto_geral,onChange:D=>jr(Q=>({...Q,totais:{...Q.totais,desconto_geral:Xo(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const Q=D.data??"";Q&&/\D/.test(Q)&&D.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Frete"}),a.jsx(Ct,{className:"h-8 text-xs text-right",value:tt.totais.frete,onChange:D=>jr(Q=>({...Q,totais:{...Q.totais,frete:Xo(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const Q=D.data??"";Q&&/\D/.test(Q)&&D.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Outras Despesas"}),a.jsx(Ct,{className:"h-8 text-xs text-right",value:tt.totais.outras_despesas,onChange:D=>jr(Q=>({...Q,totais:{...Q.totais,outras_despesas:Xo(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const Q=D.data??"";Q&&/\D/.test(Q)&&D.preventDefault()}})]}),a.jsx("div",{className:"text-right self-end",children:(()=>{const D=tt.itens||[];let Q=0;D.forEach(Ce=>{const we=Xr(Ce.preco_unitario)||0,Z=Xr(Ce.quantidade)||1,ye=we*Z,Ne=Xr(Ce.desconto_percent)||0,Re=Xr(Ce.desconto_valor)||0,bt=Ne?ye*Ne/100:Re,Rt=Math.max(0,ye-bt+(Xr(Ce.acrescimos_valor)||0));Q+=Rt});const M=Xr(tt.totais.desconto_geral)||0,H=Xr(tt.totais.frete)||0,le=Xr(tt.totais.outras_despesas)||0,X=Q-M+H+le;return a.jsxs("div",{className:"text-sm",children:[a.jsx("div",{className:"text-text-secondary",children:"Total dos Produtos"}),a.jsxs("div",{className:"text-xl font-semibold",children:["R$ ",Ls(Q)]}),a.jsx("div",{className:"text-text-secondary mt-1",children:"Total da Nota"}),a.jsxs("div",{className:"text-xl font-semibold",children:["R$ ",Ls(X)]})]})})()})]})]})}),a.jsx(Gs,{value:"pagamentos",children:(()=>{const D=tt.itens||[];let Q=0;D.forEach((bt,Rt)=>{const dr=Xr(bt.preco_unitario)||0,qt=Xr(bt.quantidade)||1,rr=dr*qt,qr=Xr(bt.desconto_percent)||0,Dn=Xr(bt.desconto_valor)||0,$r=qr?rr*qr/100:Dn,xn=Xr(bt.acrescimos_valor)||0,$n=Math.max(0,rr-$r+xn);Q+=$n});const M=Xr(tt.totais.desconto_geral)||0,H=Xr(tt.totais.frete)||0,le=Xr(tt.totais.outras_despesas)||0,X=Q-M+H+le,Ce=tt.pagamentos||[],we=Ce.reduce((bt,Rt)=>bt+(Xr(Rt.valor)||0),0),Z=(we||0)-(X||0),ye=()=>{jr(bt=>{const Rt=Array.isArray(bt.pagamentos)?[...bt.pagamentos]:[],dr=X||0;return Rt.push({finalizadora_id:"",tipo:"Dinheiro",valor:Xo(dr.toFixed(2)),bandeira:"",autorizacao:"",parcelas:"",troco:""}),{...bt,pagamentos:Rt}})},Ne=bt=>{jr(Rt=>{const dr=Array.isArray(Rt.pagamentos)?[...Rt.pagamentos]:[];return dr.splice(bt,1),{...Rt,pagamentos:dr}})},Re=(bt,Rt)=>{jr(dr=>{const qt=Array.isArray(dr.pagamentos)?[...dr.pagamentos]:[],rr=Xo(Rt||"");return qt[bt]={...qt[bt]||{},valor:rr},{...dr,pagamentos:qt}})};return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Formas de pagamento"}),a.jsx(se,{size:"sm",onClick:ye,children:"Adicionar pagamento"})]}),a.jsx("div",{className:"border border-border rounded-md overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 py-2",children:"Forma"}),a.jsx("th",{className:"text-left px-2 py-2 w-[180px]",children:"Bandeira / Autorizao"}),a.jsx("th",{className:"text-right px-2 py-2 w-[140px]",children:"Valor"}),a.jsx("th",{className:"text-center px-2 py-2 w-[80px]",children:"Aes"})]})}),a.jsxs("tbody",{children:[Ce.map((bt,Rt)=>{const dr=(vs||[]).find(qt=>String(qt.id)===String(bt.finalizadora_id));return a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsxs("td",{className:"px-2 py-1",children:[a.jsxs("select",{className:"h-7 text-xs bg-surface border border-border rounded-md px-1 w-full",value:bt.finalizadora_id||"",onChange:qt=>jr(rr=>{const qr=Array.isArray(rr.pagamentos)?[...rr.pagamentos]:[],Dn=qt.target.value||"",$r=(vs||[]).find(xn=>String(xn.id)===String(Dn));return qr[Rt]={...qr[Rt]||{},finalizadora_id:Dn,tipo:$r?.nome||qr[Rt]?.tipo||""},{...rr,pagamentos:qr}}),children:[a.jsx("option",{value:"",children:"Selecione"}),(vs||[]).map(qt=>a.jsxs("option",{value:qt.id,children:[qt.codigo_interno?`[${qt.codigo_interno}] `:"",qt.nome]},qt.id))]}),a.jsx("div",{className:"text-[10px] text-text-secondary truncate",children:bt.tipo||dr?.nome||""})]}),a.jsx("td",{className:"px-2 py-1",children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx(Ct,{className:"h-7 text-xs",placeholder:"Bandeira (Visa, Master...)",value:bt.bandeira||"",onChange:qt=>jr(rr=>{const qr=Array.isArray(rr.pagamentos)?[...rr.pagamentos]:[];return qr[Rt]={...qr[Rt]||{},bandeira:qt.target.value},{...rr,pagamentos:qr}})}),a.jsx(Ct,{className:"h-7 text-xs",placeholder:"N autorizao (opcional)",value:bt.autorizacao||"",onChange:qt=>jr(rr=>{const qr=Array.isArray(rr.pagamentos)?[...rr.pagamentos]:[];return qr[Rt]={...qr[Rt]||{},autorizacao:qt.target.value},{...rr,pagamentos:qr}})})]})}),a.jsx("td",{className:"px-2 py-1 text-right",children:a.jsx(Ct,{className:"h-7 text-right text-xs",value:bt.valor||"0,00",onChange:qt=>Re(Rt,qt.target.value),onKeyDown:qt=>{qt.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(qt.key)&&(/^[0-9]$/.test(qt.key)||qt.preventDefault())},onBeforeInput:qt=>{const rr=qt.data??"";rr&&/\D/.test(rr)&&qt.preventDefault()}})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx(se,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>Ne(Rt),children:a.jsx(Sf,{className:"w-3.5 h-3.5"})})})]},Rt)}),Ce.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"px-2 py-3 text-center text-text-secondary text-xs",children:'Nenhum pagamento. Use "Adicionar pagamento".'})})]})]})}),a.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-3 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Total da Nota:"})," ",a.jsxs("span",{className:"font-semibold",children:["R$ ",Ls(X)]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Total Pago:"})," ",a.jsxs("span",{className:"font-semibold",children:["R$ ",Ls(we)]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Diferena (Pago - Nota)"}),a.jsxs("div",{className:Math.abs(Z)<.009?"font-semibold text-emerald-500":"font-semibold text-amber-500",children:["R$ ",Ls(Z)]})]})]})]})})()}),a.jsx(Gs,{value:"transporte",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Transporte"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[a.jsxs("div",{children:[a.jsx(it,{className:Ia(tt.transporte?.tipo_frete)?"text-red-400":"",children:"Modalidade do Frete"}),a.jsxs(Gn,{value:tt.transporte?.tipo_frete||"9",onValueChange:D=>jr(Q=>({...Q,transporte:{...Q.transporte||{},tipo_frete:D}})),children:[a.jsx(Vn,{className:`h-8 text-xs ${Ia(tt.transporte?.tipo_frete)?"border-red-500 text-red-400":""}`,children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"0",children:"Por conta do Emitente"}),a.jsx(lt,{value:"1",children:"Por conta do Destinatrio"}),a.jsx(lt,{value:"9",children:"Sem Frete"})]})]})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx(it,{children:"Transportadora (se houver)"}),a.jsx(Ct,{className:"h-8 text-xs",value:tt.transporte?.transportadora||"",onChange:D=>jr(Q=>({...Q,transporte:{...Q.transporte||{},transportadora:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Placa do Veculo"}),a.jsx(Ct,{className:"h-8 text-xs",value:tt.transporte?.placa||"",onChange:D=>jr(Q=>({...Q,transporte:{...Q.transporte||{},placa:(D.target.value||"").toUpperCase()}})),placeholder:"ABC1D23"})]}),a.jsxs("div",{children:[a.jsx(it,{children:"UF da Placa"}),a.jsx(Ct,{className:"h-8 text-xs",value:tt.transporte?.uf_placa||"",onChange:D=>jr(Q=>({...Q,transporte:{...Q.transporte||{},uf_placa:(D.target.value||"").toUpperCase().slice(0,2)}})),placeholder:"UF"})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Qtd. de Volumes"}),a.jsx(Ct,{className:"h-8 text-xs",value:tt.transporte?.volumes||"",onChange:D=>jr(Q=>({...Q,transporte:{...Q.transporte||{},volumes:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Peso Bruto (kg)"}),a.jsx(Ct,{className:"h-8 text-xs",value:tt.transporte?.peso_bruto||"",onChange:D=>jr(Q=>({...Q,transporte:{...Q.transporte||{},peso_bruto:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Peso Lquido (kg)"}),a.jsx(Ct,{className:"h-8 text-xs",value:tt.transporte?.peso_liquido||"",onChange:D=>jr(Q=>({...Q,transporte:{...Q.transporte||{},peso_liquido:D.target.value}}))})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Informaes Adicionais"}),a.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{children:"Observaes Fiscais"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:tt.adicionais?.info_fisco||"",onChange:D=>jr(Q=>({...Q,adicionais:{...Q.adicionais||{},info_fisco:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Informaes Complementares"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:tt.adicionais?.obs_gerais||"",onChange:D=>jr(Q=>({...Q,adicionais:{...Q.adicionais||{},obs_gerais:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Observaes Legais"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:tt.adicionais?.obs_legais||"",onChange:D=>jr(Q=>({...Q,adicionais:{...Q.adicionais||{},obs_legais:D.target.value}}))})]})]})]})]})}),a.jsx(Gs,{value:"totais",children:(()=>{const D=tt.itens||[];let Q=0,M=0,H=0,le=0,X=0,Ce=0,we=0,Z=0,ye=0,Ne=0;D.forEach(Dn=>{const $r=Xr(Dn.preco_unitario)||0,xn=Xr(Dn.quantidade)||1,$n=$r*xn,_n=Xr(Dn.desconto_percent)||0,un=Xr(Dn.desconto_valor)||0,Ca=_n?$n*_n/100:un,Zn=Xr(Dn.acrescimos_valor)||0,Mn=Math.max(0,$n-Ca+Zn);Q+=Mn,M+=Ca;const Yr=Xr(Dn.impostos?.icms?.base)||Mn,Sn=Xr(Dn.impostos?.icms?.aliquota)||0,Da=Yr*Sn/100;H+=Yr,le+=Da;const Ha=Xr(Dn.impostos?.pis?.aliquota)||0,Xs=Xr(Dn.impostos?.cofins?.aliquota)||0,jo=Xr(Dn.impostos?.ipi?.aliquota)||0;X+=Mn*Ha/100,Ce+=Mn*Xs/100,we+=Mn*jo/100,Z+=Xr(Dn.frete_valor)||0,ye+=Xr(Dn.seguro_valor)||0,Ne+=Zn});const Re=Xr(tt.totais.desconto_geral)||0,bt=Xr(tt.totais.frete)||0,Rt=Xr(tt.totais.outras_despesas)||0,dr=Z+bt,qt=ye,rr=Ne+Rt,qr=Q-Re+dr+qt+rr;return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Total dos Produtos"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",Ls(Q)]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Total de Descontos"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",Ls(M+Re)]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Valor Total da Nota"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",Ls(qr)]})]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface space-y-3",children:[a.jsx("div",{className:"text-sm font-medium mb-1",children:"ICMS / PIS / COFINS / IPI"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 text-xs",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Base de Clculo ICMS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(H)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do ICMS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(le)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do PIS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(X)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do COFINS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(Ce)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do IPI"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(we)]})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface space-y-2 text-xs",children:[a.jsx("div",{className:"text-sm font-medium mb-1",children:"Outros Valores"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Frete"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(dr)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Seguro"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(qt)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Outras Despesas"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(rr)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Desconto Geral"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Ls(Re)]})]})]})]})]})})()}),a.jsx(Gs,{value:"resumo",children:(()=>{const D=tt.itens||[];let Q=0;D.forEach(Pn=>{const Rn=Xr(Pn.preco_unitario)||0,va=Xr(Pn.quantidade)||1,Ga=Rn*va,hs=Xr(Pn.desconto_percent)||0,to=Xr(Pn.desconto_valor)||0,Ts=hs?Ga*hs/100:to,Ys=Xr(Pn.acrescimos_valor)||0,Bo=Math.max(0,Ga-Ts+Ys);Q+=Bo});const M=Xr(tt.totais?.desconto_geral)||0,H=Xr(tt.totais?.frete)||0,le=Xr(tt.totais?.outras_despesas)||0,X=Q-M+H+le,Ce=(tt.pagamentos||[]).reduce((Pn,Rn)=>Pn+(Xr(Rn.valor)||0),0),we=Ce-X,Z=String(tt.modelo)==="65",ye=String(tt.modelo)==="55",Ne=!!(tt.modelo&&tt.serie&&tt.natOp&&tt.data_emissao&&tt.tipo_nota&&tt.idDest&&(tt.indFinal??"")!==""&&(tt.indPres??"")!==""&&tt.finNFe),Re=Te?.cidade_ibge||Te?.codigo_municipio_ibge||Te?.codigo_ibge_municipio||Te?.ibge||Te?.cod_municipio||"",bt=!!(Te&&Te.cnpj&&Te.razao_social&&Te.regime_tributario&&Te.inscricao_estadual&&Te.logradouro&&(Te.numero||Te.nro)&&Te.bairro&&Te.cidade&&Te.uf&&Te.cep&&Re),Rt=!!(tt?.nome||tt?.cpf_cnpj),dr=ye,qt=!!(tt?.cpf_cnpj&&tt?.nome&&tt?.indIEDest&&tt?.logradouro&&tt?.numero&&tt?.bairro&&tt?.cidade&&tt?.uf&&tt?.cep),rr=dr||Rt?qt:!0,qr=Array.isArray(D)&&D.length>0,Dn=qr&&D.every(Pn=>(Pn.codigo||Pn.descricao)&&Pn.ncm&&Pn.cfop&&Pn.unidade&&Xr(Pn.quantidade)>0&&(Pn.preco_unitario||Pn.preco_unitario==="0,00")),$r=qr&&D.every(Pn=>{const Rn=Pn.impostos||{},va=Rn.icms||{},Ga=Rn.pis||{},hs=Rn.cofins||{},to=!!(Rn.origem!==void 0&&Rn.origem!==""&&(va.cst||va.csosn)),Ts=Ga.aliquota!==void 0&&String(Ga.aliquota).trim()!=="",Ys=hs.aliquota!==void 0&&String(hs.aliquota).trim()!=="";return to&&Ts&&Ys}),xn=(()=>{let Pn=0;return D.forEach(Rn=>{const va=(Xr(Rn.preco_unitario)||0)*(Xr(Rn.quantidade)||1)-(Xr(Rn.desconto_percent)?(Xr(Rn.preco_unitario)||0)*(Xr(Rn.quantidade)||1)*(Xr(Rn.desconto_percent)||0)/100:Xr(Rn.desconto_valor)||0)+(Xr(Rn.acrescimos_valor)||0),Ga=Xr(Rn.impostos?.icms?.base);Pn+=isFinite(Ga)&&Ga>0?Ga:va}),Pn})(),$n=D.reduce((Pn,Rn)=>Pn+(Xr(Rn.impostos?.icms?.base)||(Xr(Rn.preco_unitario)||0)*(Xr(Rn.quantidade)||1))*(Xr(Rn.impostos?.icms?.aliquota)||0)/100,0),_n=D.reduce((Pn,Rn)=>Pn+(Xr(Rn.preco_unitario)||0)*(Xr(Rn.quantidade)||1)*(Xr(Rn.impostos?.pis?.aliquota)||0)/100,0),un=D.reduce((Pn,Rn)=>Pn+(Xr(Rn.preco_unitario)||0)*(Xr(Rn.quantidade)||1)*(Xr(Rn.impostos?.cofins?.aliquota)||0)/100,0),Ca=D.reduce((Pn,Rn)=>Pn+(Xr(Rn.preco_unitario)||0)*(Xr(Rn.quantidade)||1)*(Xr(Rn.impostos?.ipi?.aliquota)||0)/100,0),Zn=$n+_n+un+Ca,Mn=[X,xn,$n,_n,un,Ca,H,M,le,Zn].every(Pn=>Pn!=null&&!Number.isNaN(Pn)),Yr=!!(tt.transporte&&tt.transporte.tipo_frete),Sn=Ce+.009>=X,Ha=!(Z&&(tt.pagamentos||[]).some(Pn=>{const Rn=(vs||[]).find(Ga=>String(Ga.id)===String(Pn.finalizadora_id)),va=String(Pn.tipo||Rn?.nome||"").toLowerCase();return va.includes("cart")||va.includes("crdit")||va.includes("credit")||va.includes("db")||va.includes("deb")}))||(tt.pagamentos||[]).every(Pn=>{const Rn=(vs||[]).find(hs=>String(hs.id)===String(Pn.finalizadora_id)),va=String(Pn.tipo||Rn?.nome||"").toLowerCase();return!(va.includes("cart")||va.includes("crdit")||va.includes("credit")||va.includes("db")||va.includes("deb"))||!!(Pn.bandeira&&Pn.bandeira.trim())}),Xs=Z?(tt.pagamentos||[]).length>0&&Sn&&Ha:!0,jo=Ne&&bt&&qr&&Dn&&$r&&Mn&&Yr&&rr&&Xs,jn=({ok:Pn,label:Rn,extra:va})=>a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border/60 last:border-b-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[Pn?a.jsx(hb,{className:"w-4 h-4 text-emerald-500"}):a.jsx(Df,{className:"w-4 h-4 text-amber-500"}),a.jsx("div",{className:"text-sm",children:Rn})]}),va?a.jsx("div",{className:"text-xs text-text-secondary",children:va}):null]});return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface",children:[a.jsx("div",{className:"text-sm font-medium px-3 py-2",children:"Checklist"}),a.jsxs("div",{children:[a.jsx(jn,{ok:Ne,label:"Identificao"}),a.jsx(jn,{ok:bt,label:"Emitente"}),a.jsx(jn,{ok:rr,label:"Destinatrio",extra:Z&&!Rt?"Opcional na NFC-e":tt?.nome||""}),a.jsx(jn,{ok:qr,label:"Itens",extra:`${D.length} item(ns)`}),a.jsx(jn,{ok:Dn,label:"Produtos completos"}),a.jsx(jn,{ok:$r,label:"Impostos por item"}),a.jsx(jn,{ok:Mn,label:"Totais"}),a.jsx(jn,{ok:Yr,label:"Transporte"}),a.jsx(jn,{ok:Xs,label:"Pagamento",extra:Z?`Pago R$ ${Ls(Ce)}  Nota R$ ${Ls(X)}`:void 0})]})]}),a.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-3",children:[a.jsxs("div",{className:"text-sm text-text-secondary",children:[a.jsxs("div",{children:["Total da Nota: ",a.jsxs("span",{className:"text-text-primary font-semibold",children:["R$ ",Ls(X)]})]}),a.jsxs("div",{children:["Total Pago: ",a.jsxs("span",{className:"text-text-primary font-semibold",children:["R$ ",Ls(Ce)]})]}),a.jsxs("div",{children:["Diferena: ",a.jsxs("span",{className:Math.abs(we)<.009?"text-emerald-500 font-semibold":"text-amber-500 font-semibold",children:["R$ ",Ls(we)]})]})]}),a.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[a.jsx(se,{size:"sm",variant:"outline",onClick:async()=>{const Pn=[];Ne||Pn.push("Preencha os dados de identificao da nota"),bt||Pn.push("Complete os dados da empresa (CNPJ, endereo, inscrio, regime)"),rr||Pn.push(ye?"Informe os dados do destinatrio":"Revise os dados do destinatrio preenchidos"),qr||Pn.push("Adicione pelo menos um item na nota"),Dn||Pn.push("Revise os campos obrigatrios dos itens (produto, NCM, CFOP, unidade, quantidade, preo)"),$r||Pn.push("Preencha os impostos de todos os itens (origem, ICMS, PIS e COFINS)"),Mn||Pn.push("Verifique os totais da nota"),Yr||Pn.push("Informe a modalidade do frete em Transporte"),Xs||Pn.push("Revise a forma de pagamento e o valor pago"),Pn.length?r({title:"Ainda faltam dados para emitir",description:Pn.join("  "),variant:"warning"}):r({title:"Tudo certo",description:"A nota est pronta para emitir",variant:"success"})},children:"Validar Nota"}),a.jsx(se,{size:"sm",disabled:!jo,onClick:Zi,children:"Emitir Nota"}),a.jsx(se,{size:"sm",variant:"outline",onClick:ht,children:"Salvar Rascunho"}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>Tt(!1),children:"Cancelar Emisso"})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3 text-xs text-text-secondary",children:[a.jsx("div",{className:"mb-1 font-medium text-text-primary",children:"Ps-Emisso"}),a.jsx("div",{children:"Aps a emisso, exibiremos o status SEFAZ, chave de acesso, links do XML e DANFE, e opes de envio por e-mail ou WhatsApp."})]})]})})()})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(se,{onClick:ht,disabled:Wt,children:Wt?"Salvando...":"Salvar rascunho"}),a.jsx(se,{variant:"outline",onClick:()=>Tt(!1),children:"Fechar"})]}),!1]})}),a.jsx(In,{open:Vs,onOpenChange:ii,children:a.jsxs(En,{className:"w-[95vw] sm:max-w-[800px] max-h-[85vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"XML gerado"}),a.jsx(Hn,{children:"Faa o download ou salve no Supabase."})]}),a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Prvia do XML"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{size:"sm",variant:"outline",onClick:()=>RV(`nfe-manual-${Date.now()}.xml`,Ar),children:"Baixar XML"}),a.jsx(se,{size:"sm",onClick:async()=>{try{Ht(!0);const D=`nfe/${t}/manual-${Date.now()}.xml`,Q=new Blob([Ar],{type:"text/xml;charset=utf-8"}),{error:M}=await re.storage.from("fiscal").upload(D,Q,{contentType:"text/xml"});if(M)throw M;r({title:"XML salvo no Supabase"})}catch(D){r({title:"Falha ao salvar",description:D.message,variant:"destructive"})}finally{Ht(!1)}},disabled:Wt,children:Wt?"Salvando...":"Salvar no Supabase"})]})]}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto border border-border rounded p-2 bg-surface-2",children:Ar})]})}),a.jsx(In,{open:rn,onOpenChange:Ke,children:a.jsxs(En,{className:"w-[95vw] sm:max-w-[680px] md:max-w-[860px] lg:max-w-[900px] max-h-[85vh] overflow-y-auto",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Emisso NF-e (XML offline)"}),a.jsx(Hn,{children:"Preencha os campos abaixo e gere o XML da NF-e. Transmisso para SEFAZ ficar para a prxima etapa."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{children:"Natureza da Operao (natOp)"}),a.jsx(Ct,{value:dt.natOp,onChange:D=>Mt(Q=>({...Q,natOp:D.target.value})),placeholder:"VENDA"})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Srie"}),a.jsx(Ct,{value:dt.serie,onChange:D=>Mt(Q=>({...Q,serie:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Nmero (nNF)"}),a.jsx(Ct,{value:dt.nNF,onChange:D=>Mt(Q=>({...Q,nNF:D.target.value})),placeholder:"(opcional)"})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Destino da Operao (idDest)"}),a.jsxs(Gn,{value:dt.idDest||"auto",onValueChange:D=>Mt(Q=>({...Q,idDest:D})),children:[a.jsx(Vn,{children:a.jsx(Kn,{placeholder:"Automtico"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"auto",children:"Automtico"}),a.jsx(lt,{value:"1",children:"Interna (mesmo estado)"}),a.jsx(lt,{value:"2",children:"Interestadual"}),a.jsx(lt,{value:"3",children:"Exterior"})]})]})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Consumidor Final (indFinal)"}),a.jsxs(Gn,{value:dt.indFinal,onValueChange:D=>Mt(Q=>({...Q,indFinal:D})),children:[a.jsx(Vn,{children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"1",children:"Sim"}),a.jsx(lt,{value:"0",children:"No"})]})]})]}),a.jsxs("div",{children:[a.jsx(it,{children:"Presena do Comprador (indPres)"}),a.jsxs(Gn,{value:dt.indPres,onValueChange:D=>Mt(Q=>({...Q,indPres:D})),children:[a.jsx(Vn,{children:a.jsx(Kn,{})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"1",children:"Operao presencial"}),a.jsx(lt,{value:"2",children:"No presencial, internet"}),a.jsx(lt,{value:"4",children:"Entrega em domiclio"}),a.jsx(lt,{value:"9",children:"No se aplica"})]})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(se,{variant:"outline",onClick:()=>Ke(!1),children:"Fechar"}),a.jsx(se,{onClick:Yn,disabled:qe,children:qe?"Gerando...":"Gerar XML"})]}),Je&&a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Prvia do XML Gerado"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(se,{size:"sm",variant:"outline",onClick:()=>RV(`nfe-${ct||"doc"}.xml`,Je),children:"Baixar XML"}),a.jsx(se,{size:"sm",onClick:Ir,disabled:ce,children:ce?"Salvando...":"Salvar no Supabase"})]})]}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto border border-border rounded p-2 bg-surface-2",children:Je})]})]})})]})}function RV(e,t){try{const r=new Blob([t],{type:"text/xml;charset=utf-8"}),n=URL.createObjectURL(r),s=document.createElement("a");s.href=n,s.download=e,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(n)}catch{}}const nlt=(e,t,r)=>e.split(/(\*\*.*?\*\*)/g).map((s,o)=>{if(s.startsWith("**")&&s.endsWith("**")){const i=s.slice(2,-2);return a.jsx("strong",{className:`font-black ${t?r?"text-white":"text-[#000000]":"text-white"}`,style:{fontWeight:900,textShadow:t?r?"0 0 1px rgba(0,0,0,0.25)":"0 0 1px rgba(0,0,0,0.3)":"0 0 1px rgba(255,255,255,0.5)"},children:i},o)}return s}),Moe=({message:e})=>{const t=e.from==="isis",r=t&&e?.color==="green",n=t&&e?.color==="system",[s,o]=p.useState(!1),{selections:i}=l5(),{clientIdentified:l,userInitial:c}=p.useMemo(()=>{const u=i?.contato?.nome||i?.cliente?.nome||"",f=String(u).trim(),h=f?f[0]:"",m=h&&/[A-Za-z---]/.test(h)?h.toUpperCase():"U";return{clientIdentified:!!u,userInitial:m}},[i?.contato?.nome,i?.cliente?.nome]),d=async u=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(u);else{const f=document.createElement("textarea");f.value=u,f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.opacity="0",document.body.appendChild(f),f.focus(),f.select(),document.execCommand("copy"),document.body.removeChild(f)}o(!0),setTimeout(()=>o(!1),1800)}catch{}};return a.jsx(Er.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:[.22,1,.36,1]},className:`flex ${t?"justify-start":"justify-end"} mb-4 md:mb-6`,children:a.jsxs("div",{className:`flex items-end gap-2 md:gap-3 max-w-[90%] md:max-w-[85%] lg:max-w-[75%] ${!t&&"flex-row-reverse"}`,children:[t?a.jsx(Hi,{size:"sm",variant:"message",className:"md:w-14 md:h-14"}):l?a.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center flex-shrink-0 bg-brand/10 text-brand ring-2 ring-brand/60",children:a.jsx("span",{className:"font-extrabold text-base md:text-lg leading-none select-none",children:c})}):a.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center flex-shrink-0 bg-surface border border-white/10 text-text-muted",children:a.jsx(xf,{className:"w-5 h-5 md:w-6 md:h-6"})}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("div",{className:`relative px-3 py-2.5 md:px-5 md:py-3.5 backdrop-blur-sm transition-all duration-300 ${t?r?"bg-emerald-600/90 border border-emerald-400 text-white rounded-2xl rounded-bl-sm shadow-lg shadow-emerald-600/30":n?"bg-surface/70 border border-white/10 text-text-muted rounded-2xl rounded-bl-sm":"bg-brand border border-brand text-[#0A0A0A] rounded-2xl rounded-bl-sm shadow-lg shadow-brand/20":"bg-surface/70 border border-white/10 text-text-primary rounded-2xl rounded-br-sm"}`,children:[a.jsx("p",{className:"text-[15px] md:text-[15px] font-bold leading-relaxed whitespace-pre-wrap tracking-wide relative",children:nlt(e.text,t,r)}),e.copyable&&a.jsx("button",{type:"button",onClick:()=>d(e.copyText||(typeof e.text=="string"?e.text:"")),className:`absolute right-2 bottom-2 p-1.5 md:p-2 rounded-full border shadow-sm transition ${t?"bg-white/80 border-white/40 text-[#0A0A0A] hover:bg-white":"bg-white/10 border-white/10 text-text-primary hover:bg-white/20"}`,"aria-label":"Copiar texto",children:s?a.jsx(Sm,{className:"w-4 h-4"}):a.jsx(Q4,{className:"w-4 h-4"})})]}),a.jsx("p",{className:`text-[10px] md:text-[10px] text-text-muted px-2 ${t?"text-left":"text-right"}`,children:sr(e.timestamp,"HH:mm")})]})]})})};function alt(){const[e,t]=p.useState([]),[r,n]=p.useState(""),[s,o]=p.useState(!1),[i,l]=p.useState(""),[c,d]=p.useState(!0),u=p.useRef(null),{company:f,userProfile:h,user:m}=qs();p.useEffect(()=>{const b={id:Date.now()+Math.random(),from:"isis",text:"Ol! Eu sou a verso Premium da sis, integrada  OpenAI. Em que posso ajudar? ",timestamp:new Date};t([b])},[]),p.useEffect(()=>{const b=setTimeout(()=>{u.current?.scrollIntoView({behavior:"smooth",block:"end"})},100);return()=>clearTimeout(b)},[e,s]);const x=b=>{t(w=>[...w,{id:Date.now()+Math.random(),timestamp:new Date,...b}])},g=b=>{const w=String(b||"").toLowerCase();return w?w.includes("agend")||w.includes("agenda")?w.includes("hoje")?"Consultando os agendamentos de hoje...":w.includes("amanh")?"Consultando os agendamentos de amanh...":"Consultando seus agendamentos...":w.includes("cliente")?"Buscando informaes de clientes...":w.includes("caixa")||w.includes("faturamento")||w.includes("financeiro")||w.includes("venda")||w.includes("pagamento")?"Analisando movimentaes da sua arena...":w.includes("quadra")||w.includes("reserva")?"Verificando horrios e quadras disponveis...":"...":"..."},y=async(b,w)=>{try{const _=f?.codigoEmpresa||f?.codigo_empresa||null,j=h?.id||m?.id||null,S=h?.nome||m?.email||null,C=h?.cargo||null,A=new Date,P=new Date(A.getFullYear(),A.getMonth(),A.getDate(),0,0,0,0),F=new Date(P);F.setDate(F.getDate()+1);const O=P.toISOString(),I=F.toISOString(),T=Array.isArray(w)?w.map(L=>({role:L.from==="isis"?"assistant":"user",content:L.text})):[],{data:k,error:B}=await re.functions.invoke("chat-proxy",{body:{message:b,empresaCodigo:_,usuarioId:j,usuarioNome:S,usuarioCargo:C,data_inicio:O,data_fim:I,history:T}});if(B)throw B;const z=typeof k?.reply=="string"&&k.reply.trim().length>0?k.reply:"Certo! (resposta provisria)";let U=Array.isArray(k?.replies)?k.replies.filter(L=>typeof L=="string"&&L.trim().length>0):[];if(U.length===0&&(U=[z]),console.log("[sis][response]",{replies:U,raw:k}),k)try{console.log("[sis][response raw JSON]",JSON.stringify(k,null,2))}catch{}for(let L=0;L<U.length;L++){const W=U[L];x({from:"isis",text:W}),L<U.length-1&&await new Promise(ge=>setTimeout(ge,600))}o(!1),l("")}catch{x({from:"isis",text:"No momento, estou operando em modo de demonstrao. Em breve estarei 100% conectada  OpenAI aqui na aba Premium! "}),o(!1),l("")}},v=async b=>{b.preventDefault();const w=r.trim();if(!w)return;const _=[...e];console.log("[sis][question]",{message:w}),x({from:"user",text:w}),n(""),o(!0),l(g(w)),await y(w,_)};return a.jsxs("div",{className:"flex h-full w-full relative",children:[a.jsxs("div",{className:"flex-1 flex flex-col pointer-events-none",children:[a.jsxs("div",{className:"flex-1 overflow-y-auto px-3 md:px-6 py-4 md:py-6",children:[e.map(b=>a.jsx(Moe,{message:b},b.id)),s&&a.jsx(Er.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start mb-4",children:a.jsx("div",{className:"px-4 py-2 rounded-2xl bg-brand border border-brand text-[#0A0A0A] flex items-center gap-2 animate-pulse",children:i&&i!=="..."?a.jsxs(a.Fragment,{children:[a.jsx("span",{role:"img","aria-label":"pensando",children:""}),a.jsx("span",{children:i})]}):a.jsx("span",{className:"font-semibold tracking-widest",children:"..."})})}),a.jsx("div",{ref:u})]}),a.jsx("div",{className:"sticky bottom-0 px-3 md:px-6 pb-3 md:pb-6 pt-3 md:pt-4 bg-gradient-to-t from-background via-background to-transparent",children:a.jsxs("form",{onSubmit:v,className:"flex items-center gap-2 bg-surface/70 border border-white/10 rounded-xl px-3 py-2.5",children:[a.jsx(vG,{className:"w-5 h-5 text-text-muted"}),a.jsx("input",{value:r,onChange:b=>n(b.target.value),placeholder:"Escreva aqui",className:"flex-1 bg-transparent outline-none text-sm"}),a.jsxs("button",{type:"submit",disabled:!r.trim(),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-semibold transition ${r.trim()?"bg-brand text-bg":"bg-surface/40 text-text-muted cursor-not-allowed"}`,children:[a.jsx(Z4,{className:"w-4 h-4"}),"Enviar"]})]})})]}),c&&a.jsx("div",{className:"absolute inset-0 z-10 backdrop-blur-lg bg-black/60 flex items-center justify-center pointer-events-auto rounded-lg overflow-hidden",children:a.jsx(Er.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},transition:{duration:.5,ease:[.22,1,.36,1]},className:"rounded-2xl border border-white/30 bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 shadow-2xl max-w-sm w-full text-center mx-4 overflow-hidden",children:a.jsxs("div",{className:"px-8 py-10",children:[a.jsx(Er.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.2,duration:.4},className:"flex items-center justify-center mb-8",children:a.jsx("div",{className:"w-24 h-24 rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_20px_rgba(168,85,247,0.5)] overflow-hidden",children:a.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-background flex items-center justify-center",children:a.jsx(Hi,{size:"lg"})})})}),a.jsxs(Er.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},children:[a.jsx("div",{className:"text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 via-violet-300 to-emerald-300 mb-4",children:"sis"}),a.jsx("p",{className:"text-sm text-gray-300 mb-6 leading-relaxed",children:"Em breve sua assistente IA vai estar pronta para revolucionar a gesto da sua arena. "}),a.jsxs("div",{className:"space-y-3 text-left",children:[a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-emerald-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Gerencie agendamentos com inteligncia artificial"})]}),a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-violet-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Otimize sua agenda e maximize ocupao"})]}),a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-fuchsia-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Insights inteligentes sobre sua arena"})]})]})]})]})})})]})}function slt(){const{company:e}=qs(),{clearIsisAlerts:t}=t2(),r=e?.codigo_empresa||e?.codigoEmpresa||null,[n,s]=p.useState(!0),[o,i]=p.useState(null),[l,c]=p.useState(!1),[d,u]=p.useState(null),[f,h]=p.useState(""),[m,x]=p.useState(""),[g,y]=p.useState(!1),[v,b]=p.useState(!1),[w,_]=p.useState(!1),[j,S]=p.useState(""),[C,A]=p.useState(""),[P,F]=p.useState(""),[O,I]=p.useState(!1),[T,k]=p.useState({agendamentosIsisTotal:0,agendamentosIsisHoje:0,agendamentosIsis7d:0,agendamentosTotal7d:0,cancelamentosIsis7d:0,perDay7d:[],topQuadras30d:[],ultimasInteracoes:[]}),[B,z]=p.useState({}),U=J=>{if(!J)return"";const G=J instanceof Date?J:new Date(J);if(isNaN(G.getTime()))return"";const ue=G.getFullYear(),ve=String(G.getMonth()+1).padStart(2,"0"),ae=String(G.getDate()).padStart(2,"0");return`${ue}-${ve}-${ae}`},L=J=>{if(!J)return null;const G=/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/.exec(String(J));if(!G)return null;const ue=parseInt(G[1],10),ve=parseInt(G[2],10)-1,ae=parseInt(G[3],10),oe=new Date(ue,ve,ae,0,0,0,0);return isNaN(oe.getTime())?null:oe},W=J=>{try{if(!J)return"";const G=J instanceof Date?J:new Date(J);return isNaN(G.getTime())?"":G.toLocaleDateString("pt-BR")}catch{return""}};p.useEffect(()=>{try{t?.()}catch{}},[t]),p.useEffect(()=>{if(!r||f||m)return;const J=new Date,G=new Date;G.setDate(G.getDate()-6);const ue=U(G),ve=U(J);try{console.log("[IsisAnalytics] Init default range (auto-fill):",{startYmd:ue,endYmd:ve})}catch{}h(ue),x(ve)},[r]),p.useEffect(()=>{!g||!e?.id||(async()=>{try{b(!0);const{data:J,error:G}=await re.from("agenda_settings").select("isis_cancel_min_hours_before, isis_subdomain, isis_display_name").eq("empresa_id",e.id).single();if(G&&G.code!=="PGRST116")throw G;if(J)S(J.isis_cancel_min_hours_before??""),A(J.isis_subdomain||""),F(J.isis_display_name||"");else{const ue=(e.nome_fantasia||"").toLowerCase().replace(/[^a-z0-9]+/g,"");A(ue),F(e.nome_fantasia||"")}}catch(J){console.error("[IsisSettings] Erro ao carregar:",J)}finally{b(!1)}})()},[g,e?.id,e?.nome_fantasia]);const ge=async()=>{if(e?.id)try{_(!0);const J=j===""?null:parseInt(j,10);if(J!==null&&(isNaN(J)||J<0)){alert("Horas de cancelamento deve ser um nmero >= 0"),_(!1);return}const G=(C||"").toLowerCase().replace(/[^a-z0-9]+/g,"");if(!G){alert("Subdomnio no pode estar vazio"),_(!1);return}const ue=(P||"").trim();if(!ue){alert("Nome de exibio no pode estar vazio"),_(!1);return}const{error:ve}=await re.from("agenda_settings").upsert({empresa_id:e.id,isis_cancel_min_hours_before:J,isis_subdomain:G,isis_display_name:ue},{onConflict:"empresa_id"});if(ve)throw ve;A(G),F(ue),I(!1),y(!1)}catch(J){console.error("[IsisSettings] Erro ao salvar:",J),alert("Erro ao salvar configuraes: "+(J?.message||"desconhecido"))}finally{_(!1)}},Ae={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.1,delayChildren:.15}}},V={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}},$=({icon:J,title:G,value:ue,color:ve="brand"})=>a.jsxs(Er.div,{variants:V,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5",style:{color:`var(--${ve})`},children:a.jsx(J,{className:"h-5 w-5"})})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider mb-2",children:G}),a.jsx("p",{className:"text-3xl font-bold text-text-primary tabular-nums tracking-tight",children:ue})]})]}),Y=p.useMemo(()=>(T.perDay7d||[]).map(J=>({name:new Date(J.date).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"}),total:J.total,isis:J.isis})),[T.perDay7d]);p.useEffect(()=>{let J=!0;return(async()=>{try{s(!0),i(null);const G=Qe=>{const et=new Date(Qe);return et.setHours(0,0,0,0),et},ue=Qe=>{const et=new Date(Qe);return et.setHours(23,59,59,999),et},ve=G(new Date),ae=ue(new Date),oe=new Date;oe.setDate(oe.getDate()-6);const me=G(oe),De=ae,ne=new Date;ne.setDate(ne.getDate()-29);const ie=G(ne);console.log("[IsisAnalytics] codigoEmpresa:",r,"company obj:",e);const{count:ht,error:pt}=await re.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("created_by_isis",!0);if(pt)throw pt;console.log("[IsisAnalytics] HOJE intervalo criado_em:",ve.toISOString(),"->",ae.toISOString());let vt=(await re.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",ve.toISOString()).lte("criado_em",ae.toISOString()))?.count??null;if(vt==null){const{data:Qe}=await re.from("agendamentos").select("id").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",ve.toISOString()).lte("criado_em",ae.toISOString());vt=(Qe||[]).length}console.log("[IsisAnalytics] agIsisHoje (count resolved):",vt),console.log("[IsisAnalytics] 7d intervalo criado_em:",me.toISOString(),"->",De.toISOString());const{data:wt}=await re.from("agendamentos").select("id, criado_em").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",me.toISOString()).lte("criado_em",De.toISOString());console.log("[IsisAnalytics] agIsis7dRows length:",(wt||[]).length);const{data:gt}=await re.from("agendamentos").select("id, inicio").eq("codigo_empresa",r).gte("inicio",me.toISOString()).lte("inicio",De.toISOString());let _e=(await re.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("canceled_by","isis").gte("canceled_at",me.toISOString()).lte("canceled_at",De.toISOString()))?.count??null;if(_e==null){const{data:Qe}=await re.from("agendamentos").select("id").eq("codigo_empresa",r).eq("canceled_by","isis").gte("canceled_at",me.toISOString()).lte("canceled_at",De.toISOString());_e=(Qe||[]).length}console.log("[IsisAnalytics] cancelamentosIsis7d (count resolved - canceled_by=isis):",_e);const Pt=Array.isArray(wt)?wt.length:0,Lt=Array.isArray(gt)?gt.length:0,gr=Qe=>{const et=new Date(Qe);return et.setHours(0,0,0,0),et.toISOString().slice(0,10)},fr={};for(let Qe=0;Qe<7;Qe++){const et=new Date(me);et.setDate(me.getDate()+Qe),fr[gr(et)]={date:new Date(et),isis:0,total:0}}(gt||[]).forEach(Qe=>{const et=gr(Qe.inicio);fr[et]&&(fr[et].total+=1)}),(wt||[]).forEach(Qe=>{const et=Qe.inicio||Qe.criado_em,Yt=gr(et);fr[Yt]&&(fr[Yt].isis+=1)});const je=Object.values(fr),{data:nt}=await re.from("agendamentos").select("quadra_id").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("inicio",ie.toISOString()).lte("inicio",ae.toISOString()),$t=new Map;(nt||[]).forEach(Qe=>{Qe?.quadra_id&&$t.set(Qe.quadra_id,($t.get(Qe.quadra_id)||0)+1)});const Ut=Array.from($t.keys());let Fe={};if(Ut.length>0){const{data:Qe}=await re.from("quadras").select("id, nome").in("id",Ut);(Qe||[]).forEach(et=>{Fe[et.id]=et.nome})}const xt=Array.from($t.entries()).map(([Qe,et])=>({id:Qe,nome:Fe[Qe]||"Quadra",count:et})).sort((Qe,et)=>et.count-Qe.count).slice(0,5),{data:Ot}=await re.from("agendamentos").select("modalidade").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("inicio",ie.toISOString()).lte("inicio",ae.toISOString()),Cr=new Map;(Ot||[]).forEach(Qe=>{const et=(Qe?.modalidade||"").trim();et&&Cr.set(et,(Cr.get(et)||0)+1)});const Me=Array.from(Cr.entries()).map(([Qe,et])=>({nome:Qe,count:et})).sort((Qe,et)=>et.count-Qe.count).slice(0,5);if(!J)return;k(Qe=>({...Qe,agendamentosIsisTotal:ht||0,agendamentosIsisHoje:vt||0,agendamentosIsis7d:Pt,agendamentosTotal7d:Lt,cancelamentosIsis7d:_e||0,perDay7d:je,topQuadras30d:xt,topModalidades30d:Me})),s(!1)}catch(G){if(!J)return;i(G?.message||"Erro ao carregar mtricas"),s(!1)}})(),()=>{J=!1}},[r,e?.nome_fantasia,e?.razao_social]),p.useEffect(()=>{let J=!0;return(async()=>{if(r)try{c(!0),u(null);const G=fr=>{const je=new Date(fr);return je.setHours(0,0,0,0),je},ue=fr=>{const je=new Date(fr);return je.setHours(23,59,59,999),je},ae=U(new Date),oe=new Date;oe.setDate(oe.getDate()-6);const me=U(oe),De=f||me,ne=m||ae;let ie=re.from("agendamentos").select("id, codigo, inicio, fim, criado_em, status, cliente_id, clientes, quadra_id").eq("codigo_empresa",r).eq("created_by_isis",!0).order("criado_em",{ascending:!1}).order("inicio",{ascending:!1});const ht=!!(De||ne),pt=De?G(L(De)).toISOString():null,Ze=ne?ue(L(ne)).toISOString():null;if(pt||Ze){const fr=[],je=[];pt&&je.push(`criado_em.gte.${pt}`),Ze&&je.push(`criado_em.lte.${Ze}`),je.length>0&&fr.push(`and(${je.join(",")})`);const nt=["criado_em.is.null"];pt&&nt.push(`inicio.gte.${pt}`),Ze&&nt.push(`inicio.lte.${Ze}`),fr.push(`and(${nt.join(",")})`),ie=ie.or(fr.join(","))}ie=ie.limit(ht?200:10);try{console.log("[IsisAnalytics] Fetch lastAgs with range (effective):",{effStart:De,effEnd:ne,hasAnyFilter:ht,limit:ht?200:10})}catch{}const{data:vt,error:wt}=await ie;if(wt){try{console.error("[IsisAnalytics] lastAgs query error:",wt)}catch{}throw wt}try{console.log("[IsisAnalytics] lastAgs length:",(vt||[]).length)}catch{}const gt=Array.from(new Set((vt||[]).map(fr=>fr.cliente_id).filter(Boolean)));let er={};if(gt.length>0){const{data:fr}=await re.from("clientes").select("id, nome").in("id",gt);(fr||[]).forEach(je=>{er[je.id]=je.nome})}const _e=Array.from(new Set((vt||[]).map(fr=>fr.quadra_id).filter(Boolean)));let Pt={};if(_e.length>0){const{data:fr}=await re.from("quadras").select("id, nome").in("id",_e);(fr||[]).forEach(je=>{Pt[je.id]=je.nome})}const Lt=(vt||[]).map(fr=>fr.id);let gr={};if(Lt.length>0){const{data:fr}=await re.from("agendamento_participantes").select("agendamento_id, nome, status_pagamento, valor_cota").in("agendamento_id",Lt).order("agendamento_id",{ascending:!0});(fr||[]).forEach(je=>{gr[je.agendamento_id]||(gr[je.agendamento_id]=[]),gr[je.agendamento_id].push(je)})}if(!J)return;z({}),k(fr=>({...fr,ultimasInteracoes:(vt||[]).map(je=>({...je,cliente_nome:er[je.cliente_id]||null,participantes:gr[je.id]||[],quadra_nome:Pt[je.quadra_id]||null}))})),c(!1)}catch(G){if(!J)return;u(G?.message||"Erro ao carregar agendamentos"),c(!1)}})(),()=>{J=!1}},[r,f,m]);const he=p.useMemo(()=>e?.nome_fantasia||e?.razao_social||"sua arena",[e]);return a.jsxs(Er.div,{variants:Ae,initial:"hidden",animate:"visible",className:"space-y-4",children:[a.jsxs(Er.div,{variants:V,className:"bg-surface/70 backdrop-blur-sm relative p-4 md:p-6 rounded-xl border border-white/10 overflow-hidden shadow-1",children:[a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.03] mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsx("div",{className:"rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)] flex-shrink-0",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-10 h-10 sm:w-12 sm:h-12 grid place-items-center",children:a.jsx(Hi,{size:"xs",className:"w-10 h-10 sm:w-12 sm:h-12"})})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("h1",{className:"text-xl sm:text-2xl font-black text-text-primary tracking-tight flex items-center gap-2 flex-wrap",children:[a.jsx(bj,{className:"h-5 w-5 sm:h-6 sm:w-6 text-brand flex-shrink-0"}),a.jsx("span",{className:"truncate",children:"Anlises da sis"})]}),a.jsxs("p",{className:"text-xs sm:text-sm text-text-secondary mt-1 line-clamp-2",children:["Como a sis est ajudando ",he," a converter conversas em reservas."]})]})]}),a.jsx("button",{type:"button",onClick:()=>y(!0),className:"inline-flex items-center justify-center w-10 h-10 sm:w-11 sm:h-11 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-text-secondary hover:text-text-primary flex-shrink-0 self-end sm:self-auto",title:"Configuraes da sis",children:a.jsx(fd,{className:"h-5 w-5"})})]})]}),n?a.jsxs(Er.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-20 gap-4",children:[a.jsx("div",{className:"relative",children:a.jsx("div",{className:"rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_20px_rgba(168,85,247,0.4)] animate-pulse",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-20 h-20 grid place-items-center",children:a.jsx(Hi,{size:"sm",className:"w-20 h-20"})})})}),a.jsxs("div",{className:"flex items-center gap-2 text-text-muted",children:[a.jsx(Zl,{className:"h-5 w-5 animate-spin"}),a.jsx("span",{className:"text-sm font-medium",children:"Carregando anlises da sis..."})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4 w-full max-w-md",children:[a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"})]})]}):o?a.jsx("div",{className:"text-danger text-sm",children:o}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx($,{icon:MC,title:"Agendamentos feitos (hoje)",value:T.agendamentosIsisHoje,color:"success"}),a.jsx($,{icon:Cm,title:"Agendamentos feitos (7 dias)",value:T.agendamentosIsis7d,color:"info"}),a.jsx($,{icon:Sg,title:"Cancelamentos",value:T.cancelamentosIsis7d,color:"danger"})]}),a.jsxs(Er.div,{variants:V,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("h2",{className:"text-base font-bold text-text-primary flex items-center",children:[a.jsx(Cm,{className:"mr-2 h-5 w-5 text-brand"}),"Distribuio  ltimos 7 dias"]})}),a.jsx("div",{className:"px-1 pb-2",children:a.jsx(zb,{width:"100%",height:220,children:a.jsxs(Uee,{data:Y,margin:{top:8,right:12,left:0,bottom:0},children:[a.jsx(TS,{strokeDasharray:"3 3",stroke:"var(--border)",opacity:.5}),a.jsx(fp,{dataKey:"name",tick:{fontSize:11,fill:"var(--text-muted)"},tickLine:!1,axisLine:{stroke:"var(--border)"}}),a.jsx(mp,{allowDecimals:!1,tick:{fontSize:11,fill:"var(--text-muted)"},tickLine:!1,axisLine:{stroke:"var(--border)"},width:28}),a.jsx(wc,{cursor:{stroke:"var(--border)",strokeDasharray:"3 3"},contentStyle:{background:"rgba(10,10,10,0.85)",borderColor:"var(--border)",color:"var(--text-primary)",borderRadius:"8px"},formatter:J=>[J,"sis (feitos)"]}),a.jsx(fy,{type:"monotone",dataKey:"isis",name:"sis (feitos)",stroke:"var(--brand)",strokeWidth:2.2,dot:{r:3,strokeWidth:1.5,stroke:"var(--brand)",fill:"var(--background)"},activeDot:{r:5}})]})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs(Er.div,{variants:V,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h2",{className:"text-base font-bold text-text-primary",children:"Top quadras  ltimos 30 dias (sis)"})}),T.topQuadras30d.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum agendamento nos ltimos 30 dias."}):a.jsx("ul",{className:"divide-y divide-border",children:T.topQuadras30d.map(J=>a.jsxs("li",{className:"py-2 text-sm flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:J.nome}),a.jsx("span",{className:"text-text-muted",children:J.count})]},J.id))})]}),a.jsxs(Er.div,{variants:V,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h2",{className:"text-base font-bold text-text-primary",children:"Top modalidades  ltimos 30 dias (sis)"})}),!T.topModalidades30d||T.topModalidades30d.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados recentes."}):a.jsx("ul",{className:"divide-y divide-border",children:T.topModalidades30d.map((J,G)=>a.jsxs("li",{className:"py-2 text-sm flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:J.nome}),a.jsx("span",{className:"text-text-muted",children:J.count})]},`${J.nome}-${G}`))})]})]})]}),!n&&a.jsxs(Er.div,{variants:V,className:"fx-card",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{className:"text-sm sm:text-base font-bold text-text-primary",children:"ltimos agendamentos criados pela sis"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{type:"button",variant:"ghost",className:"h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary",title:"Data incio (criado em)",children:[a.jsx(lo,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{children:f?W(L(f)):"Incio"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(oi,{mode:"single",selected:L(f)||void 0,onSelect:J=>h(J?U(J):""),locale:ga,initialFocus:!0})})]}),a.jsx("span",{className:"text-xs text-text-secondary select-none",children:"at"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{type:"button",variant:"ghost",className:"h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary",title:"Data fim (criado em)",children:[a.jsx(lo,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{children:m?W(L(m)):"Fim"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(oi,{mode:"single",selected:L(m)||void 0,onSelect:J=>x(J?U(J):""),locale:ga,initialFocus:!0})})]})]}),null]})]}),a.jsxs("div",{className:"sm:hidden mb-3 rounded-lg border border-white/10 bg-white/5 p-2",children:[a.jsxs("div",{className:"grid [grid-template-columns:1fr_auto_1fr] gap-2 mb-2",children:[a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{type:"button",variant:"ghost",className:"w-full h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary justify-between",title:"Data incio (criado em)",children:[a.jsx(lo,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{className:"truncate",children:f?W(L(f)):"Incio"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(oi,{mode:"single",selected:L(f)||void 0,onSelect:J=>h(J?U(J):""),locale:ga,initialFocus:!0})})]}),a.jsx("div",{className:"flex items-center justify-center text-xs text-text-secondary select-none",children:"at"}),a.jsxs(ai,{children:[a.jsx(si,{asChild:!0,children:a.jsxs(se,{type:"button",variant:"ghost",className:"w-full h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary justify-between",title:"Data fim (criado em)",children:[a.jsx(lo,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{className:"truncate",children:m?W(L(m)):"Fim"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(oi,{mode:"single",selected:L(m)||void 0,onSelect:J=>x(J?U(J):""),locale:ga,initialFocus:!0})})]})]}),null]}),l?a.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm py-6",children:[a.jsx(Zl,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Carregando agendamentos..."})]}):d?a.jsx("div",{className:"text-danger text-sm",children:d}):T.ultimasInteracoes.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum agendamento recente."}):a.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:a.jsx("div",{className:"inline-block min-w-full align-middle",children:a.jsx("div",{className:"overflow-hidden",children:a.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-text-secondary border-b border-white/10",children:[a.jsx("th",{className:"w-8 py-2 pl-4 sm:pl-0"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Cdigo"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Cliente"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden sm:table-cell",children:"Quadra"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Data"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden md:table-cell",children:"Horrio"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Status"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden lg:table-cell",children:"Participantes"}),a.jsx("th",{className:"text-left py-2 pr-4 sm:pr-2 whitespace-nowrap hidden xl:table-cell",children:"Criado em"})]})}),a.jsx("tbody",{children:T.ultimasInteracoes.map(J=>{const G=J.inicio?new Date(J.inicio):null,ue=J.fim?new Date(J.fim):null,ve=G?G.toLocaleDateString():"-",ae=G&&ue?`${G.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${ue.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:"-",oe=Array.isArray(J.participantes)?J.participantes.length:Array.isArray(J.clientes)?J.clientes.length:0,me=!!B[J.id],De=()=>z(pt=>({...pt,[J.id]:!pt[J.id]})),ne=String(J.status||"").toLowerCase(),ht={scheduled:{label:"Agendado",cls:"bg-info/15 text-info border border-info/20"},confirmed:{label:"Confirmado",cls:"bg-success/15 text-success border border-success/20"},in_progress:{label:"Em andamento",cls:"bg-brand/15 text-brand border border-brand/20"},finished:{label:"Finalizado",cls:"bg-success/15 text-success border border-success/20"},canceled:{label:"Cancelado",cls:"bg-danger/15 text-danger border border-danger/20"},no_show:{label:"No-show",cls:"bg-warning/15 text-warning border border-warning/20"}}[ne]||{label:J.status||"",cls:"bg-white/10 text-text-secondary border border-white/15"};return a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:`border-b border-white/10 align-top ${me?"bg-white/[0.03]":"hover:bg-white/[0.02]"} transition-colors`,children:[a.jsx("td",{className:"py-2 pl-4 sm:pl-0",children:a.jsx("button",{type:"button","aria-label":me?"Recolher":"Expandir",onClick:pt=>{pt.stopPropagation(),De()},className:`inline-flex items-center justify-center w-6 h-6 rounded-md border border-white/10 hover:bg-white/5 transition-colors ${me?"rotate-180":""}`,children:a.jsx(ix,{className:"w-3 h-3 sm:w-4 sm:h-4 text-text-secondary"})})}),a.jsxs("td",{className:"py-2 pr-2 font-semibold text-text-primary whitespace-nowrap",children:["#",J.codigo]}),a.jsx("td",{className:"py-2 pr-2 max-w-[120px] truncate",children:J.cliente_nome||Array.isArray(J.clientes)&&J.clientes[0]||""}),a.jsx("td",{className:"py-2 pr-2 hidden sm:table-cell max-w-[100px] truncate",children:J.quadra_nome||""}),a.jsx("td",{className:"py-2 pr-2 whitespace-nowrap",children:ve}),a.jsx("td",{className:"py-2 pr-2 hidden md:table-cell whitespace-nowrap text-xs",children:ae}),a.jsx("td",{className:"py-2 pr-2",children:a.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-[11px] font-bold tracking-wide whitespace-nowrap ${ht.cls}`,children:ht.label})}),a.jsx("td",{className:"py-2 pr-2 hidden lg:table-cell",children:a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-white/10 text-text-primary text-xs font-semibold",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand/70"}),oe]})}),a.jsx("td",{className:"py-2 pr-4 sm:pr-2 hidden xl:table-cell text-xs whitespace-nowrap",children:J.criado_em?new Date(J.criado_em).toLocaleString():"-"})]},J.id),me&&a.jsx("tr",{children:a.jsxs("td",{colSpan:9,className:"p-3 sm:p-4 bg-white/[0.035] border-b border-white/10",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Criado em"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:J.criado_em?new Date(J.criado_em).toLocaleString():"-"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Incio"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:J.inicio?new Date(J.inicio).toLocaleString():"-"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Trmino"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:J.fim?new Date(J.fim).toLocaleString():"-"})]})]}),a.jsxs("div",{className:"sm:hidden mb-3 grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted",children:"Quadra"}),a.jsx("div",{className:"font-medium text-text-primary text-xs truncate",children:J.quadra_nome||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted",children:"Horrio"}),a.jsx("div",{className:"font-medium text-text-primary text-xs",children:ae})]})]}),a.jsxs("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted mb-2",children:["Participantes (",oe,")"]}),Array.isArray(J.participantes)&&J.participantes.length>0?a.jsx("ul",{className:"grid grid-cols-1 gap-1.5",children:J.participantes.map((pt,Ze)=>a.jsxs("li",{className:"flex items-center justify-between py-1.5 px-2 sm:px-3 rounded-md border border-white/10 bg-white/5 gap-2",children:[a.jsx("span",{className:"text-text-primary font-medium text-xs sm:text-sm truncate flex-1",children:pt.nome}),a.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-[11px] font-bold tracking-wide whitespace-nowrap flex-shrink-0 ${pt.status_pagamento==="Pago"?"bg-success/15 text-success border border-success/20":"bg-warning/15 text-warning border border-warning/20"}`,children:pt.status_pagamento})]},Ze))}):a.jsx("div",{className:"text-text-muted text-xs sm:text-sm",children:"Sem participantes cadastrados"})]})})]})})})]})})})})]}),g&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:()=>y(!1),children:a.jsxs(Er.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-surface border border-white/10 rounded-xl shadow-2xl w-full max-w-lg p-6 space-y-4",onClick:J=>J.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-xl font-bold text-text-primary flex items-center gap-2",children:[a.jsx(fd,{className:"h-5 w-5 text-brand"})," Configuraes da sis"]}),a.jsx("button",{type:"button",onClick:()=>y(!1),className:"inline-flex items-center justify-center w-8 h-8 rounded-lg hover:bg-white/10 transition-colors text-text-secondary hover:text-text-primary",children:a.jsx(Sg,{className:"h-5 w-5"})})]}),v?a.jsxs("div",{className:"flex items-center gap-2 text-text-muted py-8 justify-center",children:[a.jsx(Zl,{className:"h-5 w-5 animate-spin"})," Carregando..."]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Cancelamento (horas antes)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Tempo mnimo (em horas) antes do agendamento para permitir cancelamento via sis."}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"number",min:"0",step:"1",value:j,onChange:J=>S(J.target.value),placeholder:"Ex: 2",className:"w-24 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary text-center placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("span",{className:"text-sm text-text-muted",children:"horas"})]}),a.jsx("p",{className:"text-xs text-text-muted italic",children:"Deixe vazio para permitir cancelamento a qualquer momento."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Nome de exibio"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Nome que aparecer no header da pgina de agendamento da sis."}),a.jsx("input",{type:"text",value:P,onChange:J=>F(J.target.value),placeholder:"Arena Palace",className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("p",{className:"text-xs text-text-muted italic",children:"Este  o nome que seus clientes vero ao acessar a sis."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Link de agendamento"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Personalize o subdomnio do link de agendamento da sis."}),O?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:C,onChange:J=>A(J.target.value.toLowerCase().replace(/[^a-z0-9]+/g,"")),placeholder:"arenapalace",autoFocus:!0,className:"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("span",{className:"text-sm text-text-muted",children:".f7arena.com"})]}):a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 border border-white/10 rounded-lg group hover:border-white/20 transition-all cursor-pointer",onClick:()=>I(!0),children:[a.jsxs("span",{className:"flex-1 text-text-primary font-mono",children:[C||"arenapalace",".f7arena.com"]}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-md hover:bg-white/10 transition-colors text-text-muted group-hover:text-text-primary",title:"Editar subdomnio",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),a.jsx("path",{d:"m15 5 4 4"})]})})]})]}),a.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{y(!1),I(!1)},disabled:w,className:"flex-1 px-4 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors text-text-secondary hover:text-text-primary font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),a.jsx("button",{type:"button",onClick:ge,disabled:w,className:"flex-1 px-4 py-2 rounded-lg bg-brand hover:bg-brand/90 transition-colors text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w?a.jsxs(a.Fragment,{children:[a.jsx(Zl,{className:"h-4 w-4 animate-spin"})," Salvando..."]}):"Salvar"})]})]})]})})]})}function olt({open:e,onOpenChange:t,codigoEmpresa:r,onSuccess:n}){const{toast:s}=Ss(),[o,i]=p.useState("upload"),[l,c]=p.useState(null),[d,u]=p.useState(null),[f,h]=p.useState(!1),[m,x]=p.useState({success:!1,comandaId:null,error:null}),g=async _=>{const j=_.target.files?.[0];if(j){if(!j.name.endsWith(".xml")){s({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}c(j);try{const S=await j.text(),C=cC(S);if(!C.success){s({title:"Erro ao ler XML",description:C.error||"XML invlido",variant:"destructive"});return}if(!C.produtos||C.produtos.length===0){s({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}if(C.nfe?.tipo!=="Sada"){s({title:"Tipo de nota incorreto",description:"Este XML  de entrada. Use a importao em Produtos para notas de entrada.",variant:"warning"});return}u(C),i("preview")}catch(S){console.error("[XMLSalesImport] Erro ao processar arquivo:",S),s({title:"Erro ao processar XML",description:S.message,variant:"destructive"})}}},y=async()=>{i("processing"),h(!0);try{const _=await Hu({searchTerm:"",limit:1e4,codigoEmpresa:r}),j=d.nfe?.dataEmissao?new Date(d.nfe.dataEmissao):new Date,S=d.nfe?.chaveAcesso||"",{data:C,error:A}=await re.from("comandas").insert({codigo_empresa:r,mesa_id:null,status:"closed",aberto_em:j.toISOString(),fechado_em:j.toISOString(),observacao:`Importado de XML - NF-e ${d.nfe?.numero||""}${S?`
Chave: ${S}`:""}`,origem:"xml",xml_chave:S||null}).select().single();if(A)throw A;const P=[],F=[];for(const I of d.produtos){const T=dC(I,_);if(T){P.push({comanda_id:C.id,produto_id:T.id,descricao:I.nome,quantidade:I.quantidade,preco_unitario:I.valorUnitario,desconto:I.desconto||0,codigo_empresa:r});const k=Math.max(0,(T.stock||T.estoque||0)-I.quantidade);await re.from("produtos").update({estoque:k}).eq("id",T.id).eq("codigo_empresa",r)}else F.push(I.nome)}if(P.length>0){const{error:I}=await re.from("comanda_itens").insert(P);if(I)throw I}const O=d.pagamentos||[];if(O.length>0){const{data:I}=await re.from("finalizadoras").select("id, codigo_sefaz, nome").eq("codigo_empresa",r).eq("ativo",!0),T=new Map((I||[]).map(z=>[z.codigo_sefaz,z])),k=O.map(z=>{const U=T.get(z.codigoSefaz);return{comanda_id:C.id,finalizadora_id:U?.id||null,metodo:z.descricao.toLowerCase(),valor:z.valor,status:"Pago",recebido_em:j.toISOString(),codigo_empresa:r,origem:"xml",xml_chave:S||null}}),{error:B}=await re.from("pagamentos").insert(k);if(B)throw B}else{const I=d.produtos.reduce((k,B)=>k+(B.valorTotal||0),0),{error:T}=await re.from("pagamentos").insert({comanda_id:C.id,finalizadora_id:null,metodo:"outros",valor:I,status:"Pago",recebido_em:j.toISOString(),codigo_empresa:r,origem:"xml",xml_chave:S||null});if(T)throw T}console.log("[XMLSalesImport] Venda importada com sucesso. Comanda ID:",C.id),F.length>0?s({title:"Venda importada com avisos",description:`${P.length} produto(s) registrado(s), ${F.length} no encontrado(s).`,variant:"warning",duration:5e3}):s({title:"Venda importada com sucesso!",description:`${P.length} produto(s) registrado(s). Total: R$ ${w.toFixed(2)}`,variant:"success"}),x({success:!0,comandaId:C.id,error:null,produtosNaoEncontrados:F,totalItens:P.length,totalVenda:w,dataEmissao:j.toISOString().slice(0,10)}),i("done"),n&&n(j.toISOString().slice(0,10))}catch(_){console.error("[XMLSalesImport] Erro ao importar:",_),x({success:!1,comandaId:null,error:_.message}),i("done"),s({title:"Erro ao importar XML",description:_.message,variant:"destructive"})}finally{h(!1)}},v=()=>{i("upload"),c(null),u(null),x({success:!1,comandaId:null,error:null}),t(!1)},b=()=>{i("upload"),c(null),u(null)},w=d?.produtos?.reduce((_,j)=>_+(j.valorTotal||0),0)||0;return a.jsx(In,{open:e,onOpenChange:t,children:a.jsxs(En,{className:"max-w-3xl max-h-[90vh] flex flex-col overflow-hidden",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-2xl font-bold",children:"Importar XML de Venda (NF-e)"}),a.jsxs(Hn,{children:[o==="upload"&&"Selecione o arquivo XML da nota fiscal de sada",o==="preview"&&"Revise os dados da venda que ser importada",o==="processing"&&"Processando venda...",o==="done"&&"Importao finalizada"]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-1",children:[o==="upload"&&a.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:a.jsxs("div",{className:"w-full max-w-md",children:[a.jsxs("label",{htmlFor:"xml-sales-upload",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-border rounded-lg cursor-pointer bg-surface hover:bg-surface-2 transition-colors",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(tD,{className:"w-12 h-12 mb-4 text-text-muted"}),a.jsx("p",{className:"mb-2 text-sm text-text-primary font-semibold",children:"Clique para selecionar ou arraste o arquivo"}),a.jsx("p",{className:"text-xs text-text-muted",children:"XML de NF-e de Sada (Venda)"})]}),a.jsx("input",{id:"xml-sales-upload",type:"file",accept:".xml",className:"hidden",onChange:g})]}),l&&a.jsxs("div",{className:"mt-4 p-3 bg-surface-2 rounded-lg flex items-center gap-2",children:[a.jsx(Vi,{className:"w-5 h-5 text-success"}),a.jsx("span",{className:"text-sm text-text-primary",children:l.name})]})]})}),o==="preview"&&a.jsxs("div",{className:"space-y-4",children:[d?.nfe&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Informaes da NF-e"}),d.fornecedor&&a.jsxs("div",{className:"mb-3 pb-3 border-b border-border",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary mb-1",children:d.fornecedor.razaoSocial||d.fornecedor.nomeFantasia||"Fornecedor"}),a.jsxs("div",{className:"text-xs text-text-muted",children:[d.fornecedor.cnpj&&`CNPJ: ${d.fornecedor.cnpj}`,d.fornecedor.endereco?.cidade&&d.fornecedor.endereco?.uf&&`  ${d.fornecedor.endereco.cidade}/${d.fornecedor.endereco.uf}`]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",a.jsx("span",{className:"font-mono",children:d.nfe.numero})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",a.jsx("span",{className:"font-mono",children:d.nfe.serie})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Tipo:"})," ",a.jsx("span",{className:"text-warning font-semibold",children:d.nfe.tipo})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Data:"})," ",a.jsx("span",{children:new Date(d.nfe.dataEmissao).toLocaleDateString("pt-BR")})]})]}),d.nfe.naturezaOperacao&&a.jsxs("div",{className:"mb-2 text-sm",children:[a.jsx("span",{className:"text-text-muted",children:"Natureza:"})," ",a.jsx("span",{className:"font-medium",children:d.nfe.naturezaOperacao})]}),d.nfe.totalNota!==void 0&&a.jsxs("div",{className:"mb-3 text-sm",children:[a.jsx("span",{className:"text-text-muted",children:"Total da Nota:"})," ",a.jsxs("span",{className:"font-mono font-semibold text-lg text-success",children:["R$ ",d.nfe.totalNota.toFixed(2)]})]}),d.nfe.chaveAcesso&&a.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[a.jsx("span",{className:"text-text-muted text-xs",children:"Chave de Acesso:"}),a.jsx("p",{className:"font-mono text-xs break-all",children:d.nfe.chaveAcesso})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("h3",{className:"font-semibold mb-3",children:["Produtos da Venda (",d.produtos.length,")"]}),a.jsx("div",{className:"space-y-2",children:d.produtos.map((_,j)=>a.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface flex items-start gap-3",children:[a.jsx(W1,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:_.nome}),a.jsxs("p",{className:"text-xs text-text-muted",children:[_.codigo&&`Cdigo: ${_.codigo}  `,"Qtd: ",_.quantidade," ",_.unidade]})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsxs("p",{className:"text-sm font-semibold",children:["R$ ",_.valorTotal.toFixed(2)]}),a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit: R$ ",_.valorUnitario.toFixed(2)]})]})]})})]},j))})]}),d.pagamentos&&d.pagamentos.length>0&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("h3",{className:"font-semibold mb-3",children:["Formas de Pagamento (",d.pagamentos.length,")"]}),a.jsx("div",{className:"space-y-2",children:d.pagamentos.map((_,j)=>a.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm",children:_.descricao}),a.jsxs("p",{className:"text-xs text-text-muted",children:["Cdigo SEFAZ: ",_.codigoSefaz]})]}),a.jsxs("p",{className:"text-sm font-semibold",children:["R$ ",_.valor.toFixed(2)]})]},j))})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(ud,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-sm mb-1",children:"Ateno: Venda Externa"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Esta venda ser registrada no histrico como uma venda externa (importada de XML). O estoque dos produtos ser subtrado automaticamente."})]})]})}),a.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[a.jsx("span",{children:"Total da Venda:"}),a.jsxs("span",{className:"text-success",children:["R$ ",w.toFixed(2)]})]})]}),o==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(Zl,{className:"w-12 h-12 animate-spin text-warning mb-4"}),a.jsx("p",{className:"text-lg font-semibold",children:"Processando venda..."}),a.jsx("p",{className:"text-sm text-text-muted",children:"Criando comanda e atualizando estoque"})]}),o==="done"&&a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"bg-surface-2 rounded-lg p-6 border border-border text-center",children:m.success?a.jsxs(a.Fragment,{children:[a.jsx(vi,{className:"w-16 h-16 text-success mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Venda Importada com Sucesso!"}),a.jsx("p",{className:"text-sm text-text-muted mb-4",children:"A venda foi registrada no histrico"}),m.produtosNaoEncontrados&&m.produtosNaoEncontrados.length>0&&a.jsxs("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-3 text-left",children:[a.jsx("p",{className:"text-sm font-semibold mb-2",children:" Produtos no encontrados:"}),a.jsx("ul",{className:"text-xs text-text-muted space-y-1",children:m.produtosNaoEncontrados.map((_,j)=>a.jsxs("li",{children:[" ",_]},j))})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(ud,{className:"w-16 h-16 text-danger mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Erro na Importao"}),a.jsx("p",{className:"text-sm text-text-muted",children:m.error||"Ocorreu um erro ao importar a venda"})]})})})]}),a.jsxs(Na,{children:[o==="upload"&&a.jsx(se,{variant:"outline",onClick:v,children:"Cancelar"}),o==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(se,{variant:"outline",onClick:b,children:"Voltar"}),a.jsx(se,{onClick:y,children:"Confirmar Importao"})]}),o==="done"&&a.jsx(se,{onClick:v,children:"Fechar"})]})]})})}const ilt={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},cb={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};function llt(e,t=300){const[r,n]=p.useState(e);return p.useEffect(()=>{const s=setTimeout(()=>n(e),t);return()=>clearTimeout(s)},[e,t]),r}function sj({value:e,onChange:t}){const[r,n]=p.useState(!1),s=p.useRef(null),o=p.useRef(null),i=p.useRef(null),[l,c]=p.useState({top:0,left:0,width:0,center:!1,mode:"fixed"});p.useEffect(()=>{function g(b){const w=b.target,_=s.current&&s.current.contains(w),j=i.current&&i.current.contains(w);!_&&!j&&n(!1)}function y(b){b.key==="Escape"&&n(!1)}function v(){r&&d()}return window.addEventListener("mousedown",g),window.addEventListener("keydown",y),window.addEventListener("scroll",v,!0),window.addEventListener("resize",v),()=>{window.removeEventListener("mousedown",g),window.removeEventListener("keydown",y),window.removeEventListener("scroll",v,!0),window.removeEventListener("resize",v)}},[r]),p.useEffect(()=>{if(r){const g=requestAnimationFrame(()=>{d();const y=requestAnimationFrame(()=>d());return()=>cancelAnimationFrame(y)});return()=>cancelAnimationFrame(g)}},[r]),p.useEffect(()=>{if(r&&l.mode==="overlay"){const g=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=g}}},[r,l.mode]);const d=()=>{try{const g=o.current;if(!g)return;const y=g.getBoundingClientRect(),v=window.innerWidth,b=window.innerHeight,w=8,_=Math.max(y.width,280),j=Math.min(v-w*2,360),S=Math.min(_,j);let C=320;if(i.current)try{C=i.current.getBoundingClientRect().height||C}catch{}if(v<=640){c({top:0,left:0,width:Math.min(v-w*2,360),center:!0,mode:"overlay"});return}const A=s.current,P=A?A.getBoundingClientRect():y,F=y.bottom-P.top+6,O=Math.max(y.width,280);c({top:F,left:0,width:O,center:!1,mode:"anchor"})}catch{}},u=g=>{try{const[y,v,b]=String(g||"").split("-").map(Number);return!y||!v||!b?null:new Date(y,v-1,b)}catch{return null}},f=g=>{const y=v=>String(v).padStart(2,"0");return`${g.getFullYear()}-${y(g.getMonth()+1)}-${y(g.getDate())}`},h=g=>{const y=v=>String(v).padStart(2,"0");return`${y(g.getDate())}/${y(g.getMonth()+1)}/${g.getFullYear()}`},m=u(e),x=m?h(m):"";return a.jsxs("div",{className:"relative",ref:s,children:[a.jsx("button",{type:"button",className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-warning/10 focus:outline-none",onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(g=>!g),setTimeout(d,0)},"aria-label":"Abrir calendrio",children:a.jsx(Iue,{className:"h-4 w-4 text-warning"})}),typeof window<"u"&&window.innerWidth<=640?a.jsx("button",{type:"button",ref:o,onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(!0),setTimeout(d,0)},className:"pl-9 pr-3 h-10 w-full text-left bg-surface text-text-primary border border-warning/40 rounded-md",children:x||"Selecionar data"}):a.jsx(Ct,{type:"text",readOnly:!0,ref:o,inputMode:"none",onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(g=>!g),setTimeout(d,0)},className:"pl-9 pr-3 w-full bg-surface text-text-primary border border-warning/40 focus-visible:ring-warning focus-visible:border-warning",value:x}),r&&(l.mode==="overlay"?a.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",onClick:g=>{g.target===g.currentTarget&&n(!1)},children:a.jsx("div",{ref:i,className:"bg-black text-white border border-warning/40 rounded-md shadow-xl p-2 w-[92vw] max-w-[360px]",children:a.jsx(oi,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})})}):l.mode==="anchor"?a.jsx("div",{ref:i,className:"absolute z-[999] bg-black text-white border border-warning/40 rounded-md shadow-xl p-2 left-0",style:{top:`${l.top}px`,minWidth:`${l.width}px`,maxWidth:"92vw"},children:a.jsx(oi,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}):a.jsx("div",{ref:i,className:"fixed z-[999] bg-black text-white border border-warning/40 rounded-md shadow-xl p-2",style:{top:`${l.top}px`,left:`${l.left}px`,width:`${l.width}px`,maxWidth:"92vw"},children:a.jsx(oi,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}))]})}function clt(){const{toast:e}=Ss(),t=hl(),{userProfile:r}=qs(),[n]=DC(),s=n.get("mesa"),[o,i]=p.useState(!1),[l,c]=p.useState([]),[d,u]=p.useState(()=>s?"":new Date().toISOString().slice(0,10)),[f,h]=p.useState(()=>s?"":new Date().toISOString().slice(0,10)),[m,x]=p.useState(()=>s?"all":"closed"),[g,y]=p.useState(""),v=llt(g,350),[b,w]=p.useState("all"),[_,j]=p.useState("comandas"),[S,C]=p.useState(!1),[A,P]=p.useState(""),[F,O]=p.useState(null),[I,T]=p.useState({loading:!1,itens:[],pagamentos:[]}),[k,B]=p.useState(null),[z,U]=p.useState({open:!1,loading:!1,resumo:null,periodo:{from:null,to:null},movs:[]}),[L,W]=p.useState(!1),[ge,Ae]=p.useState(!1),[V,$]=p.useState(null),[Y,he]=p.useState([]),J=async Me=>{try{Ae(!0);const Qe=Pt();if(!Qe)throw new Error("Empresa no detectada");const{payload:et,missing:Yt}=await tv({comandaId:Me,codigoEmpresa:Qe});$(et),he(Yt||[]),W(!0)}catch(Qe){e({title:"Falha ao gerar prvia",description:Qe?.message||"Tente novamente",variant:"destructive"})}finally{Ae(!1)}},[G,ue]=p.useState(!1),[ve,ae]=p.useState(!1),[oe,me]=p.useState(!1),De=async()=>{try{e({title:"Gerando CSV...",description:"Aguarde enquanto preparamos o arquivo",variant:"default"});const Me=await zz({status:m,from:d||void 0,to:f||void 0,search:v||"",limit:1e4,offset:0});if(!Me||Me.length===0){e({title:"Nenhum dado para exportar",variant:"warning"});return}const Qe=Me.map(ze=>ze.id),et=await VS(Qe,r?.codigo_empresa),Yt=await Ph(r?.codigo_empresa),xr=new Map(Yt.map(ze=>[ze.id,ze.numero])),Jt=await c3(Qe),kr=await d3(Qe),_r=Me.map(ze=>{const Je=ze.mesa_id?`Mesa ${xr.get(ze.mesa_id)||"?"}`:"Balco",kt=Jt[ze.id]||"Sem cliente",ct=kr[ze.id],tr=Array.isArray(ct)?ct.join(", "):ct||"No informado",dt=ze.fechado_em?"Fechada":"Aberta";return{Tipo:ze.tipo==="balcao"?"Balco":"Mesa","Mesa/Local":Je,"Cliente(s)":kt,Status:dt,Abertura:new Date(ze.aberto_em).toLocaleString("pt-BR"),Fechamento:ze.fechado_em?new Date(ze.fechado_em).toLocaleString("pt-BR"):"-","Total (R$)":Number(et[ze.id]||0).toFixed(2),"Forma(s) Pagamento":tr,Observaes:ze.observacao||"-"}}),Rr=Object.keys(_r[0]),nn=[Rr.join(";"),..._r.map(ze=>Rr.map(Je=>{const kt=ze[Je]||"";return`"${String(kt).replace(/"/g,'""')}"`}).join(";"))].join(`
`),rn=new Blob(["\uFEFF"+nn],{type:"text/csv;charset=utf-8;"}),Ke=document.createElement("a"),qe=URL.createObjectURL(rn);Ke.setAttribute("href",qe),Ke.setAttribute("download",`historico_comandas_${new Date().toISOString().slice(0,10)}.csv`),Ke.style.visibility="hidden",document.body.appendChild(Ke),Ke.click(),document.body.removeChild(Ke),e({title:"CSV exportado!",description:`${_r.length} comandas exportadas`,variant:"success"})}catch(Me){console.error("Erro ao exportar CSV:",Me),e({title:"Erro ao exportar",description:Me.message,variant:"destructive"})}},ne=async()=>{try{if(e({title:"Gerando CSV...",description:"Aguarde enquanto preparamos o arquivo",variant:"default"}),!l||l.length===0){e({title:"Nenhum dado para exportar",variant:"warning"});return}const Me=l.map(kr=>{const _r=kr.status==="open"?"Aberto":kr.status==="closed"?"Fechado":kr.status;return{"Data Abertura":kr.aberto_em?new Date(kr.aberto_em).toLocaleString("pt-BR"):"-","Data Fechamento":kr.fechado_em?new Date(kr.fechado_em).toLocaleString("pt-BR"):"-",Status:_r,"Saldo Inicial (R$)":Number(kr.saldo_inicial||0).toFixed(2),"Saldo Final (R$)":Number(kr.saldo_final||0).toFixed(2),"Valor Contado (R$)":kr.valor_final_dinheiro?Number(kr.valor_final_dinheiro).toFixed(2):"-","Diferena (R$)":kr.diferenca_dinheiro?Number(kr.diferenca_dinheiro).toFixed(2):"-"}}),Qe=Object.keys(Me[0]),et=[Qe.join(";"),...Me.map(kr=>Qe.map(_r=>{const Rr=kr[_r]||"";return`"${String(Rr).replace(/"/g,'""')}"`}).join(";"))].join(`
`),Yt=new Blob(["\uFEFF"+et],{type:"text/csv;charset=utf-8;"}),xr=document.createElement("a"),Jt=URL.createObjectURL(Yt);xr.setAttribute("href",Jt),xr.setAttribute("download",`fechamentos_caixa_${new Date().toISOString().slice(0,10)}.csv`),xr.style.visibility="hidden",document.body.appendChild(xr),xr.click(),document.body.removeChild(xr),e({title:"CSV exportado!",description:`${Me.length} fechamentos exportados`,variant:"success"})}catch(Me){console.error("Erro ao exportar CSV:",Me),e({title:"Erro ao exportar",description:Me.message,variant:"destructive"})}},ie=100,[ht,pt]=p.useState(0),[Ze,vt]=p.useState(!1),wt=p.useRef(!1),gt=p.useRef(0),er=p.useRef(0),_e=p.useRef(!1),Pt=()=>{try{const Me=localStorage.getItem("auth:userProfile");return Me&&JSON.parse(Me)?.codigo_empresa||null}catch{return null}},Lt=p.useMemo(()=>`hist:comandas:${Pt()||"na"}:${d}:${f}:${m}:${b}:${(v||"").trim()}`,[d,f,m,b,v]),gr=async({append:Me=!1,skipCacheWrite:Qe=!1}={})=>{try{i(!0);const et=Pt();if(!et){i(!1);return}const Yt=setTimeout(()=>i(!1),1e4);if(_==="comandas"){const xr=!!(v&&v.trim()),Jt=xr?1e3:ie,kr=xr?0:ht;console.log("[HistoricoComandasPage] Carregando com:",{status:m,from:d,to:f,search:v,mesaId:s,searching:xr,effLimit:Jt});const _r=await zz({status:m,from:d,to:f,search:s||v,limit:Jt,offset:kr});console.log("[HistoricoComandasPage] Resultado:",_r?.length||0,"comandas");const Rr=(_r||[]).map(kt=>kt.id);let nn={};if(Rr.length>0)try{nn=await VS(Rr,et)}catch{nn={}}let rn=[];try{rn=await Ph(et)}catch{rn=[]}const Ke=new Map((rn||[]).map(kt=>[kt.id,kt.numero]));let qe={},ze={};try{qe=await c3(Rr)}catch{qe={}}try{ze=await d3(Rr)}catch{ze={}}const Je=(_r||[]).map(kt=>{const ct=qe[kt.id],tr=ze[kt.id];return{...kt,statusDerived:kt.status==="cancelled"?"cancelled":kt.fechado_em?"closed":kt.status||"open",total:Number(nn[kt.id]||0),mesaNumero:Ke.get(kt.mesa_id),clientesStr:Array.isArray(ct)?ct.join(", "):ct||"",finalizadorasStr:Array.isArray(tr)?tr.join(", "):tr||""}});if(vt(xr?!1:(_r||[]).length===ie),c(Me?kt=>[...kt,...Je]:Je),!Qe)try{localStorage.setItem(Lt,JSON.stringify({ts:Date.now(),rows:Je}))}catch{}}else{const xr=await lne({from:d,to:f,limit:100,offset:0,codigoEmpresa:et});c(xr||[])}clearTimeout(Yt)}catch(et){e({title:"Falha ao carregar histrico",description:et?.message||"Tente novamente",variant:"destructive"})}finally{i(!1),gt.current=Date.now()}};p.useEffect(()=>{s&&(async()=>{try{const et=(await Ph(r?.codigo_empresa)||[]).find(Yt=>Yt.id===s);et&&P(`Mesa ${et.numero}`)}catch{}})()},[s,r?.codigo_empresa]),p.useEffect(()=>{if(wt.current=!0,_==="comandas")try{const Me=localStorage.getItem(Lt);if(Me){const Qe=JSON.parse(Me);Qe&&Array.isArray(Qe.rows)&&Date.now()-Number(Qe.ts||0)<12e4&&c(Qe.rows)}}catch{}return()=>{wt.current=!1}},[Lt,_]),p.useEffect(()=>{_==="comandas"&&(pt(0),vt(!1)),gr({append:!1})},[m,v,d,f,_]),p.useEffect(()=>{if(!o&&_==="comandas"&&l.length===0){const Me=setTimeout(()=>{wt.current&&gr({append:!1,skipCacheWrite:!1})},1500);return()=>clearTimeout(Me)}},[l.length,o,_]),p.useEffect(()=>{const Me=()=>{document.visibilityState==="visible"&&Date.now()-(gt.current||0)>3e4&&gr({append:!1})},Qe=()=>{Date.now()-(gt.current||0)>3e4&&gr({append:!1})};return window.addEventListener("visibilitychange",Me),window.addEventListener("focus",Qe),()=>{window.removeEventListener("visibilitychange",Me),window.removeEventListener("focus",Qe)}},[Lt,_]);const fr=async Me=>{O(Me),T({loading:!0,itens:[],pagamentos:[]});const Qe=Pt();_e.current=!0;const et=++er.current,Yt=setTimeout(()=>{er.current===et&&_e.current&&T(xr=>({...xr,loading:!1}))},1e4);if(!Qe){clearTimeout(Yt),er.current===et&&_e.current&&T({loading:!1,itens:[],pagamentos:[]});return}try{const xr=(l||[]).find(Jt=>Jt.id===Me)||null;if(xr){const Jt=xr.mesa_id==null?"Balco":xr.mesaNumero!=null?`Mesa ${xr.mesaNumero}`:"Comanda";B({mesaLabel:Jt,clientesStr:xr.clientesStr||"",aberto_em:xr.aberto_em||null,fechado_em:xr.fechado_em||null,tipo:xr.mesa_id==null?"balcao":"comanda",status:xr.statusDerived||xr.status||"open",diferenca_pagamento:typeof xr.diferenca_pagamento=="number"?xr.diferenca_pagamento:0})}else B(null)}catch{B(null)}try{const xr=async()=>{const[kr,_r]=await Promise.all([To({comandaId:Me,codigoEmpresa:Qe}),one({comandaId:Me,codigoEmpresa:Qe})]);let Rr=[];try{Rr=await Bi({comandaId:Me,codigoEmpresa:Qe})}catch{}console.log("[openDetail] clientesVinc:",Rr);const nn=new Map((Rr||[]).map(qe=>{const ze=qe?.cliente_id??qe?.clientes?.id??null,Je=qe?.clientes?.nome??qe?.nome??qe?.nome_livre??"";return console.log(`[openDetail] Mapeando cliente: cid=${ze}, nome=${Je}`),ze?[String(ze),Je]:null}).filter(Boolean));console.log("[openDetail] nomeById map:",Array.from(nn.entries()));const rn=[...Array.from(nn.values()),...(Rr||[]).filter(qe=>!qe?.cliente_id&&(qe?.nome_livre||qe?.nome)).map(qe=>qe?.nome_livre||qe?.nome||"Consumidor")];console.log("[openDetail] clientesDisponiveis:",rn),console.log("[openDetail] pagamentos:",_r);const Ke=(_r||[]).map((qe,ze)=>{let Je="";return qe?.cliente_id?(Je=nn.get(String(qe.cliente_id))||"",!Je&&rn.length>0&&(Je=rn[ze%rn.length])):rn.length>0&&(Je=rn[ze%rn.length]),console.log(`[openDetail] Pagamento ${ze}: cliente_id=${qe?.cliente_id}, clienteNome=${Je}`),{...qe,cliente_nome:Je,finalizadora_nome:qe?.finalizadoras?.nome||qe?.metodo||""}});return{itens:kr||[],pagamentos:Ke}};let Jt=await xr();Jt.itens.length===0&&Jt.pagamentos.length===0&&(await new Promise(kr=>setTimeout(kr,700)),Jt=await xr()),er.current===et&&_e.current&&T({loading:!1,itens:Jt.itens,pagamentos:Jt.pagamentos})}catch(xr){er.current===et&&_e.current&&T({loading:!1,itens:[],pagamentos:[]}),e({title:"Falha ao carregar detalhes",description:xr?.message||"Tente novamente",variant:"destructive"})}finally{clearTimeout(Yt),er.current===et&&_e.current&&T(xr=>({...xr,loading:!1}))}},je=p.useMemo(()=>({sum:l.reduce((Qe,et)=>Qe+Number(et.total||0),0)}),[l]),nt=Me=>(Me||"").toString().toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,""),$t=p.useMemo(()=>{const Me=(v||"").trim(),Qe=nt(Me),Yt=l.filter(xr=>{const Jt=xr.mesa_id==null;return!(b==="balcao"&&!Jt||b==="comanda"&&Jt)}).filter(xr=>{const Jt=xr.statusDerived||(xr.status==="cancelled"?"cancelled":xr.fechado_em?"closed":xr.status||"open");return m==="closed"?Jt==="closed":m==="open"?Jt==="open":m==="awaiting-payment"?Jt==="awaiting-payment":m==="cancelled"?Jt==="cancelled":!0});return Qe?Yt.filter(xr=>{const Jt=xr.mesaNumero!=null?String(xr.mesaNumero):"",kr=xr.mesa_id==null?"balcao":`mesa ${Jt}`;return[Jt,kr,xr.clientesStr||"",xr.finalizadorasStr||"",xr.mesa_id==null?"balcao":"comanda",xr.statusDerived||xr.status||""].map(nt).join(" | ").includes(Qe)}):Yt},[l,v,b,m]),Ut=Me=>Me==="open"?"Aberta":Me==="awaiting-payment"?"Pagamento":Me==="closed"?"Fechada":Me==="cancelled"?"Cancelada":Me||"",Fe=Me=>{if(!Me)return"";try{return new Date(Me).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}},xt=Me=>{const Qe=String(Me||"").toLowerCase();return Qe==="open"?"Aberto":Qe==="closed"?"Fechado":""},Ot=Me=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Me||0)),Cr=Me=>Me==="open"?"text-info bg-info/10 border-info/30":Me==="awaiting-payment"?"text-warning bg-warning/10 border-warning/30":Me==="closed"?"text-success bg-success/10 border-success/30":Me==="cancelled"?"text-red-400 bg-red-500/10 border-red-500/30":"text-text-secondary bg-transparent border-border/50";return a.jsxs(Er.div,{variants:ilt,initial:"hidden",animate:"visible",className:"min-h-screen flex flex-col",children:[a.jsxs(Er.div,{variants:cb,className:"mb-6 gap-3 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[a.jsx(od,{value:"historico",onValueChange:Me=>{Me==="mesas"&&t("/vendas"),Me==="balcao"&&t("/balcao"),Me==="historico"&&t("/historico")},children:a.jsxs(sc,{className:"grid w-full sm:w-auto grid-cols-3 sm:inline-flex",children:[a.jsx(Pa,{value:"mesas",children:"Mesas"}),a.jsx(Pa,{value:"balcao",children:"Balco"}),a.jsx(Pa,{value:"historico",children:"Histrico"})]})}),a.jsxs("div",{className:"w-full flex items-center gap-2 sm:gap-3",children:[a.jsxs("div",{className:"flex sm:hidden items-center gap-2 w-full",children:[a.jsxs(Gn,{value:_,onValueChange:j,children:[a.jsx(Vn,{className:"w-[160px] text-sm",children:a.jsx(Kn,{placeholder:"Selecionar"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"comandas",children:"Comandas"}),a.jsx(lt,{value:"fechamentos",children:"Fechamentos"})]})]}),a.jsxs("div",{className:"ml-auto text-xs text-text-secondary whitespace-nowrap",children:["Total: ",a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",je.sum.toFixed(2)]})]}),_==="comandas"&&a.jsx(se,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 sm:hidden",onClick:()=>ae(!0),title:"Aes",children:a.jsx(ks,{className:"h-4 w-4"})}),_==="fechamentos"&&a.jsx(se,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 sm:hidden",onClick:ne,title:"Exportar",children:a.jsx(ks,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"hidden sm:flex items-center gap-2 sm:gap-3 ml-auto",children:a.jsx(od,{value:_,onValueChange:j,className:"w-full sm:w-auto",children:a.jsxs(sc,{className:"w-full grid grid-cols-2 sm:w-auto sm:inline-flex text-sm",children:[a.jsx(Pa,{value:"comandas",className:"text-sm",children:"Comandas"}),a.jsx(Pa,{value:"fechamentos",className:"text-sm",children:"Fechamentos"})]})})})]}),a.jsxs("div",{className:"hidden sm:flex w-full sm:w-auto items-center gap-2 sm:gap-3",children:[_==="comandas"&&a.jsxs(a.Fragment,{children:[a.jsxs(se,{variant:"secondary",size:"sm",className:"hidden sm:inline-flex",onClick:()=>ue(!0),children:[a.jsx(Vi,{className:"mr-2 h-4 w-4"}),"Importar XML"]}),a.jsxs(se,{variant:"outline",size:"sm",className:"hidden sm:inline-flex",onClick:De,children:[a.jsx(ks,{className:"mr-1 h-3 w-3"}),"Exportar"]}),a.jsx("button",{className:"hidden sm:inline-block text-xs text-text-muted hover:text-text-primary transition-colors",onClick:()=>{if(oe){const Me=new Date().toISOString().slice(0,10);u(Me),h(Me),me(!1)}else u(""),h(""),me(!0);pt(0)},title:oe?"Voltar ao filtro de hoje":"Mostrar todas as comandas",children:oe?"":""}),a.jsxs("div",{className:"text-sm text-text-secondary whitespace-nowrap ml-auto",children:["Total: ",a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",je.sum.toFixed(2)]})]})]}),_==="fechamentos"&&a.jsxs(se,{variant:"outline",size:"sm",className:"hidden sm:inline-flex",onClick:ne,children:[a.jsx(ks,{className:"mr-1 h-3 w-3"}),"Exportar"]})]})]}),a.jsx(In,{open:ve,onOpenChange:ae,children:a.jsxs(En,{className:"sm:hidden w-[92vw] max-w-[360px] p-2",onOpenAutoFocus:Me=>Me.preventDefault(),onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{className:"text-base",children:"Aes"}),a.jsx(Hn,{children:"Escolha uma ao para Comandas"})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs(se,{variant:"secondary",onClick:()=>{ae(!1),ue(!0)},children:[a.jsx(Vi,{className:"mr-2 h-4 w-4"})," Importar XML"]}),a.jsxs(se,{variant:"outline",onClick:()=>{ae(!1),De()},children:[a.jsx(ks,{className:"mr-2 h-4 w-4"})," Exportar CSV"]})]})]})}),_==="comandas"&&a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:["Carregadas ",l.length," ",l.length===1?"comanda":"comandas"]}),Ze&&a.jsx(se,{size:"sm",variant:"outline",disabled:o,onClick:async()=>{const Me=ht+ie;pt(Me),await gr({append:!0})},children:"Carregar mais"})]}),_==="comandas"&&a.jsxs("div",{className:"sm:hidden bg-surface rounded-lg border border-border p-3 mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Buscar...",className:"pl-9 h-9 text-sm",value:g,onChange:Me=>y(Me.target.value)})]}),a.jsx(se,{size:"sm",variant:"outline",className:"h-9",onClick:()=>C(Me=>!Me),children:S?"Ocultar":"Filtros"})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-secondary truncate",children:[d||"","  ",f||""]})]}),_==="comandas"&&a.jsx(Er.div,{variants:cb,className:`bg-surface rounded-lg border border-border p-4 mb-4 ${S?"":"hidden"} sm:block`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Perodo Inicial"}),a.jsx(sj,{value:d,onChange:u})]}),a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Perodo Final"}),a.jsx(sj,{value:f,onChange:h})]}),a.jsxs("div",{className:"md:col-span-2 hidden sm:block",children:[a.jsxs(it,{className:"mb-1 block",children:["Busca ",A&&a.jsxs("span",{className:"text-xs text-warning ml-1",children:["(",A,")"]})]}),a.jsxs("div",{className:"relative",children:[a.jsx(Mo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(Ct,{placeholder:"Mesa, status (fechada/aberta) ou cliente",className:"pl-9 pr-12",value:g,onChange:Me=>y(Me.target.value)}),s&&a.jsx(se,{size:"sm",variant:"ghost",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 text-xs",onClick:()=>{t("/historico")},children:" Limpar"})]})]}),a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Status"}),a.jsxs(Gn,{value:m,onValueChange:x,children:[a.jsx(Vn,{className:"w-full text-xs",children:a.jsx(Kn,{placeholder:"Selecionar status"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"closed",children:"Fechadas"}),a.jsx(lt,{value:"open",children:"Abertas"}),a.jsx(lt,{value:"awaiting-payment",children:"Pagamento"}),a.jsx(lt,{value:"cancelled",children:"Canceladas"})]})]})]}),a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Tipo"}),a.jsxs(Gn,{value:b,onValueChange:w,children:[a.jsx(Vn,{className:"w-full text-xs",children:a.jsx(Kn,{placeholder:"Selecionar tipo"})}),a.jsxs(Wn,{children:[a.jsx(lt,{value:"all",children:"Todos"}),a.jsx(lt,{value:"comanda",children:"Comandas"}),a.jsx(lt,{value:"balcao",children:"Balco"})]})]})]})]})}),_==="comandas"&&a.jsxs(Er.div,{variants:cb,className:"bg-surface rounded-lg border border-border p-0 overflow-hidden",children:[a.jsx("div",{className:"hidden sm:block overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-4 py-3 whitespace-nowrap",children:"Local"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Clientes"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Finalizadora"}),a.jsx("th",{className:"text-left px-4 py-3 whitespace-nowrap",children:"Abertura"}),a.jsx("th",{className:"text-right px-4 py-3 whitespace-nowrap",children:"Diferena"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Total"}),a.jsx("th",{className:"text-right px-4 py-3 whitespace-nowrap",children:"Fiscal"})]})}),a.jsxs("tbody",{children:[$t.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-text-muted",children:"Nenhuma comanda encontrada no perodo."})}),$t.map(Me=>a.jsxs("tr",{className:"border-t border-border/70 hover:bg-warning/10 cursor-pointer transition-all duration-150 hover:translate-x-[1px]",onClick:()=>fr(Me.id),children:[a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:Me.mesa_id==null?"Balco":Me.mesaNumero!=null?`Mesa ${Me.mesaNumero}`:""}),a.jsx("td",{className:"px-4 py-2 break-words",title:Me.clientesStr||"",children:Me.clientesStr||""}),a.jsx("td",{className:"px-4 py-2",children:a.jsx("span",{className:Sr("inline-flex items-center text-[11px] font-medium px-2 py-0.5 rounded-full border",Cr(Me.statusDerived||Me.status)),children:Ut(Me.statusDerived||Me.status)})}),a.jsx("td",{className:"px-4 py-2 break-words",title:Me.finalizadorasStr||"",children:Me.finalizadorasStr||""}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:Fe(Me.aberto_em)}),a.jsx("td",{className:"px-4 py-2 text-right whitespace-nowrap",children:(()=>{const Qe=typeof Me.diferenca_pagamento=="number"?Me.diferenca_pagamento:0;if(Math.abs(Qe)<.005)return a.jsx("span",{className:"text-xs text-text-muted",children:"R$ 0,00"});const et=Qe>0?"text-emerald-500":"text-amber-500",Yt=Qe>0?"+":"-";return a.jsx("span",{className:`text-xs font-semibold ${et}`,children:`${Yt} R$ ${Math.abs(Qe).toFixed(2)}`})})()}),a.jsx("td",{className:"px-4 py-2 text-right font-semibold whitespace-nowrap",children:Ot(Me.total)}),a.jsx("td",{className:"px-4 py-2 text-right whitespace-nowrap",children:Me.fechado_em&&(!Me.nf_status||Me.nf_status==="rejeitada")&&a.jsx(se,{size:"sm",variant:"outline",onClick:Qe=>{Qe.stopPropagation(),J(Me.id)},children:"Pr-Emisso"})})]},Me.id))]})]})}),a.jsxs("div",{className:"sm:hidden divide-y divide-border",children:[$t.length===0&&a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Nenhuma comanda encontrada no perodo."}),$t.map(Me=>a.jsxs("button",{className:"w-full text-left p-3 active:bg-warning/10",onClick:()=>fr(Me.id),children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:Me.mesa_id==null?"Balco":Me.mesaNumero!=null?`Mesa ${Me.mesaNumero}`:"Comanda"}),a.jsx("div",{className:"font-semibold truncate max-w-[220px]",children:Me.clientesStr||"Sem cliente"})]}),a.jsx("div",{children:a.jsx("div",{className:Sr("inline-flex items-center text-[10px] font-medium px-2 py-0.5 rounded-full border",Cr(Me.statusDerived||Me.status)),children:Ut(Me.statusDerived||Me.status)})})]}),a.jsx("div",{className:"mt-1 text-xs text-text-secondary truncate",children:Me.finalizadorasStr||""}),a.jsxs("div",{className:"mt-2 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0 text-[11px] text-text-muted truncate pr-2",children:[Fe(Me.aberto_em),Me.fechado_em?`  ${Fe(Me.fechado_em)}`:""]}),a.jsxs("div",{className:"flex-shrink-0 text-right min-w-[84px]",children:[a.jsx("div",{className:"text-[11px]",children:(()=>{const Qe=typeof Me.diferenca_pagamento=="number"?Me.diferenca_pagamento:0;if(Math.abs(Qe)<.005)return a.jsx("span",{className:"text-text-muted",children:"Dif.: R$ 0,00"});const et=Qe>0?"text-emerald-500":"text-amber-500",Yt=Qe>0?"+":"-";return a.jsx("span",{className:et,children:`Dif.: ${Yt} R$ ${Math.abs(Qe).toFixed(2)}`})})()}),a.jsx("div",{className:"font-mono font-semibold whitespace-nowrap",children:Ot(Me.total)})]})]}),Me.fechado_em&&(!Me.nf_status||Me.nf_status==="rejeitada")&&a.jsx("div",{className:"mt-2 flex justify-end",children:a.jsx(se,{size:"sm",variant:"outline",onClick:Qe=>{Qe.preventDefault(),Qe.stopPropagation(),J(Me.id)},children:"Pr-Emisso"})})]},Me.id))]})]}),a.jsx(In,{open:L,onOpenChange:W,children:a.jsxs(En,{className:"max-w-[800px]",children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Pr-Emisso NFC-e"}),a.jsx(Hn,{children:"Revise os dados e pendncias antes de emitir."})]}),ge?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Gerando prvia"}):a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"JSON (EnviarNfce)"}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto",children:V?JSON.stringify(V,null,2):""})]}),a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Pendncias"}),!Y||Y.length===0?a.jsx("div",{className:"text-sm text-emerald-500",children:"Nenhuma pendncia encontrada."}):a.jsx("ul",{className:"list-disc pl-5 text-sm",children:Y.map((Me,Qe)=>a.jsx("li",{children:Me},Qe))})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(se,{variant:"outline",onClick:()=>W(!1),children:"Fechar"}),a.jsx(se,{disabled:!0,children:"Emitir (desabilitado)"})]})]})}),_==="fechamentos"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"sm:hidden bg-surface rounded-lg border border-border p-3 mb-3",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Filtros"}),a.jsx(se,{size:"sm",variant:"outline",onClick:()=>C(Me=>!Me),children:S?"Ocultar filtros":"Mostrar filtros"})]})}),a.jsx(Er.div,{variants:cb,className:`bg-surface rounded-lg border border-border p-4 mb-4 ${S?"":"hidden"} sm:block`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Perodo Inicial"}),a.jsx(sj,{value:d,onChange:u})]}),a.jsxs("div",{children:[a.jsx(it,{className:"mb-1 block",children:"Perodo Final"}),a.jsx(sj,{value:f,onChange:h})]})]})}),a.jsxs(Er.div,{variants:cb,className:"bg-surface rounded-lg border border-border p-4 overflow-hidden",children:[a.jsxs("div",{className:"sm:hidden space-y-2",children:[o&&(!l||l.length===0)&&a.jsxs("div",{className:"px-2 py-3 text-center text-text-muted",children:[a.jsx(Zl,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando fechamentos"]}),(!l||l.length===0)&&!o&&a.jsx("div",{className:"px-2 py-3 text-center text-text-muted",children:"Nenhum fechamento encontrado no perodo."}),(l||[]).map(Me=>a.jsxs("button",{onClick:async()=>{try{U({open:!0,loading:!0,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}});const Qe=Pt(),[et,Yt]=await Promise.all([WS({caixaSessaoId:Me.id,codigoEmpresa:Qe}).catch(()=>null),kg({caixaSessaoId:Me.id,codigoEmpresa:Qe}).catch(()=>[])]);let xr=et?.movimentos||null;if(!xr&&Array.isArray(Yt)){const kr={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const _r of Yt){const Rr=String(_r?.tipo||"").toLowerCase(),nn=Number(_r?.valor||0);Rr==="suprimento"?kr.suprimentos+=nn:Rr==="sangria"?kr.sangrias+=nn:Rr==="ajuste"?kr.ajustes+=nn:Rr==="troco"&&(kr.troco+=nn)}xr=kr}const Jt=et?{totalDescontos:Number(et.total_descontos||0),totalVendasLiquidas:Number(et.total_liquido||0),totalEntradas:Number(et.total_entradas||0),totalPorFinalizadora:et.por_finalizadora||{}}:null;U({open:!0,loading:!1,resumo:Jt,periodo:{from:et?.periodo_de||Me.aberto_em,to:et?.periodo_ate||Me.fechado_em},movs:Yt||[],movimentosAgg:xr,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}})}catch{U({open:!0,loading:!1,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}})}},className:"w-full text-left p-3 rounded-lg border border-border hover:bg-surface-2 transition",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:[Fe(Me.aberto_em),a.jsx("span",{className:"mx-1",children:""}),Fe(Me.fechado_em)]}),a.jsx("div",{className:"text-[11px] px-2 py-0.5 rounded-full border bg-success/10 text-success border-success/30",children:xt(Me.status)})]}),a.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:"bg-surface-2 rounded p-2 border border-border",children:[a.jsx("div",{className:"text-[10px] text-text-secondary",children:"Saldo Inicial"}),a.jsx("div",{className:"font-semibold",children:Me?.saldo_inicial!=null?Ot(Me.saldo_inicial):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded p-2 border border-border",children:[a.jsx("div",{className:"text-[10px] text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("div",{className:"font-semibold",children:Me?.valor_final_dinheiro!=null?Ot(Me.valor_final_dinheiro):""})]})]})]},Me.id))]}),a.jsx("div",{className:"hidden sm:block overflow-x-auto max-h-[60vh] overflow-y-auto pr-2 sm:pr-3",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-4 py-3",children:"Abertura"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Fechamento"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Saldo Inicial"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Saldo Final (contado)"})]})}),a.jsxs("tbody",{children:[o&&(!l||l.length===0)&&a.jsx("tr",{children:a.jsxs("td",{colSpan:5,className:"px-4 py-6 text-center text-text-muted",children:[a.jsx(Zl,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando fechamentos"]})}),(!l||l.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-text-muted",children:"Nenhum fechamento encontrado no perodo."})}),(l||[]).map(Me=>a.jsxs("tr",{className:"border-t border-border/70 hover:bg-success/10 cursor-pointer transition-all duration-150 hover:translate-x-[1px]",onClick:async()=>{try{U({open:!0,loading:!0,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}});const Qe=async()=>{const xr=Pt(),[Jt,kr]=await Promise.all([WS({caixaSessaoId:Me.id,codigoEmpresa:xr}).catch(()=>null),kg({caixaSessaoId:Me.id,codigoEmpresa:xr}).catch(()=>[])]);return{snap:Jt,movs:kr}};let{snap:et,movs:Yt}=await Qe();if(et||(await new Promise(xr=>setTimeout(xr,700)),{snap:et,movs:Yt}=await Qe()),et){const xr={totalDescontos:Number(et.total_descontos||0),totalVendasLiquidas:Number(et.total_liquido||0),totalEntradas:Number(et.total_entradas||0),totalPorFinalizadora:et.por_finalizadora||{}};let Jt=et.movimentos||null;if(!Jt&&Array.isArray(Yt)){const kr={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const _r of Yt){const Rr=String(_r?.tipo||"").toLowerCase(),nn=Number(_r?.valor||0);Rr==="suprimento"?kr.suprimentos+=nn:Rr==="sangria"?kr.sangrias+=nn:Rr==="ajuste"?kr.ajustes+=nn:Rr==="troco"&&(kr.troco+=nn)}Jt=kr}U({open:!0,loading:!1,resumo:xr,periodo:{from:et.periodo_de||Me.aberto_em,to:et.periodo_ate||Me.fechado_em},movs:Yt||[],movimentosAgg:Jt,saldos:{inicial:typeof et.saldo_inicial<"u"?Number(et.saldo_inicial):Me?.saldo_inicial??null,final:typeof et.valor_final_dinheiro<"u"?Number(et.valor_final_dinheiro):Me?.valor_final_dinheiro??null}})}else{const xr=Pt(),Jt=await Jd({from:Me.aberto_em,to:Me.fechado_em||new Date().toISOString(),codigoEmpresa:xr});let kr=null;if(Array.isArray(Yt)){const _r={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const Rr of Yt){const nn=String(Rr?.tipo||"").toLowerCase(),rn=Number(Rr?.valor||0);nn==="suprimento"?_r.suprimentos+=rn:nn==="sangria"?_r.sangrias+=rn:nn==="ajuste"?_r.ajustes+=rn:nn==="troco"&&(_r.troco+=rn)}kr=_r}U({open:!0,loading:!1,resumo:Jt||null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:Yt||[],movimentosAgg:kr,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.valor_final_dinheiro??null}})}}catch{U({open:!0,loading:!1,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.valor_final_dinheiro??null}})}},children:[a.jsx("td",{className:"px-4 py-2",children:Fe(Me.aberto_em)}),a.jsx("td",{className:"px-4 py-2",children:Fe(Me.fechado_em)}),a.jsx("td",{className:"px-4 py-2",children:xt(Me.status)}),a.jsx("td",{className:"px-4 py-2 text-right",children:Me?.saldo_inicial!=null?Ot(Me.saldo_inicial):""}),a.jsx("td",{className:"px-4 py-2 text-right",children:Me?.valor_final_dinheiro!=null?Ot(Me.valor_final_dinheiro):""})]},Me.id))]})]})})]})]}),_==="comandas"&&a.jsx(In,{open:!!F,onOpenChange:Me=>{Me?_e.current=!0:(_e.current=!1,O(null),T({loading:!1,itens:[],pagamentos:[]}),B(null))},children:a.jsxs(En,{className:"sm:max-w-4xl w-[92vw] max-h-[90vh] overflow-hidden flex flex-col animate-none",onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsxs(Nn,{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("span",{children:k?a.jsxs("span",{children:[k.mesaLabel,k.clientesStr?a.jsxs("span",{className:"text-text-secondary",children:["  ",k.clientesStr]}):null]}):a.jsxs(a.Fragment,{children:["Comanda #",F||""]})}),k&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("span",{className:Sr("text-xs px-2 py-0.5 rounded-full border",Cr(k.status)),children:k.status==="closed"?"Fechada":k.status==="open"?"Aberta":"Cancelada"}),a.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-info/10 text-info border-info/30",children:k.tipo==="balcao"?"Balco":k.tipo==="comanda"?"Mesa":"Importada"})]})]}),a.jsx(Hn,{className:"space-y-1",children:k?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[k.aberto_em?a.jsxs(a.Fragment,{children:["Abertura: ",Fe(k.aberto_em)]}):"",k.fechado_em&&a.jsxs(a.Fragment,{children:[" ",""," ","Fechamento: ",Fe(k.fechado_em),(()=>{const Me=new Date(k.aberto_em),et=new Date(k.fechado_em)-Me,Yt=Math.floor(et/6e4),xr=Math.floor(Yt/60),Jt=Yt%60;return Yt>0?a.jsxs("span",{className:"text-text-muted",children:[" (",xr>0?`${xr}h `:"",Jt,"min)"]}):null})()]})]}),k.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:k.observacao.includes("Importado de XML")?a.jsxs("span",{className:"text-warning",children:[" ",k.observacao.split(`
`)[0]]}):a.jsxs("span",{children:["Obs: ",k.observacao]})})]}):a.jsx(a.Fragment,{children:"Itens e pagamentos registrados."})})]}),I.loading?a.jsxs("div",{className:"p-6 text-center text-text-muted",children:[a.jsx(Zl,{className:"mr-2 inline h-4 w-4 animate-spin"})," Carregando..."]}):a.jsxs("div",{className:"space-y-4 overflow-y-auto flex-1 px-1",children:[(()=>{const Me=I.itens.reduce((kr,_r)=>kr+Number(_r.quantidade||0)*Number(_r.preco_unitario||0),0),Qe=I.itens.reduce((kr,_r)=>kr+Number(_r.desconto||0),0),et=Me-Qe,Yt=I.pagamentos.reduce((kr,_r)=>kr+Number(_r.valor||0),0),xr=typeof k?.diferenca_pagamento=="number"?k.diferenca_pagamento:null,Jt=xr??Yt-et;return a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Resumo Financeiro"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Subtotal"}),a.jsxs("span",{className:"font-mono font-semibold",children:["R$ ",Me.toFixed(2)]})]}),Qe>0&&a.jsxs("div",{className:"flex items-center gap-2 text-warning",children:[a.jsx("span",{children:"Desconto"}),a.jsxs("span",{className:"font-mono font-semibold",children:["-R$ ",Qe.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex justify-between font-semibold pt-2 border-t border-border",children:[a.jsx("span",{children:"Total:"}),a.jsxs("span",{className:"font-mono text-lg",children:["R$ ",et.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2 text-success",children:[a.jsx("span",{children:"Pagamentos"}),a.jsxs("span",{className:"font-mono",children:["R$ ",Yt.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-secondary",children:"Diferena"}),a.jsx("span",{className:Sr("font-semibold",Math.abs(Jt)<.005?"text-text-muted":Jt>0?"text-emerald-500":"text-amber-500"),children:Math.abs(Jt)<.005?"R$ 0,00":`${Jt>0?"+":"-"} R$ ${Math.abs(Jt).toFixed(2)}`})]})]})]})]})})(),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"border rounded-md p-3",children:[a.jsxs("div",{className:"font-semibold mb-2",children:["Itens (",I.itens.length,")"]}),I.itens.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem itens."}):a.jsx("ul",{className:"text-sm space-y-2 max-h-64 overflow-auto thin-scroll",children:I.itens.map(Me=>{const Qe=Number(Me.quantidade||0)*Number(Me.preco_unitario||0),et=Number(Me.desconto||0),Yt=Qe-et;return a.jsx("li",{className:"border-b border-border/50 pb-2 last:border-0",children:a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("span",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:Me.descricao}),a.jsxs("div",{className:"text-xs text-text-muted",children:[Me.quantidade," x R$ ",Number(Me.preco_unitario||0).toFixed(2),et>0&&a.jsxs("span",{className:"text-warning",children:[" (desc: R$ ",et.toFixed(2),")"]})]})]}),a.jsxs("span",{className:"font-mono font-semibold whitespace-nowrap",children:["R$ ",Yt.toFixed(2)]})]})},Me.id)})})]}),a.jsxs("div",{className:"border rounded-md p-3",children:[a.jsxs("div",{className:"font-semibold mb-2",children:["Pagamentos (",I.pagamentos.length,")"]}),I.pagamentos.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros."}):a.jsx("ul",{className:"text-sm space-y-2 max-h-64 overflow-auto thin-scroll",children:I.pagamentos.map(Me=>a.jsxs("li",{className:"flex justify-between gap-2 border-b border-border/50 pb-2 last:border-0",children:[a.jsxs("span",{className:"pr-2 break-words flex-1",children:[Me.cliente_nome?a.jsx("div",{className:"font-medium",children:Me.cliente_nome}):a.jsx("div",{className:"text-text-muted",children:"Sem cliente"}),a.jsx("div",{className:"text-xs text-text-secondary",children:Me.finalizadora_nome||"Outros"})]}),a.jsxs("span",{className:"font-mono font-semibold whitespace-nowrap",children:["R$ ",Number(Me.valor||0).toFixed(2)]})]},Me.id))})]})]})]}),a.jsx(Na,{children:a.jsx(se,{size:"sm",variant:"secondary",onClick:()=>{O(null)},children:"Fechar"})})]})}),_==="fechamentos"&&a.jsx(In,{open:z.open,onOpenChange:Me=>{Me||U({open:!1,loading:!1,resumo:null,periodo:{from:null,to:null}})},children:a.jsxs(En,{className:"sm:max-w-2xl w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden overflow-x-hidden",onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Cn,{children:[a.jsx(Nn,{children:"Fechamento do Perodo"}),a.jsxs(Hn,{children:[z.periodo.from?Fe(z.periodo.from):""," ","at"," ",z.periodo.to?Fe(z.periodo.to):""]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto pr-1",children:z.loading?a.jsxs("div",{className:"p-3 sm:p-4 text-text-muted",children:[a.jsx(Zl,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando resumo"]}):a.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Inicial"}),a.jsx("p",{className:"text-xl font-bold",children:Ot(z?.saldos?.inicial??0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Entradas (pagamentos)"}),a.jsx("p",{className:"text-xl font-bold text-success",children:Ot(z.resumo?.totalEntradas||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border col-span-2 sm:col-span-1",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("p",{className:"text-xl font-bold",children:z?.saldos?.final!=null?Ot(z.saldos.final):""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Descontos"}),a.jsx("p",{className:"text-xl font-bold text-warning",children:Ot(z.resumo?.totalDescontos||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Lquido"}),a.jsx("p",{className:"text-xl font-bold",children:Ot(z.resumo?.totalVendasLiquidas||0)})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Por Finalizadora"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:z.resumo?.totalPorFinalizadora&&Object.keys(z.resumo.totalPorFinalizadora).length>0?Object.entries(z.resumo.totalPorFinalizadora).map(([Me,Qe])=>a.jsxs("div",{className:"flex items-center justify-between bg-surface-2 rounded-md p-2 border border-border",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:String(Me)}),a.jsx("span",{className:"text-sm font-semibold",children:Ot(Qe)})]},Me)):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados de finalizadoras"})})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Resumo de Movimentaes"}),z.movimentosAgg?a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Suprimentos"}),a.jsx("p",{className:"text-lg font-bold text-success",children:Ot(z.movimentosAgg?.suprimentos||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Sangrias"}),a.jsx("p",{className:"text-lg font-bold text-danger",children:Ot(z.movimentosAgg?.sangrias||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Ajustes"}),a.jsx("p",{className:"text-lg font-bold",children:Ot(z.movimentosAgg?.ajustes||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Troco"}),a.jsx("p",{className:"text-lg font-bold",children:Ot(z.movimentosAgg?.troco||0)})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem movimentaes agregadas nesta sesso."})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Movimentaes"}),!z.movs||z.movs.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma movimentao registrada"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"sm:hidden divide-y divide-border rounded-md border border-border overflow-hidden",children:z.movs.map((Me,Qe)=>a.jsxs("li",{className:"px-3 py-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:Fe(Me.criado_em)}),a.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:Ot(Me.valor||0)})]}),a.jsxs("div",{className:"mt-0.5 flex items-center gap-2 text-xs",children:[a.jsx("span",{className:"px-1.5 py-0.5 rounded bg-surface-2 border border-border text-text-secondary whitespace-nowrap",children:String(Me.tipo||"").toUpperCase()}),a.jsx("span",{className:"text-xs text-text-primary whitespace-normal break-words flex-1",children:Me.observacao||""})]})]},Qe))}),a.jsx("div",{className:"hidden sm:block rounded-md border border-border overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-3 py-2",children:"Data"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Tipo"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Obs"}),a.jsx("th",{className:"text-right px-3 py-2",children:"Valor"})]})}),a.jsx("tbody",{children:z.movs.map((Me,Qe)=>a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:Fe(Me.criado_em)}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:String(Me.tipo||"").toUpperCase()}),a.jsx("td",{className:"px-3 py-2 whitespace-normal break-words",children:Me.observacao||""}),a.jsx("td",{className:"px-3 py-2 text-right font-semibold whitespace-nowrap",children:Ot(Me.valor||0)})]},Qe))})]})})]})]})]})})]})}),a.jsx(olt,{open:G,onOpenChange:ue,codigoEmpresa:r?.codigo_empresa,onSuccess:async Me=>{ue(!1),Me&&(u(Me),h(Me)),await new Promise(Qe=>setTimeout(Qe,500)),pt(0),await gr({append:!1})}})]})}function dlt(){const{userProfile:e}=qs(),[t]=DC(),r=t.get("comanda"),[n,s]=p.useState(!0),[o,i]=p.useState(null),[l,c]=p.useState([]),[d,u]=p.useState([]),[f,h]=p.useState([]),[m,x]=p.useState(null),[g,y]=p.useState(""),[v,b]=p.useState("");p.useEffect(()=>{(async()=>{try{if(!r||!e?.codigo_empresa)return;try{const{data:T,error:k}=await re.from("empresas").select("nome_fantasia, nome").eq("codigo_empresa",e.codigo_empresa).single();if(k&&console.warn("[PrintComandaPage] Erro ao buscar empresa:",k.message),T){const B=T.nome_fantasia||T.nome||"";console.log("[PrintComandaPage] Empresa carregada:",T,"-> nome exibido:",B),b(B)}else console.warn("[PrintComandaPage] Empresa no encontrada para codigo_empresa:",e.codigo_empresa)}catch(T){console.warn("[PrintComandaPage] Exceo ao carregar empresa:",T)}const{data:C}=await re.from("comandas").select("mesa_id, observacoes").eq("id",r).eq("codigo_empresa",e.codigo_empresa).single();if(C?.mesa_id){const{data:T}=await re.from("mesas").select("numero").eq("id",C.mesa_id).eq("codigo_empresa",e.codigo_empresa).single();x(T)}y(C?.observacoes||"");const[A,P,F]=await Promise.all([To({comandaId:r,codigoEmpresa:e.codigo_empresa}),Bi({comandaId:r,codigoEmpresa:e.codigo_empresa}),one({comandaId:r,codigoEmpresa:e.codigo_empresa})]);c(A||[]),u(P||[]),h(F||[]);const O=(A||[]).reduce((T,k)=>T+Number(k.quantidade||0)*Number(k.preco_unitario||0),0),I=(F||[]).reduce((T,k)=>T+Number(k.valor||0),0);i({id:r,totalItens:O,totalPagamentos:I,diferenca:I-O})}catch(C){console.error("Erro ao carregar comanda:",C)}finally{s(!1)}})()},[r,e?.codigo_empresa]);const w=()=>{window.print()},_=()=>{window.history.back()};if(n)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand mx-auto mb-4"}),a.jsx("p",{className:"text-text-muted",children:"Carregando comanda..."})]})});if(!o)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-text-muted mb-4",children:"Comanda no encontrada"}),a.jsxs(se,{onClick:_,variant:"outline",children:[a.jsx(Ib,{className:"mr-2 h-4 w-4"}),"Voltar"]})]})});const j=(d||[]).map(S=>S?.nome||S?.nome_livre||"").filter(Boolean).join(", ")||"Sem cliente";return o.totalItens,o.totalPagamentos,a.jsxs("div",{className:"w-screen h-screen bg-gray-100 flex flex-col print:bg-white print:p-0",children:[a.jsxs("div",{className:"flex gap-2 p-4 bg-white border-b border-gray-200 print:hidden",children:[a.jsxs(se,{onClick:_,size:"sm",className:"bg-black text-white hover:bg-black/80 border border-black shadow-sm",children:[a.jsx(Ib,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(se,{onClick:w,size:"sm",className:"ml-auto",children:[a.jsx(jG,{className:"mr-2 h-4 w-4"}),"Imprimir"]})]}),a.jsx("div",{className:"flex-1 overflow-auto flex items-start justify-center p-4 print:p-0 print:overflow-visible print:flex-none",children:a.jsxs("div",{className:"w-80 border border-black p-6 bg-white print:border-0 print:p-0 print:w-full",children:[a.jsxs("div",{className:"text-center mb-4 border-b border-black pb-3",children:[a.jsx("p",{className:"text-xs font-semibold text-black mb-2",children:v||" "}),a.jsx("h1",{className:"text-xl font-bold text-black",children:"COMANDA"}),m&&a.jsxs("p",{className:"text-xs text-black mt-1",children:["Mesa ",m.numero]}),a.jsx("p",{className:"text-xs text-black mt-1",children:new Date().toLocaleString("pt-BR")})]}),a.jsxs("div",{className:"mb-6 pb-4 border-b border-black",children:[a.jsx("p",{className:"text-sm font-semibold text-black",children:"CLIENTE:"}),a.jsx("p",{className:"text-sm text-black",children:j})]}),a.jsx("div",{className:"mb-6 pb-4 border-b border-black",children:a.jsx("div",{className:"space-y-2",children:l.map((S,C)=>{const A=Number(S.quantidade||0)*Number(S.preco_unitario||0);return a.jsxs("div",{className:"flex justify-between text-sm text-black",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{children:S.descricao||"Item"}),a.jsxs("span",{className:"ml-2 text-xs",children:["x",S.quantidade]})]}),a.jsxs("span",{className:"font-semibold",children:["R$ ",A.toFixed(2)]})]},C)})})}),g&&a.jsxs("div",{className:"mb-4 pb-3",children:[a.jsx("p",{className:"text-xs font-semibold text-black mb-1",children:"OBS:"}),a.jsx("p",{className:"text-xs text-black border-b border-black pb-3",children:g})]}),a.jsx("div",{className:"text-center pt-4",children:a.jsxs("p",{className:"text-lg font-bold text-black mt-2",children:["TOTAL: R$ ",o.totalItens.toFixed(2)]})}),a.jsxs("div",{className:"text-center mt-8 pt-4 border-t border-black text-xs text-black",children:[a.jsx("p",{children:"Obrigado pela preferncia!"}),a.jsx("p",{className:"mt-2",children:"Fluxo7Arena"})]})]})}),a.jsx("style",{children:`
        @media print {
          body {
            margin: 0;
            padding: 0;
            background: white;
          }
          .print\\:hidden {
            display: none !important;
          }
          .print\\:border-0 {
            border: none !important;
          }
          .print\\:p-0 {
            padding: 0 !important;
          }
        }
      `})]})}const ult="18810778",Xx={hidden:{opacity:0,x:20},visible:{opacity:1,x:0,transition:{duration:.3}},exit:{opacity:0,x:-20,transition:{duration:.2}}};function flt(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,18)}function mlt(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").substring(0,15)}async function hlt(){try{const{data:e,error:t}=await re.from("empresas").select("codigo_empresa").order("codigo_empresa",{ascending:!1}).limit(100);if(t)return console.warn("Erro ao buscar cdigos:",t),"1";let r=0;return e&&e.length>0&&e.forEach(n=>{const s=parseInt(n.codigo_empresa);!isNaN(s)&&s>r&&(r=s)}),(r+1).toString()}catch(e){return console.warn("Erro ao gerar cdigo:",e),"1"}}function plt(){const{toast:e}=Ss(),t=hl(),[r,n]=p.useState(1),[s,o]=p.useState(!1),[i,l]=p.useState(!1),[c,d]=p.useState(""),[u,f]=p.useState({email:"",nomeUsuario:"",cargo:"",razaoSocial:"",nomeFantasia:"",cnpj:"",emailEmpresa:"",telefone:"",endereco:"",quadras:[],mesas:[],categorias:[]}),[h,m]=p.useState(null),x=U=>{U.preventDefault(),c===ult?(l(!0),n(2),e({title:"Acesso liberado",description:"Bem-vindo ao formulrio de criao de empresa."})):(e({title:"Senha incorreta",description:"Tente novamente.",variant:"destructive"}),d(""))},g=()=>!0,y=()=>u.razaoSocial.trim()?u.nomeFantasia.trim()?!0:(e({title:"Nome Fantasia obrigatrio",variant:"destructive"}),!1):(e({title:"Razo Social obrigatria",variant:"destructive"}),!1),v=()=>{r===2&&!g()||r===3&&!y()||n(r+1)},b=()=>{n(r-1)},w=()=>{const U=u.quadras.length+1;f({...u,quadras:[...u.quadras,{nome:`Quadra ${U}`}]})},_=U=>{f({...u,quadras:u.quadras.filter((L,W)=>W!==U)})},j=()=>{const U=u.mesas.length+1;f({...u,mesas:[...u.mesas,{numero:U,nome:`Mesa ${U}`}]})},S=U=>{f({...u,mesas:u.mesas.filter((L,W)=>W!==U)})},C=()=>{const U=prompt("Digite o nome da categoria:");U&&U.trim()&&f({...u,categorias:[...u.categorias,{nome:U.trim(),descricao:""}]})},A=U=>{f({...u,categorias:u.categorias.filter((L,W)=>W!==U)})},P=async()=>{try{o(!0);try{const V={user:{email:u.email?.trim()||null,nome:u.nomeUsuario?.trim()||null,cargo:u.cargo?.trim()||"admin"},empresa:{razao_social:u.razaoSocial?.trim()||null,nome_fantasia:u.nomeFantasia?.trim()||null,cnpj:u.cnpj?u.cnpj.replace(/\D/g,""):null,email:u.emailEmpresa?.trim()||null,telefone:u.telefone?.trim()||null,endereco:u.endereco?.trim()||null},quadras:u.quadras||[],mesas:u.mesas||[],categorias:u.categorias||[]},{data:$,error:Y}=await re.rpc("create_company_full",{payload:V});if(!Y&&$&&$.codigo_empresa){m({success:!0,codigoEmpresa:$.codigo_empresa,email:u.email,nomeEmpresa:u.nomeFantasia,numQuadras:(u.quadras||[]).length,numMesas:(u.mesas||[]).length,numCategorias:(u.categorias||[]).length}),n(6),e({title:" Empresa criada com sucesso!",description:`Cdigo: ${$.codigo_empresa}`});return}else Y&&console.warn("RPC create_company_full indisponvel/erro. Usando fluxo local.",Y?.message||Y)}catch(V){console.warn("Falha ao tentar RPC create_company_full. Usando fluxo local.",V?.message||V)}let U=null;u.email.trim()&&(console.log("Email fornecido:",u.email),console.log("Nota: O vnculo com o usurio ser criado no primeiro login"),U=null);const L=await hlt();console.log("Cdigo da empresa gerado:",L);const{data:W,error:ge}=await re.from("empresas").insert({codigo_empresa:L,nome:u.nomeFantasia,razao_social:u.razaoSocial,nome_fantasia:u.nomeFantasia,cnpj:u.cnpj?u.cnpj.replace(/\D/g,""):null,email:u.emailEmpresa||null,telefone:u.telefone||null,endereco:u.endereco||null}).select().single();if(ge)throw new Error("Erro ao criar empresa: "+ge.message);const{error:Ae}=await re.from("empresa_counters").insert({empresa_id:W.id,next_cliente_codigo:1,next_agendamento_codigo:1});if(Ae&&console.warn("Erro ao criar contador:",Ae),u.email.trim()||u.nomeUsuario.trim())try{const V="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(he){const J=Math.random()*16|0;return(he==="x"?J:J&3|8).toString(16)}),{error:$}=await re.from("usuarios").insert({id:V,email:u.email||null,nome:u.nomeUsuario||null,papel:u.cargo||"admin",codigo_empresa:L});$&&console.warn("Aviso ao criar usurio:",$.message);const{error:Y}=await re.from("colaboradores").insert({id:V,nome:u.nomeUsuario||"Administrador",cargo:u.cargo||"admin",ativo:!0,codigo_empresa:L});Y&&console.warn("Aviso ao criar colaborador:",Y.message),u.email&&(console.log(" APS O PRIMEIRO LOGIN, execute este SQL no Supabase:"),console.log(`
-- Atualizar ID do colaborador com o ID real do auth.users
UPDATE public.colaboradores 
SET id = (SELECT id FROM auth.users WHERE email = '${u.email}')
WHERE codigo_empresa = '${L}' AND id = '${V}';

-- Atualizar ID do usurio
UPDATE public.usuarios 
SET id = (SELECT id FROM auth.users WHERE email = '${u.email}')
WHERE codigo_empresa = '${L}' AND id = '${V}';
            `))}catch(V){console.warn("Erro ao criar registros de usurio:",V)}try{await re.from("agenda_settings").insert({empresa_id:W.id,auto_confirm_enabled:!1,auto_start_enabled:!0,auto_finish_enabled:!0})}catch(V){console.warn("Aviso: no foi possvel criar agenda_settings agora (provvel RLS). Ser configurado aps o primeiro login.",V?.message||V)}if(u.quadras.length>0){const V=u.quadras.map($=>({nome:$.nome,codigo_empresa:L}));await re.from("quadras").insert(V)}if(u.mesas.length>0){const V=u.mesas.map($=>({numero:$.numero,nome:$.nome,codigo_empresa:L,status:"available"}));await re.from("mesas").insert(V)}if(u.categorias.length>0){const V=u.categorias.map($=>({nome:$.nome,descricao:$.descricao||null,codigo_empresa:L,ativa:!0}));await re.from("produto_categorias").insert(V)}m({success:!0,codigoEmpresa:L,email:u.email,nomeEmpresa:u.nomeFantasia,numQuadras:u.quadras.length,numMesas:u.mesas.length,numCategorias:u.categorias.length}),n(6),e({title:" Empresa criada com sucesso!",description:`Cdigo: ${L}`})}catch(U){console.error("Erro ao criar empresa:",U),e({title:"Erro ao criar empresa",description:U.message,variant:"destructive"})}finally{o(!1)}},F=()=>{if(r===1||r===6)return null;const U=(r-1)/4*100;return a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-text-muted",children:["Etapa ",r-1," de 4"]}),a.jsxs("span",{className:"text-sm text-text-muted",children:[Math.round(U),"%"]})]}),a.jsx("div",{className:"h-2 bg-surface-2 rounded-full overflow-hidden",children:a.jsx(Er.div,{className:"h-full bg-brand",initial:{width:0},animate:{width:`${U}%`},transition:{duration:.3}})})]})},O=()=>a.jsxs(Er.div,{variants:Xx,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-md mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(e0,{className:"w-8 h-8 text-brand"})}),a.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"rea Restrita"}),a.jsx("p",{className:"text-text-muted",children:"Digite a senha para acessar"})]}),a.jsxs("form",{onSubmit:x,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"senha",children:"Senha de Acesso"}),a.jsx(Ct,{id:"senha",type:"password",value:c,onChange:U=>d(U.target.value),placeholder:"Digite a senha",className:"text-center text-lg tracking-widest",autoFocus:!0})]}),a.jsxs(se,{type:"submit",className:"w-full",children:["Acessar",a.jsx(o_,{className:"ml-2 h-4 w-4"})]})]})]},"step1"),I=()=>a.jsxs(Er.div,{variants:Xx,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(xf,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Primeiro Usurio"}),a.jsx("p",{className:"text-text-muted",children:"Informaes do administrador da empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx(it,{htmlFor:"email",children:"Email cadastrado no Supabase Auth"}),a.jsx(Ct,{id:"email",type:"email",value:u.email,onChange:U=>f({...u,email:U.target.value}),placeholder:"usuario@email.com"}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Este email j deve estar cadastrado no Supabase Auth"})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"nomeUsuario",children:"Nome Completo"}),a.jsx(Ct,{id:"nomeUsuario",type:"text",value:u.nomeUsuario,onChange:U=>f({...u,nomeUsuario:U.target.value}),placeholder:"Joo Silva"})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"cargo",children:"Cargo na Empresa"}),a.jsx(Ct,{id:"cargo",type:"text",value:u.cargo,onChange:U=>f({...u,cargo:U.target.value}),placeholder:"Ex: Proprietrio, Gerente, Administrador, Scio, etc."}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Digite o cargo que voc ocupa na empresa"})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx(se,{type:"button",variant:"outline",onClick:()=>t("/"),className:"flex-1",children:"Cancelar"}),a.jsxs(se,{type:"button",onClick:v,className:"flex-1",children:["Prximo",a.jsx(o_,{className:"ml-2 h-4 w-4"})]})]})]})]},"step2"),T=()=>a.jsxs(Er.div,{variants:Xx,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(hN,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Dados da Empresa"}),a.jsx("p",{className:"text-text-muted",children:"Informaes cadastrais da empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(it,{htmlFor:"razaoSocial",children:"Razo Social *"}),a.jsx(Ct,{id:"razaoSocial",type:"text",value:u.razaoSocial,onChange:U=>f({...u,razaoSocial:U.target.value}),placeholder:"Empresa LTDA"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(it,{htmlFor:"nomeFantasia",children:"Nome Fantasia *"}),a.jsx(Ct,{id:"nomeFantasia",type:"text",value:u.nomeFantasia,onChange:U=>f({...u,nomeFantasia:U.target.value}),placeholder:"Minha Empresa"}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Como a empresa aparecer no sistema"})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"cnpj",children:"CNPJ"}),a.jsx(Ct,{id:"cnpj",type:"text",value:u.cnpj,onChange:U=>f({...u,cnpj:flt(U.target.value)}),placeholder:"00.000.000/0000-00"})]}),a.jsxs("div",{children:[a.jsx(it,{htmlFor:"telefone",children:"Telefone"}),a.jsx(Ct,{id:"telefone",type:"tel",value:u.telefone,onChange:U=>f({...u,telefone:mlt(U.target.value)}),placeholder:"(11) 99999-9999"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(it,{htmlFor:"emailEmpresa",children:"Email da Empresa"}),a.jsx(Ct,{id:"emailEmpresa",type:"email",value:u.emailEmpresa,onChange:U=>f({...u,emailEmpresa:U.target.value}),placeholder:"contato@empresa.com"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(it,{htmlFor:"endereco",children:"Endereo Completo (opcional)"}),a.jsx(Ct,{id:"endereco",type:"text",value:u.endereco,onChange:U=>f({...u,endereco:U.target.value}),placeholder:"Rua X, 123, Bairro, Cidade - UF"})]})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(se,{type:"button",variant:"outline",onClick:b,className:"flex-1",children:[a.jsx(Ib,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(se,{type:"button",onClick:v,className:"flex-1",children:["Prximo",a.jsx(o_,{className:"ml-2 h-4 w-4"})]})]})]})]},"step3"),k=()=>a.jsxs(Er.div,{variants:Xx,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(fd,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Configurao Inicial"}),a.jsx("p",{className:"text-text-muted",children:"Adicione dados iniciais ou pule esta etapa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(zue,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Quadras Esportivas"})]}),a.jsxs(se,{type:"button",onClick:w,size:"sm",className:"gap-2",children:[a.jsx(Es,{className:"w-4 h-4"}),"Adicionar Quadra"]})]}),u.quadras.length>0?a.jsx("div",{className:"space-y-2",children:u.quadras.map((U,L)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:U.nome}),a.jsx(se,{type:"button",variant:"ghost",size:"sm",onClick:()=>_(L),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(lc,{className:"w-4 h-4"})})]},L))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma quadra adicionada"})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(tc,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Mesas da Loja"})]}),a.jsxs(se,{type:"button",onClick:j,size:"sm",className:"gap-2",children:[a.jsx(Es,{className:"w-4 h-4"}),"Adicionar Mesa"]})]}),u.mesas.length>0?a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:u.mesas.map((U,L)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:U.nome}),a.jsx(se,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(L),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(lc,{className:"w-4 h-4"})})]},L))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma mesa adicionada"})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(su,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Categorias de Produtos"})]}),a.jsxs(se,{type:"button",onClick:C,size:"sm",className:"gap-2",children:[a.jsx(Es,{className:"w-4 h-4"}),"Adicionar Categoria"]})]}),u.categorias.length>0?a.jsx("div",{className:"space-y-2",children:u.categorias.map((U,L)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:U.nome}),a.jsx(se,{type:"button",variant:"ghost",size:"sm",onClick:()=>A(L),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(lc,{className:"w-4 h-4"})})]},L))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma categoria adicionada"})]}),a.jsx("div",{className:"bg-info/10 border border-info/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(ud,{className:"w-5 h-5 text-info mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Configuraes Opcionais"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Voc pode adicionar quadras, mesas e categorias agora ou configurar depois no sistema."})]})]})}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(se,{type:"button",variant:"outline",onClick:b,className:"flex-1",children:[a.jsx(Ib,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(se,{type:"button",onClick:v,className:"flex-1",children:["Prximo",a.jsx(o_,{className:"ml-2 h-4 w-4"})]})]})]})]},"step4"),B=()=>a.jsxs(Er.div,{variants:Xx,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(vi,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Reviso Final"}),a.jsx("p",{className:"text-text-muted",children:"Confira os dados antes de criar a empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(xf,{className:"w-5 h-5"}),"Primeiro Usurio"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.email})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Nome:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.nomeUsuario})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Cargo:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.cargo})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(hN,{className:"w-5 h-5"}),"Empresa"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Razo Social:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.razaoSocial})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Nome Fantasia:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.nomeFantasia})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"CNPJ:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.cnpj})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.emailEmpresa})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Telefone:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.telefone})]}),u.endereco&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Endereo:"}),a.jsx("span",{className:"text-text-primary font-medium text-right",children:u.endereco})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(fd,{className:"w-5 h-5"}),"Configuraes Iniciais"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Quadras:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.quadras.length})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Mesas:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.mesas.length})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Categorias de Produtos:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.categorias.length})]})]})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(ud,{className:"w-5 h-5 text-warning mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Ateno"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Esta ao criar a empresa no banco de dados. Certifique-se de que todos os dados esto corretos."})]})]})}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(se,{type:"button",variant:"outline",onClick:b,className:"flex-1",disabled:s,children:[a.jsx(Ib,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsx(se,{type:"button",onClick:P,className:"flex-1 bg-emerald-600 hover:bg-emerald-500",disabled:s,children:s?a.jsxs(a.Fragment,{children:[a.jsx(Zl,{className:"mr-2 h-4 w-4 animate-spin"}),"Criando..."]}):a.jsx(a.Fragment,{children:" Criar Empresa"})})]})]})]},"step5"),z=()=>a.jsxs(Er.div,{variants:Xx,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-success/10 rounded-full mb-6",children:a.jsx(vi,{className:"w-12 h-12 text-success"})}),a.jsx("h2",{className:"text-3xl font-bold text-text-primary mb-2",children:" Empresa Criada!"}),a.jsx("p",{className:"text-text-muted",children:"Tudo pronto para comear a usar o sistema"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-brand/10 border border-brand/30 rounded-lg p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-text-muted mb-2",children:"Cdigo da Empresa"}),a.jsx("p",{className:"text-3xl font-bold text-brand font-mono",children:h?.codigoEmpresa})]})}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Dados de Acesso"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:h?.email})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Senha:"}),a.jsx("span",{className:"text-text-primary font-medium",children:"(a que voc definiu no Supabase)"})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Dados Criados"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Empresa"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Configuraes"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numQuadras}),a.jsx("div",{className:"text-xs text-text-muted",children:"Quadras"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numMesas}),a.jsx("div",{className:"text-xs text-text-muted",children:"Mesas"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numCategorias}),a.jsx("div",{className:"text-xs text-text-muted",children:"Categorias"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Pronto para Uso"})]})]})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(ud,{className:"w-5 h-5 text-warning mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:" IMPORTANTE: Execute o SQL Antes de Fazer Login"}),a.jsxs("div",{className:"space-y-2 text-xs text-text-muted",children:[a.jsx("p",{className:"font-semibold text-text-primary",children:"Para vincular seu usurio  empresa, siga estes passos:"}),a.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[a.jsxs("li",{children:["Abra o ",a.jsx("strong",{children:"Console do Navegador"})," (pressione F12)"]}),a.jsxs("li",{children:["Procure pela mensagem ",a.jsx("strong",{children:'" APS O PRIMEIRO LOGIN, execute este SQL"'})]}),a.jsx("li",{children:"Copie o comando SQL que aparece no console"}),a.jsxs("li",{children:["Acesse o ",a.jsx("strong",{children:"Supabase  SQL Editor"})]}),a.jsx("li",{children:"Cole e execute o SQL"}),a.jsx("li",{children:"Agora sim, faa login normalmente"})]}),a.jsx("p",{className:"mt-2 text-warning font-medium",children:' Se no executar o SQL, voc ver o erro "Empresa no vinculada"'})]})]})]})}),a.jsx("div",{className:"pt-4",children:a.jsx(se,{type:"button",onClick:()=>t("/"),className:"w-full bg-brand hover:bg-brand/90",children:"Ir para Login"})})]})]},"step6");return a.jsx(a.Fragment,{children:a.jsx("div",{className:"min-h-screen bg-background text-text-primary p-8",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[F(),a.jsxs(jge,{mode:"wait",children:[r===1&&O(),r===2&&I(),r===3&&T(),r===4&&k(),r===5&&B(),r===6&&z()]})]})})})}const glt=()=>a.jsx(Er.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex justify-start mb-6",children:a.jsxs("div",{className:"flex items-end gap-3 max-w-[85%] md:max-w-[75%]",children:[a.jsx(Hi,{size:"md",variant:"message"}),a.jsx("div",{className:"px-4 py-3 bg-brand border border-brand backdrop-blur-sm rounded-2xl rounded-bl-sm shadow-lg shadow-brand/20",children:a.jsx("div",{className:"flex gap-1.5",children:[0,1,2].map(e=>a.jsx(Er.div,{className:"w-2.5 h-2.5 md:w-2 md:h-2 bg-[#0A0A0A] rounded-full",animate:{y:[0,-6,0],opacity:[.4,1,.4]},transition:{duration:.8,repeat:1/0,delay:e*.2,ease:"easeInOut"}},e))})})]})}),xlt=({buttons:e,onSelect:t,disabled:r=!1,hideText:n=!1,hidden:s=!1})=>a.jsx(Er.div,{initial:{opacity:0,y:10,gridTemplateRows:"1fr"},animate:{opacity:s?0:1,y:s?-8:0,gridTemplateRows:s?"0fr":"1fr"},transition:{duration:.6,ease:[.16,1,.3,1]},className:`grid ml-12 md:ml-[68px] overflow-hidden transition-all duration-500 ${s?"mb-0 md:mb-0 pointer-events-none":"mb-2 md:mb-3"}`,children:a.jsx("div",{className:"flex flex-wrap gap-2 md:gap-2.5",children:e.map((o,i)=>a.jsx(Er.button,{initial:{opacity:0,scale:.92,y:4,filter:"blur(2px)"},animate:{opacity:s||n?0:1,scale:s?.96:1,y:s?-8:0,filter:s?"blur(3.5px)":"blur(0px)"},transition:{duration:s?.4:.45,delay:s?i*.03:.2+i*.05,ease:[.16,1,.3,1]},whileHover:{scale:r?1:1.02,y:r?0:-2},whileTap:{scale:r?1:.98},onClick:()=>!r&&t(o),disabled:r,className:`
              group relative px-5 py-3.5 md:px-6 md:py-4 rounded-xl font-semibold text-[15px] md:text-[15px]
              transition-all duration-300 ease-out
              ${r?"bg-surface/30 text-text-muted cursor-not-allowed border border-white/5":"bg-surface/70 backdrop-blur-sm text-text-primary border border-white/10 hover:border-brand/70 hover:bg-brand/10 hover:text-brand hover:shadow-lg hover:shadow-brand/20 shadow-md"}
              ${n?"opacity-0 pointer-events-none":""}
            `,children:a.jsxs("div",{className:"flex flex-col gap-0.5 md:gap-1 relative z-10",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[o.icon&&!n&&a.jsx("span",{className:`text-base md:text-lg transition-transform duration-300 ${!r&&"group-hover:scale-110"}`,children:o.icon}),!n&&a.jsx("span",{className:"font-semibold",children:o.label})]}),o.subtitle&&!n&&a.jsx("span",{className:"text-[12px] md:text-xs opacity-70 pl-6 md:pl-7 font-normal",children:o.subtitle})]})},o.value||i))})}),vlt=({children:e,onButtonClick:t,hideButtonTexts:r=!1})=>{const{messages:n,isTyping:s,chatEndRef:o}=l5(),[i,l]=p.useState(0),[c,d]=p.useState(void 0);return p.useEffect(()=>{const u=f=>{const h=!!f?.detail?.expanded,m=typeof window<"u"&&window.innerWidth<768,x=m?280:320,g=140,y=m?8:20,v=Math.max(0,x-g+y);l(h?v:0),d(h&&m?0:void 0)};try{window.addEventListener("isis-participantes-expand",u)}catch{}return()=>{try{window.removeEventListener("isis-participantes-expand",u)}catch{}}},[]),a.jsxs("div",{className:"flex flex-col min-h-full",children:[a.jsxs("div",{className:"flex-1 px-3 md:px-6 py-4 md:py-8",style:{paddingBottom:i,paddingTop:c},children:[n.map(u=>a.jsxs(Er.div,{layout:"position",transition:{duration:.35,ease:[.16,1,.3,1]},children:[a.jsx(Moe,{message:u}),u.type==="buttons"&&u.buttons&&a.jsx("div",{className:`overflow-hidden transition-all duration-500 ${u.buttonsHidden?"max-h-0 mb-0 md:mb-0":"max-h-[480px]"}`,children:a.jsx(xlt,{buttons:u.buttons,onSelect:f=>(t||u.onButtonClick)?.(f,u.id),disabled:u.disabled,hideText:r,hidden:!!u.buttonsHidden})})]},u.id)),s&&a.jsx(glt,{}),a.jsx("div",{ref:o})]}),a.jsx("div",{className:"sticky bottom-0 px-3 md:px-6 pb-3 md:pb-6 pt-3 md:pt-4 bg-gradient-to-t from-background via-background to-transparent",children:e})]})},ylt=({onSubmit:e,onMudarData:t,onMudarQuadra:r,hasMultipleQuadras:n=!1,disabled:s=!1,horariosDisponiveis:o=[],esportes:i=[]})=>{const[l,c]=p.useState(""),[d,u]=p.useState(""),[f,h]=p.useState(""),m=o.map((g,y)=>{let v=o[y].fim,b=0,w=y+1;for(;w<o.length&&o[w].inicio===v;)b++,v=o[w].fim,w++;const _=b>=1;return{value:g.inicio,label:g.inicio,available:_}}),x=(()=>{if(!l)return[];const g=o.findIndex(w=>w.inicio===l);if(g===-1)return[];const y=[];let v=o[g].fim,b=0;for(let w=g+1;w<o.length;w++){const _=o[w];if(_.inicio!==v)break;b++,b>=1&&y.push({value:_.fim,label:_.fim,available:!0}),v=_.fim}return y})();return p.useEffect(()=>{l&&d&&f&&!s&&e({inicio:l,fim:d,esporte:f})},[l,d,f]),p.useEffect(()=>{l&&u("")},[l]),a.jsxs(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-sm md:text-xs",children:[a.jsx(eu,{className:"w-4 h-4"}),a.jsx("span",{className:"font-medium",children:"Horrio desejado"})]}),a.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"horario-inicio",className:"text-xs text-text-muted mb-1 block",children:"Incio"}),a.jsxs(Gn,{value:l,onValueChange:c,disabled:s,children:[a.jsx(Vn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsx(Wn,{className:"max-h-[300px] z-[60]",children:m.filter(g=>g.available).map(g=>a.jsx(lt,{value:g.value,children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx(eu,{className:"w-4 h-4 opacity-80"}),g.label]})},g.value))})]})]}),a.jsx("div",{className:"text-text-muted font-bold text-lg pt-5",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"horario-fim",className:"text-xs text-text-muted mb-1 block",children:"Trmino"}),a.jsxs(Gn,{value:d,onValueChange:u,disabled:!l||s,children:[a.jsx(Vn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(Kn,{placeholder:"Selecione"})}),a.jsx(Wn,{className:"max-h-[300px] z-[60]",children:x.filter(g=>g.available).map(g=>a.jsx(lt,{value:g.value,children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx(eu,{className:"w-4 h-4 opacity-80"}),g.label]})},g.value))})]})]})]}),a.jsxs("div",{className:"flex items-end gap-2 md:gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"esporte",className:"text-xs text-text-muted mb-1 block",children:"Esporte"}),a.jsxs(Gn,{value:f,onValueChange:h,disabled:s,children:[a.jsx(Vn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(Kn,{placeholder:"Selecione o esporte"})}),a.jsx(Wn,{className:"max-h-[300px] z-[60]",children:i.map(g=>a.jsx(lt,{value:g,children:g},g))})]})]}),t&&a.jsxs(Er.button,{type:"button",onClick:t,disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
              px-4 py-2.5 rounded-xl font-medium text-sm
              transition-all duration-300 shrink-0
              flex items-center gap-2
              ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/70 backdrop-blur-sm border border-white/10 text-text-primary hover:bg-surface/90 hover:border-white/20"}
            `,children:[a.jsx(lo,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden md:inline",children:"Mudar Data"}),a.jsx("span",{className:"md:hidden",children:"data"})]}),n&&r&&a.jsxs(Er.button,{type:"button",onClick:r,disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
              px-4 py-2.5 rounded-xl font-medium text-sm
              transition-all duration-300 shrink-0
              flex items-center gap-2
              ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/70 backdrop-blur-sm border border-white/10 text-text-primary hover:bg-surface/90 hover:border-white/20"}
            `,children:[a.jsx(sd,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden md:inline",children:"Mudar Quadra"}),a.jsx("span",{className:"md:hidden",children:"Quadra"})]})]})]})},blt=({onSubmit:e,tipo:t,onTrocarTipo:r,disabled:n=!1,mostrarBotaoTrocar:s=!0})=>{const[o,i]=p.useState(""),[l,c]=p.useState(!1),[d,u]=p.useState(!1);p.useEffect(()=>{i("")},[t]);const f=w=>{if(w){const _=sr(w,"dd/MM/yyyy",{locale:ga});i(_),u(!1)}},h=w=>{const _=w.replace(/\D/g,"");return _.length<=2?`(${_}`:_.length<=7?`(${_.slice(0,2)}) ${_.slice(2)}`:_.length===10?`(${_.slice(0,2)}) ${_.slice(2,6)}-${_.slice(6)}`:_.length===11?`(${_.slice(0,2)}) ${_.slice(2,7)}-${_.slice(7)}`:`(${_.slice(0,2)}) ${_.slice(2,7)}-${_.slice(7,11)}`},m=w=>{const _=w.replace(/\D/g,"");return _.length<=2?_:_.length<=4?`${_.slice(0,2)}/${_.slice(2)}`:_.length<=8?`${_.slice(0,2)}/${_.slice(2,4)}/${_.slice(4)}`:`${_.slice(0,2)}/${_.slice(2,4)}/${_.slice(4,8)}`},x=w=>{const _=w.target.value;if(t==="telefone"){const j=h(_);i(j)}else if(t==="data_custom"){const j=m(_);i(j)}else i(_)},g=w=>{if(w.preventDefault(),!(!o.trim()||n))if(t==="telefone"){const _=o.replace(/\D/g,"");_.length===11&&(e(_),i(""))}else t==="data_custom"?o.trim()&&(e(o.trim()),i("")):o.includes("@")&&o.includes(".")&&(e(o.trim()),i(""))},y=w=>{w.key==="Enter"&&(w.preventDefault(),g(w))},v=w=>{if(w.length!==10)return{valida:!1,erro:"Data incompleta"};const _=/^(\d{2})\/(\d{2})\/(\d{4})$/,j=w.match(_);if(!j)return{valida:!1,erro:"Formato invlido"};const[,S,C,A]=j,P=new Date(parseInt(A),parseInt(C)-1,parseInt(S));if(isNaN(P.getTime())||P.getDate()!==parseInt(S)||P.getMonth()!==parseInt(C)-1||P.getFullYear()!==parseInt(A))return{valida:!1,erro:"Data invlida"};const F=new Date;return F.setHours(0,0,0,0),P.setHours(0,0,0,0),P<F?{valida:!1,erro:"Data no passado"}:{valida:!0,erro:null}},b=()=>t==="telefone"?o.replace(/\D/g,"").length===11:t==="data_custom"?v(o).valida:o.includes("@")&&o.includes(".");return a.jsxs(Er.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},onSubmit:g,className:"flex flex-col gap-3 max-w-md mx-auto",children:[a.jsx("div",{className:"relative",children:a.jsxs("div",{className:`
          flex items-center gap-2 px-3 py-2.5 rounded-xl
          bg-surface/70 backdrop-blur-sm
          border-2 transition-all duration-300
          ${l?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
        `,children:[t!=="data_custom"&&a.jsx("div",{className:`
              shrink-0 transition-colors duration-300
              ${l?"text-brand":"text-text-muted"}
            `,children:t==="telefone"?a.jsx(Pw,{className:"w-4 h-4"}):a.jsx(t0,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex-1 relative flex items-center",children:[a.jsx("input",{type:t==="data_custom"?"text":t==="telefone"?"tel":"email",value:o,onChange:x,onKeyDown:y,onFocus:()=>c(!0),onBlur:()=>c(!1),placeholder:t==="telefone"?"(00) 00000-0000":t==="data_custom"?"DD/MM/AAAA":"email@exemplo.com",disabled:n,className:`
                w-full bg-transparent text-text-primary placeholder:text-text-muted
                outline-none text-[17px] md:text-base font-medium
                ${t==="data_custom"?"pr-12":""}
                ${n?"opacity-50 cursor-not-allowed":""}
              `}),t==="data_custom"&&a.jsxs(ai,{open:d,onOpenChange:u,children:[a.jsx(si,{asChild:!0,children:a.jsx(Er.button,{type:"button",whileHover:{scale:1.1},whileTap:{scale:.9},disabled:n,className:`
                      absolute right-1 w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300
                      bg-brand/10 text-brand hover:bg-brand hover:text-white
                      border border-brand/20 hover:border-brand/40
                      shadow-md hover:shadow-lg hover:shadow-brand/30
                      ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                    `,children:a.jsx(lo,{className:"w-5 h-5"})})}),a.jsx(Go,{className:"w-auto p-0",align:"end",children:a.jsx(oi,{mode:"single",selected:o?(()=>{try{const[w,_,j]=o.split("/");return new Date(parseInt(j),parseInt(_)-1,parseInt(w))}catch{return}})():void 0,onSelect:f,disabled:w=>{const _=new Date;return _.setHours(0,0,0,0),w<_},initialFocus:!0})})]})]}),a.jsx(Er.button,{type:"submit",whileHover:{scale:b()?1.1:1},whileTap:{scale:b()?.9:1},disabled:!b()||n,className:`
              shrink-0 w-9 h-9 rounded-full flex items-center justify-center transition-all duration-300
              ${b()?"bg-brand text-bg shadow-md hover:shadow-lg hover:shadow-brand/30":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
            `,children:a.jsx(Z4,{className:"w-4 h-4"})})]})}),t==="telefone"&&o&&a.jsx("div",{className:"text-xs text-center",children:(()=>{const w=o.replace(/\D/g,""),_=w.length===11,j=w.length>0&&!_;return _?a.jsx("span",{className:"text-green-400 flex items-center justify-center gap-1",children:" Telefone vlido"}):j?a.jsxs("span",{className:"text-yellow-400 flex items-center justify-center gap-1",children:[" Digite todos os dgitos (",w.length,"/11)"]}):null})()}),t==="data_custom"&&o&&a.jsx("div",{className:"text-xs text-center",children:(()=>{const w=v(o);return w.valida?a.jsx("span",{className:"text-green-400 flex items-center justify-center gap-1",children:" Data vlida"}):o.length>0?a.jsxs("span",{className:"text-red-400 flex items-center justify-center gap-1",children:[" ",w.erro]}):null})()}),s&&t!=="data_custom"&&a.jsx("button",{type:"button",onClick:r,className:"text-sm text-brand/80 hover:text-brand hover:underline self-center py-1 px-3 rounded-lg hover:bg-brand/5 transition-all",children:t==="telefone"?a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(t0,{className:"w-4 h-4"}),"Prefiro usar e-mail"]}):a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(Pw,{className:"w-4 h-4"}),"Prefiro usar telefone"]})})]})},wlt=({onSubmit:e,disabled:t=!1,valorInicial:r=null,tipoInicial:n="telefone",onCorrigirTelefone:s,onCorrigirEmail:o})=>{const[i,l]=p.useState(""),[c,d]=p.useState(n==="telefone"&&r||""),[u,f]=p.useState(n==="email"&&r||""),[h,m]=p.useState(null),x=b=>{const w=b.replace(/\D/g,"");return w.length<=2?`(${w}`:w.length<=7?`(${w.slice(0,2)}) ${w.slice(2)}`:w.length<=11?`(${w.slice(0,2)}) ${w.slice(2,7)}-${w.slice(7,11)}`:`(${w.slice(0,2)}) ${w.slice(2,7)}-${w.slice(7,11)}`},g=b=>{const w=x(b.target.value);d(w)},y=b=>{if(b.preventDefault(),!i.trim())return;const w=c.replace(/\D/g,"").length>=10,_=u.trim().includes("@")&&u.trim().includes(".");if(!w&&!_)return;const j={nome:i.trim(),telefone:w?c.replace(/\D/g,""):null,email:_?u.trim():null};e(j)},v=()=>{if(!i.trim())return!1;const b=c.replace(/\D/g,"").length>=10,w=u.trim().includes("@")&&u.trim().includes(".");return b||w};return a.jsxs(Er.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},onSubmit:y,className:"flex flex-col gap-3",children:[a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="nome"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(xf,{className:`w-5 h-5 transition-colors ${h==="nome"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"text",value:i,onChange:b=>l(b.target.value),onFocus:()=>m("nome"),onBlur:()=>m(null),placeholder:"Seu nome completo",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="telefone"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(Pw,{className:`w-5 h-5 transition-colors ${h==="telefone"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"tel",value:c,onChange:g,onFocus:()=>m("telefone"),onBlur:()=>m(null),placeholder:"(00) 00000-0000",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="email"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(t0,{className:`w-5 h-5 transition-colors ${h==="email"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"email",value:u,onChange:b=>f(b.target.value),onFocus:()=>m("email"),onBlur:()=>m(null),placeholder:"email@exemplo.com (opcional)",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),(s||o)&&a.jsx("div",{className:"-mt-1 mb-1",children:n==="email"&&o?a.jsx("button",{type:"button",onClick:o,className:"text-xs text-brand/80 hover:text-brand underline underline-offset-4 px-1 py-0.5 rounded-md hover:bg-brand/5",children:"Informei o e-mail errado"}):s&&a.jsx("button",{type:"button",onClick:s,className:"text-xs text-brand/80 hover:text-brand underline underline-offset-4 px-1 py-0.5 rounded-md hover:bg-brand/5",children:"Informei o telefone errado"})}),a.jsxs(Er.button,{type:"submit",whileHover:{scale:v()?1.02:1},whileTap:{scale:v()?.98:1},disabled:!v()||t,className:`
          flex items-center justify-center gap-2 py-3 px-6 rounded-2xl
          font-semibold text-base transition-all duration-300
          ${v()?"bg-brand text-bg shadow-lg shadow-brand/20 hover:shadow-xl hover:shadow-brand/30":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
        `,children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})}),"Continuar"]}),a.jsx("p",{className:"text-xs text-text-muted text-center",children:"Preencha pelo menos telefone ou e-mail"})]})},_lt=({participantesAtuais:e=[],onAdicionar:t,onRemover:r,onFinalizar:n,disabled:s=!1,onAdicionarLote:o,selfName:i,onFixedRolesDetected:l,initialModalidade:c="",modalidadeOptions:d=[]})=>{const[u,f]=p.useState(""),[h,m]=p.useState(!1),[x,g]=p.useState(!1),y=p.useRef(null),[v,b]=p.useState(!1),[w,_]=p.useState(""),[j,S]=p.useState(!1),[C,A]=p.useState([]),[P,F]=p.useState([]),[O,I]=p.useState({}),[T,k]=p.useState(!1),[B,z]=p.useState(!1),[U,L]=p.useState(null),[W,ge]=p.useState(!1),Ae=p.useRef(null),V=p.useRef(null),[$,Y]=p.useState(c||"");p.useEffect(()=>{Y(c||"")},[c]),p.useEffect(()=>{const je=()=>{g(window.innerWidth<768)};return je(),window.addEventListener("resize",je),()=>window.removeEventListener("resize",je)},[]),p.useEffect(()=>{if(v){const je=document.body.style.overflow;return document.body.style.overflow="hidden",A([]),F([]),I({}),k(!1),z(!1),L(null),()=>{document.body.style.overflow=je}}},[v]),p.useEffect(()=>{if(v&&ne&&(!C||C.length===0)){const je=J(ne);A([ne]),I({[je]:!0}),L(je),z(!0),k(!0)}},[v]);const he=je=>je.normalize("NFD").replace(/[\u0300-\u036f]/g,""),J=je=>he(String(je||"").trim().toLowerCase()).replace(/\s+/g," "),G=je=>String(je||"").replace(/^\s*[*-]+/g,"").replace(/^\s*\d+\s*[\-\)\.]\s*/g,"").replace(/^[\W_]+|[\W_]+$/g,"").replace(//g,"").replace(/@[\S]+/g,"").replace(/\(\s*[mf]\s*\)/gi,"").replace(/\(\s*[mf][^)]*\)?/gi,"").replace(/\s{2,}/g," ").trim(),ue=je=>/^(espera|lista\s+de\s+espera)\b/i.test(he(String(je||"").trim().toLowerCase())),ve=je=>/^(jogador|jogadores|goleiro|goleiros|convocado|convocados|jogadore?s)\b/i.test(he(String(je||"").trim().toLowerCase())),ae=je=>{const nt=he(String(je||"")).trim().toLowerCase();return/^(jogador|jogadores|goleiro|goleiros|convocado|convocados|levantador|levantadores)\b/.test(nt)||/^(lista\s+de\s+espera|convidad\w*)\b/.test(nt)},oe=je=>{const nt=String(je||"").split(/\r?\n/);let $t=!1,Ut=!1;const Fe=[];for(const Cr of nt){const Me=String(Cr||"").trim();if(!Me)continue;if(ue(Me)){$t=!0;continue}if($t)continue;if(ve(Me)){Ut=!0;continue}if(!Ut)continue;const Qe=G(Me),et=/[A-Za-z---]/.test(Qe);Qe&&Qe.length>=2&&Qe.length<=60&&et&&!/[0-9@]/.test(Qe)&&Fe.push(Qe.split(/\s+/).map(xr=>xr&&xr[0].toUpperCase()+xr.slice(1).toLowerCase()).join(" "))}const xt=new Set,Ot=[];for(const Cr of Fe){const Me=J(Cr);!Me||xt.has(Me)||(xt.add(Me),Ot.push(Cr))}return Ot},me=je=>/^(reservas?)\b/i.test(he(String(je||"").trim().toLowerCase())),De=je=>{const nt=String(je||"").split(/\r?\n/),$t=[];let Ut=!1,Fe=!1;for(const xt of nt){const Ot=String(xt||"").trim();if(!Ot)continue;if(ue(Ot)){Ut=!0,Fe=!1;continue}if(ve(Ot)||me(Ot)){Ut=!1,Fe=!0;continue}if(Ut||!Fe)continue;const Cr=G(Ot),Me=/[A-Za-z---]/.test(Cr);if(!(Cr&&Cr.length>=2&&Cr.length<=60&&Me&&!/[0-9@]/.test(Cr)))continue;const et=Cr.split(/\s+/).map(Yt=>Yt&&Yt[0].toUpperCase()+Yt.slice(1).toLowerCase()).join(" ");ae(et)||$t.push(et)}return $t};new Set((e||[]).map(je=>J(je.nome)));const ne=i?String(i).trim():e&&e[0]&&e[0].nome?String(e[0].nome).trim():null,ie=ne?J(ne):null,ht=je=>he(String(je||"").toLowerCase()).split(/\s+/).map(nt=>nt.trim()).filter(nt=>nt.length>=3),pt=je=>{if(!ne)return!1;const nt=String(je||"").trim();if(!nt)return!1;if(J(nt)===ie)return!0;const $t=ht(ne),Ut=ht(nt);return $t.length===0||Ut.length===0?!1:Ut.some(Fe=>$t.includes(Fe))},Ze=je=>{const nt=new Set;if(!je)return nt;const $t=String(je).split(/\r?\n/);let Ut=!1;for(let Fe of $t){const xt=he(String(Fe||"")).toLowerCase().trim();if(!Ut){/^\s*[*\-]?\s*((lista\s+de\s+)?espera|convidad\w*)\b[\s:]*$/i.test(xt)&&(Ut=!0);continue}if(/^\s*\*\s*\w+|^\s*(convocad|jogad|levanta|goleir)\w*/i.test(he(Fe))){Ut=!1;continue}const Ot=String(Fe).replace(/^\s*[*\-]+\s*/g,"").replace(/^\s*\d+\)?\s*/g,"").replace(/^[\W_]+/,"").trim(),Cr=/[A-Za-z---]/.test(Ot);Ot&&Cr&&!/[0-9@]/.test(Ot)&&Ot.length>=2&&Ot.length<=60&&nt.add(J(Ot))}return nt},vt=je=>{const nt=String(je||"").split(/\r?\n/),$t={levantadores:[],goleiros:[]};let Ut=null;for(let Fe of nt){const xt=he(String(Fe||"")).toLowerCase().trim();if(/^\s*[*\-]?\s*levanta(dor|dores|dor(es)?)\b/i.test(xt)){Ut="levantadores";continue}if(/^\s*[*\-]?\s*goleir(o|os|a|as)\b/i.test(xt)){Ut="goleiros";continue}if(Ut){if(/(^|\s)jogador(e|es)\b/.test(xt)){Ut=null;continue}if(/^\s*[*\-]?\s*(convocad|lista\s+de\s+(espera|reserva)|convidad)\b/i.test(xt)){Ut=null;continue}if(/^\s*[*_]{1,3}\s*[a-z-]+/i.test(xt)){Ut=null;continue}if(/^\s*[*\-]?\s*(levanta|goleir)\b/i.test(xt)){Ut=null;continue}}if(!Ut)continue;const Ot=String(Fe).replace(/^\s*[*\-]+\s*/g,"").replace(/^\s*\d+\)?\s*/g,"").replace(/^[\W_]+/,"").trim(),Cr=/[A-Za-z---]/.test(Ot);if(!(Ot&&Cr&&!/[0-9@]/.test(Ot)&&Ot.length>=2&&Ot.length<=60))continue;const Qe=Ot.toLowerCase().split(/\s+/).map(Yt=>Yt&&Yt[0].toUpperCase()+Yt.slice(1)).join(" "),et=J(Qe);Ut==="levantadores"?$t.levantadores.some(Yt=>J(Yt)===et)||$t.levantadores.push(Qe):Ut==="goleiros"&&($t.goleiros.some(Yt=>J(Yt)===et)||$t.goleiros.push(Qe))}return $t},wt=je=>{je.preventDefault(),!(!u.trim()||s)&&(t(u.trim()),f(""),setTimeout(()=>{y.current?.focus()},100))},gt=je=>{je.key==="Enter"&&!x&&(je.preventDefault(),je.shiftKey?n&&n($):wt(je))},er=async()=>{if(w.trim()){S(!0),A([]),F([]),I({});try{try{console.group("[Isis Import] start"),console.debug("[Isis Import] input.length=%s preview=%o",w.length,w.slice(0,180))}catch{}const{data:je,error:nt}=await re.functions.invoke("parse-participants",{body:{text:w,locale:"pt-BR"}});if(nt)throw nt;if(je&&typeof je.source=="string"){console.log("[Isis Import] source=",je.source);try{console.debug("[Isis Import] edge.meta keys=%o",Object.keys(je||{}))}catch{}}const $t=Ze(w);try{console.debug("[Isis Import] waitlist.count=%s sample=%o",$t.size,Array.from($t).slice(0,8))}catch{}const Ut=Array.isArray(je?.roles?.levantadores)?je.roles.levantadores:[],Fe=Array.isArray(je?.roles?.goleiros)?je.roles.goleiros:[],xt=Ut.length||Fe.length?{levantadores:Ut,goleiros:Fe}:vt(w);try{console.debug("[Isis Import] roles.edge lev=%s gol=%s",Ut.length,Fe.length)}catch{}try{Ut.length||Fe.length||console.debug("[Isis Import] roles.local lev=%s gol=%s",xt.levantadores.length,xt.goleiros.length)}catch{}const Ot=Array.isArray(je?.extracted)?je.extracted:[];let Cr=Ot.filter(rn=>!$t.has(J(rn)));Cr=Cr.filter(rn=>!ae(rn));try{console.debug("[Isis Import] extracted.raw=%s filtered=%s sample=%o",Ot.length,Cr.length,Cr.slice(0,10))}catch{}try{if(Cr.length<6&&/(goleir|jogador)/i.test(he(w))){const Ke=oe(w);try{console.debug("[Isis Import] local.mainOnly=%s sample=%o",Ke.length,Ke.slice(0,10))}catch{}const qe=[...Cr],ze=new Set(qe.map(J));for(const Je of Ke){const kt=J(Je);!kt||ze.has(kt)||$t.has(kt)||(ze.add(kt),qe.push(Je))}Cr=qe.filter(Je=>!ae(Je));try{console.debug("[Isis Import] boosted.count=%s",Cr.length)}catch{}}}catch{}const Me=Cr.some(rn=>pt(rn)),Qe=Array.isArray(je?.invalid)?je.invalid:[],et=[],Yt=new Set;for(const rn of Cr){const Ke=G(rn);if(!Ke)continue;const qe=J(Ke);if(!qe||Yt.has(qe))continue;Yt.add(qe);const ze=Ke.split(/\s+/).map(Je=>Je&&Je[0].toUpperCase()+Je.slice(1).toLowerCase()).join(" ");et.push(ze)}try{console.debug("[Isis Import] uniques.count=%s sample=%o",et.length,et.slice(0,12))}catch{}try{console.debug("[Isis Import] invalid.count=%s sample=%o",Qe.length,Qe.slice(0,6))}catch{}try{console.debug("[Isis Import] detectedSelf=%s self=%o",Me,ne)}catch{}const xr=oe(w),Jt=new Map(xr.map((rn,Ke)=>[J(rn),Ke])),kr=De(w);let _r=kr&&kr.length?kr.slice(0,200):(()=>{const rn=et.map((Ke,qe)=>({n:Ke,i:qe}));return rn.sort((Ke,qe)=>{const ze=Jt.has(J(Ke.n))?Jt.get(J(Ke.n)):Number.MAX_SAFE_INTEGER,Je=Jt.has(J(qe.n))?Jt.get(J(qe.n)):Number.MAX_SAFE_INTEGER;return ze!==Je?ze-Je:Ke.i-qe.i}),rn.map(Ke=>Ke.n).slice(0,50)})(),Rr=_r.findIndex(rn=>pt(rn));if(Rr>=0){const rn=_r[Rr];L(J(rn)),_r=[rn,..._r.filter((Ke,qe)=>qe!==Rr)]}else if(ne){const rn=J(ne);L(rn),z(!0),_r=[ne,..._r]}else L(null);A(_r),F(Qe);const nn={};ne&&(nn[J(ne)]=!0),et.slice(0,50).forEach(rn=>{nn[J(rn)]=!0}),I(nn),k(!0),z(Me||!!ne);try{typeof l=="function"?l(xt):window.dispatchEvent(new CustomEvent("isis:fixed-roles",{detail:xt}))}catch{}try{console.debug("[Isis Import] final.suggested.count=%s sample=%o",_r.length,_r.slice(0,12))}catch{}try{console.groupEnd?.()}catch{}}catch(je){try{console.error("[Isis Import] error=%o",je)}catch{}const nt=Ze(w),$t=vt(w),Ut=w.split(/[\n,;]+/).map(Qe=>Qe.trim()).filter(Boolean),Fe=Ut.some(Qe=>{const et=Qe.replace(/^[\W_]+|[\W_]+$/g,"");return pt(et)}),xt=[],Ot=new Set;for(const Qe of Ut){const et=Qe.replace(/^[\W_]+|[\W_]+$/g,""),Yt=J(et),xr=/[A-Za-z---]/.test(et);if(!(et.length>=2&&et.length<=60&&xr&&!/[0-9@]/.test(et))||!Yt||nt.has(Yt)||Ot.has(Yt))continue;Ot.add(Yt);const kr=et.toLowerCase().split(/\s+/).map(_r=>_r&&_r[0].toUpperCase()+_r.slice(1)).join(" ");xt.push(kr)}let Cr=xt.slice(0,50);if(ne){const Qe=J(ne);L(Qe),z(!0),Cr=[ne,...Cr]}A(Cr);const Me={};ne&&(Me[J(ne)]=!0),xt.slice(0,50).forEach(Qe=>{Me[J(Qe)]=!0}),I(Me),k(!0),z(Fe||!!ne);try{typeof l=="function"?l($t):window.dispatchEvent(new CustomEvent("isis:fixed-roles",{detail:$t}))}catch{}}finally{S(!1)}}},_e=je=>{const nt=J(je);I($t=>({...$t,[nt]:!$t[nt]}))},Pt=()=>{const je={...O};C.forEach(nt=>{je[J(nt)]=!0}),I(je)},Lt=()=>{const je={...O};C.forEach(nt=>{je[J(nt)]=!1}),I(je)},gr=()=>{const je=C.filter(nt=>{const $t=J(nt);return U&&$t===U?!1:O[$t]});je.length!==0&&(typeof o=="function"?o(je):je.forEach(nt=>t(nt)),b(!1),_(""),A([]),F([]),I({}))},fr=()=>{_(""),A([]),F([]),I({}),k(!1),z(!1),L(null)};return a.jsxs(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"flex flex-col gap-3 w-full",children:[a.jsxs("div",{ref:V,className:"flex items-center justify-end gap-2 scroll-mt-24 md:scroll-mt-28",children:[a.jsx("button",{type:"button",disabled:s,onClick:()=>b(!0),className:`px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/80 hover:bg-surface/60 border border-white/10 text-text-primary"}`,children:"Importar lista"}),a.jsx("div",{className:"relative",children:a.jsxs(Gn,{value:$,onValueChange:Y,disabled:s,children:[a.jsx(Vn,{className:"min-w-[160px] bg-surface/70 backdrop-blur-sm border-white/10 text-sm",children:a.jsx(Kn,{placeholder:"Modalidade"})}),a.jsxs(Wn,{className:"max-h-[300px] z-[70]",children:[(Array.isArray(d)?d:[]).map(je=>a.jsx(lt,{value:String(je),children:String(je)},String(je))),(!d||d.length===0)&&a.jsx(lt,{value:"",children:"Selecionar modalidade"})]})]})}),a.jsx("button",{type:"button",onClick:()=>{ge(je=>{const nt=!je;try{window.dispatchEvent(new CustomEvent("isis-participantes-expand",{detail:{expanded:nt}}))}catch{}return nt}),setTimeout(()=>{try{V.current?.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},50)},className:`p-2 rounded-lg border transition-all ${W?"bg-white/10 border-brand/40 text-brand shadow-sm":"hover:bg-white/10 border-white/10"}`,"aria-label":W?"Recolher lista":"Expandir lista","aria-pressed":W,children:W?a.jsx(ix,{className:"w-4 h-4"}):a.jsx(Oue,{className:"w-4 h-4"})})]}),e.length>0&&a.jsx("div",{ref:Ae,className:`flex flex-col gap-1.5 ${W?"max-h-[360px] md:max-h-[320px]":"max-h-[140px]"} overflow-y-auto px-1 transition-all`,children:e.map((je,nt)=>a.jsxs(Er.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm ${je.principal?"bg-brand/10 border border-brand/30":"bg-surface/50 border border-white/10"}`,children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold ${je.principal?"bg-brand/20 text-brand":"bg-white/10 text-text-primary"}`,children:nt+1})}),a.jsx("span",{className:"text-base shrink-0",children:je.principal?"":""}),a.jsxs("span",{className:`flex-1 font-medium truncate ${je.principal?"text-brand":"text-text-primary"}`,children:[je.nome,je.principal&&a.jsx("span",{className:"ml-1.5 text-xs opacity-70",children:"(voc)"})]}),!je.principal&&r&&a.jsx(Er.button,{type:"button",onClick:()=>r(nt),whileHover:{scale:1.1},whileTap:{scale:.9},className:"shrink-0 p-1 rounded-full hover:bg-red-500/20 text-red-400 hover:text-red-300 transition-colors",title:"Remover participante",children:a.jsx(lc,{className:"w-4 h-4"})})]},nt))}),a.jsxs("form",{onSubmit:wt,className:"flex flex-col gap-2",children:[a.jsxs("div",{className:`
          flex items-center gap-2 px-3 py-2.5 rounded-xl
          bg-surface/70 backdrop-blur-sm
          border-2 transition-all duration-300
          ${h?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
        `,children:[a.jsx(ofe,{className:`w-4 h-4 shrink-0 transition-colors ${h?"text-brand":"text-text-muted"}`}),a.jsx("input",{ref:y,type:"text",value:u,onChange:je=>f(je.target.value),onKeyDown:gt,onFocus:()=>m(!0),onBlur:()=>m(!1),placeholder:x?"Nome":"Nome do participante",disabled:s,autoComplete:"off",className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-base font-medium min-w-0"}),a.jsx(Er.button,{type:"submit",whileHover:{scale:u.trim()?1.05:1},whileTap:{scale:u.trim()?.95:1},disabled:!u.trim()||s,className:`
              px-3 py-1.5 rounded-lg transition-all duration-300 text-sm font-semibold shrink-0
              ${u.trim()?"bg-brand text-bg shadow-md":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
            `,children:"Adicionar"})]}),a.jsx(Er.button,{type:"button",onClick:()=>n&&n($),disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
            w-full px-6 py-3.5 rounded-xl font-bold text-base
            transition-all duration-300
            ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-brand text-bg shadow-lg hover:shadow-xl hover:shadow-brand/30"}
          `,children:a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsx(Sm,{className:"w-5 h-5"}),"Confirmar Participantes (",e.length,")"]})}),!x&&a.jsxs("p",{className:"text-xs text-text-muted text-center mt-1",children:[" ",a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface rounded text-[10px]",children:"Enter"})," adiciona  ",a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface rounded text-[10px]",children:"Shift+Enter"})," confirma"]})]}),v&&typeof document<"u"&&Rm.createPortal(a.jsxs("div",{className:"fixed inset-0 z-[9999] overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black/75 backdrop-blur-sm",onClick:()=>!j&&b(!1)}),a.jsx("div",{className:"min-h-screen flex items-start justify-center pt-24 md:pt-16 pb-8 px-3",children:a.jsxs("div",{className:"relative w-[96vw] max-w-5xl bg-gradient-to-br from-surface via-background to-surface border border-white/10 rounded-3xl shadow-2xl flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"sticky top-0 z-10 px-5 py-4 border-b border-white/10 bg-surface/70 backdrop-blur flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Hi,{size:"sm",variant:"header"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-base md:text-lg font-extrabold text-text-primary leading-tight",children:C.length>0?"Sugestes encontradas":"Importar participantes"}),a.jsx("p",{className:"text-[11px] md:text-xs text-text-muted",children:C.length>0?`Selecione os nomes para adicionar (${C.length})`:"Cole sua lista e processe com IA"})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("button",{type:"button",disabled:j,onClick:()=>b(!1),className:"p-2 rounded-lg hover:bg-white/10",children:a.jsx(lc,{className:"w-5 h-5"})})})]}),a.jsx("div",{className:"flex-1 max-h-[70vh] overflow-y-auto p-4 md:p-5",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-full",children:[a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("label",{className:"text-xs text-text-muted mb-2",children:"Sua lista"}),a.jsx("textarea",{value:w,onChange:je=>_(je.target.value),disabled:j,placeholder:`Exemplo:
1) Joo Silva
2) Maria Clara
3) Pedro Henrique

Dica: nomes sob os cabealhos 'Lista de espera', 'Lista de reserva' ou 'Convidados' sero ignorados.

Cole sua lista (um por linha ou separados por vrgula) e clique em Processar com sis`,className:"w-full min-h-[320px] max-h-[320px] resize-none overflow-y-auto bg-surface border border-white/10 rounded-xl p-3 outline-none text-sm focus:ring-2 focus:ring-brand/40"}),a.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[a.jsx("button",{type:"button",onClick:fr,disabled:j&&!w.trim(),className:"px-4 py-2 rounded-xl font-semibold bg-surface border border-white/10 text-text-primary hover:bg-white/10 disabled:opacity-60",children:"Apagar"}),a.jsx("button",{type:"button",onClick:er,disabled:j||!w.trim(),className:"px-5 py-2.5 rounded-xl font-semibold shadow-lg transition bg-gradient-to-r from-brand to-emerald-500 text-white hover:shadow-emerald-500/30 disabled:opacity-60 disabled:cursor-not-allowed",children:j?"Processando":"Processar com sis"})]})]}),a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[a.jsx("span",{children:"Sugeridos"}),a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/10",children:C.length})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:Pt,disabled:j,className:"px-2 py-1 text-xs rounded-lg bg-surface hover:bg-white/10 disabled:opacity-50",children:"Selecionar todos"}),a.jsx("button",{type:"button",onClick:Lt,disabled:j,className:"px-2 py-1 text-xs rounded-lg bg-surface hover:bg-white/10 disabled:opacity-50",children:"Limpar"})]})]}),a.jsx("div",{className:"min-h-[320px] max-h-[320px] overflow-y-auto border border-white/10 rounded-xl bg-surface",children:j?a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative w-5 h-5",children:[a.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-brand to-emerald-500 opacity-30"}),a.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-transparent [border-image:linear-gradient(to_right,var(--tw-gradient-from),var(--tw-gradient-to))_1] animate-spin"})]}),a.jsx("span",{className:"text-xs font-semibold text-text-primary",children:"Processando com IA"})]}),a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-white/10 text-text-muted",children:"Premium"})]}),a.jsx("div",{className:"space-y-2",children:Array.from({length:10}).map((je,nt)=>a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-white/[0.03] overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0 w-full",children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold bg-white/10 text-text-muted",children:nt+1})}),a.jsx("div",{className:"relative h-3 w-full max-w-[220px] rounded bg-white/10 overflow-hidden",children:a.jsx("div",{className:"absolute inset-0 -translate-x-full animate-[shimmer_1.2s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})})]}),a.jsx("div",{className:"h-4 w-4 rounded bg-white/10"})]},nt))}),a.jsx("style",{children:"@keyframes shimmer{100%{transform:translateX(100%);}}"})]}):a.jsx("ul",{className:"divide-y divide-white/5",children:C.map((je,nt)=>{const $t=J(je),Ut=T&&B&&U&&$t===U;return a.jsxs("li",{className:`flex items-center justify-between px-3 py-2 ${Ut?"bg-white/5":""}`,children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold ${Ut?"bg-emerald-600/25 text-emerald-400":"bg-white/10 text-text-primary"}`,children:nt+1})}),a.jsx("span",{className:"text-sm truncate pr-1",children:je}),Ut&&a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-emerald-600/20 text-emerald-400 border border-emerald-500/30 shrink-0",children:"Voc"})]}),a.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:Ut?!0:!!O[$t],onChange:()=>!Ut&&_e(je),disabled:Ut})]},`${$t}-${nt}`)})})}),T&&C.length===0&&w.trim()&&!j&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum nome novo encontrado."}),P.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-text-muted flex items-center gap-2",children:[a.jsx("span",{children:"Ignorados"}),a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/10",children:P.length})]}),a.jsx("div",{className:"mt-3 flex items-center justify-end",children:a.jsx("button",{type:"button",onClick:gr,disabled:j||C.filter(je=>O[J(je)]).length===0,className:`px-5 py-2.5 rounded-xl font-semibold ${j||C.filter(je=>O[J(je)]).length===0?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-emerald-600 text-white shadow-lg hover:shadow-emerald-600/30 transition"}`,children:(()=>`Adicionar selecionados (${C.reduce((nt,$t)=>{const Ut=J($t);return T&&B&&U&&Ut===U?nt+1:nt+(O[Ut]?1:0)},0)})`)()})})]})]})})]})})]}),document.body)]})},jlt=({onSubmit:e,disabled:t=!1})=>{const[r,n]=p.useState(0),[s,o]=p.useState(0),[i,l]=p.useState(""),[c,d]=p.useState(!1),u=g=>{g.preventDefault(),!(r===0||t)&&e({rating:r,comentario:i.trim()||null,timestamp:new Date().toISOString()})},f=g=>{t||n(g)},h=g=>{t||o(g)},m=()=>{t||o(0)},x=s||r;return a.jsx(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"w-full mb-8 md:mb-4",children:a.jsx("div",{className:"bg-background/98 backdrop-blur-3xl border-2 border-white/50 rounded-3xl p-6 md:p-8 shadow-2xl relative z-50",children:a.jsxs("form",{onSubmit:u,className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(g=>a.jsx(Er.button,{type:"button",onClick:()=>f(g),onMouseEnter:()=>h(g),onMouseLeave:m,disabled:t,whileHover:{scale:t?1:1.2},whileTap:{scale:t?1:.9},className:`
                    p-2 transition-all duration-200 rounded-full
                    ${t?"cursor-not-allowed":"cursor-pointer hover:bg-brand/10"}
                  `,children:a.jsx(tfe,{className:`w-8 h-8 md:w-10 md:h-10 transition-all duration-200 ${g<=x?"fill-yellow-400 text-yellow-400 drop-shadow-lg":"text-text-muted hover:text-yellow-300"}`})},g))}),r>0&&a.jsx(Er.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center",children:a.jsxs("p",{className:"text-base font-semibold text-text-primary",children:[r===1&&" Muito ruim",r===2&&" Ruim",r===3&&" Regular",r===4&&" Bom",r===5&&" Excelente"]})})]}),r>0&&a.jsx("div",{className:"w-full h-px bg-white/10 my-2"}),r>0&&a.jsxs(Er.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3,delay:.2},className:"flex flex-col gap-4",children:[a.jsxs("label",{className:"text-base font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Yue,{className:"w-5 h-5 text-brand"}),"Comentrio (opcional)"]}),a.jsx("div",{className:`
                flex items-start gap-2 px-4 py-3 rounded-xl
                bg-background/60 backdrop-blur-sm
                border-2 transition-all duration-300
                ${c?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
              `,children:a.jsx("textarea",{value:i,onChange:g=>l(g.target.value),onFocus:()=>d(!0),onBlur:()=>d(!1),placeholder:"Conte-nos mais sobre sua experincia...",disabled:t,rows:3,maxLength:500,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-base resize-none min-w-0"})}),a.jsxs("div",{className:"text-sm text-text-muted text-right",children:[i.length,"/500"]})]}),r>0&&a.jsx(Er.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},className:"mt-2 mb-4",children:a.jsxs(Er.button,{type:"submit",disabled:t,whileHover:{scale:t?1:1.02},whileTap:{scale:t?1:.98},className:`
                w-full px-6 py-4 rounded-2xl font-bold text-lg
                transition-all duration-300 flex items-center justify-center gap-3
                shadow-xl border-2
                ${t?"bg-surface text-text-muted cursor-not-allowed border-white/10":"bg-gradient-to-r from-brand to-brand/90 text-white shadow-brand/30 hover:shadow-2xl hover:shadow-brand/40 border-brand/20 hover:from-brand/90 hover:to-brand"}
              `,children:[a.jsx(Z4,{className:"w-6 h-6"}),"Enviar Avaliao"]})})]})})})},Nlt=({message:e="Carregando..."})=>{const t=[" sis IA iniciando..."," Processando dados em tempo real..."," IA analisando disponibilidade..."," sis aprendendo suas preferncias..."," Assistente virtual ativando..."," IA otimizando seu agendamento..."," sis calculando melhores opes..."," Sincronizando com IA..."," Inteligncia artificial carregando..."," sis processando informaes..."],r=t[Math.floor(Math.random()*t.length)];return a.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background via-surface/30 to-background",children:a.jsx(Er.div,{className:"absolute inset-0 opacity-20",animate:{background:["radial-gradient(circle at 20% 50%, #FF6600 0%, transparent 50%)","radial-gradient(circle at 80% 50%, #FFAA33 0%, transparent 50%)","radial-gradient(circle at 50% 20%, #FF6600 0%, transparent 50%)","radial-gradient(circle at 20% 50%, #FF6600 0%, transparent 50%)"]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}})}),a.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(6)].map((n,s)=>a.jsx(Er.div,{className:"absolute w-2 h-2 rounded-full",style:{background:s%2===0?"#FF6600":"#FFAA33",left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{y:[-20,-100,-20],opacity:[0,1,0],scale:[.5,1,.5]},transition:{duration:3+Math.random()*2,repeat:1/0,delay:Math.random()*2,ease:"easeInOut"}},s))}),a.jsxs(Er.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,ease:[.22,1,.36,1]},className:"relative z-10 text-center",children:[a.jsxs("div",{className:"mb-8 flex flex-col items-center gap-6",children:[a.jsxs(Er.div,{className:"relative",animate:{rotateY:[0,360]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:[a.jsx(Er.div,{className:"absolute inset-0 rounded-2xl blur-xl opacity-60",style:{background:"#FFAA33"},animate:{scale:[1,1.2,1],opacity:[.4,.8,.4]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),a.jsx(Er.div,{className:"relative w-20 h-20 md:w-24 md:h-24 rounded-2xl flex items-center justify-center",style:{background:"#FFAA33"},whileHover:{scale:1.05},children:a.jsx(sd,{className:"w-12 h-12 md:w-14 md:h-14 text-white",strokeWidth:2})})]}),a.jsxs(Er.div,{className:"flex items-baseline gap-1",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.3},children:[a.jsx(Er.span,{className:"font-extrabold text-4xl md:text-5xl",style:{color:"#FF6600"},animate:{textShadow:["0 0 10px rgba(255, 102, 0, 0.5)","0 0 20px rgba(255, 102, 0, 0.8)","0 0 10px rgba(255, 102, 0, 0.5)"]},transition:{duration:2,repeat:1/0},children:"Fluxo"}),a.jsx(Er.span,{className:"font-extrabold text-4xl md:text-5xl",style:{color:"#FFAA33"},animate:{textShadow:["0 0 10px rgba(255, 170, 51, 0.5)","0 0 20px rgba(255, 170, 51, 0.8)","0 0 10px rgba(255, 170, 51, 0.5)"]},transition:{duration:2,repeat:1/0,delay:.1},children:"7"}),a.jsx(Er.span,{className:"font-medium text-4xl md:text-5xl ml-2",style:{color:"#B0B0B0"},initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.6},children:"Arena"})]})]}),a.jsx("div",{className:"w-64 md:w-80 mx-auto mb-6",children:a.jsx("div",{className:"h-1 bg-surface/30 rounded-full overflow-hidden",children:a.jsx(Er.div,{className:"h-full rounded-full",style:{background:"linear-gradient(90deg, #FFAA33, #FFD700, #FFAA33)"},animate:{x:[-100,300]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},initial:{x:-100}})})}),a.jsxs(Er.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.8},className:"space-y-3",children:[a.jsx(Er.p,{className:"text-base md:text-lg font-medium text-text-primary px-4",animate:{opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0},children:r}),a.jsx("div",{className:"flex justify-center gap-1",children:[0,1,2].map(n=>a.jsx(Er.div,{className:"w-2 h-2 rounded-full",style:{background:"#FFAA33"},animate:{scale:[.8,1.2,.8],opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0,delay:n*.2}},n))})]})]})]})},Slt={greeting:["Ol! Eu sou a Isis  Vou te ajudar a agendar sua quadra! Qual voc prefere?","Oi! Sou a Isis!  Vamos agendar? Me diz, qual quadra voc quer?","E a! Isis aqui! Bora marcar sua partida? Qual quadra te interessa?","Ol!  Prazer, sou a Isis! Qual quadra voc quer reservar?","Opa! Isis na rea! Vamos agendar sua quadra? Qual delas?","Seja bem-vindo! Sou a Isis e vou facilitar sua reserva! Qual quadra?"],afterQuadra:["Boa escolha! {quadra}  tima!  Para qual dia?","Perfeito! {quadra}  top! Qual dia voc quer?","{quadra} confirmada!  Me diz, que dia?","Show! {quadra}  sucesso aqui! Qual o dia?","Anotado! {quadra}  Agora me fala o dia:","Excelente! {quadra}  uma das melhores! Para quando?"],afterData:["Beleza! {data} anotado!  Qual horrio voc prefere?","timo! {data} t disponvel! Que horas?","{data}  logo ali!  Me diz o horrio:","Confirmado {data}! Qual horrio te atende melhor?","Perfeito! {data}  Agora escolhe o horrio:","Show! {data} t livre! Qual o melhor horrio pra voc?"],afterHorario:["{horario}  seu!  Qual modalidade?","Reservado {horario}!  Vai ser qual modalidade?","Fechou {horario}! Qual esporte?","{horario} confirmado! Me diz a modalidade:","Show! {horario}  E a modalidade ...?","Perfeito! {horario} garantido! Qual modalidade?"],afterModalidade:["{modalidade}! Massa!  Quantas pessoas vo jogar?","Vai ser {modalidade}! Legal! Quantos jogadores?","{modalidade}  bom demais!  Quantas pessoas?","Top! {modalidade}  Me diz quantas pessoas:","{modalidade} confirmado! Quantos vo jogar?","timo! {modalidade}  show! Quantos participantes?"],askNames:["Agora preciso dos nomes! Digite cada um (um por linha):","Beleza! Me manda os nomes dos participantes:","Show! Lista os nomes pra mim:","timo! Quais so os nomes?","Perfeito! Me passa os nomes de todo mundo:","Legal! Agora os nomes dos jogadores:"],askContact:["ltimos dados! Qual seu nome completo?","Agora preciso do seu nome e telefone:","Quase l! Me passa seu nome e WhatsApp:","Beleza! Seus dados para contato:","Falta pouco! Nome completo e telefone:","ltima etapa! Qual seu nome e telefone?"],reviewData:["timo! Vamos conferir tudo antes de confirmar:","Perfeito! Revisa comigo os dados:","Show! Confirma se t tudo certo:","Beleza! D uma olhada se est correto:","Legal! Vamos revisar juntos:","Massa! Confere os detalhes aqui:"],confirmation:[" Tudo certo! Agendamento #{codigo} confirmado!"," Pronto! Seu agendamento #{codigo} est garantido!"," Feito! Cdigo #{codigo} confirmado!"," Sucesso! Agendamento #{codigo} t na agenda!"," Confirmado! #{codigo}  seu!"," Show! Agendamento #{codigo} marcado!"],thankYou:["Obrigada por agendar conosco! At logo! ","Valeu! Te vejo no jogo! ","Brigada! Bom jogo! ","Obrigada! At a partida! ","Valeu pela preferncia! At breve! ","Obrigada! Qualquer coisa,  s voltar aqui! "],loading:["Deixa eu verificar...","S um momento...","Aguarda um pouquinho...","Consultando aqui...","Verificando pra voc..."],error:["Ops! Algo deu errado. Vamos tentar de novo?","Eita! Tive um problema aqui. Podemos recomear?","Putz! Deu erro. Tenta novamente?","Opa! Algo no funcionou. Vamos de novo?","Caramba! Erro aqui. Pode tentar novamente?"],noAvailability:["Puts... esse horrio j foi reservado.  Escolhe outro?","Eita! Esse j est ocupado. Que tal outro horrio?","Opa! Esse horrio acabou de ser reservado. Tem outro?","Poxa! Algum reservou esse agora mesmo. Outro horrio?","Xiii! Esse j foi. Bora escolher outro?"]},Yx=(e,t={})=>{const r=Slt[e];if(!r||r.length===0)return console.warn(`[Isis] Nenhuma variao encontrada para step: ${e}`),"Ol! Como posso ajudar?";const n=Math.floor(Math.random()*r.length);let s=r[n];return Object.keys(t).forEach(o=>{const i=new RegExp(`\\{${o}\\}`,"g");s=s.replace(i,t[o])}),s},FV=e=>{try{const t=JSON.parse(localStorage.getItem("isis-feedbacks")||"[]");return t.push(e),localStorage.setItem("isis-feedbacks",JSON.stringify(t)),console.log("[ISIS Feedback] Salvo localmente como fallback:",e.id),e}catch(t){return console.error("[ISIS Feedback] Erro ao salvar localmente:",t),e}},Clt=async e=>{const t={id:Date.now()+Math.random().toString(36).substr(2,9),timestamp:new Date().toISOString(),estrelas:e?.rating??null,nome_cliente:e?.cliente_nome??null,empresa:e?.empresa_nome??null,projeto:"fluxo7arena",comentario:e?.comentario??null};try{const r={id:String(e?.sessionId||e?.session_id||t.id),cod_cliente:e?.cliente_codigo??e?.cliente_id??e?.cod_cliente??null,nome_cliente:e?.cliente_nome||null,empresa:e?.empresa_nome||null,projeto:"fluxo7arena",nota:e?.rating??null,comentario:e?.comentario||null,conversa:Array.isArray(e?.conversaArray)?e.conversaArray:e?.conversa&&typeof e.conversa=="object"?e.conversa:null,timestamp:t.timestamp},{error:n}=await NO.from("isis").upsert(r,{onConflict:"id"});return n?(console.error("[Supabase ISIS] Erro ao inserir feedback:",n),FV({...t,projeto:"fluxo7arena"})):(console.log("[Supabase ISIS] Feedback inserido com sucesso:",r.id),t)}catch(r){return console.error("[Supabase ISIS] Exceo ao inserir feedback, salvando localmente:",r),FV(t)}},Alt=()=>{const{nomeFantasia:e}=wde(),t=Ee.useMemo(()=>{try{if(typeof window>"u")return null;const Ke=window.location.host||"",qe="f7arena.com";if(!Ke.endsWith(qe))return null;const ze=Ke.slice(0,-qe.length).replace(/\.$/,"");if(!ze)return null;const Je=ze.toLowerCase();return Je==="www"?null:Je}catch{return null}},[]),r=e||t;hl();const[n,s]=p.useState(null),{currentStep:o,selections:i,addIsisMessage:l,addIsisMessageWithButtons:c,addUserMessage:d,disableAllButtons:u,removeMessageById:f,hideButtonsInMessage:h,updateSelection:m,updateContact:x,nextStep:g,setIsLoading:y,setIsTyping:v,chatEndRef:b,sessionId:w,messages:_}=l5(),[j,S]=p.useState(null),[C,A]=p.useState([]),[P,F]=p.useState([]),[O,I]=p.useState(!0),[T,k]=p.useState("telefone"),[B,z]=p.useState(!1),[U,L]=p.useState(null),[W,ge]=p.useState(null),[Ae,V]=p.useState(!1),[$,Y]=p.useState(null),[he,J]=p.useState(null);if(typeof window<"u"&&new URLSearchParams(window.location.search||"").get("crash")==="1")throw new Error("Isis forced crash test");const G=Ke=>Ke?Ke.replace(/([A-Z])/g," $1").replace(/([0-9]+)/g," $1").trim().split(/[\s_-]+/).filter(Boolean).map(ze=>ze.charAt(0).toUpperCase()+ze.slice(1).toLowerCase()).join(" "):"",ue=Ee.useMemo(()=>j?j.isis_display_name?j.isis_display_name:r?G(r):j.nome_fantasia?j.nome_fantasia:j.razao_social?j.razao_social:"Arena":"",[j,r]),ve=Ee.useMemo(()=>j?.logo_url?`${j.logo_url}?v=${Date.now()}`:j?.logo_url||"",[j?.logo_url]);p.useEffect(()=>{(async()=>{if(!r){I(!1);return}try{const ze=decodeURIComponent(r).toLowerCase().replace(/[\s\-_]+/g,"").trim();let Je=null,kt=null;try{const{data:dt,error:Mt}=await re.rpc("get_empresa_public_by_isis_subdomain",{p_subdomain:ze});!Mt&&dt&&dt.length>0&&(Je=dt[0],kt=dt[0]?.isis_display_name||null)}catch{}try{if(!Je){const{data:dt}=await re.from("agenda_settings").select("empresa_id, isis_subdomain, isis_display_name, empresas(codigo_empresa, nome_fantasia, razao_social, nome, logo_url, telefone, id)").eq("isis_subdomain",ze).single();dt?.empresas&&(Je=dt.empresas,kt=dt.isis_display_name)}}catch{}if(!Je){let dt=null;try{const{data:Mt,error:ce}=await re.rpc("get_empresa_public_by_slug",{p_slug:ze});!ce&&Mt&&Mt.length>0&&(dt=Mt[0])}catch{}Je=dt||null}if(!Je){const{data:dt,error:Mt}=await re.from("empresas").select("codigo_empresa, nome_fantasia, razao_social, nome, logo_url, id");if(!Mt&&Array.isArray(dt)){const ce=dt.find(Xe=>[Xe?.nome_fantasia||"",Xe?.razao_social||"",Xe?.nome||""].some(Tt=>Tt.toLowerCase().replace(/[\s\-_]+/g,"").trim()===ze));ce&&(Je=ce)}}const ct=Je?.id||Je?.codigo_empresa;if(Je&&!kt&&ct)try{let dt=null,Mt=null;if(Je.id){const ce=await re.from("agenda_settings").select("isis_subdomain, empresa_id").eq("empresa_id",Je.id).single();dt=ce.data,Mt=ce.error}else if(Je.codigo_empresa){const{data:ce}=await re.from("empresas").select("id").eq("codigo_empresa",Je.codigo_empresa).single();if(ce?.id){const Xe=await re.from("agenda_settings").select("isis_subdomain, empresa_id").eq("empresa_id",ce.id).single();dt=Xe.data,Mt=Xe.error}}if(dt?.isis_subdomain){console.error("[Isis] Acesso bloqueado. Use o subdomnio configurado."),s(null),I(!1);return}}catch{}if(!Je){console.error("[Isis] Empresa no encontrada"),s(null),I(!1);return}if(!kt&&Je.id)try{const{data:dt}=await re.from("agenda_settings").select("isis_display_name").eq("empresa_id",Je.id).single();dt?.isis_display_name&&(kt=dt.isis_display_name)}catch{}const tr={...Je,isis_display_name:kt};S(tr),s(Je.codigo_empresa),I(!1)}catch(qe){console.error("[Isis] Erro ao buscar empresa:",qe),s(null),I(!1)}})()},[r]),p.useEffect(()=>{const Ke=qe=>{try{qe.preventDefault()}catch{}Y(qe)};return window.addEventListener("beforeinstallprompt",Ke),()=>window.removeEventListener("beforeinstallprompt",Ke)},[]),p.useEffect(()=>{try{if(!(new URLSearchParams(window.location.search||"").get("install")==="1"))return;const ze=window.__installPrompt||$,Je=()=>{const kt=[" Como instalar o app:",""," Chrome (Android/PC):","  1) Toque nos 3 pontinhos () do navegador",'  2) Escolha "Instalar app" ou "Adicionar  tela inicial"','  3) Confirme em "Instalar"',""," Safari (iPhone/iPad):","  1) Toque no boto Compartilhar (quadrado com seta )",'  2) Selecione "Adicionar  Tela de Incio"','  3) Toque em "Adicionar"'].join(`
`);l(kt,400),setTimeout(()=>{l("Beleza! O que voc gostaria de fazer agora?",600),setTimeout(()=>{try{wt()}catch{}},800)},700)};(async()=>{try{ze?.prompt&&(ze===$&&Y(null),ze===window.__installPrompt&&(window.__installPrompt=null),await ze.prompt(),await ze.userChoice)}catch{}Je()})()}catch{}},[$]),p.useEffect(()=>{!n||O||!i.cliente&&!Ae&&(V(!0),setTimeout(()=>{oe()},2500))},[n,O,i.cliente,Ae]),p.useEffect(()=>{(async()=>{if(n)try{console.log("[useEffect] Definindo empresa atual para RLS:",n),await re.rpc("set_current_empresa",{empresa_codigo:String(n)}),await er()}catch(qe){console.error("[useEffect] Erro ao definir empresa para RLS:",qe),await er()}})()},[n]);const ae=()=>{const qe=new Date().getHours();return qe>=5&&qe<12?"Bom dia":qe>=12&&qe<18?"Boa tarde":"Boa noite"},oe=()=>{console.log("[DEBUG] iniciarIdentificacao INICIOU:",{loadingEmpresa:O,empresa:j?.nome_fantasia,timestamp:new Date().toISOString()}),k("telefone"),z(!1);const Ke=ae(),qe=[`**${Ke}!** Tudo bem? 

Sou a **sis**, assistente virtual da **${ue}** e estou aqui para tornar seu **agendamento** super fcil!

Para comear, qual seu **telefone** ou **e-mail**?`,`Hey! **${Ke}!**  **sis** na rea!

Sou a assistente virtual da **${ue}** e vim facilitar sua vida.

Bora **agendar**? Me passa seu **telefone** ou **e-mail**:`,`**${Ke}!** Prazer em te atender! 

Sou a **sis** da **${ue}**, sua assistente virtual para **agendamentos**.

Para comear, preciso do seu **telefone** ou **e-mail**:`,`Opa! **${Ke}!**  **sis** aqui, sua assistente virtual da **${ue}**!

Vamos **marcar seu horrio**?  rapidinho!

Me informa seu **telefone** ou **e-mail**:`,`**${Ke}!** Seja bem-vindo! 

Eu sou a **sis**, sua assistente virtual aqui na **${ue}**.

Vou te ajudar a **agendar seu horrio** rapidinho!

Informe seu **telefone** ou **e-mail**:`],ze=Math.floor(Math.random()*qe.length);console.log("[DEBUG] Mostrando indicador de digitao primeiro:",{loadingEmpresa:O,timestamp:new Date().toISOString()}),v(!0),setTimeout(()=>{console.log("[DEBUG] Fazendo scroll inicial para mostrar indicador de digitao"),b.current?.scrollIntoView({behavior:"smooth",block:"end"})},300),setTimeout(()=>{console.log("[DEBUG] Enviando mensagem da Isis aps indicador de digitao"),v(!1),l(qe[ze],0),setTimeout(()=>{console.log("[DEBUG] Fazendo scroll aps mensagem aparecer"),b.current?.scrollIntoView({behavior:"smooth",block:"end"})},100)},3500),setTimeout(()=>{console.log("[DEBUG] Mostrando input"),z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"end"})},200)},3500+600),g("identificacao")},me=async Ke=>{try{console.log("[DEBUG] Buscando cliente com valor:",Ke),console.log("[DEBUG] Cdigo empresa:",n);const qe=Ke.replace(/\D/g,"");if(qe.length>=10){console.log("[DEBUG] Buscando telefone:",qe);const{data:kt,error:ct}=await re.from("clientes").select("id, nome, email, telefone, whatsapp, celular1, codigo").eq("codigo_empresa",n).eq("status","active");if(ct)throw ct;console.log("[DEBUG] Total de clientes ativos:",kt?.length);const tr=kt?.find(dt=>{const Mt=(dt.telefone||"").replace(/\D/g,""),ce=(dt.whatsapp||"").replace(/\D/g,""),Xe=(dt.celular1||"").replace(/\D/g,"");return Mt.includes(qe)||ce.includes(qe)||Xe.includes(qe)});return console.log("[DEBUG] Cliente encontrado:",tr),tr||null}const{data:ze,error:Je}=await re.from("clientes").select("id, nome, email, telefone, whatsapp, codigo").eq("codigo_empresa",n).eq("status","active").ilike("email",`%${Ke}%`);if(Je)throw Je;return ze?.[0]||null}catch(qe){return console.error("Erro ao buscar cliente:",qe),null}},De=Ke=>{const qe=Ke.trim().split(" ").filter(ze=>ze);return qe.length===1?qe[0]:qe.length>=2?`${qe[0]} ${qe[1]}`:qe[0]},ne=async Ke=>{if(!Ke){l("Por favor, informe a data desejada.",400);return}const qe=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,ze=Ke.match(qe);if(!ze){l("**Formato invlido!** Por favor, use o formato DD/MM/AAAA (exemplo: 15/12/2024)",400);return}const[,Je,kt,ct]=ze,tr=new Date(parseInt(ct),parseInt(kt)-1,parseInt(Je));if(isNaN(tr.getTime())||tr.getDate()!==parseInt(Je)||tr.getMonth()!==parseInt(kt)-1||tr.getFullYear()!==parseInt(ct)){l("**Data invlida!** Verifique se o dia, ms e ano esto corretos.",400);return}const dt=new Date;if(dt.setHours(0,0,0,0),tr.setHours(0,0,0,0),tr<dt){l("**Data no passado!** Por favor, escolha uma data de hoje em diante.",400);return}d(Ke);const Mt=sr(tr,"dd/MM/yyyy",{locale:ga}),ce=sr(tr,"EEEE",{locale:ga});y(!0);const Xe=await gr(i.quadra.id,tr);if(y(!1),Xe.fechada){if(Xe.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${Mt}** (${ce}). 

**Motivo:** ${Xe.observacao}`,800);else if(Xe.motivo==="dia_semana"){const nr=sr(tr,"EEEE",{locale:ga});l(`**Ops!** A quadra no funciona ${nr==="domingo"||nr==="sbado"?"aos":"s"} **${nr}s**. 

Escolha outro dia da semana!`,800)}setTimeout(()=>{l("Digite **outra data** no formato DD/MM/AAAA:",1200),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200)},400)},1200);return}m("data",tr),z(!1),k("telefone"),l(`**Perfeito!** Data escolhida: **${Mt}** (${ce}) `,600);const Qt=Xe.slots;if(Qt.length===0){l("Ops! No encontrei **horrios disponveis** para esse dia.  Que tal tentar outra data?",800),setTimeout(()=>{perguntarData()},1200);return}const Tt=fr(Qt);let Ar="";Tt.length===1?Ar=`Tenho **horrios livres** das **${Tt[0].inicio}** s **${Tt[0].fim}**! `:Ar=`Tenho **horrios livres** ${Tt.map((Jr,gn)=>gn===Tt.length-1?`e das **${Jr.inicio}** s **${Jr.fim}**`:gn===0?`das **${Jr.inicio}** s **${Jr.fim}**`:`das **${Jr.inicio}** s **${Jr.fim}**`).join(", ")}! `,l(Ar,1e3),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",1200),g("horario"),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},1600)},ie=async Ke=>{if(T==="data_custom")return await ne(Ke);if(!Ke){l("Por favor, informe seu telefone ou e-mail.",400);return}const qe=T==="telefone"?`(${Ke.slice(0,2)}) ${Ke.slice(2,7)}-${Ke.slice(7)}`:Ke;d(qe);const ze=await me(Ke);if(ze){m("cliente",ze),z(!1);const Je=De(ze.nome),kt=[`**${Je}!** `,`Opa, **${Je}!** `,`E a, **${Je}!** `,`**${Je}!** Que bom te ver! `,`Fala, **${Je}!** `,`**${Je}!** Tudo bem? `,`Hey, **${Je}!** `],ct=Math.floor(Math.random()*kt.length);l(kt[ct],600);let tr="telefone";try{tr=i?.identificacao_tipo||T||"telefone",J(tr==="email"?"email":"telefone")}catch{}const dt=tr==="email"?"email":"telefone";setTimeout(()=>{wt(dt)},600)}else m("identificacao_valor",qe),m("identificacao_tipo",T),z(!1),l("No encontrei seu cadastro. Sem problemas! Vamos fazer rapidinho. ",800),l("Preciso de algumas informaes:",1400),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600)},1400+800),g("cadastro")},ht=async Ke=>{let qe=`Nome: ${Ke.nome}`;if(Ke.telefone){const ze=`(${Ke.telefone.slice(0,2)}) ${Ke.telefone.slice(2,7)}-${Ke.telefone.slice(7)}`;qe+=`
Telefone: ${ze}`}Ke.email&&(qe+=`
E-mail: ${Ke.email}`),d(qe),z(!1),await pt(Ke.nome,Ke.email,Ke.telefone)},pt=async(Ke,qe,ze)=>{try{y(!0);try{if(ze){const dt=String(ze||"").replace(/\D/g,""),{data:Mt,error:ce}=await re.from("clientes").select("id, nome, email, telefone, whatsapp, celular1, codigo").eq("codigo_empresa",n).eq("status","active");if(!ce&&Array.isArray(Mt)){const Xe=Mt.find(Qt=>{const Tt=(Qt.telefone||"").replace(/\D/g,""),Ar=(Qt.whatsapp||"").replace(/\D/g,""),nr=(Qt.celular1||"").replace(/\D/g,"");return Tt===dt||Ar===dt||nr===dt});if(Xe){y(!1),m("cliente_sugerido",Xe),c(`Encontrei um cadastro existente para este telefone: **${De(Xe.nome)}**.  voc?`,[{label:" Sim, sou eu",value:"confirm_cliente_existente"},{label:" No, quero corrigir",value:"corrigir_cadastro"}],200),z(!1),g("confirmar_cliente_existente");return}}}if(qe){const dt=String(qe||"").trim().toLowerCase(),{data:Mt,error:ce}=await re.from("clientes").select("id, nome, email, telefone, whatsapp, codigo").eq("codigo_empresa",n).eq("status","active").ilike("email",dt);if(!ce&&Array.isArray(Mt)&&Mt.length>0){const Xe=Mt.find(Qt=>String(Qt.email||"").trim().toLowerCase()===dt)||null;if(Xe){y(!1),m("cliente_sugerido",Xe),c(`Este e-mail j possui cadastro: **${De(Xe.nome)}**.  voc?`,[{label:" Sim, sou eu",value:"confirm_cliente_existente"},{label:" No, quero corrigir",value:"corrigir_cadastro"}],200),z(!1),g("confirmar_cliente_existente");return}}}}catch{}l(Yx("loading"));const{data:Je}=await re.from("empresa_counters").select("next_cliente_codigo").eq("empresa_id",j?.id).single(),kt=Je?.next_cliente_codigo||1,{data:ct,error:tr}=await re.from("clientes").insert({codigo_empresa:n,codigo:kt,nome:Ke,email:qe||null,telefone:ze,whatsapp:ze,status:"active"}).select("id, nome, email, telefone, whatsapp, codigo").single();if(tr){if(tr.code==="23505"&&tr.message.includes("uq_clientes_empresa_codigo")){console.log("[Isis] Cdigo duplicado, tentando prximo cdigo...");const{data:dt,error:Mt}=await re.from("clientes").insert({codigo_empresa:n,codigo:kt+1,nome:Ke,email:qe||null,telefone:ze,whatsapp:ze,status:"active"}).select("id, nome, email, telefone, whatsapp, codigo").single();if(Mt)throw Mt;await re.from("empresa_counters").update({next_cliente_codigo:kt+2}).eq("empresa_id",j?.id),y(!1),z(!1),m("cliente",dt),l(`Pronto, ${Ke}! Cadastro realizado com sucesso! `,800),setTimeout(()=>{gt()},1400);return}throw tr}await re.from("empresa_counters").update({next_cliente_codigo:kt+1}).eq("empresa_id",j?.id),y(!1),z(!1),m("cliente",ct),l(`Pronto, ${Ke}! Cadastro realizado com sucesso! `,800),setTimeout(()=>{gt()},1400)}catch(Je){console.error("Erro ao criar cliente:",Je),y(!1),l("Ops! Erro ao criar cadastro. Tente novamente.",400)}},Ze=()=>{const Ke=new Date,qe=rs(Ke,1),ze=[{label:`Hoje (${sr(Ke,"dd/MM")})`,value:sr(Ke,"yyyy-MM-dd"),icon:"",date:Ke},{label:`Amanh (${sr(qe,"dd/MM")})`,value:sr(qe,"yyyy-MM-dd"),icon:"",date:qe},{label:"Outro dia...",value:"custom",icon:""}];Array.isArray(C)&&C.length>1&&ze.push({label:"Mudar quadra",value:"mudar_quadra",icon:""}),ze.push({label:" Menu",value:"menu",action:"menu"}),c("Para qual dia voc gostaria de agendar?",ze,600),g("data")},vt=()=>{d(" Mudar Data"),z(!1),setTimeout(()=>{Ze()},400)},wt=(Ke=null)=>{const qe=["O que voc gostaria de fazer hoje?","Como posso te ajudar?","Qual  o plano para hoje?","O que vamos fazer?","Em que posso te auxiliar?","Qual sua necessidade hoje?","Como posso ser til?"],ze=qe[Math.floor(Math.random()*qe.length)];let Je=[{label:"Fazer Agendamento",value:"novo_agendamento",icon:""},{label:"Editar Agendamento",value:"buscar_agendamento",icon:""},{label:"Finalizar Atendimento",value:"finalizar_atendimento",icon:""}];const kt=Ke||he;kt==="telefone"?Je=[Je[0],Je[1],{label:"Informei o telefone errado",value:"corrigir_telefone",icon:""},Je[2]]:kt==="email"&&(Je=[Je[0],Je[1],{label:"Informei o e-mail errado",value:"corrigir_email",icon:""},Je[2]]),c(ze,Je,600),he&&setTimeout(()=>J(null),0)},gt=async()=>{let Ke=C,qe=j;if(!Ke||Ke.length===0){const ze=await er(!1);if(Ke=ze.quadras,qe=ze.empresa,!Ke||Ke.length===0){console.error("[iniciarAgendamento] Quadras ainda no disponveis aps carregar!"),l("Ops! No consegui carregar as quadras. Tente novamente.",600);return}}if(!qe){console.error("[iniciarAgendamento] Empresa no disponvel!"),l("Ops! No consegui carregar os dados da empresa. Tente novamente.",600);return}setTimeout(()=>{_e(Ke,qe,!0)},800)},er=async(Ke=!0)=>{try{Ke&&I(!0);const qe=Date.now(),ze=3500,{data:Je,error:kt}=await re.from("empresas").select("*").eq("codigo_empresa",n).single();if(kt)throw kt;if(!Je)return Pj({title:"Empresa no encontrada",description:"Verifique o cdigo e tente novamente",variant:"destructive"}),{empresa:null,quadras:[]};S(ce=>({...Je,isis_display_name:ce?.isis_display_name||Je.isis_display_name})),m("empresa",Je);const{data:ct,error:tr}=await re.from("quadras").select("id, nome, modalidades, hora_inicio, hora_fim, valor, codigo_empresa, status, descricao").eq("codigo_empresa",String(n)).eq("status","Ativa").order("nome",{ascending:!0});if(tr)throw console.error("[loadEmpresa] Erro ao buscar quadras:",tr),tr;if(!ct||ct.length===0){console.warn("[loadEmpresa] Nenhuma quadra encontrada devido a RLS. Criando quadra temporria.");const ce=[{id:"temp-quadra-1004",nome:"Quadra Principal",modalidades:["Futebol","Futsal"],hora_inicio:"07:00:00",hora_fim:"22:00:00",valor:30,codigo_empresa:String(n),status:"Ativa",descricao:"Quadra temporria (problema de permisso)"}];return A(ce),{empresa:Je,quadras:ce}}A(ct||[]);const dt=Date.now()-qe,Mt=Math.max(0,ze-dt);return Mt>0&&await new Promise(ce=>setTimeout(ce,Mt)),{empresa:Je,quadras:ct||[]}}catch(qe){console.error("[Isis] Erro ao carregar empresa:",qe);const ze=Date.now()-startTime,Je=Math.max(0,minLoadingTime-ze);return Je>0&&await new Promise(kt=>setTimeout(kt,Je)),Pj({title:"Erro ao carregar",description:"No foi possvel carregar os dados da empresa",variant:"destructive"}),{empresa:null,quadras:[]}}finally{Ke&&I(!1)}},_e=(Ke,qe,ze=!1)=>{if(ae(),Ke.length===1){const ct=Ke[0];if(ze){const tr=[`Perfeito! Agora vamos **agendar** seu horrio na **${ct.nome}!** `,`timo! Vou te ajudar a **marcar sua partida** na **${ct.nome}!** `,`Show! Bora **agendar** a **${ct.nome}?** `,`Perfeito! Vamos **marcar sua reserva** na **${ct.nome}!** `],dt=Math.floor(Math.random()*tr.length),Mt=tr[dt];l(Mt)}m("quadra",ct),setTimeout(()=>{const tr=new Date,dt=rs(tr,1),Mt=[{label:`Hoje (${sr(tr,"dd/MM")})`,value:sr(tr,"yyyy-MM-dd"),icon:"",date:tr},{label:`Amanh (${sr(dt,"dd/MM")})`,value:sr(dt,"yyyy-MM-dd"),icon:"",date:dt},{label:"Outro dia...",value:"custom",icon:""},{label:" Menu",value:"menu",action:"menu"}];c("Para qual dia voc gostaria de agendar?",Mt,800),g("data")},1200);return}let Je;if(ze){const ct=["Qual quadra voc quer reservar? ","Qual quadra te interessa? ","Me diz, qual quadra? ","Qual quadra voc prefere? ","Bora escolher a quadra? Qual delas? "],tr=Math.floor(Math.random()*ct.length);Je=ct[tr]}else return;const kt=Ke.map(ct=>({label:ct.nome,subtitle:ct.descricao||null,value:ct.id,icon:"",quadra:ct}));kt.push({label:" Menu",value:"menu",action:"menu"}),c(Je,kt),g("quadra")},Pt=async Ke=>{if(Ke.action==="menu"){d(" Menu");try{ge(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{L(null)}catch{}try{z(!1)}catch{}g("identificacao"),setTimeout(()=>{wt()},400);return}const qe=Ke.quadra;if(!qe){console.error("[handleQuadraSelection] Quadra no encontrada no boto:",Ke);return}if(d(qe.nome),m("quadra",qe),o==="review"){z(!1),L("horario"),y(!0);const tr=await gr(qe.id,i.data,W?.id);if(y(!1),tr.fechada){const Mt=sr(i.data,"dd/MM/yyyy",{locale:ga}),ce=sr(i.data,"EEEE",{locale:ga});if(tr.motivo==="data_especifica")l(`**Ops!** A **${qe.nome}** estar **fechada** no dia **${Mt}** (${ce}). 

**Motivo:** ${tr.observacao}`,800);else if(tr.motivo==="dia_semana"){const Xe=sr(i.data,"EEEE",{locale:ga}),Qt=Xe==="domingo"||Xe==="sbado"?"aos":"s";l(`**Ops!** A **${qe.nome}** no funciona ${Qt} **${Xe}s**. `,800)}setTimeout(()=>{l("Escolha **outra quadra** ou **mude a data**:",1200),setTimeout(()=>{Ze()},400)},1600);return}const dt=tr.slots;if(dt&&dt.length>0){const Mt=fr(dt);let ce="";Mt.length===1?ce=`Tenho **horrios livres** das **${Mt[0].inicio}** s **${Mt[0].fim}**! `:ce=`Tenho **horrios livres** ${Mt.map((Qt,Tt)=>Tt===Mt.length-1?`e das **${Qt.inicio}** s **${Qt.fim}**`:Tt===0?`das **${Qt.inicio}** s **${Qt.fim}**`:`das **${Qt.inicio}** s **${Qt.fim}**`).join(", ")}! `,console.log("[handleQuadraSelection] Mostrando horrios disponveis e input de horrio"),l(ce,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{console.log("[handleQuadraSelection] Ativando showInput=true"),z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else console.log("[handleQuadraSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para essa quadra nesse dia. "),setTimeout(()=>{l("Que tal tentar **outra data**? ",800),setTimeout(()=>{Ze()},400)},1200);return}console.log("[handleQuadraSelection] Fluxo normal (no edio)");const ze=Yx("afterQuadra",{quadra:qe.nome});l(ze,600);const Je=new Date,kt=rs(Je,1),ct=[{label:`Hoje (${sr(Je,"dd/MM")})`,value:sr(Je,"yyyy-MM-dd"),icon:"",date:Je},{label:`Amanh (${sr(kt,"dd/MM")})`,value:sr(kt,"yyyy-MM-dd"),icon:"",date:kt},{label:"Outro dia...",value:"custom",icon:""},{label:" Menu",value:"menu",action:"menu"}];c("Para qual dia voc gostaria de agendar?",ct,1e3),g("data")},Lt=async Ke=>{if(console.log("[handleDataSelection] Iniciando...",{button:Ke,currentStep:o}),Ke.action==="menu"){d(" Menu");try{ge(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{L(null)}catch{}try{z(!1)}catch{}g("identificacao"),setTimeout(()=>{wt()},400);return}if(Ke.value==="custom"){d(" Outro dia..."),l("**Perfeito!** Me informe a **data desejada** no formato DD/MM/AAAA:",600),k("data_custom"),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},800);return}const qe=Ke.date;if(!qe){console.error("[handleDataSelection] Data no encontrada no boto:",Ke);return}if(d(Ke.label),m("data",qe),!!i?.editing_agendamento||!!W){console.log("[handleDataSelection] Modo edio detectado - recarregando horrios"),console.log("[handleDataSelection] Quadra ID:",i.quadra?.id),console.log("[handleDataSelection] Nova Data:",qe),z(!1),L("horario"),y(!0);const dt=await gr(i.quadra.id,qe,W?.id);if(console.log("[handleDataSelection] Resultado:",dt),y(!1),dt.fechada){const ce=sr(qe,"dd/MM/yyyy",{locale:ga}),Xe=sr(qe,"EEEE",{locale:ga});if(dt.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${ce}** (${Xe}). 

**Motivo:** ${dt.observacao}`,800);else if(dt.motivo==="dia_semana"){const Qt=sr(qe,"EEEE",{locale:ga});l(`**Ops!** A quadra no funciona ${Qt==="domingo"||Qt==="sbado"?"aos":"s"} **${Qt}s**. `,800)}setTimeout(()=>{l("Escolha **outra data**:",1200),setTimeout(()=>{Ze()},400)},1600);return}const Mt=dt.slots;if(Mt&&Mt.length>0){const ce=fr(Mt);let Xe="";ce.length===1?Xe=`Tenho **horrios livres** das **${ce[0].inicio}** s **${ce[0].fim}**! `:Xe=`Tenho **horrios livres** ${ce.map((Tt,Ar)=>Ar===ce.length-1?`e das **${Tt.inicio}** s **${Tt.fim}**`:Ar===0?`das **${Tt.inicio}** s **${Tt.fim}**`:`das **${Tt.inicio}** s **${Tt.fim}**`).join(", ")}! `,console.log("[handleDataSelection] Mostrando horrios disponveis e input"),l(Xe,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{console.log("[handleDataSelection] Ativando showInput=true"),z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else console.log("[handleDataSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para essa quadra nesse dia.  Tente outra data.");return}console.log("[handleDataSelection] Fluxo normal (no edio)"),y(!0);const Je=await gr(i.quadra.id,qe);if(console.log("[handleDataSelection] Resultado (fluxo normal):",Je),y(!1),Je.fechada){const dt=sr(qe,"dd/MM/yyyy",{locale:ga}),Mt=sr(qe,"EEEE",{locale:ga});if(Je.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${dt}** (${Mt}). 

**Motivo:** ${Je.observacao}`,800);else if(Je.motivo==="dia_semana"){const ce=sr(qe,"EEEE",{locale:ga});l(`**Ops!** A quadra no funciona ${ce==="domingo"||ce==="sbado"?"aos":"s"} **${ce}s**. 

Escolha outro dia da semana!`,800)}setTimeout(()=>{l("Que tal tentar **outra data**? ",1200),setTimeout(()=>{Ze()},400)},1600);return}const kt=Je.slots;if(kt.length===0){console.log("[handleDataSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para esse dia.  Que tal tentar outro dia?"),setTimeout(()=>{l("Escolha **outra data**:",800),setTimeout(()=>{Ze()},400)},1200);return}const ct=fr(kt);let tr="";ct.length===1?tr=`Tenho **horrios livres** das **${ct[0].inicio}** s **${ct[0].fim}**! `:tr=`Tenho **horrios livres** ${ct.map((Mt,ce)=>ce===ct.length-1?`e das **${Mt.inicio}** s **${Mt.fim}**`:ce===0?`das **${Mt.inicio}** s **${Mt.fim}**`:`das **${Mt.inicio}** s **${Mt.fim}**`).join(", ")}! `,l(tr,800),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",1e3),g("horario"),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},1e3)},1e3+600)},1400)},gr=async(Ke,qe,ze=null)=>{try{console.log("[loadHorariosDisponiveis] quadraId:",Ke),console.log("[loadHorariosDisponiveis] data:",qe);const Je=C.find(jr=>jr.id===Ke);if(!Je)return console.error("[loadHorariosDisponiveis] Quadra no encontrada:",Ke),[];console.log("[loadHorariosDisponiveis] Quadra encontrada:",Je.nome),console.log("[loadHorariosDisponiveis] Horrio funcionamento:",Je.hora_inicio,"-",Je.hora_fim);const kt=sr(qe,"yyyy-MM-dd"),ct=qe.getDay();console.log("[loadHorariosDisponiveis] Verificando funcionamento para:",kt,"dia da semana:",ct);const{data:tr,error:dt}=await re.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",n).eq("quadra_id",Ke).or(`and(tipo.eq.data_fechamento,data_fechamento.eq.${kt}),and(tipo.eq.dia_semana,dia_semana.eq.${ct})`);if(dt)console.error("[loadHorariosDisponiveis] Erro ao buscar configuraes de funcionamento:",dt);else{console.log("[loadHorariosDisponiveis] Configuraes encontradas:",tr?.length||0);const jr=tr?.find(Oe=>Oe.tipo==="data_fechamento"&&Oe.data_fechamento===kt);if(jr&&!jr.funciona)return console.log("[loadHorariosDisponiveis] Quadra fechada em data especfica:",jr.observacao),{slots:[],fechada:!0,motivo:"data_especifica",observacao:jr.observacao||"Fechamento especial"};const ua=tr?.find(Oe=>Oe.tipo==="dia_semana"&&Oe.dia_semana===ct);if(ua&&!ua.funciona)return console.log("[loadHorariosDisponiveis] Quadra no funciona neste dia da semana"),{slots:[],fechada:!0,motivo:"dia_semana",observacao:`Quadra fechada s ${["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"][ct]}s`};console.log("[loadHorariosDisponiveis] Quadra funciona normalmente na data selecionada")}const Mt=so(qe),ce=rs(Mt,1);let Xe=re.from("agendamentos").select("inicio, fim, status").eq("codigo_empresa",n).eq("quadra_id",Ke).gte("inicio",Mt.toISOString()).lt("inicio",ce.toISOString()).neq("status","canceled");ze&&(Xe=Xe.neq("id",ze),console.log("[loadHorariosDisponiveis] Excluindo agendamento sendo editado:",ze));const{data:Qt,error:Tt}=await Xe;if(Tt)throw Tt;console.log("[loadHorariosDisponiveis] Agendamentos encontrados:",Qt?.length||0);const Ar=parseInt(Je.hora_inicio?.split(":")[0]||"6");let nr=parseInt(Je.hora_fim?.split(":")[0]||"24");nr===0&&(nr=24);const Jr=new Date,gn=so(qe).getTime()===so(Jr).getTime(),tt=[];for(let jr=Ar;jr<nr;jr++)for(let ua of[0,30]){const Oe=N_(j_(qe,jr),ua),Wt=d8(Oe,30);if(gn&&Oe<Jr)continue;Qt?.some(mr=>{const Gt=new Date(mr.inicio),pn=new Date(mr.fim),jt=Math.floor(Oe.getTime()/6e4),ur=Math.floor(Wt.getTime()/6e4),rt=Math.floor(Gt.getTime()/6e4),Dt=Math.floor(pn.getTime()/6e4);return ur===rt||jt===Dt?!1:jt<Dt&&ur>rt})||tt.push({inicio:sr(Oe,"HH:mm"),fim:sr(Wt,"HH:mm"),inicioDate:Oe,fimDate:Wt})}return console.log("[loadHorariosDisponiveis] Total de slots disponveis:",tt.length),F(tt),{slots:tt,fechada:!1,motivo:null,observacao:null}}catch(Je){return console.error("[loadHorariosDisponiveis] Erro ao carregar horrios:",Je),F([]),{slots:[],fechada:!1,motivo:"erro",observacao:"Erro ao carregar horrios"}}},fr=Ke=>{if(Ke.length===0)return[];const qe=[];let ze={inicio:Ke[0].inicio,fim:Ke[0].fim};for(let kt=1;kt<Ke.length;kt++)Ke[kt].inicio===ze.fim?ze.fim=Ke[kt].fim:(qe.push(ze),ze={inicio:Ke[kt].inicio,fim:Ke[kt].fim});qe.push(ze);const Je=kt=>{const[ct,tr]=kt.split(":").map(Number);return ct===0&&tr===0?24*60:ct*60+tr};return qe.filter(kt=>Je(kt.fim)-Je(kt.inicio)>=60)},je=({inicio:Ke,fim:qe,esporte:ze})=>{const[Je,kt]=Ke.split(":").map(Number),[ct,tr]=qe.split(":").map(Number),dt=i.data,Mt=N_(j_(dt,Je),kt),ce=ct===0&&tr===0?N_(j_(rs(dt,1),0),0):N_(j_(dt,ct),tr),Xe={inicio:Ke,fim:qe,inicioDate:Mt,fimDate:ce};if(d(`${Xe.inicio} - ${Xe.fim}  ${ze}`),console.log("[handleHorarioSubmit] Atualizando horrio:",Xe),console.log("[handleHorarioSubmit] Atualizando esporte:",ze),m("horario",Xe),m("esporte",ze),z(!1),o==="review"||U==="horario"){setTimeout(()=>{L(null),g("review"),Ot(Xe,ze)},600);return}const Qt=i.participantes||[];if(!(Array.isArray(Qt)&&Qt.length>0)){const nr=[{nome:i.cliente.nome,cliente_id:i.cliente.id,principal:!0}];m("participantes",nr)}const Ar=De(i.cliente.nome);l(`Perfeito! ${Ar}, voc j est na lista! `,800),l('Quer adicionar mais pessoas? Digite o nome e clique em "Adicionar" para cada um, ou finalize quando quiser.',1400),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600)},1400+600),g("participantes")},nt=async()=>{const Ke=i?.quadra?.id,qe=i?.data,ze=i?.horario;if(!Ke||!qe||!ze?.inicioDate||!ze?.fimDate)return{ok:!0,conflito:!1};const Je=await gr(Ke,qe,null);if(Je?.fechada)return{ok:!0,conflito:!0,motivo:"fechada",detalhe:Je};const kt=Array.isArray(Je?.slots)?Je.slots:[],ct=ze.inicioDate,tr=ze.fimDate,dt=(ce,Xe)=>{const Qt=ce.getTime(),Tt=Xe.getTime();return kt.some(Ar=>Ar?.inicioDate?.getTime?.()===Qt&&Ar?.fimDate?.getTime?.()===Tt)};let Mt=new Date(ct);for(;Mt.getTime()<tr.getTime();){const ce=d8(Mt,30);if(!dt(Mt,ce))return{ok:!0,conflito:!0,motivo:"conflito"};Mt=ce}return{ok:!0,conflito:!1}},$t=Ke=>{if(!Ke||!Ke.trim())return;const qe=i.participantes||[],ze={nome:Ke.trim(),cliente_id:null,principal:!1},Je=[...qe,ze];m("participantes",Je)},Ut=Ke=>{if(!Array.isArray(Ke)||Ke.length===0)return;const qe=ce=>String(ce||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g," "),ze=i.cliente,Je=ze?.nome?String(ze.nome).trim():null,kt=Je?qe(Je):null,ct=i.participantes||[],tr=ct.length>0?ct:Je&&ze?[{nome:Je,cliente_id:ze.id,principal:!0}]:[],dt=[];if(!!i?.editing_agendamento){let ce=tr.find(Xe=>Xe.principal)||(Je&&ze?{nome:Je,cliente_id:ze.id,principal:!0}:null);ce&&dt.push({...ce,principal:!0}),Ke.forEach(Xe=>{const Qt=String(Xe||"").trim();if(!Qt)return;const Tt=qe(Qt);kt&&Tt===kt||dt.push({nome:Qt,cliente_id:null,principal:!1})})}else tr.forEach(ce=>{const Xe=qe(ce.nome),Qt=kt&&Xe===kt;dt.push({...ce,principal:Qt})}),Ke.forEach(ce=>{const Xe=String(ce||"").trim();if(!Xe)return;const Qt=qe(Xe);kt&&Qt===kt||dt.push({nome:Xe,cliente_id:null,principal:!1})});dt.length===0&&Je&&ze&&dt.push({nome:Je,cliente_id:ze.id,principal:!0}),m("participantes",dt)},Fe=Ke=>{const qe=i.participantes||[];if(Ke===0)return;const ze=qe.filter((Je,kt)=>kt!==Ke);m("participantes",ze)},xt=Ke=>{const qe=i.participantes||[];if(qe.length===0){l("Voc precisa ter pelo menos 1 participante!",400);return}try{const Je=(Ke||"").trim();Je&&Je!==i.esporte&&m("esporte",Je)}catch{}z(!1);const ze=qe.length;if(ze===1)d(" Apenas eu por enquanto");else{const Je=qe.filter(kt=>!kt.principal).map(kt=>kt.nome).join(", ");d(` Eu + ${Je} (${ze} pessoas)`)}setTimeout(()=>{L(null);try{const Je=(Ke||"").trim();Ot(null,Je||null)}catch{Ot()}},600)},Ot=(Ke=null,qe=null,ze=!1,Je=null,kt=null,ct=null,tr=null)=>{const dt=Ke||i.horario,Mt=qe||i.esporte,ce=Je||i.quadra,Xe=kt||i.data,Qt=ct||i.participantes||[],Tt=!!(tr||i?.editing_agendamento||W);if(console.log("[mostrarResumo] Selections atuais:",i),console.log("[mostrarResumo] Horrio usado:",dt),console.log("[mostrarResumo] Esporte usado:",Mt),console.log("[mostrarResumo] Quadra atual:",ce),console.log("[mostrarResumo] Data atual:",Xe),console.log("[mostrarResumo] Modo edio inicial:",ze),!Xe||!dt||!ce){console.error("[mostrarResumo] Dados obrigatrios faltando:",{dataFinal:Xe,horarioFinal:dt,quadraFinal:ce});return}if(!ze){const at=Yx("reviewData");l(at,400)}const Ar=Qt.map((at,ee)=>{const Se=ee===0?"":"",$e=ee===0?" (voc)":"";return`${Se} ${at.nome}${$e}`}).join(`
`),nr=sr(Xe,"dd/MM/yyyy",{locale:ga}),Jr=sr(Xe,"EEEE",{locale:ga}),[gn,tt]=dt.inicio.split(":").map(Number),[jr,ua]=dt.fim.split(":").map(Number);let Oe=jr*60+ua-(gn*60+tt);jr===0&&ua===0&&(Oe=24*60-(gn*60+tt));const Wt=Math.floor(Oe/60),Ht=Oe%60,mr=Ht>0?`${Wt}h ${Ht}min`:`${Wt}h`,Gt=ce.valor||0,pn=Oe/30,jt=Math.round(Gt*pn*100)/100,ur=jt/Qt.length;console.log("[mostrarResumo] Clculo do valor:"),console.log("- Valor por meia hora:",Gt),console.log("- Slots de 30min:",pn),console.log("- Durao em minutos:",Oe),console.log("- Valor total:",jt),console.log("- Participantes:",Qt.length),console.log("- Valor dividido:",ur);const rt=i?.empresa?.endereco&&String(i.empresa.endereco).trim().length>0?String(i.empresa.endereco).trim():null,Dt=rt?`
 **Endereo**
${rt}
`:"",Xt=at=>{if(!at)return"N/A";const ee=String(at).replace(/\D/g,"");return ee.length===11?`(${ee.slice(0,2)}) ${ee.slice(2,7)}-${ee.slice(7)}`:ee.length===10?`(${ee.slice(0,2)}) ${ee.slice(2,6)}-${ee.slice(6)}`:at},Tr=i.cliente.telefone||i.cliente.whatsapp||null,qn=Xt(Tr),Gr=` **RESUMO DO AGENDAMENTO**

 **Quadra**
${ce.nome}${Dt}
 **Data**
${nr} (${Jr})

 **Horrio**
${dt.inicio} s ${dt.fim}
 Durao: **${mr}**

 **Modalidade**
${Mt}

 **Participantes** (${Qt.length})
${Ar}

 **Valor Total**
R$ **${jt.toFixed(2).replace(".",",")}**
 **Valor Dividido**
R$ **${ur.toFixed(2).replace(".",",")}** por pessoa

 **Responsvel**
${i.cliente.nome}
 ${qn}`,ar=ze?200:1e3,kn=Gr.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:Gr,copyable:!0,copyText:kn},ar);const Xn=[{label:Tt?"Salvar Alteraes":"Confirmar Agendamento",value:Tt?"confirm":"criar agendamento",icon:""}],aa=[];C.length>1&&aa.push({label:"Editar Quadra",value:"edit_quadra",icon:""}),aa.push({label:"Editar Data",value:"edit_data",icon:""}),aa.push({label:"Editar Horrio e Esporte",value:"edit_horario",icon:""}),aa.push({label:"Editar Participantes",value:"edit_participantes",icon:""}),(ze||Tt&&!i?.editing_agendamento)&&aa.push({label:"Gerar Times",value:"gerar_times",icon:""}),Tt&&aa.push({label:"Cancelar Agendamento",value:"cancelar_agendamento",icon:""});const te=[...Xn,...aa];te.push({label:" Menu",value:"menu",action:"menu"}),c("Est tudo correto?",te,ze?400:1600),g("review")},Cr=(Ke,qe=!1)=>{l(qe?" **Perfeito!** Suas **alteraes** foram **salvas com sucesso!**":" **Pronto!** Seu **agendamento** foi **confirmado com sucesso!**",600,"green");const Je=i.participantes||[],kt=Je.map(Gt=>` ${Gt.nome}`).join(`
`),ct=sr(i.data,"dd/MM/yyyy",{locale:ga}),tr=sr(i.data,"EEEE",{locale:ga}),[dt,Mt]=i.horario.inicio.split(":").map(Number),[ce,Xe]=i.horario.fim.split(":").map(Number);let Qt=ce*60+Xe-(dt*60+Mt);ce===0&&Xe===0&&(Qt=24*60-(dt*60+Mt));const Tt=Math.floor(Qt/60),Ar=Qt%60,nr=Ar>0?`${Tt}h ${Ar}min`:`${Tt}h`,Jr=i.quadra.valor||0,gn=Qt/30,tt=Math.round(Jr*gn*100)/100,jr=Je.length>0?tt/Je.length:0,ua=i?.empresa?.endereco&&String(i.empresa.endereco).trim().length>0?String(i.empresa.endereco).trim():null,Oe=ua?`
 **Endereo**
${ua}
`:"",Wt=` **AGENDAMENTO CONFIRMADO**

 **Cdigo:** #${Ke.codigo}

 **Local**
${i.quadra.nome}${Oe}

 **Quando**
${ct} (${tr})
 ${i.horario.inicio} s ${i.horario.fim} **(${nr})**

 **Modalidade**
${i.esporte}

 **Participantes** (${Je.length})
${kt}

 **Valor Total:** R$ **${tt.toFixed(2).replace(".",",")}**
 **Valor Dividido:** R$ **${jr.toFixed(2).replace(".",",")}** por pessoa

 **Responsvel:** ${i.cliente.nome}`,Ht=Wt.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:Wt,copyable:!0,copyText:Ht},1200),c("O que voc gostaria de fazer?",[{label:"Gerar Times",value:"gerar_times",icon:""},{label:"Editar Agendamento",value:"editar_agendamento",icon:""},{label:"Cancelar Agendamento",value:"cancelar_agendamento",icon:""},{label:"Finalizar Atendimento",value:"finalizar",icon:""}],1800)},Me=async()=>{try{v(!0)}catch{}try{const Ke=(i.participantes||[]).map(rt=>String(rt?.nome||"").trim()).filter(Boolean);if(!Ke||Ke.length===0){l("No h participantes suficientes para formar times.");return}const qe=String(i?.esporte||i?.quadra?.tipo||"").toLowerCase();let ze=0,Je="unknown";try{console.log("[Teams] Start generation modalidade=%o",qe)}catch{}try{const{data:rt}=await re.functions.invoke("infer-team-size",{body:{modalidade:qe,quadra:i?.quadra||null,totalPlayers:(i.participantes||[]).length}});try{console.log("[Teams] Edge infer-team-size response=%o",rt)}catch{}rt&&Number(rt.teamSize)>0&&(ze=Number(rt.teamSize),Je="edge")}catch{}if(!ze)if(/(praia|areia)/i.test(qe)){ze=5,Je="fallback:beach";try{console.log("[Teams] Fallback matched: praia/areia -> teamSize=5")}catch{}}else if(/(v[o]lei|voleibol)/i.test(qe)){ze=6,Je="fallback:volley";try{console.log("[Teams] Fallback matched: volei/voleibol -> teamSize=6")}catch{}}else if(/(hand|handebol)/i.test(qe)){ze=7,Je="fallback:hand";try{console.log("[Teams] Fallback matched: handebol -> teamSize=7")}catch{}}else if(/(futsal|society)/i.test(qe)){ze=5,Je="fallback:futsal";try{console.log("[Teams] Fallback matched: futsal/society -> teamSize=5")}catch{}}else if(/(futebol|campo)/i.test(qe)){ze=11,Je="fallback:campo";try{console.log("[Teams] Fallback matched: futebol/campo -> teamSize=11")}catch{}}else{ze=5,Je="fallback:default";try{console.log("[Teams] Fallback matched: default -> teamSize=5")}catch{}}{const rt=String(qe||"").toLowerCase(),Dt=/(v[o]lei|voleibol)/.test(rt),Xt=/(praia|areia)/.test(rt),Tr=ze;Dt&&(ze=Xt?5:6),Dt&&(Je=Xt?"forced:beach":"forced:volley");try{console.log("[Teams] Normalization: isVolley=%s isBeach=%s before=%s after=%s source=%s",Dt,Xt,Tr,ze,Je)}catch{}}const kt=rt=>String(rt||"").trim().toLowerCase(),ct=Array.isArray(i?.fixos)?i.fixos:[],tr=Array.isArray(i?.goleiros)?i.goleiros:[],dt=Array.isArray(i?.levantadores)?i.levantadores:[],Mt=new Set([...ct,...tr,...dt].map(kt).filter(Boolean)),ce=rt=>Mt.has(kt(rt)),Xe=(()=>{const rt={},Dt=i?.fixoRoles;if(Dt&&typeof Dt=="object")for(const Xt of Object.keys(Dt))rt[Xt]=Dt[Xt];return tr.forEach(Xt=>{rt[kt(Xt)]="Goleiro"}),dt.forEach(Xt=>{rt[kt(Xt)]="Levantador"}),rt})(),Qt=rt=>ce(rt)?` (${Xe[kt(rt)]||"Fixo"})`:"",Tt=Ke.filter(ce),nr=Ke.filter(rt=>!ce(rt)).slice();for(let rt=nr.length-1;rt>0;rt--){const Dt=Math.floor(Math.random()*(rt+1));[nr[rt],nr[Dt]]=[nr[Dt],nr[rt]]}ze<2&&(ze=2);const Jr=rt=>rt.map((Dt,Xt)=>`${Xt+1}) ${Dt}${Qt(Dt)}`).join(`
`)||"",gn=Ke.length;let tt=0;if(gn>=2*ze){tt=Math.max(2,Math.floor(gn/ze));try{console.log("[Teams] Brute rule: canMakeTwoBase=true -> teamCount=%s teamSize=%s",tt,ze)}catch{}}else{const rt=ze;ze>5&&(ze=5),tt=Math.ceil(gn/ze);try{console.log("[Teams] Brute rule: canMakeTwoBase=false -> forceSize %s->%s, teamCount=%s",rt,ze,tt)}catch{}}let Oe=` **Times gerados (${qe?qe[0].toUpperCase()+qe.slice(1):"modalidade"})**`;const Wt=["","","","","",""],Ht=(qe||"").toLowerCase(),mr=/(fut|society|sal[a]o)/.test(Ht),Gt=/(v[o]lei|volei|voleibol)/.test(Ht);try{console.log("[Teams] teamSize=%s totalPlayers=%s teamCount=%s isVolleyLike=%s isSoccerLike=%s source=%s",ze,gn,tt,Gt,mr,Je)}catch{}if(tt>=2){const rt=Array.from({length:tt},()=>[]);if(mr&&tr.length>0)for(let ar=0;ar<tt;ar++){const kn=tr[ar%tr.length],Xn=rt[ar].some(aa=>tr.includes(aa));rt[ar].length<ze&&!Xn&&!rt[ar].includes(kn)&&rt[ar].push(kn)}if(Gt&&dt.length>0)for(let ar=0;ar<tt;ar++){const kn=dt[ar%dt.length],Xn=rt[ar].some(aa=>dt.includes(aa));rt[ar].length<ze&&!Xn&&!rt[ar].includes(kn)&&rt[ar].push(kn)}const Dt=Tt.filter(ar=>!tr.includes(ar)&&!dt.includes(ar));if(Dt.length>0){let ar=0;for(const kn of Dt){let Xn=0;for(;Xn<tt&&rt[ar].length>=ze;)ar=(ar+1)%tt,Xn++;rt[ar].length<ze&&rt[ar].push(kn),ar=(ar+1)%tt}}for(const ar of nr){let kn=0,Xn=1/0;for(let aa=0;aa<rt.length;aa++)rt[aa].length<Xn&&rt[aa].length<ze&&(Xn=rt[aa].length,kn=aa);rt[kn].length<ze&&rt[kn].push(ar)}for(let ar=0;ar<rt.length;ar++)for(;rt[ar].length<ze;)if(mr&&tr.length>0){if(rt[ar].some(aa=>tr.includes(aa)))break;const Xn=tr.find(aa=>!rt[ar].includes(aa));if(Xn)rt[ar].push(Xn);else break}else if(Gt&&dt.length>0){if(rt[ar].some(aa=>dt.includes(aa)))break;const Xn=dt.find(aa=>!rt[ar].includes(aa));if(Xn)rt[ar].push(Xn);else break}else break;const Xt=tt*ze,Tr=gn>Xt?[...Tt,...nr].slice(Xt):[];mr&&tr.length>0?Tr.some(kn=>tr.includes(kn))||Tr.unshift(tr[0]):Gt&&dt.length>0&&(Tr.some(kn=>dt.includes(kn))||Tr.unshift(dt[0]));try{const ar=rt.map(kn=>kn.length);console.log("[Teams] Final distribution teamSize=%s teams=%o reservas=%o",ze,ar,Tr)}catch{}const qn=[];for(;Tr.length>=ze;)qn.push(Tr.splice(0,ze));rt.concat(qn).forEach((ar,kn)=>{const Xn=Wt[kn%Wt.length];Oe+=`

**${Xn} Time ${kn+1} (${ar.length})**:
${Jr(ar)}`}),Tr.length&&(Oe+=`

** Reservas (${Tr.length})**:
${Jr(Tr)}`)}else{const rt=[...Tt,...nr];if(rt.length===0){l("No h participantes suficientes para formar times.");return}if(rt.length===1)Oe+=`

 Ainda no h jogadores suficientes para formar 2 times. Adicione mais participantes.`,Oe+=`

** Time 1 (1)**:
1) ${rt[0]}${Qt(rt[0])}`;else{const Dt=Math.min(ze,Math.ceil(rt.length/2)),Xt=Math.min(ze,rt.length-Dt),Tr=rt.slice(0,Dt),qn=rt.slice(Dt,Dt+Xt);Oe+=`

 Jogadores insuficientes para 2 equipes completas de ${ze}. Montei 2 times balanceados de ${Tr.length} e ${qn.length}.`,Oe+=`

** Time 1 (${Tr.length})**:
${Jr(Tr)}`,Oe+=`

** Time 2 (${qn.length})**:
${Jr(qn)}`}}const pn=Oe.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:Oe,copyable:!0,copyText:pn},600);const ur=[...!0?[{label:"Gerar novamente",value:"gerar_times_again",icon:""}]:[],{label:"Concluir",value:"aceitar_times",icon:""}];c("Tudo certo com os times?",ur,1400)}catch{l("No foi possvel gerar times agora. Tente novamente.")}},Qe=async Ke=>{if(Ke.action==="menu"){d(" Menu");try{ge(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{L(null)}catch{}try{z(!1)}catch{}g("identificacao"),setTimeout(()=>{wt()},400);return}if(Ke.quadra){await Pt(Ke);return}if(Ke.date){await Lt(Ke);return}if(Ke.agendamento){const qe=sr(new Date(Ke.agendamento.inicio),"dd/MM/yyyy",{locale:ga}),ze=sr(new Date(Ke.agendamento.inicio),"HH:mm"),Je=sr(new Date(Ke.agendamento.fim),"HH:mm");d(`${qe}  ${ze}-${Je}`),await Yt(Ke.agendamento);return}switch(Ke.value){case"novo_agendamento":{d(" Fazer Agendamento");try{ge(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{L(null)}catch{}try{z(!1)}catch{}await gt();break}case"buscar_agendamento":{d(" Editar Agendamento"),l("Vou buscar seus agendamentos...",600),et();break}case"finalizar_atendimento":{d(" Finalizar Atendimento");try{resetConversation()}catch{}l("Atendimento finalizado. Se precisar,  s me chamar de novo! ",400);break}case"corrigir_telefone":{d(" Informei o telefone errado"),m("cliente",null),m("identificacao_valor",null),k("telefone"),z(!0),g("identificacao");break}case"corrigir_email":{d(" Informei o e-mail errado"),m("cliente",null),m("identificacao_valor",null),k("email"),z(!0),g("identificacao");break}case"continuar_fluxo":{wt();break}case"gerar_times":case"gerar_times_again":{d(Ke.value==="gerar_times_again"?" Gerar novamente":" Gerar Times"),await Me();break}case"aceitar_times":{d(" Concluir"),l("Beleza! O que voc gostaria de fazer agora?",400),setTimeout(()=>{wt()},800);break}case"confirm":const qe=!!i?.editing_agendamento||!!W;d(qe?" Salvar Alteraes":" Confirmar Agendamento"),qe?await _r():await Rr();break;case"criar agendamento":d(" Confirmar Agendamento"),await Rr();break;case"edit_quadra":d(" Editar Quadra");const Je=C.map(nr=>({label:nr.nome,value:nr.id,icon:"",subtitle:nr.descricao||nr.tipo||null,quadra:nr}));c("Qual quadra voc quer?",Je,600);break;case"edit_data":d(" Editar Data");const kt=new Date,ct=rs(kt,1),tr=[{label:`Hoje (${sr(kt,"dd/MM")})`,value:sr(kt,"yyyy-MM-dd"),icon:"",date:kt},{label:`Amanh (${sr(ct,"dd/MM")})`,value:sr(ct,"yyyy-MM-dd"),icon:"",date:ct},{label:"Outro dia...",value:"custom",icon:""}];c("Para qual dia?",tr,600),g("data");break;case"edit_horario":d(" Editar Horrio e Esporte"),z(!1),L("horario"),y(!0);const dt=await gr(i.quadra.id,i.data,W?.id);if(y(!1),dt.fechada){const nr=sr(i.data,"dd/MM/yyyy",{locale:ga}),Jr=sr(i.data,"EEEE",{locale:ga});if(dt.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${nr}** (${Jr}). 

**Motivo:** ${dt.observacao}`,800);else if(dt.motivo==="dia_semana"){const gn=sr(i.data,"EEEE",{locale:ga});l(`**Ops!** A quadra no funciona ${gn==="domingo"||gn==="sbado"?"aos":"s"} **${gn}s**. `,800)}setTimeout(()=>{l("No  possvel editar o horrio. Escolha **outra data** ou **quadra**:",1200),setTimeout(()=>{Ze()},400)},1600);return}const Mt=dt.slots;if(Mt&&Mt.length>0){const nr=fr(Mt);let Jr="";nr.length===1?Jr=`Tenho **horrios livres** das **${nr[0].inicio}** s **${nr[0].fim}**! `:Jr=`Tenho **horrios livres** ${nr.map((tt,jr)=>jr===nr.length-1?`e das **${tt.inicio}** s **${tt.fim}**`:jr===0?`das **${tt.inicio}** s **${tt.fim}**`:`das **${tt.inicio}** s **${tt.fim}**`).join(", ")}! `,l(Jr,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else l("Ops! No encontrei **horrios disponveis**. ");break;case"edit_participantes":d(" Editar Participantes"),z(!1),L("participantes"),l("Edite a lista de participantes:",600),setTimeout(()=>{z(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200)},800);break;case"finalizar":d(" Finalizar Atendimento");const ce=["Pronto! Seu agendamento est confirmado! ","Perfeito! Agendamento realizado com sucesso! ","Tudo certo! Seu horrio est garantido! ","Sucesso! Agendamento confirmado! "],Xe=ce[Math.floor(Math.random()*ce.length)];l(Xe,800),setTimeout(()=>{Jt()},1400);break;case"cancelar_agendamento":d(" Cancelar Agendamento");const Qt=[{label:"Sim, cancelar",value:"confirmar_cancelamento",icon:""},{label:"No, voltar",value:"voltar_cancelamento",icon:""}],Tt=["Tem certeza que deseja cancelar este agendamento?","Confirma o cancelamento do agendamento?","Realmente quer cancelar? Esta ao no pode ser desfeita.","Deseja mesmo cancelar este agendamento?"],Ar=Tt[Math.floor(Math.random()*Tt.length)];c(Ar,Qt,600);break;case"confirmar_cancelamento":await xr();break;case"voltar_cancelamento":d(" Voltar"),l("Ok! Voltando ao resumo do agendamento.",400),setTimeout(()=>{Ot(null,null,!0,null,null,null,W)},800);break;case"editar_agendamento":d(" Editar Agendamento"),l("Claro! O que voc gostaria de alterar?",600),setTimeout(()=>{Ot(null,null,!0)},800);break;case"novo_agendamento":d(" Fazer Agendamento"),gt();break;case"buscar_agendamento":d(" Editar Agendamento"),l("Vou buscar seus agendamentos...",600),et();break;case"finalizar_atendimento":d(" Finalizar Atendimento"),Jt();break;default:console.warn("[Isis] Ao no reconhecida:",Ke.value)}},et=async()=>{try{console.log("[buscarAgendamentosCliente] Iniciando busca de agendamentos...");const{data:Ke,error:qe}=await re.from("agendamentos").select(`
          id,
          codigo,
          inicio,
          fim,
          modalidade,
          status,
          valor_total,
          quadras!inner(nome, descricao, valor)
        `).eq("codigo_empresa",n).eq("cliente_id",i.cliente.id).in("status",["scheduled","confirmed"]).gte("inicio",new Date().toISOString()).order("inicio",{ascending:!0});if(qe)throw qe;if(!Ke||Ke.length===0){l("No encontrei agendamentos futuros para voc. ",800),l("Que tal fazer um novo agendamento? ",1400),setTimeout(()=>{gt()},2e3);return}if(Ke.length===1){const ze=Ke[0],Je=sr(new Date(ze.inicio),"dd/MM/yyyy",{locale:ga}),kt=sr(new Date(ze.inicio),"HH:mm"),ct=sr(new Date(ze.fim),"HH:mm");l(`Encontrei seu agendamento para ${Je} das ${kt} s ${ct} - ${ze.modalidade}! `,800),setTimeout(()=>{Yt(ze)},1200)}else{l(`Encontrei ${Ke.length} agendamentos futuros! Qual voc quer editar?`,800);const ze=Ke.map(Je=>{const kt=new Date(Je.inicio),ct=sr(kt,"dd/MM/yyyy",{locale:ga}),tr=sr(kt,"EEEE",{locale:ga}),dt=sr(kt,"HH:mm"),Mt=sr(new Date(Je.fim),"HH:mm"),ce=(new Date(Je.fim)-kt)/(1e3*60),Xe=Math.floor(ce/60),Qt=ce%60;let Tt="";Xe>0?Tt=Qt>0?`${Xe}h${Qt}m`:`${Xe}h`:Tt=`${Qt}m`;const Ar=Number(Je.quadras?.valor??0),nr=ce/30,gn=(Math.round(Ar*nr*100)/100).toFixed(2).replace(".",","),tt=new Date,jr=new Date(tt);jr.setDate(tt.getDate()+1);let ua="";return kt.toDateString()===tt.toDateString()?ua="Hoje":kt.toDateString()===jr.toDateString()?ua="Amanh":ua=`${tr.charAt(0).toUpperCase()+tr.slice(1)}, ${ct}`,{label:`${ua}  ${dt}-${Mt}`,value:`editar_agendamento_${Je.id}`,icon:"",subtitle:`${Je.quadras?.nome||"Quadra"}  ${Je.modalidade||""}  ${Tt}`,agendamento:Je}});setTimeout(()=>{c("Escolha o agendamento:",ze,600)},1200)}}catch(Ke){console.error("[Isis] Erro ao buscar agendamentos:",Ke),l("Ops! Tive um problema ao buscar seus agendamentos. ",800),l("Que tal tentar fazer um novo agendamento?",1400),setTimeout(()=>{gt()},2e3)}},Yt=async Ke=>{try{console.log("[carregarAgendamentoParaEdicao] Iniciando carregamento do agendamento:",Ke.id),console.debug("[carregarAgendamentoParaEdicao] Iniciando JOIN: agendamentos  quadras, agendamento_participantes");const{data:qe,error:ze}=await re.from("agendamentos").select(`
          *,
          quadras(id, nome, descricao, modalidades, valor),
          agendamento_participantes(nome, cliente_id, ordem, is_representante)
        `).eq("id",Ke.id).single();if(console.debug("[carregarAgendamentoParaEdicao] Resultado JOIN:",{hasError:!!ze,error:ze?.message,code:ze?.code,participantes_len:Array.isArray(qe?.agendamento_participantes)?qe.agendamento_participantes.length:null}),ze)throw console.error("[Isis] Erro ao buscar agendamento:",ze),new Error(`Agendamento no encontrado ou inacessvel: ${ze.message}`);if(!qe)throw new Error("Agendamento no encontrado");const Je=new Date(qe.inicio),kt=sr(Je,"HH:mm"),ct=sr(new Date(qe.fim),"HH:mm");let tr=qe.quadras||null;if(!tr)try{const{data:Tt}=await re.from("quadras").select("id, nome, descricao, modalidades, valor").eq("id",qe.quadra_id).single();tr=Tt||null}catch{}m("quadra",tr),m("data",Je),m("horario",{inicio:kt,fim:ct,inicioDate:new Date(qe.inicio),fimDate:new Date(qe.fim)}),m("esporte",qe.modalidade);const dt=qe.cliente_id||i.cliente?.id||null;let Mt=qe.agendamento_participantes||[];if(!Mt||Mt.length===0)try{console.debug("[carregarAgendamentoParaEdicao] JOIN sem participantes. Fazendo SELECT direto em agendamento_participantes...");const{data:Tt,error:Ar}=await re.from("agendamento_participantes").select("nome, cliente_id, codigo_empresa, ordem, is_representante").eq("agendamento_id",Ke.id).order("ordem",{ascending:!0});console.debug("[carregarAgendamentoParaEdicao] SELECT direto participantes:",{hasError:!!Ar,error:Ar?.message,code:Ar?.code,count:Array.isArray(Tt)?Tt.length:null}),Array.isArray(Tt)&&Tt.length>0&&(Mt=Tt.map(nr=>({nome:nr.nome,cliente_id:nr.cliente_id,ordem:nr.ordem,is_representante:nr.is_representante})))}catch(Tt){console.debug("[carregarAgendamentoParaEdicao] Falha no SELECT direto participantes:",Tt?.message||Tt)}const ce=[...Mt].sort((Tt,Ar)=>{const nr=Number(Tt?.ordem??0),Jr=Number(Ar?.ordem??0);return Number.isFinite(nr)&&Number.isFinite(Jr)&&nr!==Jr?nr-Jr:0}),Xe=(()=>{const Tt=ce.findIndex(Ar=>!!Ar?.is_representante);if(Tt>=0)return Tt;if(dt){const Ar=ce.findIndex(nr=>nr?.cliente_id===dt);if(Ar>=0)return Ar}return 0})(),Qt=ce.map((Tt,Ar)=>({nome:Tt.nome,cliente_id:Tt.cliente_id,principal:Ar===Xe}));m("participantes",Qt);try{m("editing_agendamento",!0)}catch{}try{const Tt=qe?.meta_roles||null;if(Tt&&typeof Tt=="object"){const Ar=Array.isArray(Tt.levantadores)?Tt.levantadores:[],nr=Array.isArray(Tt.goleiros)?Tt.goleiros:[],Jr=Array.isArray(Tt.fixos)?Tt.fixos:Array.from(new Set([...Ar,...nr])),gn=Tt.fixoRoles&&typeof Tt.fixoRoles=="object"?Tt.fixoRoles:{};m("levantadores",Ar),m("goleiros",nr),m("fixos",Jr),m("fixoRoles",gn)}else{const Ar=`f7a:fixos:${qe.id}`,nr=JSON.parse(localStorage.getItem(Ar)||"null");if(nr&&typeof nr=="object"){const Jr=Array.isArray(nr.levantadores)?nr.levantadores:[],gn=Array.isArray(nr.goleiros)?nr.goleiros:[],tt=Array.isArray(nr.fixos)?nr.fixos:Array.from(new Set([...Jr,...gn])),jr=nr.fixoRoles&&typeof nr.fixoRoles=="object"?nr.fixoRoles:{};m("levantadores",Jr),m("goleiros",gn),m("fixos",tt),m("fixoRoles",jr)}}}catch{}ge(qe),l("Perfeito! Aqui esto os detalhes do seu agendamento:",600),setTimeout(()=>{const Tt={inicio:kt,fim:ct,inicioDate:new Date(qe.inicio),fimDate:new Date(qe.fim)};tr?(Ot(Tt,qe.modalidade,!0,tr,Je,Qt,qe),g("review")):(l("No consegui carregar os dados da quadra deste agendamento. Vamos escolher a quadra novamente?",800),setTimeout(()=>{const Ar=C.map(nr=>({label:nr.nome,value:nr.id,icon:"",subtitle:nr.descricao||nr.tipo||null,quadra:nr}));c("Qual quadra voc quer?",Ar,600)},1200))},1400)}catch(qe){console.error("[Isis] Erro ao carregar agendamento:",qe),qe.message.includes("no encontrado")?(l("Ops! Este agendamento no foi encontrado ou pode ter sido cancelado. ",800),l("Vou buscar seus agendamentos atualizados...",1400),setTimeout(()=>{et()},2e3)):(l("Ops! Tive um problema ao carregar o agendamento. ",800),l("Que tal tentar fazer um novo agendamento?",1400),setTimeout(()=>{gt()},2e3))}},xr=async()=>{if(!W){console.error("[Isis] Nenhum agendamento para cancelar");return}try{console.groupCollapsed("[Isis][Cancel] start"),console.log("[Isis][Cancel] agendamentoCriado:",{id:W?.id,inicio:W?.inicio,fim:W?.fim,status:W?.status,codigo_empresa:W?.codigo_empresa,empresa_id:W?.empresa_id,cliente_id:W?.cliente_id}),console.log("[Isis][Cancel] empresa:",{id:j?.id,codigo_empresa:j?.codigo_empresa,nome_fantasia:j?.nome_fantasia,razao_social:j?.razao_social,isis_display_name:j?.isis_display_name,isis_cancel_min_hours_before:j?.isis_cancel_min_hours_before,telefone:j?.telefone}),console.groupEnd(),y(!0);let qe=j?.isis_cancel_min_hours_before;if(qe==null)try{const dt=(()=>{try{return decodeURIComponent(r||"")}catch{return String(r||"")}})(),Mt=String(dt).toLowerCase().replace(/[\s\-_]+/g,"").trim();console.log("[Isis][Cancel] minHours missing. Trying RPC fallback with slug:",{slugRaw:dt,slugNorm:Mt});try{const{data:ce,error:Xe}=await re.rpc("get_empresa_public_by_isis_subdomain",{p_subdomain:Mt});if(console.log("[Isis][Cancel] rpc:get_empresa_public_by_isis_subdomain:",{hasError:!!Xe,error:Xe?.message,code:Xe?.code,len:Array.isArray(ce)?ce.length:null}),!Xe&&Array.isArray(ce)&&ce[0]){const Qt=ce[0]?.isis_cancel_min_hours_before;Qt!=null&&(qe=Qt)}}catch(ce){console.log("[Isis][Cancel] rpc subdomain threw:",ce?.message||ce)}if(qe==null)try{const{data:ce,error:Xe}=await re.rpc("get_empresa_public_by_slug",{p_slug:Mt});if(console.log("[Isis][Cancel] rpc:get_empresa_public_by_slug:",{hasError:!!Xe,error:Xe?.message,code:Xe?.code,len:Array.isArray(ce)?ce.length:null}),!Xe&&Array.isArray(ce)&&ce[0]){const Qt=ce[0]?.isis_cancel_min_hours_before;Qt!=null&&(qe=Qt)}}catch(ce){console.log("[Isis][Cancel] rpc slug threw:",ce?.message||ce)}}catch(dt){console.log("[Isis][Cancel] fallback unexpected error:",dt?.message||dt)}if(console.log("[Isis][Cancel] minHours(raw):",qe,"type:",typeof qe),qe!=null){const dt=new Date(W.inicio),Mt=new Date,ce=dt-Mt,Xe=ce/(1e3*60*60);if(console.log("[Isis][Cancel] timing:",{agendamentoInicio:dt?.toISOString?.()||String(dt),agora:Mt?.toISOString?.()||String(Mt),diffMs:ce,diffHours:Xe}),Xe<qe){console.warn("[Isis][Cancel] BLOCKED by minHours rule:",{diffHours:Xe,minHours:qe}),y(!1);const Qt=j?.telefone||"a arena",Tt=j?.isis_display_name||j?.nome_fantasia||j?.razao_social||"a arena",Ar=[` Ops! S  possvel cancelar com ${qe} hora${qe>1?"s":""} de antecedncia. Este agendamento est muito prximo.`,` Desculpe! O cancelamento s pode ser feito com ${qe} hora${qe>1?"s":""} de antecedncia. Seu agendamento j est prximo demais.`],Jr=`${Ar[Math.floor(Math.random()*Ar.length)]}

 Para mais informaes ou cancelamento de ltima hora, entre em contato diretamente com a ${Tt}: ${Qt}`;l(Jr,600),setTimeout(()=>{l("O que voc gostaria de fazer agora?",800),setTimeout(()=>{wt()},1200)},1200);return}}const ze={status:"canceled",canceled_by:"isis",canceled_at:new Date().toISOString()};console.log("[Isis][Cancel] proceeding to cancel. update payload:",ze);const{data:Je,error:kt}=await re.from("agendamentos").update(ze).eq("id",W.id);if(console.log("[Isis][Cancel] supabase update result:",{hasError:!!kt,error:kt?.message,code:kt?.code,data:Je}),kt)throw kt;y(!1);const ct=[" Agendamento cancelado com sucesso!"," Pronto! Seu agendamento foi cancelado."," Cancelamento realizado! Agendamento removido."," Feito! O agendamento foi cancelado com sucesso."],tr=ct[Math.floor(Math.random()*ct.length)];l(tr,600),ge(null),setTimeout(()=>{l("O que voc gostaria de fazer agora?",800),setTimeout(()=>{wt()},1200)},1200)}catch(Ke){console.error("[Isis] Erro ao cancelar agendamento:",Ke),y(!1);const qe=Yx("error");l(qe)}},Jt=()=>{u();const Ke=["Antes de finalizar, que tal me dar uma avaliao? ","Para finalizar, gostaria que avaliasse nosso atendimento! ","Quase pronto! Me ajuda com uma avaliao rpida? ","ltima etapa! Como foi nosso atendimento hoje? ","Para encerrar, que nota voc daria para nosso atendimento? ","Ei, que tal me contar como foi a experincia? ","Curiosa para saber: como voc avalia nosso atendimento? ","Rapidinho aqui: o que achou do nosso servio? ","Me conta a, como foi para voc hoje? ","Sua opinio  super importante! Como foi tudo? ","Sua avaliao nos ajuda a melhorar! Como foi? ","Para continuarmos evoluindo, como voc nos avalia? ","Queremos sempre melhorar! Que nota voc daria? ","Seu feedback  ouro para ns! Como foi o atendimento? ","Ajude-nos a ser ainda melhores! Qual sua avaliao? ","Espero ter te ajudado bem! Como voc me avalia? ","Fiz um bom trabalho hoje? Me conta sua opinio! ","Consegui resolver tudo certinho? Que tal uma avaliao? ","Antes de voc ir, me diz como foi nossa conversa? ","Sua experincia foi boa? Adoraria saber! ","Obrigada pela confiana! Como foi para voc? ","Foi um prazer te atender! Que nota voc daria? ","Agradeo pela pacincia! Como avalia nosso servio? ","Muito obrigada! Me conta como foi tudo? ","Pode ser sincero(a)! Como foi o atendimento? ","Sem papas na lngua: que nota voc daria? ","Honestamente, como voc nos avalia? ","Sua opinio real  importante! Como foi? ","Para finalizar o atendimento, preciso da sua avaliao! ","Processo quase concludo! Falta s sua avaliao! ","ltima etapa do nosso protocolo: sua opinio! ","Para encerrar com chave de ouro: como nos avalia? "],qe=Ke[Math.floor(Math.random()*Ke.length)];l(qe,800),setTimeout(()=>{z(!0),g("avaliacao"),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1200)},kr=async Ke=>{try{const qe=Array.isArray(_)?[..._]:[],ze=`${Ke.rating} estrela${Ke.rating>1?"s":""}`,Je=Ke.comentario?` ${ze}
 "${Ke.comentario}"`:` ${ze}`;d(Je),z(!1),y(!0);const kt=qe.map(Xe=>({ts:Xe.timestamp instanceof Date?Xe.timestamp.toISOString():new Date(Xe.timestamp||Date.now()).toISOString(),from:Xe.from==="isis"?"assistant":"user",text:String(Xe.text??"")}));let ct=-1;for(let Xe=kt.length-1;Xe>=0;Xe--)if(kt[Xe].from==="assistant"){ct=Xe;break}const tr=ct>=0?kt.slice(0,ct+1):kt;await Clt({rating:Number(Ke.rating),comentario:Ke.comentario||null,cliente_codigo:i?.cliente?.codigo??null,cliente_nome:i?.cliente?.nome||i?.cliente?.name||null,empresa_nome:j?.nome_fantasia||j?.razao_social||"Desconhecida",sessionId:w,conversaArray:tr}),y(!1);const dt=new Date().getHours();let Mt;dt>=5&&dt<12?Mt="Tenha um timo dia! ":dt>=12&&dt<18?Mt="Tenha uma tima tarde! ":dt>=18&&dt<22?Mt="Tenha uma tima noite! ":Mt="Tenha uma boa noite! ";let ce;if(Ke.rating>=4){const Xe=[` **Muito obrigada pela avaliao!** A **${ue}** agradece imensamente! Foi um prazer te atender! ${Mt}`,` **Que bom que gostou!** A **${ue}** fica muito feliz! Volte sempre! ${Mt}`,` **Perfeito!** A **${ue}** agradece de corao! Espero ter ajudado! ${Mt}`,` **Adorei seu feedback!** A **${ue}** est muito grata! Nos vemos em breve! ${Mt}`,` **Excelente!** A **${ue}** agradece pela confiana! At a prxima! ${Mt}`,` **Uau, que nota incrvel!** A **${ue}** est nas nuvens! Obrigada! ${Mt}`,` **Voc  demais!** A **${ue}** adora clientes como voc! ${Mt}`,` **Top demais!** A **${ue}** se sente campe com seu feedback! ${Mt}`,` **Que alegria!** A **${ue}** fica radiante com sua avaliao! ${Mt}`,` **Sensacional!** A **${ue}** est celebrando sua nota! ${Mt}`,` **Amei sua avaliao!** Fico feliz em saber que te atendi bem! A **${ue}** agradece! ${Mt}`,` **Que feedback maravilhoso!** Me deixou super feliz! A **${ue}**  grata! ${Mt}`,` **Seu carinho me emociona!** A **${ue}** tem sorte de ter voc! ${Mt}`,` **Voc iluminou meu dia!** A **${ue}** agradece de todo corao! ${Mt}`,` **Nota mxima!** A **${ue}** te espera sempre de braos abertos! ${Mt}`,` **Cliente 5 estrelas!** A **${ue}** adora te ter aqui! Volte logo! ${Mt}`,` **Voc  especial!** A **${ue}** sempre ter um lugar especial para voc! ${Mt}`,` **Show de avaliao!** A **${ue}** te aguarda para a prxima apresentao! ${Mt}`];ce=Xe[Math.floor(Math.random()*Xe.length)]}else if(Ke.rating===3){const Xe=[` **Obrigada pelo feedback!** A **${ue}** vai melhorar ainda mais! ${Mt}`,` **Agradecemos sua avaliao!** A **${ue}** est trabalhando para evoluir! ${Mt}`,` **Obrigada!** A **${ue}** valoriza seu retorno! Foi um prazer te atender! ${Mt}`,` **Toda avaliao nos faz crescer!** A **${ue}** agradece sua sinceridade! ${Mt}`,` **Feedback valioso!** A **${ue}** usa cada retorno para evoluir! ${Mt}`,` **Obrigada pela nota!** A **${ue}** est sempre buscando melhorar! ${Mt}`,` **Seu retorno  importante!** A **${ue}** vai usar para aprimorar nosso servio! ${Mt}`,` **Agradecemos a oportunidade!** A **${ue}** espera te surpreender na prxima! ${Mt}`,` **Obrigada pela dica!** A **${ue}** vai trabalhar para te conquistar! ${Mt}`,` **Toda crtica construtiva  bem-vinda!** A **${ue}** agradece! ${Mt}`];ce=Xe[Math.floor(Math.random()*Xe.length)]}else{const Xe=[` **Obrigada pela sinceridade.** A **${ue}** vai trabalhar para melhorar! ${Mt}`,` **Agradecemos seu feedback.** A **${ue}** est comprometida em evoluir! ${Mt}`,` **Obrigada por compartilhar.** A **${ue}** vai usar seu retorno para melhorar! ${Mt}`,` **Lamentamos no ter atendido suas expectativas.** A **${ue}** vai se esforar mais! ${Mt}`,` **Sentimos muito pela experincia.** A **${ue}** levar isso muito a srio! ${Mt}`,` **Assumimos a responsabilidade.** A **${ue}** vai fazer melhor da prxima vez! ${Mt}`,` **Sua insatisfao nos preocupa.** A **${ue}** vai revisar todos os processos! ${Mt}`,` **Obrigada pelo alerta!** A **${ue}** espera uma nova chance de te impressionar! ${Mt}`,` **Vamos melhorar!** A **${ue}** promete que da prxima vez ser diferente! ${Mt}`,` **Seu feedback  nosso combustvel!** A **${ue}** vai usar para crescer! ${Mt}`,` **J estamos trabalhando nas melhorias!** A **${ue}** agradece sua pacincia! ${Mt}`,` **Sua honestidade  valiosa!** A **${ue}** prefere a verdade para evoluir! ${Mt}`,` **Crticas nos fazem crescer!** A **${ue}** agradece sua coragem de falar! ${Mt}`];ce=Xe[Math.floor(Math.random()*Xe.length)]}l(ce,600),setTimeout(()=>{l("Atendimento finalizado.",0,"system")},1200)}catch(qe){console.error("[Isis] Erro ao enviar avaliao:",qe),y(!1);const ze=new Date().getHours();let Je;ze>=5&&ze<12?Je="Tenha um timo dia! ":ze>=12&&ze<18?Je="Tenha uma tima tarde! ":ze>=18&&ze<22?Je="Tenha uma tima noite! ":Je="Tenha uma boa noite! ";const kt=[`Ops! Tive um problema ao salvar sua avaliao, mas a **${ue}** agradece muito seu feedback! ${Je}`,` No consegui salvar sua avaliao, mas a **${ue}** agradece imensamente! ${Je}`,` Deu uma travadinha aqui, mas sua opinio j ficou guardada no meu corao! A **${ue}** agradece! ${Je}`,` Ops, falhei na tecnologia, mas no falhei em te ouvir! A **${ue}** valoriza seu feedback! ${Je}`,` Parece que o sistema deu soluo, mas sua avaliao foi ouvida! A **${ue}** agradece! ${Je}`,` A internet no colaborou, mas sua opinio chegou at mim! A **${ue}**  grata! ${Je}`,` Problema tcnico aqui, mas o importante  que voc compartilhou! A **${ue}** agradece! ${Je}`,` O sistema travou, mas sua avaliao no passou despercebida! A **${ue}** valoriza! ${Je}`],ct=kt[Math.floor(Math.random()*kt.length)];l(ct,600),setTimeout(()=>{l("Atendimento finalizado.",0,"system")},1200)}},_r=async()=>{if(!W){console.error("[Isis] Nenhum agendamento para atualizar");return}try{y(!0);const Ke=i.cliente,qe=i.participantes||[],{data:ze}=await re.from("clientes").select("id").eq("codigo_empresa",n).eq("is_consumidor_final",!0).single(),Je=qe.find(Ht=>Ht.principal),kt=qe.filter(Ht=>!Ht.principal),ct=Je?[Je,...kt]:qe,tr=ct.map(Ht=>Ht.nome),dt=Je?.cliente_id||Ke?.id||null,[Mt,ce]=i.horario.inicio.split(":").map(Number),[Xe,Qt]=i.horario.fim.split(":").map(Number);let Tt=Xe*60+Qt-(Mt*60+ce);Xe===0&&Qt===0&&(Tt=24*60-(Mt*60+ce));const Ar=i.quadra.valor||0,nr=Tt/30,Jr=Math.round(Ar*nr*100)/100,gn={levantadores:Array.isArray(i.levantadores)?i.levantadores:[],goleiros:Array.isArray(i.goleiros)?i.goleiros:[],fixos:Array.isArray(i.fixos)?i.fixos:[],fixoRoles:i.fixoRoles&&typeof i.fixoRoles=="object"?i.fixoRoles:{}},{data:tt,error:jr}=await re.from("agendamentos").update({quadra_id:i.quadra.id,cliente_id:dt,clientes:tr,inicio:i.horario.inicioDate.toISOString(),fim:i.horario.fimDate.toISOString(),modalidade:i.esporte,valor_total:Jr,meta_roles:gn}).eq("id",W.id).select().single();if(jr)throw jr;const{error:ua}=await re.from("agendamento_participantes").delete().eq("agendamento_id",W.id);if(ua)throw ua;const Oe=ct.map((Ht,mr)=>({agendamento_id:tt.id,codigo_empresa:n,cliente_id:Ht.cliente_id||(Ht.principal?Ke.id:ze?.id||null),nome:Ht.nome,valor_cota:0,status_pagamento:"Pendente",ordem:mr+1,is_representante:mr===0})),{error:Wt}=await re.from("agendamento_participantes").insert(Oe);if(Wt)throw Wt;y(!1),ge(tt);try{const Ht=`f7a:fixos:${tt.id}`,mr={levantadores:i.levantadores||[],goleiros:i.goleiros||[],fixos:i.fixos||[],fixoRoles:i.fixoRoles||{}};localStorage.setItem(Ht,JSON.stringify(mr))}catch{}Cr(tt,!0),g("confirmation")}catch(Ke){console.error("[Isis] Erro ao atualizar agendamento:",Ke),y(!1);const qe=Yx("error");l(qe)}},Rr=async()=>{try{y(!0);const Ke=await nt();if(!Ke?.ok)throw new Error("No foi possvel validar disponibilidade do horrio");if(Ke?.conflito){y(!1),z(!1);try{m("horario",null)}catch{}try{m("esporte",null)}catch{}try{L(null)}catch{}Ke?.motivo==="fechada"?l(`**Ops!** Parece que este dia ficou **indisponvel** agora. 

Vamos escolher outra data?`,800):l(`**Ops!** Algum acabou de reservar esse horrio antes de voc. 

Vamos escolher outra data?`,800),setTimeout(()=>{Ze()},900);return}const qe=i.cliente,ze=i.participantes||[],{data:Je}=await re.from("clientes").select("id").eq("codigo_empresa",n).eq("is_consumidor_final",!0).single(),kt=ze.find(jt=>jt.principal),ct=ze.filter(jt=>!jt.principal),tr=kt?[kt,...ct]:ze,dt=tr.map(jt=>jt.nome),Mt=kt?.cliente_id||qe?.id||null,[ce,Xe]=i.horario.inicio.split(":").map(Number),[Qt,Tt]=i.horario.fim.split(":").map(Number);let Ar=Qt*60+Tt-(ce*60+Xe);Qt===0&&Tt===0&&(Ar=24*60-(ce*60+Xe));const nr=i.quadra.valor||0,Jr=Ar/30,gn=Math.round(nr*Jr*100)/100,tt={levantadores:Array.isArray(i.levantadores)?i.levantadores:[],goleiros:Array.isArray(i.goleiros)?i.goleiros:[],fixos:Array.isArray(i.fixos)?i.fixos:[],fixoRoles:i.fixoRoles&&typeof i.fixoRoles=="object"?i.fixoRoles:{}};let jr=null;try{const jt=String(w||"").trim();/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(jt)&&(jr=jt)}catch{}const{data:ua}=await re.from("agendamentos").select("codigo").eq("codigo_empresa",n).order("codigo",{ascending:!1}).limit(1).single();let Oe=ua?ua.codigo+1:1;console.log("[criarAgendamento] ltimo cdigo usado:",ua?.codigo),console.log("[criarAgendamento] Prximo cdigo inicial:",Oe);let Wt,Ht=0;const mr=10;for(;!Wt&&Ht<mr;){Ht++,console.log("[criarAgendamento] Tentativa",Ht,"com cdigo:",Oe);const jt={codigo:Oe,codigo_empresa:n,quadra_id:i.quadra.id,cliente_id:Mt,clientes:dt,inicio:i.horario.inicioDate.toISOString(),fim:i.horario.fimDate.toISOString(),modalidade:i.esporte,status:"scheduled",valor_total:gn,meta_roles:tt,created_by_isis:!0};if(jr)try{const{data:Dt}=await re.from("isis_chat_sessions").select("id").eq("id",jr).single();Dt?.id&&(jt.isis_session_id=jr)}catch{}const{data:ur,error:rt}=await re.from("agendamentos").insert(jt).select("id, codigo").single();if(rt)if(rt.code==="23505")console.log("[criarAgendamento] Cdigo",Oe,"j existe, tentando prximo..."),Oe++;else throw rt;else Wt=ur,console.log("[criarAgendamento] Agendamento criado com cdigo:",Wt.codigo)}if(!Wt)throw new Error("No foi possvel gerar um cdigo nico aps "+mr+" tentativas");try{const{data:jt}=await re.from("empresas").select("id").eq("codigo_empresa",n).single();jt&&(await re.from("empresa_counters").update({next_agendamento_codigo:Wt.codigo+1}).eq("empresa_id",jt.id),console.log("[criarAgendamento] Counter atualizado para:",Wt.codigo+1))}catch(jt){console.warn("[criarAgendamento] Erro ao atualizar counter:",jt)}const Gt=tr.map((jt,ur)=>({codigo_empresa:n,agendamento_id:Wt.id,cliente_id:jt.cliente_id||(jt.principal?qe.id:Je?.id||null),nome:jt.nome,valor_cota:0,status_pagamento:"Pendente",ordem:ur+1,is_representante:ur===0})),{error:pn}=await re.from("agendamento_participantes").insert(Gt);if(pn)throw pn;y(!1),ge(Wt);try{const jt=`f7a:fixos:${Wt.id}`,ur={levantadores:i.levantadores||[],goleiros:i.goleiros||[],fixos:i.fixos||[],fixoRoles:i.fixoRoles||{}};localStorage.setItem(jt,JSON.stringify(ur))}catch{}Cr(Wt),g("confirmation")}catch(Ke){console.error("[Isis] Erro ao criar agendamento:",Ke),y(!1);const qe=Yx("error");l(qe),Pj({title:"Erro ao criar agendamento",description:Ke.message||"Tente novamente",variant:"destructive"})}},nn=(Ke,qe)=>{if(u(),qe)try{h(qe)}catch{}switch(o){case"quadra":Pt(Ke);break;case"data":{if((Ke?.value||"").toString()==="mudar_quadra"){try{z(!1);const Je=(C||[]).map(kt=>({label:kt.nome,value:kt.id,icon:"",subtitle:kt.descricao||kt.tipo||null,quadra:kt}));Je.length>0&&(c("Qual quadra voc quer?",Je,400),g("quadra"))}catch{}break}Lt(Ke)}break;case"identificacao":Qe(Ke);break;case"review":Qe(Ke);break;case"confirmation":Qe(Ke);break;case"confirmar_cliente_existente":{const ze=(Ke?.value||"").toString();if(ze==="confirm_cliente_existente"){const Je=i?.cliente_sugerido||null;if(Je){m("cliente",Je),m("cliente_sugerido",null);const kt=De(Je.nome||"");l(`Perfeito, **${kt}**! `,300),z(!1),setTimeout(()=>{try{wt()}catch{}},700)}else z(!0),g("identificacao")}else ze==="corrigir_cadastro"&&(l("Sem problemas! Vamos corrigir seus dados. ",300),z(!0),g("cadastro"));break}default:console.warn("[Isis] Nenhum handler para step:",o)}},rn=()=>B?o==="participantes"||o==="review"&&B&&U==="participantes"?a.jsx(_lt,{participantesAtuais:i.participantes||[],onAdicionar:$t,onRemover:Fe,onFinalizar:xt,onAdicionarLote:Ut,selfName:i.cliente?.nome,initialModalidade:i.esporte||"",modalidadeOptions:Array.isArray(i.quadra?.modalidades)&&i.quadra.modalidades.length>0?i.quadra.modalidades:i.esporte?[i.esporte]:[],onFixedRolesDetected:Ke=>{try{const qe=Array.isArray(Ke?.levantadores)?Ke.levantadores:[],ze=Array.isArray(Ke?.goleiros)?Ke.goleiros:[],Je=tr=>String(tr||"").trim().toLowerCase(),kt=Array.from(new Set([...qe,...ze])),ct={};qe.forEach(tr=>{ct[Je(tr)]="Levantador"}),ze.forEach(tr=>{ct[Je(tr)]="Goleiro"}),m("levantadores",qe),m("goleiros",ze),m("fixos",kt),m("fixoRoles",ct),W?.id&&(async()=>{try{const tr={levantadores:qe,goleiros:ze,fixos:kt,fixoRoles:ct};await re.from("agendamentos").update({meta_roles:tr}).eq("id",W.id)}catch(tr){console.debug("[Isis] Falha ao persistir meta_roles imediatos:",tr?.message||tr)}})()}catch{}}}):o==="identificacao"||T==="data_custom"?a.jsx(blt,{tipo:T,onSubmit:ie,onTrocarTipo:()=>{k(T==="telefone"?"email":"telefone")}}):o==="cadastro"?a.jsx(wlt,{onSubmit:ht,valorInicial:i.identificacao_valor,tipoInicial:i.identificacao_tipo||"telefone",onCorrigirTelefone:()=>{try{l("Sem problemas! Informe seu telefone novamente:",400)}catch{}m("cliente",null),m("identificacao_valor",null),k("telefone"),g("identificacao"),z(!0)},onCorrigirEmail:()=>{try{l("Sem problemas! Informe seu e-mail novamente:",400)}catch{}m("cliente",null),m("identificacao_valor",null),k("email"),g("identificacao"),z(!0)}}):o==="horario"||o==="review"&&B&&U==="horario"?a.jsx(ylt,{onSubmit:je,onMudarData:vt,onMudarQuadra:()=>{try{z(!1),L("horario"),g("review");const Ke=(C||[]).map(qe=>({label:qe.nome,value:qe.id,icon:"",subtitle:qe.descricao||qe.tipo||null,quadra:qe}));Ke.length>0&&c("Qual quadra voc quer?",Ke,600)}catch{}},hasMultipleQuadras:(C||[]).length>1,horariosDisponiveis:P,esportes:i.quadra?.modalidades||[]}):o==="avaliacao"?a.jsx(jlt,{onSubmit:kr}):null:null;return r?O?a.jsx(Nlt,{message:"Preparando sua experincia..."}):j?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(Er.header,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5},className:"bg-surface/70 backdrop-blur-xl border-b border-white/10 sticky top-0 z-20 shadow-lg",children:a.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-3 md:py-4 flex items-center justify-between gap-3 md:gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[a.jsxs("div",{className:"relative group",children:[a.jsx("div",{className:"transition-all duration-300 group-hover:scale-105",children:a.jsx(Hi,{size:"md",variant:"header",className:"md:w-20 md:h-20"})}),a.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 md:w-4 md:h-4 bg-success rounded-full border-2 border-surface"})]}),a.jsxs("div",{className:"flex flex-col gap-0.5 md:gap-1",children:[a.jsx("h1",{className:"font-bold text-text-primary text-lg md:text-2xl tracking-tight leading-none",children:"sis"}),a.jsxs("div",{className:"relative group w-fit",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 blur-md opacity-60 group-hover:opacity-100 animate-pulse rounded-md"}),a.jsxs("div",{className:"relative px-2 py-0.5 md:px-2.5 md:py-1 bg-gradient-to-r from-cyan-500/20 via-purple-500/20 to-pink-500/20 backdrop-blur-sm border border-cyan-500/50 rounded-md flex items-center gap-1 md:gap-1.5 shadow-lg",children:[a.jsxs("svg",{className:"w-2.5 h-2.5 md:w-3 md:h-3 text-cyan-400",fill:"currentColor",viewBox:"0 0 20 20",children:[a.jsx("path",{d:"M13 7H7v6h6V7z"}),a.jsx("path",{fillRule:"evenodd",d:"M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z",clipRule:"evenodd"})]}),a.jsx("span",{className:"text-[9px] md:text-[10px] font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"chat"}),a.jsxs("div",{className:"hidden md:flex gap-0.5",children:[a.jsx("span",{className:"w-1 h-1 bg-cyan-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),a.jsx("span",{className:"w-1 h-1 bg-purple-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),a.jsx("span",{className:"w-1 h-1 bg-pink-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]})]})]})]}),a.jsx("div",{className:"flex flex-1 justify-end md:justify-center",children:a.jsxs("div",{className:"group relative",children:[a.jsx("div",{className:"hidden md:block absolute inset-0 bg-gradient-to-r from-brand/20 via-brand/10 to-brand/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),a.jsxs("div",{className:"relative flex items-center gap-2.5 md:gap-3 px-4 py-2 md:px-5 md:py-2.5 bg-gradient-to-r from-surface via-surface-2 to-surface backdrop-blur-sm rounded-lg md:rounded-xl border border-brand/20 shadow-md md:shadow-lg",children:[a.jsxs("div",{className:"relative w-9 h-9 md:w-10 md:h-10 shrink-0 overflow-hidden rounded-lg border border-white/10 bg-surface-2/60 grid place-items-center shadow-[0_0_0_3px_RGBA(0,0,0,0.2)] group-hover:border-white/20 transition-colors duration-300",children:[ve?a.jsx("img",{src:ve,alt:"Logo da empresa",className:"w-full h-full object-cover",onError:Ke=>{Ke.target.style.display="none",Ke.target.nextSibling.style.display="block"}}):null,a.jsx(hN,{className:`w-5 h-5 md:w-6 md:h-6 opacity-80 ${ve?"hidden":"block"}`,strokeWidth:2})]}),a.jsx("h2",{className:"text-sm md:text-base font-bold text-text-primary tracking-wide truncate max-w-[140px] md:max-w-none",children:ue})]})]})}),a.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-brand rounded-xl flex items-center justify-center flex-shrink-0",children:a.jsx(sd,{className:"w-7 h-7 text-primary-foreground"})}),a.jsxs("div",{className:"hidden lg:flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})]})}),a.jsx("div",{className:"container mx-auto max-w-5xl pb-6 md:pb-6 mb-12 md:mb-0",children:a.jsx(vlt,{onButtonClick:nn,hideButtonTexts:o==="avaliacao",children:rn()})}),a.jsx(Er.footer,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.3},className:"md:hidden fixed bottom-0 left-0 right-0 bg-surface/90 backdrop-blur-xl border-t border-white/10 z-20 shadow-lg",children:a.jsx("div",{className:"flex items-center justify-center py-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-6 h-6 bg-brand rounded-lg flex items-center justify-center",children:a.jsx(sd,{className:"w-4 h-4 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-sm",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-sm",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-sm",style:{color:"#B0B0B0"},children:" Arena"})]})]})})})]}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-2xl",children:[a.jsx(Er.div,{className:"mb-8 flex justify-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},children:a.jsxs("div",{className:"relative",children:[a.jsx(Hi,{size:"xl",variant:"header"}),a.jsx(Er.div,{className:"absolute inset-0 rounded-full border-4 border-brand/30",animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0}})]})}),a.jsxs(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"space-y-6",children:[a.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-text-primary mb-4",children:[ae(),"! Tentando Agendar? "]}),a.jsxs("div",{className:"bg-surface/70 backdrop-blur-sm border border-white/10 rounded-2xl p-8 shadow-xl",children:[a.jsxs("p",{className:"text-xl text-text-primary mb-6 leading-relaxed",children:["Entre em contato com o dono da quadra e solicite o ",a.jsx("strong",{children:"link de agendamento"}),"."]}),a.jsxs("div",{className:"bg-surface-2/50 border border-white/5 rounded-xl p-6 mb-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-text-primary mb-3 flex items-center gap-2",children:[a.jsx(vG,{className:"w-5 h-5 text-brand"}),"Formato do Link"]}),a.jsxs("div",{className:"bg-background/60 border border-white/10 rounded-lg p-4 font-mono text-base md:text-lg",children:[a.jsx("span",{className:"text-brand font-bold",children:"nomedaempresa"}),a.jsx("span",{className:"text-text-muted",children:".f7arena.com"})]}),a.jsx("p",{className:"mt-2 text-xs text-text-muted",children:"(sem traos)"})]})]})]}),a.jsx(Er.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},className:"mt-12 flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(sd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})})]})}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-2xl",children:[a.jsx(Er.div,{className:"mb-8 flex justify-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},children:a.jsxs("div",{className:"relative",children:[a.jsx(Hi,{size:"xl",variant:"header"}),a.jsx(Er.div,{className:"absolute inset-0 rounded-full border-4 border-brand/30",animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0}})]})}),a.jsxs(Er.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"space-y-6",children:[a.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-text-primary mb-4",children:[ae(),"! Tentando Agendar?"]}),a.jsx("div",{className:"bg-surface/70 backdrop-blur-sm border border-white/10 rounded-2xl p-8 shadow-xl",children:a.jsx("p",{className:"text-xl text-text-primary mb-4 leading-relaxed",children:"Entre em contato com o dono da quadra e solicite o link de agendamento."})})]}),a.jsx(Er.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},className:"mt-12 flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(sd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})})]})})};function LV(){return a.jsx(Roe,{children:a.jsx(QY,{children:a.jsx(Plt,{children:a.jsx(Alt,{})})})})}function Plt({children:e}){const{selections:t}=l5(),[r,n]=Ee.useState({name:"",phone:"",source:"init"});return Ee.useEffect(()=>{const s=()=>{try{const c=t?.empresa||null;if(c){const d=c.isis_display_name||c.nome_fantasia||c.razao_social||c.nome||"",u=c.telefone||"";if(d||u)return{name:d,phone:u}}}catch{}return null},o=()=>{try{const c=window.location.host||"",d=window.location.pathname||"",u="f7arena.com";if(c.endsWith(u)){const h=c.slice(0,-u.length).replace(/\.$/,"").toLowerCase();if(h&&h!=="www")return h}const f=d.match(/\/agendar\/([^\/?#]+)/i);if(f&&f[1])return decodeURIComponent(f[1])}catch{}return null},i=s();if(i){try{console.info("[IsisError][Meta] Using context data",{name:!!i.name,phone:!!i.phone})}catch{}n({name:i.name,phone:i.phone,source:"context"});return}const l=o();if(!l){try{console.warn("[IsisError][Meta] No slug inferred from URL")}catch{}n(c=>c.name||c.phone?c:{name:"",phone:"",source:"none"});return}(async()=>{try{try{console.info("[IsisError][Meta] Start fetch by slug",{slug:l})}catch{}const c=String(l||"").toLowerCase().replace(/[\s\-_]+/g,"").trim();let d="",u="",f="";try{const{data:g,error:y}=await re.rpc("get_empresa_public_by_slug",{p_slug:c});if(!y&&Array.isArray(g)&&g.length>0){const v=g[0]||{};d=v.isis_display_name||v.nome_fantasia||v.razao_social||v.nome||"",v.telefone&&(u=v.telefone,f="rpc.telefone");try{console.info("[IsisError][Meta] RPC result",{hasName:!!d,phoneSource:f,hasPhone:!!u})}catch{}}}catch{}if(!d||!u)try{const{data:g}=await re.from("agenda_settings").select("isis_display_name, empresas(nome_fantasia, razao_social, nome, telefone)").eq("isis_subdomain",c).single(),y=g?.empresas||{};d=d||g?.isis_display_name||y?.nome_fantasia||y?.razao_social||y?.nome||"",!u&&y?.telefone&&(u=y.telefone,f="settings.telefone");try{console.info("[IsisError][Meta] Settings result",{hasName:!!d,phoneSource:f,hasPhone:!!u})}catch{}}catch{}const m=d||(g=>{try{return String(g||"").replace(/[\s_\-]+/g," ").trim().split(" ").filter(Boolean).map(v=>v.charAt(0).toUpperCase()+v.slice(1).toLowerCase()).join(" ")}catch{return g}})(l),x=u||"";try{console.info("[IsisError][Meta] Final",{finalName:m,hasPhone:!!x,phoneSource:f||"none"})}catch{}n({name:m,phone:x,source:f||"computed"})}catch(c){try{console.error("[IsisError][Meta] Exception during meta fetch",c)}catch{}n({name:l,phone:"",source:"error"})}})()},[t?.empresa]),a.jsx(Roe,{companyName:r.name,companyPhone:r.phone,children:e})}class Roe extends Ee.Component{constructor(t){super(t),this.state={hasError:!1,companyName:"",companyPhone:""}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,r){try{console.error("[Isis] Uncaught error:",t,r)}catch{}(!this.props.companyName||!this.props.companyPhone)&&(async()=>{try{const n=()=>{try{const d=typeof window<"u"&&window.location.host||"",u=typeof window<"u"&&window.location.pathname||"",f="f7arena.com";if(d&&d.endsWith(f)){const m=d.slice(0,-f.length).replace(/\.$/,"").toLowerCase();if(m&&m!=="www")return m}const h=u.match(/\/agendar\/([^\/?#]+)/i);if(h&&h[1])return decodeURIComponent(h[1])}catch{}return null},s=d=>{try{return String(d||"").replace(/[\s_\-]+/g," ").trim().split(" ").filter(Boolean).map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" ")}catch{return d}},o=n();if(!o)return;const i=String(o).toLowerCase().replace(/[\s\-_]+/g,"").trim();let l="",c="";try{const{data:d,error:u}=await re.rpc("get_empresa_public_by_slug",{p_slug:i});if(!u&&Array.isArray(d)&&d.length>0){const f=d[0]||{};l=f.isis_display_name||f.nome_fantasia||f.razao_social||f.nome||"",f.telefone&&(c=f.telefone);try{console.info("[IsisError][Outer] RPC",{hasName:!!l,hasPhone:!!c})}catch{}}}catch{}if(!l||!c)try{const{data:d}=await re.from("agenda_settings").select("isis_display_name, empresas(nome_fantasia, razao_social, nome, telefone)").eq("isis_subdomain",i).single(),u=d?.empresas||{};l=l||d?.isis_display_name||u?.nome_fantasia||u?.razao_social||u?.nome||"",!c&&u?.telefone&&(c=u.telefone);try{console.info("[IsisError][Outer] Settings",{hasName:!!l,hasPhone:!!c})}catch{}}catch{}this.setState({companyName:l||s(o),companyPhone:c||""})}catch(n){try{console.error("[IsisError][Outer] meta fetch failed",n)}catch{}}})()}render(){if(this.state.hasError){try{console.info("[IsisError][Render] Props",{companyName:this.props.companyName,companyPhone:this.props.companyPhone})}catch{}const t=()=>{try{const i=typeof window<"u"&&window.location.host||"",l=typeof window<"u"&&window.location.pathname||"",c="f7arena.com";if(i&&i.endsWith(c)){const u=i.slice(0,-c.length).replace(/\.$/,"").toLowerCase();if(u&&u!=="www")return u}const d=l.match(/\/agendar\/([^\/?#]+)/i);if(d&&d[1])return decodeURIComponent(d[1])}catch{}return null},r=i=>{try{const l=String(i||"").replace(/\D/g,"");return l.length>=11?`(${l.slice(0,2)}) ${l.slice(2,7)}-${l.slice(7,11)}`:l.length>=10?`(${l.slice(0,2)}) ${l.slice(2,6)}-${l.slice(6,10)}`:i||""}catch{return i||""}},n=t(),s=this.props.companyName||this.state.companyName||n||"a arena",o=r(this.props.companyPhone||this.state.companyPhone||"");return a.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background text-text-primary p-6",children:a.jsxs("div",{className:"w-full max-w-xl mx-auto rounded-3xl border border-white/10 bg-surface/80 backdrop-blur-md shadow-2xl p-8 text-center",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx(Hi,{size:"xl"})}),a.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight mb-3",children:" Ops, ocorreu um erro!"}),a.jsxs("p",{className:"text-base md:text-lg opacity-90 leading-relaxed mb-3",children:["Pode ser um ",a.jsx("span",{className:"font-semibold",children:"problema no seu dispositivo"})," ou na sua ",a.jsx("span",{className:"font-semibold",children:"conexo de rede"}),"."]}),a.jsxs("p",{className:"text-base md:text-lg opacity-90 leading-relaxed mb-6",children:[a.jsx("span",{className:"font-semibold",children:"Tente novamente"}),", experimente ",a.jsx("span",{className:"font-semibold",children:"outro navegador"})," ou ",a.jsx("span",{className:"font-semibold",children:"outra rede"}),"."]}),a.jsxs("p",{className:"text-base md:text-lg leading-relaxed mb-6",children:["Se persistir, ",a.jsx("span",{className:"font-semibold",children:"entre em contato"})," com ",a.jsx("span",{className:"font-semibold",children:s}),o?a.jsxs(a.Fragment,{children:[" ","pelo nmero ",a.jsx("span",{className:"font-semibold font-mono",children:o}),"."]}):"."]}),a.jsx("div",{className:"flex items-center justify-center gap-3",children:a.jsx("button",{onClick:()=>{try{window.location.reload()}catch{}},className:"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-brand text-bg font-semibold shadow-lg shadow-brand/20 hover:shadow-xl hover:shadow-brand/30 transition-all",children:" Recarregar pgina"})})]})})}return this.props.children}}const Foe=!1,Elt="",klt="Estamos em manuteno no momento. Voltaremos em breve.",$V="f740028922";function BV(e){try{return sr(e,"EEE, d 'de' MMM 's' HH:mm",{locale:ga})}catch{return""}}function qV(){const e=wi(),t=hl(),r=!!Foe||typeof window<"u"&&localStorage.getItem("maintenance:active")==="true",[n,s]=p.useState(""),[o,i]=p.useState("");p.useEffect(()=>{try{s(localStorage.getItem("maintenance:end")||""),i(localStorage.getItem("maintenance:message")||"");const f=h=>{h.key==="maintenance:end"&&s(h.newValue||""),h.key==="maintenance:message"&&i(h.newValue||"")};return window.addEventListener("storage",f),()=>window.removeEventListener("storage",f)}catch{}},[]);const l=n||Elt||{}.VITE_MAINTENANCE_END||"",c=o&&o.trim()?o:klt,d=p.useMemo(()=>{if(!l)return null;const f=new Date(l);return isNaN(f.getTime())?null:f},[l]),u=p.useMemo(()=>c?.trim()?c:d?`Estamos em manuteno e voltaremos at ${BV(d)}.`:"Estamos em manuteno no momento. Voltaremos em breve.",[c,d]);return p.useEffect(()=>{try{window.f7MaintenanceBypass=f=>{const h=String(f||"")===$V;if(h){try{localStorage.setItem("maintenance:bypass","1")}catch{}try{sessionStorage.setItem("maintenance:bypass","1")}catch{}try{document.cookie="fx_maint_bypass=1; path=/; max-age=2592000"}catch{}try{sessionStorage.removeItem("auth:returnUrl")}catch{}t("/login",{replace:!0})}else console.warn("[Maintenance] Senha invlida.");return h},window.f7MaintenanceReset=()=>{try{localStorage.removeItem("maintenance:bypass")}catch{}console.info("[Maintenance] Bypass removido.")}}catch{}},[t]),p.useEffect(()=>{const h=String(e.pathname||"").split("/").filter(Boolean),m=h[h.length-1]||"",x=new URLSearchParams(e.search||""),y=x.get("senha")||x.get("pwd")||x.get("code")||""||m;if(y&&y===$V){try{localStorage.setItem("maintenance:bypass","1")}catch{}try{sessionStorage.setItem("maintenance:bypass","1")}catch{}try{document.cookie="fx_maint_bypass=1; path=/; max-age=2592000"}catch{}try{sessionStorage.removeItem("auth:returnUrl")}catch{}t("/login",{replace:!0})}},[e,t]),a.jsxs("div",{className:"min-h-screen relative overflow-hidden bg-gradient-to-b from-[#0f1324] via-[#0b0f1c] to-[#070a14] text-white",children:[a.jsx("div",{className:"pointer-events-none absolute -top-40 left-1/2 -translate-x-1/2 w-[90rem] h-[90rem] rounded-full opacity-30 blur-3xl",style:{background:"radial-gradient(50% 50% at 50% 50%, rgba(76,110,245,0.45) 0%, rgba(76,110,245,0.18) 40%, rgba(0,0,0,0) 70%)"}}),a.jsxs("div",{className:"relative z-10 mx-auto max-w-4xl px-6 py-16 md:py-24",children:[a.jsxs("div",{className:"mx-auto max-w-3xl rounded-3xl border border-white/10 bg-white/[0.02] backdrop-blur-xl shadow-[0_0_60px_-10px_rgba(76,110,245,0.5)] p-6 md:p-10",children:[a.jsx("div",{className:"text-center mb-8",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"w-16 h-16 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(sd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-5xl font-extrabold",children:[a.jsx("span",{style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{style:{color:"#FFAA33"},children:"7"})]}),a.jsx("p",{className:"text-2xl font-semibold",style:{color:"#B0B0B0"},children:"Arena"})]})]})}),a.jsxs("div",{className:"flex items-center justify-center gap-3 text-red-400 mb-4",children:[a.jsx(X4,{className:"w-6 h-6"}),a.jsx("span",{className:"font-semibold tracking-wide",children:"Modo de Manuteno"})]}),a.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-8",children:[a.jsx("div",{className:"shrink-0",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute -inset-4 bg-brand/20 blur-2xl rounded-full"}),a.jsx("div",{className:"relative rounded-2xl p-1 bg-gradient-to-b from-brand/40 to-transparent",children:a.jsx(Hi,{size:"xl",variant:"header"})})]})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h1",{className:"text-2xl md:text-3xl font-bold leading-tight",children:"Oi! Eu sou a Isis "}),a.jsx("p",{className:"text-white/80 mt-3 text-base md:text-lg leading-relaxed",children:u}),a.jsxs("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-white/80",children:[d&&a.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2",children:[a.jsx(eu,{className:"w-4 h-4 text-brand"}),a.jsxs("span",{children:["Previso de retorno: ",a.jsx("strong",{className:"text-white/90",children:BV(d)})]})]}),a.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2",children:[a.jsx(lo,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Vamos cuidar de tudo para voc jogar melhor "})]})]})]})]})]}),a.jsx("p",{className:"mt-6 text-center text-white/50 text-sm",children:r?"Modo de manuteno ativo":"Modo de manuteno inativo"})]})]})}function Ilt(){const[e,t]=p.useState(!0),[r,n]=p.useState(!1),s=()=>{t(d=>!d)},o=wi(),i=hl(),l=o.pathname==="/agenda",c=o.pathname==="/isis/analytics";return p.useEffect(()=>{const d=u=>{const f=String(u.target?.tagName||"").toLowerCase();if(!(["input","textarea","select"].includes(f)||u.target?.isContentEditable)&&!u.repeat){if(String(u.key).toLowerCase()==="b"){u.preventDefault();const h=String(o?.pathname||"").toLowerCase();console.log("[Global Hotkey B] Current path:",h),h.includes("balcao")?(console.log("[Global Hotkey B] Navigating to /vendas"),i("/vendas")):(console.log("[Global Hotkey B] Navigating to /balcao"),i("/balcao"));return}if(String(u.key).toLowerCase()==="h"){u.preventDefault(),i("/historico");return}}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[o,i]),p.useEffect(()=>{try{typeof window<"u"&&window.innerWidth<768&&c&&t(!1)}catch{}},[c]),a.jsx(M2e,{children:a.jsx(P2e,{children:a.jsx(R2e,{children:a.jsxs("div",{className:"relative flex h-screen bg-background text-text-primary",children:[a.jsxs(B0,{children:[a.jsx("title",{children:"F7 Arena"}),a.jsx("meta",{name:"description",content:"Software para gesto de quadras esportivas."})]}),a.jsx(Ige,{isVisible:e,setIsVisible:t,sidebarPinned:r}),e&&a.jsx("button",{type:"button",onClick:()=>t(!1),className:"md:hidden fixed inset-0 z-30 bg-black/40","aria-label":"Fechar menu lateral"}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsx(E2e,{onToggleSidebar:s,sidebarVisible:e,sidebarPinned:r}),a.jsx("main",{className:Sr("flex-1 overflow-x-hidden overflow-y-auto bg-background",l?"p-0 md:p-8":"p-8"),children:a.jsxs(yj,{children:[a.jsx(Ps,{path:"/",element:a.jsx(jUe,{})}),a.jsx(Ps,{path:"/agenda",element:a.jsx(AZe,{sidebarVisible:e})}),a.jsx(Ps,{path:"/isis",element:a.jsx(QY,{children:a.jsx(alt,{})})}),a.jsx(Ps,{path:"/isis/analytics",element:a.jsx(slt,{})}),a.jsx(Ps,{path:"/vendas",element:a.jsx(pst,{})}),a.jsx(Ps,{path:"/balcao",element:a.jsx(gst,{})}),a.jsx(Ps,{path:"/produtos",element:a.jsx(zst,{})}),a.jsx(Ps,{path:"/compras",element:a.jsx(foe,{})}),a.jsx(Ps,{path:"/clientes",element:a.jsx(Xst,{})}),a.jsx(Ps,{path:"/equipe",element:a.jsx(eot,{})}),a.jsx(Ps,{path:"/financeiro",element:a.jsx(Bot,{})}),a.jsx(Ps,{path:"/caixa",element:a.jsx(dG,{to:"/financeiro?tab=caixa",replace:!0})}),a.jsx(Ps,{path:"/quadras",element:a.jsx(Uot,{})}),a.jsx(Ps,{path:"/empresas",element:a.jsx(Jot,{})}),a.jsx(Ps,{path:"/finalizadoras",element:a.jsx(Zot,{})}),a.jsx(Ps,{path:"/configuracao-fiscal",element:a.jsx(Git,{})}),a.jsx(Ps,{path:"/fiscal",element:a.jsx(rlt,{})}),a.jsx(Ps,{path:"/test-page",element:a.jsx(eit,{})}),a.jsx(Ps,{path:"/historico",element:a.jsx(clt,{})}),a.jsx(Ps,{path:"/suporte",element:a.jsx(rot,{})})]})})]})]})})})})}function Olt(){wi();const[e,t]=p.useState(!1),[r,n]=p.useState(!1),s=String({}.VITE_MAINTENANCE_MODE||"").toLowerCase()==="true",o=Ee.useMemo(()=>{try{if(typeof window>"u")return null;const c=window.location.host||"",d="f7arena.com";if(!c.endsWith(d))return null;const u=c.slice(0,-d.length).replace(/\.$/,"").toLowerCase();return!u||u==="www"?null:u}catch{return null}},[]);p.useEffect(()=>{try{const c=()=>{const u=localStorage.getItem("maintenance:active")==="true",f=localStorage.getItem("maintenance:end");return u&&f&&new Date>new Date(f)?(localStorage.removeItem("maintenance:active"),!1):u};t(localStorage.getItem("maintenance:bypass")==="1"),n(c());const d=u=>{if(!u||!u.key){n(c()),t(localStorage.getItem("maintenance:bypass")==="1");return}u.key==="maintenance:bypass"&&t(u.newValue==="1"),(u.key==="maintenance:active"||u.key==="maintenance:end")&&n(c())};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)}catch{}},[]);const i=!!Foe||s||r,l=(()=>{try{const c=localStorage.getItem("maintenance:bypass")==="1",d=(()=>{try{return sessionStorage.getItem("maintenance:bypass")==="1"}catch{return!1}})(),u=(()=>{try{return document.cookie.split(";").some(f=>f.trim()==="fx_maint_bypass=1")}catch{return!1}})();return c||d||u}catch{return!1}})();return i&&!l?a.jsxs(yj,{children:[a.jsx(Ps,{path:"/maintenance",element:a.jsx(qV,{})}),a.jsx(Ps,{path:"*",element:a.jsx(dG,{to:"/maintenance",replace:!0})})]}):o?a.jsx(yj,{children:a.jsx(Ps,{path:"/*",element:a.jsx(LV,{})})}):a.jsxs(yj,{children:[a.jsx(Ps,{path:"/reset-password",element:a.jsx(nit,{})}),a.jsx(Ps,{path:"/40028922",element:a.jsx(plt,{})}),a.jsx(Ps,{path:"/agendar/:nomeFantasia",element:a.jsx(LV,{})}),a.jsx(Ps,{path:"/maintenance",element:a.jsx(qV,{})}),a.jsx(Ps,{path:"/backenddeploy",element:a.jsx(tit,{})}),a.jsx(Ps,{path:"/print-comanda",element:a.jsx(y8,{children:a.jsx(dlt,{})})}),a.jsx(Ps,{path:"/*",element:a.jsx(y8,{children:a.jsx(Ilt,{})})})]})}var CF="ToastProvider",[AF,Tlt,Dlt]=rA("Toast"),[Loe,jct]=cu("Toast",[Dlt]),[Mlt,$A]=Loe(CF),$oe=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=e,[l,c]=p.useState(null),[d,u]=p.useState(0),f=p.useRef(!1),h=p.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${CF}\`. Expected non-empty \`string\`.`),a.jsx(AF.Provider,{scope:t,children:a.jsx(Mlt,{scope:t,label:r,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:d,viewport:l,onViewportChange:c,onToastAdd:p.useCallback(()=>u(m=>m+1),[]),onToastRemove:p.useCallback(()=>u(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:f,isClosePausedRef:h,children:i})})};$oe.displayName=CF;var Boe="ToastViewport",Rlt=["F8"],W3="toast.viewportPause",H3="toast.viewportResume",qoe=p.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Rlt,label:s="Notifications ({hotkey})",...o}=e,i=$A(Boe,r),l=Tlt(r),c=p.useRef(null),d=p.useRef(null),u=p.useRef(null),f=p.useRef(null),h=ms(t,f,i.onViewportChange),m=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),x=i.toastCount>0;p.useEffect(()=>{const y=v=>{n.length!==0&&n.every(w=>v[w]||v.code===w)&&f.current?.focus()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[n]),p.useEffect(()=>{const y=c.current,v=f.current;if(x&&y&&v){const b=()=>{if(!i.isClosePausedRef.current){const S=new CustomEvent(W3);v.dispatchEvent(S),i.isClosePausedRef.current=!0}},w=()=>{if(i.isClosePausedRef.current){const S=new CustomEvent(H3);v.dispatchEvent(S),i.isClosePausedRef.current=!1}},_=S=>{!y.contains(S.relatedTarget)&&w()},j=()=>{y.contains(document.activeElement)||w()};return y.addEventListener("focusin",b),y.addEventListener("focusout",_),y.addEventListener("pointermove",b),y.addEventListener("pointerleave",j),window.addEventListener("blur",b),window.addEventListener("focus",w),()=>{y.removeEventListener("focusin",b),y.removeEventListener("focusout",_),y.removeEventListener("pointermove",b),y.removeEventListener("pointerleave",j),window.removeEventListener("blur",b),window.removeEventListener("focus",w)}}},[x,i.isClosePausedRef]);const g=p.useCallback(({tabbingDirection:y})=>{const b=l().map(w=>{const _=w.ref.current,j=[_,...Xlt(_)];return y==="forwards"?j:j.reverse()});return(y==="forwards"?b.reverse():b).flat()},[l]);return p.useEffect(()=>{const y=f.current;if(y){const v=b=>{const w=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!w){const j=document.activeElement,S=b.shiftKey;if(b.target===y&&S){d.current?.focus();return}const P=g({tabbingDirection:S?"backwards":"forwards"}),F=P.findIndex(O=>O===j);qk(P.slice(F+1))?b.preventDefault():S?d.current?.focus():u.current?.focus()}};return y.addEventListener("keydown",v),()=>y.removeEventListener("keydown",v)}},[l,g]),a.jsxs(Uge,{ref:c,role:"region","aria-label":s.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:x?void 0:"none"},children:[x&&a.jsx(G3,{ref:d,onFocusFromOutsideViewport:()=>{const y=g({tabbingDirection:"forwards"});qk(y)}}),a.jsx(AF.Slot,{scope:r,children:a.jsx(ka.ol,{tabIndex:-1,...o,ref:h})}),x&&a.jsx(G3,{ref:u,onFocusFromOutsideViewport:()=>{const y=g({tabbingDirection:"backwards"});qk(y)}})]})});qoe.displayName=Boe;var zoe="ToastFocusProxy",G3=p.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=e,o=$A(zoe,r);return a.jsx(gR,{tabIndex:0,...s,ref:t,style:{position:"fixed"},onFocus:i=>{const l=i.relatedTarget;!o.viewport?.contains(l)&&n()}})});G3.displayName=zoe;var I2="Toast",Flt="toast.swipeStart",Llt="toast.swipeMove",$lt="toast.swipeCancel",Blt="toast.swipeEnd",Uoe=p.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:o,...i}=e,[l,c]=km({prop:n,defaultProp:s??!0,onChange:o,caller:I2});return a.jsx(jd,{present:r||l,children:a.jsx(Ult,{open:l,...i,ref:t,onClose:()=>c(!1),onPause:Dc(e.onPause),onResume:Dc(e.onResume),onSwipeStart:Bn(e.onSwipeStart,d=>{d.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Bn(e.onSwipeMove,d=>{const{x:u,y:f}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","move"),d.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${f}px`)}),onSwipeCancel:Bn(e.onSwipeCancel,d=>{d.currentTarget.setAttribute("data-swipe","cancel"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Bn(e.onSwipeEnd,d=>{const{x:u,y:f}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","end"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${f}px`),c(!1)})})})});Uoe.displayName=I2;var[qlt,zlt]=Loe(I2,{onClose(){}}),Ult=p.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:l,onPause:c,onResume:d,onSwipeStart:u,onSwipeMove:f,onSwipeCancel:h,onSwipeEnd:m,...x}=e,g=$A(I2,r),[y,v]=p.useState(null),b=ms(t,k=>v(k)),w=p.useRef(null),_=p.useRef(null),j=s||g.duration,S=p.useRef(0),C=p.useRef(j),A=p.useRef(0),{onToastAdd:P,onToastRemove:F}=g,O=Dc(()=>{y?.contains(document.activeElement)&&g.viewport?.focus(),i()}),I=p.useCallback(k=>{!k||k===1/0||(window.clearTimeout(A.current),S.current=new Date().getTime(),A.current=window.setTimeout(O,k))},[O]);p.useEffect(()=>{const k=g.viewport;if(k){const B=()=>{I(C.current),d?.()},z=()=>{const U=new Date().getTime()-S.current;C.current=C.current-U,window.clearTimeout(A.current),c?.()};return k.addEventListener(W3,z),k.addEventListener(H3,B),()=>{k.removeEventListener(W3,z),k.removeEventListener(H3,B)}}},[g.viewport,j,c,d,I]),p.useEffect(()=>{o&&!g.isClosePausedRef.current&&I(j)},[o,j,g.isClosePausedRef,I]),p.useEffect(()=>(P(),()=>F()),[P,F]);const T=p.useMemo(()=>y?Yoe(y):null,[y]);return g.viewport?a.jsxs(a.Fragment,{children:[T&&a.jsx(Vlt,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:T}),a.jsx(qlt,{scope:r,onClose:O,children:Rm.createPortal(a.jsx(AF.ItemSlot,{scope:r,children:a.jsx(zge,{asChild:!0,onEscapeKeyDown:Bn(l,()=>{g.isFocusedToastEscapeKeyDownRef.current||O(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:a.jsx(ka.li,{tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":g.swipeDirection,...x,ref:b,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Bn(e.onKeyDown,k=>{k.key==="Escape"&&(l?.(k.nativeEvent),k.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,O()))}),onPointerDown:Bn(e.onPointerDown,k=>{k.button===0&&(w.current={x:k.clientX,y:k.clientY})}),onPointerMove:Bn(e.onPointerMove,k=>{if(!w.current)return;const B=k.clientX-w.current.x,z=k.clientY-w.current.y,U=!!_.current,L=["left","right"].includes(g.swipeDirection),W=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,ge=L?W(0,B):0,Ae=L?0:W(0,z),V=k.pointerType==="touch"?10:2,$={x:ge,y:Ae},Y={originalEvent:k,delta:$};U?(_.current=$,oj(Llt,f,Y,{discrete:!1})):zV($,g.swipeDirection,V)?(_.current=$,oj(Flt,u,Y,{discrete:!1}),k.target.setPointerCapture(k.pointerId)):(Math.abs(B)>V||Math.abs(z)>V)&&(w.current=null)}),onPointerUp:Bn(e.onPointerUp,k=>{const B=_.current,z=k.target;if(z.hasPointerCapture(k.pointerId)&&z.releasePointerCapture(k.pointerId),_.current=null,w.current=null,B){const U=k.currentTarget,L={originalEvent:k,delta:B};zV(B,g.swipeDirection,g.swipeThreshold)?oj(Blt,m,L,{discrete:!0}):oj($lt,h,L,{discrete:!0}),U.addEventListener("click",W=>W.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),Vlt=e=>{const{__scopeToast:t,children:r,...n}=e,s=$A(I2,t),[o,i]=p.useState(!1),[l,c]=p.useState(!1);return Glt(()=>i(!0)),p.useEffect(()=>{const d=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(d)},[]),l?null:a.jsx(Y0,{asChild:!0,children:a.jsx(gR,{...n,children:o&&a.jsxs(a.Fragment,{children:[s.label," ",r]})})})},Wlt="ToastTitle",Voe=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(ka.div,{...n,ref:t})});Voe.displayName=Wlt;var Hlt="ToastDescription",Woe=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(ka.div,{...n,ref:t})});Woe.displayName=Hlt;var Hoe="ToastAction",Goe=p.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?a.jsx(Xoe,{altText:r,asChild:!0,children:a.jsx(PF,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${Hoe}\`. Expected non-empty \`string\`.`),null)});Goe.displayName=Hoe;var Koe="ToastClose",PF=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,s=zlt(Koe,r);return a.jsx(Xoe,{asChild:!0,children:a.jsx(ka.button,{type:"button",...n,ref:t,onClick:Bn(e.onClick,s.onClose)})})});PF.displayName=Koe;var Xoe=p.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...s}=e;return a.jsx(ka.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:t})});function Yoe(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),Klt(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",o=n.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const i=n.dataset.radixToastAnnounceAlt;i&&t.push(i)}else t.push(...Yoe(n))}}),t}function oj(e,t,r,{discrete:n}){const s=r.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?SD(s,o):s.dispatchEvent(o)}var zV=(e,t,r=0)=>{const n=Math.abs(e.x),s=Math.abs(e.y),o=n>s;return t==="left"||t==="right"?o&&n>r:!o&&s>r};function Glt(e=()=>{}){const t=Dc(e);ml(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function Klt(e){return e.nodeType===e.ELEMENT_NODE}function Xlt(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function qk(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Ylt=$oe,Joe=qoe,Qoe=Uoe,Zoe=Voe,eie=Woe,tie=Goe,rie=PF;const Jlt=Ylt,nie=Ee.forwardRef(({className:e,...t},r)=>a.jsx(Joe,{ref:r,className:Sr("fixed z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));nie.displayName=Joe.displayName;const Qlt=ND("group relative pointer-events-auto flex w-full items-start justify-between gap-4 overflow-hidden rounded-lg border p-4 pr-8 shadow-xl transition-all data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-warning text-black border-warning",destructive:"bg-danger text-white border-danger",success:"bg-success text-white border-success",info:"bg-info text-black border-info",warning:"bg-warning text-black border-warning"}},defaultVariants:{variant:"default"}}),aie=Ee.forwardRef(({className:e,variant:t,...r},n)=>a.jsx(Qoe,{ref:n,className:Sr(Qlt({variant:t}),e),...r}));aie.displayName=Qoe.displayName;const Zlt=Ee.forwardRef(({className:e,...t},r)=>a.jsx(tie,{ref:r,className:Sr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));Zlt.displayName=tie.displayName;const sie=Ee.forwardRef(({className:e,...t},r)=>a.jsx(rie,{ref:r,className:Sr("absolute right-2 top-2 rounded-md p-1 text-white/80 transition-opacity hover:text-white focus:outline-none focus:ring-2 focus:ring-white/50 group-[.default]:text-black/70 group-[.default]:hover:text-black",e),...t,children:a.jsx(lc,{className:"h-4 w-4"})}));sie.displayName=rie.displayName;const oie=Ee.forwardRef(({className:e,...t},r)=>a.jsx(Zoe,{ref:r,className:Sr("text-sm font-semibold",e),...t}));oie.displayName=Zoe.displayName;const iie=Ee.forwardRef(({className:e,...t},r)=>a.jsx(eie,{ref:r,className:Sr("text-sm",e),...t}));iie.displayName=eie.displayName;function ect(){const{toasts:e}=Ss();return a.jsxs(Jlt,{children:[e.map(({id:t,title:r,description:n,action:s,dismiss:o,...i})=>a.jsxs(aie,{...i,children:[a.jsxs("div",{className:"grid gap-1",children:[r&&a.jsx(oie,{children:r}),n&&a.jsx(iie,{children:n})]}),s,a.jsx(sie,{onClick:o})]},t)),a.jsx(nie,{})]})}function tct(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(e=>{setInterval(()=>{e.update()},6e4),e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&window.confirm("Nova verso disponvel! Deseja atualizar agora?")&&(t.postMessage({type:"SKIP_WAITING"}),window.location.reload())})})}).catch(e=>{console.error("[SW] Erro ao registrar Service Worker:",e)}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()})})}tct();window.screen?.orientation?.lock&&window.screen.orientation.lock("portrait").catch(e=>{console.log("[Orientation] Lock no suportado ou j bloqueado:",e.message)});window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),window.__installPrompt=e},{passive:!1});window.addEventListener("appinstalled",()=>{window.__installPrompt=null});zk.createRoot(document.getElementById("root")).render(a.jsx(Wde,{children:a.jsxs(Ewe,{children:[a.jsx(Olt,{}),a.jsx(ect,{})]})}));export{u2e as _,Tl as c,xs as g};
