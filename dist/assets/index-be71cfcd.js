var bie=Object.defineProperty;var wie=(e,t,r)=>t in e?bie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var lo=(e,t,r)=>(wie(e,typeof t!="symbol"?t+"":t,r),r);function jie(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var Jl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ls(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function _ie(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var UV={exports:{}},jC={},VV={exports:{}},Ps={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V1=Symbol.for("react.element"),Nie=Symbol.for("react.portal"),Sie=Symbol.for("react.fragment"),Cie=Symbol.for("react.strict_mode"),Pie=Symbol.for("react.profiler"),Aie=Symbol.for("react.provider"),Eie=Symbol.for("react.context"),kie=Symbol.for("react.forward_ref"),Iie=Symbol.for("react.suspense"),Oie=Symbol.for("react.memo"),Tie=Symbol.for("react.lazy"),BF=Symbol.iterator;function Die(e){return e===null||typeof e!="object"?null:(e=BF&&e[BF]||e["@@iterator"],typeof e=="function"?e:null)}var WV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HV=Object.assign,GV={};function Q0(e,t,r){this.props=e,this.context=t,this.refs=GV,this.updater=r||WV}Q0.prototype.isReactComponent={};Q0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Q0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function KV(){}KV.prototype=Q0.prototype;function K3(e,t,r){this.props=e,this.context=t,this.refs=GV,this.updater=r||WV}var X3=K3.prototype=new KV;X3.constructor=K3;HV(X3,Q0.prototype);X3.isPureReactComponent=!0;var qF=Array.isArray,XV=Object.prototype.hasOwnProperty,Y3={current:null},YV={key:!0,ref:!0,__self:!0,__source:!0};function JV(e,t,r){var n,s={},o=null,i=null;if(t!=null)for(n in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(o=""+t.key),t)XV.call(t,n)&&!YV.hasOwnProperty(n)&&(s[n]=t[n]);var l=arguments.length-2;if(l===1)s.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps,l)s[n]===void 0&&(s[n]=l[n]);return{$$typeof:V1,type:e,key:o,ref:i,props:s,_owner:Y3.current}}function Mie(e,t){return{$$typeof:V1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function J3(e){return typeof e=="object"&&e!==null&&e.$$typeof===V1}function Rie(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var zF=/\/+/g;function nA(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Rie(""+e.key):t.toString(36)}function m_(e,t,r,n,s){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case V1:case Nie:i=!0}}if(i)return i=e,s=s(i),e=n===""?"."+nA(i,0):n,qF(s)?(r="",e!=null&&(r=e.replace(zF,"$&/")+"/"),m_(s,t,r,"",function(d){return d})):s!=null&&(J3(s)&&(s=Mie(s,r+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(zF,"$&/")+"/")+e)),t.push(s)),1;if(i=0,n=n===""?".":n+":",qF(e))for(var l=0;l<e.length;l++){o=e[l];var c=n+nA(o,l);i+=m_(o,t,r,c,s)}else if(c=Die(e),typeof c=="function")for(e=c.call(e),l=0;!(o=e.next()).done;)o=o.value,c=n+nA(o,l++),i+=m_(o,t,r,c,s);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function Hj(e,t,r){if(e==null)return e;var n=[],s=0;return m_(e,n,"","",function(o){return t.call(r,o,s++)}),n}function Fie(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Pc={current:null},h_={transition:null},Lie={ReactCurrentDispatcher:Pc,ReactCurrentBatchConfig:h_,ReactCurrentOwner:Y3};function QV(){throw Error("act(...) is not supported in production builds of React.")}Ps.Children={map:Hj,forEach:function(e,t,r){Hj(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Hj(e,function(){t++}),t},toArray:function(e){return Hj(e,function(t){return t})||[]},only:function(e){if(!J3(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ps.Component=Q0;Ps.Fragment=Sie;Ps.Profiler=Pie;Ps.PureComponent=K3;Ps.StrictMode=Cie;Ps.Suspense=Iie;Ps.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Lie;Ps.act=QV;Ps.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=HV({},e.props),s=e.key,o=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,i=Y3.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)XV.call(t,c)&&!YV.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];n.children=l}return{$$typeof:V1,type:e.type,key:s,ref:o,props:n,_owner:i}};Ps.createContext=function(e){return e={$$typeof:Eie,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Aie,_context:e},e.Consumer=e};Ps.createElement=JV;Ps.createFactory=function(e){var t=JV.bind(null,e);return t.type=e,t};Ps.createRef=function(){return{current:null}};Ps.forwardRef=function(e){return{$$typeof:kie,render:e}};Ps.isValidElement=J3;Ps.lazy=function(e){return{$$typeof:Tie,_payload:{_status:-1,_result:e},_init:Fie}};Ps.memo=function(e,t){return{$$typeof:Oie,type:e,compare:t===void 0?null:t}};Ps.startTransition=function(e){var t=h_.transition;h_.transition={};try{e()}finally{h_.transition=t}};Ps.unstable_act=QV;Ps.useCallback=function(e,t){return Pc.current.useCallback(e,t)};Ps.useContext=function(e){return Pc.current.useContext(e)};Ps.useDebugValue=function(){};Ps.useDeferredValue=function(e){return Pc.current.useDeferredValue(e)};Ps.useEffect=function(e,t){return Pc.current.useEffect(e,t)};Ps.useId=function(){return Pc.current.useId()};Ps.useImperativeHandle=function(e,t,r){return Pc.current.useImperativeHandle(e,t,r)};Ps.useInsertionEffect=function(e,t){return Pc.current.useInsertionEffect(e,t)};Ps.useLayoutEffect=function(e,t){return Pc.current.useLayoutEffect(e,t)};Ps.useMemo=function(e,t){return Pc.current.useMemo(e,t)};Ps.useReducer=function(e,t,r){return Pc.current.useReducer(e,t,r)};Ps.useRef=function(e){return Pc.current.useRef(e)};Ps.useState=function(e){return Pc.current.useState(e)};Ps.useSyncExternalStore=function(e,t,r){return Pc.current.useSyncExternalStore(e,t,r)};Ps.useTransition=function(){return Pc.current.useTransition()};Ps.version="18.3.1";VV.exports=Ps;var p=VV.exports;const Ce=Ls(p),Q3=jie({__proto__:null,default:Ce},[p]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $ie=p,Bie=Symbol.for("react.element"),qie=Symbol.for("react.fragment"),zie=Object.prototype.hasOwnProperty,Uie=$ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Vie={key:!0,ref:!0,__self:!0,__source:!0};function ZV(e,t,r){var n,s={},o=null,i=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)zie.call(t,n)&&!Vie.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:Bie,type:e,key:o,ref:i,props:s,_owner:Uie.current}}jC.Fragment=qie;jC.jsx=ZV;jC.jsxs=ZV;UV.exports=jC;var a=UV.exports,Uk={},eW={exports:{}},$d={},tW={exports:{}},rW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(F,V){var ue=F.length;F.push(V);e:for(;0<ue;){var _e=ue-1>>>1,U=F[_e];if(0<s(U,V))F[_e]=V,F[ue]=U,ue=_e;else break e}}function r(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var V=F[0],ue=F.pop();if(ue!==V){F[0]=ue;e:for(var _e=0,U=F.length,L=U>>>1;_e<L;){var G=2*(_e+1)-1,de=F[G],X=G+1,W=F[X];if(0>s(de,ue))X<U&&0>s(W,de)?(F[_e]=W,F[X]=ue,_e=X):(F[_e]=de,F[G]=ue,_e=G);else if(X<U&&0>s(W,ue))F[_e]=W,F[X]=ue,_e=X;else break e}}return V}function s(F,V){var ue=F.sortIndex-V.sortIndex;return ue!==0?ue:F.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();e.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,f=null,h=3,m=!1,x=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(F){for(var V=r(d);V!==null;){if(V.callback===null)n(d);else if(V.startTime<=F)n(d),V.sortIndex=V.expirationTime,t(c,V);else break;V=r(d)}}function j(F){if(g=!1,w(F),!x)if(r(c)!==null)x=!0,q(_);else{var V=r(d);V!==null&&z(j,V.startTime-F)}}function _(F,V){x=!1,g&&(g=!1,y(S),S=-1),m=!0;var ue=h;try{for(w(V),f=r(c);f!==null&&(!(f.expirationTime>V)||F&&!O());){var _e=f.callback;if(typeof _e=="function"){f.callback=null,h=f.priorityLevel;var U=_e(f.expirationTime<=V);V=e.unstable_now(),typeof U=="function"?f.callback=U:f===r(c)&&n(c),w(V)}else n(c);f=r(c)}if(f!==null)var L=!0;else{var G=r(d);G!==null&&z(j,G.startTime-V),L=!1}return L}finally{f=null,h=ue,m=!1}}var C=!1,A=null,S=-1,P=5,M=-1;function O(){return!(e.unstable_now()-M<P)}function I(){if(A!==null){var F=e.unstable_now();M=F;var V=!0;try{V=A(!0,F)}finally{V?T():(C=!1,A=null)}}else C=!1}var T;if(typeof b=="function")T=function(){b(I)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,$=k.port2;k.port1.onmessage=I,T=function(){$.postMessage(null)}}else T=function(){v(I,0)};function q(F){A=F,C||(C=!0,T())}function z(F,V){S=v(function(){F(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){x||m||(x=!0,q(_))},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(F){switch(h){case 1:case 2:case 3:var V=3;break;default:V=h}var ue=h;h=V;try{return F()}finally{h=ue}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,V){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var ue=h;h=F;try{return V()}finally{h=ue}},e.unstable_scheduleCallback=function(F,V,ue){var _e=e.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?_e+ue:_e):ue=_e,F){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=ue+U,F={id:u++,callback:V,priorityLevel:F,startTime:ue,expirationTime:U,sortIndex:-1},ue>_e?(F.sortIndex=ue,t(d,F),r(c)===null&&F===r(d)&&(g?(y(S),S=-1):g=!0,z(j,ue-_e))):(F.sortIndex=U,t(c,F),x||m||(x=!0,q(_))),F},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(F){var V=h;return function(){var ue=h;h=V;try{return F.apply(this,arguments)}finally{h=ue}}}})(rW);tW.exports=rW;var Wie=tW.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hie=p,Fd=Wie;function Fn(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nW=new Set,mw={};function mx(e,t){n0(e,t),n0(e+"Capture",t)}function n0(e,t){for(mw[e]=t,e=0;e<t.length;e++)nW.add(t[e])}var Dm=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vk=Object.prototype.hasOwnProperty,Gie=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,UF={},VF={};function Kie(e){return Vk.call(VF,e)?!0:Vk.call(UF,e)?!1:Gie.test(e)?VF[e]=!0:(UF[e]=!0,!1)}function Xie(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Yie(e,t,r,n){if(t===null||typeof t>"u"||Xie(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ac(e,t,r,n,s,o,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=i}var kl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){kl[e]=new Ac(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];kl[t]=new Ac(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){kl[e]=new Ac(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){kl[e]=new Ac(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){kl[e]=new Ac(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){kl[e]=new Ac(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){kl[e]=new Ac(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){kl[e]=new Ac(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){kl[e]=new Ac(e,5,!1,e.toLowerCase(),null,!1,!1)});var Z3=/[\-:]([a-z])/g;function e4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Z3,e4);kl[t]=new Ac(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Z3,e4);kl[t]=new Ac(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Z3,e4);kl[t]=new Ac(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){kl[e]=new Ac(e,1,!1,e.toLowerCase(),null,!1,!1)});kl.xlinkHref=new Ac("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){kl[e]=new Ac(e,1,!1,e.toLowerCase(),null,!0,!0)});function t4(e,t,r,n){var s=kl.hasOwnProperty(t)?kl[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Yie(t,r,s,n)&&(r=null),n||s===null?Kie(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Km=Hie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gj=Symbol.for("react.element"),fv=Symbol.for("react.portal"),mv=Symbol.for("react.fragment"),r4=Symbol.for("react.strict_mode"),Wk=Symbol.for("react.profiler"),aW=Symbol.for("react.provider"),sW=Symbol.for("react.context"),n4=Symbol.for("react.forward_ref"),Hk=Symbol.for("react.suspense"),Gk=Symbol.for("react.suspense_list"),a4=Symbol.for("react.memo"),wh=Symbol.for("react.lazy"),oW=Symbol.for("react.offscreen"),WF=Symbol.iterator;function My(e){return e===null||typeof e!="object"?null:(e=WF&&e[WF]||e["@@iterator"],typeof e=="function"?e:null)}var ni=Object.assign,aA;function pb(e){if(aA===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);aA=t&&t[1]||""}return`
`+aA+e}var sA=!1;function oA(e,t){if(!e||sA)return"";sA=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),o=n.stack.split(`
`),i=s.length-1,l=o.length-1;1<=i&&0<=l&&s[i]!==o[l];)l--;for(;1<=i&&0<=l;i--,l--)if(s[i]!==o[l]){if(i!==1||l!==1)do if(i--,l--,0>l||s[i]!==o[l]){var c=`
`+s[i].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=i&&0<=l);break}}}finally{sA=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?pb(e):""}function Jie(e){switch(e.tag){case 5:return pb(e.type);case 16:return pb("Lazy");case 13:return pb("Suspense");case 19:return pb("SuspenseList");case 0:case 2:case 15:return e=oA(e.type,!1),e;case 11:return e=oA(e.type.render,!1),e;case 1:return e=oA(e.type,!0),e;default:return""}}function Kk(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case mv:return"Fragment";case fv:return"Portal";case Wk:return"Profiler";case r4:return"StrictMode";case Hk:return"Suspense";case Gk:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case sW:return(e.displayName||"Context")+".Consumer";case aW:return(e._context.displayName||"Context")+".Provider";case n4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case a4:return t=e.displayName||null,t!==null?t:Kk(e.type)||"Memo";case wh:t=e._payload,e=e._init;try{return Kk(e(t))}catch{}}return null}function Qie(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Kk(t);case 8:return t===r4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function mp(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function iW(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Zie(e){var t=iW(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(i){n=""+i,o.call(this,i)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Kj(e){e._valueTracker||(e._valueTracker=Zie(e))}function lW(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=iW(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function H_(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Xk(e,t){var r=t.checked;return ni({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function HF(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=mp(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function cW(e,t){t=t.checked,t!=null&&t4(e,"checked",t,!1)}function Yk(e,t){cW(e,t);var r=mp(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Jk(e,t.type,r):t.hasOwnProperty("defaultValue")&&Jk(e,t.type,mp(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function GF(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Jk(e,t,r){(t!=="number"||H_(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var gb=Array.isArray;function Rv(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+mp(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function Qk(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Fn(91));return ni({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function KF(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Fn(92));if(gb(r)){if(1<r.length)throw Error(Fn(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:mp(r)}}function dW(e,t){var r=mp(t.value),n=mp(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function XF(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function uW(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zk(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?uW(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Xj,fW=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Xj=Xj||document.createElement("div"),Xj.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Xj.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function hw(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ele=["Webkit","ms","Moz","O"];Object.keys(Pb).forEach(function(e){ele.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Pb[t]=Pb[e]})});function mW(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Pb.hasOwnProperty(e)&&Pb[e]?(""+t).trim():t+"px"}function hW(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=mW(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var tle=ni({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eI(e,t){if(t){if(tle[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Fn(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Fn(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Fn(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Fn(62))}}function tI(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rI=null;function s4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var nI=null,Fv=null,Lv=null;function YF(e){if(e=G1(e)){if(typeof nI!="function")throw Error(Fn(280));var t=e.stateNode;t&&(t=PC(t),nI(e.stateNode,e.type,t))}}function pW(e){Fv?Lv?Lv.push(e):Lv=[e]:Fv=e}function gW(){if(Fv){var e=Fv,t=Lv;if(Lv=Fv=null,YF(e),t)for(e=0;e<t.length;e++)YF(t[e])}}function xW(e,t){return e(t)}function vW(){}var iA=!1;function yW(e,t,r){if(iA)return e(t,r);iA=!0;try{return xW(e,t,r)}finally{iA=!1,(Fv!==null||Lv!==null)&&(vW(),gW())}}function pw(e,t){var r=e.stateNode;if(r===null)return null;var n=PC(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Fn(231,t,typeof r));return r}var aI=!1;if(Dm)try{var Ry={};Object.defineProperty(Ry,"passive",{get:function(){aI=!0}}),window.addEventListener("test",Ry,Ry),window.removeEventListener("test",Ry,Ry)}catch{aI=!1}function rle(e,t,r,n,s,o,i,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(u){this.onError(u)}}var Ab=!1,G_=null,K_=!1,sI=null,nle={onError:function(e){Ab=!0,G_=e}};function ale(e,t,r,n,s,o,i,l,c){Ab=!1,G_=null,rle.apply(nle,arguments)}function sle(e,t,r,n,s,o,i,l,c){if(ale.apply(this,arguments),Ab){if(Ab){var d=G_;Ab=!1,G_=null}else throw Error(Fn(198));K_||(K_=!0,sI=d)}}function hx(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function bW(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function JF(e){if(hx(e)!==e)throw Error(Fn(188))}function ole(e){var t=e.alternate;if(!t){if(t=hx(e),t===null)throw Error(Fn(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var o=s.alternate;if(o===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===r)return JF(s),e;if(o===n)return JF(s),t;o=o.sibling}throw Error(Fn(188))}if(r.return!==n.return)r=s,n=o;else{for(var i=!1,l=s.child;l;){if(l===r){i=!0,r=s,n=o;break}if(l===n){i=!0,n=s,r=o;break}l=l.sibling}if(!i){for(l=o.child;l;){if(l===r){i=!0,r=o,n=s;break}if(l===n){i=!0,n=o,r=s;break}l=l.sibling}if(!i)throw Error(Fn(189))}}if(r.alternate!==n)throw Error(Fn(190))}if(r.tag!==3)throw Error(Fn(188));return r.stateNode.current===r?e:t}function wW(e){return e=ole(e),e!==null?jW(e):null}function jW(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=jW(e);if(t!==null)return t;e=e.sibling}return null}var _W=Fd.unstable_scheduleCallback,QF=Fd.unstable_cancelCallback,ile=Fd.unstable_shouldYield,lle=Fd.unstable_requestPaint,gi=Fd.unstable_now,cle=Fd.unstable_getCurrentPriorityLevel,o4=Fd.unstable_ImmediatePriority,NW=Fd.unstable_UserBlockingPriority,X_=Fd.unstable_NormalPriority,dle=Fd.unstable_LowPriority,SW=Fd.unstable_IdlePriority,_C=null,qf=null;function ule(e){if(qf&&typeof qf.onCommitFiberRoot=="function")try{qf.onCommitFiberRoot(_C,e,void 0,(e.current.flags&128)===128)}catch{}}var tf=Math.clz32?Math.clz32:hle,fle=Math.log,mle=Math.LN2;function hle(e){return e>>>=0,e===0?32:31-(fle(e)/mle|0)|0}var Yj=64,Jj=4194304;function xb(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Y_(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,o=e.pingedLanes,i=r&268435455;if(i!==0){var l=i&~s;l!==0?n=xb(l):(o&=i,o!==0&&(n=xb(o)))}else i=r&~s,i!==0?n=xb(i):o!==0&&(n=xb(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,o=t&-t,s>=o||s===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-tf(t),s=1<<r,n|=e[r],t&=~s;return n}function ple(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gle(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,o=e.pendingLanes;0<o;){var i=31-tf(o),l=1<<i,c=s[i];c===-1?(!(l&r)||l&n)&&(s[i]=ple(l,t)):c<=t&&(e.expiredLanes|=l),o&=~l}}function oI(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function CW(){var e=Yj;return Yj<<=1,!(Yj&4194240)&&(Yj=64),e}function lA(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function W1(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-tf(t),e[t]=r}function xle(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-tf(r),o=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~o}}function i4(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-tf(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var uo=0;function PW(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var AW,l4,EW,kW,IW,iI=!1,Qj=[],Vh=null,Wh=null,Hh=null,gw=new Map,xw=new Map,Ch=[],vle="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ZF(e,t){switch(e){case"focusin":case"focusout":Vh=null;break;case"dragenter":case"dragleave":Wh=null;break;case"mouseover":case"mouseout":Hh=null;break;case"pointerover":case"pointerout":gw.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xw.delete(t.pointerId)}}function Fy(e,t,r,n,s,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[s]},t!==null&&(t=G1(t),t!==null&&l4(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function yle(e,t,r,n,s){switch(t){case"focusin":return Vh=Fy(Vh,e,t,r,n,s),!0;case"dragenter":return Wh=Fy(Wh,e,t,r,n,s),!0;case"mouseover":return Hh=Fy(Hh,e,t,r,n,s),!0;case"pointerover":var o=s.pointerId;return gw.set(o,Fy(gw.get(o)||null,e,t,r,n,s)),!0;case"gotpointercapture":return o=s.pointerId,xw.set(o,Fy(xw.get(o)||null,e,t,r,n,s)),!0}return!1}function OW(e){var t=hg(e.target);if(t!==null){var r=hx(t);if(r!==null){if(t=r.tag,t===13){if(t=bW(r),t!==null){e.blockedOn=t,IW(e.priority,function(){EW(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function p_(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=lI(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);rI=n,r.target.dispatchEvent(n),rI=null}else return t=G1(r),t!==null&&l4(t),e.blockedOn=r,!1;t.shift()}return!0}function eL(e,t,r){p_(e)&&r.delete(t)}function ble(){iI=!1,Vh!==null&&p_(Vh)&&(Vh=null),Wh!==null&&p_(Wh)&&(Wh=null),Hh!==null&&p_(Hh)&&(Hh=null),gw.forEach(eL),xw.forEach(eL)}function Ly(e,t){e.blockedOn===t&&(e.blockedOn=null,iI||(iI=!0,Fd.unstable_scheduleCallback(Fd.unstable_NormalPriority,ble)))}function vw(e){function t(s){return Ly(s,e)}if(0<Qj.length){Ly(Qj[0],e);for(var r=1;r<Qj.length;r++){var n=Qj[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Vh!==null&&Ly(Vh,e),Wh!==null&&Ly(Wh,e),Hh!==null&&Ly(Hh,e),gw.forEach(t),xw.forEach(t),r=0;r<Ch.length;r++)n=Ch[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Ch.length&&(r=Ch[0],r.blockedOn===null);)OW(r),r.blockedOn===null&&Ch.shift()}var $v=Km.ReactCurrentBatchConfig,J_=!0;function wle(e,t,r,n){var s=uo,o=$v.transition;$v.transition=null;try{uo=1,c4(e,t,r,n)}finally{uo=s,$v.transition=o}}function jle(e,t,r,n){var s=uo,o=$v.transition;$v.transition=null;try{uo=4,c4(e,t,r,n)}finally{uo=s,$v.transition=o}}function c4(e,t,r,n){if(J_){var s=lI(e,t,r,n);if(s===null)vA(e,t,n,Q_,r),ZF(e,n);else if(yle(s,e,t,r,n))n.stopPropagation();else if(ZF(e,n),t&4&&-1<vle.indexOf(e)){for(;s!==null;){var o=G1(s);if(o!==null&&AW(o),o=lI(e,t,r,n),o===null&&vA(e,t,n,Q_,r),o===s)break;s=o}s!==null&&n.stopPropagation()}else vA(e,t,n,null,r)}}var Q_=null;function lI(e,t,r,n){if(Q_=null,e=s4(n),e=hg(e),e!==null)if(t=hx(e),t===null)e=null;else if(r=t.tag,r===13){if(e=bW(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Q_=e,null}function TW(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(cle()){case o4:return 1;case NW:return 4;case X_:case dle:return 16;case SW:return 536870912;default:return 16}default:return 16}}var Th=null,d4=null,g_=null;function DW(){if(g_)return g_;var e,t=d4,r=t.length,n,s="value"in Th?Th.value:Th.textContent,o=s.length;for(e=0;e<r&&t[e]===s[e];e++);var i=r-e;for(n=1;n<=i&&t[r-n]===s[o-n];n++);return g_=s.slice(e,1<n?1-n:void 0)}function x_(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Zj(){return!0}function tL(){return!1}function Bd(e){function t(r,n,s,o,i){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(r=e[l],this[l]=r?r(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Zj:tL,this.isPropagationStopped=tL,this}return ni(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Zj)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Zj)},persist:function(){},isPersistent:Zj}),t}var Z0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},u4=Bd(Z0),H1=ni({},Z0,{view:0,detail:0}),_le=Bd(H1),cA,dA,$y,NC=ni({},H1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:f4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$y&&($y&&e.type==="mousemove"?(cA=e.screenX-$y.screenX,dA=e.screenY-$y.screenY):dA=cA=0,$y=e),cA)},movementY:function(e){return"movementY"in e?e.movementY:dA}}),rL=Bd(NC),Nle=ni({},NC,{dataTransfer:0}),Sle=Bd(Nle),Cle=ni({},H1,{relatedTarget:0}),uA=Bd(Cle),Ple=ni({},Z0,{animationName:0,elapsedTime:0,pseudoElement:0}),Ale=Bd(Ple),Ele=ni({},Z0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),kle=Bd(Ele),Ile=ni({},Z0,{data:0}),nL=Bd(Ile),Ole={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tle={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dle={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mle(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Dle[e])?!!t[e]:!1}function f4(){return Mle}var Rle=ni({},H1,{key:function(e){if(e.key){var t=Ole[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=x_(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Tle[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:f4,charCode:function(e){return e.type==="keypress"?x_(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?x_(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Fle=Bd(Rle),Lle=ni({},NC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),aL=Bd(Lle),$le=ni({},H1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:f4}),Ble=Bd($le),qle=ni({},Z0,{propertyName:0,elapsedTime:0,pseudoElement:0}),zle=Bd(qle),Ule=ni({},NC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Vle=Bd(Ule),Wle=[9,13,27,32],m4=Dm&&"CompositionEvent"in window,Eb=null;Dm&&"documentMode"in document&&(Eb=document.documentMode);var Hle=Dm&&"TextEvent"in window&&!Eb,MW=Dm&&(!m4||Eb&&8<Eb&&11>=Eb),sL=String.fromCharCode(32),oL=!1;function RW(e,t){switch(e){case"keyup":return Wle.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function FW(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var hv=!1;function Gle(e,t){switch(e){case"compositionend":return FW(t);case"keypress":return t.which!==32?null:(oL=!0,sL);case"textInput":return e=t.data,e===sL&&oL?null:e;default:return null}}function Kle(e,t){if(hv)return e==="compositionend"||!m4&&RW(e,t)?(e=DW(),g_=d4=Th=null,hv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return MW&&t.locale!=="ko"?null:t.data;default:return null}}var Xle={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iL(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Xle[e.type]:t==="textarea"}function LW(e,t,r,n){pW(n),t=Z_(t,"onChange"),0<t.length&&(r=new u4("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var kb=null,yw=null;function Yle(e){XW(e,0)}function SC(e){var t=xv(e);if(lW(t))return e}function Jle(e,t){if(e==="change")return t}var $W=!1;if(Dm){var fA;if(Dm){var mA="oninput"in document;if(!mA){var lL=document.createElement("div");lL.setAttribute("oninput","return;"),mA=typeof lL.oninput=="function"}fA=mA}else fA=!1;$W=fA&&(!document.documentMode||9<document.documentMode)}function cL(){kb&&(kb.detachEvent("onpropertychange",BW),yw=kb=null)}function BW(e){if(e.propertyName==="value"&&SC(yw)){var t=[];LW(t,yw,e,s4(e)),yW(Yle,t)}}function Qle(e,t,r){e==="focusin"?(cL(),kb=t,yw=r,kb.attachEvent("onpropertychange",BW)):e==="focusout"&&cL()}function Zle(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return SC(yw)}function ece(e,t){if(e==="click")return SC(t)}function tce(e,t){if(e==="input"||e==="change")return SC(t)}function rce(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var of=typeof Object.is=="function"?Object.is:rce;function bw(e,t){if(of(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!Vk.call(t,s)||!of(e[s],t[s]))return!1}return!0}function dL(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function uL(e,t){var r=dL(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=dL(r)}}function qW(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qW(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function zW(){for(var e=window,t=H_();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=H_(e.document)}return t}function h4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function nce(e){var t=zW(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&qW(r.ownerDocument.documentElement,r)){if(n!==null&&h4(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,o=Math.min(n.start,s);n=n.end===void 0?o:Math.min(n.end,s),!e.extend&&o>n&&(s=n,n=o,o=s),s=uL(r,o);var i=uL(r,n);s&&i&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ace=Dm&&"documentMode"in document&&11>=document.documentMode,pv=null,cI=null,Ib=null,dI=!1;function fL(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;dI||pv==null||pv!==H_(n)||(n=pv,"selectionStart"in n&&h4(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Ib&&bw(Ib,n)||(Ib=n,n=Z_(cI,"onSelect"),0<n.length&&(t=new u4("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=pv)))}function e2(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var gv={animationend:e2("Animation","AnimationEnd"),animationiteration:e2("Animation","AnimationIteration"),animationstart:e2("Animation","AnimationStart"),transitionend:e2("Transition","TransitionEnd")},hA={},UW={};Dm&&(UW=document.createElement("div").style,"AnimationEvent"in window||(delete gv.animationend.animation,delete gv.animationiteration.animation,delete gv.animationstart.animation),"TransitionEvent"in window||delete gv.transitionend.transition);function CC(e){if(hA[e])return hA[e];if(!gv[e])return e;var t=gv[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in UW)return hA[e]=t[r];return e}var VW=CC("animationend"),WW=CC("animationiteration"),HW=CC("animationstart"),GW=CC("transitionend"),KW=new Map,mL="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cp(e,t){KW.set(e,t),mx(t,[e])}for(var pA=0;pA<mL.length;pA++){var gA=mL[pA],sce=gA.toLowerCase(),oce=gA[0].toUpperCase()+gA.slice(1);Cp(sce,"on"+oce)}Cp(VW,"onAnimationEnd");Cp(WW,"onAnimationIteration");Cp(HW,"onAnimationStart");Cp("dblclick","onDoubleClick");Cp("focusin","onFocus");Cp("focusout","onBlur");Cp(GW,"onTransitionEnd");n0("onMouseEnter",["mouseout","mouseover"]);n0("onMouseLeave",["mouseout","mouseover"]);n0("onPointerEnter",["pointerout","pointerover"]);n0("onPointerLeave",["pointerout","pointerover"]);mx("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));mx("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));mx("onBeforeInput",["compositionend","keypress","textInput","paste"]);mx("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));mx("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));mx("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ice=new Set("cancel close invalid load scroll toggle".split(" ").concat(vb));function hL(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,sle(n,t,void 0,e),e.currentTarget=null}function XW(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var i=n.length-1;0<=i;i--){var l=n[i],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==o&&s.isPropagationStopped())break e;hL(s,l,d),o=c}else for(i=0;i<n.length;i++){if(l=n[i],c=l.instance,d=l.currentTarget,l=l.listener,c!==o&&s.isPropagationStopped())break e;hL(s,l,d),o=c}}}if(K_)throw e=sI,K_=!1,sI=null,e}function Fo(e,t){var r=t[pI];r===void 0&&(r=t[pI]=new Set);var n=e+"__bubble";r.has(n)||(YW(t,e,2,!1),r.add(n))}function xA(e,t,r){var n=0;t&&(n|=4),YW(r,e,n,t)}var t2="_reactListening"+Math.random().toString(36).slice(2);function ww(e){if(!e[t2]){e[t2]=!0,nW.forEach(function(r){r!=="selectionchange"&&(ice.has(r)||xA(r,!1,e),xA(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[t2]||(t[t2]=!0,xA("selectionchange",!1,t))}}function YW(e,t,r,n){switch(TW(t)){case 1:var s=wle;break;case 4:s=jle;break;default:s=c4}r=s.bind(null,t,r,e),s=void 0,!aI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function vA(e,t,r,n,s){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var l=n.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(i===4)for(i=n.return;i!==null;){var c=i.tag;if((c===3||c===4)&&(c=i.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;i=i.return}for(;l!==null;){if(i=hg(l),i===null)return;if(c=i.tag,c===5||c===6){n=o=i;continue e}l=l.parentNode}}n=n.return}yW(function(){var d=o,u=s4(r),f=[];e:{var h=KW.get(e);if(h!==void 0){var m=u4,x=e;switch(e){case"keypress":if(x_(r)===0)break e;case"keydown":case"keyup":m=Fle;break;case"focusin":x="focus",m=uA;break;case"focusout":x="blur",m=uA;break;case"beforeblur":case"afterblur":m=uA;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=rL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Sle;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Ble;break;case VW:case WW:case HW:m=Ale;break;case GW:m=zle;break;case"scroll":m=_le;break;case"wheel":m=Vle;break;case"copy":case"cut":case"paste":m=kle;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=aL}var g=(t&4)!==0,v=!g&&e==="scroll",y=g?h!==null?h+"Capture":null:h;g=[];for(var b=d,w;b!==null;){w=b;var j=w.stateNode;if(w.tag===5&&j!==null&&(w=j,y!==null&&(j=pw(b,y),j!=null&&g.push(jw(b,j,w)))),v)break;b=b.return}0<g.length&&(h=new m(h,x,null,r,u),f.push({event:h,listeners:g}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",h&&r!==rI&&(x=r.relatedTarget||r.fromElement)&&(hg(x)||x[Mm]))break e;if((m||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,m?(x=r.relatedTarget||r.toElement,m=d,x=x?hg(x):null,x!==null&&(v=hx(x),x!==v||x.tag!==5&&x.tag!==6)&&(x=null)):(m=null,x=d),m!==x)){if(g=rL,j="onMouseLeave",y="onMouseEnter",b="mouse",(e==="pointerout"||e==="pointerover")&&(g=aL,j="onPointerLeave",y="onPointerEnter",b="pointer"),v=m==null?h:xv(m),w=x==null?h:xv(x),h=new g(j,b+"leave",m,r,u),h.target=v,h.relatedTarget=w,j=null,hg(u)===d&&(g=new g(y,b+"enter",x,r,u),g.target=w,g.relatedTarget=v,j=g),v=j,m&&x)t:{for(g=m,y=x,b=0,w=g;w;w=Ix(w))b++;for(w=0,j=y;j;j=Ix(j))w++;for(;0<b-w;)g=Ix(g),b--;for(;0<w-b;)y=Ix(y),w--;for(;b--;){if(g===y||y!==null&&g===y.alternate)break t;g=Ix(g),y=Ix(y)}g=null}else g=null;m!==null&&pL(f,h,m,g,!1),x!==null&&v!==null&&pL(f,v,x,g,!0)}}e:{if(h=d?xv(d):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var _=Jle;else if(iL(h))if($W)_=tce;else{_=Zle;var C=Qle}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(_=ece);if(_&&(_=_(e,d))){LW(f,_,r,u);break e}C&&C(e,h,d),e==="focusout"&&(C=h._wrapperState)&&C.controlled&&h.type==="number"&&Jk(h,"number",h.value)}switch(C=d?xv(d):window,e){case"focusin":(iL(C)||C.contentEditable==="true")&&(pv=C,cI=d,Ib=null);break;case"focusout":Ib=cI=pv=null;break;case"mousedown":dI=!0;break;case"contextmenu":case"mouseup":case"dragend":dI=!1,fL(f,r,u);break;case"selectionchange":if(ace)break;case"keydown":case"keyup":fL(f,r,u)}var A;if(m4)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else hv?RW(e,r)&&(S="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(S="onCompositionStart");S&&(MW&&r.locale!=="ko"&&(hv||S!=="onCompositionStart"?S==="onCompositionEnd"&&hv&&(A=DW()):(Th=u,d4="value"in Th?Th.value:Th.textContent,hv=!0)),C=Z_(d,S),0<C.length&&(S=new nL(S,e,null,r,u),f.push({event:S,listeners:C}),A?S.data=A:(A=FW(r),A!==null&&(S.data=A)))),(A=Hle?Gle(e,r):Kle(e,r))&&(d=Z_(d,"onBeforeInput"),0<d.length&&(u=new nL("onBeforeInput","beforeinput",null,r,u),f.push({event:u,listeners:d}),u.data=A))}XW(f,t)})}function jw(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Z_(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=pw(e,r),o!=null&&n.unshift(jw(e,o,s)),o=pw(e,t),o!=null&&n.push(jw(e,o,s))),e=e.return}return n}function Ix(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pL(e,t,r,n,s){for(var o=t._reactName,i=[];r!==null&&r!==n;){var l=r,c=l.alternate,d=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&d!==null&&(l=d,s?(c=pw(r,o),c!=null&&i.unshift(jw(r,c,l))):s||(c=pw(r,o),c!=null&&i.push(jw(r,c,l)))),r=r.return}i.length!==0&&e.push({event:t,listeners:i})}var lce=/\r\n?/g,cce=/\u0000|\uFFFD/g;function gL(e){return(typeof e=="string"?e:""+e).replace(lce,`
`).replace(cce,"")}function r2(e,t,r){if(t=gL(t),gL(e)!==t&&r)throw Error(Fn(425))}function eN(){}var uI=null,fI=null;function mI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var hI=typeof setTimeout=="function"?setTimeout:void 0,dce=typeof clearTimeout=="function"?clearTimeout:void 0,xL=typeof Promise=="function"?Promise:void 0,uce=typeof queueMicrotask=="function"?queueMicrotask:typeof xL<"u"?function(e){return xL.resolve(null).then(e).catch(fce)}:hI;function fce(e){setTimeout(function(){throw e})}function yA(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),vw(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);vw(t)}function Gh(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function vL(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var ey=Math.random().toString(36).slice(2),Af="__reactFiber$"+ey,_w="__reactProps$"+ey,Mm="__reactContainer$"+ey,pI="__reactEvents$"+ey,mce="__reactListeners$"+ey,hce="__reactHandles$"+ey;function hg(e){var t=e[Af];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Mm]||r[Af]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=vL(e);e!==null;){if(r=e[Af])return r;e=vL(e)}return t}e=r,r=e.parentNode}return null}function G1(e){return e=e[Af]||e[Mm],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function xv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Fn(33))}function PC(e){return e[_w]||null}var gI=[],vv=-1;function Pp(e){return{current:e}}function qo(e){0>vv||(e.current=gI[vv],gI[vv]=null,vv--)}function Eo(e,t){vv++,gI[vv]=e.current,e.current=t}var hp={},Zl=Pp(hp),Hc=Pp(!1),Wg=hp;function a0(e,t){var r=e.type.contextTypes;if(!r)return hp;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in r)s[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Gc(e){return e=e.childContextTypes,e!=null}function tN(){qo(Hc),qo(Zl)}function yL(e,t,r){if(Zl.current!==hp)throw Error(Fn(168));Eo(Zl,t),Eo(Hc,r)}function JW(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(Fn(108,Qie(e)||"Unknown",s));return ni({},r,n)}function rN(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||hp,Wg=Zl.current,Eo(Zl,e),Eo(Hc,Hc.current),!0}function bL(e,t,r){var n=e.stateNode;if(!n)throw Error(Fn(169));r?(e=JW(e,t,Wg),n.__reactInternalMemoizedMergedChildContext=e,qo(Hc),qo(Zl),Eo(Zl,e)):qo(Hc),Eo(Hc,r)}var vm=null,AC=!1,bA=!1;function QW(e){vm===null?vm=[e]:vm.push(e)}function pce(e){AC=!0,QW(e)}function Ap(){if(!bA&&vm!==null){bA=!0;var e=0,t=uo;try{var r=vm;for(uo=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}vm=null,AC=!1}catch(s){throw vm!==null&&(vm=vm.slice(e+1)),_W(o4,Ap),s}finally{uo=t,bA=!1}}return null}var yv=[],bv=0,nN=null,aN=0,tu=[],ru=0,Hg=null,jm=1,_m="";function Qp(e,t){yv[bv++]=aN,yv[bv++]=nN,nN=e,aN=t}function ZW(e,t,r){tu[ru++]=jm,tu[ru++]=_m,tu[ru++]=Hg,Hg=e;var n=jm;e=_m;var s=32-tf(n)-1;n&=~(1<<s),r+=1;var o=32-tf(t)+s;if(30<o){var i=s-s%5;o=(n&(1<<i)-1).toString(32),n>>=i,s-=i,jm=1<<32-tf(t)+s|r<<s|n,_m=o+e}else jm=1<<o|r<<s|n,_m=e}function p4(e){e.return!==null&&(Qp(e,1),ZW(e,1,0))}function g4(e){for(;e===nN;)nN=yv[--bv],yv[bv]=null,aN=yv[--bv],yv[bv]=null;for(;e===Hg;)Hg=tu[--ru],tu[ru]=null,_m=tu[--ru],tu[ru]=null,jm=tu[--ru],tu[ru]=null}var Ed=null,_d=null,Wo=!1,Ku=null;function eH(e,t){var r=uu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function wL(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ed=e,_d=Gh(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ed=e,_d=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Hg!==null?{id:jm,overflow:_m}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=uu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Ed=e,_d=null,!0):!1;default:return!1}}function xI(e){return(e.mode&1)!==0&&(e.flags&128)===0}function vI(e){if(Wo){var t=_d;if(t){var r=t;if(!wL(e,t)){if(xI(e))throw Error(Fn(418));t=Gh(r.nextSibling);var n=Ed;t&&wL(e,t)?eH(n,r):(e.flags=e.flags&-4097|2,Wo=!1,Ed=e)}}else{if(xI(e))throw Error(Fn(418));e.flags=e.flags&-4097|2,Wo=!1,Ed=e}}}function jL(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ed=e}function n2(e){if(e!==Ed)return!1;if(!Wo)return jL(e),Wo=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!mI(e.type,e.memoizedProps)),t&&(t=_d)){if(xI(e))throw tH(),Error(Fn(418));for(;t;)eH(e,t),t=Gh(t.nextSibling)}if(jL(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Fn(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){_d=Gh(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}_d=null}}else _d=Ed?Gh(e.stateNode.nextSibling):null;return!0}function tH(){for(var e=_d;e;)e=Gh(e.nextSibling)}function s0(){_d=Ed=null,Wo=!1}function x4(e){Ku===null?Ku=[e]:Ku.push(e)}var gce=Km.ReactCurrentBatchConfig;function By(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Fn(309));var n=r.stateNode}if(!n)throw Error(Fn(147,e));var s=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(i){var l=s.refs;i===null?delete l[o]:l[o]=i},t._stringRef=o,t)}if(typeof e!="string")throw Error(Fn(284));if(!r._owner)throw Error(Fn(290,e))}return e}function a2(e,t){throw e=Object.prototype.toString.call(t),Error(Fn(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _L(e){var t=e._init;return t(e._payload)}function rH(e){function t(y,b){if(e){var w=y.deletions;w===null?(y.deletions=[b],y.flags|=16):w.push(b)}}function r(y,b){if(!e)return null;for(;b!==null;)t(y,b),b=b.sibling;return null}function n(y,b){for(y=new Map;b!==null;)b.key!==null?y.set(b.key,b):y.set(b.index,b),b=b.sibling;return y}function s(y,b){return y=Jh(y,b),y.index=0,y.sibling=null,y}function o(y,b,w){return y.index=w,e?(w=y.alternate,w!==null?(w=w.index,w<b?(y.flags|=2,b):w):(y.flags|=2,b)):(y.flags|=1048576,b)}function i(y){return e&&y.alternate===null&&(y.flags|=2),y}function l(y,b,w,j){return b===null||b.tag!==6?(b=PA(w,y.mode,j),b.return=y,b):(b=s(b,w),b.return=y,b)}function c(y,b,w,j){var _=w.type;return _===mv?u(y,b,w.props.children,j,w.key):b!==null&&(b.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===wh&&_L(_)===b.type)?(j=s(b,w.props),j.ref=By(y,b,w),j.return=y,j):(j=N_(w.type,w.key,w.props,null,y.mode,j),j.ref=By(y,b,w),j.return=y,j)}function d(y,b,w,j){return b===null||b.tag!==4||b.stateNode.containerInfo!==w.containerInfo||b.stateNode.implementation!==w.implementation?(b=AA(w,y.mode,j),b.return=y,b):(b=s(b,w.children||[]),b.return=y,b)}function u(y,b,w,j,_){return b===null||b.tag!==7?(b=Ig(w,y.mode,j,_),b.return=y,b):(b=s(b,w),b.return=y,b)}function f(y,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return b=PA(""+b,y.mode,w),b.return=y,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Gj:return w=N_(b.type,b.key,b.props,null,y.mode,w),w.ref=By(y,null,b),w.return=y,w;case fv:return b=AA(b,y.mode,w),b.return=y,b;case wh:var j=b._init;return f(y,j(b._payload),w)}if(gb(b)||My(b))return b=Ig(b,y.mode,w,null),b.return=y,b;a2(y,b)}return null}function h(y,b,w,j){var _=b!==null?b.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return _!==null?null:l(y,b,""+w,j);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Gj:return w.key===_?c(y,b,w,j):null;case fv:return w.key===_?d(y,b,w,j):null;case wh:return _=w._init,h(y,b,_(w._payload),j)}if(gb(w)||My(w))return _!==null?null:u(y,b,w,j,null);a2(y,w)}return null}function m(y,b,w,j,_){if(typeof j=="string"&&j!==""||typeof j=="number")return y=y.get(w)||null,l(b,y,""+j,_);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Gj:return y=y.get(j.key===null?w:j.key)||null,c(b,y,j,_);case fv:return y=y.get(j.key===null?w:j.key)||null,d(b,y,j,_);case wh:var C=j._init;return m(y,b,w,C(j._payload),_)}if(gb(j)||My(j))return y=y.get(w)||null,u(b,y,j,_,null);a2(b,j)}return null}function x(y,b,w,j){for(var _=null,C=null,A=b,S=b=0,P=null;A!==null&&S<w.length;S++){A.index>S?(P=A,A=null):P=A.sibling;var M=h(y,A,w[S],j);if(M===null){A===null&&(A=P);break}e&&A&&M.alternate===null&&t(y,A),b=o(M,b,S),C===null?_=M:C.sibling=M,C=M,A=P}if(S===w.length)return r(y,A),Wo&&Qp(y,S),_;if(A===null){for(;S<w.length;S++)A=f(y,w[S],j),A!==null&&(b=o(A,b,S),C===null?_=A:C.sibling=A,C=A);return Wo&&Qp(y,S),_}for(A=n(y,A);S<w.length;S++)P=m(A,y,S,w[S],j),P!==null&&(e&&P.alternate!==null&&A.delete(P.key===null?S:P.key),b=o(P,b,S),C===null?_=P:C.sibling=P,C=P);return e&&A.forEach(function(O){return t(y,O)}),Wo&&Qp(y,S),_}function g(y,b,w,j){var _=My(w);if(typeof _!="function")throw Error(Fn(150));if(w=_.call(w),w==null)throw Error(Fn(151));for(var C=_=null,A=b,S=b=0,P=null,M=w.next();A!==null&&!M.done;S++,M=w.next()){A.index>S?(P=A,A=null):P=A.sibling;var O=h(y,A,M.value,j);if(O===null){A===null&&(A=P);break}e&&A&&O.alternate===null&&t(y,A),b=o(O,b,S),C===null?_=O:C.sibling=O,C=O,A=P}if(M.done)return r(y,A),Wo&&Qp(y,S),_;if(A===null){for(;!M.done;S++,M=w.next())M=f(y,M.value,j),M!==null&&(b=o(M,b,S),C===null?_=M:C.sibling=M,C=M);return Wo&&Qp(y,S),_}for(A=n(y,A);!M.done;S++,M=w.next())M=m(A,y,S,M.value,j),M!==null&&(e&&M.alternate!==null&&A.delete(M.key===null?S:M.key),b=o(M,b,S),C===null?_=M:C.sibling=M,C=M);return e&&A.forEach(function(I){return t(y,I)}),Wo&&Qp(y,S),_}function v(y,b,w,j){if(typeof w=="object"&&w!==null&&w.type===mv&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Gj:e:{for(var _=w.key,C=b;C!==null;){if(C.key===_){if(_=w.type,_===mv){if(C.tag===7){r(y,C.sibling),b=s(C,w.props.children),b.return=y,y=b;break e}}else if(C.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===wh&&_L(_)===C.type){r(y,C.sibling),b=s(C,w.props),b.ref=By(y,C,w),b.return=y,y=b;break e}r(y,C);break}else t(y,C);C=C.sibling}w.type===mv?(b=Ig(w.props.children,y.mode,j,w.key),b.return=y,y=b):(j=N_(w.type,w.key,w.props,null,y.mode,j),j.ref=By(y,b,w),j.return=y,y=j)}return i(y);case fv:e:{for(C=w.key;b!==null;){if(b.key===C)if(b.tag===4&&b.stateNode.containerInfo===w.containerInfo&&b.stateNode.implementation===w.implementation){r(y,b.sibling),b=s(b,w.children||[]),b.return=y,y=b;break e}else{r(y,b);break}else t(y,b);b=b.sibling}b=AA(w,y.mode,j),b.return=y,y=b}return i(y);case wh:return C=w._init,v(y,b,C(w._payload),j)}if(gb(w))return x(y,b,w,j);if(My(w))return g(y,b,w,j);a2(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,b!==null&&b.tag===6?(r(y,b.sibling),b=s(b,w),b.return=y,y=b):(r(y,b),b=PA(w,y.mode,j),b.return=y,y=b),i(y)):r(y,b)}return v}var o0=rH(!0),nH=rH(!1),sN=Pp(null),oN=null,wv=null,v4=null;function y4(){v4=wv=oN=null}function b4(e){var t=sN.current;qo(sN),e._currentValue=t}function yI(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Bv(e,t){oN=e,v4=wv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Uc=!0),e.firstContext=null)}function bu(e){var t=e._currentValue;if(v4!==e)if(e={context:e,memoizedValue:t,next:null},wv===null){if(oN===null)throw Error(Fn(308));wv=e,oN.dependencies={lanes:0,firstContext:e}}else wv=wv.next=e;return t}var pg=null;function w4(e){pg===null?pg=[e]:pg.push(e)}function aH(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,w4(t)):(r.next=s.next,s.next=r),t.interleaved=r,Rm(e,n)}function Rm(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var jh=!1;function j4(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sH(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Em(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Kh(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ws&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,Rm(e,r)}return s=n.interleaved,s===null?(t.next=t,w4(n)):(t.next=s.next,s.next=t),n.interleaved=t,Rm(e,r)}function v_(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,i4(e,r)}}function NL(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var i={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?s=o=i:o=o.next=i,r=r.next}while(r!==null);o===null?s=o=t:o=o.next=t}else s=o=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function iN(e,t,r,n){var s=e.updateQueue;jh=!1;var o=s.firstBaseUpdate,i=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,i===null?o=d:i.next=d,i=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==i&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(o!==null){var f=s.baseState;i=0,u=d=c=null,l=o;do{var h=l.lane,m=l.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:m,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var x=e,g=l;switch(h=t,m=r,g.tag){case 1:if(x=g.payload,typeof x=="function"){f=x.call(m,f,h);break e}f=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,h=typeof x=="function"?x.call(m,f,h):x,h==null)break e;f=ni({},f,h);break e;case 2:jh=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,h=s.effects,h===null?s.effects=[l]:h.push(l))}else m={eventTime:m,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=m,c=f):u=u.next=m,i|=h;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;h=l,l=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(u===null&&(c=f),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,t=s.shared.interleaved,t!==null){s=t;do i|=s.lane,s=s.next;while(s!==t)}else o===null&&(s.shared.lanes=0);Kg|=i,e.lanes=i,e.memoizedState=f}}function SL(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(Fn(191,s));s.call(n)}}}var K1={},zf=Pp(K1),Nw=Pp(K1),Sw=Pp(K1);function gg(e){if(e===K1)throw Error(Fn(174));return e}function _4(e,t){switch(Eo(Sw,t),Eo(Nw,e),Eo(zf,K1),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Zk(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Zk(t,e)}qo(zf),Eo(zf,t)}function i0(){qo(zf),qo(Nw),qo(Sw)}function oH(e){gg(Sw.current);var t=gg(zf.current),r=Zk(t,e.type);t!==r&&(Eo(Nw,e),Eo(zf,r))}function N4(e){Nw.current===e&&(qo(zf),qo(Nw))}var Xo=Pp(0);function lN(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var wA=[];function S4(){for(var e=0;e<wA.length;e++)wA[e]._workInProgressVersionPrimary=null;wA.length=0}var y_=Km.ReactCurrentDispatcher,jA=Km.ReactCurrentBatchConfig,Gg=0,ti=null,zi=null,sl=null,cN=!1,Ob=!1,Cw=0,xce=0;function Bl(){throw Error(Fn(321))}function C4(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!of(e[r],t[r]))return!1;return!0}function P4(e,t,r,n,s,o){if(Gg=o,ti=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,y_.current=e===null||e.memoizedState===null?wce:jce,e=r(n,s),Ob){o=0;do{if(Ob=!1,Cw=0,25<=o)throw Error(Fn(301));o+=1,sl=zi=null,t.updateQueue=null,y_.current=_ce,e=r(n,s)}while(Ob)}if(y_.current=dN,t=zi!==null&&zi.next!==null,Gg=0,sl=zi=ti=null,cN=!1,t)throw Error(Fn(300));return e}function A4(){var e=Cw!==0;return Cw=0,e}function Cf(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sl===null?ti.memoizedState=sl=e:sl=sl.next=e,sl}function wu(){if(zi===null){var e=ti.alternate;e=e!==null?e.memoizedState:null}else e=zi.next;var t=sl===null?ti.memoizedState:sl.next;if(t!==null)sl=t,zi=e;else{if(e===null)throw Error(Fn(310));zi=e,e={memoizedState:zi.memoizedState,baseState:zi.baseState,baseQueue:zi.baseQueue,queue:zi.queue,next:null},sl===null?ti.memoizedState=sl=e:sl=sl.next=e}return sl}function Pw(e,t){return typeof t=="function"?t(e):t}function _A(e){var t=wu(),r=t.queue;if(r===null)throw Error(Fn(311));r.lastRenderedReducer=e;var n=zi,s=n.baseQueue,o=r.pending;if(o!==null){if(s!==null){var i=s.next;s.next=o.next,o.next=i}n.baseQueue=s=o,r.pending=null}if(s!==null){o=s.next,n=n.baseState;var l=i=null,c=null,d=o;do{var u=d.lane;if((Gg&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var f={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,i=n):c=c.next=f,ti.lanes|=u,Kg|=u}d=d.next}while(d!==null&&d!==o);c===null?i=n:c.next=l,of(n,t.memoizedState)||(Uc=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=c,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do o=s.lane,ti.lanes|=o,Kg|=o,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function NA(e){var t=wu(),r=t.queue;if(r===null)throw Error(Fn(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,o=t.memoizedState;if(s!==null){r.pending=null;var i=s=s.next;do o=e(o,i.action),i=i.next;while(i!==s);of(o,t.memoizedState)||(Uc=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function iH(){}function lH(e,t){var r=ti,n=wu(),s=t(),o=!of(n.memoizedState,s);if(o&&(n.memoizedState=s,Uc=!0),n=n.queue,E4(uH.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||sl!==null&&sl.memoizedState.tag&1){if(r.flags|=2048,Aw(9,dH.bind(null,r,n,s,t),void 0,null),dl===null)throw Error(Fn(349));Gg&30||cH(r,t,s)}return s}function cH(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=ti.updateQueue,t===null?(t={lastEffect:null,stores:null},ti.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function dH(e,t,r,n){t.value=r,t.getSnapshot=n,fH(t)&&mH(e)}function uH(e,t,r){return r(function(){fH(t)&&mH(e)})}function fH(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!of(e,r)}catch{return!0}}function mH(e){var t=Rm(e,1);t!==null&&rf(t,e,1,-1)}function CL(e){var t=Cf();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Pw,lastRenderedState:e},t.queue=e,e=e.dispatch=bce.bind(null,ti,e),[t.memoizedState,e]}function Aw(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=ti.updateQueue,t===null?(t={lastEffect:null,stores:null},ti.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function hH(){return wu().memoizedState}function b_(e,t,r,n){var s=Cf();ti.flags|=e,s.memoizedState=Aw(1|t,r,void 0,n===void 0?null:n)}function EC(e,t,r,n){var s=wu();n=n===void 0?null:n;var o=void 0;if(zi!==null){var i=zi.memoizedState;if(o=i.destroy,n!==null&&C4(n,i.deps)){s.memoizedState=Aw(t,r,o,n);return}}ti.flags|=e,s.memoizedState=Aw(1|t,r,o,n)}function PL(e,t){return b_(8390656,8,e,t)}function E4(e,t){return EC(2048,8,e,t)}function pH(e,t){return EC(4,2,e,t)}function gH(e,t){return EC(4,4,e,t)}function xH(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function vH(e,t,r){return r=r!=null?r.concat([e]):null,EC(4,4,xH.bind(null,t,e),r)}function k4(){}function yH(e,t){var r=wu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&C4(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function bH(e,t){var r=wu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&C4(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function wH(e,t,r){return Gg&21?(of(r,t)||(r=CW(),ti.lanes|=r,Kg|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Uc=!0),e.memoizedState=r)}function vce(e,t){var r=uo;uo=r!==0&&4>r?r:4,e(!0);var n=jA.transition;jA.transition={};try{e(!1),t()}finally{uo=r,jA.transition=n}}function jH(){return wu().memoizedState}function yce(e,t,r){var n=Yh(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},_H(e))NH(t,r);else if(r=aH(e,t,r,n),r!==null){var s=Nc();rf(r,e,n,s),SH(r,t,n)}}function bce(e,t,r){var n=Yh(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(_H(e))NH(t,s);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var i=t.lastRenderedState,l=o(i,r);if(s.hasEagerState=!0,s.eagerState=l,of(l,i)){var c=t.interleaved;c===null?(s.next=s,w4(t)):(s.next=c.next,c.next=s),t.interleaved=s;return}}catch{}finally{}r=aH(e,t,s,n),r!==null&&(s=Nc(),rf(r,e,n,s),SH(r,t,n))}}function _H(e){var t=e.alternate;return e===ti||t!==null&&t===ti}function NH(e,t){Ob=cN=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function SH(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,i4(e,r)}}var dN={readContext:bu,useCallback:Bl,useContext:Bl,useEffect:Bl,useImperativeHandle:Bl,useInsertionEffect:Bl,useLayoutEffect:Bl,useMemo:Bl,useReducer:Bl,useRef:Bl,useState:Bl,useDebugValue:Bl,useDeferredValue:Bl,useTransition:Bl,useMutableSource:Bl,useSyncExternalStore:Bl,useId:Bl,unstable_isNewReconciler:!1},wce={readContext:bu,useCallback:function(e,t){return Cf().memoizedState=[e,t===void 0?null:t],e},useContext:bu,useEffect:PL,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,b_(4194308,4,xH.bind(null,t,e),r)},useLayoutEffect:function(e,t){return b_(4194308,4,e,t)},useInsertionEffect:function(e,t){return b_(4,2,e,t)},useMemo:function(e,t){var r=Cf();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Cf();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=yce.bind(null,ti,e),[n.memoizedState,e]},useRef:function(e){var t=Cf();return e={current:e},t.memoizedState=e},useState:CL,useDebugValue:k4,useDeferredValue:function(e){return Cf().memoizedState=e},useTransition:function(){var e=CL(!1),t=e[0];return e=vce.bind(null,e[1]),Cf().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=ti,s=Cf();if(Wo){if(r===void 0)throw Error(Fn(407));r=r()}else{if(r=t(),dl===null)throw Error(Fn(349));Gg&30||cH(n,t,r)}s.memoizedState=r;var o={value:r,getSnapshot:t};return s.queue=o,PL(uH.bind(null,n,o,e),[e]),n.flags|=2048,Aw(9,dH.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=Cf(),t=dl.identifierPrefix;if(Wo){var r=_m,n=jm;r=(n&~(1<<32-tf(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=Cw++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=xce++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},jce={readContext:bu,useCallback:yH,useContext:bu,useEffect:E4,useImperativeHandle:vH,useInsertionEffect:pH,useLayoutEffect:gH,useMemo:bH,useReducer:_A,useRef:hH,useState:function(){return _A(Pw)},useDebugValue:k4,useDeferredValue:function(e){var t=wu();return wH(t,zi.memoizedState,e)},useTransition:function(){var e=_A(Pw)[0],t=wu().memoizedState;return[e,t]},useMutableSource:iH,useSyncExternalStore:lH,useId:jH,unstable_isNewReconciler:!1},_ce={readContext:bu,useCallback:yH,useContext:bu,useEffect:E4,useImperativeHandle:vH,useInsertionEffect:pH,useLayoutEffect:gH,useMemo:bH,useReducer:NA,useRef:hH,useState:function(){return NA(Pw)},useDebugValue:k4,useDeferredValue:function(e){var t=wu();return zi===null?t.memoizedState=e:wH(t,zi.memoizedState,e)},useTransition:function(){var e=NA(Pw)[0],t=wu().memoizedState;return[e,t]},useMutableSource:iH,useSyncExternalStore:lH,useId:jH,unstable_isNewReconciler:!1};function Uu(e,t){if(e&&e.defaultProps){t=ni({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function bI(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:ni({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var kC={isMounted:function(e){return(e=e._reactInternals)?hx(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Nc(),s=Yh(e),o=Em(n,s);o.payload=t,r!=null&&(o.callback=r),t=Kh(e,o,s),t!==null&&(rf(t,e,s,n),v_(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Nc(),s=Yh(e),o=Em(n,s);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=Kh(e,o,s),t!==null&&(rf(t,e,s,n),v_(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Nc(),n=Yh(e),s=Em(r,n);s.tag=2,t!=null&&(s.callback=t),t=Kh(e,s,n),t!==null&&(rf(t,e,n,r),v_(t,e,n))}};function AL(e,t,r,n,s,o,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,i):t.prototype&&t.prototype.isPureReactComponent?!bw(r,n)||!bw(s,o):!0}function CH(e,t,r){var n=!1,s=hp,o=t.contextType;return typeof o=="object"&&o!==null?o=bu(o):(s=Gc(t)?Wg:Zl.current,n=t.contextTypes,o=(n=n!=null)?a0(e,s):hp),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=kC,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=o),t}function EL(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&kC.enqueueReplaceState(t,t.state,null)}function wI(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},j4(e);var o=t.contextType;typeof o=="object"&&o!==null?s.context=bu(o):(o=Gc(t)?Wg:Zl.current,s.context=a0(e,o)),s.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(bI(e,t,o,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&kC.enqueueReplaceState(s,s.state,null),iN(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function l0(e,t){try{var r="",n=t;do r+=Jie(n),n=n.return;while(n);var s=r}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:s,digest:null}}function SA(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function jI(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Nce=typeof WeakMap=="function"?WeakMap:Map;function PH(e,t,r){r=Em(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){fN||(fN=!0,OI=n),jI(e,t)},r}function AH(e,t,r){r=Em(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){jI(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){jI(e,t),typeof n!="function"&&(Xh===null?Xh=new Set([this]):Xh.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),r}function kL(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Nce;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=Lce.bind(null,e,t,r),t.then(e,e))}function IL(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function OL(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Em(-1,1),t.tag=2,Kh(r,t,1))),r.lanes|=1),e)}var Sce=Km.ReactCurrentOwner,Uc=!1;function gc(e,t,r,n){t.child=e===null?nH(t,null,r,n):o0(t,e.child,r,n)}function TL(e,t,r,n,s){r=r.render;var o=t.ref;return Bv(t,s),n=P4(e,t,r,n,o,s),r=A4(),e!==null&&!Uc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Fm(e,t,s)):(Wo&&r&&p4(t),t.flags|=1,gc(e,t,n,s),t.child)}function DL(e,t,r,n,s){if(e===null){var o=r.type;return typeof o=="function"&&!L4(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,EH(e,t,o,n,s)):(e=N_(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&s)){var i=o.memoizedProps;if(r=r.compare,r=r!==null?r:bw,r(i,n)&&e.ref===t.ref)return Fm(e,t,s)}return t.flags|=1,e=Jh(o,n),e.ref=t.ref,e.return=t,t.child=e}function EH(e,t,r,n,s){if(e!==null){var o=e.memoizedProps;if(bw(o,n)&&e.ref===t.ref)if(Uc=!1,t.pendingProps=n=o,(e.lanes&s)!==0)e.flags&131072&&(Uc=!0);else return t.lanes=e.lanes,Fm(e,t,s)}return _I(e,t,r,n,s)}function kH(e,t,r){var n=t.pendingProps,s=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Eo(_v,vd),vd|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Eo(_v,vd),vd|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,Eo(_v,vd),vd|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,Eo(_v,vd),vd|=n;return gc(e,t,s,r),t.child}function IH(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function _I(e,t,r,n,s){var o=Gc(r)?Wg:Zl.current;return o=a0(t,o),Bv(t,s),r=P4(e,t,r,n,o,s),n=A4(),e!==null&&!Uc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Fm(e,t,s)):(Wo&&n&&p4(t),t.flags|=1,gc(e,t,r,s),t.child)}function ML(e,t,r,n,s){if(Gc(r)){var o=!0;rN(t)}else o=!1;if(Bv(t,s),t.stateNode===null)w_(e,t),CH(t,r,n),wI(t,r,n,s),n=!0;else if(e===null){var i=t.stateNode,l=t.memoizedProps;i.props=l;var c=i.context,d=r.contextType;typeof d=="object"&&d!==null?d=bu(d):(d=Gc(r)?Wg:Zl.current,d=a0(t,d));var u=r.getDerivedStateFromProps,f=typeof u=="function"||typeof i.getSnapshotBeforeUpdate=="function";f||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==n||c!==d)&&EL(t,i,n,d),jh=!1;var h=t.memoizedState;i.state=h,iN(t,n,i,s),c=t.memoizedState,l!==n||h!==c||Hc.current||jh?(typeof u=="function"&&(bI(t,r,u,n),c=t.memoizedState),(l=jh||AL(t,r,l,n,h,c,d))?(f||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),i.props=n,i.state=c,i.context=d,n=l):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{i=t.stateNode,sH(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:Uu(t.type,l),i.props=d,f=t.pendingProps,h=i.context,c=r.contextType,typeof c=="object"&&c!==null?c=bu(c):(c=Gc(r)?Wg:Zl.current,c=a0(t,c));var m=r.getDerivedStateFromProps;(u=typeof m=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==f||h!==c)&&EL(t,i,n,c),jh=!1,h=t.memoizedState,i.state=h,iN(t,n,i,s);var x=t.memoizedState;l!==f||h!==x||Hc.current||jh?(typeof m=="function"&&(bI(t,r,m,n),x=t.memoizedState),(d=jh||AL(t,r,d,n,h,x,c)||!1)?(u||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,x,c),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,x,c)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=x),i.props=n,i.state=x,i.context=c,n=d):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return NI(e,t,r,n,o,s)}function NI(e,t,r,n,s,o){IH(e,t);var i=(t.flags&128)!==0;if(!n&&!i)return s&&bL(t,r,!1),Fm(e,t,o);n=t.stateNode,Sce.current=t;var l=i&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&i?(t.child=o0(t,e.child,null,o),t.child=o0(t,null,l,o)):gc(e,t,l,o),t.memoizedState=n.state,s&&bL(t,r,!0),t.child}function OH(e){var t=e.stateNode;t.pendingContext?yL(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yL(e,t.context,!1),_4(e,t.containerInfo)}function RL(e,t,r,n,s){return s0(),x4(s),t.flags|=256,gc(e,t,r,n),t.child}var SI={dehydrated:null,treeContext:null,retryLane:0};function CI(e){return{baseLanes:e,cachePool:null,transitions:null}}function TH(e,t,r){var n=t.pendingProps,s=Xo.current,o=!1,i=(t.flags&128)!==0,l;if((l=i)||(l=e!==null&&e.memoizedState===null?!1:(s&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),Eo(Xo,s&1),e===null)return vI(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=n.children,e=n.fallback,o?(n=t.mode,o=t.child,i={mode:"hidden",children:i},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=TC(i,n,0,null),e=Ig(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=CI(r),t.memoizedState=SI,e):I4(t,i));if(s=e.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return Cce(e,t,i,n,l,s,r);if(o){o=n.fallback,i=t.mode,s=e.child,l=s.sibling;var c={mode:"hidden",children:n.children};return!(i&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=Jh(s,c),n.subtreeFlags=s.subtreeFlags&14680064),l!==null?o=Jh(l,o):(o=Ig(o,i,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,i=e.child.memoizedState,i=i===null?CI(r):{baseLanes:i.baseLanes|r,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~r,t.memoizedState=SI,n}return o=e.child,e=o.sibling,n=Jh(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function I4(e,t){return t=TC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function s2(e,t,r,n){return n!==null&&x4(n),o0(t,e.child,null,r),e=I4(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Cce(e,t,r,n,s,o,i){if(r)return t.flags&256?(t.flags&=-257,n=SA(Error(Fn(422))),s2(e,t,i,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,s=t.mode,n=TC({mode:"visible",children:n.children},s,0,null),o=Ig(o,s,i,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&o0(t,e.child,null,i),t.child.memoizedState=CI(i),t.memoizedState=SI,o);if(!(t.mode&1))return s2(e,t,i,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var l=n.dgst;return n=l,o=Error(Fn(419)),n=SA(o,n,void 0),s2(e,t,i,n)}if(l=(i&e.childLanes)!==0,Uc||l){if(n=dl,n!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|i)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,Rm(e,s),rf(n,e,s,-1))}return F4(),n=SA(Error(Fn(421))),s2(e,t,i,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=$ce.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,_d=Gh(s.nextSibling),Ed=t,Wo=!0,Ku=null,e!==null&&(tu[ru++]=jm,tu[ru++]=_m,tu[ru++]=Hg,jm=e.id,_m=e.overflow,Hg=t),t=I4(t,n.children),t.flags|=4096,t)}function FL(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),yI(e.return,t,r)}function CA(e,t,r,n,s){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=s)}function DH(e,t,r){var n=t.pendingProps,s=n.revealOrder,o=n.tail;if(gc(e,t,n.children,r),n=Xo.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&FL(e,r,t);else if(e.tag===19)FL(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Eo(Xo,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&lN(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),CA(t,!1,s,r,o);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&lN(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}CA(t,!0,r,null,o);break;case"together":CA(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function w_(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Fm(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Kg|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Fn(153));if(t.child!==null){for(e=t.child,r=Jh(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Jh(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Pce(e,t,r){switch(t.tag){case 3:OH(t),s0();break;case 5:oH(t);break;case 1:Gc(t.type)&&rN(t);break;case 4:_4(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;Eo(sN,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Eo(Xo,Xo.current&1),t.flags|=128,null):r&t.child.childLanes?TH(e,t,r):(Eo(Xo,Xo.current&1),e=Fm(e,t,r),e!==null?e.sibling:null);Eo(Xo,Xo.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return DH(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Eo(Xo,Xo.current),n)break;return null;case 22:case 23:return t.lanes=0,kH(e,t,r)}return Fm(e,t,r)}var MH,PI,RH,FH;MH=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};PI=function(){};RH=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,gg(zf.current);var o=null;switch(r){case"input":s=Xk(e,s),n=Xk(e,n),o=[];break;case"select":s=ni({},s,{value:void 0}),n=ni({},n,{value:void 0}),o=[];break;case"textarea":s=Qk(e,s),n=Qk(e,n),o=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=eN)}eI(r,n);var i;r=null;for(d in s)if(!n.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(i in l)l.hasOwnProperty(i)&&(r||(r={}),r[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(mw.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in n){var c=n[d];if(l=s?.[d],n.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(r||(r={}),r[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(r||(r={}),r[i]=c[i])}else r||(o||(o=[]),o.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(mw.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Fo("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}r&&(o=o||[]).push("style",r);var d=o;(t.updateQueue=d)&&(t.flags|=4)}};FH=function(e,t,r,n){r!==n&&(t.flags|=4)};function qy(e,t){if(!Wo)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function ql(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Ace(e,t,r){var n=t.pendingProps;switch(g4(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ql(t),null;case 1:return Gc(t.type)&&tN(),ql(t),null;case 3:return n=t.stateNode,i0(),qo(Hc),qo(Zl),S4(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(n2(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ku!==null&&(MI(Ku),Ku=null))),PI(e,t),ql(t),null;case 5:N4(t);var s=gg(Sw.current);if(r=t.type,e!==null&&t.stateNode!=null)RH(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Fn(166));return ql(t),null}if(e=gg(zf.current),n2(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[Af]=t,n[_w]=o,e=(t.mode&1)!==0,r){case"dialog":Fo("cancel",n),Fo("close",n);break;case"iframe":case"object":case"embed":Fo("load",n);break;case"video":case"audio":for(s=0;s<vb.length;s++)Fo(vb[s],n);break;case"source":Fo("error",n);break;case"img":case"image":case"link":Fo("error",n),Fo("load",n);break;case"details":Fo("toggle",n);break;case"input":HF(n,o),Fo("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Fo("invalid",n);break;case"textarea":KF(n,o),Fo("invalid",n)}eI(r,o),s=null;for(var i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="children"?typeof l=="string"?n.textContent!==l&&(o.suppressHydrationWarning!==!0&&r2(n.textContent,l,e),s=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&r2(n.textContent,l,e),s=["children",""+l]):mw.hasOwnProperty(i)&&l!=null&&i==="onScroll"&&Fo("scroll",n)}switch(r){case"input":Kj(n),GF(n,o,!0);break;case"textarea":Kj(n),XF(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=eN)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=uW(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=i.createElement(r,{is:n.is}):(e=i.createElement(r),r==="select"&&(i=e,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):e=i.createElementNS(e,r),e[Af]=t,e[_w]=n,MH(e,t,!1,!1),t.stateNode=e;e:{switch(i=tI(r,n),r){case"dialog":Fo("cancel",e),Fo("close",e),s=n;break;case"iframe":case"object":case"embed":Fo("load",e),s=n;break;case"video":case"audio":for(s=0;s<vb.length;s++)Fo(vb[s],e);s=n;break;case"source":Fo("error",e),s=n;break;case"img":case"image":case"link":Fo("error",e),Fo("load",e),s=n;break;case"details":Fo("toggle",e),s=n;break;case"input":HF(e,n),s=Xk(e,n),Fo("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=ni({},n,{value:void 0}),Fo("invalid",e);break;case"textarea":KF(e,n),s=Qk(e,n),Fo("invalid",e);break;default:s=n}eI(r,s),l=s;for(o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="style"?hW(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&fW(e,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&hw(e,c):typeof c=="number"&&hw(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(mw.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Fo("scroll",e):c!=null&&t4(e,o,c,i))}switch(r){case"input":Kj(e),GF(e,n,!1);break;case"textarea":Kj(e),XF(e);break;case"option":n.value!=null&&e.setAttribute("value",""+mp(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?Rv(e,!!n.multiple,o,!1):n.defaultValue!=null&&Rv(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=eN)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ql(t),null;case 6:if(e&&t.stateNode!=null)FH(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Fn(166));if(r=gg(Sw.current),gg(zf.current),n2(t)){if(n=t.stateNode,r=t.memoizedProps,n[Af]=t,(o=n.nodeValue!==r)&&(e=Ed,e!==null))switch(e.tag){case 3:r2(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&r2(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Af]=t,t.stateNode=n}return ql(t),null;case 13:if(qo(Xo),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Wo&&_d!==null&&t.mode&1&&!(t.flags&128))tH(),s0(),t.flags|=98560,o=!1;else if(o=n2(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(Fn(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Fn(317));o[Af]=t}else s0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ql(t),o=!1}else Ku!==null&&(MI(Ku),Ku=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Xo.current&1?Hi===0&&(Hi=3):F4())),t.updateQueue!==null&&(t.flags|=4),ql(t),null);case 4:return i0(),PI(e,t),e===null&&ww(t.stateNode.containerInfo),ql(t),null;case 10:return b4(t.type._context),ql(t),null;case 17:return Gc(t.type)&&tN(),ql(t),null;case 19:if(qo(Xo),o=t.memoizedState,o===null)return ql(t),null;if(n=(t.flags&128)!==0,i=o.rendering,i===null)if(n)qy(o,!1);else{if(Hi!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=lN(e),i!==null){for(t.flags|=128,qy(o,!1),n=i.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,e=i.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Eo(Xo,Xo.current&1|2),t.child}e=e.sibling}o.tail!==null&&gi()>c0&&(t.flags|=128,n=!0,qy(o,!1),t.lanes=4194304)}else{if(!n)if(e=lN(i),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),qy(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!Wo)return ql(t),null}else 2*gi()-o.renderingStartTime>c0&&r!==1073741824&&(t.flags|=128,n=!0,qy(o,!1),t.lanes=4194304);o.isBackwards?(i.sibling=t.child,t.child=i):(r=o.last,r!==null?r.sibling=i:t.child=i,o.last=i)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=gi(),t.sibling=null,r=Xo.current,Eo(Xo,n?r&1|2:r&1),t):(ql(t),null);case 22:case 23:return R4(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?vd&1073741824&&(ql(t),t.subtreeFlags&6&&(t.flags|=8192)):ql(t),null;case 24:return null;case 25:return null}throw Error(Fn(156,t.tag))}function Ece(e,t){switch(g4(t),t.tag){case 1:return Gc(t.type)&&tN(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return i0(),qo(Hc),qo(Zl),S4(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return N4(t),null;case 13:if(qo(Xo),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Fn(340));s0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return qo(Xo),null;case 4:return i0(),null;case 10:return b4(t.type._context),null;case 22:case 23:return R4(),null;case 24:return null;default:return null}}var o2=!1,Xl=!1,kce=typeof WeakSet=="function"?WeakSet:Set,ga=null;function jv(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ci(e,t,n)}else r.current=null}function AI(e,t,r){try{r()}catch(n){ci(e,t,n)}}var LL=!1;function Ice(e,t){if(uI=J_,e=zW(),h4(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var i=0,l=-1,c=-1,d=0,u=0,f=e,h=null;t:for(;;){for(var m;f!==r||s!==0&&f.nodeType!==3||(l=i+s),f!==o||n!==0&&f.nodeType!==3||(c=i+n),f.nodeType===3&&(i+=f.nodeValue.length),(m=f.firstChild)!==null;)h=f,f=m;for(;;){if(f===e)break t;if(h===r&&++d===s&&(l=i),h===o&&++u===n&&(c=i),(m=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=m}r=l===-1||c===-1?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(fI={focusedElem:e,selectionRange:r},J_=!1,ga=t;ga!==null;)if(t=ga,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ga=e;else for(;ga!==null;){t=ga;try{var x=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,v=x.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:Uu(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Fn(163))}}catch(j){ci(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,ga=e;break}ga=t.return}return x=LL,LL=!1,x}function Tb(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var o=s.destroy;s.destroy=void 0,o!==void 0&&AI(t,r,o)}s=s.next}while(s!==n)}}function IC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function EI(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function LH(e){var t=e.alternate;t!==null&&(e.alternate=null,LH(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Af],delete t[_w],delete t[pI],delete t[mce],delete t[hce])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function $H(e){return e.tag===5||e.tag===3||e.tag===4}function $L(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||$H(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function kI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=eN));else if(n!==4&&(e=e.child,e!==null))for(kI(e,t,r),e=e.sibling;e!==null;)kI(e,t,r),e=e.sibling}function II(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(II(e,t,r),e=e.sibling;e!==null;)II(e,t,r),e=e.sibling}var Cl=null,Vu=!1;function ih(e,t,r){for(r=r.child;r!==null;)BH(e,t,r),r=r.sibling}function BH(e,t,r){if(qf&&typeof qf.onCommitFiberUnmount=="function")try{qf.onCommitFiberUnmount(_C,r)}catch{}switch(r.tag){case 5:Xl||jv(r,t);case 6:var n=Cl,s=Vu;Cl=null,ih(e,t,r),Cl=n,Vu=s,Cl!==null&&(Vu?(e=Cl,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Cl.removeChild(r.stateNode));break;case 18:Cl!==null&&(Vu?(e=Cl,r=r.stateNode,e.nodeType===8?yA(e.parentNode,r):e.nodeType===1&&yA(e,r),vw(e)):yA(Cl,r.stateNode));break;case 4:n=Cl,s=Vu,Cl=r.stateNode.containerInfo,Vu=!0,ih(e,t,r),Cl=n,Vu=s;break;case 0:case 11:case 14:case 15:if(!Xl&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var o=s,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&AI(r,t,i),s=s.next}while(s!==n)}ih(e,t,r);break;case 1:if(!Xl&&(jv(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(l){ci(r,t,l)}ih(e,t,r);break;case 21:ih(e,t,r);break;case 22:r.mode&1?(Xl=(n=Xl)||r.memoizedState!==null,ih(e,t,r),Xl=n):ih(e,t,r);break;default:ih(e,t,r)}}function BL(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new kce),t.forEach(function(n){var s=Bce.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function Ru(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var o=e,i=t,l=i;e:for(;l!==null;){switch(l.tag){case 5:Cl=l.stateNode,Vu=!1;break e;case 3:Cl=l.stateNode.containerInfo,Vu=!0;break e;case 4:Cl=l.stateNode.containerInfo,Vu=!0;break e}l=l.return}if(Cl===null)throw Error(Fn(160));BH(o,i,s),Cl=null,Vu=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){ci(s,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)qH(t,e),t=t.sibling}function qH(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ru(t,e),_f(e),n&4){try{Tb(3,e,e.return),IC(3,e)}catch(g){ci(e,e.return,g)}try{Tb(5,e,e.return)}catch(g){ci(e,e.return,g)}}break;case 1:Ru(t,e),_f(e),n&512&&r!==null&&jv(r,r.return);break;case 5:if(Ru(t,e),_f(e),n&512&&r!==null&&jv(r,r.return),e.flags&32){var s=e.stateNode;try{hw(s,"")}catch(g){ci(e,e.return,g)}}if(n&4&&(s=e.stateNode,s!=null)){var o=e.memoizedProps,i=r!==null?r.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&cW(s,o),tI(l,i);var d=tI(l,o);for(i=0;i<c.length;i+=2){var u=c[i],f=c[i+1];u==="style"?hW(s,f):u==="dangerouslySetInnerHTML"?fW(s,f):u==="children"?hw(s,f):t4(s,u,f,d)}switch(l){case"input":Yk(s,o);break;case"textarea":dW(s,o);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var m=o.value;m!=null?Rv(s,!!o.multiple,m,!1):h!==!!o.multiple&&(o.defaultValue!=null?Rv(s,!!o.multiple,o.defaultValue,!0):Rv(s,!!o.multiple,o.multiple?[]:"",!1))}s[_w]=o}catch(g){ci(e,e.return,g)}}break;case 6:if(Ru(t,e),_f(e),n&4){if(e.stateNode===null)throw Error(Fn(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(g){ci(e,e.return,g)}}break;case 3:if(Ru(t,e),_f(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{vw(t.containerInfo)}catch(g){ci(e,e.return,g)}break;case 4:Ru(t,e),_f(e);break;case 13:Ru(t,e),_f(e),s=e.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(D4=gi())),n&4&&BL(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(Xl=(d=Xl)||u,Ru(t,e),Xl=d):Ru(t,e),_f(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(ga=e,u=e.child;u!==null;){for(f=ga=u;ga!==null;){switch(h=ga,m=h.child,h.tag){case 0:case 11:case 14:case 15:Tb(4,h,h.return);break;case 1:jv(h,h.return);var x=h.stateNode;if(typeof x.componentWillUnmount=="function"){n=h,r=h.return;try{t=n,x.props=t.memoizedProps,x.state=t.memoizedState,x.componentWillUnmount()}catch(g){ci(n,r,g)}}break;case 5:jv(h,h.return);break;case 22:if(h.memoizedState!==null){zL(f);continue}}m!==null?(m.return=h,ga=m):zL(f)}u=u.sibling}e:for(u=null,f=e;;){if(f.tag===5){if(u===null){u=f;try{s=f.stateNode,d?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=f.stateNode,c=f.memoizedProps.style,i=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=mW("display",i))}catch(g){ci(e,e.return,g)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(g){ci(e,e.return,g)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Ru(t,e),_f(e),n&4&&BL(e);break;case 21:break;default:Ru(t,e),_f(e)}}function _f(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if($H(r)){var n=r;break e}r=r.return}throw Error(Fn(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(hw(s,""),n.flags&=-33);var o=$L(e);II(e,o,s);break;case 3:case 4:var i=n.stateNode.containerInfo,l=$L(e);kI(e,l,i);break;default:throw Error(Fn(161))}}catch(c){ci(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Oce(e,t,r){ga=e,zH(e)}function zH(e,t,r){for(var n=(e.mode&1)!==0;ga!==null;){var s=ga,o=s.child;if(s.tag===22&&n){var i=s.memoizedState!==null||o2;if(!i){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Xl;l=o2;var d=Xl;if(o2=i,(Xl=c)&&!d)for(ga=s;ga!==null;)i=ga,c=i.child,i.tag===22&&i.memoizedState!==null?UL(s):c!==null?(c.return=i,ga=c):UL(s);for(;o!==null;)ga=o,zH(o),o=o.sibling;ga=s,o2=l,Xl=d}qL(e)}else s.subtreeFlags&8772&&o!==null?(o.return=s,ga=o):qL(e)}}function qL(e){for(;ga!==null;){var t=ga;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Xl||IC(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Xl)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:Uu(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&SL(t,o,n);break;case 3:var i=t.updateQueue;if(i!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}SL(t,i,r)}break;case 5:var l=t.stateNode;if(r===null&&t.flags&4){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&vw(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Fn(163))}Xl||t.flags&512&&EI(t)}catch(h){ci(t,t.return,h)}}if(t===e){ga=null;break}if(r=t.sibling,r!==null){r.return=t.return,ga=r;break}ga=t.return}}function zL(e){for(;ga!==null;){var t=ga;if(t===e){ga=null;break}var r=t.sibling;if(r!==null){r.return=t.return,ga=r;break}ga=t.return}}function UL(e){for(;ga!==null;){var t=ga;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{IC(4,t)}catch(c){ci(t,r,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(c){ci(t,s,c)}}var o=t.return;try{EI(t)}catch(c){ci(t,o,c)}break;case 5:var i=t.return;try{EI(t)}catch(c){ci(t,i,c)}}}catch(c){ci(t,t.return,c)}if(t===e){ga=null;break}var l=t.sibling;if(l!==null){l.return=t.return,ga=l;break}ga=t.return}}var Tce=Math.ceil,uN=Km.ReactCurrentDispatcher,O4=Km.ReactCurrentOwner,gu=Km.ReactCurrentBatchConfig,Ws=0,dl=null,Ii=null,El=0,vd=0,_v=Pp(0),Hi=0,Ew=null,Kg=0,OC=0,T4=0,Db=null,$c=null,D4=0,c0=1/0,pm=null,fN=!1,OI=null,Xh=null,i2=!1,Dh=null,mN=0,Mb=0,TI=null,j_=-1,__=0;function Nc(){return Ws&6?gi():j_!==-1?j_:j_=gi()}function Yh(e){return e.mode&1?Ws&2&&El!==0?El&-El:gce.transition!==null?(__===0&&(__=CW()),__):(e=uo,e!==0||(e=window.event,e=e===void 0?16:TW(e.type)),e):1}function rf(e,t,r,n){if(50<Mb)throw Mb=0,TI=null,Error(Fn(185));W1(e,r,n),(!(Ws&2)||e!==dl)&&(e===dl&&(!(Ws&2)&&(OC|=r),Hi===4&&Ph(e,El)),Kc(e,n),r===1&&Ws===0&&!(t.mode&1)&&(c0=gi()+500,AC&&Ap()))}function Kc(e,t){var r=e.callbackNode;gle(e,t);var n=Y_(e,e===dl?El:0);if(n===0)r!==null&&QF(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&QF(r),t===1)e.tag===0?pce(VL.bind(null,e)):QW(VL.bind(null,e)),uce(function(){!(Ws&6)&&Ap()}),r=null;else{switch(PW(n)){case 1:r=o4;break;case 4:r=NW;break;case 16:r=X_;break;case 536870912:r=SW;break;default:r=X_}r=YH(r,UH.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function UH(e,t){if(j_=-1,__=0,Ws&6)throw Error(Fn(327));var r=e.callbackNode;if(qv()&&e.callbackNode!==r)return null;var n=Y_(e,e===dl?El:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=hN(e,n);else{t=n;var s=Ws;Ws|=2;var o=WH();(dl!==e||El!==t)&&(pm=null,c0=gi()+500,kg(e,t));do try{Rce();break}catch(l){VH(e,l)}while(1);y4(),uN.current=o,Ws=s,Ii!==null?t=0:(dl=null,El=0,t=Hi)}if(t!==0){if(t===2&&(s=oI(e),s!==0&&(n=s,t=DI(e,s))),t===1)throw r=Ew,kg(e,0),Ph(e,n),Kc(e,gi()),r;if(t===6)Ph(e,n);else{if(s=e.current.alternate,!(n&30)&&!Dce(s)&&(t=hN(e,n),t===2&&(o=oI(e),o!==0&&(n=o,t=DI(e,o))),t===1))throw r=Ew,kg(e,0),Ph(e,n),Kc(e,gi()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(Fn(345));case 2:Zp(e,$c,pm);break;case 3:if(Ph(e,n),(n&130023424)===n&&(t=D4+500-gi(),10<t)){if(Y_(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){Nc(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=hI(Zp.bind(null,e,$c,pm),t);break}Zp(e,$c,pm);break;case 4:if(Ph(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var i=31-tf(n);o=1<<i,i=t[i],i>s&&(s=i),n&=~o}if(n=s,n=gi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Tce(n/1960))-n,10<n){e.timeoutHandle=hI(Zp.bind(null,e,$c,pm),n);break}Zp(e,$c,pm);break;case 5:Zp(e,$c,pm);break;default:throw Error(Fn(329))}}}return Kc(e,gi()),e.callbackNode===r?UH.bind(null,e):null}function DI(e,t){var r=Db;return e.current.memoizedState.isDehydrated&&(kg(e,t).flags|=256),e=hN(e,t),e!==2&&(t=$c,$c=r,t!==null&&MI(t)),e}function MI(e){$c===null?$c=e:$c.push.apply($c,e)}function Dce(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],o=s.getSnapshot;s=s.value;try{if(!of(o(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ph(e,t){for(t&=~T4,t&=~OC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-tf(t),n=1<<r;e[r]=-1,t&=~n}}function VL(e){if(Ws&6)throw Error(Fn(327));qv();var t=Y_(e,0);if(!(t&1))return Kc(e,gi()),null;var r=hN(e,t);if(e.tag!==0&&r===2){var n=oI(e);n!==0&&(t=n,r=DI(e,n))}if(r===1)throw r=Ew,kg(e,0),Ph(e,t),Kc(e,gi()),r;if(r===6)throw Error(Fn(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Zp(e,$c,pm),Kc(e,gi()),null}function M4(e,t){var r=Ws;Ws|=1;try{return e(t)}finally{Ws=r,Ws===0&&(c0=gi()+500,AC&&Ap())}}function Xg(e){Dh!==null&&Dh.tag===0&&!(Ws&6)&&qv();var t=Ws;Ws|=1;var r=gu.transition,n=uo;try{if(gu.transition=null,uo=1,e)return e()}finally{uo=n,gu.transition=r,Ws=t,!(Ws&6)&&Ap()}}function R4(){vd=_v.current,qo(_v)}function kg(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,dce(r)),Ii!==null)for(r=Ii.return;r!==null;){var n=r;switch(g4(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&tN();break;case 3:i0(),qo(Hc),qo(Zl),S4();break;case 5:N4(n);break;case 4:i0();break;case 13:qo(Xo);break;case 19:qo(Xo);break;case 10:b4(n.type._context);break;case 22:case 23:R4()}r=r.return}if(dl=e,Ii=e=Jh(e.current,null),El=vd=t,Hi=0,Ew=null,T4=OC=Kg=0,$c=Db=null,pg!==null){for(t=0;t<pg.length;t++)if(r=pg[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,o=r.pending;if(o!==null){var i=o.next;o.next=s,n.next=i}r.pending=n}pg=null}return e}function VH(e,t){do{var r=Ii;try{if(y4(),y_.current=dN,cN){for(var n=ti.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}cN=!1}if(Gg=0,sl=zi=ti=null,Ob=!1,Cw=0,O4.current=null,r===null||r.return===null){Hi=1,Ew=t,Ii=null;break}e:{var o=e,i=r.return,l=r,c=t;if(t=El,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=IL(i);if(m!==null){m.flags&=-257,OL(m,i,l,o,t),m.mode&1&&kL(o,d,t),t=m,c=d;var x=t.updateQueue;if(x===null){var g=new Set;g.add(c),t.updateQueue=g}else x.add(c);break e}else{if(!(t&1)){kL(o,d,t),F4();break e}c=Error(Fn(426))}}else if(Wo&&l.mode&1){var v=IL(i);if(v!==null){!(v.flags&65536)&&(v.flags|=256),OL(v,i,l,o,t),x4(l0(c,l));break e}}o=c=l0(c,l),Hi!==4&&(Hi=2),Db===null?Db=[o]:Db.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var y=PH(o,c,t);NL(o,y);break e;case 1:l=c;var b=o.type,w=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Xh===null||!Xh.has(w)))){o.flags|=65536,t&=-t,o.lanes|=t;var j=AH(o,l,t);NL(o,j);break e}}o=o.return}while(o!==null)}GH(r)}catch(_){t=_,Ii===r&&r!==null&&(Ii=r=r.return);continue}break}while(1)}function WH(){var e=uN.current;return uN.current=dN,e===null?dN:e}function F4(){(Hi===0||Hi===3||Hi===2)&&(Hi=4),dl===null||!(Kg&268435455)&&!(OC&268435455)||Ph(dl,El)}function hN(e,t){var r=Ws;Ws|=2;var n=WH();(dl!==e||El!==t)&&(pm=null,kg(e,t));do try{Mce();break}catch(s){VH(e,s)}while(1);if(y4(),Ws=r,uN.current=n,Ii!==null)throw Error(Fn(261));return dl=null,El=0,Hi}function Mce(){for(;Ii!==null;)HH(Ii)}function Rce(){for(;Ii!==null&&!ile();)HH(Ii)}function HH(e){var t=XH(e.alternate,e,vd);e.memoizedProps=e.pendingProps,t===null?GH(e):Ii=t,O4.current=null}function GH(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Ece(r,t),r!==null){r.flags&=32767,Ii=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Hi=6,Ii=null;return}}else if(r=Ace(r,t,vd),r!==null){Ii=r;return}if(t=t.sibling,t!==null){Ii=t;return}Ii=t=e}while(t!==null);Hi===0&&(Hi=5)}function Zp(e,t,r){var n=uo,s=gu.transition;try{gu.transition=null,uo=1,Fce(e,t,r,n)}finally{gu.transition=s,uo=n}return null}function Fce(e,t,r,n){do qv();while(Dh!==null);if(Ws&6)throw Error(Fn(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Fn(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(xle(e,o),e===dl&&(Ii=dl=null,El=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||i2||(i2=!0,YH(X_,function(){return qv(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=gu.transition,gu.transition=null;var i=uo;uo=1;var l=Ws;Ws|=4,O4.current=null,Ice(e,r),qH(r,e),nce(fI),J_=!!uI,fI=uI=null,e.current=r,Oce(r),lle(),Ws=l,uo=i,gu.transition=o}else e.current=r;if(i2&&(i2=!1,Dh=e,mN=s),o=e.pendingLanes,o===0&&(Xh=null),ule(r.stateNode),Kc(e,gi()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(fN)throw fN=!1,e=OI,OI=null,e;return mN&1&&e.tag!==0&&qv(),o=e.pendingLanes,o&1?e===TI?Mb++:(Mb=0,TI=e):Mb=0,Ap(),null}function qv(){if(Dh!==null){var e=PW(mN),t=gu.transition,r=uo;try{if(gu.transition=null,uo=16>e?16:e,Dh===null)var n=!1;else{if(e=Dh,Dh=null,mN=0,Ws&6)throw Error(Fn(331));var s=Ws;for(Ws|=4,ga=e.current;ga!==null;){var o=ga,i=o.child;if(ga.flags&16){var l=o.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ga=d;ga!==null;){var u=ga;switch(u.tag){case 0:case 11:case 15:Tb(8,u,o)}var f=u.child;if(f!==null)f.return=u,ga=f;else for(;ga!==null;){u=ga;var h=u.sibling,m=u.return;if(LH(u),u===d){ga=null;break}if(h!==null){h.return=m,ga=h;break}ga=m}}}var x=o.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}ga=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,ga=i;else e:for(;ga!==null;){if(o=ga,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Tb(9,o,o.return)}var y=o.sibling;if(y!==null){y.return=o.return,ga=y;break e}ga=o.return}}var b=e.current;for(ga=b;ga!==null;){i=ga;var w=i.child;if(i.subtreeFlags&2064&&w!==null)w.return=i,ga=w;else e:for(i=b;ga!==null;){if(l=ga,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:IC(9,l)}}catch(_){ci(l,l.return,_)}if(l===i){ga=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,ga=j;break e}ga=l.return}}if(Ws=s,Ap(),qf&&typeof qf.onPostCommitFiberRoot=="function")try{qf.onPostCommitFiberRoot(_C,e)}catch{}n=!0}return n}finally{uo=r,gu.transition=t}}return!1}function WL(e,t,r){t=l0(r,t),t=PH(e,t,1),e=Kh(e,t,1),t=Nc(),e!==null&&(W1(e,1,t),Kc(e,t))}function ci(e,t,r){if(e.tag===3)WL(e,e,r);else for(;t!==null;){if(t.tag===3){WL(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Xh===null||!Xh.has(n))){e=l0(r,e),e=AH(t,e,1),t=Kh(t,e,1),e=Nc(),t!==null&&(W1(t,1,e),Kc(t,e));break}}t=t.return}}function Lce(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Nc(),e.pingedLanes|=e.suspendedLanes&r,dl===e&&(El&r)===r&&(Hi===4||Hi===3&&(El&130023424)===El&&500>gi()-D4?kg(e,0):T4|=r),Kc(e,t)}function KH(e,t){t===0&&(e.mode&1?(t=Jj,Jj<<=1,!(Jj&130023424)&&(Jj=4194304)):t=1);var r=Nc();e=Rm(e,t),e!==null&&(W1(e,t,r),Kc(e,r))}function $ce(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),KH(e,r)}function Bce(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Fn(314))}n!==null&&n.delete(t),KH(e,r)}var XH;XH=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Hc.current)Uc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Uc=!1,Pce(e,t,r);Uc=!!(e.flags&131072)}else Uc=!1,Wo&&t.flags&1048576&&ZW(t,aN,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;w_(e,t),e=t.pendingProps;var s=a0(t,Zl.current);Bv(t,r),s=P4(null,t,n,e,s,r);var o=A4();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Gc(n)?(o=!0,rN(t)):o=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,j4(t),s.updater=kC,t.stateNode=s,s._reactInternals=t,wI(t,n,e,r),t=NI(null,t,n,!0,o,r)):(t.tag=0,Wo&&o&&p4(t),gc(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(w_(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=zce(n),e=Uu(n,e),s){case 0:t=_I(null,t,n,e,r);break e;case 1:t=ML(null,t,n,e,r);break e;case 11:t=TL(null,t,n,e,r);break e;case 14:t=DL(null,t,n,Uu(n.type,e),r);break e}throw Error(Fn(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Uu(n,s),_I(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Uu(n,s),ML(e,t,n,s,r);case 3:e:{if(OH(t),e===null)throw Error(Fn(387));n=t.pendingProps,o=t.memoizedState,s=o.element,sH(e,t),iN(t,n,null,r);var i=t.memoizedState;if(n=i.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){s=l0(Error(Fn(423)),t),t=RL(e,t,n,r,s);break e}else if(n!==s){s=l0(Error(Fn(424)),t),t=RL(e,t,n,r,s);break e}else for(_d=Gh(t.stateNode.containerInfo.firstChild),Ed=t,Wo=!0,Ku=null,r=nH(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(s0(),n===s){t=Fm(e,t,r);break e}gc(e,t,n,r)}t=t.child}return t;case 5:return oH(t),e===null&&vI(t),n=t.type,s=t.pendingProps,o=e!==null?e.memoizedProps:null,i=s.children,mI(n,s)?i=null:o!==null&&mI(n,o)&&(t.flags|=32),IH(e,t),gc(e,t,i,r),t.child;case 6:return e===null&&vI(t),null;case 13:return TH(e,t,r);case 4:return _4(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=o0(t,null,n,r):gc(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Uu(n,s),TL(e,t,n,s,r);case 7:return gc(e,t,t.pendingProps,r),t.child;case 8:return gc(e,t,t.pendingProps.children,r),t.child;case 12:return gc(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,o=t.memoizedProps,i=s.value,Eo(sN,n._currentValue),n._currentValue=i,o!==null)if(of(o.value,i)){if(o.children===s.children&&!Hc.current){t=Fm(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){i=o.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=Em(-1,r&-r),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),yI(o.return,r,t),l.lanes|=r;break}c=c.next}}else if(o.tag===10)i=o.type===t.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(Fn(341));i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),yI(i,r,t),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===t){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}gc(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,Bv(t,r),s=bu(s),n=n(s),t.flags|=1,gc(e,t,n,r),t.child;case 14:return n=t.type,s=Uu(n,t.pendingProps),s=Uu(n.type,s),DL(e,t,n,s,r);case 15:return EH(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Uu(n,s),w_(e,t),t.tag=1,Gc(n)?(e=!0,rN(t)):e=!1,Bv(t,r),CH(t,n,s),wI(t,n,s,r),NI(null,t,n,!0,e,r);case 19:return DH(e,t,r);case 22:return kH(e,t,r)}throw Error(Fn(156,t.tag))};function YH(e,t){return _W(e,t)}function qce(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uu(e,t,r,n){return new qce(e,t,r,n)}function L4(e){return e=e.prototype,!(!e||!e.isReactComponent)}function zce(e){if(typeof e=="function")return L4(e)?1:0;if(e!=null){if(e=e.$$typeof,e===n4)return 11;if(e===a4)return 14}return 2}function Jh(e,t){var r=e.alternate;return r===null?(r=uu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function N_(e,t,r,n,s,o){var i=2;if(n=e,typeof e=="function")L4(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case mv:return Ig(r.children,s,o,t);case r4:i=8,s|=8;break;case Wk:return e=uu(12,r,t,s|2),e.elementType=Wk,e.lanes=o,e;case Hk:return e=uu(13,r,t,s),e.elementType=Hk,e.lanes=o,e;case Gk:return e=uu(19,r,t,s),e.elementType=Gk,e.lanes=o,e;case oW:return TC(r,s,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case aW:i=10;break e;case sW:i=9;break e;case n4:i=11;break e;case a4:i=14;break e;case wh:i=16,n=null;break e}throw Error(Fn(130,e==null?e:typeof e,""))}return t=uu(i,r,t,s),t.elementType=e,t.type=n,t.lanes=o,t}function Ig(e,t,r,n){return e=uu(7,e,n,t),e.lanes=r,e}function TC(e,t,r,n){return e=uu(22,e,n,t),e.elementType=oW,e.lanes=r,e.stateNode={isHidden:!1},e}function PA(e,t,r){return e=uu(6,e,null,t),e.lanes=r,e}function AA(e,t,r){return t=uu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uce(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lA(0),this.expirationTimes=lA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lA(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function $4(e,t,r,n,s,o,i,l,c){return e=new Uce(e,t,r,l,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=uu(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},j4(o),e}function Vce(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fv,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function JH(e){if(!e)return hp;e=e._reactInternals;e:{if(hx(e)!==e||e.tag!==1)throw Error(Fn(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Gc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Fn(171))}if(e.tag===1){var r=e.type;if(Gc(r))return JW(e,r,t)}return t}function QH(e,t,r,n,s,o,i,l,c){return e=$4(r,n,!0,e,s,o,i,l,c),e.context=JH(null),r=e.current,n=Nc(),s=Yh(r),o=Em(n,s),o.callback=t??null,Kh(r,o,s),e.current.lanes=s,W1(e,s,n),Kc(e,n),e}function DC(e,t,r,n){var s=t.current,o=Nc(),i=Yh(s);return r=JH(r),t.context===null?t.context=r:t.pendingContext=r,t=Em(o,i),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Kh(s,t,i),e!==null&&(rf(e,s,i,o),v_(e,s,i)),i}function pN(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function HL(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function B4(e,t){HL(e,t),(e=e.alternate)&&HL(e,t)}function Wce(){return null}var ZH=typeof reportError=="function"?reportError:function(e){console.error(e)};function q4(e){this._internalRoot=e}MC.prototype.render=q4.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Fn(409));DC(e,t,null,null)};MC.prototype.unmount=q4.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Xg(function(){DC(null,e,null,null)}),t[Mm]=null}};function MC(e){this._internalRoot=e}MC.prototype.unstable_scheduleHydration=function(e){if(e){var t=kW();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Ch.length&&t!==0&&t<Ch[r].priority;r++);Ch.splice(r,0,e),r===0&&OW(e)}};function z4(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function RC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function GL(){}function Hce(e,t,r,n,s){if(s){if(typeof n=="function"){var o=n;n=function(){var d=pN(i);o.call(d)}}var i=QH(t,n,e,0,null,!1,!1,"",GL);return e._reactRootContainer=i,e[Mm]=i.current,ww(e.nodeType===8?e.parentNode:e),Xg(),i}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var l=n;n=function(){var d=pN(c);l.call(d)}}var c=$4(e,0,!1,null,null,!1,!1,"",GL);return e._reactRootContainer=c,e[Mm]=c.current,ww(e.nodeType===8?e.parentNode:e),Xg(function(){DC(t,c,r,n)}),c}function FC(e,t,r,n,s){var o=r._reactRootContainer;if(o){var i=o;if(typeof s=="function"){var l=s;s=function(){var c=pN(i);l.call(c)}}DC(t,i,e,s)}else i=Hce(r,t,e,s,n);return pN(i)}AW=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=xb(t.pendingLanes);r!==0&&(i4(t,r|1),Kc(t,gi()),!(Ws&6)&&(c0=gi()+500,Ap()))}break;case 13:Xg(function(){var n=Rm(e,1);if(n!==null){var s=Nc();rf(n,e,1,s)}}),B4(e,1)}};l4=function(e){if(e.tag===13){var t=Rm(e,134217728);if(t!==null){var r=Nc();rf(t,e,134217728,r)}B4(e,134217728)}};EW=function(e){if(e.tag===13){var t=Yh(e),r=Rm(e,t);if(r!==null){var n=Nc();rf(r,e,t,n)}B4(e,t)}};kW=function(){return uo};IW=function(e,t){var r=uo;try{return uo=e,t()}finally{uo=r}};nI=function(e,t,r){switch(t){case"input":if(Yk(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=PC(n);if(!s)throw Error(Fn(90));lW(n),Yk(n,s)}}}break;case"textarea":dW(e,r);break;case"select":t=r.value,t!=null&&Rv(e,!!r.multiple,t,!1)}};xW=M4;vW=Xg;var Gce={usingClientEntryPoint:!1,Events:[G1,xv,PC,pW,gW,M4]},zy={findFiberByHostInstance:hg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Kce={bundleType:zy.bundleType,version:zy.version,rendererPackageName:zy.rendererPackageName,rendererConfig:zy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Km.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=wW(e),e===null?null:e.stateNode},findFiberByHostInstance:zy.findFiberByHostInstance||Wce,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var l2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!l2.isDisabled&&l2.supportsFiber)try{_C=l2.inject(Kce),qf=l2}catch{}}$d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gce;$d.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!z4(t))throw Error(Fn(200));return Vce(e,t,null,r)};$d.createRoot=function(e,t){if(!z4(e))throw Error(Fn(299));var r=!1,n="",s=ZH;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=$4(e,1,!1,null,null,r,!1,n,s),e[Mm]=t.current,ww(e.nodeType===8?e.parentNode:e),new q4(t)};$d.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Fn(188)):(e=Object.keys(e).join(","),Error(Fn(268,e)));return e=wW(t),e=e===null?null:e.stateNode,e};$d.flushSync=function(e){return Xg(e)};$d.hydrate=function(e,t,r){if(!RC(t))throw Error(Fn(200));return FC(null,e,t,!0,r)};$d.hydrateRoot=function(e,t,r){if(!z4(e))throw Error(Fn(405));var n=r!=null&&r.hydratedSources||null,s=!1,o="",i=ZH;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(i=r.onRecoverableError)),t=QH(t,null,e,1,r??null,s,!1,o,i),e[Mm]=t.current,ww(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new MC(t)};$d.render=function(e,t,r){if(!RC(t))throw Error(Fn(200));return FC(null,e,t,!1,r)};$d.unmountComponentAtNode=function(e){if(!RC(e))throw Error(Fn(40));return e._reactRootContainer?(Xg(function(){FC(null,null,e,!1,function(){e._reactRootContainer=null,e[Mm]=null})}),!0):!1};$d.unstable_batchedUpdates=M4;$d.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!RC(r))throw Error(Fn(200));if(e==null||e._reactInternals===void 0)throw Error(Fn(38));return FC(e,t,r,!1,n)};$d.version="18.3.1-next-f1338f8080-20240426";function eG(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(eG)}catch(e){console.error(e)}}eG(),eW.exports=$d;var Xm=eW.exports;const U4=Ls(Xm);var KL=Xm;Uk.createRoot=KL.createRoot,Uk.hydrateRoot=KL.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kw(){return kw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kw.apply(this,arguments)}var Mh;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Mh||(Mh={}));const XL="popstate";function Xce(e){e===void 0&&(e={});function t(n,s){let{pathname:o,search:i,hash:l}=n.location;return RI("",{pathname:o,search:i,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:gN(s)}return Jce(t,r,null,e)}function ri(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function tG(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Yce(){return Math.random().toString(36).substr(2,8)}function YL(e,t){return{usr:e.state,key:e.key,idx:t}}function RI(e,t,r,n){return r===void 0&&(r=null),kw({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?ty(t):t,{state:r,key:t&&t.key||n||Yce()})}function gN(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function ty(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Jce(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:o=!1}=n,i=s.history,l=Mh.Pop,c=null,d=u();d==null&&(d=0,i.replaceState(kw({},i.state,{idx:d}),""));function u(){return(i.state||{idx:null}).idx}function f(){l=Mh.Pop;let v=u(),y=v==null?null:v-d;d=v,c&&c({action:l,location:g.location,delta:y})}function h(v,y){l=Mh.Push;let b=RI(g.location,v,y);r&&r(b,v),d=u()+1;let w=YL(b,d),j=g.createHref(b);try{i.pushState(w,"",j)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;s.location.assign(j)}o&&c&&c({action:l,location:g.location,delta:1})}function m(v,y){l=Mh.Replace;let b=RI(g.location,v,y);r&&r(b,v),d=u();let w=YL(b,d),j=g.createHref(b);i.replaceState(w,"",j),o&&c&&c({action:l,location:g.location,delta:0})}function x(v){let y=s.location.origin!=="null"?s.location.origin:s.location.href,b=typeof v=="string"?v:gN(v);return b=b.replace(/ $/,"%20"),ri(y,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,y)}let g={get action(){return l},get location(){return e(s,i)},listen(v){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(XL,f),c=v,()=>{s.removeEventListener(XL,f),c=null}},createHref(v){return t(s,v)},createURL:x,encodeLocation(v){let y=x(v);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:h,replace:m,go(v){return i.go(v)}};return g}var JL;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(JL||(JL={}));function Qce(e,t,r){return r===void 0&&(r="/"),Zce(e,t,r,!1)}function Zce(e,t,r,n){let s=typeof t=="string"?ty(t):t,o=d0(s.pathname||"/",r);if(o==null)return null;let i=rG(e);ede(i);let l=null;for(let c=0;l==null&&c<i.length;++c){let d=ude(o);l=cde(i[c],d,n)}return l}function rG(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(o,i,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};c.relativePath.startsWith("/")&&(ri(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let d=Qh([n,c.relativePath]),u=r.concat(c);o.children&&o.children.length>0&&(ri(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),rG(o.children,t,u,d)),!(o.path==null&&!o.index)&&t.push({path:d,score:ide(d,o.index),routesMeta:u})};return e.forEach((o,i)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))s(o,i);else for(let c of nG(o.path))s(o,i,c)}),t}function nG(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return s?[o,""]:[o];let i=nG(n.join("/")),l=[];return l.push(...i.map(c=>c===""?o:[o,c].join("/"))),s&&l.push(...i),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function ede(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:lde(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const tde=/^:[\w-]+$/,rde=3,nde=2,ade=1,sde=10,ode=-2,QL=e=>e==="*";function ide(e,t){let r=e.split("/"),n=r.length;return r.some(QL)&&(n+=ode),t&&(n+=nde),r.filter(s=>!QL(s)).reduce((s,o)=>s+(tde.test(o)?rde:o===""?ade:sde),n)}function lde(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function cde(e,t,r){r===void 0&&(r=!1);let{routesMeta:n}=e,s={},o="/",i=[];for(let l=0;l<n.length;++l){let c=n[l],d=l===n.length-1,u=o==="/"?t:t.slice(o.length)||"/",f=xN({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),h=c.route;if(!f&&d&&r&&!n[n.length-1].route.index&&(f=xN({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!f)return null;Object.assign(s,f.params),i.push({params:s,pathname:Qh([o,f.pathname]),pathnameBase:pde(Qh([o,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(o=Qh([o,f.pathnameBase]))}return i}function xN(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=dde(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let o=s[0],i=o.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:n.reduce((d,u,f)=>{let{paramName:h,isOptional:m}=u;if(h==="*"){let g=l[f]||"";i=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[f];return m&&!x?d[h]=void 0:d[h]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:i,pattern:e}}function dde(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),tG(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function ude(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return tG(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function d0(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function fde(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?ty(e):e;return{pathname:r?r.startsWith("/")?r:mde(r,t):t,search:gde(n),hash:xde(s)}}function mde(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function EA(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function hde(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function V4(e,t){let r=hde(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function W4(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=ty(e):(s=kw({},e),ri(!s.pathname||!s.pathname.includes("?"),EA("?","pathname","search",s)),ri(!s.pathname||!s.pathname.includes("#"),EA("#","pathname","hash",s)),ri(!s.search||!s.search.includes("#"),EA("#","search","hash",s)));let o=e===""||s.pathname==="",i=o?"/":s.pathname,l;if(i==null)l=r;else{let f=t.length-1;if(!n&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}l=f>=0?t[f]:"/"}let c=fde(s,l),d=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const Qh=e=>e.join("/").replace(/\/\/+/g,"/"),pde=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),gde=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,xde=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function vde(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const aG=["post","put","patch","delete"];new Set(aG);const yde=["get",...aG];new Set(yde);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Iw(){return Iw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Iw.apply(this,arguments)}const LC=p.createContext(null),sG=p.createContext(null),Ym=p.createContext(null),$C=p.createContext(null),Jm=p.createContext({outlet:null,matches:[],isDataRoute:!1}),oG=p.createContext(null);function bde(e,t){let{relative:r}=t===void 0?{}:t;ry()||ri(!1);let{basename:n,navigator:s}=p.useContext(Ym),{hash:o,pathname:i,search:l}=BC(e,{relative:r}),c=i;return n!=="/"&&(c=i==="/"?n:Qh([n,i])),s.createHref({pathname:c,search:l,hash:o})}function ry(){return p.useContext($C)!=null}function Mi(){return ry()||ri(!1),p.useContext($C).location}function iG(e){p.useContext(Ym).static||p.useLayoutEffect(e)}function Ol(){let{isDataRoute:e}=p.useContext(Jm);return e?Dde():wde()}function wde(){ry()||ri(!1);let e=p.useContext(LC),{basename:t,future:r,navigator:n}=p.useContext(Ym),{matches:s}=p.useContext(Jm),{pathname:o}=Mi(),i=JSON.stringify(V4(s,r.v7_relativeSplatPath)),l=p.useRef(!1);return iG(()=>{l.current=!0}),p.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){n.go(d);return}let f=W4(d,JSON.parse(i),o,u.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Qh([t,f.pathname])),(u.replace?n.replace:n.push)(f,u.state,u)},[t,n,i,o,e])}function jde(){let{matches:e}=p.useContext(Jm),t=e[e.length-1];return t?t.params:{}}function BC(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=p.useContext(Ym),{matches:s}=p.useContext(Jm),{pathname:o}=Mi(),i=JSON.stringify(V4(s,n.v7_relativeSplatPath));return p.useMemo(()=>W4(e,JSON.parse(i),o,r==="path"),[e,i,o,r])}function _de(e,t){return Nde(e,t)}function Nde(e,t,r,n){ry()||ri(!1);let{navigator:s}=p.useContext(Ym),{matches:o}=p.useContext(Jm),i=o[o.length-1],l=i?i.params:{};i&&i.pathname;let c=i?i.pathnameBase:"/";i&&i.route;let d=Mi(),u;if(t){var f;let v=typeof t=="string"?ty(t):t;c==="/"||(f=v.pathname)!=null&&f.startsWith(c)||ri(!1),u=v}else u=d;let h=u.pathname||"/",m=h;if(c!=="/"){let v=c.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let x=Qce(e,{pathname:m}),g=Ede(x&&x.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:Qh([c,s.encodeLocation?s.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:Qh([c,s.encodeLocation?s.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,r,n);return t&&g?p.createElement($C.Provider,{value:{location:Iw({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Mh.Pop}},g):g}function Sde(){let e=Tde(),t=vde(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},o=null;return p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},t),r?p.createElement("pre",{style:s},r):null,o)}const Cde=p.createElement(Sde,null);class Pde extends p.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?p.createElement(Jm.Provider,{value:this.props.routeContext},p.createElement(oG.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ade(e){let{routeContext:t,match:r,children:n}=e,s=p.useContext(LC);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),p.createElement(Jm.Provider,{value:t},n)}function Ede(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,l=(s=r)==null?void 0:s.errors;if(l!=null){let u=i.findIndex(f=>f.route.id&&l?.[f.route.id]!==void 0);u>=0||ri(!1),i=i.slice(0,Math.min(i.length,u+1))}let c=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let u=0;u<i.length;u++){let f=i[u];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(d=u),f.route.id){let{loaderData:h,errors:m}=r,x=f.route.loader&&h[f.route.id]===void 0&&(!m||m[f.route.id]===void 0);if(f.route.lazy||x){c=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((u,f,h)=>{let m,x=!1,g=null,v=null;r&&(m=l&&f.route.id?l[f.route.id]:void 0,g=f.route.errorElement||Cde,c&&(d<0&&h===0?(Mde("route-fallback",!1),x=!0,v=null):d===h&&(x=!0,v=f.route.hydrateFallbackElement||null)));let y=t.concat(i.slice(0,h+1)),b=()=>{let w;return m?w=g:x?w=v:f.route.Component?w=p.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=u,p.createElement(Ade,{match:f,routeContext:{outlet:u,matches:y,isDataRoute:r!=null},children:w})};return r&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?p.createElement(Pde,{location:r.location,revalidation:r.revalidation,component:g,error:m,children:b(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):b()},null)}var lG=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(lG||{}),vN=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(vN||{});function kde(e){let t=p.useContext(LC);return t||ri(!1),t}function Ide(e){let t=p.useContext(sG);return t||ri(!1),t}function Ode(e){let t=p.useContext(Jm);return t||ri(!1),t}function cG(e){let t=Ode(),r=t.matches[t.matches.length-1];return r.route.id||ri(!1),r.route.id}function Tde(){var e;let t=p.useContext(oG),r=Ide(vN.UseRouteError),n=cG(vN.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Dde(){let{router:e}=kde(lG.UseNavigateStable),t=cG(vN.UseNavigateStable),r=p.useRef(!1);return iG(()=>{r.current=!0}),p.useCallback(function(s,o){o===void 0&&(o={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,Iw({fromRouteId:t},o)))},[e,t])}const ZL={};function Mde(e,t,r){!t&&!ZL[e]&&(ZL[e]=!0)}function Rde(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function dG(e){let{to:t,replace:r,state:n,relative:s}=e;ry()||ri(!1);let{future:o,static:i}=p.useContext(Ym),{matches:l}=p.useContext(Jm),{pathname:c}=Mi(),d=Ol(),u=W4(t,V4(l,o.v7_relativeSplatPath),c,s==="path"),f=JSON.stringify(u);return p.useEffect(()=>d(JSON.parse(f),{replace:r,state:n,relative:s}),[d,f,s,r,n]),null}function eo(e){ri(!1)}function Fde(e){let{basename:t="/",children:r=null,location:n,navigationType:s=Mh.Pop,navigator:o,static:i=!1,future:l}=e;ry()&&ri(!1);let c=t.replace(/^\/*/,"/"),d=p.useMemo(()=>({basename:c,navigator:o,static:i,future:Iw({v7_relativeSplatPath:!1},l)}),[c,l,o,i]);typeof n=="string"&&(n=ty(n));let{pathname:u="/",search:f="",hash:h="",state:m=null,key:x="default"}=n,g=p.useMemo(()=>{let v=d0(u,c);return v==null?null:{location:{pathname:v,search:f,hash:h,state:m,key:x},navigationType:s}},[c,u,f,h,m,x,s]);return g==null?null:p.createElement(Ym.Provider,{value:d},p.createElement($C.Provider,{children:r,value:g}))}function S_(e){let{children:t,location:r}=e;return _de(FI(t),r)}new Promise(()=>{});function FI(e,t){t===void 0&&(t=[]);let r=[];return p.Children.forEach(e,(n,s)=>{if(!p.isValidElement(n))return;let o=[...t,s];if(n.type===p.Fragment){r.push.apply(r,FI(n.props.children,o));return}n.type!==eo&&ri(!1),!n.props.index||!n.props.children||ri(!1);let i={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=FI(n.props.children,o)),r.push(i)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yN(){return yN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yN.apply(this,arguments)}function uG(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function Lde(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function $de(e,t){return e.button===0&&(!t||t==="_self")&&!Lde(e)}function LI(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(s=>[r,s]):[[r,n]])},[]))}function Bde(e,t){let r=LI(e);return t&&t.forEach((n,s)=>{r.has(s)||t.getAll(s).forEach(o=>{r.append(s,o)})}),r}const qde=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],zde=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Ude="6";try{window.__reactRouterVersion=Ude}catch{}const Vde=p.createContext({isTransitioning:!1}),Wde="startTransition",e$=Q3[Wde];function Hde(e){let{basename:t,children:r,future:n,window:s}=e,o=p.useRef();o.current==null&&(o.current=Xce({window:s,v5Compat:!0}));let i=o.current,[l,c]=p.useState({action:i.action,location:i.location}),{v7_startTransition:d}=n||{},u=p.useCallback(f=>{d&&e$?e$(()=>c(f)):c(f)},[c,d]);return p.useLayoutEffect(()=>i.listen(u),[i,u]),p.useEffect(()=>Rde(n),[n]),p.createElement(Fde,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:i,future:n})}const Gde=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Kde=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,H4=p.forwardRef(function(t,r){let{onClick:n,relative:s,reloadDocument:o,replace:i,state:l,target:c,to:d,preventScrollReset:u,viewTransition:f}=t,h=uG(t,qde),{basename:m}=p.useContext(Ym),x,g=!1;if(typeof d=="string"&&Kde.test(d)&&(x=d,Gde))try{let w=new URL(window.location.href),j=d.startsWith("//")?new URL(w.protocol+d):new URL(d),_=d0(j.pathname,m);j.origin===w.origin&&_!=null?d=_+j.search+j.hash:g=!0}catch{}let v=bde(d,{relative:s}),y=Yde(d,{replace:i,state:l,target:c,preventScrollReset:u,relative:s,viewTransition:f});function b(w){n&&n(w),w.defaultPrevented||y(w)}return p.createElement("a",yN({},h,{href:x||v,onClick:g||o?n:b,ref:r,target:c}))}),hm=p.forwardRef(function(t,r){let{"aria-current":n="page",caseSensitive:s=!1,className:o="",end:i=!1,style:l,to:c,viewTransition:d,children:u}=t,f=uG(t,zde),h=BC(c,{relative:f.relative}),m=Mi(),x=p.useContext(sG),{navigator:g,basename:v}=p.useContext(Ym),y=x!=null&&Jde(h)&&d===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,w=m.pathname,j=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;s||(w=w.toLowerCase(),j=j?j.toLowerCase():null,b=b.toLowerCase()),j&&v&&(j=d0(j,v)||j);const _=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let C=w===b||!i&&w.startsWith(b)&&w.charAt(_)==="/",A=j!=null&&(j===b||!i&&j.startsWith(b)&&j.charAt(b.length)==="/"),S={isActive:C,isPending:A,isTransitioning:y},P=C?n:void 0,M;typeof o=="function"?M=o(S):M=[o,C?"active":null,A?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let O=typeof l=="function"?l(S):l;return p.createElement(H4,yN({},f,{"aria-current":P,className:M,ref:r,style:O,to:c,viewTransition:d}),typeof u=="function"?u(S):u)});var $I;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})($I||($I={}));var t$;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(t$||(t$={}));function Xde(e){let t=p.useContext(LC);return t||ri(!1),t}function Yde(e,t){let{target:r,replace:n,state:s,preventScrollReset:o,relative:i,viewTransition:l}=t===void 0?{}:t,c=Ol(),d=Mi(),u=BC(e,{relative:i});return p.useCallback(f=>{if($de(f,r)){f.preventDefault();let h=n!==void 0?n:gN(d)===gN(u);c(e,{replace:h,state:s,preventScrollReset:o,relative:i,viewTransition:l})}},[d,c,u,n,s,r,e,o,i,l])}function qC(e){let t=p.useRef(LI(e)),r=p.useRef(!1),n=Mi(),s=p.useMemo(()=>Bde(n.search,r.current?null:t.current),[n.search]),o=Ol(),i=p.useCallback((l,c)=>{const d=LI(typeof l=="function"?l(s):l);r.current=!0,o("?"+d,c)},[o,s]);return[s,i]}function Jde(e,t){t===void 0&&(t={});let r=p.useContext(Vde);r==null&&ri(!1);let{basename:n}=Xde($I.useViewTransitionState),s=BC(e,{relative:t.relative});if(!r.isTransitioning)return!1;let o=d0(r.currentLocation.pathname,n)||r.currentLocation.pathname,i=d0(r.nextLocation.pathname,n)||r.nextLocation.pathname;return xN(s.pathname,i)!=null||xN(s.pathname,o)!=null}function fG(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=fG(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function ls(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=fG(e))&&(n&&(n+=" "),n+=t);return n}function Qde(){for(var e=0,t,r,n="";e<arguments.length;)(t=arguments[e++])&&(r=mG(t))&&(n&&(n+=" "),n+=r);return n}function mG(e){if(typeof e=="string")return e;for(var t,r="",n=0;n<e.length;n++)e[n]&&(t=mG(e[n]))&&(r&&(r+=" "),r+=t);return r}var G4="-";function Zde(e){var t=tue(e),r=e.conflictingClassGroups,n=e.conflictingClassGroupModifiers,s=n===void 0?{}:n;function o(l){var c=l.split(G4);return c[0]===""&&c.length!==1&&c.shift(),hG(c,t)||eue(l)}function i(l,c){var d=r[l]||[];return c&&s[l]?[].concat(d,s[l]):d}return{getClassGroupId:o,getConflictingClassGroupIds:i}}function hG(e,t){if(e.length===0)return t.classGroupId;var r=e[0],n=t.nextPart.get(r),s=n?hG(e.slice(1),n):void 0;if(s)return s;if(t.validators.length!==0){var o=e.join(G4);return t.validators.find(function(i){var l=i.validator;return l(o)})?.classGroupId}}var r$=/^\[(.+)\]$/;function eue(e){if(r$.test(e)){var t=r$.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}}function tue(e){var t=e.theme,r=e.prefix,n={nextPart:new Map,validators:[]},s=nue(Object.entries(e.classGroups),r);return s.forEach(function(o){var i=o[0],l=o[1];BI(l,n,i,t)}),n}function BI(e,t,r,n){e.forEach(function(s){if(typeof s=="string"){var o=s===""?t:n$(t,s);o.classGroupId=r;return}if(typeof s=="function"){if(rue(s)){BI(s(n),t,r,n);return}t.validators.push({validator:s,classGroupId:r});return}Object.entries(s).forEach(function(i){var l=i[0],c=i[1];BI(c,n$(t,l),r,n)})})}function n$(e,t){var r=e;return t.split(G4).forEach(function(n){r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r}function rue(e){return e.isThemeGetter}function nue(e,t){return t?e.map(function(r){var n=r[0],s=r[1],o=s.map(function(i){return typeof i=="string"?t+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(function(l){var c=l[0],d=l[1];return[t+c,d]})):i});return[n,o]}):e}function aue(e){if(e<1)return{get:function(){},set:function(){}};var t=0,r=new Map,n=new Map;function s(o,i){r.set(o,i),t++,t>e&&(t=0,n=r,r=new Map)}return{get:function(i){var l=r.get(i);if(l!==void 0)return l;if((l=n.get(i))!==void 0)return s(i,l),l},set:function(i,l){r.has(i)?r.set(i,l):s(i,l)}}}var pG="!";function sue(e){var t=e.separator||":",r=t.length===1,n=t[0],s=t.length;return function(i){for(var l=[],c=0,d=0,u,f=0;f<i.length;f++){var h=i[f];if(c===0){if(h===n&&(r||i.slice(f,f+s)===t)){l.push(i.slice(d,f)),d=f+s;continue}if(h==="/"){u=f;continue}}h==="["?c++:h==="]"&&c--}var m=l.length===0?i:i.substring(d),x=m.startsWith(pG),g=x?m.substring(1):m,v=u&&u>d?u-d:void 0;return{modifiers:l,hasImportantModifier:x,baseClassName:g,maybePostfixModifierPosition:v}}}function oue(e){if(e.length<=1)return e;var t=[],r=[];return e.forEach(function(n){var s=n[0]==="[";s?(t.push.apply(t,r.sort().concat([n])),r=[]):r.push(n)}),t.push.apply(t,r.sort()),t}function iue(e){return{cache:aue(e.cacheSize),splitModifiers:sue(e),...Zde(e)}}var lue=/\s+/;function cue(e,t){var r=t.splitModifiers,n=t.getClassGroupId,s=t.getConflictingClassGroupIds,o=new Set;return e.trim().split(lue).map(function(i){var l=r(i),c=l.modifiers,d=l.hasImportantModifier,u=l.baseClassName,f=l.maybePostfixModifierPosition,h=n(f?u.substring(0,f):u),m=!!f;if(!h){if(!f)return{isTailwindClass:!1,originalClassName:i};if(h=n(u),!h)return{isTailwindClass:!1,originalClassName:i};m=!1}var x=oue(c).join(":"),g=d?x+pG:x;return{isTailwindClass:!0,modifierId:g,classGroupId:h,originalClassName:i,hasPostfixModifier:m}}).reverse().filter(function(i){if(!i.isTailwindClass)return!0;var l=i.modifierId,c=i.classGroupId,d=i.hasPostfixModifier,u=l+c;return o.has(u)?!1:(o.add(u),s(c,d).forEach(function(f){return o.add(l+f)}),!0)}).reverse().map(function(i){return i.originalClassName}).join(" ")}function due(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,s,o,i=l;function l(d){var u=t[0],f=t.slice(1),h=f.reduce(function(m,x){return x(m)},u());return n=iue(h),s=n.cache.get,o=n.cache.set,i=c,c(d)}function c(d){var u=s(d);if(u)return u;var f=cue(d,n);return o(d,f),f}return function(){return i(Qde.apply(null,arguments))}}function Ro(e){var t=function(n){return n[e]||[]};return t.isThemeGetter=!0,t}var gG=/^\[(?:([a-z-]+):)?(.+)\]$/i,uue=/^\d+\/\d+$/,fue=new Set(["px","full","screen"]),mue=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,hue=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,pue=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function Fu(e){return xg(e)||fue.has(e)||uue.test(e)||qI(e)}function qI(e){return px(e,"length",wue)}function gue(e){return px(e,"size",xG)}function xue(e){return px(e,"position",xG)}function vue(e){return px(e,"url",jue)}function c2(e){return px(e,"number",xg)}function xg(e){return!Number.isNaN(Number(e))}function yue(e){return e.endsWith("%")&&xg(e.slice(0,-1))}function Uy(e){return a$(e)||px(e,"number",a$)}function Es(e){return gG.test(e)}function Vy(){return!0}function lh(e){return mue.test(e)}function bue(e){return px(e,"",_ue)}function px(e,t,r){var n=gG.exec(e);return n?n[1]?n[1]===t:r(n[2]):!1}function wue(e){return hue.test(e)}function xG(){return!1}function jue(e){return e.startsWith("url(")}function a$(e){return Number.isInteger(Number(e))}function _ue(e){return pue.test(e)}function Nue(){var e=Ro("colors"),t=Ro("spacing"),r=Ro("blur"),n=Ro("brightness"),s=Ro("borderColor"),o=Ro("borderRadius"),i=Ro("borderSpacing"),l=Ro("borderWidth"),c=Ro("contrast"),d=Ro("grayscale"),u=Ro("hueRotate"),f=Ro("invert"),h=Ro("gap"),m=Ro("gradientColorStops"),x=Ro("gradientColorStopPositions"),g=Ro("inset"),v=Ro("margin"),y=Ro("opacity"),b=Ro("padding"),w=Ro("saturate"),j=Ro("scale"),_=Ro("sepia"),C=Ro("skew"),A=Ro("space"),S=Ro("translate"),P=function(){return["auto","contain","none"]},M=function(){return["auto","hidden","clip","visible","scroll"]},O=function(){return["auto",Es,t]},I=function(){return[Es,t]},T=function(){return["",Fu]},k=function(){return["auto",xg,Es]},$=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},q=function(){return["solid","dashed","dotted","double","none"]},z=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},F=function(){return["start","end","center","between","around","evenly","stretch"]},V=function(){return["","0",Es]},ue=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},_e=function(){return[xg,c2]},U=function(){return[xg,Es]};return{cacheSize:500,theme:{colors:[Vy],spacing:[Fu],blur:["none","",lh,Es],brightness:_e(),borderColor:[e],borderRadius:["none","","full",lh,Es],borderSpacing:I(),borderWidth:T(),contrast:_e(),grayscale:V(),hueRotate:U(),invert:V(),gap:I(),gradientColorStops:[e],gradientColorStopPositions:[yue,qI],inset:O(),margin:O(),opacity:_e(),padding:I(),saturate:_e(),scale:_e(),sepia:V(),skew:U(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",Es]}],container:["container"],columns:[{columns:[lh]}],"break-after":[{"break-after":ue()}],"break-before":[{"break-before":ue()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat($(),[Es])}],overflow:[{overflow:M()}],"overflow-x":[{"overflow-x":M()}],"overflow-y":[{"overflow-y":M()}],overscroll:[{overscroll:P()}],"overscroll-x":[{"overscroll-x":P()}],"overscroll-y":[{"overscroll-y":P()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Uy]}],basis:[{basis:O()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Es]}],grow:[{grow:V()}],shrink:[{shrink:V()}],order:[{order:["first","last","none",Uy]}],"grid-cols":[{"grid-cols":[Vy]}],"col-start-end":[{col:["auto",{span:["full",Uy]},Es]}],"col-start":[{"col-start":k()}],"col-end":[{"col-end":k()}],"grid-rows":[{"grid-rows":[Vy]}],"row-start-end":[{row:["auto",{span:[Uy]},Es]}],"row-start":[{"row-start":k()}],"row-end":[{"row-end":k()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Es]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Es]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal"].concat(F())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(F(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(F(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[A]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[A]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",Es,t]}],"min-w":[{"min-w":["min","max","fit",Es,Fu]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[lh]},lh,Es]}],h:[{h:[Es,t,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",Es,Fu]}],"max-h":[{"max-h":[Es,t,"min","max","fit"]}],"font-size":[{text:["base",lh,qI]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",c2]}],"font-family":[{font:[Vy]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Es]}],"line-clamp":[{"line-clamp":["none",xg,c2]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Es,Fu]}],"list-image":[{"list-image":["none",Es]}],"list-style-type":[{list:["none","disc","decimal",Es]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(q(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",Fu]}],"underline-offset":[{"underline-offset":["auto",Es,Fu]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Es]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Es]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat($(),[xue])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",gue]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},vue]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[].concat(q(),["hidden"])}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:q()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:[""].concat(q())}],"outline-offset":[{"outline-offset":[Es,Fu]}],"outline-w":[{outline:[Fu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:T()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Fu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",lh,bue]}],"shadow-color":[{shadow:[Vy]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":z()}],"bg-blend":[{"bg-blend":z()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",lh,Es]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[f]}],saturate:[{saturate:[w]}],sepia:[{sepia:[_]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[_]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Es]}],duration:[{duration:U()}],ease:[{ease:["linear","in","out","in-out",Es]}],delay:[{delay:U()}],animate:[{animate:["none","spin","ping","pulse","bounce",Es]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[j]}],"scale-x":[{"scale-x":[j]}],"scale-y":[{"scale-y":[j]}],rotate:[{rotate:[Uy,Es]}],"translate-x":[{"translate-x":[S]}],"translate-y":[{"translate-y":[S]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Es]}],accent:[{accent:["auto",e]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Es]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Es]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Fu,c2]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}var Sue=due(Nue);function Er(...e){return Sue(ls(e))}const s$=["#3B82F6","#22C55E","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#F43F5E","#10B981","#A855F7","#EAB308"];function Cue(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return Math.abs(t)}function _h(e){if(!e)return"#94A3B8";const t=Cue(String(e))%s$.length;return s$[t]}var Pue={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Aue=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),wn=(e,t)=>{const r=p.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:i,children:l,...c},d)=>p.createElement("svg",{ref:d,...Pue,width:s,height:s,stroke:n,strokeWidth:i?Number(o)*24/Number(s):o,className:`lucide lucide-${Aue(e)}`,...c},[...t.map(([u,f])=>p.createElement(u,f)),...(Array.isArray(l)?l:[l])||[]]));return r.displayName=`${e}`,r},kd=wn("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Jf=wn("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Eue=wn("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]),Rb=wn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),d2=wn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),K4=wn("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),X4=wn("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),Y4=wn("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),C_=wn("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Fb=wn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),vG=wn("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),kue=wn("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),bN=wn("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),Iue=wn("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),zC=wn("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),Oue=wn("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),J4=wn("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),P_=wn("CalendarX",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"10",x2:"14",y1:"14",y2:"18",key:"1g3qc0"}],["line",{x1:"14",x2:"10",y1:"14",y2:"18",key:"1az83m"}]]),ko=wn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),yb=wn("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Oi=wn("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Lm=wn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),gx=wn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),zI=wn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Yg=wn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Tue=wn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Due=wn("Chrome",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["line",{x1:"21.17",x2:"12",y1:"8",y2:"8",key:"a0cw5f"}],["line",{x1:"3.95",x2:"8.54",y1:"6.06",y2:"14",key:"1kftof"}],["line",{x1:"10.88",x2:"15.46",y1:"21.94",y2:"14",key:"1ymyh8"}]]),Mue=wn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Rue=wn("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]),xu=wn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Q4=wn("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Rh=wn("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Vi=wn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),ys=wn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Og=wn("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Jg=wn("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ox=wn("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),ol=wn("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),wN=wn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Fue=wn("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Lue=wn("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),$ue=wn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Bue=wn("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),que=wn("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),zue=wn("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Uue=wn("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),yG=wn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Vue=wn("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",key:"1kog09"}]]),Wue=wn("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),Hue=wn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),bG=wn("LifeBuoy",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.93 4.93 4.24 4.24",key:"1ymg45"}],["path",{d:"m14.83 9.17 4.24-4.24",key:"1cb5xl"}],["path",{d:"m14.83 14.83 4.24 4.24",key:"q42g0n"}],["path",{d:"m9.17 14.83-4.24 4.24",key:"bqpfvv"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]),wG=wn("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),Gue=wn("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),ll=wn("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),u0=wn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Kue=wn("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Xue=wn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),f0=wn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),o$=wn("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Yue=wn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),kA=wn("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Jue=wn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),i$=wn("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Nv=wn("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Que=wn("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),l$=wn("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),ju=wn("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),xc=wn("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Zue=wn("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Ow=wn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),jG=wn("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),to=wn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),_G=wn("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),Tg=wn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),c$=wn("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),efe=wn("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Yo=wn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Z4=wn("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Xc=wn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),d$=wn("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),u$=wn("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),tfe=wn("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),zv=wn("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),X1=wn("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),f$=wn("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),IA=wn("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),UI=wn("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),rfe=wn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),eD=wn("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]),u2=wn("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Sc=wn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),nfe=wn("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),$m=wn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Nd=wn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),afe=wn("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]),NG=wn("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),tD=wn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),sfe=wn("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),ofe=wn("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),ife=wn("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),SG=wn("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Tf=wn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),vc=wn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),CG=wn("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),Dg=wn("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Yc=wn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),cl=({size:e="md",variant:t="header",className:r=""})=>{const n={xs:"w-8 h-8",sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20",xl:"w-24 h-24"},s={header:"/isis-profile.png",message:"/isis-profile-baloon.png"},o=s[t]||s.header,i=e==="lg"?"scale-125":e==="md"?"scale-110":"scale-100";return a.jsx("div",{className:`${n[e]||n.md} rounded-full overflow-hidden flex-shrink-0 ring-2 ring-brand ring-offset-0 ${r}`,children:a.jsx("img",{src:o,alt:"Assistente Virtual",className:`w-full h-full object-cover ${i}`,onError:l=>{l.target.style.display="none",l.target.parentElement.innerHTML=`
            <div class="w-full h-full bg-brand flex items-center justify-center">
              <span class="text-bg font-bold text-lg">A</span>
            </div>
          `}})})},PG=p.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),UC=p.createContext({}),VC=p.createContext(null),WC=typeof document<"u",rD=WC?p.useLayoutEffect:p.useEffect,AG=p.createContext({strict:!1}),nD=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),lfe="framerAppearId",EG="data-"+nD(lfe);function cfe(e,t,r,n){const{visualElement:s}=p.useContext(UC),o=p.useContext(AG),i=p.useContext(VC),l=p.useContext(PG).reducedMotion,c=p.useRef();n=n||o.renderer,!c.current&&n&&(c.current=n(e,{visualState:t,parent:s,props:r,presenceContext:i,blockInitialAnimation:i?i.initial===!1:!1,reducedMotionConfig:l}));const d=c.current;p.useInsertionEffect(()=>{d&&d.update(r,i)});const u=p.useRef(!!(r[EG]&&!window.HandoffComplete));return rD(()=>{d&&(d.render(),u.current&&d.animationState&&d.animationState.animateChanges())}),p.useEffect(()=>{d&&(d.updateFeatures(),!u.current&&d.animationState&&d.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),d}function Sv(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function dfe(e,t,r){return p.useCallback(n=>{n&&e.mount&&e.mount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):Sv(r)&&(r.current=n))},[t])}function Tw(e){return typeof e=="string"||Array.isArray(e)}function HC(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const aD=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],sD=["initial",...aD];function GC(e){return HC(e.animate)||sD.some(t=>Tw(e[t]))}function kG(e){return!!(GC(e)||e.variants)}function ufe(e,t){if(GC(e)){const{initial:r,animate:n}=e;return{initial:r===!1||Tw(r)?r:void 0,animate:Tw(n)?n:void 0}}return e.inherit!==!1?t:{}}function ffe(e){const{initial:t,animate:r}=ufe(e,p.useContext(UC));return p.useMemo(()=>({initial:t,animate:r}),[m$(t),m$(r)])}function m$(e){return Array.isArray(e)?e.join(" "):e}const h$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Dw={};for(const e in h$)Dw[e]={isEnabled:t=>h$[e].some(r=>!!t[r])};function mfe(e){for(const t in e)Dw[t]={...Dw[t],...e[t]}}const oD=p.createContext({}),IG=p.createContext({}),hfe=Symbol.for("motionComponentSymbol");function pfe({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:n,Component:s}){e&&mfe(e);function o(l,c){let d;const u={...p.useContext(PG),...l,layoutId:gfe(l)},{isStatic:f}=u,h=ffe(l),m=n(l,f);if(!f&&WC){h.visualElement=cfe(s,m,u,t);const x=p.useContext(IG),g=p.useContext(AG).strict;h.visualElement&&(d=h.visualElement.loadFeatures(u,g,e,x))}return p.createElement(UC.Provider,{value:h},d&&h.visualElement?p.createElement(d,{visualElement:h.visualElement,...u}):null,r(s,l,dfe(m,h.visualElement,c),m,f,h.visualElement))}const i=p.forwardRef(o);return i[hfe]=s,i}function gfe({layoutId:e}){const t=p.useContext(oD).id;return t&&e!==void 0?t+"-"+e:e}function xfe(e){function t(n,s={}){return pfe(e(n,s))}if(typeof Proxy>"u")return t;const r=new Map;return new Proxy(t,{get:(n,s)=>(r.has(s)||r.set(s,t(s)),r.get(s))})}const vfe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function iD(e){return typeof e!="string"||e.includes("-")?!1:!!(vfe.indexOf(e)>-1||/[A-Z]/.test(e))}const jN={};function yfe(e){Object.assign(jN,e)}const Y1=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],xx=new Set(Y1);function OG(e,{layout:t,layoutId:r}){return xx.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!jN[e]||e==="opacity")}const Qc=e=>!!(e&&e.getVelocity),bfe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},wfe=Y1.length;function jfe(e,{enableHardwareAcceleration:t=!0,allowTransformNone:r=!0},n,s){let o="";for(let i=0;i<wfe;i++){const l=Y1[i];if(e[l]!==void 0){const c=bfe[l]||l;o+=`${c}(${e[l]}) `}}return t&&!e.z&&(o+="translateZ(0)"),o=o.trim(),s?o=s(e,n?"":o):r&&n&&(o="none"),o}const TG=e=>t=>typeof t=="string"&&t.startsWith(e),DG=TG("--"),VI=TG("var(--"),_fe=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,Nfe=(e,t)=>t&&typeof e=="number"?t.transform(e):e,pp=(e,t,r)=>Math.min(Math.max(r,e),t),vx={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Lb={...vx,transform:e=>pp(0,1,e)},f2={...vx,default:1},$b=e=>Math.round(e*1e5)/1e5,KC=/(-)?([\d]*\.?[\d])+/g,MG=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Sfe=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function J1(e){return typeof e=="string"}const Q1=e=>({test:t=>J1(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),gh=Q1("deg"),Uf=Q1("%"),es=Q1("px"),Cfe=Q1("vh"),Pfe=Q1("vw"),p$={...Uf,parse:e=>Uf.parse(e)/100,transform:e=>Uf.transform(e*100)},g$={...vx,transform:Math.round},RG={borderWidth:es,borderTopWidth:es,borderRightWidth:es,borderBottomWidth:es,borderLeftWidth:es,borderRadius:es,radius:es,borderTopLeftRadius:es,borderTopRightRadius:es,borderBottomRightRadius:es,borderBottomLeftRadius:es,width:es,maxWidth:es,height:es,maxHeight:es,size:es,top:es,right:es,bottom:es,left:es,padding:es,paddingTop:es,paddingRight:es,paddingBottom:es,paddingLeft:es,margin:es,marginTop:es,marginRight:es,marginBottom:es,marginLeft:es,rotate:gh,rotateX:gh,rotateY:gh,rotateZ:gh,scale:f2,scaleX:f2,scaleY:f2,scaleZ:f2,skew:gh,skewX:gh,skewY:gh,distance:es,translateX:es,translateY:es,translateZ:es,x:es,y:es,z:es,perspective:es,transformPerspective:es,opacity:Lb,originX:p$,originY:p$,originZ:es,zIndex:g$,fillOpacity:Lb,strokeOpacity:Lb,numOctaves:g$};function lD(e,t,r,n){const{style:s,vars:o,transform:i,transformOrigin:l}=e;let c=!1,d=!1,u=!0;for(const f in t){const h=t[f];if(DG(f)){o[f]=h;continue}const m=RG[f],x=Nfe(h,m);if(xx.has(f)){if(c=!0,i[f]=x,!u)continue;h!==(m.default||0)&&(u=!1)}else f.startsWith("origin")?(d=!0,l[f]=x):s[f]=x}if(t.transform||(c||n?s.transform=jfe(e.transform,r,u,n):s.transform&&(s.transform="none")),d){const{originX:f="50%",originY:h="50%",originZ:m=0}=l;s.transformOrigin=`${f} ${h} ${m}`}}const cD=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function FG(e,t,r){for(const n in t)!Qc(t[n])&&!OG(n,r)&&(e[n]=t[n])}function Afe({transformTemplate:e},t,r){return p.useMemo(()=>{const n=cD();return lD(n,t,{enableHardwareAcceleration:!r},e),Object.assign({},n.vars,n.style)},[t])}function Efe(e,t,r){const n=e.style||{},s={};return FG(s,n,e),Object.assign(s,Afe(e,t,r)),e.transformValues?e.transformValues(s):s}function kfe(e,t,r){const n={},s=Efe(e,t,r);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const Ife=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function _N(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Ife.has(e)}let LG=e=>!_N(e);function Ofe(e){e&&(LG=t=>t.startsWith("on")?!_N(t):e(t))}try{Ofe(require("@emotion/is-prop-valid").default)}catch{}function Tfe(e,t,r){const n={};for(const s in e)s==="values"&&typeof e.values=="object"||(LG(s)||r===!0&&_N(s)||!t&&!_N(s)||e.draggable&&s.startsWith("onDrag"))&&(n[s]=e[s]);return n}function x$(e,t,r){return typeof e=="string"?e:es.transform(t+r*e)}function Dfe(e,t,r){const n=x$(t,e.x,e.width),s=x$(r,e.y,e.height);return`${n} ${s}`}const Mfe={offset:"stroke-dashoffset",array:"stroke-dasharray"},Rfe={offset:"strokeDashoffset",array:"strokeDasharray"};function Ffe(e,t,r=1,n=0,s=!0){e.pathLength=1;const o=s?Mfe:Rfe;e[o.offset]=es.transform(-n);const i=es.transform(t),l=es.transform(r);e[o.array]=`${i} ${l}`}function dD(e,{attrX:t,attrY:r,attrScale:n,originX:s,originY:o,pathLength:i,pathSpacing:l=1,pathOffset:c=0,...d},u,f,h){if(lD(e,d,u,h),f){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:m,style:x,dimensions:g}=e;m.transform&&(g&&(x.transform=m.transform),delete m.transform),g&&(s!==void 0||o!==void 0||x.transform)&&(x.transformOrigin=Dfe(g,s!==void 0?s:.5,o!==void 0?o:.5)),t!==void 0&&(m.x=t),r!==void 0&&(m.y=r),n!==void 0&&(m.scale=n),i!==void 0&&Ffe(m,i,l,c,!1)}const $G=()=>({...cD(),attrs:{}}),uD=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Lfe(e,t,r,n){const s=p.useMemo(()=>{const o=$G();return dD(o,t,{enableHardwareAcceleration:!1},uD(n),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};FG(o,e.style,e),s.style={...o,...s.style}}return s}function $fe(e=!1){return(r,n,s,{latestValues:o},i)=>{const c=(iD(r)?Lfe:kfe)(n,o,i,r),u={...Tfe(n,typeof r=="string",e),...c,ref:s},{children:f}=n,h=p.useMemo(()=>Qc(f)?f.get():f,[f]);return p.createElement(r,{...u,children:h})}}function BG(e,{style:t,vars:r},n,s){Object.assign(e.style,t,s&&s.getProjectionStyles(n));for(const o in r)e.style.setProperty(o,r[o])}const qG=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function zG(e,t,r,n){BG(e,t,void 0,n);for(const s in t.attrs)e.setAttribute(qG.has(s)?s:nD(s),t.attrs[s])}function fD(e,t){const{style:r}=e,n={};for(const s in r)(Qc(r[s])||t.style&&Qc(t.style[s])||OG(s,e))&&(n[s]=r[s]);return n}function UG(e,t){const r=fD(e,t);for(const n in e)if(Qc(e[n])||Qc(t[n])){const s=Y1.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=e[n]}return r}function mD(e,t,r,n={},s={}){return typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,s)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,s)),t}function VG(e){const t=p.useRef(null);return t.current===null&&(t.current=e()),t.current}const NN=e=>Array.isArray(e),Bfe=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),qfe=e=>NN(e)?e[e.length-1]||0:e;function A_(e){const t=Qc(e)?e.get():e;return Bfe(t)?t.toValue():t}function zfe({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:r},n,s,o){const i={latestValues:Ufe(n,s,o,e),renderState:t()};return r&&(i.mount=l=>r(n,l,i)),i}const WG=e=>(t,r)=>{const n=p.useContext(UC),s=p.useContext(VC),o=()=>zfe(e,t,n,s);return r?o():VG(o)};function Ufe(e,t,r,n){const s={},o=n(e,{});for(const h in o)s[h]=A_(o[h]);let{initial:i,animate:l}=e;const c=GC(e),d=kG(e);t&&d&&!c&&e.inherit!==!1&&(i===void 0&&(i=t.initial),l===void 0&&(l=t.animate));let u=r?r.initial===!1:!1;u=u||i===!1;const f=u?l:i;return f&&typeof f!="boolean"&&!HC(f)&&(Array.isArray(f)?f:[f]).forEach(m=>{const x=mD(e,m);if(!x)return;const{transitionEnd:g,transition:v,...y}=x;for(const b in y){let w=y[b];if(Array.isArray(w)){const j=u?w.length-1:0;w=w[j]}w!==null&&(s[b]=w)}for(const b in g)s[b]=g[b]}),s}const ui=e=>e;class v${constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const r=this.order.indexOf(t);r!==-1&&(this.order.splice(r,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function Vfe(e){let t=new v$,r=new v$,n=0,s=!1,o=!1;const i=new WeakSet,l={schedule:(c,d=!1,u=!1)=>{const f=u&&s,h=f?t:r;return d&&i.add(c),h.add(c)&&f&&s&&(n=t.order.length),c},cancel:c=>{r.remove(c),i.delete(c)},process:c=>{if(s){o=!0;return}if(s=!0,[t,r]=[r,t],r.clear(),n=t.order.length,n)for(let d=0;d<n;d++){const u=t.order[d];u(c),i.has(u)&&(l.schedule(u),e())}s=!1,o&&(o=!1,l.process(c))}};return l}const m2=["prepare","read","update","preRender","render","postRender"],Wfe=40;function Hfe(e,t){let r=!1,n=!0;const s={delta:0,timestamp:0,isProcessing:!1},o=m2.reduce((f,h)=>(f[h]=Vfe(()=>r=!0),f),{}),i=f=>o[f].process(s),l=()=>{const f=performance.now();r=!1,s.delta=n?1e3/60:Math.max(Math.min(f-s.timestamp,Wfe),1),s.timestamp=f,s.isProcessing=!0,m2.forEach(i),s.isProcessing=!1,r&&t&&(n=!1,e(l))},c=()=>{r=!0,n=!0,s.isProcessing||e(l)};return{schedule:m2.reduce((f,h)=>{const m=o[h];return f[h]=(x,g=!1,v=!1)=>(r||c(),m.schedule(x,g,v)),f},{}),cancel:f=>m2.forEach(h=>o[h].cancel(f)),state:s,steps:o}}const{schedule:Io,cancel:Bm,state:Hl,steps:OA}=Hfe(typeof requestAnimationFrame<"u"?requestAnimationFrame:ui,!0),Gfe={useVisualState:WG({scrapeMotionValuesFromProps:UG,createRenderState:$G,onMount:(e,t,{renderState:r,latestValues:n})=>{Io.read(()=>{try{r.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}}),Io.render(()=>{dD(r,n,{enableHardwareAcceleration:!1},uD(t.tagName),e.transformTemplate),zG(t,r)})}})},Kfe={useVisualState:WG({scrapeMotionValuesFromProps:fD,createRenderState:cD})};function Xfe(e,{forwardMotionProps:t=!1},r,n){return{...iD(e)?Gfe:Kfe,preloadedFeatures:r,useRender:$fe(t),createVisualElement:n,Component:e}}function Nm(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}const HG=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function XC(e,t="page"){return{point:{x:e[t+"X"],y:e[t+"Y"]}}}const Yfe=e=>t=>HG(t)&&e(t,XC(t));function km(e,t,r,n){return Nm(e,t,Yfe(r),n)}const Jfe=(e,t)=>r=>t(e(r)),Zh=(...e)=>e.reduce(Jfe);function GG(e){let t=null;return()=>{const r=()=>{t=null};return t===null?(t=e,r):!1}}const y$=GG("dragHorizontal"),b$=GG("dragVertical");function KG(e){let t=!1;if(e==="y")t=b$();else if(e==="x")t=y$();else{const r=y$(),n=b$();r&&n?t=()=>{r(),n()}:(r&&r(),n&&n())}return t}function XG(){const e=KG(!0);return e?(e(),!1):!0}class Ep{constructor(t){this.isMounted=!1,this.node=t}update(){}}function w$(e,t){const r="pointer"+(t?"enter":"leave"),n="onHover"+(t?"Start":"End"),s=(o,i)=>{if(o.pointerType==="touch"||XG())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t),l[n]&&Io.update(()=>l[n](o,i))};return km(e.current,r,s,{passive:!e.getProps()[n]})}class Qfe extends Ep{mount(){this.unmount=Zh(w$(this.node,!0),w$(this.node,!1))}unmount(){}}class Zfe extends Ep{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Zh(Nm(this.node.current,"focus",()=>this.onFocus()),Nm(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const YG=(e,t)=>t?e===t?!0:YG(e,t.parentElement):!1;function TA(e,t){if(!t)return;const r=new PointerEvent("pointer"+e);t(r,XC(r))}class eme extends Ep{constructor(){super(...arguments),this.removeStartListeners=ui,this.removeEndListeners=ui,this.removeAccessibleListeners=ui,this.startPointerPress=(t,r)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),o=km(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:u,globalTapTarget:f}=this.node.getProps();Io.update(()=>{!f&&!YG(this.node.current,l.target)?u&&u(l,c):d&&d(l,c)})},{passive:!(n.onTap||n.onPointerUp)}),i=km(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=Zh(o,i),this.startPress(t,r)},this.startAccessiblePress=()=>{const t=o=>{if(o.key!=="Enter"||this.isPressing)return;const i=l=>{l.key!=="Enter"||!this.checkPressEnd()||TA("up",(c,d)=>{const{onTap:u}=this.node.getProps();u&&Io.update(()=>u(c,d))})};this.removeEndListeners(),this.removeEndListeners=Nm(this.node.current,"keyup",i),TA("down",(l,c)=>{this.startPress(l,c)})},r=Nm(this.node.current,"keydown",t),n=()=>{this.isPressing&&TA("cancel",(o,i)=>this.cancelPress(o,i))},s=Nm(this.node.current,"blur",n);this.removeAccessibleListeners=Zh(r,s)}}startPress(t,r){this.isPressing=!0;const{onTapStart:n,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&Io.update(()=>n(t,r))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!XG()}cancelPress(t,r){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&Io.update(()=>n(t,r))}mount(){const t=this.node.getProps(),r=km(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),n=Nm(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Zh(r,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const WI=new WeakMap,DA=new WeakMap,tme=e=>{const t=WI.get(e.target);t&&t(e)},rme=e=>{e.forEach(tme)};function nme({root:e,...t}){const r=e||document;DA.has(r)||DA.set(r,{});const n=DA.get(r),s=JSON.stringify(t);return n[s]||(n[s]=new IntersectionObserver(rme,{root:e,...t})),n[s]}function ame(e,t,r){const n=nme(t);return WI.set(e,r),n.observe(e),()=>{WI.delete(e),n.unobserve(e)}}const sme={some:0,all:1};class ome extends Ep{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:s="some",once:o}=t,i={root:r?r.current:void 0,rootMargin:n,threshold:typeof s=="number"?s:sme[s]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:f}=this.node.getProps(),h=d?u:f;h&&h(c)};return ame(this.node.current,i,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(ime(t,r))&&this.startObserver()}unmount(){}}function ime({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const lme={inView:{Feature:ome},tap:{Feature:eme},focus:{Feature:Zfe},hover:{Feature:Qfe}};function JG(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function cme(e){const t={};return e.values.forEach((r,n)=>t[n]=r.get()),t}function dme(e){const t={};return e.values.forEach((r,n)=>t[n]=r.getVelocity()),t}function YC(e,t,r){const n=e.getProps();return mD(n,t,r!==void 0?r:n.custom,cme(e),dme(e))}let ume=ui,hD=ui;const ep=e=>e*1e3,Im=e=>e/1e3,fme={current:!1},QG=e=>Array.isArray(e)&&typeof e[0]=="number";function ZG(e){return!!(!e||typeof e=="string"&&eK[e]||QG(e)||Array.isArray(e)&&e.every(ZG))}const bb=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,eK={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:bb([0,.65,.55,1]),circOut:bb([.55,0,1,.45]),backIn:bb([.31,.01,.66,-.59]),backOut:bb([.33,1.53,.69,.99])};function tK(e){if(e)return QG(e)?bb(e):Array.isArray(e)?e.map(tK):eK[e]}function mme(e,t,r,{delay:n=0,duration:s,repeat:o=0,repeatType:i="loop",ease:l,times:c}={}){const d={[t]:r};c&&(d.offset=c);const u=tK(l);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:n,duration:s,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:o+1,direction:i==="reverse"?"alternate":"normal"})}function hme(e,{repeat:t,repeatType:r="loop"}){const n=t&&r!=="loop"&&t%2===1?0:e.length-1;return e[n]}const rK=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,pme=1e-7,gme=12;function xme(e,t,r,n,s){let o,i,l=0;do i=t+(r-t)/2,o=rK(i,n,s)-e,o>0?r=i:t=i;while(Math.abs(o)>pme&&++l<gme);return i}function Z1(e,t,r,n){if(e===t&&r===n)return ui;const s=o=>xme(o,0,1,e,r);return o=>o===0||o===1?o:rK(s(o),t,n)}const vme=Z1(.42,0,1,1),yme=Z1(0,0,.58,1),nK=Z1(.42,0,.58,1),bme=e=>Array.isArray(e)&&typeof e[0]!="number",aK=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,sK=e=>t=>1-e(1-t),pD=e=>1-Math.sin(Math.acos(e)),oK=sK(pD),wme=aK(pD),iK=Z1(.33,1.53,.69,.99),gD=sK(iK),jme=aK(gD),_me=e=>(e*=2)<1?.5*gD(e):.5*(2-Math.pow(2,-10*(e-1))),Nme={linear:ui,easeIn:vme,easeInOut:nK,easeOut:yme,circIn:pD,circInOut:wme,circOut:oK,backIn:gD,backInOut:jme,backOut:iK,anticipate:_me},j$=e=>{if(Array.isArray(e)){hD(e.length===4);const[t,r,n,s]=e;return Z1(t,r,n,s)}else if(typeof e=="string")return Nme[e];return e},xD=(e,t)=>r=>!!(J1(r)&&Sfe.test(r)&&r.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(r,t)),lK=(e,t,r)=>n=>{if(!J1(n))return n;const[s,o,i,l]=n.match(KC);return{[e]:parseFloat(s),[t]:parseFloat(o),[r]:parseFloat(i),alpha:l!==void 0?parseFloat(l):1}},Sme=e=>pp(0,255,e),MA={...vx,transform:e=>Math.round(Sme(e))},vg={test:xD("rgb","red"),parse:lK("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+MA.transform(e)+", "+MA.transform(t)+", "+MA.transform(r)+", "+$b(Lb.transform(n))+")"};function Cme(e){let t="",r="",n="",s="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),s=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),s=e.substring(4,5),t+=t,r+=r,n+=n,s+=s),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}}const HI={test:xD("#"),parse:Cme,transform:vg.transform},Cv={test:xD("hsl","hue"),parse:lK("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Uf.transform($b(t))+", "+Uf.transform($b(r))+", "+$b(Lb.transform(n))+")"},hc={test:e=>vg.test(e)||HI.test(e)||Cv.test(e),parse:e=>vg.test(e)?vg.parse(e):Cv.test(e)?Cv.parse(e):HI.parse(e),transform:e=>J1(e)?e:e.hasOwnProperty("red")?vg.transform(e):Cv.transform(e)},Jo=(e,t,r)=>-r*e+r*t+e;function RA(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Pme({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let s=0,o=0,i=0;if(!t)s=o=i=r;else{const l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;s=RA(c,l,e+1/3),o=RA(c,l,e),i=RA(c,l,e-1/3)}return{red:Math.round(s*255),green:Math.round(o*255),blue:Math.round(i*255),alpha:n}}const FA=(e,t,r)=>{const n=e*e;return Math.sqrt(Math.max(0,r*(t*t-n)+n))},Ame=[HI,vg,Cv],Eme=e=>Ame.find(t=>t.test(e));function _$(e){const t=Eme(e);let r=t.parse(e);return t===Cv&&(r=Pme(r)),r}const cK=(e,t)=>{const r=_$(e),n=_$(t),s={...r};return o=>(s.red=FA(r.red,n.red,o),s.green=FA(r.green,n.green,o),s.blue=FA(r.blue,n.blue,o),s.alpha=Jo(r.alpha,n.alpha,o),vg.transform(s))};function kme(e){var t,r;return isNaN(e)&&J1(e)&&(((t=e.match(KC))===null||t===void 0?void 0:t.length)||0)+(((r=e.match(MG))===null||r===void 0?void 0:r.length)||0)>0}const dK={regex:_fe,countKey:"Vars",token:"${v}",parse:ui},uK={regex:MG,countKey:"Colors",token:"${c}",parse:hc.parse},fK={regex:KC,countKey:"Numbers",token:"${n}",parse:vx.parse};function LA(e,{regex:t,countKey:r,token:n,parse:s}){const o=e.tokenised.match(t);o&&(e["num"+r]=o.length,e.tokenised=e.tokenised.replace(t,n),e.values.push(...o.map(s)))}function SN(e){const t=e.toString(),r={value:t,tokenised:t,values:[],numVars:0,numColors:0,numNumbers:0};return r.value.includes("var(--")&&LA(r,dK),LA(r,uK),LA(r,fK),r}function mK(e){return SN(e).values}function hK(e){const{values:t,numColors:r,numVars:n,tokenised:s}=SN(e),o=t.length;return i=>{let l=s;for(let c=0;c<o;c++)c<n?l=l.replace(dK.token,i[c]):c<n+r?l=l.replace(uK.token,hc.transform(i[c])):l=l.replace(fK.token,$b(i[c]));return l}}const Ime=e=>typeof e=="number"?0:e;function Ome(e){const t=mK(e);return hK(e)(t.map(Ime))}const gp={test:kme,parse:mK,createTransformer:hK,getAnimatableNone:Ome},pK=(e,t)=>r=>`${r>0?t:e}`;function gK(e,t){return typeof e=="number"?r=>Jo(e,t,r):hc.test(e)?cK(e,t):e.startsWith("var(")?pK(e,t):vK(e,t)}const xK=(e,t)=>{const r=[...e],n=r.length,s=e.map((o,i)=>gK(o,t[i]));return o=>{for(let i=0;i<n;i++)r[i]=s[i](o);return r}},Tme=(e,t)=>{const r={...e,...t},n={};for(const s in r)e[s]!==void 0&&t[s]!==void 0&&(n[s]=gK(e[s],t[s]));return s=>{for(const o in n)r[o]=n[o](s);return r}},vK=(e,t)=>{const r=gp.createTransformer(t),n=SN(e),s=SN(t);return n.numVars===s.numVars&&n.numColors===s.numColors&&n.numNumbers>=s.numNumbers?Zh(xK(n.values,s.values),r):pK(e,t)},Mw=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n},N$=(e,t)=>r=>Jo(e,t,r);function Dme(e){return typeof e=="number"?N$:typeof e=="string"?hc.test(e)?cK:vK:Array.isArray(e)?xK:typeof e=="object"?Tme:N$}function Mme(e,t,r){const n=[],s=r||Dme(e[0]),o=e.length-1;for(let i=0;i<o;i++){let l=s(e[i],e[i+1]);if(t){const c=Array.isArray(t)?t[i]||ui:t;l=Zh(c,l)}n.push(l)}return n}function yK(e,t,{clamp:r=!0,ease:n,mixer:s}={}){const o=e.length;if(hD(o===t.length),o===1)return()=>t[0];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=Mme(t,n,s),l=i.length,c=d=>{let u=0;if(l>1)for(;u<e.length-2&&!(d<e[u+1]);u++);const f=Mw(e[u],e[u+1],d);return i[u](f)};return r?d=>c(pp(e[0],e[o-1],d)):c}function Rme(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const s=Mw(0,t,n);e.push(Jo(r,1,s))}}function Fme(e){const t=[0];return Rme(t,e.length-1),t}function Lme(e,t){return e.map(r=>r*t)}function $me(e,t){return e.map(()=>t||nK).splice(0,e.length-1)}function CN({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const s=bme(n)?n.map(j$):j$(n),o={done:!1,value:t[0]},i=Lme(r&&r.length===t.length?r:Fme(t),e),l=yK(i,t,{ease:Array.isArray(s)?s:$me(t,s)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}function bK(e,t){return t?e*(1e3/t):0}const Bme=5;function wK(e,t,r){const n=Math.max(t-Bme,0);return bK(r-e(n),t-n)}const $A=.001,qme=.01,S$=10,zme=.05,Ume=1;function Vme({duration:e=800,bounce:t=.25,velocity:r=0,mass:n=1}){let s,o;ume(e<=ep(S$));let i=1-t;i=pp(zme,Ume,i),e=pp(qme,S$,Im(e)),i<1?(s=d=>{const u=d*i,f=u*e,h=u-r,m=GI(d,i),x=Math.exp(-f);return $A-h/m*x},o=d=>{const f=d*i*e,h=f*r+r,m=Math.pow(i,2)*Math.pow(d,2)*e,x=Math.exp(-f),g=GI(Math.pow(d,2),i);return(-s(d)+$A>0?-1:1)*((h-m)*x)/g}):(s=d=>{const u=Math.exp(-d*e),f=(d-r)*e+1;return-$A+u*f},o=d=>{const u=Math.exp(-d*e),f=(r-d)*(e*e);return u*f});const l=5/e,c=Hme(s,o,l);if(e=ep(e),isNaN(c))return{stiffness:100,damping:10,duration:e};{const d=Math.pow(c,2)*n;return{stiffness:d,damping:i*2*Math.sqrt(n*d),duration:e}}}const Wme=12;function Hme(e,t,r){let n=r;for(let s=1;s<Wme;s++)n=n-e(n)/t(n);return n}function GI(e,t){return e*Math.sqrt(1-t*t)}const Gme=["duration","bounce"],Kme=["stiffness","damping","mass"];function C$(e,t){return t.some(r=>e[r]!==void 0)}function Xme(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!C$(e,Kme)&&C$(e,Gme)){const r=Vme(e);t={...t,...r,mass:1},t.isResolvedFromDuration=!0}return t}function jK({keyframes:e,restDelta:t,restSpeed:r,...n}){const s=e[0],o=e[e.length-1],i={done:!1,value:s},{stiffness:l,damping:c,mass:d,duration:u,velocity:f,isResolvedFromDuration:h}=Xme({...n,velocity:-Im(n.velocity||0)}),m=f||0,x=c/(2*Math.sqrt(l*d)),g=o-s,v=Im(Math.sqrt(l/d)),y=Math.abs(g)<5;r||(r=y?.01:2),t||(t=y?.005:.5);let b;if(x<1){const w=GI(v,x);b=j=>{const _=Math.exp(-x*v*j);return o-_*((m+x*v*g)/w*Math.sin(w*j)+g*Math.cos(w*j))}}else if(x===1)b=w=>o-Math.exp(-v*w)*(g+(m+v*g)*w);else{const w=v*Math.sqrt(x*x-1);b=j=>{const _=Math.exp(-x*v*j),C=Math.min(w*j,300);return o-_*((m+x*v*g)*Math.sinh(C)+w*g*Math.cosh(C))/w}}return{calculatedDuration:h&&u||null,next:w=>{const j=b(w);if(h)i.done=w>=u;else{let _=m;w!==0&&(x<1?_=wK(b,w,j):_=0);const C=Math.abs(_)<=r,A=Math.abs(o-j)<=t;i.done=C&&A}return i.value=i.done?o:j,i}}}function P$({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:s=10,bounceStiffness:o=500,modifyTarget:i,min:l,max:c,restDelta:d=.5,restSpeed:u}){const f=e[0],h={done:!1,value:f},m=S=>l!==void 0&&S<l||c!==void 0&&S>c,x=S=>l===void 0?c:c===void 0||Math.abs(l-S)<Math.abs(c-S)?l:c;let g=r*t;const v=f+g,y=i===void 0?v:i(v);y!==v&&(g=y-f);const b=S=>-g*Math.exp(-S/n),w=S=>y+b(S),j=S=>{const P=b(S),M=w(S);h.done=Math.abs(P)<=d,h.value=h.done?y:M};let _,C;const A=S=>{m(h.value)&&(_=S,C=jK({keyframes:[h.value,x(h.value)],velocity:wK(w,S,h.value),damping:s,stiffness:o,restDelta:d,restSpeed:u}))};return A(0),{calculatedDuration:null,next:S=>{let P=!1;return!C&&_===void 0&&(P=!0,j(S),A(S)),_!==void 0&&S>_?C.next(S-_):(!P&&j(S),h)}}}const Yme=e=>{const t=({timestamp:r})=>e(r);return{start:()=>Io.update(t,!0),stop:()=>Bm(t),now:()=>Hl.isProcessing?Hl.timestamp:performance.now()}},A$=2e4;function E$(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<A$;)t+=r,n=e.next(t);return t>=A$?1/0:t}const Jme={decay:P$,inertia:P$,tween:CN,keyframes:CN,spring:jK};function PN({autoplay:e=!0,delay:t=0,driver:r=Yme,keyframes:n,type:s="keyframes",repeat:o=0,repeatDelay:i=0,repeatType:l="loop",onPlay:c,onStop:d,onComplete:u,onUpdate:f,...h}){let m=1,x=!1,g,v;const y=()=>{v=new Promise(_e=>{g=_e})};y();let b;const w=Jme[s]||CN;let j;w!==CN&&typeof n[0]!="number"&&(j=yK([0,100],n,{clamp:!1}),n=[0,100]);const _=w({...h,keyframes:n});let C;l==="mirror"&&(C=w({...h,keyframes:[...n].reverse(),velocity:-(h.velocity||0)}));let A="idle",S=null,P=null,M=null;_.calculatedDuration===null&&o&&(_.calculatedDuration=E$(_));const{calculatedDuration:O}=_;let I=1/0,T=1/0;O!==null&&(I=O+i,T=I*(o+1)-i);let k=0;const $=_e=>{if(P===null)return;m>0&&(P=Math.min(P,_e)),m<0&&(P=Math.min(_e-T/m,P)),S!==null?k=S:k=Math.round(_e-P)*m;const U=k-t*(m>=0?1:-1),L=m>=0?U<0:U>T;k=Math.max(U,0),A==="finished"&&S===null&&(k=T);let G=k,de=_;if(o){const me=Math.min(k,T)/I;let ee=Math.floor(me),ae=me%1;!ae&&me>=1&&(ae=1),ae===1&&ee--,ee=Math.min(ee,o+1),!!(ee%2)&&(l==="reverse"?(ae=1-ae,i&&(ae-=i/I)):l==="mirror"&&(de=C)),G=pp(0,1,ae)*I}const X=L?{done:!1,value:n[0]}:de.next(G);j&&(X.value=j(X.value));let{done:W}=X;!L&&O!==null&&(W=m>=0?k>=T:k<=0);const Y=S===null&&(A==="finished"||A==="running"&&W);return f&&f(X.value),Y&&F(),X},q=()=>{b&&b.stop(),b=void 0},z=()=>{A="idle",q(),g(),y(),P=M=null},F=()=>{A="finished",u&&u(),q(),g()},V=()=>{if(x)return;b||(b=r($));const _e=b.now();c&&c(),S!==null?P=_e-S:(!P||A==="finished")&&(P=_e),A==="finished"&&y(),M=P,S=null,A="running",b.start()};e&&V();const ue={then(_e,U){return v.then(_e,U)},get time(){return Im(k)},set time(_e){_e=ep(_e),k=_e,S!==null||!b||m===0?S=_e:P=b.now()-_e/m},get duration(){const _e=_.calculatedDuration===null?E$(_):_.calculatedDuration;return Im(_e)},get speed(){return m},set speed(_e){_e===m||!b||(m=_e,ue.time=Im(k))},get state(){return A},play:V,pause:()=>{A="paused",S=k},stop:()=>{x=!0,A!=="idle"&&(A="idle",d&&d(),z())},cancel:()=>{M!==null&&$(M),z()},complete:()=>{A="finished"},sample:_e=>(P=0,$(_e))};return ue}function Qme(e){let t;return()=>(t===void 0&&(t=e()),t)}const Zme=Qme(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),ehe=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),h2=10,the=2e4,rhe=(e,t)=>t.type==="spring"||e==="backgroundColor"||!ZG(t.ease);function nhe(e,t,{onUpdate:r,onComplete:n,...s}){if(!(Zme()&&ehe.has(t)&&!s.repeatDelay&&s.repeatType!=="mirror"&&s.damping!==0&&s.type!=="inertia"))return!1;let i=!1,l,c,d=!1;const u=()=>{c=new Promise(w=>{l=w})};u();let{keyframes:f,duration:h=300,ease:m,times:x}=s;if(rhe(t,s)){const w=PN({...s,repeat:0,delay:0});let j={done:!1,value:f[0]};const _=[];let C=0;for(;!j.done&&C<the;)j=w.sample(C),_.push(j.value),C+=h2;x=void 0,f=_,h=C-h2,m="linear"}const g=mme(e.owner.current,t,f,{...s,duration:h,ease:m,times:x}),v=()=>{d=!1,g.cancel()},y=()=>{d=!0,Io.update(v),l(),u()};return g.onfinish=()=>{d||(e.set(hme(f,s)),n&&n(),y())},{then(w,j){return c.then(w,j)},attachTimeline(w){return g.timeline=w,g.onfinish=null,ui},get time(){return Im(g.currentTime||0)},set time(w){g.currentTime=ep(w)},get speed(){return g.playbackRate},set speed(w){g.playbackRate=w},get duration(){return Im(h)},play:()=>{i||(g.play(),Bm(v))},pause:()=>g.pause(),stop:()=>{if(i=!0,g.playState==="idle")return;const{currentTime:w}=g;if(w){const j=PN({...s,autoplay:!1});e.setWithVelocity(j.sample(w-h2).value,j.sample(w).value,h2)}y()},complete:()=>{d||g.finish()},cancel:y}}function ahe({keyframes:e,delay:t,onUpdate:r,onComplete:n}){const s=()=>(r&&r(e[e.length-1]),n&&n(),{time:0,speed:1,duration:0,play:ui,pause:ui,stop:ui,then:o=>(o(),Promise.resolve()),cancel:ui,complete:ui});return t?PN({keyframes:[0,1],duration:0,delay:t,onComplete:s}):s()}const she={type:"spring",stiffness:500,damping:25,restSpeed:10},ohe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),ihe={type:"keyframes",duration:.8},lhe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},che=(e,{keyframes:t})=>t.length>2?ihe:xx.has(e)?e.startsWith("scale")?ohe(t[1]):she:lhe,KI=(e,t)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(gp.test(t)||t==="0")&&!t.startsWith("url(")),dhe=new Set(["brightness","contrast","saturate","opacity"]);function uhe(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(KC)||[];if(!n)return e;const s=r.replace(n,"");let o=dhe.has(t)?1:0;return n!==r&&(o*=100),t+"("+o+s+")"}const fhe=/([a-z-]*)\(.*?\)/g,XI={...gp,getAnimatableNone:e=>{const t=e.match(fhe);return t?t.map(uhe).join(" "):e}},mhe={...RG,color:hc,backgroundColor:hc,outlineColor:hc,fill:hc,stroke:hc,borderColor:hc,borderTopColor:hc,borderRightColor:hc,borderBottomColor:hc,borderLeftColor:hc,filter:XI,WebkitFilter:XI},vD=e=>mhe[e];function _K(e,t){let r=vD(e);return r!==XI&&(r=gp),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const NK=e=>/^0[^.\s]+$/.test(e);function hhe(e){if(typeof e=="number")return e===0;if(e!==null)return e==="none"||e==="0"||NK(e)}function phe(e,t,r,n){const s=KI(t,r);let o;Array.isArray(r)?o=[...r]:o=[null,r];const i=n.from!==void 0?n.from:e.get();let l;const c=[];for(let d=0;d<o.length;d++)o[d]===null&&(o[d]=d===0?i:o[d-1]),hhe(o[d])&&c.push(d),typeof o[d]=="string"&&o[d]!=="none"&&o[d]!=="0"&&(l=o[d]);if(s&&c.length&&l)for(let d=0;d<c.length;d++){const u=c[d];o[u]=_K(t,l)}return o}function ghe({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:s,repeat:o,repeatType:i,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}function yD(e,t){return e[t]||e.default||e}const xhe={skipAnimations:!1},bD=(e,t,r,n={})=>s=>{const o=yD(n,e)||{},i=o.delay||n.delay||0;let{elapsed:l=0}=n;l=l-ep(i);const c=phe(t,e,r,o),d=c[0],u=c[c.length-1],f=KI(e,d),h=KI(e,u);let m={keyframes:c,velocity:t.getVelocity(),ease:"easeOut",...o,delay:-l,onUpdate:x=>{t.set(x),o.onUpdate&&o.onUpdate(x)},onComplete:()=>{s(),o.onComplete&&o.onComplete()}};if(ghe(o)||(m={...m,...che(e,m)}),m.duration&&(m.duration=ep(m.duration)),m.repeatDelay&&(m.repeatDelay=ep(m.repeatDelay)),!f||!h||fme.current||o.type===!1||xhe.skipAnimations)return ahe(m);if(!n.isHandoff&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const x=nhe(t,e,m);if(x)return x}return PN(m)};function AN(e){return!!(Qc(e)&&e.add)}const SK=e=>/^\-?\d*\.?\d+$/.test(e);function wD(e,t){e.indexOf(t)===-1&&e.push(t)}function jD(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class _D{constructor(){this.subscriptions=[]}add(t){return wD(this.subscriptions,t),()=>jD(this.subscriptions,t)}notify(t,r,n){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](t,r,n);else for(let o=0;o<s;o++){const i=this.subscriptions[o];i&&i(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const vhe=e=>!isNaN(parseFloat(e));class yhe{constructor(t,r={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(n,s=!0)=>{this.prev=this.current,this.current=n;const{delta:o,timestamp:i}=Hl;this.lastUpdated!==i&&(this.timeDelta=o,this.lastUpdated=i,Io.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>Io.postRender(this.velocityCheck),this.velocityCheck=({timestamp:n})=>{n!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=vhe(this.current),this.owner=r.owner}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new _D);const n=this.events[t].add(r);return t==="change"?()=>{n(),Io.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,r,n){this.set(r),this.prev=t,this.timeDelta=n}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?bK(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function m0(e,t){return new yhe(e,t)}const CK=e=>t=>t.test(e),bhe={test:e=>e==="auto",parse:e=>e},PK=[vx,es,Uf,gh,Pfe,Cfe,bhe],Wy=e=>PK.find(CK(e)),whe=[...PK,hc,gp],jhe=e=>whe.find(CK(e));function _he(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,m0(r))}function Nhe(e,t){const r=YC(e,t);let{transitionEnd:n={},transition:s={},...o}=r?e.makeTargetAnimatable(r,!1):{};o={...o,...n};for(const i in o){const l=qfe(o[i]);_he(e,i,l)}}function She(e,t,r){var n,s;const o=Object.keys(t).filter(l=>!e.hasValue(l)),i=o.length;if(i)for(let l=0;l<i;l++){const c=o[l],d=t[c];let u=null;Array.isArray(d)&&(u=d[0]),u===null&&(u=(s=(n=r[c])!==null&&n!==void 0?n:e.readValue(c))!==null&&s!==void 0?s:t[c]),u!=null&&(typeof u=="string"&&(SK(u)||NK(u))?u=parseFloat(u):!jhe(u)&&gp.test(d)&&(u=_K(c,d)),e.addValue(c,m0(u,{owner:e})),r[c]===void 0&&(r[c]=u),u!==null&&e.setBaseTarget(c,u))}}function Che(e,t){return t?(t[e]||t.default||t).from:void 0}function Phe(e,t,r){const n={};for(const s in e){const o=Che(s,t);if(o!==void 0)n[s]=o;else{const i=r.getValue(s);i&&(n[s]=i.get())}}return n}function Ahe({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function Ehe(e,t){const r=e.get();if(Array.isArray(t)){for(let n=0;n<t.length;n++)if(t[n]!==r)return!0}else return r!==t}function AK(e,t,{delay:r=0,transitionOverride:n,type:s}={}){let{transition:o=e.getDefaultTransition(),transitionEnd:i,...l}=e.makeTargetAnimatable(t);const c=e.getValue("willChange");n&&(o=n);const d=[],u=s&&e.animationState&&e.animationState.getState()[s];for(const f in l){const h=e.getValue(f),m=l[f];if(!h||m===void 0||u&&Ahe(u,f))continue;const x={delay:r,elapsed:0,...yD(o||{},f)};if(window.HandoffAppearAnimations){const y=e.getProps()[EG];if(y){const b=window.HandoffAppearAnimations(y,f,h,Io);b!==null&&(x.elapsed=b,x.isHandoff=!0)}}let g=!x.isHandoff&&!Ehe(h,m);if(x.type==="spring"&&(h.getVelocity()||x.velocity)&&(g=!1),h.animation&&(g=!1),g)continue;h.start(bD(f,h,m,e.shouldReduceMotion&&xx.has(f)?{type:!1}:x));const v=h.animation;AN(c)&&(c.add(f),v.then(()=>c.remove(f))),d.push(v)}return i&&Promise.all(d).then(()=>{i&&Nhe(e,i)}),d}function YI(e,t,r={}){const n=YC(e,t,r.custom);let{transition:s=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(s=r.transitionOverride);const o=n?()=>Promise.all(AK(e,n,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:f}=s;return khe(e,t,d+c,u,f,r)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,d]=l==="beforeChildren"?[o,i]:[i,o];return c().then(()=>d())}else return Promise.all([o(),i(r.delay)])}function khe(e,t,r=0,n=0,s=1,o){const i=[],l=(e.variantChildren.size-1)*n,c=s===1?(d=0)=>d*n:(d=0)=>l-d*n;return Array.from(e.variantChildren).sort(Ihe).forEach((d,u)=>{d.notify("AnimationStart",t),i.push(YI(d,t,{...o,delay:r+c(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(i)}function Ihe(e,t){return e.sortNodePosition(t)}function Ohe(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const s=t.map(o=>YI(e,o,r));n=Promise.all(s)}else if(typeof t=="string")n=YI(e,t,r);else{const s=typeof t=="function"?YC(e,t,r.custom):t;n=Promise.all(AK(e,s,r))}return n.then(()=>e.notify("AnimationComplete",t))}const The=[...aD].reverse(),Dhe=aD.length;function Mhe(e){return t=>Promise.all(t.map(({animation:r,options:n})=>Ohe(e,r,n)))}function Rhe(e){let t=Mhe(e);const r=Lhe();let n=!0;const s=(c,d)=>{const u=YC(e,d);if(u){const{transition:f,transitionEnd:h,...m}=u;c={...c,...m,...h}}return c};function o(c){t=c(e)}function i(c,d){const u=e.getProps(),f=e.getVariantContext(!0)||{},h=[],m=new Set;let x={},g=1/0;for(let y=0;y<Dhe;y++){const b=The[y],w=r[b],j=u[b]!==void 0?u[b]:f[b],_=Tw(j),C=b===d?w.isActive:null;C===!1&&(g=y);let A=j===f[b]&&j!==u[b]&&_;if(A&&n&&e.manuallyAnimateOnMount&&(A=!1),w.protectedKeys={...x},!w.isActive&&C===null||!j&&!w.prevProp||HC(j)||typeof j=="boolean")continue;let P=Fhe(w.prevProp,j)||b===d&&w.isActive&&!A&&_||y>g&&_,M=!1;const O=Array.isArray(j)?j:[j];let I=O.reduce(s,{});C===!1&&(I={});const{prevResolvedValues:T={}}=w,k={...T,...I},$=q=>{P=!0,m.has(q)&&(M=!0,m.delete(q)),w.needsAnimating[q]=!0};for(const q in k){const z=I[q],F=T[q];if(x.hasOwnProperty(q))continue;let V=!1;NN(z)&&NN(F)?V=!JG(z,F):V=z!==F,V?z!==void 0?$(q):m.add(q):z!==void 0&&m.has(q)?$(q):w.protectedKeys[q]=!0}w.prevProp=j,w.prevResolvedValues=I,w.isActive&&(x={...x,...I}),n&&e.blockInitialAnimation&&(P=!1),P&&(!A||M)&&h.push(...O.map(q=>({animation:q,options:{type:b,...c}})))}if(m.size){const y={};m.forEach(b=>{const w=e.getBaseTarget(b);w!==void 0&&(y[b]=w)}),h.push({animation:y})}let v=!!h.length;return n&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(v=!1),n=!1,v?t(h):Promise.resolve()}function l(c,d,u){var f;if(r[c].isActive===d)return Promise.resolve();(f=e.variantChildren)===null||f===void 0||f.forEach(m=>{var x;return(x=m.animationState)===null||x===void 0?void 0:x.setActive(c,d)}),r[c].isActive=d;const h=i(u,c);for(const m in r)r[m].protectedKeys={};return h}return{animateChanges:i,setActive:l,setAnimateFunction:o,getState:()=>r}}function Fhe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!JG(t,e):!1}function Up(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Lhe(){return{animate:Up(!0),whileInView:Up(),whileHover:Up(),whileTap:Up(),whileDrag:Up(),whileFocus:Up(),exit:Up()}}class $he extends Ep{constructor(t){super(t),t.animationState||(t.animationState=Rhe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),HC(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){}}let Bhe=0;class qhe extends Ep{constructor(){super(...arguments),this.id=Bhe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r,custom:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const o=this.node.animationState.setActive("exit",!t,{custom:n??this.node.getProps().custom});r&&!t&&o.then(()=>r(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const zhe={animation:{Feature:$he},exit:{Feature:qhe}},k$=(e,t)=>Math.abs(e-t);function Uhe(e,t){const r=k$(e.x,t.x),n=k$(e.y,t.y);return Math.sqrt(r**2+n**2)}class EK{constructor(t,r,{transformPagePoint:n,contextWindow:s,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=qA(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,m=Uhe(f.offset,{x:0,y:0})>=3;if(!h&&!m)return;const{point:x}=f,{timestamp:g}=Hl;this.history.push({...x,timestamp:g});const{onStart:v,onMove:y}=this.handlers;h||(v&&v(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,f)},this.handlePointerMove=(f,h)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=BA(h,this.transformPagePoint),Io.update(this.updatePoint,!0)},this.handlePointerUp=(f,h)=>{this.end();const{onEnd:m,onSessionEnd:x,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=qA(f.type==="pointercancel"?this.lastMoveEventInfo:BA(h,this.transformPagePoint),this.history);this.startEvent&&m&&m(f,v),x&&x(f,v)},!HG(t))return;this.dragSnapToOrigin=o,this.handlers=r,this.transformPagePoint=n,this.contextWindow=s||window;const i=XC(t),l=BA(i,this.transformPagePoint),{point:c}=l,{timestamp:d}=Hl;this.history=[{...c,timestamp:d}];const{onSessionStart:u}=r;u&&u(t,qA(l,this.history)),this.removeListeners=Zh(km(this.contextWindow,"pointermove",this.handlePointerMove),km(this.contextWindow,"pointerup",this.handlePointerUp),km(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Bm(this.updatePoint)}}function BA(e,t){return t?{point:t(e.point)}:e}function I$(e,t){return{x:e.x-t.x,y:e.y-t.y}}function qA({point:e},t){return{point:e,delta:I$(e,kK(t)),offset:I$(e,Vhe(t)),velocity:Whe(t,.1)}}function Vhe(e){return e[0]}function kK(e){return e[e.length-1]}function Whe(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const s=kK(e);for(;r>=0&&(n=e[r],!(s.timestamp-n.timestamp>ep(t)));)r--;if(!n)return{x:0,y:0};const o=Im(s.timestamp-n.timestamp);if(o===0)return{x:0,y:0};const i={x:(s.x-n.x)/o,y:(s.y-n.y)/o};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function Ld(e){return e.max-e.min}function JI(e,t=0,r=.01){return Math.abs(e-t)<=r}function O$(e,t,r,n=.5){e.origin=n,e.originPoint=Jo(t.min,t.max,e.origin),e.scale=Ld(r)/Ld(t),(JI(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=Jo(r.min,r.max,e.origin)-e.originPoint,(JI(e.translate)||isNaN(e.translate))&&(e.translate=0)}function Bb(e,t,r,n){O$(e.x,t.x,r.x,n?n.originX:void 0),O$(e.y,t.y,r.y,n?n.originY:void 0)}function T$(e,t,r){e.min=r.min+t.min,e.max=e.min+Ld(t)}function Hhe(e,t,r){T$(e.x,t.x,r.x),T$(e.y,t.y,r.y)}function D$(e,t,r){e.min=t.min-r.min,e.max=e.min+Ld(t)}function qb(e,t,r){D$(e.x,t.x,r.x),D$(e.y,t.y,r.y)}function Ghe(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?Jo(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?Jo(r,e,n.max):Math.min(e,r)),e}function M$(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Khe(e,{top:t,left:r,bottom:n,right:s}){return{x:M$(e.x,r,s),y:M$(e.y,t,n)}}function R$(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function Xhe(e,t){return{x:R$(e.x,t.x),y:R$(e.y,t.y)}}function Yhe(e,t){let r=.5;const n=Ld(e),s=Ld(t);return s>n?r=Mw(t.min,t.max-n,e.min):n>s&&(r=Mw(e.min,e.max-s,t.min)),pp(0,1,r)}function Jhe(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const QI=.35;function Qhe(e=QI){return e===!1?e=0:e===!0&&(e=QI),{x:F$(e,"left","right"),y:F$(e,"top","bottom")}}function F$(e,t,r){return{min:L$(e,t),max:L$(e,r)}}function L$(e,t){return typeof e=="number"?e:e[t]||0}const $$=()=>({translate:0,scale:1,origin:0,originPoint:0}),Pv=()=>({x:$$(),y:$$()}),B$=()=>({min:0,max:0}),Pi=()=>({x:B$(),y:B$()});function Zd(e){return[e("x"),e("y")]}function IK({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function Zhe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function epe(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function zA(e){return e===void 0||e===1}function ZI({scale:e,scaleX:t,scaleY:r}){return!zA(e)||!zA(t)||!zA(r)}function eg(e){return ZI(e)||OK(e)||e.z||e.rotate||e.rotateX||e.rotateY}function OK(e){return q$(e.x)||q$(e.y)}function q$(e){return e&&e!=="0%"}function EN(e,t,r){const n=e-r,s=t*n;return r+s}function z$(e,t,r,n,s){return s!==void 0&&(e=EN(e,s,n)),EN(e,r,n)+t}function eO(e,t=0,r=1,n,s){e.min=z$(e.min,t,r,n,s),e.max=z$(e.max,t,r,n,s)}function TK(e,{x:t,y:r}){eO(e.x,t.translate,t.scale,t.originPoint),eO(e.y,r.translate,r.scale,r.originPoint)}function tpe(e,t,r,n=!1){const s=r.length;if(!s)return;t.x=t.y=1;let o,i;for(let l=0;l<s;l++){o=r[l],i=o.projectionDelta;const c=o.instance;c&&c.style&&c.style.display==="contents"||(n&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Av(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,TK(e,i)),n&&eg(o.latestValues)&&Av(e,o.latestValues))}t.x=U$(t.x),t.y=U$(t.y)}function U$(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function Nh(e,t){e.min=e.min+t,e.max=e.max+t}function V$(e,t,[r,n,s]){const o=t[s]!==void 0?t[s]:.5,i=Jo(e.min,e.max,o);eO(e,t[r],t[n],i,t.scale)}const rpe=["x","scaleX","originX"],npe=["y","scaleY","originY"];function Av(e,t){V$(e.x,t,rpe),V$(e.y,t,npe)}function DK(e,t){return IK(epe(e.getBoundingClientRect(),t))}function ape(e,t,r){const n=DK(e,r),{scroll:s}=t;return s&&(Nh(n.x,s.offset.x),Nh(n.y,s.offset.y)),n}const MK=({current:e})=>e?e.ownerDocument.defaultView:null,spe=new WeakMap;class ope{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Pi(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const s=u=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(XC(u,"page").point)},o=(u,f)=>{const{drag:h,dragPropagation:m,onDragStart:x}=this.getProps();if(h&&!m&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=KG(h),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Zd(v=>{let y=this.getAxisMotionValue(v).get()||0;if(Uf.test(y)){const{projection:b}=this.visualElement;if(b&&b.layout){const w=b.layout.layoutBox[v];w&&(y=Ld(w)*(parseFloat(y)/100))}}this.originPoint[v]=y}),x&&Io.update(()=>x(u,f),!1,!0);const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},i=(u,f)=>{const{dragPropagation:h,dragDirectionLock:m,onDirectionLock:x,onDrag:g}=this.getProps();if(!h&&!this.openGlobalLock)return;const{offset:v}=f;if(m&&this.currentDirection===null){this.currentDirection=ipe(v),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",f.point,v),this.updateAxis("y",f.point,v),this.visualElement.render(),g&&g(u,f)},l=(u,f)=>this.stop(u,f),c=()=>Zd(u=>{var f;return this.getAnimationState(u)==="paused"&&((f=this.getAxisMotionValue(u).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new EK(t,{onSessionStart:s,onStart:o,onMove:i,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:MK(this.visualElement)})}stop(t,r){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:s}=r;this.startAnimation(s);const{onDragEnd:o}=this.getProps();o&&Io.update(()=>o(t,r))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:s}=this.getProps();if(!n||!p2(t,s,this.currentDirection))return;const o=this.getAxisMotionValue(t);let i=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(i=Ghe(i,this.constraints[t],this.elastic[t])),o.set(i)}resolveConstraints(){var t;const{dragConstraints:r,dragElastic:n}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;r&&Sv(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&s?this.constraints=Khe(s.layoutBox,r):this.constraints=!1,this.elastic=Qhe(n),o!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Zd(i=>{this.getAxisMotionValue(i)&&(this.constraints[i]=Jhe(s.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Sv(t))return!1;const n=t.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const o=ape(n,s.root,this.visualElement.getTransformPagePoint());let i=Xhe(s.layout.layoutBox,o);if(r){const l=r(Zhe(i));this.hasMutatedConstraints=!!l,l&&(i=IK(l))}return i}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:s,dragTransition:o,dragSnapToOrigin:i,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Zd(u=>{if(!p2(u,r,this.currentDirection))return;let f=c&&c[u]||{};i&&(f={min:0,max:0});const h=s?200:1e6,m=s?40:1e7,x={type:"inertia",velocity:n?t[u]:0,bounceStiffness:h,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...f};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return n.start(bD(t,n,0,r))}stopAnimation(){Zd(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Zd(t=>{var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(t){const r="_drag"+t.toUpperCase(),n=this.visualElement.getProps(),s=n[r];return s||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Zd(r=>{const{drag:n}=this.getProps();if(!p2(r,n,this.currentDirection))return;const{projection:s}=this.visualElement,o=this.getAxisMotionValue(r);if(s&&s.layout){const{min:i,max:l}=s.layout.layoutBox[r];o.set(t[r]-Jo(i,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!Sv(r)||!n||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};Zd(i=>{const l=this.getAxisMotionValue(i);if(l){const c=l.get();s[i]=Yhe({min:c,max:c},this.constraints[i])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Zd(i=>{if(!p2(i,t,null))return;const l=this.getAxisMotionValue(i),{min:c,max:d}=this.constraints[i];l.set(Jo(c,d,s[i]))})}addListeners(){if(!this.visualElement.current)return;spe.set(this.visualElement,this);const t=this.visualElement.current,r=km(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();Sv(c)&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,o=s.addEventListener("measure",n);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),n();const i=Nm(window,"resize",()=>this.scalePositionWithinConstraints()),l=s.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Zd(u=>{const f=this.getAxisMotionValue(u);f&&(this.originPoint[u]+=c[u].translate,f.set(f.get()+c[u].translate))}),this.visualElement.render())});return()=>{i(),r(),o(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:s=!1,dragConstraints:o=!1,dragElastic:i=QI,dragMomentum:l=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:s,dragConstraints:o,dragElastic:i,dragMomentum:l}}}function p2(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function ipe(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class lpe extends Ep{constructor(t){super(t),this.removeGroupControls=ui,this.removeListeners=ui,this.controls=new ope(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ui}unmount(){this.removeGroupControls(),this.removeListeners()}}const W$=e=>(t,r)=>{e&&Io.update(()=>e(t,r))};class cpe extends Ep{constructor(){super(...arguments),this.removePointerDownListener=ui}onPointerDown(t){this.session=new EK(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:MK(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:s}=this.node.getProps();return{onSessionStart:W$(t),onStart:W$(r),onMove:n,onEnd:(o,i)=>{delete this.session,s&&Io.update(()=>s(o,i))}}}mount(){this.removePointerDownListener=km(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function dpe(){const e=p.useContext(VC);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:n}=e,s=p.useId();return p.useEffect(()=>n(s),[]),!t&&r?[!1,()=>r&&r(s)]:[!0]}const E_={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function H$(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Hy={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(es.test(e))e=parseFloat(e);else return e;const r=H$(e,t.target.x),n=H$(e,t.target.y);return`${r}% ${n}%`}},upe={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,s=gp.parse(e);if(s.length>5)return n;const o=gp.createTransformer(e),i=typeof s[0]!="number"?1:0,l=r.x.scale*t.x,c=r.y.scale*t.y;s[0+i]/=l,s[1+i]/=c;const d=Jo(l,c,.5);return typeof s[2+i]=="number"&&(s[2+i]/=d),typeof s[3+i]=="number"&&(s[3+i]/=d),o(s)}};class fpe extends Ce.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:s}=this.props,{projection:o}=t;yfe(mpe),o&&(r.group&&r.group.add(o),n&&n.register&&s&&n.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),E_.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:s,isPresent:o}=this.props,i=n.projection;return i&&(i.isPresent=o,s||t.layoutDependency!==r||r===void 0?i.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?i.promote():i.relegate()||Io.postRender(()=>{const l=i.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),queueMicrotask(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:s}=t;s&&(s.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(s),n&&n.deregister&&n.deregister(s))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function RK(e){const[t,r]=dpe(),n=p.useContext(oD);return Ce.createElement(fpe,{...e,layoutGroup:n,switchLayoutGroup:p.useContext(IG),isPresent:t,safeToRemove:r})}const mpe={borderRadius:{...Hy,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Hy,borderTopRightRadius:Hy,borderBottomLeftRadius:Hy,borderBottomRightRadius:Hy,boxShadow:upe},FK=["TopLeft","TopRight","BottomLeft","BottomRight"],hpe=FK.length,G$=e=>typeof e=="string"?parseFloat(e):e,K$=e=>typeof e=="number"||es.test(e);function ppe(e,t,r,n,s,o){s?(e.opacity=Jo(0,r.opacity!==void 0?r.opacity:1,gpe(n)),e.opacityExit=Jo(t.opacity!==void 0?t.opacity:1,0,xpe(n))):o&&(e.opacity=Jo(t.opacity!==void 0?t.opacity:1,r.opacity!==void 0?r.opacity:1,n));for(let i=0;i<hpe;i++){const l=`border${FK[i]}Radius`;let c=X$(t,l),d=X$(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||K$(c)===K$(d)?(e[l]=Math.max(Jo(G$(c),G$(d),n),0),(Uf.test(d)||Uf.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||r.rotate)&&(e.rotate=Jo(t.rotate||0,r.rotate||0,n))}function X$(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const gpe=LK(0,.5,oK),xpe=LK(.5,.95,ui);function LK(e,t,r){return n=>n<e?0:n>t?1:r(Mw(e,t,n))}function Y$(e,t){e.min=t.min,e.max=t.max}function Hd(e,t){Y$(e.x,t.x),Y$(e.y,t.y)}function J$(e,t,r,n,s){return e-=t,e=EN(e,1/r,n),s!==void 0&&(e=EN(e,1/s,n)),e}function vpe(e,t=0,r=1,n=.5,s,o=e,i=e){if(Uf.test(t)&&(t=parseFloat(t),t=Jo(i.min,i.max,t/100)-i.min),typeof t!="number")return;let l=Jo(o.min,o.max,n);e===o&&(l-=t),e.min=J$(e.min,t,r,l,s),e.max=J$(e.max,t,r,l,s)}function Q$(e,t,[r,n,s],o,i){vpe(e,t[r],t[n],t[s],t.scale,o,i)}const ype=["x","scaleX","originX"],bpe=["y","scaleY","originY"];function Z$(e,t,r,n){Q$(e.x,t,ype,r?r.x:void 0,n?n.x:void 0),Q$(e.y,t,bpe,r?r.y:void 0,n?n.y:void 0)}function e6(e){return e.translate===0&&e.scale===1}function $K(e){return e6(e.x)&&e6(e.y)}function wpe(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function BK(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function t6(e){return Ld(e.x)/Ld(e.y)}class jpe{constructor(){this.members=[]}add(t){wD(this.members,t),t.scheduleRender()}remove(t){if(jD(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(s=>t===s);if(r===0)return!1;let n;for(let s=r;s>=0;s--){const o=this.members[s];if(o.isPresent!==!1){n=o;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:s}=t.options;s===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function r6(e,t,r){let n="";const s=e.x.translate/t.x,o=e.y.translate/t.y;if((s||o)&&(n=`translate3d(${s}px, ${o}px, 0) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{rotate:c,rotateX:d,rotateY:u}=r;c&&(n+=`rotate(${c}deg) `),d&&(n+=`rotateX(${d}deg) `),u&&(n+=`rotateY(${u}deg) `)}const i=e.x.scale*t.x,l=e.y.scale*t.y;return(i!==1||l!==1)&&(n+=`scale(${i}, ${l})`),n||"none"}const _pe=(e,t)=>e.depth-t.depth;class Npe{constructor(){this.children=[],this.isDirty=!1}add(t){wD(this.children,t),this.isDirty=!0}remove(t){jD(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(_pe),this.isDirty=!1,this.children.forEach(t)}}function Spe(e,t){const r=performance.now(),n=({timestamp:s})=>{const o=s-r;o>=t&&(Bm(n),e(o-t))};return Io.read(n,!0),()=>Bm(n)}function Cpe(e){window.MotionDebug&&window.MotionDebug.record(e)}function Ppe(e){return e instanceof SVGElement&&e.tagName!=="svg"}function Ape(e,t,r){const n=Qc(e)?e:m0(e);return n.start(bD("",n,t,r)),n.animation}const n6=["","X","Y","Z"],Epe={visibility:"hidden"},a6=1e3;let kpe=0;const tg={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function qK({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:s}){return class{constructor(i={},l=t?.()){this.id=kpe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,tg.totalNodes=tg.resolvedTargetDeltas=tg.recalculatedProjection=0,this.nodes.forEach(Tpe),this.nodes.forEach(Lpe),this.nodes.forEach($pe),this.nodes.forEach(Dpe),Cpe(tg)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Npe)}addEventListener(i,l){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new _D),this.eventHandlers.get(i).add(l)}notifyListeners(i,...l){const c=this.eventHandlers.get(i);c&&c.notify(...l)}hasListeners(i){return this.eventHandlers.has(i)}mount(i,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Ppe(i),this.instance=i;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const h=()=>this.root.updateBlockedByResize=!1;e(i,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=Spe(h,250),E_.hasAnimatedSinceResize&&(E_.hasAnimatedSinceResize=!1,this.nodes.forEach(o6))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:h,hasRelativeTargetChanged:m,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||u.getDefaultTransition()||Vpe,{onLayoutAnimationStart:v,onLayoutAnimationComplete:y}=u.getProps(),b=!this.targetLayout||!BK(this.targetLayout,x)||m,w=!h&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||h&&(b||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,w);const j={...yD(g,"layout"),onPlay:v,onComplete:y};(u.shouldReduceMotion||this.options.layoutRoot)&&(j.delay=0,j.type=!1),this.startAnimation(j)}else h||o6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Bm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Bpe),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const f=this.path[u];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(s6);return}this.isUpdating||this.nodes.forEach(Rpe),this.isUpdating=!1,this.nodes.forEach(Fpe),this.nodes.forEach(Ipe),this.nodes.forEach(Ope),this.clearAllSnapshots();const l=performance.now();Hl.delta=pp(0,1e3/60,l-Hl.timestamp),Hl.timestamp=l,Hl.isProcessing=!0,OA.update.process(Hl),OA.preRender.process(Hl),OA.render.process(Hl),Hl.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Mpe),this.sharedNodes.forEach(qpe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Io.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Io.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Pi(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let l=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(l=!1),l&&(this.scroll={animationId:this.root.animationId,phase:i,isRoot:n(this.instance),offset:r(this.instance)})}resetTransform(){if(!s)return;const i=this.isLayoutDirty||this.shouldResetTransform,l=this.projectionDelta&&!$K(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;i&&(l||eg(this.latestValues)||u)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return i&&(c=this.removeTransform(c)),Wpe(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:i}=this.options;if(!i)return Pi();const l=i.measureViewportBox(),{scroll:c}=this.root;return c&&(Nh(l.x,c.offset.x),Nh(l.y,c.offset.y)),l}removeElementScroll(i){const l=Pi();Hd(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:f}=d;if(d!==this.root&&u&&f.layoutScroll){if(u.isRoot){Hd(l,i);const{scroll:h}=this.root;h&&(Nh(l.x,-h.offset.x),Nh(l.y,-h.offset.y))}Nh(l.x,u.offset.x),Nh(l.y,u.offset.y)}}return l}applyTransform(i,l=!1){const c=Pi();Hd(c,i);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Av(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),eg(u.latestValues)&&Av(c,u.latestValues)}return eg(this.latestValues)&&Av(c,this.latestValues),c}removeTransform(i){const l=Pi();Hd(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!eg(d.latestValues))continue;ZI(d.latestValues)&&d.updateSnapshot();const u=Pi(),f=d.measurePageBox();Hd(u,f),Z$(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return eg(this.latestValues)&&Z$(l,this.latestValues),l}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Hl.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(i||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:f,layoutId:h}=this.options;if(!(!this.layout||!(f||h))){if(this.resolvedRelativeTargetAt=Hl.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pi(),this.relativeTargetOrigin=Pi(),qb(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),Hd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Pi(),this.targetWithTransforms=Pi()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Hhe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Hd(this.target,this.layout.layoutBox),TK(this.target,this.targetDelta)):Hd(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Pi(),this.relativeTargetOrigin=Pi(),qb(this.relativeTargetOrigin,this.target,m.target),Hd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}tg.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||ZI(this.parent.latestValues)||OK(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var i;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((i=this.parent)===null||i===void 0)&&i.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Hl.timestamp&&(d=!1),d)return;const{layout:u,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||f))return;Hd(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,m=this.treeScale.y;tpe(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox);const{target:x}=l;if(!x){this.projectionTransform&&(this.projectionDelta=Pv(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Pv(),this.projectionDeltaWithTransform=Pv());const g=this.projectionTransform;Bb(this.projectionDelta,this.layoutCorrected,x,this.latestValues),this.projectionTransform=r6(this.projectionDelta,this.treeScale),(this.projectionTransform!==g||this.treeScale.x!==h||this.treeScale.y!==m)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x)),tg.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),i){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(i,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},f=Pv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=Pi(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,g=m!==x,v=this.getStack(),y=!v||v.members.length<=1,b=!!(g&&!y&&this.options.crossfade===!0&&!this.path.some(Upe));this.animationProgress=0;let w;this.mixTargetDelta=j=>{const _=j/1e3;i6(f.x,i.x,_),i6(f.y,i.y,_),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(qb(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),zpe(this.relativeTarget,this.relativeTargetOrigin,h,_),w&&wpe(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Pi()),Hd(w,this.relativeTarget)),g&&(this.animationValues=u,ppe(u,d,this.latestValues,_,b,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Bm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Io.update(()=>{E_.hasAnimatedSinceResize=!0,this.currentAnimation=Ape(0,a6,{...i,onUpdate:l=>{this.mixTargetDelta(l),i.onUpdate&&i.onUpdate(l)},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(a6),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=i;if(!(!l||!c||!d)){if(this!==i&&this.layout&&d&&zK(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Pi();const f=Ld(this.layout.layoutBox.x);c.x.min=i.target.x.min,c.x.max=c.x.min+f;const h=Ld(this.layout.layoutBox.y);c.y.min=i.target.y.min,c.y.max=c.y.min+h}Hd(l,c),Av(l,u),Bb(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(i,l){this.sharedNodes.has(i)||this.sharedNodes.set(i,new jpe),this.sharedNodes.get(i).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){var i;const{layoutId:l}=this.options;return l?((i=this.getStack())===null||i===void 0?void 0:i.lead)||this:this}getPrevLead(){var i;const{layoutId:l}=this.options;return l?(i=this.getStack())===null||i===void 0?void 0:i.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),i&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetRotation(){const{visualElement:i}=this.options;if(!i)return;let l=!1;const{latestValues:c}=i;if((c.rotate||c.rotateX||c.rotateY||c.rotateZ)&&(l=!0),!l)return;const d={};for(let u=0;u<n6.length;u++){const f="rotate"+n6[u];c[f]&&(d[f]=c[f],i.setStaticValue(f,0))}i.render();for(const u in d)i.setStaticValue(u,d[u]);i.scheduleRender()}getProjectionStyles(i){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Epe;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=A_(i?.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const g={};return this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=A_(i?.pointerEvents)||""),this.hasProjected&&!eg(this.latestValues)&&(g.transform=u?u({},""):"none",this.hasProjected=!1),g}const h=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=r6(this.projectionDeltaWithTransform,this.treeScale,h),u&&(d.transform=u(h,d.transform));const{x:m,y:x}=this.projectionDelta;d.transformOrigin=`${m.origin*100}% ${x.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(l=h.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:d.opacity=f===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const g in jN){if(h[g]===void 0)continue;const{correct:v,applyTo:y}=jN[g],b=d.transform==="none"?h[g]:v(h[g],f);if(y){const w=y.length;for(let j=0;j<w;j++)d[y[j]]=b}else d[g]=b}return this.options.layoutId&&(d.pointerEvents=f===this?A_(i?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>{var l;return(l=i.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(s6),this.root.sharedNodes.clear()}}}function Ipe(e){e.updateLayout()}function Ope(e){var t;const r=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:s}=e.layout,{animationType:o}=e.options,i=r.source!==e.layout.source;o==="size"?Zd(f=>{const h=i?r.measuredBox[f]:r.layoutBox[f],m=Ld(h);h.min=n[f].min,h.max=h.min+m}):zK(o,r.layoutBox,n)&&Zd(f=>{const h=i?r.measuredBox[f]:r.layoutBox[f],m=Ld(n[f]);h.max=h.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+m)});const l=Pv();Bb(l,n,r.layoutBox);const c=Pv();i?Bb(c,e.applyTransform(s,!0),r.measuredBox):Bb(c,n,r.layoutBox);const d=!$K(l);let u=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:m}=f;if(h&&m){const x=Pi();qb(x,r.layoutBox,h.layoutBox);const g=Pi();qb(g,n,m.layoutBox),BK(x,g)||(u=!0),f.options.layoutRoot&&(e.relativeTarget=g,e.relativeTargetOrigin=x,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:r,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Tpe(e){tg.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Dpe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Mpe(e){e.clearSnapshot()}function s6(e){e.clearMeasurements()}function Rpe(e){e.isLayoutDirty=!1}function Fpe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function o6(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Lpe(e){e.resolveTargetDelta()}function $pe(e){e.calcProjection()}function Bpe(e){e.resetRotation()}function qpe(e){e.removeLeadSnapshot()}function i6(e,t,r){e.translate=Jo(t.translate,0,r),e.scale=Jo(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function l6(e,t,r,n){e.min=Jo(t.min,r.min,n),e.max=Jo(t.max,r.max,n)}function zpe(e,t,r,n){l6(e.x,t.x,r.x,n),l6(e.y,t.y,r.y,n)}function Upe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Vpe={duration:.45,ease:[.4,0,.1,1]},c6=e=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(e),d6=c6("applewebkit/")&&!c6("chrome/")?Math.round:ui;function u6(e){e.min=d6(e.min),e.max=d6(e.max)}function Wpe(e){u6(e.x),u6(e.y)}function zK(e,t,r){return e==="position"||e==="preserve-aspect"&&!JI(t6(t),t6(r),.2)}const Hpe=qK({attachResizeListener:(e,t)=>Nm(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),UA={current:void 0},UK=qK({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!UA.current){const e=new Hpe({});e.mount(window),e.setOptions({layoutScroll:!0}),UA.current=e}return UA.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Gpe={pan:{Feature:cpe},drag:{Feature:lpe,ProjectionNode:UK,MeasureLayout:RK}},Kpe=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Xpe(e){const t=Kpe.exec(e);if(!t)return[,];const[,r,n]=t;return[r,n]}function tO(e,t,r=1){const[n,s]=Xpe(e);if(!n)return;const o=window.getComputedStyle(t).getPropertyValue(n);if(o){const i=o.trim();return SK(i)?parseFloat(i):i}else return VI(s)?tO(s,t,r+1):s}function Ype(e,{...t},r){const n=e.current;if(!(n instanceof Element))return{target:t,transitionEnd:r};r&&(r={...r}),e.values.forEach(s=>{const o=s.get();if(!VI(o))return;const i=tO(o,n);i&&s.set(i)});for(const s in t){const o=t[s];if(!VI(o))continue;const i=tO(o,n);i&&(t[s]=i,r||(r={}),r[s]===void 0&&(r[s]=o))}return{target:t,transitionEnd:r}}const Jpe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),VK=e=>Jpe.has(e),Qpe=e=>Object.keys(e).some(VK),f6=e=>e===vx||e===es,m6=(e,t)=>parseFloat(e.split(", ")[t]),h6=(e,t)=>(r,{transform:n})=>{if(n==="none"||!n)return 0;const s=n.match(/^matrix3d\((.+)\)$/);if(s)return m6(s[1],t);{const o=n.match(/^matrix\((.+)\)$/);return o?m6(o[1],e):0}},Zpe=new Set(["x","y","z"]),ege=Y1.filter(e=>!Zpe.has(e));function tge(e){const t=[];return ege.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t.length&&e.render(),t}const h0={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:h6(4,13),y:h6(5,14)};h0.translateX=h0.x;h0.translateY=h0.y;const rge=(e,t,r)=>{const n=t.measureViewportBox(),s=t.current,o=getComputedStyle(s),{display:i}=o,l={};i==="none"&&t.setStaticValue("display",e.display||"block"),r.forEach(d=>{l[d]=h0[d](n,o)}),t.render();const c=t.measureViewportBox();return r.forEach(d=>{const u=t.getValue(d);u&&u.jump(l[d]),e[d]=h0[d](c,o)}),e},nge=(e,t,r={},n={})=>{t={...t},n={...n};const s=Object.keys(t).filter(VK);let o=[],i=!1;const l=[];if(s.forEach(c=>{const d=e.getValue(c);if(!e.hasValue(c))return;let u=r[c],f=Wy(u);const h=t[c];let m;if(NN(h)){const x=h.length,g=h[0]===null?1:0;u=h[g],f=Wy(u);for(let v=g;v<x&&h[v]!==null;v++)m?hD(Wy(h[v])===m):m=Wy(h[v])}else m=Wy(h);if(f!==m)if(f6(f)&&f6(m)){const x=d.get();typeof x=="string"&&d.set(parseFloat(x)),typeof h=="string"?t[c]=parseFloat(h):Array.isArray(h)&&m===es&&(t[c]=h.map(parseFloat))}else f?.transform&&m?.transform&&(u===0||h===0)?u===0?d.set(m.transform(u)):t[c]=f.transform(h):(i||(o=tge(e),i=!0),l.push(c),n[c]=n[c]!==void 0?n[c]:t[c],d.jump(h))}),l.length){const c=l.indexOf("height")>=0?window.pageYOffset:null,d=rge(t,e,l);return o.length&&o.forEach(([u,f])=>{e.getValue(u).set(f)}),e.render(),WC&&c!==null&&window.scrollTo({top:c}),{target:d,transitionEnd:n}}else return{target:t,transitionEnd:n}};function age(e,t,r,n){return Qpe(t)?nge(e,t,r,n):{target:t,transitionEnd:n}}const sge=(e,t,r,n)=>{const s=Ype(e,t,n);return t=s.target,n=s.transitionEnd,age(e,t,r,n)},rO={current:null},WK={current:!1};function oge(){if(WK.current=!0,!!WC)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>rO.current=e.matches;e.addListener(t),t()}else rO.current=!1}function ige(e,t,r){const{willChange:n}=t;for(const s in t){const o=t[s],i=r[s];if(Qc(o))e.addValue(s,o),AN(n)&&n.add(s);else if(Qc(i))e.addValue(s,m0(o,{owner:e})),AN(n)&&n.remove(s);else if(i!==o)if(e.hasValue(s)){const l=e.getValue(s);!l.hasAnimated&&l.set(o)}else{const l=e.getStaticValue(s);e.addValue(s,m0(l!==void 0?l:o,{owner:e}))}}for(const s in r)t[s]===void 0&&e.removeValue(s);return t}const p6=new WeakMap,HK=Object.keys(Dw),lge=HK.length,g6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],cge=sD.length;class dge{constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:s,visualState:o},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Io.render(this.render,!1,!0);const{latestValues:l,renderState:c}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=r.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=s,this.options=i,this.isControllingVariants=GC(r),this.isVariantNode=kG(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:d,...u}=this.scrapeMotionValuesFromProps(r,{});for(const f in u){const h=u[f];l[f]!==void 0&&Qc(h)&&(h.set(l[f],!1),AN(d)&&d.add(f))}}scrapeMotionValuesFromProps(t,r){return{}}mount(t){this.current=t,p6.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),WK.current||oge(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:rO.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){p6.delete(this.current),this.projection&&this.projection.unmount(),Bm(this.notifyUpdate),Bm(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,r){const n=xx.has(t),s=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&Io.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),o=r.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{s(),o()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...r},n,s,o){let i,l;for(let c=0;c<lge;c++){const d=HK[c],{isEnabled:u,Feature:f,ProjectionNode:h,MeasureLayout:m}=Dw[d];h&&(i=h),u(r)&&(!this.features[d]&&f&&(this.features[d]=new f(this)),m&&(l=m))}if((this.type==="html"||this.type==="svg")&&!this.projection&&i){this.projection=new i(this.latestValues,this.parent&&this.parent.projection);const{layoutId:c,layout:d,drag:u,dragConstraints:f,layoutScroll:h,layoutRoot:m}=r;this.projection.setOptions({layoutId:c,layout:d,alwaysMeasureLayout:!!u||f&&Sv(f),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof d=="string"?d:"both",initialPromotionConfig:o,layoutScroll:h,layoutRoot:m})}return l}updateFeatures(){for(const t in this.features){const r=this.features[t];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Pi()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}makeTargetAnimatable(t,r=!0){return this.makeTargetAnimatableFromInstance(t,this.props,r)}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<g6.length;n++){const s=g6[n];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const o=t["on"+s];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=ige(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const n=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(n.initial=this.props.initial),n}const r={};for(let n=0;n<cge;n++){const s=sD[n],o=this.props[s];(Tw(o)||o===!1)&&(r[s]=o)}return r}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){r!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,r)),this.values.set(t,r),this.latestValues[t]=r.get()}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=m0(r,{owner:this}),this.addValue(t,n)),n}readValue(t){var r;return this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(r=this.getBaseTargetFromProps(this.props,t))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,t,this.options)}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var r;const{initial:n}=this.props,s=typeof n=="string"||typeof n=="object"?(r=mD(this.props,n))===null||r===void 0?void 0:r[t]:void 0;if(n&&s!==void 0)return s;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!Qc(o)?o:this.initialValues[t]!==void 0&&s===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new _D),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}}class GK extends dge{sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}makeTargetAnimatableFromInstance({transition:t,transitionEnd:r,...n},{transformValues:s},o){let i=Phe(n,t||{},this);if(s&&(r&&(r=s(r)),n&&(n=s(n)),i&&(i=s(i))),o){She(this,n,i);const l=sge(this,n,i,r);r=l.transitionEnd,n=l.target}return{transition:t,transitionEnd:r,...n}}}function uge(e){return window.getComputedStyle(e)}class fge extends GK{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,r){if(xx.has(r)){const n=vD(r);return n&&n.default||0}else{const n=uge(t),s=(DG(r)?n.getPropertyValue(r):n[r])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:r}){return DK(t,r)}build(t,r,n,s){lD(t,r,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,r){return fD(t,r)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Qc(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}renderInstance(t,r,n,s){BG(t,r,n,s)}}class mge extends GK{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(xx.has(r)){const n=vD(r);return n&&n.default||0}return r=qG.has(r)?r:nD(r),t.getAttribute(r)}measureInstanceViewportBox(){return Pi()}scrapeMotionValuesFromProps(t,r){return UG(t,r)}build(t,r,n,s){dD(t,r,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,r,n,s){zG(t,r,n,s)}mount(t){this.isSVGTag=uD(t.tagName),super.mount(t)}}const hge=(e,t)=>iD(e)?new mge(t,{enableHardwareAcceleration:!1}):new fge(t,{enableHardwareAcceleration:!0}),pge={layout:{ProjectionNode:UK,MeasureLayout:RK}},gge={...zhe,...lme,...Gpe,...pge},Mr=xfe((e,t)=>Xfe(e,t,gge,hge));function KK(){const e=p.useRef(!1);return rD(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function xge(){const e=KK(),[t,r]=p.useState(0),n=p.useCallback(()=>{e.current&&r(t+1)},[t]);return[p.useCallback(()=>Io.postRender(n),[n]),t]}class vge extends p.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=r.offsetHeight||0,n.width=r.offsetWidth||0,n.top=r.offsetTop,n.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function yge({children:e,isPresent:t}){const r=p.useId(),n=p.useRef(null),s=p.useRef({width:0,height:0,top:0,left:0});return p.useInsertionEffect(()=>{const{width:o,height:i,top:l,left:c}=s.current;if(t||!n.current||!o||!i)return;n.current.dataset.motionPopId=r;const d=document.createElement("style");return document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${i}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[t]),p.createElement(vge,{isPresent:t,childRef:n,sizeRef:s},p.cloneElement(e,{ref:n}))}const VA=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:s,presenceAffectsLayout:o,mode:i})=>{const l=VG(bge),c=p.useId(),d=p.useMemo(()=>({id:c,initial:t,isPresent:r,custom:s,onExitComplete:u=>{l.set(u,!0);for(const f of l.values())if(!f)return;n&&n()},register:u=>(l.set(u,!1),()=>l.delete(u))}),o?void 0:[r]);return p.useMemo(()=>{l.forEach((u,f)=>l.set(f,!1))},[r]),p.useEffect(()=>{!r&&!l.size&&n&&n()},[r]),i==="popLayout"&&(e=p.createElement(yge,{isPresent:r},e)),p.createElement(VC.Provider,{value:d},e)};function bge(){return new Map}function wge(e){return p.useEffect(()=>()=>e(),[])}const rg=e=>e.key||"";function jge(e,t){e.forEach(r=>{const n=rg(r);t.set(n,r)})}function _ge(e){const t=[];return p.Children.forEach(e,r=>{p.isValidElement(r)&&t.push(r)}),t}const Nge=({children:e,custom:t,initial:r=!0,onExitComplete:n,exitBeforeEnter:s,presenceAffectsLayout:o=!0,mode:i="sync"})=>{const l=p.useContext(oD).forceRender||xge()[0],c=KK(),d=_ge(e);let u=d;const f=p.useRef(new Map).current,h=p.useRef(u),m=p.useRef(new Map).current,x=p.useRef(!0);if(rD(()=>{x.current=!1,jge(d,m),h.current=u}),wge(()=>{x.current=!0,m.clear(),f.clear()}),x.current)return p.createElement(p.Fragment,null,u.map(b=>p.createElement(VA,{key:rg(b),isPresent:!0,initial:r?void 0:!1,presenceAffectsLayout:o,mode:i},b)));u=[...u];const g=h.current.map(rg),v=d.map(rg),y=g.length;for(let b=0;b<y;b++){const w=g[b];v.indexOf(w)===-1&&!f.has(w)&&f.set(w,void 0)}return i==="wait"&&f.size&&(u=[]),f.forEach((b,w)=>{if(v.indexOf(w)!==-1)return;const j=m.get(w);if(!j)return;const _=g.indexOf(w);let C=b;if(!C){const A=()=>{f.delete(w);const S=Array.from(m.keys()).filter(P=>!v.includes(P));if(S.forEach(P=>m.delete(P)),h.current=d.filter(P=>{const M=rg(P);return M===w||S.includes(M)}),!f.size){if(c.current===!1)return;l(),n&&n()}};C=p.createElement(VA,{key:rg(j),isPresent:!1,onExitComplete:A,custom:t,presenceAffectsLayout:o,mode:i},j),f.set(w,C)}u.splice(_,0,C)}),u=u.map(b=>{const w=b.key;return f.has(w)?b:p.createElement(VA,{key:rg(b),isPresent:!0,presenceAffectsLayout:o,mode:i},b)}),p.createElement(p.Fragment,null,f.size?u:u.map(b=>p.cloneElement(b)))};function x6(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function JC(...e){return t=>{let r=!1;const n=e.map(s=>{const o=x6(s,t);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let s=0;s<n.length;s++){const o=n[s];typeof o=="function"?o():x6(e[s],null)}}}}function Ds(...e){return p.useCallback(JC(...e),e)}function xp(e){const t=Cge(e),r=p.forwardRef((n,s)=>{const{children:o,...i}=n,l=p.Children.toArray(o),c=l.find(Age);if(c){const d=c.props.children,u=l.map(f=>f===c?p.Children.count(d)>1?p.Children.only(null):p.isValidElement(d)?d.props.children:null:f);return a.jsx(t,{...i,ref:s,children:p.isValidElement(d)?p.cloneElement(d,void 0,u):null})}return a.jsx(t,{...i,ref:s,children:o})});return r.displayName=`${e}.Slot`,r}var Sge=xp("Slot");function Cge(e){const t=p.forwardRef((r,n)=>{const{children:s,...o}=r;if(p.isValidElement(s)){const i=kge(s),l=Ege(o,s.props);return s.type!==p.Fragment&&(l.ref=n?JC(n,i):i),p.cloneElement(s,l)}return p.Children.count(s)>1?p.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var XK=Symbol("radix.slottable");function Pge(e){const t=({children:r})=>a.jsx(a.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=XK,t}function Age(e){return p.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===XK}function Ege(e,t){const r={...t};for(const n in t){const s=e[n],o=t[n];/^on[A-Z]/.test(n)?s&&o?r[n]=(...l)=>{const c=o(...l);return s(...l),c}:s&&(r[n]=s):n==="style"?r[n]={...s,...o}:n==="className"&&(r[n]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}function kge(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}const v6=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,y6=ls,ND=(e,t)=>r=>{var n;if(t?.variants==null)return y6(e,r?.class,r?.className);const{variants:s,defaultVariants:o}=t,i=Object.keys(s).map(d=>{const u=r?.[d],f=o?.[d];if(u===null)return null;const h=v6(u)||v6(f);return s[d][h]}),l=r&&Object.entries(r).reduce((d,u)=>{let[f,h]=u;return h===void 0||(d[f]=h),d},{}),c=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((d,u)=>{let{class:f,className:h,...m}=u;return Object.entries(m).every(x=>{let[g,v]=x;return Array.isArray(v)?v.includes({...o,...l}[g]):{...o,...l}[g]===v})?[...d,f,h]:d},[]);return y6(e,i,c,r?.class,r?.className)},Rw=ND("inline-flex items-center justify-center rounded-sm text-sm font-bold tracking-wide transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background active:scale-[0.98] disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-brand text-primary-foreground hover:bg-brand/90 shadow-lg shadow-brand/15",destructive:"bg-danger text-white hover:bg-danger/90 shadow-lg shadow-danger/15",outline:"border border-border bg-transparent hover:bg-accent hover:text-accent-foreground",secondary:"bg-surface-2 text-secondary-foreground hover:bg-surface-2/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-brand underline-offset-4 hover:underline",success:"bg-success text-white hover:bg-success/90 shadow-lg shadow-success/15"},size:{default:"h-10 px-5 py-2 gap-2",sm:"h-9 rounded-sm px-3 gap-1.5",lg:"h-12 rounded-md px-8 gap-2.5 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Z=Ce.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...s},o)=>{const i=n?Sge:"button";return a.jsx(i,{className:Er(Rw({variant:t,size:r,className:e})),ref:o,...s})});Z.displayName="Button";const g2=[{to:"/",icon:Hue,label:"Painel Principal"},{to:"/agenda",icon:ko,label:"Agenda"},{to:"/vendas",icon:X1,label:"Loja"},{to:"/financeiro",icon:CG,label:"Financeiro"},{to:"/fiscal",icon:Y4,label:"Central Fiscal"}],k_={hidden:{opacity:0,x:-20},visible:e=>({opacity:1,x:0,transition:{delay:e*.05+.3,duration:.3,ease:"easeOut"}})},Ige=({to:e,icon:t,label:r,index:n,onNavigate:s})=>{const o="flex items-center h-[52px] px-4 rounded-sm bg-brand text-primary-foreground font-bold shadow-lg shadow-brand/10 border-l-4 border-brand w-full",i="flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 border-transparent w-full";return a.jsx(Mr.li,{custom:n,variants:k_,initial:"hidden",animate:"visible",whileHover:{x:4},transition:{type:"spring",stiffness:300,damping:15},children:a.jsxs(hm,{to:e,onClick:s,className:({isActive:l})=>e==="/isis"&&l?"flex items-center h-[52px] px-4 rounded-sm font-bold text-white shadow-lg shadow-emerald-500/10 border-l-4 border-transparent bg-gradient-to-r from-fuchsia-600 via-violet-600 to-emerald-600 ring-1 ring-white/10":l?o:i,children:[e==="/isis"?a.jsx("span",{className:"mr-4 flex-shrink-0 inline-flex items-center justify-center rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)]",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(cl,{size:"sm"})})}):a.jsx(t,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base flex items-center gap-2",children:r})]})})};function Oge({onNavigate:e,isVisible:t,setIsVisible:r,sidebarPinned:n}){const s=Ol(),o=Mi(),i=["/produtos","/compras","/clientes","/equipe","/quadras","/empresas","/finalizadoras"],l=p.useMemo(()=>i.includes(o.pathname),[o.pathname]),[c,d]=p.useState(l),u=p.useRef(null);p.useRef(null);const f=p.useRef(0),h=p.useRef(0),m=()=>{window.innerWidth<768&&r(!1)};return p.useEffect(()=>{const x=y=>{window.innerWidth>=768||(f.current=y.touches[0].clientX,h.current=y.touches[0].clientY)},g=y=>{if(window.innerWidth>=768)return;const b=y.touches[0].clientX,w=y.touches[0].clientY,j=b-f.current,_=Math.abs(w-h.current);f.current<50&&j>50&&_<50&&r(!0)},v=()=>{f.current=0,h.current=0};return window.addEventListener("touchstart",x,{passive:!0}),window.addEventListener("touchmove",g,{passive:!0}),window.addEventListener("touchend",v,{passive:!0}),()=>{window.removeEventListener("touchstart",x),window.removeEventListener("touchmove",g),window.removeEventListener("touchend",v)}},[t]),a.jsx(a.Fragment,{children:a.jsxs(Mr.aside,{ref:u,initial:!1,animate:{width:n||t?280:0},className:`h-screen bg-surface flex flex-col border-r border-border shadow-xl shadow-black/20 overflow-hidden\r
                   fixed inset-y-0 left-0 z-40 md:static md:flex-shrink-0`,children:[a.jsxs(Mr.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},className:"flex items-center px-6 pt-8 pb-6 h-[120px] flex-shrink-0",children:[a.jsx("div",{className:"w-14 h-14 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(Nd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]}),a.jsx("nav",{className:"flex-1 overflow-y-auto px-6 py-2 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent hover:scrollbar-thumb-border-hover",children:a.jsxs("ul",{className:"space-y-3",children:[g2.map((x,g)=>a.jsx(Ige,{...x,index:g,onNavigate:m},x.to)),a.jsxs(Mr.li,{custom:g2.length,variants:k_,initial:"hidden",animate:"visible",children:[a.jsxs("button",{type:"button",onClick:()=>d(x=>!x),className:`w-full flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 ${l?"bg-brand text-primary-foreground font-bold border-brand":"border-transparent"}`,children:[a.jsx(Lue,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base flex-1 text-left",children:"Cadastros"}),a.jsx(gx,{className:`h-4 w-4 transition-transform ${c?"rotate-180":""}`})]}),c&&a.jsxs("ul",{className:"mt-2 ml-8 space-y-2",children:[a.jsx("li",{children:a.jsxs(hm,{to:"/clientes",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(vc,{className:"h-4 w-4 mr-3"})," Clientes & Fornecedores"]})}),a.jsx("li",{children:a.jsxs(hm,{to:"/finalizadoras",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(Rh,{className:"h-4 w-4 mr-3"})," Finalizadoras"]})}),a.jsx("li",{children:a.jsxs(hm,{to:"/produtos",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(ju,{className:"h-4 w-4 mr-3"})," Produtos"]})}),a.jsx("li",{children:a.jsxs(hm,{to:"/equipe",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(ofe,{className:"h-4 w-4 mr-3"})," Equipe"]})}),a.jsx("li",{children:a.jsxs(hm,{to:"/quadras",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(Wue,{className:"h-4 w-4 mr-3"})," Quadras"]})}),a.jsx("li",{children:a.jsxs(hm,{to:"/empresas",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(bN,{className:"h-4 w-4 mr-3"})," Empresa"]})})]})]}),a.jsx(Mr.li,{custom:g2.length+1,variants:k_,initial:"hidden",animate:"visible",className:"pt-4 border-t border-border/50 mt-4",children:a.jsxs(hm,{to:"/suporte",onClick:m,className:({isActive:x})=>x?"flex items-center h-[52px] px-4 rounded-sm bg-brand text-primary-foreground font-bold shadow-lg shadow-brand/10 border-l-4 border-brand":"flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 border-transparent",children:[a.jsx(bG,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base",children:"Suporte"})]})}),a.jsx(Mr.li,{custom:g2.length+2,variants:k_,initial:"hidden",animate:"visible",children:a.jsxs(hm,{to:"/isis",onClick:m,className:({isActive:x})=>x?"flex items-center h-[56px] px-4 rounded-sm font-extrabold text-text-primary bg-surface-2/80 border border-white/20 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.06)]":"flex items-center h-[56px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border border-white/15",children:[a.jsx("span",{className:"mr-4 flex-shrink-0 inline-flex items-center justify-center rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)]",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(cl,{size:"sm"})})}),a.jsx("span",{className:"text-lg font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 via-violet-300 to-emerald-300",children:"sis"}),a.jsx("button",{type:"button",title:"Dashboard analtica da sis",onClick:x=>{x.preventDefault(),x.stopPropagation(),s("/isis/analytics")},className:"ml-auto inline-flex items-center justify-center p-2.5 rounded-full text-text-secondary hover:text-text-primary hover:bg-white/10 transition-all border border-white/10 hover:border-white/20 cursor-pointer shadow-sm hover:shadow",children:a.jsx(Xc,{className:"h-5 w-5"})})]})})]})})]})})}function aa(e,t,{checkForDefaultPrevented:r=!0}={}){return function(s){if(e?.(s),r===!1||!s.defaultPrevented)return t?.(s)}}function Tge(e,t){const r=p.createContext(t),n=o=>{const{children:i,...l}=o,c=p.useMemo(()=>l,Object.values(l));return a.jsx(r.Provider,{value:c,children:i})};n.displayName=e+"Provider";function s(o){const i=p.useContext(r);if(i)return i;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return[n,s]}function Cu(e,t=[]){let r=[];function n(o,i){const l=p.createContext(i),c=r.length;r=[...r,i];const d=f=>{const{scope:h,children:m,...x}=f,g=h?.[e]?.[c]||l,v=p.useMemo(()=>x,Object.values(x));return a.jsx(g.Provider,{value:v,children:m})};d.displayName=o+"Provider";function u(f,h){const m=h?.[e]?.[c]||l,x=p.useContext(m);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${o}\``)}return[d,u]}const s=()=>{const o=r.map(i=>p.createContext(i));return function(l){const c=l?.[e]||o;return p.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return s.scopeName=e,[n,Dge(s,...t)]}function Dge(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((l,{useScope:c,scopeName:d})=>{const f=c(o)[`__scope${d}`];return{...l,...f}},{});return p.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}var Mge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Xa=Mge.reduce((e,t)=>{const r=xp(`Primitive.${t}`),n=p.forwardRef((s,o)=>{const{asChild:i,...l}=s,c=i?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function SD(e,t){e&&Xm.flushSync(()=>e.dispatchEvent(t))}function Zc(e){const t=p.useRef(e);return p.useEffect(()=>{t.current=e}),p.useMemo(()=>(...r)=>t.current?.(...r),[])}function Rge(e,t=globalThis?.document){const r=Zc(e);p.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Fge="DismissableLayer",nO="dismissableLayer.update",Lge="dismissableLayer.pointerDownOutside",$ge="dismissableLayer.focusOutside",b6,YK=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ny=p.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:i,onDismiss:l,...c}=e,d=p.useContext(YK),[u,f]=p.useState(null),h=u?.ownerDocument??globalThis?.document,[,m]=p.useState({}),x=Ds(t,A=>f(A)),g=Array.from(d.layers),[v]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),y=g.indexOf(v),b=u?g.indexOf(u):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,j=b>=y,_=qge(A=>{const S=A.target,P=[...d.branches].some(M=>M.contains(S));!j||P||(s?.(A),i?.(A),A.defaultPrevented||l?.())},h),C=zge(A=>{const S=A.target;[...d.branches].some(M=>M.contains(S))||(o?.(A),i?.(A),A.defaultPrevented||l?.())},h);return Rge(A=>{b===d.layers.size-1&&(n?.(A),!A.defaultPrevented&&l&&(A.preventDefault(),l()))},h),p.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(b6=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),w6(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=b6)}},[u,h,r,d]),p.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),w6())},[u,d]),p.useEffect(()=>{const A=()=>m({});return document.addEventListener(nO,A),()=>document.removeEventListener(nO,A)},[]),a.jsx(Xa.div,{...c,ref:x,style:{pointerEvents:w?j?"auto":"none":void 0,...e.style},onFocusCapture:aa(e.onFocusCapture,C.onFocusCapture),onBlurCapture:aa(e.onBlurCapture,C.onBlurCapture),onPointerDownCapture:aa(e.onPointerDownCapture,_.onPointerDownCapture)})});ny.displayName=Fge;var Bge="DismissableLayerBranch",JK=p.forwardRef((e,t)=>{const r=p.useContext(YK),n=p.useRef(null),s=Ds(t,n);return p.useEffect(()=>{const o=n.current;if(o)return r.branches.add(o),()=>{r.branches.delete(o)}},[r.branches]),a.jsx(Xa.div,{...e,ref:s})});JK.displayName=Bge;function qge(e,t=globalThis?.document){const r=Zc(e),n=p.useRef(!1),s=p.useRef(()=>{});return p.useEffect(()=>{const o=l=>{if(l.target&&!n.current){let c=function(){QK(Lge,r,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=c,t.addEventListener("click",s.current,{once:!0})):c()}else t.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",o),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function zge(e,t=globalThis?.document){const r=Zc(e),n=p.useRef(!1);return p.useEffect(()=>{const s=o=>{o.target&&!n.current&&QK($ge,r,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function w6(){const e=new CustomEvent(nO);document.dispatchEvent(e)}function QK(e,t,r,{discrete:n}){const s=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?SD(s,o):s.dispatchEvent(o)}var Uge=ny,Vge=JK,WA=0;function QC(){p.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??j6()),document.body.insertAdjacentElement("beforeend",e[1]??j6()),WA++,()=>{WA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),WA--}},[])}function j6(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var HA="focusScope.autoFocusOnMount",GA="focusScope.autoFocusOnUnmount",_6={bubbles:!1,cancelable:!0},Wge="FocusScope",ej=p.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=e,[l,c]=p.useState(null),d=Zc(s),u=Zc(o),f=p.useRef(null),h=Ds(t,g=>c(g)),m=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(n){let g=function(w){if(m.paused||!l)return;const j=w.target;l.contains(j)?f.current=j:xh(f.current,{select:!0})},v=function(w){if(m.paused||!l)return;const j=w.relatedTarget;j!==null&&(l.contains(j)||xh(f.current,{select:!0}))},y=function(w){if(document.activeElement===document.body)for(const _ of w)_.removedNodes.length>0&&xh(l)};document.addEventListener("focusin",g),document.addEventListener("focusout",v);const b=new MutationObserver(y);return l&&b.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",v),b.disconnect()}}},[n,l,m.paused]),p.useEffect(()=>{if(l){S6.add(m);const g=document.activeElement;if(!l.contains(g)){const y=new CustomEvent(HA,_6);l.addEventListener(HA,d),l.dispatchEvent(y),y.defaultPrevented||(Hge(Jge(ZK(l)),{select:!0}),document.activeElement===g&&xh(l))}return()=>{l.removeEventListener(HA,d),setTimeout(()=>{const y=new CustomEvent(GA,_6);l.addEventListener(GA,u),l.dispatchEvent(y),y.defaultPrevented||xh(g??document.body,{select:!0}),l.removeEventListener(GA,u),S6.remove(m)},0)}}},[l,d,u,m]);const x=p.useCallback(g=>{if(!r&&!n||m.paused)return;const v=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,y=document.activeElement;if(v&&y){const b=g.currentTarget,[w,j]=Gge(b);w&&j?!g.shiftKey&&y===j?(g.preventDefault(),r&&xh(w,{select:!0})):g.shiftKey&&y===w&&(g.preventDefault(),r&&xh(j,{select:!0})):y===b&&g.preventDefault()}},[r,n,m.paused]);return a.jsx(Xa.div,{tabIndex:-1,...i,ref:h,onKeyDown:x})});ej.displayName=Wge;function Hge(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(xh(n,{select:t}),document.activeElement!==r)return}function Gge(e){const t=ZK(e),r=N6(t,e),n=N6(t.reverse(),e);return[r,n]}function ZK(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function N6(e,t){for(const r of e)if(!Kge(r,{upTo:t}))return r}function Kge(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Xge(e){return e instanceof HTMLInputElement&&"select"in e}function xh(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&Xge(e)&&t&&e.select()}}var S6=Yge();function Yge(){let e=[];return{add(t){const r=e[0];t!==r&&r?.pause(),e=C6(e,t),e.unshift(t)},remove(t){e=C6(e,t),e[0]?.resume()}}}function C6(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function Jge(e){return e.filter(t=>t.tagName!=="A")}var Il=globalThis?.document?p.useLayoutEffect:()=>{},Qge=Q3[" useId ".trim().toString()]||(()=>{}),Zge=0;function nf(e){const[t,r]=p.useState(Qge());return Il(()=>{e||r(n=>n??String(Zge++))},[e]),e||(t?`radix-${t}`:"")}const exe=["top","right","bottom","left"],vp=Math.min,bd=Math.max,kN=Math.round,x2=Math.floor,Vf=e=>({x:e,y:e}),txe={left:"right",right:"left",bottom:"top",top:"bottom"},rxe={start:"end",end:"start"};function aO(e,t,r){return bd(e,vp(t,r))}function qm(e,t){return typeof e=="function"?e(t):e}function zm(e){return e.split("-")[0]}function ay(e){return e.split("-")[1]}function CD(e){return e==="x"?"y":"x"}function PD(e){return e==="y"?"height":"width"}const nxe=new Set(["top","bottom"]);function Df(e){return nxe.has(zm(e))?"y":"x"}function AD(e){return CD(Df(e))}function axe(e,t,r){r===void 0&&(r=!1);const n=ay(e),s=AD(e),o=PD(s);let i=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(i=IN(i)),[i,IN(i)]}function sxe(e){const t=IN(e);return[sO(e),t,sO(t)]}function sO(e){return e.replace(/start|end/g,t=>rxe[t])}const P6=["left","right"],A6=["right","left"],oxe=["top","bottom"],ixe=["bottom","top"];function lxe(e,t,r){switch(e){case"top":case"bottom":return r?t?A6:P6:t?P6:A6;case"left":case"right":return t?oxe:ixe;default:return[]}}function cxe(e,t,r,n){const s=ay(e);let o=lxe(zm(e),r==="start",n);return s&&(o=o.map(i=>i+"-"+s),t&&(o=o.concat(o.map(sO)))),o}function IN(e){return e.replace(/left|right|bottom|top/g,t=>txe[t])}function dxe(e){return{top:0,right:0,bottom:0,left:0,...e}}function eX(e){return typeof e!="number"?dxe(e):{top:e,right:e,bottom:e,left:e}}function ON(e){const{x:t,y:r,width:n,height:s}=e;return{width:n,height:s,top:r,left:t,right:t+n,bottom:r+s,x:t,y:r}}function E6(e,t,r){let{reference:n,floating:s}=e;const o=Df(t),i=AD(t),l=PD(i),c=zm(t),d=o==="y",u=n.x+n.width/2-s.width/2,f=n.y+n.height/2-s.height/2,h=n[l]/2-s[l]/2;let m;switch(c){case"top":m={x:u,y:n.y-s.height};break;case"bottom":m={x:u,y:n.y+n.height};break;case"right":m={x:n.x+n.width,y:f};break;case"left":m={x:n.x-s.width,y:f};break;default:m={x:n.x,y:n.y}}switch(ay(t)){case"start":m[i]-=h*(r&&d?-1:1);break;case"end":m[i]+=h*(r&&d?-1:1);break}return m}const uxe=async(e,t,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:o=[],platform:i}=r,l=o.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(t));let d=await i.getElementRects({reference:e,floating:t,strategy:s}),{x:u,y:f}=E6(d,n,c),h=n,m={},x=0;for(let g=0;g<l.length;g++){const{name:v,fn:y}=l[g],{x:b,y:w,data:j,reset:_}=await y({x:u,y:f,initialPlacement:n,placement:h,strategy:s,middlewareData:m,rects:d,platform:i,elements:{reference:e,floating:t}});u=b??u,f=w??f,m={...m,[v]:{...m[v],...j}},_&&x<=50&&(x++,typeof _=="object"&&(_.placement&&(h=_.placement),_.rects&&(d=_.rects===!0?await i.getElementRects({reference:e,floating:t,strategy:s}):_.rects),{x:u,y:f}=E6(d,h,c)),g=-1)}return{x:u,y:f,placement:h,strategy:s,middlewareData:m}};async function Fw(e,t){var r;t===void 0&&(t={});const{x:n,y:s,platform:o,rects:i,elements:l,strategy:c}=e,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:h=!1,padding:m=0}=qm(t,e),x=eX(m),v=l[h?f==="floating"?"reference":"floating":f],y=ON(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(v)))==null||r?v:v.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(l.floating)),boundary:d,rootBoundary:u,strategy:c})),b=f==="floating"?{x:n,y:s,width:i.floating.width,height:i.floating.height}:i.reference,w=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l.floating)),j=await(o.isElement==null?void 0:o.isElement(w))?await(o.getScale==null?void 0:o.getScale(w))||{x:1,y:1}:{x:1,y:1},_=ON(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:b,offsetParent:w,strategy:c}):b);return{top:(y.top-_.top+x.top)/j.y,bottom:(_.bottom-y.bottom+x.bottom)/j.y,left:(y.left-_.left+x.left)/j.x,right:(_.right-y.right+x.right)/j.x}}const fxe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:s,rects:o,platform:i,elements:l,middlewareData:c}=t,{element:d,padding:u=0}=qm(e,t)||{};if(d==null)return{};const f=eX(u),h={x:r,y:n},m=AD(s),x=PD(m),g=await i.getDimensions(d),v=m==="y",y=v?"top":"left",b=v?"bottom":"right",w=v?"clientHeight":"clientWidth",j=o.reference[x]+o.reference[m]-h[m]-o.floating[x],_=h[m]-o.reference[m],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(d));let A=C?C[w]:0;(!A||!await(i.isElement==null?void 0:i.isElement(C)))&&(A=l.floating[w]||o.floating[x]);const S=j/2-_/2,P=A/2-g[x]/2-1,M=vp(f[y],P),O=vp(f[b],P),I=M,T=A-g[x]-O,k=A/2-g[x]/2+S,$=aO(I,k,T),q=!c.arrow&&ay(s)!=null&&k!==$&&o.reference[x]/2-(k<I?M:O)-g[x]/2<0,z=q?k<I?k-I:k-T:0;return{[m]:h[m]+z,data:{[m]:$,centerOffset:k-$-z,...q&&{alignmentOffset:z}},reset:q}}}),mxe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:s,middlewareData:o,rects:i,initialPlacement:l,platform:c,elements:d}=t,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:h,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:g=!0,...v}=qm(e,t);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const y=zm(s),b=Df(l),w=zm(l)===l,j=await(c.isRTL==null?void 0:c.isRTL(d.floating)),_=h||(w||!g?[IN(l)]:sxe(l)),C=x!=="none";!h&&C&&_.push(...cxe(l,g,x,j));const A=[l,..._],S=await Fw(t,v),P=[];let M=((n=o.flip)==null?void 0:n.overflows)||[];if(u&&P.push(S[y]),f){const k=axe(s,i,j);P.push(S[k[0]],S[k[1]])}if(M=[...M,{placement:s,overflows:P}],!P.every(k=>k<=0)){var O,I;const k=(((O=o.flip)==null?void 0:O.index)||0)+1,$=A[k];if($&&(!(f==="alignment"?b!==Df($):!1)||M.every(F=>Df(F.placement)===b?F.overflows[0]>0:!0)))return{data:{index:k,overflows:M},reset:{placement:$}};let q=(I=M.filter(z=>z.overflows[0]<=0).sort((z,F)=>z.overflows[1]-F.overflows[1])[0])==null?void 0:I.placement;if(!q)switch(m){case"bestFit":{var T;const z=(T=M.filter(F=>{if(C){const V=Df(F.placement);return V===b||V==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(V=>V>0).reduce((V,ue)=>V+ue,0)]).sort((F,V)=>F[1]-V[1])[0])==null?void 0:T[0];z&&(q=z);break}case"initialPlacement":q=l;break}if(s!==q)return{reset:{placement:q}}}return{}}}};function k6(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function I6(e){return exe.some(t=>e[t]>=0)}const hxe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...s}=qm(e,t);switch(n){case"referenceHidden":{const o=await Fw(t,{...s,elementContext:"reference"}),i=k6(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:I6(i)}}}case"escaped":{const o=await Fw(t,{...s,altBoundary:!0}),i=k6(o,r.floating);return{data:{escapedOffsets:i,escaped:I6(i)}}}default:return{}}}}},tX=new Set(["left","top"]);async function pxe(e,t){const{placement:r,platform:n,elements:s}=e,o=await(n.isRTL==null?void 0:n.isRTL(s.floating)),i=zm(r),l=ay(r),c=Df(r)==="y",d=tX.has(i)?-1:1,u=o&&c?-1:1,f=qm(t,e);let{mainAxis:h,crossAxis:m,alignmentAxis:x}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return l&&typeof x=="number"&&(m=l==="end"?x*-1:x),c?{x:m*u,y:h*d}:{x:h*d,y:m*u}}const gxe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:s,y:o,placement:i,middlewareData:l}=t,c=await pxe(t,e);return i===((r=l.offset)==null?void 0:r.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:s+c.x,y:o+c.y,data:{...c,placement:i}}}}},xxe=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:s}=t,{mainAxis:o=!0,crossAxis:i=!1,limiter:l={fn:v=>{let{x:y,y:b}=v;return{x:y,y:b}}},...c}=qm(e,t),d={x:r,y:n},u=await Fw(t,c),f=Df(zm(s)),h=CD(f);let m=d[h],x=d[f];if(o){const v=h==="y"?"top":"left",y=h==="y"?"bottom":"right",b=m+u[v],w=m-u[y];m=aO(b,m,w)}if(i){const v=f==="y"?"top":"left",y=f==="y"?"bottom":"right",b=x+u[v],w=x-u[y];x=aO(b,x,w)}const g=l.fn({...t,[h]:m,[f]:x});return{...g,data:{x:g.x-r,y:g.y-n,enabled:{[h]:o,[f]:i}}}}}},vxe=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:s,rects:o,middlewareData:i}=t,{offset:l=0,mainAxis:c=!0,crossAxis:d=!0}=qm(e,t),u={x:r,y:n},f=Df(s),h=CD(f);let m=u[h],x=u[f];const g=qm(l,t),v=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(c){const w=h==="y"?"height":"width",j=o.reference[h]-o.floating[w]+v.mainAxis,_=o.reference[h]+o.reference[w]-v.mainAxis;m<j?m=j:m>_&&(m=_)}if(d){var y,b;const w=h==="y"?"width":"height",j=tX.has(zm(s)),_=o.reference[f]-o.floating[w]+(j&&((y=i.offset)==null?void 0:y[f])||0)+(j?0:v.crossAxis),C=o.reference[f]+o.reference[w]+(j?0:((b=i.offset)==null?void 0:b[f])||0)-(j?v.crossAxis:0);x<_?x=_:x>C&&(x=C)}return{[h]:m,[f]:x}}}},yxe=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:s,rects:o,platform:i,elements:l}=t,{apply:c=()=>{},...d}=qm(e,t),u=await Fw(t,d),f=zm(s),h=ay(s),m=Df(s)==="y",{width:x,height:g}=o.floating;let v,y;f==="top"||f==="bottom"?(v=f,y=h===(await(i.isRTL==null?void 0:i.isRTL(l.floating))?"start":"end")?"left":"right"):(y=f,v=h==="end"?"top":"bottom");const b=g-u.top-u.bottom,w=x-u.left-u.right,j=vp(g-u[v],b),_=vp(x-u[y],w),C=!t.middlewareData.shift;let A=j,S=_;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(S=w),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(A=b),C&&!h){const M=bd(u.left,0),O=bd(u.right,0),I=bd(u.top,0),T=bd(u.bottom,0);m?S=x-2*(M!==0||O!==0?M+O:bd(u.left,u.right)):A=g-2*(I!==0||T!==0?I+T:bd(u.top,u.bottom))}await c({...t,availableWidth:S,availableHeight:A});const P=await i.getDimensions(l.floating);return x!==P.width||g!==P.height?{reset:{rects:!0}}:{}}}};function ZC(){return typeof window<"u"}function sy(e){return rX(e)?(e.nodeName||"").toLowerCase():"#document"}function Id(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function tm(e){var t;return(t=(rX(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function rX(e){return ZC()?e instanceof Node||e instanceof Id(e).Node:!1}function lf(e){return ZC()?e instanceof Element||e instanceof Id(e).Element:!1}function Qf(e){return ZC()?e instanceof HTMLElement||e instanceof Id(e).HTMLElement:!1}function O6(e){return!ZC()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Id(e).ShadowRoot}const bxe=new Set(["inline","contents"]);function tj(e){const{overflow:t,overflowX:r,overflowY:n,display:s}=cf(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!bxe.has(s)}const wxe=new Set(["table","td","th"]);function jxe(e){return wxe.has(sy(e))}const _xe=[":popover-open",":modal"];function e5(e){return _xe.some(t=>{try{return e.matches(t)}catch{return!1}})}const Nxe=["transform","translate","scale","rotate","perspective"],Sxe=["transform","translate","scale","rotate","perspective","filter"],Cxe=["paint","layout","strict","content"];function ED(e){const t=kD(),r=lf(e)?cf(e):e;return Nxe.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||Sxe.some(n=>(r.willChange||"").includes(n))||Cxe.some(n=>(r.contain||"").includes(n))}function Pxe(e){let t=yp(e);for(;Qf(t)&&!p0(t);){if(ED(t))return t;if(e5(t))return null;t=yp(t)}return null}function kD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Axe=new Set(["html","body","#document"]);function p0(e){return Axe.has(sy(e))}function cf(e){return Id(e).getComputedStyle(e)}function t5(e){return lf(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function yp(e){if(sy(e)==="html")return e;const t=e.assignedSlot||e.parentNode||O6(e)&&e.host||tm(e);return O6(t)?t.host:t}function nX(e){const t=yp(e);return p0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Qf(t)&&tj(t)?t:nX(t)}function Lw(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const s=nX(e),o=s===((n=e.ownerDocument)==null?void 0:n.body),i=Id(s);if(o){const l=oO(i);return t.concat(i,i.visualViewport||[],tj(s)?s:[],l&&r?Lw(l):[])}return t.concat(s,Lw(s,[],r))}function oO(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function aX(e){const t=cf(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const s=Qf(e),o=s?e.offsetWidth:r,i=s?e.offsetHeight:n,l=kN(r)!==o||kN(n)!==i;return l&&(r=o,n=i),{width:r,height:n,$:l}}function ID(e){return lf(e)?e:e.contextElement}function Uv(e){const t=ID(e);if(!Qf(t))return Vf(1);const r=t.getBoundingClientRect(),{width:n,height:s,$:o}=aX(t);let i=(o?kN(r.width):r.width)/n,l=(o?kN(r.height):r.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!l||!Number.isFinite(l))&&(l=1),{x:i,y:l}}const Exe=Vf(0);function sX(e){const t=Id(e);return!kD()||!t.visualViewport?Exe:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function kxe(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Id(e)?!1:t}function Qg(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const s=e.getBoundingClientRect(),o=ID(e);let i=Vf(1);t&&(n?lf(n)&&(i=Uv(n)):i=Uv(e));const l=kxe(o,r,n)?sX(o):Vf(0);let c=(s.left+l.x)/i.x,d=(s.top+l.y)/i.y,u=s.width/i.x,f=s.height/i.y;if(o){const h=Id(o),m=n&&lf(n)?Id(n):n;let x=h,g=oO(x);for(;g&&n&&m!==x;){const v=Uv(g),y=g.getBoundingClientRect(),b=cf(g),w=y.left+(g.clientLeft+parseFloat(b.paddingLeft))*v.x,j=y.top+(g.clientTop+parseFloat(b.paddingTop))*v.y;c*=v.x,d*=v.y,u*=v.x,f*=v.y,c+=w,d+=j,x=Id(g),g=oO(x)}}return ON({width:u,height:f,x:c,y:d})}function OD(e,t){const r=t5(e).scrollLeft;return t?t.left+r:Qg(tm(e)).left+r}function oX(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-(r?0:OD(e,n)),o=n.top+t.scrollTop;return{x:s,y:o}}function Ixe(e){let{elements:t,rect:r,offsetParent:n,strategy:s}=e;const o=s==="fixed",i=tm(n),l=t?e5(t.floating):!1;if(n===i||l&&o)return r;let c={scrollLeft:0,scrollTop:0},d=Vf(1);const u=Vf(0),f=Qf(n);if((f||!f&&!o)&&((sy(n)!=="body"||tj(i))&&(c=t5(n)),Qf(n))){const m=Qg(n);d=Uv(n),u.x=m.x+n.clientLeft,u.y=m.y+n.clientTop}const h=i&&!f&&!o?oX(i,c,!0):Vf(0);return{width:r.width*d.x,height:r.height*d.y,x:r.x*d.x-c.scrollLeft*d.x+u.x+h.x,y:r.y*d.y-c.scrollTop*d.y+u.y+h.y}}function Oxe(e){return Array.from(e.getClientRects())}function Txe(e){const t=tm(e),r=t5(e),n=e.ownerDocument.body,s=bd(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),o=bd(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+OD(e);const l=-r.scrollTop;return cf(n).direction==="rtl"&&(i+=bd(t.clientWidth,n.clientWidth)-s),{width:s,height:o,x:i,y:l}}function Dxe(e,t){const r=Id(e),n=tm(e),s=r.visualViewport;let o=n.clientWidth,i=n.clientHeight,l=0,c=0;if(s){o=s.width,i=s.height;const d=kD();(!d||d&&t==="fixed")&&(l=s.offsetLeft,c=s.offsetTop)}return{width:o,height:i,x:l,y:c}}const Mxe=new Set(["absolute","fixed"]);function Rxe(e,t){const r=Qg(e,!0,t==="fixed"),n=r.top+e.clientTop,s=r.left+e.clientLeft,o=Qf(e)?Uv(e):Vf(1),i=e.clientWidth*o.x,l=e.clientHeight*o.y,c=s*o.x,d=n*o.y;return{width:i,height:l,x:c,y:d}}function T6(e,t,r){let n;if(t==="viewport")n=Dxe(e,r);else if(t==="document")n=Txe(tm(e));else if(lf(t))n=Rxe(t,r);else{const s=sX(e);n={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return ON(n)}function iX(e,t){const r=yp(e);return r===t||!lf(r)||p0(r)?!1:cf(r).position==="fixed"||iX(r,t)}function Fxe(e,t){const r=t.get(e);if(r)return r;let n=Lw(e,[],!1).filter(l=>lf(l)&&sy(l)!=="body"),s=null;const o=cf(e).position==="fixed";let i=o?yp(e):e;for(;lf(i)&&!p0(i);){const l=cf(i),c=ED(i);!c&&l.position==="fixed"&&(s=null),(o?!c&&!s:!c&&l.position==="static"&&!!s&&Mxe.has(s.position)||tj(i)&&!c&&iX(e,i))?n=n.filter(u=>u!==i):s=l,i=yp(i)}return t.set(e,n),n}function Lxe(e){let{element:t,boundary:r,rootBoundary:n,strategy:s}=e;const i=[...r==="clippingAncestors"?e5(t)?[]:Fxe(t,this._c):[].concat(r),n],l=i[0],c=i.reduce((d,u)=>{const f=T6(t,u,s);return d.top=bd(f.top,d.top),d.right=vp(f.right,d.right),d.bottom=vp(f.bottom,d.bottom),d.left=bd(f.left,d.left),d},T6(t,l,s));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function $xe(e){const{width:t,height:r}=aX(e);return{width:t,height:r}}function Bxe(e,t,r){const n=Qf(t),s=tm(t),o=r==="fixed",i=Qg(e,!0,o,t);let l={scrollLeft:0,scrollTop:0};const c=Vf(0);function d(){c.x=OD(s)}if(n||!n&&!o)if((sy(t)!=="body"||tj(s))&&(l=t5(t)),n){const m=Qg(t,!0,o,t);c.x=m.x+t.clientLeft,c.y=m.y+t.clientTop}else s&&d();o&&!n&&s&&d();const u=s&&!n&&!o?oX(s,l):Vf(0),f=i.left+l.scrollLeft-c.x-u.x,h=i.top+l.scrollTop-c.y-u.y;return{x:f,y:h,width:i.width,height:i.height}}function KA(e){return cf(e).position==="static"}function D6(e,t){if(!Qf(e)||cf(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return tm(e)===r&&(r=r.ownerDocument.body),r}function lX(e,t){const r=Id(e);if(e5(e))return r;if(!Qf(e)){let s=yp(e);for(;s&&!p0(s);){if(lf(s)&&!KA(s))return s;s=yp(s)}return r}let n=D6(e,t);for(;n&&jxe(n)&&KA(n);)n=D6(n,t);return n&&p0(n)&&KA(n)&&!ED(n)?r:n||Pxe(e)||r}const qxe=async function(e){const t=this.getOffsetParent||lX,r=this.getDimensions,n=await r(e.floating);return{reference:Bxe(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function zxe(e){return cf(e).direction==="rtl"}const Uxe={convertOffsetParentRelativeRectToViewportRelativeRect:Ixe,getDocumentElement:tm,getClippingRect:Lxe,getOffsetParent:lX,getElementRects:qxe,getClientRects:Oxe,getDimensions:$xe,getScale:Uv,isElement:lf,isRTL:zxe};function cX(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Vxe(e,t){let r=null,n;const s=tm(e);function o(){var l;clearTimeout(n),(l=r)==null||l.disconnect(),r=null}function i(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),o();const d=e.getBoundingClientRect(),{left:u,top:f,width:h,height:m}=d;if(l||t(),!h||!m)return;const x=x2(f),g=x2(s.clientWidth-(u+h)),v=x2(s.clientHeight-(f+m)),y=x2(u),w={rootMargin:-x+"px "+-g+"px "+-v+"px "+-y+"px",threshold:bd(0,vp(1,c))||1};let j=!0;function _(C){const A=C[0].intersectionRatio;if(A!==c){if(!j)return i();A?i(!1,A):n=setTimeout(()=>{i(!1,1e-7)},1e3)}A===1&&!cX(d,e.getBoundingClientRect())&&i(),j=!1}try{r=new IntersectionObserver(_,{...w,root:s.ownerDocument})}catch{r=new IntersectionObserver(_,w)}r.observe(e)}return i(!0),o}function Wxe(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=n,d=ID(e),u=s||o?[...d?Lw(d):[],...Lw(t)]:[];u.forEach(y=>{s&&y.addEventListener("scroll",r,{passive:!0}),o&&y.addEventListener("resize",r)});const f=d&&l?Vxe(d,r):null;let h=-1,m=null;i&&(m=new ResizeObserver(y=>{let[b]=y;b&&b.target===d&&m&&(m.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var w;(w=m)==null||w.observe(t)})),r()}),d&&!c&&m.observe(d),m.observe(t));let x,g=c?Qg(e):null;c&&v();function v(){const y=Qg(e);g&&!cX(g,y)&&r(),g=y,x=requestAnimationFrame(v)}return r(),()=>{var y;u.forEach(b=>{s&&b.removeEventListener("scroll",r),o&&b.removeEventListener("resize",r)}),f?.(),(y=m)==null||y.disconnect(),m=null,c&&cancelAnimationFrame(x)}}const Hxe=gxe,Gxe=xxe,Kxe=mxe,Xxe=yxe,Yxe=hxe,M6=fxe,Jxe=vxe,Qxe=(e,t,r)=>{const n=new Map,s={platform:Uxe,...r},o={...s.platform,_c:n};return uxe(e,t,{...s,platform:o})};var Zxe=typeof document<"u",eve=function(){},I_=Zxe?p.useLayoutEffect:eve;function TN(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,s;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!TN(e[n],t[n]))return!1;return!0}if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,s[n]))return!1;for(n=r;n--!==0;){const o=s[n];if(!(o==="_owner"&&e.$$typeof)&&!TN(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function dX(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function R6(e,t){const r=dX(e);return Math.round(t*r)/r}function XA(e){const t=p.useRef(e);return I_(()=>{t.current=e}),t}function tve(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:i}={},transform:l=!0,whileElementsMounted:c,open:d}=e,[u,f]=p.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[h,m]=p.useState(n);TN(h,n)||m(n);const[x,g]=p.useState(null),[v,y]=p.useState(null),b=p.useCallback(F=>{F!==C.current&&(C.current=F,g(F))},[]),w=p.useCallback(F=>{F!==A.current&&(A.current=F,y(F))},[]),j=o||x,_=i||v,C=p.useRef(null),A=p.useRef(null),S=p.useRef(u),P=c!=null,M=XA(c),O=XA(s),I=XA(d),T=p.useCallback(()=>{if(!C.current||!A.current)return;const F={placement:t,strategy:r,middleware:h};O.current&&(F.platform=O.current),Qxe(C.current,A.current,F).then(V=>{const ue={...V,isPositioned:I.current!==!1};k.current&&!TN(S.current,ue)&&(S.current=ue,Xm.flushSync(()=>{f(ue)}))})},[h,t,r,O,I]);I_(()=>{d===!1&&S.current.isPositioned&&(S.current.isPositioned=!1,f(F=>({...F,isPositioned:!1})))},[d]);const k=p.useRef(!1);I_(()=>(k.current=!0,()=>{k.current=!1}),[]),I_(()=>{if(j&&(C.current=j),_&&(A.current=_),j&&_){if(M.current)return M.current(j,_,T);T()}},[j,_,T,M,P]);const $=p.useMemo(()=>({reference:C,floating:A,setReference:b,setFloating:w}),[b,w]),q=p.useMemo(()=>({reference:j,floating:_}),[j,_]),z=p.useMemo(()=>{const F={position:r,left:0,top:0};if(!q.floating)return F;const V=R6(q.floating,u.x),ue=R6(q.floating,u.y);return l?{...F,transform:"translate("+V+"px, "+ue+"px)",...dX(q.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:V,top:ue}},[r,l,q.floating,u.x,u.y]);return p.useMemo(()=>({...u,update:T,refs:$,elements:q,floatingStyles:z}),[u,T,$,q,z])}const rve=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:s}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?M6({element:n.current,padding:s}).fn(r):{}:n?M6({element:n,padding:s}).fn(r):{}}}},nve=(e,t)=>({...Hxe(e),options:[e,t]}),ave=(e,t)=>({...Gxe(e),options:[e,t]}),sve=(e,t)=>({...Jxe(e),options:[e,t]}),ove=(e,t)=>({...Kxe(e),options:[e,t]}),ive=(e,t)=>({...Xxe(e),options:[e,t]}),lve=(e,t)=>({...Yxe(e),options:[e,t]}),cve=(e,t)=>({...rve(e),options:[e,t]});var dve="Arrow",uX=p.forwardRef((e,t)=>{const{children:r,width:n=10,height:s=5,...o}=e;return a.jsx(Xa.svg,{...o,ref:t,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:a.jsx("polygon",{points:"0,0 30,0 15,10"})})});uX.displayName=dve;var uve=uX;function fX(e){const[t,r]=p.useState(void 0);return Il(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,l;if("borderBoxSize"in o){const c=o.borderBoxSize,d=Array.isArray(c)?c[0]:c;i=d.inlineSize,l=d.blockSize}else i=e.offsetWidth,l=e.offsetHeight;r({width:i,height:l})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var TD="Popper",[mX,oy]=Cu(TD),[fve,hX]=mX(TD),pX=e=>{const{__scopePopper:t,children:r}=e,[n,s]=p.useState(null);return a.jsx(fve,{scope:t,anchor:n,onAnchorChange:s,children:r})};pX.displayName=TD;var gX="PopperAnchor",xX=p.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...s}=e,o=hX(gX,r),i=p.useRef(null),l=Ds(t,i),c=p.useRef(null);return p.useEffect(()=>{const d=c.current;c.current=n?.current||i.current,d!==c.current&&o.onAnchorChange(c.current)}),n?null:a.jsx(Xa.div,{...s,ref:l})});xX.displayName=gX;var DD="PopperContent",[mve,hve]=mX(DD),vX=p.forwardRef((e,t)=>{const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:o="center",alignOffset:i=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:d=[],collisionPadding:u=0,sticky:f="partial",hideWhenDetached:h=!1,updatePositionStrategy:m="optimized",onPlaced:x,...g}=e,v=hX(DD,r),[y,b]=p.useState(null),w=Ds(t,W=>b(W)),[j,_]=p.useState(null),C=fX(j),A=C?.width??0,S=C?.height??0,P=n+(o!=="center"?"-"+o:""),M=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},O=Array.isArray(d)?d:[d],I=O.length>0,T={padding:M,boundary:O.filter(gve),altBoundary:I},{refs:k,floatingStyles:$,placement:q,isPositioned:z,middlewareData:F}=tve({strategy:"fixed",placement:P,whileElementsMounted:(...W)=>Wxe(...W,{animationFrame:m==="always"}),elements:{reference:v.anchor},middleware:[nve({mainAxis:s+S,alignmentAxis:i}),c&&ave({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?sve():void 0,...T}),c&&ove({...T}),ive({...T,apply:({elements:W,rects:Y,availableWidth:me,availableHeight:ee})=>{const{width:ae,height:le}=Y.reference,Te=W.floating.style;Te.setProperty("--radix-popper-available-width",`${me}px`),Te.setProperty("--radix-popper-available-height",`${ee}px`),Te.setProperty("--radix-popper-anchor-width",`${ae}px`),Te.setProperty("--radix-popper-anchor-height",`${le}px`)}}),j&&cve({element:j,padding:l}),xve({arrowWidth:A,arrowHeight:S}),h&&lve({strategy:"referenceHidden",...T})]}),[V,ue]=wX(q),_e=Zc(x);Il(()=>{z&&_e?.()},[z,_e]);const U=F.arrow?.x,L=F.arrow?.y,G=F.arrow?.centerOffset!==0,[de,X]=p.useState();return Il(()=>{y&&X(window.getComputedStyle(y).zIndex)},[y]),a.jsx("div",{ref:k.setFloating,"data-radix-popper-content-wrapper":"",style:{...$,transform:z?$.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:de,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:a.jsx(mve,{scope:r,placedSide:V,onArrowChange:_,arrowX:U,arrowY:L,shouldHideArrow:G,children:a.jsx(Xa.div,{"data-side":V,"data-align":ue,...g,ref:w,style:{...g.style,animation:z?void 0:"none"}})})})});vX.displayName=DD;var yX="PopperArrow",pve={top:"bottom",right:"left",bottom:"top",left:"right"},bX=p.forwardRef(function(t,r){const{__scopePopper:n,...s}=t,o=hve(yX,n),i=pve[o.placedSide];return a.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:a.jsx(uve,{...s,ref:r,style:{...s.style,display:"block"}})})});bX.displayName=yX;function gve(e){return e!==null}var xve=e=>({name:"transformOrigin",options:e,fn(t){const{placement:r,rects:n,middlewareData:s}=t,i=s.arrow?.centerOffset!==0,l=i?0:e.arrowWidth,c=i?0:e.arrowHeight,[d,u]=wX(r),f={start:"0%",center:"50%",end:"100%"}[u],h=(s.arrow?.x??0)+l/2,m=(s.arrow?.y??0)+c/2;let x="",g="";return d==="bottom"?(x=i?f:`${h}px`,g=`${-c}px`):d==="top"?(x=i?f:`${h}px`,g=`${n.floating.height+c}px`):d==="right"?(x=`${-c}px`,g=i?f:`${m}px`):d==="left"&&(x=`${n.floating.width+c}px`,g=i?f:`${m}px`),{data:{x,y:g}}}});function wX(e){const[t,r="center"]=e.split("-");return[t,r]}var MD=pX,r5=xX,RD=vX,FD=bX,vve="Portal",iy=p.forwardRef((e,t)=>{const{container:r,...n}=e,[s,o]=p.useState(!1);Il(()=>o(!0),[]);const i=r||s&&globalThis?.document?.body;return i?U4.createPortal(a.jsx(Xa.div,{...n,ref:t}),i):null});iy.displayName=vve;function yve(e,t){return p.useReducer((r,n)=>t[r][n]??r,e)}var qd=e=>{const{present:t,children:r}=e,n=bve(t),s=typeof r=="function"?r({present:n.isPresent}):p.Children.only(r),o=Ds(n.ref,wve(s));return typeof r=="function"||n.isPresent?p.cloneElement(s,{ref:o}):null};qd.displayName="Presence";function bve(e){const[t,r]=p.useState(),n=p.useRef(null),s=p.useRef(e),o=p.useRef("none"),i=e?"mounted":"unmounted",[l,c]=yve(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const d=v2(n.current);o.current=l==="mounted"?d:"none"},[l]),Il(()=>{const d=n.current,u=s.current;if(u!==e){const h=o.current,m=v2(d);e?c("MOUNT"):m==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&h!==m?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,c]),Il(()=>{if(t){let d;const u=t.ownerDocument.defaultView??window,f=m=>{const g=v2(n.current).includes(CSS.escape(m.animationName));if(m.target===t&&g&&(c("ANIMATION_END"),!s.current)){const v=t.style.animationFillMode;t.style.animationFillMode="forwards",d=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=v)})}},h=m=>{m.target===t&&(o.current=v2(n.current))};return t.addEventListener("animationstart",h),t.addEventListener("animationcancel",f),t.addEventListener("animationend",f),()=>{u.clearTimeout(d),t.removeEventListener("animationstart",h),t.removeEventListener("animationcancel",f),t.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:p.useCallback(d=>{n.current=d?getComputedStyle(d):null,r(d)},[])}}function v2(e){return e?.animationName||"none"}function wve(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var jve=Q3[" useInsertionEffect ".trim().toString()]||Il;function Um({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[s,o,i]=_ve({defaultProp:t,onChange:r}),l=e!==void 0,c=l?e:s;{const u=p.useRef(e!==void 0);p.useEffect(()=>{const f=u.current;f!==l&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,n])}const d=p.useCallback(u=>{if(l){const f=Nve(u)?u(e):u;f!==e&&i.current?.(f)}else o(u)},[l,e,o,i]);return[c,d]}function _ve({defaultProp:e,onChange:t}){const[r,n]=p.useState(e),s=p.useRef(r),o=p.useRef(t);return jve(()=>{o.current=t},[t]),p.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,n,o]}function Nve(e){return typeof e=="function"}var Sve=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Tx=new WeakMap,y2=new WeakMap,b2={},YA=0,jX=function(e){return e&&(e.host||jX(e.parentNode))},Cve=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=jX(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Pve=function(e,t,r,n){var s=Cve(t,Array.isArray(e)?e:[e]);b2[r]||(b2[r]=new WeakMap);var o=b2[r],i=[],l=new Set,c=new Set(s),d=function(f){!f||l.has(f)||(l.add(f),d(f.parentNode))};s.forEach(d);var u=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(h){if(l.has(h))u(h);else try{var m=h.getAttribute(n),x=m!==null&&m!=="false",g=(Tx.get(h)||0)+1,v=(o.get(h)||0)+1;Tx.set(h,g),o.set(h,v),i.push(h),g===1&&x&&y2.set(h,!0),v===1&&h.setAttribute(r,"true"),x||h.setAttribute(n,"true")}catch(y){console.error("aria-hidden: cannot operate on ",h,y)}})};return u(t),l.clear(),YA++,function(){i.forEach(function(f){var h=Tx.get(f)-1,m=o.get(f)-1;Tx.set(f,h),o.set(f,m),h||(y2.has(f)||f.removeAttribute(n),y2.delete(f)),m||f.removeAttribute(r)}),YA--,YA||(Tx=new WeakMap,Tx=new WeakMap,y2=new WeakMap,b2={})}},n5=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),s=t||Sve(e);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live], script"))),Pve(n,s,r,"aria-hidden")):function(){return null}},Ef=function(){return Ef=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Ef.apply(this,arguments)};function _X(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Ave(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}var O_="right-scroll-bar-position",T_="width-before-scroll-bar",Eve="with-scroll-bars-hidden",kve="--removed-body-scroll-bar-size";function JA(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Ive(e,t){var r=p.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var s=r.value;s!==n&&(r.value=n,r.callback(n,s))}}}})[0];return r.callback=t,r.facade}var Ove=typeof window<"u"?p.useLayoutEffect:p.useEffect,F6=new WeakMap;function Tve(e,t){var r=Ive(t||null,function(n){return e.forEach(function(s){return JA(s,n)})});return Ove(function(){var n=F6.get(r);if(n){var s=new Set(n),o=new Set(e),i=r.current;s.forEach(function(l){o.has(l)||JA(l,null)}),o.forEach(function(l){s.has(l)||JA(l,i)})}F6.set(r,e)},[e]),r}function Dve(e){return e}function Mve(e,t){t===void 0&&(t=Dve);var r=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(o){var i=t(o,n);return r.push(i),function(){r=r.filter(function(l){return l!==i})}},assignSyncMedium:function(o){for(n=!0;r.length;){var i=r;r=[],i.forEach(o)}r={push:function(l){return o(l)},filter:function(){return r}}},assignMedium:function(o){n=!0;var i=[];if(r.length){var l=r;r=[],l.forEach(o),i=r}var c=function(){var u=i;i=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),r={push:function(u){i.push(u),d()},filter:function(u){return i=i.filter(u),r}}}};return s}function Rve(e){e===void 0&&(e={});var t=Mve(null);return t.options=Ef({async:!0,ssr:!1},e),t}var NX=function(e){var t=e.sideCar,r=_X(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return p.createElement(n,Ef({},r))};NX.isSideCarExport=!0;function Fve(e,t){return e.useMedium(t),NX}var SX=Rve(),QA=function(){},a5=p.forwardRef(function(e,t){var r=p.useRef(null),n=p.useState({onScrollCapture:QA,onWheelCapture:QA,onTouchMoveCapture:QA}),s=n[0],o=n[1],i=e.forwardProps,l=e.children,c=e.className,d=e.removeScrollBar,u=e.enabled,f=e.shards,h=e.sideCar,m=e.noRelative,x=e.noIsolation,g=e.inert,v=e.allowPinchZoom,y=e.as,b=y===void 0?"div":y,w=e.gapMode,j=_X(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=h,C=Tve([r,t]),A=Ef(Ef({},j),s);return p.createElement(p.Fragment,null,u&&p.createElement(_,{sideCar:SX,removeScrollBar:d,shards:f,noRelative:m,noIsolation:x,inert:g,setCallbacks:o,allowPinchZoom:!!v,lockRef:r,gapMode:w}),i?p.cloneElement(p.Children.only(l),Ef(Ef({},A),{ref:C})):p.createElement(b,Ef({},A,{className:c,ref:C}),l))});a5.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};a5.classNames={fullWidth:T_,zeroRight:O_};var L6,Lve=function(){if(L6)return L6;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function $ve(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Lve();return t&&e.setAttribute("nonce",t),e}function Bve(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function qve(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var zve=function(){var e=0,t=null;return{add:function(r){e==0&&(t=$ve())&&(Bve(t,r),qve(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Uve=function(){var e=zve();return function(t,r){p.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},CX=function(){var e=Uve(),t=function(r){var n=r.styles,s=r.dynamic;return e(n,s),null};return t},Vve={left:0,top:0,right:0,gap:0},ZA=function(e){return parseInt(e||"",10)||0},Wve=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[ZA(r),ZA(n),ZA(s)]},Hve=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Vve;var t=Wve(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},Gve=CX(),Vv="data-scroll-locked",Kve=function(e,t,r,n){var s=e.left,o=e.top,i=e.right,l=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(Eve,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(l,"px ").concat(n,`;
  }
  body[`).concat(Vv,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(l,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(O_,` {
    right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(T_,` {
    margin-right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(O_," .").concat(O_,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(T_," .").concat(T_,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Vv,`] {
    `).concat(kve,": ").concat(l,`px;
  }
`)},$6=function(){var e=parseInt(document.body.getAttribute(Vv)||"0",10);return isFinite(e)?e:0},Xve=function(){p.useEffect(function(){return document.body.setAttribute(Vv,($6()+1).toString()),function(){var e=$6()-1;e<=0?document.body.removeAttribute(Vv):document.body.setAttribute(Vv,e.toString())}},[])},Yve=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,s=n===void 0?"margin":n;Xve();var o=p.useMemo(function(){return Hve(s)},[s]);return p.createElement(Gve,{styles:Kve(o,!t,s,r?"":"!important")})},iO=!1;if(typeof window<"u")try{var w2=Object.defineProperty({},"passive",{get:function(){return iO=!0,!0}});window.addEventListener("test",w2,w2),window.removeEventListener("test",w2,w2)}catch{iO=!1}var Dx=iO?{passive:!1}:!1,Jve=function(e){return e.tagName==="TEXTAREA"},PX=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!Jve(e)&&r[t]==="visible")},Qve=function(e){return PX(e,"overflowY")},Zve=function(e){return PX(e,"overflowX")},B6=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=AX(e,n);if(s){var o=EX(e,n),i=o[1],l=o[2];if(i>l)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},e0e=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},t0e=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},AX=function(e,t){return e==="v"?Qve(t):Zve(t)},EX=function(e,t){return e==="v"?e0e(t):t0e(t)},r0e=function(e,t){return e==="h"&&t==="rtl"?-1:1},n0e=function(e,t,r,n,s){var o=r0e(e,window.getComputedStyle(t).direction),i=o*n,l=r.target,c=t.contains(l),d=!1,u=i>0,f=0,h=0;do{if(!l)break;var m=EX(e,l),x=m[0],g=m[1],v=m[2],y=g-v-o*x;(x||y)&&AX(e,l)&&(f+=y,h+=x);var b=l.parentNode;l=b&&b.nodeType===Node.DOCUMENT_FRAGMENT_NODE?b.host:b}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return(u&&(s&&Math.abs(f)<1||!s&&i>f)||!u&&(s&&Math.abs(h)<1||!s&&-i>h))&&(d=!0),d},j2=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},q6=function(e){return[e.deltaX,e.deltaY]},z6=function(e){return e&&"current"in e?e.current:e},a0e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},s0e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},o0e=0,Mx=[];function i0e(e){var t=p.useRef([]),r=p.useRef([0,0]),n=p.useRef(),s=p.useState(o0e++)[0],o=p.useState(CX)[0],i=p.useRef(e);p.useEffect(function(){i.current=e},[e]),p.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var g=Ave([e.lockRef.current],(e.shards||[]).map(z6),!0).filter(Boolean);return g.forEach(function(v){return v.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),g.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var l=p.useCallback(function(g,v){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!i.current.allowPinchZoom;var y=j2(g),b=r.current,w="deltaX"in g?g.deltaX:b[0]-y[0],j="deltaY"in g?g.deltaY:b[1]-y[1],_,C=g.target,A=Math.abs(w)>Math.abs(j)?"h":"v";if("touches"in g&&A==="h"&&C.type==="range")return!1;var S=B6(A,C);if(!S)return!0;if(S?_=A:(_=A==="v"?"h":"v",S=B6(A,C)),!S)return!1;if(!n.current&&"changedTouches"in g&&(w||j)&&(n.current=_),!_)return!0;var P=n.current||_;return n0e(P,v,g,P==="h"?w:j,!0)},[]),c=p.useCallback(function(g){var v=g;if(!(!Mx.length||Mx[Mx.length-1]!==o)){var y="deltaY"in v?q6(v):j2(v),b=t.current.filter(function(_){return _.name===v.type&&(_.target===v.target||v.target===_.shadowParent)&&a0e(_.delta,y)})[0];if(b&&b.should){v.cancelable&&v.preventDefault();return}if(!b){var w=(i.current.shards||[]).map(z6).filter(Boolean).filter(function(_){return _.contains(v.target)}),j=w.length>0?l(v,w[0]):!i.current.noIsolation;j&&v.cancelable&&v.preventDefault()}}},[]),d=p.useCallback(function(g,v,y,b){var w={name:g,delta:v,target:y,should:b,shadowParent:l0e(y)};t.current.push(w),setTimeout(function(){t.current=t.current.filter(function(j){return j!==w})},1)},[]),u=p.useCallback(function(g){r.current=j2(g),n.current=void 0},[]),f=p.useCallback(function(g){d(g.type,q6(g),g.target,l(g,e.lockRef.current))},[]),h=p.useCallback(function(g){d(g.type,j2(g),g.target,l(g,e.lockRef.current))},[]);p.useEffect(function(){return Mx.push(o),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:h}),document.addEventListener("wheel",c,Dx),document.addEventListener("touchmove",c,Dx),document.addEventListener("touchstart",u,Dx),function(){Mx=Mx.filter(function(g){return g!==o}),document.removeEventListener("wheel",c,Dx),document.removeEventListener("touchmove",c,Dx),document.removeEventListener("touchstart",u,Dx)}},[]);var m=e.removeScrollBar,x=e.inert;return p.createElement(p.Fragment,null,x?p.createElement(o,{styles:s0e(s)}):null,m?p.createElement(Yve,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function l0e(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const c0e=Fve(SX,i0e);var kX=p.forwardRef(function(e,t){return p.createElement(a5,Ef({},e,{ref:t,sideCar:c0e}))});kX.classNames=a5.classNames;const s5=kX;var o5="Popover",[IX,sct]=Cu(o5,[oy]),rj=oy(),[d0e,kp]=IX(o5),OX=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:i=!1}=e,l=rj(t),c=p.useRef(null),[d,u]=p.useState(!1),[f,h]=Um({prop:n,defaultProp:s??!1,onChange:o,caller:o5});return a.jsx(MD,{...l,children:a.jsx(d0e,{scope:t,contentId:nf(),triggerRef:c,open:f,onOpenChange:h,onOpenToggle:p.useCallback(()=>h(m=>!m),[h]),hasCustomAnchor:d,onCustomAnchorAdd:p.useCallback(()=>u(!0),[]),onCustomAnchorRemove:p.useCallback(()=>u(!1),[]),modal:i,children:r})})};OX.displayName=o5;var TX="PopoverAnchor",u0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=kp(TX,r),o=rj(r),{onCustomAnchorAdd:i,onCustomAnchorRemove:l}=s;return p.useEffect(()=>(i(),()=>l()),[i,l]),a.jsx(r5,{...o,...n,ref:t})});u0e.displayName=TX;var DX="PopoverTrigger",MX=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=kp(DX,r),o=rj(r),i=Ds(t,s.triggerRef),l=a.jsx(Xa.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":BX(s.open),...n,ref:i,onClick:aa(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?l:a.jsx(r5,{asChild:!0,...o,children:l})});MX.displayName=DX;var LD="PopoverPortal",[f0e,m0e]=IX(LD,{forceMount:void 0}),RX=e=>{const{__scopePopover:t,forceMount:r,children:n,container:s}=e,o=kp(LD,t);return a.jsx(f0e,{scope:t,forceMount:r,children:a.jsx(qd,{present:r||o.open,children:a.jsx(iy,{asChild:!0,container:s,children:n})})})};RX.displayName=LD;var g0="PopoverContent",FX=p.forwardRef((e,t)=>{const r=m0e(g0,e.__scopePopover),{forceMount:n=r.forceMount,...s}=e,o=kp(g0,e.__scopePopover);return a.jsx(qd,{present:n||o.open,children:o.modal?a.jsx(p0e,{...s,ref:t}):a.jsx(g0e,{...s,ref:t})})});FX.displayName=g0;var h0e=xp("PopoverContent.RemoveScroll"),p0e=p.forwardRef((e,t)=>{const r=kp(g0,e.__scopePopover),n=p.useRef(null),s=Ds(t,n),o=p.useRef(!1);return p.useEffect(()=>{const i=n.current;if(i)return n5(i)},[]),a.jsx(s5,{as:h0e,allowPinchZoom:!0,children:a.jsx(LX,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:aa(e.onCloseAutoFocus,i=>{i.preventDefault(),o.current||r.triggerRef.current?.focus()}),onPointerDownOutside:aa(e.onPointerDownOutside,i=>{const l=i.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;o.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:aa(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),g0e=p.forwardRef((e,t)=>{const r=kp(g0,e.__scopePopover),n=p.useRef(!1),s=p.useRef(!1);return a.jsx(LX,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{e.onCloseAutoFocus?.(o),o.defaultPrevented||(n.current||r.triggerRef.current?.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{e.onInteractOutside?.(o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;r.triggerRef.current?.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),LX=p.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...f}=e,h=kp(g0,r),m=rj(r);return QC(),a.jsx(ej,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:a.jsx(ny,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:a.jsx(RD,{"data-state":BX(h.open),role:"dialog",id:h.contentId,...m,...f,ref:t,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),$X="PopoverClose",x0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=kp($X,r);return a.jsx(Xa.button,{type:"button",...n,ref:t,onClick:aa(e.onClick,()=>s.onOpenChange(!1))})});x0e.displayName=$X;var v0e="PopoverArrow",y0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=rj(r);return a.jsx(FD,{...s,...n,ref:t})});y0e.displayName=v0e;function BX(e){return e?"open":"closed"}var b0e=OX,w0e=MX,j0e=RX,qX=FX;const Qo=b0e,Zo=w0e,Ho=Ce.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},s)=>a.jsx(j0e,{container:document.body,children:a.jsx(qX,{ref:s,align:t,sideOffset:r,className:Er("z-[9999] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Ho.displayName=qX.displayName;var i5="Dialog",[zX,UX]=Cu(i5),[_0e,hf]=zX(i5),VX=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:i=!0}=e,l=p.useRef(null),c=p.useRef(null),[d,u]=Um({prop:n,defaultProp:s??!1,onChange:o,caller:i5});return a.jsx(_0e,{scope:t,triggerRef:l,contentRef:c,contentId:nf(),titleId:nf(),descriptionId:nf(),open:d,onOpenChange:u,onOpenToggle:p.useCallback(()=>u(f=>!f),[u]),modal:i,children:r})};VX.displayName=i5;var WX="DialogTrigger",HX=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=hf(WX,r),o=Ds(t,s.triggerRef);return a.jsx(Xa.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":qD(s.open),...n,ref:o,onClick:aa(e.onClick,s.onOpenToggle)})});HX.displayName=WX;var $D="DialogPortal",[N0e,GX]=zX($D,{forceMount:void 0}),KX=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:s}=e,o=hf($D,t);return a.jsx(N0e,{scope:t,forceMount:r,children:p.Children.map(n,i=>a.jsx(qd,{present:r||o.open,children:a.jsx(iy,{asChild:!0,container:s,children:i})}))})};KX.displayName=$D;var DN="DialogOverlay",XX=p.forwardRef((e,t)=>{const r=GX(DN,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=hf(DN,e.__scopeDialog);return o.modal?a.jsx(qd,{present:n||o.open,children:a.jsx(C0e,{...s,ref:t})}):null});XX.displayName=DN;var S0e=xp("DialogOverlay.RemoveScroll"),C0e=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=hf(DN,r);return a.jsx(s5,{as:S0e,allowPinchZoom:!0,shards:[s.contentRef],children:a.jsx(Xa.div,{"data-state":qD(s.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),Zg="DialogContent",YX=p.forwardRef((e,t)=>{const r=GX(Zg,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=hf(Zg,e.__scopeDialog);return a.jsx(qd,{present:n||o.open,children:o.modal?a.jsx(P0e,{...s,ref:t}):a.jsx(A0e,{...s,ref:t})})});YX.displayName=Zg;var P0e=p.forwardRef((e,t)=>{const r=hf(Zg,e.__scopeDialog),n=p.useRef(null),s=Ds(t,r.contentRef,n);return p.useEffect(()=>{const o=n.current;if(o)return n5(o)},[]),a.jsx(JX,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:aa(e.onCloseAutoFocus,o=>{o.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:aa(e.onPointerDownOutside,o=>{const i=o.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&o.preventDefault()}),onFocusOutside:aa(e.onFocusOutside,o=>o.preventDefault())})}),A0e=p.forwardRef((e,t)=>{const r=hf(Zg,e.__scopeDialog),n=p.useRef(!1),s=p.useRef(!1);return a.jsx(JX,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{e.onCloseAutoFocus?.(o),o.defaultPrevented||(n.current||r.triggerRef.current?.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{e.onInteractOutside?.(o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;r.triggerRef.current?.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),JX=p.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=e,l=hf(Zg,r),c=p.useRef(null),d=Ds(t,c);return QC(),a.jsxs(a.Fragment,{children:[a.jsx(ej,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:a.jsx(ny,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":qD(l.open),...i,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),a.jsxs(a.Fragment,{children:[a.jsx(k0e,{titleId:l.titleId}),a.jsx(O0e,{contentRef:c,descriptionId:l.descriptionId})]})]})}),BD="DialogTitle",QX=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=hf(BD,r);return a.jsx(Xa.h2,{id:s.titleId,...n,ref:t})});QX.displayName=BD;var ZX="DialogDescription",eY=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=hf(ZX,r);return a.jsx(Xa.p,{id:s.descriptionId,...n,ref:t})});eY.displayName=ZX;var tY="DialogClose",rY=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=hf(tY,r);return a.jsx(Xa.button,{type:"button",...n,ref:t,onClick:aa(e.onClick,()=>s.onOpenChange(!1))})});rY.displayName=tY;function qD(e){return e?"open":"closed"}var nY="DialogTitleWarning",[E0e,aY]=Tge(nY,{contentName:Zg,titleName:BD,docsSlug:"dialog"}),k0e=({titleId:e})=>{const t=aY(nY),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return p.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},I0e="DialogDescriptionWarning",O0e=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${aY(I0e).contentName}}.`;return p.useEffect(()=>{const s=e.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},sY=VX,T0e=HX,oY=KX,zD=XX,UD=YX,VD=QX,WD=eY,l5=rY;const zn=sY,D0e=oY,tp=l5,iY=Ce.forwardRef(({className:e,disableAnimations:t,...r},n)=>{const s=typeof window<"u"&&(window.matchMedia?.("(pointer: coarse)")?.matches||window.innerWidth<768),o=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,i=(t??!1)||s||o;return a.jsx(zD,{ref:n,className:Er("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm",i?"data-[state=open]:animate-none data-[state=closed]:animate-none":"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r})});iY.displayName=zD.displayName;const qn=Ce.forwardRef(({className:e,children:t,overlayClassName:r,disableAnimations:n,alignTop:s,...o},i)=>{const l=typeof window<"u"&&(window.matchMedia?.("(pointer: coarse)")?.matches||window.innerWidth<768),c=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,d=(n??!1)||l||c;return a.jsxs(D0e,{children:[a.jsx(iY,{disableAnimations:d,className:r}),a.jsxs(UD,{ref:i,className:Er("fixed z-50 grid w-full max-w-lg gap-4 border border-border bg-surface p-6 pr-14 shadow-lg duration-200 sm:rounded-lg",s?"left-1/2 top-[10%] -translate-x-1/2":"left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",d?"data-[state=open]:animate-none data-[state=closed]:animate-none":"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...o,children:[t,a.jsxs(l5,{className:"absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-md border border-border bg-surface/90 opacity-80 shadow-sm ring-offset-background transition-all hover:opacity-100 hover:bg-surface focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(Yc,{className:"h-5 w-5"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]})});qn.displayName=UD.displayName;const Bn=({className:e,...t})=>a.jsx("div",{className:Er("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Bn.displayName="DialogHeader";const Ua=({className:e,...t})=>a.jsx("div",{className:Er("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Ua.displayName="DialogFooter";const $n=Ce.forwardRef(({className:e,...t},r)=>a.jsx(VD,{ref:r,className:Er("text-lg font-semibold leading-none tracking-tight",e),...t}));$n.displayName=VD.displayName;const la=Ce.forwardRef(({className:e,...t},r)=>a.jsx(WD,{ref:r,className:Er("text-sm text-text-secondary",e),...t}));la.displayName=WD.displayName;const M0e=1;let eE=0;function R0e(){return eE=(eE+1)%Number.MAX_VALUE,eE.toString()}const pc={state:{toasts:[]},listeners:[],getState:()=>pc.state,setState:e=>{typeof e=="function"?pc.state=e(pc.state):pc.state={...pc.state,...e},pc.listeners.forEach(t=>t(pc.state))},subscribe:e=>(pc.listeners.push(e),()=>{pc.listeners=pc.listeners.filter(t=>t!==e)})},D_=({...e})=>{const t=R0e(),r=s=>pc.setState(o=>({...o,toasts:o.toasts.map(i=>i.id===t?{...i,...s}:i)})),n=()=>pc.setState(s=>({...s,toasts:s.toasts.filter(o=>o.id!==t)}));return pc.setState(s=>({...s,toasts:[{...e,id:t,dismiss:n},...s.toasts].slice(0,M0e)})),{id:t,dismiss:n,update:r}};function Xs(){const[e,t]=p.useState(pc.getState());return p.useEffect(()=>pc.subscribe(n=>{t(n)}),[]),p.useEffect(()=>{const r=[];return e.toasts.forEach(n=>{if(n.duration===1/0)return;const s=setTimeout(()=>{n.dismiss()},n.duration||5e3);r.push(s)}),()=>{r.forEach(n=>clearTimeout(n))}},[e.toasts]),{toast:D_,toasts:e.toasts}}const F0e="main",L0e={dev:{supabaseUrl:"https://xlbgopcindcsteymtwjp.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsYmdvcGNpbmRjc3RleW10d2pwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MDAwMTQsImV4cCI6MjA4MDI3NjAxNH0.0ydvsFW8j5ZKCyHalAlFWHjjK8QbcDC6mZQzVJ0lSnA"},main:{supabaseUrl:"https://dlfryxtyxqoacuunswuc.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY"}},$0e=Object.freeze(Object.defineProperty({__proto__:null,ACTIVE_TARGET:F0e,TARGETS:L0e},Symbol.toStringTag,{value:"Module"})),B0e=void 0,q0e=void 0,z0e=Object.freeze(Object.defineProperty({__proto__:null,ACTIVE_TARGET:B0e,TARGETS:q0e},Symbol.toStringTag,{value:"Module"})),U0e="modulepreload",V0e=function(e){return"/"+e},U6={},Wf=function(t,r,n){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=V0e(o),o in U6)return;U6[o]=!0;const i=o.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!n)for(let u=s.length-1;u>=0;u--){const f=s[u];if(f.href===o&&(!i||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":U0e,i||(d.as="script",d.crossOrigin=""),d.href=o,document.head.appendChild(d),i)return new Promise((u,f)=>{d.addEventListener("load",u),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})},W0e=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>Wf(()=>Promise.resolve().then(()=>ly),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)};class HD extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class V6 extends HD{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class W6 extends HD{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class H6 extends HD{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var lO;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(lO||(lO={}));var H0e=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class G0e{constructor(t,{headers:r={},customFetch:n,region:s=lO.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=W0e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return H0e(this,arguments,void 0,function*(r,n={}){var s;try{const{headers:o,method:i,body:l,signal:c}=n;let d={},{region:u}=n;u||(u=this.region);const f=new URL(`${this.url}/${r}`);u&&u!=="any"&&(d["x-region"]=u,f.searchParams.set("forceFunctionRegion",u));let h;l&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",h=l):typeof l=="string"?(d["Content-Type"]="text/plain",h=l):typeof FormData<"u"&&l instanceof FormData?h=l:(d["Content-Type"]="application/json",h=JSON.stringify(l)));const m=yield this.fetch(f.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),o),body:h,signal:c}).catch(y=>{throw y.name==="AbortError"?y:new V6(y)}),x=m.headers.get("x-relay-error");if(x&&x==="true")throw new W6(m);if(!m.ok)throw new H6(m);let g=((s=m.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),v;return g==="application/json"?v=yield m.json():g==="application/octet-stream"?v=yield m.blob():g==="text/event-stream"?v=m:g==="multipart/form-data"?v=yield m.formData():v=yield m.text(),{data:v,error:null,response:m}}catch(o){return o instanceof Error&&o.name==="AbortError"?{data:null,error:new V6(o)}:{data:null,error:o,response:o instanceof H6||o instanceof W6?o.context:void 0}}})}}var Bc={},GD={},c5={},nj={},d5={},u5={},K0e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},x0=K0e();const X0e=x0.fetch,lY=x0.fetch.bind(x0),cY=x0.Headers,Y0e=x0.Request,J0e=x0.Response,ly=Object.freeze(Object.defineProperty({__proto__:null,Headers:cY,Request:Y0e,Response:J0e,default:lY,fetch:X0e},Symbol.toStringTag,{value:"Module"})),Q0e=_ie(ly);var f5={};Object.defineProperty(f5,"__esModule",{value:!0});let Z0e=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};f5.default=Z0e;var dY=Jl&&Jl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(u5,"__esModule",{value:!0});const eye=dY(Q0e),tye=dY(f5);let rye=class{constructor(t){var r,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(r=t.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=eye.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,r){return this.headers=new Headers(this.headers),this.headers.set(t,r),this}then(t,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,l,c,d;let u=null,f=null,h=null,m=o.status,x=o.statusText;if(o.ok){if(this.method!=="HEAD"){const b=await o.text();b===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((i=this.headers.get("Accept"))===null||i===void 0)&&i.includes("application/vnd.pgrst.plan+text"))?f=b:f=JSON.parse(b))}const v=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),y=(c=o.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");v&&y&&y.length>1&&(h=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(u={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,m=406,x="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const v=await o.text();try{u=JSON.parse(v),Array.isArray(u)&&o.status===404&&(f=[],u=null,m=200,x="OK")}catch{o.status===404&&v===""?(m=204,x="No Content"):u={message:v}}if(u&&this.isMaybeSingle&&(!((d=u?.details)===null||d===void 0)&&d.includes("0 rows"))&&(u=null,m=200,x="OK"),u&&this.shouldThrowOnError)throw new tye.default(u)}return{error:u,data:f,count:h,status:m,statusText:x}});return this.shouldThrowOnError||(s=s.catch(o=>{var i,l,c;return{error:{message:`${(i=o?.name)!==null&&i!==void 0?i:"FetchError"}: ${o?.message}`,details:`${(l=o?.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=o?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(t,r)}returns(){return this}overrideTypes(){return this}};u5.default=rye;var nye=Jl&&Jl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(d5,"__esModule",{value:!0});const aye=nye(u5);let sye=class extends aye.default{select(t){let r=!1;const n=(t??"*").split("").map(s=>/\s/.test(s)&&!r?"":(s==='"'&&(r=!r),s)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:r=!0,nullsFirst:n,foreignTable:s,referencedTable:o=s}={}){const i=o?`${o}.order`:"order",l=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${l?`${l},`:""}${t}.${r?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:r,referencedTable:n=r}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,r,{foreignTable:n,referencedTable:s=n}={}){const o=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(o,`${t}`),this.url.searchParams.set(i,`${r-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:r=!1,settings:n=!1,buffers:s=!1,wal:o=!1,format:i="text"}={}){var l;const c=[t?"analyze":null,r?"verbose":null,n?"settings":null,s?"buffers":null,o?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${d}"; options=${c};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};d5.default=sye;var oye=Jl&&Jl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(nj,"__esModule",{value:!0});const iye=oye(d5);let lye=class extends iye.default{eq(t,r){return this.url.searchParams.append(t,`eq.${r}`),this}neq(t,r){return this.url.searchParams.append(t,`neq.${r}`),this}gt(t,r){return this.url.searchParams.append(t,`gt.${r}`),this}gte(t,r){return this.url.searchParams.append(t,`gte.${r}`),this}lt(t,r){return this.url.searchParams.append(t,`lt.${r}`),this}lte(t,r){return this.url.searchParams.append(t,`lte.${r}`),this}like(t,r){return this.url.searchParams.append(t,`like.${r}`),this}likeAllOf(t,r){return this.url.searchParams.append(t,`like(all).{${r.join(",")}}`),this}likeAnyOf(t,r){return this.url.searchParams.append(t,`like(any).{${r.join(",")}}`),this}ilike(t,r){return this.url.searchParams.append(t,`ilike.${r}`),this}ilikeAllOf(t,r){return this.url.searchParams.append(t,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(t,r){return this.url.searchParams.append(t,`ilike(any).{${r.join(",")}}`),this}is(t,r){return this.url.searchParams.append(t,`is.${r}`),this}in(t,r){const n=Array.from(new Set(r)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cs.{${r.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(r)}`),this}containedBy(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cd.{${r.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(r)}`),this}rangeGt(t,r){return this.url.searchParams.append(t,`sr.${r}`),this}rangeGte(t,r){return this.url.searchParams.append(t,`nxl.${r}`),this}rangeLt(t,r){return this.url.searchParams.append(t,`sl.${r}`),this}rangeLte(t,r){return this.url.searchParams.append(t,`nxr.${r}`),this}rangeAdjacent(t,r){return this.url.searchParams.append(t,`adj.${r}`),this}overlaps(t,r){return typeof r=="string"?this.url.searchParams.append(t,`ov.${r}`):this.url.searchParams.append(t,`ov.{${r.join(",")}}`),this}textSearch(t,r,{config:n,type:s}={}){let o="";s==="plain"?o="pl":s==="phrase"?o="ph":s==="websearch"&&(o="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${o}fts${i}.${r}`),this}match(t){return Object.entries(t).forEach(([r,n])=>{this.url.searchParams.append(r,`eq.${n}`)}),this}not(t,r,n){return this.url.searchParams.append(t,`not.${r}.${n}`),this}or(t,{foreignTable:r,referencedTable:n=r}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,r,n){return this.url.searchParams.append(t,`${r}.${n}`),this}};nj.default=lye;var cye=Jl&&Jl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(c5,"__esModule",{value:!0});const Gy=cye(nj);let dye=class{constructor(t,{headers:r={},schema:n,fetch:s}){this.url=t,this.headers=new Headers(r),this.schema=n,this.fetch=s}select(t,r){const{head:n=!1,count:s}=r??{},o=n?"HEAD":"GET";let i=!1;const l=(t??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join("");return this.url.searchParams.set("select",l),s&&this.headers.append("Prefer",`count=${s}`),new Gy.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:r,defaultToNull:n=!0}={}){var s;const o="POST";if(r&&this.headers.append("Prefer",`count=${r}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(i.length>0){const l=[...new Set(i)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new Gy.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(t,{onConflict:r,ignoreDuplicates:n=!1,count:s,defaultToNull:o=!0}={}){var i;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),r!==void 0&&this.url.searchParams.set("on_conflict",r),s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new Gy.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:r}={}){var n;const s="PATCH";return r&&this.headers.append("Prefer",`count=${r}`),new Gy.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var r;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Gy.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}};c5.default=dye;var uY=Jl&&Jl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(GD,"__esModule",{value:!0});const uye=uY(c5),fye=uY(nj);let mye=class fY{constructor(t,{headers:r={},schema:n,fetch:s}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=s}from(t){const r=new URL(`${this.url}/${t}`);return new uye.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new fY(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:s=!1,count:o}={}){var i;let l;const c=new URL(`${this.url}/rpc/${t}`);let d;n||s?(l=n?"HEAD":"GET",Object.entries(r).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{c.searchParams.append(f,h)})):(l="POST",d=r);const u=new Headers(this.headers);return o&&u.set("Prefer",`count=${o}`),new fye.default({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};GD.default=mye;var cy=Jl&&Jl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Bc,"__esModule",{value:!0});Bc.PostgrestError=Bc.PostgrestBuilder=Bc.PostgrestTransformBuilder=Bc.PostgrestFilterBuilder=Bc.PostgrestQueryBuilder=Bc.PostgrestClient=void 0;const mY=cy(GD);Bc.PostgrestClient=mY.default;const hY=cy(c5);Bc.PostgrestQueryBuilder=hY.default;const pY=cy(nj);Bc.PostgrestFilterBuilder=pY.default;const gY=cy(d5);Bc.PostgrestTransformBuilder=gY.default;const xY=cy(u5);Bc.PostgrestBuilder=xY.default;const vY=cy(f5);Bc.PostgrestError=vY.default;var hye=Bc.default={PostgrestClient:mY.default,PostgrestQueryBuilder:hY.default,PostgrestFilterBuilder:pY.default,PostgrestTransformBuilder:gY.default,PostgrestBuilder:xY.default,PostgrestError:vY.default};const{PostgrestClient:pye,PostgrestQueryBuilder:uct,PostgrestFilterBuilder:fct,PostgrestTransformBuilder:mct,PostgrestBuilder:hct,PostgrestError:pct}=hye;class gye{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const xye="2.75.0",vye=`realtime-js/${xye}`,yye="1.0.0",cO=1e4,bye=1e3,wye=100;var zb;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(zb||(zb={}));var qi;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(qi||(qi={}));var Wu;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Wu||(Wu={}));var dO;(function(e){e.websocket="websocket"})(dO||(dO={}));var ug;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(ug||(ug={}));class jye{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,r,n)}_decodeBroadcast(t,r,n){const s=r.getUint8(1),o=r.getUint8(2);let i=this.HEADER_LENGTH+2;const l=n.decode(t.slice(i,i+s));i=i+s;const c=n.decode(t.slice(i,i+o));i=i+o;const d=JSON.parse(n.decode(t.slice(i,t.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class yY{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var So;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(So||(So={}));const G6=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((o,i)=>(o[i]=_ye(i,e,t,s),o),{}):{}},_ye=(e,t,r,n)=>{const s=t.find(l=>l.name===e),o=s?.type,i=r[e];return o&&!n.includes(o)?bY(o,i):uO(i)},bY=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return Pye(t,r)}switch(e){case So.bool:return Nye(t);case So.float4:case So.float8:case So.int2:case So.int4:case So.int8:case So.numeric:case So.oid:return Sye(t);case So.json:case So.jsonb:return Cye(t);case So.timestamp:return Aye(t);case So.abstime:case So.date:case So.daterange:case So.int4range:case So.int8range:case So.money:case So.reltime:case So.text:case So.time:case So.timestamptz:case So.timetz:case So.tsrange:case So.tstzrange:return uO(t);default:return uO(t)}},uO=e=>e,Nye=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Sye=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Cye=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Pye=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let o;const i=e.slice(1,r);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(l=>bY(t,l))}return e},Aye=e=>typeof e=="string"?e.replace(" ","T"):e,wY=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class tE{constructor(t,r,n={},s=cO){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var K6;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(K6||(K6={}));class Ub{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ub.syncState(this.state,s,o,i),this.pendingDiffs.forEach(c=>{this.state=Ub.syncDiff(this.state,c,o,i)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ub.syncDiff(this.state,s,o,i),l())}),this.onJoin((s,o,i)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:i})}),this.onLeave((s,o,i)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const o=this.cloneDeep(t),i=this.transformState(r),l={},c={};return this.map(o,(d,u)=>{i[d]||(c[d]=u)}),this.map(i,(d,u)=>{const f=o[d];if(f){const h=u.map(v=>v.presence_ref),m=f.map(v=>v.presence_ref),x=u.filter(v=>m.indexOf(v.presence_ref)<0),g=f.filter(v=>h.indexOf(v.presence_ref)<0);x.length>0&&(l[d]=x),g.length>0&&(c[d]=g)}else l[d]=u}),this.syncDiff(o,{joins:l,leaves:c},n,s)}static syncDiff(t,r,n,s){const{joins:o,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const f=t[l].map(m=>m.presence_ref),h=u.filter(m=>f.indexOf(m.presence_ref)<0);t[l].unshift(...h)}n(l,u,c)}),this.map(i,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(f=>f.presence_ref);d=d.filter(f=>u.indexOf(f.presence_ref)<0),t[l]=d,s(l,d,c),d.length===0&&delete t[l]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var X6;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(X6||(X6={}));var Vb;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Vb||(Vb={}));var gm;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(gm||(gm={}));class KD{constructor(t,r={config:{}},n){var s,o;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=qi.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new tE(this,Wu.join,this.params,this.timeout),this.rejoinTimer=new yY(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qi.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qi.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qi.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qi.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=qi.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Wu.reply,{},(i,l)=>{this._trigger(this._replyEventName(l),i)}),this.presence=new Ub(this),this.broadcastEndpointURL=wY(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,o;if(this.socket.isConnected()||this.socket.connect(),this.state==qi.closed){const{config:{broadcast:i,presence:l,private:c}}=this.params,d=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[Vb.PRESENCE]&&this.bindings[Vb.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,f={},h={broadcast:i,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(m=>t?.(gm.CHANNEL_ERROR,m)),this._onClose(()=>t?.(gm.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:m})=>{var x;if(this.socket.setAuth(),m===void 0){t?.(gm.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,v=(x=g?.length)!==null&&x!==void 0?x:0,y=[];for(let b=0;b<v;b++){const w=g[b],{filter:{event:j,schema:_,table:C,filter:A}}=w,S=m&&m[b];if(S&&S.event===j&&S.schema===_&&S.table===C&&S.filter===A)y.push(Object.assign(Object.assign({},w),{id:S.id}));else{this.unsubscribe(),this.state=qi.errored,t?.(gm.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,t&&t(gm.SUBSCRIBED);return}}).receive("error",m=>{this.state=qi.errored,t?.(gm.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{t?.(gm.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===qi.joined&&t===Vb.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){const{event:o,payload:i}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,l,c;const d=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(i=this.params)===null||i===void 0?void 0:i.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&o("ok"),d.receive("ok",()=>o("ok")),d.receive("error",()=>o("error")),d.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=qi.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Wu.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new tE(this,Wu.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qi.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),i=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(o),i}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new tE(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>wye){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,o;const i=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Wu;if(n&&[l,c,d,u].indexOf(i)>=0&&n!==this._joinRef())return;let h=this._onMessage(i,r,n);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(m=>{var x,g,v;return((x=m.filter)===null||x===void 0?void 0:x.event)==="*"||((v=(g=m.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(m=>m.callback(h,n)):(o=this.bindings[i])===null||o===void 0||o.filter(m=>{var x,g,v,y,b,w;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in m){const j=m.id,_=(x=m.filter)===null||x===void 0?void 0:x.event;return j&&((g=r.ids)===null||g===void 0?void 0:g.includes(j))&&(_==="*"||_?.toLocaleLowerCase()===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const j=(b=(y=m?.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return j==="*"||j===((w=r?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===i}).map(m=>{if(typeof h=="object"&&"ids"in h){const x=h.data,{schema:g,table:v,commit_timestamp:y,type:b,errors:w}=x;h=Object.assign(Object.assign({},{schema:g,table:v,commit_timestamp:y,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(x))}m.callback(h,n)})}_isClosed(){return this.state===qi.closed}_isJoined(){return this.state===qi.joined}_isJoining(){return this.state===qi.joining}_isLeaving(){return this.state===qi.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),o={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&KD.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Wu.close,{},t)}_onError(t){this._on(Wu.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qi.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=G6(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=G6(t.columns,t.old_record)),r}}const rE=()=>{},_2={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Eye=[1e3,2e3,5e3,1e4],kye=1e4,Iye=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Oye{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=cO,this.transport=null,this.heartbeatIntervalMs=_2.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=rE,this.ref=0,this.reconnectTimer=null,this.logger=rE,this.conn=null,this.sendBuffer=[],this.serializer=new jye,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let o;return s?o=s:typeof fetch>"u"?o=(...i)=>Wf(()=>Promise.resolve().then(()=>ly),void 0).then(({default:l})=>l(...i)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...i)=>o(...i)},!(!((n=r?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${dO.websocket}`,this.httpEndpoint=wY(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=gye.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:yye}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case zb.connecting:return ug.Connecting;case zb.open:return ug.Open;case zb.closing:return ug.Closing;default:return ug.Closed}}isConnected(){return this.connectionState()===ug.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new KD(`realtime:${t}`,r,this);return this.channels.push(o),o}}push(t){const{topic:r,event:n,payload:s,ref:o}=t,i=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${r} ${n} (${o})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(bye,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},_2.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:o,ref:i}=r,l=i?`(${i})`:"",c=o.status||"";this.log("receive",`${c} ${n} ${s} ${l}`.trim(),o),this.channels.filter(d=>d._isMember(n)).forEach(d=>d._trigger(s,o,i)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Wu.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([Iye],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const s={access_token:r,version:vye};r&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(Wu.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new yY(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},_2.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,o,i,l,c,d,u;if(this.transport=(r=t?.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t?.timeout)!==null&&n!==void 0?n:cO,this.heartbeatIntervalMs=(s=t?.heartbeatIntervalMs)!==null&&s!==void 0?s:_2.HEARTBEAT_INTERVAL,this.worker=(o=t?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(i=t?.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(l=t?.heartbeatCallback)!==null&&l!==void 0?l:rE,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t?.reconnectAfterMs)!==null&&c!==void 0?c:f=>Eye[f-1]||kye,this.encode=(d=t?.encode)!==null&&d!==void 0?d:(f,h)=>h(JSON.stringify(f)),this.decode=(u=t?.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class XD extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ki(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Tye extends XD{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class fO extends XD{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}var Dye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const jY=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>Wf(()=>Promise.resolve().then(()=>ly),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},Mye=()=>Dye(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Wf(()=>Promise.resolve().then(()=>ly),void 0)).Response:Response}),mO=e=>{if(Array.isArray(e))return e.map(r=>mO(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[s]=mO(n)}),t},Rye=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var yx=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const nE=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Fye=(e,t,r)=>yx(void 0,void 0,void 0,function*(){const n=yield Mye();e instanceof n&&!r?.noResolveJson?e.json().then(s=>{const o=e.status||500,i=s?.statusCode||o+"";t(new Tye(nE(s),o,i))}).catch(s=>{t(new fO(nE(s),s))}):t(new fO(nE(e),e))}),Lye=(e,t,r,n)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"||!n?s:(Rye(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t?.headers),s.body=JSON.stringify(n)):s.body=n,t?.duplex&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r))};function aj(e,t,r,n,s,o){return yx(this,void 0,void 0,function*(){return new Promise((i,l)=>{e(r,Lye(t,n,s,o)).then(c=>{if(!c.ok)throw c;return n?.noResolveJson?c:c.json()}).then(c=>i(c)).catch(c=>Fye(c,l,n))})})}function MN(e,t,r,n){return yx(this,void 0,void 0,function*(){return aj(e,"GET",t,r,n)})}function Pf(e,t,r,n,s){return yx(this,void 0,void 0,function*(){return aj(e,"POST",t,n,s,r)})}function hO(e,t,r,n,s){return yx(this,void 0,void 0,function*(){return aj(e,"PUT",t,n,s,r)})}function $ye(e,t,r,n){return yx(this,void 0,void 0,function*(){return aj(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function _Y(e,t,r,n,s){return yx(this,void 0,void 0,function*(){return aj(e,"DELETE",t,n,s,r)})}var Bye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class qye{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return Bye(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ki(t))return{data:null,error:t};throw t}})}}var zye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Uye{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}asStream(){return new qye(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.execute().then(t,r)}execute(){return zye(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ki(t))return{data:null,error:t};throw t}})}}var Dc=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Vye={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Y6={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Wye{constructor(t,r={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=jY(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,s){return Dc(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},Y6),s);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const c=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c))):(o=n,l["cache-control"]=`max-age=${i.cacheControl}`,l["content-type"]=i.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(l=Object.assign(Object.assign({},l),s.headers));const d=this._removeEmptyFolders(r),u=this._getFinalPath(d),f=yield(t=="PUT"?hO:Pf)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:l},i?.duplex?{duplex:i.duplex}:{}));return{data:{path:d,id:f.Id,fullPath:f.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(ki(o))return{data:null,error:o};throw o}})}upload(t,r,n){return Dc(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,s){return Dc(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),i=this._getFinalPath(o),l=new URL(this.url+`/object/upload/sign/${i}`);l.searchParams.set("token",r);try{let c;const d=Object.assign({upsert:Y6.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const f=yield hO(this.fetch,l.toString(),c,{headers:u});return{data:{path:o,fullPath:f.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(ki(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,r){return Dc(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const s=Object.assign({},this.headers);r?.upsert&&(s["x-upsert"]="true");const o=yield Pf(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),i=new URL(this.url+o.url),l=i.searchParams.get("token");if(!l)throw new XD("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:l},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ki(n))return{data:null,error:n};throw n}})}update(t,r,n){return Dc(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return Dc(this,void 0,void 0,function*(){try{return{data:yield Pf(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ki(s))return{data:null,error:s};throw s}})}copy(t,r,n){return Dc(this,void 0,void 0,function*(){try{return{data:{path:(yield Pf(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ki(s))return{data:null,error:s};throw s}})}createSignedUrl(t,r,n){return Dc(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),o=yield Pf(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ki(s))return{data:null,error:s};throw s}})}createSignedUrls(t,r,n){return Dc(this,void 0,void 0,function*(){try{const s=yield Pf(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ki(s))return{data:null,error:s};throw s}})}download(t,r){const s=typeof r?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(r?.transform||{}),i=o?`?${o}`:"",l=this._getFinalPath(t),c=()=>MN(this.fetch,`${this.url}/${s}/${l}${i}`,{headers:this.headers,noResolveJson:!0});return new Uye(c,this.shouldThrowOnError)}info(t){return Dc(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield MN(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:mO(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ki(n))return{data:null,error:n};throw n}})}exists(t){return Dc(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield $ye(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ki(n)&&n instanceof fO){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),s=[],o=r?.download?`download=${r.download===!0?"":r.download}`:"";o!==""&&s.push(o);const l=typeof r?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(r?.transform||{});c!==""&&s.push(c);let d=s.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${d}`)}}}remove(t){return Dc(this,void 0,void 0,function*(){try{return{data:yield _Y(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ki(r))return{data:null,error:r};throw r}})}list(t,r,n){return Dc(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Vye),r),{prefix:t||""});return{data:yield Pf(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ki(s))return{data:null,error:s};throw s}})}listV2(t,r){return Dc(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield Pf(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ki(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const Hye="2.75.0",Gye={"X-Client-Info":`storage-js/${Hye}`};var Rx=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Kye{constructor(t,r={},n,s){this.shouldThrowOnError=!1;const o=new URL(t);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Gye),r),this.fetch=jY(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Rx(this,void 0,void 0,function*(){try{return{data:yield MN(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ki(t))return{data:null,error:t};throw t}})}getBucket(t){return Rx(this,void 0,void 0,function*(){try{return{data:yield MN(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ki(r))return{data:null,error:r};throw r}})}createBucket(t){return Rx(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield Pf(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ki(s))return{data:null,error:s};throw s}})}updateBucket(t,r){return Rx(this,void 0,void 0,function*(){try{return{data:yield hO(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ki(n))return{data:null,error:n};throw n}})}emptyBucket(t){return Rx(this,void 0,void 0,function*(){try{return{data:yield Pf(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ki(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Rx(this,void 0,void 0,function*(){try{return{data:yield _Y(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ki(r))return{data:null,error:r};throw r}})}}class Xye extends Kye{constructor(t,r={},n,s){super(t,r,n,s)}from(t){return new Wye(this.url,this.headers,t,this.fetch)}}const Yye="2.75.0";let wb="";typeof Deno<"u"?wb="deno":typeof document<"u"?wb="web":typeof navigator<"u"&&navigator.product==="ReactNative"?wb="react-native":wb="node";const Jye={"X-Client-Info":`supabase-js-${wb}/${Yye}`},Qye={headers:Jye},Zye={schema:"public"},ebe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},tbe={};var rbe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const nbe=e=>{let t;return e?t=e:typeof fetch>"u"?t=lY:t=fetch,(...r)=>t(...r)},abe=()=>typeof Headers>"u"?cY:Headers,sbe=(e,t,r)=>{const n=nbe(r),s=abe();return(o,i)=>rbe(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:e;let d=new s(i?.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(o,Object.assign(Object.assign({},i),{headers:d}))})};var obe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};function ibe(e){return e.endsWith("/")?e:e+"/"}function lbe(e,t){var r,n;const{db:s,auth:o,realtime:i,global:l}=e,{db:c,auth:d,realtime:u,global:f}=t,h={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},d),o),realtime:Object.assign(Object.assign({},u),i),storage:{},global:Object.assign(Object.assign(Object.assign({},f),l),{headers:Object.assign(Object.assign({},(r=f?.headers)!==null&&r!==void 0?r:{}),(n=l?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>obe(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}function cbe(e){const t=e?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ibe(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const NY="2.75.0",lv=30*1e3,pO=3,aE=pO*lv,dbe="http://localhost:9999",ube="supabase.auth.token",fbe={"X-Client-Info":`gotrue-js/${NY}`},gO="X-Supabase-Api-Version",SY={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},mbe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,hbe=10*60*1e3;class $w extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function za(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class pbe extends $w{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function gbe(e){return za(e)&&e.name==="AuthApiError"}class fg extends $w{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Ip extends $w{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class vh extends Ip{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function xbe(e){return za(e)&&e.name==="AuthSessionMissingError"}class Fx extends Ip{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class N2 extends Ip{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class S2 extends Ip{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vbe(e){return za(e)&&e.name==="AuthImplicitGrantRedirectError"}class J6 extends Ip{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class xO extends Ip{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function sE(e){return za(e)&&e.name==="AuthRetryableFetchError"}class Q6 extends Ip{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class vO extends Ip{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const RN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Z6=` 	
\r=`.split(""),ybe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Z6.length;t+=1)e[Z6[t].charCodeAt(0)]=-2;for(let t=0;t<RN.length;t+=1)e[RN[t].charCodeAt(0)]=t;return e})();function e8(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(RN[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(RN[n]),t.queuedBits-=6}}function CY(e,t,r){const n=ybe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function t8(e){const t=[],r=i=>{t.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=i=>{jbe(i,n,r)};for(let i=0;i<e.length;i+=1)CY(e.charCodeAt(i),s,o);return t.join("")}function bbe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function wbe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}bbe(n,t)}}function jbe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Wv(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)CY(e.charCodeAt(s),r,n);return new Uint8Array(t)}function _be(e){const t=[];return wbe(e,r=>t.push(r)),new Uint8Array(t)}function yg(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>e8(s,r,n)),e8(null,r,n),t.join("")}function Nbe(e){return Math.round(Date.now()/1e3)+e}function Sbe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const hd=()=>typeof window<"u"&&typeof document<"u",Vp={tested:!1,writable:!1},PY=()=>{if(!hd())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Vp.tested)return Vp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Vp.tested=!0,Vp.writable=!0}catch{Vp.tested=!0,Vp.writable=!1}return Vp.writable};function Cbe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,o)=>{t[o]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const AY=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>Wf(()=>Promise.resolve().then(()=>ly),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},Pbe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",cv=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Wp=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ch=async(e,t)=>{await e.removeItem(t)};class m5{constructor(){this.promise=new m5.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}m5.promiseConstructor=Promise;function oE(e){const t=e.split(".");if(t.length!==3)throw new vO("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!mbe.test(t[n]))throw new vO("JWT not in base64url format");return{header:JSON.parse(t8(t[0])),payload:JSON.parse(t8(t[1])),signature:Wv(t[2]),raw:{header:t[0],payload:t[1]}}}async function Abe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Ebe(e,t){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await e(o);if(!t(o,null,i)){n(i);return}}catch(i){if(!t(o,i)){s(i);return}}})()})}function kbe(e){return("0"+e.toString(16)).substr(-2)}function Ibe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let o=0;o<56;o++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,kbe).join("")}async function Obe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function Tbe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await Obe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Lx(e,t,r=!1){const n=Ibe();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await cv(e,`${t}-code-verifier`,s);const o=await Tbe(n);return[o,n===o?"plain":"s256"]}const Dbe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Mbe(e){const t=e.headers.get(gO);if(!t||!t.match(Dbe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Rbe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Fbe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Lbe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $x(e){if(!Lbe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function iE(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function r8(e){return JSON.parse(JSON.stringify(e))}var $be=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};const ng=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Bbe=[502,503,504];async function n8(e){var t;if(!Pbe(e))throw new xO(ng(e),0);if(Bbe.includes(e.status))throw new xO(ng(e),e.status);let r;try{r=await e.json()}catch(o){throw new fg(ng(o),o)}let n;const s=Mbe(e);if(s&&s.getTime()>=SY["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Q6(ng(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new vh}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new Q6(ng(r),e.status,r.weak_password.reasons);throw new pbe(ng(r),e.status||500,n)}const qbe=(e,t,r,n)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function ds(e,t,r,n){var s;const o=Object.assign({},n?.headers);o[gO]||(o[gO]=SY["2024-01-01"].name),n?.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const i=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await zbe(e,t,r+l,{headers:o,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(c):{data:Object.assign({},c),error:null}}async function zbe(e,t,r,n,s,o){const i=qbe(t,n,s,o);let l;try{l=await e(r,Object.assign({},i))}catch(c){throw console.error(c),new xO(ng(c),0)}if(l.ok||await n8(l),n?.noResolveJson)return l;try{return await l.json()}catch(c){await n8(c)}}function Bu(e){var t;let r=null;Wbe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=Nbe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function a8(e){const t=Bu(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Ah(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Ube(e){return{data:e,error:null}}function Vbe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o}=e,i=$be(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o},c=Object.assign({},i);return{data:{properties:l,user:c},error:null}}function s8(e){return e}function Wbe(e){return e.access_token&&e.refresh_token&&e.expires_in}const lE=["global","local","others"];var Hbe=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};class Gbe{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=AY(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=lE[0]){if(lE.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${lE.join(", ")}`);try{return await ds(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(za(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await ds(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Ah})}catch(n){if(za(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=Hbe(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await ds(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Vbe,redirectTo:r?.redirectTo})}catch(r){if(za(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await ds(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ah})}catch(r){if(za(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await ds(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:s8});if(u.error)throw u.error;const f=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(x=>{const g=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(x.split(";")[1].split("=")[1]);d[`${v}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(za(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){$x(t);try{return await ds(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ah})}catch(r){if(za(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){$x(t);try{return await ds(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Ah})}catch(n){if(za(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){$x(t);try{return await ds(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Ah})}catch(n){if(za(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){$x(t.userId);try{const{data:r,error:n}=await ds(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(za(r))return{data:null,error:r};throw r}}async _deleteFactor(t){$x(t.userId),$x(t.id);try{return{data:await ds(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(za(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await ds(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:s8});if(u.error)throw u.error;const f=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(x=>{const g=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(x.split(";")[1].split("=")[1]);d[`${v}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(za(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(t){try{return await ds(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(za(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await ds(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(za(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await ds(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(za(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await ds(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(za(r))return{data:null,error:r};throw r}}}function o8(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Bx={debug:!!(globalThis&&PY()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class EY extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Kbe extends EY{}async function Xbe(e,t,r){Bx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Bx.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Bx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{Bx.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw Bx.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Kbe(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Bx.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Ybe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function kY(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Jbe(e){return parseInt(e,16)}function Qbe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function Zbe(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:o=new Date,nonce:i,notBefore:l,requestId:c,resources:d,scheme:u,uri:f,version:h}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const m=kY(e.address),x=u?`${u}://${n}`:n,g=e.statement?`${e.statement}
`:"",v=`${x} wants you to sign in with your Ethereum account:
${m}

${g}`;let y=`URI: ${f}
Version: ${h}
Chain ID: ${r}${i?`
Nonce: ${i}`:""}
Issued At: ${o.toISOString()}`;if(s&&(y+=`
Expiration Time: ${s.toISOString()}`),l&&(y+=`
Not Before: ${l.toISOString()}`),c&&(y+=`
Request ID: ${c}`),d){let b=`
Resources:`;for(const w of d){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);b+=`
- ${w}`}y+=b}return`${v}
${y}`}class Ei extends Error{constructor({message:t,code:r,cause:n,name:s}){var o;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(o=s??(n instanceof Error?n.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=r}}class FN extends Ei{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function ewe({error:e,options:t}){var r,n,s;const{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ei({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Ei({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=o.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Ei({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ei({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Ei({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Ei({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return o.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new Ei({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Ei({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const i=window.location.hostname;if(OY(i)){if(o.rp.id!==i)return new Ei({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ei({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new Ei({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Ei({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ei({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function twe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ei({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Ei({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(OY(n)){if(r.rpId!==n)return new Ei({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ei({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Ei({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ei({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}var IY=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};class rwe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const nwe=new rwe;function awe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=IY(e,["challenge","user","excludeCredentials"]),o=Wv(t).buffer,i=Object.assign(Object.assign({},r),{id:Wv(r.id).buffer}),l=Object.assign(Object.assign({},s),{challenge:o,user:i});if(n&&n.length>0){l.excludeCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const d=n[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:Wv(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function swe(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=IY(e,["challenge","allowCredentials"]),s=Wv(t).buffer,o=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){o.allowCredentials=new Array(r.length);for(let i=0;i<r.length;i++){const l=r[i];o.allowCredentials[i]=Object.assign(Object.assign({},l),{id:Wv(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return o}function owe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:yg(new Uint8Array(e.response.attestationObject)),clientDataJSON:yg(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function iwe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:yg(new Uint8Array(s.authenticatorData)),clientDataJSON:yg(new Uint8Array(s.clientDataJSON)),signature:yg(new Uint8Array(s.signature)),userHandle:s.userHandle?yg(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function OY(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function i8(){var e,t;return!!(hd()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function lwe(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new FN("Browser returned unexpected credential type",t)}:{data:null,error:new FN("Empty credential response",t)}}catch(t){return{data:null,error:ewe({error:t,options:e})}}}async function cwe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new FN("Browser returned unexpected credential type",t)}:{data:null,error:new FN("Empty credential response",t)}}catch(t){return{data:null,error:twe({error:t,options:e})}}}const dwe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},uwe={userVerification:"preferred",hints:["security-key"]};function LN(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const o in s){const i=s[o];if(i!==void 0)if(Array.isArray(i))n[o]=i;else if(r(i))n[o]=i;else if(t(i)){const l=n[o];t(l)?n[o]=LN(l,i):n[o]=LN(i)}else n[o]=i}return n}function fwe(e,t){return LN(dwe,e,t||{})}function mwe(e,t){return LN(uwe,e,t||{})}class hwe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},o){try{const{data:i,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!i)return{data:null,error:l};const c=s??nwe.createNewAbortSignal();if(i.webauthn.type==="create"){const{user:d}=i.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${n}`),d.displayName||(d.displayName=d.name)}switch(i.webauthn.type){case"create":{const d=fwe(i.webauthn.credential_options.publicKey,o?.create),{data:u,error:f}=await lwe({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}case"request":{const d=mwe(i.webauthn.credential_options.publicKey,o?.request),{data:u,error:f}=await cwe(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}}}catch(i){return za(i)?{data:null,error:i}:{data:null,error:new fg("Unexpected error in challenge",i)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}},o){if(!r)return{data:null,error:new $w("rpId is required for WebAuthn authentication")};try{if(!i8())return{data:null,error:new fg("Browser does not support WebAuthn",null)};const{data:i,error:l}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:o});if(!i)return{data:null,error:l};const{webauthn:c}=i;return this._verify({factorId:t,challengeId:i.challengeId,webauthn:{type:c.type,rpId:r,rpOrigins:n,credential_response:c.credential_response}})}catch(i){return za(i)?{data:null,error:i}:{data:null,error:new fg("Unexpected error in authenticate",i)}}}async _register({friendlyName:t,rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s},o){if(!r)return{data:null,error:new $w("rpId is required for WebAuthn registration")};try{if(!i8())return{data:null,error:new fg("Browser does not support WebAuthn",null)};const{data:i,error:l}=await this._enroll({friendlyName:t});if(!i)return await this.client.mfa.listFactors().then(u=>{var f;return(f=u.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===t&&h.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:o});return c?this._verify({factorId:i.id,challengeId:c.challengeId,webauthn:{rpId:r,rpOrigins:n,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(i){return za(i)?{data:null,error:i}:{data:null,error:new fg("Unexpected error in register",i)}}}}Ybe();const pwe={url:dbe,storageKey:ube,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fbe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function l8(e,t,r){return await r()}const qx={};class Bw{get jwks(){var t,r;return(r=(t=qx[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){qx[this.storageKey]=Object.assign(Object.assign({},qx[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=qx[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){qx[this.storageKey]=Object.assign(Object.assign({},qx[this.storageKey]),{cachedAt:t})}constructor(t){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Bw.nextInstanceID,Bw.nextInstanceID+=1,this.instanceID>0&&hd()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},pwe),t);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Gbe({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=AY(s.fetch),this.lock=s.lock||l8,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:hd()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Xbe:this.lock=l8,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new hwe(this)},this.persistSession?(s.storage?this.storage=s.storage:PY()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=o8(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=o8(this.memoryStorage)),hd()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${NY}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const r=Cbe(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),hd()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(r,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),vbe(o)){const c=(t=o.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",l),await this._saveSession(i),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return za(r)?{error:r}:{error:new fg("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const o=await ds(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Bu}),{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(za(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(t){var r,n,s;try{let o;if("email"in t){const{email:u,password:f,options:h}=t;let m=null,x=null;this.flowType==="pkce"&&([m,x]=await Lx(this.storage,this.storageKey)),o=await ds(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:f,data:(r=h?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:m,code_challenge_method:x},xform:Bu})}else if("phone"in t){const{phone:u,password:f,options:h}=t;o=await ds(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:f,data:(n=h?.data)!==null&&n!==void 0?n:{},channel:(s=h?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Bu})}else throw new N2("You must provide either an email or phone number and a password");const{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(za(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(t){try{let r;if("email"in t){const{email:o,password:i,options:l}=t;r=await ds(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:a8})}else if("phone"in t){const{phone:o,password:i,options:l}=t;r=await ds(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:a8})}else throw new N2("You must provide either an email or phone number and a password");const{data:n,error:s}=r;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Fx}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(za(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(t){var r,n,s,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,o,i,l,c,d,u,f,h;let m,x;if("message"in t)m=t.message,x=t.signature;else{const{chain:g,wallet:v,statement:y,options:b}=t;let w;if(hd())if(typeof v=="object")w=v;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")w=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=v}const j=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href),_=await w.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!_||_.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=kY(_[0]);let A=(n=b?.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!A){const P=await w.request({method:"eth_chainId"});A=Jbe(P)}const S={domain:j.host,address:C,statement:y,uri:j.href,version:"1",chainId:A,nonce:(s=b?.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(i=(o=b?.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(l=b?.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=b?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=b?.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=b?.signInWithEthereum)===null||u===void 0?void 0:u.resources};m=Zbe(S),x=await w.request({method:"personal_sign",params:[Qbe(m),C]})}try{const{data:g,error:v}=await ds(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:x},!((f=t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=t.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Bu});if(v)throw v;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new Fx}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:v})}catch(g){if(za(g))return{data:{user:null,session:null},error:g};throw g}}async signInWithSolana(t){var r,n,s,o,i,l,c,d,u,f,h,m;let x,g;if("message"in t)x=t.message,g=t.signature;else{const{chain:v,wallet:y,statement:b,options:w}=t;let j;if(hd())if(typeof y=="object")j=y;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))j=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=y}const _=new URL((r=w?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in j&&j.signIn){const C=await j.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),b?{statement:b}:null));let A;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")A=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)A=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)x=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),g=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in j)||typeof j.signMessage!="function"||!("publicKey"in j)||typeof j!="object"||!j.publicKey||!("toBase58"in j.publicKey)||typeof j.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${_.host} wants you to sign in with your Solana account:`,j.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(s=(n=w?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=w?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((i=w?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((d=w?.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const C=await j.signMessage(new TextEncoder().encode(x),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=C}}try{const{data:v,error:y}=await ds(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:yg(g)},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Bu});if(y)throw y;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Fx}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:y})}catch(v){if(za(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(t){const r=await Wp(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:o,error:i}=await ds(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Bu});if(await ch(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new Fx}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:i})}catch(o){if(za(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:o,nonce:i}=t,l=await ds(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:Bu}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Fx}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(r){if(za(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(t){var r,n,s,o,i;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Lx(this.storage,this.storageKey));const{error:f}=await ds(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await ds(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(i=c?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:d?.message_id},error:u}}throw new N2("You must provide either an email or phone number.")}catch(l){if(za(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var r,n;try{let s,o;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:l}=await ds(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:Bu});if(l)throw l;if(!i)throw new Error("An error occurred on token verification.");const c=i.session,d=i.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(s){if(za(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(t){var r,n,s;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await Lx(this.storage,this.storageKey)),await ds(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:Ube})}catch(o){if(za(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new vh;const{error:s}=await ds(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:s}})}catch(t){if(za(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:o}=t,{error:i}=await ds(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in t){const{phone:n,type:s,options:o}=t,{data:i,error:l}=await ds(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:l}}throw new N2("You must provide either an email or phone number and a type")}catch(r){if(za(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Wp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<aE:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const i=await Wp(this.userStorage,this.storageKey+"-user");i?.user?t.user=i.user:t.user=iE()}if(this.storage.isServer&&t.user){let i=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!i&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{session:null},error:o}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await ds(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ah}):await this._useSession(async r=>{var n,s,o;const{data:i,error:l}=r;if(l)throw l;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new vh}:await ds(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Ah})})}catch(r){if(za(r))return xbe(r)&&(await this._removeSession(),await ch(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new vh;const i=s.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await Lx(this.storage,this.storageKey));const{data:d,error:u}=await ds(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:i.access_token,xform:Ah});if(u)throw u;return i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(za(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new vh;const r=Date.now()/1e3;let n=r,s=!0,o=null;const{payload:i}=oE(t.access_token);if(i.exp&&(n=i.exp,s=n<=r),s){const{data:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};o=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;o={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(r){if(za(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:i,error:l}=r;if(l)throw l;t=(n=i.session)!==null&&n!==void 0?n:void 0}if(!t?.refresh_token)throw new vh;const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{user:null,session:null},error:o}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(za(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(t,r){try{if(!hd())throw new S2("No browser detected.");if(t.error||t.error_description||t.error_code)throw new S2(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new J6("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new S2("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new J6("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(t.code);if(w)throw w;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:i,expires_in:l,expires_at:c,token_type:d}=t;if(!o||!l||!i||!d)throw new S2("No session defined in URL");const u=Math.round(Date.now()/1e3),f=parseInt(l);let h=u+f;c&&(h=parseInt(c));const m=h-u;m*1e3<=lv&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${f}s`);const x=h-f;u-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,h,u):u-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,h,u);const{data:g,error:v}=await this._getUser(o);if(v)throw v;const y={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:f,expires_at:h,refresh_token:i,token_type:d,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:t.type},error:null}}catch(n){if(za(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Wp(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{error:o};const i=(n=s.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:l}=await this.admin.signOut(i,t);if(l&&!(gbe(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await ch(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const r=Sbe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:o},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Lx(this.storage,this.storageKey,!0));try{return await ds(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(o){if(za(o))return{data:null,error:o};throw o}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(r){if(za(r))return{data:null,error:r};throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async o=>{var i,l,c,d,u;const{data:f,error:h}=o;if(h)throw h;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await ds(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(d=f.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return hd()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:t.provider,url:n?.url},error:null}}catch(n){if(za(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:o}}=r;if(s)throw s;const{options:i,provider:l,token:c,access_token:d,nonce:u}=t,f=await ds(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=o?.access_token)!==null&&n!==void 0?n:void 0,body:{provider:l,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:Bu}),{data:h,error:m}=f;return m?{data:{user:null,session:null},error:m}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new Fx}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),{data:h,error:m})}catch(s){if(za(s))return{data:{user:null,session:null},error:s};throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)throw i;return await ds(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(za(r))return{data:null,error:r};throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Ebe(async s=>(s>0&&await Abe(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await ds(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Bu})),(s,o)=>{const i=200*Math.pow(2,s);return o&&sE(o)&&Date.now()+i-n<lv})}catch(n){if(this._debug(r,"error",n),za(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),hd()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Wp(this.storage,this.storageKey);if(s&&this.userStorage){let i=await Wp(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:s.user},await cv(this.userStorage,this.storageKey+"-user",i)),s.user=(t=i?.user)!==null&&t!==void 0?t:iE()}else if(s&&!s.user&&!s.user){const i=await Wp(this.storage,this.storageKey+"-user");i&&i?.user?(s.user=i.user,await ch(this.storage,this.storageKey+"-user"),await cv(this.storage,this.storageKey,s)):s.user=iE()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<aE;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${aE}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),sE(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:l}=await this._getUser(s.access_token);!l&&i?.user?(s.user=i.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new vh;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new m5;const{data:o,error:i}=await this._refreshAccessToken(t);if(i)throw i;if(!o.session)throw new vh;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const l={data:o.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(o){if(this._debug(s,"error",o),za(o)){const i={data:null,error:o};return sE(o)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,r)}catch(c){o.push(c)}});if(await Promise.all(i),o.length>0){for(let l=0;l<o.length;l+=1)console.error(o[l]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await cv(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const o=r8(s);await cv(this.storage,this.storageKey,o)}else{const s=r8(r);await cv(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await ch(this.storage,this.storageKey),await ch(this.storage,this.storageKey+"-code-verifier"),await ch(this.storage,this.storageKey+"-user"),this.userStorage&&await ch(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&hd()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),lv);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/lv);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${lv}ms, refresh threshold is ${pO} ticks`),s<=pO&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof EY)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!hd()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,i]=await Lx(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});s.push(l.toString())}if(n?.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;return o?{data:null,error:o}:await ds(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(za(r))return{data:null,error:r};throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)return{data:null,error:i};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:d}=await ds(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&c.type==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(za(r))return{data:null,error:r};throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{data:null,error:o};const i=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?owe(t.webauthn.credential_response):iwe(t.webauthn.credential_response)})}:{code:t.code}),{data:l,error:c}=await ds(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:i,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:c})})}catch(r){if(za(r))return{data:null,error:r};throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{data:null,error:o};const i=await ds(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});if(i.error)return i;const{data:l}=i;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:awe(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:swe(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(za(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const o of(t=r?.factors)!==null&&t!==void 0?t:[])s.all.push(o),o.status==="verified"&&s[o.factor_type].push(o);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var r,n;const{data:{session:s},error:o}=t;if(o)return{data:null,error:o};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=oE(s.access_token);let l=null;i.aal&&(l=i.aal);let c=l;((n=(r=s.user.factors)===null||r===void 0?void 0:r.filter(f=>f.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=i.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(l=>l.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(l=>l.kid===t),n&&this.jwks_cached_at+hbe>s)return n;const{data:o,error:i}=await ds(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(l=>l.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:m,error:x}=await this.getSession();if(x||!m.session)return{data:null,error:x};n=m.session.access_token}const{header:s,payload:o,signature:i,raw:{header:l,payload:c}}=oE(n);r?.allowExpired||Rbe(o.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!d){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:o,header:s,signature:i},error:null}}const u=Fbe(s.alg),f=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,f,i,_be(`${l}.${c}`)))throw new vO("Invalid JWT signature");return{data:{claims:o,header:s,signature:i},error:null}}catch(n){if(za(n))return{data:null,error:n};throw n}}}Bw.nextInstanceID=0;const gwe=Bw;class xwe extends gwe{constructor(t){super(t)}}var vwe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class ywe{constructor(t,r,n){var s,o,i;this.supabaseUrl=t,this.supabaseKey=r;const l=cbe(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:Zye,realtime:tbe,auth:Object.assign(Object.assign({},ebe),{storageKey:c}),global:Qye},u=lbe(n??{},d);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=u.global.headers)!==null&&o!==void 0?o:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=u.auth)!==null&&i!==void 0?i:{},this.headers,u.global.fetch),this.fetch=sbe(r,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new pye(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Xye(this.storageUrl.href,this.headers,this.fetch,n?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new G0e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return vwe(this,void 0,void 0,function*(){var t,r;if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,storageKey:i,flowType:l,lock:c,debug:d},u,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new xwe({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,flowType:l,lock:c,debug:d,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Oye(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const bwe=(e,t,r)=>new ywe(e,t,r);function wwe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}wwe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const jwe="https://dlfryxtyxqoacuunswuc.supabase.co",_we="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY";function YD(){try{if(typeof window<"u"&&window.__SUPABASE_URL)return window.__SUPABASE_URL}catch{}return jwe}function TY(){try{if(typeof window<"u"&&window.__SUPABASE_KEY)return window.__SUPABASE_KEY}catch{}return _we}function Nwe(){try{return(new URL(YD()).host||"").split(".")[0]||""}catch{return""}}function Swe(){const e=Nwe();return e?`sb-${e}-auth-token`:"sb-auth-token"}async function Cwe(){try{const e=localStorage.getItem("custom-auth-token");if(e&&e.trim())return e.trim()}catch{}try{if(typeof rp<"u"&&rp?.auth?.getSession){const e=new Promise((s,o)=>setTimeout(()=>o(new Error("getSession timeout")),1e3)),t=rp.auth.getSession(),{data:r}=await Promise.race([t,e]),n=r?.session?.access_token;if(n)return console.debug("[Supabase Wrapper] Token obtido via getSession"),n}}catch(e){console.debug("[Supabase Wrapper] getSession falhou ou timeout:",e.message)}try{const e=Swe(),t=localStorage.getItem(e);if(t){const r=JSON.parse(t);if(r?.access_token)return console.debug("[Supabase Wrapper] Token obtido via localStorage"),r.access_token;if(r?.currentSession?.access_token)return console.debug("[Supabase Wrapper] Token obtido via localStorage (currentSession)"),r.currentSession.access_token}}catch(e){console.warn("[Supabase Wrapper] Erro ao ler localStorage:",e)}return console.warn("[Supabase Wrapper]  Nenhum token encontrado - usando anon key"),null}const Pwe=e=>{const t=new URLSearchParams;return Object.entries(e).forEach(([r,n])=>{n!=null&&(Array.isArray(n)?n.forEach(s=>t.append(r,String(s))):t.append(r,String(n)))}),t.toString()},DY=async(e,t={})=>{const{method:r="GET",body:n,headers:s={},params:o={},signal:i,timeoutMs:l=2e4}=t,c=Pwe(o),u=`${YD()}/rest/v1/${e}${c?`?${c}`:""}`,h={apikey:TY(),"Content-Type":"application/json",Prefer:"return=representation",...s};try{const _=await Cwe();_&&(h.Authorization=`Bearer ${_}`)}catch(_){console.warn("[Supabase Wrapper] Erro ao obter token de sesso:",_)}const m={method:r,headers:h};n&&(m.body=JSON.stringify(n)),i&&(m.signal=i);const x=new AbortController,g=setTimeout(()=>{console.warn(`[Supabase Wrapper]  Timeout (${l}ms) para ${e}`);try{x.abort("timeout")}catch{}},Math.max(5e3,l)),v=(()=>{if(!i)return x.signal;try{i.addEventListener("abort",()=>{try{x.abort("upstream-abort")}catch{}})}catch{}return x.signal})();m.signal=v;const y=Date.now();let b;try{b=await fetch(u,m)}finally{clearTimeout(g)}if(!b.ok){let _="";try{_=await b.text()}catch{}const C=Date.now()-y;let A=!1;try{const S=JSON.parse(_);A=b.status===401&&(S?.code==="PGRST303"||/jwt expired/i.test(S?.message||""))}catch{}if(A){try{window.dispatchEvent(new CustomEvent("auth:jwt-expired"))}catch{}try{localStorage.removeItem("custom-auth-token"),Object.keys(localStorage).filter(S=>S.startsWith("sb-")).forEach(S=>localStorage.removeItem(S)),Object.keys(sessionStorage).filter(S=>S.startsWith("sb-")).forEach(S=>sessionStorage.removeItem(S)),sessionStorage.setItem("auth:forceLogout","1"),window.location.replace("/")}catch{}}throw new Error(`[Supabase Wrapper] HTTP ${b.status} (${C}ms) - ${_||"unknown error"}`)}const w=Date.now()-y;let j;try{j=await b.json()}catch(_){throw console.error(`[Supabase Wrapper] Erro ao parsear JSON de ${e}:`,_),new Error(`[Supabase Wrapper] JSON parse error: ${_.message}`)}return w>3e3?console.warn(`[Supabase Wrapper]  fetch ${e} LENTO (${w}ms)`):console.debug(`[Supabase Wrapper] fetch ${e} OK (${w}ms)`),{data:j,error:null}};class Awe{constructor(t){this.table=t,this.params={},this.multiFilters={},this.selectColumns="*",this.signal=null}select(t="*"){return this.selectColumns=t,this.params.select=t,this}eq(t,r){return this._addFilter(t,`eq.${r}`),this}neq(t,r){return this.params[t]=`neq.${r}`,this}gt(t,r){return this.params[t]=`gt.${r}`,this}gte(t,r){return this._addFilter(t,`gte.${r}`),this}lt(t,r){return this.params[t]=`lt.${r}`,this}lte(t,r){return this._addFilter(t,`lte.${r}`),this}like(t,r){return this.params[t]=`like.${r}`,this}ilike(t,r){return this.params[t]=`ilike.${r}`,this}is(t,r){return this.params[t]=`is.${r}`,this}in(t,r){return this.params[t]=`in.(${r.join(",")})`,this}not(t,r,n){return this.params[t]=`not.${r}.${n}`,this}or(t){return this.params.or=`(${t})`,this}contains(t,r){return this.params[t]=`cs.{${r}}`,this}containedBy(t,r){return this.params[t]=`cd.{${r}}`,this}filter(t,r,n){return this._addFilter(t,`${r}.${n}`),this}order(t,r={}){const n=r.ascending===!1?"desc":"asc";return this.params.order=`${t}.${n}`,this}limit(t){return this.params.limit=t,this}range(t,r){return this.params.offset=t,this.params.limit=r-t+1,this}single(){return this.params.limit=1,this.isSingle=!0,this}maybeSingle(){return this.params.limit=1,this.isMaybeSingle=!0,this}abortSignal(t){return this.signal=t,this}_addFilter(t,r){this.multiFilters[t]||(this.multiFilters[t]=[]),this.multiFilters[t].push(r)}async then(t,r){try{const n={...this.params};Object.entries(this.multiFilters).forEach(([o,i])=>{i.length===1?n[o]=i[0]:i.length>1&&(n[o]=i)});const s=await DY(this.table,{method:"GET",params:n,signal:this.signal});this.isSingle&&s.data&&(s.data=s.data[0]||null),this.isMaybeSingle&&s.data&&(s.data=s.data[0]||null),t(s)}catch(n){r(n)}}}class Ewe extends Awe{insert(t){return this.method="POST",this.body=Array.isArray(t)?t:[t],this}update(t){return this.method="PATCH",this.body=t,this}upsert(t,r={}){this.method="POST",this.body=Array.isArray(t)?t:[t];const n=r.ignoreDuplicates?"resolution=ignore-duplicates":"resolution=merge-duplicates",s=r.returning==="minimal"?"return=minimal":"return=representation";return this.headers={...this.headers||{},Prefer:`${n},${s}`},r.onConflict&&(this.params.on_conflict=r.onConflict),this}delete(){return this.method="DELETE",this}async then(t,r){try{const n={...this.params};Object.entries(this.multiFilters).forEach(([o,i])=>{i.length===1?n[o]=i[0]:i.length>1&&(n[o]=i)});const s=await DY(this.table,{method:this.method||"GET",body:this.body,params:n,signal:this.signal,headers:this.headers||{}});this.isSingle&&s.data&&(s.data=s.data[0]||null),this.isMaybeSingle&&s.data&&(s.data=s.data[0]||null),t(s)}catch(n){r(n)}}}const rp={from(e){return new Ewe(e)},auth:null,supabaseUrl:YD(),supabaseKey:TY()};typeof window<"u"&&rp.from("empresas").select("id").limit(1).then(({data:e,error:t})=>{t&&console.error("[Supabase Wrapper]  ERRO:",t)}).catch(e=>{console.error("[Supabase Wrapper]  EXCEPTION:",e)});const c8="main";let Hv,Wb;try{const e=Object.assign({"./backendTargets.js":$0e,"./backendTargets.local.js":z0e}),t=e["./backendTargets.js"]||null,r=e["./backendTargets.local.js"]||null;t?.TARGETS&&(Wb=t.TARGETS),t?.ACTIVE_TARGET&&(Hv=t.ACTIVE_TARGET),r?.TARGETS&&(Wb=r.TARGETS),r?.ACTIVE_TARGET&&(Hv=r.ACTIVE_TARGET)}catch{}let fu=Wb&&Hv&&Wb[Hv]?Wb[Hv]:null,JD=Hv;!fu&&c8&&(JD=c8);let qc=fu&&fu.supabaseUrl&&fu.supabaseUrl.trim()?fu.supabaseUrl:"",zc=fu&&fu.supabaseAnonKey&&fu.supabaseAnonKey.trim()?fu.supabaseAnonKey:"";if(!qc||!zc){const e=(JD||"dev").toLowerCase(),t=e==="main"?{}.VITE_SUPABASE_URL_MAIN:{}.VITE_SUPABASE_URL_DEV,r=e==="main"?{}.VITE_SUPABASE_ANON_KEY_MAIN:{}.VITE_SUPABASE_ANON_KEY_DEV;qc=qc&&qc.trim()?qc:t,zc=zc&&zc.trim()?zc:r}(!qc||!zc)&&(qc=qc||"https://dlfryxtyxqoacuunswuc.supabase.co",zc=zc||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY");try{try{const e=JD||"dev";console.log(`[Target] Branch ativa: ${e}`);try{typeof window<"u"&&(window.__ACTIVE_TARGET=e)}catch{}const t=!!fu&&!!(fu.supabaseUrl||"").trim()&&!!(fu.supabaseAnonKey||"").trim(),r=!t&&(!!{}.VITE_SUPABASE_URL_DEV||!!{}.VITE_SUPABASE_URL_MAIN);console.info(`[Supabase] Backend target mode: ${t?"static config":r?"per-target env":"generic env"}`)}catch{}}catch{}if(!qc||!zc)throw console.error("[Supabase]  ERRO CRTICO: Variveis de ambiente ausentes!"),new Error("Supabase: Variveis de ambiente no configuradas!");const yO=qc,bO=zc,qu=bwe(qc,zc,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:typeof window<"u"?window.localStorage:void 0},global:{headers:{"X-Client-Info":"fluxo7arena-web",apikey:zc}}});try{typeof window<"u"&&rp&&(rp.auth=qu.auth)}catch{}const Q={from:e=>rp.from(e),auth:qu.auth,storage:qu.storage,functions:qu.functions,rpc:(...e)=>qu.rpc(...e),realtime:qu.realtime,channel:(...e)=>qu.channel(...e),removeChannel:(...e)=>qu.removeChannel(...e),removeAllChannels:()=>qu.removeAllChannels(),getChannels:()=>qu.getChannels(),supabaseUrl:qc,supabaseKey:zc};if(typeof window<"u"){window.__supabase=Q,window.__supabase_original=qu,window.__supabase_wrapper=rp;try{window.__SUPABASE_URL=qc}catch{}try{window.__SUPABASE_KEY=zc}catch{}}try{if(typeof window<"u"){const e=()=>{try{const t=localStorage.getItem("custom-auth-token");if(t&&t.trim()){Q.realtime.setAuth(t.trim());return}let r="";try{r=(new URL(qc).host||"").split(".")[0]||""}catch{}const n=r?`sb-${r}-auth-token`:"sb-auth-token",s=localStorage.getItem(n);if(s){const o=JSON.parse(s),i=o?.access_token||o?.currentSession?.access_token;i&&Q.realtime.setAuth(i)}}catch{}};e();try{window.addEventListener("storage",t=>{try{const r=t?.key||"";(r==="custom-auth-token"||r.startsWith("sb-"))&&e()}catch{}})}catch{}}}catch{}const MY=p.createContext({}),fo=()=>{const e=p.useContext(MY);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},kwe=({children:e})=>{const[t,r]=p.useState(null),[n,s]=p.useState(null),[o,i]=p.useState(null),[l,c]=p.useState(!0),[d,u]=p.useState(!1),f=p.useRef(null),h=p.useRef(!1),m=(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}})();p.useEffect(()=>{if((()=>{try{return sessionStorage.getItem("auth:forceLogout")==="1"}catch{return!1}})()){try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company")}catch{}r(null),s(null),i(null),u(!0),c(!1);try{sessionStorage.removeItem("auth:forceLogout")}catch{}try{Q.auth.signOut({scope:"global"}).catch(()=>{})}catch{}return}try{const S=localStorage.getItem("auth:userProfile"),P=localStorage.getItem("auth:company");S&&s(JSON.parse(S)),P&&i(JSON.parse(P)),(S||P)&&u(!0)}catch(S){console.warn("AuthContext: falha ao hidratar cache local:",S)}(async()=>{try{if(m)try{const M=localStorage.getItem("custom-auth-token");if(M&&M.trim()){const I=JSON.parse(atob(M.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")))?.sub||null;if(I){r({id:I}),u(!0),await x(I),f.current=I,c(!1);return}}}catch{}const{data:{session:S},error:P}=await Q.auth.getSession();P&&console.error("supabase.auth.getSession error:",P),S?.user?(r(S.user),u(!0),await x(S.user.id),f.current=S.user.id):u(!0)}catch(S){console.error("getSession exception:",S)}finally{c(!1)}})();const{data:C}=Q.auth.onAuthStateChange(async(S,P)=>{console.log("[AuthContext] onAuthStateChange",{event:S,userId:P?.user?.id||null});try{if(S==="SIGNED_OUT"){try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company")}catch{}r(null),s(null),i(null),f.current=null,h.current=!1,c(!1),u(!0);return}if(m){u(!0),c(!1);return}const M=P?.user||null;r(M),u(!0),M?.id&&(await x(M.id),f.current=M.id,c(!1))}catch(M){console.error("onAuthStateChange handler error:",M),c(!1),u(!0)}}),A=setTimeout(()=>{c(S=>S&&!1),u(S=>S||!0)},12e3);return()=>{clearTimeout(A),C.subscription.unsubscribe()}},[]),p.useEffect(()=>{(async()=>{try{if(!d||!t)return;const _=!n,C=!!n&&!o&&!!n.codigo_empresa;(_||C)&&(await x(t.id),f.current=t.id)}catch{}})()},[d,t?.id,!!n,n?.codigo_empresa,!!o]),p.useEffect(()=>{const j=()=>{try{const A=localStorage.getItem("auth:userProfile"),S=localStorage.getItem("auth:company");if(A){const P=JSON.parse(A);(!n||!n.codigo_empresa)&&s(P)}if(S){const P=JSON.parse(S);(!o||!o.codigo_empresa)&&i(P)}}catch{}},_=()=>{j(),t?.id&&x(t.id).catch(()=>{})},C=()=>{document.visibilityState==="visible"&&_()};return window.addEventListener("focus",_),document.addEventListener("visibilitychange",C),()=>{window.removeEventListener("focus",_),document.removeEventListener("visibilitychange",C)}},[t?.id]);const x=async j=>{if(h.current){console.log("[AuthDebug] loadUserProfile:skip (already running)");return}h.current=!0;try{const _=[300,800,1600,3e3],C=P=>new Promise(M=>setTimeout(M,P)),A=async(P,M)=>{let O;try{const I=new Promise(k=>{O=setTimeout(()=>k({__timeout:!0}),M)});return await Promise.race([P,I])}finally{clearTimeout(O)}},S=1200;for(let P=0;P<=_.length;P++){console.log("[AuthDebug] loadUserProfile:start",{userId:j,attempt:P});try{console.log("[AuthDebug] querying colaboradores",{userId:j});const M=Q.from("colaboradores").select("*").eq("id",j).single(),O=await A(M,S);if(O&&O.__timeout){console.warn("[AuthDebug] colaboradores:timeout, using usuarios fallback (inline)");try{console.log("[AuthDebug] fallback-inline: querying usuarios by id");const{data:k,error:$}=await Q.from("usuarios").select("*").eq("id",j).maybeSingle();if(!$&&k){let q=null;if(k.codigo_empresa){console.log("[AuthDebug] fallback-inline: querying empresas by codigo",{codigo_empresa:k.codigo_empresa});const{data:F,error:V}=await Q.from("empresas").select("*").eq("codigo_empresa",k.codigo_empresa).single();V?console.warn("[AuthDebug] fallback-inline: empresa error",{status:V.status,code:V.code,message:V.message}):(q=F,console.log("[AuthDebug] fallback-inline: empresa loaded"))}const z={id:j,nome:k.nome||null,cargo:k.papel||"user",codigo_empresa:k.codigo_empresa||null,_source:"usuarios"};s(z);try{localStorage.setItem("auth:userProfile",JSON.stringify(z))}catch{}if(q){i(q);try{localStorage.setItem("auth:company",JSON.stringify(q))}catch{}console.log("[AuthDebug] fallback-inline: set company from usuarios path")}else console.warn("[AuthDebug] fallback-inline: no company resolved; preserving previous company");return}$&&console.warn("[AuthDebug] fallback-inline: usuarios error",{status:$.status,code:$.code,message:$.message})}catch(k){console.warn("[AuthDebug] fallback-inline: unexpected error",k?.message||k)}if(P<_.length){await C(_[P]);continue}return}const{data:I,error:T}=O||{};if(console.log("[AuthDebug] colaboradores:success",{hasProfile:!!I,codigo_empresa:I?.codigo_empresa||null}),T){if(console.warn("[AuthDebug] colaboradores:error",{code:T.code,status:T.status,message:T.message}),T.code==="42P17"){if(P<_.length){await C(_[P]);continue}console.warn("RLS recursion (42P17) persistente ao carregar perfil. Prosseguindo sem alterar cache.");return}if([401,403].includes(Number(T.status))&&(console.warn("[AuthDebug] Erro de autorizao detectado, tentando fallback"),P<_.length)){await C(_[P]);continue}if(T.code==="PGRST116"){try{console.log("[AuthDebug] fallback: querying usuarios by id");const{data:$,error:q}=await Q.from("usuarios").select("*").eq("id",j).maybeSingle();if(!q&&$){let z=null;if($.codigo_empresa){console.log("[AuthDebug] fallback: querying empresas by codigo",{codigo_empresa:$.codigo_empresa});const{data:V,error:ue}=await Q.from("empresas").select("*").eq("codigo_empresa",$.codigo_empresa).single();ue?console.warn("[AuthDebug] fallback: empresa error",{status:ue.status,code:ue.code,message:ue.message}):(z=V,console.log("[AuthDebug] fallback: empresa loaded"))}const F={id:j,nome:$.nome||null,cargo:$.papel||"user",codigo_empresa:$.codigo_empresa||null,_source:"usuarios"};s(F);try{localStorage.setItem("auth:userProfile",JSON.stringify(F))}catch{}if(z){i(z);try{localStorage.setItem("auth:company",JSON.stringify(z))}catch{}console.log("[AuthDebug] fallback: set company from usuarios path")}else console.warn("[AuthDebug] fallback: no company resolved; preserving previous company");return}q&&console.warn("[AuthDebug] fallback: usuarios error",{status:q.status,code:q.code,message:q.message})}catch{}console.warn("AuthContext: perfil no encontrado (PGRST116) e fallback falhou; mantendo cache atual.");return}if([401,403,406].includes(Number(T.status))&&P<_.length){await C(_[P]);continue}throw T}if(!I){if(P<_.length){await C(_[P]);continue}return}s(I);try{localStorage.setItem("auth:userProfile",JSON.stringify(I))}catch{}if(I?.codigo_empresa){console.log("[AuthDebug] company: querying empresas by codigo from colaboradores",{codigo_empresa:I.codigo_empresa});const{data:k,error:$}=await Q.from("empresas").select("*").eq("codigo_empresa",I.codigo_empresa).single();if($){if([401,403,406].includes(Number($.status))&&P<_.length){await C(_[P]);continue}console.warn("[AuthDebug] company: load error; preserving previous company",{status:$.status,code:$.code,message:$.message});return}else{i(k);try{localStorage.setItem("auth:company",JSON.stringify(k))}catch{}console.log("[AuthDebug] company: set from colaboradores path")}}else console.warn("[AuthDebug] company: no codigo_empresa available on profile; preserving previous company");return}catch(M){if(console.error("[AuthDebug] loadUserProfile:unexpected error",{message:M?.message,code:M?.code,status:M?.status}),P<_.length){await C(_[P]);continue}console.error("Error loading user profile:",M);return}}}finally{h.current=!1}},w={user:t,userProfile:n,company:o,loading:l,authReady:d,signUp:async(j,_,C,A=null)=>{try{const{data:S,error:P}=await Q.auth.signUp({email:j,password:_});if(P)throw P;if(S?.user&&A){const{data:M,error:O}=await Q.from("empresas").select("id, codigo_empresa").eq("codigo_empresa",A).single();if(O)throw new Error("Cdigo de empresa invlido. Verifique o cdigo informado.");const{error:I}=await Q.from("colaboradores").insert({id:S.user.id,codigo_empresa:M.codigo_empresa,nome:C,cargo:"user",ativo:!0});if(I)throw I}return{data:S,error:null}}catch(S){let P="No foi possvel cadastrar. Verifique os dados e tente novamente.";const M=(S?.message||"").toLowerCase();return M.includes("user already registered")||M.includes("already registered")||M.includes("user already exists")?P="Email j cadastrado. Tente entrar ou redefinir a senha.":M.includes("password")&&M.includes("length")&&(P="Senha muito curta. Use ao menos 6 caracteres."),{data:null,error:new Error(P)}}},signIn:async(j,_)=>{try{if(m){const S=yO,P=bO,M=await fetch(`${S}/rest/v1/rpc/auth_login_dev`,{method:"POST",headers:{"Content-Type":"application/json",apikey:P,Authorization:`Bearer ${P}`},body:JSON.stringify({p_email:j,p_password:_})});if(!M.ok){const k=await M.text().catch(()=>"");let $="No foi possvel entrar. Tente novamente.";return M.status===401&&($="Email ou senha invlidos."),M.status===423&&($="Usurio bloqueado temporariamente."),{data:null,error:new Error($+(k?` (${k})`:""))}}const I=(await M.json())?.access_token||"",T=(()=>{try{return JSON.parse(atob(I.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))).sub}catch{return null}})();try{localStorage.setItem("custom-auth-token",I)}catch{}return T&&(r({id:T}),u(!0),await x(T),f.current=T),{data:{user:T?{id:T}:null},error:null}}const{data:C,error:A}=await Q.auth.signInWithPassword({email:j,password:_});if(A){let S="No foi possvel entrar. Tente novamente.";const P=(A.message||"").toLowerCase(),M=A.status;return P.includes("invalid login")||P.includes("invalid credentials")||M===400?S="Email ou senha invlidos.":P.includes("email not confirmed")||P.includes("not confirmed")?S="Email no confirmado. Verifique sua caixa de entrada.":M===429?S="Muitas tentativas. Aguarde alguns minutos e tente novamente.":M>=500&&(S="Servio indisponvel no momento. Tente novamente mais tarde."),{data:null,error:new Error(S)}}return C.user&&await Q.from("colaboradores").select("id").eq("id",C.user.id).single(),{data:C,error:null}}catch(C){return{data:null,error:C}}},signOut:async()=>{try{localStorage.removeItem("custom-auth-token")}catch{}try{const j=Q.auth.signOut({scope:"global"}),_=new Promise(C=>setTimeout(C,700));await Promise.race([j,_])}catch(j){console.warn("[AuthContext] signOut(): error during signOut",j?.message||j)}f.current=null,r(null),s(null),i(null),c(!1),u(!0);try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company"),localStorage.removeItem("clientes:list"),localStorage.removeItem("quadras:list"),localStorage.removeItem("agenda:courts"),localStorage.removeItem("agenda:selectedCourts"),localStorage.removeItem("agenda:viewFilter"),Object.keys(localStorage).filter(j=>j.startsWith("agenda:bookings:")).forEach(j=>localStorage.removeItem(j)),Object.keys(localStorage).filter(j=>j.startsWith("sb-")).forEach(j=>localStorage.removeItem(j)),Object.keys(sessionStorage).filter(j=>j.startsWith("sb-")).forEach(j=>sessionStorage.removeItem(j))}catch{}try{sessionStorage.setItem("auth:forceLogout","1")}catch{}try{window.location.replace("/")}catch{}return{error:null}},reloadCompany:async()=>{try{const j=n&&n.codigo_empresa?n.codigo_empresa:null;if(!j)return;const{data:_,error:C}=await Q.from("empresas").select("*").eq("codigo_empresa",j).single();if(!C&&_){i(_);try{localStorage.setItem("auth:company",JSON.stringify(_))}catch{}}}catch{}}};return a.jsx(MY.Provider,{value:w,children:e})};function ks(e){"@babel/helpers - typeof";return ks=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ks(e)}function fi(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Pa(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function os(e){Pa(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||ks(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Ss(e,t){Pa(2,arguments);var r=os(e),n=fi(t);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function df(e,t){Pa(2,arguments);var r=os(e),n=fi(t);if(isNaN(n))return new Date(NaN);if(!n)return r;var s=r.getDate(),o=new Date(r.getTime());o.setMonth(r.getMonth()+n+1,0);var i=o.getDate();return s>=i?o:(r.setFullYear(o.getFullYear(),o.getMonth(),s),r)}function RY(e,t){Pa(2,arguments);var r=os(e).getTime(),n=fi(t);return new Date(r+n)}var Iwe={};function Op(){return Iwe}function _u(e,t){var r,n,s,o,i,l,c,d;Pa(1,arguments);var u=Op(),f=fi((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=os(e),m=h.getDay(),x=(m<f?7:0)+m-f;return h.setDate(h.getDate()-x),h.setHours(0,0,0,0),h}function ex(e){return Pa(1,arguments),_u(e,{weekStartsOn:1})}function Owe(e){Pa(1,arguments);var t=os(e),r=t.getFullYear(),n=new Date(0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);var s=ex(n),o=new Date(0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);var i=ex(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=i.getTime()?r:r-1}function Twe(e){Pa(1,arguments);var t=Owe(e),r=new Date(0);r.setFullYear(t,0,4),r.setHours(0,0,0,0);var n=ex(r);return n}function qw(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Po(e){Pa(1,arguments);var t=os(e);return t.setHours(0,0,0,0),t}var Dwe=864e5;function Mf(e,t){Pa(2,arguments);var r=Po(e),n=Po(t),s=r.getTime()-qw(r),o=n.getTime()-qw(n);return Math.round((s-o)/Dwe)}var Mwe=6e4;function d8(e,t){Pa(2,arguments);var r=fi(t);return RY(e,r*Mwe)}function wO(e,t){Pa(2,arguments);var r=fi(t),n=r*7;return Ss(e,n)}function Rwe(e,t){Pa(2,arguments);var r=fi(t);return df(e,r*12)}function Fwe(e){Pa(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(ks(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var r;return t.forEach(function(n){var s=os(n);(r===void 0||r<s||isNaN(Number(s)))&&(r=s)}),r||new Date(NaN)}function Lwe(e){Pa(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(ks(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var r;return t.forEach(function(n){var s=os(n);(r===void 0||r>s||isNaN(s.getDate()))&&(r=s)}),r||new Date(NaN)}var FY=6e4,LY=36e5;function Ql(e,t){Pa(2,arguments);var r=Po(e),n=Po(t);return r.getTime()===n.getTime()}function QD(e){return Pa(1,arguments),e instanceof Date||ks(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function $we(e){if(Pa(1,arguments),!QD(e)&&typeof e!="number")return!1;var t=os(e);return!isNaN(Number(t))}function zw(e,t){Pa(2,arguments);var r=os(e),n=os(t),s=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return s*12+o}var Bwe=6048e5;function qwe(e,t,r){Pa(2,arguments);var n=_u(e,r),s=_u(t,r),o=n.getTime()-qw(n),i=s.getTime()-qw(s);return Math.round((o-i)/Bwe)}function u8(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function zwe(e,t){Pa(2,arguments);var r=os(e),n=os(t),s=u8(r,n),o=Math.abs(Mf(r,n));r.setDate(r.getDate()-s*o);var i=+(u8(r,n)===-s),l=s*(o-i);return l===0?0:l}function M_(e){Pa(1,arguments);var t=os(e);return t.setHours(23,59,59,999),t}function h5(e){Pa(1,arguments);var t=os(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function Cc(e){Pa(1,arguments);var t=os(e);return t.setDate(1),t.setHours(0,0,0,0),t}function Uwe(e){Pa(1,arguments);var t=os(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function ZD(e,t){var r,n,s,o,i,l,c,d;Pa(1,arguments);var u=Op(),f=fi((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=os(e),m=h.getDay(),x=(m<f?-7:0)+6-(m-f);return h.setDate(h.getDate()+x),h.setHours(23,59,59,999),h}function $Y(e){return Pa(1,arguments),ZD(e,{weekStartsOn:1})}function Vwe(e,t){Pa(2,arguments);var r=fi(t);return RY(e,-r)}var Wwe=864e5;function Hwe(e){Pa(1,arguments);var t=os(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=t.getTime(),s=r-n;return Math.floor(s/Wwe)+1}function $N(e){Pa(1,arguments);var t=1,r=os(e),n=r.getUTCDay(),s=(n<t?7:0)+n-t;return r.setUTCDate(r.getUTCDate()-s),r.setUTCHours(0,0,0,0),r}function BY(e){Pa(1,arguments);var t=os(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var s=$N(n),o=new Date(0);o.setUTCFullYear(r,0,4),o.setUTCHours(0,0,0,0);var i=$N(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=i.getTime()?r:r-1}function Gwe(e){Pa(1,arguments);var t=BY(e),r=new Date(0);r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0);var n=$N(r);return n}var Kwe=6048e5;function Xwe(e){Pa(1,arguments);var t=os(e),r=$N(t).getTime()-Gwe(t).getTime();return Math.round(r/Kwe)+1}function BN(e,t){var r,n,s,o,i,l,c,d;Pa(1,arguments);var u=Op(),f=fi((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=os(e),m=h.getUTCDay(),x=(m<f?7:0)+m-f;return h.setUTCDate(h.getUTCDate()-x),h.setUTCHours(0,0,0,0),h}function qY(e,t){var r,n,s,o,i,l,c,d;Pa(1,arguments);var u=os(e),f=u.getUTCFullYear(),h=Op(),m=fi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setUTCFullYear(f+1,0,m),x.setUTCHours(0,0,0,0);var g=BN(x,t),v=new Date(0);v.setUTCFullYear(f,0,m),v.setUTCHours(0,0,0,0);var y=BN(v,t);return u.getTime()>=g.getTime()?f+1:u.getTime()>=y.getTime()?f:f-1}function Ywe(e,t){var r,n,s,o,i,l,c,d;Pa(1,arguments);var u=Op(),f=fi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:u.firstWeekContainsDate)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=qY(e,t),m=new Date(0);m.setUTCFullYear(h,0,f),m.setUTCHours(0,0,0,0);var x=BN(m,t);return x}var Jwe=6048e5;function Qwe(e,t){Pa(1,arguments);var r=os(e),n=BN(r,t).getTime()-Ywe(r,t).getTime();return Math.round(n/Jwe)+1}function co(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var Zwe={y:function(t,r){var n=t.getUTCFullYear(),s=n>0?n:1-n;return co(r==="yy"?s%100:s,r.length)},M:function(t,r){var n=t.getUTCMonth();return r==="M"?String(n+1):co(n+1,2)},d:function(t,r){return co(t.getUTCDate(),r.length)},a:function(t,r){var n=t.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(t,r){return co(t.getUTCHours()%12||12,r.length)},H:function(t,r){return co(t.getUTCHours(),r.length)},m:function(t,r){return co(t.getUTCMinutes(),r.length)},s:function(t,r){return co(t.getUTCSeconds(),r.length)},S:function(t,r){var n=r.length,s=t.getUTCMilliseconds(),o=Math.floor(s*Math.pow(10,n-3));return co(o,r.length)}};const dh=Zwe;var zx={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},e1e={G:function(t,r,n){var s=t.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){var s=t.getUTCFullYear(),o=s>0?s:1-s;return n.ordinalNumber(o,{unit:"year"})}return dh.y(t,r)},Y:function(t,r,n,s){var o=qY(t,s),i=o>0?o:1-o;if(r==="YY"){var l=i%100;return co(l,2)}return r==="Yo"?n.ordinalNumber(i,{unit:"year"}):co(i,r.length)},R:function(t,r){var n=BY(t);return co(n,r.length)},u:function(t,r){var n=t.getUTCFullYear();return co(n,r.length)},Q:function(t,r,n){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"Q":return String(s);case"QQ":return co(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,r,n){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"q":return String(s);case"qq":return co(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,r,n){var s=t.getUTCMonth();switch(r){case"M":case"MM":return dh.M(t,r);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(t,r,n){var s=t.getUTCMonth();switch(r){case"L":return String(s+1);case"LL":return co(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(t,r,n,s){var o=Qwe(t,s);return r==="wo"?n.ordinalNumber(o,{unit:"week"}):co(o,r.length)},I:function(t,r,n){var s=Xwe(t);return r==="Io"?n.ordinalNumber(s,{unit:"week"}):co(s,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):dh.d(t,r)},D:function(t,r,n){var s=Hwe(t);return r==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):co(s,r.length)},E:function(t,r,n){var s=t.getUTCDay();switch(r){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(t,r,n,s){var o=t.getUTCDay(),i=(o-s.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return co(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});case"eeee":default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(t,r,n,s){var o=t.getUTCDay(),i=(o-s.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return co(i,r.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});case"cccc":default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(t,r,n){var s=t.getUTCDay(),o=s===0?7:s;switch(r){case"i":return String(o);case"ii":return co(o,r.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(t,r,n){var s=t.getUTCHours(),o=s/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(t,r,n){var s=t.getUTCHours(),o;switch(s===12?o=zx.noon:s===0?o=zx.midnight:o=s/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(t,r,n){var s=t.getUTCHours(),o;switch(s>=17?o=zx.evening:s>=12?o=zx.afternoon:s>=4?o=zx.morning:o=zx.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){var s=t.getUTCHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return dh.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):dh.H(t,r)},K:function(t,r,n){var s=t.getUTCHours()%12;return r==="Ko"?n.ordinalNumber(s,{unit:"hour"}):co(s,r.length)},k:function(t,r,n){var s=t.getUTCHours();return s===0&&(s=24),r==="ko"?n.ordinalNumber(s,{unit:"hour"}):co(s,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):dh.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):dh.s(t,r)},S:function(t,r){return dh.S(t,r)},X:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();if(i===0)return"Z";switch(r){case"X":return m8(i);case"XXXX":case"XX":return ag(i);case"XXXXX":case"XXX":default:return ag(i,":")}},x:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"x":return m8(i);case"xxxx":case"xx":return ag(i);case"xxxxx":case"xxx":default:return ag(i,":")}},O:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+f8(i,":");case"OOOO":default:return"GMT"+ag(i,":")}},z:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+f8(i,":");case"zzzz":default:return"GMT"+ag(i,":")}},t:function(t,r,n,s){var o=s._originalDate||t,i=Math.floor(o.getTime()/1e3);return co(i,r.length)},T:function(t,r,n,s){var o=s._originalDate||t,i=o.getTime();return co(i,r.length)}};function f8(e,t){var r=e>0?"-":"+",n=Math.abs(e),s=Math.floor(n/60),o=n%60;if(o===0)return r+String(s);var i=t||"";return r+String(s)+i+co(o,2)}function m8(e,t){if(e%60===0){var r=e>0?"-":"+";return r+co(Math.abs(e)/60,2)}return ag(e,t)}function ag(e,t){var r=t||"",n=e>0?"-":"+",s=Math.abs(e),o=co(Math.floor(s/60),2),i=co(s%60,2);return n+o+r+i}const t1e=e1e;var h8=function(t,r){switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},zY=function(t,r){switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},r1e=function(t,r){var n=t.match(/(P+)(p+)?/)||[],s=n[1],o=n[2];if(!o)return h8(t,r);var i;switch(s){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;case"PPPP":default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",h8(s,r)).replace("{{time}}",zY(o,r))},n1e={p:zY,P:r1e};const a1e=n1e;var s1e=["D","DD"],o1e=["YY","YYYY"];function i1e(e){return s1e.indexOf(e)!==-1}function l1e(e){return o1e.indexOf(e)!==-1}function p8(e,t,r){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var c1e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},d1e=function(t,r,n){var s,o=c1e[t];return typeof o=="string"?s=o:r===1?s=o.one:s=o.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};const u1e=d1e;function Gv(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth,n=e.formats[r]||e.formats[e.defaultWidth];return n}}var f1e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},m1e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},h1e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},p1e={date:Gv({formats:f1e,defaultWidth:"full"}),time:Gv({formats:m1e,defaultWidth:"full"}),dateTime:Gv({formats:h1e,defaultWidth:"full"})};const g1e=p1e;var x1e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},v1e=function(t,r,n,s){return x1e[t]};const y1e=v1e;function kf(e){return function(t,r){var n=r!=null&&r.context?String(r.context):"standalone",s;if(n==="formatting"&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):o;s=e.formattingValues[i]||e.formattingValues[o]}else{var l=e.defaultWidth,c=r!=null&&r.width?String(r.width):e.defaultWidth;s=e.values[c]||e.values[l]}var d=e.argumentCallback?e.argumentCallback(t):t;return s[d]}}var b1e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},w1e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},j1e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},_1e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},N1e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},S1e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},C1e=function(t,r){var n=Number(t),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},P1e={ordinalNumber:C1e,era:kf({values:b1e,defaultWidth:"wide"}),quarter:kf({values:w1e,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:kf({values:j1e,defaultWidth:"wide"}),day:kf({values:_1e,defaultWidth:"wide"}),dayPeriod:kf({values:N1e,defaultWidth:"wide",formattingValues:S1e,defaultFormattingWidth:"wide"})};const A1e=P1e;function If(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(s);if(!o)return null;var i=o[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?k1e(l,function(f){return f.test(i)}):E1e(l,function(f){return f.test(i)}),d;d=e.valueCallback?e.valueCallback(c):c,d=r.valueCallback?r.valueCallback(d):d;var u=t.slice(i.length);return{value:d,rest:u}}}function E1e(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r}function k1e(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r}function UY(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.match(e.matchPattern);if(!n)return null;var s=n[0],o=t.match(e.parsePattern);if(!o)return null;var i=e.valueCallback?e.valueCallback(o[0]):o[0];i=r.valueCallback?r.valueCallback(i):i;var l=t.slice(s.length);return{value:i,rest:l}}}var I1e=/^(\d+)(th|st|nd|rd)?/i,O1e=/\d+/i,T1e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},D1e={any:[/^b/i,/^(a|c)/i]},M1e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},R1e={any:[/1/i,/2/i,/3/i,/4/i]},F1e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},L1e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},$1e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},B1e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},q1e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},z1e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},U1e={ordinalNumber:UY({matchPattern:I1e,parsePattern:O1e,valueCallback:function(t){return parseInt(t,10)}}),era:If({matchPatterns:T1e,defaultMatchWidth:"wide",parsePatterns:D1e,defaultParseWidth:"any"}),quarter:If({matchPatterns:M1e,defaultMatchWidth:"wide",parsePatterns:R1e,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:If({matchPatterns:F1e,defaultMatchWidth:"wide",parsePatterns:L1e,defaultParseWidth:"any"}),day:If({matchPatterns:$1e,defaultMatchWidth:"wide",parsePatterns:B1e,defaultParseWidth:"any"}),dayPeriod:If({matchPatterns:q1e,defaultMatchWidth:"any",parsePatterns:z1e,defaultParseWidth:"any"})};const V1e=U1e;var W1e={code:"en-US",formatDistance:u1e,formatLong:g1e,formatRelative:y1e,localize:A1e,match:V1e,options:{weekStartsOn:0,firstWeekContainsDate:1}};const VY=W1e;var H1e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,G1e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,K1e=/^'([^]*?)'?$/,X1e=/''/g,Y1e=/[a-zA-Z]/;function or(e,t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w,j;Pa(2,arguments);var _=String(t),C=Op(),A=(n=(s=r?.locale)!==null&&s!==void 0?s:C.locale)!==null&&n!==void 0?n:VY,S=fi((o=(i=(l=(c=r?.firstWeekContainsDate)!==null&&c!==void 0?c:r==null||(d=r.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&l!==void 0?l:C.firstWeekContainsDate)!==null&&i!==void 0?i:(f=C.locale)===null||f===void 0||(h=f.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var P=fi((m=(x=(g=(v=r?.weekStartsOn)!==null&&v!==void 0?v:r==null||(y=r.locale)===null||y===void 0||(b=y.options)===null||b===void 0?void 0:b.weekStartsOn)!==null&&g!==void 0?g:C.weekStartsOn)!==null&&x!==void 0?x:(w=C.locale)===null||w===void 0||(j=w.options)===null||j===void 0?void 0:j.weekStartsOn)!==null&&m!==void 0?m:0);if(!(P>=0&&P<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!A.localize)throw new RangeError("locale must contain localize property");if(!A.formatLong)throw new RangeError("locale must contain formatLong property");var M=os(e);if(!$we(M))throw new RangeError("Invalid time value");var O=qw(M),I=Vwe(M,O),T={firstWeekContainsDate:S,weekStartsOn:P,locale:A,_originalDate:M},k=_.match(G1e).map(function($){var q=$[0];if(q==="p"||q==="P"){var z=a1e[q];return z($,A.formatLong)}return $}).join("").match(H1e).map(function($){if($==="''")return"'";var q=$[0];if(q==="'")return J1e($);var z=t1e[q];if(z)return!(r!=null&&r.useAdditionalWeekYearTokens)&&l1e($)&&p8($,t,String(e)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&i1e($)&&p8($,t,String(e)),z(I,$,A.localize,T);if(q.match(Y1e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+q+"`");return $}).join("");return k}function J1e(e){var t=e.match(K1e);return t?t[1].replace(X1e,"'"):e}function Q1e(e){Pa(1,arguments);var t=os(e),r=t.getFullYear(),n=t.getMonth(),s=new Date(0);return s.setFullYear(r,n+1,0),s.setHours(0,0,0,0),s.getDate()}function Gd(e){Pa(1,arguments);var t=os(e),r=t.getHours();return r}var Z1e=6048e5;function eje(e){Pa(1,arguments);var t=os(e),r=ex(t).getTime()-Twe(t).getTime();return Math.round(r/Z1e)+1}function Kd(e){Pa(1,arguments);var t=os(e),r=t.getMinutes();return r}function tje(e){Pa(1,arguments);var t=os(e),r=t.getTime();return r}function rje(e){return Pa(1,arguments),Math.floor(tje(e)/1e3)}function nje(e,t){var r,n,s,o,i,l,c,d;Pa(1,arguments);var u=os(e),f=u.getFullYear(),h=Op(),m=fi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setFullYear(f+1,0,m),x.setHours(0,0,0,0);var g=_u(x,t),v=new Date(0);v.setFullYear(f,0,m),v.setHours(0,0,0,0);var y=_u(v,t);return u.getTime()>=g.getTime()?f+1:u.getTime()>=y.getTime()?f:f-1}function aje(e,t){var r,n,s,o,i,l,c,d;Pa(1,arguments);var u=Op(),f=fi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:u.firstWeekContainsDate)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=nje(e,t),m=new Date(0);m.setFullYear(h,0,f),m.setHours(0,0,0,0);var x=_u(m,t);return x}var sje=6048e5;function oje(e,t){Pa(1,arguments);var r=os(e),n=_u(r,t).getTime()-aje(r,t).getTime();return Math.round(n/sje)+1}function ije(e){Pa(1,arguments);var t=os(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function lje(e,t){return Pa(1,arguments),qwe(ije(e),Cc(e),t)+1}function jO(e,t){Pa(2,arguments);var r=os(e),n=os(t);return r.getTime()>n.getTime()}function WY(e,t){Pa(2,arguments);var r=os(e),n=os(t);return r.getTime()<n.getTime()}function g8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function cje(e,t){if(e){if(typeof e=="string")return g8(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g8(e,t):void 0}}function _O(e,t){return _O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},_O(e,t)}function dje(e,t){if(ks(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ks(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uje(e){var t=dje(e,"string");return ks(t)=="symbol"?t:t+""}function fje(e,t,r){return(t=uje(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eM(e,t){Pa(2,arguments);var r=os(e),n=os(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function mje(e,t){Pa(2,arguments);var r=os(e),n=os(t);return r.getFullYear()===n.getFullYear()}function Kv(e,t){Pa(2,arguments);var r=fi(t);return Ss(e,-r)}function x8(e,t){var r;Pa(1,arguments);var n=fi((r=t?.additionalDigits)!==null&&r!==void 0?r:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var s=xje(e),o;if(s.date){var i=vje(s.date,n);o=yje(i.restDateString,i.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var l=o.getTime(),c=0,d;if(s.time&&(c=bje(s.time),isNaN(c)))return new Date(NaN);if(s.timezone){if(d=wje(s.timezone),isNaN(d))return new Date(NaN)}else{var u=new Date(l+c),f=new Date(0);return f.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),f.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),f}return new Date(l+c+d)}var C2={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},hje=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,pje=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,gje=/^([+-])(\d{2})(?::?(\d{2}))?$/;function xje(e){var t={},r=e.split(C2.dateTimeDelimiter),n;if(r.length>2)return t;if(/:/.test(r[0])?n=r[0]:(t.date=r[0],n=r[1],C2.timeZoneDelimiter.test(t.date)&&(t.date=e.split(C2.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){var s=C2.timezone.exec(n);s?(t.time=n.replace(s[1],""),t.timezone=s[1]):t.time=n}return t}function vje(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};var s=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?s:o*100,restDateString:e.slice((n[1]||n[2]).length)}}function yje(e,t){if(t===null)return new Date(NaN);var r=e.match(hje);if(!r)return new Date(NaN);var n=!!r[4],s=Ky(r[1]),o=Ky(r[2])-1,i=Ky(r[3]),l=Ky(r[4]),c=Ky(r[5])-1;if(n)return Cje(t,l,c)?jje(t,l,c):new Date(NaN);var d=new Date(0);return!Nje(t,o,i)||!Sje(t,s)?new Date(NaN):(d.setUTCFullYear(t,o,Math.max(s,i)),d)}function Ky(e){return e?parseInt(e):1}function bje(e){var t=e.match(pje);if(!t)return NaN;var r=cE(t[1]),n=cE(t[2]),s=cE(t[3]);return Pje(r,n,s)?r*LY+n*FY+s*1e3:NaN}function cE(e){return e&&parseFloat(e.replace(",","."))||0}function wje(e){if(e==="Z")return 0;var t=e.match(gje);if(!t)return 0;var r=t[1]==="+"?-1:1,n=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return Aje(n,s)?r*(n*LY+s*FY):NaN}function jje(e,t,r){var n=new Date(0);n.setUTCFullYear(e,0,4);var s=n.getUTCDay()||7,o=(t-1)*7+r+1-s;return n.setUTCDate(n.getUTCDate()+o),n}var _je=[31,null,31,30,31,30,31,31,30,31,30,31];function HY(e){return e%400===0||e%4===0&&e%100!==0}function Nje(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(_je[t]||(HY(e)?29:28))}function Sje(e,t){return t>=1&&t<=(HY(e)?366:365)}function Cje(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function Pje(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function Aje(e,t){return t>=0&&t<=59}function dE(e,t){Pa(2,arguments);var r=os(e),n=fi(t),s=r.getFullYear(),o=r.getDate(),i=new Date(0);i.setFullYear(s,n,15),i.setHours(0,0,0,0);var l=Q1e(i);return r.setMonth(n,Math.min(o,l)),r}function P2(e,t){Pa(2,arguments);var r=os(e),n=fi(t);return r.setHours(n),r}function A2(e,t){Pa(2,arguments);var r=os(e),n=fi(t);return r.setMinutes(n),r}function v8(e,t){Pa(2,arguments);var r=os(e),n=fi(t);return isNaN(r.getTime())?new Date(NaN):(r.setFullYear(n),r)}const GY=p.createContext(),Eje=({children:e})=>{const{userProfile:t}=fo(),r=Mi(),[n,s]=p.useState([]),[o,i]=p.useState(!1),[l,c]=p.useState(!1),[d,u]=p.useState(!1),f=p.useRef(r.pathname),h=p.useRef(!1),m=p.useRef(null),[x,g]=p.useState(null),v=p.useRef([]),y=p.useRef(null),b=p.useRef(!1);p.useEffect(()=>{v.current=n},[n]);const w=p.useCallback(()=>`alerts:persisted:isis:${t?.codigo_empresa||"na"}`,[t?.codigo_empresa]),j=p.useCallback(()=>{try{const O=localStorage.getItem(w()),I=O?JSON.parse(O):[];return Array.isArray(I)?I.filter(T=>T&&T.tipo==="isis-event"&&T.id):[]}catch{return[]}},[w]),_=p.useCallback(O=>{try{localStorage.setItem(w(),JSON.stringify(O||[]))}catch{}},[w]),C=p.useCallback(O=>{if(!O)return;s(k=>Array.isArray(k)?k.filter($=>$?.id!==O):[]);const T=j().filter(k=>k?.id!==O);_(T)},[j,_]),A=p.useCallback(()=>document.querySelectorAll('[role="dialog"]').length>0,[]),S=p.useCallback(async()=>{if(t?.codigo_empresa)try{u(!0);const O=t.codigo_empresa,I=new Date,T=Po(I).toISOString(),k=M_(I).toISOString(),$=[],{data:q}=await Q.from("produtos").select("nome, estoque, estoque_minimo, status").eq("codigo_empresa",O).not("estoque_minimo","is",null),z=(q||[]).filter(ee=>{const ae=Number(ee.estoque||0),le=Number(ee.estoque_minimo||0);return ae<=le&&le>0});z.length>0&&$.push({tipo:"estoque",icone:"Package",cor:"danger",mensagem:`${z.length} produto${z.length>1?"s":""} com estoque baixo`,link:"/produtos"});const{data:F}=await Q.from("agendamento_participantes").select("id, agendamento_id").eq("codigo_empresa",O).eq("status_pagamento","Pendente");if(F&&F.length>0){const ee=[...new Set(F.map(te=>te.agendamento_id))],{data:ae}=await Q.from("agendamentos").select("id, inicio, status").in("id",ee).not("status","in","(canceled,absent)").order("inicio",{ascending:!0}),le=new Set((ae||[]).map(te=>te.id)),Te=F.filter(te=>le.has(te.agendamento_id));if(Te.length>0){const te=ae?.[0],ie=or(te?new Date(te.inicio):I,"yyyy-MM-dd");$.push({tipo:"pagamento",icone:"DollarSign",cor:"warning",mensagem:`${Te.length} pagamento${Te.length>1?"s":""} pendente${Te.length>1?"s":""} em agendamentos`,link:`/agenda?date=${ie}`})}}const V=new Date;V.setHours(V.getHours()-3);const{data:ue}=await Q.from("comandas").select("id, aberto_em, status").eq("codigo_empresa",O).eq("status","open").is("fechado_em",null).lte("aberto_em",V.toISOString());ue&&ue.length>0&&$.push({tipo:"comanda",icone:"Clock",cor:"warning",mensagem:`${ue.length} comanda${ue.length>1?"s":""} aberta${ue.length>1?"s":""} h mais de 3 horas`,link:"/vendas"});const _e=new Date;_e.setHours(_e.getHours()-12);const{data:U}=await Q.from("caixa_sessoes").select("id, aberto_em").eq("codigo_empresa",O).eq("status","open").lte("aberto_em",_e.toISOString()).limit(1);U&&U.length>0&&$.push({tipo:"caixa",icone:"ShoppingCart",cor:"danger",mensagem:"Caixa aberto h mais de 12 horas",link:"/vendas"});const{data:L}=await Q.from("mesas").select("id, nome, numero").eq("codigo_empresa",O).eq("status","awaiting-payment");if(L&&L.length>0){const ee=L.map(le=>le.id),{data:ae}=await Q.from("comandas").select("id, mesa_id").eq("codigo_empresa",O).in("mesa_id",ee).eq("status","open");if(ae&&ae.length>0){const le=ae.map(xt=>xt.id),{data:Te}=await Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",le),te={};(Te||[]).forEach(xt=>{const vt=(Number(xt.quantidade)||0)*(Number(xt.preco_unitario)||0),dt=Number(xt.desconto)||0,St=vt-dt;te[xt.comanda_id]=(te[xt.comanda_id]||0)+St});const ie=Object.values(te).filter(xt=>xt>100).length;ie>0&&$.push({tipo:"mesa",icone:"Store",cor:"info",mensagem:`${ie} mesa${ie>1?"s":""} com saldo alto aguardando pagamento`,link:"/vendas"})}}const{data:G}=await Q.from("clientes").select("id, nome, aniversario").eq("codigo_empresa",O).eq("status","Ativo").not("aniversario","is",null),de=or(I,"MM-dd"),X=(G||[]).filter(ee=>ee.aniversario?or(new Date(ee.aniversario),"MM-dd")===de:!1);X.length>0&&$.push({tipo:"aniversario",icone:"Users",cor:"success",mensagem:` ${X.length} aniversariante${X.length>1?"s":""} hoje!`,link:"/clientes"});const W=[];for(let ee=1;ee<=7;ee++){const ae=new Date(I);ae.setDate(ae.getDate()+ee),W.push(or(ae,"MM-dd"))}const Y=(G||[]).filter(ee=>{if(!ee.aniversario)return!1;const ae=or(new Date(ee.aniversario),"MM-dd");return W.includes(ae)});Y.length>0&&$.push({tipo:"aniversario-semana",icone:"CalendarPlus",cor:"purple",mensagem:` ${Y.length} aniversariante${Y.length>1?"s":""} esta semana`,link:"/clientes"});const me=j();s([...me,...$]);try{if(!h.current&&!b.current&&$.length>0&&typeof document<"u"&&document.visibilityState==="visible"&&!A()){const ae=(()=>{try{return typeof window<"u"&&window.innerWidth<768}catch{return!1}})(),le=(()=>{try{return!!document.querySelector('button[aria-label="Fechar menu lateral"]')}catch{return!1}})();if(ae&&le){try{y.current&&clearInterval(y.current)}catch{}y.current=setInterval(()=>{try{if(h.current){clearInterval(y.current),y.current=null;return}if(!!!document.querySelector('button[aria-label="Fechar menu lateral"]')&&!A()){c(!0),h.current=!0;try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{c(!1)},3500),clearInterval(y.current),y.current=null}}catch{}},250)}else setTimeout(()=>{if(!h.current){if(A()){h.current=!0;return}c(!0),h.current=!0;try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{c(!1)},3500)}},350)}}catch{}}catch(O){console.error("[AlertsContext] Erro ao carregar alertas:",O)}finally{u(!1)}},[t?.codigo_empresa]);p.useEffect(()=>{if(o){h.current=!0,b.current=!0,c(!1);try{y.current&&(clearInterval(y.current),y.current=null)}catch{}}else c(!1)},[o]),p.useEffect(()=>()=>{try{m.current&&clearTimeout(m.current)}catch{}try{y.current&&clearInterval(y.current)}catch{}},[]);const P=p.useCallback(()=>{try{m.current&&clearTimeout(m.current)}catch{}c(!1),g(null)},[]),M=p.useCallback(()=>{s(O=>Array.isArray(O)?O.filter(I=>I?.tipo!=="isis-event"):[]);try{_([])}catch{}try{P()}catch{}},[_,P]);return p.useEffect(()=>{if(!t?.codigo_empresa)return;const O=t.codigo_empresa,I=Q.channel(`isis-events:${O}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamentos",filter:`codigo_empresa=eq.${O}`},T=>{try{const{eventType:k,new:$,old:q}=T||{};if(!($||q))return;const F=$?.created_by_isis===!0||q?.created_by_isis===!0,V=$?.canceled_by==="isis"||q?.canceled_by==="isis";if(!F&&!V||A())return;const ue=$?.inicio||q?.inicio;let _e="";try{if(ue){const de=new Date(ue);_e=`/agenda?date=${`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,"0")}-${String(de.getDate()).padStart(2,"0")}`}`}}catch{}let U="";if(k==="INSERT"){if(!F)return;U="sis criou um agendamento"}else if(k==="UPDATE")if(q?.status!=="canceled"&&$?.status==="canceled"&&$?.canceled_by==="isis")U="sis cancelou um agendamento";else return;else if(k==="DELETE")if(q?.canceled_by==="isis")U="sis cancelou um agendamento";else return;else return;const L=`isis-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,G={id:L,tipo:"isis-event",icone:"AlertTriangle",cor:"warning",mensagem:U,link:"/isis/analytics",createdAt:new Date().toISOString()};s(de=>[G,...Array.isArray(de)?de:[]]);try{const de=j(),X=[G,...de.filter(W=>W.id!==L)];_(X)}catch{}g({id:L,message:U,link:_e}),c(!0);try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{P()},5e3);try{s(de=>Array.isArray(de)?de:[])}catch{}}catch(k){console.warn("[AlertsContext] erro ao processar evento isis:",k)}}).subscribe();return()=>{try{Q.removeChannel(I)}catch{}}},[t?.codigo_empresa,A,P]),p.useEffect(()=>{if(t?.codigo_empresa){S();const O=setInterval(()=>{S()},5*60*1e3);return()=>clearInterval(O)}},[t?.codigo_empresa,S]),p.useEffect(()=>{if(!t?.codigo_empresa)return;const O=()=>{if(document.visibilityState==="visible"){if(A())return;S()}},I=()=>{A()||S()};return document.addEventListener("visibilitychange",O),window.addEventListener("focus",I),()=>{document.removeEventListener("visibilitychange",O),window.removeEventListener("focus",I)}},[t?.codigo_empresa,S,A]),p.useEffect(()=>{if(t?.codigo_empresa){if(f.current===r.pathname)return;if(f.current=r.pathname,A()){console.log("[AlertsContext] Mudana de rota detectada, mas h modais abertos - ignorando recarga");return}console.log("[AlertsContext] Mudana de rota detectada - recarregando alertas"),S()}},[r.pathname,t?.codigo_empresa,S,A]),a.jsx(GY.Provider,{value:{alerts:n,setAlerts:s,showModal:o,setShowModal:i,showBalloon:l,setShowBalloon:c,eventBalloon:x,setEventBalloon:g,closeBalloon:P,dismissAlert:C,clearIsisAlerts:M,loading:d,loadAlerts:S},children:e})},sj=()=>{const e=p.useContext(GY);if(!e)throw new Error("useAlerts must be used within AlertsProvider");return e};function kje({onToggleSidebar:e,sidebarVisible:t,sidebarPinned:r}){const{toast:n}=Xs(),{signOut:s,userProfile:o,company:i,user:l}=fo(),{alerts:c,setAlerts:d,showModal:u,setShowModal:f,showBalloon:h,setShowBalloon:m,eventBalloon:x,closeBalloon:g,dismissAlert:v}=sj(),y=Ol(),b=o?.nome||"Usurio",w=Ce.useMemo(()=>{const V=b.trim().split(/\s+/);return V.length>=2?`${V[0]} ${V[1]}`:b},[b]),j=o?.cargo||o?.papel||"";let _="";try{const V=localStorage.getItem("auth:company");if(V){const ue=JSON.parse(V);_=ue?.nome_fantasia||ue?.razao_social||ue?.nome||ue?.codigoEmpresa||"";var C=ue?.logo_url||""}}catch{}const A=i?.nome_fantasia||i?.razao_social||i?.nome||i?.codigoEmpresa||_||"Empresa no vinculada",S=i?.logo_url||(typeof C<"u"?C:""),P=Ce.useMemo(()=>i?.logo_url?`${i.logo_url}?v=${Date.now()}`:S||"",[i?.logo_url]),M=Ce.useMemo(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}},[]),O=V=>({Package:ju,DollarSign:Vi,CalendarCheck:zC,Clock:xu,ShoppingCart:X1,Store:eD,Users:vc,CalendarPlus:J4,AlertTriangle:Jf,Info:yG})[V]||Jf,I=V=>({danger:"text-danger",warning:"text-warning",info:"text-info",success:"text-success",purple:"text-purple"})[V]||"text-warning",T=({alert:V,onClick:ue})=>{const _e=O(V.icone),U=I(V.cor),L=V?.tipo==="isis-event";return a.jsxs("li",{className:"flex items-center gap-2 p-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group",onClick:ue,children:[L?a.jsx("span",{className:"rounded-full overflow-hidden bg-background w-5 h-5 flex items-center justify-center flex-shrink-0 shadow-[0_0_0_2px_rgba(0,0,0,0.25)]",children:a.jsx(cl,{size:"xs",className:"w-5 h-5"})}):a.jsx(_e,{className:`w-4 h-4 flex-shrink-0 ${U}`}),a.jsx("span",{className:"text-text-secondary group-hover:text-text-primary transition-colors flex-1",children:V.mensagem}),V.link&&a.jsx(K4,{className:"w-3 h-3 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity"})]})},k=async()=>{console.log("[Header] Logout button clicked",{at:new Date().toISOString(),userBefore:!!l});const{error:V}=await s();console.log("[Header] Logout completed",{error:V,userAfter:!!l}),n(V?{title:"Erro ao sair",description:"Ocorreu um erro ao fazer logout. Tente novamente.",variant:"destructive"}:{title:"Logout realizado",description:"Voc foi desconectado com sucesso.",variant:"default"})};new Date().toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"});const $=Mi(),q=Ce.useMemo(()=>{try{const V=String($?.pathname||"");if(V==="/"||V.startsWith("/dashboard"))return"";const _e=[{key:"/agenda",label:"Agenda"},{key:"/isis",label:"sis"},{key:"/clientes",label:"Clientes & Fornecedores"},{key:"/produtos",label:"Produtos"},{key:"/vendas",label:"Vendas"},{key:"/financeiro",label:"Financeiro"},{key:"/balcao",label:"Balco"},{key:"/cadastros",label:"Cadastros"},{key:"/quadras",label:"Quadras"},{key:"/equipe",label:"Equipe"},{key:"/finalizadoras",label:"Finalizadoras"},{key:"/empresas",label:"Empresas"},{key:"/configuracoes",label:"Configuraes"},{key:"/login",label:"Login"}].find(U=>V.startsWith(U.key));if(_e)return _e.label;if(typeof document<"u"){const U=String(document.title||"");return(U.includes(" - ")?U.split(" - ")[0]:U)||""}}catch{}return""},[$?.pathname]),z=Ce.useMemo(()=>String($?.pathname||"").startsWith("/isis"),[$?.pathname]),F=Ce.useMemo(()=>{const V=i?.nome_fantasia||i?.nome||i?.razao_social||i?.codigoEmpresa||_||"";return String(V).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"").trim()},[i?.nome_fantasia,i?.nome,i?.razao_social,i?.codigoEmpresa,_]);return Ce.useMemo(()=>F?`https://${F}.f7arena.com`:"",[F]),a.jsxs(Mr.header,{animate:{opacity:1,y:0},transition:{duration:.6,ease:[.22,1,.36,1]},className:"relative bg-surface/80 backdrop-blur-sm text-text-primary h-14 md:h-[72px] flex-shrink-0 flex items-center justify-between px-3 md:px-8 border-b border-border shadow-[0_1px_0_RGBA(255,255,255,0.04)]",children:[a.jsxs("div",{className:"flex items-center gap-2 md:gap-4 min-w-0 flex-1",children:[a.jsx(Z,{variant:"ghost",size:"icon",onClick:e,"aria-label":t?"Ocultar barra lateral":"Mostrar barra lateral",className:"h-10 w-10 md:h-12 md:w-12 hover:bg-surface-2/60 transition-colors",children:a.jsx(Yue,{className:`w-6 h-6 md:w-7 md:h-7 transition-colors ${t?"text-brand":"text-text-primary"}`})}),a.jsxs("div",{className:"group mx-auto md:mx-0 pl-2 pr-3 md:pl-3 md:pr-5 py-1 md:py-1.5 border border-white/10 bg-gradient-to-b from-surface-2/60 to-surface/60 text-text-primary flex items-center gap-2 md:gap-4 shadow-sm hover:border-white/20 transition-colors overflow-hidden max-w-[60vw] md:max-w-[30vw] lg:max-w-[24vw]",title:A,children:[a.jsx("div",{className:"relative w-9 h-9 md:w-11 md:h-11 shrink-0 overflow-hidden border border-white/10 bg-surface-2/60 grid place-items-center shadow-[0_0_0_3px_RGBA(0,0,0,0.2)]",children:P?a.jsx("img",{src:P,alt:"Logo",className:"w-full h-full object-cover"}):a.jsx(Iue,{className:"w-6 h-6 opacity-80"})}),a.jsx("span",{className:"tracking-tight truncate text-base leading-8 md:text-base md:leading-[44px] text-text-primary font-semibold flex-1 min-w-0 text-center md:text-left",children:A}),M&&a.jsx("span",{className:"ml-2 hidden md:inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-extrabold uppercase tracking-wider bg-red-600 text-white shadow animate-pulse",children:"Dev"})]})]}),z?a.jsx("div",{className:"pointer-events-none absolute z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:block",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)] w-8 h-8",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-full h-full",children:a.jsx(cl,{size:"xs",className:"w-8 h-8"})})}),a.jsx("h1",{className:"text-lg md:text-xl font-bold tracking-tight text-text-primary",children:"sis"})]})}):q?a.jsx("div",{className:"pointer-events-none absolute z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:block",children:a.jsx("h1",{className:"text-lg md:text-xl font-bold tracking-tight text-text-primary",children:q})}):null,a.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[!z&&a.jsxs(Z,{variant:"ghost",onClick:()=>y("/isis"),className:"hidden md:inline-flex items-center gap-2 px-2.5 py-1.5 rounded-full border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-all duration-200 hover:-translate-y-px hover:shadow-[0_4px_16px_rgba(0,0,0,0.25)]",children:[a.jsx("span",{className:"inline-flex items-center justify-center rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(cl,{size:"xs"})})}),a.jsx("span",{className:"text-sm font-semibold text-text-primary",children:"sis"})]}),a.jsxs(Qo,{open:u?!1:h,onOpenChange:m,children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"ghost",size:"icon",onClick:()=>{m(!1),f(!0)},className:"relative text-text-secondary hover:text-text-primary transition-colors duration-200",children:[a.jsx(Fb,{className:"h-5 w-5"}),c.length>0&&a.jsx("span",{className:"absolute -top-1 -right-1 bg-danger text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:c.length})]})}),a.jsxs(Ho,{align:"end",sideOffset:8,className:"w-80 p-0 overflow-hidden bg-background border-white/10",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Fb,{className:"h-4 w-4 text-brand"}),a.jsx("span",{className:"text-sm font-semibold",children:x?"Notificao":"Alertas"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[!x&&a.jsx(Z,{size:"sm",variant:"ghost",onClick:()=>{m(!1),f(!0)},children:"Ver todos"}),a.jsx(Z,{size:"icon",variant:"ghost",onClick:()=>{x?g():m(!1)},"aria-label":"Fechar",children:a.jsx(Yc,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"p-2",children:x?a.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md bg-surface-2",children:[a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(cl,{size:"xs"})}),a.jsx("span",{className:"text-sm text-text-secondary flex-1",children:x.message}),a.jsx(Z,{size:"sm",variant:"ghost",className:"shrink-0",onClick:()=>{y("/isis/analytics");try{x?.id&&v(x.id)}catch{}g()},children:"Ver"})]}):c.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-6",children:"Nenhum alerta no momento"}):a.jsx("ul",{className:"space-y-1 text-sm",children:c.slice(0,3).map((V,ue)=>a.jsx(T,{alert:V,onClick:()=>{if(V.link&&y(V.link),V?.tipo==="isis-event"&&V?.id)try{v(V.id)}catch{}m(!1)}},ue))})})]})]}),a.jsx(Z,{variant:"ghost",size:"icon",onClick:k,className:"text-text-secondary hover:text-brand hover:bg-brand/10 transition-colors duration-200 shrink-0",children:a.jsx(Xue,{className:"h-5 w-5"})}),a.jsx("div",{className:"hidden md:block w-px h-8 bg-border mx-1 md:mx-2"}),a.jsxs("div",{className:"hidden md:flex group pl-2 pr-3 md:pl-4 md:pr-4 py-1.5 rounded-full border border-white/10 bg-gradient-to-b from-surface-2/60 to-surface/60 text-text-primary items-center gap-2 md:gap-3 shadow-sm hover:border-white/20 transition-colors",title:`${w}  ${j}`,children:[a.jsx("span",{className:"text-xs md:text-sm font-semibold truncate max-w-[120px] md:max-w-[180px]",children:w}),a.jsx("span",{className:"text-[10px] md:text-[11px] px-1.5 md:px-2 py-0.5 rounded-full bg-brand/15 text-brand font-medium tracking-wide",children:j})]})]}),a.jsx(zn,{open:u,onOpenChange:f,children:a.jsxs(qn,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(Bn,{children:a.jsxs($n,{className:"flex items-center gap-2",children:[a.jsx(Fb,{className:"h-5 w-5 text-brand"}),"Todos os Alertas (",c.length,")"]})}),a.jsx("div",{className:"mt-4",children:c.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-8",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:c.map((V,ue)=>a.jsx(T,{alert:V,onClick:()=>{if(V.link&&(y(V.link),f(!1)),V?.tipo==="isis-event"&&V?.id)try{v(V.id)}catch{}}},ue))})})]})})]})}const At=Ce.forwardRef(({className:e,type:t,...r},n)=>a.jsx("input",{type:t,className:Er("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...r}));At.displayName="Input";var Ije="Label",KY=p.forwardRef((e,t)=>a.jsx(Xa.label,{...e,ref:t,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));KY.displayName=Ije;var XY=KY;const Oje=ND("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),lt=Ce.forwardRef(({className:e,...t},r)=>a.jsx(XY,{ref:r,className:Er(Oje(),e),...t}));lt.displayName=XY.displayName;const Tje=e=>{const t={"Invalid login credentials":"Email ou senha incorretos","Email not confirmed":"Email no confirmado","User not found":"Usurio no encontrado","Invalid email":"Email invlido","Password should be at least 6 characters":"A senha deve ter pelo menos 6 caracteres","Unable to validate email address: invalid format":"Formato de email invlido","Email rate limit exceeded":"Muitas tentativas. Aguarde alguns minutos","Network request failed":"Erro de conexo. Verifique sua internet","Failed to fetch":"Erro de conexo. Verifique sua internet"};if(t[e])return t[e];for(const[r,n]of Object.entries(t))if(e.includes(r))return n;return"Erro ao fazer login. Verifique suas credenciais e tente novamente."},Dje=()=>{const[e,t]=p.useState(!1),[r,n]=p.useState(!1),[s,o]=p.useState(""),[i,l]=p.useState({email:"",password:""}),{signIn:c,user:d,authReady:u}=fo(),{toast:f}=Xs();p.useEffect(()=>{if(u&&d)try{const v=sessionStorage.getItem("auth:returnUrl");sessionStorage.removeItem("auth:returnUrl");const y=v||"/";console.log("[LoginPage] Redirecionando para:",y),window.location.replace(y)}catch{}},[u,!!d]);const h=v=>{l({...i,[v.target.name]:v.target.value}),s&&o("")},m=async v=>{v.preventDefault(),n(!0),o("");try{const y=await c(i.email,i.password);if(y.error)throw y.error;f({title:"Login realizado!",description:"Bem-vindo de volta!",variant:"default"});try{const b=sessionStorage.getItem("auth:returnUrl");sessionStorage.removeItem("auth:returnUrl");const w=b||"/";console.log("[LoginPage] Redirecionando aps login para:",w),window.location.replace(w)}catch{}}catch(y){const b=y.message||"Ocorreu um erro. Tente novamente.",w=Tje(b);o(w),f({title:"Erro",description:w,variant:"destructive"})}finally{n(!1)}},x={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}},g=(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}})();return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 sm:p-6 relative",children:[g&&a.jsx("div",{className:"pointer-events-none select-none absolute top-4 right-4 z-20",children:a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-extrabold uppercase tracking-wider bg-red-600 text-white shadow animate-pulse",children:"Dev"})}),a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.02] mix-blend-overlay"}),a.jsxs(Mr.div,{variants:x,initial:"hidden",animate:"visible",className:"relative z-10 w-full max-w-md pb-20 sm:pb-0",children:[a.jsxs("div",{className:"fx-card",children:[a.jsx("div",{className:"text-center mb-6",children:a.jsxs("div",{className:"flex items-center justify-center mb-4",children:[a.jsx("div",{className:"w-16 h-16 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(Nd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-5xl font-extrabold",children:[a.jsx("span",{style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{style:{color:"#FFAA33"},children:"7"})]}),a.jsx("p",{className:"text-2xl font-semibold",style:{color:"#B0B0B0"},children:"Arena"})]})]})}),a.jsxs("form",{onSubmit:m,className:"space-y-5 sm:space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs(lt,{htmlFor:"email",className:"text-text-primary flex items-center gap-2 text-sm sm:text-base",children:[a.jsx(f0,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Email"]}),a.jsx(At,{id:"email",name:"email",type:"email",placeholder:"seu@email.com",value:i.email,onChange:h,required:!0,className:"placeholder:text-[#B0B0B0] h-12 sm:h-10 text-base sm:text-sm"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(lt,{htmlFor:"password",className:"text-text-primary flex items-center gap-2 text-sm sm:text-base",children:[a.jsx(u0,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Senha"]}),a.jsxs("div",{className:"relative",children:[a.jsx(At,{id:"password",name:"password",type:e?"text":"password",placeholder:"Sua senha",value:i.password,onChange:h,required:!0,className:"pr-10 placeholder:text-[#B0B0B0] h-12 sm:h-10 text-base sm:text-sm"}),a.jsx("button",{type:"button",onClick:()=>t(!e),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors",children:e?a.jsx(Og,{className:"w-5 h-5 sm:w-4 sm:h-4"}):a.jsx(Jg,{className:"w-5 h-5 sm:w-4 sm:h-4"})})]})]}),s&&a.jsx(Mr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-lg bg-destructive/10 border border-destructive/30 text-destructive text-sm",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:""}),a.jsx("span",{className:"flex-1",children:s})]})}),a.jsx(Z,{type:"submit",className:"w-full h-12 sm:h-10 text-base sm:text-sm",disabled:r,children:r?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin"}),"Entrando..."]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Kue,{className:"w-4 h-4"}),"Entrar"]})})]})]}),a.jsx("p",{className:"mt-4 text-center text-xs text-text-muted opacity-70",children:" 2026 Fluxo7 Arena  Todos os direitos reservados."})]})]})})},y8=({children:e})=>{const{user:t,authReady:r}=fo(),n=Mi();return p.useEffect(()=>{if(r&&!t&&n.pathname!=="/login")try{sessionStorage.setItem("auth:returnUrl",n.pathname+n.search),console.log("[ProtectedRoute] Salvando rota de retorno:",n.pathname+n.search)}catch(s){console.warn("[ProtectedRoute] Erro ao salvar rota de retorno:",s)}},[r,t,n.pathname,n.search]),r?t?e:a.jsx(Dje,{}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 border-4 border-brand border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-text-primary font-medium",children:"Carregando..."})]})})},Mje=p.createContext(),Rje=({children:e})=>{const[t,r]=p.useState({payment:{open:!1,data:null},editParticipant:{open:!1,data:null}}),[n,s]=p.useState(new Set),o=p.useCallback((f,h=null)=>{console.log(" [MODALS] Abrindo modal:",f,h),r(m=>({...m,[f]:{open:!0,data:h}}))},[]),i=p.useCallback(f=>{if(n.has(f)){console.log(` [ModalsContext] Modal "${f}" est protegido, ignorando fechamento`);return}r(h=>({...h,[f]:{open:!1,data:{}}}))},[n]),l=p.useCallback(f=>t[f]?.open||!1,[t]),c=p.useCallback(f=>t[f]?.data||{},[t]),d=p.useCallback(f=>{console.log(` [ModalsContext] Protegendo modal "${f}"`),s(h=>new Set([...h,f]))},[]),u=p.useCallback(f=>{console.log(` [ModalsContext] Desprotegendo modal "${f}"`),s(h=>{const m=new Set(h);return m.delete(f),m})},[]);return a.jsx(Mje.Provider,{value:{openModal:o,closeModal:i,isModalOpen:l,getModalData:c,protectModal:d,unprotectModal:u},children:e})},YY=p.createContext(),qN=()=>{const e=p.useContext(YY);if(!e)throw new Error("useAgenda must be used within AgendaProvider");return e},Fje=({children:e})=>{const[t,r]=p.useState(!1),[n,s]=p.useState(!1),[o,i]=p.useState(!1),[l,c]=p.useState({participantId:null,participantName:""}),[d,u]=p.useState(null),[f,h]=p.useState([]),[m,x]=p.useState(""),[g,v]=p.useState([]),[y,b]=p.useState(null),[w,j]=p.useState([]),_=p.useRef({isProtected:!1,protectedUntil:0}),C=p.useRef(Date.now()),A=p.useRef(null),S=Mi(),P=p.useCallback((q=2e3)=>{const z=Date.now()+q;if(z>_.current.protectedUntil)_.current.isProtected=!0,_.current.protectedUntil=z;else return;setTimeout(()=>{Date.now()>=_.current.protectedUntil&&(_.current.isProtected=!1)},q)},[]),M=p.useCallback(()=>{_.current.isProtected=!1,_.current.protectedUntil=0},[]),O=p.useCallback(()=>{r(!0)},[]),I=p.useCallback((q={})=>{const z=q===!0||q&&q.force===!0,F=Date.now();if(z)return r(!1),!0;if(_.current.isProtected&&F<_.current.protectedUntil){const ue=_.current.protectedUntil-F;try{localStorage.getItem("debug:agenda")==="1"&&console.log(` [PaymentModal] Fechamento bloqueado por proteo (${ue}ms restantes)`)}catch{}return!1}if(Date.now()-C.current<500){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Fechamento bloqueado por mudana de visibilidade recente")}catch{}return!1}try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Fechando modal (no protegido)")}catch{}return r(!1),!0},[]),T=p.useCallback((q,z)=>{c({participantId:q,participantName:z}),s(!0),P(3e3)},[P]),k=p.useCallback(()=>{s(!1),c({participantId:null,participantName:""})},[]);p.useEffect(()=>{if(!(S?.pathname||"").startsWith("/agenda"))return()=>{};const F=()=>{const ue=Date.now(),_e=document.hidden;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] visibilitychange:",{hidden:_e,timestamp:new Date().toISOString(),isPaymentModalOpen:t})}catch{}if(C.current=ue,!_e&&t){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] Aba restaurada com modal aberto - protegendo por 3s")}catch{}const U=Date.now()+3e3;_.current.isProtected=!0,_.current.protectedUntil=U}},V=()=>{const ue=Date.now();try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] window focus:",{timestamp:new Date().toISOString(),isPaymentModalOpen:t})}catch{}if(C.current=ue,t){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] Janela ganhou foco com modal aberto - protegendo por 3s")}catch{}const _e=Date.now()+3e3;_.current.isProtected=!0,_.current.protectedUntil=_e}};return document.addEventListener("visibilitychange",F),window.addEventListener("focus",V),()=>{document.removeEventListener("visibilitychange",F),window.removeEventListener("focus",V)}},[t,S?.pathname]);const $={isPaymentModalOpen:t,isEditParticipantModalOpen:n,isAddBookingModalOpen:o,openPaymentModal:O,closePaymentModal:I,openEditParticipantModal:T,closeEditParticipantModal:k,setIsAddBookingModalOpen:i,editParticipantData:l,editingBooking:d,setEditingBooking:u,participantsForm:f,setParticipantsForm:h,paymentTotal:m,setPaymentTotal:x,payMethods:g,setPayMethods:v,bookingForm:y,setBookingForm:b,localCustomers:w,setLocalCustomers:j,protectPaymentModal:P,unprotectPaymentModal:M,onParticipantReplacedRef:A,get lastVisibilityChangeTime(){return C.current},get isModalProtected(){const q=Date.now();return _.current.isProtected&&q<_.current.protectedUntil}};return a.jsx(YY.Provider,{value:$,children:e})},Lje="https://guildthlqkfubbqoybys.supabase.co",b8="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",$je=()=>({apikey:b8,Authorization:`Bearer ${b8}`,"Content-Type":"application/json","X-Client-Info":"fluxo7-isis-web"}),E2=async(e,{method:t="GET",body:r,headers:n}={})=>{const s=`${Lje}${e}`,o=await fetch(s,{method:t,headers:{...$je(),...n||{}},body:r?JSON.stringify(r):void 0}),i=await o.text().catch(()=>""),l=i&&JSON.parse(i)||null;return o.ok?{data:l,error:null}:{data:null,error:{status:o.status,message:l?.message||i||`HTTP ${o.status}`,details:l?.details??null,hint:l?.hint??null,code:l?.code??null}}};class Bje{constructor(t){this.table=t,this._select="*",this._filters=[],this._order=null}select(t){return this._select=t||"*",this}eq(t,r){return this._filters.push([t,"eq",r]),this}is(t,r){return this._filters.push([t,"is",r]),this}order(t,{ascending:r}={}){return this._order={column:t,ascending:r!==!1},this}async insert(t){return E2(`/rest/v1/${this.table}`,{method:"POST",body:t})}async upsert(t,{onConflict:r}={}){const n=new URLSearchParams;r&&n.set("on_conflict",r);const s=n.toString();return E2(`/rest/v1/${this.table}${s?`?${s}`:""}`,{method:"POST",body:t,headers:{Prefer:"resolution=merge-duplicates,return=minimal"}})}async update(t){const r=new URLSearchParams;r.set("select",this._select);for(const[n,s,o]of this._filters)s==="is"&&o===null?r.set(n,"is.null"):r.set(n,`${s}.${o}`);return this._order?.column&&r.set("order",`${this._order.column}.${this._order.ascending?"asc":"desc"}`),E2(`/rest/v1/${this.table}?${r.toString()}`,{method:"PATCH",body:t,headers:{Prefer:"return=minimal"}})}async then(t,r){const n=new URLSearchParams;n.set("select",this._select);for(const[o,i,l]of this._filters)i==="is"&&l===null?n.set(o,"is.null"):n.set(o,`${i}.${l}`);this._order?.column&&n.set("order",`${this._order.column}.${this._order.ascending?"asc":"desc"}`);const s=await E2(`/rest/v1/${this.table}?${n.toString()}`,{method:"GET"});return Promise.resolve(s).then(t,r)}}const NO={from(e){return new Bje(e)}},JY=p.createContext(),p5=()=>{const e=p.useContext(JY);if(!e)throw new Error("useIsis deve ser usado dentro de IsisProvider");return e},QY=({children:e})=>{const[t,r]=p.useState("greeting"),[n,s]=p.useState([]),o=p.useRef((()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const ae=[...Array(36)].map(()=>"x");return ae[8]=ae[13]=ae[18]=ae[23]="-",ae[14]="4",ae.map((le,Te)=>{if(le!=="x")return le;const te=Math.random()*16|0;return(Te===19?te&3|8:te).toString(16)}).join("")}catch{return"00000000-0000-4000-8000-000000000000"}})()),[i,l]=p.useState(o.current),[c,d]=p.useState({empresa:null,quadra:null,data:null,horario:null,modalidade:null,quantidade:null,nomes:[],contato:{nome:"",telefone:""}}),[u,f]=p.useState(!1),[h,m]=p.useState(!1),x=p.useRef(null),v=[["VITE_KEY_CHAT_ISIS",{}.VITE_KEY_CHAT_ISIS],["VITE-KEY-CHAT-ISIS",{VITE_JSONBIN_BIN_ID:"690605e5ae596e708f3c7bc5",VITE_JSONBIN_ISIS_BIN_ID:"6939b808ae596e708f90b843",VITE_JSONBIN_API_KEY:"$/XmOGvx8./SZzV3qMzQ5i.6FjBjS4toNbeaEFzX2D8QPUddyM6VR2",VITE_SUPABASE_URL:"https://dlfryxtyxqoacuunswuc.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY",VITE_SUPABASE_URL_ISIS:"https://guildthlqkfubbqoybys.supabase.co",VITE_SUPABASE_ANON_KEY_ISIS:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}["VITE-KEY-CHAT-ISIS"]],["KEY_CHAT_ISIS",{}.KEY_CHAT_ISIS],["KEY-CHAT-ISIS",{VITE_JSONBIN_BIN_ID:"690605e5ae596e708f3c7bc5",VITE_JSONBIN_ISIS_BIN_ID:"6939b808ae596e708f90b843",VITE_JSONBIN_API_KEY:"$/XmOGvx8./SZzV3qMzQ5i.6FjBjS4toNbeaEFzX2D8QPUddyM6VR2",VITE_SUPABASE_URL:"https://dlfryxtyxqoacuunswuc.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY",VITE_SUPABASE_URL_ISIS:"https://guildthlqkfubbqoybys.supabase.co",VITE_SUPABASE_ANON_KEY_ISIS:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}["KEY-CHAT-ISIS"]]].find(([ae,le])=>!!le),y=v?.[1],b=v?.[0]||"none",w={}.VITE_JSONBIN_COLLECTION_ID||null,j="6939b808ae596e708f90b843",_="https://api.jsonbin.io/v3/b",C={}.VITE_ISIS_EDGE_SYNC==="1",[A,S]=p.useState(C?j:null);if(C&&typeof window<"u")try{console.info("[Isis][JSONBin] keySource=%s binId=%s",b,j||window.localStorage.getItem("ISIS_JSONBIN_BIN_ID")||"none")}catch{}const P=p.useCallback(async ae=>{if(!C)return{ok:!1,data:null};if(!y){try{console.debug("[Isis][Edge] skipped (no JSONBIN key) mode=%s",ae?.mode)}catch{}return{ok:!1,data:null}}try{const{data:le,error:Te}=await Q.functions.invoke("isis-chat",{body:ae});if(Te){try{console.debug("[Isis][Edge] %s error=%o",ae?.mode,Te)}catch{}return{ok:!1,data:null}}try{console.debug("[Isis][Edge] %s ok resp=%o",ae?.mode,le)}catch{}return{ok:!0,data:le}}catch(le){try{console.debug("[Isis][Edge] invoke exception:",le)}catch{}return{ok:!1,data:null}}},[y,C]),M=p.useCallback(async ae=>{if(!y)return null;const le={"X-Master-Key":y,"X-Access-Key":y,"Content-Type":"application/json"};w&&(le["X-Collection-Id"]=w);const Te=await fetch(`${_}`,{method:"POST",headers:le,body:JSON.stringify(ae||{projects:[{name:"F7 Arena"}],chat_sessions:[]})});if(!Te.ok)return null;const te=await Te.json().catch(()=>null),ie=te?.metadata?.id||te?.id||null;if(ie){S(ie);try{window?.localStorage?.setItem("ISIS_JSONBIN_BIN_ID",ie)}catch{}}return ie},[y]),O=p.useCallback(async()=>{if(!y||!A)return null;try{console.debug("[Isis][JSONBin] loadBin: GET %s/%s",_,A)}catch{}const ae={"X-Master-Key":y,"X-Access-Key":y,"X-Bin-Meta":"false","Content-Type":"application/json"};w&&(ae["X-Collection-Id"]=w);const le=await fetch(`${_}/${A}`,{method:"GET",headers:ae});try{console.debug("[Isis][JSONBin] loadBin: status=%s",le?.status)}catch{}if(le.status===401||le.status===404){try{console.error("[Isis][JSONBin] GET unauthorized or not found. keySource=%s binId=%s status=%s",b,A,le.status)}catch{}return await M()?{projects:[{name:"F7 Arena"}],chat_sessions:[]}:null}if(!le.ok)return null;try{return await le.json()}catch{return null}},[y,A,M]),I=p.useCallback(async ae=>{if(!y||!A&&!await M(ae))return!1;const le=A||(typeof window<"u"?window.localStorage.getItem("ISIS_JSONBIN_BIN_ID"):null);try{console.debug("[Isis][JSONBin] saveBin: PUT %s/%s",_,le)}catch{}const Te={"X-Master-Key":y,"X-Access-Key":y,"Content-Type":"application/json"};w&&(Te["X-Collection-Id"]=w);const te=await fetch(`${_}/${le}`,{method:"PUT",headers:Te,body:JSON.stringify(ae)});try{console.debug("[Isis][JSONBin] saveBin: status=%s",te?.status)}catch{}if(te.status===401||te.status===404){try{console.error("[Isis][JSONBin] PUT unauthorized or not found. keySource=%s binId=%s status=%s",b,le,te.status)}catch{}return!!await M(ae)}return te.ok},[y,A,M]),T=ae=>!ae||typeof ae!="object"?{projects:[{name:"F7 Arena"}],chat_sessions:[]}:(Array.isArray(ae.chat_sessions)||(ae.chat_sessions=[]),ae),k=(ae,le)=>(Array.isArray(ae?.chat_sessions)?ae.chat_sessions:[]).findIndex(te=>(te?.project||"").toString()===(le.project||"").toString()&&(te?.company?.code||"").toString()===(le.companyCode||"").toString()&&(te?.client_code||"").toString()===(le.clientCode||"").toString()),$=p.useCallback(async()=>{if(i)return i;try{try{console.info("[Isis][Chat] ensureSession: start")}catch{}const ae=c?.empresa||null,le=ae?{code:ae.codigo_empresa||ae.codigoEmpresa,name:ae.nome_fantasia||ae.nome}:null,Te=c?.cliente||null;let te=await O();te=T(te),Array.isArray(te.projects)||(te.projects=[{name:"F7 Arena"}]);const ie={project:"F7 Arena",companyCode:le?.code||null,clientCode:Te?.id?String(Te.id):null};try{console.debug("[Isis][Chat] ensureSession: criteria=%o",ie)}catch{}if(ie.companyCode&&ie.clientCode){const xt=k(te,ie);try{console.debug("[Isis][Chat] ensureSession: existingIndex=%s",xt)}catch{}xt===-1&&te.chat_sessions.push({client_code:ie.clientCode,client_name:Te?.nome||Te?.name||"",company:le,project:ie.project,conversation:[]})}await I(te);try{console.info("[Isis][Chat] ensureSession: sessionId=%s",i)}catch{}return i}catch(ae){try{console.error("[Isis][Chat] ensureSession: failed",ae)}catch{}return null}},[i,c?.empresa,c?.cliente,O,I]),q=p.useCallback(async ae=>{if(ae)try{const le=c?.empresa||null,Te=le?{code:le.codigo_empresa||le.codigoEmpresa,name:le.nome_fantasia||le.nome}:null,te=c?.cliente||null;let ie=await O();if(!ie)return;ie=T(ie);const xt={project:"F7 Arena",companyCode:Te?.code||null,clientCode:te?.id?String(te.id):null};try{console.debug("[Isis][Chat] tryUpdateSessionMeta: criteria=%o",xt)}catch{}if(!xt.companyCode&&!xt.clientCode)return;let vt=k(ie,xt);if(vt===-1){ie.chat_sessions.push({client_code:xt.clientCode,client_name:te?.nome||te?.name||"",company:Te,project:xt.project,conversation:[]}),vt=ie.chat_sessions.length-1;try{console.debug("[Isis][Chat] tryUpdateSessionMeta: created index=%s",vt)}catch{}}else{te?.id&&!ie.chat_sessions[vt].client_code&&(ie.chat_sessions[vt].client_code=String(te.id)),te?.nome&&!ie.chat_sessions[vt].client_name&&(ie.chat_sessions[vt].client_name=te.nome),Te&&!ie.chat_sessions[vt].company&&(ie.chat_sessions[vt].company=Te);try{console.debug("[Isis][Chat] tryUpdateSessionMeta: updated index=%s",vt)}catch{}}await I(ie),Te?.name&&te?.id&&await P({mode:"set_meta",cod_cliente:te?.id?String(te.id):"",nome_cliente:te?.nome||te?.name||"",empresa:Te.name,software:"F7 Arena"})}catch{}},[c?.empresa,c?.cliente,O,I,P]),z=p.useCallback(async ae=>{try{try{console.info("[Isis][Chat] persistMessage: incoming=%o",{sessionId:i,from:ae.from,text:ae.text})}catch{}const le=c?.empresa||null,Te=le?{code:le.codigo_empresa||le.codigoEmpresa,name:le.nome_fantasia||le.nome}:null,te=c?.cliente||null;try{const ie=ae.from==="isis"?"assistant":"user",xt=Te?.name||le?.nome_fantasia||le?.nome||le?.razao_social||"Desconhecida";let vt=[];try{const{data:_t,error:gr}=await NO.from("isis").select("conversa").eq("id",i);if(gr)try{console.error("[Isis][Chat] supabase-isis select conversa error:",{sessionId:i,status:gr?.status,message:gr?.message,code:gr?.code})}catch{}!gr&&Array.isArray(_t)&&_t[0]?.conversa&&(vt=Array.isArray(_t[0].conversa)?_t[0].conversa:[])}catch{}const dt=[...Array.isArray(vt)?vt:[],{ts:new Date().toISOString(),from:ie,text:String(ae.text??"")}],St={id:String(i),cod_cliente:te?.id?String(te.id):null,nome_cliente:te?.nome||te?.name||null,empresa:xt,projeto:"fluxo7arena",conversa:dt,timestamp:new Date().toISOString()},{error:ft}=await NO.from("isis").upsert(St,{onConflict:"id"});if(ft)try{console.error("[Isis][Chat] supabase-isis upsert error:",{sessionId:i,status:ft?.status,message:ft?.message,code:ft?.code})}catch{}else try{console.info("[Isis][Chat] supabase-isis upsert ok:",{sessionId:i,conversaLen:Array.isArray(dt)?dt.length:null,hasCliente:!!te?.id,empresa:xt})}catch{}}catch(ie){try{console.error("[Isis][Chat] supabase-isis exception:",ie)}catch{}}if(C&&await P({mode:"append_message",cod_cliente:te?.id?String(te.id):"_unknown",nome_cliente:te?.nome||te?.name||"",empresa:Te?.name||"",software:"F7 Arena",session_id:i,message:{from:ae.from==="isis"?"assistant":"user",text:String(ae.text??"")}}),C)try{const ie=await $();if(!ie)return;const xt=ae.from==="isis"?"assistant":"user",vt={ts:new Date().toISOString(),from:xt,text:String(ae.text??"")};let dt=await O();if(!dt)return;dt=T(dt);const St=c?.empresa||null,ft=St?{code:St.codigo_empresa||St.codigoEmpresa,name:St.nome_fantasia||St.nome}:null,_t=c?.cliente||null,gr={project:"F7 Arena",companyCode:ft?.code||null,clientCode:_t?.id?String(_t.id):null};let be=k(dt,gr);be===-1?dt.chat_sessions.push({client_code:gr.clientCode,client_name:_t?.nome||_t?.name||"",company:ft,project:gr.project,conversation:[vt]}):(Array.isArray(dt.chat_sessions[be].conversation)||(dt.chat_sessions[be].conversation=[]),dt.chat_sessions[be].conversation.push(vt)),await I(dt),q(ie)}catch{}}catch{}},[$,q,O,I,P,c?.empresa,c?.cliente,i]),F=p.useCallback(ae=>{s(le=>[...le,{id:Date.now()+Math.random(),timestamp:new Date,...ae}]),setTimeout(()=>{x.current?.scrollIntoView({behavior:"smooth"})},100);try{z(ae)}catch{}},[z]),V=p.useCallback((ae,le=2e3,Te=null)=>{m(!0),setTimeout(()=>{m(!1);const te=ae&&typeof ae=="object"&&ae.text?ae:{text:ae};F({from:"isis",text:te.text,type:"text",color:te.color??Te,copyable:!!te.copyable,copyText:te.copyText})},le)},[F]),ue=p.useCallback((ae,le,Te=2e3)=>{m(!0),setTimeout(()=>{m(!1),s(te=>te.map(ie=>ie.type==="buttons"&&ie.buttons&&ie.buttons.length>0?{...ie,disabled:!0}:ie)),F({from:"isis",text:ae,type:"buttons",buttons:le,disabled:!1})},Te)},[F]),_e=p.useCallback(()=>{s(ae=>ae.map(le=>le.type==="buttons"&&le.buttons&&le.buttons.length>0&&!le.disabled?{...le,disabled:!0}:le))},[]),U=p.useCallback(ae=>{s(le=>le.filter(Te=>Te.id!==ae))},[]),L=p.useCallback(ae=>{s(le=>le.map(Te=>Te.id===ae&&Te.type==="buttons"?{...Te,buttonsHidden:!0,disabled:!0}:Te))},[]),G=p.useCallback(ae=>{F({from:"user",text:ae,type:"text"})},[F]),de=p.useCallback((ae,le)=>{if(d(Te=>({...Te,[ae]:le})),(ae==="cliente"||ae==="empresa")&&i)try{q(i)}catch{}},[]),X=p.useCallback((ae,le)=>{d(Te=>({...Te,contato:{...Te.contato,[ae]:le}}))},[]),W=p.useCallback(ae=>{r(ae)},[]),Y=p.useCallback(()=>{const ae=["greeting","quadra","data","horario","modalidade","quantidade","nomes","contato","review","confirmation","avaliacao"],le=ae.indexOf(t);le>0&&r(ae[le-1])},[t]),me=p.useCallback(()=>{r("greeting"),s([]),d({empresa:null,quadra:null,data:null,horario:null,modalidade:null,quantidade:null,nomes:[],contato:{nome:"",telefone:""}}),f(!1),m(!1),l(null)},[]),ee={currentStep:t,messages:n,selections:c,sessionId:i,isLoading:u,isTyping:h,chatEndRef:x,addMessage:F,addIsisMessage:V,addIsisMessageWithButtons:ue,addUserMessage:G,disableAllButtons:_e,removeMessageById:U,hideButtonsInMessage:L,updateSelection:de,updateContact:X,nextStep:W,previousStep:Y,resetConversation:me,setIsLoading:f,setIsTyping:m};return a.jsx(JY.Provider,{value:ee,children:e})};var qje=Array.isArray,ed=qje,zje=typeof Jl=="object"&&Jl&&Jl.Object===Object&&Jl,ZY=zje,Uje=ZY,Vje=typeof self=="object"&&self&&self.Object===Object&&self,Wje=Uje||Vje||Function("return this")(),rm=Wje,Hje=rm,Gje=Hje.Symbol,oj=Gje,w8=oj,eJ=Object.prototype,Kje=eJ.hasOwnProperty,Xje=eJ.toString,Xy=w8?w8.toStringTag:void 0;function Yje(e){var t=Kje.call(e,Xy),r=e[Xy];try{e[Xy]=void 0;var n=!0}catch{}var s=Xje.call(e);return n&&(t?e[Xy]=r:delete e[Xy]),s}var Jje=Yje,Qje=Object.prototype,Zje=Qje.toString;function e2e(e){return Zje.call(e)}var t2e=e2e,j8=oj,r2e=Jje,n2e=t2e,a2e="[object Null]",s2e="[object Undefined]",_8=j8?j8.toStringTag:void 0;function o2e(e){return e==null?e===void 0?s2e:a2e:_8&&_8 in Object(e)?r2e(e):n2e(e)}var Qm=o2e;function i2e(e){return e!=null&&typeof e=="object"}var Zm=i2e,l2e=Qm,c2e=Zm,d2e="[object Symbol]";function u2e(e){return typeof e=="symbol"||c2e(e)&&l2e(e)==d2e}var dy=u2e,f2e=ed,m2e=dy,h2e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p2e=/^\w*$/;function g2e(e,t){if(f2e(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||m2e(e)?!0:p2e.test(e)||!h2e.test(e)||t!=null&&e in Object(t)}var tM=g2e;function x2e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Tp=x2e;const uy=Ls(Tp);var v2e=Qm,y2e=Tp,b2e="[object AsyncFunction]",w2e="[object Function]",j2e="[object GeneratorFunction]",_2e="[object Proxy]";function N2e(e){if(!y2e(e))return!1;var t=v2e(e);return t==w2e||t==j2e||t==b2e||t==_2e}var rM=N2e;const Ka=Ls(rM);var S2e=rm,C2e=S2e["__core-js_shared__"],P2e=C2e,uE=P2e,N8=function(){var e=/[^.]+$/.exec(uE&&uE.keys&&uE.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function A2e(e){return!!N8&&N8 in e}var E2e=A2e,k2e=Function.prototype,I2e=k2e.toString;function O2e(e){if(e!=null){try{return I2e.call(e)}catch{}try{return e+""}catch{}}return""}var tJ=O2e,T2e=rM,D2e=E2e,M2e=Tp,R2e=tJ,F2e=/[\\^$.*+?()[\]{}|]/g,L2e=/^\[object .+?Constructor\]$/,$2e=Function.prototype,B2e=Object.prototype,q2e=$2e.toString,z2e=B2e.hasOwnProperty,U2e=RegExp("^"+q2e.call(z2e).replace(F2e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function V2e(e){if(!M2e(e)||D2e(e))return!1;var t=T2e(e)?U2e:L2e;return t.test(R2e(e))}var W2e=V2e;function H2e(e,t){return e?.[t]}var G2e=H2e,K2e=W2e,X2e=G2e;function Y2e(e,t){var r=X2e(e,t);return K2e(r)?r:void 0}var bx=Y2e,J2e=bx,Q2e=J2e(Object,"create"),g5=Q2e,S8=g5;function Z2e(){this.__data__=S8?S8(null):{},this.size=0}var e_e=Z2e;function t_e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var r_e=t_e,n_e=g5,a_e="__lodash_hash_undefined__",s_e=Object.prototype,o_e=s_e.hasOwnProperty;function i_e(e){var t=this.__data__;if(n_e){var r=t[e];return r===a_e?void 0:r}return o_e.call(t,e)?t[e]:void 0}var l_e=i_e,c_e=g5,d_e=Object.prototype,u_e=d_e.hasOwnProperty;function f_e(e){var t=this.__data__;return c_e?t[e]!==void 0:u_e.call(t,e)}var m_e=f_e,h_e=g5,p_e="__lodash_hash_undefined__";function g_e(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=h_e&&t===void 0?p_e:t,this}var x_e=g_e,v_e=e_e,y_e=r_e,b_e=l_e,w_e=m_e,j_e=x_e;function fy(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}fy.prototype.clear=v_e;fy.prototype.delete=y_e;fy.prototype.get=b_e;fy.prototype.has=w_e;fy.prototype.set=j_e;var __e=fy;function N_e(){this.__data__=[],this.size=0}var S_e=N_e;function C_e(e,t){return e===t||e!==e&&t!==t}var nM=C_e,P_e=nM;function A_e(e,t){for(var r=e.length;r--;)if(P_e(e[r][0],t))return r;return-1}var x5=A_e,E_e=x5,k_e=Array.prototype,I_e=k_e.splice;function O_e(e){var t=this.__data__,r=E_e(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():I_e.call(t,r,1),--this.size,!0}var T_e=O_e,D_e=x5;function M_e(e){var t=this.__data__,r=D_e(t,e);return r<0?void 0:t[r][1]}var R_e=M_e,F_e=x5;function L_e(e){return F_e(this.__data__,e)>-1}var $_e=L_e,B_e=x5;function q_e(e,t){var r=this.__data__,n=B_e(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var z_e=q_e,U_e=S_e,V_e=T_e,W_e=R_e,H_e=$_e,G_e=z_e;function my(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}my.prototype.clear=U_e;my.prototype.delete=V_e;my.prototype.get=W_e;my.prototype.has=H_e;my.prototype.set=G_e;var v5=my,K_e=bx,X_e=rm,Y_e=K_e(X_e,"Map"),aM=Y_e,C8=__e,J_e=v5,Q_e=aM;function Z_e(){this.size=0,this.__data__={hash:new C8,map:new(Q_e||J_e),string:new C8}}var eNe=Z_e;function tNe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var rNe=tNe,nNe=rNe;function aNe(e,t){var r=e.__data__;return nNe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var y5=aNe,sNe=y5;function oNe(e){var t=sNe(this,e).delete(e);return this.size-=t?1:0,t}var iNe=oNe,lNe=y5;function cNe(e){return lNe(this,e).get(e)}var dNe=cNe,uNe=y5;function fNe(e){return uNe(this,e).has(e)}var mNe=fNe,hNe=y5;function pNe(e,t){var r=hNe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var gNe=pNe,xNe=eNe,vNe=iNe,yNe=dNe,bNe=mNe,wNe=gNe;function hy(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}hy.prototype.clear=xNe;hy.prototype.delete=vNe;hy.prototype.get=yNe;hy.prototype.has=bNe;hy.prototype.set=wNe;var sM=hy,rJ=sM,jNe="Expected a function";function oM(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(jNe);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],o=r.cache;if(o.has(s))return o.get(s);var i=e.apply(this,n);return r.cache=o.set(s,i)||o,i};return r.cache=new(oM.Cache||rJ),r}oM.Cache=rJ;var nJ=oM;const _Ne=Ls(nJ);var NNe=nJ,SNe=500;function CNe(e){var t=NNe(e,function(n){return r.size===SNe&&r.clear(),n}),r=t.cache;return t}var PNe=CNe,ANe=PNe,ENe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kNe=/\\(\\)?/g,INe=ANe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ENe,function(r,n,s,o){t.push(s?o.replace(kNe,"$1"):n||r)}),t}),ONe=INe;function TNe(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var iM=TNe,P8=oj,DNe=iM,MNe=ed,RNe=dy,FNe=1/0,A8=P8?P8.prototype:void 0,E8=A8?A8.toString:void 0;function aJ(e){if(typeof e=="string")return e;if(MNe(e))return DNe(e,aJ)+"";if(RNe(e))return E8?E8.call(e):"";var t=e+"";return t=="0"&&1/e==-FNe?"-0":t}var LNe=aJ,$Ne=LNe;function BNe(e){return e==null?"":$Ne(e)}var sJ=BNe,qNe=ed,zNe=tM,UNe=ONe,VNe=sJ;function WNe(e,t){return qNe(e)?e:zNe(e,t)?[e]:UNe(VNe(e))}var oJ=WNe,HNe=dy,GNe=1/0;function KNe(e){if(typeof e=="string"||HNe(e))return e;var t=e+"";return t=="0"&&1/e==-GNe?"-0":t}var b5=KNe,XNe=oJ,YNe=b5;function JNe(e,t){t=XNe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[YNe(t[r++])];return r&&r==n?e:void 0}var lM=JNe,QNe=lM;function ZNe(e,t,r){var n=e==null?void 0:QNe(e,t);return n===void 0?r:n}var iJ=ZNe;const Od=Ls(iJ);function eSe(e){return e==null}var tSe=eSe;const ss=Ls(tSe);var rSe=Qm,nSe=ed,aSe=Zm,sSe="[object String]";function oSe(e){return typeof e=="string"||!nSe(e)&&aSe(e)&&rSe(e)==sSe}var iSe=oSe;const tx=Ls(iSe);var lJ={exports:{}},mo={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cM=Symbol.for("react.element"),dM=Symbol.for("react.portal"),w5=Symbol.for("react.fragment"),j5=Symbol.for("react.strict_mode"),_5=Symbol.for("react.profiler"),N5=Symbol.for("react.provider"),S5=Symbol.for("react.context"),lSe=Symbol.for("react.server_context"),C5=Symbol.for("react.forward_ref"),P5=Symbol.for("react.suspense"),A5=Symbol.for("react.suspense_list"),E5=Symbol.for("react.memo"),k5=Symbol.for("react.lazy"),cSe=Symbol.for("react.offscreen"),cJ;cJ=Symbol.for("react.module.reference");function Pu(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case cM:switch(e=e.type,e){case w5:case _5:case j5:case P5:case A5:return e;default:switch(e=e&&e.$$typeof,e){case lSe:case S5:case C5:case k5:case E5:case N5:return e;default:return t}}case dM:return t}}}mo.ContextConsumer=S5;mo.ContextProvider=N5;mo.Element=cM;mo.ForwardRef=C5;mo.Fragment=w5;mo.Lazy=k5;mo.Memo=E5;mo.Portal=dM;mo.Profiler=_5;mo.StrictMode=j5;mo.Suspense=P5;mo.SuspenseList=A5;mo.isAsyncMode=function(){return!1};mo.isConcurrentMode=function(){return!1};mo.isContextConsumer=function(e){return Pu(e)===S5};mo.isContextProvider=function(e){return Pu(e)===N5};mo.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===cM};mo.isForwardRef=function(e){return Pu(e)===C5};mo.isFragment=function(e){return Pu(e)===w5};mo.isLazy=function(e){return Pu(e)===k5};mo.isMemo=function(e){return Pu(e)===E5};mo.isPortal=function(e){return Pu(e)===dM};mo.isProfiler=function(e){return Pu(e)===_5};mo.isStrictMode=function(e){return Pu(e)===j5};mo.isSuspense=function(e){return Pu(e)===P5};mo.isSuspenseList=function(e){return Pu(e)===A5};mo.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===w5||e===_5||e===j5||e===P5||e===A5||e===cSe||typeof e=="object"&&e!==null&&(e.$$typeof===k5||e.$$typeof===E5||e.$$typeof===N5||e.$$typeof===S5||e.$$typeof===C5||e.$$typeof===cJ||e.getModuleId!==void 0)};mo.typeOf=Pu;lJ.exports=mo;var dSe=lJ.exports,uSe=Qm,fSe=Zm,mSe="[object Number]";function hSe(e){return typeof e=="number"||fSe(e)&&uSe(e)==mSe}var dJ=hSe;const pSe=Ls(dJ);var gSe=dJ;function xSe(e){return gSe(e)&&e!=+e}var vSe=xSe;const py=Ls(vSe);var yc=function(t){return t===0?0:t>0?1:-1},bg=function(t){return tx(t)&&t.indexOf("%")===t.length-1},Rn=function(t){return pSe(t)&&!py(t)},ySe=function(t){return ss(t)},Gi=function(t){return Rn(t)||tx(t)},bSe=0,wx=function(t){var r=++bSe;return"".concat(t||"").concat(r)},bc=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Rn(t)&&!tx(t))return n;var o;if(bg(t)){var i=t.indexOf("%");o=r*parseFloat(t.slice(0,i))/100}else o=+t;return py(o)&&(o=n),s&&o>r&&(o=r),o},Eh=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},wSe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},s=0;s<r;s++)if(!n[t[s]])n[t[s]]=!0;else return!0;return!1},Wi=function(t,r){return Rn(t)&&Rn(r)?function(n){return t+n*(r-t)}:function(){return r}};function zN(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Od(n,t))===r})}var jSe=function(t,r){return Rn(t)&&Rn(r)?t-r:tx(t)&&tx(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Xv(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function SO(e){"@babel/helpers - typeof";return SO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},SO(e)}var _Se=["viewBox","children"],NSe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],k8=["points","pathLength"],fE={svg:_Se,polygon:k8,polyline:k8},uM=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],UN=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(p.isValidElement(t)&&(n=t.props),!uy(n))return null;var s={};return Object.keys(n).forEach(function(o){uM.includes(o)&&(s[o]=r||function(i){return n[o](n,i)})}),s},SSe=function(t,r,n){return function(s){return t(r,n,s),null}},rx=function(t,r,n){if(!uy(t)||SO(t)!=="object")return null;var s=null;return Object.keys(t).forEach(function(o){var i=t[o];uM.includes(o)&&typeof i=="function"&&(s||(s={}),s[o]=SSe(i,r,n))}),s},CSe=["children"],PSe=["children"];function I8(e,t){if(e==null)return{};var r=ASe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ASe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function CO(e){"@babel/helpers - typeof";return CO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},CO(e)}var O8={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Om=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},T8=null,mE=null,fM=function e(t){if(t===T8&&Array.isArray(mE))return mE;var r=[];return p.Children.forEach(t,function(n){ss(n)||(dSe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),mE=r,T8=t,r};function Td(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(s){return Om(s)}):n=[Om(t)],fM(e).forEach(function(s){var o=Od(s,"type.displayName")||Od(s,"type.name");n.indexOf(o)!==-1&&r.push(s)}),r}function yd(e,t){var r=Td(e,t);return r&&r[0]}var D8=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,s=r.height;return!(!Rn(n)||n<=0||!Rn(s)||s<=0)},ESe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],kSe=function(t){return t&&t.type&&tx(t.type)&&ESe.indexOf(t.type)>=0},uJ=function(t){return t&&CO(t)==="object"&&"clipDot"in t},ISe=function(t,r,n,s){var o,i=(o=fE?.[s])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!Ka(t)&&(s&&i.includes(r)||NSe.includes(r))||n&&uM.includes(r)},ka=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var s=t;if(p.isValidElement(t)&&(s=t.props),!uy(s))return null;var o={};return Object.keys(s).forEach(function(i){var l;ISe((l=s)===null||l===void 0?void 0:l[i],i,r,n)&&(o[i]=s[i])}),o},PO=function e(t,r){if(t===r)return!0;var n=p.Children.count(t);if(n!==p.Children.count(r))return!1;if(n===0)return!0;if(n===1)return M8(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var s=0;s<n;s++){var o=t[s],i=r[s];if(Array.isArray(o)||Array.isArray(i)){if(!e(o,i))return!1}else if(!M8(o,i))return!1}return!0},M8=function(t,r){if(ss(t)&&ss(r))return!0;if(!ss(t)&&!ss(r)){var n=t.props||{},s=n.children,o=I8(n,CSe),i=r.props||{},l=i.children,c=I8(i,PSe);return s&&l?Xv(o,c)&&PO(s,l):!s&&!l?Xv(o,c):!1}return!1},R8=function(t,r){var n=[],s={};return fM(t).forEach(function(o,i){if(kSe(o))n.push(o);else if(o){var l=Om(o.type),c=r[l]||{},d=c.handler,u=c.once;if(d&&(!u||!s[l])){var f=d(o,l,i);n.push(f),s[l]=!0}}}),n},OSe=function(t){var r=t&&t.type;return r&&O8[r]?O8[r]:null},TSe=function(t,r){return fM(r).indexOf(t)},DSe=["children","width","height","viewBox","className","style","title","desc"];function AO(){return AO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AO.apply(this,arguments)}function MSe(e,t){if(e==null)return{};var r=RSe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function RSe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function EO(e){var t=e.children,r=e.width,n=e.height,s=e.viewBox,o=e.className,i=e.style,l=e.title,c=e.desc,d=MSe(e,DSe),u=s||{width:r,height:n,x:0,y:0},f=ls("recharts-surface",o);return Ce.createElement("svg",AO({},ka(d,!0,"svg"),{className:f,width:r,height:n,style:i,viewBox:"".concat(u.x," ").concat(u.y," ").concat(u.width," ").concat(u.height)}),Ce.createElement("title",null,l),Ce.createElement("desc",null,c),t)}var FSe=["children","className"];function kO(){return kO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kO.apply(this,arguments)}function LSe(e,t){if(e==null)return{};var r=$Se(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function $Se(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Cs=Ce.forwardRef(function(e,t){var r=e.children,n=e.className,s=LSe(e,FSe),o=ls("recharts-layer",n);return Ce.createElement("g",kO({className:o},ka(s,!0),{ref:t}),r)}),af=function(t,r){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o]};function BSe(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),r=r>s?s:r,r<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(s);++n<s;)o[n]=e[n+t];return o}var qSe=BSe,zSe=qSe;function USe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:zSe(e,t,r)}var VSe=USe,WSe="\\ud800-\\udfff",HSe="\\u0300-\\u036f",GSe="\\ufe20-\\ufe2f",KSe="\\u20d0-\\u20ff",XSe=HSe+GSe+KSe,YSe="\\ufe0e\\ufe0f",JSe="\\u200d",QSe=RegExp("["+JSe+WSe+XSe+YSe+"]");function ZSe(e){return QSe.test(e)}var fJ=ZSe;function eCe(e){return e.split("")}var tCe=eCe,mJ="\\ud800-\\udfff",rCe="\\u0300-\\u036f",nCe="\\ufe20-\\ufe2f",aCe="\\u20d0-\\u20ff",sCe=rCe+nCe+aCe,oCe="\\ufe0e\\ufe0f",iCe="["+mJ+"]",IO="["+sCe+"]",OO="\\ud83c[\\udffb-\\udfff]",lCe="(?:"+IO+"|"+OO+")",hJ="[^"+mJ+"]",pJ="(?:\\ud83c[\\udde6-\\uddff]){2}",gJ="[\\ud800-\\udbff][\\udc00-\\udfff]",cCe="\\u200d",xJ=lCe+"?",vJ="["+oCe+"]?",dCe="(?:"+cCe+"(?:"+[hJ,pJ,gJ].join("|")+")"+vJ+xJ+")*",uCe=vJ+xJ+dCe,fCe="(?:"+[hJ+IO+"?",IO,pJ,gJ,iCe].join("|")+")",mCe=RegExp(OO+"(?="+OO+")|"+fCe+uCe,"g");function hCe(e){return e.match(mCe)||[]}var pCe=hCe,gCe=tCe,xCe=fJ,vCe=pCe;function yCe(e){return xCe(e)?vCe(e):gCe(e)}var bCe=yCe,wCe=VSe,jCe=fJ,_Ce=bCe,NCe=sJ;function SCe(e){return function(t){t=NCe(t);var r=jCe(t)?_Ce(t):void 0,n=r?r[0]:t.charAt(0),s=r?wCe(r,1).join(""):t.slice(1);return n[e]()+s}}var CCe=SCe,PCe=CCe,ACe=PCe("toUpperCase"),ECe=ACe;const I5=Ls(ECe);function Ao(e){return function(){return e}}const yJ=Math.cos,VN=Math.sin,pf=Math.sqrt,WN=Math.PI,O5=2*WN,TO=Math.PI,DO=2*TO,sg=1e-6,kCe=DO-sg;function bJ(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function ICe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return bJ;const r=10**t;return function(n){this._+=n[0];for(let s=1,o=n.length;s<o;++s)this._+=Math.round(arguments[s]*r)/r+n[s]}}class OCe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?bJ:ICe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,s){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+s}`}bezierCurveTo(t,r,n,s,o,i){this._append`C${+t},${+r},${+n},${+s},${this._x1=+o},${this._y1=+i}`}arcTo(t,r,n,s,o){if(t=+t,r=+r,n=+n,s=+s,o=+o,o<0)throw new Error(`negative radius: ${o}`);let i=this._x1,l=this._y1,c=n-t,d=s-r,u=i-t,f=l-r,h=u*u+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>sg)if(!(Math.abs(f*c-d*u)>sg)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let m=n-i,x=s-l,g=c*c+d*d,v=m*m+x*x,y=Math.sqrt(g),b=Math.sqrt(h),w=o*Math.tan((TO-Math.acos((g+h-v)/(2*y*b)))/2),j=w/b,_=w/y;Math.abs(j-1)>sg&&this._append`L${t+j*u},${r+j*f}`,this._append`A${o},${o},0,0,${+(f*m>u*x)},${this._x1=t+_*c},${this._y1=r+_*d}`}}arc(t,r,n,s,o,i){if(t=+t,r=+r,n=+n,i=!!i,n<0)throw new Error(`negative radius: ${n}`);let l=n*Math.cos(s),c=n*Math.sin(s),d=t+l,u=r+c,f=1^i,h=i?s-o:o-s;this._x1===null?this._append`M${d},${u}`:(Math.abs(this._x1-d)>sg||Math.abs(this._y1-u)>sg)&&this._append`L${d},${u}`,n&&(h<0&&(h=h%DO+DO),h>kCe?this._append`A${n},${n},0,1,${f},${t-l},${r-c}A${n},${n},0,1,${f},${this._x1=d},${this._y1=u}`:h>sg&&this._append`A${n},${n},0,${+(h>=TO)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+s}h${-n}Z`}toString(){return this._}}function mM(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new OCe(t)}function hM(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function wJ(e){this._context=e}wJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function T5(e){return new wJ(e)}function jJ(e){return e[0]}function _J(e){return e[1]}function NJ(e,t){var r=Ao(!0),n=null,s=T5,o=null,i=mM(l);e=typeof e=="function"?e:e===void 0?jJ:Ao(e),t=typeof t=="function"?t:t===void 0?_J:Ao(t);function l(c){var d,u=(c=hM(c)).length,f,h=!1,m;for(n==null&&(o=s(m=i())),d=0;d<=u;++d)!(d<u&&r(f=c[d],d,c))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(f,d,c),+t(f,d,c));if(m)return o=null,m+""||null}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:Ao(+c),l):e},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:Ao(+c),l):t},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:Ao(!!c),l):r},l.curve=function(c){return arguments.length?(s=c,n!=null&&(o=s(n)),l):s},l.context=function(c){return arguments.length?(c==null?n=o=null:o=s(n=c),l):n},l}function k2(e,t,r){var n=null,s=Ao(!0),o=null,i=T5,l=null,c=mM(d);e=typeof e=="function"?e:e===void 0?jJ:Ao(+e),t=typeof t=="function"?t:Ao(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?_J:Ao(+r);function d(f){var h,m,x,g=(f=hM(f)).length,v,y=!1,b,w=new Array(g),j=new Array(g);for(o==null&&(l=i(b=c())),h=0;h<=g;++h){if(!(h<g&&s(v=f[h],h,f))===y)if(y=!y)m=h,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),x=h-1;x>=m;--x)l.point(w[x],j[x]);l.lineEnd(),l.areaEnd()}y&&(w[h]=+e(v,h,f),j[h]=+t(v,h,f),l.point(n?+n(v,h,f):w[h],r?+r(v,h,f):j[h]))}if(b)return l=null,b+""||null}function u(){return NJ().defined(s).curve(i).context(o)}return d.x=function(f){return arguments.length?(e=typeof f=="function"?f:Ao(+f),n=null,d):e},d.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Ao(+f),d):e},d.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Ao(+f),d):n},d.y=function(f){return arguments.length?(t=typeof f=="function"?f:Ao(+f),r=null,d):t},d.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Ao(+f),d):t},d.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Ao(+f),d):r},d.lineX0=d.lineY0=function(){return u().x(e).y(t)},d.lineY1=function(){return u().x(e).y(r)},d.lineX1=function(){return u().x(n).y(t)},d.defined=function(f){return arguments.length?(s=typeof f=="function"?f:Ao(!!f),d):s},d.curve=function(f){return arguments.length?(i=f,o!=null&&(l=i(o)),d):i},d.context=function(f){return arguments.length?(f==null?o=l=null:l=i(o=f),d):o},d}class SJ{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function TCe(e){return new SJ(e,!0)}function DCe(e){return new SJ(e,!1)}const pM={draw(e,t){const r=pf(t/WN);e.moveTo(r,0),e.arc(0,0,r,0,O5)}},MCe={draw(e,t){const r=pf(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},CJ=pf(1/3),RCe=CJ*2,FCe={draw(e,t){const r=pf(t/RCe),n=r*CJ;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},LCe={draw(e,t){const r=pf(t),n=-r/2;e.rect(n,n,r,r)}},$Ce=.8908130915292852,PJ=VN(WN/10)/VN(7*WN/10),BCe=VN(O5/10)*PJ,qCe=-yJ(O5/10)*PJ,zCe={draw(e,t){const r=pf(t*$Ce),n=BCe*r,s=qCe*r;e.moveTo(0,-r),e.lineTo(n,s);for(let o=1;o<5;++o){const i=O5*o/5,l=yJ(i),c=VN(i);e.lineTo(c*r,-l*r),e.lineTo(l*n-c*s,c*n+l*s)}e.closePath()}},hE=pf(3),UCe={draw(e,t){const r=-pf(t/(hE*3));e.moveTo(0,r*2),e.lineTo(-hE*r,-r),e.lineTo(hE*r,-r),e.closePath()}},Xd=-.5,Yd=pf(3)/2,MO=1/pf(12),VCe=(MO/2+1)*3,WCe={draw(e,t){const r=pf(t/VCe),n=r/2,s=r*MO,o=n,i=r*MO+r,l=-o,c=i;e.moveTo(n,s),e.lineTo(o,i),e.lineTo(l,c),e.lineTo(Xd*n-Yd*s,Yd*n+Xd*s),e.lineTo(Xd*o-Yd*i,Yd*o+Xd*i),e.lineTo(Xd*l-Yd*c,Yd*l+Xd*c),e.lineTo(Xd*n+Yd*s,Xd*s-Yd*n),e.lineTo(Xd*o+Yd*i,Xd*i-Yd*o),e.lineTo(Xd*l+Yd*c,Xd*c-Yd*l),e.closePath()}};function HCe(e,t){let r=null,n=mM(s);e=typeof e=="function"?e:Ao(e||pM),t=typeof t=="function"?t:Ao(t===void 0?64:+t);function s(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return s.type=function(o){return arguments.length?(e=typeof o=="function"?o:Ao(o),s):e},s.size=function(o){return arguments.length?(t=typeof o=="function"?o:Ao(+o),s):t},s.context=function(o){return arguments.length?(r=o??null,s):r},s}function HN(){}function GN(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function AJ(e){this._context=e}AJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:GN(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:GN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function GCe(e){return new AJ(e)}function EJ(e){this._context=e}EJ.prototype={areaStart:HN,areaEnd:HN,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:GN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function KCe(e){return new EJ(e)}function kJ(e){this._context=e}kJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:GN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function XCe(e){return new kJ(e)}function IJ(e){this._context=e}IJ.prototype={areaStart:HN,areaEnd:HN,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function YCe(e){return new IJ(e)}function F8(e){return e<0?-1:1}function L8(e,t,r){var n=e._x1-e._x0,s=t-e._x1,o=(e._y1-e._y0)/(n||s<0&&-0),i=(r-e._y1)/(s||n<0&&-0),l=(o*s+i*n)/(n+s);return(F8(o)+F8(i))*Math.min(Math.abs(o),Math.abs(i),.5*Math.abs(l))||0}function $8(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function pE(e,t,r){var n=e._x0,s=e._y0,o=e._x1,i=e._y1,l=(o-n)/3;e._context.bezierCurveTo(n+l,s+l*t,o-l,i-l*r,o,i)}function KN(e){this._context=e}KN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:pE(this,this._t0,$8(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,pE(this,$8(this,r=L8(this,e,t)),r);break;default:pE(this,this._t0,r=L8(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function OJ(e){this._context=new TJ(e)}(OJ.prototype=Object.create(KN.prototype)).point=function(e,t){KN.prototype.point.call(this,t,e)};function TJ(e){this._context=e}TJ.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,s,o){this._context.bezierCurveTo(t,e,n,r,o,s)}};function JCe(e){return new KN(e)}function QCe(e){return new OJ(e)}function DJ(e){this._context=e}DJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=B8(e),s=B8(t),o=0,i=1;i<r;++o,++i)this._context.bezierCurveTo(n[0][o],s[0][o],n[1][o],s[1][o],e[i],t[i]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function B8(e){var t,r=e.length-1,n,s=new Array(r),o=new Array(r),i=new Array(r);for(s[0]=0,o[0]=2,i[0]=e[0]+2*e[1],t=1;t<r-1;++t)s[t]=1,o[t]=4,i[t]=4*e[t]+2*e[t+1];for(s[r-1]=2,o[r-1]=7,i[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=s[t]/o[t-1],o[t]-=n,i[t]-=n*i[t-1];for(s[r-1]=i[r-1]/o[r-1],t=r-2;t>=0;--t)s[t]=(i[t]-s[t+1])/o[t];for(o[r-1]=(e[r]+s[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-s[t+1];return[s,o]}function ZCe(e){return new DJ(e)}function D5(e,t){this._context=e,this._t=t}D5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function e5e(e){return new D5(e,.5)}function t5e(e){return new D5(e,0)}function r5e(e){return new D5(e,1)}function v0(e,t){if((i=e.length)>1)for(var r=1,n,s,o=e[t[0]],i,l=o.length;r<i;++r)for(s=o,o=e[t[r]],n=0;n<l;++n)o[n][1]+=o[n][0]=isNaN(s[n][1])?s[n][0]:s[n][1]}function RO(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function n5e(e,t){return e[t]}function a5e(e){const t=[];return t.key=e,t}function s5e(){var e=Ao([]),t=RO,r=v0,n=n5e;function s(o){var i=Array.from(e.apply(this,arguments),a5e),l,c=i.length,d=-1,u;for(const f of o)for(l=0,++d;l<c;++l)(i[l][d]=[0,+n(f,i[l].key,d,o)]).data=f;for(l=0,u=hM(t(i));l<c;++l)i[u[l]].index=l;return r(i,u),i}return s.keys=function(o){return arguments.length?(e=typeof o=="function"?o:Ao(Array.from(o)),s):e},s.value=function(o){return arguments.length?(n=typeof o=="function"?o:Ao(+o),s):n},s.order=function(o){return arguments.length?(t=o==null?RO:typeof o=="function"?o:Ao(Array.from(o)),s):t},s.offset=function(o){return arguments.length?(r=o??v0,s):r},s}function o5e(e,t){if((n=e.length)>0){for(var r,n,s=0,o=e[0].length,i;s<o;++s){for(i=r=0;r<n;++r)i+=e[r][s][1]||0;if(i)for(r=0;r<n;++r)e[r][s][1]/=i}v0(e,t)}}function i5e(e,t){if((s=e.length)>0){for(var r=0,n=e[t[0]],s,o=n.length;r<o;++r){for(var i=0,l=0;i<s;++i)l+=e[i][r][1]||0;n[r][1]+=n[r][0]=-l/2}v0(e,t)}}function l5e(e,t){if(!(!((i=e.length)>0)||!((o=(s=e[t[0]]).length)>0))){for(var r=0,n=1,s,o,i;n<o;++n){for(var l=0,c=0,d=0;l<i;++l){for(var u=e[t[l]],f=u[n][1]||0,h=u[n-1][1]||0,m=(f-h)/2,x=0;x<l;++x){var g=e[t[x]],v=g[n][1]||0,y=g[n-1][1]||0;m+=v-y}c+=f,d+=m*f}s[n-1][1]+=s[n-1][0]=r,c&&(r-=d/c)}s[n-1][1]+=s[n-1][0]=r,v0(e,t)}}function Uw(e){"@babel/helpers - typeof";return Uw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uw(e)}var c5e=["type","size","sizeType"];function FO(){return FO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},FO.apply(this,arguments)}function q8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function z8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q8(Object(r),!0).forEach(function(n){d5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function d5e(e,t,r){return t=u5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u5e(e){var t=f5e(e,"string");return Uw(t)=="symbol"?t:t+""}function f5e(e,t){if(Uw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Uw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function m5e(e,t){if(e==null)return{};var r=h5e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function h5e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var MJ={symbolCircle:pM,symbolCross:MCe,symbolDiamond:FCe,symbolSquare:LCe,symbolStar:zCe,symbolTriangle:UCe,symbolWye:WCe},p5e=Math.PI/180,g5e=function(t){var r="symbol".concat(I5(t));return MJ[r]||pM},x5e=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var s=18*p5e;return 1.25*t*t*(Math.tan(s)-Math.tan(s*2)*Math.pow(Math.tan(s),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},v5e=function(t,r){MJ["symbol".concat(I5(t))]=r},gM=function(t){var r=t.type,n=r===void 0?"circle":r,s=t.size,o=s===void 0?64:s,i=t.sizeType,l=i===void 0?"area":i,c=m5e(t,c5e),d=z8(z8({},c),{},{type:n,size:o,sizeType:l}),u=function(){var v=g5e(n),y=HCe().type(v).size(x5e(o,l,n));return y()},f=d.className,h=d.cx,m=d.cy,x=ka(d,!0);return h===+h&&m===+m&&o===+o?Ce.createElement("path",FO({},x,{className:ls("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(m,")"),d:u()})):null};gM.registerSymbol=v5e;function y0(e){"@babel/helpers - typeof";return y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y0(e)}function LO(){return LO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},LO.apply(this,arguments)}function U8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function y5e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U8(Object(r),!0).forEach(function(n){Vw(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function b5e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,FJ(n.key),n)}}function w5e(e,t,r){return t&&V8(e.prototype,t),r&&V8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function j5e(e,t,r){return t=XN(t),_5e(e,RJ()?Reflect.construct(t,r||[],XN(e).constructor):t.apply(e,r))}function _5e(e,t){if(t&&(y0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N5e(e)}function N5e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function RJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(RJ=function(){return!!e})()}function XN(e){return XN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},XN(e)}function S5e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$O(e,t)}function $O(e,t){return $O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},$O(e,t)}function Vw(e,t,r){return t=FJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FJ(e){var t=C5e(e,"string");return y0(t)=="symbol"?t:t+""}function C5e(e,t){if(y0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(y0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Jd=32,xM=function(e){function t(){return b5e(this,t),j5e(this,t,arguments)}return S5e(t,e),w5e(t,[{key:"renderIcon",value:function(n){var s=this.props.inactiveColor,o=Jd/2,i=Jd/6,l=Jd/3,c=n.inactive?s:n.color;if(n.type==="plainline")return Ce.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Jd,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ce.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(o,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(o,`
            H`).concat(Jd,"M").concat(2*l,",").concat(o,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ce.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(Jd/8,"h").concat(Jd,"v").concat(Jd*3/4,"h").concat(-Jd,"z"),className:"recharts-legend-icon"});if(Ce.isValidElement(n.legendIcon)){var d=y5e({},n);return delete d.legendIcon,Ce.cloneElement(n.legendIcon,d)}return Ce.createElement(gM,{fill:c,cx:o,cy:o,size:Jd,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,s=this.props,o=s.payload,i=s.iconSize,l=s.layout,c=s.formatter,d=s.inactiveColor,u={x:0,y:0,width:Jd,height:Jd},f={display:l==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(m,x){var g=m.formatter||c,v=ls(Vw(Vw({"recharts-legend-item":!0},"legend-item-".concat(x),!0),"inactive",m.inactive));if(m.type==="none")return null;var y=Ka(m.value)?null:m.value;af(!Ka(m.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var b=m.inactive?d:m.color;return Ce.createElement("li",LO({className:v,style:f,key:"legend-item-".concat(x)},rx(n.props,m,x)),Ce.createElement(EO,{width:i,height:i,viewBox:u,style:h},n.renderIcon(m)),Ce.createElement("span",{className:"recharts-legend-item-text",style:{color:b}},g?g(y,m,x):y))})}},{key:"render",value:function(){var n=this.props,s=n.payload,o=n.layout,i=n.align;if(!s||!s.length)return null;var l={padding:0,margin:0,textAlign:o==="horizontal"?i:"left"};return Ce.createElement("ul",{className:"recharts-default-legend",style:l},this.renderItems())}}])}(p.PureComponent);Vw(xM,"displayName","Legend");Vw(xM,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var P5e=v5;function A5e(){this.__data__=new P5e,this.size=0}var E5e=A5e;function k5e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var I5e=k5e;function O5e(e){return this.__data__.get(e)}var T5e=O5e;function D5e(e){return this.__data__.has(e)}var M5e=D5e,R5e=v5,F5e=aM,L5e=sM,$5e=200;function B5e(e,t){var r=this.__data__;if(r instanceof R5e){var n=r.__data__;if(!F5e||n.length<$5e-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new L5e(n)}return r.set(e,t),this.size=r.size,this}var q5e=B5e,z5e=v5,U5e=E5e,V5e=I5e,W5e=T5e,H5e=M5e,G5e=q5e;function gy(e){var t=this.__data__=new z5e(e);this.size=t.size}gy.prototype.clear=U5e;gy.prototype.delete=V5e;gy.prototype.get=W5e;gy.prototype.has=H5e;gy.prototype.set=G5e;var LJ=gy,K5e="__lodash_hash_undefined__";function X5e(e){return this.__data__.set(e,K5e),this}var Y5e=X5e;function J5e(e){return this.__data__.has(e)}var Q5e=J5e,Z5e=sM,ePe=Y5e,tPe=Q5e;function YN(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Z5e;++t<r;)this.add(e[t])}YN.prototype.add=YN.prototype.push=ePe;YN.prototype.has=tPe;var $J=YN;function rPe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var BJ=rPe;function nPe(e,t){return e.has(t)}var qJ=nPe,aPe=$J,sPe=BJ,oPe=qJ,iPe=1,lPe=2;function cPe(e,t,r,n,s,o){var i=r&iPe,l=e.length,c=t.length;if(l!=c&&!(i&&c>l))return!1;var d=o.get(e),u=o.get(t);if(d&&u)return d==t&&u==e;var f=-1,h=!0,m=r&lPe?new aPe:void 0;for(o.set(e,t),o.set(t,e);++f<l;){var x=e[f],g=t[f];if(n)var v=i?n(g,x,f,t,e,o):n(x,g,f,e,t,o);if(v!==void 0){if(v)continue;h=!1;break}if(m){if(!sPe(t,function(y,b){if(!oPe(m,b)&&(x===y||s(x,y,r,n,o)))return m.push(b)})){h=!1;break}}else if(!(x===g||s(x,g,r,n,o))){h=!1;break}}return o.delete(e),o.delete(t),h}var zJ=cPe,dPe=rm,uPe=dPe.Uint8Array,fPe=uPe;function mPe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,s){r[++t]=[s,n]}),r}var hPe=mPe;function pPe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var vM=pPe,W8=oj,H8=fPe,gPe=nM,xPe=zJ,vPe=hPe,yPe=vM,bPe=1,wPe=2,jPe="[object Boolean]",_Pe="[object Date]",NPe="[object Error]",SPe="[object Map]",CPe="[object Number]",PPe="[object RegExp]",APe="[object Set]",EPe="[object String]",kPe="[object Symbol]",IPe="[object ArrayBuffer]",OPe="[object DataView]",G8=W8?W8.prototype:void 0,gE=G8?G8.valueOf:void 0;function TPe(e,t,r,n,s,o,i){switch(r){case OPe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case IPe:return!(e.byteLength!=t.byteLength||!o(new H8(e),new H8(t)));case jPe:case _Pe:case CPe:return gPe(+e,+t);case NPe:return e.name==t.name&&e.message==t.message;case PPe:case EPe:return e==t+"";case SPe:var l=vPe;case APe:var c=n&bPe;if(l||(l=yPe),e.size!=t.size&&!c)return!1;var d=i.get(e);if(d)return d==t;n|=wPe,i.set(e,t);var u=xPe(l(e),l(t),n,s,o,i);return i.delete(e),u;case kPe:if(gE)return gE.call(e)==gE.call(t)}return!1}var DPe=TPe;function MPe(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var UJ=MPe,RPe=UJ,FPe=ed;function LPe(e,t,r){var n=t(e);return FPe(e)?n:RPe(n,r(e))}var $Pe=LPe;function BPe(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[s++]=i)}return o}var qPe=BPe;function zPe(){return[]}var UPe=zPe,VPe=qPe,WPe=UPe,HPe=Object.prototype,GPe=HPe.propertyIsEnumerable,K8=Object.getOwnPropertySymbols,KPe=K8?function(e){return e==null?[]:(e=Object(e),VPe(K8(e),function(t){return GPe.call(e,t)}))}:WPe,XPe=KPe;function YPe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var JPe=YPe,QPe=Qm,ZPe=Zm,eAe="[object Arguments]";function tAe(e){return ZPe(e)&&QPe(e)==eAe}var rAe=tAe,X8=rAe,nAe=Zm,VJ=Object.prototype,aAe=VJ.hasOwnProperty,sAe=VJ.propertyIsEnumerable,oAe=X8(function(){return arguments}())?X8:function(e){return nAe(e)&&aAe.call(e,"callee")&&!sAe.call(e,"callee")},yM=oAe,JN={exports:{}};function iAe(){return!1}var lAe=iAe;JN.exports;(function(e,t){var r=rm,n=lAe,s=t&&!t.nodeType&&t,o=s&&!0&&e&&!e.nodeType&&e,i=o&&o.exports===s,l=i?r.Buffer:void 0,c=l?l.isBuffer:void 0,d=c||n;e.exports=d})(JN,JN.exports);var WJ=JN.exports,cAe=9007199254740991,dAe=/^(?:0|[1-9]\d*)$/;function uAe(e,t){var r=typeof e;return t=t??cAe,!!t&&(r=="number"||r!="symbol"&&dAe.test(e))&&e>-1&&e%1==0&&e<t}var bM=uAe,fAe=9007199254740991;function mAe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=fAe}var wM=mAe,hAe=Qm,pAe=wM,gAe=Zm,xAe="[object Arguments]",vAe="[object Array]",yAe="[object Boolean]",bAe="[object Date]",wAe="[object Error]",jAe="[object Function]",_Ae="[object Map]",NAe="[object Number]",SAe="[object Object]",CAe="[object RegExp]",PAe="[object Set]",AAe="[object String]",EAe="[object WeakMap]",kAe="[object ArrayBuffer]",IAe="[object DataView]",OAe="[object Float32Array]",TAe="[object Float64Array]",DAe="[object Int8Array]",MAe="[object Int16Array]",RAe="[object Int32Array]",FAe="[object Uint8Array]",LAe="[object Uint8ClampedArray]",$Ae="[object Uint16Array]",BAe="[object Uint32Array]",Lo={};Lo[OAe]=Lo[TAe]=Lo[DAe]=Lo[MAe]=Lo[RAe]=Lo[FAe]=Lo[LAe]=Lo[$Ae]=Lo[BAe]=!0;Lo[xAe]=Lo[vAe]=Lo[kAe]=Lo[yAe]=Lo[IAe]=Lo[bAe]=Lo[wAe]=Lo[jAe]=Lo[_Ae]=Lo[NAe]=Lo[SAe]=Lo[CAe]=Lo[PAe]=Lo[AAe]=Lo[EAe]=!1;function qAe(e){return gAe(e)&&pAe(e.length)&&!!Lo[hAe(e)]}var zAe=qAe;function UAe(e){return function(t){return e(t)}}var HJ=UAe,QN={exports:{}};QN.exports;(function(e,t){var r=ZY,n=t&&!t.nodeType&&t,s=n&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===n,i=o&&r.process,l=function(){try{var c=s&&s.require&&s.require("util").types;return c||i&&i.binding&&i.binding("util")}catch{}}();e.exports=l})(QN,QN.exports);var VAe=QN.exports,WAe=zAe,HAe=HJ,Y8=VAe,J8=Y8&&Y8.isTypedArray,GAe=J8?HAe(J8):WAe,GJ=GAe,KAe=JPe,XAe=yM,YAe=ed,JAe=WJ,QAe=bM,ZAe=GJ,eEe=Object.prototype,tEe=eEe.hasOwnProperty;function rEe(e,t){var r=YAe(e),n=!r&&XAe(e),s=!r&&!n&&JAe(e),o=!r&&!n&&!s&&ZAe(e),i=r||n||s||o,l=i?KAe(e.length,String):[],c=l.length;for(var d in e)(t||tEe.call(e,d))&&!(i&&(d=="length"||s&&(d=="offset"||d=="parent")||o&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||QAe(d,c)))&&l.push(d);return l}var nEe=rEe,aEe=Object.prototype;function sEe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||aEe;return e===r}var oEe=sEe;function iEe(e,t){return function(r){return e(t(r))}}var KJ=iEe,lEe=KJ,cEe=lEe(Object.keys,Object),dEe=cEe,uEe=oEe,fEe=dEe,mEe=Object.prototype,hEe=mEe.hasOwnProperty;function pEe(e){if(!uEe(e))return fEe(e);var t=[];for(var r in Object(e))hEe.call(e,r)&&r!="constructor"&&t.push(r);return t}var gEe=pEe,xEe=rM,vEe=wM;function yEe(e){return e!=null&&vEe(e.length)&&!xEe(e)}var ij=yEe,bEe=nEe,wEe=gEe,jEe=ij;function _Ee(e){return jEe(e)?bEe(e):wEe(e)}var M5=_Ee,NEe=$Pe,SEe=XPe,CEe=M5;function PEe(e){return NEe(e,CEe,SEe)}var AEe=PEe,Q8=AEe,EEe=1,kEe=Object.prototype,IEe=kEe.hasOwnProperty;function OEe(e,t,r,n,s,o){var i=r&EEe,l=Q8(e),c=l.length,d=Q8(t),u=d.length;if(c!=u&&!i)return!1;for(var f=c;f--;){var h=l[f];if(!(i?h in t:IEe.call(t,h)))return!1}var m=o.get(e),x=o.get(t);if(m&&x)return m==t&&x==e;var g=!0;o.set(e,t),o.set(t,e);for(var v=i;++f<c;){h=l[f];var y=e[h],b=t[h];if(n)var w=i?n(b,y,h,t,e,o):n(y,b,h,e,t,o);if(!(w===void 0?y===b||s(y,b,r,n,o):w)){g=!1;break}v||(v=h=="constructor")}if(g&&!v){var j=e.constructor,_=t.constructor;j!=_&&"constructor"in e&&"constructor"in t&&!(typeof j=="function"&&j instanceof j&&typeof _=="function"&&_ instanceof _)&&(g=!1)}return o.delete(e),o.delete(t),g}var TEe=OEe,DEe=bx,MEe=rm,REe=DEe(MEe,"DataView"),FEe=REe,LEe=bx,$Ee=rm,BEe=LEe($Ee,"Promise"),qEe=BEe,zEe=bx,UEe=rm,VEe=zEe(UEe,"Set"),XJ=VEe,WEe=bx,HEe=rm,GEe=WEe(HEe,"WeakMap"),KEe=GEe,BO=FEe,qO=aM,zO=qEe,UO=XJ,VO=KEe,YJ=Qm,xy=tJ,Z8="[object Map]",XEe="[object Object]",eB="[object Promise]",tB="[object Set]",rB="[object WeakMap]",nB="[object DataView]",YEe=xy(BO),JEe=xy(qO),QEe=xy(zO),ZEe=xy(UO),eke=xy(VO),og=YJ;(BO&&og(new BO(new ArrayBuffer(1)))!=nB||qO&&og(new qO)!=Z8||zO&&og(zO.resolve())!=eB||UO&&og(new UO)!=tB||VO&&og(new VO)!=rB)&&(og=function(e){var t=YJ(e),r=t==XEe?e.constructor:void 0,n=r?xy(r):"";if(n)switch(n){case YEe:return nB;case JEe:return Z8;case QEe:return eB;case ZEe:return tB;case eke:return rB}return t});var tke=og,xE=LJ,rke=zJ,nke=DPe,ake=TEe,aB=tke,sB=ed,oB=WJ,ske=GJ,oke=1,iB="[object Arguments]",lB="[object Array]",I2="[object Object]",ike=Object.prototype,cB=ike.hasOwnProperty;function lke(e,t,r,n,s,o){var i=sB(e),l=sB(t),c=i?lB:aB(e),d=l?lB:aB(t);c=c==iB?I2:c,d=d==iB?I2:d;var u=c==I2,f=d==I2,h=c==d;if(h&&oB(e)){if(!oB(t))return!1;i=!0,u=!1}if(h&&!u)return o||(o=new xE),i||ske(e)?rke(e,t,r,n,s,o):nke(e,t,c,r,n,s,o);if(!(r&oke)){var m=u&&cB.call(e,"__wrapped__"),x=f&&cB.call(t,"__wrapped__");if(m||x){var g=m?e.value():e,v=x?t.value():t;return o||(o=new xE),s(g,v,r,n,o)}}return h?(o||(o=new xE),ake(e,t,r,n,s,o)):!1}var cke=lke,dke=cke,dB=Zm;function JJ(e,t,r,n,s){return e===t?!0:e==null||t==null||!dB(e)&&!dB(t)?e!==e&&t!==t:dke(e,t,r,n,JJ,s)}var jM=JJ,uke=LJ,fke=jM,mke=1,hke=2;function pke(e,t,r,n){var s=r.length,o=s,i=!n;if(e==null)return!o;for(e=Object(e);s--;){var l=r[s];if(i&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++s<o;){l=r[s];var c=l[0],d=e[c],u=l[1];if(i&&l[2]){if(d===void 0&&!(c in e))return!1}else{var f=new uke;if(n)var h=n(d,u,c,e,t,f);if(!(h===void 0?fke(u,d,mke|hke,n,f):h))return!1}}return!0}var gke=pke,xke=Tp;function vke(e){return e===e&&!xke(e)}var QJ=vke,yke=QJ,bke=M5;function wke(e){for(var t=bke(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,yke(s)]}return t}var jke=wke;function _ke(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var ZJ=_ke,Nke=gke,Ske=jke,Cke=ZJ;function Pke(e){var t=Ske(e);return t.length==1&&t[0][2]?Cke(t[0][0],t[0][1]):function(r){return r===e||Nke(r,e,t)}}var Ake=Pke;function Eke(e,t){return e!=null&&t in Object(e)}var kke=Eke,Ike=oJ,Oke=yM,Tke=ed,Dke=bM,Mke=wM,Rke=b5;function Fke(e,t,r){t=Ike(t,e);for(var n=-1,s=t.length,o=!1;++n<s;){var i=Rke(t[n]);if(!(o=e!=null&&r(e,i)))break;e=e[i]}return o||++n!=s?o:(s=e==null?0:e.length,!!s&&Mke(s)&&Dke(i,s)&&(Tke(e)||Oke(e)))}var Lke=Fke,$ke=kke,Bke=Lke;function qke(e,t){return e!=null&&Bke(e,t,$ke)}var zke=qke,Uke=jM,Vke=iJ,Wke=zke,Hke=tM,Gke=QJ,Kke=ZJ,Xke=b5,Yke=1,Jke=2;function Qke(e,t){return Hke(e)&&Gke(t)?Kke(Xke(e),t):function(r){var n=Vke(r,e);return n===void 0&&n===t?Wke(r,e):Uke(t,n,Yke|Jke)}}var Zke=Qke;function eIe(e){return e}var vy=eIe;function tIe(e){return function(t){return t?.[e]}}var rIe=tIe,nIe=lM;function aIe(e){return function(t){return nIe(t,e)}}var sIe=aIe,oIe=rIe,iIe=sIe,lIe=tM,cIe=b5;function dIe(e){return lIe(e)?oIe(cIe(e)):iIe(e)}var uIe=dIe,fIe=Ake,mIe=Zke,hIe=vy,pIe=ed,gIe=uIe;function xIe(e){return typeof e=="function"?e:e==null?hIe:typeof e=="object"?pIe(e)?mIe(e[0],e[1]):fIe(e):gIe(e)}var nm=xIe;function vIe(e,t,r,n){for(var s=e.length,o=r+(n?1:-1);n?o--:++o<s;)if(t(e[o],o,e))return o;return-1}var eQ=vIe;function yIe(e){return e!==e}var bIe=yIe;function wIe(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}var jIe=wIe,_Ie=eQ,NIe=bIe,SIe=jIe;function CIe(e,t,r){return t===t?SIe(e,t,r):_Ie(e,NIe,r)}var PIe=CIe,AIe=PIe;function EIe(e,t){var r=e==null?0:e.length;return!!r&&AIe(e,t,0)>-1}var kIe=EIe;function IIe(e,t,r){for(var n=-1,s=e==null?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}var OIe=IIe;function TIe(){}var DIe=TIe,vE=XJ,MIe=DIe,RIe=vM,FIe=1/0,LIe=vE&&1/RIe(new vE([,-0]))[1]==FIe?function(e){return new vE(e)}:MIe,$Ie=LIe,BIe=$J,qIe=kIe,zIe=OIe,UIe=qJ,VIe=$Ie,WIe=vM,HIe=200;function GIe(e,t,r){var n=-1,s=qIe,o=e.length,i=!0,l=[],c=l;if(r)i=!1,s=zIe;else if(o>=HIe){var d=t?null:VIe(e);if(d)return WIe(d);i=!1,s=UIe,c=new BIe}else c=t?[]:l;e:for(;++n<o;){var u=e[n],f=t?t(u):u;if(u=r||u!==0?u:0,i&&f===f){for(var h=c.length;h--;)if(c[h]===f)continue e;t&&c.push(f),l.push(u)}else s(c,f,r)||(c!==l&&c.push(f),l.push(u))}return l}var KIe=GIe,XIe=nm,YIe=KIe;function JIe(e,t){return e&&e.length?YIe(e,XIe(t)):[]}var QIe=JIe;const uB=Ls(QIe);function tQ(e,t,r){return t===!0?uB(e,r):Ka(t)?uB(e,t):e}function b0(e){"@babel/helpers - typeof";return b0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b0(e)}var ZIe=["ref"];function fB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function im(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fB(Object(r),!0).forEach(function(n){R5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nQ(n.key),n)}}function tOe(e,t,r){return t&&mB(e.prototype,t),r&&mB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function rOe(e,t,r){return t=ZN(t),nOe(e,rQ()?Reflect.construct(t,r||[],ZN(e).constructor):t.apply(e,r))}function nOe(e,t){if(t&&(b0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aOe(e)}function aOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rQ=function(){return!!e})()}function ZN(e){return ZN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ZN(e)}function sOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WO(e,t)}function WO(e,t){return WO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},WO(e,t)}function R5(e,t,r){return t=nQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nQ(e){var t=oOe(e,"string");return b0(t)=="symbol"?t:t+""}function oOe(e,t){if(b0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(b0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function iOe(e,t){if(e==null)return{};var r=lOe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function lOe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function cOe(e){return e.value}function dOe(e,t){if(Ce.isValidElement(e))return Ce.cloneElement(e,t);if(typeof e=="function")return Ce.createElement(e,t);t.ref;var r=iOe(t,ZIe);return Ce.createElement(xM,r)}var hB=1,Mg=function(e){function t(){var r;eOe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=rOe(this,t,[].concat(s)),R5(r,"lastBoundingBox",{width:-1,height:-1}),r}return sOe(t,e),tOe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,s=this.getBBox();s?(Math.abs(s.width-this.lastBoundingBox.width)>hB||Math.abs(s.height-this.lastBoundingBox.height)>hB)&&(this.lastBoundingBox.width=s.width,this.lastBoundingBox.height=s.height,n&&n(s)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?im({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var s=this.props,o=s.layout,i=s.align,l=s.verticalAlign,c=s.margin,d=s.chartWidth,u=s.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(i==="center"&&o==="vertical"){var m=this.getBBoxSnapshot();f={left:((d||0)-m.width)/2}}else f=i==="right"?{right:c&&c.right||0}:{left:c&&c.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(l==="middle"){var x=this.getBBoxSnapshot();h={top:((u||0)-x.height)/2}}else h=l==="bottom"?{bottom:c&&c.bottom||0}:{top:c&&c.top||0};return im(im({},f),h)}},{key:"render",value:function(){var n=this,s=this.props,o=s.content,i=s.width,l=s.height,c=s.wrapperStyle,d=s.payloadUniqBy,u=s.payload,f=im(im({position:"absolute",width:i||"auto",height:l||"auto"},this.getDefaultPosition(c)),c);return Ce.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(m){n.wrapperNode=m}},dOe(o,im(im({},this.props),{},{payload:tQ(u,d,cOe)})))}}],[{key:"getWithHeight",value:function(n,s){var o=im(im({},this.defaultProps),n.props),i=o.layout;return i==="vertical"&&Rn(n.props.height)?{height:n.props.height}:i==="horizontal"?{width:n.props.width||s}:null}}])}(p.PureComponent);R5(Mg,"displayName","Legend");R5(Mg,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var pB=oj,uOe=yM,fOe=ed,gB=pB?pB.isConcatSpreadable:void 0;function mOe(e){return fOe(e)||uOe(e)||!!(gB&&e&&e[gB])}var hOe=mOe,pOe=UJ,gOe=hOe;function aQ(e,t,r,n,s){var o=-1,i=e.length;for(r||(r=gOe),s||(s=[]);++o<i;){var l=e[o];t>0&&r(l)?t>1?aQ(l,t-1,r,n,s):pOe(s,l):n||(s[s.length]=l)}return s}var sQ=aQ;function xOe(e){return function(t,r,n){for(var s=-1,o=Object(t),i=n(t),l=i.length;l--;){var c=i[e?l:++s];if(r(o[c],c,o)===!1)break}return t}}var vOe=xOe,yOe=vOe,bOe=yOe(),wOe=bOe,jOe=wOe,_Oe=M5;function NOe(e,t){return e&&jOe(e,t,_Oe)}var oQ=NOe,SOe=ij;function COe(e,t){return function(r,n){if(r==null)return r;if(!SOe(r))return e(r,n);for(var s=r.length,o=t?s:-1,i=Object(r);(t?o--:++o<s)&&n(i[o],o,i)!==!1;);return r}}var POe=COe,AOe=oQ,EOe=POe,kOe=EOe(AOe),_M=kOe,IOe=_M,OOe=ij;function TOe(e,t){var r=-1,n=OOe(e)?Array(e.length):[];return IOe(e,function(s,o,i){n[++r]=t(s,o,i)}),n}var iQ=TOe;function DOe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var MOe=DOe,xB=dy;function ROe(e,t){if(e!==t){var r=e!==void 0,n=e===null,s=e===e,o=xB(e),i=t!==void 0,l=t===null,c=t===t,d=xB(t);if(!l&&!d&&!o&&e>t||o&&i&&c&&!l&&!d||n&&i&&c||!r&&c||!s)return 1;if(!n&&!o&&!d&&e<t||d&&r&&s&&!n&&!o||l&&r&&s||!i&&s||!c)return-1}return 0}var FOe=ROe,LOe=FOe;function $Oe(e,t,r){for(var n=-1,s=e.criteria,o=t.criteria,i=s.length,l=r.length;++n<i;){var c=LOe(s[n],o[n]);if(c){if(n>=l)return c;var d=r[n];return c*(d=="desc"?-1:1)}}return e.index-t.index}var BOe=$Oe,yE=iM,qOe=lM,zOe=nm,UOe=iQ,VOe=MOe,WOe=HJ,HOe=BOe,GOe=vy,KOe=ed;function XOe(e,t,r){t.length?t=yE(t,function(o){return KOe(o)?function(i){return qOe(i,o.length===1?o[0]:o)}:o}):t=[GOe];var n=-1;t=yE(t,WOe(zOe));var s=UOe(e,function(o,i,l){var c=yE(t,function(d){return d(o)});return{criteria:c,index:++n,value:o}});return VOe(s,function(o,i){return HOe(o,i,r)})}var YOe=XOe;function JOe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var QOe=JOe,ZOe=QOe,vB=Math.max;function eTe(e,t,r){return t=vB(t===void 0?e.length-1:t,0),function(){for(var n=arguments,s=-1,o=vB(n.length-t,0),i=Array(o);++s<o;)i[s]=n[t+s];s=-1;for(var l=Array(t+1);++s<t;)l[s]=n[s];return l[t]=r(i),ZOe(e,this,l)}}var tTe=eTe;function rTe(e){return function(){return e}}var nTe=rTe,aTe=bx,sTe=function(){try{var e=aTe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),lQ=sTe,oTe=nTe,yB=lQ,iTe=vy,lTe=yB?function(e,t){return yB(e,"toString",{configurable:!0,enumerable:!1,value:oTe(t),writable:!0})}:iTe,cTe=lTe,dTe=800,uTe=16,fTe=Date.now;function mTe(e){var t=0,r=0;return function(){var n=fTe(),s=uTe-(n-r);if(r=n,s>0){if(++t>=dTe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var hTe=mTe,pTe=cTe,gTe=hTe,xTe=gTe(pTe),vTe=xTe,yTe=vy,bTe=tTe,wTe=vTe;function jTe(e,t){return wTe(bTe(e,t,yTe),e+"")}var _Te=jTe,NTe=nM,STe=ij,CTe=bM,PTe=Tp;function ATe(e,t,r){if(!PTe(r))return!1;var n=typeof t;return(n=="number"?STe(r)&&CTe(t,r.length):n=="string"&&t in r)?NTe(r[t],e):!1}var F5=ATe,ETe=sQ,kTe=YOe,ITe=_Te,bB=F5,OTe=ITe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&bB(e,t[0],t[1])?t=[]:r>2&&bB(t[0],t[1],t[2])&&(t=[t[0]]),kTe(e,ETe(t,1),[])}),TTe=OTe;const NM=Ls(TTe);function Ww(e){"@babel/helpers - typeof";return Ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ww(e)}function HO(){return HO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HO.apply(this,arguments)}function DTe(e,t){return LTe(e)||FTe(e,t)||RTe(e,t)||MTe()}function MTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RTe(e,t){if(e){if(typeof e=="string")return wB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wB(e,t)}}function wB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function FTe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function LTe(e){if(Array.isArray(e))return e}function jB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function bE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jB(Object(r),!0).forEach(function(n){$Te(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $Te(e,t,r){return t=BTe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BTe(e){var t=qTe(e,"string");return Ww(t)=="symbol"?t:t+""}function qTe(e,t){if(Ww(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ww(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function zTe(e){return Array.isArray(e)&&Gi(e[0])&&Gi(e[1])?e.join(" ~ "):e}var UTe=function(t){var r=t.separator,n=r===void 0?" : ":r,s=t.contentStyle,o=s===void 0?{}:s,i=t.itemStyle,l=i===void 0?{}:i,c=t.labelStyle,d=c===void 0?{}:c,u=t.payload,f=t.formatter,h=t.itemSorter,m=t.wrapperClassName,x=t.labelClassName,g=t.label,v=t.labelFormatter,y=t.accessibilityLayer,b=y===void 0?!1:y,w=function(){if(u&&u.length){var I={padding:0,margin:0},T=(h?NM(u,h):u).map(function(k,$){if(k.type==="none")return null;var q=bE({display:"block",paddingTop:4,paddingBottom:4,color:k.color||"#000"},l),z=k.formatter||f||zTe,F=k.value,V=k.name,ue=F,_e=V;if(z&&ue!=null&&_e!=null){var U=z(F,V,k,$,u);if(Array.isArray(U)){var L=DTe(U,2);ue=L[0],_e=L[1]}else ue=U}return Ce.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat($),style:q},Gi(_e)?Ce.createElement("span",{className:"recharts-tooltip-item-name"},_e):null,Gi(_e)?Ce.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ce.createElement("span",{className:"recharts-tooltip-item-value"},ue),Ce.createElement("span",{className:"recharts-tooltip-item-unit"},k.unit||""))});return Ce.createElement("ul",{className:"recharts-tooltip-item-list",style:I},T)}return null},j=bE({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),_=bE({margin:0},d),C=!ss(g),A=C?g:"",S=ls("recharts-default-tooltip",m),P=ls("recharts-tooltip-label",x);C&&v&&u!==void 0&&u!==null&&(A=v(g,u));var M=b?{role:"status","aria-live":"assertive"}:{};return Ce.createElement("div",HO({className:S,style:j},M),Ce.createElement("p",{className:P,style:_},Ce.isValidElement(A)?A:"".concat(A)),w())};function Hw(e){"@babel/helpers - typeof";return Hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hw(e)}function O2(e,t,r){return t=VTe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VTe(e){var t=WTe(e,"string");return Hw(t)=="symbol"?t:t+""}function WTe(e,t){if(Hw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Hw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Yy="recharts-tooltip-wrapper",HTe={visibility:"hidden"};function GTe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return ls(Yy,O2(O2(O2(O2({},"".concat(Yy,"-right"),Rn(r)&&t&&Rn(t.x)&&r>=t.x),"".concat(Yy,"-left"),Rn(r)&&t&&Rn(t.x)&&r<t.x),"".concat(Yy,"-bottom"),Rn(n)&&t&&Rn(t.y)&&n>=t.y),"".concat(Yy,"-top"),Rn(n)&&t&&Rn(t.y)&&n<t.y))}function _B(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,s=e.offsetTopLeft,o=e.position,i=e.reverseDirection,l=e.tooltipDimension,c=e.viewBox,d=e.viewBoxDimension;if(o&&Rn(o[n]))return o[n];var u=r[n]-l-s,f=r[n]+s;if(t[n])return i[n]?u:f;if(i[n]){var h=u,m=c[n];return h<m?Math.max(f,c[n]):Math.max(u,c[n])}var x=f+l,g=c[n]+d;return x>g?Math.max(u,c[n]):Math.max(f,c[n])}function KTe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function XTe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,s=e.position,o=e.reverseDirection,i=e.tooltipBox,l=e.useTranslate3d,c=e.viewBox,d,u,f;return i.height>0&&i.width>0&&r?(u=_B({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:i.width,viewBox:c,viewBoxDimension:c.width}),f=_B({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:i.height,viewBox:c,viewBoxDimension:c.height}),d=KTe({translateX:u,translateY:f,useTranslate3d:l})):d=HTe,{cssProperties:d,cssClasses:GTe({translateX:u,translateY:f,coordinate:r})}}function w0(e){"@babel/helpers - typeof";return w0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w0(e)}function NB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function SB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NB(Object(r),!0).forEach(function(n){KO(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YTe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function CB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dQ(n.key),n)}}function JTe(e,t,r){return t&&CB(e.prototype,t),r&&CB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function QTe(e,t,r){return t=eS(t),ZTe(e,cQ()?Reflect.construct(t,r||[],eS(e).constructor):t.apply(e,r))}function ZTe(e,t){if(t&&(w0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return e3e(e)}function e3e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cQ=function(){return!!e})()}function eS(e){return eS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},eS(e)}function t3e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GO(e,t)}function GO(e,t){return GO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},GO(e,t)}function KO(e,t,r){return t=dQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dQ(e){var t=r3e(e,"string");return w0(t)=="symbol"?t:t+""}function r3e(e,t){if(w0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(w0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var PB=1,n3e=function(e){function t(){var r;YTe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=QTe(this,t,[].concat(s)),KO(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),KO(r,"handleKeyDown",function(i){if(i.key==="Escape"){var l,c,d,u;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(l=(c=r.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&l!==void 0?l:0,y:(d=(u=r.props.coordinate)===null||u===void 0?void 0:u.y)!==null&&d!==void 0?d:0}})}}),r}return t3e(t,e),JTe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>PB||Math.abs(n.height-this.state.lastBoundingBox.height)>PB)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,s;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,s=this.props,o=s.active,i=s.allowEscapeViewBox,l=s.animationDuration,c=s.animationEasing,d=s.children,u=s.coordinate,f=s.hasPayload,h=s.isAnimationActive,m=s.offset,x=s.position,g=s.reverseDirection,v=s.useTranslate3d,y=s.viewBox,b=s.wrapperStyle,w=XTe({allowEscapeViewBox:i,coordinate:u,offsetTopLeft:m,position:x,reverseDirection:g,tooltipBox:this.state.lastBoundingBox,useTranslate3d:v,viewBox:y}),j=w.cssClasses,_=w.cssProperties,C=SB(SB({transition:h&&o?"transform ".concat(l,"ms ").concat(c):void 0},_),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&f?"visible":"hidden",position:"absolute",top:0,left:0},b);return Ce.createElement("div",{tabIndex:-1,className:j,style:C,ref:function(S){n.wrapperNode=S}},d)}}])}(p.PureComponent),a3e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},sf={isSsr:a3e(),get:function(t){return sf[t]},set:function(t,r){if(typeof t=="string")sf[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(s){sf[s]=t[s]})}}};function j0(e){"@babel/helpers - typeof";return j0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j0(e)}function AB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function EB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?AB(Object(r),!0).forEach(function(n){SM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):AB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function s3e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fQ(n.key),n)}}function o3e(e,t,r){return t&&kB(e.prototype,t),r&&kB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i3e(e,t,r){return t=tS(t),l3e(e,uQ()?Reflect.construct(t,r||[],tS(e).constructor):t.apply(e,r))}function l3e(e,t){if(t&&(j0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return c3e(e)}function c3e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uQ=function(){return!!e})()}function tS(e){return tS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tS(e)}function d3e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&XO(e,t)}function XO(e,t){return XO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},XO(e,t)}function SM(e,t,r){return t=fQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fQ(e){var t=u3e(e,"string");return j0(t)=="symbol"?t:t+""}function u3e(e,t){if(j0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(j0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function f3e(e){return e.dataKey}function m3e(e,t){return Ce.isValidElement(e)?Ce.cloneElement(e,t):typeof e=="function"?Ce.createElement(e,t):Ce.createElement(UTe,t)}var Lc=function(e){function t(){return s3e(this,t),i3e(this,t,arguments)}return d3e(t,e),o3e(t,[{key:"render",value:function(){var n=this,s=this.props,o=s.active,i=s.allowEscapeViewBox,l=s.animationDuration,c=s.animationEasing,d=s.content,u=s.coordinate,f=s.filterNull,h=s.isAnimationActive,m=s.offset,x=s.payload,g=s.payloadUniqBy,v=s.position,y=s.reverseDirection,b=s.useTranslate3d,w=s.viewBox,j=s.wrapperStyle,_=x??[];f&&_.length&&(_=tQ(x.filter(function(A){return A.value!=null&&(A.hide!==!0||n.props.includeHidden)}),g,f3e));var C=_.length>0;return Ce.createElement(n3e,{allowEscapeViewBox:i,animationDuration:l,animationEasing:c,isAnimationActive:h,active:o,coordinate:u,hasPayload:C,offset:m,position:v,reverseDirection:y,useTranslate3d:b,viewBox:w,wrapperStyle:j},m3e(d,EB(EB({},this.props),{},{payload:_})))}}])}(p.PureComponent);SM(Lc,"displayName","Tooltip");SM(Lc,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!sf.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var h3e=rm,p3e=function(){return h3e.Date.now()},g3e=p3e,x3e=/\s/;function v3e(e){for(var t=e.length;t--&&x3e.test(e.charAt(t)););return t}var y3e=v3e,b3e=y3e,w3e=/^\s+/;function j3e(e){return e&&e.slice(0,b3e(e)+1).replace(w3e,"")}var _3e=j3e,N3e=_3e,IB=Tp,S3e=dy,OB=0/0,C3e=/^[-+]0x[0-9a-f]+$/i,P3e=/^0b[01]+$/i,A3e=/^0o[0-7]+$/i,E3e=parseInt;function k3e(e){if(typeof e=="number")return e;if(S3e(e))return OB;if(IB(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=IB(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=N3e(e);var r=P3e.test(e);return r||A3e.test(e)?E3e(e.slice(2),r?2:8):C3e.test(e)?OB:+e}var mQ=k3e,I3e=Tp,wE=g3e,TB=mQ,O3e="Expected a function",T3e=Math.max,D3e=Math.min;function M3e(e,t,r){var n,s,o,i,l,c,d=0,u=!1,f=!1,h=!0;if(typeof e!="function")throw new TypeError(O3e);t=TB(t)||0,I3e(r)&&(u=!!r.leading,f="maxWait"in r,o=f?T3e(TB(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h);function m(C){var A=n,S=s;return n=s=void 0,d=C,i=e.apply(S,A),i}function x(C){return d=C,l=setTimeout(y,t),u?m(C):i}function g(C){var A=C-c,S=C-d,P=t-A;return f?D3e(P,o-S):P}function v(C){var A=C-c,S=C-d;return c===void 0||A>=t||A<0||f&&S>=o}function y(){var C=wE();if(v(C))return b(C);l=setTimeout(y,g(C))}function b(C){return l=void 0,h&&n?m(C):(n=s=void 0,i)}function w(){l!==void 0&&clearTimeout(l),d=0,n=c=s=l=void 0}function j(){return l===void 0?i:b(wE())}function _(){var C=wE(),A=v(C);if(n=arguments,s=this,c=C,A){if(l===void 0)return x(c);if(f)return clearTimeout(l),l=setTimeout(y,t),m(c)}return l===void 0&&(l=setTimeout(y,t)),i}return _.cancel=w,_.flush=j,_}var R3e=M3e,F3e=R3e,L3e=Tp,$3e="Expected a function";function B3e(e,t,r){var n=!0,s=!0;if(typeof e!="function")throw new TypeError($3e);return L3e(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),F3e(e,t,{leading:n,maxWait:t,trailing:s})}var q3e=B3e;const hQ=Ls(q3e);function Gw(e){"@babel/helpers - typeof";return Gw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gw(e)}function DB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function T2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DB(Object(r),!0).forEach(function(n){z3e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z3e(e,t,r){return t=U3e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U3e(e){var t=V3e(e,"string");return Gw(t)=="symbol"?t:t+""}function V3e(e,t){if(Gw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Gw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function W3e(e,t){return X3e(e)||K3e(e,t)||G3e(e,t)||H3e()}function H3e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G3e(e,t){if(e){if(typeof e=="string")return MB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return MB(e,t)}}function MB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function K3e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function X3e(e){if(Array.isArray(e))return e}var Hb=p.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,s=n===void 0?{width:-1,height:-1}:n,o=e.width,i=o===void 0?"100%":o,l=e.height,c=l===void 0?"100%":l,d=e.minWidth,u=d===void 0?0:d,f=e.minHeight,h=e.maxHeight,m=e.children,x=e.debounce,g=x===void 0?0:x,v=e.id,y=e.className,b=e.onResize,w=e.style,j=w===void 0?{}:w,_=p.useRef(null),C=p.useRef();C.current=b,p.useImperativeHandle(t,function(){return Object.defineProperty(_.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),_.current},configurable:!0})});var A=p.useState({containerWidth:s.width,containerHeight:s.height}),S=W3e(A,2),P=S[0],M=S[1],O=p.useCallback(function(T,k){M(function($){var q=Math.round(T),z=Math.round(k);return $.containerWidth===q&&$.containerHeight===z?$:{containerWidth:q,containerHeight:z}})},[]);p.useEffect(function(){var T=function(V){var ue,_e=V[0].contentRect,U=_e.width,L=_e.height;O(U,L),(ue=C.current)===null||ue===void 0||ue.call(C,U,L)};g>0&&(T=hQ(T,g,{trailing:!0,leading:!1}));var k=new ResizeObserver(T),$=_.current.getBoundingClientRect(),q=$.width,z=$.height;return O(q,z),k.observe(_.current),function(){k.disconnect()}},[O,g]);var I=p.useMemo(function(){var T=P.containerWidth,k=P.containerHeight;if(T<0||k<0)return null;af(bg(i)||bg(c),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,i,c),af(!r||r>0,"The aspect(%s) must be greater than zero.",r);var $=bg(i)?T:i,q=bg(c)?k:c;r&&r>0&&($?q=$/r:q&&($=q*r),h&&q>h&&(q=h)),af($>0||q>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,$,q,i,c,u,f,r);var z=!Array.isArray(m)&&Om(m.type).endsWith("Chart");return Ce.Children.map(m,function(F){return Ce.isValidElement(F)?p.cloneElement(F,T2({width:$,height:q},z?{style:T2({height:"100%",width:"100%",maxHeight:q,maxWidth:$},F.props.style)}:{})):F})},[r,m,c,h,f,u,P,i]);return Ce.createElement("div",{id:v?"".concat(v):void 0,className:ls("recharts-responsive-container",y),style:T2(T2({},j),{},{width:i,height:c,minWidth:u,minHeight:f,maxHeight:h}),ref:_},I)}),Kw=function(t){return null};Kw.displayName="Cell";function Xw(e){"@babel/helpers - typeof";return Xw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xw(e)}function RB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function YO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RB(Object(r),!0).forEach(function(n){Y3e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y3e(e,t,r){return t=J3e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J3e(e){var t=Q3e(e,"string");return Xw(t)=="symbol"?t:t+""}function Q3e(e,t){if(Xw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Xw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ux={widthCache:{},cacheCount:0},Z3e=2e3,e4e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},FB="recharts_measurement_span";function t4e(e){var t=YO({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var Gb=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||sf.isSsr)return{width:0,height:0};var n=t4e(r),s=JSON.stringify({text:t,copyStyle:n});if(Ux.widthCache[s])return Ux.widthCache[s];try{var o=document.getElementById(FB);o||(o=document.createElement("span"),o.setAttribute("id",FB),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var i=YO(YO({},e4e),n);Object.assign(o.style,i),o.textContent="".concat(t);var l=o.getBoundingClientRect(),c={width:l.width,height:l.height};return Ux.widthCache[s]=c,++Ux.cacheCount>Z3e&&(Ux.cacheCount=0,Ux.widthCache={}),c}catch{return{width:0,height:0}}},r4e=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Yw(e){"@babel/helpers - typeof";return Yw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yw(e)}function rS(e,t){return o4e(e)||s4e(e,t)||a4e(e,t)||n4e()}function n4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a4e(e,t){if(e){if(typeof e=="string")return LB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LB(e,t)}}function LB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function o4e(e){if(Array.isArray(e))return e}function i4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c4e(n.key),n)}}function l4e(e,t,r){return t&&$B(e.prototype,t),r&&$B(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c4e(e){var t=d4e(e,"string");return Yw(t)=="symbol"?t:t+""}function d4e(e,t){if(Yw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Yw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var BB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,qB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,u4e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,f4e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,pQ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},m4e=Object.keys(pQ),Ev="NaN";function h4e(e,t){return e*pQ[t]}var D2=function(){function e(t,r){i4e(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!u4e.test(r)&&(this.num=NaN,this.unit=""),m4e.includes(r)&&(this.num=h4e(t,r),this.unit="px")}return l4e(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,s=(n=f4e.exec(r))!==null&&n!==void 0?n:[],o=rS(s,3),i=o[1],l=o[2];return new e(parseFloat(i),l??"")}}])}();function gQ(e){if(e.includes(Ev))return Ev;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=BB.exec(t))!==null&&r!==void 0?r:[],s=rS(n,4),o=s[1],i=s[2],l=s[3],c=D2.parse(o??""),d=D2.parse(l??""),u=i==="*"?c.multiply(d):c.divide(d);if(u.isNaN())return Ev;t=t.replace(BB,u.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=qB.exec(t))!==null&&f!==void 0?f:[],m=rS(h,4),x=m[1],g=m[2],v=m[3],y=D2.parse(x??""),b=D2.parse(v??""),w=g==="+"?y.add(b):y.subtract(b);if(w.isNaN())return Ev;t=t.replace(qB,w.toString())}return t}var zB=/\(([^()]*)\)/;function p4e(e){for(var t=e;t.includes("(");){var r=zB.exec(t),n=rS(r,2),s=n[1];t=t.replace(zB,gQ(s))}return t}function g4e(e){var t=e.replace(/\s+/g,"");return t=p4e(t),t=gQ(t),t}function x4e(e){try{return g4e(e)}catch{return Ev}}function jE(e){var t=x4e(e.slice(5,-1));return t===Ev?"":t}var v4e=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],y4e=["dx","dy","angle","className","breakAll"];function JO(){return JO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JO.apply(this,arguments)}function UB(e,t){if(e==null)return{};var r=b4e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function b4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function VB(e,t){return N4e(e)||_4e(e,t)||j4e(e,t)||w4e()}function w4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function j4e(e,t){if(e){if(typeof e=="string")return WB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WB(e,t)}}function WB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function N4e(e){if(Array.isArray(e))return e}var xQ=/[ \f\n\r\t\v\u2028\u2029]+/,vQ=function(t){var r=t.children,n=t.breakAll,s=t.style;try{var o=[];ss(r)||(n?o=r.toString().split(""):o=r.toString().split(xQ));var i=o.map(function(c){return{word:c,width:Gb(c,s).width}}),l=n?0:Gb("",s).width;return{wordsWithComputedWidth:i,spaceWidth:l}}catch{return null}},S4e=function(t,r,n,s,o){var i=t.maxLines,l=t.children,c=t.style,d=t.breakAll,u=Rn(i),f=l,h=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return $.reduce(function(q,z){var F=z.word,V=z.width,ue=q[q.length-1];if(ue&&(s==null||o||ue.width+V+n<Number(s)))ue.words.push(F),ue.width+=V+n;else{var _e={words:[F],width:V};q.push(_e)}return q},[])},m=h(r),x=function($){return $.reduce(function(q,z){return q.width>z.width?q:z})};if(!u)return m;for(var g="",v=function($){var q=f.slice(0,$),z=vQ({breakAll:d,style:c,children:q+g}).wordsWithComputedWidth,F=h(z),V=F.length>i||x(F).width>Number(s);return[V,F]},y=0,b=f.length-1,w=0,j;y<=b&&w<=f.length-1;){var _=Math.floor((y+b)/2),C=_-1,A=v(C),S=VB(A,2),P=S[0],M=S[1],O=v(_),I=VB(O,1),T=I[0];if(!P&&!T&&(y=_+1),P&&T&&(b=_-1),!P&&T){j=M;break}w++}return j||m},HB=function(t){var r=ss(t)?[]:t.toString().split(xQ);return[{words:r}]},C4e=function(t){var r=t.width,n=t.scaleToFit,s=t.children,o=t.style,i=t.breakAll,l=t.maxLines;if((r||n)&&!sf.isSsr){var c,d,u=vQ({breakAll:i,children:s,style:o});if(u){var f=u.wordsWithComputedWidth,h=u.spaceWidth;c=f,d=h}else return HB(s);return S4e({breakAll:i,children:s,maxLines:l,style:o},c,d,r,n)}return HB(s)},GB="#808080",nx=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,i=t.lineHeight,l=i===void 0?"1em":i,c=t.capHeight,d=c===void 0?"0.71em":c,u=t.scaleToFit,f=u===void 0?!1:u,h=t.textAnchor,m=h===void 0?"start":h,x=t.verticalAnchor,g=x===void 0?"end":x,v=t.fill,y=v===void 0?GB:v,b=UB(t,v4e),w=p.useMemo(function(){return C4e({breakAll:b.breakAll,children:b.children,maxLines:b.maxLines,scaleToFit:f,style:b.style,width:b.width})},[b.breakAll,b.children,b.maxLines,f,b.style,b.width]),j=b.dx,_=b.dy,C=b.angle,A=b.className,S=b.breakAll,P=UB(b,y4e);if(!Gi(n)||!Gi(o))return null;var M=n+(Rn(j)?j:0),O=o+(Rn(_)?_:0),I;switch(g){case"start":I=jE("calc(".concat(d,")"));break;case"middle":I=jE("calc(".concat((w.length-1)/2," * -").concat(l," + (").concat(d," / 2))"));break;default:I=jE("calc(".concat(w.length-1," * -").concat(l,")"));break}var T=[];if(f){var k=w[0].width,$=b.width;T.push("scale(".concat((Rn($)?$/k:1)/k,")"))}return C&&T.push("rotate(".concat(C,", ").concat(M,", ").concat(O,")")),T.length&&(P.transform=T.join(" ")),Ce.createElement("text",JO({},ka(P,!0),{x:M,y:O,className:ls("recharts-text",A),textAnchor:m,fill:y.includes("url")?GB:y}),w.map(function(q,z){var F=q.words.join(S?"":" ");return Ce.createElement("tspan",{x:M,dy:z===0?I:l,key:"".concat(F,"-").concat(z)},F)}))};function np(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function P4e(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function CM(e){let t,r,n;e.length!==2?(t=np,r=(l,c)=>np(e(l),c),n=(l,c)=>e(l)-c):(t=e===np||e===P4e?e:A4e,r=e,n=e);function s(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;r(l[f],c)<0?d=f+1:u=f}while(d<u)}return d}function o(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;r(l[f],c)<=0?d=f+1:u=f}while(d<u)}return d}function i(l,c,d=0,u=l.length){const f=s(l,c,d,u-1);return f>d&&n(l[f-1],c)>-n(l[f],c)?f-1:f}return{left:s,center:i,right:o}}function A4e(){return 0}function yQ(e){return e===null?NaN:+e}function*E4e(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}const k4e=CM(np),I4e=k4e.right;CM(yQ).center;const lj=I4e;class KB extends Map{constructor(t,r=D4e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,s]of t)this.set(n,s)}get(t){return super.get(XB(this,t))}has(t){return super.has(XB(this,t))}set(t,r){return super.set(O4e(this,t),r)}delete(t){return super.delete(T4e(this,t))}}function XB({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function O4e({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function T4e({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function D4e(e){return e!==null&&typeof e=="object"?e.valueOf():e}function M4e(e=np){if(e===np)return bQ;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function bQ(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const R4e=Math.sqrt(50),F4e=Math.sqrt(10),L4e=Math.sqrt(2);function nS(e,t,r){const n=(t-e)/Math.max(0,r),s=Math.floor(Math.log10(n)),o=n/Math.pow(10,s),i=o>=R4e?10:o>=F4e?5:o>=L4e?2:1;let l,c,d;return s<0?(d=Math.pow(10,-s)/i,l=Math.round(e*d),c=Math.round(t*d),l/d<e&&++l,c/d>t&&--c,d=-d):(d=Math.pow(10,s)*i,l=Math.round(e/d),c=Math.round(t/d),l*d<e&&++l,c*d>t&&--c),c<l&&.5<=r&&r<2?nS(e,t,r*2):[l,c,d]}function QO(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[s,o,i]=n?nS(t,e,r):nS(e,t,r);if(!(o>=s))return[];const l=o-s+1,c=new Array(l);if(n)if(i<0)for(let d=0;d<l;++d)c[d]=(o-d)/-i;else for(let d=0;d<l;++d)c[d]=(o-d)*i;else if(i<0)for(let d=0;d<l;++d)c[d]=(s+d)/-i;else for(let d=0;d<l;++d)c[d]=(s+d)*i;return c}function ZO(e,t,r){return t=+t,e=+e,r=+r,nS(e,t,r)[2]}function eT(e,t,r){t=+t,e=+e,r=+r;const n=t<e,s=n?ZO(t,e,r):ZO(e,t,r);return(n?-1:1)*(s<0?1/-s:s)}function YB(e,t){let r;if(t===void 0)for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let s of e)(s=t(s,++n,e))!=null&&(r<s||r===void 0&&s>=s)&&(r=s)}return r}function JB(e,t){let r;if(t===void 0)for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let s of e)(s=t(s,++n,e))!=null&&(r>s||r===void 0&&s>=s)&&(r=s)}return r}function wQ(e,t,r=0,n=1/0,s){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(s=s===void 0?bQ:M4e(s);n>r;){if(n-r>600){const c=n-r+1,d=t-r+1,u=Math.log(c),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(c-f)/c)*(d-c/2<0?-1:1),m=Math.max(r,Math.floor(t-d*f/c+h)),x=Math.min(n,Math.floor(t+(c-d)*f/c+h));wQ(e,t,m,x,s)}const o=e[t];let i=r,l=n;for(Jy(e,r,t),s(e[n],o)>0&&Jy(e,r,n);i<l;){for(Jy(e,i,l),++i,--l;s(e[i],o)<0;)++i;for(;s(e[l],o)>0;)--l}s(e[r],o)===0?Jy(e,r,l):(++l,Jy(e,l,n)),l<=t&&(r=l+1),t<=l&&(n=l-1)}return e}function Jy(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function $4e(e,t,r){if(e=Float64Array.from(E4e(e,r)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return JB(e);if(t>=1)return YB(e);var n,s=(n-1)*t,o=Math.floor(s),i=YB(wQ(e,o).subarray(0,o+1)),l=JB(e.subarray(o+1));return i+(l-i)*(s-o)}}function B4e(e,t,r=yQ){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,s=(n-1)*t,o=Math.floor(s),i=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return i+(l-i)*(s-o)}}function q4e(e,t,r){e=+e,t=+t,r=(s=arguments.length)<2?(t=e,e=0,1):s<3?1:+r;for(var n=-1,s=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(s);++n<s;)o[n]=e+n*r;return o}function Au(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function eh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const tT=Symbol("implicit");function PM(){var e=new KB,t=[],r=[],n=tT;function s(o){let i=e.get(o);if(i===void 0){if(n!==tT)return n;e.set(o,i=t.push(o)-1)}return r[i%r.length]}return s.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new KB;for(const i of o)e.has(i)||e.set(i,t.push(i)-1);return s},s.range=function(o){return arguments.length?(r=Array.from(o),s):r.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return PM(t,r).unknown(n)},Au.apply(s,arguments),s}function Jw(){var e=PM().unknown(void 0),t=e.domain,r=e.range,n=0,s=1,o,i,l=!1,c=0,d=0,u=.5;delete e.unknown;function f(){var h=t().length,m=s<n,x=m?s:n,g=m?n:s;o=(g-x)/Math.max(1,h-c+d*2),l&&(o=Math.floor(o)),x+=(g-x-o*(h-c))*u,i=o*(1-c),l&&(x=Math.round(x),i=Math.round(i));var v=q4e(h).map(function(y){return x+o*y});return r(m?v.reverse():v)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,s]=h,n=+n,s=+s,f()):[n,s]},e.rangeRound=function(h){return[n,s]=h,n=+n,s=+s,l=!0,f()},e.bandwidth=function(){return i},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,f()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,d=+h),f()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),f()):c},e.paddingOuter=function(h){return arguments.length?(d=+h,f()):d},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),f()):u},e.copy=function(){return Jw(t(),[n,s]).round(l).paddingInner(c).paddingOuter(d).align(u)},Au.apply(f(),arguments)}function jQ(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return jQ(t())},e}function Kb(){return jQ(Jw.apply(null,arguments).paddingInner(1))}function AM(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function _Q(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function cj(){}var Qw=.7,aS=1/Qw,Yv="\\s*([+-]?\\d+)\\s*",Zw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",z4e=/^#([0-9a-f]{3,8})$/,U4e=new RegExp(`^rgb\\(${Yv},${Yv},${Yv}\\)$`),V4e=new RegExp(`^rgb\\(${Hf},${Hf},${Hf}\\)$`),W4e=new RegExp(`^rgba\\(${Yv},${Yv},${Yv},${Zw}\\)$`),H4e=new RegExp(`^rgba\\(${Hf},${Hf},${Hf},${Zw}\\)$`),G4e=new RegExp(`^hsl\\(${Zw},${Hf},${Hf}\\)$`),K4e=new RegExp(`^hsla\\(${Zw},${Hf},${Hf},${Zw}\\)$`),QB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};AM(cj,e1,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ZB,formatHex:ZB,formatHex8:X4e,formatHsl:Y4e,formatRgb:eq,toString:eq});function ZB(){return this.rgb().formatHex()}function X4e(){return this.rgb().formatHex8()}function Y4e(){return NQ(this).formatHsl()}function eq(){return this.rgb().formatRgb()}function e1(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=z4e.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?tq(t):r===3?new Vc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?M2(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?M2(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=U4e.exec(e))?new Vc(t[1],t[2],t[3],1):(t=V4e.exec(e))?new Vc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=W4e.exec(e))?M2(t[1],t[2],t[3],t[4]):(t=H4e.exec(e))?M2(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=G4e.exec(e))?aq(t[1],t[2]/100,t[3]/100,1):(t=K4e.exec(e))?aq(t[1],t[2]/100,t[3]/100,t[4]):QB.hasOwnProperty(e)?tq(QB[e]):e==="transparent"?new Vc(NaN,NaN,NaN,0):null}function tq(e){return new Vc(e>>16&255,e>>8&255,e&255,1)}function M2(e,t,r,n){return n<=0&&(e=t=r=NaN),new Vc(e,t,r,n)}function J4e(e){return e instanceof cj||(e=e1(e)),e?(e=e.rgb(),new Vc(e.r,e.g,e.b,e.opacity)):new Vc}function rT(e,t,r,n){return arguments.length===1?J4e(e):new Vc(e,t,r,n??1)}function Vc(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}AM(Vc,rT,_Q(cj,{brighter(e){return e=e==null?aS:Math.pow(aS,e),new Vc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Qw:Math.pow(Qw,e),new Vc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Vc(Rg(this.r),Rg(this.g),Rg(this.b),sS(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rq,formatHex:rq,formatHex8:Q4e,formatRgb:nq,toString:nq}));function rq(){return`#${wg(this.r)}${wg(this.g)}${wg(this.b)}`}function Q4e(){return`#${wg(this.r)}${wg(this.g)}${wg(this.b)}${wg((isNaN(this.opacity)?1:this.opacity)*255)}`}function nq(){const e=sS(this.opacity);return`${e===1?"rgb(":"rgba("}${Rg(this.r)}, ${Rg(this.g)}, ${Rg(this.b)}${e===1?")":`, ${e})`}`}function sS(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Rg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function wg(e){return e=Rg(e),(e<16?"0":"")+e.toString(16)}function aq(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Ju(e,t,r,n)}function NQ(e){if(e instanceof Ju)return new Ju(e.h,e.s,e.l,e.opacity);if(e instanceof cj||(e=e1(e)),!e)return new Ju;if(e instanceof Ju)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,s=Math.min(t,r,n),o=Math.max(t,r,n),i=NaN,l=o-s,c=(o+s)/2;return l?(t===o?i=(r-n)/l+(r<n)*6:r===o?i=(n-t)/l+2:i=(t-r)/l+4,l/=c<.5?o+s:2-o-s,i*=60):l=c>0&&c<1?0:i,new Ju(i,l,c,e.opacity)}function Z4e(e,t,r,n){return arguments.length===1?NQ(e):new Ju(e,t,r,n??1)}function Ju(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}AM(Ju,Z4e,_Q(cj,{brighter(e){return e=e==null?aS:Math.pow(aS,e),new Ju(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Qw:Math.pow(Qw,e),new Ju(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,s=2*r-n;return new Vc(_E(e>=240?e-240:e+120,s,n),_E(e,s,n),_E(e<120?e+240:e-120,s,n),this.opacity)},clamp(){return new Ju(sq(this.h),R2(this.s),R2(this.l),sS(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=sS(this.opacity);return`${e===1?"hsl(":"hsla("}${sq(this.h)}, ${R2(this.s)*100}%, ${R2(this.l)*100}%${e===1?")":`, ${e})`}`}}));function sq(e){return e=(e||0)%360,e<0?e+360:e}function R2(e){return Math.max(0,Math.min(1,e||0))}function _E(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const EM=e=>()=>e;function eDe(e,t){return function(r){return e+r*t}}function tDe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function rDe(e){return(e=+e)==1?SQ:function(t,r){return r-t?tDe(t,r,e):EM(isNaN(t)?r:t)}}function SQ(e,t){var r=t-e;return r?eDe(e,r):EM(isNaN(e)?t:e)}const oq=function e(t){var r=rDe(t);function n(s,o){var i=r((s=rT(s)).r,(o=rT(o)).r),l=r(s.g,o.g),c=r(s.b,o.b),d=SQ(s.opacity,o.opacity);return function(u){return s.r=i(u),s.g=l(u),s.b=c(u),s.opacity=d(u),s+""}}return n.gamma=e,n}(1);function nDe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),s;return function(o){for(s=0;s<r;++s)n[s]=e[s]*(1-o)+t[s]*o;return n}}function aDe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function sDe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,s=new Array(n),o=new Array(r),i;for(i=0;i<n;++i)s[i]=yy(e[i],t[i]);for(;i<r;++i)o[i]=t[i];return function(l){for(i=0;i<n;++i)o[i]=s[i](l);return o}}function oDe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function oS(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function iDe(e,t){var r={},n={},s;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in e?r[s]=yy(e[s],t[s]):n[s]=t[s];return function(o){for(s in r)n[s]=r[s](o);return n}}var nT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,NE=new RegExp(nT.source,"g");function lDe(e){return function(){return e}}function cDe(e){return function(t){return e(t)+""}}function dDe(e,t){var r=nT.lastIndex=NE.lastIndex=0,n,s,o,i=-1,l=[],c=[];for(e=e+"",t=t+"";(n=nT.exec(e))&&(s=NE.exec(t));)(o=s.index)>r&&(o=t.slice(r,o),l[i]?l[i]+=o:l[++i]=o),(n=n[0])===(s=s[0])?l[i]?l[i]+=s:l[++i]=s:(l[++i]=null,c.push({i,x:oS(n,s)})),r=NE.lastIndex;return r<t.length&&(o=t.slice(r),l[i]?l[i]+=o:l[++i]=o),l.length<2?c[0]?cDe(c[0].x):lDe(t):(t=c.length,function(d){for(var u=0,f;u<t;++u)l[(f=c[u]).i]=f.x(d);return l.join("")})}function yy(e,t){var r=typeof t,n;return t==null||r==="boolean"?EM(t):(r==="number"?oS:r==="string"?(n=e1(t))?(t=n,oq):dDe:t instanceof e1?oq:t instanceof Date?oDe:aDe(t)?nDe:Array.isArray(t)?sDe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?iDe:oS)(e,t)}function kM(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function uDe(e,t){t===void 0&&(t=e,e=yy);for(var r=0,n=t.length-1,s=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(s,s=t[++r]);return function(i){var l=Math.max(0,Math.min(n-1,Math.floor(i*=n)));return o[l](i-l)}}function fDe(e){return function(){return e}}function iS(e){return+e}var iq=[0,1];function wc(e){return e}function aT(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:fDe(isNaN(t)?NaN:.5)}function mDe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function hDe(e,t,r){var n=e[0],s=e[1],o=t[0],i=t[1];return s<n?(n=aT(s,n),o=r(i,o)):(n=aT(n,s),o=r(o,i)),function(l){return o(n(l))}}function pDe(e,t,r){var n=Math.min(e.length,t.length)-1,s=new Array(n),o=new Array(n),i=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<n;)s[i]=aT(e[i],e[i+1]),o[i]=r(t[i],t[i+1]);return function(l){var c=lj(e,l,1,n)-1;return o[c](s[c](l))}}function dj(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function L5(){var e=iq,t=iq,r=yy,n,s,o,i=wc,l,c,d;function u(){var h=Math.min(e.length,t.length);return i!==wc&&(i=mDe(e[0],e[h-1])),l=h>2?pDe:hDe,c=d=null,f}function f(h){return h==null||isNaN(h=+h)?o:(c||(c=l(e.map(n),t,r)))(n(i(h)))}return f.invert=function(h){return i(s((d||(d=l(t,e.map(n),oS)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,iS),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=kM,u()},f.clamp=function(h){return arguments.length?(i=h?!0:wc,u()):i!==wc},f.interpolate=function(h){return arguments.length?(r=h,u()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,m){return n=h,s=m,u()}}function IM(){return L5()(wc,wc)}function gDe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function lS(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function _0(e){return e=lS(Math.abs(e)),e?e[1]:NaN}function xDe(e,t){return function(r,n){for(var s=r.length,o=[],i=0,l=e[0],c=0;s>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),o.push(r.substring(s-=l,s+l)),!((c+=l+1)>n));)l=e[i=(i+1)%e.length];return o.reverse().join(t)}}function vDe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var yDe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function t1(e){if(!(t=yDe.exec(e)))throw new Error("invalid format: "+e);var t;return new OM({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}t1.prototype=OM.prototype;function OM(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}OM.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function bDe(e){e:for(var t=e.length,r=1,n=-1,s;r<t;++r)switch(e[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(s+1):e}var CQ;function wDe(e,t){var r=lS(e,t);if(!r)return e+"";var n=r[0],s=r[1],o=s-(CQ=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,i=n.length;return o===i?n:o>i?n+new Array(o-i+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+lS(e,Math.max(0,t+o-1))[0]}function lq(e,t){var r=lS(e,t);if(!r)return e+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const cq={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:gDe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>lq(e*100,t),r:lq,s:wDe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function dq(e){return e}var uq=Array.prototype.map,fq=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function jDe(e){var t=e.grouping===void 0||e.thousands===void 0?dq:xDe(uq.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",s=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?dq:vDe(uq.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function d(f){f=t1(f);var h=f.fill,m=f.align,x=f.sign,g=f.symbol,v=f.zero,y=f.width,b=f.comma,w=f.precision,j=f.trim,_=f.type;_==="n"?(b=!0,_="g"):cq[_]||(w===void 0&&(w=12),j=!0,_="g"),(v||h==="0"&&m==="=")&&(v=!0,h="0",m="=");var C=g==="$"?r:g==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",A=g==="$"?n:/[%p]/.test(_)?i:"",S=cq[_],P=/[defgprs%]/.test(_);w=w===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function M(O){var I=C,T=A,k,$,q;if(_==="c")T=S(O)+T,O="";else{O=+O;var z=O<0||1/O<0;if(O=isNaN(O)?c:S(Math.abs(O),w),j&&(O=bDe(O)),z&&+O==0&&x!=="+"&&(z=!1),I=(z?x==="("?x:l:x==="-"||x==="("?"":x)+I,T=(_==="s"?fq[8+CQ/3]:"")+T+(z&&x==="("?")":""),P){for(k=-1,$=O.length;++k<$;)if(q=O.charCodeAt(k),48>q||q>57){T=(q===46?s+O.slice(k+1):O.slice(k))+T,O=O.slice(0,k);break}}}b&&!v&&(O=t(O,1/0));var F=I.length+O.length+T.length,V=F<y?new Array(y-F+1).join(h):"";switch(b&&v&&(O=t(V+O,V.length?y-T.length:1/0),V=""),m){case"<":O=I+O+T+V;break;case"=":O=I+V+O+T;break;case"^":O=V.slice(0,F=V.length>>1)+I+O+T+V.slice(F);break;default:O=V+I+O+T;break}return o(O)}return M.toString=function(){return f+""},M}function u(f,h){var m=d((f=t1(f),f.type="f",f)),x=Math.max(-8,Math.min(8,Math.floor(_0(h)/3)))*3,g=Math.pow(10,-x),v=fq[8+x/3];return function(y){return m(g*y)+v}}return{format:d,formatPrefix:u}}var F2,TM,PQ;_De({thousands:",",grouping:[3],currency:["$",""]});function _De(e){return F2=jDe(e),TM=F2.format,PQ=F2.formatPrefix,F2}function NDe(e){return Math.max(0,-_0(Math.abs(e)))}function SDe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_0(t)/3)))*3-_0(Math.abs(e)))}function CDe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,_0(t)-_0(e))+1}function AQ(e,t,r,n){var s=eT(e,t,r),o;switch(n=t1(n??",f"),n.type){case"s":{var i=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=SDe(s,i))&&(n.precision=o),PQ(n,i)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=CDe(s,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=NDe(s))&&(n.precision=o-(n.type==="%")*2);break}}return TM(n)}function Dp(e){var t=e.domain;return e.ticks=function(r){var n=t();return QO(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var s=t();return AQ(s[0],s[s.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),s=0,o=n.length-1,i=n[s],l=n[o],c,d,u=10;for(l<i&&(d=i,i=l,l=d,d=s,s=o,o=d);u-- >0;){if(d=ZO(i,l,r),d===c)return n[s]=i,n[o]=l,t(n);if(d>0)i=Math.floor(i/d)*d,l=Math.ceil(l/d)*d;else if(d<0)i=Math.ceil(i*d)/d,l=Math.floor(l*d)/d;else break;c=d}return e},e}function cS(){var e=IM();return e.copy=function(){return dj(e,cS())},Au.apply(e,arguments),Dp(e)}function EQ(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,iS),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return EQ(e).unknown(t)},e=arguments.length?Array.from(e,iS):[0,1],Dp(r)}function kQ(e,t){e=e.slice();var r=0,n=e.length-1,s=e[r],o=e[n],i;return o<s&&(i=r,r=n,n=i,i=s,s=o,o=i),e[r]=t.floor(s),e[n]=t.ceil(o),e}function mq(e){return Math.log(e)}function hq(e){return Math.exp(e)}function PDe(e){return-Math.log(-e)}function ADe(e){return-Math.exp(-e)}function EDe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function kDe(e){return e===10?EDe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function IDe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function pq(e){return(t,r)=>-e(-t,r)}function DM(e){const t=e(mq,hq),r=t.domain;let n=10,s,o;function i(){return s=IDe(n),o=kDe(n),r()[0]<0?(s=pq(s),o=pq(o),e(PDe,ADe)):e(mq,hq),t}return t.base=function(l){return arguments.length?(n=+l,i()):n},t.domain=function(l){return arguments.length?(r(l),i()):r()},t.ticks=l=>{const c=r();let d=c[0],u=c[c.length-1];const f=u<d;f&&([d,u]=[u,d]);let h=s(d),m=s(u),x,g;const v=l==null?10:+l;let y=[];if(!(n%1)&&m-h<v){if(h=Math.floor(h),m=Math.ceil(m),d>0){for(;h<=m;++h)for(x=1;x<n;++x)if(g=h<0?x/o(-h):x*o(h),!(g<d)){if(g>u)break;y.push(g)}}else for(;h<=m;++h)for(x=n-1;x>=1;--x)if(g=h>0?x/o(-h):x*o(h),!(g<d)){if(g>u)break;y.push(g)}y.length*2<v&&(y=QO(d,u,v))}else y=QO(h,m,Math.min(m-h,v)).map(o);return f?y.reverse():y},t.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=n===10?"s":","),typeof c!="function"&&(!(n%1)&&(c=t1(c)).precision==null&&(c.trim=!0),c=TM(c)),l===1/0)return c;const d=Math.max(1,n*l/t.ticks().length);return u=>{let f=u/o(Math.round(s(u)));return f*n<n-.5&&(f*=n),f<=d?c(u):""}},t.nice=()=>r(kQ(r(),{floor:l=>o(Math.floor(s(l))),ceil:l=>o(Math.ceil(s(l)))})),t}function IQ(){const e=DM(L5()).domain([1,10]);return e.copy=()=>dj(e,IQ()).base(e.base()),Au.apply(e,arguments),e}function gq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function xq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function MM(e){var t=1,r=e(gq(t),xq(t));return r.constant=function(n){return arguments.length?e(gq(t=+n),xq(t)):t},Dp(r)}function OQ(){var e=MM(L5());return e.copy=function(){return dj(e,OQ()).constant(e.constant())},Au.apply(e,arguments)}function vq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ODe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function TDe(e){return e<0?-e*e:e*e}function RM(e){var t=e(wc,wc),r=1;function n(){return r===1?e(wc,wc):r===.5?e(ODe,TDe):e(vq(r),vq(1/r))}return t.exponent=function(s){return arguments.length?(r=+s,n()):r},Dp(t)}function FM(){var e=RM(L5());return e.copy=function(){return dj(e,FM()).exponent(e.exponent())},Au.apply(e,arguments),e}function DDe(){return FM.apply(null,arguments).exponent(.5)}function yq(e){return Math.sign(e)*e*e}function MDe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function TQ(){var e=IM(),t=[0,1],r=!1,n;function s(o){var i=MDe(e(o));return isNaN(i)?n:r?Math.round(i):i}return s.invert=function(o){return e.invert(yq(o))},s.domain=function(o){return arguments.length?(e.domain(o),s):e.domain()},s.range=function(o){return arguments.length?(e.range((t=Array.from(o,iS)).map(yq)),s):t.slice()},s.rangeRound=function(o){return s.range(o).round(!0)},s.round=function(o){return arguments.length?(r=!!o,s):r},s.clamp=function(o){return arguments.length?(e.clamp(o),s):e.clamp()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return TQ(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Au.apply(s,arguments),Dp(s)}function DQ(){var e=[],t=[],r=[],n;function s(){var i=0,l=Math.max(1,t.length);for(r=new Array(l-1);++i<l;)r[i-1]=B4e(e,i/l);return o}function o(i){return i==null||isNaN(i=+i)?n:t[lj(r,i)]}return o.invertExtent=function(i){var l=t.indexOf(i);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(i){if(!arguments.length)return e.slice();e=[];for(let l of i)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(np),s()},o.range=function(i){return arguments.length?(t=Array.from(i),s()):t.slice()},o.unknown=function(i){return arguments.length?(n=i,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return DQ().domain(e).range(t).unknown(n)},Au.apply(o,arguments)}function MQ(){var e=0,t=1,r=1,n=[.5],s=[0,1],o;function i(c){return c!=null&&c<=c?s[lj(n,c,0,r)]:o}function l(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return i}return i.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,l()):[e,t]},i.range=function(c){return arguments.length?(r=(s=Array.from(c)).length-1,l()):s.slice()},i.invertExtent=function(c){var d=s.indexOf(c);return d<0?[NaN,NaN]:d<1?[e,n[0]]:d>=r?[n[r-1],t]:[n[d-1],n[d]]},i.unknown=function(c){return arguments.length&&(o=c),i},i.thresholds=function(){return n.slice()},i.copy=function(){return MQ().domain([e,t]).range(s).unknown(o)},Au.apply(Dp(i),arguments)}function RQ(){var e=[.5],t=[0,1],r,n=1;function s(o){return o!=null&&o<=o?t[lj(e,o,0,n)]:r}return s.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),s):e.slice()},s.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),s):t.slice()},s.invertExtent=function(o){var i=t.indexOf(o);return[e[i-1],e[i]]},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return RQ().domain(e).range(t).unknown(r)},Au.apply(s,arguments)}const SE=new Date,CE=new Date;function Ki(e,t,r,n){function s(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return s.floor=o=>(e(o=new Date(+o)),o),s.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),s.round=o=>{const i=s(o),l=s.ceil(o);return o-i<l-o?i:l},s.offset=(o,i)=>(t(o=new Date(+o),i==null?1:Math.floor(i)),o),s.range=(o,i,l)=>{const c=[];if(o=s.ceil(o),l=l==null?1:Math.floor(l),!(o<i)||!(l>0))return c;let d;do c.push(d=new Date(+o)),t(o,l),e(o);while(d<o&&o<i);return c},s.filter=o=>Ki(i=>{if(i>=i)for(;e(i),!o(i);)i.setTime(i-1)},(i,l)=>{if(i>=i)if(l<0)for(;++l<=0;)for(;t(i,-1),!o(i););else for(;--l>=0;)for(;t(i,1),!o(i););}),r&&(s.count=(o,i)=>(SE.setTime(+o),CE.setTime(+i),e(SE),e(CE),Math.floor(r(SE,CE))),s.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?s.filter(n?i=>n(i)%o===0:i=>s.count(0,i)%o===0):s)),s}const dS=Ki(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);dS.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ki(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):dS);dS.range;const Sm=1e3,mu=Sm*60,Cm=mu*60,Vm=Cm*24,LM=Vm*7,bq=Vm*30,PE=Vm*365,jg=Ki(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Sm)},(e,t)=>(t-e)/Sm,e=>e.getUTCSeconds());jg.range;const $M=Ki(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Sm)},(e,t)=>{e.setTime(+e+t*mu)},(e,t)=>(t-e)/mu,e=>e.getMinutes());$M.range;const BM=Ki(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*mu)},(e,t)=>(t-e)/mu,e=>e.getUTCMinutes());BM.range;const qM=Ki(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Sm-e.getMinutes()*mu)},(e,t)=>{e.setTime(+e+t*Cm)},(e,t)=>(t-e)/Cm,e=>e.getHours());qM.range;const zM=Ki(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Cm)},(e,t)=>(t-e)/Cm,e=>e.getUTCHours());zM.range;const uj=Ki(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*mu)/Vm,e=>e.getDate()-1);uj.range;const $5=Ki(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Vm,e=>e.getUTCDate()-1);$5.range;const FQ=Ki(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Vm,e=>Math.floor(e/Vm));FQ.range;function jx(e){return Ki(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*mu)/LM)}const B5=jx(0),uS=jx(1),RDe=jx(2),FDe=jx(3),N0=jx(4),LDe=jx(5),$De=jx(6);B5.range;uS.range;RDe.range;FDe.range;N0.range;LDe.range;$De.range;function _x(e){return Ki(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/LM)}const q5=_x(0),fS=_x(1),BDe=_x(2),qDe=_x(3),S0=_x(4),zDe=_x(5),UDe=_x(6);q5.range;fS.range;BDe.range;qDe.range;S0.range;zDe.range;UDe.range;const UM=Ki(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());UM.range;const VM=Ki(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());VM.range;const Wm=Ki(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Wm.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ki(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Wm.range;const Hm=Ki(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Hm.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ki(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Hm.range;function LQ(e,t,r,n,s,o){const i=[[jg,1,Sm],[jg,5,5*Sm],[jg,15,15*Sm],[jg,30,30*Sm],[o,1,mu],[o,5,5*mu],[o,15,15*mu],[o,30,30*mu],[s,1,Cm],[s,3,3*Cm],[s,6,6*Cm],[s,12,12*Cm],[n,1,Vm],[n,2,2*Vm],[r,1,LM],[t,1,bq],[t,3,3*bq],[e,1,PE]];function l(d,u,f){const h=u<d;h&&([d,u]=[u,d]);const m=f&&typeof f.range=="function"?f:c(d,u,f),x=m?m.range(d,+u+1):[];return h?x.reverse():x}function c(d,u,f){const h=Math.abs(u-d)/f,m=CM(([,,v])=>v).right(i,h);if(m===i.length)return e.every(eT(d/PE,u/PE,f));if(m===0)return dS.every(Math.max(eT(d,u,f),1));const[x,g]=i[h/i[m-1][2]<i[m][2]/h?m-1:m];return x.every(g)}return[l,c]}const[VDe,WDe]=LQ(Hm,VM,q5,FQ,zM,BM),[HDe,GDe]=LQ(Wm,UM,B5,uj,qM,$M);function AE(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function EE(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Qy(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function KDe(e){var t=e.dateTime,r=e.date,n=e.time,s=e.periods,o=e.days,i=e.shortDays,l=e.months,c=e.shortMonths,d=Zy(s),u=eb(s),f=Zy(o),h=eb(o),m=Zy(i),x=eb(i),g=Zy(l),v=eb(l),y=Zy(c),b=eb(c),w={a:z,A:F,b:V,B:ue,c:null,d:Cq,e:Cq,f:xMe,g:PMe,G:EMe,H:hMe,I:pMe,j:gMe,L:$Q,m:vMe,M:yMe,p:_e,q:U,Q:Eq,s:kq,S:bMe,u:wMe,U:jMe,V:_Me,w:NMe,W:SMe,x:null,X:null,y:CMe,Y:AMe,Z:kMe,"%":Aq},j={a:L,A:G,b:de,B:X,c:null,d:Pq,e:Pq,f:DMe,g:VMe,G:HMe,H:IMe,I:OMe,j:TMe,L:qQ,m:MMe,M:RMe,p:W,q:Y,Q:Eq,s:kq,S:FMe,u:LMe,U:$Me,V:BMe,w:qMe,W:zMe,x:null,X:null,y:UMe,Y:WMe,Z:GMe,"%":Aq},_={a:M,A:O,b:I,B:T,c:k,d:Nq,e:Nq,f:dMe,g:_q,G:jq,H:Sq,I:Sq,j:oMe,L:cMe,m:sMe,M:iMe,p:P,q:aMe,Q:fMe,s:mMe,S:lMe,u:ZDe,U:eMe,V:tMe,w:QDe,W:rMe,x:$,X:q,y:_q,Y:jq,Z:nMe,"%":uMe};w.x=C(r,w),w.X=C(n,w),w.c=C(t,w),j.x=C(r,j),j.X=C(n,j),j.c=C(t,j);function C(me,ee){return function(ae){var le=[],Te=-1,te=0,ie=me.length,xt,vt,dt;for(ae instanceof Date||(ae=new Date(+ae));++Te<ie;)me.charCodeAt(Te)===37&&(le.push(me.slice(te,Te)),(vt=wq[xt=me.charAt(++Te)])!=null?xt=me.charAt(++Te):vt=xt==="e"?" ":"0",(dt=ee[xt])&&(xt=dt(ae,vt)),le.push(xt),te=Te+1);return le.push(me.slice(te,Te)),le.join("")}}function A(me,ee){return function(ae){var le=Qy(1900,void 0,1),Te=S(le,me,ae+="",0),te,ie;if(Te!=ae.length)return null;if("Q"in le)return new Date(le.Q);if("s"in le)return new Date(le.s*1e3+("L"in le?le.L:0));if(ee&&!("Z"in le)&&(le.Z=0),"p"in le&&(le.H=le.H%12+le.p*12),le.m===void 0&&(le.m="q"in le?le.q:0),"V"in le){if(le.V<1||le.V>53)return null;"w"in le||(le.w=1),"Z"in le?(te=EE(Qy(le.y,0,1)),ie=te.getUTCDay(),te=ie>4||ie===0?fS.ceil(te):fS(te),te=$5.offset(te,(le.V-1)*7),le.y=te.getUTCFullYear(),le.m=te.getUTCMonth(),le.d=te.getUTCDate()+(le.w+6)%7):(te=AE(Qy(le.y,0,1)),ie=te.getDay(),te=ie>4||ie===0?uS.ceil(te):uS(te),te=uj.offset(te,(le.V-1)*7),le.y=te.getFullYear(),le.m=te.getMonth(),le.d=te.getDate()+(le.w+6)%7)}else("W"in le||"U"in le)&&("w"in le||(le.w="u"in le?le.u%7:"W"in le?1:0),ie="Z"in le?EE(Qy(le.y,0,1)).getUTCDay():AE(Qy(le.y,0,1)).getDay(),le.m=0,le.d="W"in le?(le.w+6)%7+le.W*7-(ie+5)%7:le.w+le.U*7-(ie+6)%7);return"Z"in le?(le.H+=le.Z/100|0,le.M+=le.Z%100,EE(le)):AE(le)}}function S(me,ee,ae,le){for(var Te=0,te=ee.length,ie=ae.length,xt,vt;Te<te;){if(le>=ie)return-1;if(xt=ee.charCodeAt(Te++),xt===37){if(xt=ee.charAt(Te++),vt=_[xt in wq?ee.charAt(Te++):xt],!vt||(le=vt(me,ae,le))<0)return-1}else if(xt!=ae.charCodeAt(le++))return-1}return le}function P(me,ee,ae){var le=d.exec(ee.slice(ae));return le?(me.p=u.get(le[0].toLowerCase()),ae+le[0].length):-1}function M(me,ee,ae){var le=m.exec(ee.slice(ae));return le?(me.w=x.get(le[0].toLowerCase()),ae+le[0].length):-1}function O(me,ee,ae){var le=f.exec(ee.slice(ae));return le?(me.w=h.get(le[0].toLowerCase()),ae+le[0].length):-1}function I(me,ee,ae){var le=y.exec(ee.slice(ae));return le?(me.m=b.get(le[0].toLowerCase()),ae+le[0].length):-1}function T(me,ee,ae){var le=g.exec(ee.slice(ae));return le?(me.m=v.get(le[0].toLowerCase()),ae+le[0].length):-1}function k(me,ee,ae){return S(me,t,ee,ae)}function $(me,ee,ae){return S(me,r,ee,ae)}function q(me,ee,ae){return S(me,n,ee,ae)}function z(me){return i[me.getDay()]}function F(me){return o[me.getDay()]}function V(me){return c[me.getMonth()]}function ue(me){return l[me.getMonth()]}function _e(me){return s[+(me.getHours()>=12)]}function U(me){return 1+~~(me.getMonth()/3)}function L(me){return i[me.getUTCDay()]}function G(me){return o[me.getUTCDay()]}function de(me){return c[me.getUTCMonth()]}function X(me){return l[me.getUTCMonth()]}function W(me){return s[+(me.getUTCHours()>=12)]}function Y(me){return 1+~~(me.getUTCMonth()/3)}return{format:function(me){var ee=C(me+="",w);return ee.toString=function(){return me},ee},parse:function(me){var ee=A(me+="",!1);return ee.toString=function(){return me},ee},utcFormat:function(me){var ee=C(me+="",j);return ee.toString=function(){return me},ee},utcParse:function(me){var ee=A(me+="",!0);return ee.toString=function(){return me},ee}}}var wq={"-":"",_:" ",0:"0"},ml=/^\s*\d+/,XDe=/^%/,YDe=/[\\^$*+?|[\]().{}]/g;function Ys(e,t,r){var n=e<0?"-":"",s=(n?-e:e)+"",o=s.length;return n+(o<r?new Array(r-o+1).join(t)+s:s)}function JDe(e){return e.replace(YDe,"\\$&")}function Zy(e){return new RegExp("^(?:"+e.map(JDe).join("|")+")","i")}function eb(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function QDe(e,t,r){var n=ml.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function ZDe(e,t,r){var n=ml.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function eMe(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function tMe(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function rMe(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function jq(e,t,r){var n=ml.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function _q(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function nMe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function aMe(e,t,r){var n=ml.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function sMe(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function Nq(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function oMe(e,t,r){var n=ml.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Sq(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function iMe(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function lMe(e,t,r){var n=ml.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function cMe(e,t,r){var n=ml.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function dMe(e,t,r){var n=ml.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function uMe(e,t,r){var n=XDe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function fMe(e,t,r){var n=ml.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function mMe(e,t,r){var n=ml.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Cq(e,t){return Ys(e.getDate(),t,2)}function hMe(e,t){return Ys(e.getHours(),t,2)}function pMe(e,t){return Ys(e.getHours()%12||12,t,2)}function gMe(e,t){return Ys(1+uj.count(Wm(e),e),t,3)}function $Q(e,t){return Ys(e.getMilliseconds(),t,3)}function xMe(e,t){return $Q(e,t)+"000"}function vMe(e,t){return Ys(e.getMonth()+1,t,2)}function yMe(e,t){return Ys(e.getMinutes(),t,2)}function bMe(e,t){return Ys(e.getSeconds(),t,2)}function wMe(e){var t=e.getDay();return t===0?7:t}function jMe(e,t){return Ys(B5.count(Wm(e)-1,e),t,2)}function BQ(e){var t=e.getDay();return t>=4||t===0?N0(e):N0.ceil(e)}function _Me(e,t){return e=BQ(e),Ys(N0.count(Wm(e),e)+(Wm(e).getDay()===4),t,2)}function NMe(e){return e.getDay()}function SMe(e,t){return Ys(uS.count(Wm(e)-1,e),t,2)}function CMe(e,t){return Ys(e.getFullYear()%100,t,2)}function PMe(e,t){return e=BQ(e),Ys(e.getFullYear()%100,t,2)}function AMe(e,t){return Ys(e.getFullYear()%1e4,t,4)}function EMe(e,t){var r=e.getDay();return e=r>=4||r===0?N0(e):N0.ceil(e),Ys(e.getFullYear()%1e4,t,4)}function kMe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Ys(t/60|0,"0",2)+Ys(t%60,"0",2)}function Pq(e,t){return Ys(e.getUTCDate(),t,2)}function IMe(e,t){return Ys(e.getUTCHours(),t,2)}function OMe(e,t){return Ys(e.getUTCHours()%12||12,t,2)}function TMe(e,t){return Ys(1+$5.count(Hm(e),e),t,3)}function qQ(e,t){return Ys(e.getUTCMilliseconds(),t,3)}function DMe(e,t){return qQ(e,t)+"000"}function MMe(e,t){return Ys(e.getUTCMonth()+1,t,2)}function RMe(e,t){return Ys(e.getUTCMinutes(),t,2)}function FMe(e,t){return Ys(e.getUTCSeconds(),t,2)}function LMe(e){var t=e.getUTCDay();return t===0?7:t}function $Me(e,t){return Ys(q5.count(Hm(e)-1,e),t,2)}function zQ(e){var t=e.getUTCDay();return t>=4||t===0?S0(e):S0.ceil(e)}function BMe(e,t){return e=zQ(e),Ys(S0.count(Hm(e),e)+(Hm(e).getUTCDay()===4),t,2)}function qMe(e){return e.getUTCDay()}function zMe(e,t){return Ys(fS.count(Hm(e)-1,e),t,2)}function UMe(e,t){return Ys(e.getUTCFullYear()%100,t,2)}function VMe(e,t){return e=zQ(e),Ys(e.getUTCFullYear()%100,t,2)}function WMe(e,t){return Ys(e.getUTCFullYear()%1e4,t,4)}function HMe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?S0(e):S0.ceil(e),Ys(e.getUTCFullYear()%1e4,t,4)}function GMe(){return"+0000"}function Aq(){return"%"}function Eq(e){return+e}function kq(e){return Math.floor(+e/1e3)}var Vx,UQ,VQ;KMe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function KMe(e){return Vx=KDe(e),UQ=Vx.format,Vx.parse,VQ=Vx.utcFormat,Vx.utcParse,Vx}function XMe(e){return new Date(e)}function YMe(e){return e instanceof Date?+e:+new Date(+e)}function WM(e,t,r,n,s,o,i,l,c,d){var u=IM(),f=u.invert,h=u.domain,m=d(".%L"),x=d(":%S"),g=d("%I:%M"),v=d("%I %p"),y=d("%a %d"),b=d("%b %d"),w=d("%B"),j=d("%Y");function _(C){return(c(C)<C?m:l(C)<C?x:i(C)<C?g:o(C)<C?v:n(C)<C?s(C)<C?y:b:r(C)<C?w:j)(C)}return u.invert=function(C){return new Date(f(C))},u.domain=function(C){return arguments.length?h(Array.from(C,YMe)):h().map(XMe)},u.ticks=function(C){var A=h();return e(A[0],A[A.length-1],C??10)},u.tickFormat=function(C,A){return A==null?_:d(A)},u.nice=function(C){var A=h();return(!C||typeof C.range!="function")&&(C=t(A[0],A[A.length-1],C??10)),C?h(kQ(A,C)):u},u.copy=function(){return dj(u,WM(e,t,r,n,s,o,i,l,c,d))},u}function JMe(){return Au.apply(WM(HDe,GDe,Wm,UM,B5,uj,qM,$M,jg,UQ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function QMe(){return Au.apply(WM(VDe,WDe,Hm,VM,q5,$5,zM,BM,jg,VQ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function z5(){var e=0,t=1,r,n,s,o,i=wc,l=!1,c;function d(f){return f==null||isNaN(f=+f)?c:i(s===0?.5:(f=(o(f)-r)*s,l?Math.max(0,Math.min(1,f)):f))}d.domain=function(f){return arguments.length?([e,t]=f,r=o(e=+e),n=o(t=+t),s=r===n?0:1/(n-r),d):[e,t]},d.clamp=function(f){return arguments.length?(l=!!f,d):l},d.interpolator=function(f){return arguments.length?(i=f,d):i};function u(f){return function(h){var m,x;return arguments.length?([m,x]=h,i=f(m,x),d):[i(0),i(1)]}}return d.range=u(yy),d.rangeRound=u(kM),d.unknown=function(f){return arguments.length?(c=f,d):c},function(f){return o=f,r=f(e),n=f(t),s=r===n?0:1/(n-r),d}}function Mp(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function WQ(){var e=Dp(z5()(wc));return e.copy=function(){return Mp(e,WQ())},eh.apply(e,arguments)}function HQ(){var e=DM(z5()).domain([1,10]);return e.copy=function(){return Mp(e,HQ()).base(e.base())},eh.apply(e,arguments)}function GQ(){var e=MM(z5());return e.copy=function(){return Mp(e,GQ()).constant(e.constant())},eh.apply(e,arguments)}function HM(){var e=RM(z5());return e.copy=function(){return Mp(e,HM()).exponent(e.exponent())},eh.apply(e,arguments)}function ZMe(){return HM.apply(null,arguments).exponent(.5)}function KQ(){var e=[],t=wc;function r(n){if(n!=null&&!isNaN(n=+n))return t((lj(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let s of n)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(np),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,s)=>t(s/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(s,o)=>$4e(e,o/n))},r.copy=function(){return KQ(t).domain(e)},eh.apply(r,arguments)}function U5(){var e=0,t=.5,r=1,n=1,s,o,i,l,c,d=wc,u,f=!1,h;function m(g){return isNaN(g=+g)?h:(g=.5+((g=+u(g))-o)*(n*g<n*o?l:c),d(f?Math.max(0,Math.min(1,g)):g))}m.domain=function(g){return arguments.length?([e,t,r]=g,s=u(e=+e),o=u(t=+t),i=u(r=+r),l=s===o?0:.5/(o-s),c=o===i?0:.5/(i-o),n=o<s?-1:1,m):[e,t,r]},m.clamp=function(g){return arguments.length?(f=!!g,m):f},m.interpolator=function(g){return arguments.length?(d=g,m):d};function x(g){return function(v){var y,b,w;return arguments.length?([y,b,w]=v,d=uDe(g,[y,b,w]),m):[d(0),d(.5),d(1)]}}return m.range=x(yy),m.rangeRound=x(kM),m.unknown=function(g){return arguments.length?(h=g,m):h},function(g){return u=g,s=g(e),o=g(t),i=g(r),l=s===o?0:.5/(o-s),c=o===i?0:.5/(i-o),n=o<s?-1:1,m}}function XQ(){var e=Dp(U5()(wc));return e.copy=function(){return Mp(e,XQ())},eh.apply(e,arguments)}function YQ(){var e=DM(U5()).domain([.1,1,10]);return e.copy=function(){return Mp(e,YQ()).base(e.base())},eh.apply(e,arguments)}function JQ(){var e=MM(U5());return e.copy=function(){return Mp(e,JQ()).constant(e.constant())},eh.apply(e,arguments)}function GM(){var e=RM(U5());return e.copy=function(){return Mp(e,GM()).exponent(e.exponent())},eh.apply(e,arguments)}function eRe(){return GM.apply(null,arguments).exponent(.5)}const Iq=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Jw,scaleDiverging:XQ,scaleDivergingLog:YQ,scaleDivergingPow:GM,scaleDivergingSqrt:eRe,scaleDivergingSymlog:JQ,scaleIdentity:EQ,scaleImplicit:tT,scaleLinear:cS,scaleLog:IQ,scaleOrdinal:PM,scalePoint:Kb,scalePow:FM,scaleQuantile:DQ,scaleQuantize:MQ,scaleRadial:TQ,scaleSequential:WQ,scaleSequentialLog:HQ,scaleSequentialPow:HM,scaleSequentialQuantile:KQ,scaleSequentialSqrt:ZMe,scaleSequentialSymlog:GQ,scaleSqrt:DDe,scaleSymlog:OQ,scaleThreshold:RQ,scaleTime:JMe,scaleUtc:QMe,tickFormat:AQ},Symbol.toStringTag,{value:"Module"}));var tRe=dy;function rRe(e,t,r){for(var n=-1,s=e.length;++n<s;){var o=e[n],i=t(o);if(i!=null&&(l===void 0?i===i&&!tRe(i):r(i,l)))var l=i,c=o}return c}var V5=rRe;function nRe(e,t){return e>t}var QQ=nRe,aRe=V5,sRe=QQ,oRe=vy;function iRe(e){return e&&e.length?aRe(e,oRe,sRe):void 0}var lRe=iRe;const Fh=Ls(lRe);function cRe(e,t){return e<t}var ZQ=cRe,dRe=V5,uRe=ZQ,fRe=vy;function mRe(e){return e&&e.length?dRe(e,fRe,uRe):void 0}var hRe=mRe;const W5=Ls(hRe);var pRe=iM,gRe=nm,xRe=iQ,vRe=ed;function yRe(e,t){var r=vRe(e)?pRe:xRe;return r(e,gRe(t))}var bRe=yRe,wRe=sQ,jRe=bRe;function _Re(e,t){return wRe(jRe(e,t),1)}var NRe=_Re;const SRe=Ls(NRe);var CRe=jM;function PRe(e,t){return CRe(e,t)}var ARe=PRe;const ax=Ls(ARe);var by=1e9,ERe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},XM,Go=!0,Nu="[DecimalError] ",Fg=Nu+"Invalid argument: ",KM=Nu+"Exponent out of range: ",wy=Math.floor,ig=Math.pow,kRe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,jd,al=1e7,$o=7,eZ=9007199254740991,mS=wy(eZ/$o),xa={};xa.absoluteValue=xa.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};xa.comparedTo=xa.cmp=function(e){var t,r,n,s,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,s=e.d.length,t=0,r=n<s?n:s;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===s?0:n>s^o.s<0?1:-1};xa.decimalPlaces=xa.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*$o;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};xa.dividedBy=xa.div=function(e){return Tm(this,new this.constructor(e))};xa.dividedToIntegerBy=xa.idiv=function(e){var t=this,r=t.constructor;return jo(Tm(t,new r(e),0,1),r.precision)};xa.equals=xa.eq=function(e){return!this.cmp(e)};xa.exponent=function(){return Ti(this)};xa.greaterThan=xa.gt=function(e){return this.cmp(e)>0};xa.greaterThanOrEqualTo=xa.gte=function(e){return this.cmp(e)>=0};xa.isInteger=xa.isint=function(){return this.e>this.d.length-2};xa.isNegative=xa.isneg=function(){return this.s<0};xa.isPositive=xa.ispos=function(){return this.s>0};xa.isZero=function(){return this.s===0};xa.lessThan=xa.lt=function(e){return this.cmp(e)<0};xa.lessThanOrEqualTo=xa.lte=function(e){return this.cmp(e)<1};xa.logarithm=xa.log=function(e){var t,r=this,n=r.constructor,s=n.precision,o=s+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(jd))throw Error(Nu+"NaN");if(r.s<1)throw Error(Nu+(r.s?"NaN":"-Infinity"));return r.eq(jd)?new n(0):(Go=!1,t=Tm(r1(r,o),r1(e,o),o),Go=!0,jo(t,s))};xa.minus=xa.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?nZ(t,e):tZ(t,(e.s=-e.s,e))};xa.modulo=xa.mod=function(e){var t,r=this,n=r.constructor,s=n.precision;if(e=new n(e),!e.s)throw Error(Nu+"NaN");return r.s?(Go=!1,t=Tm(r,e,0,1).times(e),Go=!0,r.minus(t)):jo(new n(r),s)};xa.naturalExponential=xa.exp=function(){return rZ(this)};xa.naturalLogarithm=xa.ln=function(){return r1(this)};xa.negated=xa.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};xa.plus=xa.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?tZ(t,e):nZ(t,(e.s=-e.s,e))};xa.precision=xa.sd=function(e){var t,r,n,s=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Fg+e);if(t=Ti(s)+1,n=s.d.length-1,r=n*$o+1,n=s.d[n],n){for(;n%10==0;n/=10)r--;for(n=s.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};xa.squareRoot=xa.sqrt=function(){var e,t,r,n,s,o,i,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(Nu+"NaN")}for(e=Ti(l),Go=!1,s=Math.sqrt(+l),s==0||s==1/0?(t=Rf(l.d),(t.length+e)%2==0&&(t+="0"),s=Math.sqrt(t),e=wy((e+1)/2)-(e<0||e%2),s==1/0?t="5e"+e:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new c(t)):n=new c(s.toString()),r=c.precision,s=i=r+3;;)if(o=n,n=o.plus(Tm(l,o,i+2)).times(.5),Rf(o.d).slice(0,i)===(t=Rf(n.d)).slice(0,i)){if(t=t.slice(i-3,i+1),s==i&&t=="4999"){if(jo(o,r+1,0),o.times(o).eq(l)){n=o;break}}else if(t!="9999")break;i+=4}return Go=!0,jo(n,r)};xa.times=xa.mul=function(e){var t,r,n,s,o,i,l,c,d,u=this,f=u.constructor,h=u.d,m=(e=new f(e)).d;if(!u.s||!e.s)return new f(0);for(e.s*=u.s,r=u.e+e.e,c=h.length,d=m.length,c<d&&(o=h,h=m,m=o,i=c,c=d,d=i),o=[],i=c+d,n=i;n--;)o.push(0);for(n=d;--n>=0;){for(t=0,s=c+n;s>n;)l=o[s]+m[n]*h[s-n-1]+t,o[s--]=l%al|0,t=l/al|0;o[s]=(o[s]+t)%al|0}for(;!o[--i];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,Go?jo(e,f.precision):e};xa.toDecimalPlaces=xa.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Zf(e,0,by),t===void 0?t=n.rounding:Zf(t,0,8),jo(r,e+Ti(r)+1,t))};xa.toExponential=function(e,t){var r,n=this,s=n.constructor;return e===void 0?r=sx(n,!0):(Zf(e,0,by),t===void 0?t=s.rounding:Zf(t,0,8),n=jo(new s(n),e+1,t),r=sx(n,!0,e+1)),r};xa.toFixed=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?sx(s):(Zf(e,0,by),t===void 0?t=o.rounding:Zf(t,0,8),n=jo(new o(s),e+Ti(s)+1,t),r=sx(n.abs(),!1,e+Ti(n)+1),s.isneg()&&!s.isZero()?"-"+r:r)};xa.toInteger=xa.toint=function(){var e=this,t=e.constructor;return jo(new t(e),Ti(e)+1,t.rounding)};xa.toNumber=function(){return+this};xa.toPower=xa.pow=function(e){var t,r,n,s,o,i,l=this,c=l.constructor,d=12,u=+(e=new c(e));if(!e.s)return new c(jd);if(l=new c(l),!l.s){if(e.s<1)throw Error(Nu+"Infinity");return l}if(l.eq(jd))return l;if(n=c.precision,e.eq(jd))return jo(l,n);if(t=e.e,r=e.d.length-1,i=t>=r,o=l.s,i){if((r=u<0?-u:u)<=eZ){for(s=new c(jd),t=Math.ceil(n/$o+4),Go=!1;r%2&&(s=s.times(l),Tq(s.d,t)),r=wy(r/2),r!==0;)l=l.times(l),Tq(l.d,t);return Go=!0,e.s<0?new c(jd).div(s):jo(s,n)}}else if(o<0)throw Error(Nu+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,l.s=1,Go=!1,s=e.times(r1(l,n+d)),Go=!0,s=rZ(s),s.s=o,s};xa.toPrecision=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?(r=Ti(s),n=sx(s,r<=o.toExpNeg||r>=o.toExpPos)):(Zf(e,1,by),t===void 0?t=o.rounding:Zf(t,0,8),s=jo(new o(s),e,t),r=Ti(s),n=sx(s,e<=r||r<=o.toExpNeg,e)),n};xa.toSignificantDigits=xa.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Zf(e,1,by),t===void 0?t=n.rounding:Zf(t,0,8)),jo(new n(r),e,t)};xa.toString=xa.valueOf=xa.val=xa.toJSON=xa[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Ti(e),r=e.constructor;return sx(e,t<=r.toExpNeg||t>=r.toExpPos)};function tZ(e,t){var r,n,s,o,i,l,c,d,u=e.constructor,f=u.precision;if(!e.s||!t.s)return t.s||(t=new u(e)),Go?jo(t,f):t;if(c=e.d,d=t.d,i=e.e,s=t.e,c=c.slice(),o=i-s,o){for(o<0?(n=c,o=-o,l=d.length):(n=d,s=i,l=c.length),i=Math.ceil(f/$o),l=i>l?i+1:l+1,o>l&&(o=l,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(l=c.length,o=d.length,l-o<0&&(o=l,n=d,d=c,c=n),r=0;o;)r=(c[--o]=c[o]+d[o]+r)/al|0,c[o]%=al;for(r&&(c.unshift(r),++s),l=c.length;c[--l]==0;)c.pop();return t.d=c,t.e=s,Go?jo(t,f):t}function Zf(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Fg+e)}function Rf(e){var t,r,n,s=e.length-1,o="",i=e[0];if(s>0){for(o+=i,t=1;t<s;t++)n=e[t]+"",r=$o-n.length,r&&(o+=Sh(r)),o+=n;i=e[t],n=i+"",r=$o-n.length,r&&(o+=Sh(r))}else if(i===0)return"0";for(;i%10===0;)i/=10;return o+i}var Tm=function(){function e(n,s){var o,i=0,l=n.length;for(n=n.slice();l--;)o=n[l]*s+i,n[l]=o%al|0,i=o/al|0;return i&&n.unshift(i),n}function t(n,s,o,i){var l,c;if(o!=i)c=o>i?1:-1;else for(l=c=0;l<o;l++)if(n[l]!=s[l]){c=n[l]>s[l]?1:-1;break}return c}function r(n,s,o){for(var i=0;o--;)n[o]-=i,i=n[o]<s[o]?1:0,n[o]=i*al+n[o]-s[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,s,o,i){var l,c,d,u,f,h,m,x,g,v,y,b,w,j,_,C,A,S,P=n.constructor,M=n.s==s.s?1:-1,O=n.d,I=s.d;if(!n.s)return new P(n);if(!s.s)throw Error(Nu+"Division by zero");for(c=n.e-s.e,A=I.length,_=O.length,m=new P(M),x=m.d=[],d=0;I[d]==(O[d]||0);)++d;if(I[d]>(O[d]||0)&&--c,o==null?b=o=P.precision:i?b=o+(Ti(n)-Ti(s))+1:b=o,b<0)return new P(0);if(b=b/$o+2|0,d=0,A==1)for(u=0,I=I[0],b++;(d<_||u)&&b--;d++)w=u*al+(O[d]||0),x[d]=w/I|0,u=w%I|0;else{for(u=al/(I[0]+1)|0,u>1&&(I=e(I,u),O=e(O,u),A=I.length,_=O.length),j=A,g=O.slice(0,A),v=g.length;v<A;)g[v++]=0;S=I.slice(),S.unshift(0),C=I[0],I[1]>=al/2&&++C;do u=0,l=t(I,g,A,v),l<0?(y=g[0],A!=v&&(y=y*al+(g[1]||0)),u=y/C|0,u>1?(u>=al&&(u=al-1),f=e(I,u),h=f.length,v=g.length,l=t(f,g,h,v),l==1&&(u--,r(f,A<h?S:I,h))):(u==0&&(l=u=1),f=I.slice()),h=f.length,h<v&&f.unshift(0),r(g,f,v),l==-1&&(v=g.length,l=t(I,g,A,v),l<1&&(u++,r(g,A<v?S:I,v))),v=g.length):l===0&&(u++,g=[0]),x[d++]=u,l&&g[0]?g[v++]=O[j]||0:(g=[O[j]],v=1);while((j++<_||g[0]!==void 0)&&b--)}return x[0]||x.shift(),m.e=c,jo(m,i?o+Ti(m)+1:o)}}();function rZ(e,t){var r,n,s,o,i,l,c=0,d=0,u=e.constructor,f=u.precision;if(Ti(e)>16)throw Error(KM+Ti(e));if(!e.s)return new u(jd);for(t==null?(Go=!1,l=f):l=t,i=new u(.03125);e.abs().gte(.1);)e=e.times(i),d+=5;for(n=Math.log(ig(2,d))/Math.LN10*2+5|0,l+=n,r=s=o=new u(jd),u.precision=l;;){if(s=jo(s.times(e),l),r=r.times(++c),i=o.plus(Tm(s,r,l)),Rf(i.d).slice(0,l)===Rf(o.d).slice(0,l)){for(;d--;)o=jo(o.times(o),l);return u.precision=f,t==null?(Go=!0,jo(o,f)):o}o=i}}function Ti(e){for(var t=e.e*$o,r=e.d[0];r>=10;r/=10)t++;return t}function kE(e,t,r){if(t>e.LN10.sd())throw Go=!0,r&&(e.precision=r),Error(Nu+"LN10 precision limit exceeded");return jo(new e(e.LN10),t)}function Sh(e){for(var t="";e--;)t+="0";return t}function r1(e,t){var r,n,s,o,i,l,c,d,u,f=1,h=10,m=e,x=m.d,g=m.constructor,v=g.precision;if(m.s<1)throw Error(Nu+(m.s?"NaN":"-Infinity"));if(m.eq(jd))return new g(0);if(t==null?(Go=!1,d=v):d=t,m.eq(10))return t==null&&(Go=!0),kE(g,d);if(d+=h,g.precision=d,r=Rf(x),n=r.charAt(0),o=Ti(m),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)m=m.times(e),r=Rf(m.d),n=r.charAt(0),f++;o=Ti(m),n>1?(m=new g("0."+r),o++):m=new g(n+"."+r.slice(1))}else return c=kE(g,d+2,v).times(o+""),m=r1(new g(n+"."+r.slice(1)),d-h).plus(c),g.precision=v,t==null?(Go=!0,jo(m,v)):m;for(l=i=m=Tm(m.minus(jd),m.plus(jd),d),u=jo(m.times(m),d),s=3;;){if(i=jo(i.times(u),d),c=l.plus(Tm(i,new g(s),d)),Rf(c.d).slice(0,d)===Rf(l.d).slice(0,d))return l=l.times(2),o!==0&&(l=l.plus(kE(g,d+2,v).times(o+""))),l=Tm(l,new g(f),d),g.precision=v,t==null?(Go=!0,jo(l,v)):l;l=c,s+=2}}function Oq(e,t){var r,n,s;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(s=t.length;t.charCodeAt(s-1)===48;)--s;if(t=t.slice(n,s),t){if(s-=n,r=r-n-1,e.e=wy(r/$o),e.d=[],n=(r+1)%$o,r<0&&(n+=$o),n<s){for(n&&e.d.push(+t.slice(0,n)),s-=$o;n<s;)e.d.push(+t.slice(n,n+=$o));t=t.slice(n),n=$o-t.length}else n-=s;for(;n--;)t+="0";if(e.d.push(+t),Go&&(e.e>mS||e.e<-mS))throw Error(KM+r)}else e.s=0,e.e=0,e.d=[0];return e}function jo(e,t,r){var n,s,o,i,l,c,d,u,f=e.d;for(i=1,o=f[0];o>=10;o/=10)i++;if(n=t-i,n<0)n+=$o,s=t,d=f[u=0];else{if(u=Math.ceil((n+1)/$o),o=f.length,u>=o)return e;for(d=o=f[u],i=1;o>=10;o/=10)i++;n%=$o,s=n-$o+i}if(r!==void 0&&(o=ig(10,i-s-1),l=d/o%10|0,c=t<0||f[u+1]!==void 0||d%o,c=r<4?(l||c)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||c||r==6&&(n>0?s>0?d/ig(10,i-s):0:f[u-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return c?(o=Ti(e),f.length=1,t=t-o-1,f[0]=ig(10,($o-t%$o)%$o),e.e=wy(-t/$o)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=u,o=1,u--):(f.length=u+1,o=ig(10,$o-n),f[u]=s>0?(d/ig(10,i-s)%ig(10,s)|0)*o:0),c)for(;;)if(u==0){(f[0]+=o)==al&&(f[0]=1,++e.e);break}else{if(f[u]+=o,f[u]!=al)break;f[u--]=0,o=1}for(n=f.length;f[--n]===0;)f.pop();if(Go&&(e.e>mS||e.e<-mS))throw Error(KM+Ti(e));return e}function nZ(e,t){var r,n,s,o,i,l,c,d,u,f,h=e.constructor,m=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),Go?jo(t,m):t;if(c=e.d,f=t.d,n=t.e,d=e.e,c=c.slice(),i=d-n,i){for(u=i<0,u?(r=c,i=-i,l=f.length):(r=f,n=d,l=c.length),s=Math.max(Math.ceil(m/$o),l)+2,i>s&&(i=s,r.length=1),r.reverse(),s=i;s--;)r.push(0);r.reverse()}else{for(s=c.length,l=f.length,u=s<l,u&&(l=s),s=0;s<l;s++)if(c[s]!=f[s]){u=c[s]<f[s];break}i=0}for(u&&(r=c,c=f,f=r,t.s=-t.s),l=c.length,s=f.length-l;s>0;--s)c[l++]=0;for(s=f.length;s>i;){if(c[--s]<f[s]){for(o=s;o&&c[--o]===0;)c[o]=al-1;--c[o],c[s]+=al}c[s]-=f[s]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(t.d=c,t.e=n,Go?jo(t,m):t):new h(0)}function sx(e,t,r){var n,s=Ti(e),o=Rf(e.d),i=o.length;return t?(r&&(n=r-i)>0?o=o.charAt(0)+"."+o.slice(1)+Sh(n):i>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(s<0?"e":"e+")+s):s<0?(o="0."+Sh(-s-1)+o,r&&(n=r-i)>0&&(o+=Sh(n))):s>=i?(o+=Sh(s+1-i),r&&(n=r-s-1)>0&&(o=o+"."+Sh(n))):((n=s+1)<i&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-i)>0&&(s+1===i&&(o+="."),o+=Sh(n))),e.s<0?"-"+o:o}function Tq(e,t){if(e.length>t)return e.length=t,!0}function aZ(e){var t,r,n;function s(o){var i=this;if(!(i instanceof s))return new s(o);if(i.constructor=s,o instanceof s){i.s=o.s,i.e=o.e,i.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(Fg+o);if(o>0)i.s=1;else if(o<0)o=-o,i.s=-1;else{i.s=0,i.e=0,i.d=[0];return}if(o===~~o&&o<1e7){i.e=0,i.d=[o];return}return Oq(i,o.toString())}else if(typeof o!="string")throw Error(Fg+o);if(o.charCodeAt(0)===45?(o=o.slice(1),i.s=-1):i.s=1,kRe.test(o))Oq(i,o);else throw Error(Fg+o)}if(s.prototype=xa,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=aZ,s.config=s.set=IRe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return s.config(e),s}function IRe(e){if(!e||typeof e!="object")throw Error(Nu+"Object expected");var t,r,n,s=["precision",1,by,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<s.length;t+=3)if((n=e[r=s[t]])!==void 0)if(wy(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(Fg+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Fg+r+": "+n);return this}var XM=aZ(ERe);jd=new XM(1);const xo=XM;function ORe(e){return RRe(e)||MRe(e)||DRe(e)||TRe()}function TRe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DRe(e,t){if(e){if(typeof e=="string")return sT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sT(e,t)}}function MRe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function RRe(e){if(Array.isArray(e))return sT(e)}function sT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var FRe=function(t){return t},sZ={"@@functional/placeholder":!0},oZ=function(t){return t===sZ},Dq=function(t){return function r(){return arguments.length===0||arguments.length===1&&oZ(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},LRe=function e(t,r){return t===1?r:Dq(function(){for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];var i=s.filter(function(l){return l!==sZ}).length;return i>=t?r.apply(void 0,s):e(t-i,Dq(function(){for(var l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];var u=s.map(function(f){return oZ(f)?c.shift():f});return r.apply(void 0,ORe(u).concat(c))}))})},H5=function(t){return LRe(t.length,t)},oT=function(t,r){for(var n=[],s=t;s<r;++s)n[s-t]=s;return n},$Re=H5(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),BRe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return FRe;var s=r.reverse(),o=s[0],i=s.slice(1);return function(){return i.reduce(function(l,c){return c(l)},o.apply(void 0,arguments))}},iT=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},iZ=function(t){var r=null,n=null;return function(){for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return r&&o.every(function(l,c){return l===r[c]})||(r=o,n=t.apply(void 0,o)),n}};function qRe(e){var t;return e===0?t=1:t=Math.floor(new xo(e).abs().log(10).toNumber())+1,t}function zRe(e,t,r){for(var n=new xo(e),s=0,o=[];n.lt(t)&&s<1e5;)o.push(n.toNumber()),n=n.add(r),s++;return o}var URe=H5(function(e,t,r){var n=+e,s=+t;return n+r*(s-n)}),VRe=H5(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),WRe=H5(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const G5={rangeStep:zRe,getDigitCount:qRe,interpolateNumber:URe,uninterpolateNumber:VRe,uninterpolateTruncation:WRe};function lT(e){return KRe(e)||GRe(e)||lZ(e)||HRe()}function HRe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GRe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function KRe(e){if(Array.isArray(e))return cT(e)}function n1(e,t){return JRe(e)||YRe(e,t)||lZ(e,t)||XRe()}function XRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lZ(e,t){if(e){if(typeof e=="string")return cT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cT(e,t)}}function cT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function YRe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,s=!1,o=void 0;try{for(var i=e[Symbol.iterator](),l;!(n=(l=i.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(c){s=!0,o=c}finally{try{!n&&i.return!=null&&i.return()}finally{if(s)throw o}}return r}}function JRe(e){if(Array.isArray(e))return e}function cZ(e){var t=n1(e,2),r=t[0],n=t[1],s=r,o=n;return r>n&&(s=n,o=r),[s,o]}function dZ(e,t,r){if(e.lte(0))return new xo(0);var n=G5.getDigitCount(e.toNumber()),s=new xo(10).pow(n),o=e.div(s),i=n!==1?.05:.1,l=new xo(Math.ceil(o.div(i).toNumber())).add(r).mul(i),c=l.mul(s);return t?c:new xo(Math.ceil(c))}function QRe(e,t,r){var n=1,s=new xo(e);if(!s.isint()&&r){var o=Math.abs(e);o<1?(n=new xo(10).pow(G5.getDigitCount(e)-1),s=new xo(Math.floor(s.div(n).toNumber())).mul(n)):o>1&&(s=new xo(Math.floor(e)))}else e===0?s=new xo(Math.floor((t-1)/2)):r||(s=new xo(Math.floor(e)));var i=Math.floor((t-1)/2),l=BRe($Re(function(c){return s.add(new xo(c-i).mul(n)).toNumber()}),oT);return l(0,t)}function uZ(e,t,r,n){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new xo(0),tickMin:new xo(0),tickMax:new xo(0)};var o=dZ(new xo(t).sub(e).div(r-1),n,s),i;e<=0&&t>=0?i=new xo(0):(i=new xo(e).add(t).div(2),i=i.sub(new xo(i).mod(o)));var l=Math.ceil(i.sub(e).div(o).toNumber()),c=Math.ceil(new xo(t).sub(i).div(o).toNumber()),d=l+c+1;return d>r?uZ(e,t,r,n,s+1):(d<r&&(c=t>0?c+(r-d):c,l=t>0?l:l+(r-d)),{step:o,tickMin:i.sub(new xo(l).mul(o)),tickMax:i.add(new xo(c).mul(o))})}function ZRe(e){var t=n1(e,2),r=t[0],n=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=Math.max(s,2),l=cZ([r,n]),c=n1(l,2),d=c[0],u=c[1];if(d===-1/0||u===1/0){var f=u===1/0?[d].concat(lT(oT(0,s-1).map(function(){return 1/0}))):[].concat(lT(oT(0,s-1).map(function(){return-1/0})),[u]);return r>n?iT(f):f}if(d===u)return QRe(d,s,o);var h=uZ(d,u,i,o),m=h.step,x=h.tickMin,g=h.tickMax,v=G5.rangeStep(x,g.add(new xo(.1).mul(m)),m);return r>n?iT(v):v}function eFe(e,t){var r=n1(e,2),n=r[0],s=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=cZ([n,s]),l=n1(i,2),c=l[0],d=l[1];if(c===-1/0||d===1/0)return[n,s];if(c===d)return[c];var u=Math.max(t,2),f=dZ(new xo(d).sub(c).div(u-1),o,0),h=[].concat(lT(G5.rangeStep(new xo(c),new xo(d).sub(new xo(.99).mul(f)),f)),[d]);return n>s?iT(h):h}var tFe=iZ(ZRe),rFe=iZ(eFe),nFe=!0,IE="Invariant failed";function bp(e,t){if(!e){if(nFe)throw new Error(IE);var r=typeof t=="function"?t():t,n=r?"".concat(IE,": ").concat(r):IE;throw new Error(n)}}var aFe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function C0(e){"@babel/helpers - typeof";return C0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C0(e)}function hS(){return hS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hS.apply(this,arguments)}function sFe(e,t){return cFe(e)||lFe(e,t)||iFe(e,t)||oFe()}function oFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iFe(e,t){if(e){if(typeof e=="string")return Mq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mq(e,t)}}function Mq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function lFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function cFe(e){if(Array.isArray(e))return e}function dFe(e,t){if(e==null)return{};var r=uFe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function uFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function fFe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hZ(n.key),n)}}function mFe(e,t,r){return t&&Rq(e.prototype,t),r&&Rq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function hFe(e,t,r){return t=pS(t),pFe(e,fZ()?Reflect.construct(t,r||[],pS(e).constructor):t.apply(e,r))}function pFe(e,t){if(t&&(C0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gFe(e)}function gFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fZ=function(){return!!e})()}function pS(e){return pS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pS(e)}function xFe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dT(e,t)}function dT(e,t){return dT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},dT(e,t)}function mZ(e,t,r){return t=hZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hZ(e){var t=vFe(e,"string");return C0(t)=="symbol"?t:t+""}function vFe(e,t){if(C0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(C0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fj=function(e){function t(){return fFe(this,t),hFe(this,t,arguments)}return xFe(t,e),mFe(t,[{key:"render",value:function(){var n=this.props,s=n.offset,o=n.layout,i=n.width,l=n.dataKey,c=n.data,d=n.dataPointFormatter,u=n.xAxis,f=n.yAxis,h=dFe(n,aFe),m=ka(h,!1);this.props.direction==="x"&&u.type!=="number"&&bp(!1);var x=c.map(function(g){var v=d(g,l),y=v.x,b=v.y,w=v.value,j=v.errorVal;if(!j)return null;var _=[],C,A;if(Array.isArray(j)){var S=sFe(j,2);C=S[0],A=S[1]}else C=A=j;if(o==="vertical"){var P=u.scale,M=b+s,O=M+i,I=M-i,T=P(w-C),k=P(w+A);_.push({x1:k,y1:O,x2:k,y2:I}),_.push({x1:T,y1:M,x2:k,y2:M}),_.push({x1:T,y1:O,x2:T,y2:I})}else if(o==="horizontal"){var $=f.scale,q=y+s,z=q-i,F=q+i,V=$(w-C),ue=$(w+A);_.push({x1:z,y1:ue,x2:F,y2:ue}),_.push({x1:q,y1:V,x2:q,y2:ue}),_.push({x1:z,y1:V,x2:F,y2:V})}return Ce.createElement(Cs,hS({className:"recharts-errorBar",key:"bar-".concat(_.map(function(_e){return"".concat(_e.x1,"-").concat(_e.x2,"-").concat(_e.y1,"-").concat(_e.y2)}))},m),_.map(function(_e){return Ce.createElement("line",hS({},_e,{key:"line-".concat(_e.x1,"-").concat(_e.x2,"-").concat(_e.y1,"-").concat(_e.y2)}))}))});return Ce.createElement(Cs,{className:"recharts-errorBars"},x)}}])}(Ce.Component);mZ(fj,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});mZ(fj,"displayName","ErrorBar");function a1(e){"@babel/helpers - typeof";return a1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a1(e)}function Fq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Hp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fq(Object(r),!0).forEach(function(n){yFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yFe(e,t,r){return t=bFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bFe(e){var t=wFe(e,"string");return a1(t)=="symbol"?t:t+""}function wFe(e,t){if(a1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(a1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pZ=function(t){var r=t.children,n=t.formattedGraphicalItems,s=t.legendWidth,o=t.legendContent,i=yd(r,Mg);if(!i)return null;var l=Mg.defaultProps,c=l!==void 0?Hp(Hp({},l),i.props):{},d;return i.props&&i.props.payload?d=i.props&&i.props.payload:o==="children"?d=(n||[]).reduce(function(u,f){var h=f.item,m=f.props,x=m.sectors||m.data||[];return u.concat(x.map(function(g){return{type:i.props.iconType||h.props.legendType,value:g.name,color:g.fill,payload:g}}))},[]):d=(n||[]).map(function(u){var f=u.item,h=f.type.defaultProps,m=h!==void 0?Hp(Hp({},h),f.props):{},x=m.dataKey,g=m.name,v=m.legendType,y=m.hide;return{inactive:y,dataKey:x,type:c.iconType||v||"square",color:YM(f),value:g||x,payload:m}}),Hp(Hp(Hp({},c),Mg.getWithHeight(i,s)),{},{payload:d,item:i})};function s1(e){"@babel/helpers - typeof";return s1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s1(e)}function Lq(e){return SFe(e)||NFe(e)||_Fe(e)||jFe()}function jFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Fe(e,t){if(e){if(typeof e=="string")return uT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uT(e,t)}}function NFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function SFe(e){if(Array.isArray(e))return uT(e)}function uT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function di(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$q(Object(r),!0).forEach(function(n){Jv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$q(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jv(e,t,r){return t=CFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CFe(e){var t=PFe(e,"string");return s1(t)=="symbol"?t:t+""}function PFe(e,t){if(s1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(s1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bi(e,t,r){return ss(e)||ss(t)?r:Gi(t)?Od(e,t,r):Ka(t)?t(e):r}function Xb(e,t,r,n){var s=SRe(e,function(l){return bi(l,t)});if(r==="number"){var o=s.filter(function(l){return Rn(l)||parseFloat(l)});return o.length?[W5(o),Fh(o)]:[1/0,-1/0]}var i=n?s.filter(function(l){return!ss(l)}):s;return i.map(function(l){return Gi(l)||l instanceof Date?l:""})}var AFe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,i=-1,l=(r=n?.length)!==null&&r!==void 0?r:0;if(l<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var c=o.range,d=0;d<l;d++){var u=d>0?s[d-1].coordinate:s[l-1].coordinate,f=s[d].coordinate,h=d>=l-1?s[0].coordinate:s[d+1].coordinate,m=void 0;if(yc(f-u)!==yc(h-f)){var x=[];if(yc(h-f)===yc(c[1]-c[0])){m=h;var g=f+c[1]-c[0];x[0]=Math.min(g,(g+u)/2),x[1]=Math.max(g,(g+u)/2)}else{m=u;var v=h+c[1]-c[0];x[0]=Math.min(f,(v+f)/2),x[1]=Math.max(f,(v+f)/2)}var y=[Math.min(f,(m+f)/2),Math.max(f,(m+f)/2)];if(t>y[0]&&t<=y[1]||t>=x[0]&&t<=x[1]){i=s[d].index;break}}else{var b=Math.min(u,h),w=Math.max(u,h);if(t>(b+f)/2&&t<=(w+f)/2){i=s[d].index;break}}}else for(var j=0;j<l;j++)if(j===0&&t<=(n[j].coordinate+n[j+1].coordinate)/2||j>0&&j<l-1&&t>(n[j].coordinate+n[j-1].coordinate)/2&&t<=(n[j].coordinate+n[j+1].coordinate)/2||j===l-1&&t>(n[j].coordinate+n[j-1].coordinate)/2){i=n[j].index;break}return i},YM=function(t){var r,n=t,s=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?di(di({},t.type.defaultProps),t.props):t.props,i=o.stroke,l=o.fill,c;switch(s){case"Line":c=i;break;case"Area":case"Radar":c=i&&i!=="none"?i:l;break;default:c=l;break}return c},EFe=function(t){var r=t.barSize,n=t.totalSize,s=t.stackGroups,o=s===void 0?{}:s;if(!o)return{};for(var i={},l=Object.keys(o),c=0,d=l.length;c<d;c++)for(var u=o[l[c]].stackGroups,f=Object.keys(u),h=0,m=f.length;h<m;h++){var x=u[f[h]],g=x.items,v=x.cateAxisId,y=g.filter(function(A){return Om(A.type).indexOf("Bar")>=0});if(y&&y.length){var b=y[0].type.defaultProps,w=b!==void 0?di(di({},b),y[0].props):y[0].props,j=w.barSize,_=w[v];i[_]||(i[_]=[]);var C=ss(j)?r:j;i[_].push({item:y[0],stackList:y.slice(1),barSize:ss(C)?void 0:bc(C,n,0)})}}return i},kFe=function(t){var r=t.barGap,n=t.barCategoryGap,s=t.bandSize,o=t.sizeList,i=o===void 0?[]:o,l=t.maxBarSize,c=i.length;if(c<1)return null;var d=bc(r,s,0,!0),u,f=[];if(i[0].barSize===+i[0].barSize){var h=!1,m=s/c,x=i.reduce(function(j,_){return j+_.barSize||0},0);x+=(c-1)*d,x>=s&&(x-=(c-1)*d,d=0),x>=s&&m>0&&(h=!0,m*=.9,x=c*m);var g=(s-x)/2>>0,v={offset:g-d,size:0};u=i.reduce(function(j,_){var C={item:_.item,position:{offset:v.offset+v.size+d,size:h?m:_.barSize}},A=[].concat(Lq(j),[C]);return v=A[A.length-1].position,_.stackList&&_.stackList.length&&_.stackList.forEach(function(S){A.push({item:S,position:v})}),A},f)}else{var y=bc(n,s,0,!0);s-2*y-(c-1)*d<=0&&(d=0);var b=(s-2*y-(c-1)*d)/c;b>1&&(b>>=0);var w=l===+l?Math.min(b,l):b;u=i.reduce(function(j,_,C){var A=[].concat(Lq(j),[{item:_.item,position:{offset:y+(b+d)*C+(b-w)/2,size:w}}]);return _.stackList&&_.stackList.length&&_.stackList.forEach(function(S){A.push({item:S,position:A[A.length-1].position})}),A},f)}return u},IFe=function(t,r,n,s){var o=n.children,i=n.width,l=n.margin,c=i-(l.left||0)-(l.right||0),d=pZ({children:o,legendWidth:c});if(d){var u=s||{},f=u.width,h=u.height,m=d.align,x=d.verticalAlign,g=d.layout;if((g==="vertical"||g==="horizontal"&&x==="middle")&&m!=="center"&&Rn(t[m]))return di(di({},t),{},Jv({},m,t[m]+(f||0)));if((g==="horizontal"||g==="vertical"&&m==="center")&&x!=="middle"&&Rn(t[x]))return di(di({},t),{},Jv({},x,t[x]+(h||0)))}return t},OFe=function(t,r,n){return ss(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},gZ=function(t,r,n,s,o){var i=r.props.children,l=Td(i,fj).filter(function(d){return OFe(s,o,d.props.direction)});if(l&&l.length){var c=l.map(function(d){return d.props.dataKey});return t.reduce(function(d,u){var f=bi(u,n);if(ss(f))return d;var h=Array.isArray(f)?[W5(f),Fh(f)]:[f,f],m=c.reduce(function(x,g){var v=bi(u,g,0),y=h[0]-Math.abs(Array.isArray(v)?v[0]:v),b=h[1]+Math.abs(Array.isArray(v)?v[1]:v);return[Math.min(y,x[0]),Math.max(b,x[1])]},[1/0,-1/0]);return[Math.min(m[0],d[0]),Math.max(m[1],d[1])]},[1/0,-1/0])}return null},TFe=function(t,r,n,s,o){var i=r.map(function(l){return gZ(t,l,n,o,s)}).filter(function(l){return!ss(l)});return i&&i.length?i.reduce(function(l,c){return[Math.min(l[0],c[0]),Math.max(l[1],c[1])]},[1/0,-1/0]):null},xZ=function(t,r,n,s,o){var i=r.map(function(c){var d=c.props.dataKey;return n==="number"&&d&&gZ(t,c,d,s)||Xb(t,d,n,o)});if(n==="number")return i.reduce(function(c,d){return[Math.min(c[0],d[0]),Math.max(c[1],d[1])]},[1/0,-1/0]);var l={};return i.reduce(function(c,d){for(var u=0,f=d.length;u<f;u++)l[d[u]]||(l[d[u]]=!0,c.push(d[u]));return c},[])},vZ=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},yZ=function(t,r,n,s){if(s)return t.map(function(c){return c.coordinate});var o,i,l=t.map(function(c){return c.coordinate===r&&(o=!0),c.coordinate===n&&(i=!0),c.coordinate});return o||l.push(r),i||l.push(n),l},Pm=function(t,r,n){if(!t)return null;var s=t.scale,o=t.duplicateDomain,i=t.type,l=t.range,c=t.realScaleType==="scaleBand"?s.bandwidth()/2:2,d=(r||n)&&i==="category"&&s.bandwidth?s.bandwidth()/c:0;if(d=t.axisType==="angleAxis"&&l?.length>=2?yc(l[0]-l[1])*2*d:d,r&&(t.ticks||t.niceTicks)){var u=(t.ticks||t.niceTicks).map(function(f){var h=o?o.indexOf(f):f;return{coordinate:s(h)+d,value:f,offset:d}});return u.filter(function(f){return!py(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:s(f)+d,value:f,index:h,offset:d}}):s.ticks&&!n?s.ticks(t.tickCount).map(function(f){return{coordinate:s(f)+d,value:f,offset:d}}):s.domain().map(function(f,h){return{coordinate:s(f)+d,value:o?o[f]:f,index:h,offset:d}})},OE=new WeakMap,L2=function(t,r){if(typeof r!="function")return t;OE.has(t)||OE.set(t,new WeakMap);var n=OE.get(t);if(n.has(r))return n.get(r);var s=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,s),s},bZ=function(t,r,n){var s=t.scale,o=t.type,i=t.layout,l=t.axisType;if(s==="auto")return i==="radial"&&l==="radiusAxis"?{scale:Jw(),realScaleType:"band"}:i==="radial"&&l==="angleAxis"?{scale:cS(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Kb(),realScaleType:"point"}:o==="category"?{scale:Jw(),realScaleType:"band"}:{scale:cS(),realScaleType:"linear"};if(tx(s)){var c="scale".concat(I5(s));return{scale:(Iq[c]||Kb)(),realScaleType:Iq[c]?c:"point"}}return Ka(s)?{scale:s}:{scale:Kb(),realScaleType:"point"}},Bq=1e-4,wZ=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,s=t.range(),o=Math.min(s[0],s[1])-Bq,i=Math.max(s[0],s[1])+Bq,l=t(r[0]),c=t(r[n-1]);(l<o||l>i||c<o||c>i)&&t.domain([r[0],r[n-1]])}},DFe=function(t,r){if(!t)return null;for(var n=0,s=t.length;n<s;n++)if(t[n].item===r)return t[n].position;return null},MFe=function(t,r){if(!r||r.length!==2||!Rn(r[0])||!Rn(r[1]))return t;var n=Math.min(r[0],r[1]),s=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!Rn(t[0])||t[0]<n)&&(o[0]=n),(!Rn(t[1])||t[1]>s)&&(o[1]=s),o[0]>s&&(o[0]=s),o[1]<n&&(o[1]=n),o},RFe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,i=0,l=0;l<r;++l){var c=py(t[l][n][1])?t[l][n][0]:t[l][n][1];c>=0?(t[l][n][0]=o,t[l][n][1]=o+c,o=t[l][n][1]):(t[l][n][0]=i,t[l][n][1]=i+c,i=t[l][n][1])}},FFe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,i=0;i<r;++i){var l=py(t[i][n][1])?t[i][n][0]:t[i][n][1];l>=0?(t[i][n][0]=o,t[i][n][1]=o+l,o=t[i][n][1]):(t[i][n][0]=0,t[i][n][1]=0)}},LFe={sign:RFe,expand:o5e,none:v0,silhouette:i5e,wiggle:l5e,positive:FFe},$Fe=function(t,r,n){var s=r.map(function(l){return l.props.dataKey}),o=LFe[n],i=s5e().keys(s).value(function(l,c){return+bi(l,c,0)}).order(RO).offset(o);return i(t)},BFe=function(t,r,n,s,o,i){if(!t)return null;var l=i?r.reverse():r,c={},d=l.reduce(function(f,h){var m,x=(m=h.type)!==null&&m!==void 0&&m.defaultProps?di(di({},h.type.defaultProps),h.props):h.props,g=x.stackId,v=x.hide;if(v)return f;var y=x[n],b=f[y]||{hasStack:!1,stackGroups:{}};if(Gi(g)){var w=b.stackGroups[g]||{numericAxisId:n,cateAxisId:s,items:[]};w.items.push(h),b.hasStack=!0,b.stackGroups[g]=w}else b.stackGroups[wx("_stackId_")]={numericAxisId:n,cateAxisId:s,items:[h]};return di(di({},f),{},Jv({},y,b))},c),u={};return Object.keys(d).reduce(function(f,h){var m=d[h];if(m.hasStack){var x={};m.stackGroups=Object.keys(m.stackGroups).reduce(function(g,v){var y=m.stackGroups[v];return di(di({},g),{},Jv({},v,{numericAxisId:n,cateAxisId:s,items:y.items,stackedData:$Fe(t,y.items,o)}))},x)}return di(di({},f),{},Jv({},h,m))},u)},jZ=function(t,r){var n=r.realScaleType,s=r.type,o=r.tickCount,i=r.originalDomain,l=r.allowDecimals,c=n||r.scale;if(c!=="auto"&&c!=="linear")return null;if(o&&s==="number"&&i&&(i[0]==="auto"||i[1]==="auto")){var d=t.domain();if(!d.length)return null;var u=tFe(d,o,l);return t.domain([W5(u),Fh(u)]),{niceTicks:u}}if(o&&s==="number"){var f=t.domain(),h=rFe(f,o,l);return{niceTicks:h}}return null};function gS(e){var t=e.axis,r=e.ticks,n=e.bandSize,s=e.entry,o=e.index,i=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!ss(s[t.dataKey])){var l=zN(r,"value",s[t.dataKey]);if(l)return l.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var c=bi(s,ss(i)?t.dataKey:i);return ss(c)?null:t.scale(c)}var qq=function(t){var r=t.axis,n=t.ticks,s=t.offset,o=t.bandSize,i=t.entry,l=t.index;if(r.type==="category")return n[l]?n[l].coordinate+s:null;var c=bi(i,r.dataKey,r.domain[l]);return ss(c)?null:r.scale(c)-o/2+s},qFe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var s=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return s<=0&&o>=0?0:o<0?o:s}return n[0]},zFe=function(t,r){var n,s=(n=t.type)!==null&&n!==void 0&&n.defaultProps?di(di({},t.type.defaultProps),t.props):t.props,o=s.stackId;if(Gi(o)){var i=r[o];if(i){var l=i.items.indexOf(t);return l>=0?i.stackedData[l]:null}}return null},UFe=function(t){return t.reduce(function(r,n){return[W5(n.concat([r[0]]).filter(Rn)),Fh(n.concat([r[1]]).filter(Rn))]},[1/0,-1/0])},_Z=function(t,r,n){return Object.keys(t).reduce(function(s,o){var i=t[o],l=i.stackedData,c=l.reduce(function(d,u){var f=UFe(u.slice(r,n+1));return[Math.min(d[0],f[0]),Math.max(d[1],f[1])]},[1/0,-1/0]);return[Math.min(c[0],s[0]),Math.max(c[1],s[1])]},[1/0,-1/0]).map(function(s){return s===1/0||s===-1/0?0:s})},zq=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Uq=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,fT=function(t,r,n){if(Ka(t))return t(r,n);if(!Array.isArray(t))return r;var s=[];if(Rn(t[0]))s[0]=n?t[0]:Math.min(t[0],r[0]);else if(zq.test(t[0])){var o=+zq.exec(t[0])[1];s[0]=r[0]-o}else Ka(t[0])?s[0]=t[0](r[0]):s[0]=r[0];if(Rn(t[1]))s[1]=n?t[1]:Math.max(t[1],r[1]);else if(Uq.test(t[1])){var i=+Uq.exec(t[1])[1];s[1]=r[1]+i}else Ka(t[1])?s[1]=t[1](r[1]):s[1]=r[1];return s},xS=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var s=t.scale.bandwidth();if(!n||s>0)return s}if(t&&r&&r.length>=2){for(var o=NM(r,function(f){return f.coordinate}),i=1/0,l=1,c=o.length;l<c;l++){var d=o[l],u=o[l-1];i=Math.min((d.coordinate||0)-(u.coordinate||0),i)}return i===1/0?0:i}return n?void 0:0},Vq=function(t,r,n){return!t||!t.length||ax(t,Od(n,"type.defaultProps.domain"))?r:t},NZ=function(t,r){var n=t.type.defaultProps?di(di({},t.type.defaultProps),t.props):t.props,s=n.dataKey,o=n.name,i=n.unit,l=n.formatter,c=n.tooltipType,d=n.chartType,u=n.hide;return di(di({},ka(t,!1)),{},{dataKey:s,unit:i,formatter:l,name:o||s,color:YM(t),value:bi(r,s),type:c,payload:r,chartType:d,hide:u})};function o1(e){"@babel/helpers - typeof";return o1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o1(e)}function Wq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function xm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wq(Object(r),!0).forEach(function(n){SZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SZ(e,t,r){return t=VFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VFe(e){var t=WFe(e,"string");return o1(t)=="symbol"?t:t+""}function WFe(e,t){if(o1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(o1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HFe(e,t){return YFe(e)||XFe(e,t)||KFe(e,t)||GFe()}function GFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KFe(e,t){if(e){if(typeof e=="string")return Hq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hq(e,t)}}function Hq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function XFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function YFe(e){if(Array.isArray(e))return e}var vS=Math.PI/180,JFe=function(t){return t*180/Math.PI},Oo=function(t,r,n,s){return{x:t+Math.cos(-vS*s)*n,y:r+Math.sin(-vS*s)*n}},CZ=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},QFe=function(t,r,n,s,o){var i=t.width,l=t.height,c=t.startAngle,d=t.endAngle,u=bc(t.cx,i,i/2),f=bc(t.cy,l,l/2),h=CZ(i,l,n),m=bc(t.innerRadius,h,0),x=bc(t.outerRadius,h,h*.8),g=Object.keys(r);return g.reduce(function(v,y){var b=r[y],w=b.domain,j=b.reversed,_;if(ss(b.range))s==="angleAxis"?_=[c,d]:s==="radiusAxis"&&(_=[m,x]),j&&(_=[_[1],_[0]]);else{_=b.range;var C=_,A=HFe(C,2);c=A[0],d=A[1]}var S=bZ(b,o),P=S.realScaleType,M=S.scale;M.domain(w).range(_),wZ(M);var O=jZ(M,xm(xm({},b),{},{realScaleType:P})),I=xm(xm(xm({},b),O),{},{range:_,radius:x,realScaleType:P,scale:M,cx:u,cy:f,innerRadius:m,outerRadius:x,startAngle:c,endAngle:d});return xm(xm({},v),{},SZ({},y,I))},{})},ZFe=function(t,r){var n=t.x,s=t.y,o=r.x,i=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(s-i,2))},eLe=function(t,r){var n=t.x,s=t.y,o=r.cx,i=r.cy,l=ZFe({x:n,y:s},{x:o,y:i});if(l<=0)return{radius:l};var c=(n-o)/l,d=Math.acos(c);return s>i&&(d=2*Math.PI-d),{radius:l,angle:JFe(d),angleInRadian:d}},tLe=function(t){var r=t.startAngle,n=t.endAngle,s=Math.floor(r/360),o=Math.floor(n/360),i=Math.min(s,o);return{startAngle:r-i*360,endAngle:n-i*360}},rLe=function(t,r){var n=r.startAngle,s=r.endAngle,o=Math.floor(n/360),i=Math.floor(s/360),l=Math.min(o,i);return t+l*360},Gq=function(t,r){var n=t.x,s=t.y,o=eLe({x:n,y:s},r),i=o.radius,l=o.angle,c=r.innerRadius,d=r.outerRadius;if(i<c||i>d)return!1;if(i===0)return!0;var u=tLe(r),f=u.startAngle,h=u.endAngle,m=l,x;if(f<=h){for(;m>h;)m-=360;for(;m<f;)m+=360;x=m>=f&&m<=h}else{for(;m>f;)m-=360;for(;m<h;)m+=360;x=m>=h&&m<=f}return x?xm(xm({},r),{},{radius:i,angle:rLe(m,r)}):null},PZ=function(t){return!p.isValidElement(t)&&!Ka(t)&&typeof t!="boolean"?t.className:""};function i1(e){"@babel/helpers - typeof";return i1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i1(e)}var nLe=["offset"];function aLe(e){return lLe(e)||iLe(e)||oLe(e)||sLe()}function sLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oLe(e,t){if(e){if(typeof e=="string")return mT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mT(e,t)}}function iLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lLe(e){if(Array.isArray(e))return mT(e)}function mT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function cLe(e,t){if(e==null)return{};var r=dLe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function dLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Kq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Bi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kq(Object(r),!0).forEach(function(n){uLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uLe(e,t,r){return t=fLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fLe(e){var t=mLe(e,"string");return i1(t)=="symbol"?t:t+""}function mLe(e,t){if(i1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(i1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function l1(){return l1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l1.apply(this,arguments)}var hLe=function(t){var r=t.value,n=t.formatter,s=ss(t.children)?r:t.children;return Ka(n)?n(s):s},pLe=function(t,r){var n=yc(r-t),s=Math.min(Math.abs(r-t),360);return n*s},gLe=function(t,r,n){var s=t.position,o=t.viewBox,i=t.offset,l=t.className,c=o,d=c.cx,u=c.cy,f=c.innerRadius,h=c.outerRadius,m=c.startAngle,x=c.endAngle,g=c.clockWise,v=(f+h)/2,y=pLe(m,x),b=y>=0?1:-1,w,j;s==="insideStart"?(w=m+b*i,j=g):s==="insideEnd"?(w=x-b*i,j=!g):s==="end"&&(w=x+b*i,j=g),j=y<=0?j:!j;var _=Oo(d,u,v,w),C=Oo(d,u,v,w+(j?1:-1)*359),A="M".concat(_.x,",").concat(_.y,`
    A`).concat(v,",").concat(v,",0,1,").concat(j?0:1,`,
    `).concat(C.x,",").concat(C.y),S=ss(t.id)?wx("recharts-radial-line-"):t.id;return Ce.createElement("text",l1({},n,{dominantBaseline:"central",className:ls("recharts-radial-bar-label",l)}),Ce.createElement("defs",null,Ce.createElement("path",{id:S,d:A})),Ce.createElement("textPath",{xlinkHref:"#".concat(S)},r))},xLe=function(t){var r=t.viewBox,n=t.offset,s=t.position,o=r,i=o.cx,l=o.cy,c=o.innerRadius,d=o.outerRadius,u=o.startAngle,f=o.endAngle,h=(u+f)/2;if(s==="outside"){var m=Oo(i,l,d+n,h),x=m.x,g=m.y;return{x,y:g,textAnchor:x>=i?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"end"};var v=(c+d)/2,y=Oo(i,l,v,h),b=y.x,w=y.y;return{x:b,y:w,textAnchor:"middle",verticalAnchor:"middle"}},vLe=function(t){var r=t.viewBox,n=t.parentViewBox,s=t.offset,o=t.position,i=r,l=i.x,c=i.y,d=i.width,u=i.height,f=u>=0?1:-1,h=f*s,m=f>0?"end":"start",x=f>0?"start":"end",g=d>=0?1:-1,v=g*s,y=g>0?"end":"start",b=g>0?"start":"end";if(o==="top"){var w={x:l+d/2,y:c-f*s,textAnchor:"middle",verticalAnchor:m};return Bi(Bi({},w),n?{height:Math.max(c-n.y,0),width:d}:{})}if(o==="bottom"){var j={x:l+d/2,y:c+u+h,textAnchor:"middle",verticalAnchor:x};return Bi(Bi({},j),n?{height:Math.max(n.y+n.height-(c+u),0),width:d}:{})}if(o==="left"){var _={x:l-v,y:c+u/2,textAnchor:y,verticalAnchor:"middle"};return Bi(Bi({},_),n?{width:Math.max(_.x-n.x,0),height:u}:{})}if(o==="right"){var C={x:l+d+v,y:c+u/2,textAnchor:b,verticalAnchor:"middle"};return Bi(Bi({},C),n?{width:Math.max(n.x+n.width-C.x,0),height:u}:{})}var A=n?{width:d,height:u}:{};return o==="insideLeft"?Bi({x:l+v,y:c+u/2,textAnchor:b,verticalAnchor:"middle"},A):o==="insideRight"?Bi({x:l+d-v,y:c+u/2,textAnchor:y,verticalAnchor:"middle"},A):o==="insideTop"?Bi({x:l+d/2,y:c+h,textAnchor:"middle",verticalAnchor:x},A):o==="insideBottom"?Bi({x:l+d/2,y:c+u-h,textAnchor:"middle",verticalAnchor:m},A):o==="insideTopLeft"?Bi({x:l+v,y:c+h,textAnchor:b,verticalAnchor:x},A):o==="insideTopRight"?Bi({x:l+d-v,y:c+h,textAnchor:y,verticalAnchor:x},A):o==="insideBottomLeft"?Bi({x:l+v,y:c+u-h,textAnchor:b,verticalAnchor:m},A):o==="insideBottomRight"?Bi({x:l+d-v,y:c+u-h,textAnchor:y,verticalAnchor:m},A):uy(o)&&(Rn(o.x)||bg(o.x))&&(Rn(o.y)||bg(o.y))?Bi({x:l+bc(o.x,d),y:c+bc(o.y,u),textAnchor:"end",verticalAnchor:"end"},A):Bi({x:l+d/2,y:c+u/2,textAnchor:"middle",verticalAnchor:"middle"},A)},yLe=function(t){return"cx"in t&&Rn(t.cx)};function il(e){var t=e.offset,r=t===void 0?5:t,n=cLe(e,nLe),s=Bi({offset:r},n),o=s.viewBox,i=s.position,l=s.value,c=s.children,d=s.content,u=s.className,f=u===void 0?"":u,h=s.textBreakAll;if(!o||ss(l)&&ss(c)&&!p.isValidElement(d)&&!Ka(d))return null;if(p.isValidElement(d))return p.cloneElement(d,s);var m;if(Ka(d)){if(m=p.createElement(d,s),p.isValidElement(m))return m}else m=hLe(s);var x=yLe(o),g=ka(s,!0);if(x&&(i==="insideStart"||i==="insideEnd"||i==="end"))return gLe(s,m,g);var v=x?xLe(s):vLe(s);return Ce.createElement(nx,l1({className:ls("recharts-label",f)},g,v,{breakAll:h}),m)}il.displayName="Label";var AZ=function(t){var r=t.cx,n=t.cy,s=t.angle,o=t.startAngle,i=t.endAngle,l=t.r,c=t.radius,d=t.innerRadius,u=t.outerRadius,f=t.x,h=t.y,m=t.top,x=t.left,g=t.width,v=t.height,y=t.clockWise,b=t.labelViewBox;if(b)return b;if(Rn(g)&&Rn(v)){if(Rn(f)&&Rn(h))return{x:f,y:h,width:g,height:v};if(Rn(m)&&Rn(x))return{x:m,y:x,width:g,height:v}}return Rn(f)&&Rn(h)?{x:f,y:h,width:0,height:0}:Rn(r)&&Rn(n)?{cx:r,cy:n,startAngle:o||s||0,endAngle:i||s||0,innerRadius:d||0,outerRadius:u||c||l||0,clockWise:y}:t.viewBox?t.viewBox:{}},bLe=function(t,r){return t?t===!0?Ce.createElement(il,{key:"label-implicit",viewBox:r}):Gi(t)?Ce.createElement(il,{key:"label-implicit",viewBox:r,value:t}):p.isValidElement(t)?t.type===il?p.cloneElement(t,{key:"label-implicit",viewBox:r}):Ce.createElement(il,{key:"label-implicit",content:t,viewBox:r}):Ka(t)?Ce.createElement(il,{key:"label-implicit",content:t,viewBox:r}):uy(t)?Ce.createElement(il,l1({viewBox:r},t,{key:"label-implicit"})):null:null},wLe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var s=t.children,o=AZ(t),i=Td(s,il).map(function(c,d){return p.cloneElement(c,{viewBox:r||o,key:"label-".concat(d)})});if(!n)return i;var l=bLe(t.label,r||o);return[l].concat(aLe(i))};il.parseViewBox=AZ;il.renderCallByParent=wLe;function jLe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var _Le=jLe;const NLe=Ls(_Le);function c1(e){"@babel/helpers - typeof";return c1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c1(e)}var SLe=["valueAccessor"],CLe=["data","dataKey","clockWise","id","textBreakAll"];function PLe(e){return ILe(e)||kLe(e)||ELe(e)||ALe()}function ALe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ELe(e,t){if(e){if(typeof e=="string")return hT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hT(e,t)}}function kLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ILe(e){if(Array.isArray(e))return hT(e)}function hT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function yS(){return yS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yS.apply(this,arguments)}function Xq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Yq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xq(Object(r),!0).forEach(function(n){OLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OLe(e,t,r){return t=TLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TLe(e){var t=DLe(e,"string");return c1(t)=="symbol"?t:t+""}function DLe(e,t){if(c1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(c1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jq(e,t){if(e==null)return{};var r=MLe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function MLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var RLe=function(t){return Array.isArray(t.value)?NLe(t.value):t.value};function Gf(e){var t=e.valueAccessor,r=t===void 0?RLe:t,n=Jq(e,SLe),s=n.data,o=n.dataKey,i=n.clockWise,l=n.id,c=n.textBreakAll,d=Jq(n,CLe);return!s||!s.length?null:Ce.createElement(Cs,{className:"recharts-label-list"},s.map(function(u,f){var h=ss(o)?r(u,f):bi(u&&u.payload,o),m=ss(l)?{}:{id:"".concat(l,"-").concat(f)};return Ce.createElement(il,yS({},ka(u,!0),d,m,{parentViewBox:u.parentViewBox,value:h,textBreakAll:c,viewBox:il.parseViewBox(ss(i)?u:Yq(Yq({},u),{},{clockWise:i})),key:"label-".concat(f),index:f}))}))}Gf.displayName="LabelList";function FLe(e,t){return e?e===!0?Ce.createElement(Gf,{key:"labelList-implicit",data:t}):Ce.isValidElement(e)||Ka(e)?Ce.createElement(Gf,{key:"labelList-implicit",data:t,content:e}):uy(e)?Ce.createElement(Gf,yS({data:t},e,{key:"labelList-implicit"})):null:null}function LLe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,s=Td(n,Gf).map(function(i,l){return p.cloneElement(i,{data:t,key:"labelList-".concat(l)})});if(!r)return s;var o=FLe(e.label,t);return[o].concat(PLe(s))}Gf.renderCallByParent=LLe;function d1(e){"@babel/helpers - typeof";return d1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d1(e)}function pT(){return pT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pT.apply(this,arguments)}function Qq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Zq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qq(Object(r),!0).forEach(function(n){$Le(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $Le(e,t,r){return t=BLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BLe(e){var t=qLe(e,"string");return d1(t)=="symbol"?t:t+""}function qLe(e,t){if(d1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(d1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var zLe=function(t,r){var n=yc(r-t),s=Math.min(Math.abs(r-t),359.999);return n*s},$2=function(t){var r=t.cx,n=t.cy,s=t.radius,o=t.angle,i=t.sign,l=t.isExternal,c=t.cornerRadius,d=t.cornerIsExternal,u=c*(l?1:-1)+s,f=Math.asin(c/u)/vS,h=d?o:o+i*f,m=Oo(r,n,u,h),x=Oo(r,n,s,h),g=d?o-i*f:o,v=Oo(r,n,u*Math.cos(f*vS),g);return{center:m,circleTangency:x,lineTangency:v,theta:f}},EZ=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,i=t.startAngle,l=t.endAngle,c=zLe(i,l),d=i+c,u=Oo(r,n,o,i),f=Oo(r,n,o,d),h="M ".concat(u.x,",").concat(u.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(c)>180),",").concat(+(i>d),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(s>0){var m=Oo(r,n,s,i),x=Oo(r,n,s,d);h+="L ".concat(x.x,",").concat(x.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(c)>180),",").concat(+(i<=d),`,
            `).concat(m.x,",").concat(m.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},ULe=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,i=t.cornerRadius,l=t.forceCornerRadius,c=t.cornerIsExternal,d=t.startAngle,u=t.endAngle,f=yc(u-d),h=$2({cx:r,cy:n,radius:o,angle:d,sign:f,cornerRadius:i,cornerIsExternal:c}),m=h.circleTangency,x=h.lineTangency,g=h.theta,v=$2({cx:r,cy:n,radius:o,angle:u,sign:-f,cornerRadius:i,cornerIsExternal:c}),y=v.circleTangency,b=v.lineTangency,w=v.theta,j=c?Math.abs(d-u):Math.abs(d-u)-g-w;if(j<0)return l?"M ".concat(x.x,",").concat(x.y,`
        a`).concat(i,",").concat(i,",0,0,1,").concat(i*2,`,0
        a`).concat(i,",").concat(i,",0,0,1,").concat(-i*2,`,0
      `):EZ({cx:r,cy:n,innerRadius:s,outerRadius:o,startAngle:d,endAngle:u});var _="M ".concat(x.x,",").concat(x.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(m.x,",").concat(m.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(j>180),",").concat(+(f<0),",").concat(y.x,",").concat(y.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(b.x,",").concat(b.y,`
  `);if(s>0){var C=$2({cx:r,cy:n,radius:s,angle:d,sign:f,isExternal:!0,cornerRadius:i,cornerIsExternal:c}),A=C.circleTangency,S=C.lineTangency,P=C.theta,M=$2({cx:r,cy:n,radius:s,angle:u,sign:-f,isExternal:!0,cornerRadius:i,cornerIsExternal:c}),O=M.circleTangency,I=M.lineTangency,T=M.theta,k=c?Math.abs(d-u):Math.abs(d-u)-P-T;if(k<0&&i===0)return"".concat(_,"L").concat(r,",").concat(n,"Z");_+="L".concat(I.x,",").concat(I.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(O.x,",").concat(O.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(k>180),",").concat(+(f>0),",").concat(A.x,",").concat(A.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(S.x,",").concat(S.y,"Z")}else _+="L".concat(r,",").concat(n,"Z");return _},VLe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},JM=function(t){var r=Zq(Zq({},VLe),t),n=r.cx,s=r.cy,o=r.innerRadius,i=r.outerRadius,l=r.cornerRadius,c=r.forceCornerRadius,d=r.cornerIsExternal,u=r.startAngle,f=r.endAngle,h=r.className;if(i<o||u===f)return null;var m=ls("recharts-sector",h),x=i-o,g=bc(l,x,0,!0),v;return g>0&&Math.abs(u-f)<360?v=ULe({cx:n,cy:s,innerRadius:o,outerRadius:i,cornerRadius:Math.min(g,x/2),forceCornerRadius:c,cornerIsExternal:d,startAngle:u,endAngle:f}):v=EZ({cx:n,cy:s,innerRadius:o,outerRadius:i,startAngle:u,endAngle:f}),Ce.createElement("path",pT({},ka(r,!0),{className:m,d:v,role:"img"}))};function u1(e){"@babel/helpers - typeof";return u1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u1(e)}function gT(){return gT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gT.apply(this,arguments)}function e7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function t7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e7(Object(r),!0).forEach(function(n){WLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WLe(e,t,r){return t=HLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HLe(e){var t=GLe(e,"string");return u1(t)=="symbol"?t:t+""}function GLe(e,t){if(u1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(u1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var r7={curveBasisClosed:KCe,curveBasisOpen:XCe,curveBasis:GCe,curveBumpX:TCe,curveBumpY:DCe,curveLinearClosed:YCe,curveLinear:T5,curveMonotoneX:JCe,curveMonotoneY:QCe,curveNatural:ZCe,curveStep:e5e,curveStepAfter:r5e,curveStepBefore:t5e},B2=function(t){return t.x===+t.x&&t.y===+t.y},tb=function(t){return t.x},rb=function(t){return t.y},KLe=function(t,r){if(Ka(t))return t;var n="curve".concat(I5(t));return(n==="curveMonotone"||n==="curveBump")&&r?r7["".concat(n).concat(r==="vertical"?"Y":"X")]:r7[n]||T5},XLe=function(t){var r=t.type,n=r===void 0?"linear":r,s=t.points,o=s===void 0?[]:s,i=t.baseLine,l=t.layout,c=t.connectNulls,d=c===void 0?!1:c,u=KLe(n,l),f=d?o.filter(function(g){return B2(g)}):o,h;if(Array.isArray(i)){var m=d?i.filter(function(g){return B2(g)}):i,x=f.map(function(g,v){return t7(t7({},g),{},{base:m[v]})});return l==="vertical"?h=k2().y(rb).x1(tb).x0(function(g){return g.base.x}):h=k2().x(tb).y1(rb).y0(function(g){return g.base.y}),h.defined(B2).curve(u),h(x)}return l==="vertical"&&Rn(i)?h=k2().y(rb).x1(tb).x0(i):Rn(i)?h=k2().x(tb).y1(rb).y0(i):h=NJ().x(tb).y(rb),h.defined(B2).curve(u),h(f)},Lg=function(t){var r=t.className,n=t.points,s=t.path,o=t.pathRef;if((!n||!n.length)&&!s)return null;var i=n&&n.length?XLe(t):s;return p.createElement("path",gT({},ka(t,!1),UN(t),{className:ls("recharts-curve",r),d:i,ref:o}))},kZ={exports:{}},YLe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",JLe=YLe,QLe=JLe;function IZ(){}function OZ(){}OZ.resetWarningCache=IZ;var ZLe=function(){function e(n,s,o,i,l,c){if(c!==QLe){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:OZ,resetWarningCache:IZ};return r.PropTypes=r,r};kZ.exports=ZLe();var e$e=kZ.exports;const La=Ls(e$e);var t$e=Object.getOwnPropertyNames,r$e=Object.getOwnPropertySymbols,n$e=Object.prototype.hasOwnProperty;function n7(e,t){return function(n,s,o){return e(n,s,o)&&t(n,s,o)}}function q2(e){return function(r,n,s){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,s);var o=s.cache,i=o.get(r),l=o.get(n);if(i&&l)return i===n&&l===r;o.set(r,n),o.set(n,r);var c=e(r,n,s);return o.delete(r),o.delete(n),c}}function a7(e){return t$e(e).concat(r$e(e))}var a$e=Object.hasOwn||function(e,t){return n$e.call(e,t)};function Nx(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var s$e="__v",o$e="__o",i$e="_owner",s7=Object.getOwnPropertyDescriptor,o7=Object.keys;function l$e(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function c$e(e,t){return Nx(e.getTime(),t.getTime())}function d$e(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function u$e(e,t){return e===t}function i7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.entries(),i,l,c=0;(i=o.next())&&!i.done;){for(var d=t.entries(),u=!1,f=0;(l=d.next())&&!l.done;){if(s[f]){f++;continue}var h=i.value,m=l.value;if(r.equals(h[0],m[0],c,f,e,t,r)&&r.equals(h[1],m[1],h[0],m[0],e,t,r)){u=s[f]=!0;break}f++}if(!u)return!1;c++}return!0}var f$e=Nx;function m$e(e,t,r){var n=o7(e),s=n.length;if(o7(t).length!==s)return!1;for(;s-- >0;)if(!TZ(e,t,r,n[s]))return!1;return!0}function nb(e,t,r){var n=a7(e),s=n.length;if(a7(t).length!==s)return!1;for(var o,i,l;s-- >0;)if(o=n[s],!TZ(e,t,r,o)||(i=s7(e,o),l=s7(t,o),(i||l)&&(!i||!l||i.configurable!==l.configurable||i.enumerable!==l.enumerable||i.writable!==l.writable)))return!1;return!0}function h$e(e,t){return Nx(e.valueOf(),t.valueOf())}function p$e(e,t){return e.source===t.source&&e.flags===t.flags}function l7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.values(),i,l;(i=o.next())&&!i.done;){for(var c=t.values(),d=!1,u=0;(l=c.next())&&!l.done;){if(!s[u]&&r.equals(i.value,l.value,i.value,l.value,e,t,r)){d=s[u]=!0;break}u++}if(!d)return!1}return!0}function g$e(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function x$e(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function TZ(e,t,r,n){return(n===i$e||n===o$e||n===s$e)&&(e.$$typeof||t.$$typeof)?!0:a$e(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var v$e="[object Arguments]",y$e="[object Boolean]",b$e="[object Date]",w$e="[object Error]",j$e="[object Map]",_$e="[object Number]",N$e="[object Object]",S$e="[object RegExp]",C$e="[object Set]",P$e="[object String]",A$e="[object URL]",E$e=Array.isArray,c7=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,d7=Object.assign,k$e=Object.prototype.toString.call.bind(Object.prototype.toString);function I$e(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,s=e.areFunctionsEqual,o=e.areMapsEqual,i=e.areNumbersEqual,l=e.areObjectsEqual,c=e.arePrimitiveWrappersEqual,d=e.areRegExpsEqual,u=e.areSetsEqual,f=e.areTypedArraysEqual,h=e.areUrlsEqual;return function(x,g,v){if(x===g)return!0;if(x==null||g==null)return!1;var y=typeof x;if(y!==typeof g)return!1;if(y!=="object")return y==="number"?i(x,g,v):y==="function"?s(x,g,v):!1;var b=x.constructor;if(b!==g.constructor)return!1;if(b===Object)return l(x,g,v);if(E$e(x))return t(x,g,v);if(c7!=null&&c7(x))return f(x,g,v);if(b===Date)return r(x,g,v);if(b===RegExp)return d(x,g,v);if(b===Map)return o(x,g,v);if(b===Set)return u(x,g,v);var w=k$e(x);return w===b$e?r(x,g,v):w===S$e?d(x,g,v):w===j$e?o(x,g,v):w===C$e?u(x,g,v):w===N$e?typeof x.then!="function"&&typeof g.then!="function"&&l(x,g,v):w===A$e?h(x,g,v):w===w$e?n(x,g,v):w===v$e?l(x,g,v):w===y$e||w===_$e||w===P$e?c(x,g,v):!1}}function O$e(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,s={areArraysEqual:n?nb:l$e,areDatesEqual:c$e,areErrorsEqual:d$e,areFunctionsEqual:u$e,areMapsEqual:n?n7(i7,nb):i7,areNumbersEqual:f$e,areObjectsEqual:n?nb:m$e,arePrimitiveWrappersEqual:h$e,areRegExpsEqual:p$e,areSetsEqual:n?n7(l7,nb):l7,areTypedArraysEqual:n?nb:g$e,areUrlsEqual:x$e};if(r&&(s=d7({},s,r(s))),t){var o=q2(s.areArraysEqual),i=q2(s.areMapsEqual),l=q2(s.areObjectsEqual),c=q2(s.areSetsEqual);s=d7({},s,{areArraysEqual:o,areMapsEqual:i,areObjectsEqual:l,areSetsEqual:c})}return s}function T$e(e){return function(t,r,n,s,o,i,l){return e(t,r,l)}}function D$e(e){var t=e.circular,r=e.comparator,n=e.createState,s=e.equals,o=e.strict;if(n)return function(c,d){var u=n(),f=u.cache,h=f===void 0?t?new WeakMap:void 0:f,m=u.meta;return r(c,d,{cache:h,equals:s,meta:m,strict:o})};if(t)return function(c,d){return r(c,d,{cache:new WeakMap,equals:s,meta:void 0,strict:o})};var i={cache:void 0,equals:s,meta:void 0,strict:o};return function(c,d){return r(c,d,i)}}var M$e=Rp();Rp({strict:!0});Rp({circular:!0});Rp({circular:!0,strict:!0});Rp({createInternalComparator:function(){return Nx}});Rp({strict:!0,createInternalComparator:function(){return Nx}});Rp({circular:!0,createInternalComparator:function(){return Nx}});Rp({circular:!0,createInternalComparator:function(){return Nx},strict:!0});function Rp(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,s=e.createState,o=e.strict,i=o===void 0?!1:o,l=O$e(e),c=I$e(l),d=n?n(c):T$e(c);return D$e({circular:r,comparator:c,createState:s,equals:d,strict:i})}function R$e(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function u7(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function s(o){r<0&&(r=o),o-r>t?(e(o),r=-1):R$e(s)};requestAnimationFrame(n)}function xT(e){"@babel/helpers - typeof";return xT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xT(e)}function F$e(e){return q$e(e)||B$e(e)||$$e(e)||L$e()}function L$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $$e(e,t){if(e){if(typeof e=="string")return f7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f7(e,t)}}function f7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function B$e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function q$e(e){if(Array.isArray(e))return e}function z$e(){var e={},t=function(){return null},r=!1,n=function s(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var i=o,l=F$e(i),c=l[0],d=l.slice(1);if(typeof c=="number"){u7(s.bind(null,d),c);return}s(c),u7(s.bind(null,d));return}xT(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function f1(e){"@babel/helpers - typeof";return f1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f1(e)}function m7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function h7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m7(Object(r),!0).forEach(function(n){DZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DZ(e,t,r){return t=U$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U$e(e){var t=V$e(e,"string");return f1(t)==="symbol"?t:String(t)}function V$e(e,t){if(f1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(f1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var W$e=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,s){return n.filter(function(o){return s.includes(o)})})},H$e=function(t){return t},G$e=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Yb=function(t,r){return Object.keys(r).reduce(function(n,s){return h7(h7({},n),{},DZ({},s,t(s,r[s])))},{})},p7=function(t,r,n){return t.map(function(s){return"".concat(G$e(s)," ").concat(r,"ms ").concat(n)}).join(",")};function K$e(e,t){return J$e(e)||Y$e(e,t)||MZ(e,t)||X$e()}function X$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Y$e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function J$e(e){if(Array.isArray(e))return e}function Q$e(e){return t6e(e)||e6e(e)||MZ(e)||Z$e()}function Z$e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MZ(e,t){if(e){if(typeof e=="string")return vT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vT(e,t)}}function e6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function t6e(e){if(Array.isArray(e))return vT(e)}function vT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var bS=1e-4,RZ=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},FZ=function(t,r){return t.map(function(n,s){return n*Math.pow(r,s)}).reduce(function(n,s){return n+s})},g7=function(t,r){return function(n){var s=RZ(t,r);return FZ(s,n)}},r6e=function(t,r){return function(n){var s=RZ(t,r),o=[].concat(Q$e(s.map(function(i,l){return i*l}).slice(1)),[0]);return FZ(o,n)}},x7=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0],o=r[1],i=r[2],l=r[3];if(r.length===1)switch(r[0]){case"linear":s=0,o=0,i=1,l=1;break;case"ease":s=.25,o=.1,i=.25,l=1;break;case"ease-in":s=.42,o=0,i=1,l=1;break;case"ease-out":s=.42,o=0,i=.58,l=1;break;case"ease-in-out":s=0,o=0,i=.58,l=1;break;default:{var c=r[0].split("(");if(c[0]==="cubic-bezier"&&c[1].split(")")[0].split(",").length===4){var d=c[1].split(")")[0].split(",").map(function(v){return parseFloat(v)}),u=K$e(d,4);s=u[0],o=u[1],i=u[2],l=u[3]}}}var f=g7(s,i),h=g7(o,l),m=r6e(s,i),x=function(y){return y>1?1:y<0?0:y},g=function(y){for(var b=y>1?1:y,w=b,j=0;j<8;++j){var _=f(w)-b,C=m(w);if(Math.abs(_-b)<bS||C<bS)return h(w);w=x(w-_/C)}return h(w)};return g.isStepper=!1,g},n6e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,s=t.damping,o=s===void 0?8:s,i=t.dt,l=i===void 0?17:i,c=function(u,f,h){var m=-(u-f)*n,x=h*o,g=h+(m-x)*l/1e3,v=h*l/1e3+u;return Math.abs(v-f)<bS&&Math.abs(g)<bS?[f,0]:[v,g]};return c.isStepper=!0,c.dt=l,c},a6e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0];if(typeof s=="string")switch(s){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return x7(s);case"spring":return n6e();default:if(s.split("(")[0]==="cubic-bezier")return x7(s)}return typeof s=="function"?s:null};function m1(e){"@babel/helpers - typeof";return m1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m1(e)}function v7(e){return i6e(e)||o6e(e)||LZ(e)||s6e()}function s6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function i6e(e){if(Array.isArray(e))return bT(e)}function y7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Sl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y7(Object(r),!0).forEach(function(n){yT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yT(e,t,r){return t=l6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l6e(e){var t=c6e(e,"string");return m1(t)==="symbol"?t:String(t)}function c6e(e,t){if(m1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(m1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function d6e(e,t){return m6e(e)||f6e(e,t)||LZ(e,t)||u6e()}function u6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LZ(e,t){if(e){if(typeof e=="string")return bT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bT(e,t)}}function bT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function m6e(e){if(Array.isArray(e))return e}var wS=function(t,r,n){return t+(r-t)*n},wT=function(t){var r=t.from,n=t.to;return r!==n},h6e=function e(t,r,n){var s=Yb(function(o,i){if(wT(i)){var l=t(i.from,i.to,i.velocity),c=d6e(l,2),d=c[0],u=c[1];return Sl(Sl({},i),{},{from:d,velocity:u})}return i},r);return n<1?Yb(function(o,i){return wT(i)?Sl(Sl({},i),{},{velocity:wS(i.velocity,s[o].velocity,n),from:wS(i.from,s[o].from,n)}):i},r):e(t,s,n-1)};const p6e=function(e,t,r,n,s){var o=W$e(e,t),i=o.reduce(function(v,y){return Sl(Sl({},v),{},yT({},y,[e[y],t[y]]))},{}),l=o.reduce(function(v,y){return Sl(Sl({},v),{},yT({},y,{from:e[y],velocity:0,to:t[y]}))},{}),c=-1,d,u,f=function(){return null},h=function(){return Yb(function(y,b){return b.from},l)},m=function(){return!Object.values(l).filter(wT).length},x=function(y){d||(d=y);var b=y-d,w=b/r.dt;l=h6e(r,l,w),s(Sl(Sl(Sl({},e),t),h())),d=y,m()||(c=requestAnimationFrame(f))},g=function(y){u||(u=y);var b=(y-u)/n,w=Yb(function(_,C){return wS.apply(void 0,v7(C).concat([r(b)]))},i);if(s(Sl(Sl(Sl({},e),t),w)),b<1)c=requestAnimationFrame(f);else{var j=Yb(function(_,C){return wS.apply(void 0,v7(C).concat([r(1)]))},i);s(Sl(Sl(Sl({},e),t),j))}};return f=r.isStepper?x:g,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(c)}}};function P0(e){"@babel/helpers - typeof";return P0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P0(e)}var g6e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function x6e(e,t){if(e==null)return{};var r=v6e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function v6e(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function TE(e){return j6e(e)||w6e(e)||b6e(e)||y6e()}function y6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b6e(e,t){if(e){if(typeof e=="string")return jT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jT(e,t)}}function w6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function j6e(e){if(Array.isArray(e))return jT(e)}function jT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Lu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b7(Object(r),!0).forEach(function(n){jb(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jb(e,t,r){return t=$Z(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$Z(n.key),n)}}function N6e(e,t,r){return t&&w7(e.prototype,t),r&&w7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function $Z(e){var t=S6e(e,"string");return P0(t)==="symbol"?t:String(t)}function S6e(e,t){if(P0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(P0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function C6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_T(e,t)}function _T(e,t){return _T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},_T(e,t)}function P6e(e){var t=A6e();return function(){var n=jS(e),s;if(t){var o=jS(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return NT(this,s)}}function NT(e,t){if(t&&(P0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ST(e)}function ST(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A6e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function jS(e){return jS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jS(e)}var K5=function(e){C6e(r,e);var t=P6e(r);function r(n,s){var o;_6e(this,r),o=t.call(this,n,s);var i=o.props,l=i.isActive,c=i.attributeName,d=i.from,u=i.to,f=i.steps,h=i.children,m=i.duration;if(o.handleStyleChange=o.handleStyleChange.bind(ST(o)),o.changeStyle=o.changeStyle.bind(ST(o)),!l||m<=0)return o.state={style:{}},typeof h=="function"&&(o.state={style:u}),NT(o);if(f&&f.length)o.state={style:f[0].style};else if(d){if(typeof h=="function")return o.state={style:d},NT(o);o.state={style:c?jb({},c,d):d}}else o.state={style:{}};return o}return N6e(r,[{key:"componentDidMount",value:function(){var s=this.props,o=s.isActive,i=s.canBegin;this.mounted=!0,!(!o||!i)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(s){var o=this.props,i=o.isActive,l=o.canBegin,c=o.attributeName,d=o.shouldReAnimate,u=o.to,f=o.from,h=this.state.style;if(l){if(!i){var m={style:c?jb({},c,u):u};this.state&&h&&(c&&h[c]!==u||!c&&h!==u)&&this.setState(m);return}if(!(M$e(s.to,u)&&s.canBegin&&s.isActive)){var x=!s.canBegin||!s.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var g=x||d?f:s.to;if(this.state&&h){var v={style:c?jb({},c,g):g};(c&&h[c]!==g||!c&&h!==g)&&this.setState(v)}this.runAnimation(Lu(Lu({},this.props),{},{from:g,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var s=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),s&&s()}},{key:"handleStyleChange",value:function(s){this.changeStyle(s)}},{key:"changeStyle",value:function(s){this.mounted&&this.setState({style:s})}},{key:"runJSAnimation",value:function(s){var o=this,i=s.from,l=s.to,c=s.duration,d=s.easing,u=s.begin,f=s.onAnimationEnd,h=s.onAnimationStart,m=p6e(i,l,a6e(d),c,this.changeStyle),x=function(){o.stopJSAnimation=m()};this.manager.start([h,u,x,c,f])}},{key:"runStepAnimation",value:function(s){var o=this,i=s.steps,l=s.begin,c=s.onAnimationStart,d=i[0],u=d.style,f=d.duration,h=f===void 0?0:f,m=function(g,v,y){if(y===0)return g;var b=v.duration,w=v.easing,j=w===void 0?"ease":w,_=v.style,C=v.properties,A=v.onAnimationEnd,S=y>0?i[y-1]:v,P=C||Object.keys(_);if(typeof j=="function"||j==="spring")return[].concat(TE(g),[o.runJSAnimation.bind(o,{from:S.style,to:_,duration:b,easing:j}),b]);var M=p7(P,b,j),O=Lu(Lu(Lu({},S.style),_),{},{transition:M});return[].concat(TE(g),[O,b,A]).filter(H$e)};return this.manager.start([c].concat(TE(i.reduce(m,[u,Math.max(h,l)])),[s.onAnimationEnd]))}},{key:"runAnimation",value:function(s){this.manager||(this.manager=z$e());var o=s.begin,i=s.duration,l=s.attributeName,c=s.to,d=s.easing,u=s.onAnimationStart,f=s.onAnimationEnd,h=s.steps,m=s.children,x=this.manager;if(this.unSubscribe=x.subscribe(this.handleStyleChange),typeof d=="function"||typeof m=="function"||d==="spring"){this.runJSAnimation(s);return}if(h.length>1){this.runStepAnimation(s);return}var g=l?jb({},l,c):c,v=p7(Object.keys(g),i,d);x.start([u,o,Lu(Lu({},g),{},{transition:v}),i,f])}},{key:"render",value:function(){var s=this.props,o=s.children;s.begin;var i=s.duration;s.attributeName,s.easing;var l=s.isActive;s.steps,s.from,s.to,s.canBegin,s.onAnimationEnd,s.shouldReAnimate,s.onAnimationReStart;var c=x6e(s,g6e),d=p.Children.count(o),u=this.state.style;if(typeof o=="function")return o(u);if(!l||d===0||i<=0)return o;var f=function(m){var x=m.props,g=x.style,v=g===void 0?{}:g,y=x.className,b=p.cloneElement(m,Lu(Lu({},c),{},{style:Lu(Lu({},v),u),className:y}));return b};return d===1?f(p.Children.only(o)):Ce.createElement("div",null,p.Children.map(o,function(h){return f(h)}))}}]),r}(p.PureComponent);K5.displayName="Animate";K5.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};K5.propTypes={from:La.oneOfType([La.object,La.string]),to:La.oneOfType([La.object,La.string]),attributeName:La.string,duration:La.number,begin:La.number,easing:La.oneOfType([La.string,La.func]),steps:La.arrayOf(La.shape({duration:La.number.isRequired,style:La.object.isRequired,easing:La.oneOfType([La.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),La.func]),properties:La.arrayOf("string"),onAnimationEnd:La.func})),children:La.oneOfType([La.node,La.func]),isActive:La.bool,canBegin:La.bool,onAnimationEnd:La.func,shouldReAnimate:La.bool,onAnimationStart:La.func,onAnimationReStart:La.func};const wp=K5;function Wa(){return Wa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Wa.apply(null,arguments)}function _S(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function BZ(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_O(e,t)}function h1(e){"@babel/helpers - typeof";return h1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h1(e)}function NS(){return NS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},NS.apply(this,arguments)}function E6e(e,t){return T6e(e)||O6e(e,t)||I6e(e,t)||k6e()}function k6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I6e(e,t){if(e){if(typeof e=="string")return j7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j7(e,t)}}function j7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function O6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function T6e(e){if(Array.isArray(e))return e}function _7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function N7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_7(Object(r),!0).forEach(function(n){D6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D6e(e,t,r){return t=M6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M6e(e){var t=R6e(e,"string");return h1(t)=="symbol"?t:t+""}function R6e(e,t){if(h1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(h1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var S7=function(t,r,n,s,o){var i=Math.min(Math.abs(n)/2,Math.abs(s)/2),l=s>=0?1:-1,c=n>=0?1:-1,d=s>=0&&n>=0||s<0&&n<0?1:0,u;if(i>0&&o instanceof Array){for(var f=[0,0,0,0],h=0,m=4;h<m;h++)f[h]=o[h]>i?i:o[h];u="M".concat(t,",").concat(r+l*f[0]),f[0]>0&&(u+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(d,",").concat(t+c*f[0],",").concat(r)),u+="L ".concat(t+n-c*f[1],",").concat(r),f[1]>0&&(u+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(d,`,
        `).concat(t+n,",").concat(r+l*f[1])),u+="L ".concat(t+n,",").concat(r+s-l*f[2]),f[2]>0&&(u+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(d,`,
        `).concat(t+n-c*f[2],",").concat(r+s)),u+="L ".concat(t+c*f[3],",").concat(r+s),f[3]>0&&(u+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(d,`,
        `).concat(t,",").concat(r+s-l*f[3])),u+="Z"}else if(i>0&&o===+o&&o>0){var x=Math.min(i,o);u="M ".concat(t,",").concat(r+l*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+c*x,",").concat(r,`
            L `).concat(t+n-c*x,",").concat(r,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+n,",").concat(r+l*x,`
            L `).concat(t+n,",").concat(r+s-l*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+n-c*x,",").concat(r+s,`
            L `).concat(t+c*x,",").concat(r+s,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t,",").concat(r+s-l*x," Z")}else u="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(s," h ").concat(-n," Z");return u},F6e=function(t,r){if(!t||!r)return!1;var n=t.x,s=t.y,o=r.x,i=r.y,l=r.width,c=r.height;if(Math.abs(l)>0&&Math.abs(c)>0){var d=Math.min(o,o+l),u=Math.max(o,o+l),f=Math.min(i,i+c),h=Math.max(i,i+c);return n>=d&&n<=u&&s>=f&&s<=h}return!1},L6e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},QM=function(t){var r=N7(N7({},L6e),t),n=p.useRef(),s=p.useState(-1),o=E6e(s,2),i=o[0],l=o[1];p.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var j=n.current.getTotalLength();j&&l(j)}catch{}},[]);var c=r.x,d=r.y,u=r.width,f=r.height,h=r.radius,m=r.className,x=r.animationEasing,g=r.animationDuration,v=r.animationBegin,y=r.isAnimationActive,b=r.isUpdateAnimationActive;if(c!==+c||d!==+d||u!==+u||f!==+f||u===0||f===0)return null;var w=ls("recharts-rectangle",m);return b?Ce.createElement(wp,{canBegin:i>0,from:{width:u,height:f,x:c,y:d},to:{width:u,height:f,x:c,y:d},duration:g,animationEasing:x,isActive:b},function(j){var _=j.width,C=j.height,A=j.x,S=j.y;return Ce.createElement(wp,{canBegin:i>0,from:"0px ".concat(i===-1?1:i,"px"),to:"".concat(i,"px 0px"),attributeName:"strokeDasharray",begin:v,duration:g,isActive:y,easing:x},Ce.createElement("path",NS({},ka(r,!0),{className:w,d:S7(A,S,_,C,h),ref:n})))}):Ce.createElement("path",NS({},ka(r,!0),{className:w,d:S7(c,d,u,f,h)}))},$6e=["points","className","baseLinePoints","connectNulls"];function kv(){return kv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kv.apply(this,arguments)}function B6e(e,t){if(e==null)return{};var r=q6e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function q6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function C7(e){return W6e(e)||V6e(e)||U6e(e)||z6e()}function z6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U6e(e,t){if(e){if(typeof e=="string")return CT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CT(e,t)}}function V6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function W6e(e){if(Array.isArray(e))return CT(e)}function CT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var P7=function(t){return t&&t.x===+t.x&&t.y===+t.y},H6e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){P7(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),P7(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},Jb=function(t,r){var n=H6e(t);r&&(n=[n.reduce(function(o,i){return[].concat(C7(o),C7(i))},[])]);var s=n.map(function(o){return o.reduce(function(i,l,c){return"".concat(i).concat(c===0?"M":"L").concat(l.x,",").concat(l.y)},"")}).join("");return n.length===1?"".concat(s,"Z"):s},G6e=function(t,r,n){var s=Jb(t,n);return"".concat(s.slice(-1)==="Z"?s.slice(0,-1):s,"L").concat(Jb(r.reverse(),n).slice(1))},K6e=function(t){var r=t.points,n=t.className,s=t.baseLinePoints,o=t.connectNulls,i=B6e(t,$6e);if(!r||!r.length)return null;var l=ls("recharts-polygon",n);if(s&&s.length){var c=i.stroke&&i.stroke!=="none",d=G6e(r,s,o);return Ce.createElement("g",{className:l},Ce.createElement("path",kv({},ka(i,!0),{fill:d.slice(-1)==="Z"?i.fill:"none",stroke:"none",d})),c?Ce.createElement("path",kv({},ka(i,!0),{fill:"none",d:Jb(r,o)})):null,c?Ce.createElement("path",kv({},ka(i,!0),{fill:"none",d:Jb(s,o)})):null)}var u=Jb(r,o);return Ce.createElement("path",kv({},ka(i,!0),{fill:u.slice(-1)==="Z"?i.fill:"none",className:l,d:u}))};function PT(){return PT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PT.apply(this,arguments)}var mj=function(t){var r=t.cx,n=t.cy,s=t.r,o=t.className,i=ls("recharts-dot",o);return r===+r&&n===+n&&s===+s?p.createElement("circle",PT({},ka(t,!1),UN(t),{className:i,cx:r,cy:n,r:s})):null};function p1(e){"@babel/helpers - typeof";return p1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p1(e)}var X6e=["x","y","top","left","width","height","className"];function AT(){return AT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AT.apply(this,arguments)}function A7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Y6e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A7(Object(r),!0).forEach(function(n){J6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function J6e(e,t,r){return t=Q6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q6e(e){var t=Z6e(e,"string");return p1(t)=="symbol"?t:t+""}function Z6e(e,t){if(p1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(p1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function e8e(e,t){if(e==null)return{};var r=t8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function t8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var r8e=function(t,r,n,s,o,i){return"M".concat(t,",").concat(o,"v").concat(s,"M").concat(i,",").concat(r,"h").concat(n)},n8e=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,i=t.top,l=i===void 0?0:i,c=t.left,d=c===void 0?0:c,u=t.width,f=u===void 0?0:u,h=t.height,m=h===void 0?0:h,x=t.className,g=e8e(t,X6e),v=Y6e({x:n,y:o,top:l,left:d,width:f,height:m},g);return!Rn(n)||!Rn(o)||!Rn(f)||!Rn(m)||!Rn(l)||!Rn(d)?null:Ce.createElement("path",AT({},ka(v,!0),{className:ls("recharts-cross",x),d:r8e(n,o,f,m,l,d)}))},a8e=V5,s8e=QQ,o8e=nm;function i8e(e,t){return e&&e.length?a8e(e,o8e(t),s8e):void 0}var l8e=i8e;const c8e=Ls(l8e);var d8e=V5,u8e=nm,f8e=ZQ;function m8e(e,t){return e&&e.length?d8e(e,u8e(t),f8e):void 0}var h8e=m8e;const p8e=Ls(h8e);var g8e=["cx","cy","angle","ticks","axisLine"],x8e=["ticks","tick","angle","tickFormatter","stroke"];function A0(e){"@babel/helpers - typeof";return A0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A0(e)}function Qb(){return Qb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qb.apply(this,arguments)}function E7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Gp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E7(Object(r),!0).forEach(function(n){X5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k7(e,t){if(e==null)return{};var r=v8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function v8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function y8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zZ(n.key),n)}}function b8e(e,t,r){return t&&I7(e.prototype,t),r&&I7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function w8e(e,t,r){return t=SS(t),j8e(e,qZ()?Reflect.construct(t,r||[],SS(e).constructor):t.apply(e,r))}function j8e(e,t){if(t&&(A0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _8e(e)}function _8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qZ=function(){return!!e})()}function SS(e){return SS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},SS(e)}function N8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ET(e,t)}function ET(e,t){return ET=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},ET(e,t)}function X5(e,t,r){return t=zZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zZ(e){var t=S8e(e,"string");return A0(t)=="symbol"?t:t+""}function S8e(e,t){if(A0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(A0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Y5=function(e){function t(){return y8e(this,t),w8e(this,t,arguments)}return N8e(t,e),b8e(t,[{key:"getTickValueCoord",value:function(n){var s=n.coordinate,o=this.props,i=o.angle,l=o.cx,c=o.cy;return Oo(l,c,s,i)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,s;switch(n){case"left":s="end";break;case"right":s="start";break;default:s="middle";break}return s}},{key:"getViewBox",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.angle,l=n.ticks,c=c8e(l,function(u){return u.coordinate||0}),d=p8e(l,function(u){return u.coordinate||0});return{cx:s,cy:o,startAngle:i,endAngle:i,innerRadius:d.coordinate||0,outerRadius:c.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.angle,l=n.ticks,c=n.axisLine,d=k7(n,g8e),u=l.reduce(function(x,g){return[Math.min(x[0],g.coordinate),Math.max(x[1],g.coordinate)]},[1/0,-1/0]),f=Oo(s,o,u[0],i),h=Oo(s,o,u[1],i),m=Gp(Gp(Gp({},ka(d,!1)),{},{fill:"none"},ka(c,!1)),{},{x1:f.x,y1:f.y,x2:h.x,y2:h.y});return Ce.createElement("line",Qb({className:"recharts-polar-radius-axis-line"},m))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,i=s.tick,l=s.angle,c=s.tickFormatter,d=s.stroke,u=k7(s,x8e),f=this.getTickTextAnchor(),h=ka(u,!1),m=ka(i,!1),x=o.map(function(g,v){var y=n.getTickValueCoord(g),b=Gp(Gp(Gp(Gp({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(y.x,", ").concat(y.y,")")},h),{},{stroke:"none",fill:d},m),{},{index:v},y),{},{payload:g});return Ce.createElement(Cs,Qb({className:ls("recharts-polar-radius-axis-tick",PZ(i)),key:"tick-".concat(g.coordinate)},rx(n.props,g,v)),t.renderTickItem(i,b,c?c(g.value,v):g.value))});return Ce.createElement(Cs,{className:"recharts-polar-radius-axis-ticks"},x)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.axisLine,i=n.tick;return!s||!s.length?null:Ce.createElement(Cs,{className:ls("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),i&&this.renderTicks(),il.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,s,o){var i;return Ce.isValidElement(n)?i=Ce.cloneElement(n,s):Ka(n)?i=n(s):i=Ce.createElement(nx,Qb({},s,{className:"recharts-polar-radius-axis-tick-value"}),o),i}}])}(p.PureComponent);X5(Y5,"displayName","PolarRadiusAxis");X5(Y5,"axisType","radiusAxis");X5(Y5,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function E0(e){"@babel/helpers - typeof";return E0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E0(e)}function mg(){return mg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mg.apply(this,arguments)}function O7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Kp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O7(Object(r),!0).forEach(function(n){J5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function C8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VZ(n.key),n)}}function P8e(e,t,r){return t&&T7(e.prototype,t),r&&T7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function A8e(e,t,r){return t=CS(t),E8e(e,UZ()?Reflect.construct(t,r||[],CS(e).constructor):t.apply(e,r))}function E8e(e,t){if(t&&(E0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k8e(e)}function k8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UZ=function(){return!!e})()}function CS(e){return CS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},CS(e)}function I8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kT(e,t)}function kT(e,t){return kT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},kT(e,t)}function J5(e,t,r){return t=VZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VZ(e){var t=O8e(e,"string");return E0(t)=="symbol"?t:t+""}function O8e(e,t){if(E0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(E0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var T8e=Math.PI/180,D7=1e-5,Q5=function(e){function t(){return C8e(this,t),A8e(this,t,arguments)}return I8e(t,e),P8e(t,[{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.cx,i=s.cy,l=s.radius,c=s.orientation,d=s.tickSize,u=d||8,f=Oo(o,i,l,n.coordinate),h=Oo(o,i,l+(c==="inner"?-1:1)*u,n.coordinate);return{x1:f.x,y1:f.y,x2:h.x,y2:h.y}}},{key:"getTickTextAnchor",value:function(n){var s=this.props.orientation,o=Math.cos(-n.coordinate*T8e),i;return o>D7?i=s==="outer"?"start":"end":o<-D7?i=s==="outer"?"end":"start":i="middle",i}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.radius,l=n.axisLine,c=n.axisLineType,d=Kp(Kp({},ka(this.props,!1)),{},{fill:"none"},ka(l,!1));if(c==="circle")return Ce.createElement(mj,mg({className:"recharts-polar-angle-axis-line"},d,{cx:s,cy:o,r:i}));var u=this.props.ticks,f=u.map(function(h){return Oo(s,o,i,h.coordinate)});return Ce.createElement(K6e,mg({className:"recharts-polar-angle-axis-line"},d,{points:f}))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,i=s.tick,l=s.tickLine,c=s.tickFormatter,d=s.stroke,u=ka(this.props,!1),f=ka(i,!1),h=Kp(Kp({},u),{},{fill:"none"},ka(l,!1)),m=o.map(function(x,g){var v=n.getTickLineCoord(x),y=n.getTickTextAnchor(x),b=Kp(Kp(Kp({textAnchor:y},u),{},{stroke:"none",fill:d},f),{},{index:g,payload:x,x:v.x2,y:v.y2});return Ce.createElement(Cs,mg({className:ls("recharts-polar-angle-axis-tick",PZ(i)),key:"tick-".concat(x.coordinate)},rx(n.props,x,g)),l&&Ce.createElement("line",mg({className:"recharts-polar-angle-axis-tick-line"},h,v)),i&&t.renderTickItem(i,b,c?c(x.value,g):x.value))});return Ce.createElement(Cs,{className:"recharts-polar-angle-axis-ticks"},m)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.radius,i=n.axisLine;return o<=0||!s||!s.length?null:Ce.createElement(Cs,{className:ls("recharts-polar-angle-axis",this.props.className)},i&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,s,o){var i;return Ce.isValidElement(n)?i=Ce.cloneElement(n,s):Ka(n)?i=n(s):i=Ce.createElement(nx,mg({},s,{className:"recharts-polar-angle-axis-tick-value"}),o),i}}])}(p.PureComponent);J5(Q5,"displayName","PolarAngleAxis");J5(Q5,"axisType","angleAxis");J5(Q5,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var D8e=KJ,M8e=D8e(Object.getPrototypeOf,Object),R8e=M8e,F8e=Qm,L8e=R8e,$8e=Zm,B8e="[object Object]",q8e=Function.prototype,z8e=Object.prototype,WZ=q8e.toString,U8e=z8e.hasOwnProperty,V8e=WZ.call(Object);function W8e(e){if(!$8e(e)||F8e(e)!=B8e)return!1;var t=L8e(e);if(t===null)return!0;var r=U8e.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&WZ.call(r)==V8e}var H8e=W8e;const G8e=Ls(H8e);var K8e=Qm,X8e=Zm,Y8e="[object Boolean]";function J8e(e){return e===!0||e===!1||X8e(e)&&K8e(e)==Y8e}var Q8e=J8e;const Z8e=Ls(Q8e);function g1(e){"@babel/helpers - typeof";return g1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g1(e)}function PS(){return PS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PS.apply(this,arguments)}function eBe(e,t){return aBe(e)||nBe(e,t)||rBe(e,t)||tBe()}function tBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rBe(e,t){if(e){if(typeof e=="string")return M7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M7(e,t)}}function M7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function nBe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function aBe(e){if(Array.isArray(e))return e}function R7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function F7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?R7(Object(r),!0).forEach(function(n){sBe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sBe(e,t,r){return t=oBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oBe(e){var t=iBe(e,"string");return g1(t)=="symbol"?t:t+""}function iBe(e,t){if(g1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(g1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var L7=function(t,r,n,s,o){var i=n-s,l;return l="M ".concat(t,",").concat(r),l+="L ".concat(t+n,",").concat(r),l+="L ".concat(t+n-i/2,",").concat(r+o),l+="L ".concat(t+n-i/2-s,",").concat(r+o),l+="L ".concat(t,",").concat(r," Z"),l},lBe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},cBe=function(t){var r=F7(F7({},lBe),t),n=p.useRef(),s=p.useState(-1),o=eBe(s,2),i=o[0],l=o[1];p.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var w=n.current.getTotalLength();w&&l(w)}catch{}},[]);var c=r.x,d=r.y,u=r.upperWidth,f=r.lowerWidth,h=r.height,m=r.className,x=r.animationEasing,g=r.animationDuration,v=r.animationBegin,y=r.isUpdateAnimationActive;if(c!==+c||d!==+d||u!==+u||f!==+f||h!==+h||u===0&&f===0||h===0)return null;var b=ls("recharts-trapezoid",m);return y?Ce.createElement(wp,{canBegin:i>0,from:{upperWidth:0,lowerWidth:0,height:h,x:c,y:d},to:{upperWidth:u,lowerWidth:f,height:h,x:c,y:d},duration:g,animationEasing:x,isActive:y},function(w){var j=w.upperWidth,_=w.lowerWidth,C=w.height,A=w.x,S=w.y;return Ce.createElement(wp,{canBegin:i>0,from:"0px ".concat(i===-1?1:i,"px"),to:"".concat(i,"px 0px"),attributeName:"strokeDasharray",begin:v,duration:g,easing:x},Ce.createElement("path",PS({},ka(r,!0),{className:b,d:L7(A,S,j,_,C),ref:n})))}):Ce.createElement("g",null,Ce.createElement("path",PS({},ka(r,!0),{className:b,d:L7(c,d,u,f,h)})))},dBe=["option","shapeType","propTransformer","activeClassName","isActive"];function x1(e){"@babel/helpers - typeof";return x1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x1(e)}function uBe(e,t){if(e==null)return{};var r=fBe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fBe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function $7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function AS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$7(Object(r),!0).forEach(function(n){mBe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mBe(e,t,r){return t=hBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hBe(e){var t=pBe(e,"string");return x1(t)=="symbol"?t:t+""}function pBe(e,t){if(x1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(x1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gBe(e,t){return AS(AS({},t),e)}function xBe(e,t){return e==="symbols"}function B7(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ce.createElement(QM,r);case"trapezoid":return Ce.createElement(cBe,r);case"sector":return Ce.createElement(JM,r);case"symbols":if(xBe(t))return Ce.createElement(gM,r);break;default:return null}}function vBe(e){return p.isValidElement(e)?e.props:e}function HZ(e){var t=e.option,r=e.shapeType,n=e.propTransformer,s=n===void 0?gBe:n,o=e.activeClassName,i=o===void 0?"recharts-active-shape":o,l=e.isActive,c=uBe(e,dBe),d;if(p.isValidElement(t))d=p.cloneElement(t,AS(AS({},c),vBe(t)));else if(Ka(t))d=t(c);else if(G8e(t)&&!Z8e(t)){var u=s(t,c);d=Ce.createElement(B7,{shapeType:r,elementProps:u})}else{var f=c;d=Ce.createElement(B7,{shapeType:r,elementProps:f})}return l?Ce.createElement(Cs,{className:i},d):d}function Z5(e,t){return t!=null&&"trapezoids"in e.props}function eP(e,t){return t!=null&&"sectors"in e.props}function v1(e,t){return t!=null&&"points"in e.props}function yBe(e,t){var r,n,s=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return s&&o}function bBe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function wBe(e,t){var r=e.x===t.x,n=e.y===t.y,s=e.z===t.z;return r&&n&&s}function jBe(e,t){var r;return Z5(e,t)?r=yBe:eP(e,t)?r=bBe:v1(e,t)&&(r=wBe),r}function _Be(e,t){var r;return Z5(e,t)?r="trapezoids":eP(e,t)?r="sectors":v1(e,t)&&(r="points"),r}function NBe(e,t){if(Z5(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(eP(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return v1(e,t)?t.payload:{}}function SBe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,s=_Be(r,t),o=NBe(r,t),i=n.filter(function(c,d){var u=ax(o,c),f=r.props[s].filter(function(x){var g=jBe(r,t);return g(x,t)}),h=r.props[s].indexOf(f[f.length-1]),m=d===h;return u&&m}),l=n.indexOf(i[i.length-1]);return l}var R_;function k0(e){"@babel/helpers - typeof";return k0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k0(e)}function Iv(){return Iv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Iv.apply(this,arguments)}function q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Co(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q7(Object(r),!0).forEach(function(n){cu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CBe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,KZ(n.key),n)}}function PBe(e,t,r){return t&&z7(e.prototype,t),r&&z7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ABe(e,t,r){return t=ES(t),EBe(e,GZ()?Reflect.construct(t,r||[],ES(e).constructor):t.apply(e,r))}function EBe(e,t){if(t&&(k0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kBe(e)}function kBe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function GZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GZ=function(){return!!e})()}function ES(e){return ES=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ES(e)}function IBe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IT(e,t)}function IT(e,t){return IT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},IT(e,t)}function cu(e,t,r){return t=KZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KZ(e){var t=OBe(e,"string");return k0(t)=="symbol"?t:t+""}function OBe(e,t){if(k0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(k0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var em=function(e){function t(r){var n;return CBe(this,t),n=ABe(this,t,[r]),cu(n,"pieRef",null),cu(n,"sectorRefs",[]),cu(n,"id",wx("recharts-pie-")),cu(n,"handleAnimationEnd",function(){var s=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Ka(s)&&s()}),cu(n,"handleAnimationStart",function(){var s=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Ka(s)&&s()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return IBe(t,e),PBe(t,[{key:"isActiveIndex",value:function(n){var s=this.props.activeIndex;return Array.isArray(s)?s.indexOf(n)!==-1:n===s}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.label,l=o.labelLine,c=o.dataKey,d=o.valueKey,u=ka(this.props,!1),f=ka(i,!1),h=ka(l,!1),m=i&&i.offsetRadius||20,x=n.map(function(g,v){var y=(g.startAngle+g.endAngle)/2,b=Oo(g.cx,g.cy,g.outerRadius+m,y),w=Co(Co(Co(Co({},u),g),{},{stroke:"none"},f),{},{index:v,textAnchor:t.getTextAnchor(b.x,g.cx)},b),j=Co(Co(Co(Co({},u),g),{},{fill:"none",stroke:g.fill},h),{},{index:v,points:[Oo(g.cx,g.cy,g.outerRadius,y),b]}),_=c;return ss(c)&&ss(d)?_="value":ss(c)&&(_=d),Ce.createElement(Cs,{key:"label-".concat(g.startAngle,"-").concat(g.endAngle,"-").concat(g.midAngle,"-").concat(v)},l&&t.renderLabelLineItem(l,j,"line"),t.renderLabelItem(i,w,bi(g,_)))});return Ce.createElement(Cs,{className:"recharts-pie-labels"},x)}},{key:"renderSectorsStatically",value:function(n){var s=this,o=this.props,i=o.activeShape,l=o.blendStroke,c=o.inactiveShape;return n.map(function(d,u){if(d?.startAngle===0&&d?.endAngle===0&&n.length!==1)return null;var f=s.isActiveIndex(u),h=c&&s.hasActiveIndex()?c:null,m=f?i:h,x=Co(Co({},d),{},{stroke:l?d.fill:d.stroke,tabIndex:-1});return Ce.createElement(Cs,Iv({ref:function(v){v&&!s.sectorRefs.includes(v)&&s.sectorRefs.push(v)},tabIndex:-1,className:"recharts-pie-sector"},rx(s.props,d,u),{key:"sector-".concat(d?.startAngle,"-").concat(d?.endAngle,"-").concat(d.midAngle,"-").concat(u)}),Ce.createElement(HZ,Iv({option:m,isActive:f,shapeType:"sector"},x)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,s=this.props,o=s.sectors,i=s.isAnimationActive,l=s.animationBegin,c=s.animationDuration,d=s.animationEasing,u=s.animationId,f=this.state,h=f.prevSectors,m=f.prevIsAnimationActive;return Ce.createElement(wp,{begin:l,duration:c,isActive:i,easing:d,from:{t:0},to:{t:1},key:"pie-".concat(u,"-").concat(m),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(x){var g=x.t,v=[],y=o&&o[0],b=y.startAngle;return o.forEach(function(w,j){var _=h&&h[j],C=j>0?Od(w,"paddingAngle",0):0;if(_){var A=Wi(_.endAngle-_.startAngle,w.endAngle-w.startAngle),S=Co(Co({},w),{},{startAngle:b+C,endAngle:b+A(g)+C});v.push(S),b=S.endAngle}else{var P=w.endAngle,M=w.startAngle,O=Wi(0,P-M),I=O(g),T=Co(Co({},w),{},{startAngle:b+C,endAngle:b+I+C});v.push(T),b=T.endAngle}}),Ce.createElement(Cs,null,n.renderSectorsStatically(v))})}},{key:"attachKeyboardHandlers",value:function(n){var s=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var i=++s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[i].focus(),s.setState({sectorToFocus:i});break}case"ArrowRight":{var l=--s.state.sectorToFocus<0?s.sectorRefs.length-1:s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[l].focus(),s.setState({sectorToFocus:l});break}case"Escape":{s.sectorRefs[s.state.sectorToFocus].blur(),s.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,s=n.sectors,o=n.isAnimationActive,i=this.state.prevSectors;return o&&s&&s.length&&(!i||!ax(i,s))?this.renderSectorsWithAnimation():this.renderSectorsStatically(s)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,s=this.props,o=s.hide,i=s.sectors,l=s.className,c=s.label,d=s.cx,u=s.cy,f=s.innerRadius,h=s.outerRadius,m=s.isAnimationActive,x=this.state.isAnimationFinished;if(o||!i||!i.length||!Rn(d)||!Rn(u)||!Rn(f)||!Rn(h))return null;var g=ls("recharts-pie",l);return Ce.createElement(Cs,{tabIndex:this.props.rootTabIndex,className:g,ref:function(y){n.pieRef=y}},this.renderSectors(),c&&this.renderLabels(i),il.renderCallByParent(this.props,null,!1),(!m||x)&&Gf.renderCallByParent(this.props,i,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return s.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:s.curSectors,isAnimationFinished:!0}:n.sectors!==s.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,s){return n>s?"start":n<s?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,s,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,s);if(Ka(n))return n(s);var i=ls("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ce.createElement(Lg,Iv({},s,{key:o,type:"linear",className:i}))}},{key:"renderLabelItem",value:function(n,s,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,s);var i=o;if(Ka(n)&&(i=n(s),Ce.isValidElement(i)))return i;var l=ls("recharts-pie-label-text",typeof n!="boolean"&&!Ka(n)?n.className:"");return Ce.createElement(nx,Iv({},s,{alignmentBaseline:"middle",className:l}),i)}}])}(p.PureComponent);R_=em;cu(em,"displayName","Pie");cu(em,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!sf.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});cu(em,"parseDeltaAngle",function(e,t){var r=yc(t-e),n=Math.min(Math.abs(t-e),360);return r*n});cu(em,"getRealPieData",function(e){var t=e.data,r=e.children,n=ka(e,!1),s=Td(r,Kw);return t&&t.length?t.map(function(o,i){return Co(Co(Co({payload:o},n),o),s&&s[i]&&s[i].props)}):s&&s.length?s.map(function(o){return Co(Co({},n),o.props)}):[]});cu(em,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,s=t.width,o=t.height,i=CZ(s,o),l=n+bc(e.cx,s,s/2),c=r+bc(e.cy,o,o/2),d=bc(e.innerRadius,i,0),u=bc(e.outerRadius,i,i*.8),f=e.maxRadius||Math.sqrt(s*s+o*o)/2;return{cx:l,cy:c,innerRadius:d,outerRadius:u,maxRadius:f}});cu(em,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Co(Co({},t.type.defaultProps),t.props):t.props,s=R_.getRealPieData(n);if(!s||!s.length)return null;var o=n.cornerRadius,i=n.startAngle,l=n.endAngle,c=n.paddingAngle,d=n.dataKey,u=n.nameKey,f=n.valueKey,h=n.tooltipType,m=Math.abs(n.minAngle),x=R_.parseCoordinateOfPie(n,r),g=R_.parseDeltaAngle(i,l),v=Math.abs(g),y=d;ss(d)&&ss(f)?(af(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),y="value"):ss(d)&&(af(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),y=f);var b=s.filter(function(S){return bi(S,y,0)!==0}).length,w=(v>=360?b:b-1)*c,j=v-b*m-w,_=s.reduce(function(S,P){var M=bi(P,y,0);return S+(Rn(M)?M:0)},0),C;if(_>0){var A;C=s.map(function(S,P){var M=bi(S,y,0),O=bi(S,u,P),I=(Rn(M)?M:0)/_,T;P?T=A.endAngle+yc(g)*c*(M!==0?1:0):T=i;var k=T+yc(g)*((M!==0?m:0)+I*j),$=(T+k)/2,q=(x.innerRadius+x.outerRadius)/2,z=[{name:O,value:M,payload:S,dataKey:y,type:h}],F=Oo(x.cx,x.cy,q,$);return A=Co(Co(Co({percent:I,cornerRadius:o,name:O,tooltipPayload:z,midAngle:$,middleRadius:q,tooltipPosition:F},S),x),{},{value:bi(S,y),startAngle:T,endAngle:k,payload:S,paddingAngle:yc(g)*c}),A})}return Co(Co({},x),{},{sectors:C,data:s})});var TBe=Math.ceil,DBe=Math.max;function MBe(e,t,r,n){for(var s=-1,o=DBe(TBe((t-e)/(r||1)),0),i=Array(o);o--;)i[n?o:++s]=e,e+=r;return i}var RBe=MBe,FBe=mQ,U7=1/0,LBe=17976931348623157e292;function $Be(e){if(!e)return e===0?e:0;if(e=FBe(e),e===U7||e===-U7){var t=e<0?-1:1;return t*LBe}return e===e?e:0}var XZ=$Be,BBe=RBe,qBe=F5,DE=XZ;function zBe(e){return function(t,r,n){return n&&typeof n!="number"&&qBe(t,r,n)&&(r=n=void 0),t=DE(t),r===void 0?(r=t,t=0):r=DE(r),n=n===void 0?t<r?1:-1:DE(n),BBe(t,r,n,e)}}var UBe=zBe,VBe=UBe,WBe=VBe(),HBe=WBe;const kS=Ls(HBe);function y1(e){"@babel/helpers - typeof";return y1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y1(e)}function V7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function W7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V7(Object(r),!0).forEach(function(n){YZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YZ(e,t,r){return t=GBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function GBe(e){var t=KBe(e,"string");return y1(t)=="symbol"?t:t+""}function KBe(e,t){if(y1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(y1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var XBe=["Webkit","Moz","O","ms"],YBe=function(t,r){if(!t)return null;var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),s=XBe.reduce(function(o,i){return W7(W7({},o),{},YZ({},i+n,r))},{});return s[t]=r,s};function I0(e){"@babel/helpers - typeof";return I0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I0(e)}function IS(){return IS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},IS.apply(this,arguments)}function H7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ME(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H7(Object(r),!0).forEach(function(n){pd(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JBe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,QZ(n.key),n)}}function QBe(e,t,r){return t&&G7(e.prototype,t),r&&G7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ZBe(e,t,r){return t=OS(t),eqe(e,JZ()?Reflect.construct(t,r||[],OS(e).constructor):t.apply(e,r))}function eqe(e,t){if(t&&(I0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tqe(e)}function tqe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(JZ=function(){return!!e})()}function OS(e){return OS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},OS(e)}function rqe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OT(e,t)}function OT(e,t){return OT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},OT(e,t)}function pd(e,t,r){return t=QZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QZ(e){var t=nqe(e,"string");return I0(t)=="symbol"?t:t+""}function nqe(e,t){if(I0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(I0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var aqe=function(t){var r=t.data,n=t.startIndex,s=t.endIndex,o=t.x,i=t.width,l=t.travellerWidth;if(!r||!r.length)return{};var c=r.length,d=Kb().domain(kS(0,c)).range([o,o+i-l]),u=d.domain().map(function(f){return d(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:d(n),endX:d(s),scale:d,scaleValues:u}},K7=function(t){return t.changedTouches&&!!t.changedTouches.length},O0=function(e){function t(r){var n;return JBe(this,t),n=ZBe(this,t,[r]),pd(n,"handleDrag",function(s){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(s):n.state.isSlideMoving&&n.handleSlideDrag(s)}),pd(n,"handleTouchMove",function(s){s.changedTouches!=null&&s.changedTouches.length>0&&n.handleDrag(s.changedTouches[0])}),pd(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var s=n.props,o=s.endIndex,i=s.onDragEnd,l=s.startIndex;i?.({endIndex:o,startIndex:l})}),n.detachDragEndListener()}),pd(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),pd(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),pd(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),pd(n,"handleSlideDragStart",function(s){var o=K7(s)?s.changedTouches[0]:s;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return rqe(t,e),QBe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var s=n.startX,o=n.endX,i=this.state.scaleValues,l=this.props,c=l.gap,d=l.data,u=d.length-1,f=Math.min(s,o),h=Math.max(s,o),m=t.getIndexInRange(i,f),x=t.getIndexInRange(i,h);return{startIndex:m-m%c,endIndex:x===u?u:x-x%c}}},{key:"getTextOfTick",value:function(n){var s=this.props,o=s.data,i=s.tickFormatter,l=s.dataKey,c=bi(o[n],l,n);return Ka(i)?i(c,n):c}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var s=this.state,o=s.slideMoveStartX,i=s.startX,l=s.endX,c=this.props,d=c.x,u=c.width,f=c.travellerWidth,h=c.startIndex,m=c.endIndex,x=c.onChange,g=n.pageX-o;g>0?g=Math.min(g,d+u-f-l,d+u-f-i):g<0&&(g=Math.max(g,d-i,d-l));var v=this.getIndex({startX:i+g,endX:l+g});(v.startIndex!==h||v.endIndex!==m)&&x&&x(v),this.setState({startX:i+g,endX:l+g,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,s){var o=K7(s)?s.changedTouches[0]:s;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var s=this.state,o=s.brushMoveStartX,i=s.movingTravellerId,l=s.endX,c=s.startX,d=this.state[i],u=this.props,f=u.x,h=u.width,m=u.travellerWidth,x=u.onChange,g=u.gap,v=u.data,y={startX:this.state.startX,endX:this.state.endX},b=n.pageX-o;b>0?b=Math.min(b,f+h-m-d):b<0&&(b=Math.max(b,f-d)),y[i]=d+b;var w=this.getIndex(y),j=w.startIndex,_=w.endIndex,C=function(){var S=v.length-1;return i==="startX"&&(l>c?j%g===0:_%g===0)||l<c&&_===S||i==="endX"&&(l>c?_%g===0:j%g===0)||l>c&&_===S};this.setState(pd(pd({},i,d+b),"brushMoveStartX",n.pageX),function(){x&&C()&&x(w)})}},{key:"handleTravellerMoveKeyboard",value:function(n,s){var o=this,i=this.state,l=i.scaleValues,c=i.startX,d=i.endX,u=this.state[s],f=l.indexOf(u);if(f!==-1){var h=f+n;if(!(h===-1||h>=l.length)){var m=l[h];s==="startX"&&m>=d||s==="endX"&&m<=c||this.setState(pd({},s,m),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.fill,d=n.stroke;return Ce.createElement("rect",{stroke:d,fill:c,x:s,y:o,width:i,height:l})}},{key:"renderPanorama",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.data,d=n.children,u=n.padding,f=p.Children.only(d);return f?Ce.cloneElement(f,{x:s,y:o,width:i,height:l,margin:u,compact:!0,data:c}):null}},{key:"renderTravellerLayer",value:function(n,s){var o,i,l=this,c=this.props,d=c.y,u=c.travellerWidth,f=c.height,h=c.traveller,m=c.ariaLabel,x=c.data,g=c.startIndex,v=c.endIndex,y=Math.max(n,this.props.x),b=ME(ME({},ka(this.props,!1)),{},{x:y,y:d,width:u,height:f}),w=m||"Min value: ".concat((o=x[g])===null||o===void 0?void 0:o.name,", Max value: ").concat((i=x[v])===null||i===void 0?void 0:i.name);return Ce.createElement(Cs,{tabIndex:0,role:"slider","aria-label":w,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[s],onTouchStart:this.travellerDragStartHandlers[s],onKeyDown:function(_){["ArrowLeft","ArrowRight"].includes(_.key)&&(_.preventDefault(),_.stopPropagation(),l.handleTravellerMoveKeyboard(_.key==="ArrowRight"?1:-1,s))},onFocus:function(){l.setState({isTravellerFocused:!0})},onBlur:function(){l.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,b))}},{key:"renderSlide",value:function(n,s){var o=this.props,i=o.y,l=o.height,c=o.stroke,d=o.travellerWidth,u=Math.min(n,s)+d,f=Math.max(Math.abs(s-n)-d,0);return Ce.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:c,fillOpacity:.2,x:u,y:i,width:f,height:l})}},{key:"renderText",value:function(){var n=this.props,s=n.startIndex,o=n.endIndex,i=n.y,l=n.height,c=n.travellerWidth,d=n.stroke,u=this.state,f=u.startX,h=u.endX,m=5,x={pointerEvents:"none",fill:d};return Ce.createElement(Cs,{className:"recharts-brush-texts"},Ce.createElement(nx,IS({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-m,y:i+l/2},x),this.getTextOfTick(s)),Ce.createElement(nx,IS({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+c+m,y:i+l/2},x),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,s=n.data,o=n.className,i=n.children,l=n.x,c=n.y,d=n.width,u=n.height,f=n.alwaysShowText,h=this.state,m=h.startX,x=h.endX,g=h.isTextActive,v=h.isSlideMoving,y=h.isTravellerMoving,b=h.isTravellerFocused;if(!s||!s.length||!Rn(l)||!Rn(c)||!Rn(d)||!Rn(u)||d<=0||u<=0)return null;var w=ls("recharts-brush",o),j=Ce.Children.count(i)===1,_=YBe("userSelect","none");return Ce.createElement(Cs,{className:w,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:_},this.renderBackground(),j&&this.renderPanorama(),this.renderSlide(m,x),this.renderTravellerLayer(m,"startX"),this.renderTravellerLayer(x,"endX"),(g||v||y||b||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var s=n.x,o=n.y,i=n.width,l=n.height,c=n.stroke,d=Math.floor(o+l/2)-1;return Ce.createElement(Ce.Fragment,null,Ce.createElement("rect",{x:s,y:o,width:i,height:l,fill:c,stroke:"none"}),Ce.createElement("line",{x1:s+1,y1:d,x2:s+i-1,y2:d,fill:"none",stroke:"#fff"}),Ce.createElement("line",{x1:s+1,y1:d+2,x2:s+i-1,y2:d+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,s){var o;return Ce.isValidElement(n)?o=Ce.cloneElement(n,s):Ka(n)?o=n(s):o=t.renderDefaultTraveller(s),o}},{key:"getDerivedStateFromProps",value:function(n,s){var o=n.data,i=n.width,l=n.x,c=n.travellerWidth,d=n.updateId,u=n.startIndex,f=n.endIndex;if(o!==s.prevData||d!==s.prevUpdateId)return ME({prevData:o,prevTravellerWidth:c,prevUpdateId:d,prevX:l,prevWidth:i},o&&o.length?aqe({data:o,width:i,x:l,travellerWidth:c,startIndex:u,endIndex:f}):{scale:null,scaleValues:null});if(s.scale&&(i!==s.prevWidth||l!==s.prevX||c!==s.prevTravellerWidth)){s.scale.range([l,l+i-c]);var h=s.scale.domain().map(function(m){return s.scale(m)});return{prevData:o,prevTravellerWidth:c,prevUpdateId:d,prevX:l,prevWidth:i,startX:s.scale(n.startIndex),endX:s.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,s){for(var o=n.length,i=0,l=o-1;l-i>1;){var c=Math.floor((i+l)/2);n[c]>s?l=c:i=c}return s>=n[l]?l:i}}])}(p.PureComponent);pd(O0,"displayName","Brush");pd(O0,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var sqe=_M;function oqe(e,t){var r;return sqe(e,function(n,s,o){return r=t(n,s,o),!r}),!!r}var iqe=oqe,lqe=BJ,cqe=nm,dqe=iqe,uqe=ed,fqe=F5;function mqe(e,t,r){var n=uqe(e)?lqe:dqe;return r&&fqe(e,t,r)&&(t=void 0),n(e,cqe(t))}var hqe=mqe;const pqe=Ls(hqe);var Kf=function(t,r){var n=t.alwaysShow,s=t.ifOverflow;return n&&(s="extendDomain"),s===r},X7=lQ;function gqe(e,t,r){t=="__proto__"&&X7?X7(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var xqe=gqe,vqe=xqe,yqe=oQ,bqe=nm;function wqe(e,t){var r={};return t=bqe(t),yqe(e,function(n,s,o){vqe(r,s,t(n,s,o))}),r}var jqe=wqe;const _qe=Ls(jqe);function Nqe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var Sqe=Nqe,Cqe=_M;function Pqe(e,t){var r=!0;return Cqe(e,function(n,s,o){return r=!!t(n,s,o),r}),r}var Aqe=Pqe,Eqe=Sqe,kqe=Aqe,Iqe=nm,Oqe=ed,Tqe=F5;function Dqe(e,t,r){var n=Oqe(e)?Eqe:kqe;return r&&Tqe(e,t,r)&&(t=void 0),n(e,Iqe(t))}var Mqe=Dqe;const ZZ=Ls(Mqe);var Rqe=["x","y"];function b1(e){"@babel/helpers - typeof";return b1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b1(e)}function TT(){return TT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TT.apply(this,arguments)}function Y7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ab(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Y7(Object(r),!0).forEach(function(n){Fqe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fqe(e,t,r){return t=Lqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lqe(e){var t=$qe(e,"string");return b1(t)=="symbol"?t:t+""}function $qe(e,t){if(b1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(b1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Bqe(e,t){if(e==null)return{};var r=qqe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function qqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function zqe(e,t){var r=e.x,n=e.y,s=Bqe(e,Rqe),o="".concat(r),i=parseInt(o,10),l="".concat(n),c=parseInt(l,10),d="".concat(t.height||s.height),u=parseInt(d,10),f="".concat(t.width||s.width),h=parseInt(f,10);return ab(ab(ab(ab(ab({},t),s),i?{x:i}:{}),c?{y:c}:{}),{},{height:u,width:h,name:t.name,radius:t.radius})}function J7(e){return Ce.createElement(HZ,TT({shapeType:"rectangle",propTransformer:zqe,activeClassName:"recharts-active-bar"},e))}var Uqe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,s){if(typeof t=="number")return t;var o=Rn(n)||ySe(n);return o?t(n,s):(o||bp(!1),r)}},Vqe=["value","background"],eee;function T0(e){"@babel/helpers - typeof";return T0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T0(e)}function Wqe(e,t){if(e==null)return{};var r=Hqe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Hqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function TS(){return TS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TS.apply(this,arguments)}function Q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ai(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q7(Object(r),!0).forEach(function(n){Lh(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gqe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ree(n.key),n)}}function Kqe(e,t,r){return t&&Z7(e.prototype,t),r&&Z7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Xqe(e,t,r){return t=DS(t),Yqe(e,tee()?Reflect.construct(t,r||[],DS(e).constructor):t.apply(e,r))}function Yqe(e,t){if(t&&(T0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jqe(e)}function Jqe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tee=function(){return!!e})()}function DS(e){return DS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},DS(e)}function Qqe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DT(e,t)}function DT(e,t){return DT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},DT(e,t)}function Lh(e,t,r){return t=ree(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ree(e){var t=Zqe(e,"string");return T0(t)=="symbol"?t:t+""}function Zqe(e,t){if(T0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(T0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Sx=function(e){function t(){var r;Gqe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=Xqe(this,t,[].concat(s)),Lh(r,"state",{isAnimationFinished:!1}),Lh(r,"id",wx("recharts-bar-")),Lh(r,"handleAnimationEnd",function(){var i=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),i&&i()}),Lh(r,"handleAnimationStart",function(){var i=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),i&&i()}),r}return Qqe(t,e),Kqe(t,[{key:"renderRectanglesStatically",value:function(n){var s=this,o=this.props,i=o.shape,l=o.dataKey,c=o.activeIndex,d=o.activeBar,u=ka(this.props,!1);return n&&n.map(function(f,h){var m=h===c,x=m?d:i,g=Ai(Ai(Ai({},u),f),{},{isActive:m,option:x,index:h,dataKey:l,onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd});return Ce.createElement(Cs,TS({className:"recharts-bar-rectangle"},rx(s.props,f,h),{key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(h)}),Ce.createElement(J7,g))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,s=this.props,o=s.data,i=s.layout,l=s.isAnimationActive,c=s.animationBegin,d=s.animationDuration,u=s.animationEasing,f=s.animationId,h=this.state.prevData;return Ce.createElement(wp,{begin:c,duration:d,isActive:l,easing:u,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(m){var x=m.t,g=o.map(function(v,y){var b=h&&h[y];if(b){var w=Wi(b.x,v.x),j=Wi(b.y,v.y),_=Wi(b.width,v.width),C=Wi(b.height,v.height);return Ai(Ai({},v),{},{x:w(x),y:j(x),width:_(x),height:C(x)})}if(i==="horizontal"){var A=Wi(0,v.height),S=A(x);return Ai(Ai({},v),{},{y:v.y+v.height-S,height:S})}var P=Wi(0,v.width),M=P(x);return Ai(Ai({},v),{},{width:M})});return Ce.createElement(Cs,null,n.renderRectanglesStatically(g))})}},{key:"renderRectangles",value:function(){var n=this.props,s=n.data,o=n.isAnimationActive,i=this.state.prevData;return o&&s&&s.length&&(!i||!ax(i,s))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(s)}},{key:"renderBackground",value:function(){var n=this,s=this.props,o=s.data,i=s.dataKey,l=s.activeIndex,c=ka(this.props.background,!1);return o.map(function(d,u){d.value;var f=d.background,h=Wqe(d,Vqe);if(!f)return null;var m=Ai(Ai(Ai(Ai(Ai({},h),{},{fill:"#eee"},f),c),rx(n.props,d,u)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:i,index:u,className:"recharts-bar-background-rectangle"});return Ce.createElement(J7,TS({key:"background-bar-".concat(u),option:n.props.background,isActive:u===l},m))})}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.data,l=o.xAxis,c=o.yAxis,d=o.layout,u=o.children,f=Td(u,fj);if(!f)return null;var h=d==="vertical"?i[0].height/2:i[0].width/2,m=function(v,y){var b=Array.isArray(v.value)?v.value[1]:v.value;return{x:v.x,y:v.y,value:b,errorVal:bi(v,y)}},x={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ce.createElement(Cs,x,f.map(function(g){return Ce.cloneElement(g,{key:"error-bar-".concat(s,"-").concat(g.props.dataKey),data:i,xAxis:l,yAxis:c,layout:d,offset:h,dataPointFormatter:m})}))}},{key:"render",value:function(){var n=this.props,s=n.hide,o=n.data,i=n.className,l=n.xAxis,c=n.yAxis,d=n.left,u=n.top,f=n.width,h=n.height,m=n.isAnimationActive,x=n.background,g=n.id;if(s||!o||!o.length)return null;var v=this.state.isAnimationFinished,y=ls("recharts-bar",i),b=l&&l.allowDataOverflow,w=c&&c.allowDataOverflow,j=b||w,_=ss(g)?this.id:g;return Ce.createElement(Cs,{className:y},b||w?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(_)},Ce.createElement("rect",{x:b?d:d-f/2,y:w?u:u-h/2,width:b?f:f*2,height:w?h:h*2}))):null,Ce.createElement(Cs,{className:"recharts-bar-rectangles",clipPath:j?"url(#clipPath-".concat(_,")"):null},x?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(j,_),(!m||v)&&Gf.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:s.curData}:n.data!==s.curData?{curData:n.data}:null}}])}(p.PureComponent);eee=Sx;Lh(Sx,"displayName","Bar");Lh(Sx,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!sf.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Lh(Sx,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,s=e.bandSize,o=e.xAxis,i=e.yAxis,l=e.xAxisTicks,c=e.yAxisTicks,d=e.stackedData,u=e.dataStartIndex,f=e.displayedData,h=e.offset,m=DFe(n,r);if(!m)return null;var x=t.layout,g=r.type.defaultProps,v=g!==void 0?Ai(Ai({},g),r.props):r.props,y=v.dataKey,b=v.children,w=v.minPointSize,j=x==="horizontal"?i:o,_=d?j.scale.domain():null,C=qFe({numericAxis:j}),A=Td(b,Kw),S=f.map(function(P,M){var O,I,T,k,$,q;d?O=MFe(d[u+M],_):(O=bi(P,y),Array.isArray(O)||(O=[C,O]));var z=Uqe(w,eee.defaultProps.minPointSize)(O[1],M);if(x==="horizontal"){var F,V=[i.scale(O[0]),i.scale(O[1])],ue=V[0],_e=V[1];I=qq({axis:o,ticks:l,bandSize:s,offset:m.offset,entry:P,index:M}),T=(F=_e??ue)!==null&&F!==void 0?F:void 0,k=m.size;var U=ue-_e;if($=Number.isNaN(U)?0:U,q={x:I,y:i.y,width:k,height:i.height},Math.abs(z)>0&&Math.abs($)<Math.abs(z)){var L=yc($||z)*(Math.abs(z)-Math.abs($));T-=L,$+=L}}else{var G=[o.scale(O[0]),o.scale(O[1])],de=G[0],X=G[1];if(I=de,T=qq({axis:i,ticks:c,bandSize:s,offset:m.offset,entry:P,index:M}),k=X-de,$=m.size,q={x:o.x,y:T,width:o.width,height:$},Math.abs(z)>0&&Math.abs(k)<Math.abs(z)){var W=yc(k||z)*(Math.abs(z)-Math.abs(k));k+=W}}return Ai(Ai(Ai({},P),{},{x:I,y:T,width:k,height:$,value:d?O:O[1],payload:P,background:q},A&&A[M]&&A[M].props),{},{tooltipPayload:[NZ(r,P)],tooltipPosition:{x:I+k/2,y:T+$/2}})});return Ai({data:S,layout:x},h)});function w1(e){"@babel/helpers - typeof";return w1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w1(e)}function e7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ez(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nee(n.key),n)}}function t7e(e,t,r){return t&&ez(e.prototype,t),r&&ez(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Hu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tz(Object(r),!0).forEach(function(n){tP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tP(e,t,r){return t=nee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nee(e){var t=r7e(e,"string");return w1(t)=="symbol"?t:t+""}function r7e(e,t){if(w1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(w1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ZM=function(t,r,n,s,o){var i=t.width,l=t.height,c=t.layout,d=t.children,u=Object.keys(r),f={left:n.left,leftMirror:n.left,right:i-n.right,rightMirror:i-n.right,top:n.top,topMirror:n.top,bottom:l-n.bottom,bottomMirror:l-n.bottom},h=!!yd(d,Sx);return u.reduce(function(m,x){var g=r[x],v=g.orientation,y=g.domain,b=g.padding,w=b===void 0?{}:b,j=g.mirror,_=g.reversed,C="".concat(v).concat(j?"Mirror":""),A,S,P,M,O;if(g.type==="number"&&(g.padding==="gap"||g.padding==="no-gap")){var I=y[1]-y[0],T=1/0,k=g.categoricalDomain.sort(jSe);if(k.forEach(function(G,de){de>0&&(T=Math.min((G||0)-(k[de-1]||0),T))}),Number.isFinite(T)){var $=T/I,q=g.layout==="vertical"?n.height:n.width;if(g.padding==="gap"&&(A=$*q/2),g.padding==="no-gap"){var z=bc(t.barCategoryGap,$*q),F=$*q/2;A=F-z-(F-z)/q*z}}}s==="xAxis"?S=[n.left+(w.left||0)+(A||0),n.left+n.width-(w.right||0)-(A||0)]:s==="yAxis"?S=c==="horizontal"?[n.top+n.height-(w.bottom||0),n.top+(w.top||0)]:[n.top+(w.top||0)+(A||0),n.top+n.height-(w.bottom||0)-(A||0)]:S=g.range,_&&(S=[S[1],S[0]]);var V=bZ(g,o,h),ue=V.scale,_e=V.realScaleType;ue.domain(y).range(S),wZ(ue);var U=jZ(ue,Hu(Hu({},g),{},{realScaleType:_e}));s==="xAxis"?(O=v==="top"&&!j||v==="bottom"&&j,P=n.left,M=f[C]-O*g.height):s==="yAxis"&&(O=v==="left"&&!j||v==="right"&&j,P=f[C]-O*g.width,M=n.top);var L=Hu(Hu(Hu({},g),U),{},{realScaleType:_e,x:P,y:M,scale:ue,width:s==="xAxis"?n.width:g.width,height:s==="yAxis"?n.height:g.height});return L.bandSize=xS(L,U),!g.hide&&s==="xAxis"?f[C]+=(O?-1:1)*L.height:g.hide||(f[C]+=(O?-1:1)*L.width),Hu(Hu({},m),{},tP({},x,L))},{})},aee=function(t,r){var n=t.x,s=t.y,o=r.x,i=r.y;return{x:Math.min(n,o),y:Math.min(s,i),width:Math.abs(o-n),height:Math.abs(i-s)}},n7e=function(t){var r=t.x1,n=t.y1,s=t.x2,o=t.y2;return aee({x:r,y:n},{x:s,y:o})},see=function(){function e(t){e7e(this,e),this.scale=t}return t7e(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+i}case"end":{var l=this.bandwidth?this.bandwidth():0;return this.scale(r)+l}default:return this.scale(r)}if(s){var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+c}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),s=n[0],o=n[n.length-1];return s<=o?r>=s&&r<=o:r>=o&&r<=s}}],[{key:"create",value:function(r){return new e(r)}}])}();tP(see,"EPS",1e-4);var eR=function(t){var r=Object.keys(t).reduce(function(n,s){return Hu(Hu({},n),{},tP({},s,see.create(t[s])))},{});return Hu(Hu({},r),{},{apply:function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=o.bandAware,l=o.position;return _qe(s,function(c,d){return r[d].apply(c,{bandAware:i,position:l})})},isInRange:function(s){return ZZ(s,function(o,i){return r[i].isInRange(o)})}})};function a7e(e){return(e%180+180)%180}var s7e=function(t){var r=t.width,n=t.height,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=a7e(s),i=o*Math.PI/180,l=Math.atan(n/r),c=i>l&&i<Math.PI-l?n/Math.sin(i):r/Math.cos(i);return Math.abs(c)},o7e=nm,i7e=ij,l7e=M5;function c7e(e){return function(t,r,n){var s=Object(t);if(!i7e(t)){var o=o7e(r);t=l7e(t),r=function(l){return o(s[l],l,s)}}var i=e(t,r,n);return i>-1?s[o?t[i]:i]:void 0}}var d7e=c7e,u7e=XZ;function f7e(e){var t=u7e(e),r=t%1;return t===t?r?t-r:t:0}var m7e=f7e,h7e=eQ,p7e=nm,g7e=m7e,x7e=Math.max;function v7e(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var s=r==null?0:g7e(r);return s<0&&(s=x7e(n+s,0)),h7e(e,p7e(t),s)}var y7e=v7e,b7e=d7e,w7e=y7e,j7e=b7e(w7e),_7e=j7e;const N7e=Ls(_7e);var S7e=_Ne(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),tR=p.createContext(void 0),rR=p.createContext(void 0),oee=p.createContext(void 0),iee=p.createContext({}),lee=p.createContext(void 0),cee=p.createContext(0),dee=p.createContext(0),rz=function(t){var r=t.state,n=r.xAxisMap,s=r.yAxisMap,o=r.offset,i=t.clipPathId,l=t.children,c=t.width,d=t.height,u=S7e(o);return Ce.createElement(tR.Provider,{value:n},Ce.createElement(rR.Provider,{value:s},Ce.createElement(iee.Provider,{value:o},Ce.createElement(oee.Provider,{value:u},Ce.createElement(lee.Provider,{value:i},Ce.createElement(cee.Provider,{value:d},Ce.createElement(dee.Provider,{value:c},l)))))))},C7e=function(){return p.useContext(lee)},uee=function(t){var r=p.useContext(tR);r==null&&bp(!1);var n=r[t];return n==null&&bp(!1),n},P7e=function(){var t=p.useContext(tR);return Eh(t)},A7e=function(){var t=p.useContext(rR),r=N7e(t,function(n){return ZZ(n.domain,Number.isFinite)});return r||Eh(t)},fee=function(t){var r=p.useContext(rR);r==null&&bp(!1);var n=r[t];return n==null&&bp(!1),n},E7e=function(){var t=p.useContext(oee);return t},k7e=function(){return p.useContext(iee)},nR=function(){return p.useContext(dee)},aR=function(){return p.useContext(cee)};function D0(e){"@babel/helpers - typeof";return D0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D0(e)}function I7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hee(n.key),n)}}function O7e(e,t,r){return t&&nz(e.prototype,t),r&&nz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function T7e(e,t,r){return t=MS(t),D7e(e,mee()?Reflect.construct(t,r||[],MS(e).constructor):t.apply(e,r))}function D7e(e,t){if(t&&(D0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return M7e(e)}function M7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mee=function(){return!!e})()}function MS(e){return MS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},MS(e)}function R7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MT(e,t)}function MT(e,t){return MT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},MT(e,t)}function az(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function sz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?az(Object(r),!0).forEach(function(n){sR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):az(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sR(e,t,r){return t=hee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hee(e){var t=F7e(e,"string");return D0(t)=="symbol"?t:t+""}function F7e(e,t){if(D0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(D0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function L7e(e,t){return z7e(e)||q7e(e,t)||B7e(e,t)||$7e()}function $7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B7e(e,t){if(e){if(typeof e=="string")return oz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oz(e,t)}}function oz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function q7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function z7e(e){if(Array.isArray(e))return e}function RT(){return RT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},RT.apply(this,arguments)}var U7e=function(t,r){var n;return Ce.isValidElement(t)?n=Ce.cloneElement(t,r):Ka(t)?n=t(r):n=Ce.createElement("line",RT({},r,{className:"recharts-reference-line-line"})),n},V7e=function(t,r,n,s,o,i,l,c,d){var u=o.x,f=o.y,h=o.width,m=o.height;if(n){var x=d.y,g=t.y.apply(x,{position:i});if(Kf(d,"discard")&&!t.y.isInRange(g))return null;var v=[{x:u+h,y:g},{x:u,y:g}];return c==="left"?v.reverse():v}if(r){var y=d.x,b=t.x.apply(y,{position:i});if(Kf(d,"discard")&&!t.x.isInRange(b))return null;var w=[{x:b,y:f+m},{x:b,y:f}];return l==="top"?w.reverse():w}if(s){var j=d.segment,_=j.map(function(C){return t.apply(C,{position:i})});return Kf(d,"discard")&&pqe(_,function(C){return!t.isInRange(C)})?null:_}return null};function W7e(e){var t=e.x,r=e.y,n=e.segment,s=e.xAxisId,o=e.yAxisId,i=e.shape,l=e.className,c=e.alwaysShow,d=C7e(),u=uee(s),f=fee(o),h=E7e();if(!d||!h)return null;af(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var m=eR({x:u.scale,y:f.scale}),x=Gi(t),g=Gi(r),v=n&&n.length===2,y=V7e(m,x,g,v,h,e.position,u.orientation,f.orientation,e);if(!y)return null;var b=L7e(y,2),w=b[0],j=w.x,_=w.y,C=b[1],A=C.x,S=C.y,P=Kf(e,"hidden")?"url(#".concat(d,")"):void 0,M=sz(sz({clipPath:P},ka(e,!0)),{},{x1:j,y1:_,x2:A,y2:S});return Ce.createElement(Cs,{className:ls("recharts-reference-line",l)},U7e(i,M),il.renderCallByParent(e,n7e({x1:j,y1:_,x2:A,y2:S})))}var oR=function(e){function t(){return I7e(this,t),T7e(this,t,arguments)}return R7e(t,e),O7e(t,[{key:"render",value:function(){return Ce.createElement(W7e,this.props)}}])}(Ce.Component);sR(oR,"displayName","ReferenceLine");sR(oR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function FT(){return FT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},FT.apply(this,arguments)}function M0(e){"@babel/helpers - typeof";return M0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M0(e)}function iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function lz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iz(Object(r),!0).forEach(function(n){rP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function H7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gee(n.key),n)}}function G7e(e,t,r){return t&&cz(e.prototype,t),r&&cz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function K7e(e,t,r){return t=RS(t),X7e(e,pee()?Reflect.construct(t,r||[],RS(e).constructor):t.apply(e,r))}function X7e(e,t){if(t&&(M0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Y7e(e)}function Y7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pee=function(){return!!e})()}function RS(e){return RS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},RS(e)}function J7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LT(e,t)}function LT(e,t){return LT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},LT(e,t)}function rP(e,t,r){return t=gee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gee(e){var t=Q7e(e,"string");return M0(t)=="symbol"?t:t+""}function Q7e(e,t){if(M0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(M0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Z7e=function(t){var r=t.x,n=t.y,s=t.xAxis,o=t.yAxis,i=eR({x:s.scale,y:o.scale}),l=i.apply({x:r,y:n},{bandAware:!0});return Kf(t,"discard")&&!i.isInRange(l)?null:l},nP=function(e){function t(){return H7e(this,t),K7e(this,t,arguments)}return J7e(t,e),G7e(t,[{key:"render",value:function(){var n=this.props,s=n.x,o=n.y,i=n.r,l=n.alwaysShow,c=n.clipPathId,d=Gi(s),u=Gi(o);if(af(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!d||!u)return null;var f=Z7e(this.props);if(!f)return null;var h=f.x,m=f.y,x=this.props,g=x.shape,v=x.className,y=Kf(this.props,"hidden")?"url(#".concat(c,")"):void 0,b=lz(lz({clipPath:y},ka(this.props,!0)),{},{cx:h,cy:m});return Ce.createElement(Cs,{className:ls("recharts-reference-dot",v)},t.renderDot(g,b),il.renderCallByParent(this.props,{x:h-i,y:m-i,width:2*i,height:2*i}))}}])}(Ce.Component);rP(nP,"displayName","ReferenceDot");rP(nP,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});rP(nP,"renderDot",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Ka(e)?r=e(t):r=Ce.createElement(mj,FT({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function $T(){return $T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$T.apply(this,arguments)}function R0(e){"@babel/helpers - typeof";return R0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R0(e)}function dz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function uz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dz(Object(r),!0).forEach(function(n){aP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vee(n.key),n)}}function tze(e,t,r){return t&&fz(e.prototype,t),r&&fz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function rze(e,t,r){return t=FS(t),nze(e,xee()?Reflect.construct(t,r||[],FS(e).constructor):t.apply(e,r))}function nze(e,t){if(t&&(R0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aze(e)}function aze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xee=function(){return!!e})()}function FS(e){return FS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},FS(e)}function sze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BT(e,t)}function BT(e,t){return BT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},BT(e,t)}function aP(e,t,r){return t=vee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vee(e){var t=oze(e,"string");return R0(t)=="symbol"?t:t+""}function oze(e,t){if(R0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(R0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ize=function(t,r,n,s,o){var i=o.x1,l=o.x2,c=o.y1,d=o.y2,u=o.xAxis,f=o.yAxis;if(!u||!f)return null;var h=eR({x:u.scale,y:f.scale}),m={x:t?h.x.apply(i,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(c,{position:"start"}):h.y.rangeMin},x={x:r?h.x.apply(l,{position:"end"}):h.x.rangeMax,y:s?h.y.apply(d,{position:"end"}):h.y.rangeMax};return Kf(o,"discard")&&(!h.isInRange(m)||!h.isInRange(x))?null:aee(m,x)},sP=function(e){function t(){return eze(this,t),rze(this,t,arguments)}return sze(t,e),tze(t,[{key:"render",value:function(){var n=this.props,s=n.x1,o=n.x2,i=n.y1,l=n.y2,c=n.className,d=n.alwaysShow,u=n.clipPathId;af(d===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Gi(s),h=Gi(o),m=Gi(i),x=Gi(l),g=this.props.shape;if(!f&&!h&&!m&&!x&&!g)return null;var v=ize(f,h,m,x,this.props);if(!v&&!g)return null;var y=Kf(this.props,"hidden")?"url(#".concat(u,")"):void 0;return Ce.createElement(Cs,{className:ls("recharts-reference-area",c)},t.renderRect(g,uz(uz({clipPath:y},ka(this.props,!0)),v)),il.renderCallByParent(this.props,v))}}])}(Ce.Component);aP(sP,"displayName","ReferenceArea");aP(sP,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});aP(sP,"renderRect",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Ka(e)?r=e(t):r=Ce.createElement(QM,$T({},t,{className:"recharts-reference-area-rect"})),r});function yee(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],s=0;s<e.length;s+=t)if(r===void 0||r(e[s])===!0)n.push(e[s]);else return;return n}function lze(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return s7e(n,r)}function cze(e,t,r){var n=r==="width",s=e.x,o=e.y,i=e.width,l=e.height;return t===1?{start:n?s:o,end:n?s+i:o+l}:{start:n?s+i:o+l,end:n?s:o}}function LS(e,t,r,n,s){if(e*t<e*n||e*t>e*s)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-s)<=0}function dze(e,t){return yee(e,t+1)}function uze(e,t,r,n,s){for(var o=(n||[]).slice(),i=t.start,l=t.end,c=0,d=1,u=i,f=function(){var x=n?.[c];if(x===void 0)return{v:yee(n,d)};var g=c,v,y=function(){return v===void 0&&(v=r(x,g)),v},b=x.coordinate,w=c===0||LS(e,b,y,u,l);w||(c=0,u=i,d+=1),w&&(u=b+e*(y()/2+s),c+=d)},h;d<=o.length;)if(h=f(),h)return h.v;return[]}function j1(e){"@babel/helpers - typeof";return j1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j1(e)}function mz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Gl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mz(Object(r),!0).forEach(function(n){fze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fze(e,t,r){return t=mze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mze(e){var t=hze(e,"string");return j1(t)=="symbol"?t:t+""}function hze(e,t){if(j1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(j1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pze(e,t,r,n,s){for(var o=(n||[]).slice(),i=o.length,l=t.start,c=t.end,d=function(h){var m=o[h],x,g=function(){return x===void 0&&(x=r(m,h)),x};if(h===i-1){var v=e*(m.coordinate+e*g()/2-c);o[h]=m=Gl(Gl({},m),{},{tickCoord:v>0?m.coordinate-v*e:m.coordinate})}else o[h]=m=Gl(Gl({},m),{},{tickCoord:m.coordinate});var y=LS(e,m.tickCoord,g,l,c);y&&(c=m.tickCoord-e*(g()/2+s),o[h]=Gl(Gl({},m),{},{isShow:!0}))},u=i-1;u>=0;u--)d(u);return o}function gze(e,t,r,n,s,o){var i=(n||[]).slice(),l=i.length,c=t.start,d=t.end;if(o){var u=n[l-1],f=r(u,l-1),h=e*(u.coordinate+e*f/2-d);i[l-1]=u=Gl(Gl({},u),{},{tickCoord:h>0?u.coordinate-h*e:u.coordinate});var m=LS(e,u.tickCoord,function(){return f},c,d);m&&(d=u.tickCoord-e*(f/2+s),i[l-1]=Gl(Gl({},u),{},{isShow:!0}))}for(var x=o?l-1:l,g=function(b){var w=i[b],j,_=function(){return j===void 0&&(j=r(w,b)),j};if(b===0){var C=e*(w.coordinate-e*_()/2-c);i[b]=w=Gl(Gl({},w),{},{tickCoord:C<0?w.coordinate-C*e:w.coordinate})}else i[b]=w=Gl(Gl({},w),{},{tickCoord:w.coordinate});var A=LS(e,w.tickCoord,_,c,d);A&&(c=w.tickCoord+e*(_()/2+s),i[b]=Gl(Gl({},w),{},{isShow:!0}))},v=0;v<x;v++)g(v);return i}function iR(e,t,r){var n=e.tick,s=e.ticks,o=e.viewBox,i=e.minTickGap,l=e.orientation,c=e.interval,d=e.tickFormatter,u=e.unit,f=e.angle;if(!s||!s.length||!n)return[];if(Rn(c)||sf.isSsr)return dze(s,typeof c=="number"&&Rn(c)?c:0);var h=[],m=l==="top"||l==="bottom"?"width":"height",x=u&&m==="width"?Gb(u,{fontSize:t,letterSpacing:r}):{width:0,height:0},g=function(w,j){var _=Ka(d)?d(w.value,j):w.value;return m==="width"?lze(Gb(_,{fontSize:t,letterSpacing:r}),x,f):Gb(_,{fontSize:t,letterSpacing:r})[m]},v=s.length>=2?yc(s[1].coordinate-s[0].coordinate):1,y=cze(o,v,m);return c==="equidistantPreserveStart"?uze(v,y,g,s,i):(c==="preserveStart"||c==="preserveStartEnd"?h=gze(v,y,g,s,i,c==="preserveStartEnd"):h=pze(v,y,g,s,i),h.filter(function(b){return b.isShow}))}var xze=["viewBox"],vze=["viewBox"],yze=["ticks"];function F0(e){"@babel/helpers - typeof";return F0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F0(e)}function Ov(){return Ov=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ov.apply(this,arguments)}function hz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function $i(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hz(Object(r),!0).forEach(function(n){lR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RE(e,t){if(e==null)return{};var r=bze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function bze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function wze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,wee(n.key),n)}}function jze(e,t,r){return t&&pz(e.prototype,t),r&&pz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _ze(e,t,r){return t=$S(t),Nze(e,bee()?Reflect.construct(t,r||[],$S(e).constructor):t.apply(e,r))}function Nze(e,t){if(t&&(F0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Sze(e)}function Sze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bee=function(){return!!e})()}function $S(e){return $S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},$S(e)}function Cze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qT(e,t)}function qT(e,t){return qT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},qT(e,t)}function lR(e,t,r){return t=wee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wee(e){var t=Pze(e,"string");return F0(t)=="symbol"?t:t+""}function Pze(e,t){if(F0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(F0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var jy=function(e){function t(r){var n;return wze(this,t),n=_ze(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return Cze(t,e),jze(t,[{key:"shouldComponentUpdate",value:function(n,s){var o=n.viewBox,i=RE(n,xze),l=this.props,c=l.viewBox,d=RE(l,vze);return!Xv(o,c)||!Xv(i,d)||!Xv(s,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var s=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];s&&this.setState({fontSize:window.getComputedStyle(s).fontSize,letterSpacing:window.getComputedStyle(s).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.x,i=s.y,l=s.width,c=s.height,d=s.orientation,u=s.tickSize,f=s.mirror,h=s.tickMargin,m,x,g,v,y,b,w=f?-1:1,j=n.tickSize||u,_=Rn(n.tickCoord)?n.tickCoord:n.coordinate;switch(d){case"top":m=x=n.coordinate,v=i+ +!f*c,g=v-w*j,b=g-w*h,y=_;break;case"left":g=v=n.coordinate,x=o+ +!f*l,m=x-w*j,y=m-w*h,b=_;break;case"right":g=v=n.coordinate,x=o+ +f*l,m=x+w*j,y=m+w*h,b=_;break;default:m=x=n.coordinate,v=i+ +f*c,g=v+w*j,b=g+w*h,y=_;break}return{line:{x1:m,y1:g,x2:x,y2:v},tick:{x:y,y:b}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,i;switch(s){case"left":i=o?"start":"end";break;case"right":i=o?"end":"start";break;default:i="middle";break}return i}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,i="end";switch(s){case"left":case"right":i="middle";break;case"top":i=o?"start":"end";break;default:i=o?"end":"start";break}return i}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.orientation,d=n.mirror,u=n.axisLine,f=$i($i($i({},ka(this.props,!1)),ka(u,!1)),{},{fill:"none"});if(c==="top"||c==="bottom"){var h=+(c==="top"&&!d||c==="bottom"&&d);f=$i($i({},f),{},{x1:s,y1:o+h*l,x2:s+i,y2:o+h*l})}else{var m=+(c==="left"&&!d||c==="right"&&d);f=$i($i({},f),{},{x1:s+m*i,y1:o,x2:s+m*i,y2:o+l})}return Ce.createElement("line",Ov({},f,{className:ls("recharts-cartesian-axis-line",Od(u,"className"))}))}},{key:"renderTicks",value:function(n,s,o){var i=this,l=this.props,c=l.tickLine,d=l.stroke,u=l.tick,f=l.tickFormatter,h=l.unit,m=iR($i($i({},this.props),{},{ticks:n}),s,o),x=this.getTickTextAnchor(),g=this.getTickVerticalAnchor(),v=ka(this.props,!1),y=ka(u,!1),b=$i($i({},v),{},{fill:"none"},ka(c,!1)),w=m.map(function(j,_){var C=i.getTickLineCoord(j),A=C.line,S=C.tick,P=$i($i($i($i({textAnchor:x,verticalAnchor:g},v),{},{stroke:"none",fill:d},y),S),{},{index:_,payload:j,visibleTicksCount:m.length,tickFormatter:f});return Ce.createElement(Cs,Ov({className:"recharts-cartesian-axis-tick",key:"tick-".concat(j.value,"-").concat(j.coordinate,"-").concat(j.tickCoord)},rx(i.props,j,_)),c&&Ce.createElement("line",Ov({},b,A,{className:ls("recharts-cartesian-axis-tick-line",Od(c,"className"))})),u&&t.renderTickItem(u,P,"".concat(Ka(f)?f(j.value,_):j.value).concat(h||"")))});return Ce.createElement("g",{className:"recharts-cartesian-axis-ticks"},w)}},{key:"render",value:function(){var n=this,s=this.props,o=s.axisLine,i=s.width,l=s.height,c=s.ticksGenerator,d=s.className,u=s.hide;if(u)return null;var f=this.props,h=f.ticks,m=RE(f,yze),x=h;return Ka(c)&&(x=h&&h.length>0?c(this.props):c(m)),i<=0||l<=0||!x||!x.length?null:Ce.createElement(Cs,{className:ls("recharts-cartesian-axis",d),ref:function(v){n.layerReference=v}},o&&this.renderAxisLine(),this.renderTicks(x,this.state.fontSize,this.state.letterSpacing),il.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,s,o){var i,l=ls(s.className,"recharts-cartesian-axis-tick-value");return Ce.isValidElement(n)?i=Ce.cloneElement(n,$i($i({},s),{},{className:l})):Ka(n)?i=n($i($i({},s),{},{className:l})):i=Ce.createElement(nx,Ov({},s,{className:"recharts-cartesian-axis-tick-value"}),o),i}}])}(p.Component);lR(jy,"displayName","CartesianAxis");lR(jy,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Aze=["x1","y1","x2","y2","key"],Eze=["offset"];function ox(e){"@babel/helpers - typeof";return ox=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ox(e)}function gz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Yl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gz(Object(r),!0).forEach(function(n){kze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kze(e,t,r){return t=Ize(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ize(e){var t=Oze(e,"string");return ox(t)=="symbol"?t:t+""}function Oze(e,t){if(ox(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ox(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _g(){return _g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_g.apply(this,arguments)}function xz(e,t){if(e==null)return{};var r=Tze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Tze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Dze=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,s=t.x,o=t.y,i=t.width,l=t.height,c=t.ry;return Ce.createElement("rect",{x:s,y:o,ry:c,width:i,height:l,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function jee(e,t){var r;if(Ce.isValidElement(e))r=Ce.cloneElement(e,t);else if(Ka(e))r=e(t);else{var n=t.x1,s=t.y1,o=t.x2,i=t.y2,l=t.key,c=xz(t,Aze),d=ka(c,!1);d.offset;var u=xz(d,Eze);r=Ce.createElement("line",_g({},u,{x1:n,y1:s,x2:o,y2:i,fill:"none",key:l}))}return r}function Mze(e){var t=e.x,r=e.width,n=e.horizontal,s=n===void 0?!0:n,o=e.horizontalPoints;if(!s||!o||!o.length)return null;var i=o.map(function(l,c){var d=Yl(Yl({},e),{},{x1:t,y1:l,x2:t+r,y2:l,key:"line-".concat(c),index:c});return jee(s,d)});return Ce.createElement("g",{className:"recharts-cartesian-grid-horizontal"},i)}function Rze(e){var t=e.y,r=e.height,n=e.vertical,s=n===void 0?!0:n,o=e.verticalPoints;if(!s||!o||!o.length)return null;var i=o.map(function(l,c){var d=Yl(Yl({},e),{},{x1:l,y1:t,x2:l,y2:t+r,key:"line-".concat(c),index:c});return jee(s,d)});return Ce.createElement("g",{className:"recharts-cartesian-grid-vertical"},i)}function Fze(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,s=e.y,o=e.width,i=e.height,l=e.horizontalPoints,c=e.horizontal,d=c===void 0?!0:c;if(!d||!t||!t.length)return null;var u=l.map(function(h){return Math.round(h+s-s)}).sort(function(h,m){return h-m});s!==u[0]&&u.unshift(0);var f=u.map(function(h,m){var x=!u[m+1],g=x?s+i-h:u[m+1]-h;if(g<=0)return null;var v=m%t.length;return Ce.createElement("rect",{key:"react-".concat(m),y:h,x:n,height:g,width:o,stroke:"none",fill:t[v],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function Lze(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,s=e.fillOpacity,o=e.x,i=e.y,l=e.width,c=e.height,d=e.verticalPoints;if(!r||!n||!n.length)return null;var u=d.map(function(h){return Math.round(h+o-o)}).sort(function(h,m){return h-m});o!==u[0]&&u.unshift(0);var f=u.map(function(h,m){var x=!u[m+1],g=x?o+l-h:u[m+1]-h;if(g<=0)return null;var v=m%n.length;return Ce.createElement("rect",{key:"react-".concat(m),x:h,y:i,width:g,height:c,stroke:"none",fill:n[v],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var $ze=function(t,r){var n=t.xAxis,s=t.width,o=t.height,i=t.offset;return yZ(iR(Yl(Yl(Yl({},jy.defaultProps),n),{},{ticks:Pm(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),i.left,i.left+i.width,r)},Bze=function(t,r){var n=t.yAxis,s=t.width,o=t.height,i=t.offset;return yZ(iR(Yl(Yl(Yl({},jy.defaultProps),n),{},{ticks:Pm(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),i.top,i.top+i.height,r)},Wx={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function BS(e){var t,r,n,s,o,i,l=nR(),c=aR(),d=k7e(),u=Yl(Yl({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Wx.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:Wx.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:Wx.horizontal,horizontalFill:(s=e.horizontalFill)!==null&&s!==void 0?s:Wx.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:Wx.vertical,verticalFill:(i=e.verticalFill)!==null&&i!==void 0?i:Wx.verticalFill,x:Rn(e.x)?e.x:d.left,y:Rn(e.y)?e.y:d.top,width:Rn(e.width)?e.width:d.width,height:Rn(e.height)?e.height:d.height}),f=u.x,h=u.y,m=u.width,x=u.height,g=u.syncWithTicks,v=u.horizontalValues,y=u.verticalValues,b=P7e(),w=A7e();if(!Rn(m)||m<=0||!Rn(x)||x<=0||!Rn(f)||f!==+f||!Rn(h)||h!==+h)return null;var j=u.verticalCoordinatesGenerator||$ze,_=u.horizontalCoordinatesGenerator||Bze,C=u.horizontalPoints,A=u.verticalPoints;if((!C||!C.length)&&Ka(_)){var S=v&&v.length,P=_({yAxis:w?Yl(Yl({},w),{},{ticks:S?v:w.ticks}):void 0,width:l,height:c,offset:d},S?!0:g);af(Array.isArray(P),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(ox(P),"]")),Array.isArray(P)&&(C=P)}if((!A||!A.length)&&Ka(j)){var M=y&&y.length,O=j({xAxis:b?Yl(Yl({},b),{},{ticks:M?y:b.ticks}):void 0,width:l,height:c,offset:d},M?!0:g);af(Array.isArray(O),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(ox(O),"]")),Array.isArray(O)&&(A=O)}return Ce.createElement("g",{className:"recharts-cartesian-grid"},Ce.createElement(Dze,{fill:u.fill,fillOpacity:u.fillOpacity,x:u.x,y:u.y,width:u.width,height:u.height,ry:u.ry}),Ce.createElement(Mze,_g({},u,{offset:d,horizontalPoints:C,xAxis:b,yAxis:w})),Ce.createElement(Rze,_g({},u,{offset:d,verticalPoints:A,xAxis:b,yAxis:w})),Ce.createElement(Fze,_g({},u,{horizontalPoints:C})),Ce.createElement(Lze,_g({},u,{verticalPoints:A})))}BS.displayName="CartesianGrid";var qze=["type","layout","connectNulls","ref"],zze=["key"];function L0(e){"@babel/helpers - typeof";return L0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L0(e)}function vz(e,t){if(e==null)return{};var r=Uze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Uze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Zb(){return Zb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Zb.apply(this,arguments)}function yz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function md(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yz(Object(r),!0).forEach(function(n){Gu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hx(e){return Gze(e)||Hze(e)||Wze(e)||Vze()}function Vze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wze(e,t){if(e){if(typeof e=="string")return zT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zT(e,t)}}function Hze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Gze(e){if(Array.isArray(e))return zT(e)}function zT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Kze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Nee(n.key),n)}}function Xze(e,t,r){return t&&bz(e.prototype,t),r&&bz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Yze(e,t,r){return t=qS(t),Jze(e,_ee()?Reflect.construct(t,r||[],qS(e).constructor):t.apply(e,r))}function Jze(e,t){if(t&&(L0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qze(e)}function Qze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_ee=function(){return!!e})()}function qS(e){return qS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qS(e)}function Zze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UT(e,t)}function UT(e,t){return UT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},UT(e,t)}function Gu(e,t,r){return t=Nee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nee(e){var t=e9e(e,"string");return L0(t)=="symbol"?t:t+""}function e9e(e,t){if(L0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(L0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _y=function(e){function t(){var r;Kze(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=Yze(this,t,[].concat(s)),Gu(r,"state",{isAnimationFinished:!0,totalLength:0}),Gu(r,"generateSimpleStrokeDasharray",function(i,l){return"".concat(l,"px ").concat(i-l,"px")}),Gu(r,"getStrokeDasharray",function(i,l,c){var d=c.reduce(function(y,b){return y+b});if(!d)return r.generateSimpleStrokeDasharray(l,i);for(var u=Math.floor(i/d),f=i%d,h=l-i,m=[],x=0,g=0;x<c.length;g+=c[x],++x)if(g+c[x]>f){m=[].concat(Hx(c.slice(0,x)),[f-g]);break}var v=m.length%2===0?[0,h]:[h];return[].concat(Hx(t.repeat(c,u)),Hx(m),v).map(function(y){return"".concat(y,"px")}).join(", ")}),Gu(r,"id",wx("recharts-line-")),Gu(r,"pathRef",function(i){r.mainCurve=i}),Gu(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Gu(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Zze(t,e),Xze(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.points,l=o.xAxis,c=o.yAxis,d=o.layout,u=o.children,f=Td(u,fj);if(!f)return null;var h=function(g,v){return{x:g.x,y:g.y,value:g.value,errorVal:bi(g.payload,v)}},m={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ce.createElement(Cs,m,f.map(function(x){return Ce.cloneElement(x,{key:"bar-".concat(x.props.dataKey),data:i,xAxis:l,yAxis:c,layout:d,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,s,o){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.dot,d=l.points,u=l.dataKey,f=ka(this.props,!1),h=ka(c,!0),m=d.map(function(g,v){var y=md(md(md({key:"dot-".concat(v),r:3},f),h),{},{index:v,cx:g.x,cy:g.y,value:g.value,dataKey:u,payload:g.payload,points:d});return t.renderDotItem(c,y)}),x={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ce.createElement(Cs,Zb({className:"recharts-line-dots",key:"dots"},x),m)}},{key:"renderCurveStatically",value:function(n,s,o,i){var l=this.props,c=l.type,d=l.layout,u=l.connectNulls;l.ref;var f=vz(l,qze),h=md(md(md({},ka(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(o,")"):null,points:n},i),{},{type:c,layout:d,connectNulls:u});return Ce.createElement(Lg,Zb({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,s){var o=this,i=this.props,l=i.points,c=i.strokeDasharray,d=i.isAnimationActive,u=i.animationBegin,f=i.animationDuration,h=i.animationEasing,m=i.animationId,x=i.animateNewValues,g=i.width,v=i.height,y=this.state,b=y.prevPoints,w=y.totalLength;return Ce.createElement(wp,{begin:u,duration:f,isActive:d,easing:h,from:{t:0},to:{t:1},key:"line-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(j){var _=j.t;if(b){var C=b.length/l.length,A=l.map(function(I,T){var k=Math.floor(T*C);if(b[k]){var $=b[k],q=Wi($.x,I.x),z=Wi($.y,I.y);return md(md({},I),{},{x:q(_),y:z(_)})}if(x){var F=Wi(g*2,I.x),V=Wi(v/2,I.y);return md(md({},I),{},{x:F(_),y:V(_)})}return md(md({},I),{},{x:I.x,y:I.y})});return o.renderCurveStatically(A,n,s)}var S=Wi(0,w),P=S(_),M;if(c){var O="".concat(c).split(/[,\s]+/gim).map(function(I){return parseFloat(I)});M=o.getStrokeDasharray(P,w,O)}else M=o.generateSimpleStrokeDasharray(w,P);return o.renderCurveStatically(l,n,s,{strokeDasharray:M})})}},{key:"renderCurve",value:function(n,s){var o=this.props,i=o.points,l=o.isAnimationActive,c=this.state,d=c.prevPoints,u=c.totalLength;return l&&i&&i.length&&(!d&&u>0||!ax(d,i))?this.renderCurveWithAnimation(n,s):this.renderCurveStatically(i,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,i=s.dot,l=s.points,c=s.className,d=s.xAxis,u=s.yAxis,f=s.top,h=s.left,m=s.width,x=s.height,g=s.isAnimationActive,v=s.id;if(o||!l||!l.length)return null;var y=this.state.isAnimationFinished,b=l.length===1,w=ls("recharts-line",c),j=d&&d.allowDataOverflow,_=u&&u.allowDataOverflow,C=j||_,A=ss(v)?this.id:v,S=(n=ka(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},P=S.r,M=P===void 0?3:P,O=S.strokeWidth,I=O===void 0?2:O,T=uJ(i)?i:{},k=T.clipDot,$=k===void 0?!0:k,q=M*2+I;return Ce.createElement(Cs,{className:w},j||_?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(A)},Ce.createElement("rect",{x:j?h:h-m/2,y:_?f:f-x/2,width:j?m:m*2,height:_?x:x*2})),!$&&Ce.createElement("clipPath",{id:"clipPath-dots-".concat(A)},Ce.createElement("rect",{x:h-q/2,y:f-q/2,width:m+q,height:x+q}))):null,!b&&this.renderCurve(C,A),this.renderErrorBar(C,A),(b||i)&&this.renderDots(C,$,A),(!g||y)&&Gf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:s.curPoints}:n.points!==s.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,s){for(var o=n.length%2!==0?[].concat(Hx(n),[0]):n,i=[],l=0;l<s;++l)i=[].concat(Hx(i),Hx(o));return i}},{key:"renderDotItem",value:function(n,s){var o;if(Ce.isValidElement(n))o=Ce.cloneElement(n,s);else if(Ka(n))o=n(s);else{var i=s.key,l=vz(s,zze),c=ls("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ce.createElement(mj,Zb({key:i},l,{className:c}))}return o}}])}(p.PureComponent);Gu(_y,"displayName","Line");Gu(_y,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!sf.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Gu(_y,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,s=e.xAxisTicks,o=e.yAxisTicks,i=e.dataKey,l=e.bandSize,c=e.displayedData,d=e.offset,u=t.layout,f=c.map(function(h,m){var x=bi(h,i);return u==="horizontal"?{x:gS({axis:r,ticks:s,bandSize:l,entry:h,index:m}),y:ss(x)?null:n.scale(x),value:x,payload:h}:{x:ss(x)?null:r.scale(x),y:gS({axis:n,ticks:o,bandSize:l,entry:h,index:m}),value:x,payload:h}});return md({points:f,layout:u},d)});var t9e=["layout","type","stroke","connectNulls","isRange","ref"],r9e=["key"],See;function $0(e){"@babel/helpers - typeof";return $0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$0(e)}function Cee(e,t){if(e==null)return{};var r=n9e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function n9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Ng(){return Ng=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ng.apply(this,arguments)}function wz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function yh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wz(Object(r),!0).forEach(function(n){Ff(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function a9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Aee(n.key),n)}}function s9e(e,t,r){return t&&jz(e.prototype,t),r&&jz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o9e(e,t,r){return t=zS(t),i9e(e,Pee()?Reflect.construct(t,r||[],zS(e).constructor):t.apply(e,r))}function i9e(e,t){if(t&&($0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l9e(e)}function l9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Pee=function(){return!!e})()}function zS(e){return zS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zS(e)}function c9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&VT(e,t)}function VT(e,t){return VT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},VT(e,t)}function Ff(e,t,r){return t=Aee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Aee(e){var t=d9e(e,"string");return $0(t)=="symbol"?t:t+""}function d9e(e,t){if($0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Fp=function(e){function t(){var r;a9e(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=o9e(this,t,[].concat(s)),Ff(r,"state",{isAnimationFinished:!0}),Ff(r,"id",wx("recharts-area-")),Ff(r,"handleAnimationEnd",function(){var i=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),Ka(i)&&i()}),Ff(r,"handleAnimationStart",function(){var i=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),Ka(i)&&i()}),r}return c9e(t,e),s9e(t,[{key:"renderDots",value:function(n,s,o){var i=this.props.isAnimationActive,l=this.state.isAnimationFinished;if(i&&!l)return null;var c=this.props,d=c.dot,u=c.points,f=c.dataKey,h=ka(this.props,!1),m=ka(d,!0),x=u.map(function(v,y){var b=yh(yh(yh({key:"dot-".concat(y),r:3},h),m),{},{index:y,cx:v.x,cy:v.y,dataKey:f,value:v.value,payload:v.payload,points:u});return t.renderDotItem(d,b)}),g={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ce.createElement(Cs,Ng({className:"recharts-area-dots"},g),x)}},{key:"renderHorizontalRect",value:function(n){var s=this.props,o=s.baseLine,i=s.points,l=s.strokeWidth,c=i[0].x,d=i[i.length-1].x,u=n*Math.abs(c-d),f=Fh(i.map(function(h){return h.y||0}));return Rn(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(Fh(o.map(function(h){return h.y||0})),f)),Rn(f)?Ce.createElement("rect",{x:c<d?c:c-u,y:0,width:u,height:Math.floor(f+(l?parseInt("".concat(l),10):1))}):null}},{key:"renderVerticalRect",value:function(n){var s=this.props,o=s.baseLine,i=s.points,l=s.strokeWidth,c=i[0].y,d=i[i.length-1].y,u=n*Math.abs(c-d),f=Fh(i.map(function(h){return h.x||0}));return Rn(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(Fh(o.map(function(h){return h.x||0})),f)),Rn(f)?Ce.createElement("rect",{x:0,y:c<d?c:c-u,width:f+(l?parseInt("".concat(l),10):1),height:Math.floor(u)}):null}},{key:"renderClipRect",value:function(n){var s=this.props.layout;return s==="vertical"?this.renderVerticalRect(n):this.renderHorizontalRect(n)}},{key:"renderAreaStatically",value:function(n,s,o,i){var l=this.props,c=l.layout,d=l.type,u=l.stroke,f=l.connectNulls,h=l.isRange;l.ref;var m=Cee(l,t9e);return Ce.createElement(Cs,{clipPath:o?"url(#clipPath-".concat(i,")"):null},Ce.createElement(Lg,Ng({},ka(m,!0),{points:n,connectNulls:f,type:d,baseLine:s,layout:c,stroke:"none",className:"recharts-area-area"})),u!=="none"&&Ce.createElement(Lg,Ng({},ka(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:n})),u!=="none"&&h&&Ce.createElement(Lg,Ng({},ka(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:s})))}},{key:"renderAreaWithAnimation",value:function(n,s){var o=this,i=this.props,l=i.points,c=i.baseLine,d=i.isAnimationActive,u=i.animationBegin,f=i.animationDuration,h=i.animationEasing,m=i.animationId,x=this.state,g=x.prevPoints,v=x.prevBaseLine;return Ce.createElement(wp,{begin:u,duration:f,isActive:d,easing:h,from:{t:0},to:{t:1},key:"area-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(y){var b=y.t;if(g){var w=g.length/l.length,j=l.map(function(S,P){var M=Math.floor(P*w);if(g[M]){var O=g[M],I=Wi(O.x,S.x),T=Wi(O.y,S.y);return yh(yh({},S),{},{x:I(b),y:T(b)})}return S}),_;if(Rn(c)&&typeof c=="number"){var C=Wi(v,c);_=C(b)}else if(ss(c)||py(c)){var A=Wi(v,0);_=A(b)}else _=c.map(function(S,P){var M=Math.floor(P*w);if(v[M]){var O=v[M],I=Wi(O.x,S.x),T=Wi(O.y,S.y);return yh(yh({},S),{},{x:I(b),y:T(b)})}return S});return o.renderAreaStatically(j,_,n,s)}return Ce.createElement(Cs,null,Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"animationClipPath-".concat(s)},o.renderClipRect(b))),Ce.createElement(Cs,{clipPath:"url(#animationClipPath-".concat(s,")")},o.renderAreaStatically(l,c,n,s)))})}},{key:"renderArea",value:function(n,s){var o=this.props,i=o.points,l=o.baseLine,c=o.isAnimationActive,d=this.state,u=d.prevPoints,f=d.prevBaseLine,h=d.totalLength;return c&&i&&i.length&&(!u&&h>0||!ax(u,i)||!ax(f,l))?this.renderAreaWithAnimation(n,s):this.renderAreaStatically(i,l,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,i=s.dot,l=s.points,c=s.className,d=s.top,u=s.left,f=s.xAxis,h=s.yAxis,m=s.width,x=s.height,g=s.isAnimationActive,v=s.id;if(o||!l||!l.length)return null;var y=this.state.isAnimationFinished,b=l.length===1,w=ls("recharts-area",c),j=f&&f.allowDataOverflow,_=h&&h.allowDataOverflow,C=j||_,A=ss(v)?this.id:v,S=(n=ka(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},P=S.r,M=P===void 0?3:P,O=S.strokeWidth,I=O===void 0?2:O,T=uJ(i)?i:{},k=T.clipDot,$=k===void 0?!0:k,q=M*2+I;return Ce.createElement(Cs,{className:w},j||_?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(A)},Ce.createElement("rect",{x:j?u:u-m/2,y:_?d:d-x/2,width:j?m:m*2,height:_?x:x*2})),!$&&Ce.createElement("clipPath",{id:"clipPath-dots-".concat(A)},Ce.createElement("rect",{x:u-q/2,y:d-q/2,width:m+q,height:x+q}))):null,b?null:this.renderArea(C,A),(i||b)&&this.renderDots(C,$,A),(!g||y)&&Gf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,curBaseLine:n.baseLine,prevPoints:s.curPoints,prevBaseLine:s.curBaseLine}:n.points!==s.curPoints||n.baseLine!==s.curBaseLine?{curPoints:n.points,curBaseLine:n.baseLine}:null}}])}(p.PureComponent);See=Fp;Ff(Fp,"displayName","Area");Ff(Fp,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!sf.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Ff(Fp,"getBaseValue",function(e,t,r,n){var s=e.layout,o=e.baseValue,i=t.props.baseValue,l=i??o;if(Rn(l)&&typeof l=="number")return l;var c=s==="horizontal"?n:r,d=c.scale.domain();if(c.type==="number"){var u=Math.max(d[0],d[1]),f=Math.min(d[0],d[1]);return l==="dataMin"?f:l==="dataMax"||u<0?u:Math.max(Math.min(d[0],d[1]),0)}return l==="dataMin"?d[0]:l==="dataMax"?d[1]:d[0]});Ff(Fp,"getComposedData",function(e){var t=e.props,r=e.item,n=e.xAxis,s=e.yAxis,o=e.xAxisTicks,i=e.yAxisTicks,l=e.bandSize,c=e.dataKey,d=e.stackedData,u=e.dataStartIndex,f=e.displayedData,h=e.offset,m=t.layout,x=d&&d.length,g=See.getBaseValue(t,r,n,s),v=m==="horizontal",y=!1,b=f.map(function(j,_){var C;x?C=d[u+_]:(C=bi(j,c),Array.isArray(C)?y=!0:C=[g,C]);var A=C[1]==null||x&&bi(j,c)==null;return v?{x:gS({axis:n,ticks:o,bandSize:l,entry:j,index:_}),y:A?null:s.scale(C[1]),value:C,payload:j}:{x:A?null:n.scale(C[1]),y:gS({axis:s,ticks:i,bandSize:l,entry:j,index:_}),value:C,payload:j}}),w;return x||y?w=b.map(function(j){var _=Array.isArray(j.value)?j.value[0]:null;return v?{x:j.x,y:_!=null&&j.y!=null?s.scale(_):null}:{x:_!=null?n.scale(_):null,y:j.y}}):w=v?s.scale(g):n.scale(g),yh({points:b,baseLine:w,layout:m,isRange:y},h)});Ff(Fp,"renderDotItem",function(e,t){var r;if(Ce.isValidElement(e))r=Ce.cloneElement(e,t);else if(Ka(e))r=e(t);else{var n=ls("recharts-area-dot",typeof e!="boolean"?e.className:""),s=t.key,o=Cee(t,r9e);r=Ce.createElement(mj,Ng({},o,{key:s,className:n}))}return r});function B0(e){"@babel/helpers - typeof";return B0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B0(e)}function u9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Iee(n.key),n)}}function f9e(e,t,r){return t&&_z(e.prototype,t),r&&_z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function m9e(e,t,r){return t=US(t),h9e(e,Eee()?Reflect.construct(t,r||[],US(e).constructor):t.apply(e,r))}function h9e(e,t){if(t&&(B0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return p9e(e)}function p9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Eee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Eee=function(){return!!e})()}function US(e){return US=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},US(e)}function g9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WT(e,t)}function WT(e,t){return WT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},WT(e,t)}function kee(e,t,r){return t=Iee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Iee(e){var t=x9e(e,"string");return B0(t)=="symbol"?t:t+""}function x9e(e,t){if(B0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(B0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HT(){return HT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HT.apply(this,arguments)}function v9e(e){var t=e.xAxisId,r=nR(),n=aR(),s=uee(t);return s==null?null:p.createElement(jy,HT({},s,{className:ls("recharts-".concat(s.axisType," ").concat(s.axisType),s.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(i){return Pm(i,!0)}}))}var jp=function(e){function t(){return u9e(this,t),m9e(this,t,arguments)}return g9e(t,e),f9e(t,[{key:"render",value:function(){return p.createElement(v9e,this.props)}}])}(p.Component);kee(jp,"displayName","XAxis");kee(jp,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function q0(e){"@babel/helpers - typeof";return q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q0(e)}function y9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dee(n.key),n)}}function b9e(e,t,r){return t&&Nz(e.prototype,t),r&&Nz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function w9e(e,t,r){return t=VS(t),j9e(e,Oee()?Reflect.construct(t,r||[],VS(e).constructor):t.apply(e,r))}function j9e(e,t){if(t&&(q0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _9e(e)}function _9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Oee=function(){return!!e})()}function VS(e){return VS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},VS(e)}function N9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GT(e,t)}function GT(e,t){return GT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},GT(e,t)}function Tee(e,t,r){return t=Dee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dee(e){var t=S9e(e,"string");return q0(t)=="symbol"?t:t+""}function S9e(e,t){if(q0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(q0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KT(){return KT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KT.apply(this,arguments)}var C9e=function(t){var r=t.yAxisId,n=nR(),s=aR(),o=fee(r);return o==null?null:p.createElement(jy,KT({},o,{className:ls("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:s},ticksGenerator:function(l){return Pm(l,!0)}}))},_p=function(e){function t(){return y9e(this,t),w9e(this,t,arguments)}return N9e(t,e),b9e(t,[{key:"render",value:function(){return p.createElement(C9e,this.props)}}])}(p.Component);Tee(_p,"displayName","YAxis");Tee(_p,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function Sz(e){return k9e(e)||E9e(e)||A9e(e)||P9e()}function P9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A9e(e,t){if(e){if(typeof e=="string")return XT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return XT(e,t)}}function E9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function k9e(e){if(Array.isArray(e))return XT(e)}function XT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var YT=function(t,r,n,s,o){var i=Td(t,oR),l=Td(t,nP),c=[].concat(Sz(i),Sz(l)),d=Td(t,sP),u="".concat(s,"Id"),f=s[0],h=r;if(c.length&&(h=c.reduce(function(g,v){if(v.props[u]===n&&Kf(v.props,"extendDomain")&&Rn(v.props[f])){var y=v.props[f];return[Math.min(g[0],y),Math.max(g[1],y)]}return g},h)),d.length){var m="".concat(f,"1"),x="".concat(f,"2");h=d.reduce(function(g,v){if(v.props[u]===n&&Kf(v.props,"extendDomain")&&Rn(v.props[m])&&Rn(v.props[x])){var y=v.props[m],b=v.props[x];return[Math.min(g[0],y,b),Math.max(g[1],y,b)]}return g},h)}return o&&o.length&&(h=o.reduce(function(g,v){return Rn(v)?[Math.min(g[0],v),Math.max(g[1],v)]:g},h)),h},Mee={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function s(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function o(c,d,u,f,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new s(u,f||c,h),x=r?r+d:d;return c._events[x]?c._events[x].fn?c._events[x]=[c._events[x],m]:c._events[x].push(m):(c._events[x]=m,c._eventsCount++),c}function i(c,d){--c._eventsCount===0?c._events=new n:delete c._events[d]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],u,f;if(this._eventsCount===0)return d;for(f in u=this._events)t.call(u,f)&&d.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},l.prototype.listeners=function(d){var u=r?r+d:d,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,m=f.length,x=new Array(m);h<m;h++)x[h]=f[h].fn;return x},l.prototype.listenerCount=function(d){var u=r?r+d:d,f=this._events[u];return f?f.fn?1:f.length:0},l.prototype.emit=function(d,u,f,h,m,x){var g=r?r+d:d;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,b,w;if(v.fn){switch(v.once&&this.removeListener(d,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,f),!0;case 4:return v.fn.call(v.context,u,f,h),!0;case 5:return v.fn.call(v.context,u,f,h,m),!0;case 6:return v.fn.call(v.context,u,f,h,m,x),!0}for(w=1,b=new Array(y-1);w<y;w++)b[w-1]=arguments[w];v.fn.apply(v.context,b)}else{var j=v.length,_;for(w=0;w<j;w++)switch(v[w].once&&this.removeListener(d,v[w].fn,void 0,!0),y){case 1:v[w].fn.call(v[w].context);break;case 2:v[w].fn.call(v[w].context,u);break;case 3:v[w].fn.call(v[w].context,u,f);break;case 4:v[w].fn.call(v[w].context,u,f,h);break;default:if(!b)for(_=1,b=new Array(y-1);_<y;_++)b[_-1]=arguments[_];v[w].fn.apply(v[w].context,b)}}return!0},l.prototype.on=function(d,u,f){return o(this,d,u,f,!1)},l.prototype.once=function(d,u,f){return o(this,d,u,f,!0)},l.prototype.removeListener=function(d,u,f,h){var m=r?r+d:d;if(!this._events[m])return this;if(!u)return i(this,m),this;var x=this._events[m];if(x.fn)x.fn===u&&(!h||x.once)&&(!f||x.context===f)&&i(this,m);else{for(var g=0,v=[],y=x.length;g<y;g++)(x[g].fn!==u||h&&!x[g].once||f&&x[g].context!==f)&&v.push(x[g]);v.length?this._events[m]=v.length===1?v[0]:v:i(this,m)}return this},l.prototype.removeAllListeners=function(d){var u;return d?(u=r?r+d:d,this._events[u]&&i(this,u)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l})(Mee);var I9e=Mee.exports;const O9e=Ls(I9e);var FE=new O9e,LE="recharts.syncMouseEvents";function _1(e){"@babel/helpers - typeof";return _1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_1(e)}function T9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ree(n.key),n)}}function D9e(e,t,r){return t&&Cz(e.prototype,t),r&&Cz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function $E(e,t,r){return t=Ree(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ree(e){var t=M9e(e,"string");return _1(t)=="symbol"?t:t+""}function M9e(e,t){if(_1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(_1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var R9e=function(){function e(){T9e(this,e),$E(this,"activeIndex",0),$E(this,"coordinateList",[]),$E(this,"layout","horizontal")}return D9e(e,[{key:"setDetails",value:function(r){var n,s=r.coordinateList,o=s===void 0?null:s,i=r.container,l=i===void 0?null:i,c=r.layout,d=c===void 0?null:c,u=r.offset,f=u===void 0?null:u,h=r.mouseHandlerCallback,m=h===void 0?null:h;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=l??this.container,this.layout=d??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=m??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var s=this.container.getBoundingClientRect(),o=s.x,i=s.y,l=s.height,c=this.coordinateList[this.activeIndex].coordinate,d=((r=window)===null||r===void 0?void 0:r.scrollX)||0,u=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=o+c+d,h=i+this.offset.top+l/2+u;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function F9e(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],s=e?.[1];if(n&&s&&Rn(n)&&Rn(s))return!0}return!1}function L9e(e,t,r,n){var s=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-s:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-s,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function Fee(e){var t=e.cx,r=e.cy,n=e.radius,s=e.startAngle,o=e.endAngle,i=Oo(t,r,n,s),l=Oo(t,r,n,o);return{points:[i,l],cx:t,cy:r,radius:n,startAngle:s,endAngle:o}}function $9e(e,t,r){var n,s,o,i;if(e==="horizontal")n=t.x,o=n,s=r.top,i=r.top+r.height;else if(e==="vertical")s=t.y,i=s,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var l=t.cx,c=t.cy,d=t.innerRadius,u=t.outerRadius,f=t.angle,h=Oo(l,c,d,f),m=Oo(l,c,u,f);n=h.x,s=h.y,o=m.x,i=m.y}else return Fee(t);return[{x:n,y:s},{x:o,y:i}]}function N1(e){"@babel/helpers - typeof";return N1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N1(e)}function Pz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function z2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Pz(Object(r),!0).forEach(function(n){B9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function B9e(e,t,r){return t=q9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q9e(e){var t=z9e(e,"string");return N1(t)=="symbol"?t:t+""}function z9e(e,t){if(N1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(N1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function U9e(e){var t,r,n=e.element,s=e.tooltipEventType,o=e.isActive,i=e.activeCoordinate,l=e.activePayload,c=e.offset,d=e.activeTooltipIndex,u=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,m=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!m||!o||!i||h!=="ScatterChart"&&s!=="axis")return null;var x,g=Lg;if(h==="ScatterChart")x=i,g=n8e;else if(h==="BarChart")x=L9e(f,i,c,u),g=QM;else if(f==="radial"){var v=Fee(i),y=v.cx,b=v.cy,w=v.radius,j=v.startAngle,_=v.endAngle;x={cx:y,cy:b,startAngle:j,endAngle:_,innerRadius:w,outerRadius:w},g=JM}else x={points:$9e(f,i,c)},g=Lg;var C=z2(z2(z2(z2({stroke:"#ccc",pointerEvents:"none"},c),x),ka(m,!1)),{},{payload:l,payloadIndex:d,className:ls("recharts-tooltip-cursor",m.className)});return p.isValidElement(m)?p.cloneElement(m,C):p.createElement(g,C)}var V9e=["item"],W9e=["children","className","width","height","style","compact","title","desc"];function z0(e){"@babel/helpers - typeof";return z0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z0(e)}function Tv(){return Tv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tv.apply(this,arguments)}function Az(e,t){return K9e(e)||G9e(e,t)||$ee(e,t)||H9e()}function H9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function K9e(e){if(Array.isArray(e))return e}function Ez(e,t){if(e==null)return{};var r=X9e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function X9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Y9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Bee(n.key),n)}}function J9e(e,t,r){return t&&kz(e.prototype,t),r&&kz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Q9e(e,t,r){return t=WS(t),Z9e(e,Lee()?Reflect.construct(t,r||[],WS(e).constructor):t.apply(e,r))}function Z9e(e,t){if(t&&(z0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eUe(e)}function eUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lee=function(){return!!e})()}function WS(e){return WS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},WS(e)}function tUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JT(e,t)}function JT(e,t){return JT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},JT(e,t)}function U0(e){return aUe(e)||nUe(e)||$ee(e)||rUe()}function rUe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $ee(e,t){if(e){if(typeof e=="string")return QT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return QT(e,t)}}function nUe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function aUe(e){if(Array.isArray(e))return QT(e)}function QT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Hr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Iz(Object(r),!0).forEach(function(n){Ha(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ha(e,t,r){return t=Bee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bee(e){var t=sUe(e,"string");return z0(t)=="symbol"?t:t+""}function sUe(e,t){if(z0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(z0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oUe={xAxis:["bottom","top"],yAxis:["left","right"]},iUe={width:"100%",height:"100%"},qee={x:0,y:0};function U2(e){return e}var lUe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},cUe=function(t,r,n,s){var o=r.find(function(u){return u&&u.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:s.y};if(t==="vertical")return{x:s.x,y:o.coordinate};if(t==="centric"){var i=o.coordinate,l=s.radius;return Hr(Hr(Hr({},s),Oo(s.cx,s.cy,l,i)),{},{angle:i,radius:l})}var c=o.coordinate,d=s.angle;return Hr(Hr(Hr({},s),Oo(s.cx,s.cy,c,d)),{},{angle:d,radius:c})}return qee},oP=function(t,r){var n=r.graphicalItems,s=r.dataStartIndex,o=r.dataEndIndex,i=(n??[]).reduce(function(l,c){var d=c.props.data;return d&&d.length?[].concat(U0(l),U0(d)):l},[]);return i.length>0?i:t&&t.length&&Rn(s)&&Rn(o)?t.slice(s,o+1):[]};function zee(e){return e==="number"?[0,"auto"]:void 0}var ZT=function(t,r,n,s){var o=t.graphicalItems,i=t.tooltipAxis,l=oP(r,t);return n<0||!o||!o.length||n>=l.length?null:o.reduce(function(c,d){var u,f=(u=d.props.data)!==null&&u!==void 0?u:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(i.dataKey&&!i.allowDuplicatedCategory){var m=f===void 0?l:f;h=zN(m,i.dataKey,s)}else h=f&&f[n]||l[n];return h?[].concat(U0(c),[NZ(d,h)]):c},[])},Oz=function(t,r,n,s){var o=s||{x:t.chartX,y:t.chartY},i=lUe(o,n),l=t.orderedTooltipTicks,c=t.tooltipAxis,d=t.tooltipTicks,u=AFe(i,l,d,c);if(u>=0&&d){var f=d[u]&&d[u].value,h=ZT(t,r,u,f),m=cUe(n,l,u,o);return{activeTooltipIndex:u,activeLabel:f,activePayload:h,activeCoordinate:m}}return null},dUe=function(t,r){var n=r.axes,s=r.graphicalItems,o=r.axisType,i=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.layout,f=t.children,h=t.stackOffset,m=vZ(u,o);return n.reduce(function(x,g){var v,y=g.type.defaultProps!==void 0?Hr(Hr({},g.type.defaultProps),g.props):g.props,b=y.type,w=y.dataKey,j=y.allowDataOverflow,_=y.allowDuplicatedCategory,C=y.scale,A=y.ticks,S=y.includeHidden,P=y[i];if(x[P])return x;var M=oP(t.data,{graphicalItems:s.filter(function(U){var L,G=i in U.props?U.props[i]:(L=U.type.defaultProps)===null||L===void 0?void 0:L[i];return G===P}),dataStartIndex:c,dataEndIndex:d}),O=M.length,I,T,k;F9e(y.domain,j,b)&&(I=fT(y.domain,null,j),m&&(b==="number"||C!=="auto")&&(k=Xb(M,w,"category")));var $=zee(b);if(!I||I.length===0){var q,z=(q=y.domain)!==null&&q!==void 0?q:$;if(w){if(I=Xb(M,w,b),b==="category"&&m){var F=wSe(I);_&&F?(T=I,I=kS(0,O)):_||(I=Vq(z,I,g).reduce(function(U,L){return U.indexOf(L)>=0?U:[].concat(U0(U),[L])},[]))}else if(b==="category")_?I=I.filter(function(U){return U!==""&&!ss(U)}):I=Vq(z,I,g).reduce(function(U,L){return U.indexOf(L)>=0||L===""||ss(L)?U:[].concat(U0(U),[L])},[]);else if(b==="number"){var V=TFe(M,s.filter(function(U){var L,G,de=i in U.props?U.props[i]:(L=U.type.defaultProps)===null||L===void 0?void 0:L[i],X="hide"in U.props?U.props.hide:(G=U.type.defaultProps)===null||G===void 0?void 0:G.hide;return de===P&&(S||!X)}),w,o,u);V&&(I=V)}m&&(b==="number"||C!=="auto")&&(k=Xb(M,w,"category"))}else m?I=kS(0,O):l&&l[P]&&l[P].hasStack&&b==="number"?I=h==="expand"?[0,1]:_Z(l[P].stackGroups,c,d):I=xZ(M,s.filter(function(U){var L=i in U.props?U.props[i]:U.type.defaultProps[i],G="hide"in U.props?U.props.hide:U.type.defaultProps.hide;return L===P&&(S||!G)}),b,u,!0);if(b==="number")I=YT(f,I,P,o,A),z&&(I=fT(z,I,j));else if(b==="category"&&z){var ue=z,_e=I.every(function(U){return ue.indexOf(U)>=0});_e&&(I=ue)}}return Hr(Hr({},x),{},Ha({},P,Hr(Hr({},y),{},{axisType:o,domain:I,categoricalDomain:k,duplicateDomain:T,originalDomain:(v=y.domain)!==null&&v!==void 0?v:$,isCategorical:m,layout:u})))},{})},uUe=function(t,r){var n=r.graphicalItems,s=r.Axis,o=r.axisType,i=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.layout,f=t.children,h=oP(t.data,{graphicalItems:n,dataStartIndex:c,dataEndIndex:d}),m=h.length,x=vZ(u,o),g=-1;return n.reduce(function(v,y){var b=y.type.defaultProps!==void 0?Hr(Hr({},y.type.defaultProps),y.props):y.props,w=b[i],j=zee("number");if(!v[w]){g++;var _;return x?_=kS(0,m):l&&l[w]&&l[w].hasStack?(_=_Z(l[w].stackGroups,c,d),_=YT(f,_,w,o)):(_=fT(j,xZ(h,n.filter(function(C){var A,S,P=i in C.props?C.props[i]:(A=C.type.defaultProps)===null||A===void 0?void 0:A[i],M="hide"in C.props?C.props.hide:(S=C.type.defaultProps)===null||S===void 0?void 0:S.hide;return P===w&&!M}),"number",u),s.defaultProps.allowDataOverflow),_=YT(f,_,w,o)),Hr(Hr({},v),{},Ha({},w,Hr(Hr({axisType:o},s.defaultProps),{},{hide:!0,orientation:Od(oUe,"".concat(o,".").concat(g%2),null),domain:_,originalDomain:j,isCategorical:x,layout:u})))}return v},{})},fUe=function(t,r){var n=r.axisType,s=n===void 0?"xAxis":n,o=r.AxisComp,i=r.graphicalItems,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.children,f="".concat(s,"Id"),h=Td(u,o),m={};return h&&h.length?m=dUe(t,{axes:h,graphicalItems:i,axisType:s,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:d}):i&&i.length&&(m=uUe(t,{Axis:o,graphicalItems:i,axisType:s,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:d})),m},mUe=function(t){var r=Eh(t),n=Pm(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:NM(n,function(s){return s.coordinate}),tooltipAxis:r,tooltipAxisBandSize:xS(r,n)}},Tz=function(t){var r=t.children,n=t.defaultShowTooltip,s=yd(r,O0),o=0,i=0;return t.data&&t.data.length!==0&&(i=t.data.length-1),s&&s.props&&(s.props.startIndex>=0&&(o=s.props.startIndex),s.props.endIndex>=0&&(i=s.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:i,activeTooltipIndex:-1,isTooltipActive:!!n}},hUe=function(t){return!t||!t.length?!1:t.some(function(r){var n=Om(r&&r.type);return n&&n.indexOf("Bar")>=0})},Dz=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},pUe=function(t,r){var n=t.props,s=t.graphicalItems,o=t.xAxisMap,i=o===void 0?{}:o,l=t.yAxisMap,c=l===void 0?{}:l,d=n.width,u=n.height,f=n.children,h=n.margin||{},m=yd(f,O0),x=yd(f,Mg),g=Object.keys(c).reduce(function(_,C){var A=c[C],S=A.orientation;return!A.mirror&&!A.hide?Hr(Hr({},_),{},Ha({},S,_[S]+A.width)):_},{left:h.left||0,right:h.right||0}),v=Object.keys(i).reduce(function(_,C){var A=i[C],S=A.orientation;return!A.mirror&&!A.hide?Hr(Hr({},_),{},Ha({},S,Od(_,"".concat(S))+A.height)):_},{top:h.top||0,bottom:h.bottom||0}),y=Hr(Hr({},v),g),b=y.bottom;m&&(y.bottom+=m.props.height||O0.defaultProps.height),x&&r&&(y=IFe(y,s,n,r));var w=d-y.left-y.right,j=u-y.top-y.bottom;return Hr(Hr({brushBottom:b},y),{},{width:Math.max(w,0),height:Math.max(j,0)})},gUe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},iP=function(t){var r=t.chartName,n=t.GraphicalChild,s=t.defaultTooltipEventType,o=s===void 0?"axis":s,i=t.validateTooltipEventTypes,l=i===void 0?["axis"]:i,c=t.axisComponents,d=t.legendContent,u=t.formatAxisMap,f=t.defaultProps,h=function(y,b){var w=b.graphicalItems,j=b.stackGroups,_=b.offset,C=b.updateId,A=b.dataStartIndex,S=b.dataEndIndex,P=y.barSize,M=y.layout,O=y.barGap,I=y.barCategoryGap,T=y.maxBarSize,k=Dz(M),$=k.numericAxisName,q=k.cateAxisName,z=hUe(w),F=[];return w.forEach(function(V,ue){var _e=oP(y.data,{graphicalItems:[V],dataStartIndex:A,dataEndIndex:S}),U=V.type.defaultProps!==void 0?Hr(Hr({},V.type.defaultProps),V.props):V.props,L=U.dataKey,G=U.maxBarSize,de=U["".concat($,"Id")],X=U["".concat(q,"Id")],W={},Y=c.reduce(function(_t,gr){var be=b["".concat(gr.axisType,"Map")],Nt=U["".concat(gr.axisType,"Id")];be&&be[Nt]||gr.axisType==="zAxis"||bp(!1);var Wt=be[Nt];return Hr(Hr({},_t),{},Ha(Ha({},gr.axisType,Wt),"".concat(gr.axisType,"Ticks"),Pm(Wt)))},W),me=Y[q],ee=Y["".concat(q,"Ticks")],ae=j&&j[de]&&j[de].hasStack&&zFe(V,j[de].stackGroups),le=Om(V.type).indexOf("Bar")>=0,Te=xS(me,ee),te=[],ie=z&&EFe({barSize:P,stackGroups:j,totalSize:gUe(Y,q)});if(le){var xt,vt,dt=ss(G)?T:G,St=(xt=(vt=xS(me,ee,!0))!==null&&vt!==void 0?vt:dt)!==null&&xt!==void 0?xt:0;te=kFe({barGap:O,barCategoryGap:I,bandSize:St!==Te?St:Te,sizeList:ie[X],maxBarSize:dt}),St!==Te&&(te=te.map(function(_t){return Hr(Hr({},_t),{},{position:Hr(Hr({},_t.position),{},{offset:_t.position.offset-St/2})})}))}var ft=V&&V.type&&V.type.getComposedData;ft&&F.push({props:Hr(Hr({},ft(Hr(Hr({},Y),{},{displayedData:_e,props:y,dataKey:L,item:V,bandSize:Te,barPosition:te,offset:_,stackedData:ae,layout:M,dataStartIndex:A,dataEndIndex:S}))),{},Ha(Ha(Ha({key:V.key||"item-".concat(ue)},$,Y[$]),q,Y[q]),"animationId",C)),childIndex:TSe(V,y.children),item:V})}),F},m=function(y,b){var w=y.props,j=y.dataStartIndex,_=y.dataEndIndex,C=y.updateId;if(!D8({props:w}))return null;var A=w.children,S=w.layout,P=w.stackOffset,M=w.data,O=w.reverseStackOrder,I=Dz(S),T=I.numericAxisName,k=I.cateAxisName,$=Td(A,n),q=BFe(M,$,"".concat(T,"Id"),"".concat(k,"Id"),P,O),z=c.reduce(function(U,L){var G="".concat(L.axisType,"Map");return Hr(Hr({},U),{},Ha({},G,fUe(w,Hr(Hr({},L),{},{graphicalItems:$,stackGroups:L.axisType===T&&q,dataStartIndex:j,dataEndIndex:_}))))},{}),F=pUe(Hr(Hr({},z),{},{props:w,graphicalItems:$}),b?.legendBBox);Object.keys(z).forEach(function(U){z[U]=u(w,z[U],F,U.replace("Map",""),r)});var V=z["".concat(k,"Map")],ue=mUe(V),_e=h(w,Hr(Hr({},z),{},{dataStartIndex:j,dataEndIndex:_,updateId:C,graphicalItems:$,stackGroups:q,offset:F}));return Hr(Hr({formattedGraphicalItems:_e,graphicalItems:$,offset:F,stackGroups:q},ue),z)},x=function(v){function y(b){var w,j,_;return Y9e(this,y),_=Q9e(this,y,[b]),Ha(_,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Ha(_,"accessibilityManager",new R9e),Ha(_,"handleLegendBBoxUpdate",function(C){if(C){var A=_.state,S=A.dataStartIndex,P=A.dataEndIndex,M=A.updateId;_.setState(Hr({legendBBox:C},m({props:_.props,dataStartIndex:S,dataEndIndex:P,updateId:M},Hr(Hr({},_.state),{},{legendBBox:C}))))}}),Ha(_,"handleReceiveSyncEvent",function(C,A,S){if(_.props.syncId===C){if(S===_.eventEmitterSymbol&&typeof _.props.syncMethod!="function")return;_.applySyncEvent(A)}}),Ha(_,"handleBrushChange",function(C){var A=C.startIndex,S=C.endIndex;if(A!==_.state.dataStartIndex||S!==_.state.dataEndIndex){var P=_.state.updateId;_.setState(function(){return Hr({dataStartIndex:A,dataEndIndex:S},m({props:_.props,dataStartIndex:A,dataEndIndex:S,updateId:P},_.state))}),_.triggerSyncEvent({dataStartIndex:A,dataEndIndex:S})}}),Ha(_,"handleMouseEnter",function(C){var A=_.getMouseInfo(C);if(A){var S=Hr(Hr({},A),{},{isTooltipActive:!0});_.setState(S),_.triggerSyncEvent(S);var P=_.props.onMouseEnter;Ka(P)&&P(S,C)}}),Ha(_,"triggeredAfterMouseMove",function(C){var A=_.getMouseInfo(C),S=A?Hr(Hr({},A),{},{isTooltipActive:!0}):{isTooltipActive:!1};_.setState(S),_.triggerSyncEvent(S);var P=_.props.onMouseMove;Ka(P)&&P(S,C)}),Ha(_,"handleItemMouseEnter",function(C){_.setState(function(){return{isTooltipActive:!0,activeItem:C,activePayload:C.tooltipPayload,activeCoordinate:C.tooltipPosition||{x:C.cx,y:C.cy}}})}),Ha(_,"handleItemMouseLeave",function(){_.setState(function(){return{isTooltipActive:!1}})}),Ha(_,"handleMouseMove",function(C){C.persist(),_.throttleTriggeredAfterMouseMove(C)}),Ha(_,"handleMouseLeave",function(C){_.throttleTriggeredAfterMouseMove.cancel();var A={isTooltipActive:!1};_.setState(A),_.triggerSyncEvent(A);var S=_.props.onMouseLeave;Ka(S)&&S(A,C)}),Ha(_,"handleOuterEvent",function(C){var A=OSe(C),S=Od(_.props,"".concat(A));if(A&&Ka(S)){var P,M;/.*touch.*/i.test(A)?M=_.getMouseInfo(C.changedTouches[0]):M=_.getMouseInfo(C),S((P=M)!==null&&P!==void 0?P:{},C)}}),Ha(_,"handleClick",function(C){var A=_.getMouseInfo(C);if(A){var S=Hr(Hr({},A),{},{isTooltipActive:!0});_.setState(S),_.triggerSyncEvent(S);var P=_.props.onClick;Ka(P)&&P(S,C)}}),Ha(_,"handleMouseDown",function(C){var A=_.props.onMouseDown;if(Ka(A)){var S=_.getMouseInfo(C);A(S,C)}}),Ha(_,"handleMouseUp",function(C){var A=_.props.onMouseUp;if(Ka(A)){var S=_.getMouseInfo(C);A(S,C)}}),Ha(_,"handleTouchMove",function(C){C.changedTouches!=null&&C.changedTouches.length>0&&_.throttleTriggeredAfterMouseMove(C.changedTouches[0])}),Ha(_,"handleTouchStart",function(C){C.changedTouches!=null&&C.changedTouches.length>0&&_.handleMouseDown(C.changedTouches[0])}),Ha(_,"handleTouchEnd",function(C){C.changedTouches!=null&&C.changedTouches.length>0&&_.handleMouseUp(C.changedTouches[0])}),Ha(_,"handleDoubleClick",function(C){var A=_.props.onDoubleClick;if(Ka(A)){var S=_.getMouseInfo(C);A(S,C)}}),Ha(_,"handleContextMenu",function(C){var A=_.props.onContextMenu;if(Ka(A)){var S=_.getMouseInfo(C);A(S,C)}}),Ha(_,"triggerSyncEvent",function(C){_.props.syncId!==void 0&&FE.emit(LE,_.props.syncId,C,_.eventEmitterSymbol)}),Ha(_,"applySyncEvent",function(C){var A=_.props,S=A.layout,P=A.syncMethod,M=_.state.updateId,O=C.dataStartIndex,I=C.dataEndIndex;if(C.dataStartIndex!==void 0||C.dataEndIndex!==void 0)_.setState(Hr({dataStartIndex:O,dataEndIndex:I},m({props:_.props,dataStartIndex:O,dataEndIndex:I,updateId:M},_.state)));else if(C.activeTooltipIndex!==void 0){var T=C.chartX,k=C.chartY,$=C.activeTooltipIndex,q=_.state,z=q.offset,F=q.tooltipTicks;if(!z)return;if(typeof P=="function")$=P(F,C);else if(P==="value"){$=-1;for(var V=0;V<F.length;V++)if(F[V].value===C.activeLabel){$=V;break}}var ue=Hr(Hr({},z),{},{x:z.left,y:z.top}),_e=Math.min(T,ue.x+ue.width),U=Math.min(k,ue.y+ue.height),L=F[$]&&F[$].value,G=ZT(_.state,_.props.data,$),de=F[$]?{x:S==="horizontal"?F[$].coordinate:_e,y:S==="horizontal"?U:F[$].coordinate}:qee;_.setState(Hr(Hr({},C),{},{activeLabel:L,activeCoordinate:de,activePayload:G,activeTooltipIndex:$}))}else _.setState(C)}),Ha(_,"renderCursor",function(C){var A,S=_.state,P=S.isTooltipActive,M=S.activeCoordinate,O=S.activePayload,I=S.offset,T=S.activeTooltipIndex,k=S.tooltipAxisBandSize,$=_.getTooltipEventType(),q=(A=C.props.active)!==null&&A!==void 0?A:P,z=_.props.layout,F=C.key||"_recharts-cursor";return Ce.createElement(U9e,{key:F,activeCoordinate:M,activePayload:O,activeTooltipIndex:T,chartName:r,element:C,isActive:q,layout:z,offset:I,tooltipAxisBandSize:k,tooltipEventType:$})}),Ha(_,"renderPolarAxis",function(C,A,S){var P=Od(C,"type.axisType"),M=Od(_.state,"".concat(P,"Map")),O=C.type.defaultProps,I=O!==void 0?Hr(Hr({},O),C.props):C.props,T=M&&M[I["".concat(P,"Id")]];return p.cloneElement(C,Hr(Hr({},T),{},{className:ls(P,T.className),key:C.key||"".concat(A,"-").concat(S),ticks:Pm(T,!0)}))}),Ha(_,"renderPolarGrid",function(C){var A=C.props,S=A.radialLines,P=A.polarAngles,M=A.polarRadius,O=_.state,I=O.radiusAxisMap,T=O.angleAxisMap,k=Eh(I),$=Eh(T),q=$.cx,z=$.cy,F=$.innerRadius,V=$.outerRadius;return p.cloneElement(C,{polarAngles:Array.isArray(P)?P:Pm($,!0).map(function(ue){return ue.coordinate}),polarRadius:Array.isArray(M)?M:Pm(k,!0).map(function(ue){return ue.coordinate}),cx:q,cy:z,innerRadius:F,outerRadius:V,key:C.key||"polar-grid",radialLines:S})}),Ha(_,"renderLegend",function(){var C=_.state.formattedGraphicalItems,A=_.props,S=A.children,P=A.width,M=A.height,O=_.props.margin||{},I=P-(O.left||0)-(O.right||0),T=pZ({children:S,formattedGraphicalItems:C,legendWidth:I,legendContent:d});if(!T)return null;var k=T.item,$=Ez(T,V9e);return p.cloneElement(k,Hr(Hr({},$),{},{chartWidth:P,chartHeight:M,margin:O,onBBoxUpdate:_.handleLegendBBoxUpdate}))}),Ha(_,"renderTooltip",function(){var C,A=_.props,S=A.children,P=A.accessibilityLayer,M=yd(S,Lc);if(!M)return null;var O=_.state,I=O.isTooltipActive,T=O.activeCoordinate,k=O.activePayload,$=O.activeLabel,q=O.offset,z=(C=M.props.active)!==null&&C!==void 0?C:I;return p.cloneElement(M,{viewBox:Hr(Hr({},q),{},{x:q.left,y:q.top}),active:z,label:$,payload:z?k:[],coordinate:T,accessibilityLayer:P})}),Ha(_,"renderBrush",function(C){var A=_.props,S=A.margin,P=A.data,M=_.state,O=M.offset,I=M.dataStartIndex,T=M.dataEndIndex,k=M.updateId;return p.cloneElement(C,{key:C.key||"_recharts-brush",onChange:L2(_.handleBrushChange,C.props.onChange),data:P,x:Rn(C.props.x)?C.props.x:O.left,y:Rn(C.props.y)?C.props.y:O.top+O.height+O.brushBottom-(S.bottom||0),width:Rn(C.props.width)?C.props.width:O.width,startIndex:I,endIndex:T,updateId:"brush-".concat(k)})}),Ha(_,"renderReferenceElement",function(C,A,S){if(!C)return null;var P=_,M=P.clipPathId,O=_.state,I=O.xAxisMap,T=O.yAxisMap,k=O.offset,$=C.type.defaultProps||{},q=C.props,z=q.xAxisId,F=z===void 0?$.xAxisId:z,V=q.yAxisId,ue=V===void 0?$.yAxisId:V;return p.cloneElement(C,{key:C.key||"".concat(A,"-").concat(S),xAxis:I[F],yAxis:T[ue],viewBox:{x:k.left,y:k.top,width:k.width,height:k.height},clipPathId:M})}),Ha(_,"renderActivePoints",function(C){var A=C.item,S=C.activePoint,P=C.basePoint,M=C.childIndex,O=C.isRange,I=[],T=A.props.key,k=A.item.type.defaultProps!==void 0?Hr(Hr({},A.item.type.defaultProps),A.item.props):A.item.props,$=k.activeDot,q=k.dataKey,z=Hr(Hr({index:M,dataKey:q,cx:S.x,cy:S.y,r:4,fill:YM(A.item),strokeWidth:2,stroke:"#fff",payload:S.payload,value:S.value},ka($,!1)),UN($));return I.push(y.renderActiveDot($,z,"".concat(T,"-activePoint-").concat(M))),P?I.push(y.renderActiveDot($,Hr(Hr({},z),{},{cx:P.x,cy:P.y}),"".concat(T,"-basePoint-").concat(M))):O&&I.push(null),I}),Ha(_,"renderGraphicChild",function(C,A,S){var P=_.filterFormatItem(C,A,S);if(!P)return null;var M=_.getTooltipEventType(),O=_.state,I=O.isTooltipActive,T=O.tooltipAxis,k=O.activeTooltipIndex,$=O.activeLabel,q=_.props.children,z=yd(q,Lc),F=P.props,V=F.points,ue=F.isRange,_e=F.baseLine,U=P.item.type.defaultProps!==void 0?Hr(Hr({},P.item.type.defaultProps),P.item.props):P.item.props,L=U.activeDot,G=U.hide,de=U.activeBar,X=U.activeShape,W=!!(!G&&I&&z&&(L||de||X)),Y={};M!=="axis"&&z&&z.props.trigger==="click"?Y={onClick:L2(_.handleItemMouseEnter,C.props.onClick)}:M!=="axis"&&(Y={onMouseLeave:L2(_.handleItemMouseLeave,C.props.onMouseLeave),onMouseEnter:L2(_.handleItemMouseEnter,C.props.onMouseEnter)});var me=p.cloneElement(C,Hr(Hr({},P.props),Y));function ee(gr){return typeof T.dataKey=="function"?T.dataKey(gr.payload):null}if(W)if(k>=0){var ae,le;if(T.dataKey&&!T.allowDuplicatedCategory){var Te=typeof T.dataKey=="function"?ee:"payload.".concat(T.dataKey.toString());ae=zN(V,Te,$),le=ue&&_e&&zN(_e,Te,$)}else ae=V?.[k],le=ue&&_e&&_e[k];if(X||de){var te=C.props.activeIndex!==void 0?C.props.activeIndex:k;return[p.cloneElement(C,Hr(Hr(Hr({},P.props),Y),{},{activeIndex:te})),null,null]}if(!ss(ae))return[me].concat(U0(_.renderActivePoints({item:P,activePoint:ae,basePoint:le,childIndex:k,isRange:ue})))}else{var ie,xt=(ie=_.getItemByXY(_.state.activeCoordinate))!==null&&ie!==void 0?ie:{graphicalItem:me},vt=xt.graphicalItem,dt=vt.item,St=dt===void 0?C:dt,ft=vt.childIndex,_t=Hr(Hr(Hr({},P.props),Y),{},{activeIndex:ft});return[p.cloneElement(St,_t),null,null]}return ue?[me,null,null]:[me,null]}),Ha(_,"renderCustomized",function(C,A,S){return p.cloneElement(C,Hr(Hr({key:"recharts-customized-".concat(S)},_.props),_.state))}),Ha(_,"renderMap",{CartesianGrid:{handler:U2,once:!0},ReferenceArea:{handler:_.renderReferenceElement},ReferenceLine:{handler:U2},ReferenceDot:{handler:_.renderReferenceElement},XAxis:{handler:U2},YAxis:{handler:U2},Brush:{handler:_.renderBrush,once:!0},Bar:{handler:_.renderGraphicChild},Line:{handler:_.renderGraphicChild},Area:{handler:_.renderGraphicChild},Radar:{handler:_.renderGraphicChild},RadialBar:{handler:_.renderGraphicChild},Scatter:{handler:_.renderGraphicChild},Pie:{handler:_.renderGraphicChild},Funnel:{handler:_.renderGraphicChild},Tooltip:{handler:_.renderCursor,once:!0},PolarGrid:{handler:_.renderPolarGrid,once:!0},PolarAngleAxis:{handler:_.renderPolarAxis},PolarRadiusAxis:{handler:_.renderPolarAxis},Customized:{handler:_.renderCustomized}}),_.clipPathId="".concat((w=b.id)!==null&&w!==void 0?w:wx("recharts"),"-clip"),_.throttleTriggeredAfterMouseMove=hQ(_.triggeredAfterMouseMove,(j=b.throttleDelay)!==null&&j!==void 0?j:1e3/60),_.state={},_}return tUe(y,v),J9e(y,[{key:"componentDidMount",value:function(){var w,j;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(j=this.props.margin.top)!==null&&j!==void 0?j:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var w=this.props,j=w.children,_=w.data,C=w.height,A=w.layout,S=yd(j,Lc);if(S){var P=S.props.defaultIndex;if(!(typeof P!="number"||P<0||P>this.state.tooltipTicks.length-1)){var M=this.state.tooltipTicks[P]&&this.state.tooltipTicks[P].value,O=ZT(this.state,_,P,M),I=this.state.tooltipTicks[P].coordinate,T=(this.state.offset.top+C)/2,k=A==="horizontal",$=k?{x:I,y:T}:{y:I,x:T},q=this.state.formattedGraphicalItems.find(function(F){var V=F.item;return V.type.name==="Scatter"});q&&($=Hr(Hr({},$),q.props.points[P].tooltipPosition),O=q.props.points[P].tooltipPayload);var z={activeTooltipIndex:P,isTooltipActive:!0,activeLabel:M,activePayload:O,activeCoordinate:$};this.setState(z),this.renderCursor(S),this.accessibilityManager.setIndex(P)}}}},{key:"getSnapshotBeforeUpdate",value:function(w,j){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==j.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==w.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==w.margin){var _,C;this.accessibilityManager.setDetails({offset:{left:(_=this.props.margin.left)!==null&&_!==void 0?_:0,top:(C=this.props.margin.top)!==null&&C!==void 0?C:0}})}return null}},{key:"componentDidUpdate",value:function(w){PO([yd(w.children,Lc)],[yd(this.props.children,Lc)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var w=yd(this.props.children,Lc);if(w&&typeof w.props.shared=="boolean"){var j=w.props.shared?"axis":"item";return l.indexOf(j)>=0?j:o}return o}},{key:"getMouseInfo",value:function(w){if(!this.container)return null;var j=this.container,_=j.getBoundingClientRect(),C=r4e(_),A={chartX:Math.round(w.pageX-C.left),chartY:Math.round(w.pageY-C.top)},S=_.width/j.offsetWidth||1,P=this.inRange(A.chartX,A.chartY,S);if(!P)return null;var M=this.state,O=M.xAxisMap,I=M.yAxisMap,T=this.getTooltipEventType(),k=Oz(this.state,this.props.data,this.props.layout,P);if(T!=="axis"&&O&&I){var $=Eh(O).scale,q=Eh(I).scale,z=$&&$.invert?$.invert(A.chartX):null,F=q&&q.invert?q.invert(A.chartY):null;return Hr(Hr({},A),{},{xValue:z,yValue:F},k)}return k?Hr(Hr({},A),k):null}},{key:"inRange",value:function(w,j){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,C=this.props.layout,A=w/_,S=j/_;if(C==="horizontal"||C==="vertical"){var P=this.state.offset,M=A>=P.left&&A<=P.left+P.width&&S>=P.top&&S<=P.top+P.height;return M?{x:A,y:S}:null}var O=this.state,I=O.angleAxisMap,T=O.radiusAxisMap;if(I&&T){var k=Eh(I);return Gq({x:A,y:S},k)}return null}},{key:"parseEventsOfWrapper",value:function(){var w=this.props.children,j=this.getTooltipEventType(),_=yd(w,Lc),C={};_&&j==="axis"&&(_.props.trigger==="click"?C={onClick:this.handleClick}:C={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var A=UN(this.props,this.handleOuterEvent);return Hr(Hr({},A),C)}},{key:"addListener",value:function(){FE.on(LE,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){FE.removeListener(LE,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(w,j,_){for(var C=this.state.formattedGraphicalItems,A=0,S=C.length;A<S;A++){var P=C[A];if(P.item===w||P.props.key===w.key||j===Om(P.item.type)&&_===P.childIndex)return P}return null}},{key:"renderClipPath",value:function(){var w=this.clipPathId,j=this.state.offset,_=j.left,C=j.top,A=j.height,S=j.width;return Ce.createElement("defs",null,Ce.createElement("clipPath",{id:w},Ce.createElement("rect",{x:_,y:C,height:A,width:S})))}},{key:"getXScales",value:function(){var w=this.state.xAxisMap;return w?Object.entries(w).reduce(function(j,_){var C=Az(_,2),A=C[0],S=C[1];return Hr(Hr({},j),{},Ha({},A,S.scale))},{}):null}},{key:"getYScales",value:function(){var w=this.state.yAxisMap;return w?Object.entries(w).reduce(function(j,_){var C=Az(_,2),A=C[0],S=C[1];return Hr(Hr({},j),{},Ha({},A,S.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(w){var j;return(j=this.state.xAxisMap)===null||j===void 0||(j=j[w])===null||j===void 0?void 0:j.scale}},{key:"getYScaleByAxisId",value:function(w){var j;return(j=this.state.yAxisMap)===null||j===void 0||(j=j[w])===null||j===void 0?void 0:j.scale}},{key:"getItemByXY",value:function(w){var j=this.state,_=j.formattedGraphicalItems,C=j.activeItem;if(_&&_.length)for(var A=0,S=_.length;A<S;A++){var P=_[A],M=P.props,O=P.item,I=O.type.defaultProps!==void 0?Hr(Hr({},O.type.defaultProps),O.props):O.props,T=Om(O.type);if(T==="Bar"){var k=(M.data||[]).find(function(F){return F6e(w,F)});if(k)return{graphicalItem:P,payload:k}}else if(T==="RadialBar"){var $=(M.data||[]).find(function(F){return Gq(w,F)});if($)return{graphicalItem:P,payload:$}}else if(Z5(P,C)||eP(P,C)||v1(P,C)){var q=SBe({graphicalItem:P,activeTooltipItem:C,itemData:I.data}),z=I.activeIndex===void 0?q:I.activeIndex;return{graphicalItem:Hr(Hr({},P),{},{childIndex:z}),payload:v1(P,C)?I.data[q]:P.props.data[q]}}}return null}},{key:"render",value:function(){var w=this;if(!D8(this))return null;var j=this.props,_=j.children,C=j.className,A=j.width,S=j.height,P=j.style,M=j.compact,O=j.title,I=j.desc,T=Ez(j,W9e),k=ka(T,!1);if(M)return Ce.createElement(rz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement(EO,Tv({},k,{width:A,height:S,title:O,desc:I}),this.renderClipPath(),R8(_,this.renderMap)));if(this.props.accessibilityLayer){var $,q;k.tabIndex=($=this.props.tabIndex)!==null&&$!==void 0?$:0,k.role=(q=this.props.role)!==null&&q!==void 0?q:"application",k.onKeyDown=function(F){w.accessibilityManager.keyboardEvent(F)},k.onFocus=function(){w.accessibilityManager.focus()}}var z=this.parseEventsOfWrapper();return Ce.createElement(rz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement("div",Tv({className:ls("recharts-wrapper",C),style:Hr({position:"relative",cursor:"default",width:A,height:S},P)},z,{ref:function(V){w.container=V}}),Ce.createElement(EO,Tv({},k,{width:A,height:S,title:O,desc:I,style:iUe}),this.renderClipPath(),R8(_,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(p.Component);Ha(x,"displayName",r),Ha(x,"defaultProps",Hr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),Ha(x,"getDerivedStateFromProps",function(v,y){var b=v.dataKey,w=v.data,j=v.children,_=v.width,C=v.height,A=v.layout,S=v.stackOffset,P=v.margin,M=y.dataStartIndex,O=y.dataEndIndex;if(y.updateId===void 0){var I=Tz(v);return Hr(Hr(Hr({},I),{},{updateId:0},m(Hr(Hr({props:v},I),{},{updateId:0}),y)),{},{prevDataKey:b,prevData:w,prevWidth:_,prevHeight:C,prevLayout:A,prevStackOffset:S,prevMargin:P,prevChildren:j})}if(b!==y.prevDataKey||w!==y.prevData||_!==y.prevWidth||C!==y.prevHeight||A!==y.prevLayout||S!==y.prevStackOffset||!Xv(P,y.prevMargin)){var T=Tz(v),k={chartX:y.chartX,chartY:y.chartY,isTooltipActive:y.isTooltipActive},$=Hr(Hr({},Oz(y,w,A)),{},{updateId:y.updateId+1}),q=Hr(Hr(Hr({},T),k),$);return Hr(Hr(Hr({},q),m(Hr({props:v},q),y)),{},{prevDataKey:b,prevData:w,prevWidth:_,prevHeight:C,prevLayout:A,prevStackOffset:S,prevMargin:P,prevChildren:j})}if(!PO(j,y.prevChildren)){var z,F,V,ue,_e=yd(j,O0),U=_e&&(z=(F=_e.props)===null||F===void 0?void 0:F.startIndex)!==null&&z!==void 0?z:M,L=_e&&(V=(ue=_e.props)===null||ue===void 0?void 0:ue.endIndex)!==null&&V!==void 0?V:O,G=U!==M||L!==O,de=!ss(w),X=de&&!G?y.updateId:y.updateId+1;return Hr(Hr({updateId:X},m(Hr(Hr({props:v},y),{},{updateId:X,dataStartIndex:U,dataEndIndex:L}),y)),{},{prevChildren:j,dataStartIndex:U,dataEndIndex:L})}return null}),Ha(x,"renderActiveDot",function(v,y,b){var w;return p.isValidElement(v)?w=p.cloneElement(v,y):Ka(v)?w=v(y):w=Ce.createElement(mj,y),Ce.createElement(Cs,{className:"recharts-active-dot",key:b},w)});var g=p.forwardRef(function(y,b){return Ce.createElement(x,Tv({},y,{ref:b}))});return g.displayName=x.displayName,g},Uee=iP({chartName:"LineChart",GraphicalChild:_y,axisComponents:[{axisType:"xAxis",AxisComp:jp},{axisType:"yAxis",AxisComp:_p}],formatAxisMap:ZM}),xUe=iP({chartName:"BarChart",GraphicalChild:Sx,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:jp},{axisType:"yAxis",AxisComp:_p}],formatAxisMap:ZM}),vUe=iP({chartName:"PieChart",GraphicalChild:em,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:Q5},{axisType:"radiusAxis",AxisComp:Y5}],formatAxisMap:QFe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}}),yUe=iP({chartName:"AreaChart",GraphicalChild:Fp,axisComponents:[{axisType:"xAxis",AxisComp:jp},{axisType:"yAxis",AxisComp:_p}],formatAxisMap:ZM});const Mz=({icon:e,title:t,value:r,trend:n,trendValue:s,color:o,className:i,loading:l})=>{const c=n==="up"?K4:Eue,d=n==="up"?"text-success":"text-danger";return a.jsx(Mr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group flex flex-col justify-between ${i}`,children:a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10",style:{color:`var(--${o})`},children:a.jsx(e,{className:"h-5 w-5"})}),!l&&n&&s&&a.jsxs("div",{className:`flex items-center text-xs font-bold ${d}`,children:[a.jsx(c,{className:"w-3.5 h-3.5 mr-1"}),a.jsx("span",{children:s})]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider mb-2",children:t}),l?a.jsx("div",{className:"h-9 bg-white/5 rounded animate-pulse"}):a.jsx("p",{className:"text-3xl font-bold text-text-primary tabular-nums tracking-tight",children:r})]})]})})},bUe=({alerts:e,className:t})=>{const r=Ol(),[n,s]=p.useState(!1),o=u=>({Package:ju,DollarSign:Vi,CalendarCheck:zC,Clock:xu,ShoppingCart:X1,Store:eD,Users:vc,CalendarPlus:J4,AlertTriangle:Jf,Info:yG})[u]||Jf,i=u=>({danger:"text-danger",warning:"text-warning",info:"text-info",success:"text-success",purple:"text-purple"})[u]||"text-warning",l=e.length>2?e.slice(0,2):e,c=e.length>2,d=({alert:u,onClick:f})=>{const h=o(u.icone),m=i(u.cor);return a.jsxs("li",{className:"flex items-center gap-2 p-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group",onClick:f,children:[a.jsx(h,{className:`w-4 h-4 flex-shrink-0 ${m}`}),a.jsx("span",{className:"text-text-secondary group-hover:text-text-primary transition-colors flex-1",children:u.mensagem}),u.link&&a.jsx(K4,{className:"w-3 h-3 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity"})]})};return a.jsxs(a.Fragment,{children:[a.jsxs(Mr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card ${t||""}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h2",{className:"text-lg font-bold text-text-primary flex items-center",children:[a.jsx(Fb,{className:"mr-2 h-5 w-5 text-brand"})," Alertas do Dia"]}),c&&a.jsx(Z,{variant:"ghost",size:"sm",className:"text-xs text-brand hover:text-brand/80",onClick:()=>s(!0),children:"Ver todos"})]}),e.length===0?a.jsx("p",{className:"text-sm text-text-muted",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:l.map((u,f)=>a.jsx(d,{alert:u,onClick:()=>u.link&&r(u.link)},f))})]}),a.jsx(zn,{open:n,onOpenChange:s,children:a.jsxs(qn,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(Bn,{children:a.jsxs($n,{className:"flex items-center gap-2",children:[a.jsx(Fb,{className:"h-5 w-5 text-brand"}),"Todos os Alertas (",e.length,")"]})}),a.jsx("div",{className:"mt-4",children:e.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-8",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:e.map((u,f)=>a.jsx(d,{alert:u,onClick:()=>{u.link&&(r(u.link),s(!1))}},f))})})]})})]})},wUe=({title:e,icon:t,data:r,color:n,className:s,loading:o})=>{const i=r.reduce((d,u)=>d+(u.receita||0),0),l=r.reduce((d,u)=>d+(u.despesa||0),0),c=i-l;return a.jsxs(Mr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group ${s||""}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10 mr-3",style:{color:`var(--${n})`},children:a.jsx(t,{className:"h-5 w-5"})}),a.jsx("h3",{className:"text-base font-bold text-text-primary flex-1",children:e}),a.jsx("div",{className:"text-xs font-semibold text-text-muted",children:"ltimos 14 dias"})]}),a.jsx("div",{className:"mb-2",children:a.jsx(Hb,{width:"100%",height:90,children:a.jsxs(yUe,{data:r,margin:{top:4,right:0,left:0,bottom:0},children:[a.jsx(Lc,{cursor:{stroke:"var(--border)",strokeDasharray:"3 3"},contentStyle:{background:"rgba(10, 10, 10, 0.85)",borderColor:"var(--border)",color:"var(--text-primary)",borderRadius:"var(--radius-sm)"},formatter:(d,u)=>u==="saldo"?[`R$ ${d.toLocaleString("pt-BR")}`,"Saldo"]:d,labelFormatter:d=>d}),a.jsx(Fp,{type:"monotone",dataKey:"saldo",stroke:"var(--brand)",strokeWidth:2,fill:"var(--brand)",fillOpacity:.15})]})})}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Receita"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-success tabular-nums",children:["R$ ",i.toLocaleString("pt-BR")]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Despesa"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-danger tabular-nums",children:["R$ ",l.toLocaleString("pt-BR")]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Saldo"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-text-primary tabular-nums",children:["R$ ",c.toLocaleString("pt-BR")]})]})]})]})},jUe=({title:e,icon:t,data:r,color:n,className:s,loading:o})=>a.jsxs(Mr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group flex flex-col ${s||""}`,children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10 mr-3",style:{color:`var(--${n})`},children:a.jsx(t,{className:"h-5 w-5"})}),a.jsx("h3",{className:"text-base font-bold text-text-primary",children:e})]}),a.jsx("div",{className:"space-y-3 mt-auto",children:o?Array.from({length:3}).map((i,l)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("div",{className:"h-4 w-24 bg-white/5 rounded animate-pulse"}),a.jsx("div",{className:"h-4 w-12 bg-white/5 rounded animate-pulse"})]},l)):r.map((i,l)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:i.name}),a.jsx("span",{className:"font-bold text-text-primary tabular-nums",children:i.value})]},l))})]}),_Ue={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.1,delayChildren:.2}}},BE={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}};function NUe(){const{toast:e}=Xs(),{userProfile:t}=fo(),n=sj()?.alerts||[],s=Ol(),[o,i]=p.useState(!0),[l,c]=p.useState(0),[d,u]=p.useState({finalizados:0,total:0}),[f,h]=p.useState(0),[m,x]=p.useState(0),[g,v]=p.useState(0),[y,b]=p.useState(0),[w,j]=p.useState(0),[_,C]=p.useState(0),[A,S]=p.useState([]);p.useEffect(()=>{(async()=>{if(!t?.codigo_empresa){console.log("[DashboardPage] Aguardando autenticao..."),i(!1);return}console.log("[DashboardPage] Iniciando carregamento de dados...");try{i(!0);const I=t.codigo_empresa,T=new Date,k=Po(T).toISOString(),$=M_(T).toISOString();console.log("[Dashboard] 1. Buscando pagamentos...");const{data:q}=await Q.from("pagamentos").select("valor, status").eq("codigo_empresa",I).gte("recebido_em",k).lte("recebido_em",$);console.log("[Dashboard]  Pagamentos carregados:",q?.length||0);const z=(q||[]).filter(be=>!["Cancelado","Estornado"].includes(be.status)).reduce((be,Nt)=>be+Number(Nt.valor||0),0);console.log("[Dashboard] 2. Buscando agendamentos de hoje...");const{data:F}=await Q.from("agendamentos").select("id").eq("codigo_empresa",I).gte("inicio",k).lte("inicio",$);console.log("[Dashboard]  Agendamentos de hoje:",F?.length||0);let V=0;if(F&&F.length>0){console.log("[Dashboard] 3. Buscando participantes pagos...");const be=F.map(Wt=>Wt.id),{data:Nt}=await Q.from("agendamento_participantes").select("valor_cota, status_pagamento, aplicar_taxa, finalizadora_id, finalizadoras!agp_finalizadora_id_fkey(taxa_percentual)").eq("codigo_empresa",I).in("agendamento_id",be).eq("status_pagamento","Pago");console.log("[Dashboard]  Participantes pagos:",Nt?.length||0),V=(Nt||[]).reduce((Wt,_r)=>{let yr=Number(_r.valor_cota||0);if(_r.aplicar_taxa===!0){const ve=Number(_r.finalizadoras?.taxa_percentual||0);ve>0&&(yr=yr/(1+ve/100))}return Wt+yr},0)}const ue=z+V;c(ue),console.log("[Dashboard] 4. Buscando agendamentos completos...");const{data:_e}=await Q.from("agendamentos").select("id, status, inicio, fim").eq("codigo_empresa",I).gte("inicio",k).lte("inicio",$);console.log("[Dashboard]  Agendamentos completos:",_e?.length||0);const U=(_e||[]).filter(be=>be.status==="finished").length;u({finalizados:U,total:_e?.length||0});const L=new Date().toISOString(),G=(_e||[]).filter(be=>be.inicio>L&&!["canceled","finished"].includes(be.status)).length;h(G);const de=(_e||[]).filter(be=>be.status==="in_progress").length;x(de),console.log("[Dashboard] 5. Buscando quadras...");const{data:X}=await Q.from("quadras").select("id").eq("codigo_empresa",I);console.log("[Dashboard]  Quadras:",X?.length||0);const me=(X?.length||0)*17;let ee=0;for(const be of _e||[])if(!["canceled","no_show"].includes(be.status))if(be.inicio&&be.fim){const Nt=new Date(be.inicio),yr=(new Date(be.fim)-Nt)/(1e3*60*60);ee+=yr}else ee+=1;const ae=me>0?Math.round(ee/me*100):0;v(ae),console.log("[Dashboard] 6. Buscando comandas abertas...");const{data:le}=await Q.from("comandas").select("id").eq("codigo_empresa",I).eq("status","open");console.log("[Dashboard]  Comandas abertas:",le?.length||0),b(le?.length||0),console.log("[Dashboard] 7. Buscando mesas...");const{data:Te}=await Q.from("mesas").select("id, status").eq("codigo_empresa",I);console.log("[Dashboard]  Mesas:",Te?.length||0);const te=(Te||[]).filter(be=>["in-use","awaiting-payment"].includes(be.status)).length;j(te),console.log("[Dashboard] 8. Buscando vendas da loja...");const{data:ie}=await Q.from("comandas").select("id").eq("codigo_empresa",I).eq("status","closed").gte("fechado_em",k).lte("fechado_em",$);console.log("[Dashboard]  Vendas da loja:",ie?.length||0),C(ie?.length||0),console.log("[Dashboard] 9. Buscando dados dos ltimos 14 dias...");const xt=new Date;xt.setDate(xt.getDate()-13);const vt=Po(xt).toISOString(),dt=M_(T).toISOString(),{data:St}=await Q.from("pagamentos").select("valor, status, recebido_em").eq("codigo_empresa",I).gte("recebido_em",vt).lte("recebido_em",dt);console.log("[Dashboard]  Pagamentos 14 dias:",St?.length||0);const{data:ft}=await Q.from("agendamentos").select("id, inicio").eq("codigo_empresa",I).gte("inicio",vt).lte("inicio",dt);console.log("[Dashboard]  Agendamentos 14 dias:",ft?.length||0);let _t=[];if(ft&&ft.length>0){const be=ft.map(Wt=>Wt.id),{data:Nt}=await Q.from("agendamento_participantes").select("valor_cota, agendamento_id").eq("codigo_empresa",I).in("agendamento_id",be).eq("status_pagamento","Pago");_t=Nt||[],console.log("[Dashboard]  Participantes pagos 14 dias:",_t.length)}const gr=[];for(let be=13;be>=0;be--){const Nt=new Date;Nt.setDate(Nt.getDate()-be);const Wt=Po(Nt),_r=M_(Nt),yr=(St||[]).filter($t=>{const De=new Date($t.recebido_em);return De>=Wt&&De<=_r&&!["Cancelado","Estornado"].includes($t.status)}).reduce(($t,De)=>$t+Number(De.valor||0),0),ve=(ft||[]).filter($t=>{const De=new Date($t.inicio);return De>=Wt&&De<=_r}).map($t=>$t.id),at=_t.filter($t=>ve.includes($t.agendamento_id)).reduce(($t,De)=>$t+Number(De.valor_cota||0),0),qt=yr+at;gr.push({name:be===0?"Hoje":`${be}d`,saldo:Math.round(qt),receita:Math.round(qt),despesa:0})}console.log("[Dashboard]  Dados de 14 dias carregados"),S(gr)}catch(I){console.error("[DashboardPage]  Erro ao carregar dashboard:",I),e({title:"Erro ao carregar dashboard",description:I?.message||"Tente recarregar a pgina",variant:"destructive"})}finally{console.log("[DashboardPage]  Carregamento concludo"),i(!1)}})()},[t?.codigo_empresa]);const P=O=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(O||0)),M=[{name:"Comandas Abertas",value:y},{name:"Mesas Ocupadas",value:w},{name:"Vendas Hoje",value:_}];return a.jsx(a.Fragment,{children:a.jsxs(Mr.div,{variants:_Ue,initial:"hidden",animate:"visible",className:"space-y-4",children:[a.jsxs(Mr.div,{variants:BE,className:"relative grid grid-cols-1 xl:grid-cols-12 gap-4 items-start",children:[a.jsx("div",{className:"xl:col-span-8",children:a.jsxs("div",{className:"bg-surface/70 backdrop-blur-sm relative p-4 rounded-xl border border-white/10 overflow-hidden shadow-1",children:[a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.03] mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 max-w-[720px]",children:[a.jsxs("h1",{className:"text-3xl font-black mb-2 text-text-primary tracking-tighter",children:["Bem-vindo de volta, ",a.jsxs("span",{className:"text-brand",children:[(t?.nome_exibicao||t?.nome||t?.email?.split("@")[0]||"Admin").split(" ")[0],"!"]})]}),a.jsx("p",{className:"text-text-secondary mb-3 max-w-[60ch] text-sm md:text-base font-normal",children:"Sua central de comando para uma gesto de sucesso. Monitore agendamentos, faturamento e clientes em um s lugar."}),a.jsxs("div",{className:"flex flex-wrap gap-2.5",children:[a.jsxs(Z,{onClick:()=>s("/agenda",{state:{openModal:!0}}),size:"default",children:[a.jsx(J4,{className:"mr-2 h-4 w-4"}),"+ Agendamento"]}),a.jsxs(Z,{onClick:()=>s("/clientes",{state:{openModal:!0}}),variant:"outline",size:"default",children:[a.jsx(vc,{className:"mr-2 h-4 w-4"}),"Adicionar Cliente"]})]})]})]})}),a.jsx("div",{className:"xl:col-span-4",children:a.jsxs("div",{className:"fx-card",children:[a.jsxs("h2",{className:"text-lg font-bold text-text-primary mb-3 flex items-center",children:[a.jsx(xu,{className:"mr-2 h-5 w-5 text-brand"})," Resumo do Dia"]}),a.jsxs("ul",{className:"space-y-2 text-sm",children:[a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Prximas Reservas"}),o?a.jsx("div",{className:"h-6 w-12 bg-white/5 rounded animate-pulse"}):a.jsx("span",{className:"font-bold text-text-primary tabular-nums",children:f})]}),a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Quadras em Uso"}),o?a.jsx("div",{className:"h-6 w-12 bg-white/5 rounded animate-pulse"}):a.jsx("span",{className:"font-bold text-success tabular-nums",children:m})]}),a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Taxa de Ocupao"}),o?a.jsx("div",{className:"h-6 w-16 bg-white/5 rounded animate-pulse"}):a.jsxs("span",{className:`font-bold tabular-nums ${g>=70?"text-success":g>=40?"text-warning":"text-danger"}`,children:[g,"%"]})]})]})]})})]}),a.jsxs(Mr.div,{variants:BE,className:"relative grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-12 gap-4 items-stretch",children:[a.jsx("div",{className:"xl:col-span-3",children:a.jsx(Mz,{icon:Vi,title:"Faturamento do Dia",value:P(l),color:"success",className:"h-full",loading:o})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(Mz,{icon:zC,title:"Agend. Finalizados",value:`${d.finalizados} de ${d.total}`,color:"info",className:"h-full",loading:o})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(bUe,{className:"h-full",alerts:n})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(jUe,{icon:eD,title:"Informaes da Loja",data:M,color:"purple",className:"h-full",loading:o})})]}),a.jsx(Mr.div,{variants:BE,className:"grid grid-cols-1 gap-4",children:a.jsx(wUe,{icon:$m,title:"Resumo Financeiro",data:A,color:"brand",loading:o})})]})})}var SUe={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 ms",other:"cerca de {{count}} meses"},xMonths:{one:"1 ms",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},CUe=function(t,r,n){var s,o=SUe[t];return typeof o=="string"?s=o:r===1?s=o.one:s=o.other.replace("{{count}}",String(r)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"em "+s:"h "+s:s};const PUe=CUe;var AUe={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},EUe={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},kUe={full:"{{date}} 's' {{time}}",long:"{{date}} 's' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},IUe={date:Gv({formats:AUe,defaultWidth:"full"}),time:Gv({formats:EUe,defaultWidth:"full"}),dateTime:Gv({formats:kUe,defaultWidth:"full"})};const OUe=IUe;var TUe={lastWeek:function(t){var r=t.getUTCDay(),n=r===0||r===6?"ltimo":"ltima";return"'"+n+"' eeee 's' p"},yesterday:"'ontem s' p",today:"'hoje s' p",tomorrow:"'amanh s' p",nextWeek:"eeee 's' p",other:"P"},DUe=function(t,r,n,s){var o=TUe[t];return typeof o=="function"?o(r):o};const MUe=DUe;var RUe={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},FUe={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},LUe={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},$Ue={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","tera","quarta","quinta","sexta","sbado"],wide:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"]},BUe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"}},qUe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},zUe=function(t,r){var n=Number(t);return r?.unit==="week"?n+"":n+""},UUe={ordinalNumber:zUe,era:kf({values:RUe,defaultWidth:"wide"}),quarter:kf({values:FUe,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:kf({values:LUe,defaultWidth:"wide"}),day:kf({values:$Ue,defaultWidth:"wide"}),dayPeriod:kf({values:BUe,defaultWidth:"wide",formattingValues:qUe,defaultFormattingWidth:"wide"})};const VUe=UUe;var WUe=/^(\d+)[o]?/i,HUe=/\d+/i,GUe={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},KUe={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},XUe={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},YUe={any:[/1/i,/2/i,/3/i,/4/i]},JUe={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|maro|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},QUe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},ZUe={narrow:/^(dom|[23456]?|s[a]b)/i,short:/^(dom|[23456]?|s[a]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a]b)/i,wide:/^(domingo|(segunda|ter[c]a|quarta|quinta|sexta)([- ]feira)?|s[a]bado)/i},eVe={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a]b/i]},tVe={narrow:/^(a|p|mn|md|(da) (manh|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh|tarde|noite))/i},rVe={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},nVe={ordinalNumber:UY({matchPattern:WUe,parsePattern:HUe,valueCallback:function(t){return parseInt(t,10)}}),era:If({matchPatterns:GUe,defaultMatchWidth:"wide",parsePatterns:KUe,defaultParseWidth:"any"}),quarter:If({matchPatterns:XUe,defaultMatchWidth:"wide",parsePatterns:YUe,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:If({matchPatterns:JUe,defaultMatchWidth:"wide",parsePatterns:QUe,defaultParseWidth:"any"}),day:If({matchPatterns:ZUe,defaultMatchWidth:"wide",parsePatterns:eVe,defaultParseWidth:"any"}),dayPeriod:If({matchPatterns:tVe,defaultMatchWidth:"any",parsePatterns:rVe,defaultParseWidth:"any"})};const aVe=nVe;var sVe={code:"pt-BR",formatDistance:PUe,formatLong:OUe,formatRelative:MUe,localize:VUe,match:aVe,options:{weekStartsOn:0,firstWeekContainsDate:1}};const Da=sVe;var ts=function(){return ts=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},ts.apply(this,arguments)};function oVe(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Vee(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function hj(e){return e.mode==="multiple"}function pj(e){return e.mode==="range"}function lP(e){return e.mode==="single"}var iVe={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function lVe(e,t){return or(e,"LLLL y",t)}function cVe(e,t){return or(e,"d",t)}function dVe(e,t){return or(e,"LLLL",t)}function uVe(e){return"".concat(e)}function fVe(e,t){return or(e,"cccccc",t)}function mVe(e,t){return or(e,"yyyy",t)}var hVe=Object.freeze({__proto__:null,formatCaption:lVe,formatDay:cVe,formatMonthCaption:dVe,formatWeekNumber:uVe,formatWeekdayName:fVe,formatYearCaption:mVe}),pVe=function(e,t,r){return or(e,"do MMMM (EEEE)",r)},gVe=function(){return"Month: "},xVe=function(){return"Go to next month"},vVe=function(){return"Go to previous month"},yVe=function(e,t){return or(e,"cccc",t)},bVe=function(e){return"Week n. ".concat(e)},wVe=function(){return"Year: "},jVe=Object.freeze({__proto__:null,labelDay:pVe,labelMonthDropdown:gVe,labelNext:xVe,labelPrevious:vVe,labelWeekNumber:bVe,labelWeekday:yVe,labelYearDropdown:wVe});function _Ve(){var e="buttons",t=iVe,r=VY,n={},s={},o=1,i={},l=new Date;return{captionLayout:e,classNames:t,formatters:hVe,labels:jVe,locale:r,modifiersClassNames:n,modifiers:s,numberOfMonths:o,styles:i,today:l,mode:"default"}}function NVe(e){var t=e.fromYear,r=e.toYear,n=e.fromMonth,s=e.toMonth,o=e.fromDate,i=e.toDate;return n?o=Cc(n):t&&(o=new Date(t,0,1)),s?i=h5(s):r&&(i=new Date(r,11,31)),{fromDate:o?Po(o):void 0,toDate:i?Po(i):void 0}}var Wee=p.createContext(void 0);function SVe(e){var t,r=e.initialProps,n=_Ve(),s=NVe(r),o=s.fromDate,i=s.toDate,l=(t=r.captionLayout)!==null&&t!==void 0?t:n.captionLayout;l!=="buttons"&&(!o||!i)&&(l="buttons");var c;(lP(r)||hj(r)||pj(r))&&(c=r.onSelect);var d=ts(ts(ts({},n),r),{captionLayout:l,classNames:ts(ts({},n.classNames),r.classNames),components:ts({},r.components),formatters:ts(ts({},n.formatters),r.formatters),fromDate:o,labels:ts(ts({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:ts(ts({},n.modifiers),r.modifiers),modifiersClassNames:ts(ts({},n.modifiersClassNames),r.modifiersClassNames),onSelect:c,styles:ts(ts({},n.styles),r.styles),toDate:i});return a.jsx(Wee.Provider,{value:d,children:e.children})}function To(){var e=p.useContext(Wee);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function Hee(e){var t=To(),r=t.locale,n=t.classNames,s=t.styles,o=t.formatters.formatCaption;return a.jsx("div",{className:n.caption_label,style:s.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:r})})}function CVe(e){return a.jsx("svg",ts({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:a.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Gee(e){var t,r,n=e.onChange,s=e.value,o=e.children,i=e.caption,l=e.className,c=e.style,d=To(),u=(r=(t=d.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:CVe;return a.jsxs("div",{className:l,style:c,children:[a.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),a.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:s,onChange:n,children:o}),a.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[i,a.jsx(u,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function PVe(e){var t,r=To(),n=r.fromDate,s=r.toDate,o=r.styles,i=r.locale,l=r.formatters.formatMonthCaption,c=r.classNames,d=r.components,u=r.labels.labelMonthDropdown;if(!n)return a.jsx(a.Fragment,{});if(!s)return a.jsx(a.Fragment,{});var f=[];if(mje(n,s))for(var h=Cc(n),m=n.getMonth();m<=s.getMonth();m++)f.push(dE(h,m));else for(var h=Cc(new Date),m=0;m<=11;m++)f.push(dE(h,m));var x=function(v){var y=Number(v.target.value),b=dE(Cc(e.displayMonth),y);e.onChange(b)},g=(t=d?.Dropdown)!==null&&t!==void 0?t:Gee;return a.jsx(g,{name:"months","aria-label":u(),className:c.dropdown_month,style:o.dropdown_month,onChange:x,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:f.map(function(v){return a.jsx("option",{value:v.getMonth(),children:l(v,{locale:i})},v.getMonth())})})}function AVe(e){var t,r=e.displayMonth,n=To(),s=n.fromDate,o=n.toDate,i=n.locale,l=n.styles,c=n.classNames,d=n.components,u=n.formatters.formatYearCaption,f=n.labels.labelYearDropdown,h=[];if(!s)return a.jsx(a.Fragment,{});if(!o)return a.jsx(a.Fragment,{});for(var m=s.getFullYear(),x=o.getFullYear(),g=m;g<=x;g++)h.push(v8(Uwe(new Date),g));var v=function(b){var w=v8(Cc(r),Number(b.target.value));e.onChange(w)},y=(t=d?.Dropdown)!==null&&t!==void 0?t:Gee;return a.jsx(y,{name:"years","aria-label":f(),className:c.dropdown_year,style:l.dropdown_year,onChange:v,value:r.getFullYear(),caption:u(r,{locale:i}),children:h.map(function(b){return a.jsx("option",{value:b.getFullYear(),children:u(b,{locale:i})},b.getFullYear())})})}function EVe(e,t){var r=p.useState(e),n=r[0],s=r[1],o=t===void 0?n:t;return[o,s]}function kVe(e){var t=e.month,r=e.defaultMonth,n=e.today,s=t||r||n||new Date,o=e.toDate,i=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(o&&zw(o,s)<0){var d=-1*(c-1);s=df(o,d)}return i&&zw(s,i)<0&&(s=i),Cc(s)}function IVe(){var e=To(),t=kVe(e),r=EVe(t,e.month),n=r[0],s=r[1],o=function(i){var l;if(!e.disableNavigation){var c=Cc(i);s(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[n,o]}function OVe(e,t){for(var r=t.reverseMonths,n=t.numberOfMonths,s=Cc(e),o=Cc(df(s,n)),i=zw(o,s),l=[],c=0;c<i;c++){var d=df(s,c);l.push(d)}return r&&(l=l.reverse()),l}function TVe(e,t){if(!t.disableNavigation){var r=t.toDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=n?o:1,l=Cc(e);if(!r)return df(l,i);var c=zw(r,e);if(!(c<o))return df(l,i)}}function DVe(e,t){if(!t.disableNavigation){var r=t.fromDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=n?o:1,l=Cc(e);if(!r)return df(l,-i);var c=zw(l,r);if(!(c<=0))return df(l,-i)}}var Kee=p.createContext(void 0);function MVe(e){var t=To(),r=IVe(),n=r[0],s=r[1],o=OVe(n,t),i=TVe(n,t),l=DVe(n,t),c=function(f){return o.some(function(h){return eM(f,h)})},d=function(f,h){c(f)||(h&&WY(f,h)?s(df(f,1+t.numberOfMonths*-1)):s(f))},u={currentMonth:n,displayMonths:o,goToMonth:s,goToDate:d,previousMonth:l,nextMonth:i,isDateDisplayed:c};return a.jsx(Kee.Provider,{value:u,children:e.children})}function gj(){var e=p.useContext(Kee);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function Rz(e){var t,r=To(),n=r.classNames,s=r.styles,o=r.components,i=gj().goToMonth,l=function(u){i(df(u,e.displayIndex?-e.displayIndex:0))},c=(t=o?.CaptionLabel)!==null&&t!==void 0?t:Hee,d=a.jsx(c,{id:e.id,displayMonth:e.displayMonth});return a.jsxs("div",{className:n.caption_dropdowns,style:s.caption_dropdowns,children:[a.jsx("div",{className:n.vhidden,children:d}),a.jsx(PVe,{onChange:l,displayMonth:e.displayMonth}),a.jsx(AVe,{onChange:l,displayMonth:e.displayMonth})]})}function RVe(e){return a.jsx("svg",ts({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:a.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function FVe(e){return a.jsx("svg",ts({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:a.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var HS=p.forwardRef(function(e,t){var r=To(),n=r.classNames,s=r.styles,o=[n.button_reset,n.button];e.className&&o.push(e.className);var i=o.join(" "),l=ts(ts({},s.button_reset),s.button);return e.style&&Object.assign(l,e.style),a.jsx("button",ts({},e,{ref:t,type:"button",className:i,style:l}))});function LVe(e){var t,r,n=To(),s=n.dir,o=n.locale,i=n.classNames,l=n.styles,c=n.labels,d=c.labelPrevious,u=c.labelNext,f=n.components;if(!e.nextMonth&&!e.previousMonth)return a.jsx(a.Fragment,{});var h=d(e.previousMonth,{locale:o}),m=[i.nav_button,i.nav_button_previous].join(" "),x=u(e.nextMonth,{locale:o}),g=[i.nav_button,i.nav_button_next].join(" "),v=(t=f?.IconRight)!==null&&t!==void 0?t:FVe,y=(r=f?.IconLeft)!==null&&r!==void 0?r:RVe;return a.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&a.jsx(HS,{name:"previous-month","aria-label":h,className:m,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:s==="rtl"?a.jsx(v,{className:i.nav_icon,style:l.nav_icon}):a.jsx(y,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&a.jsx(HS,{name:"next-month","aria-label":x,className:g,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:s==="rtl"?a.jsx(y,{className:i.nav_icon,style:l.nav_icon}):a.jsx(v,{className:i.nav_icon,style:l.nav_icon})})]})}function Fz(e){var t=To().numberOfMonths,r=gj(),n=r.previousMonth,s=r.nextMonth,o=r.goToMonth,i=r.displayMonths,l=i.findIndex(function(x){return eM(e.displayMonth,x)}),c=l===0,d=l===i.length-1,u=t>1&&(c||!d),f=t>1&&(d||!c),h=function(){n&&o(n)},m=function(){s&&o(s)};return a.jsx(LVe,{displayMonth:e.displayMonth,hideNext:u,hidePrevious:f,nextMonth:s,previousMonth:n,onPreviousClick:h,onNextClick:m})}function $Ve(e){var t,r=To(),n=r.classNames,s=r.disableNavigation,o=r.styles,i=r.captionLayout,l=r.components,c=(t=l?.CaptionLabel)!==null&&t!==void 0?t:Hee,d;return s?d=a.jsx(c,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?d=a.jsx(Rz,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?d=a.jsxs(a.Fragment,{children:[a.jsx(Rz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),a.jsx(Fz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):d=a.jsxs(a.Fragment,{children:[a.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),a.jsx(Fz,{displayMonth:e.displayMonth,id:e.id})]}),a.jsx("div",{className:n.caption,style:o.caption,children:d})}function BVe(e){var t=To(),r=t.footer,n=t.styles,s=t.classNames.tfoot;return r?a.jsx("tfoot",{className:s,style:n.tfoot,children:a.jsx("tr",{children:a.jsx("td",{colSpan:8,children:r})})}):a.jsx(a.Fragment,{})}function qVe(e,t,r){for(var n=r?ex(new Date):_u(new Date,{locale:e,weekStartsOn:t}),s=[],o=0;o<7;o++){var i=Ss(n,o);s.push(i)}return s}function zVe(){var e=To(),t=e.classNames,r=e.styles,n=e.showWeekNumber,s=e.locale,o=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=qVe(s,o,i);return a.jsxs("tr",{style:r.head_row,className:t.head_row,children:[n&&a.jsx("td",{style:r.head_cell,className:t.head_cell}),d.map(function(u,f){return a.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":c(u,{locale:s}),children:l(u,{locale:s})},f)})]})}function UVe(){var e,t=To(),r=t.classNames,n=t.styles,s=t.components,o=(e=s?.HeadRow)!==null&&e!==void 0?e:zVe;return a.jsx("thead",{style:n.head,className:r.head,children:a.jsx(o,{})})}function VVe(e){var t=To(),r=t.locale,n=t.formatters.formatDay;return a.jsx(a.Fragment,{children:n(e.date,{locale:r})})}var cR=p.createContext(void 0);function WVe(e){if(!hj(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return a.jsx(cR.Provider,{value:t,children:e.children})}return a.jsx(HVe,{initialProps:e.initialProps,children:e.children})}function HVe(e){var t=e.initialProps,r=e.children,n=t.selected,s=t.min,o=t.max,i=function(d,u,f){var h,m;(h=t.onDayClick)===null||h===void 0||h.call(t,d,u,f);var x=!!(u.selected&&s&&n?.length===s);if(!x){var g=!!(!u.selected&&o&&n?.length===o);if(!g){var v=n?Vee([],n,!0):[];if(u.selected){var y=v.findIndex(function(b){return Ql(d,b)});v.splice(y,1)}else v.push(d);(m=t.onSelect)===null||m===void 0||m.call(t,v,d,u,f)}}},l={disabled:[]};n&&l.disabled.push(function(d){var u=o&&n.length>o-1,f=n.some(function(h){return Ql(h,d)});return!!(u&&!f)});var c={selected:n,onDayClick:i,modifiers:l};return a.jsx(cR.Provider,{value:c,children:r})}function dR(){var e=p.useContext(cR);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function GVe(e,t){var r=t||{},n=r.from,s=r.to;return n&&s?Ql(s,e)&&Ql(n,e)?void 0:Ql(s,e)?{from:s,to:void 0}:Ql(n,e)?void 0:jO(n,e)?{from:e,to:s}:{from:n,to:e}:s?jO(e,s)?{from:s,to:e}:{from:e,to:s}:n?WY(e,n)?{from:e,to:n}:{from:n,to:e}:{from:e,to:void 0}}var uR=p.createContext(void 0);function KVe(e){if(!pj(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return a.jsx(uR.Provider,{value:t,children:e.children})}return a.jsx(XVe,{initialProps:e.initialProps,children:e.children})}function XVe(e){var t=e.initialProps,r=e.children,n=t.selected,s=n||{},o=s.from,i=s.to,l=t.min,c=t.max,d=function(m,x,g){var v,y;(v=t.onDayClick)===null||v===void 0||v.call(t,m,x,g);var b=GVe(m,n);(y=t.onSelect)===null||y===void 0||y.call(t,b,m,x,g)},u={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(u.range_start=[o],i?(u.range_end=[i],Ql(o,i)||(u.range_middle=[{after:o,before:i}])):u.range_end=[o]):i&&(u.range_start=[i],u.range_end=[i]),l&&(o&&!i&&u.disabled.push({after:Kv(o,l-1),before:Ss(o,l-1)}),o&&i&&u.disabled.push({after:o,before:Ss(o,l-1)}),!o&&i&&u.disabled.push({after:Kv(i,l-1),before:Ss(i,l-1)})),c){if(o&&!i&&(u.disabled.push({before:Ss(o,-c+1)}),u.disabled.push({after:Ss(o,c-1)})),o&&i){var f=Mf(i,o)+1,h=c-f;u.disabled.push({before:Kv(o,h)}),u.disabled.push({after:Ss(i,h)})}!o&&i&&(u.disabled.push({before:Ss(i,-c+1)}),u.disabled.push({after:Ss(i,c-1)}))}return a.jsx(uR.Provider,{value:{selected:n,onDayClick:d,modifiers:u},children:r})}function fR(){var e=p.useContext(uR);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function F_(e){return Array.isArray(e)?Vee([],e,!0):e!==void 0?[e]:[]}function YVe(e){var t={};return Object.entries(e).forEach(function(r){var n=r[0],s=r[1];t[n]=F_(s)}),t}var uf;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(uf||(uf={}));var JVe=uf.Selected,lm=uf.Disabled,QVe=uf.Hidden,ZVe=uf.Today,qE=uf.RangeEnd,zE=uf.RangeMiddle,UE=uf.RangeStart,eWe=uf.Outside;function tWe(e,t,r){var n,s=(n={},n[JVe]=F_(e.selected),n[lm]=F_(e.disabled),n[QVe]=F_(e.hidden),n[ZVe]=[e.today],n[qE]=[],n[zE]=[],n[UE]=[],n[eWe]=[],n);return e.fromDate&&s[lm].push({before:e.fromDate}),e.toDate&&s[lm].push({after:e.toDate}),hj(e)?s[lm]=s[lm].concat(t.modifiers[lm]):pj(e)&&(s[lm]=s[lm].concat(r.modifiers[lm]),s[UE]=r.modifiers[UE],s[zE]=r.modifiers[zE],s[qE]=r.modifiers[qE]),s}var Xee=p.createContext(void 0);function rWe(e){var t=To(),r=dR(),n=fR(),s=tWe(t,r,n),o=YVe(t.modifiers),i=ts(ts({},s),o);return a.jsx(Xee.Provider,{value:i,children:e.children})}function Yee(){var e=p.useContext(Xee);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function nWe(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function aWe(e){return!!(e&&typeof e=="object"&&"from"in e)}function sWe(e){return!!(e&&typeof e=="object"&&"after"in e)}function oWe(e){return!!(e&&typeof e=="object"&&"before"in e)}function iWe(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function lWe(e,t){var r,n=t.from,s=t.to;if(n&&s){var o=Mf(s,n)<0;o&&(r=[s,n],n=r[0],s=r[1]);var i=Mf(e,n)>=0&&Mf(s,e)>=0;return i}return s?Ql(s,e):n?Ql(n,e):!1}function cWe(e){return QD(e)}function dWe(e){return Array.isArray(e)&&e.every(QD)}function uWe(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(cWe(r))return Ql(e,r);if(dWe(r))return r.includes(e);if(aWe(r))return lWe(e,r);if(iWe(r))return r.dayOfWeek.includes(e.getDay());if(nWe(r)){var n=Mf(r.before,e),s=Mf(r.after,e),o=n>0,i=s<0,l=jO(r.before,r.after);return l?i&&o:o||i}return sWe(r)?Mf(e,r.after)>0:oWe(r)?Mf(r.before,e)>0:typeof r=="function"?r(e):!1})}function mR(e,t,r){var n=Object.keys(t).reduce(function(o,i){var l=t[i];return uWe(e,l)&&o.push(i),o},[]),s={};return n.forEach(function(o){return s[o]=!0}),r&&!eM(e,r)&&(s.outside=!0),s}function fWe(e,t){for(var r=Cc(e[0]),n=h5(e[e.length-1]),s,o,i=r;i<=n;){var l=mR(i,t),c=!l.disabled&&!l.hidden;if(!c){i=Ss(i,1);continue}if(l.selected)return i;l.today&&!o&&(o=i),s||(s=i),i=Ss(i,1)}return o||s}var mWe=365;function Jee(e,t){var r=t.moveBy,n=t.direction,s=t.context,o=t.modifiers,i=t.retry,l=i===void 0?{count:0,lastFocused:e}:i,c=s.weekStartsOn,d=s.fromDate,u=s.toDate,f=s.locale,h={day:Ss,week:wO,month:df,year:Rwe,startOfWeek:function(v){return s.ISOWeek?ex(v):_u(v,{locale:f,weekStartsOn:c})},endOfWeek:function(v){return s.ISOWeek?$Y(v):ZD(v,{locale:f,weekStartsOn:c})}},m=h[r](e,n==="after"?1:-1);n==="before"&&d?m=Fwe([d,m]):n==="after"&&u&&(m=Lwe([u,m]));var x=!0;if(o){var g=mR(m,o);x=!g.disabled&&!g.hidden}return x?m:l.count>mWe?l.lastFocused:Jee(m,{moveBy:r,direction:n,context:s,modifiers:o,retry:ts(ts({},l),{count:l.count+1})})}var Qee=p.createContext(void 0);function hWe(e){var t=gj(),r=Yee(),n=p.useState(),s=n[0],o=n[1],i=p.useState(),l=i[0],c=i[1],d=fWe(t.displayMonths,r),u=s??(l&&t.isDateDisplayed(l))?l:d,f=function(){c(s),o(void 0)},h=function(v){o(v)},m=To(),x=function(v,y){if(s){var b=Jee(s,{moveBy:v,direction:y,context:m,modifiers:r});Ql(s,b)||(t.goToDate(b,s),h(b))}},g={focusedDay:s,focusTarget:u,blur:f,focus:h,focusDayAfter:function(){return x("day","after")},focusDayBefore:function(){return x("day","before")},focusWeekAfter:function(){return x("week","after")},focusWeekBefore:function(){return x("week","before")},focusMonthBefore:function(){return x("month","before")},focusMonthAfter:function(){return x("month","after")},focusYearBefore:function(){return x("year","before")},focusYearAfter:function(){return x("year","after")},focusStartOfWeek:function(){return x("startOfWeek","before")},focusEndOfWeek:function(){return x("endOfWeek","after")}};return a.jsx(Qee.Provider,{value:g,children:e.children})}function hR(){var e=p.useContext(Qee);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function pWe(e,t){var r=Yee(),n=mR(e,r,t);return n}var pR=p.createContext(void 0);function gWe(e){if(!lP(e.initialProps)){var t={selected:void 0};return a.jsx(pR.Provider,{value:t,children:e.children})}return a.jsx(xWe,{initialProps:e.initialProps,children:e.children})}function xWe(e){var t=e.initialProps,r=e.children,n=function(o,i,l){var c,d,u;if((c=t.onDayClick)===null||c===void 0||c.call(t,o,i,l),i.selected&&!t.required){(d=t.onSelect)===null||d===void 0||d.call(t,void 0,o,i,l);return}(u=t.onSelect)===null||u===void 0||u.call(t,o,o,i,l)},s={selected:t.selected,onDayClick:n};return a.jsx(pR.Provider,{value:s,children:r})}function Zee(){var e=p.useContext(pR);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function vWe(e,t){var r=To(),n=Zee(),s=dR(),o=fR(),i=hR(),l=i.focusDayAfter,c=i.focusDayBefore,d=i.focusWeekAfter,u=i.focusWeekBefore,f=i.blur,h=i.focus,m=i.focusMonthBefore,x=i.focusMonthAfter,g=i.focusYearBefore,v=i.focusYearAfter,y=i.focusStartOfWeek,b=i.focusEndOfWeek,w=function(z){var F,V,ue,_e;lP(r)?(F=n.onDayClick)===null||F===void 0||F.call(n,e,t,z):hj(r)?(V=s.onDayClick)===null||V===void 0||V.call(s,e,t,z):pj(r)?(ue=o.onDayClick)===null||ue===void 0||ue.call(o,e,t,z):(_e=r.onDayClick)===null||_e===void 0||_e.call(r,e,t,z)},j=function(z){var F;h(e),(F=r.onDayFocus)===null||F===void 0||F.call(r,e,t,z)},_=function(z){var F;f(),(F=r.onDayBlur)===null||F===void 0||F.call(r,e,t,z)},C=function(z){var F;(F=r.onDayMouseEnter)===null||F===void 0||F.call(r,e,t,z)},A=function(z){var F;(F=r.onDayMouseLeave)===null||F===void 0||F.call(r,e,t,z)},S=function(z){var F;(F=r.onDayPointerEnter)===null||F===void 0||F.call(r,e,t,z)},P=function(z){var F;(F=r.onDayPointerLeave)===null||F===void 0||F.call(r,e,t,z)},M=function(z){var F;(F=r.onDayTouchCancel)===null||F===void 0||F.call(r,e,t,z)},O=function(z){var F;(F=r.onDayTouchEnd)===null||F===void 0||F.call(r,e,t,z)},I=function(z){var F;(F=r.onDayTouchMove)===null||F===void 0||F.call(r,e,t,z)},T=function(z){var F;(F=r.onDayTouchStart)===null||F===void 0||F.call(r,e,t,z)},k=function(z){var F;(F=r.onDayKeyUp)===null||F===void 0||F.call(r,e,t,z)},$=function(z){var F;switch(z.key){case"ArrowLeft":z.preventDefault(),z.stopPropagation(),r.dir==="rtl"?l():c();break;case"ArrowRight":z.preventDefault(),z.stopPropagation(),r.dir==="rtl"?c():l();break;case"ArrowDown":z.preventDefault(),z.stopPropagation(),d();break;case"ArrowUp":z.preventDefault(),z.stopPropagation(),u();break;case"PageUp":z.preventDefault(),z.stopPropagation(),z.shiftKey?g():m();break;case"PageDown":z.preventDefault(),z.stopPropagation(),z.shiftKey?v():x();break;case"Home":z.preventDefault(),z.stopPropagation(),y();break;case"End":z.preventDefault(),z.stopPropagation(),b();break}(F=r.onDayKeyDown)===null||F===void 0||F.call(r,e,t,z)},q={onClick:w,onFocus:j,onBlur:_,onKeyDown:$,onKeyUp:k,onMouseEnter:C,onMouseLeave:A,onPointerEnter:S,onPointerLeave:P,onTouchCancel:M,onTouchEnd:O,onTouchMove:I,onTouchStart:T};return q}function yWe(){var e=To(),t=Zee(),r=dR(),n=fR(),s=lP(e)?t.selected:hj(e)?r.selected:pj(e)?n.selected:void 0;return s}function bWe(e){return Object.values(uf).includes(e)}function wWe(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(n){var s=e.modifiersClassNames[n];if(s)r.push(s);else if(bWe(n)){var o=e.classNames["day_".concat(n)];o&&r.push(o)}}),r}function jWe(e,t){var r=ts({},e.styles.day);return Object.keys(t).forEach(function(n){var s;r=ts(ts({},r),(s=e.modifiersStyles)===null||s===void 0?void 0:s[n])}),r}function _We(e,t,r){var n,s,o,i=To(),l=hR(),c=pWe(e,t),d=vWe(e,c),u=yWe(),f=!!(i.onDayClick||i.mode!=="default");p.useEffect(function(){var C;c.outside||l.focusedDay&&f&&Ql(l.focusedDay,e)&&((C=r.current)===null||C===void 0||C.focus())},[l.focusedDay,e,r,f,c.outside]);var h=wWe(i,c).join(" "),m=jWe(i,c),x=!!(c.outside&&!i.showOutsideDays||c.hidden),g=(o=(s=i.components)===null||s===void 0?void 0:s.DayContent)!==null&&o!==void 0?o:VVe,v=a.jsx(g,{date:e,displayMonth:t,activeModifiers:c}),y={style:m,className:h,children:v,role:"gridcell"},b=l.focusTarget&&Ql(l.focusTarget,e)&&!c.outside,w=l.focusedDay&&Ql(l.focusedDay,e),j=ts(ts(ts({},y),(n={disabled:c.disabled,role:"gridcell"},n["aria-selected"]=c.selected,n.tabIndex=w||b?0:-1,n)),d),_={isButton:f,isHidden:x,activeModifiers:c,selectedDays:u,buttonProps:j,divProps:y};return _}function NWe(e){var t=p.useRef(null),r=_We(e.date,e.displayMonth,t);return r.isHidden?a.jsx("div",{role:"gridcell"}):r.isButton?a.jsx(HS,ts({name:"day",ref:t},r.buttonProps)):a.jsx("div",ts({},r.divProps))}function SWe(e){var t=e.number,r=e.dates,n=To(),s=n.onWeekNumberClick,o=n.styles,i=n.classNames,l=n.locale,c=n.labels.labelWeekNumber,d=n.formatters.formatWeekNumber,u=d(Number(t),{locale:l});if(!s)return a.jsx("span",{className:i.weeknumber,style:o.weeknumber,children:u});var f=c(Number(t),{locale:l}),h=function(m){s(t,r,m)};return a.jsx(HS,{name:"week-number","aria-label":f,className:i.weeknumber,style:o.weeknumber,onClick:h,children:u})}function CWe(e){var t,r,n=To(),s=n.styles,o=n.classNames,i=n.showWeekNumber,l=n.components,c=(t=l?.Day)!==null&&t!==void 0?t:NWe,d=(r=l?.WeekNumber)!==null&&r!==void 0?r:SWe,u;return i&&(u=a.jsx("td",{className:o.cell,style:s.cell,children:a.jsx(d,{number:e.weekNumber,dates:e.dates})})),a.jsxs("tr",{className:o.row,style:s.row,children:[u,e.dates.map(function(f){return a.jsx("td",{className:o.cell,style:s.cell,role:"presentation",children:a.jsx(c,{displayMonth:e.displayMonth,date:f})},rje(f))})]})}function Lz(e,t,r){for(var n=r?.ISOWeek?$Y(t):ZD(t,r),s=r?.ISOWeek?ex(e):_u(e,r),o=Mf(n,s),i=[],l=0;l<=o;l++)i.push(Ss(s,l));var c=i.reduce(function(d,u){var f=r?.ISOWeek?eje(u):oje(u,r),h=d.find(function(m){return m.weekNumber===f});return h?(h.dates.push(u),d):(d.push({weekNumber:f,dates:[u]}),d)},[]);return c}function PWe(e,t){var r=Lz(Cc(e),h5(e),t);if(t?.useFixedWeeks){var n=lje(e,t);if(n<6){var s=r[r.length-1],o=s.dates[s.dates.length-1],i=wO(o,6-n),l=Lz(wO(o,1),i,t);r.push.apply(r,l)}}return r}function AWe(e){var t,r,n,s=To(),o=s.locale,i=s.classNames,l=s.styles,c=s.hideHead,d=s.fixedWeeks,u=s.components,f=s.weekStartsOn,h=s.firstWeekContainsDate,m=s.ISOWeek,x=PWe(e.displayMonth,{useFixedWeeks:!!d,ISOWeek:m,locale:o,weekStartsOn:f,firstWeekContainsDate:h}),g=(t=u?.Head)!==null&&t!==void 0?t:UVe,v=(r=u?.Row)!==null&&r!==void 0?r:CWe,y=(n=u?.Footer)!==null&&n!==void 0?n:BVe;return a.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&a.jsx(g,{}),a.jsx("tbody",{className:i.tbody,style:l.tbody,children:x.map(function(b){return a.jsx(v,{displayMonth:e.displayMonth,dates:b.dates,weekNumber:b.weekNumber},b.weekNumber)})}),a.jsx(y,{displayMonth:e.displayMonth})]})}function EWe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var kWe=EWe()?p.useLayoutEffect:p.useEffect,VE=!1,IWe=0;function $z(){return"react-day-picker-".concat(++IWe)}function OWe(e){var t,r=e??(VE?$z():null),n=p.useState(r),s=n[0],o=n[1];return kWe(function(){s===null&&o($z())},[]),p.useEffect(function(){VE===!1&&(VE=!0)},[]),(t=e??s)!==null&&t!==void 0?t:void 0}function TWe(e){var t,r,n=To(),s=n.dir,o=n.classNames,i=n.styles,l=n.components,c=gj().displayMonths,d=OWe(n.id?"".concat(n.id,"-").concat(e.displayIndex):void 0),u=n.id?"".concat(n.id,"-grid-").concat(e.displayIndex):void 0,f=[o.month],h=i.month,m=e.displayIndex===0,x=e.displayIndex===c.length-1,g=!m&&!x;s==="rtl"&&(t=[m,x],x=t[0],m=t[1]),m&&(f.push(o.caption_start),h=ts(ts({},h),i.caption_start)),x&&(f.push(o.caption_end),h=ts(ts({},h),i.caption_end)),g&&(f.push(o.caption_between),h=ts(ts({},h),i.caption_between));var v=(r=l?.Caption)!==null&&r!==void 0?r:$Ve;return a.jsxs("div",{className:f.join(" "),style:h,children:[a.jsx(v,{id:d,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),a.jsx(AWe,{id:u,"aria-labelledby":d,displayMonth:e.displayMonth})]},e.displayIndex)}function DWe(e){var t=To(),r=t.classNames,n=t.styles;return a.jsx("div",{className:r.months,style:n.months,children:e.children})}function MWe(e){var t,r,n=e.initialProps,s=To(),o=hR(),i=gj(),l=p.useState(!1),c=l[0],d=l[1];p.useEffect(function(){s.initialFocus&&o.focusTarget&&(c||(o.focus(o.focusTarget),d(!0)))},[s.initialFocus,c,o.focus,o.focusTarget,o]);var u=[s.classNames.root,s.className];s.numberOfMonths>1&&u.push(s.classNames.multiple_months),s.showWeekNumber&&u.push(s.classNames.with_weeknumber);var f=ts(ts({},s.styles.root),s.style),h=Object.keys(n).filter(function(x){return x.startsWith("data-")}).reduce(function(x,g){var v;return ts(ts({},x),(v={},v[g]=n[g],v))},{}),m=(r=(t=n.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:DWe;return a.jsx("div",ts({className:u.join(" "),style:f,dir:s.dir,id:s.id,nonce:n.nonce,title:n.title,lang:n.lang},h,{children:a.jsx(m,{children:i.displayMonths.map(function(x,g){return a.jsx(TWe,{displayIndex:g,displayMonth:x},g)})})}))}function RWe(e){var t=e.children,r=oVe(e,["children"]);return a.jsx(SVe,{initialProps:r,children:a.jsx(MVe,{children:a.jsx(gWe,{initialProps:r,children:a.jsx(WVe,{initialProps:r,children:a.jsx(KVe,{initialProps:r,children:a.jsx(rWe,{children:a.jsx(hWe,{children:t})})})})})})})}function e3(e){return a.jsx(RWe,ts({},e,{children:a.jsx(MWe,{initialProps:e})}))}function ei({className:e,classNames:t,showOutsideDays:r=!0,weekStartsOn:n=1,locale:s=Da,...o}){const i=["dom","seg","ter","qua","qui","sex","sb"];return a.jsx(e3,{showOutsideDays:r,weekStartsOn:n,locale:s,className:Er("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Er(Rw({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Er(Rw({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},formatters:{formatWeekdayName:(l,c)=>i[l.getDay()]},components:{IconLeft:({...l})=>a.jsx(zI,{className:"h-4 w-4"}),IconRight:({...l})=>a.jsx(Yg,{className:"h-4 w-4"})},...o})}ei.displayName="Calendar";var ete="AlertDialog",[FWe,gct]=Cu(ete,[UX]),th=UX(),tte=e=>{const{__scopeAlertDialog:t,...r}=e,n=th(t);return a.jsx(sY,{...n,...r,modal:!0})};tte.displayName=ete;var LWe="AlertDialogTrigger",rte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=th(r);return a.jsx(T0e,{...s,...n,ref:t})});rte.displayName=LWe;var $We="AlertDialogPortal",nte=e=>{const{__scopeAlertDialog:t,...r}=e,n=th(t);return a.jsx(oY,{...n,...r})};nte.displayName=$We;var BWe="AlertDialogOverlay",ate=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=th(r);return a.jsx(zD,{...s,...n,ref:t})});ate.displayName=BWe;var Qv="AlertDialogContent",[qWe,zWe]=FWe(Qv),UWe=Pge("AlertDialogContent"),ste=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...s}=e,o=th(r),i=p.useRef(null),l=Ds(t,i),c=p.useRef(null);return a.jsx(E0e,{contentName:Qv,titleName:ote,docsSlug:"alert-dialog",children:a.jsx(qWe,{scope:r,cancelRef:c,children:a.jsxs(UD,{role:"alertdialog",...o,...s,ref:l,onOpenAutoFocus:aa(s.onOpenAutoFocus,d=>{d.preventDefault(),c.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[a.jsx(UWe,{children:n}),a.jsx(WWe,{contentRef:i})]})})})});ste.displayName=Qv;var ote="AlertDialogTitle",ite=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=th(r);return a.jsx(VD,{...s,...n,ref:t})});ite.displayName=ote;var lte="AlertDialogDescription",cte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=th(r);return a.jsx(WD,{...s,...n,ref:t})});cte.displayName=lte;var VWe="AlertDialogAction",dte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=th(r);return a.jsx(l5,{...s,...n,ref:t})});dte.displayName=VWe;var ute="AlertDialogCancel",fte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:s}=zWe(ute,r),o=th(r),i=Ds(t,s);return a.jsx(l5,{...o,...n,ref:i})});fte.displayName=ute;var WWe=({contentRef:e})=>{const t=`\`${Qv}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Qv}\` by passing a \`${lte}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Qv}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return p.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},HWe=tte,GWe=rte,KWe=nte,mte=ate,hte=ste,pte=dte,gte=fte,xte=ite,vte=cte;const Xu=HWe,Sg=GWe,XWe=KWe,yte=Ce.forwardRef(({className:e,...t},r)=>a.jsx(mte,{className:Er("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));yte.displayName=mte.displayName;const nu=Ce.forwardRef(({className:e,...t},r)=>a.jsxs(XWe,{children:[a.jsx(yte,{}),a.jsx(hte,{ref:r,className:Er("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));nu.displayName=hte.displayName;const au=({className:e,...t})=>a.jsx("div",{className:Er("flex flex-col space-y-2 text-center sm:text-left",e),...t});au.displayName="AlertDialogHeader";const su=({className:e,...t})=>a.jsx("div",{className:Er("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});su.displayName="AlertDialogFooter";const ou=Ce.forwardRef(({className:e,...t},r)=>a.jsx(xte,{ref:r,className:Er("text-lg font-semibold",e),...t}));ou.displayName=xte.displayName;const iu=Ce.forwardRef(({className:e,...t},r)=>a.jsx(vte,{ref:r,className:Er("text-sm text-muted-foreground",e),...t}));iu.displayName=vte.displayName;const Yu=Ce.forwardRef(({className:e,...t},r)=>a.jsx(pte,{ref:r,className:Er(Rw(),e),...t}));Yu.displayName=pte.displayName;const lu=Ce.forwardRef(({className:e,...t},r)=>a.jsx(gte,{ref:r,className:Er(Rw({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));lu.displayName=gte.displayName;function Bz(e,[t,r]){return Math.min(r,Math.max(t,e))}function cP(e){const t=e+"CollectionProvider",[r,n]=Cu(t),[s,o]=r(t,{collectionRef:{current:null},itemMap:new Map}),i=g=>{const{scope:v,children:y}=g,b=Ce.useRef(null),w=Ce.useRef(new Map).current;return a.jsx(s,{scope:v,itemMap:w,collectionRef:b,children:y})};i.displayName=t;const l=e+"CollectionSlot",c=xp(l),d=Ce.forwardRef((g,v)=>{const{scope:y,children:b}=g,w=o(l,y),j=Ds(v,w.collectionRef);return a.jsx(c,{ref:j,children:b})});d.displayName=l;const u=e+"CollectionItemSlot",f="data-radix-collection-item",h=xp(u),m=Ce.forwardRef((g,v)=>{const{scope:y,children:b,...w}=g,j=Ce.useRef(null),_=Ds(v,j),C=o(u,y);return Ce.useEffect(()=>(C.itemMap.set(j,{ref:j,...w}),()=>void C.itemMap.delete(j))),a.jsx(h,{[f]:"",ref:_,children:b})});m.displayName=u;function x(g){const v=o(e+"CollectionConsumer",g);return Ce.useCallback(()=>{const b=v.collectionRef.current;if(!b)return[];const w=Array.from(b.querySelectorAll(`[${f}]`));return Array.from(v.itemMap.values()).sort((C,A)=>w.indexOf(C.ref.current)-w.indexOf(A.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:i,Slot:d,ItemSlot:m},x,n]}var YWe=p.createContext(void 0);function dP(e){const t=p.useContext(YWe);return e||t||"ltr"}function bte(e){const t=p.useRef({value:e,previous:e});return p.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var wte=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),JWe="VisuallyHidden",gR=p.forwardRef((e,t)=>a.jsx(Xa.span,{...e,ref:t,style:{...wte,...e.style}}));gR.displayName=JWe;var QWe=[" ","Enter","ArrowUp","ArrowDown"],ZWe=[" ","Enter"],ix="Select",[uP,fP,eHe]=cP(ix),[Ny,xct]=Cu(ix,[eHe,oy]),mP=oy(),[tHe,Lp]=Ny(ix),[rHe,nHe]=Ny(ix),jte=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:s,onOpenChange:o,value:i,defaultValue:l,onValueChange:c,dir:d,name:u,autoComplete:f,disabled:h,required:m,form:x}=e,g=mP(t),[v,y]=p.useState(null),[b,w]=p.useState(null),[j,_]=p.useState(!1),C=dP(d),[A,S]=Um({prop:n,defaultProp:s??!1,onChange:o,caller:ix}),[P,M]=Um({prop:i,defaultProp:l,onChange:c,caller:ix}),O=p.useRef(null),I=v?x||!!v.closest("form"):!0,[T,k]=p.useState(new Set),$=Array.from(T).map(q=>q.props.value).join(";");return a.jsx(MD,{...g,children:a.jsxs(tHe,{required:m,scope:t,trigger:v,onTriggerChange:y,valueNode:b,onValueNodeChange:w,valueNodeHasChildren:j,onValueNodeHasChildrenChange:_,contentId:nf(),value:P,onValueChange:M,open:A,onOpenChange:S,dir:C,triggerPointerDownPosRef:O,disabled:h,children:[a.jsx(uP.Provider,{scope:t,children:a.jsx(rHe,{scope:e.__scopeSelect,onNativeOptionAdd:p.useCallback(q=>{k(z=>new Set(z).add(q))},[]),onNativeOptionRemove:p.useCallback(q=>{k(z=>{const F=new Set(z);return F.delete(q),F})},[]),children:r})}),I?a.jsxs(Vte,{"aria-hidden":!0,required:m,tabIndex:-1,name:u,autoComplete:f,value:P,onChange:q=>M(q.target.value),disabled:h,form:x,children:[P===void 0?a.jsx("option",{value:""}):null,Array.from(T)]},$):null]})})};jte.displayName=ix;var _te="SelectTrigger",Nte=p.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...s}=e,o=mP(r),i=Lp(_te,r),l=i.disabled||n,c=Ds(t,i.onTriggerChange),d=fP(r),u=p.useRef("touch"),[f,h,m]=Hte(g=>{const v=d().filter(w=>!w.disabled),y=v.find(w=>w.value===i.value),b=Gte(v,g,y);b!==void 0&&i.onValueChange(b.value)}),x=g=>{l||(i.onOpenChange(!0),m()),g&&(i.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return a.jsx(r5,{asChild:!0,...o,children:a.jsx(Xa.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":Wte(i.value)?"":void 0,...s,ref:c,onClick:aa(s.onClick,g=>{g.currentTarget.focus(),u.current!=="mouse"&&x(g)}),onPointerDown:aa(s.onPointerDown,g=>{u.current=g.pointerType;const v=g.target;v.hasPointerCapture(g.pointerId)&&v.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(x(g),g.preventDefault())}),onKeyDown:aa(s.onKeyDown,g=>{const v=f.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&h(g.key),!(v&&g.key===" ")&&QWe.includes(g.key)&&(x(),g.preventDefault())})})})});Nte.displayName=_te;var Ste="SelectValue",Cte=p.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,children:o,placeholder:i="",...l}=e,c=Lp(Ste,r),{onValueNodeHasChildrenChange:d}=c,u=o!==void 0,f=Ds(t,c.onValueNodeChange);return Il(()=>{d(u)},[d,u]),a.jsx(Xa.span,{...l,ref:f,style:{pointerEvents:"none"},children:Wte(c.value)?a.jsx(a.Fragment,{children:i}):o})});Cte.displayName=Ste;var aHe="SelectIcon",Pte=p.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...s}=e;return a.jsx(Xa.span,{"aria-hidden":!0,...s,ref:t,children:n||""})});Pte.displayName=aHe;var sHe="SelectPortal",Ate=e=>a.jsx(iy,{asChild:!0,...e});Ate.displayName=sHe;var lx="SelectContent",Ete=p.forwardRef((e,t)=>{const r=Lp(lx,e.__scopeSelect),[n,s]=p.useState();if(Il(()=>{s(new DocumentFragment)},[]),!r.open){const o=n;return o?Xm.createPortal(a.jsx(kte,{scope:e.__scopeSelect,children:a.jsx(uP.Slot,{scope:e.__scopeSelect,children:a.jsx("div",{children:e.children})})}),o):null}return a.jsx(Ite,{...e,ref:t})});Ete.displayName=lx;var zu=10,[kte,$p]=Ny(lx),oHe="SelectContentImpl",iHe=xp("SelectContent.RemoveScroll"),Ite=p.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:o,onPointerDownOutside:i,side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:h,collisionPadding:m,sticky:x,hideWhenDetached:g,avoidCollisions:v,...y}=e,b=Lp(lx,r),[w,j]=p.useState(null),[_,C]=p.useState(null),A=Ds(t,W=>j(W)),[S,P]=p.useState(null),[M,O]=p.useState(null),I=fP(r),[T,k]=p.useState(!1),$=p.useRef(!1);p.useEffect(()=>{if(w)return n5(w)},[w]),QC();const q=p.useCallback(W=>{const[Y,...me]=I().map(le=>le.ref.current),[ee]=me.slice(-1),ae=document.activeElement;for(const le of W)if(le===ae||(le?.scrollIntoView({block:"nearest"}),le===Y&&_&&(_.scrollTop=0),le===ee&&_&&(_.scrollTop=_.scrollHeight),le?.focus(),document.activeElement!==ae))return},[I,_]),z=p.useCallback(()=>q([S,w]),[q,S,w]);p.useEffect(()=>{T&&z()},[T,z]);const{onOpenChange:F,triggerPointerDownPosRef:V}=b;p.useEffect(()=>{if(w){let W={x:0,y:0};const Y=ee=>{W={x:Math.abs(Math.round(ee.pageX)-(V.current?.x??0)),y:Math.abs(Math.round(ee.pageY)-(V.current?.y??0))}},me=ee=>{W.x<=10&&W.y<=10?ee.preventDefault():w.contains(ee.target)||F(!1),document.removeEventListener("pointermove",Y),V.current=null};return V.current!==null&&(document.addEventListener("pointermove",Y),document.addEventListener("pointerup",me,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Y),document.removeEventListener("pointerup",me,{capture:!0})}}},[w,F,V]),p.useEffect(()=>{const W=()=>F(!1);return window.addEventListener("blur",W),window.addEventListener("resize",W),()=>{window.removeEventListener("blur",W),window.removeEventListener("resize",W)}},[F]);const[ue,_e]=Hte(W=>{const Y=I().filter(ae=>!ae.disabled),me=Y.find(ae=>ae.ref.current===document.activeElement),ee=Gte(Y,W,me);ee&&setTimeout(()=>ee.ref.current.focus())}),U=p.useCallback((W,Y,me)=>{const ee=!$.current&&!me;(b.value!==void 0&&b.value===Y||ee)&&(P(W),ee&&($.current=!0))},[b.value]),L=p.useCallback(()=>w?.focus(),[w]),G=p.useCallback((W,Y,me)=>{const ee=!$.current&&!me;(b.value!==void 0&&b.value===Y||ee)&&O(W)},[b.value]),de=n==="popper"?t3:Ote,X=de===t3?{side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:h,collisionPadding:m,sticky:x,hideWhenDetached:g,avoidCollisions:v}:{};return a.jsx(kte,{scope:r,content:w,viewport:_,onViewportChange:C,itemRefCallback:U,selectedItem:S,onItemLeave:L,itemTextRefCallback:G,focusSelectedItem:z,selectedItemText:M,position:n,isPositioned:T,searchRef:ue,children:a.jsx(s5,{as:iHe,allowPinchZoom:!0,children:a.jsx(ej,{asChild:!0,trapped:b.open,onMountAutoFocus:W=>{W.preventDefault()},onUnmountAutoFocus:aa(s,W=>{b.trigger?.focus({preventScroll:!0}),W.preventDefault()}),children:a.jsx(ny,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:W=>W.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:a.jsx(de,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:W=>W.preventDefault(),...y,...X,onPlaced:()=>k(!0),ref:A,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:aa(y.onKeyDown,W=>{const Y=W.ctrlKey||W.altKey||W.metaKey;if(W.key==="Tab"&&W.preventDefault(),!Y&&W.key.length===1&&_e(W.key),["ArrowUp","ArrowDown","Home","End"].includes(W.key)){let ee=I().filter(ae=>!ae.disabled).map(ae=>ae.ref.current);if(["ArrowUp","End"].includes(W.key)&&(ee=ee.slice().reverse()),["ArrowUp","ArrowDown"].includes(W.key)){const ae=W.target,le=ee.indexOf(ae);ee=ee.slice(le+1)}setTimeout(()=>q(ee)),W.preventDefault()}})})})})})})});Ite.displayName=oHe;var lHe="SelectItemAlignedPosition",Ote=p.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...s}=e,o=Lp(lx,r),i=$p(lx,r),[l,c]=p.useState(null),[d,u]=p.useState(null),f=Ds(t,A=>u(A)),h=fP(r),m=p.useRef(!1),x=p.useRef(!0),{viewport:g,selectedItem:v,selectedItemText:y,focusSelectedItem:b}=i,w=p.useCallback(()=>{if(o.trigger&&o.valueNode&&l&&d&&g&&v&&y){const A=o.trigger.getBoundingClientRect(),S=d.getBoundingClientRect(),P=o.valueNode.getBoundingClientRect(),M=y.getBoundingClientRect();if(o.dir!=="rtl"){const ae=M.left-S.left,le=P.left-ae,Te=A.left-le,te=A.width+Te,ie=Math.max(te,S.width),xt=window.innerWidth-zu,vt=Bz(le,[zu,Math.max(zu,xt-ie)]);l.style.minWidth=te+"px",l.style.left=vt+"px"}else{const ae=S.right-M.right,le=window.innerWidth-P.right-ae,Te=window.innerWidth-A.right-le,te=A.width+Te,ie=Math.max(te,S.width),xt=window.innerWidth-zu,vt=Bz(le,[zu,Math.max(zu,xt-ie)]);l.style.minWidth=te+"px",l.style.right=vt+"px"}const O=h(),I=window.innerHeight-zu*2,T=g.scrollHeight,k=window.getComputedStyle(d),$=parseInt(k.borderTopWidth,10),q=parseInt(k.paddingTop,10),z=parseInt(k.borderBottomWidth,10),F=parseInt(k.paddingBottom,10),V=$+q+T+F+z,ue=Math.min(v.offsetHeight*5,V),_e=window.getComputedStyle(g),U=parseInt(_e.paddingTop,10),L=parseInt(_e.paddingBottom,10),G=A.top+A.height/2-zu,de=I-G,X=v.offsetHeight/2,W=v.offsetTop+X,Y=$+q+W,me=V-Y;if(Y<=G){const ae=O.length>0&&v===O[O.length-1].ref.current;l.style.bottom="0px";const le=d.clientHeight-g.offsetTop-g.offsetHeight,Te=Math.max(de,X+(ae?L:0)+le+z),te=Y+Te;l.style.height=te+"px"}else{const ae=O.length>0&&v===O[0].ref.current;l.style.top="0px";const Te=Math.max(G,$+g.offsetTop+(ae?U:0)+X)+me;l.style.height=Te+"px",g.scrollTop=Y-G+g.offsetTop}l.style.margin=`${zu}px 0`,l.style.minHeight=ue+"px",l.style.maxHeight=I+"px",n?.(),requestAnimationFrame(()=>m.current=!0)}},[h,o.trigger,o.valueNode,l,d,g,v,y,o.dir,n]);Il(()=>w(),[w]);const[j,_]=p.useState();Il(()=>{d&&_(window.getComputedStyle(d).zIndex)},[d]);const C=p.useCallback(A=>{A&&x.current===!0&&(w(),b?.(),x.current=!1)},[w,b]);return a.jsx(dHe,{scope:r,contentWrapper:l,shouldExpandOnScrollRef:m,onScrollButtonChange:C,children:a.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:j},children:a.jsx(Xa.div,{...s,ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});Ote.displayName=lHe;var cHe="SelectPopperPosition",t3=p.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:s=zu,...o}=e,i=mP(r);return a.jsx(RD,{...i,...o,ref:t,align:n,collisionPadding:s,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});t3.displayName=cHe;var[dHe,xR]=Ny(lx,{}),r3="SelectViewport",Tte=p.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...s}=e,o=$p(r3,r),i=xR(r3,r),l=Ds(t,o.onViewportChange),c=p.useRef(0);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),a.jsx(uP.Slot,{scope:r,children:a.jsx(Xa.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:aa(s.onScroll,d=>{const u=d.currentTarget,{contentWrapper:f,shouldExpandOnScrollRef:h}=i;if(h?.current&&f){const m=Math.abs(c.current-u.scrollTop);if(m>0){const x=window.innerHeight-zu*2,g=parseFloat(f.style.minHeight),v=parseFloat(f.style.height),y=Math.max(g,v);if(y<x){const b=y+m,w=Math.min(x,b),j=b-w;f.style.height=w+"px",f.style.bottom==="0px"&&(u.scrollTop=j>0?j:0,f.style.justifyContent="flex-end")}}}c.current=u.scrollTop})})})]})});Tte.displayName=r3;var Dte="SelectGroup",[uHe,fHe]=Ny(Dte),mHe=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=nf();return a.jsx(uHe,{scope:r,id:s,children:a.jsx(Xa.div,{role:"group","aria-labelledby":s,...n,ref:t})})});mHe.displayName=Dte;var Mte="SelectLabel",Rte=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=fHe(Mte,r);return a.jsx(Xa.div,{id:s.id,...n,ref:t})});Rte.displayName=Mte;var GS="SelectItem",[hHe,Fte]=Ny(GS),Lte=p.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:s=!1,textValue:o,...i}=e,l=Lp(GS,r),c=$p(GS,r),d=l.value===n,[u,f]=p.useState(o??""),[h,m]=p.useState(!1),x=Ds(t,b=>c.itemRefCallback?.(b,n,s)),g=nf(),v=p.useRef("touch"),y=()=>{s||(l.onValueChange(n),l.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return a.jsx(hHe,{scope:r,value:n,disabled:s,textId:g,isSelected:d,onItemTextChange:p.useCallback(b=>{f(w=>w||(b?.textContent??"").trim())},[]),children:a.jsx(uP.ItemSlot,{scope:r,value:n,disabled:s,textValue:u,children:a.jsx(Xa.div,{role:"option","aria-labelledby":g,"data-highlighted":h?"":void 0,"aria-selected":d&&h,"data-state":d?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...i,ref:x,onFocus:aa(i.onFocus,()=>m(!0)),onBlur:aa(i.onBlur,()=>m(!1)),onClick:aa(i.onClick,()=>{v.current!=="mouse"&&y()}),onPointerUp:aa(i.onPointerUp,()=>{v.current==="mouse"&&y()}),onPointerDown:aa(i.onPointerDown,b=>{v.current=b.pointerType}),onPointerMove:aa(i.onPointerMove,b=>{v.current=b.pointerType,s?c.onItemLeave?.():v.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:aa(i.onPointerLeave,b=>{b.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:aa(i.onKeyDown,b=>{c.searchRef?.current!==""&&b.key===" "||(ZWe.includes(b.key)&&y(),b.key===" "&&b.preventDefault())})})})})});Lte.displayName=GS;var _b="SelectItemText",$te=p.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,...o}=e,i=Lp(_b,r),l=$p(_b,r),c=Fte(_b,r),d=nHe(_b,r),[u,f]=p.useState(null),h=Ds(t,y=>f(y),c.onItemTextChange,y=>l.itemTextRefCallback?.(y,c.value,c.disabled)),m=u?.textContent,x=p.useMemo(()=>a.jsx("option",{value:c.value,disabled:c.disabled,children:m},c.value),[c.disabled,c.value,m]),{onNativeOptionAdd:g,onNativeOptionRemove:v}=d;return Il(()=>(g(x),()=>v(x)),[g,v,x]),a.jsxs(a.Fragment,{children:[a.jsx(Xa.span,{id:c.textId,...o,ref:h}),c.isSelected&&i.valueNode&&!i.valueNodeHasChildren?Xm.createPortal(o.children,i.valueNode):null]})});$te.displayName=_b;var Bte="SelectItemIndicator",qte=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return Fte(Bte,r).isSelected?a.jsx(Xa.span,{"aria-hidden":!0,...n,ref:t}):null});qte.displayName=Bte;var n3="SelectScrollUpButton",pHe=p.forwardRef((e,t)=>{const r=$p(n3,e.__scopeSelect),n=xR(n3,e.__scopeSelect),[s,o]=p.useState(!1),i=Ds(t,n.onScrollButtonChange);return Il(()=>{if(r.viewport&&r.isPositioned){let l=function(){const d=c.scrollTop>0;o(d)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),s?a.jsx(zte,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop-c.offsetHeight)}}):null});pHe.displayName=n3;var a3="SelectScrollDownButton",gHe=p.forwardRef((e,t)=>{const r=$p(a3,e.__scopeSelect),n=xR(a3,e.__scopeSelect),[s,o]=p.useState(!1),i=Ds(t,n.onScrollButtonChange);return Il(()=>{if(r.viewport&&r.isPositioned){let l=function(){const d=c.scrollHeight-c.clientHeight,u=Math.ceil(c.scrollTop)<d;o(u)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),s?a.jsx(zte,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop+c.offsetHeight)}}):null});gHe.displayName=a3;var zte=p.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...s}=e,o=$p("SelectScrollButton",r),i=p.useRef(null),l=fP(r),c=p.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return p.useEffect(()=>()=>c(),[c]),Il(()=>{l().find(u=>u.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),a.jsx(Xa.div,{"aria-hidden":!0,...s,ref:t,style:{flexShrink:0,...s.style},onPointerDown:aa(s.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(n,50))}),onPointerMove:aa(s.onPointerMove,()=>{o.onItemLeave?.(),i.current===null&&(i.current=window.setInterval(n,50))}),onPointerLeave:aa(s.onPointerLeave,()=>{c()})})}),xHe="SelectSeparator",Ute=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return a.jsx(Xa.div,{"aria-hidden":!0,...n,ref:t})});Ute.displayName=xHe;var s3="SelectArrow",vHe=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=mP(r),o=Lp(s3,r),i=$p(s3,r);return o.open&&i.position==="popper"?a.jsx(FD,{...s,...n,ref:t}):null});vHe.displayName=s3;var yHe="SelectBubbleInput",Vte=p.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const s=p.useRef(null),o=Ds(n,s),i=bte(t);return p.useEffect(()=>{const l=s.current;if(!l)return;const c=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(i!==t&&u){const f=new Event("change",{bubbles:!0});u.call(l,t),l.dispatchEvent(f)}},[i,t]),a.jsx(Xa.select,{...r,style:{...wte,...r.style},ref:o,defaultValue:t})});Vte.displayName=yHe;function Wte(e){return e===""||e===void 0}function Hte(e){const t=Zc(e),r=p.useRef(""),n=p.useRef(0),s=p.useCallback(i=>{const l=r.current+i;t(l),function c(d){r.current=d,window.clearTimeout(n.current),d!==""&&(n.current=window.setTimeout(()=>c(""),1e3))}(l)},[t]),o=p.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return p.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,s,o]}function Gte(e,t,r){const s=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let i=bHe(e,Math.max(o,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.textValue.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function bHe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var wHe=jte,Kte=Nte,jHe=Cte,_He=Pte,NHe=Ate,Xte=Ete,SHe=Tte,Yte=Rte,Jte=Lte,CHe=$te,PHe=qte,Qte=Ute;const ea=wHe,ra=jHe,Jn=Ce.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Kte,{ref:n,className:Er("flex h-10 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground hover:bg-surface-2/30 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-150",e),...r,children:[t,a.jsx(_He,{asChild:!0,children:a.jsx(gx,{className:"h-4 w-4 opacity-50"})})]}));Jn.displayName=Kte.displayName;const Qn=Ce.forwardRef(({className:e,children:t,position:r="popper",...n},s)=>a.jsx(NHe,{children:a.jsx(Xte,{ref:s,className:Er("relative z-50 min-w-[8rem] max-h-[340px] overflow-auto fx-scroll rounded-md border bg-popover text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:a.jsx(SHe,{className:Er("p-1",r==="popper"&&"w-full min-w-[var(--radix-select-trigger-width)]"),children:t})})}));Qn.displayName=Xte.displayName;const AHe=Ce.forwardRef(({className:e,...t},r)=>a.jsx(Yte,{ref:r,className:Er("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));AHe.displayName=Yte.displayName;const Qe=Ce.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Jte,{ref:n,className:Er("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none hover:bg-surface-2/50 focus:bg-surface-2/50 data-[state=checked]:bg-surface-2/50 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-colors",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(PHe,{children:a.jsx(Lm,{className:"h-4 w-4"})})}),a.jsx(CHe,{children:t})]}));Qe.displayName=Jte.displayName;const EHe=Ce.forwardRef(({className:e,...t},r)=>a.jsx(Qte,{ref:r,className:Er("-mx-1 my-1 h-px bg-muted",e),...t}));EHe.displayName=Qte.displayName;var hP="Checkbox",[kHe,vct]=Cu(hP),[IHe,vR]=kHe(hP);function OHe(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:s,disabled:o,form:i,name:l,onCheckedChange:c,required:d,value:u="on",internal_do_not_use_render:f}=e,[h,m]=Um({prop:r,defaultProp:s??!1,onChange:c,caller:hP}),[x,g]=p.useState(null),[v,y]=p.useState(null),b=p.useRef(!1),w=x?!!i||!!x.closest("form"):!0,j={checked:h,disabled:o,setChecked:m,control:x,setControl:g,name:l,form:i,value:u,hasConsumerStoppedPropagationRef:b,required:d,defaultChecked:ap(s)?!1:s,isFormControl:w,bubbleInput:v,setBubbleInput:y};return a.jsx(IHe,{scope:t,...j,children:THe(f)?f(j):n})}var Zte="CheckboxTrigger",ere=p.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},s)=>{const{control:o,value:i,disabled:l,checked:c,required:d,setControl:u,setChecked:f,hasConsumerStoppedPropagationRef:h,isFormControl:m,bubbleInput:x}=vR(Zte,e),g=Ds(s,u),v=p.useRef(c);return p.useEffect(()=>{const y=o?.form;if(y){const b=()=>f(v.current);return y.addEventListener("reset",b),()=>y.removeEventListener("reset",b)}},[o,f]),a.jsx(Xa.button,{type:"button",role:"checkbox","aria-checked":ap(c)?"mixed":c,"aria-required":d,"data-state":sre(c),"data-disabled":l?"":void 0,disabled:l,value:i,...n,ref:g,onKeyDown:aa(t,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:aa(r,y=>{f(b=>ap(b)?!0:!b),x&&m&&(h.current=y.isPropagationStopped(),h.current||y.stopPropagation())})})});ere.displayName=Zte;var yR=p.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:s,defaultChecked:o,required:i,disabled:l,value:c,onCheckedChange:d,form:u,...f}=e;return a.jsx(OHe,{__scopeCheckbox:r,checked:s,defaultChecked:o,disabled:l,required:i,onCheckedChange:d,name:n,form:u,value:c,internal_do_not_use_render:({isFormControl:h})=>a.jsxs(a.Fragment,{children:[a.jsx(ere,{...f,ref:t,__scopeCheckbox:r}),h&&a.jsx(are,{__scopeCheckbox:r})]})})});yR.displayName=hP;var tre="CheckboxIndicator",rre=p.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...s}=e,o=vR(tre,r);return a.jsx(qd,{present:n||ap(o.checked)||o.checked===!0,children:a.jsx(Xa.span,{"data-state":sre(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});rre.displayName=tre;var nre="CheckboxBubbleInput",are=p.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:s,checked:o,defaultChecked:i,required:l,disabled:c,name:d,value:u,form:f,bubbleInput:h,setBubbleInput:m}=vR(nre,e),x=Ds(r,m),g=bte(o),v=fX(n);p.useEffect(()=>{const b=h;if(!b)return;const w=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(w,"checked").set,C=!s.current;if(g!==o&&_){const A=new Event("click",{bubbles:C});b.indeterminate=ap(o),_.call(b,ap(o)?!1:o),b.dispatchEvent(A)}},[h,g,o,s]);const y=p.useRef(ap(o)?!1:o);return a.jsx(Xa.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??y.current,required:l,disabled:c,name:d,value:u,form:f,...t,tabIndex:-1,ref:x,style:{...t.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});are.displayName=nre;function THe(e){return typeof e=="function"}function ap(e){return e==="indeterminate"}function sre(e){return ap(e)?"indeterminate":e?"checked":"unchecked"}const Ks=Ce.forwardRef(({className:e,...t},r)=>a.jsx(yR,{ref:r,className:Er("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:a.jsx(rre,{className:Er("flex items-center justify-center text-current"),children:a.jsx(Lm,{className:"h-4 w-4"})})}));Ks.displayName=yR.displayName;var WE="rovingFocusGroup.onEntryFocus",DHe={bubbles:!1,cancelable:!0},xj="RovingFocusGroup",[o3,ore,MHe]=cP(xj),[RHe,pP]=Cu(xj,[MHe]),[FHe,LHe]=RHe(xj),ire=p.forwardRef((e,t)=>a.jsx(o3.Provider,{scope:e.__scopeRovingFocusGroup,children:a.jsx(o3.Slot,{scope:e.__scopeRovingFocusGroup,children:a.jsx($He,{...e,ref:t})})}));ire.displayName=xj;var $He=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:s=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:u=!1,...f}=e,h=p.useRef(null),m=Ds(t,h),x=dP(o),[g,v]=Um({prop:i,defaultProp:l??null,onChange:c,caller:xj}),[y,b]=p.useState(!1),w=Zc(d),j=ore(r),_=p.useRef(!1),[C,A]=p.useState(0);return p.useEffect(()=>{const S=h.current;if(S)return S.addEventListener(WE,w),()=>S.removeEventListener(WE,w)},[w]),a.jsx(FHe,{scope:r,orientation:n,dir:x,loop:s,currentTabStopId:g,onItemFocus:p.useCallback(S=>v(S),[v]),onItemShiftTab:p.useCallback(()=>b(!0),[]),onFocusableItemAdd:p.useCallback(()=>A(S=>S+1),[]),onFocusableItemRemove:p.useCallback(()=>A(S=>S-1),[]),children:a.jsx(Xa.div,{tabIndex:y||C===0?-1:0,"data-orientation":n,...f,ref:m,style:{outline:"none",...e.style},onMouseDown:aa(e.onMouseDown,()=>{_.current=!0}),onFocus:aa(e.onFocus,S=>{const P=!_.current;if(S.target===S.currentTarget&&P&&!y){const M=new CustomEvent(WE,DHe);if(S.currentTarget.dispatchEvent(M),!M.defaultPrevented){const O=j().filter(q=>q.focusable),I=O.find(q=>q.active),T=O.find(q=>q.id===g),$=[I,T,...O].filter(Boolean).map(q=>q.ref.current);dre($,u)}}_.current=!1}),onBlur:aa(e.onBlur,()=>b(!1))})})}),lre="RovingFocusGroupItem",cre=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:s=!1,tabStopId:o,children:i,...l}=e,c=nf(),d=o||c,u=LHe(lre,r),f=u.currentTabStopId===d,h=ore(r),{onFocusableItemAdd:m,onFocusableItemRemove:x,currentTabStopId:g}=u;return p.useEffect(()=>{if(n)return m(),()=>x()},[n,m,x]),a.jsx(o3.ItemSlot,{scope:r,id:d,focusable:n,active:s,children:a.jsx(Xa.span,{tabIndex:f?0:-1,"data-orientation":u.orientation,...l,ref:t,onMouseDown:aa(e.onMouseDown,v=>{n?u.onItemFocus(d):v.preventDefault()}),onFocus:aa(e.onFocus,()=>u.onItemFocus(d)),onKeyDown:aa(e.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){u.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const y=zHe(v,u.orientation,u.dir);if(y!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let w=h().filter(j=>j.focusable).map(j=>j.ref.current);if(y==="last")w.reverse();else if(y==="prev"||y==="next"){y==="prev"&&w.reverse();const j=w.indexOf(v.currentTarget);w=u.loop?UHe(w,j+1):w.slice(j+1)}setTimeout(()=>dre(w))}}),children:typeof i=="function"?i({isCurrentTabStop:f,hasTabStop:g!=null}):i})})});cre.displayName=lre;var BHe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function qHe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function zHe(e,t,r){const n=qHe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return BHe[n]}function dre(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function UHe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var ure=ire,fre=cre,i3=["Enter"," "],VHe=["ArrowDown","PageUp","Home"],mre=["ArrowUp","PageDown","End"],WHe=[...VHe,...mre],HHe={ltr:[...i3,"ArrowRight"],rtl:[...i3,"ArrowLeft"]},GHe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},vj="Menu",[S1,KHe,XHe]=cP(vj),[Cx,hre]=Cu(vj,[XHe,oy,pP]),gP=oy(),pre=pP(),[YHe,Px]=Cx(vj),[JHe,yj]=Cx(vj),gre=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:o,modal:i=!0}=e,l=gP(t),[c,d]=p.useState(null),u=p.useRef(!1),f=Zc(o),h=dP(s);return p.useEffect(()=>{const m=()=>{u.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>u.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),a.jsx(MD,{...l,children:a.jsx(YHe,{scope:t,open:r,onOpenChange:f,content:c,onContentChange:d,children:a.jsx(JHe,{scope:t,onClose:p.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:u,dir:h,modal:i,children:n})})})};gre.displayName=vj;var QHe="MenuAnchor",bR=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=gP(r);return a.jsx(r5,{...s,...n,ref:t})});bR.displayName=QHe;var wR="MenuPortal",[ZHe,xre]=Cx(wR,{forceMount:void 0}),vre=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:s}=e,o=Px(wR,t);return a.jsx(ZHe,{scope:t,forceMount:r,children:a.jsx(qd,{present:r||o.open,children:a.jsx(iy,{asChild:!0,container:s,children:n})})})};vre.displayName=wR;var vu="MenuContent",[eGe,jR]=Cx(vu),yre=p.forwardRef((e,t)=>{const r=xre(vu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Px(vu,e.__scopeMenu),i=yj(vu,e.__scopeMenu);return a.jsx(S1.Provider,{scope:e.__scopeMenu,children:a.jsx(qd,{present:n||o.open,children:a.jsx(S1.Slot,{scope:e.__scopeMenu,children:i.modal?a.jsx(tGe,{...s,ref:t}):a.jsx(rGe,{...s,ref:t})})})})}),tGe=p.forwardRef((e,t)=>{const r=Px(vu,e.__scopeMenu),n=p.useRef(null),s=Ds(t,n);return p.useEffect(()=>{const o=n.current;if(o)return n5(o)},[]),a.jsx(_R,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:aa(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),rGe=p.forwardRef((e,t)=>{const r=Px(vu,e.__scopeMenu);return a.jsx(_R,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),nGe=xp("MenuContent.ScrollLock"),_R=p.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:h,onDismiss:m,disableOutsideScroll:x,...g}=e,v=Px(vu,r),y=yj(vu,r),b=gP(r),w=pre(r),j=KHe(r),[_,C]=p.useState(null),A=p.useRef(null),S=Ds(t,A,v.onContentChange),P=p.useRef(0),M=p.useRef(""),O=p.useRef(0),I=p.useRef(null),T=p.useRef("right"),k=p.useRef(0),$=x?s5:p.Fragment,q=x?{as:nGe,allowPinchZoom:!0}:void 0,z=V=>{const ue=M.current+V,_e=j().filter(W=>!W.disabled),U=document.activeElement,L=_e.find(W=>W.ref.current===U)?.textValue,G=_e.map(W=>W.textValue),de=pGe(G,ue,L),X=_e.find(W=>W.textValue===de)?.ref.current;(function W(Y){M.current=Y,window.clearTimeout(P.current),Y!==""&&(P.current=window.setTimeout(()=>W(""),1e3))})(ue),X&&setTimeout(()=>X.focus())};p.useEffect(()=>()=>window.clearTimeout(P.current),[]),QC();const F=p.useCallback(V=>T.current===I.current?.side&&xGe(V,I.current?.area),[]);return a.jsx(eGe,{scope:r,searchRef:M,onItemEnter:p.useCallback(V=>{F(V)&&V.preventDefault()},[F]),onItemLeave:p.useCallback(V=>{F(V)||(A.current?.focus(),C(null))},[F]),onTriggerLeave:p.useCallback(V=>{F(V)&&V.preventDefault()},[F]),pointerGraceTimerRef:O,onPointerGraceIntentChange:p.useCallback(V=>{I.current=V},[]),children:a.jsx($,{...q,children:a.jsx(ej,{asChild:!0,trapped:s,onMountAutoFocus:aa(o,V=>{V.preventDefault(),A.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:a.jsx(ny,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:h,onDismiss:m,children:a.jsx(ure,{asChild:!0,...w,dir:y.dir,orientation:"vertical",loop:n,currentTabStopId:_,onCurrentTabStopIdChange:C,onEntryFocus:aa(c,V=>{y.isUsingKeyboardRef.current||V.preventDefault()}),preventScrollOnEntryFocus:!0,children:a.jsx(RD,{role:"menu","aria-orientation":"vertical","data-state":Mre(v.open),"data-radix-menu-content":"",dir:y.dir,...b,...g,ref:S,style:{outline:"none",...g.style},onKeyDown:aa(g.onKeyDown,V=>{const _e=V.target.closest("[data-radix-menu-content]")===V.currentTarget,U=V.ctrlKey||V.altKey||V.metaKey,L=V.key.length===1;_e&&(V.key==="Tab"&&V.preventDefault(),!U&&L&&z(V.key));const G=A.current;if(V.target!==G||!WHe.includes(V.key))return;V.preventDefault();const X=j().filter(W=>!W.disabled).map(W=>W.ref.current);mre.includes(V.key)&&X.reverse(),mGe(X)}),onBlur:aa(e.onBlur,V=>{V.currentTarget.contains(V.target)||(window.clearTimeout(P.current),M.current="")}),onPointerMove:aa(e.onPointerMove,C1(V=>{const ue=V.target,_e=k.current!==V.clientX;if(V.currentTarget.contains(ue)&&_e){const U=V.clientX>k.current?"right":"left";T.current=U,k.current=V.clientX}}))})})})})})})});yre.displayName=vu;var aGe="MenuGroup",NR=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Xa.div,{role:"group",...n,ref:t})});NR.displayName=aGe;var sGe="MenuLabel",bre=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Xa.div,{...n,ref:t})});bre.displayName=sGe;var KS="MenuItem",qz="menu.itemSelect",xP=p.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...s}=e,o=p.useRef(null),i=yj(KS,e.__scopeMenu),l=jR(KS,e.__scopeMenu),c=Ds(t,o),d=p.useRef(!1),u=()=>{const f=o.current;if(!r&&f){const h=new CustomEvent(qz,{bubbles:!0,cancelable:!0});f.addEventListener(qz,m=>n?.(m),{once:!0}),SD(f,h),h.defaultPrevented?d.current=!1:i.onClose()}};return a.jsx(wre,{...s,ref:c,disabled:r,onClick:aa(e.onClick,u),onPointerDown:f=>{e.onPointerDown?.(f),d.current=!0},onPointerUp:aa(e.onPointerUp,f=>{d.current||f.currentTarget?.click()}),onKeyDown:aa(e.onKeyDown,f=>{const h=l.searchRef.current!=="";r||h&&f.key===" "||i3.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});xP.displayName=KS;var wre=p.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:s,...o}=e,i=jR(KS,r),l=pre(r),c=p.useRef(null),d=Ds(t,c),[u,f]=p.useState(!1),[h,m]=p.useState("");return p.useEffect(()=>{const x=c.current;x&&m((x.textContent??"").trim())},[o.children]),a.jsx(S1.ItemSlot,{scope:r,disabled:n,textValue:s??h,children:a.jsx(fre,{asChild:!0,...l,focusable:!n,children:a.jsx(Xa.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:d,onPointerMove:aa(e.onPointerMove,C1(x=>{n?i.onItemLeave(x):(i.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:aa(e.onPointerLeave,C1(x=>i.onItemLeave(x))),onFocus:aa(e.onFocus,()=>f(!0)),onBlur:aa(e.onBlur,()=>f(!1))})})})}),oGe="MenuCheckboxItem",jre=p.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...s}=e;return a.jsx(Pre,{scope:e.__scopeMenu,checked:r,children:a.jsx(xP,{role:"menuitemcheckbox","aria-checked":XS(r)?"mixed":r,...s,ref:t,"data-state":CR(r),onSelect:aa(s.onSelect,()=>n?.(XS(r)?!0:!r),{checkForDefaultPrevented:!1})})})});jre.displayName=oGe;var _re="MenuRadioGroup",[iGe,lGe]=Cx(_re,{value:void 0,onValueChange:()=>{}}),Nre=p.forwardRef((e,t)=>{const{value:r,onValueChange:n,...s}=e,o=Zc(n);return a.jsx(iGe,{scope:e.__scopeMenu,value:r,onValueChange:o,children:a.jsx(NR,{...s,ref:t})})});Nre.displayName=_re;var Sre="MenuRadioItem",Cre=p.forwardRef((e,t)=>{const{value:r,...n}=e,s=lGe(Sre,e.__scopeMenu),o=r===s.value;return a.jsx(Pre,{scope:e.__scopeMenu,checked:o,children:a.jsx(xP,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":CR(o),onSelect:aa(n.onSelect,()=>s.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Cre.displayName=Sre;var SR="MenuItemIndicator",[Pre,cGe]=Cx(SR,{checked:!1}),Are=p.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...s}=e,o=cGe(SR,r);return a.jsx(qd,{present:n||XS(o.checked)||o.checked===!0,children:a.jsx(Xa.span,{...s,ref:t,"data-state":CR(o.checked)})})});Are.displayName=SR;var dGe="MenuSeparator",Ere=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Xa.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});Ere.displayName=dGe;var uGe="MenuArrow",kre=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=gP(r);return a.jsx(FD,{...s,...n,ref:t})});kre.displayName=uGe;var fGe="MenuSub",[yct,Ire]=Cx(fGe),Nb="MenuSubTrigger",Ore=p.forwardRef((e,t)=>{const r=Px(Nb,e.__scopeMenu),n=yj(Nb,e.__scopeMenu),s=Ire(Nb,e.__scopeMenu),o=jR(Nb,e.__scopeMenu),i=p.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=o,d={__scopeMenu:e.__scopeMenu},u=p.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return p.useEffect(()=>u,[u]),p.useEffect(()=>{const f=l.current;return()=>{window.clearTimeout(f),c(null)}},[l,c]),a.jsx(bR,{asChild:!0,...d,children:a.jsx(wre,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":Mre(r.open),...e,ref:JC(t,s.onTriggerChange),onClick:f=>{e.onClick?.(f),!(e.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:aa(e.onPointerMove,C1(f=>{o.onItemEnter(f),!f.defaultPrevented&&!e.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:aa(e.onPointerLeave,C1(f=>{u();const h=r.content?.getBoundingClientRect();if(h){const m=r.content?.dataset.side,x=m==="right",g=x?-5:5,v=h[x?"left":"right"],y=h[x?"right":"left"];o.onPointerGraceIntentChange({area:[{x:f.clientX+g,y:f.clientY},{x:v,y:h.top},{x:y,y:h.top},{x:y,y:h.bottom},{x:v,y:h.bottom}],side:m}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(f),f.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:aa(e.onKeyDown,f=>{const h=o.searchRef.current!=="";e.disabled||h&&f.key===" "||HHe[n.dir].includes(f.key)&&(r.onOpenChange(!0),r.content?.focus(),f.preventDefault())})})})});Ore.displayName=Nb;var Tre="MenuSubContent",Dre=p.forwardRef((e,t)=>{const r=xre(vu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Px(vu,e.__scopeMenu),i=yj(vu,e.__scopeMenu),l=Ire(Tre,e.__scopeMenu),c=p.useRef(null),d=Ds(t,c);return a.jsx(S1.Provider,{scope:e.__scopeMenu,children:a.jsx(qd,{present:n||o.open,children:a.jsx(S1.Slot,{scope:e.__scopeMenu,children:a.jsx(_R,{id:l.contentId,"aria-labelledby":l.triggerId,...s,ref:d,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{i.isUsingKeyboardRef.current&&c.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:aa(e.onFocusOutside,u=>{u.target!==l.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:aa(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:aa(e.onKeyDown,u=>{const f=u.currentTarget.contains(u.target),h=GHe[i.dir].includes(u.key);f&&h&&(o.onOpenChange(!1),l.trigger?.focus(),u.preventDefault())})})})})})});Dre.displayName=Tre;function Mre(e){return e?"open":"closed"}function XS(e){return e==="indeterminate"}function CR(e){return XS(e)?"indeterminate":e?"checked":"unchecked"}function mGe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function hGe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function pGe(e,t,r){const s=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let i=hGe(e,Math.max(o,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function gGe(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const l=t[o],c=t[i],d=l.x,u=l.y,f=c.x,h=c.y;u>n!=h>n&&r<(f-d)*(n-u)/(h-u)+d&&(s=!s)}return s}function xGe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return gGe(r,t)}function C1(e){return t=>t.pointerType==="mouse"?e(t):void 0}var vGe=gre,yGe=bR,bGe=vre,wGe=yre,jGe=NR,_Ge=bre,NGe=xP,SGe=jre,CGe=Nre,PGe=Cre,AGe=Are,EGe=Ere,kGe=kre,IGe=Ore,OGe=Dre,vP="DropdownMenu",[TGe,bct]=Cu(vP,[hre]),Ec=hre(),[DGe,Rre]=TGe(vP),Fre=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:o,onOpenChange:i,modal:l=!0}=e,c=Ec(t),d=p.useRef(null),[u,f]=Um({prop:s,defaultProp:o??!1,onChange:i,caller:vP});return a.jsx(DGe,{scope:t,triggerId:nf(),triggerRef:d,contentId:nf(),open:u,onOpenChange:f,onOpenToggle:p.useCallback(()=>f(h=>!h),[f]),modal:l,children:a.jsx(vGe,{...c,open:u,onOpenChange:f,dir:n,modal:l,children:r})})};Fre.displayName=vP;var Lre="DropdownMenuTrigger",$re=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...s}=e,o=Rre(Lre,r),i=Ec(r);return a.jsx(yGe,{asChild:!0,...i,children:a.jsx(Xa.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:JC(t,o.triggerRef),onPointerDown:aa(e.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(o.onOpenToggle(),o.open||l.preventDefault())}),onKeyDown:aa(e.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&o.onOpenToggle(),l.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});$re.displayName=Lre;var MGe="DropdownMenuPortal",Bre=e=>{const{__scopeDropdownMenu:t,...r}=e,n=Ec(t);return a.jsx(bGe,{...n,...r})};Bre.displayName=MGe;var qre="DropdownMenuContent",zre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Rre(qre,r),o=Ec(r),i=p.useRef(!1);return a.jsx(wGe,{id:s.contentId,"aria-labelledby":s.triggerId,...o,...n,ref:t,onCloseAutoFocus:aa(e.onCloseAutoFocus,l=>{i.current||s.triggerRef.current?.focus(),i.current=!1,l.preventDefault()}),onInteractOutside:aa(e.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,u=c.button===2||d;(!s.modal||u)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});zre.displayName=qre;var RGe="DropdownMenuGroup",FGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(jGe,{...s,...n,ref:t})});FGe.displayName=RGe;var LGe="DropdownMenuLabel",Ure=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(_Ge,{...s,...n,ref:t})});Ure.displayName=LGe;var $Ge="DropdownMenuItem",Vre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(NGe,{...s,...n,ref:t})});Vre.displayName=$Ge;var BGe="DropdownMenuCheckboxItem",Wre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(SGe,{...s,...n,ref:t})});Wre.displayName=BGe;var qGe="DropdownMenuRadioGroup",zGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(CGe,{...s,...n,ref:t})});zGe.displayName=qGe;var UGe="DropdownMenuRadioItem",Hre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(PGe,{...s,...n,ref:t})});Hre.displayName=UGe;var VGe="DropdownMenuItemIndicator",Gre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(AGe,{...s,...n,ref:t})});Gre.displayName=VGe;var WGe="DropdownMenuSeparator",Kre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(EGe,{...s,...n,ref:t})});Kre.displayName=WGe;var HGe="DropdownMenuArrow",GGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(kGe,{...s,...n,ref:t})});GGe.displayName=HGe;var KGe="DropdownMenuSubTrigger",Xre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(IGe,{...s,...n,ref:t})});Xre.displayName=KGe;var XGe="DropdownMenuSubContent",Yre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ec(r);return a.jsx(OGe,{...s,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Yre.displayName=XGe;var YGe=Fre,JGe=$re,QGe=Bre,Jre=zre,Qre=Ure,Zre=Vre,ene=Wre,tne=Hre,rne=Gre,nne=Kre,ane=Xre,sne=Yre;const Lf=YGe,$f=JGe,ZGe=Ce.forwardRef(({className:e,inset:t,children:r,...n},s)=>a.jsxs(ane,{ref:s,className:Er("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...n,children:[r,a.jsx(Yg,{className:"ml-auto h-4 w-4"})]}));ZGe.displayName=ane.displayName;const eKe=Ce.forwardRef(({className:e,...t},r)=>a.jsx(sne,{ref:r,className:Er("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));eKe.displayName=sne.displayName;const Qu=Ce.forwardRef(({className:e,sideOffset:t=4,...r},n)=>a.jsx(QGe,{children:a.jsx(Jre,{ref:n,sideOffset:t,className:Er("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Qu.displayName=Jre.displayName;const vs=Ce.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(Zre,{ref:n,className:Er("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...r}));vs.displayName=Zre.displayName;const tKe=Ce.forwardRef(({className:e,children:t,checked:r,...n},s)=>a.jsxs(ene,{ref:s,className:Er("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...n,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(rne,{children:a.jsx(Lm,{className:"h-4 w-4"})})}),t]}));tKe.displayName=ene.displayName;const rKe=Ce.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(tne,{ref:n,className:Er("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(rne,{children:a.jsx(Mue,{className:"h-2 w-2 fill-current"})})}),t]}));rKe.displayName=tne.displayName;const l3=Ce.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(Qre,{ref:n,className:Er("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));l3.displayName=Qre.displayName;const L_=Ce.forwardRef(({className:e,...t},r)=>a.jsx(nne,{ref:r,className:Er("-mx-1 my-1 h-px bg-muted",e),...t}));L_.displayName=nne.displayName;function qa(){try{const e=localStorage.getItem("auth:userProfile");if(e){const r=JSON.parse(e);if(r?.codigo_empresa)return r.codigo_empresa}const t=localStorage.getItem("auth:company");if(t){const r=JSON.parse(t);if(r?.codigo_empresa)return r.codigo_empresa;if(r?.codigo)return r.codigo}return typeof window<"u"&&window.__authProfile&&window.__authProfile.codigo_empresa?window.__authProfile.codigo_empresa:null}catch{return null}}async function $h({somenteAtivas:e=!0,codigoEmpresa:t}={}){const r=t||qa();let n=Q.from("finalizadoras").select("*").order("codigo_interno",{ascending:!0,nullsFirst:!1}).order("nome",{ascending:!0});r&&(n=n.eq("codigo_empresa",r)),e&&(n=n.eq("ativo",!0));const{data:s,error:o}=await n;if(o)throw o;const i=s||[];return i.sort((l,c)=>{const d=parseInt(l?.codigo_interno)||0,u=parseInt(c?.codigo_interno)||0;if(d!==u)return d-u;const f=(l?.nome||"").toLowerCase(),h=(c?.nome||"").toLowerCase();return f.localeCompare(h)}),i}async function nKe(e,t){const r=t||qa(),n={codigo_interno:e?.codigo_interno||null,codigo_sefaz:e?.codigo_sefaz||null,nome:(e?.nome||"").trim(),tipo:e?.tipo||"outros",ativo:e?.ativo??!0,taxa_percentual:e?.taxa_percentual==null?null:Number(e.taxa_percentual)};if(!n.nome)throw new Error("Nome  obrigatrio");r&&(n.codigo_empresa=r);const{data:s,error:o}=await Q.from("finalizadoras").insert(n).select("*").single();if(o)throw o;return s}async function YS({caixaSessaoId:e,codigoEmpresa:t}={}){if(!e)throw new Error("caixaSessaoId  obrigatrio");const r=t||qa();let n=Q.from("caixa_sessoes").select("id, aberto_em, fechado_em, saldo_inicial, saldo_final").eq("id",e).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i=Array.isArray(s)?s[0]:s;if(!i)throw new Error("Sesso no encontrada");const l=i.aberto_em,c=i.fechado_em||new Date().toISOString(),d=await hu({from:l,to:c,codigoEmpresa:r});let u=0,f=0,h=0,m=0;try{let g=Q.from("caixa_movimentacoes").select("tipo, valor").eq("caixa_sessao_id",e);r&&(g=g.eq("codigo_empresa",r));const{data:v}=await g;for(const y of v||[]){const b=Number(y?.valor||0),w=String(y?.tipo||"").toLowerCase();w==="suprimento"?u+=b:w==="sangria"?f+=b:w==="ajuste"?h+=b:w==="troco"&&(m+=b)}}catch{}const x=u+h-f-m;return{...d,saldoInicial:Number(i.saldo_inicial||0),saldoFinal:i.saldo_final!=null?Number(i.saldo_final):null,movimentos:{suprimentos:u,sangrias:f,ajustes:h,troco:m,totalMovimentos:x}}}async function aKe(e,t,r){if(!e)throw new Error("ID invlido");const n=r||qa(),s={codigo_interno:t?.codigo_interno||null,codigo_sefaz:t?.codigo_sefaz||null,nome:(t?.nome||"").trim(),tipo:t?.tipo||"outros",ativo:t?.ativo??!0,taxa_percentual:t?.taxa_percentual==null?null:Number(t.taxa_percentual)};if(!s.nome)throw new Error("Nome  obrigatrio");let o=Q.from("finalizadoras").update(s).eq("id",e);n&&(o=o.eq("codigo_empresa",n));const{data:i,error:l}=await o.select("*").single();if(l)throw l;return i}async function sKe(e,t,r){if(!e)throw new Error("ID invlido");const n=r||qa();let s=Q.from("finalizadoras").update({ativo:!!t}).eq("id",e);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s.select("*").single();if(i)throw i;return o}async function PR({codigoEmpresa:e}={}){const t=e||qa();let r=Q.from("caixa_sessoes").select("id").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;if(!(Array.isArray(n)&&n.length>0)){const i=new Error(" necessrio abrir o caixa antes de criar comandas.");throw i.code="NO_OPEN_CASH_SESSION",i}return!0}async function c3(e=[],t){if(!Array.isArray(e)||e.length===0)return{};const r=t||qa(),n=async i=>{let l=Q.from("comanda_clientes").select(`comanda_id, cliente_id, nome_livre, clientes:clientes${i}(id, nome)`).in("comanda_id",e);return r&&(l=l.eq("codigo_empresa",r)),l};let s=[];try{const{data:i,error:l}=await n("!comanda_clientes_cliente_id_fkey");if(l)throw l;s=i||[]}catch{try{const{data:i,error:l}=await n("!fk_comanda_clientes_cliente");if(l)throw l;s=i||[]}catch{let i=Q.from("comanda_clientes").select("comanda_id, cliente_id, nome_livre").in("comanda_id",e);r&&(i=i.eq("codigo_empresa",r));const{data:l}=await i;s=l||[]}}const o={};for(const i of s){const l=i.comanda_id,c=i.clientes?.nome||i.nome_livre||"";o[l]||(o[l]=[]),c&&o[l].push(c)}for(const i of Object.keys(o))o[i]=Array.from(new Set(o[i])).join(", ");return o}async function d3(e=[],t){if(!Array.isArray(e)||e.length===0)return{};const r=t||qa();let n=Q.from("pagamentos").select("comanda_id, metodo, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").in("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i={};for(const c of s||[]){if(!((c.status||"Pago")!=="Cancelado"&&(c.status||"Pago")!=="Estornado"))continue;const u=c.comanda_id,f=c?.finalizadoras?.nome||c.metodo||"Outros";i[u]||(i[u]=[]),i[u].push(f)}const l={};for(const[c,d]of Object.entries(i))d.length===0?l[c]="":d.length===1?l[c]=d[0]:l[c]=`${d[0]} +${d.length-1}`;return l}async function oKe({comandaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("comandaId  obrigatrio");const r=t||qa();let n=Q.from("comanda_itens").select("produto_id, quantidade").eq("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i=new Map;for(const m of s||[]){const x=m.produto_id,g=Number(m.quantidade||0);i.set(x,(i.get(x)||0)+g)}if(i.size===0)return!0;const l=Array.from(i.keys());let c=Q.from("produtos").select("id, nome, estoque");c=c.in("id",l),r&&(c=c.eq("codigo_empresa",r));const{data:d,error:u}=await c;if(u)throw u;const f=new Map((d||[]).map(m=>[m.id,{nome:m.nome,estoque:Number(m.estoque||0)}])),h=[];for(const[m,x]of i.entries()){const g=f.get(m)||{nome:`Produto ${m}`,estoque:0};x>g.estoque&&h.push({id:m,name:g.nome,solicitado:x,estoque:g.estoque})}if(h.length>0){const m=h.map(g=>`${g.name}: solicitado ${g.solicitado}, estoque ${g.estoque}`).join("; "),x=new Error(`Estoque insuficiente para finalizar: ${m}`);throw x.code="INSUFFICIENT_STOCK_COMANDA",x.items=h,x}return!0}async function Dv({codigoEmpresa:e}={}){const t=e||qa();let r=Q.from("comandas").select("id,status,aberto_em").is("mesa_id",null).in("status",["open","awaiting-payment"]).order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n?.[0]||null}async function $_({codigoEmpresa:e}={}){const t=e||qa();console.log("[getOrCreateComandaBalcao] Iniciando com codigo_empresa:",t),await PR({codigoEmpresa:t});const r=await Dv({codigoEmpresa:t});if(r)return console.log("[getOrCreateComandaBalcao] Comanda existente encontrada:",r),r;const n={status:"open",mesa_id:null,aberto_em:new Date().toISOString()};console.log("[getOrCreateComandaBalcao] Criando nova comanda (codigo_empresa via DEFAULT):",n);const{data:s,error:o}=await Q.from("comandas").insert(n).select("id,status,aberto_em,tipo,codigo_empresa").single();if(o)throw console.error("[getOrCreateComandaBalcao] ERRO ao criar comanda:",o),o;return console.log("[getOrCreateComandaBalcao] Comanda criada com sucesso:",s),console.log("[getOrCreateComandaBalcao] Codigo da comanda criada:",s?.codigo_empresa,"vs esperado:",t),await new Promise(i=>setTimeout(i,100)),s}async function zz({status:e,from:t,to:r,search:n="",limit:s=50,offset:o=0,codigoEmpresa:i}={}){const l=i||qa();let c=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").order("fechado_em",{ascending:!1,nullsFirst:!1}).order("aberto_em",{ascending:!1}).range(o,o+s-1);l&&(c=c.eq("codigo_empresa",l)),e&&Array.isArray(e)&&e.length?c=c.in("status",e):typeof e=="string"&&e!=="all"&&(e==="closed"?c=c.or("status.eq.closed,fechado_em.not.is.null").neq("status","cancelled"):c=c.eq("status",e));const d=v=>{if(!v)return null;if(typeof v=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(v)){const[y,b,w]=v.split("-").map(Number);return new Date(y,b-1,w,0,0,0,0)}return new Date(v)},u=v=>{if(!v)return null;if(typeof v=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(v)){const[y,b,w]=v.split("-").map(Number);return new Date(y,b-1,w,23,59,59,999)}return new Date(v)},f=d(t),h=u(r);f&&(c=c.gte("aberto_em",f.toISOString())),h&&(c=c.lte("aberto_em",h.toISOString()));const m=(n||"").trim();if(m){const v=/^\d+$/.test(m);if(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(m)){const b=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").eq("id",m).eq("codigo_empresa",l),w=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").eq("mesa_id",m).eq("codigo_empresa",l),[j,_]=await Promise.all([b,w]),C=j.data||[],A=_.data||[],S=[...C,...A];return Array.from(new Map(S.map(M=>[M.id,M])).values()).sort((M,O)=>new Date(O.fechado_em||O.aberto_em)-new Date(M.fechado_em||M.aberto_em))}else v?c=c.or(`id.eq.${m},status.ilike.%${m}%`):c=c.or(`status.ilike.%${m}%`)}const{data:x,error:g}=await c;if(g)throw g;return x||[]}async function hu({from:e,to:t,codigoEmpresa:r}={}){const n="[listarResumoPeriodo]",s=r||qa();console.log(`${n} Iniciando consulta`),console.log(`${n} Perodo: ${e||"SEM from"} at ${t||"SEM to"}`),console.log(`${n} codigo_empresa: ${s}`);let o=[];try{let h=Q.from("comandas").select("id, fechado_em").eq("status","closed");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("fechado_em",new Date(e).toISOString())),t&&(h=h.lte("fechado_em",new Date(t).toISOString()));const{data:m,error:x}=await h;if(x)throw x;o=m||[]}catch{o=[]}const i=(o||[]).map(h=>h.id);let l=0,c=0;if(i.length>0)try{let h=Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",i);s&&(h=h.eq("codigo_empresa",s));const{data:m,error:x}=await h;if(x)throw x;for(const g of m||[]){const v=Number(g.quantidade||0)*Number(g.preco_unitario||0),y=Number(g.desconto||0);l+=v,c+=y}}catch{}const d=Math.max(0,l-c),u={};let f=0;try{let h=Q.from("pagamentos").select("metodo, valor, recebido_em, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("recebido_em",new Date(e).toISOString())),t&&(h=h.lte("recebido_em",new Date(t).toISOString())),console.log(`${n} Consultando pagamentos de comandas...`);const{data:m,error:x}=await h;if(x)throw console.error(`${n}  Erro ao buscar pagamentos:`,x),x;console.log(`${n} Total de pagamentos de comandas encontrados: ${(m||[]).length}`);for(const g of m||[]){if(!((g.status||"Pago")!=="Cancelado"&&(g.status||"Pago")!=="Estornado"))continue;const y=g.finalizadoras?.nome||g.metodo||"outros",b=Number(g.valor||0);u[y]=(u[y]||0)+b,f+=b}console.log(`${n}  Resumo comandas por finalizadora:`,u)}catch(h){console.error(`${n}  Exception ao processar pagamentos de comandas:`,h)}try{let h=Q.from("agendamentos").select("id, inicio");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("inicio",new Date(e).toISOString())),t&&(h=h.lte("inicio",new Date(t).toISOString())),console.log(`${n} Consultando agendamentos no perodo...`);const{data:m,error:x}=await h;if(x)throw console.error(`${n}  Erro ao buscar agendamentos:`,x),x;if(console.log(`${n} Total de agendamentos encontrados: ${(m||[]).length}`),m&&m.length>0){const g=m.map(w=>w.id);let v=Q.from("agendamento_participantes").select("valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, finalizadoras!agp_finalizadora_id_fkey(nome, taxa_percentual)").in("agendamento_id",g).eq("status_pagamento","Pago");s&&(v=v.eq("codigo_empresa",s)),console.log(`${n} Consultando participantes pagos...`);const{data:y,error:b}=await v;if(b)throw console.error(`${n}  Erro ao buscar participantes:`,b),b;console.log(`${n} Total de participantes pagos encontrados: ${(y||[]).length}`);for(const w of y||[]){const j=w.finalizadoras?.nome||"Outros";let _=Number(w.valor_cota||0);if(w.aplicar_taxa===!0){const C=Number(w.finalizadoras?.taxa_percentual||0);C>0&&(_=_/(1+C/100),console.log(`${n}  Participante com taxa: valor_cota=${w.valor_cota}, taxa=${C}%, valor_real=${_.toFixed(2)}`))}u[j]=(u[j]||0)+_,f+=_}console.log(`${n}  Resumo agendamentos por finalizadora:`,u)}}catch(h){console.error(`${n}  Exception ao processar pagamentos de agendamentos:`,h)}return console.log(`${n}  RESUMO FINAL por finalizadora:`,u),console.log(`${n} Total de entradas: R$ ${f.toFixed(2)}`),{from:e?new Date(e).toISOString():null,to:t?new Date(t).toISOString():null,totalPorFinalizadora:u,totalEntradas:f,totalVendasBrutas:l,totalDescontos:c,totalVendasLiquidas:d}}async function P1({codigoEmpresa:e}={}){const t=e||qa();let r=null;try{let s=Q.from("caixa_sessoes").select("aberto_em").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(s=s.eq("codigo_empresa",t));const{data:o,error:i}=await s;if(i)throw i;r=o?.[0]?.aberto_em||null}catch{}if(!r)return null;const n=new Date().toISOString();return hu({from:r,to:n,codigoEmpresa:t})}async function one({comandaId:e,codigoEmpresa:t}={}){const r=t||qa();let n=Q.from("pagamentos").select("*, finalizadoras!pagamentos_finalizadora_id_fkey(id, nome, codigo_sefaz, codigo_interno)").order("recebido_em",{ascending:!0});e&&(n=n.eq("comanda_id",e)),r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function ew({searchTerm:e="",limit:t=20,codigoEmpresa:r}={}){const n=r||qa();let s=Q.from("clientes").select("*").eq("status","active").eq("flag_cliente",!0).order("nome",{ascending:!0}).limit(t);n&&(s=s.eq("codigo_empresa",n));const o=(e||"").trim();o&&(/^\d+$/.test(o)?s=s.or(`codigo.eq.${o},nome.ilike.%${o}%,email.ilike.%${o}%,telefone.ilike.%${o}%`):s=s.or(`nome.ilike.%${o}%,email.ilike.%${o}%,telefone.ilike.%${o}%`));const{data:i,error:l}=await s;if(l)throw l;return i||[]}async function wd({codigoEmpresa:e}={}){const t="[listarComandasAbertas]",r=e||qa(),n=async()=>{const s=new Promise((c,d)=>setTimeout(()=>d(new Error("listarComandasAbertas timeout aps 30s")),3e4));let o=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, observacoes, observacoes_atualizadas_em, desconto_tipo, desconto_valor, desconto_motivo, total_com_desconto").is("fechado_em",null).neq("status","cancelled").order("aberto_em",{ascending:!1}).limit(500);r&&(o=o.eq("codigo_empresa",r));const{data:i,error:l}=await Promise.race([o,s]);if(l)throw l;return i||[]};try{try{return await n()}catch(s){if(String(s?.message||"").includes("timeout"))return console.warn(`${t} timeout na primeira tentativa, retornando array vazio`),[];throw s}}catch(s){return console.error(`${t}  EXCEPTION:`,s?.message||s),[]}}async function iKe({mesaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("mesaId  obrigatrio");const r=t||qa();let n=Q.from("comandas").select("id,status,fechado_em").eq("mesa_id",e).is("fechado_em",null).in("status",["open","awaiting-payment"]);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;if(Array.isArray(s)&&s.length>0)throw new Error("No  possvel inativar: existe comanda aberta vinculada a esta mesa.");let i=Q.from("mesas").select("id, numero, status").eq("id",e).limit(1);r&&(i=i.eq("codigo_empresa",r));const{data:l,error:c}=await i;if(c)throw c;const d=l?.[0];if(d&&Number(d.numero)===0)throw new Error("A mesa especial do balco no pode ser inativada.");let u=Q.from("mesas").update({status:"inactive"}).eq("id",e);r&&(u=u.eq("codigo_empresa",r));const{error:f}=await u;if(f)throw f;return!0}async function lKe(e){const t=e||qa();let r=Q.from("mesas").select("id, numero, nome, status").order("numero",{ascending:!0}).limit(500);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n||[]}async function cKe({mesaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("mesaId  obrigatrio");const r=t||qa();let n=Q.from("mesas").update({status:"available"}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{error:s}=await n;if(s)throw s;return!0}async function JS(e=[],t){if(!e||e.length===0)return{};const r=t||qa();let n=Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario").in("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i={};for(const l of s||[]){const c=l.comanda_id,d=Number(l.quantidade||0)*Number(l.preco_unitario||0);i[c]=(i[c]||0)+d}return i}async function Bh(e){const t="[listMesas]",r=e||qa(),n=async()=>{const s=new Promise((c,d)=>setTimeout(()=>d(new Error("listMesas timeout aps 30s")),3e4));let o=Q.from("mesas").select("id, numero, nome, status").neq("status","inactive").order("numero",{ascending:!0}).limit(200);r&&(o=o.eq("codigo_empresa",r));const{data:i,error:l}=await Promise.race([o,s]);if(l)throw l;return i||[]};try{try{return await n()}catch(s){if(String(s?.message||"").includes("timeout"))return console.warn(`${t} timeout na primeira tentativa, retornando array vazio`),[];throw s}}catch(s){return console.error(`${t}  EXCEPTION:`,s?.message||s),[]}}async function dKe({comandaId:e,status:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");let n=Q.from("pagamentos").select("*").eq("comanda_id",e);t&&(n=n.eq("status",t)),n=n.order("created_at",{ascending:!0});const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function Gx({comandaId:e,linhas:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");const n=r||qa();if(Array.isArray(t)){await Q.from("pagamentos").delete().eq("comanda_id",e).eq("status","Pendente");for(const s of t){const o=Number(s?.valor||0);if(o<=0)continue;const i=s?.metodo||s?.metodoNome||"outros";await AR({comandaId:e,finalizadoraId:s?.finalizadoraId||s?.methodId||null,metodo:i,valor:o,status:"Pendente",codigoEmpresa:n,clienteId:s?.clienteId||s?.clientId||null})}}}async function uKe({comandaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("comandaId  obrigatrio");const r=t||qa();let n=Q.from("pagamentos").update({status:"Pago",recebido_em:new Date().toISOString()}).eq("comanda_id",e).eq("status","Pendente");r&&(n=n.eq("codigo_empresa",r));const{error:s}=await n;if(s)throw s;return!0}async function fKe({numero:e,nome:t,codigoEmpresa:r}={}){const n=r||qa();let s=e;if(!s){let i=Q.from("mesas").select("numero").order("numero",{ascending:!1}).limit(1);n&&(i=i.eq("codigo_empresa",n));const{data:l,error:c}=await i;if(c)throw c;s=(l?.[0]?.numero||0)+1}const o={numero:s,status:"available"};t&&typeof t=="string"&&t.trim()&&(o.nome=t.trim()),n&&(o.codigo_empresa=n);try{const{data:i,error:l}=await Q.from("mesas").insert(o).select("*").single();if(l)throw l;return i}catch(i){const l=String(i?.message||i||"");if(/column\s+\"?nome\"?\s+of\s+relation/i.test(l)||/column\s+\"?nome\"?\s+does not exist/i.test(l)){const c={numero:s,status:"available"};n&&(c.codigo_empresa=n);const{data:d,error:u}=await Q.from("mesas").insert(c).select("*").single();if(u)throw u;return d}throw i}}async function wm({saldoInicial:e=0,codigoEmpresa:t}={}){const r=t||qa();let n=Q.from("caixa_sessoes").select("id,status,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;if(s&&s.length>0){const d=s[0];try{const u=new Date(d.aberto_em),f=new Date;if(u.toDateString()!==f.toDateString()){try{const b=await wd({codigoEmpresa:r});if(Array.isArray(b)&&b.length>0)return console.warn("[ensureCaixaAberto] Sesso de dia anterior detectada, mas h comandas abertas. No fechar automaticamente."),d}catch{}const m=f.toISOString();let x=0,g=0;try{const b=await hu({from:d.aberto_em,to:m,codigoEmpresa:r});x=Number(b?.totalEntradas||0)}catch{}try{let b=Q.from("caixa_movimentacoes").select("tipo,valor").eq("caixa_sessao_id",d.id);r&&(b=b.eq("codigo_empresa",r));const{data:w}=await b;for(const j of w||[]){const _=Number(j?.valor||0),C=String(j?.tipo||"").toLowerCase();C==="suprimento"||C==="ajuste"?g+=_:(C==="sangria"||C==="troco")&&(g-=_)}}catch{}const v=Number(d?.saldo_inicial||0)+x+g;let y=Q.from("caixa_sessoes").update({status:"closed",saldo_final:v,fechado_em:m}).eq("id",d.id).eq("status","open");r&&(y=y.eq("codigo_empresa",r)),await y;try{const b=await YS({caixaSessaoId:d.id,codigoEmpresa:r}).catch(async()=>await hu({from:d.aberto_em,to:m,codigoEmpresa:r})),w={codigo_empresa:r||qa(),caixa_sessao_id:d.id,periodo_de:b?.from||d.aberto_em,periodo_ate:b?.to||m,total_bruto:Number(b?.totalVendasBrutas||0),total_descontos:Number(b?.totalDescontos||0),total_liquido:Number(b?.totalVendasLiquidas||0),total_entradas:Number(b?.totalEntradas||0),por_finalizadora:b?.totalPorFinalizadora||{}},j=w.por_finalizadora;await Q.from("caixa_resumos").insert({...w,por_finalizadora:j&&typeof j!="string"?JSON.stringify(j):j})}catch{}}else{try{if(d?.saldo_inicial==null&&e!=null){let m=Q.from("caixa_sessoes").update({saldo_inicial:Number(e)||0}).eq("id",d.id);return r&&(m=m.eq("codigo_empresa",r)),await m,{...d,saldo_inicial:Number(e)||0}}}catch{}return d}}catch{}return d}const i={status:"open",saldo_inicial:e};r&&(i.codigo_empresa=r);const{data:l,error:c}=await Q.from("caixa_sessoes").insert(i).select("id,status,aberto_em").single();if(c)throw c;return l}async function qh({codigoEmpresa:e}={}){const t=e||qa();let r=Q.from("caixa_sessoes").select("id,status,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n?.[0]||null}async function ine({saldoFinal:e=null,valorFinalDinheiro:t=null,codigoEmpresa:r}={}){console.log("[fecharCaixa] Iniciando fechamento:",{valorFinalDinheiro:t,saldoFinal:e,codigoEmpresa:r});const n=r||qa();try{console.log("[fecharCaixa]  Limpeza preventiva: ajustando apenas comandas cancelled/closed sem fechado_em...");const{data:y}=await Q.from("comandas").select("id, status, fechado_em").eq("codigo_empresa",n).is("fechado_em",null).in("status",["cancelled","closed"]);if(y&&y.length>0){console.log(`[fecharCaixa]  Encontradas ${y.length} comandas (cancelled/closed) sem fechado_em, ajustando...`);const b=new Date().toISOString();for(const w of y)try{await Q.from("comandas").update({fechado_em:b}).eq("id",w.id).eq("codigo_empresa",n),console.log(`[fecharCaixa]  Comanda ${w.id} (status: ${w.status}) ajustada com fechado_em`)}catch{}}else console.log("[fecharCaixa]  Nenhuma comanda cancelled/closed sem fechado_em encontrada")}catch(y){console.warn("[fecharCaixa]  Erro na limpeza preventiva:",y?.message)}try{let y=await wd({codigoEmpresa:n});if(y=y||[],console.log(`[fecharCaixa]  Comandas abertas encontradas: ${y.length}`,y.map(w=>({id:w.id,status:w.status,mesa:w.mesa_id}))),y&&y.length>0){const w=y.map(j=>`${j.id}${j.mesa_id?`@mesa:${j.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${y.length} comanda(s) aberta(s). Feche todas as comandas antes de encerrar o caixa.`)}let b=0;for(;b<12&&(y=await wd({codigoEmpresa:n}),!(!y||y.length===0));)await new Promise(w=>setTimeout(w,250)),b++;if(y&&y.length>0){const w=y.map(A=>A.id);let j=new Map,_=new Map;try{if(w.length>0){let A=Q.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",w);n&&(A=A.eq("codigo_empresa",n));const{data:S}=await A;j=new Map;for(const P of S||[]){const M=P.comanda_id,O=Number(P.quantidade||0);j.set(M,(j.get(M)||0)+O)}}}catch{}try{if(w.length>0){let A=Q.from("pagamentos").select("comanda_id, status").in("comanda_id",w);n&&(A=A.eq("codigo_empresa",n));const{data:S}=await A;_=new Map;for(const P of S||[]){const M=String(P?.status||"Pago");if(M==="Cancelado"||M==="Estornado")continue;const O=P.comanda_id;_.set(O,(_.get(O)||0)+1)}}}catch{}for(const A of y){const S=Number(j.get(A.id)||0)>0,P=Number(_.get(A.id)||0)>0;if(!S&&!P)try{await V0({comandaId:A.id,codigoEmpresa:n})}catch{}}let C=await wd({codigoEmpresa:n});if(C=C||[],C.length>0){const A=C.map(O=>O.id);let S=new Map,P=new Map;try{if(A.length>0){let O=Q.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",A);n&&(O=O.eq("codigo_empresa",n));const{data:I}=await O;S=new Map;for(const T of I||[]){const k=T.comanda_id,$=Number(T.quantidade||0);S.set(k,(S.get(k)||0)+$)}}}catch{}try{if(A.length>0){let O=Q.from("pagamentos").select("comanda_id, status").in("comanda_id",A);n&&(O=O.eq("codigo_empresa",n));const{data:I}=await O;P=new Map;for(const T of I||[]){const k=String(T?.status||"Pago");if(k==="Cancelado"||k==="Estornado")continue;const $=T.comanda_id;P.set($,(P.get($)||0)+1)}}}catch{}const M=C.filter(O=>Number(S.get(O.id)||0)>0||Number(P.get(O.id)||0)>0);if(M.length>0){const O=M.map(I=>`${I.id}${I.mesa_id?`@mesa:${I.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${M.length} comandas abertas. IDs: ${O}. Feche todas antes de encerrar o caixa.`)}}}}catch(y){if(y&&/Existem \d+ comandas/.test(y.message||""))throw y;const b=new Error("Falha ao validar comandas abertas. Tente novamente e verifique sua conexo.");throw b.code="CASH_CLOSE_VALIDATION_FAILED",b}let s=Q.from("caixa_sessoes").select("id,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s;if(i)throw i;const l=o?.[0]?.id||null,c=o?.[0]?.aberto_em||null,d=Number(o?.[0]?.saldo_inicial||0);if(!l)throw new Error("Nenhuma sesso de caixa aberta encontrada.");const u=new Date().toISOString();let f=0,h=0;try{const y=await hu({from:c,to:u,codigoEmpresa:n});f=Number(y?.totalEntradas||0)}catch{}try{let y=Q.from("caixa_movimentacoes").select("tipo, valor").eq("caixa_sessao_id",l);n&&(y=y.eq("codigo_empresa",n));const{data:b}=await y;for(const w of b||[]){const j=Number(w?.valor||0),_=String(w?.tipo||"").toLowerCase();_==="suprimento"||_==="ajuste"?h+=j:(_==="sangria"||_==="troco")&&(h-=j)}}catch{}const m=e!=null?Number(e):d+f+h;try{let y=await wd({codigoEmpresa:n});if(y=y||[],y.length>0){const b=y.map(C=>C.id);let w=new Map,j=new Map;try{if(b.length>0){let C=Q.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",b);n&&(C=C.eq("codigo_empresa",n));const{data:A}=await C;w=new Map;for(const S of A||[]){const P=S.comanda_id,M=Number(S.quantidade||0);w.set(P,(w.get(P)||0)+M)}}}catch{}try{if(b.length>0){let C=Q.from("pagamentos").select("comanda_id, status").in("comanda_id",b);n&&(C=C.eq("codigo_empresa",n));const{data:A}=await C;j=new Map;for(const S of A||[]){const P=String(S?.status||"Pago");if(P==="Cancelado"||P==="Estornado")continue;const M=S.comanda_id;j.set(M,(j.get(M)||0)+1)}}}catch{}for(const C of y){const A=Number(w.get(C.id)||0)>0,S=Number(j.get(C.id)||0)>0;if(!A&&!S)try{await V0({comandaId:C.id,codigoEmpresa:n})}catch{}}let _=await wd({codigoEmpresa:n});if(_=_||[],_.length>0){const C=_.map(A=>`${A.id}${A.mesa_id?`@mesa:${A.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${_.length} comandas abertas. IDs: ${C}. Feche todas antes de encerrar o caixa.`)}}}catch(y){if(!(y&&y.message)){const b=new Error("Falha ao validar comandas abertas no momento do fechamento. Tente novamente.");throw b.code="CASH_CLOSE_FINAL_CHECK_FAILED",b}throw y}let x=Q.from("caixa_sessoes").update({status:"closed",saldo_final:m,fechado_em:u}).eq("id",l).eq("status","open");n&&(x=x.eq("codigo_empresa",n));const{data:g,error:v}=await x.select("id,status,fechado_em,saldo_final").single();if(v){const y=String(v.message||"");if(y.toLowerCase().includes("row")||y.toLowerCase().includes("single")){let b=Q.from("caixa_sessoes").select("id,status,fechado_em,saldo_final").eq("id",l).limit(1);n&&(b=b.eq("codigo_empresa",n));const{data:w}=await b;if(w&&w[0])return w[0]}throw v}try{if(c&&u&&g?.status==="closed"){let y;try{y=await YS({caixaSessaoId:l,codigoEmpresa:n})}catch{y=await hu({from:c,to:u,codigoEmpresa:n})}const b={codigo_empresa:n||qa(),caixa_sessao_id:l,periodo_de:y?.from||c,periodo_ate:y?.to||u,total_bruto:Number(y?.totalVendasBrutas||0),total_descontos:Number(y?.totalDescontos||0),total_liquido:Number(y?.totalVendasLiquidas||0),total_entradas:Number(y?.totalEntradas||0),por_finalizadora:y?.totalPorFinalizadora||{}},w=t!=null?Number(t):null,j=w!=null?w-Number(m||0):null;console.log("[fecharCaixa] Valores para snapshot:",{contado:w,diferenca:j,efetivoSaldoFinal:m,valorFinalDinheiroOriginal:t});const C=await(async A=>{const S={...A},P=S.por_finalizadora;P&&typeof P!="string"&&(S.por_finalizadora=JSON.stringify(P));let M=!0,O=!0;try{const z=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),F=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");z==="no"&&(M=!1),F==="no"&&(O=!1)}catch{}if(!M||!O)try{let z=Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:F}=await z;if(!F){M=!0,O=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}if(!M&&!O)return await Q.from("caixa_resumos").insert(S);let I={...S};M&&w!=null&&(I.valor_final_dinheiro=w),O&&j!=null&&(I.diferenca_dinheiro=j),console.log("[fecharCaixa] Tentando inserir snapshot com:",{supportValor:M,supportDif:O,contado:w,diferenca:j,hasValorFinalDinheiro:"valor_final_dinheiro"in I});const T=await Q.from("caixa_resumos").insert(I);if(!T.error)return T;const k=`${T.error?.message||""} ${T.error?.details||""}`.toLowerCase(),$=T.error?.code;if($==="42703"||$==="PGRST204"||k.includes("column")||k.includes("schema cache")){try{I.valor_final_dinheiro!==void 0&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),I.diferenca_dinheiro!==void 0&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}return await Q.from("caixa_resumos").insert(S)}return T})(b);if(C.error)throw console.error("[fecharCaixa] Erro ao inserir snapshot:",C.error),C.error;console.log("[fecharCaixa]  Snapshot inserido com sucesso");try{const{data:A}=await Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").eq("caixa_sessao_id",l).order("criado_em",{ascending:!1}).limit(1).single();console.log("[fecharCaixa] Verificao ps-insert:",A)}catch(A){console.warn("[fecharCaixa] Falha ao verificar snapshot:",A?.message)}}}catch(y){console.warn("[fecharCaixa] Falha ao gravar snapshot de fechamento:",y)}try{let y=Q.from("caixa_sessoes").select("id,aberto_em,saldo_inicial").eq("status","open");n&&(y=y.eq("codigo_empresa",n));const{data:b}=await y;if(Array.isArray(b)&&b.length>0)for(const w of b)try{const j=w?.aberto_em,_=Number(w?.saldo_inicial||0),C=new Date().toISOString();let A=0,S=0;try{const M=await hu({from:j,to:C,codigoEmpresa:n});A=Number(M?.totalEntradas||0)}catch{}try{let M=Q.from("caixa_movimentacoes").select("tipo,valor").eq("caixa_sessao_id",w.id);n&&(M=M.eq("codigo_empresa",n));const{data:O}=await M;for(const I of O||[]){const T=Number(I?.valor||0),k=String(I?.tipo||"").toLowerCase();k==="suprimento"||k==="ajuste"?S+=T:(k==="sangria"||k==="troco")&&(S-=T)}}catch{}const P=_+A+S;await Q.from("caixa_sessoes").update({status:"closed",saldo_final:P,fechado_em:C}).eq("id",w.id).eq("status","open").eq(n?"codigo_empresa":"id",n||w.id);try{const M=await YS({caixaSessaoId:w.id,codigoEmpresa:n}).catch(async()=>await hu({from:j,to:C,codigoEmpresa:n})),O={codigo_empresa:n||qa(),caixa_sessao_id:w.id,periodo_de:M?.from||j,periodo_ate:M?.to||C,total_bruto:Number(M?.totalVendasBrutas||0),total_descontos:Number(M?.totalDescontos||0),total_liquido:Number(M?.totalVendasLiquidas||0),total_entradas:Number(M?.totalEntradas||0),por_finalizadora:M?.totalPorFinalizadora||{}},I=O.por_finalizadora;await Q.from("caixa_resumos").insert({...O,por_finalizadora:I&&typeof I!="string"?JSON.stringify(I):I})}catch{}}catch(j){try{console.warn("[fecharCaixa] Saneamento: falhou ao fechar sesso remanescente",w?.id,j?.message||j)}catch{}}}catch{}return g}async function lne({from:e,to:t,limit:r=50,codigoEmpresa:n}={}){console.log("[listarFechamentosCaixa] Iniciando busca de fechamentos",{from:e,to:t,limit:r});const s=n||qa();let o=Q.from("caixa_sessoes").select("id, aberto_em, fechado_em, saldo_inicial, saldo_final, status").eq("status","closed").order("fechado_em",{ascending:!1}).limit(r);s&&(o=o.eq("codigo_empresa",s)),e&&(o=o.gte("fechado_em",`${e}T00:00:00`)),t&&(o=o.lte("fechado_em",`${t}T23:59:59`));const{data:i,error:l}=await o;if(l)throw l;const c=Array.isArray(i)?i:[];if(console.log("[listarFechamentosCaixa] Sesses fechadas encontradas:",c.length),c.length===0)return[];const d=c.map(m=>m.id);let u=[];try{let m=!0,x=!0;try{const j=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),_=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");j==="no"&&(m=!1),_==="no"&&(x=!1)}catch{}if(!m||!x)try{let j=Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:_}=await j;if(!_){m=!0,x=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}const g=["caixa_sessao_id"];m&&g.push("valor_final_dinheiro"),x&&g.push("diferenca_dinheiro");const v=g.join(", ");let y=Q.from("caixa_resumos").select(v).in("caixa_sessao_id",d).order("criado_em",{ascending:!1});s&&(y=y.eq("codigo_empresa",s));let{data:b,error:w}=await y;if(w){const j=w?.code,_=`${w?.message||""} ${w?.details||""}`.toLowerCase();if(j==="42703"||j==="PGRST204"||_.includes("column")||_.includes("schema cache")){try{m&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),x&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}let A=Q.from("caixa_resumos").select("caixa_sessao_id").in("caixa_sessao_id",d).order("criado_em",{ascending:!1});s&&(A=A.eq("codigo_empresa",s));const{data:S}=await A;u=S||[]}else throw w}else u=b||[]}catch(m){console.warn("[listarFechamentosCaixa] Erro ao buscar snapshots:",m?.message),u=[]}console.log("[listarFechamentosCaixa] Snapshots encontrados:",u.length,u);const f=new Map(u.map(m=>[m.caixa_sessao_id,m])),h=c.map(m=>{const x=f.get(m.id),g={...m,valor_final_dinheiro:x?.valor_final_dinheiro??null,diferenca_dinheiro:x?.diferenca_dinheiro??null};return x&&console.log(`[listarFechamentosCaixa] Sesso ${m.id} enriquecida com snapshot:`,{valor_final_dinheiro:x.valor_final_dinheiro,diferenca_dinheiro:x.diferenca_dinheiro}),g});return console.log("[listarFechamentosCaixa] Resultado final:",h.length,"sesses com dados enriquecidos"),h}async function QS({caixaSessaoId:e,codigoEmpresa:t}={}){if(!e)throw new Error("caixaSessaoId  obrigatrio");const r=t||qa();let n=null;try{let s=!0,o=!0;try{const f=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),h=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");f==="no"&&(s=!1),h==="no"&&(o=!1)}catch{}if(!s||!o)try{let f=Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:h}=await f;if(!h){s=!0,o=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}const i=["caixa_sessao_id","periodo_de","periodo_ate","total_bruto","total_descontos","total_liquido","total_entradas","por_finalizadora"];s&&i.push("valor_final_dinheiro"),o&&i.push("diferenca_dinheiro");const l=i.join(", ");let c=Q.from("caixa_resumos").select(l).eq("caixa_sessao_id",e).order("criado_em",{ascending:!1}).limit(1);r&&(c=c.eq("codigo_empresa",r));let{data:d,error:u}=await c;if(u){const f=u?.code,h=`${u?.message||""} ${u?.details||""}`.toLowerCase();if(f==="42703"||f==="PGRST204"||h.includes("column")||h.includes("schema cache")){try{s&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),o&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}let x=Q.from("caixa_resumos").select("caixa_sessao_id, periodo_de, periodo_ate, total_bruto, total_descontos, total_liquido, total_entradas, por_finalizadora").eq("caixa_sessao_id",e).order("criado_em",{ascending:!1}).limit(1);r&&(x=x.eq("codigo_empresa",r));const{data:g}=await x;n=g?.[0]||null}else throw u}else n=d?.[0]||null}catch(s){try{console.warn("[getCaixaResumo] Snapshot select falhou, usando fallback dinmico:",s?.message||s)}catch{}}if(!n||typeof n.saldo_inicial>"u"||typeof n.saldo_final>"u"){const s=await YS({caixaSessaoId:e,codigoEmpresa:r});let o=null;try{let i=Q.from("caixa_sessoes").select("saldo_inicial, saldo_final").eq("id",e).limit(1);r&&(i=i.eq("codigo_empresa",r));const{data:l}=await i;o=l?.[0]||null}catch{}n={codigo_empresa:r,caixa_sessao_id:e,periodo_de:s?.from||null,periodo_ate:s?.to||null,total_bruto:Number(s?.totalVendasBrutas||0),total_descontos:Number(s?.totalDescontos||0),total_liquido:Number(s?.totalVendasLiquidas||0),total_entradas:Number(s?.totalEntradas||0),por_finalizadora:s?.totalPorFinalizadora||{},saldo_inicial:Number(o?.saldo_inicial??s?.saldoInicial??0),saldo_final:o?.saldo_final!=null?Number(o.saldo_final):null,movimentos:s?.movimentos||{suprimentos:0,sangrias:0,ajustes:0,troco:0,totalMovimentos:0}}}else if(typeof n.por_finalizadora=="string")try{n.por_finalizadora=JSON.parse(n.por_finalizadora)}catch{n.por_finalizadora={}}return n}async function u3({tipo:e,valor:t,observacao:r="",caixaSessaoId:n,codigoEmpresa:s}={}){const o=s||qa();if(!e||!["sangria","suprimento","troco","ajuste"].includes(e))throw new Error("Tipo invlido de movimentao");let i=n;if(!i){let u=Q.from("caixa_sessoes").select("id").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);o&&(u=u.eq("codigo_empresa",o));const{data:f,error:h}=await u;if(h)throw h;i=f?.[0]?.id||null}if(!i)throw new Error("Sesso de caixa no encontrada para registrar movimentao");const l={codigo_empresa:o,caixa_sessao_id:i,tipo:e,valor:Math.max(0,Number(t)||0),observacao:(r||"").trim()||null},{data:c,error:d}=await Q.from("caixa_movimentacoes").insert(l).select("*").single();if(d)throw d;return c}async function $g({caixaSessaoId:e,codigoEmpresa:t}={}){const r=t||qa();if(!e)throw new Error("caixaSessaoId  obrigatrio");let n=Q.from("caixa_movimentacoes").select("*").eq("caixa_sessao_id",e).order("criado_em",{ascending:!0});r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function mKe({mesaId:e,codigoEmpresa:t}={}){const r=t||qa();await PR({codigoEmpresa:r}),console.log(`[abrirComandaParaMesa] Iniciando para mesaId: ${e}, codigo_empresa: ${r}`);try{const n={status:"open",aberto_em:new Date().toISOString()};e&&(n.mesa_id=e),console.log("[abrirComandaParaMesa] Payload (codigo_empresa via DEFAULT):",n);const{data:s,error:o}=await Q.from("comandas").insert(n).select("*").single();if(o)throw console.error("[abrirComandaParaMesa] ERRO ao criar comanda:",o),o;return console.log("[abrirComandaParaMesa]  Comanda criada:",s),await new Promise(i=>setTimeout(i,100)),s}catch(n){throw console.error("[abrirComandaParaMesa] ERRO:",n),n}}async function hKe({mesaId:e,codigoEmpresa:t}){const r=t||qa();let n=Q.from("comandas").select("id,status,aberto_em,fechado_em").eq("mesa_id",e).is("fechado_em",null).in("status",["open","awaiting-payment"]).order("aberto_em",{ascending:!1}).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s?.[0]||null}async function ii({comandaId:e,codigoEmpresa:t}){const r=t||qa();let n=Q.from("comanda_itens").select("*").eq("comanda_id",e).order("created_at",{ascending:!0});r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function kh({codigoEmpresa:e}){const t=e||qa();let r=Q.from("comandas").select("id").is("fechado_em",null);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;if(console.log("[listarItensDeTodasComandasAbertas] Comandas abertas:",n?.length||0,"IDs:",n?.map(d=>d.id)),!n||n.length===0)return console.log("[listarItensDeTodasComandasAbertas] Nenhuma comanda aberta encontrada"),[];const o=n.map(d=>d.id);let i=Q.from("comanda_itens").select("produto_id, quantidade").in("comanda_id",o);t&&(i=i.eq("codigo_empresa",t));const{data:l,error:c}=await i;if(c)throw c;return console.log("[listarItensDeTodasComandasAbertas] Itens encontrados:",l?.length||0),l&&l.length>0&&console.log("[listarItensDeTodasComandasAbertas] Detalhes dos itens:",l),l||[]}const V2=new Map;async function pKe({mesaId:e,codigoEmpresa:t}={}){const r=`${e}:${t||qa()}`;if(V2.has(r))return console.log(`[getOrCreateComandaForMesa]  Operao j em andamento para mesa ${e}, aguardando...`),V2.get(r);const n=t||qa(),s=(async()=>{try{await PR({codigoEmpresa:n}),console.log(`[getOrCreateComandaForMesa]  Criando nova comanda para mesa ${e}`);const o=await hKe({mesaId:e,codigoEmpresa:n});if(o){console.log(`[getOrCreateComandaForMesa]  Comanda existente ${o.id} encontrada, verificando se est vazia...`);let l=!1,c=!1;try{l=(await ii({comandaId:o.id,codigoEmpresa:n})||[]).length>0}catch{}try{const{data:d}=await Q.from("pagamentos").select("id, status").eq("comanda_id",o.id).eq("codigo_empresa",n);c=(d||[]).filter(f=>{const h=String(f?.status||"Pago");return h!=="Cancelado"&&h!=="Estornado"}).length>0}catch{}if(!l&&!c){console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} est vazia, fechando automaticamente...`);try{await V0({comandaId:o.id,codigoEmpresa:n}),console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} fechada com sucesso`)}catch(d){console.warn(`[getOrCreateComandaForMesa]  Erro ao fechar comanda ${o.id}:`,d?.message)}}else console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} tem dados (itens: ${l}, pagamentos: ${c}), no ser fechada automaticamente`)}console.log(`[getOrCreateComandaForMesa]  Criando comanda zerada para mesa ${e}`);const i=await mKe({mesaId:e,codigoEmpresa:n});return console.log(`[getOrCreateComandaForMesa]  Comanda ${i.id} criada com sucesso`),i}finally{V2.delete(r),console.log(`[getOrCreateComandaForMesa]  Lock liberado para mesa ${e}`)}})();return V2.set(r,s),s}async function tw({comandaId:e,clienteIds:t=[],nomesLivres:r=[],codigoEmpresa:n,replace:s=!1}={}){const o=n||qa();if(!e)throw new Error("comandaId  obrigatrio");let i=[],l=[];try{i=Array.isArray(t)?t:t?[t]:[]}catch(m){console.warn("[adicionarClientesAComanda] Erro ao processar clienteIds:",m),i=[]}try{l=Array.isArray(r)?r:r?[r]:[]}catch(m){console.warn("[adicionarClientesAComanda] Erro ao processar nomesLivres:",m),l=[]}const c=i.map(m=>m&&typeof m=="object"?m.id||m.cliente_id||m.value:m).filter(Boolean),d=l.map(m=>m&&typeof m=="object"?m.nome||m.name||m.label:m).map(m=>String(m||"").trim()).filter(Boolean);if(console.log(`[adicionarClientesAComanda] Adicionando clientes  comanda ${e}:`,{clienteIds:c,nomesLivres:d,codigo:o,replace:s}),s){const{error:m}=await Q.from("comanda_clientes").delete().eq("comanda_id",e);m&&console.warn("[adicionarClientesAComanda] Erro ao limpar clientes existentes:",m)}const u=[];if(Array.isArray(c)){let m=[];if(!s)try{const{data:g}=await Q.from("comanda_clientes").select("cliente_id, nome_livre").eq("comanda_id",e);m=Array.isArray(g)?g:[]}catch{}const x=new Set((m||[]).map(g=>g.cliente_id).filter(Boolean));for(let g=0;g<c.length;g++){const v=c[g];v&&(!s&&x.has(v)||u.push({comanda_id:e,cliente_id:v}))}}if(Array.isArray(d))for(let m=0;m<d.length;m++){const g=(d[m]||"").trim();g&&u.push({comanda_id:e,nome_livre:g})}if(u.length===0)return console.log("[adicionarClientesAComanda] Nenhum cliente para adicionar"),!0;let f=[];Array.isArray(u)&&(f=u.map(m=>o?{...m,codigo_empresa:o}:m)),console.log("[adicionarClientesAComanda] Payload para insero:",f);const{error:h}=await Q.from("comanda_clientes").insert(f);if(h)throw console.error("[adicionarClientesAComanda] ERRO ao inserir clientes:",h),h;return console.log("[adicionarClientesAComanda] Clientes adicionados com sucesso"),!0}async function rl({comandaId:e,codigoEmpresa:t}={}){if(t||qa(),!e)throw new Error("comandaId  obrigatrio");try{const{data:r,error:n}=await Q.from("comanda_clientes").select("id, cliente_id, nome_livre, clientes:clientes!comanda_clientes_cliente_id_fkey(id, codigo, nome, email, telefone)").eq("comanda_id",e).order("created_at",{ascending:!0});if(n)throw n;return(r||[]).map(s=>({id:s.id,tipo:s.cliente_id?"cadastrado":"livre",nome:s.clientes?.nome||s.nome_livre,cliente_id:s.cliente_id}))}catch{try{const{data:n,error:s}=await Q.from("comanda_clientes").select("id, cliente_id, nome_livre, clientes:clientes!fk_comanda_clientes_cliente(id, nome, email, telefone)").eq("comanda_id",e).order("created_at",{ascending:!0});if(s)throw s;return(n||[]).map(o=>({id:o.id,tipo:o.cliente_id?"cadastrado":"livre",nome:o.clientes?.nome||o.nome_livre,cliente_id:o.cliente_id}))}catch{const{data:s,error:o}=await Q.from("comanda_clientes").select("id, cliente_id, nome_livre").eq("comanda_id",e).order("created_at",{ascending:!0});if(o)throw o;return(s||[]).map(i=>({id:i.id,tipo:i.cliente_id?"cadastrado":"livre",nome:i.nome_livre||"",cliente_id:i.cliente_id}))}}}async function f3({comandaId:e,produtoId:t,descricao:r,quantidade:n,precoUnitario:s,desconto:o=0,codigoEmpresa:i}){const l=i||qa();console.log(`[adicionarItem] Adicionando item  comanda ${e}:`,{produtoId:t,descricao:r,quantidade:n,precoUnitario:s,codigo:l});try{let f=Q.from("produtos").select("id, estoque, estoque_minimo, nome").eq("id",t).limit(1);l&&(f=f.eq("codigo_empresa",l));const{data:h,error:m}=await f;if(m)throw m;const x=Array.isArray(h)?h[0]:h;if(x){const g=Number(x.estoque??0),v=Number(x.estoque_minimo??0),y=Number(n??1);if(g<=0){const A=new Error(`Produto sem estoque: ${x.nome||""}`.trim());throw A.code="OUT_OF_STOCK",A}let b=Q.from("comanda_itens").select("quantidade").eq("comanda_id",e).eq("produto_id",t);l&&(b=b.eq("codigo_empresa",l));const{data:w,error:j}=await b;if(j)throw j;const _=Array.isArray(w)&&w.length?w.reduce((A,S)=>A+Number(S?.quantidade||0),0):0;if(_+y>g){const A=new Error(`Estoque insuficiente. Em comanda: ${_}, solicitado: +${y}, disponvel: ${g}`);throw A.code="INSUFFICIENT_STOCK",A}if(g<=v&&g>0)try{console.warn(`[adicionarItem] Aviso: estoque baixo para produto '${x.nome}' (estoque=${g}, minimo=${v})`)}catch{}}}catch(f){throw f}const c={comanda_id:e,produto_id:t,descricao:r,quantidade:n,preco_unitario:s,desconto:o};l&&(c.codigo_empresa=l);const{data:d,error:u}=await Q.from("comanda_itens").insert(c).select("*").single();if(u)throw u;return d}async function eu({itemId:e,quantidade:t,codigoEmpresa:r}){const n=r||qa();let s=Q.from("comanda_itens").select("id, quantidade, produto_id, comanda_id").eq("id",e).limit(1);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s;if(i)throw i;const l=Array.isArray(o)?o[0]:o,c=Number(t||0);if(!l)throw new Error("Item no encontrado");const d=Number(l.quantidade||0);if(c-d>0){let x=Q.from("produtos").select("id, estoque, nome, estoque_minimo").eq("id",l.produto_id).limit(1);n&&(x=x.eq("codigo_empresa",n));const{data:g,error:v}=await x;if(v)throw v;const y=Array.isArray(g)?g[0]:g;if(y){const b=Number(y.estoque??0);let w=Q.from("comanda_itens").select("quantidade").eq("comanda_id",l.comanda_id).eq("produto_id",l.produto_id).neq("id",l.id);n&&(w=w.eq("codigo_empresa",n));const{data:j,error:_}=await w;if(_)throw _;const C=Array.isArray(j)&&j.length?j.reduce((M,O)=>M+Number(O?.quantidade||0),0):0;if(C+c>b){const M=new Error(`Estoque insuficiente. Em comanda (outros itens): ${C}, novo para este item: ${c}, disponvel: ${b}`);throw M.code="INSUFFICIENT_STOCK",M}const S=Number(y.estoque_minimo??0),P=b-(C+c);if(P<=S&&P>=0)try{console.warn(`[atualizarQuantidadeItem] Aviso: produto '${y.nome}' atingiu nvel de estoque baixo (restante=${P}, minimo=${S})`)}catch{}}}let f=Q.from("comanda_itens").update({quantidade:c}).eq("id",e);n&&(f=f.eq("codigo_empresa",n));const{data:h,error:m}=await f.select("*").single();if(m)throw m;return h}async function Mv({itemId:e,codigoEmpresa:t}){const r=t||qa();let n=Q.from("comanda_itens").delete().eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("id");if(o&&o.code!=="PGRST116")throw o;return Array.isArray(s)&&s.length>0}function gKe(e){if(!e)return!1;const t=e.code?String(e.code):"",r=[e.message,e.details,e.hint].filter(Boolean).join(" ").toLowerCase();return t==="22P02"||r.includes("invalid input value for enum")}async function AR({comandaId:e,finalizadoraId:t,metodo:r,valor:n,status:s="Pago",codigoEmpresa:o,clienteId:i=null}){const l=o||qa();if(!l)throw new Error("Empresa no identificada (codigo_empresa ausente).");const c=s&&["Pendente","Pago","Estornado","Cancelado"].includes(s)?s:"Pago",d=["dinheiro","credito","debito","pix","voucher","outros"],f=(m=>{if(!m)return"outros";const x=String(m).toLowerCase().trim(),v={"cartao credito":"credito","carto credito":"credito","cartao debito":"debito","carto debito":"debito","carto de credito":"credito","carto de dbito":"debito","cartao de credito":"credito","cartao de debito":"debito"}[x]||x;return d.includes(v)?v:"outros"})(r),h={comanda_id:e,finalizadora_id:t||null,metodo:f,valor:Math.max(0,Number(n)||0),status:c,recebido_em:new Date().toISOString(),codigo_empresa:l};i&&(h.cliente_id=i),console.log("[registrarPagamento] Iniciando registro de pagamento:",{comandaId:e,finalizadoraId:t,metodo:f,valor:h.valor,status:h.status,codigoEmpresa:l,payload:h});try{const{data:m,error:x}=await Q.from("pagamentos").insert(h).select().single();if(x){console.warn("[registrarPagamento] Primeira tentativa falhou:",{code:x.code,message:x.message});const g=`${x?.message||""} ${x?.details||""}`.toLowerCase();if(x?.code==="42703"||g.includes("column")&&g.includes("cliente_id")){const{cliente_id:y,...b}=h;try{localStorage.setItem("schema:pagamentos:cliente_id","no")}catch{}const{data:w,error:j}=await Q.from("pagamentos").insert(b).select().single();if(j)throw j;return console.log("[registrarPagamento] Pagamento registrado sem cliente_id:",w),w}if(gKe(x)){console.log("[registrarPagamento] Tentando abordagem alternativa sem status...");try{const y={...h};delete y.status;const{data:b,error:w}=await Q.from("pagamentos").insert(y).select().single();if(w)throw w;return console.log("[registrarPagamento] Pagamento registrado com sucesso (abordagem alternativa):",b),b}catch(y){throw console.error("[registrarPagamento] Falha na abordagem alternativa:",y),new Error(`Falha ao processar pagamento: ${y.message}`)}}throw x}return console.log("[registrarPagamento] Pagamento registrado com sucesso:",m),m}catch(m){throw console.error("[registrarPagamento] Erro ao registrar pagamento:",{error:{message:m.message,code:m.code,details:m.details,hint:m.hint},comandaId:e,finalizadoraId:t,valor:h.valor,status:h.status,codigoEmpresa:l}),m}}async function V0({comandaId:e,codigoEmpresa:t,diferencaPagamento:r}){const n=t||qa(),s="[fecharComandaEMesa]";try{console.group(s)}catch{}try{console.time?.(s)}catch{}try{console.log(`${s} Iniciando fechamento da comanda ${e}`),console.log(`${s} Obtendo dados da comanda...`);const{data:o,error:i}=await Q.from("comandas").select("id, mesa_id, status, fechado_em").eq("id",e).single();if(i||!o)throw console.error(`${s} Erro ao buscar comanda:`,i?.message||"Comanda no encontrada"),i||new Error("Comanda no encontrada");if(o.fechado_em)return console.log(`${s} Comanda ${e} j est fechada em ${o.fechado_em}`),!0;const l=new Date().toISOString();console.log(`${s} Atualizando comanda...`);const c={status:"closed",fechado_em:l};typeof r=="number"&&Number.isFinite(r)&&(c.diferenca_pagamento=r),console.log(`${s} Fechando comanda com status closed + fechado_em${c.diferenca_pagamento!=null?" + diferenca_pagamento":""}...`);let{error:d}=await Q.from("comandas").update(c).eq("id",e).eq("codigo_empresa",n);if(d&&d.code==="42703"){console.warn(`${s} Coluna diferenca_pagamento ausente no schema, tentando novamente sem ela...`);const u={status:"closed",fechado_em:l};({error:d}=await Q.from("comandas").update(u).eq("id",e).eq("codigo_empresa",n))}if(d)throw console.error(`${s} Erro ao fechar comanda:`,d),d;if(console.log(`${s} Comanda ${e} fechada com sucesso`),o.mesa_id){console.log(`${s} Atualizando status da mesa ${o.mesa_id} para disponvel...`);try{const{error:u}=await Q.from("mesas").update({status:"available"}).eq("id",o.mesa_id).select("id").single();u?console.error(`${s} Erro ao atualizar status da mesa:`,u):console.log(`${s} Mesa ${o.mesa_id} marcada como disponvel`)}catch(u){console.error(`${s} Exceo ao atualizar mesa:`,u)}}else console.log(`${s} Nenhuma mesa associada para liberar`);return console.log(`${s} Fechamento da comanda ${e} concludo com sucesso`),!0}catch(o){throw console.error(`${s} Erro fatal ao fechar comanda:`,o),o}finally{try{console.timeEnd?.(s)}catch{}try{console.groupEnd()}catch{}}}async function Uz({comandaId:e,codigoEmpresa:t}){const r=t||qa(),n="[cancelarComandaEMesa]";try{console.group(n)}catch{}try{console.time?.(n)}catch{}try{if(!e)throw new Error("comandaId obrigatrio");if(!r)throw new Error("codigo_empresa obrigatrio");console.log(`${n} Cancelando comanda ${e}`);const{data:s}=await Q.from("comandas").select("id, mesa_id").eq("id",e).single();try{await Q.from("comanda_itens").delete().eq("comanda_id",e).eq("codigo_empresa",r)}catch{}try{await Q.from("comanda_clientes").delete().eq("comanda_id",e).eq("codigo_empresa",r)}catch{}const o=new Date().toISOString(),{data:i,error:l}=await Q.from("comandas").update({status:"cancelled",fechado_em:o}).eq("id",e).eq("codigo_empresa",r).select();if(l)throw console.error(`${n} Erro ao atualizar comanda:`,l),l;if(!i||i.length===0)throw console.error(`${n}  UPDATE no afetou nenhuma linha! Comanda ${e} no foi encontrada ou RLS bloqueou`),new Error("Comanda no encontrada ou sem permisso para cancelar");if(console.log(`${n}  Comanda atualizada:`,i[0]),s?.mesa_id){console.log(`${n} Liberando mesa ${s.mesa_id}`);try{await Q.from("mesas").update({status:"available"}).eq("id",s.mesa_id)}catch(c){console.error(`${n} Erro ao liberar mesa:`,c)}}return console.log(`${n} Comanda ${e} cancelada com sucesso`),!0}catch(s){throw console.error(`${n} Falha:`,s),s}finally{try{console.timeEnd?.(n)}catch{}try{console.groupEnd?.(n)}catch{}}}async function xKe({itemId:e,desconto_tipo:t,desconto_valor:r,desconto_motivo:n,codigoEmpresa:s}={}){const o=s||qa();if(!e)throw new Error("itemId  obrigatrio");if(!["percentual","fixo"].includes(t))throw new Error('Tipo de desconto deve ser "percentual" ou "fixo"');if(r<0)throw new Error("Desconto no pode ser negativo");if(t==="percentual"&&r>100)throw new Error("Desconto percentual no pode ser maior que 100%");let i=Q.from("comanda_itens").update({desconto_tipo:t,desconto_valor:Number(r),desconto_motivo:n||null}).eq("id",e);o&&(i=i.eq("codigo_empresa",o));const{data:l,error:c}=await i.select("*").single();if(c)throw c;return l}async function vKe({comandaId:e,desconto_tipo:t,desconto_valor:r,desconto_motivo:n,codigoEmpresa:s}={}){const o=s||qa();if(!e)throw new Error("comandaId  obrigatrio");if(!["percentual","fixo"].includes(t))throw new Error('Tipo de desconto deve ser "percentual" ou "fixo"');if(r<0)throw new Error("Desconto no pode ser negativo");if(t==="percentual"&&r>100)throw new Error("Desconto percentual no pode ser maior que 100%");let i=Q.from("comandas").update({desconto_tipo:t,desconto_valor:Number(r),desconto_motivo:n||null}).eq("id",e);o&&(i=i.eq("codigo_empresa",o));const{data:l,error:c}=await i.select("*").single();if(c)throw c;return l}async function yKe({itemId:e,codigoEmpresa:t}={}){const r=t||qa();if(!e)throw new Error("itemId  obrigatrio");let n=Q.from("comanda_itens").update({desconto_tipo:null,desconto_valor:0,desconto_motivo:null}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("*").single();if(o)throw o;return s}async function bKe({comandaId:e,codigoEmpresa:t}={}){const r=t||qa();if(!e)throw new Error("comandaId  obrigatrio");let n=Q.from("comandas").update({desconto_tipo:null,desconto_valor:0,desconto_motivo:null}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("*").single();if(o)throw o;return s}async function wKe({comandaId:e,observacoes:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");const{error:n}=await Q.from("comandas").update({observacoes:(t||"").trim()||null,observacoes_atualizadas_em:new Date().toISOString()}).eq("id",e);if(n)throw n;return{id:e}}var yP="Tabs",[jKe,wct]=Cu(yP,[pP]),cne=pP(),[_Ke,ER]=jKe(yP),dne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:s,defaultValue:o,orientation:i="horizontal",dir:l,activationMode:c="automatic",...d}=e,u=dP(l),[f,h]=Um({prop:n,onChange:s,defaultProp:o??"",caller:yP});return a.jsx(_Ke,{scope:r,baseId:nf(),value:f,onValueChange:h,orientation:i,dir:u,activationMode:c,children:a.jsx(Xa.div,{dir:u,"data-orientation":i,...d,ref:t})})});dne.displayName=yP;var une="TabsList",fne=p.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...s}=e,o=ER(une,r),i=cne(r);return a.jsx(ure,{asChild:!0,...i,orientation:o.orientation,dir:o.dir,loop:n,children:a.jsx(Xa.div,{role:"tablist","aria-orientation":o.orientation,...s,ref:t})})});fne.displayName=une;var mne="TabsTrigger",hne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:s=!1,...o}=e,i=ER(mne,r),l=cne(r),c=xne(i.baseId,n),d=vne(i.baseId,n),u=n===i.value;return a.jsx(fre,{asChild:!0,...l,focusable:!s,active:u,children:a.jsx(Xa.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":d,"data-state":u?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:c,...o,ref:t,onMouseDown:aa(e.onMouseDown,f=>{!s&&f.button===0&&f.ctrlKey===!1?i.onValueChange(n):f.preventDefault()}),onKeyDown:aa(e.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&i.onValueChange(n)}),onFocus:aa(e.onFocus,()=>{const f=i.activationMode!=="manual";!u&&!s&&f&&i.onValueChange(n)})})})});hne.displayName=mne;var pne="TabsContent",gne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:s,children:o,...i}=e,l=ER(pne,r),c=xne(l.baseId,n),d=vne(l.baseId,n),u=n===l.value,f=p.useRef(u);return p.useEffect(()=>{const h=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(h)},[]),a.jsx(qd,{present:s||u,children:({present:h})=>a.jsx(Xa.div,{"data-state":u?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!h,id:d,tabIndex:0,...i,ref:t,style:{...e.style,animationDuration:f.current?"0s":void 0},children:h&&o})})});gne.displayName=pne;function xne(e,t){return`${e}-trigger-${t}`}function vne(e,t){return`${e}-content-${t}`}var NKe=dne,yne=fne,bne=hne,wne=gne;const Sd=NKe,jc=Ce.forwardRef(({className:e,...t},r)=>a.jsx(yne,{ref:r,className:Er("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));jc.displayName=yne.displayName;const Ga=Ce.forwardRef(({className:e,...t},r)=>a.jsx(bne,{ref:r,className:Er("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Ga.displayName=bne.displayName;const vo=Ce.forwardRef(({className:e,...t},r)=>a.jsx(wne,{ref:r,className:Er("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));vo.displayName=wne.displayName;function jne({open:e,onOpenChange:t,client:r,onSaved:n}){const{toast:s}=Xs(),{userProfile:o}=fo(),i=I=>({tipo_pessoa:I?.tipo_pessoa||"PF",tipo_cadastro:I?.tipo_cadastro||"cliente",nome:I?.nome||"",apelido:I?.apelido||"",cpf:I?.cpf||"",cnpj:I?.cnpj||"",rg:I?.rg||"",ie:I?.ie||"",email:I?.email||"",telefone:I?.telefone||"",fone2:I?.fone2||"",celular1:I?.celular1||"",celular2:I?.celular2||"",whatsapp:I?.whatsapp||"",cep:I?.cep||"",endereco:I?.endereco||"",numero:I?.numero||"",complemento:I?.complemento||"",bairro:I?.bairro||"",cidade:I?.cidade||"",uf:I?.uf||"",cidade_ibge:I?.cidade_ibge||"",limite_credito:I?.limite_credito??"",tipo_recebimento:I?.tipo_recebimento||"",regime_tributario:I?.regime_tributario||"",tipo_contribuinte:I?.tipo_contribuinte||"",aniversario:I?.aniversario?String(I.aniversario).slice(0,10):"",sexo:I?.sexo||"",estado_civil:I?.estado_civil||"",nome_mae:I?.nome_mae||"",nome_pai:I?.nome_pai||"",observacoes:I?.observacoes||"",status:I?.status||"active"}),[l,c]=p.useState(i(r)),[d,u]=p.useState("basicos"),[f,h]=p.useState(!1);p.useEffect(()=>{let I="cliente";r?.flag_cliente&&r?.flag_fornecedor?I="ambos":r?.flag_fornecedor&&(I="fornecedor"),c({tipo_pessoa:r?.tipo_pessoa||"PF",tipo_cadastro:I,nome:r?.nome||"",apelido:r?.apelido||"",cpf:r?.cpf||"",cnpj:r?.cnpj||"",rg:r?.rg||"",ie:r?.ie||"",email:r?.email||"",telefone:r?.telefone||"",fone2:r?.fone2||"",celular1:r?.celular1||"",celular2:r?.celular2||"",whatsapp:r?.whatsapp||"",cep:r?.cep||"",endereco:r?.endereco||"",numero:r?.numero||"",complemento:r?.complemento||"",bairro:r?.bairro||"",cidade:r?.cidade||"",uf:r?.uf||"",cidade_ibge:r?.cidade_ibge||"",limite_credito:r?.limite_credito??"",tipo_recebimento:r?.tipo_recebimento||"",regime_tributario:r?.regime_tributario||"",tipo_contribuinte:r?.tipo_contribuinte||"",aniversario:r?.aniversario?String(r.aniversario).slice(0,10):"",sexo:r?.sexo||"",estado_civil:r?.estado_civil||"",nome_mae:r?.nome_mae||"",nome_pai:r?.nome_pai||"",observacoes:r?.observacoes||"",status:r?.status||"active"})},[r]),p.useEffect(()=>{e?c(i(r||null)):r||c(i(null))},[e,!!r]);const m=I=>{const{id:T,value:k}=I.target;c($=>({...$,[T]:k}))},x=async()=>{try{const I=y.digits(l.cnpj);if(!I||I.length!==14){s({title:"CNPJ invlido",description:"Informe 14 dgitos para buscar.",variant:"destructive"});return}const T=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${I}`);if(!T.ok){let de="Falha ao consultar CNPJ";try{const X=await T.json();X?.message&&(de=X.message)}catch{}throw new Error(de)}const k=await T.json();try{console.info("[clientes] BuscarCNPJ:payload",k)}catch{}const $=k.razao_social||k.nome||"",q=k.nome_fantasia||"",z=k.logradouro||"",F=String(k.numero||""),V=k.complemento||"",ue=k.bairro||"",_e=k.municipio||k.localidade||"",U=k.uf||"",L=y.digits(k.cep||"");let G="";try{if(_e&&U){const de=await fetch(`https://brasilapi.com.br/api/ibge/municipios/v1/${U}`);if(de.ok){const X=await de.json(),W=ee=>String(ee||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim(),Y=W(_e),me=(X||[]).find(ee=>W(ee.nome)===Y);(me?.codigo_ibge||me?.codigo)&&(G=String(me.codigo_ibge||me.codigo))}}}catch{}c(de=>({...de,nome:$,apelido:q||$,endereco:z,numero:F,complemento:V,bairro:ue,cidade:_e,uf:U,cep:L,cidade_ibge:G||de.cidade_ibge}));try{console.info("[clientes] BuscarCNPJ:setForm",{razao:$,fantasia:q,logradouro:z,numero:F,complemento:V,bairro:ue,cidade:_e,uf:U,cep:L,codigoIBGE:G})}catch{}s({title:"CNPJ carregado",description:"Dados preenchidos."})}catch(I){s({title:"Falha ao buscar CNPJ",description:I.message||"Tente novamente.",variant:"destructive"})}},g=I=>I===""?null:I,v=I=>{if(I==null)return null;if(typeof I=="number")return I;const T=String(I).trim();if(!T)return null;const k=T.replace(/\s+/g,"").replace(/\.(?=\d{3}(?:\D|$))/g,"").replace(/,/g,"."),$=Number(k);return Number.isFinite($)?$:null},y=p.useMemo(()=>({digits:I=>(I||"").replace(/\D+/g,"")}),[]),b=I=>y.digits(I).slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"),w=I=>y.digits(I).slice(0,14).replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2"),j=I=>y.digits(I).slice(0,8).replace(/(\d{5})(\d)/,"$1-$2"),_=I=>{const T=y.digits(I).slice(0,11);return T.length<=10?T.replace(/(\d{2})(\d{4})(\d{0,4})/,"($1) $2-$3").trim():T.replace(/(\d{2})(\d{5})(\d{0,4})/,"($1) $2-$3").trim()},C=I=>String(I||"").replace(/[^a-z]/gi,"").toUpperCase().slice(0,2),A=(I,T=6)=>y.digits(I).slice(0,T),S=I=>{const T=y.digits(I);return T?(Number(T)/100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},P=(I,T)=>{let k=T;I==="cpf"&&(k=b(T)),I==="cnpj"&&(k=w(T)),I==="cep"&&(k=j(T)),["telefone","fone2","celular1","celular2","whatsapp"].includes(I)&&(k=_(T)),I==="uf"&&(k=C(T)),I==="numero"&&(k=A(T,8)),I==="cidade_ibge"&&(k=A(T,7)),I==="limite_credito"&&(k=S(T)),c($=>({...$,[I]:k}))},M=async()=>{const I=y.digits(l.cep);if(!I||I.length!==8){s({title:"CEP invlido",description:"Informe 8 dgitos.",variant:"destructive"});return}try{h(!0),c($=>({...$,endereco:"Buscando...",bairro:"Buscando...",cidade:"Buscando...",uf:""}));const k=await(await fetch(`https://viacep.com.br/ws/${I}/json/`)).json();if(k.erro)throw new Error("CEP no encontrado");c($=>({...$,endereco:k.logradouro||"",bairro:k.bairro||"",cidade:k.localidade||"",uf:k.uf||"",cidade_ibge:k.ibge||""})),s({title:"CEP encontrado!",description:"Endereo preenchido automaticamente.",variant:"success"})}catch(T){c(k=>({...k,endereco:"",bairro:"",cidade:"",uf:""})),s({title:"Falha ao buscar CEP",description:T.message||"Tente novamente.",variant:"destructive"})}finally{h(!1)}},O=async I=>{I?.preventDefault?.(),window.__protectPaymentModal&&window.__protectPaymentModal(5e3);try{if(!l.nome||l.nome.trim().length<2)throw new Error("Informe o nome/razo social do cliente.");const T={tipo_pessoa:g(l.tipo_pessoa),nome:l.nome,apelido:g(l.apelido),cpf:g(l.cpf),cnpj:g(l.cnpj),rg:g(l.rg),ie:g(l.ie),email:g(l.email),telefone:g(l.telefone),fone2:g(l.fone2),celular1:g(l.celular1),celular2:g(l.celular2),whatsapp:g(l.whatsapp),cep:g(l.cep),endereco:g(l.endereco),numero:g(l.numero),complemento:g(l.complemento),bairro:g(l.bairro),cidade:g(l.cidade),uf:g(l.uf),cidade_ibge:g(l.cidade_ibge),limite_credito:v(l.limite_credito),tipo_recebimento:g(l.tipo_recebimento),regime_tributario:g(l.regime_tributario),tipo_contribuinte:g(l.tipo_contribuinte),aniversario:g(l.aniversario),sexo:g(l.sexo),estado_civil:g(l.estado_civil),nome_mae:g(l.nome_mae),nome_pai:g(l.nome_pai),observacoes:g(l.observacoes),flag_cliente:l.tipo_cadastro==="cliente"||l.tipo_cadastro==="ambos",flag_fornecedor:l.tipo_cadastro==="fornecedor"||l.tipo_cadastro==="ambos",flag_funcionario:!1,flag_administradora:!1,flag_parceiro:!1,flag_ccf_spc:!1,status:l.status};let k,$=null;if(r?.id){const{data:q,error:z}=await Q.from("clientes").update(T).eq("id",r.id).select().single();k=z,$=q??null}else{const q=o?.codigo_empresa||null;if(!q)throw new Error("No foi possvel identificar a empresa do usurio (codigo_empresa). Tente recarregar a pgina ou entrar novamente.");const z={...T,codigo_empresa:q},{data:F,error:V}=await Q.from("clientes").insert(z).select().single();k=V,$=F??null}if(k)throw k;s({title:"Cliente salvo!",description:"As informaes do cliente foram atualizadas.",variant:"success"}),n?.($),setTimeout(()=>{t?.(!1)},50)}catch(T){const k=(T?.message||"").toLowerCase(),$=T?.code||"";let q="Erro ao salvar cliente",z=T.message;$==="23505"||k.includes("duplicate key")&&k.includes("uq_clientes_empresa_codigo")?(q="Cdigo j cadastrado",z="J existe um cliente com este cdigo na sua empresa. Deixe o campo cdigo em branco para gerar automaticamente ou escolha outro nmero."):k.includes("column")&&k.includes("does not exist")&&(z="Seu banco pode no estar migrado para os novos campos. Atualize o schema conforme estrutura_bd."),s({title:q,description:z,variant:"destructive"})}};return a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto w-full",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:r?"Editar Cliente":"Novo Cliente"}),a.jsx(la,{children:"Preencha os dados cadastrais do cliente."})]}),a.jsx("form",{onSubmit:O,className:"grid gap-4 sm:gap-6 py-2",children:a.jsxs(Sd,{value:d,onValueChange:u,className:"w-full",children:[a.jsx("div",{className:"sm:hidden mb-4",children:a.jsxs(ea,{value:d,onValueChange:u,children:[a.jsx(Jn,{className:"w-full",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"basicos",children:"Dados Bsicos"}),a.jsx(Qe,{value:"endereco",children:"Endereo"}),a.jsx(Qe,{value:"financeiro",children:"Financeiro"}),a.jsx(Qe,{value:"adicionais",children:"Adicionais"})]})]})}),a.jsxs(jc,{className:"hidden sm:grid grid-cols-4 gap-2",children:[a.jsx(Ga,{value:"basicos",children:"Dados Bsicos"}),a.jsx(Ga,{value:"endereco",children:"Endereo"}),a.jsx(Ga,{value:"financeiro",children:"Financeiro"}),a.jsx(Ga,{value:"adicionais",children:"Adicionais"})]}),a.jsx(vo,{value:"basicos",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{children:"Tipo de Pessoa"}),a.jsxs(ea,{value:l.tipo_pessoa,onValueChange:I=>c(T=>({...T,tipo_pessoa:I})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Pessoa"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"PF",children:"Fsica"}),a.jsx(Qe,{value:"PJ",children:"Jurdica"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{children:"Tipo de Cadastro *"}),a.jsxs(ea,{value:l.tipo_cadastro,onValueChange:I=>c(T=>({...T,tipo_cadastro:I})),required:!0,children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"cliente",children:"Cliente"}),a.jsx(Qe,{value:"fornecedor",children:"Fornecedor"}),a.jsx(Qe,{value:"ambos",children:"Cliente e Fornecedor"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(lt,{htmlFor:"nome",children:l.tipo_pessoa==="PJ"?"Razo Social":"Nome"}),a.jsx(At,{id:"nome",value:l.nome,onChange:m,required:!0})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(lt,{htmlFor:"apelido",children:l.tipo_pessoa==="PJ"?"Nome Fantasia":"Apelido"}),a.jsx(At,{id:"apelido",value:l.apelido,onChange:m})]}),l.tipo_pessoa==="PF"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"cpf",children:"CPF"}),a.jsx(At,{id:"cpf",value:l.cpf,onChange:I=>P("cpf",I.target.value),placeholder:"000.000.000-00"})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"rg",children:"RG"}),a.jsx(At,{id:"rg",value:l.rg,onChange:m})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"cnpj",children:"CNPJ"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(At,{id:"cnpj",value:l.cnpj,onChange:I=>P("cnpj",I.target.value),placeholder:"00.000.000/0000-00"}),a.jsx(Z,{type:"button",variant:"outline",onClick:x,children:"Buscar"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"ie",children:"Inscrio Estadual (IE)"}),a.jsx(At,{id:"ie",value:l.ie,onChange:m})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(lt,{htmlFor:"email",children:"Email"}),a.jsx(At,{id:"email",type:"email",value:l.email,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"telefone",children:"Telefone"}),a.jsx(At,{id:"telefone",value:l.telefone,onChange:I=>P("telefone",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"celular1",children:"Celular"}),a.jsx(At,{id:"celular1",value:l.celular1,onChange:I=>P("celular1",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"whatsapp",children:"WhatsApp"}),a.jsx(At,{id:"whatsapp",value:l.whatsapp,onChange:I=>P("whatsapp",I.target.value),placeholder:"(DDD) 9...."})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"fone2",children:"Fone 2"}),a.jsx(At,{id:"fone2",value:l.fone2,onChange:I=>P("fone2",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"celular2",children:"Celular 2"}),a.jsx(At,{id:"celular2",value:l.celular2,onChange:I=>P("celular2",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"aniversario",children:"Nascimento"}),a.jsx(At,{id:"aniversario",type:"date",value:l.aniversario||"",onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{children:"Status"}),a.jsxs(ea,{value:l.status,onValueChange:I=>c(T=>({...T,status:I})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Status"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"active",children:"Ativo"}),a.jsx(Qe,{value:"inactive",children:"Inativo"})]})]})]})]})}),a.jsx(vo,{value:"endereco",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"cep",children:"CEP"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(At,{id:"cep",value:l.cep,onChange:I=>P("cep",I.target.value),placeholder:"00000-000"}),a.jsx(Z,{type:"button",variant:"outline",onClick:M,disabled:f,children:f?"Buscando...":"Buscar"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(lt,{htmlFor:"endereco",children:"Endereo"}),a.jsx(At,{id:"endereco",value:l.endereco,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"numero",children:"Nmero"}),a.jsx(At,{id:"numero",value:l.numero,onChange:I=>P("numero",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(lt,{htmlFor:"complemento",children:"Complemento"}),a.jsx(At,{id:"complemento",value:l.complemento,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(lt,{htmlFor:"bairro",children:"Bairro"}),a.jsx(At,{id:"bairro",value:l.bairro,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"cidade",children:"Cidade"}),a.jsx(At,{id:"cidade",value:l.cidade,onChange:m})]}),a.jsxs("div",{className:"col-span-6 sm:col-span-1",children:[a.jsx(lt,{htmlFor:"uf",children:"UF"}),a.jsx(At,{id:"uf",value:l.uf,onChange:I=>P("uf",I.target.value),placeholder:"UF"})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"cidade_ibge",children:"Cd. IBGE"}),a.jsx(At,{id:"cidade_ibge",value:l.cidade_ibge,onChange:I=>P("cidade_ibge",I.target.value)})]})]})}),a.jsx(vo,{value:"financeiro",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{htmlFor:"limite_credito",children:"Limite de Crdito"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary text-sm",children:"R$"}),a.jsx(At,{id:"limite_credito",value:l.limite_credito,onChange:I=>P("limite_credito",I.target.value),placeholder:"0,00",className:"pl-10"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{children:"Tipo de Recebimento"}),a.jsxs(ea,{value:l.tipo_recebimento||"",onValueChange:I=>c(T=>({...T,tipo_recebimento:I})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"avista",children:" vista"}),a.jsx(Qe,{value:"aprazo",children:"A prazo"}),a.jsx(Qe,{value:"misto",children:"Misto"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{children:"Regime Tributrio"}),a.jsxs(ea,{value:l.regime_tributario||"",onValueChange:I=>c(T=>({...T,regime_tributario:I})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"simples",children:"Simples"}),a.jsx(Qe,{value:"lucro_presumido",children:"Lucro Presumido"}),a.jsx(Qe,{value:"lucro_real",children:"Lucro Real"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(lt,{children:"Tipo de Contribuinte"}),a.jsxs(ea,{value:l.tipo_contribuinte||"",onValueChange:I=>c(T=>({...T,tipo_contribuinte:I})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"nao_contribuinte",children:"No Contribuinte"}),a.jsx(Qe,{value:"contribuinte",children:"Contribuinte"}),a.jsx(Qe,{value:"isento",children:"Isento"})]})]})]})]})}),a.jsx(vo,{value:"adicionais",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(lt,{htmlFor:"sexo",children:"Sexo"}),a.jsxs(ea,{value:l.sexo||"",onValueChange:I=>c(T=>({...T,sexo:I})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"m",children:"Masculino"}),a.jsx(Qe,{value:"f",children:"Feminino"}),a.jsx(Qe,{value:"o",children:"Outro"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(lt,{htmlFor:"estado_civil",children:"Estado Civil"}),a.jsxs(ea,{value:l.estado_civil||"",onValueChange:I=>c(T=>({...T,estado_civil:I})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"solteiro",children:"Solteiro(a)"}),a.jsx(Qe,{value:"casado",children:"Casado(a)"}),a.jsx(Qe,{value:"divorciado",children:"Divorciado(a)"}),a.jsx(Qe,{value:"viuvo",children:"Vivo(a)"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(lt,{htmlFor:"nome_mae",children:"Nome da Me"}),a.jsx(At,{id:"nome_mae",value:l.nome_mae,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(lt,{htmlFor:"nome_pai",children:"Nome do Pai"}),a.jsx(At,{id:"nome_pai",value:l.nome_pai,onChange:m})]}),a.jsxs("div",{className:"col-span-12",children:[a.jsx(lt,{htmlFor:"observacoes",children:"Observaes"}),a.jsx("textarea",{id:"observacoes",value:l.observacoes,onChange:m,rows:4,className:"w-full rounded-md border border-border bg-background p-2 text-sm"})]})]})})]})}),a.jsxs(Ua,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Cancelar"})}),a.jsx(Z,{type:"submit",onClick:O,className:"w-full sm:w-auto",children:"Salvar Cliente"})]})]})})}function SKe(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const r=document.implementation.createHTMLDocument(),n=r.createElement("base"),s=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(s),t&&(n.href=t),s.href=e,s.href}const CKe=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function sp(e){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r]);return t}let Kx=null;function _ne(e={}){return Kx||(e.includeStyleProperties?(Kx=e.includeStyleProperties,Kx):(Kx=sp(window.getComputedStyle(document.documentElement)),Kx))}function ZS(e,t){const n=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return n?parseFloat(n.replace("px","")):0}function PKe(e){const t=ZS(e,"border-left-width"),r=ZS(e,"border-right-width");return e.clientWidth+t+r}function AKe(e){const t=ZS(e,"border-top-width"),r=ZS(e,"border-bottom-width");return e.clientHeight+t+r}function Nne(e,t={}){const r=t.width||PKe(e),n=t.height||AKe(e);return{width:r,height:n}}function EKe(){let e,t;try{t=process}catch{}const r=t&&t.env?t.env.devicePixelRatio:null;return r&&(e=parseInt(r,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const ud=16384;function kKe(e){(e.width>ud||e.height>ud)&&(e.width>ud&&e.height>ud?e.width>e.height?(e.height*=ud/e.width,e.width=ud):(e.width*=ud/e.height,e.height=ud):e.width>ud?(e.height*=ud/e.width,e.width=ud):(e.width*=ud/e.height,e.height=ud))}function eC(e){return new Promise((t,r)=>{const n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=r,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function IKe(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function OKe(e,t,r){const n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),o=document.createElementNS(n,"foreignObject");return s.setAttribute("width",`${t}`),s.setAttribute("height",`${r}`),s.setAttribute("viewBox",`0 0 ${t} ${r}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),s.appendChild(o),o.appendChild(e),IKe(s)}const Jc=(e,t)=>{if(e instanceof t)return!0;const r=Object.getPrototypeOf(e);return r===null?!1:r.constructor.name===t.name||Jc(r,t)};function TKe(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function DKe(e,t){return _ne(t).map(r=>{const n=e.getPropertyValue(r),s=e.getPropertyPriority(r);return`${r}: ${n}${s?" !important":""};`}).join(" ")}function MKe(e,t,r,n){const s=`.${e}:${t}`,o=r.cssText?TKe(r):DKe(r,n);return document.createTextNode(`${s}{${o}}`)}function Vz(e,t,r,n){const s=window.getComputedStyle(e,r),o=s.getPropertyValue("content");if(o===""||o==="none")return;const i=CKe();try{t.className=`${t.className} ${i}`}catch{return}const l=document.createElement("style");l.appendChild(MKe(i,r,s,n)),t.appendChild(l)}function RKe(e,t,r){Vz(e,t,":before",r),Vz(e,t,":after",r)}const Wz="application/font-woff",Hz="image/jpeg",FKe={woff:Wz,woff2:Wz,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Hz,jpeg:Hz,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function LKe(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function kR(e){const t=LKe(e).toLowerCase();return FKe[t]||""}function $Ke(e){return e.split(/,/)[1]}function m3(e){return e.search(/^(data:)/)!==-1}function Sne(e,t){return`data:${t};base64,${e}`}async function Cne(e,t,r){const n=await fetch(e,t);if(n.status===404)throw new Error(`Resource "${n.url}" not found`);const s=await n.blob();return new Promise((o,i)=>{const l=new FileReader;l.onerror=i,l.onloadend=()=>{try{o(r({res:n,result:l.result}))}catch(c){i(c)}},l.readAsDataURL(s)})}const HE={};function BKe(e,t,r){let n=e.replace(/\?.*/,"");return r&&(n=e),/ttf|otf|eot|woff2?/i.test(n)&&(n=n.replace(/.*\//,"")),t?`[${t}]${n}`:n}async function IR(e,t,r){const n=BKe(e,t,r.includeQueryParams);if(HE[n]!=null)return HE[n];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let s;try{const o=await Cne(e,r.fetchRequestInit,({res:i,result:l})=>(t||(t=i.headers.get("Content-Type")||""),$Ke(l)));s=Sne(o,t)}catch(o){s=r.imagePlaceholder||"";let i=`Failed to fetch resource: ${e}`;o&&(i=typeof o=="string"?o:o.message),i&&console.warn(i)}return HE[n]=s,s}async function qKe(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):eC(t)}async function zKe(e,t){if(e.currentSrc){const o=document.createElement("canvas"),i=o.getContext("2d");o.width=e.clientWidth,o.height=e.clientHeight,i?.drawImage(e,0,0,o.width,o.height);const l=o.toDataURL();return eC(l)}const r=e.poster,n=kR(r),s=await IR(r,n,t);return eC(s)}async function UKe(e,t){var r;try{if(!((r=e?.contentDocument)===null||r===void 0)&&r.body)return await bP(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function VKe(e,t){return Jc(e,HTMLCanvasElement)?qKe(e):Jc(e,HTMLVideoElement)?zKe(e,t):Jc(e,HTMLIFrameElement)?UKe(e,t):e.cloneNode(Pne(e))}const WKe=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",Pne=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function HKe(e,t,r){var n,s;if(Pne(t))return t;let o=[];return WKe(e)&&e.assignedNodes?o=sp(e.assignedNodes()):Jc(e,HTMLIFrameElement)&&(!((n=e.contentDocument)===null||n===void 0)&&n.body)?o=sp(e.contentDocument.body.childNodes):o=sp(((s=e.shadowRoot)!==null&&s!==void 0?s:e).childNodes),o.length===0||Jc(e,HTMLVideoElement)||await o.reduce((i,l)=>i.then(()=>bP(l,r)).then(c=>{c&&t.appendChild(c)}),Promise.resolve()),t}function GKe(e,t,r){const n=t.style;if(!n)return;const s=window.getComputedStyle(e);s.cssText?(n.cssText=s.cssText,n.transformOrigin=s.transformOrigin):_ne(r).forEach(o=>{let i=s.getPropertyValue(o);o==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),Jc(e,HTMLIFrameElement)&&o==="display"&&i==="inline"&&(i="block"),o==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),n.setProperty(o,i,s.getPropertyPriority(o))})}function KKe(e,t){Jc(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),Jc(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function XKe(e,t){if(Jc(e,HTMLSelectElement)){const r=t,n=Array.from(r.children).find(s=>e.value===s.getAttribute("value"));n&&n.setAttribute("selected","")}}function YKe(e,t,r){return Jc(t,Element)&&(GKe(e,t,r),RKe(e,t,r),KKe(e,t),XKe(e,t)),t}async function JKe(e,t){const r=e.querySelectorAll?e.querySelectorAll("use"):[];if(r.length===0)return e;const n={};for(let o=0;o<r.length;o++){const l=r[o].getAttribute("xlink:href");if(l){const c=e.querySelector(l),d=document.querySelector(l);!c&&d&&!n[l]&&(n[l]=await bP(d,t,!0))}}const s=Object.values(n);if(s.length){const o="http://www.w3.org/1999/xhtml",i=document.createElementNS(o,"svg");i.setAttribute("xmlns",o),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden",i.style.display="none";const l=document.createElementNS(o,"defs");i.appendChild(l);for(let c=0;c<s.length;c++)l.appendChild(s[c]);e.appendChild(i)}return e}async function bP(e,t,r){return!r&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(n=>VKe(n,t)).then(n=>HKe(e,n,t)).then(n=>YKe(e,n,t)).then(n=>JKe(n,t))}const Ane=/url\((['"]?)([^'"]+?)\1\)/g,QKe=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ZKe=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function eXe(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function tXe(e){const t=[];return e.replace(Ane,(r,n,s)=>(t.push(s),r)),t.filter(r=>!m3(r))}async function rXe(e,t,r,n,s){try{const o=r?SKe(t,r):t,i=kR(t);let l;if(s){const c=await s(o);l=Sne(c,i)}else l=await IR(o,i,n);return e.replace(eXe(t),`$1${l}$3`)}catch{}return e}function nXe(e,{preferredFontFormat:t}){return t?e.replace(ZKe,r=>{for(;;){const[n,,s]=QKe.exec(r)||[];if(!s)return"";if(s===t)return`src: ${n};`}}):e}function Ene(e){return e.search(Ane)!==-1}async function kne(e,t,r){if(!Ene(e))return e;const n=nXe(e,r);return tXe(n).reduce((o,i)=>o.then(l=>rXe(l,i,t,r)),Promise.resolve(n))}async function Xx(e,t,r){var n;const s=(n=t.style)===null||n===void 0?void 0:n.getPropertyValue(e);if(s){const o=await kne(s,null,r);return t.style.setProperty(e,o,t.style.getPropertyPriority(e)),!0}return!1}async function aXe(e,t){await Xx("background",e,t)||await Xx("background-image",e,t),await Xx("mask",e,t)||await Xx("-webkit-mask",e,t)||await Xx("mask-image",e,t)||await Xx("-webkit-mask-image",e,t)}async function sXe(e,t){const r=Jc(e,HTMLImageElement);if(!(r&&!m3(e.src))&&!(Jc(e,SVGImageElement)&&!m3(e.href.baseVal)))return;const n=r?e.src:e.href.baseVal,s=await IR(n,kR(n),t);await new Promise((o,i)=>{e.onload=o,e.onerror=t.onImageErrorHandler?(...c)=>{try{o(t.onImageErrorHandler(...c))}catch(d){i(d)}}:i;const l=e;l.decode&&(l.decode=o),l.loading==="lazy"&&(l.loading="eager"),r?(e.srcset="",e.src=s):e.href.baseVal=s})}async function oXe(e,t){const n=sp(e.childNodes).map(s=>Ine(s,t));await Promise.all(n).then(()=>e)}async function Ine(e,t){Jc(e,Element)&&(await aXe(e,t),await sXe(e,t),await oXe(e,t))}function iXe(e,t){const{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);const n=t.style;return n!=null&&Object.keys(n).forEach(s=>{r[s]=n[s]}),e}const Gz={};async function Kz(e){let t=Gz[e];if(t!=null)return t;const n=await(await fetch(e)).text();return t={url:e,cssText:n},Gz[e]=t,t}async function Xz(e,t){let r=e.cssText;const n=/url\(["']?([^"')]+)["']?\)/g,o=(r.match(/url\([^)]+\)/g)||[]).map(async i=>{let l=i.replace(n,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),Cne(l,t.fetchRequestInit,({result:c})=>(r=r.replace(i,`url(${c})`),[i,c]))});return Promise.all(o).then(()=>r)}function Yz(e){if(e==null)return[];const t=[],r=/(\/\*[\s\S]*?\*\/)/gi;let n=e.replace(r,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=s.exec(n);if(c===null)break;t.push(c[0])}n=n.replace(s,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(i,"gi");for(;;){let c=o.exec(n);if(c===null){if(c=l.exec(n),c===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;t.push(c[0])}return t}async function lXe(e,t){const r=[],n=[];return e.forEach(s=>{if("cssRules"in s)try{sp(s.cssRules||[]).forEach((o,i)=>{if(o.type===CSSRule.IMPORT_RULE){let l=i+1;const c=o.href,d=Kz(c).then(u=>Xz(u,t)).then(u=>Yz(u).forEach(f=>{try{s.insertRule(f,f.startsWith("@import")?l+=1:s.cssRules.length)}catch(h){console.error("Error inserting rule from remote css",{rule:f,error:h})}})).catch(u=>{console.error("Error loading remote css",u.toString())});n.push(d)}})}catch(o){const i=e.find(l=>l.href==null)||document.styleSheets[0];s.href!=null&&n.push(Kz(s.href).then(l=>Xz(l,t)).then(l=>Yz(l).forEach(c=>{i.insertRule(c,i.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",o)}}),Promise.all(n).then(()=>(e.forEach(s=>{if("cssRules"in s)try{sp(s.cssRules||[]).forEach(o=>{r.push(o)})}catch(o){console.error(`Error while reading CSS rules from ${s.href}`,o)}}),r))}function cXe(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Ene(t.style.getPropertyValue("src")))}async function dXe(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const r=sp(e.ownerDocument.styleSheets),n=await lXe(r,t);return cXe(n)}function One(e){return e.trim().replace(/["']/g,"")}function uXe(e){const t=new Set;function r(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(o=>{t.add(One(o))}),Array.from(n.children).forEach(o=>{o instanceof HTMLElement&&r(o)})}return r(e),t}async function fXe(e,t){const r=await dXe(e,t),n=uXe(e);return(await Promise.all(r.filter(o=>n.has(One(o.style.fontFamily))).map(o=>{const i=o.parentStyleSheet?o.parentStyleSheet.href:null;return kne(o.cssText,i,t)}))).join(`
`)}async function mXe(e,t){const r=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await fXe(e,t);if(r){const n=document.createElement("style"),s=document.createTextNode(r);n.appendChild(s),e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)}}async function hXe(e,t={}){const{width:r,height:n}=Nne(e,t),s=await bP(e,t,!0);return await mXe(s,t),await Ine(s,t),iXe(s,t),await OKe(s,r,n)}async function pXe(e,t={}){const{width:r,height:n}=Nne(e,t),s=await hXe(e,t),o=await eC(s),i=document.createElement("canvas"),l=i.getContext("2d"),c=t.pixelRatio||EKe(),d=t.canvasWidth||r,u=t.canvasHeight||n;return i.width=d*c,i.height=u*c,t.skipAutoScale||kKe(i),i.style.width=`${d}`,i.style.height=`${u}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,i.width,i.height)),l.drawImage(o,0,0,i.width,i.height),i}async function gXe(e,t={}){return(await pXe(e,t)).toDataURL()}var ff=Uint8Array,Cd=Uint16Array,OR=Int32Array,TR=new ff([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),DR=new ff([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Jz=new ff([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tne=function(e,t){for(var r=new Cd(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var s=new OR(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)s[o]=o-r[n]<<5|n;return{b:r,r:s}},Dne=Tne(TR,2),xXe=Dne.b,h3=Dne.r;xXe[28]=258,h3[258]=28;var vXe=Tne(DR,0),Qz=vXe.r,p3=new Cd(32768);for(var Bo=0;Bo<32768;++Bo){var uh=(Bo&43690)>>1|(Bo&21845)<<1;uh=(uh&52428)>>2|(uh&13107)<<2,uh=(uh&61680)>>4|(uh&3855)<<4,p3[Bo]=((uh&65280)>>8|(uh&255)<<8)>>1}var rw=function(e,t,r){for(var n=e.length,s=0,o=new Cd(t);s<n;++s)e[s]&&++o[e[s]-1];var i=new Cd(t);for(s=1;s<t;++s)i[s]=i[s-1]+o[s-1]<<1;var l;if(r){l=new Cd(1<<t);var c=15-t;for(s=0;s<n;++s)if(e[s])for(var d=s<<4|e[s],u=t-e[s],f=i[e[s]-1]++<<u,h=f|(1<<u)-1;f<=h;++f)l[p3[f]>>c]=d}else for(l=new Cd(n),s=0;s<n;++s)e[s]&&(l[s]=p3[i[e[s]-1]++]>>15-e[s]);return l},cx=new ff(288);for(var Bo=0;Bo<144;++Bo)cx[Bo]=8;for(var Bo=144;Bo<256;++Bo)cx[Bo]=9;for(var Bo=256;Bo<280;++Bo)cx[Bo]=7;for(var Bo=280;Bo<288;++Bo)cx[Bo]=8;var tC=new ff(32);for(var Bo=0;Bo<32;++Bo)tC[Bo]=5;var yXe=rw(cx,9,0),bXe=rw(tC,5,0),Mne=function(e){return(e+7)/8|0},wXe=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new ff(e.subarray(t,r))},cm=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},sb=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},GE=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var s=r.length,o=r.slice();if(!s)return{t:Fne,l:0};if(s==1){var i=new ff(r[0].s+1);return i[r[0].s]=1,{t:i,l:1}}r.sort(function(_,C){return _.f-C.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],d=0,u=1,f=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};u!=s-1;)l=r[r[d].f<r[f].f?d++:f++],c=r[d!=u&&r[d].f<r[f].f?d++:f++],r[u++]={s:-1,f:l.f+c.f,l,r:c};for(var h=o[0].s,n=1;n<s;++n)o[n].s>h&&(h=o[n].s);var m=new Cd(h+1),x=g3(r[u-1],m,0);if(x>t){var n=0,g=0,v=x-t,y=1<<v;for(o.sort(function(C,A){return m[A.s]-m[C.s]||C.f-A.f});n<s;++n){var b=o[n].s;if(m[b]>t)g+=y-(1<<x-m[b]),m[b]=t;else break}for(g>>=v;g>0;){var w=o[n].s;m[w]<t?g-=1<<t-m[w]++-1:++n}for(;n>=0&&g;--n){var j=o[n].s;m[j]==t&&(--m[j],++g)}x=t}return{t:new ff(m),l:x}},g3=function(e,t,r){return e.s==-1?Math.max(g3(e.l,t,r+1),g3(e.r,t,r+1)):t[e.s]=r},Zz=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new Cd(++t),n=0,s=e[0],o=1,i=function(c){r[n++]=c},l=1;l<=t;++l)if(e[l]==s&&l!=t)++o;else{if(!s&&o>2){for(;o>138;o-=138)i(32754);o>2&&(i(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(i(s),--o;o>6;o-=6)i(8304);o>2&&(i(o-3<<5|8208),o=0)}for(;o--;)i(s);o=1,s=e[l]}return{c:r.subarray(0,n),n:t}},ob=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},Rne=function(e,t,r){var n=r.length,s=Mne(t+2);e[s]=n&255,e[s+1]=n>>8,e[s+2]=e[s]^255,e[s+3]=e[s+1]^255;for(var o=0;o<n;++o)e[s+o+4]=r[o];return(s+4+n)*8},e9=function(e,t,r,n,s,o,i,l,c,d,u){cm(t,u++,r),++s[256];for(var f=GE(s,15),h=f.t,m=f.l,x=GE(o,15),g=x.t,v=x.l,y=Zz(h),b=y.c,w=y.n,j=Zz(g),_=j.c,C=j.n,A=new Cd(19),S=0;S<b.length;++S)++A[b[S]&31];for(var S=0;S<_.length;++S)++A[_[S]&31];for(var P=GE(A,7),M=P.t,O=P.l,I=19;I>4&&!M[Jz[I-1]];--I);var T=d+5<<3,k=ob(s,cx)+ob(o,tC)+i,$=ob(s,h)+ob(o,g)+i+14+3*I+ob(A,M)+2*A[16]+3*A[17]+7*A[18];if(c>=0&&T<=k&&T<=$)return Rne(t,u,e.subarray(c,c+d));var q,z,F,V;if(cm(t,u,1+($<k)),u+=2,$<k){q=rw(h,m,0),z=h,F=rw(g,v,0),V=g;var ue=rw(M,O,0);cm(t,u,w-257),cm(t,u+5,C-1),cm(t,u+10,I-4),u+=14;for(var S=0;S<I;++S)cm(t,u+3*S,M[Jz[S]]);u+=3*I;for(var _e=[b,_],U=0;U<2;++U)for(var L=_e[U],S=0;S<L.length;++S){var G=L[S]&31;cm(t,u,ue[G]),u+=M[G],G>15&&(cm(t,u,L[S]>>5&127),u+=L[S]>>12)}}else q=yXe,z=cx,F=bXe,V=tC;for(var S=0;S<l;++S){var de=n[S];if(de>255){var G=de>>18&31;sb(t,u,q[G+257]),u+=z[G+257],G>7&&(cm(t,u,de>>23&31),u+=TR[G]);var X=de&31;sb(t,u,F[X]),u+=V[X],X>3&&(sb(t,u,de>>5&8191),u+=DR[X])}else sb(t,u,q[de]),u+=z[de]}return sb(t,u,q[256]),u+z[256]},jXe=new OR([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Fne=new ff(0),_Xe=function(e,t,r,n,s,o){var i=o.z||e.length,l=new ff(n+i+5*(1+Math.ceil(i/7e3))+s),c=l.subarray(n,l.length-s),d=o.l,u=(o.r||0)&7;if(t){u&&(c[0]=o.r>>3);for(var f=jXe[t-1],h=f>>13,m=f&8191,x=(1<<r)-1,g=o.p||new Cd(32768),v=o.h||new Cd(x+1),y=Math.ceil(r/3),b=2*y,w=function(te){return(e[te]^e[te+1]<<y^e[te+2]<<b)&x},j=new OR(25e3),_=new Cd(288),C=new Cd(32),A=0,S=0,P=o.i||0,M=0,O=o.w||0,I=0;P+2<i;++P){var T=w(P),k=P&32767,$=v[T];if(g[k]=$,v[T]=k,O<=P){var q=i-P;if((A>7e3||M>24576)&&(q>423||!d)){u=e9(e,c,0,j,_,C,S,M,I,P-I,u),M=A=S=0,I=P;for(var z=0;z<286;++z)_[z]=0;for(var z=0;z<30;++z)C[z]=0}var F=2,V=0,ue=m,_e=k-$&32767;if(q>2&&T==w(P-_e))for(var U=Math.min(h,q)-1,L=Math.min(32767,P),G=Math.min(258,q);_e<=L&&--ue&&k!=$;){if(e[P+F]==e[P+F-_e]){for(var de=0;de<G&&e[P+de]==e[P+de-_e];++de);if(de>F){if(F=de,V=_e,de>U)break;for(var X=Math.min(_e,de-2),W=0,z=0;z<X;++z){var Y=P-_e+z&32767,me=g[Y],ee=Y-me&32767;ee>W&&(W=ee,$=Y)}}}k=$,$=g[k],_e+=k-$&32767}if(V){j[M++]=268435456|h3[F]<<18|Qz[V];var ae=h3[F]&31,le=Qz[V]&31;S+=TR[ae]+DR[le],++_[257+ae],++C[le],O=P+F,++A}else j[M++]=e[P],++_[e[P]]}}for(P=Math.max(P,O);P<i;++P)j[M++]=e[P],++_[e[P]];u=e9(e,c,d,j,_,C,S,M,I,P-I,u),d||(o.r=u&7|c[u/8|0]<<3,u-=7,o.h=v,o.p=g,o.i=P,o.w=O)}else{for(var P=o.w||0;P<i+d;P+=65535){var Te=P+65535;Te>=i&&(c[u/8|0]=d,Te=i),u=Rne(c,u+1,e.subarray(P,Te))}o.i=i}return wXe(l,0,n+Mne(u)+s)},Lne=function(){var e=1,t=0;return{p:function(r){for(var n=e,s=t,o=r.length|0,i=0;i!=o;){for(var l=Math.min(i+2655,o);i<l;++i)s+=n+=r[i];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}e=n,t=s},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},NXe=function(e,t,r,n,s){if(!s&&(s={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),i=new ff(o.length+e.length);i.set(o),i.set(e,o.length),e=i,s.w=o.length}return _Xe(e,t.level==null?6:t.level,t.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,s)},$ne=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},SXe=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var s=Lne();s.p(t.dictionary),$ne(e,2,s.d())}};function x3(e,t){t||(t={});var r=Lne();r.p(e);var n=NXe(e,t,t.dictionary?6:2,4);return SXe(n,t),$ne(n,n.length-4,r.d()),n}var CXe=typeof TextDecoder<"u"&&new TextDecoder,PXe=0;try{CXe.decode(Fne,{stream:!0}),PXe=1}catch{}function AXe(e){if(Array.isArray(e))return e}function EXe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function kXe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t9(e,t){return AXe(e)||EXe(e,t)||cje(e,t)||kXe()}function r9(e,t="utf8"){return new TextDecoder(t).decode(e)}const IXe=new TextEncoder;function OXe(e){return IXe.encode(e)}const TXe=1024*8,DXe=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),KE={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class MR{constructor(t=TXe,r={}){lo(this,"buffer");lo(this,"byteLength");lo(this,"byteOffset");lo(this,"length");lo(this,"offset");lo(this,"lastWrittenByte");lo(this,"littleEndian");lo(this,"_data");lo(this,"_mark");lo(this,"_marks");let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const s=r.offset?r.offset>>>0:0,o=t.byteLength-s;let i=s;(ArrayBuffer.isView(t)||t instanceof MR)&&(t.byteLength!==t.buffer.byteLength&&(i=t.byteOffset+s),t=t.buffer),n?this.lastWrittenByte=o:this.lastWrittenByte=0,this.buffer=t,this.length=o,this.byteLength=o,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,o),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,r){const n=KE[r].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,o=this.buffer.slice(s,s+n);if(this.littleEndian===DXe&&r!=="uint8"&&r!=="int8"){const l=new Uint8Array(this.buffer.slice(s,s+n));l.reverse();const c=new KE[r](l.buffer);return this.offset+=n,c.reverse(),c}const i=new KE[r](o);return this.offset+=n,i}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let n=0;n<t;n++)r+=this.readChar();return r}readUtf8(t=1){return r9(this.readBytes(t))}decodeText(t=1,r="utf8"){return r9(this.readBytes(t),r)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}writeUtf8(t){return this.writeBytes(OXe(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const MXe=4,n9=0,a9=1,RXe=2;function Sy(e){let t=e.length;for(;--t>=0;)e[t]=0}const FXe=0,Bne=1,LXe=2,$Xe=3,BXe=258,RR=29,bj=256,A1=bj+1+RR,Zv=30,FR=19,qne=2*A1+1,Cg=15,XE=16,qXe=7,LR=256,zne=16,Une=17,Vne=18,v3=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),B_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),zXe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Wne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UXe=512,ym=new Array((A1+2)*2);Sy(ym);const nw=new Array(Zv*2);Sy(nw);const E1=new Array(UXe);Sy(E1);const k1=new Array(BXe-$Xe+1);Sy(k1);const $R=new Array(RR);Sy($R);const rC=new Array(Zv);Sy(rC);function YE(e,t,r,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let Hne,Gne,Kne;function JE(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const Xne=e=>e<256?E1[e]:E1[256+(e>>>7)],I1=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},Wc=(e,t,r)=>{e.bi_valid>XE-r?(e.bi_buf|=t<<e.bi_valid&65535,I1(e,e.bi_buf),e.bi_buf=t>>XE-e.bi_valid,e.bi_valid+=r-XE):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Of=(e,t,r)=>{Wc(e,r[t*2],r[t*2+1])},Yne=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},VXe=e=>{e.bi_valid===16?(I1(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},WXe=(e,t)=>{const r=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,i=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let d,u,f,h,m,x,g=0;for(h=0;h<=Cg;h++)e.bl_count[h]=0;for(r[e.heap[e.heap_max]*2+1]=0,d=e.heap_max+1;d<qne;d++)u=e.heap[d],h=r[r[u*2+1]*2+1]+1,h>c&&(h=c,g++),r[u*2+1]=h,!(u>n)&&(e.bl_count[h]++,m=0,u>=l&&(m=i[u-l]),x=r[u*2],e.opt_len+=x*(h+m),o&&(e.static_len+=x*(s[u*2+1]+m)));if(g!==0){do{for(h=c-1;e.bl_count[h]===0;)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(h=c;h!==0;h--)for(u=e.bl_count[h];u!==0;)f=e.heap[--d],!(f>n)&&(r[f*2+1]!==h&&(e.opt_len+=(h-r[f*2+1])*r[f*2],r[f*2+1]=h),u--)}},Jne=(e,t,r)=>{const n=new Array(Cg+1);let s=0,o,i;for(o=1;o<=Cg;o++)s=s+r[o-1]<<1,n[o]=s;for(i=0;i<=t;i++){let l=e[i*2+1];l!==0&&(e[i*2]=Yne(n[l]++,l))}},HXe=()=>{let e,t,r,n,s;const o=new Array(Cg+1);for(r=0,n=0;n<RR-1;n++)for($R[n]=r,e=0;e<1<<v3[n];e++)k1[r++]=n;for(k1[r-1]=n,s=0,n=0;n<16;n++)for(rC[n]=s,e=0;e<1<<B_[n];e++)E1[s++]=n;for(s>>=7;n<Zv;n++)for(rC[n]=s<<7,e=0;e<1<<B_[n]-7;e++)E1[256+s++]=n;for(t=0;t<=Cg;t++)o[t]=0;for(e=0;e<=143;)ym[e*2+1]=8,e++,o[8]++;for(;e<=255;)ym[e*2+1]=9,e++,o[9]++;for(;e<=279;)ym[e*2+1]=7,e++,o[7]++;for(;e<=287;)ym[e*2+1]=8,e++,o[8]++;for(Jne(ym,A1+1,o),e=0;e<Zv;e++)nw[e*2+1]=5,nw[e*2]=Yne(e,5);Hne=new YE(ym,v3,bj+1,A1,Cg),Gne=new YE(nw,B_,0,Zv,Cg),Kne=new YE(new Array(0),zXe,0,FR,qXe)},Qne=e=>{let t;for(t=0;t<A1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<Zv;t++)e.dyn_dtree[t*2]=0;for(t=0;t<FR;t++)e.bl_tree[t*2]=0;e.dyn_ltree[LR*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Zne=e=>{e.bi_valid>8?I1(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},s9=(e,t,r,n)=>{const s=t*2,o=r*2;return e[s]<e[o]||e[s]===e[o]&&n[t]<=n[r]},QE=(e,t,r)=>{const n=e.heap[r];let s=r<<1;for(;s<=e.heap_len&&(s<e.heap_len&&s9(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!s9(t,n,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=n},o9=(e,t,r)=>{let n,s,o=0,i,l;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+o++]&255,n+=(e.pending_buf[e.sym_buf+o++]&255)<<8,s=e.pending_buf[e.sym_buf+o++],n===0?Of(e,s,t):(i=k1[s],Of(e,i+bj+1,t),l=v3[i],l!==0&&(s-=$R[i],Wc(e,s,l)),n--,i=Xne(n),Of(e,i,r),l=B_[i],l!==0&&(n-=rC[i],Wc(e,n,l)));while(o<e.sym_next);Of(e,LR,t)},y3=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.elems;let i,l,c=-1,d;for(e.heap_len=0,e.heap_max=qne,i=0;i<o;i++)r[i*2]!==0?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):r[i*2+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=c<2?++c:0,r[d*2]=1,e.depth[d]=0,e.opt_len--,s&&(e.static_len-=n[d*2+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)QE(e,r,i);d=o;do i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],QE(e,r,1),l=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=l,r[d*2]=r[i*2]+r[l*2],e.depth[d]=(e.depth[i]>=e.depth[l]?e.depth[i]:e.depth[l])+1,r[i*2+1]=r[l*2+1]=d,e.heap[1]=d++,QE(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],WXe(e,t),Jne(r,c,e.bl_count)},i9=(e,t,r)=>{let n,s=-1,o,i=t[0*2+1],l=0,c=7,d=4;for(i===0&&(c=138,d=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)o=i,i=t[(n+1)*2+1],!(++l<c&&o===i)&&(l<d?e.bl_tree[o*2]+=l:o!==0?(o!==s&&e.bl_tree[o*2]++,e.bl_tree[zne*2]++):l<=10?e.bl_tree[Une*2]++:e.bl_tree[Vne*2]++,l=0,s=o,i===0?(c=138,d=3):o===i?(c=6,d=3):(c=7,d=4))},l9=(e,t,r)=>{let n,s=-1,o,i=t[0*2+1],l=0,c=7,d=4;for(i===0&&(c=138,d=3),n=0;n<=r;n++)if(o=i,i=t[(n+1)*2+1],!(++l<c&&o===i)){if(l<d)do Of(e,o,e.bl_tree);while(--l!==0);else o!==0?(o!==s&&(Of(e,o,e.bl_tree),l--),Of(e,zne,e.bl_tree),Wc(e,l-3,2)):l<=10?(Of(e,Une,e.bl_tree),Wc(e,l-3,3)):(Of(e,Vne,e.bl_tree),Wc(e,l-11,7));l=0,s=o,i===0?(c=138,d=3):o===i?(c=6,d=3):(c=7,d=4)}},GXe=e=>{let t;for(i9(e,e.dyn_ltree,e.l_desc.max_code),i9(e,e.dyn_dtree,e.d_desc.max_code),y3(e,e.bl_desc),t=FR-1;t>=3&&e.bl_tree[Wne[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},KXe=(e,t,r,n)=>{let s;for(Wc(e,t-257,5),Wc(e,r-1,5),Wc(e,n-4,4),s=0;s<n;s++)Wc(e,e.bl_tree[Wne[s]*2+1],3);l9(e,e.dyn_ltree,t-1),l9(e,e.dyn_dtree,r-1)},XXe=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return n9;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return a9;for(r=32;r<bj;r++)if(e.dyn_ltree[r*2]!==0)return a9;return n9};let c9=!1;const YXe=e=>{c9||(HXe(),c9=!0),e.l_desc=new JE(e.dyn_ltree,Hne),e.d_desc=new JE(e.dyn_dtree,Gne),e.bl_desc=new JE(e.bl_tree,Kne),e.bi_buf=0,e.bi_valid=0,Qne(e)},eae=(e,t,r,n)=>{Wc(e,(FXe<<1)+(n?1:0),3),Zne(e),I1(e,r),I1(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},JXe=e=>{Wc(e,Bne<<1,3),Of(e,LR,ym),VXe(e)},QXe=(e,t,r,n)=>{let s,o,i=0;e.level>0?(e.strm.data_type===RXe&&(e.strm.data_type=XXe(e)),y3(e,e.l_desc),y3(e,e.d_desc),i=GXe(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=r+5,r+4<=s&&t!==-1?eae(e,t,r,n):e.strategy===MXe||o===s?(Wc(e,(Bne<<1)+(n?1:0),3),o9(e,ym,nw)):(Wc(e,(LXe<<1)+(n?1:0),3),KXe(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),o9(e,e.dyn_ltree,e.dyn_dtree)),Qne(e),n&&Zne(e)},ZXe=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(k1[r]+bj+1)*2]++,e.dyn_dtree[Xne(t)*2]++),e.sym_next===e.sym_end);var eYe=YXe,tYe=eae,rYe=QXe,nYe=ZXe,aYe=JXe,sYe={_tr_init:eYe,_tr_stored_block:tYe,_tr_flush_block:rYe,_tr_tally:nYe,_tr_align:aYe};const oYe=(e,t,r,n)=>{let s=e&65535|0,o=e>>>16&65535|0,i=0;for(;r!==0;){i=r>2e3?2e3:r,r-=i;do s=s+t[n++]|0,o=o+s|0;while(--i);s%=65521,o%=65521}return s|o<<16|0};var O1=oYe;const iYe=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},lYe=new Uint32Array(iYe()),cYe=(e,t,r,n)=>{const s=lYe,o=n+r;e^=-1;for(let i=n;i<o;i++)e=e>>>8^s[(e^t[i])&255];return e^-1};var nl=cYe,W0={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},wj={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:dYe,_tr_stored_block:b3,_tr_flush_block:uYe,_tr_tally:op,_tr_align:fYe}=sYe,{Z_NO_FLUSH:ip,Z_PARTIAL_FLUSH:mYe,Z_FULL_FLUSH:hYe,Z_FINISH:du,Z_BLOCK:d9,Z_OK:Pl,Z_STREAM_END:u9,Z_STREAM_ERROR:Xf,Z_DATA_ERROR:pYe,Z_BUF_ERROR:ZE,Z_DEFAULT_COMPRESSION:gYe,Z_FILTERED:xYe,Z_HUFFMAN_ONLY:W2,Z_RLE:vYe,Z_FIXED:yYe,Z_DEFAULT_STRATEGY:bYe,Z_UNKNOWN:wYe,Z_DEFLATED:wP}=wj,jYe=9,_Ye=15,NYe=8,SYe=29,CYe=256,w3=CYe+1+SYe,PYe=30,AYe=19,EYe=2*w3+1,kYe=15,Ts=3,zh=258,Yf=zh+Ts+1,IYe=32,H0=42,BR=57,j3=69,_3=73,N3=91,S3=103,Pg=113,Sb=666,_c=1,Cy=2,dx=3,Py=4,OYe=3,Ag=(e,t)=>(e.msg=W0[t],t),f9=e=>e*2-(e>4?9:0),Ih=e=>{let t=e.length;for(;--t>=0;)e[t]=0},TYe=e=>{let t,r,n,s=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=s?r-s:0;while(--t);t=s,n=t;do r=e.prev[--n],e.prev[n]=r>=s?r-s:0;while(--t)};let DYe=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,lp=DYe;const gd=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Pd=(e,t)=>{uYe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,gd(e.strm)},Qs=(e,t)=>{e.pending_buf[e.pending++]=t},ib=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},C3=(e,t,r,n)=>{let s=e.avail_in;return s>n&&(s=n),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),r),e.state.wrap===1?e.adler=O1(e.adler,t,s,r):e.state.wrap===2&&(e.adler=nl(e.adler,t,s,r)),e.next_in+=s,e.total_in+=s,s)},tae=(e,t)=>{let r=e.max_chain_length,n=e.strstart,s,o,i=e.prev_length,l=e.nice_match;const c=e.strstart>e.w_size-Yf?e.strstart-(e.w_size-Yf):0,d=e.window,u=e.w_mask,f=e.prev,h=e.strstart+zh;let m=d[n+i-1],x=d[n+i];e.prev_length>=e.good_match&&(r>>=2),l>e.lookahead&&(l=e.lookahead);do if(s=t,!(d[s+i]!==x||d[s+i-1]!==m||d[s]!==d[n]||d[++s]!==d[n+1])){n+=2,s++;do;while(d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&n<h);if(o=zh-(h-n),n=h-zh,o>i){if(e.match_start=t,i=o,o>=l)break;m=d[n+i-1],x=d[n+i]}}while((t=f[t&u])>c&&--r!==0);return i<=e.lookahead?i:e.lookahead},G0=e=>{const t=e.w_size;let r,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Yf)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),TYe(e),n+=t),e.strm.avail_in===0)break;if(r=C3(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=Ts)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=lp(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=lp(e,e.ins_h,e.window[s+Ts-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<Ts)););}while(e.lookahead<Yf&&e.strm.avail_in!==0)},rae=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,s,o,i=0,l=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>o&&(n=o),n<r&&(n===0&&t!==du||t===ip||n!==s+e.strm.avail_in)))break;i=t===du&&n===s+e.strm.avail_in?1:0,b3(e,0,0,i),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,gd(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(C3(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(i===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?Py:t!==ip&&t!==du&&e.strm.avail_in===0&&e.strstart===e.block_start?Cy:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(C3(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,r=o>e.w_size?e.w_size:o,s=e.strstart-e.block_start,(s>=r||(s||t===du)&&t!==ip&&e.strm.avail_in===0&&s<=o)&&(n=s>o?o:s,i=t===du&&e.strm.avail_in===0&&n===s?1:0,b3(e,e.block_start,n,i),e.block_start+=n,gd(e.strm)),i?dx:_c)},ek=(e,t)=>{let r,n;for(;;){if(e.lookahead<Yf){if(G0(e),e.lookahead<Yf&&t===ip)return _c;if(e.lookahead===0)break}if(r=0,e.lookahead>=Ts&&(e.ins_h=lp(e,e.ins_h,e.window[e.strstart+Ts-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Yf&&(e.match_length=tae(e,r)),e.match_length>=Ts)if(n=op(e,e.strstart-e.match_start,e.match_length-Ts),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=Ts){e.match_length--;do e.strstart++,e.ins_h=lp(e,e.ins_h,e.window[e.strstart+Ts-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=lp(e,e.ins_h,e.window[e.strstart+1]);else n=op(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Pd(e,!1),e.strm.avail_out===0))return _c}return e.insert=e.strstart<Ts-1?e.strstart:Ts-1,t===du?(Pd(e,!0),e.strm.avail_out===0?dx:Py):e.sym_next&&(Pd(e,!1),e.strm.avail_out===0)?_c:Cy},Yx=(e,t)=>{let r,n,s;for(;;){if(e.lookahead<Yf){if(G0(e),e.lookahead<Yf&&t===ip)return _c;if(e.lookahead===0)break}if(r=0,e.lookahead>=Ts&&(e.ins_h=lp(e,e.ins_h,e.window[e.strstart+Ts-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=Ts-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Yf&&(e.match_length=tae(e,r),e.match_length<=5&&(e.strategy===xYe||e.match_length===Ts&&e.strstart-e.match_start>4096)&&(e.match_length=Ts-1)),e.prev_length>=Ts&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-Ts,n=op(e,e.strstart-1-e.prev_match,e.prev_length-Ts),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=lp(e,e.ins_h,e.window[e.strstart+Ts-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=Ts-1,e.strstart++,n&&(Pd(e,!1),e.strm.avail_out===0))return _c}else if(e.match_available){if(n=op(e,0,e.window[e.strstart-1]),n&&Pd(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return _c}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=op(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<Ts-1?e.strstart:Ts-1,t===du?(Pd(e,!0),e.strm.avail_out===0?dx:Py):e.sym_next&&(Pd(e,!1),e.strm.avail_out===0)?_c:Cy},MYe=(e,t)=>{let r,n,s,o;const i=e.window;for(;;){if(e.lookahead<=zh){if(G0(e),e.lookahead<=zh&&t===ip)return _c;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=Ts&&e.strstart>0&&(s=e.strstart-1,n=i[s],n===i[++s]&&n===i[++s]&&n===i[++s])){o=e.strstart+zh;do;while(n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&s<o);e.match_length=zh-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=Ts?(r=op(e,1,e.match_length-Ts),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=op(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Pd(e,!1),e.strm.avail_out===0))return _c}return e.insert=0,t===du?(Pd(e,!0),e.strm.avail_out===0?dx:Py):e.sym_next&&(Pd(e,!1),e.strm.avail_out===0)?_c:Cy},RYe=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(G0(e),e.lookahead===0)){if(t===ip)return _c;break}if(e.match_length=0,r=op(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Pd(e,!1),e.strm.avail_out===0))return _c}return e.insert=0,t===du?(Pd(e,!0),e.strm.avail_out===0?dx:Py):e.sym_next&&(Pd(e,!1),e.strm.avail_out===0)?_c:Cy};function Nf(e,t,r,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=s}const Cb=[new Nf(0,0,0,0,rae),new Nf(4,4,8,4,ek),new Nf(4,5,16,8,ek),new Nf(4,6,32,32,ek),new Nf(4,4,16,16,Yx),new Nf(8,16,32,32,Yx),new Nf(8,16,128,128,Yx),new Nf(8,32,128,256,Yx),new Nf(32,128,258,1024,Yx),new Nf(32,258,258,4096,Yx)],FYe=e=>{e.window_size=2*e.w_size,Ih(e.head),e.max_lazy_match=Cb[e.level].max_lazy,e.good_match=Cb[e.level].good_length,e.nice_match=Cb[e.level].nice_length,e.max_chain_length=Cb[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=Ts-1,e.match_available=0,e.ins_h=0};function LYe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=wP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(EYe*2),this.dyn_dtree=new Uint16Array((2*PYe+1)*2),this.bl_tree=new Uint16Array((2*AYe+1)*2),Ih(this.dyn_ltree),Ih(this.dyn_dtree),Ih(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(kYe+1),this.heap=new Uint16Array(2*w3+1),Ih(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*w3+1),Ih(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const jj=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==H0&&t.status!==BR&&t.status!==j3&&t.status!==_3&&t.status!==N3&&t.status!==S3&&t.status!==Pg&&t.status!==Sb?1:0},nae=e=>{if(jj(e))return Ag(e,Xf);e.total_in=e.total_out=0,e.data_type=wYe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?BR:t.wrap?H0:Pg,e.adler=t.wrap===2?0:1,t.last_flush=-2,dYe(t),Pl},aae=e=>{const t=nae(e);return t===Pl&&FYe(e.state),t},$Ye=(e,t)=>jj(e)||e.state.wrap!==2?Xf:(e.state.gzhead=t,Pl),sae=(e,t,r,n,s,o)=>{if(!e)return Xf;let i=1;if(t===gYe&&(t=6),n<0?(i=0,n=-n):n>15&&(i=2,n-=16),s<1||s>jYe||r!==wP||n<8||n>15||t<0||t>9||o<0||o>yYe||n===8&&i!==1)return Ag(e,Xf);n===8&&(n=9);const l=new LYe;return e.state=l,l.strm=e,l.status=H0,l.wrap=i,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+Ts-1)/Ts),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=t,l.strategy=o,l.method=r,aae(e)},BYe=(e,t)=>sae(e,t,wP,_Ye,NYe,bYe),qYe=(e,t)=>{if(jj(e)||t>d9||t<0)return e?Ag(e,Xf):Xf;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===Sb&&t!==du)return Ag(e,e.avail_out===0?ZE:Xf);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(gd(e),e.avail_out===0)return r.last_flush=-1,Pl}else if(e.avail_in===0&&f9(t)<=f9(n)&&t!==du)return Ag(e,ZE);if(r.status===Sb&&e.avail_in!==0)return Ag(e,ZE);if(r.status===H0&&r.wrap===0&&(r.status=Pg),r.status===H0){let s=wP+(r.w_bits-8<<4)<<8,o=-1;if(r.strategy>=W2||r.level<2?o=0:r.level<6?o=1:r.level===6?o=2:o=3,s|=o<<6,r.strstart!==0&&(s|=IYe),s+=31-s%31,ib(r,s),r.strstart!==0&&(ib(r,e.adler>>>16),ib(r,e.adler&65535)),e.adler=1,r.status=Pg,gd(e),r.pending!==0)return r.last_flush=-1,Pl}if(r.status===BR){if(e.adler=0,Qs(r,31),Qs(r,139),Qs(r,8),r.gzhead)Qs(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Qs(r,r.gzhead.time&255),Qs(r,r.gzhead.time>>8&255),Qs(r,r.gzhead.time>>16&255),Qs(r,r.gzhead.time>>24&255),Qs(r,r.level===9?2:r.strategy>=W2||r.level<2?4:0),Qs(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(Qs(r,r.gzhead.extra.length&255),Qs(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=nl(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=j3;else if(Qs(r,0),Qs(r,0),Qs(r,0),Qs(r,0),Qs(r,0),Qs(r,r.level===9?2:r.strategy>=W2||r.level<2?4:0),Qs(r,OYe),r.status=Pg,gd(e),r.pending!==0)return r.last_flush=-1,Pl}if(r.status===j3){if(r.gzhead.extra){let s=r.pending,o=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let l=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+l),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>s&&(e.adler=nl(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex+=l,gd(e),r.pending!==0)return r.last_flush=-1,Pl;s=0,o-=l}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>s&&(e.adler=nl(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=_3}if(r.status===_3){if(r.gzhead.name){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=nl(e.adler,r.pending_buf,r.pending-s,s)),gd(e),r.pending!==0)return r.last_flush=-1,Pl;s=0}r.gzindex<r.gzhead.name.length?o=r.gzhead.name.charCodeAt(r.gzindex++)&255:o=0,Qs(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=nl(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=N3}if(r.status===N3){if(r.gzhead.comment){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=nl(e.adler,r.pending_buf,r.pending-s,s)),gd(e),r.pending!==0)return r.last_flush=-1,Pl;s=0}r.gzindex<r.gzhead.comment.length?o=r.gzhead.comment.charCodeAt(r.gzindex++)&255:o=0,Qs(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=nl(e.adler,r.pending_buf,r.pending-s,s))}r.status=S3}if(r.status===S3){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(gd(e),r.pending!==0))return r.last_flush=-1,Pl;Qs(r,e.adler&255),Qs(r,e.adler>>8&255),e.adler=0}if(r.status=Pg,gd(e),r.pending!==0)return r.last_flush=-1,Pl}if(e.avail_in!==0||r.lookahead!==0||t!==ip&&r.status!==Sb){let s=r.level===0?rae(r,t):r.strategy===W2?RYe(r,t):r.strategy===vYe?MYe(r,t):Cb[r.level].func(r,t);if((s===dx||s===Py)&&(r.status=Sb),s===_c||s===dx)return e.avail_out===0&&(r.last_flush=-1),Pl;if(s===Cy&&(t===mYe?fYe(r):t!==d9&&(b3(r,0,0,!1),t===hYe&&(Ih(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),gd(e),e.avail_out===0))return r.last_flush=-1,Pl}return t!==du?Pl:r.wrap<=0?u9:(r.wrap===2?(Qs(r,e.adler&255),Qs(r,e.adler>>8&255),Qs(r,e.adler>>16&255),Qs(r,e.adler>>24&255),Qs(r,e.total_in&255),Qs(r,e.total_in>>8&255),Qs(r,e.total_in>>16&255),Qs(r,e.total_in>>24&255)):(ib(r,e.adler>>>16),ib(r,e.adler&65535)),gd(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Pl:u9)},zYe=e=>{if(jj(e))return Xf;const t=e.state.status;return e.state=null,t===Pg?Ag(e,pYe):Pl},UYe=(e,t)=>{let r=t.length;if(jj(e))return Xf;const n=e.state,s=n.wrap;if(s===2||s===1&&n.status!==H0||n.lookahead)return Xf;if(s===1&&(e.adler=O1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){s===0&&(Ih(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(t.subarray(r-n.w_size,r),0),t=c,r=n.w_size}const o=e.avail_in,i=e.next_in,l=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,G0(n);n.lookahead>=Ts;){let c=n.strstart,d=n.lookahead-(Ts-1);do n.ins_h=lp(n,n.ins_h,n.window[c+Ts-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--d);n.strstart=c,n.lookahead=Ts-1,G0(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Ts-1,n.match_available=0,e.next_in=i,e.input=l,e.avail_in=o,n.wrap=s,Pl};var VYe=BYe,WYe=sae,HYe=aae,GYe=nae,KYe=$Ye,XYe=qYe,YYe=zYe,JYe=UYe,QYe="pako deflate (from Nodeca project)",aw={deflateInit:VYe,deflateInit2:WYe,deflateReset:HYe,deflateResetKeep:GYe,deflateSetHeader:KYe,deflate:XYe,deflateEnd:YYe,deflateSetDictionary:JYe,deflateInfo:QYe};const ZYe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var eJe=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)ZYe(r,n)&&(e[n]=r[n])}}return e},tJe=e=>{let t=0;for(let n=0,s=e.length;n<s;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,s=0,o=e.length;n<o;n++){let i=e[n];r.set(i,s),s+=i.length}return r},jP={assign:eJe,flattenChunks:tJe};let oae=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{oae=!1}const T1=new Uint8Array(256);for(let e=0;e<256;e++)T1[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;T1[254]=T1[254]=1;var rJe=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,s,o,i=e.length,l=0;for(s=0;s<i;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<i&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(l),o=0,s=0;o<l;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<i&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|r&63):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|r&63):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|r&63);return t};const nJe=(e,t)=>{if(t<65534&&e.subarray&&oae)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var aJe=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,s;const o=new Array(r*2);for(s=0,n=0;n<r;){let i=e[n++];if(i<128){o[s++]=i;continue}let l=T1[i];if(l>4){o[s++]=65533,n+=l-1;continue}for(i&=l===2?31:l===3?15:7;l>1&&n<r;)i=i<<6|e[n++]&63,l--;if(l>1){o[s++]=65533;continue}i<65536?o[s++]=i:(i-=65536,o[s++]=55296|i>>10&1023,o[s++]=56320|i&1023)}return nJe(o,s)},sJe=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+T1[e[r]]>t?r:t},D1={string2buf:rJe,buf2string:aJe,utf8border:sJe};function oJe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var iae=oJe;const lae=Object.prototype.toString,{Z_NO_FLUSH:iJe,Z_SYNC_FLUSH:lJe,Z_FULL_FLUSH:cJe,Z_FINISH:dJe,Z_OK:nC,Z_STREAM_END:uJe,Z_DEFAULT_COMPRESSION:fJe,Z_DEFAULT_STRATEGY:mJe,Z_DEFLATED:hJe}=wj;function qR(e){this.options=jP.assign({level:fJe,method:hJe,chunkSize:16384,windowBits:15,memLevel:8,strategy:mJe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iae,this.strm.avail_out=0;let r=aw.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==nC)throw new Error(W0[r]);if(t.header&&aw.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=D1.string2buf(t.dictionary):lae.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=aw.deflateSetDictionary(this.strm,n),r!==nC)throw new Error(W0[r]);this._dict_set=!0}}qR.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let s,o;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?dJe:iJe,typeof e=="string"?r.input=D1.string2buf(e):lae.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===lJe||o===cJe)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(s=aw.deflate(r,o),s===uJe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),s=aw.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===nC;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};qR.prototype.onData=function(e){this.chunks.push(e)};qR.prototype.onEnd=function(e){e===nC&&(this.result=jP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const H2=16209,pJe=16191;var gJe=function(t,r){let n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w,j,_,C,A,S,P,M;const O=t.state;n=t.next_in,P=t.input,s=n+(t.avail_in-5),o=t.next_out,M=t.output,i=o-(r-t.avail_out),l=o+(t.avail_out-257),c=O.dmax,d=O.wsize,u=O.whave,f=O.wnext,h=O.window,m=O.hold,x=O.bits,g=O.lencode,v=O.distcode,y=(1<<O.lenbits)-1,b=(1<<O.distbits)-1;e:do{x<15&&(m+=P[n++]<<x,x+=8,m+=P[n++]<<x,x+=8),w=g[m&y];t:for(;;){if(j=w>>>24,m>>>=j,x-=j,j=w>>>16&255,j===0)M[o++]=w&65535;else if(j&16){_=w&65535,j&=15,j&&(x<j&&(m+=P[n++]<<x,x+=8),_+=m&(1<<j)-1,m>>>=j,x-=j),x<15&&(m+=P[n++]<<x,x+=8,m+=P[n++]<<x,x+=8),w=v[m&b];r:for(;;){if(j=w>>>24,m>>>=j,x-=j,j=w>>>16&255,j&16){if(C=w&65535,j&=15,x<j&&(m+=P[n++]<<x,x+=8,x<j&&(m+=P[n++]<<x,x+=8)),C+=m&(1<<j)-1,C>c){t.msg="invalid distance too far back",O.mode=H2;break e}if(m>>>=j,x-=j,j=o-i,C>j){if(j=C-j,j>u&&O.sane){t.msg="invalid distance too far back",O.mode=H2;break e}if(A=0,S=h,f===0){if(A+=d-j,j<_){_-=j;do M[o++]=h[A++];while(--j);A=o-C,S=M}}else if(f<j){if(A+=d+f-j,j-=f,j<_){_-=j;do M[o++]=h[A++];while(--j);if(A=0,f<_){j=f,_-=j;do M[o++]=h[A++];while(--j);A=o-C,S=M}}}else if(A+=f-j,j<_){_-=j;do M[o++]=h[A++];while(--j);A=o-C,S=M}for(;_>2;)M[o++]=S[A++],M[o++]=S[A++],M[o++]=S[A++],_-=3;_&&(M[o++]=S[A++],_>1&&(M[o++]=S[A++]))}else{A=o-C;do M[o++]=M[A++],M[o++]=M[A++],M[o++]=M[A++],_-=3;while(_>2);_&&(M[o++]=M[A++],_>1&&(M[o++]=M[A++]))}}else if(j&64){t.msg="invalid distance code",O.mode=H2;break e}else{w=v[(w&65535)+(m&(1<<j)-1)];continue r}break}}else if(j&64)if(j&32){O.mode=pJe;break e}else{t.msg="invalid literal/length code",O.mode=H2;break e}else{w=g[(w&65535)+(m&(1<<j)-1)];continue t}break}}while(n<s&&o<l);_=x>>3,n-=_,x-=_<<3,m&=(1<<x)-1,t.next_in=n,t.next_out=o,t.avail_in=n<s?5+(s-n):5-(n-s),t.avail_out=o<l?257+(l-o):257-(o-l),O.hold=m,O.bits=x};const Jx=15,m9=852,h9=592,p9=0,tk=1,g9=2,xJe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),vJe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yJe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bJe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),wJe=(e,t,r,n,s,o,i,l)=>{const c=l.bits;let d=0,u=0,f=0,h=0,m=0,x=0,g=0,v=0,y=0,b=0,w,j,_,C,A,S=null,P;const M=new Uint16Array(Jx+1),O=new Uint16Array(Jx+1);let I=null,T,k,$;for(d=0;d<=Jx;d++)M[d]=0;for(u=0;u<n;u++)M[t[r+u]]++;for(m=c,h=Jx;h>=1&&M[h]===0;h--);if(m>h&&(m=h),h===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,l.bits=1,0;for(f=1;f<h&&M[f]===0;f++);for(m<f&&(m=f),v=1,d=1;d<=Jx;d++)if(v<<=1,v-=M[d],v<0)return-1;if(v>0&&(e===p9||h!==1))return-1;for(O[1]=0,d=1;d<Jx;d++)O[d+1]=O[d]+M[d];for(u=0;u<n;u++)t[r+u]!==0&&(i[O[t[r+u]]++]=u);if(e===p9?(S=I=i,P=20):e===tk?(S=xJe,I=vJe,P=257):(S=yJe,I=bJe,P=0),b=0,u=0,d=f,A=o,x=m,g=0,_=-1,y=1<<m,C=y-1,e===tk&&y>m9||e===g9&&y>h9)return 1;for(;;){T=d-g,i[u]+1<P?(k=0,$=i[u]):i[u]>=P?(k=I[i[u]-P],$=S[i[u]-P]):(k=32+64,$=0),w=1<<d-g,j=1<<x,f=j;do j-=w,s[A+(b>>g)+j]=T<<24|k<<16|$|0;while(j!==0);for(w=1<<d-1;b&w;)w>>=1;if(w!==0?(b&=w-1,b+=w):b=0,u++,--M[d]===0){if(d===h)break;d=t[r+i[u]]}if(d>m&&(b&C)!==_){for(g===0&&(g=m),A+=f,x=d-g,v=1<<x;x+g<h&&(v-=M[x+g],!(v<=0));)x++,v<<=1;if(y+=1<<x,e===tk&&y>m9||e===g9&&y>h9)return 1;_=b&C,s[_]=m<<24|x<<16|A-o|0}}return b!==0&&(s[A+b]=d-g<<24|64<<16|0),l.bits=m,0};var sw=wJe;const jJe=0,cae=1,dae=2,{Z_FINISH:x9,Z_BLOCK:_Je,Z_TREES:G2,Z_OK:ux,Z_STREAM_END:NJe,Z_NEED_DICT:SJe,Z_STREAM_ERROR:Su,Z_DATA_ERROR:uae,Z_MEM_ERROR:fae,Z_BUF_ERROR:CJe,Z_DEFLATED:v9}=wj,_P=16180,y9=16181,b9=16182,w9=16183,j9=16184,_9=16185,N9=16186,S9=16187,C9=16188,P9=16189,aC=16190,dm=16191,rk=16192,A9=16193,nk=16194,E9=16195,k9=16196,I9=16197,O9=16198,K2=16199,X2=16200,T9=16201,D9=16202,M9=16203,R9=16204,F9=16205,ak=16206,L9=16207,$9=16208,Uo=16209,mae=16210,hae=16211,PJe=852,AJe=592,EJe=15,kJe=EJe,B9=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function IJe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ax=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<_P||t.mode>hae?1:0},pae=e=>{if(Ax(e))return Su;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=_P,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(PJe),t.distcode=t.distdyn=new Int32Array(AJe),t.sane=1,t.back=-1,ux},gae=e=>{if(Ax(e))return Su;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,pae(e)},xae=(e,t)=>{let r;if(Ax(e))return Su;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Su:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,gae(e))},vae=(e,t)=>{if(!e)return Su;const r=new IJe;e.state=r,r.strm=e,r.window=null,r.mode=_P;const n=xae(e,t);return n!==ux&&(e.state=null),n},OJe=e=>vae(e,kJe);let q9=!0,sk,ok;const TJe=e=>{if(q9){sk=new Int32Array(512),ok=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(sw(cae,e.lens,0,288,sk,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;sw(dae,e.lens,0,32,ok,0,e.work,{bits:5}),q9=!1}e.lencode=sk,e.lenbits=9,e.distcode=ok,e.distbits=5},yae=(e,t,r,n)=>{let s;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>n&&(s=n),o.window.set(t.subarray(r-n,r-n+s),o.wnext),n-=s,n?(o.window.set(t.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0},DJe=(e,t)=>{let r,n,s,o,i,l,c,d,u,f,h,m,x,g,v=0,y,b,w,j,_,C,A,S;const P=new Uint8Array(4);let M,O;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ax(e)||!e.output||!e.input&&e.avail_in!==0)return Su;r=e.state,r.mode===dm&&(r.mode=rk),i=e.next_out,s=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,u=r.bits,f=l,h=c,S=ux;e:for(;;)switch(r.mode){case _P:if(r.wrap===0){r.mode=rk;break}for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&2&&d===35615){r.wbits===0&&(r.wbits=15),r.check=0,P[0]=d&255,P[1]=d>>>8&255,r.check=nl(r.check,P,2,0),d=0,u=0,r.mode=y9;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((d&255)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=Uo;break}if((d&15)!==v9){e.msg="unknown compression method",r.mode=Uo;break}if(d>>>=4,u-=4,A=(d&15)+8,r.wbits===0&&(r.wbits=A),A>15||A>r.wbits){e.msg="invalid window size",r.mode=Uo;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=d&512?P9:dm,d=0,u=0;break;case y9:for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.flags=d,(r.flags&255)!==v9){e.msg="unknown compression method",r.mode=Uo;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=Uo;break}r.head&&(r.head.text=d>>8&1),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,r.check=nl(r.check,P,2,0)),d=0,u=0,r.mode=b9;case b9:for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.head&&(r.head.time=d),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,P[2]=d>>>16&255,P[3]=d>>>24&255,r.check=nl(r.check,P,4,0)),d=0,u=0,r.mode=w9;case w9:for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.head&&(r.head.xflags=d&255,r.head.os=d>>8),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,r.check=nl(r.check,P,2,0)),d=0,u=0,r.mode=j9;case j9:if(r.flags&1024){for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.length=d,r.head&&(r.head.extra_len=d),r.flags&512&&r.wrap&4&&(P[0]=d&255,P[1]=d>>>8&255,r.check=nl(r.check,P,2,0)),d=0,u=0}else r.head&&(r.head.extra=null);r.mode=_9;case _9:if(r.flags&1024&&(m=r.length,m>l&&(m=l),m&&(r.head&&(A=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+m),A)),r.flags&512&&r.wrap&4&&(r.check=nl(r.check,n,m,o)),l-=m,o+=m,r.length-=m),r.length))break e;r.length=0,r.mode=N9;case N9:if(r.flags&2048){if(l===0)break e;m=0;do A=n[o+m++],r.head&&A&&r.length<65536&&(r.head.name+=String.fromCharCode(A));while(A&&m<l);if(r.flags&512&&r.wrap&4&&(r.check=nl(r.check,n,m,o)),l-=m,o+=m,A)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=S9;case S9:if(r.flags&4096){if(l===0)break e;m=0;do A=n[o+m++],r.head&&A&&r.length<65536&&(r.head.comment+=String.fromCharCode(A));while(A&&m<l);if(r.flags&512&&r.wrap&4&&(r.check=nl(r.check,n,m,o)),l-=m,o+=m,A)break e}else r.head&&(r.head.comment=null);r.mode=C9;case C9:if(r.flags&512){for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&4&&d!==(r.check&65535)){e.msg="header crc mismatch",r.mode=Uo;break}d=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=dm;break;case P9:for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}e.adler=r.check=B9(d),d=0,u=0,r.mode=aC;case aC:if(r.havedict===0)return e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,SJe;e.adler=r.check=1,r.mode=dm;case dm:if(t===_Je||t===G2)break e;case rk:if(r.last){d>>>=u&7,u-=u&7,r.mode=ak;break}for(;u<3;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}switch(r.last=d&1,d>>>=1,u-=1,d&3){case 0:r.mode=A9;break;case 1:if(TJe(r),r.mode=K2,t===G2){d>>>=2,u-=2;break e}break;case 2:r.mode=k9;break;case 3:e.msg="invalid block type",r.mode=Uo}d>>>=2,u-=2;break;case A9:for(d>>>=u&7,u-=u&7;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if((d&65535)!==(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Uo;break}if(r.length=d&65535,d=0,u=0,r.mode=nk,t===G2)break e;case nk:r.mode=E9;case E9:if(m=r.length,m){if(m>l&&(m=l),m>c&&(m=c),m===0)break e;s.set(n.subarray(o,o+m),i),l-=m,o+=m,c-=m,i+=m,r.length-=m;break}r.mode=dm;break;case k9:for(;u<14;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.nlen=(d&31)+257,d>>>=5,u-=5,r.ndist=(d&31)+1,d>>>=5,u-=5,r.ncode=(d&15)+4,d>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Uo;break}r.have=0,r.mode=I9;case I9:for(;r.have<r.ncode;){for(;u<3;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.lens[I[r.have++]]=d&7,d>>>=3,u-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,M={bits:r.lenbits},S=sw(jJe,r.lens,0,19,r.lencode,0,r.work,M),r.lenbits=M.bits,S){e.msg="invalid code lengths set",r.mode=Uo;break}r.have=0,r.mode=O9;case O9:for(;r.have<r.nlen+r.ndist;){for(;v=r.lencode[d&(1<<r.lenbits)-1],y=v>>>24,b=v>>>16&255,w=v&65535,!(y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(w<16)d>>>=y,u-=y,r.lens[r.have++]=w;else{if(w===16){for(O=y+2;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(d>>>=y,u-=y,r.have===0){e.msg="invalid bit length repeat",r.mode=Uo;break}A=r.lens[r.have-1],m=3+(d&3),d>>>=2,u-=2}else if(w===17){for(O=y+3;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=y,u-=y,A=0,m=3+(d&7),d>>>=3,u-=3}else{for(O=y+7;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=y,u-=y,A=0,m=11+(d&127),d>>>=7,u-=7}if(r.have+m>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Uo;break}for(;m--;)r.lens[r.have++]=A}}if(r.mode===Uo)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Uo;break}if(r.lenbits=9,M={bits:r.lenbits},S=sw(cae,r.lens,0,r.nlen,r.lencode,0,r.work,M),r.lenbits=M.bits,S){e.msg="invalid literal/lengths set",r.mode=Uo;break}if(r.distbits=6,r.distcode=r.distdyn,M={bits:r.distbits},S=sw(dae,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,M),r.distbits=M.bits,S){e.msg="invalid distances set",r.mode=Uo;break}if(r.mode=K2,t===G2)break e;case K2:r.mode=X2;case X2:if(l>=6&&c>=258){e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,gJe(e,h),i=e.next_out,s=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,u=r.bits,r.mode===dm&&(r.back=-1);break}for(r.back=0;v=r.lencode[d&(1<<r.lenbits)-1],y=v>>>24,b=v>>>16&255,w=v&65535,!(y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(b&&!(b&240)){for(j=y,_=b,C=w;v=r.lencode[C+((d&(1<<j+_)-1)>>j)],y=v>>>24,b=v>>>16&255,w=v&65535,!(j+y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=j,u-=j,r.back+=j}if(d>>>=y,u-=y,r.back+=y,r.length=w,b===0){r.mode=F9;break}if(b&32){r.back=-1,r.mode=dm;break}if(b&64){e.msg="invalid literal/length code",r.mode=Uo;break}r.extra=b&15,r.mode=T9;case T9:if(r.extra){for(O=r.extra;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=D9;case D9:for(;v=r.distcode[d&(1<<r.distbits)-1],y=v>>>24,b=v>>>16&255,w=v&65535,!(y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(!(b&240)){for(j=y,_=b,C=w;v=r.distcode[C+((d&(1<<j+_)-1)>>j)],y=v>>>24,b=v>>>16&255,w=v&65535,!(j+y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=j,u-=j,r.back+=j}if(d>>>=y,u-=y,r.back+=y,b&64){e.msg="invalid distance code",r.mode=Uo;break}r.offset=w,r.extra=b&15,r.mode=M9;case M9:if(r.extra){for(O=r.extra;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Uo;break}r.mode=R9;case R9:if(c===0)break e;if(m=h-c,r.offset>m){if(m=r.offset-m,m>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Uo;break}m>r.wnext?(m-=r.wnext,x=r.wsize-m):x=r.wnext-m,m>r.length&&(m=r.length),g=r.window}else g=s,x=i-r.offset,m=r.length;m>c&&(m=c),c-=m,r.length-=m;do s[i++]=g[x++];while(--m);r.length===0&&(r.mode=X2);break;case F9:if(c===0)break e;s[i++]=r.length,c--,r.mode=X2;break;case ak:if(r.wrap){for(;u<32;){if(l===0)break e;l--,d|=n[o++]<<u,u+=8}if(h-=c,e.total_out+=h,r.total+=h,r.wrap&4&&h&&(e.adler=r.check=r.flags?nl(r.check,s,h,i-h):O1(r.check,s,h,i-h)),h=c,r.wrap&4&&(r.flags?d:B9(d))!==r.check){e.msg="incorrect data check",r.mode=Uo;break}d=0,u=0}r.mode=L9;case L9:if(r.wrap&&r.flags){for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&4&&d!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=Uo;break}d=0,u=0}r.mode=$9;case $9:S=NJe;break e;case Uo:S=uae;break e;case mae:return fae;case hae:default:return Su}return e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,(r.wsize||h!==e.avail_out&&r.mode<Uo&&(r.mode<ak||t!==x9))&&yae(e,e.output,e.next_out,h-e.avail_out),f-=e.avail_in,h-=e.avail_out,e.total_in+=f,e.total_out+=h,r.total+=h,r.wrap&4&&h&&(e.adler=r.check=r.flags?nl(r.check,s,h,e.next_out-h):O1(r.check,s,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===dm?128:0)+(r.mode===K2||r.mode===nk?256:0),(f===0&&h===0||t===x9)&&S===ux&&(S=CJe),S},MJe=e=>{if(Ax(e))return Su;let t=e.state;return t.window&&(t.window=null),e.state=null,ux},RJe=(e,t)=>{if(Ax(e))return Su;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,ux):Su},FJe=(e,t)=>{const r=t.length;let n,s,o;return Ax(e)||(n=e.state,n.wrap!==0&&n.mode!==aC)?Su:n.mode===aC&&(s=1,s=O1(s,t,r,0),s!==n.check)?uae:(o=yae(e,t,r,r),o?(n.mode=mae,fae):(n.havedict=1,ux))};var LJe=gae,$Je=xae,BJe=pae,qJe=OJe,zJe=vae,UJe=DJe,VJe=MJe,WJe=RJe,HJe=FJe,GJe="pako inflate (from Nodeca project)",bm={inflateReset:LJe,inflateReset2:$Je,inflateResetKeep:BJe,inflateInit:qJe,inflateInit2:zJe,inflate:UJe,inflateEnd:VJe,inflateGetHeader:WJe,inflateSetDictionary:HJe,inflateInfo:GJe};function KJe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var XJe=KJe;const bae=Object.prototype.toString,{Z_NO_FLUSH:YJe,Z_FINISH:JJe,Z_OK:M1,Z_STREAM_END:ik,Z_NEED_DICT:lk,Z_STREAM_ERROR:QJe,Z_DATA_ERROR:z9,Z_MEM_ERROR:ZJe}=wj;function _j(e){this.options=jP.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iae,this.strm.avail_out=0;let r=bm.inflateInit2(this.strm,t.windowBits);if(r!==M1)throw new Error(W0[r]);if(this.header=new XJe,bm.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=D1.string2buf(t.dictionary):bae.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=bm.inflateSetDictionary(this.strm,t.dictionary),r!==M1)))throw new Error(W0[r])}_j.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let o,i,l;if(this.ended)return!1;for(t===~~t?i=t:i=t===!0?JJe:YJe,bae.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=bm.inflate(r,i),o===lk&&s&&(o=bm.inflateSetDictionary(r,s),o===M1?o=bm.inflate(r,i):o===z9&&(o=lk));r.avail_in>0&&o===ik&&r.state.wrap>0&&e[r.next_in]!==0;)bm.inflateReset(r),o=bm.inflate(r,i);switch(o){case QJe:case z9:case lk:case ZJe:return this.onEnd(o),this.ended=!0,!1}if(l=r.avail_out,r.next_out&&(r.avail_out===0||o===ik))if(this.options.to==="string"){let c=D1.utf8border(r.output,r.next_out),d=r.next_out-c,u=D1.buf2string(r.output,c);r.next_out=d,r.avail_out=n-d,d&&r.output.set(r.output.subarray(c,c+d),0),this.onData(u)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===M1&&l===0)){if(o===ik)return o=bm.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};_j.prototype.onData=function(e){this.chunks.push(e)};_j.prototype.onEnd=function(e){e===M1&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=jP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function zR(e,t){const r=new _j(t);if(r.push(e),r.err)throw r.msg||W0[r.err];return r.result}function eQe(e,t){return t=t||{},t.raw=!0,zR(e,t)}var tQe=_j,rQe=zR,nQe=eQe,aQe=zR,sQe=wj,oQe={Inflate:tQe,inflate:rQe,inflateRaw:nQe,ungzip:aQe,constants:sQe};const{Inflate:iQe,inflate:lQe,inflateRaw:jct,ungzip:_ct}=oQe;var U9=iQe,cQe=lQe;const wae=[];for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;wae[e]=t}const V9=4294967295;function dQe(e,t,r){let n=e;for(let s=0;s<r;s++)n=wae[(n^t[s])&255]^n>>>8;return n}function uQe(e,t){return(dQe(V9,e,t)^V9)>>>0}function W9(e,t,r){const n=e.readUint32(),s=uQe(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(s!==n)throw new Error(`CRC mismatch for chunk ${r}. Expected ${n}, found ${s}`)}function jae(e,t,r){for(let n=0;n<r;n++)t[n]=e[n]}function _ae(e,t,r,n){let s=0;for(;s<n;s++)t[s]=e[s];for(;s<r;s++)t[s]=e[s]+t[s-n]&255}function Nae(e,t,r,n){let s=0;if(r.length===0)for(;s<n;s++)t[s]=e[s];else for(;s<n;s++)t[s]=e[s]+r[s]&255}function Sae(e,t,r,n,s){let o=0;if(r.length===0){for(;o<s;o++)t[o]=e[o];for(;o<n;o++)t[o]=e[o]+(t[o-s]>>1)&255}else{for(;o<s;o++)t[o]=e[o]+(r[o]>>1)&255;for(;o<n;o++)t[o]=e[o]+(t[o-s]+r[o]>>1)&255}}function Cae(e,t,r,n,s){let o=0;if(r.length===0){for(;o<s;o++)t[o]=e[o];for(;o<n;o++)t[o]=e[o]+t[o-s]&255}else{for(;o<s;o++)t[o]=e[o]+r[o]&255;for(;o<n;o++)t[o]=e[o]+fQe(t[o-s],r[o],r[o-s])&255}}function fQe(e,t,r){const n=e+t-r,s=Math.abs(n-e),o=Math.abs(n-t),i=Math.abs(n-r);return s<=o&&s<=i?e:o<=i?t:r}function mQe(e,t,r,n,s,o){switch(e){case 0:jae(t,r,s);break;case 1:_ae(t,r,s,o);break;case 2:Nae(t,r,n,s);break;case 3:Sae(t,r,n,s,o);break;case 4:Cae(t,r,n,s,o);break;default:throw new Error(`Unsupported filter: ${e}`)}}const hQe=new Uint16Array([255]),pQe=new Uint8Array(hQe.buffer),gQe=pQe[0]===255;function xQe(e){const{data:t,width:r,height:n,channels:s,depth:o}=e,i=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(o/8)*s,c=new Uint8Array(n*r*l);let d=0;for(let u=0;u<7;u++){const f=i[u],h=Math.ceil((r-f.x)/f.xStep),m=Math.ceil((n-f.y)/f.yStep);if(h<=0||m<=0)continue;const x=h*l,g=new Uint8Array(x);for(let v=0;v<m;v++){const y=t[d++],b=t.subarray(d,d+x);d+=x;const w=new Uint8Array(x);mQe(y,b,w,g,x,l),g.set(w);for(let j=0;j<h;j++){const _=f.x+j*f.xStep,C=f.y+v*f.yStep;if(!(_>=r||C>=n))for(let A=0;A<l;A++)c[(C*r+_)*l+A]=w[j*l+A]}}}if(o===16){const u=new Uint16Array(c.buffer);if(gQe)for(let f=0;f<u.length;f++)u[f]=vQe(u[f]);return u}else return c}function vQe(e){return(e&255)<<8|e>>8&255}const yQe=new Uint16Array([255]),bQe=new Uint8Array(yQe.buffer),wQe=bQe[0]===255,jQe=new Uint8Array(0);function H9(e){const{data:t,width:r,height:n,channels:s,depth:o}=e,i=Math.ceil(o/8)*s,l=Math.ceil(o/8*s*r),c=new Uint8Array(n*l);let d=jQe,u=0,f,h;for(let m=0;m<n;m++){switch(f=t.subarray(u+1,u+1+l),h=c.subarray(m*l,(m+1)*l),t[u]){case 0:jae(f,h,l);break;case 1:_ae(f,h,l,i);break;case 2:Nae(f,h,d,l);break;case 3:Sae(f,h,d,l,i);break;case 4:Cae(f,h,d,l,i);break;default:throw new Error(`Unsupported filter: ${t[u]}`)}d=h,u+=l+1}if(o===16){const m=new Uint16Array(c.buffer);if(wQe)for(let x=0;x<m.length;x++)m[x]=_Qe(m[x]);return m}else return c}function _Qe(e){return(e&255)<<8|e>>8&255}const q_=Uint8Array.of(137,80,78,71,13,10,26,10);function G9(e){if(!NQe(e.readBytes(q_.length)))throw new Error("wrong PNG signature")}function NQe(e){if(e.length<q_.length)return!1;for(let t=0;t<q_.length;t++)if(e[t]!==q_[t])return!1;return!0}const SQe="tEXt",CQe=0,Pae=new TextDecoder("latin1");function PQe(e){if(EQe(e),e.length===0||e.length>79)throw new Error("keyword length must be between 1 and 79")}const AQe=/^[\u0000-\u00FF]*$/;function EQe(e){if(!AQe.test(e))throw new Error("invalid latin1 text")}function kQe(e,t,r){const n=Aae(t);e[n]=IQe(t,r-n.length-1)}function Aae(e){for(e.mark();e.readByte()!==CQe;);const t=e.offset;e.reset();const r=Pae.decode(e.readBytes(t-e.offset-1));return e.skip(1),PQe(r),r}function IQe(e,t){return Pae.decode(e.readBytes(t))}const fd={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},ck={UNKNOWN:-1,DEFLATE:0},K9={UNKNOWN:-1,ADAPTIVE:0},dk={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Y2={NONE:0,BACKGROUND:1,PREVIOUS:2},uk={SOURCE:0,OVER:1};class OQe extends MR{constructor(r,n={}){super(r);lo(this,"_checkCrc");lo(this,"_inflator");lo(this,"_png");lo(this,"_apng");lo(this,"_end");lo(this,"_hasPalette");lo(this,"_palette");lo(this,"_hasTransparency");lo(this,"_transparency");lo(this,"_compressionMethod");lo(this,"_filterMethod");lo(this,"_interlaceMethod");lo(this,"_colorType");lo(this,"_isAnimated");lo(this,"_numberOfFrames");lo(this,"_numberOfPlays");lo(this,"_frames");lo(this,"_writingDataChunks");const{checkCrc:s=!1}=n;this._checkCrc=s,this._inflator=new U9,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=ck.UNKNOWN,this._filterMethod=K9.UNKNOWN,this._interlaceMethod=dk.UNKNOWN,this._colorType=fd.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(G9(this);!this._end;){const r=this.readUint32(),n=this.readChars(4);this.decodeChunk(r,n)}return this.decodeImage(),this._png}decodeApng(){for(G9(this);!this._end;){const r=this.readUint32(),n=this.readChars(4);this.decodeApngChunk(r,n)}return this.decodeApngImage(),this._apng}decodeChunk(r,n){const s=this.offset;switch(n){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(r);break;case"iCCP":this.decodeiCCP(r);break;case SQe:kQe(this._png.text,this,r);break;case"pHYs":this.decodepHYs();break;default:this.skip(r);break}if(this.offset-s!==r)throw new Error(`Length mismatch while decoding chunk ${n}`);this._checkCrc?W9(this,r+4,n):this.skip(4)}decodeApngChunk(r,n){const s=this.offset;switch(n!=="fdAT"&&n!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),n){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(r);break;default:this.decodeChunk(r,n),this.offset=s+r;break}if(this.offset-s!==r)throw new Error(`Length mismatch while decoding chunk ${n}`);this._checkCrc?W9(this,r+4,n):this.skip(4)}decodeIHDR(){const r=this._png;r.width=this.readUint32(),r.height=this.readUint32(),r.depth=TQe(this.readUint8());const n=this.readUint8();this._colorType=n;let s;switch(n){case fd.GREYSCALE:s=1;break;case fd.TRUECOLOUR:s=3;break;case fd.INDEXED_COLOUR:s=1;break;case fd.GREYSCALE_ALPHA:s=2;break;case fd.TRUECOLOUR_ALPHA:s=4;break;case fd.UNKNOWN:default:throw new Error(`Unknown color type: ${n}`)}if(this._png.channels=s,this._compressionMethod=this.readUint8(),this._compressionMethod!==ck.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const r={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(r)}decodePLTE(r){if(r%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${r}`);const n=r/3;this._hasPalette=!0;const s=[];this._palette=s;for(let o=0;o<n;o++)s.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(r){this._writingDataChunks=!0;const n=r,s=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,s,n)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodeFDAT(r){this._writingDataChunks=!0;let n=r,s=this.offset+this.byteOffset;if(s+=4,n-=4,this._inflator.push(new Uint8Array(this.buffer,s,n)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodetRNS(r){switch(this._colorType){case fd.GREYSCALE:case fd.TRUECOLOUR:{if(r%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${r}`);if(r/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${r/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(r/2);for(let n=0;n<r/2;n++)this._transparency[n]=this.readUint16();break}case fd.INDEXED_COLOUR:{if(r>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${r} vs ${this._palette.length})`);let n=0;for(;n<r;n++){const s=this.readByte();this._palette[n].push(s)}for(;n<this._palette.length;n++)this._palette[n].push(255);break}case fd.UNKNOWN:case fd.GREYSCALE_ALPHA:case fd.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(r){const n=Aae(this),s=this.readUint8();if(s!==ck.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const o=this.readBytes(r-n.length-2);this._png.iccEmbeddedProfile={name:n,profile:cQe(o)}}decodepHYs(){const r=this.readUint32(),n=this.readUint32(),s=this.readByte();this._png.resolution={x:r,y:n,unit:s}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let r=0;r<this._numberOfFrames;r++){const n={sequenceNumber:this._frames[r].sequenceNumber,delayNumber:this._frames[r].delayNumber,delayDenominator:this._frames[r].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},s=this._frames.at(r);if(s){if(s.data=H9({data:s.data,width:s.width,height:s.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),r===0||s.xOffset===0&&s.yOffset===0&&s.width===this._png.width&&s.height===this._png.height)n.data=s.data;else{const o=this._apng.frames.at(r-1);this.disposeFrame(s,o,n),this.addFrameDataToCanvas(n,s)}this._apng.frames.push(n)}}return this._apng}disposeFrame(r,n,s){switch(r.disposeOp){case Y2.NONE:break;case Y2.BACKGROUND:for(let o=0;o<this._png.height;o++)for(let i=0;i<this._png.width;i++){const l=(o*r.width+i)*this._png.channels;for(let c=0;c<this._png.channels;c++)s.data[l+c]=0}break;case Y2.PREVIOUS:s.data.set(n.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(r,n){const s=1<<this._png.depth,o=(i,l)=>{const c=((i+n.yOffset)*this._png.width+n.xOffset+l)*this._png.channels,d=(i*n.width+l)*this._png.channels;return{index:c,frameIndex:d}};switch(n.blendOp){case uk.SOURCE:for(let i=0;i<n.height;i++)for(let l=0;l<n.width;l++){const{index:c,frameIndex:d}=o(i,l);for(let u=0;u<this._png.channels;u++)r.data[c+u]=n.data[d+u]}break;case uk.OVER:for(let i=0;i<n.height;i++)for(let l=0;l<n.width;l++){const{index:c,frameIndex:d}=o(i,l);for(let u=0;u<this._png.channels;u++){const f=n.data[d+this._png.channels-1]/s,h=u%(this._png.channels-1)===0?1:n.data[d+u],m=Math.floor(f*h+(1-f)*r.data[c+u]);r.data[c+u]+=m}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const r=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==K9.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===dk.NO_INTERLACE)this._png.data=H9({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===dk.ADAM7)this._png.data=xQe({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const r=this._inflator.result,n=this._frames.at(-1);n?n.data=r:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Y2.NONE,blendOp:uk.SOURCE,data:r}),this._inflator=new U9,this._writingDataChunks=!1}}function TQe(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}var X9;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(X9||(X9={}));function DQe(e,t){return new OQe(e,t).decode()}var rs=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function fk(){rs.console&&typeof rs.console.log=="function"&&rs.console.log.apply(rs.console,arguments)}var wo={log:fk,warn:function(e){rs.console&&(typeof rs.console.warn=="function"?rs.console.warn.apply(rs.console,arguments):fk.call(null,arguments))},error:function(e){rs.console&&(typeof rs.console.error=="function"?rs.console.error.apply(rs.console,arguments):fk(e))}};function mk(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){lg(n.response,t,r)},n.onerror=function(){wo.error("could not download file")},n.send()}function Y9(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function J2(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var lg=rs.saveAs||((typeof window>"u"?"undefined":ks(window))!=="object"||window!==rs?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=rs.URL||rs.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener",typeof e=="string"?(s.href=e,s.origin!==location.origin?Y9(s.href)?mk(e,t,r):J2(s,s.target="_blank"):J2(s)):(s.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(s.href)},4e4),setTimeout(function(){J2(s)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(Y9(e))mk(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){J2(n)})}else navigator.msSaveOrOpenBlob(function(s,o){return o===void 0?o={autoBom:!1}:ks(o)!=="object"&&(wo.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob([String.fromCharCode(65279),s],{type:s.type}):s}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return mk(e,t,r);var s=e.type==="application/octet-stream",o=/constructor/i.test(rs.HTMLElement)||rs.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||s&&o)&&(typeof FileReader>"u"?"undefined":ks(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var u=l.result;u=i?u:u.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=u:location=u,n=null},l.readAsDataURL(e)}else{var c=rs.URL||rs.webkitURL,d=c.createObjectURL(e);n?n.location=d:location.href=d,n=null,setTimeout(function(){c.revokeObjectURL(d)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Eae(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<r.length;n++){var s=r[n].re,o=r[n].process,i=s.exec(e);i&&(t=o(i),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),d=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),d.length==1&&(d="0"+d),"#"+l+c+d}}var z_=rs.atob.bind(rs),J9=rs.btoa.bind(rs);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function hk(e,t){var r=e[0],n=e[1],s=e[2],o=e[3];r=zl(r,n,s,o,t[0],7,-680876936),o=zl(o,r,n,s,t[1],12,-389564586),s=zl(s,o,r,n,t[2],17,606105819),n=zl(n,s,o,r,t[3],22,-1044525330),r=zl(r,n,s,o,t[4],7,-176418897),o=zl(o,r,n,s,t[5],12,1200080426),s=zl(s,o,r,n,t[6],17,-1473231341),n=zl(n,s,o,r,t[7],22,-45705983),r=zl(r,n,s,o,t[8],7,1770035416),o=zl(o,r,n,s,t[9],12,-1958414417),s=zl(s,o,r,n,t[10],17,-42063),n=zl(n,s,o,r,t[11],22,-1990404162),r=zl(r,n,s,o,t[12],7,1804603682),o=zl(o,r,n,s,t[13],12,-40341101),s=zl(s,o,r,n,t[14],17,-1502002290),r=Ul(r,n=zl(n,s,o,r,t[15],22,1236535329),s,o,t[1],5,-165796510),o=Ul(o,r,n,s,t[6],9,-1069501632),s=Ul(s,o,r,n,t[11],14,643717713),n=Ul(n,s,o,r,t[0],20,-373897302),r=Ul(r,n,s,o,t[5],5,-701558691),o=Ul(o,r,n,s,t[10],9,38016083),s=Ul(s,o,r,n,t[15],14,-660478335),n=Ul(n,s,o,r,t[4],20,-405537848),r=Ul(r,n,s,o,t[9],5,568446438),o=Ul(o,r,n,s,t[14],9,-1019803690),s=Ul(s,o,r,n,t[3],14,-187363961),n=Ul(n,s,o,r,t[8],20,1163531501),r=Ul(r,n,s,o,t[13],5,-1444681467),o=Ul(o,r,n,s,t[2],9,-51403784),s=Ul(s,o,r,n,t[7],14,1735328473),r=Vl(r,n=Ul(n,s,o,r,t[12],20,-1926607734),s,o,t[5],4,-378558),o=Vl(o,r,n,s,t[8],11,-2022574463),s=Vl(s,o,r,n,t[11],16,1839030562),n=Vl(n,s,o,r,t[14],23,-35309556),r=Vl(r,n,s,o,t[1],4,-1530992060),o=Vl(o,r,n,s,t[4],11,1272893353),s=Vl(s,o,r,n,t[7],16,-155497632),n=Vl(n,s,o,r,t[10],23,-1094730640),r=Vl(r,n,s,o,t[13],4,681279174),o=Vl(o,r,n,s,t[0],11,-358537222),s=Vl(s,o,r,n,t[3],16,-722521979),n=Vl(n,s,o,r,t[6],23,76029189),r=Vl(r,n,s,o,t[9],4,-640364487),o=Vl(o,r,n,s,t[12],11,-421815835),s=Vl(s,o,r,n,t[15],16,530742520),r=Wl(r,n=Vl(n,s,o,r,t[2],23,-995338651),s,o,t[0],6,-198630844),o=Wl(o,r,n,s,t[7],10,1126891415),s=Wl(s,o,r,n,t[14],15,-1416354905),n=Wl(n,s,o,r,t[5],21,-57434055),r=Wl(r,n,s,o,t[12],6,1700485571),o=Wl(o,r,n,s,t[3],10,-1894986606),s=Wl(s,o,r,n,t[10],15,-1051523),n=Wl(n,s,o,r,t[1],21,-2054922799),r=Wl(r,n,s,o,t[8],6,1873313359),o=Wl(o,r,n,s,t[15],10,-30611744),s=Wl(s,o,r,n,t[6],15,-1560198380),n=Wl(n,s,o,r,t[13],21,1309151649),r=Wl(r,n,s,o,t[4],6,-145523070),o=Wl(o,r,n,s,t[11],10,-1120210379),s=Wl(s,o,r,n,t[2],15,718787259),n=Wl(n,s,o,r,t[9],21,-343485551),e[0]=Uh(r,e[0]),e[1]=Uh(n,e[1]),e[2]=Uh(s,e[2]),e[3]=Uh(o,e[3])}function NP(e,t,r,n,s,o){return t=Uh(Uh(t,e),Uh(n,o)),Uh(t<<s|t>>>32-s,r)}function zl(e,t,r,n,s,o,i){return NP(t&r|~t&n,e,t,s,o,i)}function Ul(e,t,r,n,s,o,i){return NP(t&n|r&~n,e,t,s,o,i)}function Vl(e,t,r,n,s,o,i){return NP(t^r^n,e,t,s,o,i)}function Wl(e,t,r,n,s,o,i){return NP(r^(t|~n),e,t,s,o,i)}function kae(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)hk(n,MQe(e.substring(t-64,t)));e=e.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(hk(n,s),t=0;t<16;t++)s[t]=0;return s[14]=8*r,hk(n,s),n}function MQe(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}var Q9="0123456789abcdef".split("");function RQe(e){for(var t="",r=0;r<4;r++)t+=Q9[e>>8*r+4&15]+Q9[e>>8*r&15];return t}function FQe(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function P3(e){return kae(e).map(FQe).join("")}var LQe=function(e){for(var t=0;t<e.length;t++)e[t]=RQe(e[t]);return e.join("")}(kae("hello"))!="5d41402abc4b2a76b9719d911017c592";function Uh(e,t){if(LQe){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function A3(e,t){var r,n,s,o;if(e!==r){for(var i=(s=e,o=1+(256/e.length|0),new Array(o+1).join(s)),l=[],c=0;c<256;c++)l[c]=c;var d=0;for(c=0;c<256;c++){var u=l[c];d=(d+u+i.charCodeAt(c))%256,l[c]=l[d],l[d]=u}r=e,n=l}else l=n;var f=t.length,h=0,m=0,x="";for(c=0;c<f;c++)m=(m+(u=l[h=(h+1)%256]))%256,l[h]=l[m],l[m]=u,i=l[(l[h]+l[m])%256],x+=String.fromCharCode(t.charCodeAt(c)^i);return x}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var Z9={print:4,modify:8,copy:16,"annot-forms":32};function dv(e,t,r,n){this.v=1,this.r=2;var s=192;e.forEach(function(l){if(Z9.perm!==void 0)throw new Error("Invalid permission: "+l);s+=Z9[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(t+this.padding).substr(0,32),i=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,i),this.P=-(1+(255^s)),this.encryptionKey=P3(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=A3(this.encryptionKey,this.padding)}function uv(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var s=e.charCodeAt(n);t+=s<33||s===35||s===37||s===40||s===41||s===47||s===60||s===62||s===91||s===93||s===123||s===125||s>126?"#"+("0"+s.toString(16)).slice(-2):e[n]}return t}function eU(e){if(ks(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,n,s){if(s=s||!1,typeof r!="string"||typeof n!="function"||typeof s!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var o=Math.random().toString(35);return t[r][o]=[n,!!s],o},this.unsubscribe=function(r){for(var n in t)if(t[n][r])return delete t[n][r],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),s=[];for(var o in t[r]){var i=t[r][o];try{i[0].apply(e,n)}catch(l){rs.console&&wo.error("jsPDF PubSub Error",l.message,l)}i[1]&&s.push(o)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function R1(e){if(!(this instanceof R1))return new R1(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function Iae(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Oh(e,t,r,n,s){if(!(this instanceof Oh))return new Oh(e,t,r,n,s);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,Iae.call(this,n,s)}function Eg(e,t,r,n,s){if(!(this instanceof Eg))return new Eg(e,t,r,n,s);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,Iae.call(this,n,s)}function Ca(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],s=arguments[2],o=arguments[3],i=[],l=1,c=16,d="S",u=null;ks(e=e||{})==="object"&&(r=e.orientation,n=e.unit||n,s=e.format||s,o=e.compress||e.compressPdf||o,(u=e.encryption||null)!==null&&(u.userPassword=u.userPassword||"",u.ownerPassword=u.ownerPassword||"",u.userPermissions=u.userPermissions||[]),l=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(c=e.floatPrecision),d=e.defaultPathOperation||"S"),i=e.filters||(o===!0?["FlateEncode"]:i),n=n||"mm",r=(""+(r||"P")).toLowerCase();var f=e.putOnlyUsedFonts||!1,h={},m={internal:{},__private__:{}};m.__private__.PubSub=eU;var x="1.3",g=m.__private__.getPdfVersion=function(){return x};m.__private__.setPdfVersion=function(R){x=R};var v={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};m.__private__.getPageFormats=function(){return v};var y=m.__private__.getPageFormat=function(R){return v[R]};s=s||"a4";var b="compat",w="advanced",j=b;function _(){this.saveGraphicsState(),ie(new Le(qt,0,0,-qt,0,Yi()*qt).toString()+" cm"),this.setFontSize(this.getFontSize()/qt),d="n",j=w}function C(){this.restoreGraphicsState(),d="S",j=b}var A=m.__private__.combineFontStyleAndFontWeight=function(R,fe){if(R=="bold"&&fe=="normal"||R=="bold"&&fe==400||R=="normal"&&fe=="italic"||R=="bold"&&fe=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return fe&&(R=fe==400||fe==="normal"?R==="italic"?"italic":"normal":fe!=700&&fe!=="bold"||R!=="normal"?(fe==700?"bold":fe)+""+R:"bold"),R};m.advancedAPI=function(R){var fe=j===b;return fe&&_.call(this),typeof R!="function"||(R(this),fe&&C.call(this)),this},m.compatAPI=function(R){var fe=j===w;return fe&&C.call(this),typeof R!="function"||(R(this),fe&&_.call(this)),this},m.isAdvancedAPI=function(){return j===w};var S,P=function(R){if(j!==w)throw new Error(R+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},M=m.roundToPrecision=m.__private__.roundToPrecision=function(R,fe){var We=t||fe;if(isNaN(R)||isNaN(We))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return R.toFixed(We).replace(/0+$/,"")};S=m.hpf=m.__private__.hpf=typeof c=="number"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return M(R,c)}:c==="smart"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return M(R,R>-1&&R<1?16:5)}:function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return M(R,16)};var O=m.f2=m.__private__.f2=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f2");return M(R,2)},I=m.__private__.f3=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f3");return M(R,3)},T=m.scale=m.__private__.scale=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.scale");return j===b?R*qt:j===w?R:void 0},k=function(R){return T(function(fe){return j===b?Yi()-fe:j===w?fe:void 0}(R))};m.__private__.setPrecision=m.setPrecision=function(R){typeof parseInt(R,10)=="number"&&(t=parseInt(R,10))};var $,q="00000000000000000000000000000000",z=m.__private__.getFileId=function(){return q},F=m.__private__.setFileId=function(R){return q=R!==void 0&&/^[a-fA-F0-9]{32}$/.test(R)?R.toUpperCase():q.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),u!==null&&(ot=new dv(u.userPermissions,u.userPassword,u.ownerPassword,q)),q};m.setFileId=function(R){return F(R),this},m.getFileId=function(){return z()};var V=m.__private__.convertDateToPDFDate=function(R){var fe=R.getTimezoneOffset(),We=fe<0?"+":"-",gt=Math.floor(Math.abs(fe/60)),Ut=Math.abs(fe%60),zr=[We,G(gt),"'",G(Ut),"'"].join("");return["D:",R.getFullYear(),G(R.getMonth()+1),G(R.getDate()),G(R.getHours()),G(R.getMinutes()),G(R.getSeconds()),zr].join("")},ue=m.__private__.convertPDFDateToDate=function(R){var fe=parseInt(R.substr(2,4),10),We=parseInt(R.substr(6,2),10)-1,gt=parseInt(R.substr(8,2),10),Ut=parseInt(R.substr(10,2),10),zr=parseInt(R.substr(12,2),10),cn=parseInt(R.substr(14,2),10);return new Date(fe,We,gt,Ut,zr,cn,0)},_e=m.__private__.setCreationDate=function(R){var fe;if(R===void 0&&(R=new Date),R instanceof Date)fe=V(R);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(R))throw new Error("Invalid argument passed to jsPDF.setCreationDate");fe=R}return $=fe},U=m.__private__.getCreationDate=function(R){var fe=$;return R==="jsDate"&&(fe=ue($)),fe};m.setCreationDate=function(R){return _e(R),this},m.getCreationDate=function(R){return U(R)};var L,G=m.__private__.padd2=function(R){return("0"+parseInt(R)).slice(-2)},de=m.__private__.padd2Hex=function(R){return("00"+(R=R.toString())).substr(R.length)},X=0,W=[],Y=[],me=0,ee=[],ae=[],le=!1,Te=Y;m.__private__.setCustomOutputDestination=function(R){le=!0,Te=R};var te=function(R){le||(Te=R)};m.__private__.resetCustomOutputDestination=function(){le=!1,Te=Y};var ie=m.__private__.out=function(R){return R=R.toString(),me+=R.length+1,Te.push(R),Te},xt=m.__private__.write=function(R){return ie(arguments.length===1?R.toString():Array.prototype.join.call(arguments," "))},vt=m.__private__.getArrayBuffer=function(R){for(var fe=R.length,We=new ArrayBuffer(fe),gt=new Uint8Array(We);fe--;)gt[fe]=R.charCodeAt(fe);return We},dt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];m.__private__.getStandardFonts=function(){return dt};var St=e.fontSize||16;m.__private__.setFontSize=m.setFontSize=function(R){return St=j===w?R/qt:R,this};var ft,_t=m.__private__.getFontSize=m.getFontSize=function(){return j===b?St:St*qt},gr=e.R2L||!1;m.__private__.setR2L=m.setR2L=function(R){return gr=R,this},m.__private__.getR2L=m.getR2L=function(){return gr};var be,Nt=m.__private__.setZoomMode=function(R){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(R))ft=R;else if(isNaN(R)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(R)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+R+'" is not recognized.');ft=R}else ft=parseInt(R,10)};m.__private__.getZoomMode=function(){return ft};var Wt,_r=m.__private__.setPageMode=function(R){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(R)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+R+'" is not recognized.');be=R};m.__private__.getPageMode=function(){return be};var yr=m.__private__.setLayoutMode=function(R){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(R)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+R+'" is not recognized.');Wt=R};m.__private__.getLayoutMode=function(){return Wt},m.__private__.setDisplayMode=m.setDisplayMode=function(R,fe,We){return Nt(R),yr(fe),_r(We),this};var ve={title:"",subject:"",author:"",keywords:"",creator:""};m.__private__.getDocumentProperty=function(R){if(Object.keys(ve).indexOf(R)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ve[R]},m.__private__.getDocumentProperties=function(){return ve},m.__private__.setDocumentProperties=m.setProperties=m.setDocumentProperties=function(R){for(var fe in ve)ve.hasOwnProperty(fe)&&R[fe]&&(ve[fe]=R[fe]);return this},m.__private__.setDocumentProperty=function(R,fe){if(Object.keys(ve).indexOf(R)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ve[R]=fe};var at,qt,$t,De,wt,Rt={},Rr={},Me=[],tt={},ut={},sr={},Sr={},xr=null,Wr=0,qr=[],Tr=new eU(m),sn=e.hotfixes||[],Cn={},ze={},Fe=[],Le=function R(fe,We,gt,Ut,zr,cn){if(!(this instanceof R))return new R(fe,We,gt,Ut,zr,cn);isNaN(fe)&&(fe=1),isNaN(We)&&(We=0),isNaN(gt)&&(gt=0),isNaN(Ut)&&(Ut=1),isNaN(zr)&&(zr=0),isNaN(cn)&&(cn=0),this._matrix=[fe,We,gt,Ut,zr,cn]};Object.defineProperty(Le.prototype,"sx",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(Le.prototype,"shy",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(Le.prototype,"shx",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(Le.prototype,"sy",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(Le.prototype,"tx",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(Le.prototype,"ty",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(Le.prototype,"a",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(Le.prototype,"b",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(Le.prototype,"c",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(Le.prototype,"d",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(Le.prototype,"e",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(Le.prototype,"f",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(Le.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Le.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Le.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Le.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Le.prototype.join=function(R){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(S).join(R)},Le.prototype.multiply=function(R){var fe=R.sx*this.sx+R.shy*this.shx,We=R.sx*this.shy+R.shy*this.sy,gt=R.shx*this.sx+R.sy*this.shx,Ut=R.shx*this.shy+R.sy*this.sy,zr=R.tx*this.sx+R.ty*this.shx+this.tx,cn=R.tx*this.shy+R.ty*this.sy+this.ty;return new Le(fe,We,gt,Ut,zr,cn)},Le.prototype.decompose=function(){var R=this.sx,fe=this.shy,We=this.shx,gt=this.sy,Ut=this.tx,zr=this.ty,cn=Math.sqrt(R*R+fe*fe),se=(R/=cn)*We+(fe/=cn)*gt;We-=R*se,gt-=fe*se;var Se=Math.sqrt(We*We+gt*gt);return se/=Se,R*(gt/=Se)<fe*(We/=Se)&&(R=-R,fe=-fe,se=-se,cn=-cn),{scale:new Le(cn,0,0,Se,0,0),translate:new Le(1,0,0,1,Ut,zr),rotate:new Le(R,fe,-fe,R,0,0),skew:new Le(1,0,se,1,0,0)}},Le.prototype.toString=function(R){return this.join(" ")},Le.prototype.inversed=function(){var R=this.sx,fe=this.shy,We=this.shx,gt=this.sy,Ut=this.tx,zr=this.ty,cn=1/(R*gt-fe*We),se=gt*cn,Se=-fe*cn,Ee=-We*cn,it=R*cn;return new Le(se,Se,Ee,it,-se*Ut-Ee*zr,-Se*Ut-it*zr)},Le.prototype.applyToPoint=function(R){var fe=R.x*this.sx+R.y*this.shx+this.tx,We=R.x*this.shy+R.y*this.sy+this.ty;return new Hs(fe,We)},Le.prototype.applyToRectangle=function(R){var fe=this.applyToPoint(R),We=this.applyToPoint(new Hs(R.x+R.w,R.y+R.h));return new tc(fe.x,fe.y,We.x-fe.x,We.y-fe.y)},Le.prototype.clone=function(){var R=this.sx,fe=this.shy,We=this.shx,gt=this.sy,Ut=this.tx,zr=this.ty;return new Le(R,fe,We,gt,Ut,zr)},m.Matrix=Le;var Ze=m.matrixMult=function(R,fe){return fe.multiply(R)},Ot=new Le(1,0,0,1,0,0);m.unitMatrix=m.identityMatrix=Ot;var mt=function(R,fe){if(!ut[R]){var We=(fe instanceof Oh?"Sh":"P")+(Object.keys(tt).length+1).toString(10);fe.id=We,ut[R]=We,tt[We]=fe,Tr.publish("addPattern",fe)}};m.ShadingPattern=Oh,m.TilingPattern=Eg,m.addShadingPattern=function(R,fe){return P("addShadingPattern()"),mt(R,fe),this},m.beginTilingPattern=function(R){P("beginTilingPattern()"),Tl(R.boundingBox[0],R.boundingBox[1],R.boundingBox[2]-R.boundingBox[0],R.boundingBox[3]-R.boundingBox[1],R.matrix)},m.endTilingPattern=function(R,fe){P("endTilingPattern()"),fe.stream=ae[L].join(`
`),mt(R,fe),Tr.publish("endTilingPattern",fe),Fe.pop().restore()};var Qt,bt=m.__private__.newObject=function(){var R=zt();return ne(R,!0),R},zt=m.__private__.newObjectDeferred=function(){return X++,W[X]=function(){return me},X},ne=function(R,fe){return fe=typeof fe=="boolean"&&fe,W[R]=me,fe&&ie(R+" 0 obj"),R},He=m.__private__.newAdditionalObject=function(){var R={objId:zt(),content:""};return ee.push(R),R},Gt=zt(),Ht=zt(),Fr=m.__private__.decodeColorString=function(R){var fe=R.split(" ");if(fe.length!==2||fe[1]!=="g"&&fe[1]!=="G")fe.length!==5||fe[4]!=="k"&&fe[4]!=="K"||(fe=[(1-fe[0])*(1-fe[3]),(1-fe[1])*(1-fe[3]),(1-fe[2])*(1-fe[3]),"r"]);else{var We=parseFloat(fe[0]);fe=[We,We,We,"r"]}for(var gt="#",Ut=0;Ut<3;Ut++)gt+=("0"+Math.floor(255*parseFloat(fe[Ut])).toString(16)).slice(-2);return gt},cr=m.__private__.encodeColorString=function(R){var fe;typeof R=="string"&&(R={ch1:R});var We=R.ch1,gt=R.ch2,Ut=R.ch3,zr=R.ch4,cn=R.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof We=="string"&&We.charAt(0)!=="#"){var se=new Eae(We);if(se.ok)We=se.toHex();else if(!/^\d*\.?\d*$/.test(We))throw new Error('Invalid color "'+We+'" passed to jsPDF.encodeColorString.')}if(typeof We=="string"&&/^#[0-9A-Fa-f]{3}$/.test(We)&&(We="#"+We[1]+We[1]+We[2]+We[2]+We[3]+We[3]),typeof We=="string"&&/^#[0-9A-Fa-f]{6}$/.test(We)){var Se=parseInt(We.substr(1),16);We=Se>>16&255,gt=Se>>8&255,Ut=255&Se}if(gt===void 0||zr===void 0&&We===gt&&gt===Ut)fe=typeof We=="string"?We+" "+cn[0]:R.precision===2?O(We/255)+" "+cn[0]:I(We/255)+" "+cn[0];else if(zr===void 0||ks(zr)==="object"){if(zr&&!isNaN(zr.a)&&zr.a===0)return["1.","1.","1.",cn[1]].join(" ");fe=typeof We=="string"?[We,gt,Ut,cn[1]].join(" "):R.precision===2?[O(We/255),O(gt/255),O(Ut/255),cn[1]].join(" "):[I(We/255),I(gt/255),I(Ut/255),cn[1]].join(" ")}else fe=typeof We=="string"?[We,gt,Ut,zr,cn[2]].join(" "):R.precision===2?[O(We),O(gt),O(Ut),O(zr),cn[2]].join(" "):[I(We),I(gt),I(Ut),I(zr),cn[2]].join(" ");return fe},nn=m.__private__.getFilters=function(){return i},Tn=m.__private__.putStream=function(R){var fe=(R=R||{}).data||"",We=R.filters||nn(),gt=R.alreadyAppliedFilters||[],Ut=R.addLength1||!1,zr=fe.length,cn=R.objectId,se=function(Cr){return Cr};if(u!==null&&cn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");u!==null&&(se=ot.encryptor(cn,0));var Se={};We===!0&&(We=["FlateEncode"]);var Ee=R.additionalKeyValues||[],it=(Se=Ca.API.processDataByFilters!==void 0?Ca.API.processDataByFilters(fe,We):{data:fe,reverseChain:[]}).reverseChain+(Array.isArray(gt)?gt.join(" "):gt.toString());if(Se.data.length!==0&&(Ee.push({key:"Length",value:Se.data.length}),Ut===!0&&Ee.push({key:"Length1",value:zr})),it.length!=0)if(it.split("/").length-1==1)Ee.push({key:"Filter",value:it});else{Ee.push({key:"Filter",value:"["+it+"]"});for(var Pt=0;Pt<Ee.length;Pt+=1)if(Ee[Pt].key==="DecodeParms"){for(var hr=[],er=0;er<Se.reverseChain.split("/").length-1;er+=1)hr.push("null");hr.push(Ee[Pt].value),Ee[Pt].value="["+hr.join(" ")+"]"}}ie("<<");for(var Ar=0;Ar<Ee.length;Ar++)ie("/"+Ee[Ar].key+" "+Ee[Ar].value);ie(">>"),Se.data.length!==0&&(ie("stream"),ie(se(Se.data)),ie("endstream"))},Gn=m.__private__.putPage=function(R){var fe=R.number,We=R.data,gt=R.objId,Ut=R.contentsObjId;ne(gt,!0),ie("<</Type /Page"),ie("/Parent "+R.rootDictionaryObjId+" 0 R"),ie("/Resources "+R.resourceDictionaryObjId+" 0 R"),ie("/MediaBox ["+parseFloat(S(R.mediaBox.bottomLeftX))+" "+parseFloat(S(R.mediaBox.bottomLeftY))+" "+S(R.mediaBox.topRightX)+" "+S(R.mediaBox.topRightY)+"]"),R.cropBox!==null&&ie("/CropBox ["+S(R.cropBox.bottomLeftX)+" "+S(R.cropBox.bottomLeftY)+" "+S(R.cropBox.topRightX)+" "+S(R.cropBox.topRightY)+"]"),R.bleedBox!==null&&ie("/BleedBox ["+S(R.bleedBox.bottomLeftX)+" "+S(R.bleedBox.bottomLeftY)+" "+S(R.bleedBox.topRightX)+" "+S(R.bleedBox.topRightY)+"]"),R.trimBox!==null&&ie("/TrimBox ["+S(R.trimBox.bottomLeftX)+" "+S(R.trimBox.bottomLeftY)+" "+S(R.trimBox.topRightX)+" "+S(R.trimBox.topRightY)+"]"),R.artBox!==null&&ie("/ArtBox ["+S(R.artBox.bottomLeftX)+" "+S(R.artBox.bottomLeftY)+" "+S(R.artBox.topRightX)+" "+S(R.artBox.topRightY)+"]"),typeof R.userUnit=="number"&&R.userUnit!==1&&ie("/UserUnit "+R.userUnit),Tr.publish("putPage",{objId:gt,pageContext:qr[fe],pageNumber:fe,page:We}),ie("/Contents "+Ut+" 0 R"),ie(">>"),ie("endobj");var zr=We.join(`
`);return j===w&&(zr+=`
Q`),ne(Ut,!0),Tn({data:zr,filters:nn(),objectId:Ut}),ie("endobj"),gt},ta=m.__private__.putPages=function(){var R,fe,We=[];for(R=1;R<=Wr;R++)qr[R].objId=zt(),qr[R].contentsObjId=zt();for(R=1;R<=Wr;R++)We.push(Gn({number:R,data:ae[R],objId:qr[R].objId,contentsObjId:qr[R].contentsObjId,mediaBox:qr[R].mediaBox,cropBox:qr[R].cropBox,bleedBox:qr[R].bleedBox,trimBox:qr[R].trimBox,artBox:qr[R].artBox,userUnit:qr[R].userUnit,rootDictionaryObjId:Gt,resourceDictionaryObjId:Ht}));ne(Gt,!0),ie("<</Type /Pages");var gt="/Kids [";for(fe=0;fe<Wr;fe++)gt+=We[fe]+" 0 R ";ie(gt+"]"),ie("/Count "+Wr),ie(">>"),ie("endobj"),Tr.publish("postPutPages")},Aa=function(R){Tr.publish("putFont",{font:R,out:ie,newObject:bt,putStream:Tn}),R.isAlreadyPutted!==!0&&(R.objectNumber=bt(),ie("<<"),ie("/Type /Font"),ie("/BaseFont /"+uv(R.postScriptName)),ie("/Subtype /Type1"),typeof R.encoding=="string"&&ie("/Encoding /"+R.encoding),ie("/FirstChar 32"),ie("/LastChar 255"),ie(">>"),ie("endobj"))},ke=function(R){R.objectNumber=bt();var fe=[];fe.push({key:"Type",value:"/XObject"}),fe.push({key:"Subtype",value:"/Form"}),fe.push({key:"BBox",value:"["+[S(R.x),S(R.y),S(R.x+R.width),S(R.y+R.height)].join(" ")+"]"}),fe.push({key:"Matrix",value:"["+R.matrix.toString()+"]"});var We=R.pages[1].join(`
`);Tn({data:We,additionalKeyValues:fe,objectId:R.objectNumber}),ie("endobj")},Ae=function(R,fe){fe||(fe=21);var We=bt(),gt=function(cn,se){var Se,Ee=[],it=1/(se-1);for(Se=0;Se<1;Se+=it)Ee.push(Se);if(Ee.push(1),cn[0].offset!=0){var Pt={offset:0,color:cn[0].color};cn.unshift(Pt)}if(cn[cn.length-1].offset!=1){var hr={offset:1,color:cn[cn.length-1].color};cn.push(hr)}for(var er="",Ar=0,Cr=0;Cr<Ee.length;Cr++){for(Se=Ee[Cr];Se>cn[Ar+1].offset;)Ar++;var Lt=cn[Ar].offset,vn=(Se-Lt)/(cn[Ar+1].offset-Lt),Xr=cn[Ar].color,Or=cn[Ar+1].color;er+=de(Math.round((1-vn)*Xr[0]+vn*Or[0]).toString(16))+de(Math.round((1-vn)*Xr[1]+vn*Or[1]).toString(16))+de(Math.round((1-vn)*Xr[2]+vn*Or[2]).toString(16))}return er.trim()}(R.colors,fe),Ut=[];Ut.push({key:"FunctionType",value:"0"}),Ut.push({key:"Domain",value:"[0.0 1.0]"}),Ut.push({key:"Size",value:"["+fe+"]"}),Ut.push({key:"BitsPerSample",value:"8"}),Ut.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ut.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Tn({data:gt,additionalKeyValues:Ut,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:We}),ie("endobj"),R.objectNumber=bt(),ie("<< /ShadingType "+R.type),ie("/ColorSpace /DeviceRGB");var zr="/Coords ["+S(parseFloat(R.coords[0]))+" "+S(parseFloat(R.coords[1]))+" ";R.type===2?zr+=S(parseFloat(R.coords[2]))+" "+S(parseFloat(R.coords[3])):zr+=S(parseFloat(R.coords[2]))+" "+S(parseFloat(R.coords[3]))+" "+S(parseFloat(R.coords[4]))+" "+S(parseFloat(R.coords[5])),ie(zr+="]"),R.matrix&&ie("/Matrix ["+R.matrix.toString()+"]"),ie("/Function "+We+" 0 R"),ie("/Extend [true true]"),ie(">>"),ie("endobj")},et=function(R,fe){var We=zt(),gt=bt();fe.push({resourcesOid:We,objectOid:gt}),R.objectNumber=gt;var Ut=[];Ut.push({key:"Type",value:"/Pattern"}),Ut.push({key:"PatternType",value:"1"}),Ut.push({key:"PaintType",value:"1"}),Ut.push({key:"TilingType",value:"1"}),Ut.push({key:"BBox",value:"["+R.boundingBox.map(S).join(" ")+"]"}),Ut.push({key:"XStep",value:S(R.xStep)}),Ut.push({key:"YStep",value:S(R.yStep)}),Ut.push({key:"Resources",value:We+" 0 R"}),R.matrix&&Ut.push({key:"Matrix",value:"["+R.matrix.toString()+"]"}),Tn({data:R.stream,additionalKeyValues:Ut,objectId:R.objectNumber}),ie("endobj")},br=function(R){for(var fe in R.objectNumber=bt(),ie("<<"),R)switch(fe){case"opacity":ie("/ca "+O(R[fe]));break;case"stroke-opacity":ie("/CA "+O(R[fe]))}ie(">>"),ie("endobj")},Zt=function(R){ne(R.resourcesOid,!0),ie("<<"),ie("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var fe in ie("/Font <<"),Rt)Rt.hasOwnProperty(fe)&&(f===!1||f===!0&&h.hasOwnProperty(fe))&&ie("/"+fe+" "+Rt[fe].objectNumber+" 0 R");ie(">>")}(),function(){if(Object.keys(tt).length>0){for(var fe in ie("/Shading <<"),tt)tt.hasOwnProperty(fe)&&tt[fe]instanceof Oh&&tt[fe].objectNumber>=0&&ie("/"+fe+" "+tt[fe].objectNumber+" 0 R");Tr.publish("putShadingPatternDict"),ie(">>")}}(),function(fe){if(Object.keys(tt).length>0){for(var We in ie("/Pattern <<"),tt)tt.hasOwnProperty(We)&&tt[We]instanceof m.TilingPattern&&tt[We].objectNumber>=0&&tt[We].objectNumber<fe&&ie("/"+We+" "+tt[We].objectNumber+" 0 R");Tr.publish("putTilingPatternDict"),ie(">>")}}(R.objectOid),function(){if(Object.keys(sr).length>0){var fe;for(fe in ie("/ExtGState <<"),sr)sr.hasOwnProperty(fe)&&sr[fe].objectNumber>=0&&ie("/"+fe+" "+sr[fe].objectNumber+" 0 R");Tr.publish("putGStateDict"),ie(">>")}}(),function(){for(var fe in ie("/XObject <<"),Cn)Cn.hasOwnProperty(fe)&&Cn[fe].objectNumber>=0&&ie("/"+fe+" "+Cn[fe].objectNumber+" 0 R");Tr.publish("putXobjectDict"),ie(">>")}(),ie(">>"),ie("endobj")},Pn=function(R){Rr[R.fontName]=Rr[R.fontName]||{},Rr[R.fontName][R.fontStyle]=R.id},Ct=function(R,fe,We,gt,Ut){var zr={id:"F"+(Object.keys(Rt).length+1).toString(10),postScriptName:R,fontName:fe,fontStyle:We,encoding:gt,isStandardFont:Ut||!1,metadata:{}};return Tr.publish("addFont",{font:zr,instance:this}),Rt[zr.id]=zr,Pn(zr),zr.id},lr=m.__private__.pdfEscape=m.pdfEscape=function(R,fe){return function(We,gt){var Ut,zr,cn,se,Se,Ee,it,Pt,hr;if(cn=(gt=gt||{}).sourceEncoding||"Unicode",Se=gt.outputEncoding,(gt.autoencode||Se)&&Rt[at].metadata&&Rt[at].metadata[cn]&&Rt[at].metadata[cn].encoding&&(se=Rt[at].metadata[cn].encoding,!Se&&Rt[at].encoding&&(Se=Rt[at].encoding),!Se&&se.codePages&&(Se=se.codePages[0]),typeof Se=="string"&&(Se=se[Se]),Se)){for(it=!1,Ee=[],Ut=0,zr=We.length;Ut<zr;Ut++)(Pt=Se[We.charCodeAt(Ut)])?Ee.push(String.fromCharCode(Pt)):Ee.push(We[Ut]),Ee[Ut].charCodeAt(0)>>8&&(it=!0);We=Ee.join("")}for(Ut=We.length;it===void 0&&Ut!==0;)We.charCodeAt(Ut-1)>>8&&(it=!0),Ut--;if(!it)return We;for(Ee=gt.noBOM?[]:[254,255],Ut=0,zr=We.length;Ut<zr;Ut++){if((hr=(Pt=We.charCodeAt(Ut))>>8)>>8)throw new Error("Character at position "+Ut+" of string '"+We+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Ee.push(hr),Ee.push(Pt-(hr<<8))}return String.fromCharCode.apply(void 0,Ee)}(R,fe).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Ye=m.__private__.beginPage=function(R){ae[++Wr]=[],qr[Wr]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(R[0]),topRightY:Number(R[1])}},Br(Wr),te(ae[L])},Tt=function(R,fe){var We,gt,Ut;switch(r=fe||r,typeof R=="string"&&(We=y(R.toLowerCase()),Array.isArray(We)&&(gt=We[0],Ut=We[1])),Array.isArray(R)&&(gt=R[0]*qt,Ut=R[1]*qt),isNaN(gt)&&(gt=s[0],Ut=s[1]),(gt>14400||Ut>14400)&&(wo.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),gt=Math.min(14400,gt),Ut=Math.min(14400,Ut)),s=[gt,Ut],r.substr(0,1)){case"l":Ut>gt&&(s=[Ut,gt]);break;case"p":gt>Ut&&(s=[Ut,gt])}Ye(s),un(da),ie(po),pl!==0&&ie(pl+" J"),Eu!==0&&ie(Eu+" j"),Tr.publish("addPage",{pageNumber:Wr})},Xt=function(R){R>0&&R<=Wr&&(ae.splice(R,1),qr.splice(R,1),Wr--,L>Wr&&(L=Wr),this.setPage(L))},Br=function(R){R>0&&R<=Wr&&(L=R)},Wn=m.__private__.getNumberOfPages=m.getNumberOfPages=function(){return ae.length-1},xn=function(R,fe,We){var gt,Ut=void 0;return We=We||{},R=R!==void 0?R:Rt[at].fontName,fe=fe!==void 0?fe:Rt[at].fontStyle,gt=R.toLowerCase(),Rr[gt]!==void 0&&Rr[gt][fe]!==void 0?Ut=Rr[gt][fe]:Rr[R]!==void 0&&Rr[R][fe]!==void 0?Ut=Rr[R][fe]:We.disableWarning===!1&&wo.warn("Unable to look up font label for font '"+R+"', '"+fe+"'. Refer to getFontList() for available fonts."),Ut||We.noFallback||(Ut=Rr.times[fe])==null&&(Ut=Rr.times.normal),Ut},on=m.__private__.putInfo=function(){var R=bt(),fe=function(gt){return gt};for(var We in u!==null&&(fe=ot.encryptor(R,0)),ie("<<"),ie("/Producer ("+lr(fe("jsPDF "+Ca.version))+")"),ve)ve.hasOwnProperty(We)&&ve[We]&&ie("/"+We.substr(0,1).toUpperCase()+We.substr(1)+" ("+lr(fe(ve[We]))+")");ie("/CreationDate ("+lr(fe($))+")"),ie(">>"),ie("endobj")},ua=m.__private__.putCatalog=function(R){var fe=(R=R||{}).rootDictionaryObjId||Gt;switch(bt(),ie("<<"),ie("/Type /Catalog"),ie("/Pages "+fe+" 0 R"),ft||(ft="fullwidth"),ft){case"fullwidth":ie("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ie("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ie("/OpenAction [3 0 R /Fit]");break;case"original":ie("/OpenAction [3 0 R /XYZ null null 1]");break;default:var We=""+ft;We.substr(We.length-1)==="%"&&(ft=parseInt(ft)/100),typeof ft=="number"&&ie("/OpenAction [3 0 R /XYZ null null "+O(ft)+"]")}switch(Wt||(Wt="continuous"),Wt){case"continuous":ie("/PageLayout /OneColumn");break;case"single":ie("/PageLayout /SinglePage");break;case"two":case"twoleft":ie("/PageLayout /TwoColumnLeft");break;case"tworight":ie("/PageLayout /TwoColumnRight")}be&&ie("/PageMode /"+be),Tr.publish("putCatalog"),ie(">>"),ie("endobj")},sa=m.__private__.putTrailer=function(){ie("trailer"),ie("<<"),ie("/Size "+(X+1)),ie("/Root "+X+" 0 R"),ie("/Info "+(X-1)+" 0 R"),u!==null&&ie("/Encrypt "+ot.oid+" 0 R"),ie("/ID [ <"+q+"> <"+q+"> ]"),ie(">>")},wa=m.__private__.putHeader=function(){ie("%PDF-"+x),ie("%")},Va=m.__private__.putXRef=function(){var R="0000000000";ie("xref"),ie("0 "+(X+1)),ie("0000000000 65535 f ");for(var fe=1;fe<=X;fe++)typeof W[fe]=="function"?ie((R+W[fe]()).slice(-10)+" 00000 n "):W[fe]!==void 0?ie((R+W[fe]).slice(-10)+" 00000 n "):ie("0000000000 00000 n ")},J=m.__private__.buildDocument=function(){var R;X=0,me=0,Y=[],W=[],ee=[],Gt=zt(),Ht=zt(),te(Y),Tr.publish("buildDocument"),wa(),ta(),function(){Tr.publish("putAdditionalObjects");for(var We=0;We<ee.length;We++){var gt=ee[We];ne(gt.objId,!0),ie(gt.content),ie("endobj")}Tr.publish("postPutAdditionalObjects")}(),R=[],function(){for(var We in Rt)Rt.hasOwnProperty(We)&&(f===!1||f===!0&&h.hasOwnProperty(We))&&Aa(Rt[We])}(),function(){var We;for(We in sr)sr.hasOwnProperty(We)&&br(sr[We])}(),function(){for(var We in Cn)Cn.hasOwnProperty(We)&&ke(Cn[We])}(),function(We){var gt;for(gt in tt)tt.hasOwnProperty(gt)&&(tt[gt]instanceof Oh?Ae(tt[gt]):tt[gt]instanceof Eg&&et(tt[gt],We))}(R),Tr.publish("putResources"),R.forEach(Zt),Zt({resourcesOid:Ht,objectOid:Number.MAX_SAFE_INTEGER}),Tr.publish("postPutResources"),u!==null&&(ot.oid=bt(),ie("<<"),ie("/Filter /Standard"),ie("/V "+ot.v),ie("/R "+ot.r),ie("/U <"+ot.toHexString(ot.U)+">"),ie("/O <"+ot.toHexString(ot.O)+">"),ie("/P "+ot.P),ie(">>"),ie("endobj")),on(),ua();var fe=me;return Va(),sa(),ie("startxref"),ie(""+fe),ie("%%EOF"),te(ae[L]),Y.join(`
`)},Oe=m.__private__.getBlob=function(R){return new Blob([vt(R)],{type:"application/pdf"})},Je=m.output=m.__private__.output=(Qt=function(R,fe){switch(typeof(fe=fe||{})=="string"?fe={filename:fe}:fe.filename=fe.filename||"generated.pdf",R){case void 0:return J();case"save":m.save(fe.filename);break;case"arraybuffer":return vt(J());case"blob":return Oe(J());case"bloburi":case"bloburl":if(rs.URL!==void 0&&typeof rs.URL.createObjectURL=="function")return rs.URL&&rs.URL.createObjectURL(Oe(J()))||void 0;wo.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var We="",gt=J();try{We=J9(gt)}catch{We=J9(unescape(encodeURIComponent(gt)))}return"data:application/pdf;filename="+fe.filename+";base64,"+We;case"pdfobjectnewwindow":if(Object.prototype.toString.call(rs)==="[object Window]"){var Ut="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",zr=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';fe.pdfObjectUrl&&(Ut=fe.pdfObjectUrl,zr="");var cn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ut+'"'+zr+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(fe)+");<\/script></body></html>",se=rs.open();return se!==null&&se.document.write(cn),se}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(rs)==="[object Window]"){var Se='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(fe.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+fe.filename+'" width="500px" height="400px" /></body></html>',Ee=rs.open();if(Ee!==null){Ee.document.write(Se);var it=this;Ee.document.documentElement.querySelector("#pdfViewer").onload=function(){Ee.document.title=fe.filename,Ee.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(it.output("bloburl"))}}return Ee}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(rs)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Pt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",fe)+'"></iframe></body></html>',hr=rs.open();if(hr!==null&&(hr.document.write(Pt),hr.document.title=fe.filename),hr||typeof safari>"u")return hr;break;case"datauri":case"dataurl":return rs.document.location.href=this.output("datauristring",fe);default:return null}},Qt.foo=function(){try{return Qt.apply(this,arguments)}catch(We){var R=We.stack||"";~R.indexOf(" at ")&&(R=R.split(" at ")[1]);var fe="Error in function "+R.split(`
`)[0].split("<")[0]+": "+We.message;if(!rs.console)throw new Error(fe);rs.console.error(fe,We),rs.alert&&alert(fe)}},Qt.foo.bar=Qt,Qt.foo),mr=function(R){return Array.isArray(sn)===!0&&sn.indexOf(R)>-1};switch(n){case"pt":qt=1;break;case"mm":qt=72/25.4;break;case"cm":qt=72/2.54;break;case"in":qt=72;break;case"px":qt=mr("px_scaling")==1?.75:96/72;break;case"pc":case"em":qt=12;break;case"ex":qt=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);qt=n}var ot=null;_e(),F();var ar=m.__private__.getPageInfo=m.getPageInfo=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:qr[R].objId,pageNumber:R,pageContext:qr[R]}},ir=m.__private__.getPageInfoByObjId=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var fe in qr)if(qr[fe].objId===R)break;return ar(fe)},In=m.__private__.getCurrentPageInfo=m.getCurrentPageInfo=function(){return{objId:qr[L].objId,pageNumber:L,pageContext:qr[L]}};m.addPage=function(){return Tt.apply(this,arguments),this},m.setPage=function(){return Br.apply(this,arguments),te.call(this,ae[L]),this},m.insertPage=function(R){return this.addPage(),this.movePage(L,R),this},m.movePage=function(R,fe){var We,gt;if(R>fe){We=ae[R],gt=qr[R];for(var Ut=R;Ut>fe;Ut--)ae[Ut]=ae[Ut-1],qr[Ut]=qr[Ut-1];ae[fe]=We,qr[fe]=gt,this.setPage(fe)}else if(R<fe){We=ae[R],gt=qr[R];for(var zr=R;zr<fe;zr++)ae[zr]=ae[zr+1],qr[zr]=qr[zr+1];ae[fe]=We,qr[fe]=gt,this.setPage(fe)}return this},m.deletePage=function(){return Xt.apply(this,arguments),this},m.__private__.text=m.text=function(R,fe,We,gt,Ut){var zr,cn,se,Se,Ee,it,Pt,hr,er,Ar=(gt=gt||{}).scope||this;if(typeof R=="number"&&typeof fe=="number"&&(typeof We=="string"||Array.isArray(We))){var Cr=We;We=fe,fe=R,R=Cr}if(arguments[3]instanceof Le==0?(se=arguments[4],Se=arguments[5],ks(Pt=arguments[3])==="object"&&Pt!==null||(typeof se=="string"&&(Se=se,se=null),typeof Pt=="string"&&(Se=Pt,Pt=null),typeof Pt=="number"&&(se=Pt,Pt=null),gt={flags:Pt,angle:se,align:Se})):(P("The transform parameter of text() with a Matrix value"),er=Ut),isNaN(fe)||isNaN(We)||R==null)throw new Error("Invalid arguments passed to jsPDF.text");if(R.length===0)return Ar;var Lt,vn="",Xr=typeof gt.lineHeightFactor=="number"?gt.lineHeightFactor:Lr,Or=Ar.internal.scaleFactor;function _n(Ia){return Ia=Ia.split("	").join(Array(gt.TabLen||9).join(" ")),lr(Ia,Pt)}function fr(Ia){for(var Ra,fs=Ia.concat(),Js=[],yo=fs.length;yo--;)typeof(Ra=fs.shift())=="string"?Js.push(Ra):Array.isArray(Ia)&&(Ra.length===1||Ra[1]===void 0&&Ra[2]===void 0)?Js.push(Ra[0]):Js.push([Ra[0],Ra[1],Ra[2]]);return Js}function dn(Ia,Ra){var fs;if(typeof Ia=="string")fs=Ra(Ia)[0];else if(Array.isArray(Ia)){for(var Js,yo,ai=Ia.concat(),D=[],K=ai.length;K--;)typeof(Js=ai.shift())=="string"?D.push(Ra(Js)[0]):Array.isArray(Js)&&typeof Js[0]=="string"&&(yo=Ra(Js[0],Js[1],Js[2]),D.push([yo[0],yo[1],yo[2]]));fs=D}return fs}var Dr=!1,wr=!0;if(typeof R=="string")Dr=!0;else if(Array.isArray(R)){var Jr=R.concat();cn=[];for(var Mn,ha=Jr.length;ha--;)(typeof(Mn=Jr.shift())!="string"||Array.isArray(Mn)&&typeof Mn[0]!="string")&&(wr=!1);Dr=wr}if(Dr===!1)throw new Error('Type of text must be string or Array. "'+R+'" is not recognized.');typeof R=="string"&&(R=R.match(/[\r?\n]/)?R.split(/\r\n|\r|\n/g):[R]);var is=St/Ar.internal.scaleFactor,Gs=is*(Xr-1);switch(gt.baseline){case"bottom":We-=Gs;break;case"top":We+=is-Gs;break;case"hanging":We+=is-2*Gs;break;case"middle":We+=is/2-Gs}if((it=gt.maxWidth||0)>0&&(typeof R=="string"?R=Ar.splitTextToSize(R,it):Object.prototype.toString.call(R)==="[object Array]"&&(R=R.reduce(function(Ia,Ra){return Ia.concat(Ar.splitTextToSize(Ra,it))},[]))),zr={text:R,x:fe,y:We,options:gt,mutex:{pdfEscape:lr,activeFontKey:at,fonts:Rt,activeFontSize:St}},Tr.publish("preProcessText",zr),R=zr.text,se=(gt=zr.options).angle,er instanceof Le==0&&se&&typeof se=="number"){se*=Math.PI/180,gt.rotationDirection===0&&(se=-se),j===w&&(se=-se);var jn=Math.cos(se),Nr=Math.sin(se);er=new Le(jn,Nr,-Nr,jn,0,0)}else se&&se instanceof Le&&(er=se);j!==w||er||(er=Ot),(Ee=gt.charSpace||ec)!==void 0&&(vn+=S(T(Ee))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(hr=gt.horizontalScale)!==void 0&&(vn+=S(100*hr)+` Tz
`),gt.lang;var an=-1,Nn=gt.renderingMode!==void 0?gt.renderingMode:gt.stroke,Sn=Ar.internal.getCurrentPageInfo().pageContext;switch(Nn){case 0:case!1:case"fill":an=0;break;case 1:case!0:case"stroke":an=1;break;case 2:case"fillThenStroke":an=2;break;case 3:case"invisible":an=3;break;case 4:case"fillAndAddForClipping":an=4;break;case 5:case"strokeAndAddPathForClipping":an=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":an=6;break;case 7:case"addToPathForClipping":an=7}var hn=Sn.usedRenderingMode!==void 0?Sn.usedRenderingMode:-1;an!==-1?vn+=an+` Tr
`:hn!==-1&&(vn+=`0 Tr
`),an!==-1&&(Sn.usedRenderingMode=an),Se=gt.align||"left";var Pr,pn=St*Xr,vr=Ar.internal.pageSize.getWidth(),kr=Rt[at];Ee=gt.charSpace||ec,it=gt.maxWidth||0,Pt=Object.assign({autoencode:!0,noBOM:!0},gt.flags);var Vr=[],Ir=function(Ia){return Ar.getStringUnitWidth(Ia,{font:kr,charSpace:Ee,fontSize:St,doKerning:!1})*St/Or};if(Object.prototype.toString.call(R)==="[object Array]"){var re;cn=fr(R),Se!=="left"&&(Pr=cn.map(Ir));var we,Ge=0;if(Se==="right"){fe-=Pr[0],R=[],ha=cn.length;for(var ge=0;ge<ha;ge++)ge===0?(we=us(fe),re=Un(We)):(we=T(Ge-Pr[ge]),re=-pn),R.push([cn[ge],we,re]),Ge=Pr[ge]}else if(Se==="center"){fe-=Pr[0]/2,R=[],ha=cn.length;for(var nt=0;nt<ha;nt++)nt===0?(we=us(fe),re=Un(We)):(we=T((Ge-Pr[nt])/2),re=-pn),R.push([cn[nt],we,re]),Ge=Pr[nt]}else if(Se==="left"){R=[],ha=cn.length;for(var st=0;st<ha;st++)R.push(cn[st])}else if(Se==="justify"&&kr.encoding==="Identity-H"){R=[],ha=cn.length,it=it!==0?it:vr;for(var je=0,ht=0;ht<ha;ht++)if(re=ht===0?Un(We):-pn,we=ht===0?us(fe):je,ht<ha-1){var rt=T((it-Pr[ht])/(cn[ht].split(" ").length-1)),nr=cn[ht].split(" ");R.push([nr[0]+" ",we,re]),je=0;for(var yn=1;yn<nr.length;yn++){var fn=(Ir(nr[yn-1]+" "+nr[yn])-Ir(nr[yn]))*Or+rt;yn==nr.length-1?R.push([nr[yn],fn,0]):R.push([nr[yn]+" ",fn,0]),je-=fn}}else R.push([cn[ht],we,re]);R.push(["",je,0])}else{if(Se!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(R=[],ha=cn.length,it=it!==0?it:vr,ht=0;ht<ha;ht++){re=ht===0?Un(We):-pn,we=ht===0?us(fe):0;var Ln=cn[ht].split(" ").length-1,On=Ln>0?(it-Pr[ht])/Ln:0;ht<ha-1?Vr.push(S(T(On))):Vr.push(0),R.push([cn[ht],we,re])}}}(typeof gt.R2L=="boolean"?gt.R2L:gr)===!0&&(R=dn(R,function(Ia,Ra,fs){return[Ia.split("").reverse().join(""),Ra,fs]})),zr={text:R,x:fe,y:We,options:gt,mutex:{pdfEscape:lr,activeFontKey:at,fonts:Rt,activeFontSize:St}},Tr.publish("postProcessText",zr),R=zr.text,Lt=zr.mutex.isHex||!1;var ma=Rt[at].encoding;ma!=="WinAnsiEncoding"&&ma!=="StandardEncoding"||(R=dn(R,function(Ia,Ra,fs){return[_n(Ia),Ra,fs]})),cn=fr(R),R=[];for(var Ja,Bs,na,ia=Array.isArray(cn[0])?1:0,ja="",$a=function(Ia,Ra,fs){var Js="";return fs instanceof Le?(fs=typeof gt.angle=="number"?Ze(fs,new Le(1,0,0,1,Ia,Ra)):Ze(new Le(1,0,0,1,Ia,Ra),fs),j===w&&(fs=Ze(new Le(1,0,0,-1,0,0),fs)),Js=fs.join(" ")+` Tm
`):Js=S(Ia)+" "+S(Ra)+` Td
`,Js},js=0;js<cn.length;js++){switch(ja="",ia){case 1:na=(Lt?"<":"(")+cn[js][0]+(Lt?">":")"),Ja=parseFloat(cn[js][1]),Bs=parseFloat(cn[js][2]);break;case 0:na=(Lt?"<":"(")+cn[js]+(Lt?">":")"),Ja=us(fe),Bs=Un(We)}Vr!==void 0&&Vr[js]!==void 0&&(ja=Vr[js]+` Tw
`),js===0?R.push(ja+$a(Ja,Bs,er)+na):ia===0?R.push(ja+na):ia===1&&R.push(ja+$a(Ja,Bs,er)+na)}R=ia===0?R.join(` Tj
T* `):R.join(` Tj
`),R+=` Tj
`;var no=`BT
/`;return no+=at+" "+St+` Tf
`,no+=S(St*Xr)+` TL
`,no+=zo+`
`,no+=vn,no+=R,ie(no+="ET"),h[at]=!0,Ar};var ln=m.__private__.clip=m.clip=function(R){return ie(R==="evenodd"?"W*":"W"),this};m.clipEvenOdd=function(){return ln("evenodd")},m.__private__.discardPath=m.discardPath=function(){return ie("n"),this};var Kr=m.__private__.isValidStyle=function(R){var fe=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(R)!==-1&&(fe=!0),fe};m.__private__.setDefaultPathOperation=m.setDefaultPathOperation=function(R){return Kr(R)&&(d=R),this};var oe=m.__private__.getStyle=m.getStyle=function(R){var fe=d;switch(R){case"D":case"S":fe="S";break;case"F":fe="f";break;case"FD":case"DF":fe="B";break;case"f":case"f*":case"B":case"B*":fe=R}return fe},Ke=m.close=function(){return ie("h"),this};m.stroke=function(){return ie("S"),this},m.fill=function(R){return ct("f",R),this},m.fillEvenOdd=function(R){return ct("f*",R),this},m.fillStroke=function(R){return ct("B",R),this},m.fillStrokeEvenOdd=function(R){return ct("B*",R),this};var ct=function(R,fe){ks(fe)==="object"?Pe(fe,R):ie(R)},xe=function(R){R===null||j===w&&R===void 0||(R=oe(R),ie(R))};function $e(R,fe,We,gt,Ut){var zr=new Eg(fe||this.boundingBox,We||this.xStep,gt||this.yStep,this.gState,Ut||this.matrix);zr.stream=this.stream;var cn=R+"$$"+this.cloneIndex+++"$$";return mt(cn,zr),zr}var Pe=function(R,fe){var We=ut[R.key],gt=tt[We];if(gt instanceof Oh)ie("q"),ie(Vt(fe)),gt.gState&&m.setGState(gt.gState),ie(R.matrix.toString()+" cm"),ie("/"+We+" sh"),ie("Q");else if(gt instanceof Eg){var Ut=new Le(1,0,0,-1,0,Yi());R.matrix&&(Ut=Ut.multiply(R.matrix||Ot),We=$e.call(gt,R.key,R.boundingBox,R.xStep,R.yStep,Ut).id),ie("q"),ie("/Pattern cs"),ie("/"+We+" scn"),gt.gState&&m.setGState(gt.gState),ie(fe),ie("Q")}},Vt=function(R){switch(R){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},yt=m.moveTo=function(R,fe){return ie(S(T(R))+" "+S(k(fe))+" m"),this},tr=m.lineTo=function(R,fe){return ie(S(T(R))+" "+S(k(fe))+" l"),this},dr=m.curveTo=function(R,fe,We,gt,Ut,zr){return ie([S(T(R)),S(k(fe)),S(T(We)),S(k(gt)),S(T(Ut)),S(k(zr)),"c"].join(" ")),this};m.__private__.line=m.line=function(R,fe,We,gt,Ut){if(isNaN(R)||isNaN(fe)||isNaN(We)||isNaN(gt)||!Kr(Ut))throw new Error("Invalid arguments passed to jsPDF.line");return j===b?this.lines([[We-R,gt-fe]],R,fe,[1,1],Ut||"S"):this.lines([[We-R,gt-fe]],R,fe,[1,1]).stroke()},m.__private__.lines=m.lines=function(R,fe,We,gt,Ut,zr){var cn,se,Se,Ee,it,Pt,hr,er,Ar,Cr,Lt,vn;if(typeof R=="number"&&(vn=We,We=fe,fe=R,R=vn),gt=gt||[1,1],zr=zr||!1,isNaN(fe)||isNaN(We)||!Array.isArray(R)||!Array.isArray(gt)||!Kr(Ut)||typeof zr!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(yt(fe,We),cn=gt[0],se=gt[1],Ee=R.length,Cr=fe,Lt=We,Se=0;Se<Ee;Se++)(it=R[Se]).length===2?(Cr=it[0]*cn+Cr,Lt=it[1]*se+Lt,tr(Cr,Lt)):(Pt=it[0]*cn+Cr,hr=it[1]*se+Lt,er=it[2]*cn+Cr,Ar=it[3]*se+Lt,Cr=it[4]*cn+Cr,Lt=it[5]*se+Lt,dr(Pt,hr,er,Ar,Cr,Lt));return zr&&Ke(),xe(Ut),this},m.path=function(R){for(var fe=0;fe<R.length;fe++){var We=R[fe],gt=We.c;switch(We.op){case"m":yt(gt[0],gt[1]);break;case"l":tr(gt[0],gt[1]);break;case"c":dr.apply(this,gt);break;case"h":Ke()}}return this},m.__private__.rect=m.rect=function(R,fe,We,gt,Ut){if(isNaN(R)||isNaN(fe)||isNaN(We)||isNaN(gt)||!Kr(Ut))throw new Error("Invalid arguments passed to jsPDF.rect");return j===b&&(gt=-gt),ie([S(T(R)),S(k(fe)),S(T(We)),S(T(gt)),"re"].join(" ")),xe(Ut),this},m.__private__.triangle=m.triangle=function(R,fe,We,gt,Ut,zr,cn){if(isNaN(R)||isNaN(fe)||isNaN(We)||isNaN(gt)||isNaN(Ut)||isNaN(zr)||!Kr(cn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[We-R,gt-fe],[Ut-We,zr-gt],[R-Ut,fe-zr]],R,fe,[1,1],cn,!0),this},m.__private__.roundedRect=m.roundedRect=function(R,fe,We,gt,Ut,zr,cn){if(isNaN(R)||isNaN(fe)||isNaN(We)||isNaN(gt)||isNaN(Ut)||isNaN(zr)||!Kr(cn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var se=4/3*(Math.SQRT2-1);return Ut=Math.min(Ut,.5*We),zr=Math.min(zr,.5*gt),this.lines([[We-2*Ut,0],[Ut*se,0,Ut,zr-zr*se,Ut,zr],[0,gt-2*zr],[0,zr*se,-Ut*se,zr,-Ut,zr],[2*Ut-We,0],[-Ut*se,0,-Ut,-zr*se,-Ut,-zr],[0,2*zr-gt],[0,-zr*se,Ut*se,-zr,Ut,-zr]],R+Ut,fe,[1,1],cn,!0),this},m.__private__.ellipse=m.ellipse=function(R,fe,We,gt,Ut){if(isNaN(R)||isNaN(fe)||isNaN(We)||isNaN(gt)||!Kr(Ut))throw new Error("Invalid arguments passed to jsPDF.ellipse");var zr=4/3*(Math.SQRT2-1)*We,cn=4/3*(Math.SQRT2-1)*gt;return yt(R+We,fe),dr(R+We,fe-cn,R+zr,fe-gt,R,fe-gt),dr(R-zr,fe-gt,R-We,fe-cn,R-We,fe),dr(R-We,fe+cn,R-zr,fe+gt,R,fe+gt),dr(R+zr,fe+gt,R+We,fe+cn,R+We,fe),xe(Ut),this},m.__private__.circle=m.circle=function(R,fe,We,gt){if(isNaN(R)||isNaN(fe)||isNaN(We)||!Kr(gt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(R,fe,We,We,gt)},m.setFont=function(R,fe,We){return We&&(fe=A(fe,We)),at=xn(R,fe,{disableWarning:!1}),this};var tn=m.__private__.getFont=m.getFont=function(){return Rt[xn.apply(m,arguments)]};m.__private__.getFontList=m.getFontList=function(){var R,fe,We={};for(R in Rr)if(Rr.hasOwnProperty(R))for(fe in We[R]=[],Rr[R])Rr[R].hasOwnProperty(fe)&&We[R].push(fe);return We},m.addFont=function(R,fe,We,gt,Ut){var zr=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&zr.indexOf(arguments[3])!==-1?Ut=arguments[3]:arguments[3]&&zr.indexOf(arguments[3])==-1&&(We=A(We,gt)),Ct.call(this,R,fe,We,Ut=Ut||"Identity-H")};var Lr,da=e.lineWidth||.200025,rn=m.__private__.getLineWidth=m.getLineWidth=function(){return da},un=m.__private__.setLineWidth=m.setLineWidth=function(R){return da=R,ie(S(T(R))+" w"),this};m.__private__.setLineDash=Ca.API.setLineDash=Ca.API.setLineDashPattern=function(R,fe){if(R=R||[],fe=fe||0,isNaN(fe)||!Array.isArray(R))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return R=R.map(function(We){return S(T(We))}).join(" "),fe=S(T(fe)),ie("["+R+"] "+fe+" d"),this};var Dn=m.__private__.getLineHeight=m.getLineHeight=function(){return St*Lr};m.__private__.getLineHeight=m.getLineHeight=function(){return St*Lr};var fa=m.__private__.setLineHeightFactor=m.setLineHeightFactor=function(R){return typeof(R=R||1.15)=="number"&&(Lr=R),this},Oa=m.__private__.getLineHeightFactor=m.getLineHeightFactor=function(){return Lr};fa(e.lineHeight);var us=m.__private__.getHorizontalCoordinate=function(R){return T(R)},Un=m.__private__.getVerticalCoordinate=function(R){return j===w?R:qr[L].mediaBox.topRightY-qr[L].mediaBox.bottomLeftY-T(R)},Ya=m.__private__.getHorizontalCoordinateString=m.getHorizontalCoordinateString=function(R){return S(us(R))},$s=m.__private__.getVerticalCoordinateString=m.getVerticalCoordinateString=function(R){return S(Un(R))},po=e.strokeColor||"0 G";m.__private__.getStrokeColor=m.getDrawColor=function(){return Fr(po)},m.__private__.setStrokeColor=m.setDrawColor=function(R,fe,We,gt){return po=cr({ch1:R,ch2:fe,ch3:We,ch4:gt,pdfColorType:"draw",precision:2}),ie(po),this};var wi=e.fillColor||"0 g";m.__private__.getFillColor=m.getFillColor=function(){return Fr(wi)},m.__private__.setFillColor=m.setFillColor=function(R,fe,We,gt){return wi=cr({ch1:R,ch2:fe,ch3:We,ch4:gt,pdfColorType:"fill",precision:2}),ie(wi),this};var zo=e.textColor||"0 g",ji=m.__private__.getTextColor=m.getTextColor=function(){return Fr(zo)};m.__private__.setTextColor=m.setTextColor=function(R,fe,We,gt){return zo=cr({ch1:R,ch2:fe,ch3:We,ch4:gt,pdfColorType:"text",precision:3}),this};var ec=e.charSpace,rd=m.__private__.getCharSpace=m.getCharSpace=function(){return parseFloat(ec||0)};m.__private__.setCharSpace=m.setCharSpace=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return ec=R,this};var pl=0;m.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},m.__private__.setLineCap=m.setLineCap=function(R){var fe=m.CapJoinStyles[R];if(fe===void 0)throw new Error("Line cap style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return pl=fe,ie(fe+" J"),this};var Eu=0;m.__private__.setLineJoin=m.setLineJoin=function(R){var fe=m.CapJoinStyles[R];if(fe===void 0)throw new Error("Line join style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Eu=fe,ie(fe+" j"),this},m.__private__.setLineMiterLimit=m.__private__.setMiterLimit=m.setLineMiterLimit=m.setMiterLimit=function(R){if(R=R||0,isNaN(R))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ie(S(T(R))+" M"),this},m.GState=R1,m.setGState=function(R){(R=typeof R=="string"?sr[Sr[R]]:Ko(null,R)).equals(xr)||(ie("/"+R.id+" gs"),xr=R)};var Ko=function(R,fe){if(!R||!Sr[R]){var We=!1;for(var gt in sr)if(sr.hasOwnProperty(gt)&&sr[gt].equals(fe)){We=!0;break}if(We)fe=sr[gt];else{var Ut="GS"+(Object.keys(sr).length+1).toString(10);sr[Ut]=fe,fe.id=Ut}return R&&(Sr[R]=fe.id),Tr.publish("addGState",fe),fe}};m.addGState=function(R,fe){return Ko(R,fe),this},m.saveGraphicsState=function(){return ie("q"),Me.push({key:at,size:St,color:zo}),this},m.restoreGraphicsState=function(){ie("Q");var R=Me.pop();return at=R.key,St=R.size,zo=R.color,xr=null,this},m.setCurrentTransformationMatrix=function(R){return ie(R.toString()+" cm"),this},m.comment=function(R){return ie("#"+R),this};var Hs=function(R,fe){var We=R||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return We},set:function(zr){isNaN(zr)||(We=parseFloat(zr))}});var gt=fe||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return gt},set:function(zr){isNaN(zr)||(gt=parseFloat(zr))}});var Ut="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ut},set:function(zr){Ut=zr.toString()}}),this},tc=function(R,fe,We,gt){Hs.call(this,R,fe),this.type="rect";var Ut=We||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ut},set:function(cn){isNaN(cn)||(Ut=parseFloat(cn))}});var zr=gt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return zr},set:function(cn){isNaN(cn)||(zr=parseFloat(cn))}}),this},Xi=function(){this.page=Wr,this.currentPage=L,this.pages=ae.slice(0),this.pagesContext=qr.slice(0),this.x=$t,this.y=De,this.matrix=wt,this.width=rc(L),this.height=gl(L),this.outputDestination=Te,this.id="",this.objectNumber=-1};Xi.prototype.restore=function(){Wr=this.page,L=this.currentPage,qr=this.pagesContext,ae=this.pages,$t=this.x,De=this.y,wt=this.matrix,Ns(L,this.width),Dl(L,this.height),Te=this.outputDestination};var Tl=function(R,fe,We,gt,Ut){Fe.push(new Xi),Wr=L=0,ae=[],$t=R,De=fe,wt=Ut,Ye([We,gt])};for(var As in m.beginFormObject=function(R,fe,We,gt,Ut){return Tl(R,fe,We,gt,Ut),this},m.endFormObject=function(R){return function(fe){if(ze[fe])Fe.pop().restore();else{var We=new Xi,gt="Xo"+(Object.keys(Cn).length+1).toString(10);We.id=gt,ze[fe]=gt,Cn[gt]=We,Tr.publish("addFormObject",We),Fe.pop().restore()}}(R),this},m.doFormObject=function(R,fe){var We=Cn[ze[R]];return ie("q"),ie(fe.toString()+" cm"),ie("/"+We.id+" Do"),ie("Q"),this},m.getFormObject=function(R){var fe=Cn[ze[R]];return{x:fe.x,y:fe.y,width:fe.width,height:fe.height,matrix:fe.matrix}},m.save=function(R,fe){return R=R||"generated.pdf",(fe=fe||{}).returnPromise=fe.returnPromise||!1,fe.returnPromise===!1?(lg(Oe(J()),R),typeof lg.unload=="function"&&rs.setTimeout&&setTimeout(lg.unload,911),this):new Promise(function(We,gt){try{var Ut=lg(Oe(J()),R);typeof lg.unload=="function"&&rs.setTimeout&&setTimeout(lg.unload,911),We(Ut)}catch(zr){gt(zr.message)}})},Ca.API)Ca.API.hasOwnProperty(As)&&(As==="events"&&Ca.API.events.length?function(R,fe){var We,gt,Ut;for(Ut=fe.length-1;Ut!==-1;Ut--)We=fe[Ut][0],gt=fe[Ut][1],R.subscribe.apply(R,[We].concat(typeof gt=="function"?[gt]:gt))}(Tr,Ca.API.events):m[As]=Ca.API[As]);function rc(R){return qr[R].mediaBox.topRightX-qr[R].mediaBox.bottomLeftX}function Ns(R,fe){qr[R].mediaBox.topRightX=fe+qr[R].mediaBox.bottomLeftX}function gl(R){return qr[R].mediaBox.topRightY-qr[R].mediaBox.bottomLeftY}function Dl(R,fe){qr[R].mediaBox.topRightY=fe+qr[R].mediaBox.bottomLeftY}var ku=m.getPageWidth=function(R){return rc(R=R||L)/qt},xl=m.setPageWidth=function(R,fe){Ns(R,fe*qt)},Yi=m.getPageHeight=function(R){return gl(R=R||L)/qt},vl=m.setPageHeight=function(R,fe){Dl(R,fe*qt)};return m.internal={pdfEscape:lr,getStyle:oe,getFont:tn,getFontSize:_t,getCharSpace:rd,getTextColor:ji,getLineHeight:Dn,getLineHeightFactor:Oa,getLineWidth:rn,write:xt,getHorizontalCoordinate:us,getVerticalCoordinate:Un,getCoordinateString:Ya,getVerticalCoordinateString:$s,collections:{},newObject:bt,newAdditionalObject:He,newObjectDeferred:zt,newObjectDeferredBegin:ne,getFilters:nn,putStream:Tn,events:Tr,scaleFactor:qt,pageSize:{getWidth:function(){return ku(L)},setWidth:function(R){xl(L,R)},getHeight:function(){return Yi(L)},setHeight:function(R){vl(L,R)}},encryptionOptions:u,encryption:ot,getEncryptor:function(R){return u!==null?ot.encryptor(R,0):function(fe){return fe}},output:Je,getNumberOfPages:Wn,pages:ae,out:ie,f2:O,f3:I,getPageInfo:ar,getPageInfoByObjId:ir,getCurrentPageInfo:In,getPDFVersion:g,Point:Hs,Rectangle:tc,Matrix:Le,hasHotfix:mr},Object.defineProperty(m.internal.pageSize,"width",{get:function(){return ku(L)},set:function(R){xl(L,R)},enumerable:!0,configurable:!0}),Object.defineProperty(m.internal.pageSize,"height",{get:function(){return Yi(L)},set:function(R){vl(L,R)},enumerable:!0,configurable:!0}),function(R){for(var fe=0,We=dt.length;fe<We;fe++){var gt=Ct.call(this,R[fe][0],R[fe][1],R[fe][2],dt[fe][3],!0);f===!1&&(h[gt]=!0);var Ut=R[fe][0].split("-");Pn({id:gt,fontName:Ut[0],fontStyle:Ut[1]||""})}Tr.publish("addFonts",{fonts:Rt,dictionary:Rr})}.call(m,dt),at="F1",Tt(s,r),Tr.publish("initialized"),m}dv.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},dv.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},dv.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},dv.prototype.processOwnerPassword=function(e,t){return A3(P3(t).substr(0,5),e)},dv.prototype.encryptor=function(e,t){var r=P3(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return A3(r,n)}},R1.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||ks(e)!==ks(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return n===0},Ca.API={events:[]},Ca.version="3.0.3";var li=Ca.API,UR=1,Ex=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Qx=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},cs=function(e){return e.toFixed(2)},fh=function(e){return e.toFixed(5)};li.__acroform__={};var td=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},tU=function(e){return e*UR},Sf=function(e){var t=new Tae,r=ya.internal.getHeight(e)||0,n=ya.internal.getWidth(e)||0;return t.BBox=[0,0,Number(cs(n)),Number(cs(r))],t},$Qe=li.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},BQe=li.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},qQe=li.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},xi=li.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return qQe(e,t-1)},vi=li.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return $Qe(e,t-1)},yi=li.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return BQe(e,t-1)},zQe=li.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,s=e[0],o=e[1],i=e[2],l=e[3],c={};return c.lowerLeft_X=r(s)||0,c.lowerLeft_Y=n(o+l)||0,c.upperRight_X=r(s+i)||0,c.upperRight_Y=n(o)||0,[Number(cs(c.lowerLeft_X)),Number(cs(c.lowerLeft_Y)),Number(cs(c.upperRight_X)),Number(cs(c.upperRight_Y))]},UQe=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=E3(e,r),s=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+s+" "+cs(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var o=Sf(e);return o.scope=e.scope,o.stream=t.join(`
`),o}},E3=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},s=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");s=e.multiline?s.map(function(O){return O.split(`
`)}):s.map(function(O){return[O]});var o=r,i=ya.internal.getHeight(e)||0;i=i<0?-i:i;var l=ya.internal.getWidth(e)||0;l=l<0?-l:l;var c=function(O,I,T){if(O+1<s.length){var k=I+" "+s[O+1][0];return Q2(k,e,T).width<=l-4}return!1};o++;e:for(;o>0;){t="",o--;var d,u,f=Q2("3",e,o).height,h=e.multiline?i-o:(i-f)/2,m=h+=2,x=0,g=0,v=0;if(o<=0){t=`(...) Tj
`,t+="% Width of Text: "+Q2(t,e,o=12).width+", FieldWidth:"+l+`
`;break}for(var y="",b=0,w=0;w<s.length;w++)if(s.hasOwnProperty(w)){var j=!1;if(s[w].length!==1&&v!==s[w].length-1){if((f+2)*(b+2)+2>i)continue e;y+=s[w][v],j=!0,g=w,w--}else{y=(y+=s[w][v]+" ").substr(y.length-1)==" "?y.substr(0,y.length-1):y;var _=parseInt(w),C=c(_,y,o),A=w>=s.length-1;if(C&&!A){y+=" ",v=0;continue}if(C||A){if(A)g=_;else if(e.multiline&&(f+2)*(b+2)+2>i)continue e}else{if(!e.multiline||(f+2)*(b+2)+2>i)continue e;g=_}}for(var S="",P=x;P<=g;P++){var M=s[P];if(e.multiline){if(P===g){S+=M[v]+" ",v=(v+1)%M.length;continue}if(P===x){S+=M[M.length-1]+" ";continue}}S+=M[0]+" "}switch(S=S.substr(S.length-1)==" "?S.substr(0,S.length-1):S,u=Q2(S,e,o).width,e.textAlign){case"right":d=l-u-2;break;case"center":d=(l-u)/2;break;default:d=2}t+=cs(d)+" "+cs(m)+` Td
`,t+="("+Ex(S)+`) Tj
`,t+=-cs(d)+` 0 Td
`,m=-(o+2),u=0,x=j?g:g+1,b++,y=""}break}return n.text=t,n.fontSize=o,n},Q2=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),s=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:s}},VQe={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},WQe=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},HQe=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(gf.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(VQe)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");UR=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new Dae,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var s in n)if(n.hasOwnProperty(s)){var o=n[s];o.objId=void 0,o.hasAnnotation&&WQe(o,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(n,s){var o=!n;for(var i in n||(s.internal.newObjectDeferredBegin(s.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),s.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||s.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(i)){var l=n[i],c=[],d=l.Rect;if(l.Rect&&(l.Rect=zQe(l.Rect,s)),s.internal.newObjectDeferredBegin(l.objId,!0),l.DA=ya.createDefaultAppearanceStream(l),ks(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=d,l.hasAppearanceStream&&!l.appearanceStreamContent){var u=UQe(l);c.push({key:"AP",value:"<</N "+u+">>"}),s.internal.acroformPlugin.xForms.push(u)}if(l.appearanceStreamContent){var f="";for(var h in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(h)){var m=l.appearanceStreamContent[h];if(f+="/"+h+" ",f+="<<",Object.keys(m).length>=1||Array.isArray(m)){for(var i in m)if(m.hasOwnProperty(i)){var x=m[i];typeof x=="function"&&(x=x.call(s,l)),f+="/"+i+" "+x+" ",s.internal.acroformPlugin.xForms.indexOf(x)>=0||s.internal.acroformPlugin.xForms.push(x)}}else typeof(x=m)=="function"&&(x=x.call(s,l)),f+="/"+i+" "+x,s.internal.acroformPlugin.xForms.indexOf(x)>=0||s.internal.acroformPlugin.xForms.push(x);f+=">>"}c.push({key:"AP",value:`<<
`+f+">>"})}s.internal.putStream({additionalKeyValues:c,objectId:l.objId}),s.internal.out("endobj")}o&&function(g,v){for(var y in g)if(g.hasOwnProperty(y)){var b=y,w=g[y];v.internal.newObjectDeferredBegin(w.objId,!0),ks(w)==="object"&&typeof w.putStream=="function"&&w.putStream(),delete g[b]}}(s.internal.acroformPlugin.xForms,s)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},Oae=li.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(i){return i};if(Array.isArray(e)){for(var s="[",o=0;o<e.length;o++)switch(o!==0&&(s+=" "),ks(e[o])){case"boolean":case"number":case"object":s+=e[o].toString();break;case"string":e[o].substr(0,1)!=="/"?(t!==void 0&&r&&(n=r.internal.getEncryptor(t)),s+="("+Ex(n(e[o].toString()))+")"):s+=e[o].toString()}return s+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},pk=function(e,t,r){var n=function(s){return s};return t!==void 0&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),"("+Ex(n(e))+")"},Bf=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Bf.prototype.toString=function(){return this.objId+" 0 R"},Bf.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},Bf.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var n=t[r],s=this[n];s&&(Array.isArray(s)?e.push({key:n,value:Oae(s,this.objId,this.scope)}):s instanceof Bf?(s.scope=this.scope,e.push({key:n,value:s.objId+" 0 R"})):typeof s!="function"&&e.push({key:n,value:s}))}return e};var Tae=function(){Bf.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};td(Tae,Bf);var Dae=function(){Bf.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+Ex(r(e))+")"}},set:function(r){e=r}})};td(Dae,Bf);var gf=function e(){Bf.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute F supplied.');t=y}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!xi(t,3)},set:function(y){y?this.F=vi(t,3):this.F=yi(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute Ff supplied.');r=y}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(y){n=y!==void 0?y:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(y){n[0]=y}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(y){n[1]=y}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(y){n[2]=y}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(y){n[3]=y}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(y){switch(y){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=y;break;default:throw new Error('Invalid value "'+y+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof sC)return;o="FieldObject"+e.FieldNum++}var y=function(b){return b};return this.scope&&(y=this.scope.internal.getEncryptor(this.objId)),"("+Ex(y(o))+")"},set:function(y){o=y.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(y){o=y}});var i="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return i},set:function(y){i=y}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(y){l=y}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(y){c=y}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/UR:d},set:function(y){d=y}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(y){u=y}});var f="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!f||this instanceof sC||this instanceof cp))return pk(f,this.objId,this.scope)},set:function(y){y=y.toString(),f=y}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof Ui==0?pk(h,this.objId,this.scope):h},set:function(y){y=y.toString(),h=this instanceof Ui==0?y.substr(0,1)==="("?Qx(y.substr(1,y.length-2)):Qx(y):y}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ui==1?Qx(h.substr(1,h.length-1)):h},set:function(y){y=y.toString(),h=this instanceof Ui==1?"/"+y:y}});var m=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(m)return m},set:function(y){this.V=y}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof Ui==0?pk(m,this.objId,this.scope):m},set:function(y){y=y.toString(),m=this instanceof Ui==0?y.substr(0,1)==="("?Qx(y.substr(1,y.length-2)):Qx(y):y}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ui==1?Qx(m.substr(1,m.length-1)):m},set:function(y){y=y.toString(),m=this instanceof Ui==1?"/"+y:y}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var x,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(y){y=!!y,g=y}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(x)return x},set:function(y){x=y}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,1)},set:function(y){y?this.Ff=vi(this.Ff,1):this.Ff=yi(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,2)},set:function(y){y?this.Ff=vi(this.Ff,2):this.Ff=yi(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,3)},set:function(y){y?this.Ff=vi(this.Ff,3):this.Ff=yi(this.Ff,3)}});var v=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(v!==null)return v},set:function(y){if([0,1,2].indexOf(y)===-1)throw new Error('Invalid value "'+y+'" for attribute Q supplied.');v=y}}),Object.defineProperty(this,"textAlign",{get:function(){var y;switch(v){case 0:default:y="left";break;case 1:y="center";break;case 2:y="right"}return y},configurable:!0,enumerable:!0,set:function(y){switch(y){case"right":case 2:v=2;break;case"center":case 1:v=1;break;default:v=0}}})};td(gf,Bf);var Bg=function(){gf.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Oae(t,this.objId,this.scope)},set:function(r){var n,s;s=[],typeof(n=r)=="string"&&(s=function(o,i,l){l||(l=1);for(var c,d=[];c=i.exec(o);)d.push(c[l]);return d}(n,/\((.*?)\)/g)),t=s}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,18)},set:function(r){r?this.Ff=vi(this.Ff,18):this.Ff=yi(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=vi(this.Ff,19):this.Ff=yi(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,20)},set:function(r){r?(this.Ff=vi(this.Ff,20),t.sort()):this.Ff=yi(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,22)},set:function(r){r?this.Ff=vi(this.Ff,22):this.Ff=yi(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,23)},set:function(r){r?this.Ff=vi(this.Ff,23):this.Ff=yi(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,27)},set:function(r){r?this.Ff=vi(this.Ff,27):this.Ff=yi(this.Ff,27)}}),this.hasAppearanceStream=!1};td(Bg,gf);var qg=function(){Bg.call(this),this.fontName="helvetica",this.combo=!1};td(qg,Bg);var zg=function(){qg.call(this),this.combo=!0};td(zg,qg);var ow=function(){zg.call(this),this.edit=!0};td(ow,zg);var Ui=function(){gf.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,15)},set:function(r){r?this.Ff=vi(this.Ff,15):this.Ff=yi(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,16)},set:function(r){r?this.Ff=vi(this.Ff,16):this.Ff=yi(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,17)},set:function(r){r?this.Ff=vi(this.Ff,17):this.Ff=yi(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,26)},set:function(r){r?this.Ff=vi(this.Ff,26):this.Ff=yi(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,s=[];for(n in s.push("<<"),t)s.push("/"+n+" ("+Ex(r(t[n]))+")");return s.push(">>"),s.join(`
`)}},set:function(r){ks(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};td(Ui,gf);var iw=function(){Ui.call(this),this.pushButton=!0};td(iw,Ui);var Ug=function(){Ui.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};td(Ug,Ui);var sC=function(){var e,t;gf.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(s){e=s}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(s){t=s}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(l){return l};this.scope&&(s=this.scope.internal.getEncryptor(this.objId));var o,i=[];for(o in i.push("<<"),n)i.push("/"+o+" ("+Ex(s(n[o]))+")");return i.push(">>"),i.join(`
`)},set:function(s){ks(s)==="object"&&(n=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(s){typeof s=="string"&&(n.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(s){r=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(s){r="/"+s}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=ya.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};td(sC,gf),Ug.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Ug.prototype.createOption=function(e){var t=new sC;return t.Parent=this,t.optionName=e,this.Kids.push(t),GQe.call(this.scope,t),t};var lw=function(){Ui.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=ya.CheckBox.createAppearanceStream()};td(lw,Ui);var cp=function(){gf.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,13)},set:function(t){t?this.Ff=vi(this.Ff,13):this.Ff=yi(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,21)},set:function(t){t?this.Ff=vi(this.Ff,21):this.Ff=yi(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,23)},set:function(t){t?this.Ff=vi(this.Ff,23):this.Ff=yi(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,24)},set:function(t){t?this.Ff=vi(this.Ff,24):this.Ff=yi(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,25)},set:function(t){t?this.Ff=vi(this.Ff,25):this.Ff=yi(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,26)},set:function(t){t?this.Ff=vi(this.Ff,26):this.Ff=yi(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};td(cp,gf);var cw=function(){cp.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!xi(this.Ff,14)},set:function(e){e?this.Ff=vi(this.Ff,14):this.Ff=yi(this.Ff,14)}}),this.password=!0};td(cw,cp);var ya={CheckBox:{createAppearanceStream:function(){return{N:{On:ya.CheckBox.YesNormal},D:{On:ya.CheckBox.YesPushDown,Off:ya.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=Sf(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,s=e.scope.__private__.encodeColorString(e.color),o=E3(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+cs(ya.internal.getWidth(e))+" "+cs(ya.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+cs(o.fontSize)+" Tf "+s),r.push("BT"),r.push(o.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=Sf(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),s=[],o=ya.internal.getHeight(e),i=ya.internal.getWidth(e),l=E3(e,e.caption);return s.push("1 g"),s.push("0 0 "+cs(i)+" "+cs(o)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+cs(i-1)+" "+cs(o-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+r+" "+cs(l.fontSize)+" Tf "+n),s.push(l.text),s.push("ET"),s.push("Q"),t.stream=s.join(`
`),t},OffPushDown:function(e){var t=Sf(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+cs(ya.internal.getWidth(e))+" "+cs(ya.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:ya.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=ya.RadioButton.Circle.YesNormal,t.D[e]=ya.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=Sf(e);t.scope=e.scope;var r=[],n=ya.internal.getWidth(e)<=ya.internal.getHeight(e)?ya.internal.getWidth(e)/4:ya.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=ya.internal.Bezier_C,o=Number((n*s).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+fh(ya.internal.getWidth(e)/2)+" "+fh(ya.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=Sf(e);t.scope=e.scope;var r=[],n=ya.internal.getWidth(e)<=ya.internal.getHeight(e)?ya.internal.getWidth(e)/4:ya.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),o=Number((s*ya.internal.Bezier_C).toFixed(5)),i=Number((n*ya.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+fh(ya.internal.getWidth(e)/2)+" "+fh(ya.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),r.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),r.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),r.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+fh(ya.internal.getWidth(e)/2)+" "+fh(ya.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),r.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),r.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),r.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=Sf(e);t.scope=e.scope;var r=[],n=ya.internal.getWidth(e)<=ya.internal.getHeight(e)?ya.internal.getWidth(e)/4:ya.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),o=Number((s*ya.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+fh(ya.internal.getWidth(e)/2)+" "+fh(ya.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),r.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),r.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),r.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:ya.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=ya.RadioButton.Cross.YesNormal,t.D[e]=ya.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=Sf(e);t.scope=e.scope;var r=[],n=ya.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+cs(ya.internal.getWidth(e)-2)+" "+cs(ya.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(cs(n.x1.x)+" "+cs(n.x1.y)+" m"),r.push(cs(n.x2.x)+" "+cs(n.x2.y)+" l"),r.push(cs(n.x4.x)+" "+cs(n.x4.y)+" m"),r.push(cs(n.x3.x)+" "+cs(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=Sf(e);t.scope=e.scope;var r=ya.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+cs(ya.internal.getWidth(e))+" "+cs(ya.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+cs(ya.internal.getWidth(e)-2)+" "+cs(ya.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(cs(r.x1.x)+" "+cs(r.x1.y)+" m"),n.push(cs(r.x2.x)+" "+cs(r.x2.y)+" l"),n.push(cs(r.x4.x)+" "+cs(r.x4.y)+" m"),n.push(cs(r.x3.x)+" "+cs(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=Sf(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+cs(ya.internal.getWidth(e))+" "+cs(ya.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};ya.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=ya.internal.getWidth(e),r=ya.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},ya.internal.getWidth=function(e){var t=0;return ks(e)==="object"&&(t=tU(e.Rect[2])),t},ya.internal.getHeight=function(e){var t=0;return ks(e)==="object"&&(t=tU(e.Rect[3])),t};var GQe=li.addField=function(e){if(HQe(this,e),!(e instanceof gf))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};li.AcroFormChoiceField=Bg,li.AcroFormListBox=qg,li.AcroFormComboBox=zg,li.AcroFormEditBox=ow,li.AcroFormButton=Ui,li.AcroFormPushButton=iw,li.AcroFormRadioButton=Ug,li.AcroFormCheckBox=lw,li.AcroFormTextField=cp,li.AcroFormPasswordField=cw,li.AcroFormAppearance=ya,li.AcroForm={ChoiceField:Bg,ListBox:qg,ComboBox:zg,EditBox:ow,Button:Ui,PushButton:iw,RadioButton:Ug,CheckBox:lw,TextField:cp,PasswordField:cw,Appearance:ya},Ca.AcroForm={ChoiceField:Bg,ListBox:qg,ComboBox:zg,EditBox:ow,Button:Ui,PushButton:iw,RadioButton:Ug,CheckBox:lw,TextField:cp,PasswordField:cw,Appearance:ya};var KQe=Ca.AcroForm;function Mae(e){return e.reduce(function(t,r,n){return t[r]=n,t},{})}(function(e){var t="addImage_";e.__addimage__={};var r="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},s=e.__addimage__.getImageFileTypeByImageData=function(O,I){var T,k,$,q,z,F=r;if((I=I||r)==="RGBA"||O.data!==void 0&&O.data instanceof Uint8ClampedArray&&"height"in O&&"width"in O)return"RGBA";if(C(O))for(z in n)for($=n[z],T=0;T<$.length;T+=1){for(q=!0,k=0;k<$[T].length;k+=1)if($[T][k]!==void 0&&$[T][k]!==O[k]){q=!1;break}if(q===!0){F=z;break}}else for(z in n)for($=n[z],T=0;T<$.length;T+=1){for(q=!0,k=0;k<$[T].length;k+=1)if($[T][k]!==void 0&&$[T][k]!==O.charCodeAt(k)){q=!1;break}if(q===!0){F=z;break}}return F===r&&I!==r&&(F=I),F},o=function O(I){for(var T=this.internal.write,k=this.internal.putStream,$=(0,this.internal.getFilters)();$.indexOf("FlateEncode")!==-1;)$.splice($.indexOf("FlateEncode"),1);I.objectId=this.internal.newObject();var q=[];if(q.push({key:"Type",value:"/XObject"}),q.push({key:"Subtype",value:"/Image"}),q.push({key:"Width",value:I.width}),q.push({key:"Height",value:I.height}),I.colorSpace===y.INDEXED?q.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(I.palette.length/3-1)+" "+("sMask"in I&&I.sMask!==void 0?I.objectId+2:I.objectId+1)+" 0 R]"}):(q.push({key:"ColorSpace",value:"/"+I.colorSpace}),I.colorSpace===y.DEVICE_CMYK&&q.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),q.push({key:"BitsPerComponent",value:I.bitsPerComponent}),"decodeParameters"in I&&I.decodeParameters!==void 0&&q.push({key:"DecodeParms",value:"<<"+I.decodeParameters+">>"}),"transparency"in I&&Array.isArray(I.transparency)&&I.transparency.length>0){for(var z="",F=0,V=I.transparency.length;F<V;F++)z+=I.transparency[F]+" "+I.transparency[F]+" ";q.push({key:"Mask",value:"["+z+"]"})}I.sMask!==void 0&&q.push({key:"SMask",value:I.objectId+1+" 0 R"});var ue=I.filter!==void 0?["/"+I.filter]:void 0;if(k({data:I.data,additionalKeyValues:q,alreadyAppliedFilters:ue,objectId:I.objectId}),T("endobj"),"sMask"in I&&I.sMask!==void 0){var _e,U=(_e=I.sMaskBitsPerComponent)!==null&&_e!==void 0?_e:I.bitsPerComponent,L={width:I.width,height:I.height,colorSpace:"DeviceGray",bitsPerComponent:U,data:I.sMask};"filter"in I&&(L.decodeParameters="/Predictor ".concat(I.predictor," /Colors 1 /BitsPerComponent ").concat(U," /Columns ").concat(I.width),L.filter=I.filter),O.call(this,L)}if(I.colorSpace===y.INDEXED){var G=this.internal.newObject();k({data:S(new Uint8Array(I.palette)),objectId:G}),T("endobj")}},i=function(){var O=this.internal.collections[t+"images"];for(var I in O)o.call(this,O[I])},l=function(){var O,I=this.internal.collections[t+"images"],T=this.internal.write;for(var k in I)T("/I"+(O=I[k]).index,O.objectId,"0","R")},c=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",i),this.internal.events.subscribe("putXobjectDict",l))},d=function(){var O=this.internal.collections[t+"images"];return c.call(this),O},u=function(){return Object.keys(this.internal.collections[t+"images"]).length},f=function(O){return typeof e["process"+O.toUpperCase()]=="function"},h=function(O){return ks(O)==="object"&&O.nodeType===1},m=function(O,I){if(O.nodeName==="IMG"&&O.hasAttribute("src")){var T=""+O.getAttribute("src");if(T.indexOf("data:image/")===0)return z_(unescape(T).split("base64,").pop());var k=e.loadFile(T,!0);if(k!==void 0)return k}if(O.nodeName==="CANVAS"){if(O.width===0||O.height===0)throw new Error("Given canvas must have data. Canvas width: "+O.width+", height: "+O.height);var $;switch(I){case"PNG":$="image/png";break;case"WEBP":$="image/webp";break;default:$="image/jpeg"}return z_(O.toDataURL($,1).split("base64,").pop())}},x=function(O){var I=this.internal.collections[t+"images"];if(I){for(var T in I)if(O===I[T].alias)return I[T]}},g=function(O,I,T){return O||I||(O=-96,I=-96),O<0&&(O=-1*T.width*72/O/this.internal.scaleFactor),I<0&&(I=-1*T.height*72/I/this.internal.scaleFactor),O===0&&(O=I*T.width/T.height),I===0&&(I=O*T.height/T.width),[O,I]},v=function(O,I,T,k,$,q){var z=g.call(this,T,k,$),F=this.internal.getCoordinateString,V=this.internal.getVerticalCoordinateString,ue=d.call(this);if(T=z[0],k=z[1],ue[$.index]=$,q){q*=Math.PI/180;var _e=Math.cos(q),U=Math.sin(q),L=function(de){return de.toFixed(4)},G=[L(_e),L(U),L(-1*U),L(_e),0,0,"cm"]}this.internal.write("q"),q?(this.internal.write([1,"0","0",1,F(O),V(I+k),"cm"].join(" ")),this.internal.write(G.join(" ")),this.internal.write([F(T),"0","0",F(k),"0","0","cm"].join(" "))):this.internal.write([F(T),"0","0",F(k),F(O),V(I+k),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+$.index+" Do"),this.internal.write("Q")},y=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},w=e.__addimage__.sHashCode=function(O){var I,T,k=0;if(typeof O=="string")for(T=O.length,I=0;I<T;I++)k=(k<<5)-k+O.charCodeAt(I),k|=0;else if(C(O))for(T=O.byteLength/2,I=0;I<T;I++)k=(k<<5)-k+O[I],k|=0;return k},j=e.__addimage__.validateStringAsBase64=function(O){(O=O||"").toString().trim();var I=!0;return O.length===0&&(I=!1),O.length%4!=0&&(I=!1),/^[A-Za-z0-9+/]+$/.test(O.substr(0,O.length-2))===!1&&(I=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(O.substr(-2))===!1&&(I=!1),I},_=e.__addimage__.extractImageFromDataUrl=function(O){if(O==null||!(O=O.trim()).startsWith("data:"))return null;var I=O.indexOf(",");return I<0?null:O.substring(0,I).trim().endsWith("base64")?O.substring(I+1):null};e.__addimage__.isArrayBuffer=function(O){return O instanceof ArrayBuffer};var C=e.__addimage__.isArrayBufferView=function(O){return O instanceof Int8Array||O instanceof Uint8Array||O instanceof Uint8ClampedArray||O instanceof Int16Array||O instanceof Uint16Array||O instanceof Int32Array||O instanceof Uint32Array||O instanceof Float32Array||O instanceof Float64Array},A=e.__addimage__.binaryStringToUint8Array=function(O){for(var I=O.length,T=new Uint8Array(I),k=0;k<I;k++)T[k]=O.charCodeAt(k);return T},S=e.__addimage__.arrayBufferToBinaryString=function(O){for(var I="",T=C(O)?O:new Uint8Array(O),k=0;k<T.length;k+=8192)I+=String.fromCharCode.apply(null,T.subarray(k,k+8192));return I};e.addImage=function(){var O,I,T,k,$,q,z,F,V;if(typeof arguments[1]=="number"?(I=r,T=arguments[1],k=arguments[2],$=arguments[3],q=arguments[4],z=arguments[5],F=arguments[6],V=arguments[7]):(I=arguments[1],T=arguments[2],k=arguments[3],$=arguments[4],q=arguments[5],z=arguments[6],F=arguments[7],V=arguments[8]),ks(O=arguments[0])==="object"&&!h(O)&&"imageData"in O){var ue=O;O=ue.imageData,I=ue.format||I||r,T=ue.x||T||0,k=ue.y||k||0,$=ue.w||ue.width||$,q=ue.h||ue.height||q,z=ue.alias||z,F=ue.compression||F,V=ue.rotation||ue.angle||V}var _e=this.internal.getFilters();if(F===void 0&&_e.indexOf("FlateEncode")!==-1&&(F="SLOW"),isNaN(T)||isNaN(k))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var U=P.call(this,O,I,z,F);return v.call(this,T,k,$,q,U,V),this};var P=function(O,I,T,k){var $,q,z;if(typeof O=="string"&&s(O)===r){O=unescape(O);var F=M(O,!1);(F!==""||(F=e.loadFile(O,!0))!==void 0)&&(O=F)}if(h(O)&&(O=m(O,I)),I=s(O,I),!f(I))throw new Error("addImage does not support files of type '"+I+"', please ensure that a plugin for '"+I+"' support is added.");if(((z=T)==null||z.length===0)&&(T=function(V){return typeof V=="string"||C(V)?w(V):C(V.data)?w(V.data):null}(O)),($=x.call(this,T))||(O instanceof Uint8Array||I==="RGBA"||(q=O,O=A(O)),$=this["process"+I.toUpperCase()](O,u.call(this),T,function(V){return V&&typeof V=="string"&&(V=V.toUpperCase()),V in e.image_compression?V:b.NONE}(k),q)),!$)throw new Error("An unknown error occurred whilst processing the image.");return $},M=e.__addimage__.convertBase64ToBinaryString=function(O,I){I=typeof I!="boolean"||I;var T,k="";if(typeof O=="string"){var $;T=($=_(O))!==null&&$!==void 0?$:O;try{k=z_(T)}catch(q){if(I)throw j(T)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+q.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return k};e.getImageProperties=function(O){var I,T,k="";if(h(O)&&(O=m(O)),typeof O=="string"&&s(O)===r&&((k=M(O,!1))===""&&(k=e.loadFile(O)||""),O=k),T=s(O),!f(T))throw new Error("addImage does not support files of type '"+T+"', please ensure that a plugin for '"+T+"' support is added.");if(O instanceof Uint8Array||(O=A(O)),!(I=this["process"+T.toUpperCase()](O)))throw new Error("An unknown error occurred whilst processing the image");return I.fileType=T,I}})(Ca.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};Ca.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var n,s,o,i=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(r.objId),d=r.pageContext.annotations,u=!1,f=0;f<d.length&&!u;f++)switch((n=d[f]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(u=!0);break;case"reference":case"text":case"freetext":u=!0}if(u!=0){this.internal.write("/Annots [");for(var h=0;h<d.length;h++){n=d[h];var m=this.internal.pdfEscape,x=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var g=this.internal.newAdditionalObject(),v=this.internal.newAdditionalObject(),y=this.internal.getEncryptor(g.objId),b=n.title||"Note";o="<</Type /Annot /Subtype /Text "+(s="/Rect ["+i(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+m(y(n.contents))+")",o+=" /Popup "+v.objId+" 0 R",o+=" /P "+c.objId+" 0 R",o+=" /T ("+m(y(b))+") >>",g.content=o;var w=g.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(s="/Rect ["+i(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+w,n.open&&(o+=" /Open true"),o+=" >>",v.content=o,this.internal.write(g.objId,"0 R",v.objId,"0 R");break;case"freetext":s="/Rect ["+i(n.bounds.x)+" "+l(n.bounds.y)+" "+i(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var j=n.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+s+"/Contents ("+m(x(n.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+j+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(n.options.name){var _=this.annotations._nameMap[n.options.name];n.options.pageNumber=_.page,n.options.top=_.y}else n.options.top||(n.options.top=0);if(s="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",o="",n.options.url)o="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /A <</S /URI /URI ("+m(x(n.options.url))+") >>";else if(n.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,o+=" /FitV "+n.options.left+"]";break;default:var C=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),o+=" /XYZ "+n.options.left+" "+C+" "+n.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},e.link=function(r,n,s,o,i){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(r),y:d(n),w:c(r+s),h:d(n+o)},options:i,type:"link"})},e.textWithLink=function(r,n,s,o){var i,l,c=this.getTextWidth(r),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){l=o.maxWidth;var u=this.splitTextToSize(r,l).length;i=Math.ceil(d*u)}else l=c,i=d;return this.text(r,n,s,o),s+=.2*d,o.align==="center"&&(n-=c/2),o.align==="right"&&(n-=c),this.link(n,s-d,l,i,o),c},e.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(Ca.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];e.__arabicParser__={};var o=e.__arabicParser__.isInArabicSubstitutionA=function(g){return t[g.charCodeAt(0)]!==void 0},i=e.__arabicParser__.isArabicLetter=function(g){return typeof g=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(g)},l=e.__arabicParser__.isArabicEndLetter=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(g){return i(g)&&s.indexOf(g.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=1};var d=e.__arabicParser__.arabicLetterHasFinalForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=3};var u=e.__arabicParser__.arabicLetterHasMedialForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length==4},f=e.__arabicParser__.resolveLigatures=function(g){var v=0,y=r,b="",w=0;for(v=0;v<g.length;v+=1)y[g.charCodeAt(v)]!==void 0?(w++,typeof(y=y[g.charCodeAt(v)])=="number"&&(b+=String.fromCharCode(y),y=r,w=0),v===g.length-1&&(y=r,b+=g.charAt(v-(w-1)),v-=w-1,w=0)):(y=r,b+=g.charAt(v-w),v-=w,w=0);return b};e.__arabicParser__.isArabicDiacritic=function(g){return g!==void 0&&n[g.charCodeAt(0)]!==void 0};var h=e.__arabicParser__.getCorrectForm=function(g,v,y){return i(g)?o(g)===!1?-1:!d(g)||!i(v)&&!i(y)||!i(y)&&l(v)||l(g)&&!i(v)||l(g)&&c(v)||l(g)&&l(v)?0:u(g)&&i(v)&&!l(v)&&i(y)&&d(y)?3:l(g)||!i(y)?1:2:-1},m=function(g){var v=0,y=0,b=0,w="",j="",_="",C=(g=g||"").split("\\s+"),A=[];for(v=0;v<C.length;v+=1){for(A.push(""),y=0;y<C[v].length;y+=1)w=C[v][y],j=C[v][y-1],_=C[v][y+1],i(w)?(b=h(w,j,_),A[v]+=b!==-1?String.fromCharCode(t[w.charCodeAt(0)][b]):w):A[v]+=w;A[v]=f(A[v])}return A.join(" ")},x=e.__arabicParser__.processArabic=e.processArabic=function(){var g,v=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,y=[];if(Array.isArray(v)){var b=0;for(y=[],b=0;b<v.length;b+=1)Array.isArray(v[b])?y.push([m(v[b][0]),v[b][1],v[b][2]]):y.push([m(v[b])]);g=y}else g=m(v);return typeof arguments[0]=="string"?g:(arguments[0].text=g,arguments[0])};e.events.push(["preProcessText",x])}(Ca.API),Ca.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform",e.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var s=300;Object.defineProperty(this,"height",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=s+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(l){o=l}});var i={};Object.defineProperty(this,"style",{get:function(){return i},set:function(l){i=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,n){var s;if((r=r||"2d")!=="2d")return null;for(s in n)this.pdf.context2d.hasOwnProperty(s)&&(this.pdf.context2d[s]=n[s]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Ca.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(g){c=g}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(g){d=g}});var u=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return u},set:function(g){u=g}});var f=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return f},set:function(g){f=g}});var h=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return h},set:function(g){h=g}});var m=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return m},set:function(g){m=g}});var x=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return x},set:function(g){x=g}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(c){return n.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},e.getTextDimensions=function(c,d){n.call(this);var u=(d=d||{}).fontSize||this.getFontSize(),f=d.font||this.getFont(),h=d.scaleFactor||this.internal.scaleFactor,m=0,x=0,g=0,v=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var y=d.maxWidth;y>0?typeof c=="string"?c=this.splitTextToSize(c,y):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(w,j){return w.concat(v.splitTextToSize(j,y))},[])):c=Array.isArray(c)?c:[c];for(var b=0;b<c.length;b++)m<(g=this.getStringUnitWidth(c[b],{font:f})*u)&&(m=g);return m!==0&&(x=c.length),{w:m/=h,h:Math.max((x*u*this.getLineHeightFactor()-u*(this.getLineHeightFactor()-1))/h,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var i=e.cell=function(){var c;c=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var d=this.internal.__cell__.lastCell,u=this.internal.__cell__.padding,f=this.internal.__cell__.margins||t,h=this.internal.__cell__.tableHeaderRow,m=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===c.lineNumber?(c.x=(d.x||0)+(d.width||0),c.y=d.y||0):d.y+d.height+c.height+f.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=f.top,m&&h&&(this.printHeaderRow(c.lineNumber,!0),c.y+=h[0].height)):c.y=d.y+d.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,r===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-u,c.y+u,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+u,{align:"center",baseline:"top",maxWidth:c.width-u-u}):this.text(c.text,c.x+u,c.y+u,{align:"left",baseline:"top",maxWidth:c.width-u-u})),this.internal.__cell__.lastCell=c,this};e.table=function(c,d,u,f,h){if(n.call(this),!u)throw new Error("No data for PDF table.");var m,x,g,v,y=[],b=[],w=[],j={},_={},C=[],A=[],S=(h=h||{}).autoSize||!1,P=h.printHeaders!==!1,M=h.css&&h.css["font-size"]!==void 0?16*h.css["font-size"]:h.fontSize||12,O=h.margins||Object.assign({width:this.getPageWidth()},t),I=typeof h.padding=="number"?h.padding:3,T=h.headerBackgroundColor||"#c8c8c8",k=h.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=P,this.internal.__cell__.margins=O,this.internal.__cell__.table_font_size=M,this.internal.__cell__.padding=I,this.internal.__cell__.headerBackgroundColor=T,this.internal.__cell__.headerTextColor=k,this.setFontSize(M),f==null)b=y=Object.keys(u[0]),w=y.map(function(){return"left"});else if(Array.isArray(f)&&ks(f[0])==="object")for(y=f.map(function(ue){return ue.name}),b=f.map(function(ue){return ue.prompt||ue.name||""}),w=f.map(function(ue){return ue.align||"left"}),m=0;m<f.length;m+=1)_[f[m].name]=.7499990551181103*f[m].width;else Array.isArray(f)&&typeof f[0]=="string"&&(b=y=f,w=y.map(function(){return"left"}));if(S||Array.isArray(f)&&typeof f[0]=="string")for(m=0;m<y.length;m+=1){for(j[v=y[m]]=u.map(function(ue){return ue[v]}),this.setFont(void 0,"bold"),C.push(this.getTextDimensions(b[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),x=j[v],this.setFont(void 0,"normal"),g=0;g<x.length;g+=1)C.push(this.getTextDimensions(x[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);_[v]=Math.max.apply(null,C)+I+I,C=[]}if(P){var $={};for(m=0;m<y.length;m+=1)$[y[m]]={},$[y[m]].text=b[m],$[y[m]].align=w[m];var q=l.call(this,$,_);A=y.map(function(ue){return new o(c,d,_[ue],q,$[ue].text,void 0,$[ue].align)}),this.setTableHeaderRow(A),this.printHeaderRow(1,!1)}var z=f.reduce(function(ue,_e){return ue[_e.name]=_e.align,ue},{});for(m=0;m<u.length;m+=1){"rowStart"in h&&h.rowStart instanceof Function&&h.rowStart({row:m,data:u[m]},this);var F=l.call(this,u[m],_);for(g=0;g<y.length;g+=1){var V=u[m][y[g]];"cellStart"in h&&h.cellStart instanceof Function&&h.cellStart({row:m,col:g,data:V},this),i.call(this,new o(c,d,_[y[g]],F,V,m+2,z[y[g]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=d,this};var l=function(c,d){var u=this.internal.__cell__.padding,f=this.internal.__cell__.table_font_size,h=this.internal.scaleFactor;return Object.keys(c).map(function(m){var x=c[m];return this.splitTextToSize(x.hasOwnProperty("text")?x.text:x,d[m]-u-u)},this).map(function(m){return this.getLineHeightFactor()*m.length*f/h+u+u},this).reduce(function(m,x){return Math.max(m,x)},0)};e.setTableHeaderRow=function(c){n.call(this),this.internal.__cell__.tableHeaderRow=c},e.printHeaderRow=function(c,d){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var u;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var f=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(f[0],f[1],f[2],f[3],void 0,-1)}this.setFont(void 0,"bold");for(var h=[],m=0;m<this.internal.__cell__.tableHeaderRow.length;m+=1){u=this.internal.__cell__.tableHeaderRow[m].clone(),d&&(u.y=this.internal.__cell__.margins.top||0,h.push(u)),u.lineNumber=c;var x=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),i.call(this,u),this.setTextColor(x)}h.length>0&&this.setTableHeaderRow(h),this.setFont(void 0,"normal"),r=!1}}(Ca.API);var Rae={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Fae=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],k3=Mae(Fae),Lae=[100,200,300,400,500,600,700,800,900],XQe=Mae(Lae);function gk(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(o){return Rae[o=o||"normal"]?o:"normal"}(e.style),n=function(o){return o?typeof o=="number"?o>=100&&o<=900&&o%100==0?o:400:/^\d00$/.test(o)?parseInt(o):o==="bold"?700:400:400}(e.weight),s=function(o){return typeof k3[o=o||"normal"]=="number"?o:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:s,src:e.src||[],ref:e.ref||{name:t,style:[s,r,n].join(" ")}}}function rU(e,t,r,n){var s;for(s=r;s>=0&&s<t.length;s+=n)if(e[t[s]])return e[t[s]];for(s=r;s>=0&&s<t.length;s-=n)if(e[t[s]])return e[t[s]]}var YQe={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},nU={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function aU(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function sU(e){return e.trimLeft()}function JQe(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function QQe(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var Z2,oU,iU,Zx,e_,lU,cU,dU,xk=["times"];function uU(e,t,r,n,s){var o=4,i=mU;switch(s){case Ca.API.image_compression.FAST:o=1,i=fU;break;case Ca.API.image_compression.MEDIUM:o=6,i=hU;break;case Ca.API.image_compression.SLOW:o=9,i=pU}e=function(c,d,u,f){for(var h,m=c.length/d,x=new Uint8Array(c.length+m),g=[ZQe,fU,mU,hU,pU],v=0;v<m;v+=1){var y=v*d,b=c.subarray(y,y+d);if(f)x.set(f(b,u,h),y+v);else{for(var w=g.length,j=[],_=0;_<w;_+=1)j[_]=g[_](b,u,h);var C=tZe(j.concat());x.set(j[C],y+v)}h=b}return x}(e,t,Math.ceil(r*n/8),i);var l=x3(e,{level:o});return Ca.API.__addimage__.arrayBufferToBinaryString(l)}function ZQe(e){var t=Array.apply([],e);return t.unshift(0),t}function fU(e,t){var r=e.length,n=[];n[0]=1;for(var s=0;s<r;s+=1){var o=e[s-t]||0;n[s+1]=e[s]-o+256&255}return n}function mU(e,t,r){var n=e.length,s=[];s[0]=2;for(var o=0;o<n;o+=1){var i=r&&r[o]||0;s[o+1]=e[o]-i+256&255}return s}function hU(e,t,r){var n=e.length,s=[];s[0]=3;for(var o=0;o<n;o+=1){var i=e[o-t]||0,l=r&&r[o]||0;s[o+1]=e[o]+256-(i+l>>>1)&255}return s}function pU(e,t,r){var n=e.length,s=[];s[0]=4;for(var o=0;o<n;o+=1){var i=eZe(e[o-t]||0,r&&r[o]||0,r&&r[o-t]||0);s[o+1]=e[o]-i+256&255}return s}function eZe(e,t,r){if(e===t&&t===r)return e;var n=Math.abs(t-r),s=Math.abs(e-r),o=Math.abs(e+t-r-r);return n<=s&&n<=o?e:s<=o?t:r}function tZe(e){var t=e.map(function(r){return r.reduce(function(n,s){return n+Math.abs(s)},0)});return t.indexOf(Math.min.apply(null,t))}function vk(e,t,r){var n=t*r,s=Math.floor(n/8),o=16-(n-8*s+r),i=(1<<r)-1;return $ae(e,s)>>o&i}function gU(e,t,r,n){var s=r*n,o=Math.floor(s/8),i=16-(s-8*o+n),l=(1<<n)-1,c=(t&l)<<i;(function(d,u,f){if(u+1<d.byteLength)d.setUint16(u,f,!1);else{var h=f>>8&255;d.setUint8(u,h)}})(e,o,$ae(e,o)&~(l<<i)&65535|c)}function $ae(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function rZe(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,s=e[t++],o=s>>7,i=1<<1+(7&s);e[t++],e[t++];var l=null,c=null;o&&(l=t,c=i,t+=3*i);var d=!0,u=[],f=0,h=null,m=0,x=null;for(this.width=r,this.height=n;d&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,x=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var g=e[t++];f=e[t++]|e[t++]<<8,h=e[t++],1&g||(h=null),m=g>>2&7,t++;break;case 254:for(;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var v=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,j=e[t++],_=j>>6&1,C=1<<1+(7&j),A=l,S=c,P=!1;j>>7&&(P=!0,A=t,S=C,t+=3*C);var M=t;for(t++;;){var O;if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}u.push({x:v,y,width:b,height:w,has_local_palette:P,palette_offset:A,palette_size:S,data_offset:M,data_length:t-M,transparent_index:h,interlaced:!!_,delay:f,disposal:m});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return x},this.frameInfo=function(I){if(I<0||I>=u.length)throw new Error("Frame index out of range.");return u[I]},this.decodeAndBlitFrameBGRA=function(I,T){var k=this.frameInfo(I),$=k.width*k.height,q=new Uint8Array($);xU(e,k.data_offset,q,$);var z=k.palette_offset,F=k.transparent_index;F===null&&(F=256);var V=k.width,ue=r-V,_e=V,U=4*(k.y*r+k.x),L=4*((k.y+k.height)*r+k.x),G=U,de=4*ue;k.interlaced===!0&&(de+=4*r*7);for(var X=8,W=0,Y=q.length;W<Y;++W){var me=q[W];if(_e===0&&(_e=V,(G+=de)>=L&&(de=4*ue+4*r*(X-1),G=U+(V+ue)*(X<<1),X>>=1)),me===F)G+=4;else{var ee=e[z+3*me],ae=e[z+3*me+1],le=e[z+3*me+2];T[G++]=le,T[G++]=ae,T[G++]=ee,T[G++]=255}--_e}},this.decodeAndBlitFrameRGBA=function(I,T){var k=this.frameInfo(I),$=k.width*k.height,q=new Uint8Array($);xU(e,k.data_offset,q,$);var z=k.palette_offset,F=k.transparent_index;F===null&&(F=256);var V=k.width,ue=r-V,_e=V,U=4*(k.y*r+k.x),L=4*((k.y+k.height)*r+k.x),G=U,de=4*ue;k.interlaced===!0&&(de+=4*r*7);for(var X=8,W=0,Y=q.length;W<Y;++W){var me=q[W];if(_e===0&&(_e=V,(G+=de)>=L&&(de=4*ue+4*r*(X-1),G=U+(V+ue)*(X<<1),X>>=1)),me===F)G+=4;else{var ee=e[z+3*me],ae=e[z+3*me+1],le=e[z+3*me+2];T[G++]=ee,T[G++]=ae,T[G++]=le,T[G++]=255}--_e}}}function xU(e,t,r,n){for(var s=e[t++],o=1<<s,i=o+1,l=i+1,c=s+1,d=(1<<c)-1,u=0,f=0,h=0,m=e[t++],x=new Int32Array(4096),g=null;;){for(;u<16&&m!==0;)f|=e[t++]<<u,u+=8,m===1?m=e[t++]:--m;if(u<c)break;var v=f&d;if(f>>=c,u-=c,v!==o){if(v===i)break;for(var y=v<l?v:g,b=0,w=y;w>o;)w=x[w]>>8,++b;var j=w;if(h+b+(y!==v?1:0)>n)return void wo.log("Warning, gif stream longer than expected.");r[h++]=j;var _=h+=b;for(y!==v&&(r[h++]=j),w=y;b--;)w=x[w],r[--_]=255&w,w>>=8;g!==null&&l<4096&&(x[l++]=g<<8|j,l>=d+1&&c<12&&(++c,d=d<<1|1)),g=v}else l=i+1,d=(1<<(c=s+1))-1,g=null}return h!==n&&wo.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function yk(e){var t,r,n,s,o,i=Math.floor,l=new Array(64),c=new Array(64),d=new Array(64),u=new Array(64),f=new Array(65535),h=new Array(65535),m=new Array(64),x=new Array(64),g=[],v=0,y=7,b=new Array(64),w=new Array(64),j=new Array(64),_=new Array(256),C=new Array(2048),A=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],P=[0,1,2,3,4,5,6,7,8,9,10,11],M=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],O=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],k=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],$=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function q(U,L){for(var G=0,de=0,X=new Array,W=1;W<=16;W++){for(var Y=1;Y<=U[W];Y++)X[L[de]]=[],X[L[de]][0]=G,X[L[de]][1]=W,de++,G++;G*=2}return X}function z(U){for(var L=U[0],G=U[1]-1;G>=0;)L&1<<G&&(v|=1<<y),G--,--y<0&&(v==255?(F(255),F(0)):F(v),y=7,v=0)}function F(U){g.push(U)}function V(U){F(U>>8&255),F(255&U)}function ue(U,L,G,de,X){for(var W,Y=X[0],me=X[240],ee=function(St,ft){var _t,gr,be,Nt,Wt,_r,yr,ve,at,qt,$t=0;for(at=0;at<8;++at){_t=St[$t],gr=St[$t+1],be=St[$t+2],Nt=St[$t+3],Wt=St[$t+4],_r=St[$t+5],yr=St[$t+6];var De=_t+(ve=St[$t+7]),wt=_t-ve,Rt=gr+yr,Rr=gr-yr,Me=be+_r,tt=be-_r,ut=Nt+Wt,sr=Nt-Wt,Sr=De+ut,xr=De-ut,Wr=Rt+Me,qr=Rt-Me;St[$t]=Sr+Wr,St[$t+4]=Sr-Wr;var Tr=.707106781*(qr+xr);St[$t+2]=xr+Tr,St[$t+6]=xr-Tr;var sn=.382683433*((Sr=sr+tt)-(qr=Rr+wt)),Cn=.5411961*Sr+sn,ze=1.306562965*qr+sn,Fe=.707106781*(Wr=tt+Rr),Le=wt+Fe,Ze=wt-Fe;St[$t+5]=Ze+Cn,St[$t+3]=Ze-Cn,St[$t+1]=Le+ze,St[$t+7]=Le-ze,$t+=8}for($t=0,at=0;at<8;++at){_t=St[$t],gr=St[$t+8],be=St[$t+16],Nt=St[$t+24],Wt=St[$t+32],_r=St[$t+40],yr=St[$t+48];var Ot=_t+(ve=St[$t+56]),mt=_t-ve,Qt=gr+yr,bt=gr-yr,zt=be+_r,ne=be-_r,He=Nt+Wt,Gt=Nt-Wt,Ht=Ot+He,Fr=Ot-He,cr=Qt+zt,nn=Qt-zt;St[$t]=Ht+cr,St[$t+32]=Ht-cr;var Tn=.707106781*(nn+Fr);St[$t+16]=Fr+Tn,St[$t+48]=Fr-Tn;var Gn=.382683433*((Ht=Gt+ne)-(nn=bt+mt)),ta=.5411961*Ht+Gn,Aa=1.306562965*nn+Gn,ke=.707106781*(cr=ne+bt),Ae=mt+ke,et=mt-ke;St[$t+40]=et+ta,St[$t+24]=et-ta,St[$t+8]=Ae+Aa,St[$t+56]=Ae-Aa,$t++}for(at=0;at<64;++at)qt=St[at]*ft[at],m[at]=qt>0?qt+.5|0:qt-.5|0;return m}(U,L),ae=0;ae<64;++ae)x[A[ae]]=ee[ae];var le=x[0]-G;G=x[0],le==0?z(de[0]):(z(de[h[W=32767+le]]),z(f[W]));for(var Te=63;Te>0&&x[Te]==0;)Te--;if(Te==0)return z(Y),G;for(var te,ie=1;ie<=Te;){for(var xt=ie;x[ie]==0&&ie<=Te;)++ie;var vt=ie-xt;if(vt>=16){te=vt>>4;for(var dt=1;dt<=te;++dt)z(me);vt&=15}W=32767+x[ie],z(X[(vt<<4)+h[W]]),z(f[W]),ie++}return Te!=63&&z(Y),G}function _e(U){U=Math.min(Math.max(U,1),100),o!=U&&(function(L){for(var G=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],de=0;de<64;de++){var X=i((G[de]*L+50)/100);X=Math.min(Math.max(X,1),255),l[A[de]]=X}for(var W=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Y=0;Y<64;Y++){var me=i((W[Y]*L+50)/100);me=Math.min(Math.max(me,1),255),c[A[Y]]=me}for(var ee=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ae=0,le=0;le<8;le++)for(var Te=0;Te<8;Te++)d[ae]=1/(l[A[ae]]*ee[le]*ee[Te]*8),u[ae]=1/(c[A[ae]]*ee[le]*ee[Te]*8),ae++}(U<50?Math.floor(5e3/U):Math.floor(200-2*U)),o=U)}this.encode=function(U,L){L&&_e(L),g=new Array,v=0,y=7,V(65496),V(65504),V(16),F(74),F(70),F(73),F(70),F(0),F(1),F(1),F(0),V(1),V(1),F(0),F(0),function(){V(65499),V(132),F(0);for(var gr=0;gr<64;gr++)F(l[gr]);F(1);for(var be=0;be<64;be++)F(c[be])}(),function(gr,be){V(65472),V(17),F(8),V(be),V(gr),F(3),F(1),F(17),F(0),F(2),F(17),F(1),F(3),F(17),F(1)}(U.width,U.height),function(){V(65476),V(418),F(0);for(var gr=0;gr<16;gr++)F(S[gr+1]);for(var be=0;be<=11;be++)F(P[be]);F(16);for(var Nt=0;Nt<16;Nt++)F(M[Nt+1]);for(var Wt=0;Wt<=161;Wt++)F(O[Wt]);F(1);for(var _r=0;_r<16;_r++)F(I[_r+1]);for(var yr=0;yr<=11;yr++)F(T[yr]);F(17);for(var ve=0;ve<16;ve++)F(k[ve+1]);for(var at=0;at<=161;at++)F($[at])}(),V(65498),V(12),F(3),F(1),F(0),F(2),F(17),F(3),F(17),F(0),F(63),F(0);var G=0,de=0,X=0;v=0,y=7,this.encode.displayName="_encode_";for(var W,Y,me,ee,ae,le,Te,te,ie,xt=U.data,vt=U.width,dt=U.height,St=4*vt,ft=0;ft<dt;){for(W=0;W<St;){for(ae=St*ft+W,Te=-1,te=0,ie=0;ie<64;ie++)le=ae+(te=ie>>3)*St+(Te=4*(7&ie)),ft+te>=dt&&(le-=St*(ft+1+te-dt)),W+Te>=St&&(le-=W+Te-St+4),Y=xt[le++],me=xt[le++],ee=xt[le++],b[ie]=(C[Y]+C[me+256|0]+C[ee+512|0]>>16)-128,w[ie]=(C[Y+768|0]+C[me+1024|0]+C[ee+1280|0]>>16)-128,j[ie]=(C[Y+1280|0]+C[me+1536|0]+C[ee+1792|0]>>16)-128;G=ue(b,d,G,t,n),de=ue(w,u,de,r,s),X=ue(j,u,X,r,s),W+=32}ft+=8}if(y>=0){var _t=[];_t[1]=y+1,_t[0]=(1<<y+1)-1,z(_t)}return V(65497),new Uint8Array(g)},e=e||50,function(){for(var U=String.fromCharCode,L=0;L<256;L++)_[L]=U(L)}(),t=q(S,P),r=q(I,T),n=q(M,O),s=q(k,$),function(){for(var U=1,L=2,G=1;G<=15;G++){for(var de=U;de<L;de++)h[32767+de]=G,f[32767+de]=[],f[32767+de][1]=G,f[32767+de][0]=de;for(var X=-(L-1);X<=-U;X++)h[32767+X]=G,f[32767+X]=[],f[32767+X][1]=G,f[32767+X][0]=L-1+X;U<<=1,L<<=1}}(),function(){for(var U=0;U<256;U++)C[U]=19595*U,C[U+256|0]=38470*U,C[U+512|0]=7471*U+32768,C[U+768|0]=-11059*U,C[U+1024|0]=-21709*U,C[U+1280|0]=32768*U+8421375,C[U+1536|0]=-27439*U,C[U+1792|0]=-5329*U}(),_e(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function $u(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function vU(e){function t(P){if(!P)throw Error("assert :P")}function r(P,M,O){for(var I=0;4>I;I++)if(P[M+I]!=O.charCodeAt(I))return!0;return!1}function n(P,M,O,I,T){for(var k=0;k<T;k++)P[M+k]=O[I+k]}function s(P,M,O,I){for(var T=0;T<I;T++)P[M+T]=O}function o(P){return new Int32Array(P)}function i(P,M){for(var O=[],I=0;I<P;I++)O.push(new M);return O}function l(P,M){var O=[];return function I(T,k,$){for(var q=$[k],z=0;z<q&&(T.push($.length>k+1?[]:new M),!($.length<k+1));z++)I(T[z],k+1,$)}(O,0,P),O}var c=function(){var P=this;function M(N,E){for(var B=1<<E-1>>>0;N&B;)B>>>=1;return B?(N&B-1)+B:N}function O(N,E,B,H,ce){t(!(H%B));do N[E+(H-=B)]=ce;while(0<H)}function I(N,E,B,H,ce){if(t(2328>=ce),512>=ce)var ye=o(512);else if((ye=o(ce))==null)return 0;return function(pe,Ne,Ie,qe,kt,Kt){var Be,It,rr=Ne,$r=1<<Ie,ur=o(16),Gr=o(16);for(t(kt!=0),t(qe!=null),t(pe!=null),t(0<Ie),It=0;It<kt;++It){if(15<qe[It])return 0;++ur[qe[It]]}if(ur[0]==kt)return 0;for(Gr[1]=0,Be=1;15>Be;++Be){if(ur[Be]>1<<Be)return 0;Gr[Be+1]=Gr[Be]+ur[Be]}for(It=0;It<kt;++It)Be=qe[It],0<qe[It]&&(Kt[Gr[Be]++]=It);if(Gr[15]==1)return(qe=new T).g=0,qe.value=Kt[0],O(pe,rr,1,$r,qe),$r;var Zr,En=-1,bn=$r-1,Ea=0,va=1,gs=1,Na=1<<Ie;for(It=0,Be=1,kt=2;Be<=Ie;++Be,kt<<=1){if(va+=gs<<=1,0>(gs-=ur[Be]))return 0;for(;0<ur[Be];--ur[Be])(qe=new T).g=Be,qe.value=Kt[It++],O(pe,rr+Ea,kt,Na,qe),Ea=M(Ea,Be)}for(Be=Ie+1,kt=2;15>=Be;++Be,kt<<=1){if(va+=gs<<=1,0>(gs-=ur[Be]))return 0;for(;0<ur[Be];--ur[Be]){if(qe=new T,(Ea&bn)!=En){for(rr+=Na,Zr=1<<(En=Be)-Ie;15>En&&!(0>=(Zr-=ur[En]));)++En,Zr<<=1;$r+=Na=1<<(Zr=En-Ie),pe[Ne+(En=Ea&bn)].g=Zr+Ie,pe[Ne+En].value=rr-Ne-En}qe.g=Be-Ie,qe.value=Kt[It++],O(pe,rr+(Ea>>Ie),kt,Na,qe),Ea=M(Ea,Be)}}return va!=2*Gr[15]-1?0:$r}(N,E,B,H,ce,ye)}function T(){this.value=this.g=0}function k(){this.value=this.g=0}function $(){this.G=i(5,T),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=i(Ir,k)}function q(N,E,B,H){t(N!=null),t(E!=null),t(2147483648>H),N.Ca=254,N.I=0,N.b=-8,N.Ka=0,N.oa=E,N.pa=B,N.Jd=E,N.Yc=B+H,N.Zc=4<=H?B+H-4+1:B,Y(N)}function z(N,E){for(var B=0;0<E--;)B|=ee(N,128)<<E;return B}function F(N,E){var B=z(N,E);return me(N)?-B:B}function V(N,E,B,H){var ce,ye=0;for(t(N!=null),t(E!=null),t(4294967288>H),N.Sb=H,N.Ra=0,N.u=0,N.h=0,4<H&&(H=4),ce=0;ce<H;++ce)ye+=E[B+ce]<<8*ce;N.Ra=ye,N.bb=H,N.oa=E,N.pa=B}function ue(N){for(;8<=N.u&&N.bb<N.Sb;)N.Ra>>>=8,N.Ra+=N.oa[N.pa+N.bb]<<Ge-8>>>0,++N.bb,N.u-=8;de(N)&&(N.h=1,N.u=0)}function _e(N,E){if(t(0<=E),!N.h&&E<=we){var B=G(N)&re[E];return N.u+=E,ue(N),B}return N.h=1,N.u=0}function U(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function L(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function G(N){return N.Ra>>>(N.u&Ge-1)>>>0}function de(N){return t(N.bb<=N.Sb),N.h||N.bb==N.Sb&&N.u>Ge}function X(N,E){N.u=E,N.h=de(N)}function W(N){N.u>=ge&&(t(N.u>=ge),ue(N))}function Y(N){t(N!=null&&N.oa!=null),N.pa<N.Zc?(N.I=(N.oa[N.pa++]|N.I<<8)>>>0,N.b+=8):(t(N!=null&&N.oa!=null),N.pa<N.Yc?(N.b+=8,N.I=N.oa[N.pa++]|N.I<<8):N.Ka?N.b=0:(N.I<<=8,N.b+=8,N.Ka=1))}function me(N){return z(N,1)}function ee(N,E){var B=N.Ca;0>N.b&&Y(N);var H=N.b,ce=B*E>>>8,ye=(N.I>>>H>ce)+0;for(ye?(B-=ce,N.I-=ce+1<<H>>>0):B=ce+1,H=B,ce=0;256<=H;)ce+=8,H>>=8;return H=7^ce+nt[H],N.b-=H,N.Ca=(B<<H)-1,ye}function ae(N,E,B){N[E+0]=B>>24&255,N[E+1]=B>>16&255,N[E+2]=B>>8&255,N[E+3]=255&B}function le(N,E){return N[E+0]|N[E+1]<<8}function Te(N,E){return le(N,E)|N[E+2]<<16}function te(N,E){return le(N,E)|le(N,E+2)<<16}function ie(N,E){var B=1<<E;return t(N!=null),t(0<E),N.X=o(B),N.X==null?0:(N.Mb=32-E,N.Xa=E,1)}function xt(N,E){t(N!=null),t(E!=null),t(N.Xa==E.Xa),n(E.X,0,N.X,0,1<<E.Xa)}function vt(){this.X=[],this.Xa=this.Mb=0}function dt(N,E,B,H){t(B!=null),t(H!=null);var ce=B[0],ye=H[0];return ce==0&&(ce=(N*ye+E/2)/E),ye==0&&(ye=(E*ce+N/2)/N),0>=ce||0>=ye?0:(B[0]=ce,H[0]=ye,1)}function St(N,E){return N+(1<<E)-1>>>E}function ft(N,E){return((4278255360&N)+(4278255360&E)>>>0&4278255360)+((16711935&N)+(16711935&E)>>>0&16711935)>>>0}function _t(N,E){P[E]=function(B,H,ce,ye,pe,Ne,Ie){var qe;for(qe=0;qe<pe;++qe){var kt=P[N](Ne[Ie+qe-1],ce,ye+qe);Ne[Ie+qe]=ft(B[H+qe],kt)}}}function gr(){this.ud=this.hd=this.jd=0}function be(N,E){return((4278124286&(N^E))>>>1)+(N&E)>>>0}function Nt(N){return 0<=N&&256>N?N:0>N?0:255<N?255:void 0}function Wt(N,E){return Nt(N+(N-E+.5>>1))}function _r(N,E,B){return Math.abs(E-B)-Math.abs(N-B)}function yr(N,E,B,H,ce,ye,pe){for(H=ye[pe-1],B=0;B<ce;++B)ye[pe+B]=H=ft(N[E+B],H)}function ve(N,E,B,H,ce){var ye;for(ye=0;ye<B;++ye){var pe=N[E+ye],Ne=pe>>8&255,Ie=16711935&(Ie=(Ie=16711935&pe)+((Ne<<16)+Ne));H[ce+ye]=(4278255360&pe)+Ie>>>0}}function at(N,E){E.jd=255&N,E.hd=N>>8&255,E.ud=N>>16&255}function qt(N,E,B,H,ce,ye){var pe;for(pe=0;pe<H;++pe){var Ne=E[B+pe],Ie=Ne>>>8,qe=Ne,kt=255&(kt=(kt=Ne>>>16)+((N.jd<<24>>24)*(Ie<<24>>24)>>>5));qe=255&(qe=(qe+=(N.hd<<24>>24)*(Ie<<24>>24)>>>5)+((N.ud<<24>>24)*(kt<<24>>24)>>>5)),ce[ye+pe]=(4278255360&Ne)+(kt<<16)+qe}}function $t(N,E,B,H,ce){P[E]=function(ye,pe,Ne,Ie,qe,kt,Kt,Be,It){for(Ie=Kt;Ie<Be;++Ie)for(Kt=0;Kt<It;++Kt)qe[kt++]=ce(Ne[H(ye[pe++])])},P[N]=function(ye,pe,Ne,Ie,qe,kt,Kt){var Be=8>>ye.b,It=ye.Ea,rr=ye.K[0],$r=ye.w;if(8>Be)for(ye=(1<<ye.b)-1,$r=(1<<Be)-1;pe<Ne;++pe){var ur,Gr=0;for(ur=0;ur<It;++ur)ur&ye||(Gr=H(Ie[qe++])),kt[Kt++]=ce(rr[Gr&$r]),Gr>>=Be}else P["VP8LMapColor"+B](Ie,qe,rr,$r,kt,Kt,pe,Ne,It)}}function De(N,E,B,H,ce){for(B=E+B;E<B;){var ye=N[E++];H[ce++]=ye>>16&255,H[ce++]=ye>>8&255,H[ce++]=255&ye}}function wt(N,E,B,H,ce){for(B=E+B;E<B;){var ye=N[E++];H[ce++]=ye>>16&255,H[ce++]=ye>>8&255,H[ce++]=255&ye,H[ce++]=ye>>24&255}}function Rt(N,E,B,H,ce){for(B=E+B;E<B;){var ye=(pe=N[E++])>>16&240|pe>>12&15,pe=240&pe|pe>>28&15;H[ce++]=ye,H[ce++]=pe}}function Rr(N,E,B,H,ce){for(B=E+B;E<B;){var ye=(pe=N[E++])>>16&248|pe>>13&7,pe=pe>>5&224|pe>>3&31;H[ce++]=ye,H[ce++]=pe}}function Me(N,E,B,H,ce){for(B=E+B;E<B;){var ye=N[E++];H[ce++]=255&ye,H[ce++]=ye>>8&255,H[ce++]=ye>>16&255}}function tt(N,E,B,H,ce,ye){if(ye==0)for(B=E+B;E<B;)ae(H,((ye=N[E++])[0]>>24|ye[1]>>8&65280|ye[2]<<8&16711680|ye[3]<<24)>>>0),ce+=32;else n(H,ce,N,E,B)}function ut(N,E){P[E][0]=P[N+"0"],P[E][1]=P[N+"1"],P[E][2]=P[N+"2"],P[E][3]=P[N+"3"],P[E][4]=P[N+"4"],P[E][5]=P[N+"5"],P[E][6]=P[N+"6"],P[E][7]=P[N+"7"],P[E][8]=P[N+"8"],P[E][9]=P[N+"9"],P[E][10]=P[N+"10"],P[E][11]=P[N+"11"],P[E][12]=P[N+"12"],P[E][13]=P[N+"13"],P[E][14]=P[N+"0"],P[E][15]=P[N+"0"]}function sr(N){return N==pa||N==ps||N==qs||N==Ji}function Sr(){this.eb=[],this.size=this.A=this.fb=0}function xr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Wr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Sr,this.f.kb=new xr,this.sd=null}function qr(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Tr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function sn(N){return alert("todo:WebPSamplerProcessPlane"),N.T}function Cn(N,E){var B=N.T,H=E.ba.f.RGBA,ce=H.eb,ye=H.fb+N.ka*H.A,pe=Qi[E.ba.S],Ne=N.y,Ie=N.O,qe=N.f,kt=N.N,Kt=N.ea,Be=N.W,It=E.cc,rr=E.dc,$r=E.Mc,ur=E.Nc,Gr=N.ka,Zr=N.ka+N.T,En=N.U,bn=En+1>>1;for(Gr==0?pe(Ne,Ie,null,null,qe,kt,Kt,Be,qe,kt,Kt,Be,ce,ye,null,null,En):(pe(E.ec,E.fc,Ne,Ie,It,rr,$r,ur,qe,kt,Kt,Be,ce,ye-H.A,ce,ye,En),++B);Gr+2<Zr;Gr+=2)It=qe,rr=kt,$r=Kt,ur=Be,kt+=N.Rc,Be+=N.Rc,ye+=2*H.A,pe(Ne,(Ie+=2*N.fa)-N.fa,Ne,Ie,It,rr,$r,ur,qe,kt,Kt,Be,ce,ye-H.A,ce,ye,En);return Ie+=N.fa,N.j+Zr<N.o?(n(E.ec,E.fc,Ne,Ie,En),n(E.cc,E.dc,qe,kt,bn),n(E.Mc,E.Nc,Kt,Be,bn),B--):1&Zr||pe(Ne,Ie,null,null,qe,kt,Kt,Be,qe,kt,Kt,Be,ce,ye+H.A,null,null,En),B}function ze(N,E,B){var H=N.F,ce=[N.J];if(H!=null){var ye=N.U,pe=E.ba.S,Ne=pe==Ms||pe==qs;E=E.ba.f.RGBA;var Ie=[0],qe=N.ka;Ie[0]=N.T,N.Kb&&(qe==0?--Ie[0]:(--qe,ce[0]-=N.width),N.j+N.ka+N.T==N.o&&(Ie[0]=N.o-N.j-qe));var kt=E.eb;qe=E.fb+qe*E.A,N=Bt(H,ce[0],N.width,ye,Ie,kt,qe+(Ne?0:3),E.A),t(B==Ie),N&&sr(pe)&&jt(kt,qe,Ne,ye,Ie,E.A)}return 0}function Fe(N){var E=N.ma,B=E.ba.S,H=11>B,ce=B==Ta||B==ao||B==Ms||B==bs||B==12||sr(B);if(E.memory=null,E.Ib=null,E.Jb=null,E.Nd=null,!vr(E.Oa,N,ce?11:12))return 0;if(ce&&sr(B)&&_n(),N.da)alert("todo:use_scaling");else{if(H){if(E.Ib=sn,N.Kb){if(B=N.U+1>>1,E.memory=o(N.U+2*B),E.memory==null)return 0;E.ec=E.memory,E.fc=0,E.cc=E.ec,E.dc=E.fc+N.U,E.Mc=E.cc,E.Nc=E.dc+B,E.Ib=Cn,_n()}}else alert("todo:EmitYUV");ce&&(E.Jb=ze,H&&Xr())}if(H&&!Zi){for(N=0;256>N;++N)Fl[N]=89858*(N-128)+Fa>>An,Wd[N]=-22014*(N-128)+Fa,nc[N]=-45773*(N-128),Vd[N]=113618*(N-128)+Fa>>An;for(N=ws;N<as;++N)E=76283*(N-16)+Fa>>An,rh[N-ws]=an(E,255),zs[N-ws]=an(E+8>>4,15);Zi=1}return 1}function Le(N){var E=N.ma,B=N.U,H=N.T;return t(!(1&N.ka)),0>=B||0>=H?0:(B=E.Ib(N,E),E.Jb!=null&&E.Jb(N,E,B),E.Dc+=B,1)}function Ze(N){N.ma.memory=null}function Ot(N,E,B,H){return _e(N,8)!=47?0:(E[0]=_e(N,14)+1,B[0]=_e(N,14)+1,H[0]=_e(N,1),_e(N,3)!=0?0:!N.h)}function mt(N,E){if(4>N)return N+1;var B=N-2>>1;return(2+(1&N)<<B)+_e(E,B)+1}function Qt(N,E){return 120<E?E-120:1<=(B=((B=_i[E-1])>>4)*N+(8-(15&B)))?B:1;var B}function bt(N,E,B){var H=G(B),ce=N[E+=255&H].g-8;return 0<ce&&(X(B,B.u+8),H=G(B),E+=N[E].value,E+=H&(1<<ce)-1),X(B,B.u+N[E].g),N[E].value}function zt(N,E,B){return B.g+=N.g,B.value+=N.value<<E>>>0,t(8>=B.g),N.g}function ne(N,E,B){var H=N.xc;return t((E=H==0?0:N.vc[N.md*(B>>H)+(E>>H)])<N.Wb),N.Ya[E]}function He(N,E,B,H){var ce=N.ab,ye=N.c*E,pe=N.C;E=pe+E;var Ne=B,Ie=H;for(H=N.Ta,B=N.Ua;0<ce--;){var qe=N.gc[ce],kt=pe,Kt=E,Be=Ne,It=Ie,rr=(Ie=H,Ne=B,qe.Ea);switch(t(kt<Kt),t(Kt<=qe.nc),qe.hc){case 2:ht(Be,It,(Kt-kt)*rr,Ie,Ne);break;case 0:var $r=kt,ur=Kt,Gr=Ie,Zr=Ne,En=(Na=qe).Ea;$r==0&&(st(Be,It,null,null,1,Gr,Zr),yr(Be,It+1,0,0,En-1,Gr,Zr+1),It+=En,Zr+=En,++$r);for(var bn=1<<Na.b,Ea=bn-1,va=St(En,Na.b),gs=Na.K,Na=Na.w+($r>>Na.b)*va;$r<ur;){var Os=gs,Ri=Na,xs=1;for(je(Be,It,Gr,Zr-En,1,Gr,Zr);xs<En;){var Sa=(xs&~Ea)+bn;Sa>En&&(Sa=En),(0,Ln[Os[Ri++]>>8&15])(Be,It+ +xs,Gr,Zr+xs-En,Sa-xs,Gr,Zr+xs),xs=Sa}It+=En,Zr+=En,++$r&Ea||(Na+=va)}Kt!=qe.nc&&n(Ie,Ne-rr,Ie,Ne+(Kt-kt-1)*rr,rr);break;case 1:for(rr=Be,ur=It,En=(Be=qe.Ea)-(Zr=Be&~(Gr=(It=1<<qe.b)-1)),$r=St(Be,qe.b),bn=qe.K,qe=qe.w+(kt>>qe.b)*$r;kt<Kt;){for(Ea=bn,va=qe,gs=new gr,Na=ur+Zr,Os=ur+Be;ur<Na;)at(Ea[va++],gs),On(gs,rr,ur,It,Ie,Ne),ur+=It,Ne+=It;ur<Os&&(at(Ea[va++],gs),On(gs,rr,ur,En,Ie,Ne),ur+=En,Ne+=En),++kt&Gr||(qe+=$r)}break;case 3:if(Be==Ie&&It==Ne&&0<qe.b){for(ur=Ie,Be=rr=Ne+(Kt-kt)*rr-(Zr=(Kt-kt)*St(qe.Ea,qe.b)),It=Ie,Gr=Ne,$r=[],Zr=(En=Zr)-1;0<=Zr;--Zr)$r[Zr]=It[Gr+Zr];for(Zr=En-1;0<=Zr;--Zr)ur[Be+Zr]=$r[Zr];rt(qe,kt,Kt,Ie,rr,Ie,Ne)}else rt(qe,kt,Kt,Be,It,Ie,Ne)}Ne=H,Ie=B}Ie!=B&&n(H,B,Ne,Ie,ye)}function Gt(N,E){var B=N.V,H=N.Ba+N.c*N.C,ce=E-N.C;if(t(E<=N.l.o),t(16>=ce),0<ce){var ye=N.l,pe=N.Ta,Ne=N.Ua,Ie=ye.width;if(He(N,ce,B,H),ce=Ne=[Ne],t((B=N.C)<(H=E)),t(ye.v<ye.va),H>ye.o&&(H=ye.o),B<ye.j){var qe=ye.j-B;B=ye.j,ce[0]+=qe*Ie}if(B>=H?B=0:(ce[0]+=4*ye.v,ye.ka=B-ye.j,ye.U=ye.va-ye.v,ye.T=H-B,B=1),B){if(Ne=Ne[0],11>(B=N.ca).S){var kt=B.f.RGBA,Kt=(H=B.S,ce=ye.U,ye=ye.T,qe=kt.eb,kt.A),Be=ye;for(kt=kt.fb+N.Ma*kt.A;0<Be--;){var It=pe,rr=Ne,$r=ce,ur=qe,Gr=kt;switch(H){case Do:ma(It,rr,$r,ur,Gr);break;case Ta:Ja(It,rr,$r,ur,Gr);break;case pa:Ja(It,rr,$r,ur,Gr),jt(ur,Gr,0,$r,1,0);break;case Kn:ia(It,rr,$r,ur,Gr);break;case ao:tt(It,rr,$r,ur,Gr,1);break;case ps:tt(It,rr,$r,ur,Gr,1),jt(ur,Gr,0,$r,1,0);break;case Ms:tt(It,rr,$r,ur,Gr,0);break;case qs:tt(It,rr,$r,ur,Gr,0),jt(ur,Gr,1,$r,1,0);break;case bs:Bs(It,rr,$r,ur,Gr);break;case Ji:Bs(It,rr,$r,ur,Gr),Ve(ur,Gr,$r,1,0);break;case Xn:na(It,rr,$r,ur,Gr);break;default:t(0)}Ne+=Ie,kt+=Kt}N.Ma+=ye}else alert("todo:EmitRescaledRowsYUVA");t(N.Ma<=B.height)}}N.C=E,t(N.C<=N.i)}function Ht(N){var E;if(0<N.ua)return 0;for(E=0;E<N.Wb;++E){var B=N.Ya[E].G,H=N.Ya[E].H;if(0<B[1][H[1]+0].g||0<B[2][H[2]+0].g||0<B[3][H[3]+0].g)return 0}return 1}function Fr(N,E,B,H,ce,ye){if(N.Z!=0){var pe=N.qd,Ne=N.rd;for(t(Ud[N.Z]!=null);E<B;++E)Ud[N.Z](pe,Ne,H,ce,H,ce,ye),pe=H,Ne=ce,ce+=ye;N.qd=pe,N.rd=Ne}}function cr(N,E){var B=N.l.ma,H=B.Z==0||B.Z==1?N.l.j:N.C;if(H=N.C<H?H:N.C,t(E<=N.l.o),E>H){var ce=N.l.width,ye=B.ca,pe=B.tb+ce*H,Ne=N.V,Ie=N.Ba+N.c*H,qe=N.gc;t(N.ab==1),t(qe[0].hc==3),yn(qe[0],H,E,Ne,Ie,ye,pe),Fr(B,H,E,ye,pe,ce)}N.C=N.Ma=E}function nn(N,E,B,H,ce,ye,pe){var Ne=N.$/H,Ie=N.$%H,qe=N.m,kt=N.s,Kt=B+N.$,Be=Kt;ce=B+H*ce;var It=B+H*ye,rr=280+kt.ua,$r=N.Pb?Ne:16777216,ur=0<kt.ua?kt.Wa:null,Gr=kt.wc,Zr=Kt<It?ne(kt,Ie,Ne):null;t(N.C<ye),t(It<=ce);var En=!1;e:for(;;){for(;En||Kt<It;){var bn=0;if(Ne>=$r){var Ea=Kt-B;t(($r=N).Pb),$r.wd=$r.m,$r.xd=Ea,0<$r.s.ua&&xt($r.s.Wa,$r.s.vb),$r=Ne+ad}if(Ie&Gr||(Zr=ne(kt,Ie,Ne)),t(Zr!=null),Zr.Qb&&(E[Kt]=Zr.qb,En=!0),!En)if(W(qe),Zr.jc){bn=qe,Ea=E;var va=Kt,gs=Zr.pd[G(bn)&Ir-1];t(Zr.jc),256>gs.g?(X(bn,bn.u+gs.g),Ea[va]=gs.value,bn=0):(X(bn,bn.u+gs.g-256),t(256<=gs.value),bn=gs.value),bn==0&&(En=!0)}else bn=bt(Zr.G[0],Zr.H[0],qe);if(qe.h)break;if(En||256>bn){if(!En)if(Zr.nd)E[Kt]=(Zr.qb|bn<<8)>>>0;else{if(W(qe),En=bt(Zr.G[1],Zr.H[1],qe),W(qe),Ea=bt(Zr.G[2],Zr.H[2],qe),va=bt(Zr.G[3],Zr.H[3],qe),qe.h)break;E[Kt]=(va<<24|En<<16|bn<<8|Ea)>>>0}if(En=!1,++Kt,++Ie>=H&&(Ie=0,++Ne,pe!=null&&Ne<=ye&&!(Ne%16)&&pe(N,Ne),ur!=null))for(;Be<Kt;)bn=E[Be++],ur.X[(506832829*bn&4294967295)>>>ur.Mb]=bn}else if(280>bn){if(bn=mt(bn-256,qe),Ea=bt(Zr.G[4],Zr.H[4],qe),W(qe),Ea=Qt(H,Ea=mt(Ea,qe)),qe.h)break;if(Kt-B<Ea||ce-Kt<bn)break e;for(va=0;va<bn;++va)E[Kt+va]=E[Kt+va-Ea];for(Kt+=bn,Ie+=bn;Ie>=H;)Ie-=H,++Ne,pe!=null&&Ne<=ye&&!(Ne%16)&&pe(N,Ne);if(t(Kt<=ce),Ie&Gr&&(Zr=ne(kt,Ie,Ne)),ur!=null)for(;Be<Kt;)bn=E[Be++],ur.X[(506832829*bn&4294967295)>>>ur.Mb]=bn}else{if(!(bn<rr))break e;for(En=bn-280,t(ur!=null);Be<Kt;)bn=E[Be++],ur.X[(506832829*bn&4294967295)>>>ur.Mb]=bn;bn=Kt,t(!(En>>>(Ea=ur).Xa)),E[bn]=Ea.X[En],En=!0}En||t(qe.h==de(qe))}if(N.Pb&&qe.h&&Kt<ce)t(N.m.h),N.a=5,N.m=N.wd,N.$=N.xd,0<N.s.ua&&xt(N.s.vb,N.s.Wa);else{if(qe.h)break e;pe?.(N,Ne>ye?ye:Ne),N.a=0,N.$=Kt-B}return 1}return N.a=3,0}function Tn(N){t(N!=null),N.vc=null,N.yc=null,N.Ya=null;var E=N.Wa;E!=null&&(E.X=null),N.vb=null,t(N!=null)}function Gn(){var N=new Se;return N==null?null:(N.a=0,N.xb=Iy,ut("Predictor","VP8LPredictors"),ut("Predictor","VP8LPredictors_C"),ut("PredictorAdd","VP8LPredictorsAdd"),ut("PredictorAdd","VP8LPredictorsAdd_C"),ht=ve,On=qt,ma=De,Ja=wt,Bs=Rt,na=Rr,ia=Me,P.VP8LMapColor32b=nr,P.VP8LMapColor8b=fn,N)}function ta(N,E,B,H,ce){var ye=1,pe=[N],Ne=[E],Ie=H.m,qe=H.s,kt=null,Kt=0;e:for(;;){if(B)for(;ye&&_e(Ie,1);){var Be=pe,It=Ne,rr=H,$r=1,ur=rr.m,Gr=rr.gc[rr.ab],Zr=_e(ur,2);if(rr.Oc&1<<Zr)ye=0;else{switch(rr.Oc|=1<<Zr,Gr.hc=Zr,Gr.Ea=Be[0],Gr.nc=It[0],Gr.K=[null],++rr.ab,t(4>=rr.ab),Zr){case 0:case 1:Gr.b=_e(ur,3)+2,$r=ta(St(Gr.Ea,Gr.b),St(Gr.nc,Gr.b),0,rr,Gr.K),Gr.K=Gr.K[0];break;case 3:var En,bn=_e(ur,8)+1,Ea=16<bn?0:4<bn?1:2<bn?2:3;if(Be[0]=St(Gr.Ea,Ea),Gr.b=Ea,En=$r=ta(bn,1,0,rr,Gr.K)){var va,gs=bn,Na=Gr,Os=1<<(8>>Na.b),Ri=o(Os);if(Ri==null)En=0;else{var xs=Na.K[0],Sa=Na.w;for(Ri[0]=Na.K[0][0],va=1;va<1*gs;++va)Ri[va]=ft(xs[Sa+va],Ri[va-1]);for(;va<4*Os;++va)Ri[va]=0;Na.K[0]=null,Na.K[0]=Ri,En=1}}$r=En;break;case 2:break;default:t(0)}ye=$r}}if(pe=pe[0],Ne=Ne[0],ye&&_e(Ie,1)&&!(ye=1<=(Kt=_e(Ie,4))&&11>=Kt)){H.a=3;break e}var Zn;if(Zn=ye)t:{var hi,ms,Rs,Mo=H,yl=pe,sc=Ne,si=Kt,$l=B,oc=Mo.m,Fi=Mo.s,Us=[null],oo=1,oi=0,io=nd[si];r:for(;;){if($l&&_e(oc,1)){var bl=_e(oc,3)+2,Du=St(yl,bl),pi=St(sc,bl),Oc=Du*pi;if(!ta(Du,pi,0,Mo,Us))break r;for(Us=Us[0],Fi.xc=bl,hi=0;hi<Oc;++hi){var bo=Us[hi]>>8&65535;Us[hi]=bo,bo>=oo&&(oo=bo+1)}}if(oc.h)break r;for(ms=0;5>ms;++ms){var Li=ba[ms];!ms&&0<si&&(Li+=1<<si),oi<Li&&(oi=Li)}var od=i(oo*io,T),ic=oo,id=i(ic,$);if(id==null)var ld=null;else t(65536>=ic),ld=id;var Tc=o(oi);if(ld==null||Tc==null||od==null){Mo.a=1;break r}var cd=od;for(hi=Rs=0;hi<oo;++hi){var No=ld[hi],dd=No.G,Mu=No.H,zp=0,sm=1,wl=0;for(ms=0;5>ms;++ms){Li=ba[ms],dd[ms]=cd,Mu[ms]=Rs,!ms&&0<si&&(Li+=1<<si);a:{var $j,XP=Li,Bj=Mo,Oy=Tc,cie=cd,die=Rs,YP=0,nh=Bj.m,uie=_e(nh,1);if(s(Oy,0,0,XP),uie){var fie=_e(nh,1)+1,mie=_e(nh,1),EF=_e(nh,mie==0?1:8);Oy[EF]=1,fie==2&&(Oy[EF=_e(nh,8)]=1);var qj=1}else{var kF=o(19),IF=_e(nh,4)+4;if(19<IF){Bj.a=3;var zj=0;break a}for($j=0;$j<IF;++$j)kF[so[$j]]=_e(nh,3);var JP=void 0,Ty=void 0,OF=Bj,hie=kF,Uj=XP,TF=Oy,QP=0,ah=OF.m,DF=8,MF=i(128,T);n:for(;I(MF,0,7,hie,19);){if(_e(ah,1)){var pie=2+2*_e(ah,3);if((JP=2+_e(ah,pie))>Uj)break n}else JP=Uj;for(Ty=0;Ty<Uj&&JP--;){W(ah);var RF=MF[0+(127&G(ah))];X(ah,ah.u+RF.g);var kx=RF.value;if(16>kx)TF[Ty++]=kx,kx!=0&&(DF=kx);else{var gie=kx==16,FF=kx-16,xie=Ml[FF],LF=_e(ah,kc[FF])+xie;if(Ty+LF>Uj)break n;for(var vie=gie?DF:0;0<LF--;)TF[Ty++]=vie}}QP=1;break n}QP||(OF.a=3),qj=QP}(qj=qj&&!nh.h)&&(YP=I(cie,die,8,Oy,XP)),qj&&YP!=0?zj=YP:(Bj.a=3,zj=0)}if(zj==0)break r;if(sm&&Qa[ms]==1&&(sm=cd[Rs].g==0),zp+=cd[Rs].g,Rs+=zj,3>=ms){var Dy,ZP=Tc[0];for(Dy=1;Dy<Li;++Dy)Tc[Dy]>ZP&&(ZP=Tc[Dy]);wl+=ZP}}if(No.nd=sm,No.Qb=0,sm&&(No.qb=(dd[3][Mu[3]+0].value<<24|dd[1][Mu[1]+0].value<<16|dd[2][Mu[2]+0].value)>>>0,zp==0&&256>dd[0][Mu[0]+0].value&&(No.Qb=1,No.qb+=dd[0][Mu[0]+0].value<<8)),No.jc=!No.Qb&&6>wl,No.jc){var Vj,om=No;for(Vj=0;Vj<Ir;++Vj){var sh=Vj,oh=om.pd[sh],Wj=om.G[0][om.H[0]+sh];256<=Wj.value?(oh.g=Wj.g+256,oh.value=Wj.value):(oh.g=0,oh.value=0,sh>>=zt(Wj,8,oh),sh>>=zt(om.G[1][om.H[1]+sh],16,oh),sh>>=zt(om.G[2][om.H[2]+sh],0,oh),zt(om.G[3][om.H[3]+sh],24,oh))}}}Fi.vc=Us,Fi.Wb=oo,Fi.Ya=ld,Fi.yc=od,Zn=1;break t}Zn=0}if(!(ye=Zn)){H.a=3;break e}if(0<Kt){if(qe.ua=1<<Kt,!ie(qe.Wa,Kt)){H.a=1,ye=0;break e}}else qe.ua=0;var eA=H,$F=pe,yie=Ne,tA=eA.s,rA=tA.xc;if(eA.c=$F,eA.i=yie,tA.md=St($F,rA),tA.wc=rA==0?-1:(1<<rA)-1,B){H.xb=Lj;break e}if((kt=o(pe*Ne))==null){H.a=1,ye=0;break e}ye=(ye=nn(H,kt,0,pe,Ne,Ne,null))&&!Ie.h;break e}return ye?(ce!=null?ce[0]=kt:(t(kt==null),t(B)),H.$=0,B||Tn(qe)):Tn(qe),ye}function Aa(N,E){var B=N.c*N.i,H=B+E+16*E;return t(N.c<=E),N.V=o(H),N.V==null?(N.Ta=null,N.Ua=0,N.a=1,0):(N.Ta=N.V,N.Ua=N.Ba+B+E,1)}function ke(N,E){var B=N.C,H=E-B,ce=N.V,ye=N.Ba+N.c*B;for(t(E<=N.l.o);0<H;){var pe=16<H?16:H,Ne=N.l.ma,Ie=N.l.width,qe=Ie*pe,kt=Ne.ca,Kt=Ne.tb+Ie*B,Be=N.Ta,It=N.Ua;He(N,pe,ce,ye),Yt(Be,It,kt,Kt,qe),Fr(Ne,B,B+pe,kt,Kt,Ie),H-=pe,ce+=pe*N.c,B+=pe}t(B==E),N.C=N.Ma=E}function Ae(){this.ub=this.yd=this.td=this.Rb=0}function et(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function br(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function Zt(){this.Yb=function(){var N=[];return function E(B,H,ce){for(var ye=ce[H],pe=0;pe<ye&&(B.push(ce.length>H+1?[]:0),!(ce.length<H+1));pe++)E(B[pe],H+1,ce)}(N,0,[3,11]),N}()}function Pn(){this.jb=o(3),this.Wc=l([4,8],Zt),this.Xc=l([4,17],Zt)}function Ct(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function lr(){this.ld=this.La=this.dd=this.tc=0}function Ye(){this.Na=this.la=0}function Tt(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Xt(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Br(){this.uc=this.M=this.Nb=0,this.wa=Array(new lr),this.Y=0,this.ya=Array(new Xt),this.aa=0,this.l=new on}function Wn(){this.y=o(16),this.f=o(8),this.ea=o(8)}function xn(){this.cb=this.a=0,this.sc="",this.m=new U,this.Od=new Ae,this.Kc=new et,this.ed=new Ct,this.Qa=new br,this.Ic=this.$c=this.Aa=0,this.D=new Br,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=i(8,U),this.ia=0,this.pb=i(4,Tt),this.Pa=new Pn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Wn),this.Hd=0,this.rb=Array(new Ye),this.sb=0,this.wa=Array(new lr),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Xt),this.L=this.aa=0,this.gd=l([4,2],lr),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function on(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ua(){var N=new xn;return N!=null&&(N.a=0,N.sc="OK",N.cb=0,N.Xb=0,Ou||(Ou=J)),N}function sa(N,E,B){return N.a==0&&(N.a=E,N.sc=B,N.cb=0),0}function wa(N,E,B){return 3<=B&&N[E+0]==157&&N[E+1]==1&&N[E+2]==42}function Va(N,E){if(N==null)return 0;if(N.a=0,N.sc="OK",E==null)return sa(N,2,"null VP8Io passed to VP8GetHeaders()");var B=E.data,H=E.w,ce=E.ha;if(4>ce)return sa(N,7,"Truncated header.");var ye=B[H+0]|B[H+1]<<8|B[H+2]<<16,pe=N.Od;if(pe.Rb=!(1&ye),pe.td=ye>>1&7,pe.yd=ye>>4&1,pe.ub=ye>>5,3<pe.td)return sa(N,3,"Incorrect keyframe parameters.");if(!pe.yd)return sa(N,4,"Frame not displayable.");H+=3,ce-=3;var Ne=N.Kc;if(pe.Rb){if(7>ce)return sa(N,7,"cannot parse picture header");if(!wa(B,H,ce))return sa(N,3,"Bad code word");Ne.c=16383&(B[H+4]<<8|B[H+3]),Ne.Td=B[H+4]>>6,Ne.i=16383&(B[H+6]<<8|B[H+5]),Ne.Ud=B[H+6]>>6,H+=7,ce-=7,N.za=Ne.c+15>>4,N.Ub=Ne.i+15>>4,E.width=Ne.c,E.height=Ne.i,E.Da=0,E.j=0,E.v=0,E.va=E.width,E.o=E.height,E.da=0,E.ib=E.width,E.hb=E.height,E.U=E.width,E.T=E.height,s((ye=N.Pa).jb,0,255,ye.jb.length),t((ye=N.Qa)!=null),ye.Cb=0,ye.Bb=0,ye.Fb=1,s(ye.Zb,0,0,ye.Zb.length),s(ye.Lb,0,0,ye.Lb)}if(pe.ub>ce)return sa(N,7,"bad partition length");q(ye=N.m,B,H,pe.ub),H+=pe.ub,ce-=pe.ub,pe.Rb&&(Ne.Ld=me(ye),Ne.Kd=me(ye)),Ne=N.Qa;var Ie,qe=N.Pa;if(t(ye!=null),t(Ne!=null),Ne.Cb=me(ye),Ne.Cb){if(Ne.Bb=me(ye),me(ye)){for(Ne.Fb=me(ye),Ie=0;4>Ie;++Ie)Ne.Zb[Ie]=me(ye)?F(ye,7):0;for(Ie=0;4>Ie;++Ie)Ne.Lb[Ie]=me(ye)?F(ye,6):0}if(Ne.Bb)for(Ie=0;3>Ie;++Ie)qe.jb[Ie]=me(ye)?z(ye,8):255}else Ne.Bb=0;if(ye.Ka)return sa(N,3,"cannot parse segment header");if((Ne=N.ed).zd=me(ye),Ne.Tb=z(ye,6),Ne.wb=z(ye,3),Ne.Pc=me(ye),Ne.Pc&&me(ye)){for(qe=0;4>qe;++qe)me(ye)&&(Ne.vd[qe]=F(ye,6));for(qe=0;4>qe;++qe)me(ye)&&(Ne.od[qe]=F(ye,6))}if(N.L=Ne.Tb==0?0:Ne.zd?1:2,ye.Ka)return sa(N,3,"cannot parse filter header");var kt=ce;if(ce=Ie=H,H=Ie+kt,Ne=kt,N.Xb=(1<<z(N.m,2))-1,kt<3*(qe=N.Xb))B=7;else{for(Ie+=3*qe,Ne-=3*qe,kt=0;kt<qe;++kt){var Kt=B[ce+0]|B[ce+1]<<8|B[ce+2]<<16;Kt>Ne&&(Kt=Ne),q(N.Jc[+kt],B,Ie,Kt),Ie+=Kt,Ne-=Kt,ce+=3}q(N.Jc[+qe],B,Ie,Ne),B=Ie<H?0:5}if(B!=0)return sa(N,B,"cannot parse partitions");for(B=z(Ie=N.m,7),ce=me(Ie)?F(Ie,4):0,H=me(Ie)?F(Ie,4):0,Ne=me(Ie)?F(Ie,4):0,qe=me(Ie)?F(Ie,4):0,Ie=me(Ie)?F(Ie,4):0,kt=N.Qa,Kt=0;4>Kt;++Kt){if(kt.Cb){var Be=kt.Zb[Kt];kt.Fb||(Be+=B)}else{if(0<Kt){N.pb[Kt]=N.pb[0];continue}Be=B}var It=N.pb[Kt];It.Sc[0]=Rl[an(Be+ce,127)],It.Sc[1]=Iu[an(Be+0,127)],It.Eb[0]=2*Rl[an(Be+H,127)],It.Eb[1]=101581*Iu[an(Be+Ne,127)]>>16,8>It.Eb[1]&&(It.Eb[1]=8),It.Qc[0]=Rl[an(Be+qe,117)],It.Qc[1]=Iu[an(Be+Ie,127)],It.lc=Be+Ie}if(!pe.Rb)return sa(N,4,"Not a key frame.");for(me(ye),pe=N.Pa,B=0;4>B;++B){for(ce=0;8>ce;++ce)for(H=0;3>H;++H)for(Ne=0;11>Ne;++Ne)qe=ee(ye,Fj[B][ce][H][Ne])?z(ye,8):GP[B][ce][H][Ne],pe.Wc[B][ce].Yb[H][Ne]=qe;for(ce=0;17>ce;++ce)pe.Xc[B][ce]=pe.Wc[B][KP[ce]]}return N.kc=me(ye),N.kc&&(N.Bd=z(ye,8)),N.cb=1}function J(N,E,B,H,ce,ye,pe){var Ne=E[ce].Yb[B];for(B=0;16>ce;++ce){if(!ee(N,Ne[B+0]))return ce;for(;!ee(N,Ne[B+1]);)if(Ne=E[++ce].Yb[0],B=0,ce==16)return 16;var Ie=E[ce+1].Yb;if(ee(N,Ne[B+2])){var qe=N,kt=0;if(ee(qe,(Be=Ne)[(Kt=B)+3]))if(ee(qe,Be[Kt+6])){for(Ne=0,Kt=2*(kt=ee(qe,Be[Kt+8]))+(Be=ee(qe,Be[Kt+9+kt])),kt=0,Be=Ic[Kt];Be[Ne];++Ne)kt+=kt+ee(qe,Be[Ne]);kt+=3+(8<<Kt)}else ee(qe,Be[Kt+7])?(kt=7+2*ee(qe,165),kt+=ee(qe,145)):kt=5+ee(qe,159);else kt=ee(qe,Be[Kt+4])?3+ee(qe,Be[Kt+5]):2;Ne=Ie[2]}else kt=1,Ne=Ie[1];Ie=pe+Rj[ce],0>(qe=N).b&&Y(qe);var Kt,Be=qe.b,It=(Kt=qe.Ca>>1)-(qe.I>>Be)>>31;--qe.b,qe.Ca+=It,qe.Ca|=1,qe.I-=(Kt+1&It)<<Be,ye[Ie]=((kt^It)-It)*H[(0<ce)+0]}return 16}function Oe(N){var E=N.rb[N.sb-1];E.la=0,E.Na=0,s(N.zc,0,0,N.zc.length),N.ja=0}function Je(N,E,B,H,ce){ce=N[E+B+32*H]+(ce>>3),N[E+B+32*H]=-256&ce?0>ce?0:255:ce}function mr(N,E,B,H,ce,ye){Je(N,E,0,B,H+ce),Je(N,E,1,B,H+ye),Je(N,E,2,B,H-ye),Je(N,E,3,B,H-ce)}function ot(N){return(20091*N>>16)+N}function ar(N,E,B,H){var ce,ye=0,pe=o(16);for(ce=0;4>ce;++ce){var Ne=N[E+0]+N[E+8],Ie=N[E+0]-N[E+8],qe=(35468*N[E+4]>>16)-ot(N[E+12]),kt=ot(N[E+4])+(35468*N[E+12]>>16);pe[ye+0]=Ne+kt,pe[ye+1]=Ie+qe,pe[ye+2]=Ie-qe,pe[ye+3]=Ne-kt,ye+=4,E++}for(ce=ye=0;4>ce;++ce)Ne=(N=pe[ye+0]+4)+pe[ye+8],Ie=N-pe[ye+8],qe=(35468*pe[ye+4]>>16)-ot(pe[ye+12]),Je(B,H,0,0,Ne+(kt=ot(pe[ye+4])+(35468*pe[ye+12]>>16))),Je(B,H,1,0,Ie+qe),Je(B,H,2,0,Ie-qe),Je(B,H,3,0,Ne-kt),ye++,H+=32}function ir(N,E,B,H){var ce=N[E+0]+4,ye=35468*N[E+4]>>16,pe=ot(N[E+4]),Ne=35468*N[E+1]>>16;mr(B,H,0,ce+pe,N=ot(N[E+1]),Ne),mr(B,H,1,ce+ye,N,Ne),mr(B,H,2,ce-ye,N,Ne),mr(B,H,3,ce-pe,N,Ne)}function In(N,E,B,H,ce){ar(N,E,B,H),ce&&ar(N,E+16,B,H+4)}function ln(N,E,B,H){$a(N,E+0,B,H,1),$a(N,E+32,B,H+128,1)}function Kr(N,E,B,H){var ce;for(N=N[E+0]+4,ce=0;4>ce;++ce)for(E=0;4>E;++E)Je(B,H,E,ce,N)}function oe(N,E,B,H){N[E+0]&&Ia(N,E+0,B,H),N[E+16]&&Ia(N,E+16,B,H+4),N[E+32]&&Ia(N,E+32,B,H+128),N[E+48]&&Ia(N,E+48,B,H+128+4)}function Ke(N,E,B,H){var ce,ye=o(16);for(ce=0;4>ce;++ce){var pe=N[E+0+ce]+N[E+12+ce],Ne=N[E+4+ce]+N[E+8+ce],Ie=N[E+4+ce]-N[E+8+ce],qe=N[E+0+ce]-N[E+12+ce];ye[0+ce]=pe+Ne,ye[8+ce]=pe-Ne,ye[4+ce]=qe+Ie,ye[12+ce]=qe-Ie}for(ce=0;4>ce;++ce)pe=(N=ye[0+4*ce]+3)+ye[3+4*ce],Ne=ye[1+4*ce]+ye[2+4*ce],Ie=ye[1+4*ce]-ye[2+4*ce],qe=N-ye[3+4*ce],B[H+0]=pe+Ne>>3,B[H+16]=qe+Ie>>3,B[H+32]=pe-Ne>>3,B[H+48]=qe-Ie>>3,H+=64}function ct(N,E,B){var H,ce=E-32,ye=Hn,pe=255-N[ce-1];for(H=0;H<B;++H){var Ne,Ie=ye,qe=pe+N[E-1];for(Ne=0;Ne<B;++Ne)N[E+Ne]=Ie[qe+N[ce+Ne]];E+=32}}function xe(N,E){ct(N,E,4)}function $e(N,E){ct(N,E,8)}function Pe(N,E){ct(N,E,16)}function Vt(N,E){var B;for(B=0;16>B;++B)n(N,E+32*B,N,E-32,16)}function yt(N,E){var B;for(B=16;0<B;--B)s(N,E,N[E-1],16),E+=32}function tr(N,E,B){var H;for(H=0;16>H;++H)s(E,B+32*H,N,16)}function dr(N,E){var B,H=16;for(B=0;16>B;++B)H+=N[E-1+32*B]+N[E+B-32];tr(H>>5,N,E)}function tn(N,E){var B,H=8;for(B=0;16>B;++B)H+=N[E-1+32*B];tr(H>>4,N,E)}function Lr(N,E){var B,H=8;for(B=0;16>B;++B)H+=N[E+B-32];tr(H>>4,N,E)}function da(N,E){tr(128,N,E)}function rn(N,E,B){return N+2*E+B+2>>2}function un(N,E){var B,H=E-32;for(H=new Uint8Array([rn(N[H-1],N[H+0],N[H+1]),rn(N[H+0],N[H+1],N[H+2]),rn(N[H+1],N[H+2],N[H+3]),rn(N[H+2],N[H+3],N[H+4])]),B=0;4>B;++B)n(N,E+32*B,H,0,H.length)}function Dn(N,E){var B=N[E-1],H=N[E-1+32],ce=N[E-1+64],ye=N[E-1+96];ae(N,E+0,16843009*rn(N[E-1-32],B,H)),ae(N,E+32,16843009*rn(B,H,ce)),ae(N,E+64,16843009*rn(H,ce,ye)),ae(N,E+96,16843009*rn(ce,ye,ye))}function fa(N,E){var B,H=4;for(B=0;4>B;++B)H+=N[E+B-32]+N[E-1+32*B];for(H>>=3,B=0;4>B;++B)s(N,E+32*B,H,4)}function Oa(N,E){var B=N[E-1+0],H=N[E-1+32],ce=N[E-1+64],ye=N[E-1-32],pe=N[E+0-32],Ne=N[E+1-32],Ie=N[E+2-32],qe=N[E+3-32];N[E+0+96]=rn(H,ce,N[E-1+96]),N[E+1+96]=N[E+0+64]=rn(B,H,ce),N[E+2+96]=N[E+1+64]=N[E+0+32]=rn(ye,B,H),N[E+3+96]=N[E+2+64]=N[E+1+32]=N[E+0+0]=rn(pe,ye,B),N[E+3+64]=N[E+2+32]=N[E+1+0]=rn(Ne,pe,ye),N[E+3+32]=N[E+2+0]=rn(Ie,Ne,pe),N[E+3+0]=rn(qe,Ie,Ne)}function us(N,E){var B=N[E+1-32],H=N[E+2-32],ce=N[E+3-32],ye=N[E+4-32],pe=N[E+5-32],Ne=N[E+6-32],Ie=N[E+7-32];N[E+0+0]=rn(N[E+0-32],B,H),N[E+1+0]=N[E+0+32]=rn(B,H,ce),N[E+2+0]=N[E+1+32]=N[E+0+64]=rn(H,ce,ye),N[E+3+0]=N[E+2+32]=N[E+1+64]=N[E+0+96]=rn(ce,ye,pe),N[E+3+32]=N[E+2+64]=N[E+1+96]=rn(ye,pe,Ne),N[E+3+64]=N[E+2+96]=rn(pe,Ne,Ie),N[E+3+96]=rn(Ne,Ie,Ie)}function Un(N,E){var B=N[E-1+0],H=N[E-1+32],ce=N[E-1+64],ye=N[E-1-32],pe=N[E+0-32],Ne=N[E+1-32],Ie=N[E+2-32],qe=N[E+3-32];N[E+0+0]=N[E+1+64]=ye+pe+1>>1,N[E+1+0]=N[E+2+64]=pe+Ne+1>>1,N[E+2+0]=N[E+3+64]=Ne+Ie+1>>1,N[E+3+0]=Ie+qe+1>>1,N[E+0+96]=rn(ce,H,B),N[E+0+64]=rn(H,B,ye),N[E+0+32]=N[E+1+96]=rn(B,ye,pe),N[E+1+32]=N[E+2+96]=rn(ye,pe,Ne),N[E+2+32]=N[E+3+96]=rn(pe,Ne,Ie),N[E+3+32]=rn(Ne,Ie,qe)}function Ya(N,E){var B=N[E+0-32],H=N[E+1-32],ce=N[E+2-32],ye=N[E+3-32],pe=N[E+4-32],Ne=N[E+5-32],Ie=N[E+6-32],qe=N[E+7-32];N[E+0+0]=B+H+1>>1,N[E+1+0]=N[E+0+64]=H+ce+1>>1,N[E+2+0]=N[E+1+64]=ce+ye+1>>1,N[E+3+0]=N[E+2+64]=ye+pe+1>>1,N[E+0+32]=rn(B,H,ce),N[E+1+32]=N[E+0+96]=rn(H,ce,ye),N[E+2+32]=N[E+1+96]=rn(ce,ye,pe),N[E+3+32]=N[E+2+96]=rn(ye,pe,Ne),N[E+3+64]=rn(pe,Ne,Ie),N[E+3+96]=rn(Ne,Ie,qe)}function $s(N,E){var B=N[E-1+0],H=N[E-1+32],ce=N[E-1+64],ye=N[E-1+96];N[E+0+0]=B+H+1>>1,N[E+2+0]=N[E+0+32]=H+ce+1>>1,N[E+2+32]=N[E+0+64]=ce+ye+1>>1,N[E+1+0]=rn(B,H,ce),N[E+3+0]=N[E+1+32]=rn(H,ce,ye),N[E+3+32]=N[E+1+64]=rn(ce,ye,ye),N[E+3+64]=N[E+2+64]=N[E+0+96]=N[E+1+96]=N[E+2+96]=N[E+3+96]=ye}function po(N,E){var B=N[E-1+0],H=N[E-1+32],ce=N[E-1+64],ye=N[E-1+96],pe=N[E-1-32],Ne=N[E+0-32],Ie=N[E+1-32],qe=N[E+2-32];N[E+0+0]=N[E+2+32]=B+pe+1>>1,N[E+0+32]=N[E+2+64]=H+B+1>>1,N[E+0+64]=N[E+2+96]=ce+H+1>>1,N[E+0+96]=ye+ce+1>>1,N[E+3+0]=rn(Ne,Ie,qe),N[E+2+0]=rn(pe,Ne,Ie),N[E+1+0]=N[E+3+32]=rn(B,pe,Ne),N[E+1+32]=N[E+3+64]=rn(H,B,pe),N[E+1+64]=N[E+3+96]=rn(ce,H,B),N[E+1+96]=rn(ye,ce,H)}function wi(N,E){var B;for(B=0;8>B;++B)n(N,E+32*B,N,E-32,8)}function zo(N,E){var B;for(B=0;8>B;++B)s(N,E,N[E-1],8),E+=32}function ji(N,E,B){var H;for(H=0;8>H;++H)s(E,B+32*H,N,8)}function ec(N,E){var B,H=8;for(B=0;8>B;++B)H+=N[E+B-32]+N[E-1+32*B];ji(H>>4,N,E)}function rd(N,E){var B,H=4;for(B=0;8>B;++B)H+=N[E+B-32];ji(H>>3,N,E)}function pl(N,E){var B,H=4;for(B=0;8>B;++B)H+=N[E-1+32*B];ji(H>>3,N,E)}function Eu(N,E){ji(128,N,E)}function Ko(N,E,B){var H=N[E-B],ce=N[E+0],ye=3*(ce-H)+gn[1020+N[E-2*B]-N[E+B]],pe=Yn[112+(ye+4>>3)];N[E-B]=Hn[255+H+Yn[112+(ye+3>>3)]],N[E+0]=Hn[255+ce-pe]}function Hs(N,E,B,H){var ce=N[E+0],ye=N[E+B];return ns[255+N[E-2*B]-N[E-B]]>H||ns[255+ye-ce]>H}function tc(N,E,B,H){return 4*ns[255+N[E-B]-N[E+0]]+ns[255+N[E-2*B]-N[E+B]]<=H}function Xi(N,E,B,H,ce){var ye=N[E-3*B],pe=N[E-2*B],Ne=N[E-B],Ie=N[E+0],qe=N[E+B],kt=N[E+2*B],Kt=N[E+3*B];return 4*ns[255+Ne-Ie]+ns[255+pe-qe]>H?0:ns[255+N[E-4*B]-ye]<=ce&&ns[255+ye-pe]<=ce&&ns[255+pe-Ne]<=ce&&ns[255+Kt-kt]<=ce&&ns[255+kt-qe]<=ce&&ns[255+qe-Ie]<=ce}function Tl(N,E,B,H){var ce=2*H+1;for(H=0;16>H;++H)tc(N,E+H,B,ce)&&Ko(N,E+H,B)}function As(N,E,B,H){var ce=2*H+1;for(H=0;16>H;++H)tc(N,E+H*B,1,ce)&&Ko(N,E+H*B,1)}function rc(N,E,B,H){var ce;for(ce=3;0<ce;--ce)Tl(N,E+=4*B,B,H)}function Ns(N,E,B,H){var ce;for(ce=3;0<ce;--ce)As(N,E+=4,B,H)}function gl(N,E,B,H,ce,ye,pe,Ne){for(ye=2*ye+1;0<ce--;){if(Xi(N,E,B,ye,pe))if(Hs(N,E,B,Ne))Ko(N,E,B);else{var Ie=N,qe=E,kt=B,Kt=Ie[qe-2*kt],Be=Ie[qe-kt],It=Ie[qe+0],rr=Ie[qe+kt],$r=Ie[qe+2*kt],ur=27*(Zr=gn[1020+3*(It-Be)+gn[1020+Kt-rr]])+63>>7,Gr=18*Zr+63>>7,Zr=9*Zr+63>>7;Ie[qe-3*kt]=Hn[255+Ie[qe-3*kt]+Zr],Ie[qe-2*kt]=Hn[255+Kt+Gr],Ie[qe-kt]=Hn[255+Be+ur],Ie[qe+0]=Hn[255+It-ur],Ie[qe+kt]=Hn[255+rr-Gr],Ie[qe+2*kt]=Hn[255+$r-Zr]}E+=H}}function Dl(N,E,B,H,ce,ye,pe,Ne){for(ye=2*ye+1;0<ce--;){if(Xi(N,E,B,ye,pe))if(Hs(N,E,B,Ne))Ko(N,E,B);else{var Ie=N,qe=E,kt=B,Kt=Ie[qe-kt],Be=Ie[qe+0],It=Ie[qe+kt],rr=Yn[112+(4+($r=3*(Be-Kt))>>3)],$r=Yn[112+($r+3>>3)],ur=rr+1>>1;Ie[qe-2*kt]=Hn[255+Ie[qe-2*kt]+ur],Ie[qe-kt]=Hn[255+Kt+$r],Ie[qe+0]=Hn[255+Be-rr],Ie[qe+kt]=Hn[255+It-ur]}E+=H}}function ku(N,E,B,H,ce,ye){gl(N,E,B,1,16,H,ce,ye)}function xl(N,E,B,H,ce,ye){gl(N,E,1,B,16,H,ce,ye)}function Yi(N,E,B,H,ce,ye){var pe;for(pe=3;0<pe;--pe)Dl(N,E+=4*B,B,1,16,H,ce,ye)}function vl(N,E,B,H,ce,ye){var pe;for(pe=3;0<pe;--pe)Dl(N,E+=4,1,B,16,H,ce,ye)}function R(N,E,B,H,ce,ye,pe,Ne){gl(N,E,ce,1,8,ye,pe,Ne),gl(B,H,ce,1,8,ye,pe,Ne)}function fe(N,E,B,H,ce,ye,pe,Ne){gl(N,E,1,ce,8,ye,pe,Ne),gl(B,H,1,ce,8,ye,pe,Ne)}function We(N,E,B,H,ce,ye,pe,Ne){Dl(N,E+4*ce,ce,1,8,ye,pe,Ne),Dl(B,H+4*ce,ce,1,8,ye,pe,Ne)}function gt(N,E,B,H,ce,ye,pe,Ne){Dl(N,E+4,1,ce,8,ye,pe,Ne),Dl(B,H+4,1,ce,8,ye,pe,Ne)}function Ut(){this.ba=new Wr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Tr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function zr(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function cn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function se(){this.ua=0,this.Wa=new vt,this.vb=new vt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new $,this.yc=new T}function Se(){this.xb=this.a=0,this.l=new on,this.ca=new Wr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new L,this.Pb=0,this.wd=new L,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new se,this.ab=0,this.gc=i(4,cn),this.Oc=0}function Ee(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new on,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function it(N,E,B,H,ce,ye,pe){for(N=N==null?0:N[E+0],E=0;E<pe;++E)ce[ye+E]=N+B[H+E]&255,N=ce[ye+E]}function Pt(N,E,B,H,ce,ye,pe){var Ne;if(N==null)it(null,null,B,H,ce,ye,pe);else for(Ne=0;Ne<pe;++Ne)ce[ye+Ne]=N[E+Ne]+B[H+Ne]&255}function hr(N,E,B,H,ce,ye,pe){if(N==null)it(null,null,B,H,ce,ye,pe);else{var Ne,Ie=N[E+0],qe=Ie,kt=Ie;for(Ne=0;Ne<pe;++Ne)qe=kt+(Ie=N[E+Ne])-qe,kt=B[H+Ne]+(-256&qe?0>qe?0:255:qe)&255,qe=Ie,ce[ye+Ne]=kt}}function er(N,E,B,H){var ce=E.width,ye=E.o;if(t(N!=null&&E!=null),0>B||0>=H||B+H>ye)return null;if(!N.Cc){if(N.ga==null){var pe;if(N.ga=new Ee,(pe=N.ga==null)||(pe=E.width*E.o,t(N.Gb.length==0),N.Gb=o(pe),N.Uc=0,N.Gb==null?pe=0:(N.mb=N.Gb,N.nb=N.Uc,N.rc=null,pe=1),pe=!pe),!pe){pe=N.ga;var Ne=N.Fa,Ie=N.P,qe=N.qc,kt=N.mb,Kt=N.nb,Be=Ie+1,It=qe-1,rr=pe.l;if(t(Ne!=null&&kt!=null&&E!=null),Ud[0]=null,Ud[1]=it,Ud[2]=Pt,Ud[3]=hr,pe.ca=kt,pe.tb=Kt,pe.c=E.width,pe.i=E.height,t(0<pe.c&&0<pe.i),1>=qe)E=0;else if(pe.$a=3&Ne[Ie+0],pe.Z=Ne[Ie+0]>>2&3,pe.Lc=Ne[Ie+0]>>4&3,Ie=Ne[Ie+0]>>6&3,0>pe.$a||1<pe.$a||4<=pe.Z||1<pe.Lc||Ie)E=0;else if(rr.put=Le,rr.ac=Fe,rr.bc=Ze,rr.ma=pe,rr.width=E.width,rr.height=E.height,rr.Da=E.Da,rr.v=E.v,rr.va=E.va,rr.j=E.j,rr.o=E.o,pe.$a)e:{t(pe.$a==1),E=Gn();t:for(;;){if(E==null){E=0;break e}if(t(pe!=null),pe.mc=E,E.c=pe.c,E.i=pe.i,E.l=pe.l,E.l.ma=pe,E.l.width=pe.c,E.l.height=pe.i,E.a=0,V(E.m,Ne,Be,It),!ta(pe.c,pe.i,1,E,null)||(E.ab==1&&E.gc[0].hc==3&&Ht(E.s)?(pe.ic=1,Ne=E.c*E.i,E.Ta=null,E.Ua=0,E.V=o(Ne),E.Ba=0,E.V==null?(E.a=1,E=0):E=1):(pe.ic=0,E=Aa(E,pe.c)),!E))break t;E=1;break e}pe.mc=null,E=0}else E=It>=pe.c*pe.i;pe=!E}if(pe)return null;N.ga.Lc!=1?N.Ga=0:H=ye-B}t(N.ga!=null),t(B+H<=ye);e:{if(E=(Ne=N.ga).c,ye=Ne.l.o,Ne.$a==0){if(Be=N.rc,It=N.Vc,rr=N.Fa,Ie=N.P+1+B*E,qe=N.mb,kt=N.nb+B*E,t(Ie<=N.P+N.qc),Ne.Z!=0)for(t(Ud[Ne.Z]!=null),pe=0;pe<H;++pe)Ud[Ne.Z](Be,It,rr,Ie,qe,kt,E),Be=qe,It=kt,kt+=E,Ie+=E;else for(pe=0;pe<H;++pe)n(qe,kt,rr,Ie,E),Be=qe,It=kt,kt+=E,Ie+=E;N.rc=Be,N.Vc=It}else{if(t(Ne.mc!=null),E=B+H,t((pe=Ne.mc)!=null),t(E<=pe.i),pe.C>=E)E=1;else if(Ne.ic||Xr(),Ne.ic){Ne=pe.V,Be=pe.Ba,It=pe.c;var $r=pe.i,ur=(rr=1,Ie=pe.$/It,qe=pe.$%It,kt=pe.m,Kt=pe.s,pe.$),Gr=It*$r,Zr=It*E,En=Kt.wc,bn=ur<Zr?ne(Kt,qe,Ie):null;t(ur<=Gr),t(E<=$r),t(Ht(Kt));t:for(;;){for(;!kt.h&&ur<Zr;){if(qe&En||(bn=ne(Kt,qe,Ie)),t(bn!=null),W(kt),256>($r=bt(bn.G[0],bn.H[0],kt)))Ne[Be+ur]=$r,++ur,++qe>=It&&(qe=0,++Ie<=E&&!(Ie%16)&&cr(pe,Ie));else{if(!(280>$r)){rr=0;break t}$r=mt($r-256,kt);var Ea,va=bt(bn.G[4],bn.H[4],kt);if(W(kt),!(ur>=(va=Qt(It,va=mt(va,kt)))&&Gr-ur>=$r)){rr=0;break t}for(Ea=0;Ea<$r;++Ea)Ne[Be+ur+Ea]=Ne[Be+ur+Ea-va];for(ur+=$r,qe+=$r;qe>=It;)qe-=It,++Ie<=E&&!(Ie%16)&&cr(pe,Ie);ur<Zr&&qe&En&&(bn=ne(Kt,qe,Ie))}t(kt.h==de(kt))}cr(pe,Ie>E?E:Ie);break t}!rr||kt.h&&ur<Gr?(rr=0,pe.a=kt.h?5:3):pe.$=ur,E=rr}else E=nn(pe,pe.V,pe.Ba,pe.c,pe.i,E,ke);if(!E){H=0;break e}}B+H>=ye&&(N.Cc=1),H=1}if(!H)return null;if(N.Cc&&((H=N.ga)!=null&&(H.mc=null),N.ga=null,0<N.Ga))return alert("todo:WebPDequantizeLevels"),null}return N.nb+B*ce}function Ar(N,E,B,H,ce,ye){for(;0<ce--;){var pe,Ne=N,Ie=E+(B?1:0),qe=N,kt=E+(B?0:3);for(pe=0;pe<H;++pe){var Kt=qe[kt+4*pe];Kt!=255&&(Kt*=32897,Ne[Ie+4*pe+0]=Ne[Ie+4*pe+0]*Kt>>23,Ne[Ie+4*pe+1]=Ne[Ie+4*pe+1]*Kt>>23,Ne[Ie+4*pe+2]=Ne[Ie+4*pe+2]*Kt>>23)}E+=ye}}function Cr(N,E,B,H,ce){for(;0<H--;){var ye;for(ye=0;ye<B;++ye){var pe=N[E+2*ye+0],Ne=15&(qe=N[E+2*ye+1]),Ie=4369*Ne,qe=(240&qe|qe>>4)*Ie>>16;N[E+2*ye+0]=(240&pe|pe>>4)*Ie>>16&240|(15&pe|pe<<4)*Ie>>16>>4&15,N[E+2*ye+1]=240&qe|Ne}E+=ce}}function Lt(N,E,B,H,ce,ye,pe,Ne){var Ie,qe,kt=255;for(qe=0;qe<ce;++qe){for(Ie=0;Ie<H;++Ie){var Kt=N[E+Ie];ye[pe+4*Ie]=Kt,kt&=Kt}E+=B,pe+=Ne}return kt!=255}function vn(N,E,B,H,ce){var ye;for(ye=0;ye<ce;++ye)B[H+ye]=N[E+ye]>>8}function Xr(){jt=Ar,Ve=Cr,Bt=Lt,Yt=vn}function Or(N,E,B){P[N]=function(H,ce,ye,pe,Ne,Ie,qe,kt,Kt,Be,It,rr,$r,ur,Gr,Zr,En){var bn,Ea=En-1>>1,va=Ne[Ie+0]|qe[kt+0]<<16,gs=Kt[Be+0]|It[rr+0]<<16;t(H!=null);var Na=3*va+gs+131074>>2;for(E(H[ce+0],255&Na,Na>>16,$r,ur),ye!=null&&(Na=3*gs+va+131074>>2,E(ye[pe+0],255&Na,Na>>16,Gr,Zr)),bn=1;bn<=Ea;++bn){var Os=Ne[Ie+bn]|qe[kt+bn]<<16,Ri=Kt[Be+bn]|It[rr+bn]<<16,xs=va+Os+gs+Ri+524296,Sa=xs+2*(Os+gs)>>3;Na=Sa+va>>1,va=(xs=xs+2*(va+Ri)>>3)+Os>>1,E(H[ce+2*bn-1],255&Na,Na>>16,$r,ur+(2*bn-1)*B),E(H[ce+2*bn-0],255&va,va>>16,$r,ur+(2*bn-0)*B),ye!=null&&(Na=xs+gs>>1,va=Sa+Ri>>1,E(ye[pe+2*bn-1],255&Na,Na>>16,Gr,Zr+(2*bn-1)*B),E(ye[pe+2*bn+0],255&va,va>>16,Gr,Zr+(2*bn+0)*B)),va=Os,gs=Ri}1&En||(Na=3*va+gs+131074>>2,E(H[ce+En-1],255&Na,Na>>16,$r,ur+(En-1)*B),ye!=null&&(Na=3*gs+va+131074>>2,E(ye[pe+En-1],255&Na,Na>>16,Gr,Zr+(En-1)*B)))}}function _n(){Qi[Do]=Re,Qi[Ta]=Ft,Qi[Kn]=pt,Qi[ao]=Jt,Qi[Ms]=pr,Qi[bs]=Qr,Qi[Xn]=kn,Qi[pa]=Ft,Qi[ps]=Jt,Qi[qs]=pr,Qi[Ji]=Qr}function fr(N){return N&~Ni?0>N?0:255:N>>ca}function dn(N,E){return fr((19077*N>>8)+(26149*E>>8)-14234)}function Dr(N,E,B){return fr((19077*N>>8)-(6419*E>>8)-(13320*B>>8)+8708)}function wr(N,E){return fr((19077*N>>8)+(33050*E>>8)-17685)}function Jr(N,E,B,H,ce){H[ce+0]=dn(N,B),H[ce+1]=Dr(N,E,B),H[ce+2]=wr(N,E)}function Mn(N,E,B,H,ce){H[ce+0]=wr(N,E),H[ce+1]=Dr(N,E,B),H[ce+2]=dn(N,B)}function ha(N,E,B,H,ce){var ye=Dr(N,E,B);E=ye<<3&224|wr(N,E)>>3,H[ce+0]=248&dn(N,B)|ye>>5,H[ce+1]=E}function is(N,E,B,H,ce){var ye=240&wr(N,E)|15;H[ce+0]=240&dn(N,B)|Dr(N,E,B)>>4,H[ce+1]=ye}function Gs(N,E,B,H,ce){H[ce+0]=255,Jr(N,E,B,H,ce+1)}function jn(N,E,B,H,ce){Mn(N,E,B,H,ce),H[ce+3]=255}function Nr(N,E,B,H,ce){Jr(N,E,B,H,ce),H[ce+3]=255}function an(N,E){return 0>N?0:N>E?E:N}function Nn(N,E,B){P[N]=function(H,ce,ye,pe,Ne,Ie,qe,kt,Kt){for(var Be=kt+(-2&Kt)*B;kt!=Be;)E(H[ce+0],ye[pe+0],Ne[Ie+0],qe,kt),E(H[ce+1],ye[pe+0],Ne[Ie+0],qe,kt+B),ce+=2,++pe,++Ie,kt+=2*B;1&Kt&&E(H[ce+0],ye[pe+0],Ne[Ie+0],qe,kt)}}function Sn(N,E,B){return B==0?N==0?E==0?6:5:E==0?4:0:B}function hn(N,E,B,H,ce){switch(N>>>30){case 3:$a(E,B,H,ce,0);break;case 2:js(E,B,H,ce);break;case 1:Ia(E,B,H,ce)}}function Pr(N,E){var B,H,ce=E.M,ye=E.Nb,pe=N.oc,Ne=N.pc+40,Ie=N.oc,qe=N.pc+584,kt=N.oc,Kt=N.pc+600;for(B=0;16>B;++B)pe[Ne+32*B-1]=129;for(B=0;8>B;++B)Ie[qe+32*B-1]=129,kt[Kt+32*B-1]=129;for(0<ce?pe[Ne-1-32]=Ie[qe-1-32]=kt[Kt-1-32]=129:(s(pe,Ne-32-1,127,21),s(Ie,qe-32-1,127,9),s(kt,Kt-32-1,127,9)),H=0;H<N.za;++H){var Be=E.ya[E.aa+H];if(0<H){for(B=-1;16>B;++B)n(pe,Ne+32*B-4,pe,Ne+32*B+12,4);for(B=-1;8>B;++B)n(Ie,qe+32*B-4,Ie,qe+32*B+4,4),n(kt,Kt+32*B-4,kt,Kt+32*B+4,4)}var It=N.Gd,rr=N.Hd+H,$r=Be.ad,ur=Be.Hc;if(0<ce&&(n(pe,Ne-32,It[rr].y,0,16),n(Ie,qe-32,It[rr].f,0,8),n(kt,Kt-32,It[rr].ea,0,8)),Be.Za){var Gr=pe,Zr=Ne-32+16;for(0<ce&&(H>=N.za-1?s(Gr,Zr,It[rr].y[15],4):n(Gr,Zr,It[rr+1].y,0,4)),B=0;4>B;B++)Gr[Zr+128+B]=Gr[Zr+256+B]=Gr[Zr+384+B]=Gr[Zr+0+B];for(B=0;16>B;++B,ur<<=2)Gr=pe,Zr=Ne+go[B],sd[Be.Ob[B]](Gr,Zr),hn(ur,$r,16*+B,Gr,Zr)}else if(Gr=Sn(H,ce,Be.Ob[0]),jf[Gr](pe,Ne),ur!=0)for(B=0;16>B;++B,ur<<=2)hn(ur,$r,16*+B,pe,Ne+go[B]);for(B=Be.Gc,Gr=Sn(H,ce,Be.Dd),Tu[Gr](Ie,qe),Tu[Gr](kt,Kt),ur=$r,Gr=Ie,Zr=qe,255&(Be=0|B)&&(170&Be?no(ur,256,Gr,Zr):Ra(ur,256,Gr,Zr)),Be=kt,ur=Kt,255&(B>>=8)&&(170&B?no($r,320,Be,ur):Ra($r,320,Be,ur)),ce<N.Ub-1&&(n(It[rr].y,0,pe,Ne+480,16),n(It[rr].f,0,Ie,qe+224,8),n(It[rr].ea,0,kt,Kt+224,8)),B=8*ye*N.B,It=N.sa,rr=N.ta+16*H+16*ye*N.R,$r=N.qa,Be=N.ra+8*H+B,ur=N.Ha,Gr=N.Ia+8*H+B,B=0;16>B;++B)n(It,rr+B*N.R,pe,Ne+32*B,16);for(B=0;8>B;++B)n($r,Be+B*N.B,Ie,qe+32*B,8),n(ur,Gr+B*N.B,kt,Kt+32*B,8)}}function pn(N,E,B,H,ce,ye,pe,Ne,Ie){var qe=[0],kt=[0],Kt=0,Be=Ie!=null?Ie.kd:0,It=Ie??new zr;if(N==null||12>B)return 7;It.data=N,It.w=E,It.ha=B,E=[E],B=[B],It.gb=[It.gb];e:{var rr=E,$r=B,ur=It.gb;if(t(N!=null),t($r!=null),t(ur!=null),ur[0]=0,12<=$r[0]&&!r(N,rr[0],"RIFF")){if(r(N,rr[0]+8,"WEBP")){ur=3;break e}var Gr=te(N,rr[0]+4);if(12>Gr||4294967286<Gr){ur=3;break e}if(Be&&Gr>$r[0]-8){ur=7;break e}ur[0]=Gr,rr[0]+=12,$r[0]-=12}ur=0}if(ur!=0)return ur;for(Gr=0<It.gb[0],B=B[0];;){e:{var Zr=N;$r=E,ur=B;var En=qe,bn=kt,Ea=rr=[0];if((Na=Kt=[Kt])[0]=0,8>ur[0])ur=7;else{if(!r(Zr,$r[0],"VP8X")){if(te(Zr,$r[0]+4)!=10){ur=3;break e}if(18>ur[0]){ur=7;break e}var va=te(Zr,$r[0]+8),gs=1+Te(Zr,$r[0]+12);if(2147483648<=gs*(Zr=1+Te(Zr,$r[0]+15))){ur=3;break e}Ea!=null&&(Ea[0]=va),En!=null&&(En[0]=gs),bn!=null&&(bn[0]=Zr),$r[0]+=18,ur[0]-=18,Na[0]=1}ur=0}}if(Kt=Kt[0],rr=rr[0],ur!=0)return ur;if($r=!!(2&rr),!Gr&&Kt)return 3;if(ye!=null&&(ye[0]=!!(16&rr)),pe!=null&&(pe[0]=$r),Ne!=null&&(Ne[0]=0),pe=qe[0],rr=kt[0],Kt&&$r&&Ie==null){ur=0;break}if(4>B){ur=7;break}if(Gr&&Kt||!Gr&&!Kt&&!r(N,E[0],"ALPH")){B=[B],It.na=[It.na],It.P=[It.P],It.Sa=[It.Sa];e:{va=N,ur=E,Gr=B;var Na=It.gb;En=It.na,bn=It.P,Ea=It.Sa,gs=22,t(va!=null),t(Gr!=null),Zr=ur[0];var Os=Gr[0];for(t(En!=null),t(Ea!=null),En[0]=null,bn[0]=null,Ea[0]=0;;){if(ur[0]=Zr,Gr[0]=Os,8>Os){ur=7;break e}var Ri=te(va,Zr+4);if(4294967286<Ri){ur=3;break e}var xs=8+Ri+1&-2;if(gs+=xs,0<Na&&gs>Na){ur=3;break e}if(!r(va,Zr,"VP8 ")||!r(va,Zr,"VP8L")){ur=0;break e}if(Os[0]<xs){ur=7;break e}r(va,Zr,"ALPH")||(En[0]=va,bn[0]=Zr+8,Ea[0]=Ri),Zr+=xs,Os-=xs}}if(B=B[0],It.na=It.na[0],It.P=It.P[0],It.Sa=It.Sa[0],ur!=0)break}B=[B],It.Ja=[It.Ja],It.xa=[It.xa];e:if(Na=N,ur=E,Gr=B,En=It.gb[0],bn=It.Ja,Ea=It.xa,va=ur[0],Zr=!r(Na,va,"VP8 "),gs=!r(Na,va,"VP8L"),t(Na!=null),t(Gr!=null),t(bn!=null),t(Ea!=null),8>Gr[0])ur=7;else{if(Zr||gs){if(Na=te(Na,va+4),12<=En&&Na>En-12){ur=3;break e}if(Be&&Na>Gr[0]-8){ur=7;break e}bn[0]=Na,ur[0]+=8,Gr[0]-=8,Ea[0]=gs}else Ea[0]=5<=Gr[0]&&Na[va+0]==47&&!(Na[va+4]>>5),bn[0]=Gr[0];ur=0}if(B=B[0],It.Ja=It.Ja[0],It.xa=It.xa[0],E=E[0],ur!=0)break;if(4294967286<It.Ja)return 3;if(Ne==null||$r||(Ne[0]=It.xa?2:1),pe=[pe],rr=[rr],It.xa){if(5>B){ur=7;break}Ne=pe,Be=rr,$r=ye,N==null||5>B?N=0:5<=B&&N[E+0]==47&&!(N[E+4]>>5)?(Gr=[0],Na=[0],En=[0],V(bn=new L,N,E,B),Ot(bn,Gr,Na,En)?(Ne!=null&&(Ne[0]=Gr[0]),Be!=null&&(Be[0]=Na[0]),$r!=null&&($r[0]=En[0]),N=1):N=0):N=0}else{if(10>B){ur=7;break}Ne=rr,N==null||10>B||!wa(N,E+3,B-3)?N=0:(Be=N[E+0]|N[E+1]<<8|N[E+2]<<16,$r=16383&(N[E+7]<<8|N[E+6]),N=16383&(N[E+9]<<8|N[E+8]),1&Be||3<(Be>>1&7)||!(Be>>4&1)||Be>>5>=It.Ja||!$r||!N?N=0:(pe&&(pe[0]=$r),Ne&&(Ne[0]=N),N=1))}if(!N||(pe=pe[0],rr=rr[0],Kt&&(qe[0]!=pe||kt[0]!=rr)))return 3;Ie!=null&&(Ie[0]=It,Ie.offset=E-Ie.w,t(4294967286>E-Ie.w),t(Ie.offset==Ie.ha-B));break}return ur==0||ur==7&&Kt&&Ie==null?(ye!=null&&(ye[0]|=It.na!=null&&0<It.na.length),H!=null&&(H[0]=pe),ce!=null&&(ce[0]=rr),0):ur}function vr(N,E,B){var H=E.width,ce=E.height,ye=0,pe=0,Ne=H,Ie=ce;if(E.Da=N!=null&&0<N.Da,E.Da&&(Ne=N.cd,Ie=N.bd,ye=N.v,pe=N.j,11>B||(ye&=-2,pe&=-2),0>ye||0>pe||0>=Ne||0>=Ie||ye+Ne>H||pe+Ie>ce))return 0;if(E.v=ye,E.j=pe,E.va=ye+Ne,E.o=pe+Ie,E.U=Ne,E.T=Ie,E.da=N!=null&&0<N.da,E.da){if(!dt(Ne,Ie,B=[N.ib],ye=[N.hb]))return 0;E.ib=B[0],E.hb=ye[0]}return E.ob=N!=null&&N.ob,E.Kb=N==null||!N.Sd,E.da&&(E.ob=E.ib<3*H/4&&E.hb<3*ce/4,E.Kb=0),1}function kr(N){if(N==null)return 2;if(11>N.S){var E=N.f.RGBA;E.fb+=(N.height-1)*E.A,E.A=-E.A}else E=N.f.kb,N=N.height,E.O+=(N-1)*E.fa,E.fa=-E.fa,E.N+=(N-1>>1)*E.Ab,E.Ab=-E.Ab,E.W+=(N-1>>1)*E.Db,E.Db=-E.Db,E.F!=null&&(E.J+=(N-1)*E.lb,E.lb=-E.lb);return 0}function Vr(N,E,B,H){if(H==null||0>=N||0>=E)return 2;if(B!=null){if(B.Da){var ce=B.cd,ye=B.bd,pe=-2&B.v,Ne=-2&B.j;if(0>pe||0>Ne||0>=ce||0>=ye||pe+ce>N||Ne+ye>E)return 2;N=ce,E=ye}if(B.da){if(!dt(N,E,ce=[B.ib],ye=[B.hb]))return 2;N=ce[0],E=ye[0]}}H.width=N,H.height=E;e:{var Ie=H.width,qe=H.height;if(N=H.S,0>=Ie||0>=qe||!(N>=Do&&13>N))N=2;else{if(0>=H.Rd&&H.sd==null){pe=ye=ce=E=0;var kt=(Ne=Ie*Is[N])*qe;if(11>N||(ye=(qe+1)/2*(E=(Ie+1)/2),N==12&&(pe=(ce=Ie)*qe)),(qe=o(kt+2*ye+pe))==null){N=1;break e}H.sd=qe,11>N?((Ie=H.f.RGBA).eb=qe,Ie.fb=0,Ie.A=Ne,Ie.size=kt):((Ie=H.f.kb).y=qe,Ie.O=0,Ie.fa=Ne,Ie.Fd=kt,Ie.f=qe,Ie.N=0+kt,Ie.Ab=E,Ie.Cd=ye,Ie.ea=qe,Ie.W=0+kt+ye,Ie.Db=E,Ie.Ed=ye,N==12&&(Ie.F=qe,Ie.J=0+kt+2*ye),Ie.Tc=pe,Ie.lb=ce)}if(E=1,ce=H.S,ye=H.width,pe=H.height,ce>=Do&&13>ce)if(11>ce)N=H.f.RGBA,E&=(Ne=Math.abs(N.A))*(pe-1)+ye<=N.size,E&=Ne>=ye*Is[ce],E&=N.eb!=null;else{N=H.f.kb,Ne=(ye+1)/2,kt=(pe+1)/2,Ie=Math.abs(N.fa),qe=Math.abs(N.Ab);var Kt=Math.abs(N.Db),Be=Math.abs(N.lb),It=Be*(pe-1)+ye;E&=Ie*(pe-1)+ye<=N.Fd,E&=qe*(kt-1)+Ne<=N.Cd,E=(E&=Kt*(kt-1)+Ne<=N.Ed)&Ie>=ye&qe>=Ne&Kt>=Ne,E&=N.y!=null,E&=N.f!=null,E&=N.ea!=null,ce==12&&(E&=Be>=ye,E&=It<=N.Tc,E&=N.F!=null)}else E=0;N=E?0:2}}return N!=0||B!=null&&B.fd&&(N=kr(H)),N}var Ir=64,re=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],we=24,Ge=32,ge=8,nt=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];_t("Predictor0","PredictorAdd0"),P.Predictor0=function(){return 4278190080},P.Predictor1=function(N){return N},P.Predictor2=function(N,E,B){return E[B+0]},P.Predictor3=function(N,E,B){return E[B+1]},P.Predictor4=function(N,E,B){return E[B-1]},P.Predictor5=function(N,E,B){return be(be(N,E[B+1]),E[B+0])},P.Predictor6=function(N,E,B){return be(N,E[B-1])},P.Predictor7=function(N,E,B){return be(N,E[B+0])},P.Predictor8=function(N,E,B){return be(E[B-1],E[B+0])},P.Predictor9=function(N,E,B){return be(E[B+0],E[B+1])},P.Predictor10=function(N,E,B){return be(be(N,E[B-1]),be(E[B+0],E[B+1]))},P.Predictor11=function(N,E,B){var H=E[B+0];return 0>=_r(H>>24&255,N>>24&255,(E=E[B-1])>>24&255)+_r(H>>16&255,N>>16&255,E>>16&255)+_r(H>>8&255,N>>8&255,E>>8&255)+_r(255&H,255&N,255&E)?H:N},P.Predictor12=function(N,E,B){var H=E[B+0];return(Nt((N>>24&255)+(H>>24&255)-((E=E[B-1])>>24&255))<<24|Nt((N>>16&255)+(H>>16&255)-(E>>16&255))<<16|Nt((N>>8&255)+(H>>8&255)-(E>>8&255))<<8|Nt((255&N)+(255&H)-(255&E)))>>>0},P.Predictor13=function(N,E,B){var H=E[B-1];return(Wt((N=be(N,E[B+0]))>>24&255,H>>24&255)<<24|Wt(N>>16&255,H>>16&255)<<16|Wt(N>>8&255,H>>8&255)<<8|Wt(255&N,255&H))>>>0};var st=P.PredictorAdd0;P.PredictorAdd1=yr,_t("Predictor2","PredictorAdd2"),_t("Predictor3","PredictorAdd3"),_t("Predictor4","PredictorAdd4"),_t("Predictor5","PredictorAdd5"),_t("Predictor6","PredictorAdd6"),_t("Predictor7","PredictorAdd7"),_t("Predictor8","PredictorAdd8"),_t("Predictor9","PredictorAdd9"),_t("Predictor10","PredictorAdd10"),_t("Predictor11","PredictorAdd11"),_t("Predictor12","PredictorAdd12"),_t("Predictor13","PredictorAdd13");var je=P.PredictorAdd2;$t("ColorIndexInverseTransform","MapARGB","32b",function(N){return N>>8&255},function(N){return N}),$t("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(N){return N},function(N){return N>>8&255});var ht,rt=P.ColorIndexInverseTransform,nr=P.MapARGB,yn=P.VP8LColorIndexInverseTransformAlpha,fn=P.MapAlpha,Ln=P.VP8LPredictorsAdd=[];Ln.length=16,(P.VP8LPredictors=[]).length=16,(P.VP8LPredictorsAdd_C=[]).length=16,(P.VP8LPredictors_C=[]).length=16;var On,ma,Ja,Bs,na,ia,ja,$a,js,no,Ia,Ra,fs,Js,yo,ai,D,K,he,Xe,Ue,Et,Dt,Mt,jt,Ve,Bt,Yt,Ur=o(511),jr=o(2041),mn=o(225),en=o(767),Yr=0,gn=jr,Yn=mn,Hn=en,ns=Ur,Do=0,Ta=1,Kn=2,ao=3,Ms=4,bs=5,Xn=6,pa=7,ps=8,qs=9,Ji=10,kc=[2,3,7],Ml=[3,3,11],ba=[280,256,256,256,40],Qa=[0,1,1,1,0],so=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],_i=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],nd=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ad=8,Rl=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Iu=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ou=null,Ic=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Rj=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],qp=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],GP=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],wf=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Fj=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],KP=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],jf=[],sd=[],Tu=[],Lj=1,Iy=2,Ud=[],Qi=[];Or("UpsampleRgbLinePair",Jr,3),Or("UpsampleBgrLinePair",Mn,3),Or("UpsampleRgbaLinePair",Nr,4),Or("UpsampleBgraLinePair",jn,4),Or("UpsampleArgbLinePair",Gs,4),Or("UpsampleRgba4444LinePair",is,2),Or("UpsampleRgb565LinePair",ha,2);var Re=P.UpsampleRgbLinePair,pt=P.UpsampleBgrLinePair,Ft=P.UpsampleRgbaLinePair,Jt=P.UpsampleBgraLinePair,pr=P.UpsampleArgbLinePair,Qr=P.UpsampleRgba4444LinePair,kn=P.UpsampleRgb565LinePair,An=16,Fa=1<<An-1,ws=-227,as=482,ca=6,Ni=(256<<ca)-1,Zi=0,Fl=o(256),Vd=o(256),nc=o(256),Wd=o(256),rh=o(as-ws),zs=o(as-ws);Nn("YuvToRgbRow",Jr,3),Nn("YuvToBgrRow",Mn,3),Nn("YuvToRgbaRow",Nr,4),Nn("YuvToBgraRow",jn,4),Nn("YuvToArgbRow",Gs,4),Nn("YuvToRgba4444Row",is,2),Nn("YuvToRgb565Row",ha,2);var go=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ll=[0,2,8],mi=[8,7,6,4,4,2,2,2,1,1,1,1],ac=1;this.WebPDecodeRGBA=function(N,E,B,H,ce){var ye=Ta,pe=new Ut,Ne=new Wr;pe.ba=Ne,Ne.S=ye,Ne.width=[Ne.width],Ne.height=[Ne.height];var Ie=Ne.width,qe=Ne.height,kt=new qr;if(kt==null||N==null)var Kt=2;else t(kt!=null),Kt=pn(N,E,B,kt.width,kt.height,kt.Pd,kt.Qd,kt.format,null);if(Kt!=0?Ie=0:(Ie!=null&&(Ie[0]=kt.width[0]),qe!=null&&(qe[0]=kt.height[0]),Ie=1),Ie){Ne.width=Ne.width[0],Ne.height=Ne.height[0],H!=null&&(H[0]=Ne.width),ce!=null&&(ce[0]=Ne.height);e:{if(H=new on,(ce=new zr).data=N,ce.w=E,ce.ha=B,ce.kd=1,E=[0],t(ce!=null),((N=pn(ce.data,ce.w,ce.ha,null,null,null,E,null,ce))==0||N==7)&&E[0]&&(N=4),(E=N)==0){if(t(pe!=null),H.data=ce.data,H.w=ce.w+ce.offset,H.ha=ce.ha-ce.offset,H.put=Le,H.ac=Fe,H.bc=Ze,H.ma=pe,ce.xa){if((N=Gn())==null){pe=1;break e}if(function(Be,It){var rr=[0],$r=[0],ur=[0];t:for(;;){if(Be==null)return 0;if(It==null)return Be.a=2,0;if(Be.l=It,Be.a=0,V(Be.m,It.data,It.w,It.ha),!Ot(Be.m,rr,$r,ur)){Be.a=3;break t}if(Be.xb=Iy,It.width=rr[0],It.height=$r[0],!ta(rr[0],$r[0],1,Be,null))break t;return 1}return t(Be.a!=0),0}(N,H)){if(H=(E=Vr(H.width,H.height,pe.Oa,pe.ba))==0){t:{H=N;r:for(;;){if(H==null){H=0;break t}if(t(H.s.yc!=null),t(H.s.Ya!=null),t(0<H.s.Wb),t((B=H.l)!=null),t((ce=B.ma)!=null),H.xb!=0){if(H.ca=ce.ba,H.tb=ce.tb,t(H.ca!=null),!vr(ce.Oa,B,ao)){H.a=2;break r}if(!Aa(H,B.width)||B.da)break r;if((B.da||sr(H.ca.S))&&Xr(),11>H.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),H.ca.f.kb.F!=null&&Xr()),H.Pb&&0<H.s.ua&&H.s.vb.X==null&&!ie(H.s.vb,H.s.Wa.Xa)){H.a=1;break r}H.xb=0}if(!nn(H,H.V,H.Ba,H.c,H.i,B.o,Gt))break r;ce.Dc=H.Ma,H=1;break t}t(H.a!=0),H=0}H=!H}H&&(E=N.a)}else E=N.a}else{if((N=new ua)==null){pe=1;break e}if(N.Fa=ce.na,N.P=ce.P,N.qc=ce.Sa,Va(N,H)){if((E=Vr(H.width,H.height,pe.Oa,pe.ba))==0){if(N.Aa=0,B=pe.Oa,t((ce=N)!=null),B!=null){if(0<(Ie=0>(Ie=B.Md)?0:100<Ie?255:255*Ie/100)){for(qe=kt=0;4>qe;++qe)12>(Kt=ce.pb[qe]).lc&&(Kt.ia=Ie*mi[0>Kt.lc?0:Kt.lc]>>3),kt|=Kt.ia;kt&&(alert("todo:VP8InitRandom"),ce.ia=1)}ce.Ga=B.Id,100<ce.Ga?ce.Ga=100:0>ce.Ga&&(ce.Ga=0)}(function(Be,It){if(Be==null)return 0;if(It==null)return sa(Be,2,"NULL VP8Io parameter in VP8Decode().");if(!Be.cb&&!Va(Be,It))return 0;if(t(Be.cb),It.ac==null||It.ac(It)){It.ob&&(Be.L=0);var rr=Ll[Be.L];if(Be.L==2?(Be.yb=0,Be.zb=0):(Be.yb=It.v-rr>>4,Be.zb=It.j-rr>>4,0>Be.yb&&(Be.yb=0),0>Be.zb&&(Be.zb=0)),Be.Va=It.o+15+rr>>4,Be.Hb=It.va+15+rr>>4,Be.Hb>Be.za&&(Be.Hb=Be.za),Be.Va>Be.Ub&&(Be.Va=Be.Ub),0<Be.L){var $r=Be.ed;for(rr=0;4>rr;++rr){var ur;if(Be.Qa.Cb){var Gr=Be.Qa.Lb[rr];Be.Qa.Fb||(Gr+=$r.Tb)}else Gr=$r.Tb;for(ur=0;1>=ur;++ur){var Zr=Be.gd[rr][ur],En=Gr;if($r.Pc&&(En+=$r.vd[0],ur&&(En+=$r.od[0])),0<(En=0>En?0:63<En?63:En)){var bn=En;0<$r.wb&&(bn=4<$r.wb?bn>>2:bn>>1)>9-$r.wb&&(bn=9-$r.wb),1>bn&&(bn=1),Zr.dd=bn,Zr.tc=2*En+bn,Zr.ld=40<=En?2:15<=En?1:0}else Zr.tc=0;Zr.La=ur}}}rr=0}else sa(Be,6,"Frame setup failed"),rr=Be.a;if(rr=rr==0){if(rr){Be.$c=0,0<Be.Aa||(Be.Ic=ac);t:{rr=Be.Ic,$r=4*(bn=Be.za);var Ea=32*bn,va=bn+1,gs=0<Be.L?bn*(0<Be.Aa?2:1):0,Na=(Be.Aa==2?2:1)*bn;if((Zr=$r+832+(ur=3*(16*rr+Ll[Be.L])/2*Ea)+(Gr=Be.Fa!=null&&0<Be.Fa.length?Be.Kc.c*Be.Kc.i:0))!=Zr)rr=0;else{if(Zr>Be.Vb){if(Be.Vb=0,Be.Ec=o(Zr),Be.Fc=0,Be.Ec==null){rr=sa(Be,1,"no memory during frame initialization.");break t}Be.Vb=Zr}Zr=Be.Ec,En=Be.Fc,Be.Ac=Zr,Be.Bc=En,En+=$r,Be.Gd=i(Ea,Wn),Be.Hd=0,Be.rb=i(va+1,Ye),Be.sb=1,Be.wa=gs?i(gs,lr):null,Be.Y=0,Be.D.Nb=0,Be.D.wa=Be.wa,Be.D.Y=Be.Y,0<Be.Aa&&(Be.D.Y+=bn),t(!0),Be.oc=Zr,Be.pc=En,En+=832,Be.ya=i(Na,Xt),Be.aa=0,Be.D.ya=Be.ya,Be.D.aa=Be.aa,Be.Aa==2&&(Be.D.aa+=bn),Be.R=16*bn,Be.B=8*bn,bn=(Ea=Ll[Be.L])*Be.R,Ea=Ea/2*Be.B,Be.sa=Zr,Be.ta=En+bn,Be.qa=Be.sa,Be.ra=Be.ta+16*rr*Be.R+Ea,Be.Ha=Be.qa,Be.Ia=Be.ra+8*rr*Be.B+Ea,Be.$c=0,En+=ur,Be.mb=Gr?Zr:null,Be.nb=Gr?En:null,t(En+Gr<=Be.Fc+Be.Vb),Oe(Be),s(Be.Ac,Be.Bc,0,$r),rr=1}}if(rr){if(It.ka=0,It.y=Be.sa,It.O=Be.ta,It.f=Be.qa,It.N=Be.ra,It.ea=Be.Ha,It.Vd=Be.Ia,It.fa=Be.R,It.Rc=Be.B,It.F=null,It.J=0,!Yr){for(rr=-255;255>=rr;++rr)Ur[255+rr]=0>rr?-rr:rr;for(rr=-1020;1020>=rr;++rr)jr[1020+rr]=-128>rr?-128:127<rr?127:rr;for(rr=-112;112>=rr;++rr)mn[112+rr]=-16>rr?-16:15<rr?15:rr;for(rr=-255;510>=rr;++rr)en[255+rr]=0>rr?0:255<rr?255:rr;Yr=1}ja=Ke,$a=In,no=ln,Ia=Kr,Ra=oe,js=ir,fs=ku,Js=xl,yo=R,ai=fe,D=Yi,K=vl,he=We,Xe=gt,Ue=Tl,Et=As,Dt=rc,Mt=Ns,sd[0]=fa,sd[1]=xe,sd[2]=un,sd[3]=Dn,sd[4]=Oa,sd[5]=Un,sd[6]=us,sd[7]=Ya,sd[8]=po,sd[9]=$s,jf[0]=dr,jf[1]=Pe,jf[2]=Vt,jf[3]=yt,jf[4]=tn,jf[5]=Lr,jf[6]=da,Tu[0]=ec,Tu[1]=$e,Tu[2]=wi,Tu[3]=zo,Tu[4]=pl,Tu[5]=rd,Tu[6]=Eu,rr=1}else rr=0}rr&&(rr=function(Os,Ri){for(Os.M=0;Os.M<Os.Va;++Os.M){var xs,Sa=Os.Jc[Os.M&Os.Xb],Zn=Os.m,hi=Os;for(xs=0;xs<hi.za;++xs){var ms=Zn,Rs=hi,Mo=Rs.Ac,yl=Rs.Bc+4*xs,sc=Rs.zc,si=Rs.ya[Rs.aa+xs];if(Rs.Qa.Bb?si.$b=ee(ms,Rs.Pa.jb[0])?2+ee(ms,Rs.Pa.jb[2]):ee(ms,Rs.Pa.jb[1]):si.$b=0,Rs.kc&&(si.Ad=ee(ms,Rs.Bd)),si.Za=!ee(ms,145)+0,si.Za){var $l=si.Ob,oc=0;for(Rs=0;4>Rs;++Rs){var Fi,Us=sc[0+Rs];for(Fi=0;4>Fi;++Fi){Us=wf[Mo[yl+Fi]][Us];for(var oo=qp[ee(ms,Us[0])];0<oo;)oo=qp[2*oo+ee(ms,Us[oo])];Us=-oo,Mo[yl+Fi]=Us}n($l,oc,Mo,yl,4),oc+=4,sc[0+Rs]=Us}}else Us=ee(ms,156)?ee(ms,128)?1:3:ee(ms,163)?2:0,si.Ob[0]=Us,s(Mo,yl,Us,4),s(sc,0,Us,4);si.Dd=ee(ms,142)?ee(ms,114)?ee(ms,183)?1:3:2:0}if(hi.m.Ka)return sa(Os,7,"Premature end-of-partition0 encountered.");for(;Os.ja<Os.za;++Os.ja){if(hi=Sa,ms=(Zn=Os).rb[Zn.sb-1],Mo=Zn.rb[Zn.sb+Zn.ja],xs=Zn.ya[Zn.aa+Zn.ja],yl=Zn.kc?xs.Ad:0)ms.la=Mo.la=0,xs.Za||(ms.Na=Mo.Na=0),xs.Hc=0,xs.Gc=0,xs.ia=0;else{var oi,io;if(ms=Mo,Mo=hi,yl=Zn.Pa.Xc,sc=Zn.ya[Zn.aa+Zn.ja],si=Zn.pb[sc.$b],Rs=sc.ad,$l=0,oc=Zn.rb[Zn.sb-1],Us=Fi=0,s(Rs,$l,0,384),sc.Za)var bl=0,Du=yl[3];else{oo=o(16);var pi=ms.Na+oc.Na;if(pi=Ou(Mo,yl[1],pi,si.Eb,0,oo,0),ms.Na=oc.Na=(0<pi)+0,1<pi)ja(oo,0,Rs,$l);else{var Oc=oo[0]+3>>3;for(oo=0;256>oo;oo+=16)Rs[$l+oo]=Oc}bl=1,Du=yl[0]}var bo=15&ms.la,Li=15&oc.la;for(oo=0;4>oo;++oo){var od=1&Li;for(Oc=io=0;4>Oc;++Oc)bo=bo>>1|(od=(pi=Ou(Mo,Du,pi=od+(1&bo),si.Sc,bl,Rs,$l))>bl)<<7,io=io<<2|(3<pi?3:1<pi?2:Rs[$l+0]!=0),$l+=16;bo>>=4,Li=Li>>1|od<<7,Fi=(Fi<<8|io)>>>0}for(Du=bo,bl=Li>>4,oi=0;4>oi;oi+=2){for(io=0,bo=ms.la>>4+oi,Li=oc.la>>4+oi,oo=0;2>oo;++oo){for(od=1&Li,Oc=0;2>Oc;++Oc)pi=od+(1&bo),bo=bo>>1|(od=0<(pi=Ou(Mo,yl[2],pi,si.Qc,0,Rs,$l)))<<3,io=io<<2|(3<pi?3:1<pi?2:Rs[$l+0]!=0),$l+=16;bo>>=2,Li=Li>>1|od<<5}Us|=io<<4*oi,Du|=bo<<4<<oi,bl|=(240&Li)<<oi}ms.la=Du,oc.la=bl,sc.Hc=Fi,sc.Gc=Us,sc.ia=43690&Us?0:si.ia,yl=!(Fi|Us)}if(0<Zn.L&&(Zn.wa[Zn.Y+Zn.ja]=Zn.gd[xs.$b][xs.Za],Zn.wa[Zn.Y+Zn.ja].La|=!yl),hi.Ka)return sa(Os,7,"Premature end-of-file encountered.")}if(Oe(Os),Zn=Ri,hi=1,xs=(Sa=Os).D,ms=0<Sa.L&&Sa.M>=Sa.zb&&Sa.M<=Sa.Va,Sa.Aa==0)t:{if(xs.M=Sa.M,xs.uc=ms,Pr(Sa,xs),hi=1,xs=(io=Sa.D).Nb,ms=(Us=Ll[Sa.L])*Sa.R,Mo=Us/2*Sa.B,oo=16*xs*Sa.R,Oc=8*xs*Sa.B,yl=Sa.sa,sc=Sa.ta-ms+oo,si=Sa.qa,Rs=Sa.ra-Mo+Oc,$l=Sa.Ha,oc=Sa.Ia-Mo+Oc,Li=(bo=io.M)==0,Fi=bo>=Sa.Va-1,Sa.Aa==2&&Pr(Sa,io),io.uc)for(od=(pi=Sa).D.M,t(pi.D.uc),io=pi.yb;io<pi.Hb;++io){bl=io,Du=od;var ic=(id=(wl=pi).D).Nb;oi=wl.R;var id=id.wa[id.Y+bl],ld=wl.sa,Tc=wl.ta+16*ic*oi+16*bl,cd=id.dd,No=id.tc;if(No!=0)if(t(3<=No),wl.L==1)0<bl&&Et(ld,Tc,oi,No+4),id.La&&Mt(ld,Tc,oi,No),0<Du&&Ue(ld,Tc,oi,No+4),id.La&&Dt(ld,Tc,oi,No);else{var dd=wl.B,Mu=wl.qa,zp=wl.ra+8*ic*dd+8*bl,sm=wl.Ha,wl=wl.Ia+8*ic*dd+8*bl;ic=id.ld,0<bl&&(Js(ld,Tc,oi,No+4,cd,ic),ai(Mu,zp,sm,wl,dd,No+4,cd,ic)),id.La&&(K(ld,Tc,oi,No,cd,ic),Xe(Mu,zp,sm,wl,dd,No,cd,ic)),0<Du&&(fs(ld,Tc,oi,No+4,cd,ic),yo(Mu,zp,sm,wl,dd,No+4,cd,ic)),id.La&&(D(ld,Tc,oi,No,cd,ic),he(Mu,zp,sm,wl,dd,No,cd,ic))}}if(Sa.ia&&alert("todo:DitherRow"),Zn.put!=null){if(io=16*bo,bo=16*(bo+1),Li?(Zn.y=Sa.sa,Zn.O=Sa.ta+oo,Zn.f=Sa.qa,Zn.N=Sa.ra+Oc,Zn.ea=Sa.Ha,Zn.W=Sa.Ia+Oc):(io-=Us,Zn.y=yl,Zn.O=sc,Zn.f=si,Zn.N=Rs,Zn.ea=$l,Zn.W=oc),Fi||(bo-=Us),bo>Zn.o&&(bo=Zn.o),Zn.F=null,Zn.J=null,Sa.Fa!=null&&0<Sa.Fa.length&&io<bo&&(Zn.J=er(Sa,Zn,io,bo-io),Zn.F=Sa.mb,Zn.F==null&&Zn.F.length==0)){hi=sa(Sa,3,"Could not decode alpha data.");break t}io<Zn.j&&(Us=Zn.j-io,io=Zn.j,t(!(1&Us)),Zn.O+=Sa.R*Us,Zn.N+=Sa.B*(Us>>1),Zn.W+=Sa.B*(Us>>1),Zn.F!=null&&(Zn.J+=Zn.width*Us)),io<bo&&(Zn.O+=Zn.v,Zn.N+=Zn.v>>1,Zn.W+=Zn.v>>1,Zn.F!=null&&(Zn.J+=Zn.v),Zn.ka=io-Zn.j,Zn.U=Zn.va-Zn.v,Zn.T=bo-io,hi=Zn.put(Zn))}xs+1!=Sa.Ic||Fi||(n(Sa.sa,Sa.ta-ms,yl,sc+16*Sa.R,ms),n(Sa.qa,Sa.ra-Mo,si,Rs+8*Sa.B,Mo),n(Sa.Ha,Sa.Ia-Mo,$l,oc+8*Sa.B,Mo))}if(!hi)return sa(Os,6,"Output aborted.")}return 1}(Be,It)),It.bc!=null&&It.bc(It),rr&=1}return rr?(Be.cb=0,rr):0})(N,H)||(E=N.a)}}else E=N.a}E==0&&pe.Oa!=null&&pe.Oa.fd&&(E=kr(pe.ba))}pe=E}ye=pe!=0?null:11>ye?Ne.f.RGBA.eb:Ne.f.kb.y}else ye=null;return ye};var Is=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(P,M){for(var O="",I=0;I<4;I++)O+=String.fromCharCode(P[M++]);return O}function u(P,M){return P[M+0]|P[M+1]<<8}function f(P,M){return(P[M+0]|P[M+1]<<8|P[M+2]<<16)>>>0}function h(P,M){return(P[M+0]|P[M+1]<<8|P[M+2]<<16|P[M+3]<<24)>>>0}new c;var m=[0],x=[0],g=[],v=new c,y=e,b=function(P,M){var O={},I=0,T=!1,k=0,$=0;if(O.frames=[],!function(U,L){for(var G=0;G<4;G++)if(U[L+G]!="RIFF".charCodeAt(G))return!0;return!1}(P,M)){for(h(P,M+=4),M+=8;M<P.length;){var q=d(P,M),z=h(P,M+=4);M+=4;var F=z+(1&z);switch(q){case"VP8 ":case"VP8L":O.frames[I]===void 0&&(O.frames[I]={}),(_e=O.frames[I]).src_off=T?$:M-8,_e.src_size=k+z+8,I++,T&&(T=!1,k=0,$=0);break;case"VP8X":(_e=O.header={}).feature_flags=P[M];var V=M+4;_e.canvas_width=1+f(P,V),V+=3,_e.canvas_height=1+f(P,V),V+=3;break;case"ALPH":T=!0,k=F+8,$=M-8;break;case"ANIM":(_e=O.header).bgcolor=h(P,M),V=M+4,_e.loop_count=u(P,V),V+=2;break;case"ANMF":var ue,_e;(_e=O.frames[I]={}).offset_x=2*f(P,M),M+=3,_e.offset_y=2*f(P,M),M+=3,_e.width=1+f(P,M),M+=3,_e.height=1+f(P,M),M+=3,_e.duration=f(P,M),M+=3,ue=P[M++],_e.dispose=1&ue,_e.blend=ue>>1&1}q!="ANMF"&&(M+=F)}return O}}(y,0);b.response=y,b.rgbaoutput=!0,b.dataurl=!1;var w=b.header?b.header:null,j=b.frames?b.frames:null;if(w){w.loop_counter=w.loop_count,m=[w.canvas_height],x=[w.canvas_width];for(var _=0;_<j.length&&j[_].blend!=0;_++);}var C=j[0],A=v.WebPDecodeRGBA(y,C.src_off,C.src_size,x,m);C.rgba=A,C.imgwidth=x[0],C.imgheight=m[0];for(var S=0;S<x[0]*m[0]*4;S++)g[S]=A[S];return this.width=x,this.height=m,this.data=g,this}(function(e){var t,r,n,s,o,i,l,c,d,u=function(U){return U=U||{},this.isStrokeTransparent=U.isStrokeTransparent||!1,this.strokeOpacity=U.strokeOpacity||1,this.strokeStyle=U.strokeStyle||"#000000",this.fillStyle=U.fillStyle||"#000000",this.isFillTransparent=U.isFillTransparent||!1,this.fillOpacity=U.fillOpacity||1,this.font=U.font||"10px sans-serif",this.textBaseline=U.textBaseline||"alphabetic",this.textAlign=U.textAlign||"left",this.lineWidth=U.lineWidth||1,this.lineJoin=U.lineJoin||"miter",this.lineCap=U.lineCap||"butt",this.path=U.path||[],this.transform=U.transform!==void 0?U.transform.clone():new c,this.globalCompositeOperation=U.globalCompositeOperation||"normal",this.globalAlpha=U.globalAlpha||1,this.clip_path=U.clip_path||[],this.currentPoint=U.currentPoint||new i,this.miterLimit=U.miterLimit||10,this.lastPoint=U.lastPoint||new i,this.lineDashOffset=U.lineDashOffset||0,this.lineDash=U.lineDash||[],this.margin=U.margin||[0,0,0,0],this.prevPageLastElemOffset=U.prevPageLastElemOffset||0,this.ignoreClearRect=typeof U.ignoreClearRect!="boolean"||U.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new f(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,i=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,d=new u}]);var f=function(U){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var L=U;Object.defineProperty(this,"pdf",{get:function(){return L}});var G=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return G},set:function(te){G=!!te}});var de=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return de},set:function(te){de=!!te}});var X=0;Object.defineProperty(this,"posX",{get:function(){return X},set:function(te){isNaN(te)||(X=te)}});var W=0;Object.defineProperty(this,"posY",{get:function(){return W},set:function(te){isNaN(te)||(W=te)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function(te){var ie;typeof te=="number"?ie=[te,te,te,te]:((ie=new Array(4))[0]=te[0],ie[1]=te.length>=2?te[1]:ie[0],ie[2]=te.length>=3?te[2]:ie[0],ie[3]=te.length>=4?te[3]:ie[1]),d.margin=ie}});var Y=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Y},set:function(te){Y=te}});var me=0;Object.defineProperty(this,"lastBreak",{get:function(){return me},set:function(te){me=te}});var ee=[];Object.defineProperty(this,"pageBreaks",{get:function(){return ee},set:function(te){ee=te}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function(te){te instanceof u&&(d=te)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function(te){d.path=te}});var ae=[];Object.defineProperty(this,"ctxStack",{get:function(){return ae},set:function(te){ae=te}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(te){var ie;ie=h(te),this.ctx.fillStyle=ie.style,this.ctx.isFillTransparent=ie.a===0,this.ctx.fillOpacity=ie.a,this.pdf.setFillColor(ie.r,ie.g,ie.b,{a:ie.a}),this.pdf.setTextColor(ie.r,ie.g,ie.b,{a:ie.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(te){var ie=h(te);this.ctx.strokeStyle=ie.style,this.ctx.isStrokeTransparent=ie.a===0,this.ctx.strokeOpacity=ie.a,ie.a===0?this.pdf.setDrawColor(255,255,255):(ie.a,this.pdf.setDrawColor(ie.r,ie.g,ie.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(te){["butt","round","square"].indexOf(te)!==-1&&(this.ctx.lineCap=te,this.pdf.setLineCap(te))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(te){isNaN(te)||(this.ctx.lineWidth=te,this.pdf.setLineWidth(te))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(te){["bevel","round","miter"].indexOf(te)!==-1&&(this.ctx.lineJoin=te,this.pdf.setLineJoin(te))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(te){isNaN(te)||(this.ctx.miterLimit=te,this.pdf.setMiterLimit(te))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(te){this.ctx.textBaseline=te}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(te){["right","end","center","left","start"].indexOf(te)!==-1&&(this.ctx.textAlign=te)}});var le=null,Te=null;Object.defineProperty(this,"fontFaces",{get:function(){return Te},set:function(te){le=null,Te=te}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(te){var ie;if(this.ctx.font=te,(ie=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(te))!==null){var xt=ie[1];ie[2];var vt=ie[3],dt=ie[4];ie[5];var St=ie[6],ft=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(dt)[2];dt=Math.floor(ft==="px"?parseFloat(dt)*this.pdf.internal.scaleFactor:ft==="em"?parseFloat(dt)*this.pdf.getFontSize():parseFloat(dt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(dt);var _t=function(qt){var $t,De,wt=[],Rt=qt.trim();if(Rt==="")return xk;if(Rt in nU)return[nU[Rt]];for(;Rt!=="";){switch(De=null,$t=(Rt=sU(Rt)).charAt(0)){case'"':case"'":De=JQe(Rt.substring(1),$t);break;default:De=QQe(Rt)}if(De===null||(wt.push(De[0]),(Rt=sU(De[1]))!==""&&Rt.charAt(0)!==","))return xk;Rt=Rt.replace(/^,/,"")}return wt}(St);if(this.fontFaces){var gr=function(qt,$t){if(le===null){var De=function(wt){var Rt=[];return Object.keys(wt).forEach(function(Rr){wt[Rr].forEach(function(Me){var tt=null;switch(Me){case"bold":tt={family:Rr,weight:"bold"};break;case"italic":tt={family:Rr,style:"italic"};break;case"bolditalic":tt={family:Rr,weight:"bold",style:"italic"};break;case"":case"normal":tt={family:Rr}}tt!==null&&(tt.ref={name:Rr,style:Me},Rt.push(tt))})}),Rt}(qt.getFontList());le=function(wt){for(var Rt={},Rr=0;Rr<wt.length;++Rr){var Me=gk(wt[Rr]),tt=Me.family,ut=Me.stretch,sr=Me.style,Sr=Me.weight;Rt[tt]=Rt[tt]||{},Rt[tt][ut]=Rt[tt][ut]||{},Rt[tt][ut][sr]=Rt[tt][ut][sr]||{},Rt[tt][ut][sr][Sr]=Me}return Rt}(De.concat($t))}return le}(this.pdf,this.fontFaces),be=_t.map(function(qt){return{family:qt,stretch:"normal",weight:vt,style:xt}}),Nt=function(qt,$t,De){for(var wt=(De=De||{}).defaultFontFamily||"times",Rt=Object.assign({},YQe,De.genericFontFamilies||{}),Rr=null,Me=null,tt=0;tt<$t.length;++tt)if(Rt[(Rr=gk($t[tt])).family]&&(Rr.family=Rt[Rr.family]),qt.hasOwnProperty(Rr.family)){Me=qt[Rr.family];break}if(!(Me=Me||qt[wt]))throw new Error("Could not find a font-family for the rule '"+aU(Rr)+"' and default family '"+wt+"'.");if(Me=function(ut,sr){if(sr[ut])return sr[ut];var Sr=k3[ut],xr=Sr<=k3.normal?-1:1,Wr=rU(sr,Fae,Sr,xr);if(!Wr)throw new Error("Could not find a matching font-stretch value for "+ut);return Wr}(Rr.stretch,Me),Me=function(ut,sr){if(sr[ut])return sr[ut];for(var Sr=Rae[ut],xr=0;xr<Sr.length;++xr)if(sr[Sr[xr]])return sr[Sr[xr]];throw new Error("Could not find a matching font-style for "+ut)}(Rr.style,Me),!(Me=function(ut,sr){if(sr[ut])return sr[ut];if(ut===400&&sr[500])return sr[500];if(ut===500&&sr[400])return sr[400];var Sr=XQe[ut],xr=rU(sr,Lae,Sr,ut<400?-1:1);if(!xr)throw new Error("Could not find a matching font-weight for value "+ut);return xr}(Rr.weight,Me)))throw new Error("Failed to resolve a font for the rule '"+aU(Rr)+"'.");return Me}(gr,be);this.pdf.setFont(Nt.ref.name,Nt.ref.style)}else{var Wt="";(vt==="bold"||parseInt(vt,10)>=700||xt==="bold")&&(Wt="bold"),xt==="italic"&&(Wt+="italic"),Wt.length===0&&(Wt="normal");for(var _r="",yr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},ve=0;ve<_t.length;ve++){if(this.pdf.internal.getFont(_t[ve],Wt,{noFallback:!0,disableWarning:!0})!==void 0){_r=_t[ve];break}if(Wt==="bolditalic"&&this.pdf.internal.getFont(_t[ve],"bold",{noFallback:!0,disableWarning:!0})!==void 0)_r=_t[ve],Wt="bold";else if(this.pdf.internal.getFont(_t[ve],"normal",{noFallback:!0,disableWarning:!0})!==void 0){_r=_t[ve],Wt="normal";break}}if(_r===""){for(var at=0;at<_t.length;at++)if(yr[_t[at]]){_r=yr[_t[at]];break}}_r=_r===""?"Times":_r,this.pdf.setFont(_r,Wt)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(te){this.ctx.globalCompositeOperation=te}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(te){this.ctx.globalAlpha=te}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(te){this.ctx.lineDashOffset=te,_e.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(te){this.ctx.lineDash=te,_e.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(te){this.ctx.ignoreClearRect=!!te}})};f.prototype.setLineDash=function(U){this.lineDash=U},f.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},f.prototype.fill=function(){j.call(this,"fill",!1)},f.prototype.stroke=function(){j.call(this,"stroke",!1)},f.prototype.beginPath=function(){this.path=[{type:"begin"}]},f.prototype.moveTo=function(U,L){if(isNaN(U)||isNaN(L))throw wo.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var G=this.ctx.transform.applyToPoint(new i(U,L));this.path.push({type:"mt",x:G.x,y:G.y}),this.ctx.lastPoint=new i(U,L)},f.prototype.closePath=function(){var U=new i(0,0),L=0;for(L=this.path.length-1;L!==-1;L--)if(this.path[L].type==="begin"&&ks(this.path[L+1])==="object"&&typeof this.path[L+1].x=="number"){U=new i(this.path[L+1].x,this.path[L+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new i(U.x,U.y)},f.prototype.lineTo=function(U,L){if(isNaN(U)||isNaN(L))throw wo.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var G=this.ctx.transform.applyToPoint(new i(U,L));this.path.push({type:"lt",x:G.x,y:G.y}),this.ctx.lastPoint=new i(G.x,G.y)},f.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),j.call(this,null,!0)},f.prototype.quadraticCurveTo=function(U,L,G,de){if(isNaN(G)||isNaN(de)||isNaN(U)||isNaN(L))throw wo.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var X=this.ctx.transform.applyToPoint(new i(G,de)),W=this.ctx.transform.applyToPoint(new i(U,L));this.path.push({type:"qct",x1:W.x,y1:W.y,x:X.x,y:X.y}),this.ctx.lastPoint=new i(X.x,X.y)},f.prototype.bezierCurveTo=function(U,L,G,de,X,W){if(isNaN(X)||isNaN(W)||isNaN(U)||isNaN(L)||isNaN(G)||isNaN(de))throw wo.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Y=this.ctx.transform.applyToPoint(new i(X,W)),me=this.ctx.transform.applyToPoint(new i(U,L)),ee=this.ctx.transform.applyToPoint(new i(G,de));this.path.push({type:"bct",x1:me.x,y1:me.y,x2:ee.x,y2:ee.y,x:Y.x,y:Y.y}),this.ctx.lastPoint=new i(Y.x,Y.y)},f.prototype.arc=function(U,L,G,de,X,W){if(isNaN(U)||isNaN(L)||isNaN(G)||isNaN(de)||isNaN(X))throw wo.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(W=!!W,!this.ctx.transform.isIdentity){var Y=this.ctx.transform.applyToPoint(new i(U,L));U=Y.x,L=Y.y;var me=this.ctx.transform.applyToPoint(new i(0,G)),ee=this.ctx.transform.applyToPoint(new i(0,0));G=Math.sqrt(Math.pow(me.x-ee.x,2)+Math.pow(me.y-ee.y,2))}Math.abs(X-de)>=2*Math.PI&&(de=0,X=2*Math.PI),this.path.push({type:"arc",x:U,y:L,radius:G,startAngle:de,endAngle:X,counterclockwise:W})},f.prototype.arcTo=function(U,L,G,de,X){throw new Error("arcTo not implemented.")},f.prototype.rect=function(U,L,G,de){if(isNaN(U)||isNaN(L)||isNaN(G)||isNaN(de))throw wo.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(U,L),this.lineTo(U+G,L),this.lineTo(U+G,L+de),this.lineTo(U,L+de),this.lineTo(U,L),this.lineTo(U+G,L),this.lineTo(U,L)},f.prototype.fillRect=function(U,L,G,de){if(isNaN(U)||isNaN(L)||isNaN(G)||isNaN(de))throw wo.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!m.call(this)){var X={};this.lineCap!=="butt"&&(X.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(X.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(U,L,G,de),this.fill(),X.hasOwnProperty("lineCap")&&(this.lineCap=X.lineCap),X.hasOwnProperty("lineJoin")&&(this.lineJoin=X.lineJoin)}},f.prototype.strokeRect=function(U,L,G,de){if(isNaN(U)||isNaN(L)||isNaN(G)||isNaN(de))throw wo.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");x.call(this)||(this.beginPath(),this.rect(U,L,G,de),this.stroke())},f.prototype.clearRect=function(U,L,G,de){if(isNaN(U)||isNaN(L)||isNaN(G)||isNaN(de))throw wo.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(U,L,G,de))},f.prototype.save=function(U){U=typeof U!="boolean"||U;for(var L=this.pdf.internal.getCurrentPageInfo().pageNumber,G=0;G<this.pdf.internal.getNumberOfPages();G++)this.pdf.setPage(G+1),this.pdf.internal.out("q");if(this.pdf.setPage(L),U){this.ctx.fontSize=this.pdf.internal.getFontSize();var de=new u(this.ctx);this.ctxStack.push(this.ctx),this.ctx=de}},f.prototype.restore=function(U){U=typeof U!="boolean"||U;for(var L=this.pdf.internal.getCurrentPageInfo().pageNumber,G=0;G<this.pdf.internal.getNumberOfPages();G++)this.pdf.setPage(G+1),this.pdf.internal.out("Q");this.pdf.setPage(L),U&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},f.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(U){var L,G,de,X;if(U.isCanvasGradient===!0&&(U=U.getColor()),!U)return{r:0,g:0,b:0,a:0,style:U};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(U))L=0,G=0,de=0,X=0;else{var W=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(U);if(W!==null)L=parseInt(W[1]),G=parseInt(W[2]),de=parseInt(W[3]),X=1;else if((W=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(U))!==null)L=parseInt(W[1]),G=parseInt(W[2]),de=parseInt(W[3]),X=parseFloat(W[4]);else{if(X=1,typeof U=="string"&&U.charAt(0)!=="#"){var Y=new Eae(U);U=Y.ok?Y.toHex():"#000000"}U.length===4?(L=U.substring(1,2),L+=L,G=U.substring(2,3),G+=G,de=U.substring(3,4),de+=de):(L=U.substring(1,3),G=U.substring(3,5),de=U.substring(5,7)),L=parseInt(L,16),G=parseInt(G,16),de=parseInt(de,16)}}return{r:L,g:G,b:de,a:X,style:U}},m=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},x=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};f.prototype.fillText=function(U,L,G,de){if(isNaN(L)||isNaN(G)||typeof U!="string")throw wo.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(de=isNaN(de)?void 0:de,!m.call(this)){var X=F(this.ctx.transform.rotation),W=this.ctx.transform.scaleX;I.call(this,{text:U,x:L,y:G,scale:W,angle:X,align:this.textAlign,maxWidth:de})}},f.prototype.strokeText=function(U,L,G,de){if(isNaN(L)||isNaN(G)||typeof U!="string")throw wo.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!x.call(this)){de=isNaN(de)?void 0:de;var X=F(this.ctx.transform.rotation),W=this.ctx.transform.scaleX;I.call(this,{text:U,x:L,y:G,scale:W,renderingMode:"stroke",angle:X,align:this.textAlign,maxWidth:de})}},f.prototype.measureText=function(U){if(typeof U!="string")throw wo.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var L=this.pdf,G=this.pdf.internal.scaleFactor,de=L.internal.getFontSize(),X=L.getStringUnitWidth(U)*de/L.internal.scaleFactor;return new function(W){var Y=(W=W||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Y}}),this}({width:X*=Math.round(96*G/72*1e4)/1e4})},f.prototype.scale=function(U,L){if(isNaN(U)||isNaN(L))throw wo.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var G=new c(U,0,0,L,0,0);this.ctx.transform=this.ctx.transform.multiply(G)},f.prototype.rotate=function(U){if(isNaN(U))throw wo.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var L=new c(Math.cos(U),Math.sin(U),-Math.sin(U),Math.cos(U),0,0);this.ctx.transform=this.ctx.transform.multiply(L)},f.prototype.translate=function(U,L){if(isNaN(U)||isNaN(L))throw wo.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var G=new c(1,0,0,1,U,L);this.ctx.transform=this.ctx.transform.multiply(G)},f.prototype.transform=function(U,L,G,de,X,W){if(isNaN(U)||isNaN(L)||isNaN(G)||isNaN(de)||isNaN(X)||isNaN(W))throw wo.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Y=new c(U,L,G,de,X,W);this.ctx.transform=this.ctx.transform.multiply(Y)},f.prototype.setTransform=function(U,L,G,de,X,W){U=isNaN(U)?1:U,L=isNaN(L)?0:L,G=isNaN(G)?0:G,de=isNaN(de)?1:de,X=isNaN(X)?0:X,W=isNaN(W)?0:W,this.ctx.transform=new c(U,L,G,de,X,W)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};f.prototype.drawImage=function(U,L,G,de,X,W,Y,me,ee){var ae=this.pdf.getImageProperties(U),le=1,Te=1,te=1,ie=1;de!==void 0&&me!==void 0&&(te=me/de,ie=ee/X,le=ae.width/de*me/de,Te=ae.height/X*ee/X),W===void 0&&(W=L,Y=G,L=0,G=0),de!==void 0&&me===void 0&&(me=de,ee=X),de===void 0&&me===void 0&&(me=ae.width,ee=ae.height);for(var xt,vt=this.ctx.transform.decompose(),dt=F(vt.rotate.shx),St=new c,ft=(St=(St=(St=St.multiply(vt.translate)).multiply(vt.skew)).multiply(vt.scale)).applyToRectangle(new l(W-L*te,Y-G*ie,de*le,X*Te)),_t=v.call(this,ft),gr=[],be=0;be<_t.length;be+=1)gr.indexOf(_t[be])===-1&&gr.push(_t[be]);if(w(gr),this.autoPaging)for(var Nt=gr[0],Wt=gr[gr.length-1],_r=Nt;_r<Wt+1;_r++){this.pdf.setPage(_r);var yr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ve=_r===1?this.posY+this.margin[0]:this.margin[0],at=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],qt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],$t=_r===1?0:at+(_r-2)*qt;if(this.ctx.clip_path.length!==0){var De=this.path;xt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(xt,this.posX+this.margin[3],-$t+ve+this.ctx.prevPageLastElemOffset),_.call(this,"fill",!0),this.path=De}var wt=JSON.parse(JSON.stringify(ft));wt=b([wt],this.posX+this.margin[3],-$t+ve+this.ctx.prevPageLastElemOffset)[0];var Rt=(_r>Nt||_r<Wt)&&g.call(this);Rt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],yr,qt,null).clip().discardPath()),this.pdf.addImage(U,"JPEG",wt.x,wt.y,wt.w,wt.h,null,null,dt),Rt&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(U,"JPEG",ft.x,ft.y,ft.w,ft.h,null,null,dt)};var v=function(U,L,G){var de=[];L=L||this.pdf.internal.pageSize.width,G=G||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var X=this.posY+this.ctx.prevPageLastElemOffset;switch(U.type){default:case"mt":case"lt":de.push(Math.floor((U.y+X)/G)+1);break;case"arc":de.push(Math.floor((U.y+X-U.radius)/G)+1),de.push(Math.floor((U.y+X+U.radius)/G)+1);break;case"qct":var W=V(this.ctx.lastPoint.x,this.ctx.lastPoint.y,U.x1,U.y1,U.x,U.y);de.push(Math.floor((W.y+X)/G)+1),de.push(Math.floor((W.y+W.h+X)/G)+1);break;case"bct":var Y=ue(this.ctx.lastPoint.x,this.ctx.lastPoint.y,U.x1,U.y1,U.x2,U.y2,U.x,U.y);de.push(Math.floor((Y.y+X)/G)+1),de.push(Math.floor((Y.y+Y.h+X)/G)+1);break;case"rect":de.push(Math.floor((U.y+X)/G)+1),de.push(Math.floor((U.y+U.h+X)/G)+1)}for(var me=0;me<de.length;me+=1)for(;this.pdf.internal.getNumberOfPages()<de[me];)y.call(this);return de},y=function(){var U=this.fillStyle,L=this.strokeStyle,G=this.font,de=this.lineCap,X=this.lineWidth,W=this.lineJoin;this.pdf.addPage(),this.fillStyle=U,this.strokeStyle=L,this.font=G,this.lineCap=de,this.lineWidth=X,this.lineJoin=W},b=function(U,L,G){for(var de=0;de<U.length;de++)switch(U[de].type){case"bct":U[de].x2+=L,U[de].y2+=G;case"qct":U[de].x1+=L,U[de].y1+=G;default:U[de].x+=L,U[de].y+=G}return U},w=function(U){return U.sort(function(L,G){return L-G})},j=function(U,L){for(var G,de,X=this.fillStyle,W=this.strokeStyle,Y=this.lineCap,me=this.lineWidth,ee=Math.abs(me*this.ctx.transform.scaleX),ae=this.lineJoin,le=JSON.parse(JSON.stringify(this.path)),Te=JSON.parse(JSON.stringify(this.path)),te=[],ie=0;ie<Te.length;ie++)if(Te[ie].x!==void 0)for(var xt=v.call(this,Te[ie]),vt=0;vt<xt.length;vt+=1)te.indexOf(xt[vt])===-1&&te.push(xt[vt]);for(var dt=0;dt<te.length;dt++)for(;this.pdf.internal.getNumberOfPages()<te[dt];)y.call(this);if(w(te),this.autoPaging)for(var St=te[0],ft=te[te.length-1],_t=St;_t<ft+1;_t++){this.pdf.setPage(_t),this.fillStyle=X,this.strokeStyle=W,this.lineCap=Y,this.lineWidth=ee,this.lineJoin=ae;var gr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],be=_t===1?this.posY+this.margin[0]:this.margin[0],Nt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],_r=_t===1?0:Nt+(_t-2)*Wt;if(this.ctx.clip_path.length!==0){var yr=this.path;G=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(G,this.posX+this.margin[3],-_r+be+this.ctx.prevPageLastElemOffset),_.call(this,U,!0),this.path=yr}if(de=JSON.parse(JSON.stringify(le)),this.path=b(de,this.posX+this.margin[3],-_r+be+this.ctx.prevPageLastElemOffset),L===!1||_t===0){var ve=(_t>St||_t<ft)&&g.call(this);ve&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],gr,Wt,null).clip().discardPath()),_.call(this,U,L),ve&&this.pdf.restoreGraphicsState()}this.lineWidth=me}else this.lineWidth=ee,_.call(this,U,L),this.lineWidth=me;this.path=le},_=function(U,L){if((U!=="stroke"||L||!x.call(this))&&(U==="stroke"||L||!m.call(this))){for(var G,de,X=[],W=this.path,Y=0;Y<W.length;Y++){var me=W[Y];switch(me.type){case"begin":X.push({begin:!0});break;case"close":X.push({close:!0});break;case"mt":X.push({start:me,deltas:[],abs:[]});break;case"lt":var ee=X.length;if(W[Y-1]&&!isNaN(W[Y-1].x)&&(G=[me.x-W[Y-1].x,me.y-W[Y-1].y],ee>0)){for(;ee>=0;ee--)if(X[ee-1].close!==!0&&X[ee-1].begin!==!0){X[ee-1].deltas.push(G),X[ee-1].abs.push(me);break}}break;case"bct":G=[me.x1-W[Y-1].x,me.y1-W[Y-1].y,me.x2-W[Y-1].x,me.y2-W[Y-1].y,me.x-W[Y-1].x,me.y-W[Y-1].y],X[X.length-1].deltas.push(G);break;case"qct":var ae=W[Y-1].x+2/3*(me.x1-W[Y-1].x),le=W[Y-1].y+2/3*(me.y1-W[Y-1].y),Te=me.x+2/3*(me.x1-me.x),te=me.y+2/3*(me.y1-me.y),ie=me.x,xt=me.y;G=[ae-W[Y-1].x,le-W[Y-1].y,Te-W[Y-1].x,te-W[Y-1].y,ie-W[Y-1].x,xt-W[Y-1].y],X[X.length-1].deltas.push(G);break;case"arc":X.push({deltas:[],abs:[],arc:!0}),Array.isArray(X[X.length-1].abs)&&X[X.length-1].abs.push(me)}}de=L?null:U==="stroke"?"stroke":"fill";for(var vt=!1,dt=0;dt<X.length;dt++)if(X[dt].arc)for(var St=X[dt].abs,ft=0;ft<St.length;ft++){var _t=St[ft];_t.type==="arc"?S.call(this,_t.x,_t.y,_t.radius,_t.startAngle,_t.endAngle,_t.counterclockwise,void 0,L,!vt):T.call(this,_t.x,_t.y),vt=!0}else if(X[dt].close===!0)this.pdf.internal.out("h"),vt=!1;else if(X[dt].begin!==!0){var gr=X[dt].start.x,be=X[dt].start.y;k.call(this,X[dt].deltas,gr,be),vt=!0}de&&P.call(this,de),L&&M.call(this)}},C=function(U){var L=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,G=L*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return U-G;case"top":return U+L-G;case"hanging":return U+L-2*G;case"middle":return U+L/2-G;default:return U}},A=function(U){return U+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};f.prototype.createLinearGradient=function(){var U=function(){};return U.colorStops=[],U.addColorStop=function(L,G){this.colorStops.push([L,G])},U.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},U.isCanvasGradient=!0,U},f.prototype.createPattern=function(){return this.createLinearGradient()},f.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(U,L,G,de,X,W,Y,me,ee){for(var ae=q.call(this,G,de,X,W),le=0;le<ae.length;le++){var Te=ae[le];le===0&&(ee?O.call(this,Te.x1+U,Te.y1+L):T.call(this,Te.x1+U,Te.y1+L)),$.call(this,U,L,Te.x2,Te.y2,Te.x3,Te.y3,Te.x4,Te.y4)}me?M.call(this):P.call(this,Y)},P=function(U){switch(U){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},M=function(){this.pdf.clip(),this.pdf.discardPath()},O=function(U,L){this.pdf.internal.out(r(U)+" "+n(L)+" m")},I=function(U){var L;switch(U.align){case"right":case"end":L="right";break;case"center":L="center";break;default:L="left"}var G=this.pdf.getTextDimensions(U.text),de=C.call(this,U.y),X=A.call(this,de)-G.h,W=this.ctx.transform.applyToPoint(new i(U.x,de)),Y=this.ctx.transform.decompose(),me=new c;me=(me=(me=me.multiply(Y.translate)).multiply(Y.skew)).multiply(Y.scale);for(var ee,ae,le,Te=this.ctx.transform.applyToRectangle(new l(U.x,de,G.w,G.h)),te=me.applyToRectangle(new l(U.x,X,G.w,G.h)),ie=v.call(this,te),xt=[],vt=0;vt<ie.length;vt+=1)xt.indexOf(ie[vt])===-1&&xt.push(ie[vt]);if(w(xt),this.autoPaging)for(var dt=xt[0],St=xt[xt.length-1],ft=dt;ft<St+1;ft++){this.pdf.setPage(ft);var _t=ft===1?this.posY+this.margin[0]:this.margin[0],gr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],be=this.pdf.internal.pageSize.height-this.margin[2],Nt=be-this.margin[0],Wt=this.pdf.internal.pageSize.width-this.margin[1],_r=Wt-this.margin[3],yr=ft===1?0:gr+(ft-2)*Nt;if(this.ctx.clip_path.length!==0){var ve=this.path;ee=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(ee,this.posX+this.margin[3],-1*yr+_t),_.call(this,"fill",!0),this.path=ve}var at=b([JSON.parse(JSON.stringify(te))],this.posX+this.margin[3],-yr+_t+this.ctx.prevPageLastElemOffset)[0];U.scale>=.01&&(ae=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ae*U.scale),le=this.lineWidth,this.lineWidth=le*U.scale);var qt=this.autoPaging!=="text";if(qt||at.y+at.h<=be){if(qt||at.y>=_t&&at.x<=Wt){var $t=qt?U.text:this.pdf.splitTextToSize(U.text,U.maxWidth||Wt-at.x)[0],De=b([JSON.parse(JSON.stringify(Te))],this.posX+this.margin[3],-yr+_t+this.ctx.prevPageLastElemOffset)[0],wt=qt&&(ft>dt||ft<St)&&g.call(this);wt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],_r,Nt,null).clip().discardPath()),this.pdf.text($t,De.x,De.y,{angle:U.angle,align:L,renderingMode:U.renderingMode}),wt&&this.pdf.restoreGraphicsState()}}else at.y<be&&(this.ctx.prevPageLastElemOffset+=be-at.y);U.scale>=.01&&(this.pdf.setFontSize(ae),this.lineWidth=le)}else U.scale>=.01&&(ae=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ae*U.scale),le=this.lineWidth,this.lineWidth=le*U.scale),this.pdf.text(U.text,W.x+this.posX,W.y+this.posY,{angle:U.angle,align:L,renderingMode:U.renderingMode,maxWidth:U.maxWidth}),U.scale>=.01&&(this.pdf.setFontSize(ae),this.lineWidth=le)},T=function(U,L,G,de){G=G||0,de=de||0,this.pdf.internal.out(r(U+G)+" "+n(L+de)+" l")},k=function(U,L,G){return this.pdf.lines(U,L,G,null,null)},$=function(U,L,G,de,X,W,Y,me){this.pdf.internal.out([t(s(G+U)),t(o(de+L)),t(s(X+U)),t(o(W+L)),t(s(Y+U)),t(o(me+L)),"c"].join(" "))},q=function(U,L,G,de){for(var X=2*Math.PI,W=Math.PI/2;L>G;)L-=X;var Y=Math.abs(G-L);Y<X&&de&&(Y=X-Y);for(var me=[],ee=de?-1:1,ae=L;Y>1e-5;){var le=ae+ee*Math.min(Y,W);me.push(z.call(this,U,ae,le)),Y-=Math.abs(le-ae),ae=le}return me},z=function(U,L,G){var de=(G-L)/2,X=U*Math.cos(de),W=U*Math.sin(de),Y=X,me=-W,ee=Y*Y+me*me,ae=ee+Y*X+me*W,le=4/3*(Math.sqrt(2*ee*ae)-ae)/(Y*W-me*X),Te=Y-le*me,te=me+le*Y,ie=Te,xt=-te,vt=de+L,dt=Math.cos(vt),St=Math.sin(vt);return{x1:U*Math.cos(L),y1:U*Math.sin(L),x2:Te*dt-te*St,y2:Te*St+te*dt,x3:ie*dt-xt*St,y3:ie*St+xt*dt,x4:U*Math.cos(G),y4:U*Math.sin(G)}},F=function(U){return 180*U/Math.PI},V=function(U,L,G,de,X,W){var Y=U+.5*(G-U),me=L+.5*(de-L),ee=X+.5*(G-X),ae=W+.5*(de-W),le=Math.min(U,X,Y,ee),Te=Math.max(U,X,Y,ee),te=Math.min(L,W,me,ae),ie=Math.max(L,W,me,ae);return new l(le,te,Te-le,ie-te)},ue=function(U,L,G,de,X,W,Y,me){var ee,ae,le,Te,te,ie,xt,vt,dt,St,ft,_t,gr,be,Nt=G-U,Wt=de-L,_r=X-G,yr=W-de,ve=Y-X,at=me-W;for(ae=0;ae<41;ae++)dt=(xt=(le=U+(ee=ae/40)*Nt)+ee*((te=G+ee*_r)-le))+ee*(te+ee*(X+ee*ve-te)-xt),St=(vt=(Te=L+ee*Wt)+ee*((ie=de+ee*yr)-Te))+ee*(ie+ee*(W+ee*at-ie)-vt),ae==0?(ft=dt,_t=St,gr=dt,be=St):(ft=Math.min(ft,dt),_t=Math.min(_t,St),gr=Math.max(gr,dt),be=Math.max(be,St));return new l(Math.round(ft),Math.round(_t),Math.round(gr-ft),Math.round(be-_t))},_e=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var U,L,G=(U=this.ctx.lineDash,L=this.ctx.lineDashOffset,JSON.stringify({lineDash:U,lineDashOffset:L}));this.prevLineDash!==G&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=G)}}})(Ca.API),function(e){var t=function(i){var l,c,d,u,f,h,m,x,g,v;for(c=[],d=0,u=(i+=l="\0\0\0\0".slice(i.length%4||4)).length;u>d;d+=4)(f=(i.charCodeAt(d)<<24)+(i.charCodeAt(d+1)<<16)+(i.charCodeAt(d+2)<<8)+i.charCodeAt(d+3))!==0?(h=(f=((f=((f=((f=(f-(v=f%85))/85)-(g=f%85))/85)-(x=f%85))/85)-(m=f%85))/85)%85,c.push(h+33,m+33,x+33,g+33,v+33)):c.push(122);return function(y,b){for(var w=b;w>0;w--)y.pop()}(c,l.length),String.fromCharCode.apply(String,c)+"~>"},r=function(i){var l,c,d,u,f,h=String,m="length",x=255,g="charCodeAt",v="slice",y="replace";for(i[v](-2),i=i[v](0,-2)[y](/\s/g,"")[y]("z","!!!!!"),d=[],u=0,f=(i+=l="uuuuu"[v](i[m]%5||5))[m];f>u;u+=5)c=52200625*(i[g](u)-33)+614125*(i[g](u+1)-33)+7225*(i[g](u+2)-33)+85*(i[g](u+3)-33)+(i[g](u+4)-33),d.push(x&c>>24,x&c>>16,x&c>>8,x&c);return function(b,w){for(var j=w;j>0;j--)b.pop()}(d,l[m]),h.fromCharCode.apply(h,d)},n=function(i){return i.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},s=function(i){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((i=i.replace(/\s/g,"")).indexOf(">")!==-1&&(i=i.substr(0,i.indexOf(">"))),i.length%2&&(i+="0"),l.test(i)===!1)return"";for(var c="",d=0;d<i.length;d+=2)c+=String.fromCharCode("0x"+(i[d]+i[d+1]));return c},o=function(i){for(var l=new Uint8Array(i.length),c=i.length;c--;)l[c]=i.charCodeAt(c);return(l=x3(l)).reduce(function(d,u){return d+String.fromCharCode(u)},"")};e.processDataByFilters=function(i,l){var c=0,d=i||"",u=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":d=r(d),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=t(d),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=s(d),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=n(d),u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=o(d),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:d,reverseChain:u.reverse().join(" ")}}}(Ca.API),function(e){e.loadFile=function(t,r,n){return function(s,o,i){o=o!==!1,i=typeof i=="function"?i:function(){};var l=void 0;try{l=function(c,d,u){var f=new XMLHttpRequest,h=0,m=function(x){var g=x.length,v=[],y=String.fromCharCode;for(h=0;h<g;h+=1)v.push(y(255&x.charCodeAt(h)));return v.join("")};if(f.open("GET",c,!d),f.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(f.onload=function(){f.status===200?u(m(this.responseText)):u(void 0)}),f.send(null),d&&f.status===200)return m(f.responseText)}(s,o,i)}catch{}return l}(t,r,n)},e.loadImageFile=e.loadFile}(Ca.API),function(e){function t(){return(rs.html2canvas?Promise.resolve(rs.html2canvas):Wf(()=>import("./html2canvas.esm-f16e60ff.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function r(){return(rs.DOMPurify?Promise.resolve(rs.DOMPurify):Wf(()=>import("./purify.es-fd086bfc.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var n=function(l){var c=ks(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},s=function(l,c){var d=document.createElement(l);for(var u in c.className&&(d.className=c.className),c.innerHTML&&c.dompurify&&(d.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)d.style[u]=c.style[u];return d},o=function l(c,d){for(var u=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),f=c.firstChild;f;f=f.nextSibling)d!==!0&&f.nodeType===1&&f.nodeName==="SCRIPT"||u.appendChild(l(f,d));return c.nodeType===1&&(c.nodeName==="CANVAS"?(u.width=c.width,u.height=c.height,u.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(u.value=c.value),u.addEventListener("load",function(){u.scrollTop=c.scrollTop,u.scrollLeft=c.scrollLeft},!0)),u},i=function l(c){var d=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),u=l.convert(Promise.resolve(),d);return(u=u.setProgress(1,l,1,[l])).set(c)};(i.prototype=Object.create(Promise.prototype)).constructor=i,i.convert=function(l,c){return l.__proto__=c||i.prototype,l},i.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},i.prototype.from=function(l,c){return this.then(function(){switch(c=c||function(d){switch(n(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(l),c){case"string":return this.then(r).then(function(d){return this.set({src:s("div",{innerHTML:l,dompurify:d})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},i.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},i.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=o(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},i.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,c(this.prop.container,d)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},i.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=this.opt.jsPDF,u=this.opt.fontFaces,f=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,h=Object.assign({async:!0,allowTaint:!0,scale:f,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete h.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=u,u)for(var m=0;m<u.length;++m){var x=u[m],g=x.src.find(function(v){return v.format==="truetype"});g&&d.addFont(g.url,x.ref.name,x.ref.style)}return h.windowHeight=h.windowHeight||0,h.windowHeight=h.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):h.windowHeight,d.context2d.save(!0),c(this.prop.container,h)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},i.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},i.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},i.prototype.output=function(l,c,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},i.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},i.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},i.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},i.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},i.prototype.set=function(l){if(n(l)!=="object")return this;var c=Object.keys(l||{}).map(function(d){if(d in i.template.prop)return function(){this.prop[d]=l[d]};switch(d){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[d]=l[d]}}},this);return this.then(function(){return this.thenList(c)})},i.prototype.get=function(l,c){return this.then(function(){var d=l in i.template.prop?this.prop[l]:this.opt[l];return c?c(d):d})},i.prototype.setMargin=function(l){return this.then(function(){switch(n(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},i.prototype.setPageSize=function(l){function c(d,u){return Math.floor(d*u/72*96)}return this.then(function(){(l=l||Ca.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},i.prototype.setProgress=function(l,c,d,u){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),d!=null&&(this.progress.n=d),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},i.prototype.updateProgress=function(l,c,d,u){return this.setProgress(l?this.progress.val+l:null,c||null,d?this.progress.n+d:null,u?this.progress.stack.concat(u):null)},i.prototype.then=function(l,c){var d=this;return this.thenCore(l,c,function(u,f){return d.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,function(h){return d.updateProgress(null,u),h}).then(u,f).then(function(h){return d.updateProgress(1),h})})},i.prototype.thenCore=function(l,c,d){d=d||Promise.prototype.then;var u=this;l&&(l=l.bind(u)),c&&(c=c.bind(u));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?u:i.convert(Object.assign({},u),Promise.prototype),h=d.call(f,l,c);return i.convert(h,u.__proto__)},i.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},i.prototype.thenList=function(l){var c=this;return l.forEach(function(d){c=c.thenCore(d)}),c},i.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return i.convert(c,this)},i.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},i.prototype.error=function(l){return this.then(function(){throw new Error(l)})},i.prototype.using=i.prototype.set,i.prototype.saveAs=i.prototype.save,i.prototype.export=i.prototype.output,i.prototype.run=i.prototype.then,Ca.getPageSize=function(l,c,d){if(ks(l)==="object"){var u=l;l=u.orientation,c=u.unit||c,d=u.format||d}c=c||"mm",d=d||"a4",l=(""+(l||"P")).toLowerCase();var f,h=(""+d).toLowerCase(),m={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":f=1;break;case"mm":f=72/25.4;break;case"cm":f=72/2.54;break;case"in":f=72;break;case"px":f=.75;break;case"pc":case"em":f=12;break;case"ex":f=6;break;default:throw"Invalid unit: "+c}var x,g=0,v=0;if(m.hasOwnProperty(h))g=m[h][1]/f,v=m[h][0]/f;else try{g=d[1],v=d[0]}catch{throw new Error("Invalid format: "+d)}if(l==="p"||l==="portrait")l="p",v>g&&(x=v,v=g,g=x);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",g>v&&(x=v,v=g,g=x)}return{width:v,height:g,unit:c,k:f,orientation:l}},e.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(gk):null;var d=new i(c);return c.worker?d:d.from(l).doCallback()}}(Ca.API),Ca.API.addJS=function(e){return iU=e,this.internal.events.subscribe("postPutResources",function(){Z2=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Z2+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),oU=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+iU+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Z2!==void 0&&oU!==void 0&&this.internal.out("/Names <</JavaScript "+Z2+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var s=r.outline.render().split(/\r\n/),o=0;o<s.length;o++){var i=s[o],l=n.exec(i);if(l!=null){var c=l[1];r.internal.newObjectDeferredBegin(c,!1)}r.internal.write(i)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,u=[];for(o=0;o<d;o++){var f=r.internal.newObject();u.push(f);var h=r.internal.getPageInfo(o+1);r.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var m=r.internal.newObject();for(r.internal.write("<< /Names [ "),o=0;o<u.length;o++)r.internal.write("(page_"+(o+1)+")"+u[o]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+m+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var r=this;r.outline.root.children.length>0&&(r.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&r.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,s,o){var i={title:s,options:o,children:[]};return n==null&&(n=this.root),n.children.push(i),i},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var s=0;s<n.children.length;s++)this.genIds_r(n.children[s])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var s=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<n.children.length;o++){var i=n.children[o];this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(n)),o>0&&this.line("/Prev "+this.makeRef(n.children[o-1])),o<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[o+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var l=this.count=this.count_r({count:0},i);if(l>0&&this.line("/Count "+l),i.options&&i.options.pageNumber){var c=r.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+s(0)+" 0]")}this.objEnd()}for(var d=0;d<n.children.length;d++)this.renderItems(n.children[d])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,s){for(var o=0;o<s.children.length;o++)n.count++,this.count_r(n,s.children[o]);return n.count}}])}(Ca.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,n,s,o,i,l){var c,d=this.decode.DCT_DECODE,u=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=i||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,c=function(f){for(var h,m=256*f.charCodeAt(4)+f.charCodeAt(5),x=f.length,g={width:0,height:0,numcomponents:1},v=4;v<x;v+=2){if(v+=m,t.indexOf(f.charCodeAt(v+1))!==-1){h=256*f.charCodeAt(v+5)+f.charCodeAt(v+6),g={width:256*f.charCodeAt(v+7)+f.charCodeAt(v+8),height:h,numcomponents:f.charCodeAt(v+9)};break}m=256*f.charCodeAt(v+2)+f.charCodeAt(v+3)}return g}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}u={data:r,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:d,index:n,alias:s}}return u}}(Ca.API),Ca.API.processPNG=function(e,t,r,n){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var s,o=DQe(e,{checkCrc:!0}),i=o.width,l=o.height,c=o.channels,d=o.palette,u=o.depth;s=d&&c===1?function(S){for(var P=S.width,M=S.height,O=S.data,I=S.palette,T=S.depth,k=!1,$=[],q=[],z=void 0,F=!1,V=0,ue=0;ue<I.length;ue++){var _e=t9(I[ue],4),U=_e[0],L=_e[1],G=_e[2],de=_e[3];$.push(U,L,G),de!=null&&(de===0?(V++,q.length<1&&q.push(ue)):de<255&&(F=!0))}if(F||V>1){k=!0,q=void 0;var X=P*M;z=new Uint8Array(X);for(var W=new DataView(O.buffer),Y=0;Y<X;Y++){var me=vk(W,Y,T),ee=t9(I[me],4)[3];z[Y]=ee}}else V===0&&(q=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:k?8:void 0,colorBytes:O,alphaBytes:z,needSMask:k,palette:$,mask:q}}(o):c===2||c===4?function(S){for(var P=S.data,M=S.width,O=S.height,I=S.channels,T=S.depth,k=I===2?"DeviceGray":"DeviceRGB",$=I-1,q=M*O,z=$,F=q*z,V=1*q,ue=Math.ceil(F*T/8),_e=Math.ceil(V*T/8),U=new Uint8Array(ue),L=new Uint8Array(_e),G=new DataView(P.buffer),de=new DataView(U.buffer),X=new DataView(L.buffer),W=!1,Y=0;Y<q;Y++){for(var me=Y*I,ee=0;ee<z;ee++)gU(de,vk(G,me+ee,T),Y*z+ee,T);var ae=vk(G,me+z,T);ae<(1<<T)-1&&(W=!0),gU(X,ae,1*Y,T)}return{colorSpace:k,colorsPerPixel:$,sMaskBitsPerComponent:W?T:void 0,colorBytes:U,alphaBytes:L,needSMask:W}}(o):function(S){var P=S.data,M=S.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:M,colorsPerPixel:M==="DeviceGray"?1:3,colorBytes:P instanceof Uint16Array?function(O){for(var I=O.length,T=new Uint8Array(2*I),k=new DataView(T.buffer,T.byteOffset,T.byteLength),$=0;$<I;$++)k.setUint16(2*$,O[$],!1);return T}(P):P,needSMask:!1}}(o);var f,h,m,x=s,g=x.colorSpace,v=x.colorsPerPixel,y=x.sMaskBitsPerComponent,b=x.colorBytes,w=x.alphaBytes,j=x.needSMask,_=x.palette,C=x.mask,A=null;return n!==Ca.API.image_compression.NONE&&typeof x3=="function"?(A=function(S){var P;switch(S){case Ca.API.image_compression.FAST:P=11;break;case Ca.API.image_compression.MEDIUM:P=13;break;case Ca.API.image_compression.SLOW:P=14;break;default:P=12}return P}(n),f=this.decode.FLATE_DECODE,h="/Predictor ".concat(A," /Colors ").concat(v," /BitsPerComponent ").concat(u," /Columns ").concat(i),e=uU(b,Math.ceil(i*v*u/8),v,u,n),j&&(m=uU(w,Math.ceil(i*y/8),1,y,n))):(f=void 0,h=void 0,e=b,j&&(m=w)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(m&&this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),{alias:r,data:e,index:t,filter:f,decodeParameters:h,transparency:C,palette:_,sMask:m,predictor:A,width:i,height:l,bitsPerComponent:u,sMaskBitsPerComponent:y,colorSpace:g}}},function(e){e.processGIF89A=function(t,r,n,s){var o=new rZe(t),i=o.width,l=o.height,c=[];o.decodeAndBlitFrameRGBA(0,c);var d={data:c,width:i,height:l},u=new yk(100).encode(d,100);return e.processJPEG.call(this,u,r,n,s)},e.processGIF87A=e.processGIF89A}(Ca.API),$u.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:s,green:n,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},$u.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){wo.log("bit decode error:"+r)}},$u.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,s=0;s<t;s++)for(var o=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+8*s*4,l=0;l<8&&8*s+l<this.width;l++){var c=this.palette[o>>7-l&1];this.data[i+4*l]=c.blue,this.data[i+4*l+1]=c.green,this.data[i+4*l+2]=c.red,this.data[i+4*l+3]=255}r!==0&&(this.pos+=4-r)}},$u.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<e;s++){var o=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+2*s*4,l=o>>4,c=15&o,d=this.palette[l];if(this.data[i]=d.blue,this.data[i+1]=d.green,this.data[i+2]=d.red,this.data[i+3]=255,2*s+1>=this.width)break;d=this.palette[c],this.data[i+4]=d.blue,this.data[i+4+1]=d.green,this.data[i+4+2]=d.red,this.data[i+4+3]=255}t!==0&&(this.pos+=4-t)}},$u.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var s=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+4*n;if(s<this.palette.length){var i=this.palette[s];this.data[o]=i.red,this.data[o+1]=i.green,this.data[o+2]=i.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}e!==0&&(this.pos+=4-e)}},$u.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<this.width;s++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(o&t)/t*255|0,l=(o>>5&t)/t*255|0,c=(o>>10&t)/t*255|0,d=o>>15?255:0,u=n*this.width*4+4*s;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=i,this.data[u+3]=d}this.pos+=e}},$u.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var s=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(i&t)/t*255|0,c=(i>>5&r)/r*255|0,d=(i>>11)/t*255|0,u=s*this.width*4+4*o;this.data[u]=d,this.data[u+1]=c,this.data[u+2]=l,this.data[u+3]=255}this.pos+=e}},$u.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),i=t*this.width*4+4*r;this.data[i]=o,this.data[i+1]=s,this.data[i+2]=n,this.data[i+3]=255}this.pos+=this.width%4}},$u.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*r;this.data[l]=o,this.data[l+1]=s,this.data[l+2]=n,this.data[l+3]=i}},$u.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,s){var o=new $u(t,!1),i=o.width,l=o.height,c={data:o.getData(),width:i,height:l},d=new yk(100).encode(c,100);return e.processJPEG.call(this,d,r,n,s)}}(Ca.API),vU.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,s){var o=new vU(t),i=o.width,l=o.height,c={data:o.getData(),width:i,height:l},d=new yk(100).encode(c,100);return e.processJPEG.call(this,d,r,n,s)}}(Ca.API),Ca.API.processRGBA=function(e,t,r){for(var n=e.data,s=n.length,o=new Uint8Array(s/4*3),i=new Uint8Array(s/4),l=0,c=0,d=0;d<s;d+=4){var u=n[d],f=n[d+1],h=n[d+2],m=n[d+3];o[l++]=u,o[l++]=f,o[l++]=h,i[c++]=m}var x=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(i),data:x,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Ca.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Zx=Ca.API,e_=Zx.getCharWidthsArray=function(e,t){var r,n,s=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),i=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:s.metadata.Unicode.widths,c=l.fof?l.fof:1,d=t.kerning?t.kerning:s.metadata.Unicode.kerning,u=d.fof?d.fof:1,f=t.doKerning!==!1,h=0,m=e.length,x=0,g=l[0]||c,v=[];for(r=0;r<m;r++)n=e.charCodeAt(r),typeof s.metadata.widthOfString=="function"?v.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(n))+i*(1e3/o)||0)/1e3):(h=f&&ks(d[n])==="object"&&!isNaN(parseInt(d[n][x],10))?d[n][x]/u:0,v.push((l[n]||g)/c+h)),x=n;return v},lU=Zx.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),s=t.charSpace||this.internal.getCharSpace();return Zx.processArabic&&(e=Zx.processArabic(e)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(e,r,s)/r:e_.apply(this,arguments).reduce(function(o,i){return o+i},0)},cU=function(e,t,r,n){for(var s=[],o=0,i=e.length,l=0;o!==i&&l+t[o]<r;)l+=t[o],o++;s.push(e.slice(0,o));var c=o;for(l=0;o!==i;)l+t[o]>n&&(s.push(e.slice(c,o)),l=0,c=o),l+=t[o],o++;return c!==o&&s.push(e.slice(c,o)),s},dU=function(e,t,r){r||(r={});var n,s,o,i,l,c,d,u=[],f=[u],h=r.textIndent||0,m=0,x=0,g=e.split(" "),v=e_.apply(this,[" ",r])[0];if(c=r.lineIndent===-1?g[0].length+2:r.lineIndent||0){var y=Array(c).join(" "),b=[];g.map(function(j){(j=j.split(/\s*\n/)).length>1?b=b.concat(j.map(function(_,C){return(C&&_.length?`
`:"")+_})):b.push(j[0])}),g=b,c=lU.apply(this,[y,r])}for(o=0,i=g.length;o<i;o++){var w=0;if(n=g[o],c&&n[0]==`
`&&(n=n.substr(1),w=1),h+m+(x=(s=e_.apply(this,[n,r])).reduce(function(j,_){return j+_},0))>t||w){if(x>t){for(l=cU.apply(this,[n,s,t-(h+m),t]),u.push(l.shift()),u=[l.pop()];l.length;)f.push([l.shift()]);x=s.slice(n.length-(u[0]?u[0].length:0)).reduce(function(j,_){return j+_},0)}else u=[n];f.push(u),h=x+c,m=v}else u.push(n),h+=m+x,m=v}return d=c?function(j,_){return(_?y:"")+j.join(" ")}:function(j){return j.join(" ")},f.map(d)},Zx.splitTextToSize=function(e,t,r){var n,s=(r=r||{}).fontSize||this.internal.getFontSize(),o=function(u){if(u.widths&&u.kerning)return{widths:u.widths,kerning:u.kerning};var f=this.internal.getFont(u.fontName,u.fontStyle),h="Unicode";return f.metadata[h]?{widths:f.metadata[h].widths||{0:1},kerning:f.metadata[h].kerning||{}}:{font:f.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var i=1*this.internal.scaleFactor*t/s;o.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/s:0,o.lineIndent=r.lineIndent;var l,c,d=[];for(l=0,c=n.length;l<c;l++)d=d.concat(dU.apply(this,[n[l],i,o]));return d},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",r="klmnopqrstuvwxyz",n={},s={},o=0;o<16;o++)n[r[o]]=t[o],s[t[o]]=r[o];var i=function(h){return"0x"+parseInt(h,10).toString(16)},l=e.__fontmetrics__.compress=function(h){var m,x,g,v,y=["{"];for(var b in h){if(m=h[b],isNaN(parseInt(b,10))?x="'"+b+"'":(b=parseInt(b,10),x=(x=i(b).slice(2)).slice(0,-1)+s[x.slice(-1)]),typeof m=="number")m<0?(g=i(m).slice(3),v="-"):(g=i(m).slice(2),v=""),g=v+g.slice(0,-1)+s[g.slice(-1)];else{if(ks(m)!=="object")throw new Error("Don't know what to do with value type "+ks(m)+".");g=l(m)}y.push(x+g)}return y.push("}"),y.join("")},c=e.__fontmetrics__.uncompress=function(h){if(typeof h!="string")throw new Error("Invalid argument passed to uncompress.");for(var m,x,g,v,y={},b=1,w=y,j=[],_="",C="",A=h.length-1,S=1;S<A;S+=1)(v=h[S])=="'"?m?(g=m.join(""),m=void 0):m=[]:m?m.push(v):v=="{"?(j.push([w,g]),w={},g=void 0):v=="}"?((x=j.pop())[0][x[1]]=w,g=void 0,w=x[0]):v=="-"?b=-1:g===void 0?n.hasOwnProperty(v)?(_+=n[v],g=parseInt(_,16)*b,b=1,_=""):_+=v:n.hasOwnProperty(v)?(C+=n[v],w[g]=parseInt(C,16)*b,b=1,g=void 0,C=""):C+=v;return y},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},f={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(h){var m=h.font,x=f.Unicode[m.postScriptName];x&&(m.metadata.Unicode={},m.metadata.Unicode.widths=x.widths,m.metadata.Unicode.kerning=x.kerning);var g=u.Unicode[m.postScriptName];g&&(m.metadata.Unicode.encoding=g,m.encoding=g.codePages[0])}])}(Ca.API),function(e){var t=function(r){for(var n=r.length,s=new Uint8Array(n),o=0;o<n;o++)s[o]=r.charCodeAt(o);return s};e.API.events.push(["addFont",function(r){var n=void 0,s=r.font,o=r.instance;if(!s.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if(typeof(n=o.existsFileInVFS(s.postScriptName)===!1?o.loadFile(s.postScriptName):o.getFileFromVFS(s.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");(function(i,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(z_(l)),i.metadata=e.API.TTFFont.open(l),i.metadata.Unicode=i.metadata.Unicode||{encoding:{},kerning:{},widths:[]},i.metadata.glyIdsUsed=[0]})(s,n)}}])}(Ca),Ca.API.addSvgAsImage=function(e,t,r,n,s,o,i,l){if(isNaN(t)||isNaN(r))throw wo.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(s))throw wo.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=n,c.height=s;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},f=this;return(rs.canvg?Promise.resolve(rs.canvg):Wf(()=>import("./index.es-5f1c65d0.js"),[])).catch(function(h){return Promise.reject(new Error("Could not load canvg: "+h))}).then(function(h){return h.default?h.default:h}).then(function(h){return h.fromString(d,e,u)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(h){return h.render(u)}).then(function(){f.addImage(c.toDataURL("image/jpeg",1),t,r,n,s,i,l)})},Ca.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var s=0;s<this.internal.pages[n].length;s++)this.internal.pages[n][s]=this.internal.pages[n][s].replace(t,r);return this},Ca.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,s,o,i={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(i),c=[],d=0,u=0,f=0;function h(x,g){var v,y=!1;for(v=0;v<x.length;v+=1)x[v]===g&&(y=!0);return y}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(i)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var m=l.length;for(f=0;f<m;f+=1)r[l[f]].value=r[l[f]].defaultValue,r[l[f]].explicitSet=!1}if(ks(e)==="object"){for(s in e)if(o=e[s],h(l,s)&&o!==void 0){if(r[s].type==="boolean"&&typeof o=="boolean")r[s].value=o;else if(r[s].type==="name"&&h(r[s].valueSet,o))r[s].value=o;else if(r[s].type==="integer"&&Number.isInteger(o))r[s].value=o;else if(r[s].type==="array"){for(d=0;d<o.length;d+=1)if(n=!0,o[d].length===1&&typeof o[d][0]=="number")c.push(String(o[d]-1));else if(o[d].length>1){for(u=0;u<o[d].length;u+=1)typeof o[d][u]!="number"&&(n=!1);n===!0&&c.push([o[d][0]-1,o[d][1]-1].join(" "))}r[s].value="["+c.join(" ")+"]"}else r[s].value=r[s].defaultValue;r[s].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var x,g=[];for(x in r)r[x].explicitSet===!0&&(r[x].type==="name"?g.push("/"+x+" /"+r[x].value):g.push("/"+x+" "+r[x].value));g.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+g.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',s=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(n)),i=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),d=o.length+i.length+l.length+s.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+d+" >>"),this.internal.write("stream"),this.internal.write(s+o+i+l+c),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(n,s){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:s||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(Ca.API),function(e){var t=e.API,r=t.pdfEscape16=function(o,i){for(var l,c=i.metadata.Unicode.widths,d=["","0","00","000","0000"],u=[""],f=0,h=o.length;f<h;++f){if(l=i.metadata.characterToGlyph(o.charCodeAt(f)),i.metadata.glyIdsUsed.push(l),i.metadata.toUnicode[l]=o.charCodeAt(f),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(i.metadata.widthOfGlyph(l),10)])),l=="0")return u.join("");l=l.toString(16),u.push(d[4-l.length],l)}return u.join("")},n=function(o){var i,l,c,d,u,f,h;for(u=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],f=0,h=(l=Object.keys(o).sort(function(m,x){return m-x})).length;f<h;f++)i=l[f],c.length>=100&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),o[i]!==void 0&&o[i]!==null&&typeof o[i].toString=="function"&&(d=("0000"+o[i].toString(16)).slice(-4),i=("0000"+(+i).toString(16)).slice(-4),c.push("<"+i+"><"+d+">"));return c.length&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),u+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(o){(function(i){var l=i.font,c=i.out,d=i.newObject,u=i.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="Identity-H"){for(var f=l.metadata.Unicode.widths,h=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),m="",x=0;x<h.length;x++)m+=String.fromCharCode(h[x]);var g=d();u({data:m,addLength1:!0,objectId:g}),c("endobj");var v=d();u({data:n(l.metadata.toUnicode),addLength1:!0,objectId:v}),c("endobj");var y=d();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+uv(l.fontName)),c("/FontFile2 "+g+" 0 R"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var b=d();c("<<"),c("/Type /Font"),c("/BaseFont /"+uv(l.fontName)),c("/FontDescriptor "+y+" 0 R"),c("/W "+e.API.PDFObject.convert(f)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=d(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+v+" 0 R"),c("/BaseFont /"+uv(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+b+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]),t.events.push(["putFont",function(o){(function(i){var l=i.font,c=i.out,d=i.newObject,u=i.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var f=l.metadata.rawData,h="",m=0;m<f.length;m++)h+=String.fromCharCode(f[m]);var x=d();u({data:h,addLength1:!0,objectId:x}),c("endobj");var g=d();u({data:n(l.metadata.toUnicode),addLength1:!0,objectId:g}),c("endobj");var v=d();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+x+" 0 R"),c("/Flags 96"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+uv(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=d();for(var y=0;y<l.metadata.hmtx.widths.length;y++)l.metadata.hmtx.widths[y]=parseInt(l.metadata.hmtx.widths[y]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+g+" 0 R/BaseFont/"+uv(l.fontName)+"/FontDescriptor "+v+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]);var s=function(o){var i,l=o.text||"",c=o.x,d=o.y,u=o.options||{},f=o.mutex||{},h=f.pdfEscape,m=f.activeFontKey,x=f.fonts,g=m,v="",y=0,b="",w=x[g].encoding;if(x[g].encoding!=="Identity-H")return{text:l,x:c,y:d,options:u,mutex:f};for(b=l,g=m,Array.isArray(l)&&(b=l[0]),y=0;y<b.length;y+=1)x[g].metadata.hasOwnProperty("cmap")&&(i=x[g].metadata.cmap.unicode.codeMap[b[y].charCodeAt(0)]),i||b[y].charCodeAt(0)<256&&x[g].metadata.hasOwnProperty("Unicode")?v+=b[y]:v+="";var j="";return parseInt(g.slice(1))<14||w==="WinAnsiEncoding"?j=h(v,g).split("").map(function(_){return _.charCodeAt(0).toString(16)}).join(""):w==="Identity-H"&&(j=r(v,x[g])),f.isHex=!0,{text:j,x:c,y:d,options:u,mutex:f}};t.events.push(["postProcessText",function(o){var i=o.text||"",l=[],c={text:i,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(i)){var d=0;for(d=0;d<i.length;d+=1)Array.isArray(i[d])&&i[d].length===3?l.push([s(Object.assign({},c,{text:i[d][0]})).text,i[d][1],i[d][2]]):l.push(s(Object.assign({},c,{text:i[d]})).text);o.text=l}else o.text=s(Object.assign({},c,{text:i})).text}])}(Ca),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,n){return t.call(this),this.internal.vFS[r]=n,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(Ca.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(n){var s,o,i,l,c,d,u,f=t,h=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],m=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],x={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},g={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},v=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],y=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),b=!1,w=0;this.__bidiEngine__={};var j=function(O){var I=O.charCodeAt(),T=I>>8,k=g[T];return k!==void 0?f[256*k+(255&I)]:T===252||T===253?"AL":y.test(T)?"L":T===8?"R":"N"},_=function(O){for(var I,T=0;T<O.length;T++){if((I=j(O.charAt(T)))==="L")return!1;if(I==="R")return!0}return!1},C=function(O,I,T,k){var $,q,z,F,V=I[k];switch(V){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":b=!1;break;case"N":case"AN":break;case"EN":b&&(V="AN");break;case"AL":b=!0,V="R";break;case"WS":case"BN":V="N";break;case"CS":k<1||k+1>=I.length||($=T[k-1])!=="EN"&&$!=="AN"||(q=I[k+1])!=="EN"&&q!=="AN"?V="N":b&&(q="AN"),V=q===$?q:"N";break;case"ES":V=($=k>0?T[k-1]:"B")==="EN"&&k+1<I.length&&I[k+1]==="EN"?"EN":"N";break;case"ET":if(k>0&&T[k-1]==="EN"){V="EN";break}if(b){V="N";break}for(z=k+1,F=I.length;z<F&&I[z]==="ET";)z++;V=z<F&&I[z]==="EN"?"EN":"N";break;case"NSM":if(i&&!l){for(F=I.length,z=k+1;z<F&&I[z]==="NSM";)z++;if(z<F){var ue=O[k],_e=ue>=1425&&ue<=2303||ue===64286;if($=I[z],_e&&($==="R"||$==="AL")){V="R";break}}}V=k<1||($=I[k-1])==="B"?"N":T[k-1];break;case"B":b=!1,s=!0,V=w;break;case"S":o=!0,V="N"}return V},A=function(O,I,T){var k=O.split("");return T&&S(k,T,{hiLevel:w}),k.reverse(),I&&I.reverse(),k.join("")},S=function(O,I,T){var k,$,q,z,F,V=-1,ue=O.length,_e=0,U=[],L=w?m:h,G=[];for(b=!1,s=!1,o=!1,$=0;$<ue;$++)G[$]=j(O[$]);for(q=0;q<ue;q++){if(F=_e,U[q]=C(O,G,U,q),k=240&(_e=L[F][x[U[q]]]),_e&=15,I[q]=z=L[_e][5],k>0)if(k===16){for($=V;$<q;$++)I[$]=1;V=-1}else V=-1;if(L[_e][6])V===-1&&(V=q);else if(V>-1){for($=V;$<q;$++)I[$]=z;V=-1}G[q]==="B"&&(I[q]=0),T.hiLevel|=z}o&&function(de,X,W){for(var Y=0;Y<W;Y++)if(de[Y]==="S"){X[Y]=w;for(var me=Y-1;me>=0&&de[me]==="WS";me--)X[me]=w}}(G,I,ue)},P=function(O,I,T,k,$){if(!($.hiLevel<O)){if(O===1&&w===1&&!s)return I.reverse(),void(T&&T.reverse());for(var q,z,F,V,ue=I.length,_e=0;_e<ue;){if(k[_e]>=O){for(F=_e+1;F<ue&&k[F]>=O;)F++;for(V=_e,z=F-1;V<z;V++,z--)q=I[V],I[V]=I[z],I[z]=q,T&&(q=T[V],T[V]=T[z],T[z]=q);_e=F}_e++}}},M=function(O,I,T){var k=O.split(""),$={hiLevel:w};return T||(T=[]),S(k,T,$),function(q,z,F){if(F.hiLevel!==0&&u)for(var V,ue=0;ue<q.length;ue++)z[ue]===1&&(V=v.indexOf(q[ue]))>=0&&(q[ue]=v[V+1])}(k,T,$),P(2,k,I,T,$),P(1,k,I,T,$),k.join("")};return this.__bidiEngine__.doBidiReorder=function(O,I,T){if(function($,q){if(q)for(var z=0;z<$.length;z++)q[z]=z;l===void 0&&(l=_($)),d===void 0&&(d=_($))}(O,I),i||!c||d)if(i&&c&&l^d)w=l?1:0,O=A(O,I,T);else if(!i&&c&&d)w=l?1:0,O=M(O,I,T),O=A(O,I);else if(!i||l||c||d){if(i&&!c&&l^d)O=A(O,I),l?(w=0,O=M(O,I,T)):(w=1,O=M(O,I,T),O=A(O,I));else if(i&&l&&!c&&d)w=1,O=M(O,I,T),O=A(O,I);else if(!i&&!c&&l^d){var k=u;l?(w=1,O=M(O,I,T),w=0,u=!1,O=M(O,I,T),u=k):(w=0,O=M(O,I,T),O=A(O,I),w=1,u=!1,O=M(O,I,T),u=k,O=A(O,I))}}else w=0,O=M(O,I,T);else w=l?1:0,O=M(O,I,T);return O},this.__bidiEngine__.setOptions=function(O){O&&(i=O.isInputVisual,c=O.isOutputVisual,l=O.isInputRtl,d=O.isOutputRtl,u=O.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(n){var s=n.text;n.x,n.y;var o=n.options||{};n.mutex,o.lang;var i=[];if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,r.setOptions(o),Object.prototype.toString.call(s)==="[object Array]"){var l=0;for(i=[],l=0;l<s.length;l+=1)Object.prototype.toString.call(s[l])==="[object Array]"?i.push([r.doBidiReorder(s[l][0]),s[l][1],s[l][2]]):i.push([r.doBidiReorder(s[l])]);n.text=i}else n.text=r.doBidiReorder(s);r.setOptions({isInputVisual:!0})}])}(Ca),Ca.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new Np(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new xZe(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new nZe(this.contents),this.head=new sZe(this),this.name=new dZe(this),this.cmap=new Bae(this),this.toUnicode={},this.hhea=new oZe(this),this.maxp=new uZe(this),this.hmtx=new fZe(this),this.post=new lZe(this),this.os2=new iZe(this),this.loca=new gZe(this),this.glyf=new mZe(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,n,s,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var i,l,c,d;for(d=[],i=0,l=(c=this.bbox).length;i<l;i++)t=c[i],d.push(Math.round(t*this.scaleFactor));return d}.call(this),this.stemV=0,this.post.exists?(n=255&(s=this.post.italic_angle),32768&(r=s>>16)&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,n){var s,o,i,l;for(i=0,o=0,l=(t=""+t).length;0<=l?o<l:o>l;o=0<=l?++o:--o)s=t.charCodeAt(o),i+=this.widthOfGlyph(this.characterToGlyph(s))+n*(1e3/r)||0;return i*(r/1e3)},e.prototype.lineHeight=function(t,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},e}();var xf,Np=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,n;for(n=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(t){var r,n,s;for(s=[],r=0,n=t.length;0<=n?r<n:r>n;r=0<=n?++r:--r)s.push(this.writeByte(t.charCodeAt(r)));return s},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,n,s,o,i,l,c;return t=this.readByte(),r=this.readByte(),n=this.readByte(),s=this.readByte(),o=this.readByte(),i=this.readByte(),l=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^s)+16777216*(255^o)+65536*(255^i)+256*(255^l)+(255^c)+1):72057594037927940*t+281474976710656*r+1099511627776*n+4294967296*s+16777216*o+65536*i+256*l+c},e.prototype.writeLongLong=function(t){var r,n;return r=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,n;for(r=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)r.push(this.readByte());return r},e.prototype.write=function(t){var r,n,s,o;for(o=[],n=0,s=t.length;n<s;n++)r=t[n],o.push(this.writeByte(r));return o},e}(),nZe=function(){var e;function t(r){var n,s,o;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},s=0,o=this.tableCount;0<=o?s<o:s>o;s=0<=o?++s:--s)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(r){var n,s,o,i,l,c,d,u,f,h,m,x,g;for(g in m=Object.keys(r).length,c=Math.log(2),f=16*Math.floor(Math.log(m)/c),i=Math.floor(f/c),u=16*m-f,(s=new Np).writeInt(this.scalarType),s.writeShort(m),s.writeShort(f),s.writeShort(i),s.writeShort(u),o=16*m,d=s.pos+o,l=null,x=[],r)for(h=r[g],s.writeString(g),s.writeInt(e(h)),s.writeInt(d),s.writeInt(h.length),x=x.concat(h),g==="head"&&(l=d),d+=h.length;d%4;)x.push(0),d++;return s.write(x),n=2981146554-e(s.data),s.pos=l+8,s.writeUInt32(n),s.data},e=function(r){var n,s,o,i;for(r=qae.call(r);r.length%4;)r.push(0);for(o=new Np(r),s=0,n=0,i=r.length;n<i;n=n+=4)s+=o.readUInt32();return 4294967295&s},t}(),aZe={}.hasOwnProperty,am=function(e,t){for(var r in t)aZe.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};xf=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var sZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new Np).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),yU=function(){function e(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),f=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(m=t.readUInt16(),h=m/2,t.pos+=6,o=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),t.pos+=2,g=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),d=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),u=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),s=(this.length-t.pos+this.offset)/2,l=function(){var j,_;for(_=[],c=j=0;0<=s?j<s:j>s;c=0<=s?++j:--j)_.push(t.readUInt16());return _}(),c=y=0,w=o.length;y<w;c=++y)for(v=o[c],n=b=x=g[c];x<=v?b<=v:b>=v;n=x<=v?++b:--b)u[c]===0?i=n+d[c]:(i=l[u[c]/2+(n-x)-(h-c)]||0)!==0&&(i+=d[c]),this.codeMap[n]=65535&i}t.pos=f}return e.encode=function(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w,j,_,C,A,S,P,M,O,I,T,k,$,q,z,F,V,ue,_e,U,L,G,de,X,W,Y,me,ee,ae,le;switch(k=new Np,i=Object.keys(t).sort(function(Te,te){return Te-te}),r){case"macroman":for(g=0,v=function(){var Te=[];for(x=0;x<256;++x)Te.push(0);return Te}(),b={0:0},o={},$=0,V=i.length;$<V;$++)b[me=t[s=i[$]]]==null&&(b[me]=++g),o[s]={old:t[s],new:b[t[s]]},v[s]=b[t[s]];return k.writeUInt16(1),k.writeUInt16(0),k.writeUInt32(12),k.writeUInt16(0),k.writeUInt16(262),k.writeUInt16(0),k.write(v),{charMap:o,subtable:k.data,maxGlyphID:g+1};case"unicode":for(I=[],f=[],w=0,b={},n={},y=d=null,q=0,ue=i.length;q<ue;q++)b[_=t[s=i[q]]]==null&&(b[_]=++w),n[s]={old:_,new:b[_]},l=b[_]-s,y!=null&&l===d||(y&&f.push(y),I.push(s),d=l),y=s;for(y&&f.push(y),f.push(65535),I.push(65535),M=2*(P=I.length),S=2*Math.pow(Math.log(P)/Math.LN2,2),h=Math.log(S/2)/Math.LN2,A=2*P-S,c=[],C=[],m=[],x=z=0,_e=I.length;z<_e;x=++z){if(O=I[x],u=f[x],O===65535){c.push(0),C.push(0);break}if(O-(T=n[O].new)>=32768)for(c.push(0),C.push(2*(m.length+P-x)),s=F=O;O<=u?F<=u:F>=u;s=O<=u?++F:--F)m.push(n[s].new);else c.push(T-O),C.push(0)}for(k.writeUInt16(3),k.writeUInt16(1),k.writeUInt32(12),k.writeUInt16(4),k.writeUInt16(16+8*P+2*m.length),k.writeUInt16(0),k.writeUInt16(M),k.writeUInt16(S),k.writeUInt16(h),k.writeUInt16(A),W=0,U=f.length;W<U;W++)s=f[W],k.writeUInt16(s);for(k.writeUInt16(0),Y=0,L=I.length;Y<L;Y++)s=I[Y],k.writeUInt16(s);for(ee=0,G=c.length;ee<G;ee++)l=c[ee],k.writeUInt16(l);for(ae=0,de=C.length;ae<de;ae++)j=C[ae],k.writeUInt16(j);for(le=0,X=m.length;le<X;le++)g=m[le],k.writeUInt16(g);return{charMap:n,subtable:k.data,maxGlyphID:w+1}}},e}(),Bae=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,n,s;for(t.pos=this.offset,this.version=t.readUInt16(),s=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=s?n<s:n>s;n=0<=s?++n:--n)r=new yU(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var n,s;return r==null&&(r="macroman"),n=yU.encode(t,r),(s=new Np).writeUInt16(0),s.writeUInt16(1),n.table=s.data.concat(n.subtable),n},e}(),oZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),iZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(t.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),lZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="post",e.prototype.parse=function(t){var r,n,s;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var o;for(n=t.readUInt16(),this.glyphNameIndex=[],o=0;0<=n?o<n:o>n;o=0<=n?++o:--o)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],s=[];t.pos<this.offset+this.length;)r=t.readByte(),s.push(this.names.push(t.readString(r)));return s;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 262144:return this.map=function(){var i,l,c;for(c=[],o=i=0,l=this.file.maxp.numGlyphs;0<=l?i<l:i>l;o=0<=l?++i:--i)c.push(t.readUInt32());return c}.call(this)}},e}(),cZe=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},dZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="name",e.prototype.parse=function(t){var r,n,s,o,i,l,c,d,u,f,h;for(t.pos=this.offset,t.readShort(),r=t.readShort(),l=t.readShort(),n=[],o=0;0<=r?o<r:o>r;o=0<=r?++o:--o)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+l+t.readShort()});for(c={},o=u=0,f=n.length;u<f;o=++u)s=n[o],t.pos=s.offset,d=t.readString(s.length),i=new cZe(d,s),c[h=s.nameID]==null&&(c[h]=[]),c[s.nameID].push(i);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},e}(),uZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),fZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,n,s,o,i,l,c;for(t.pos=this.offset,this.metrics=[],r=0,l=this.file.hhea.numberOfMetrics;0<=l?r<l:r>l;r=0<=l?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,u;for(u=[],r=d=0;0<=s?d<s:d>s;r=0<=s?++d:--d)u.push(t.readInt16());return u}(),this.widths=function(){var d,u,f,h;for(h=[],d=0,u=(f=this.metrics).length;d<u;d++)o=f[d],h.push(o.advance);return h}.call(this),n=this.widths[this.widths.length-1],c=[],r=i=0;0<=s?i<s:i>s;r=0<=s?++i:--i)c.push(this.widths.push(n));return c},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),qae=[].slice,mZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,n,s,o,i,l,c,d,u,f;return t in this.cache?this.cache[t]:(o=this.file.loca,r=this.file.contents,n=o.indexOf(t),(s=o.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+n,i=(l=new Np(r.read(s))).readShort(),d=l.readShort(),f=l.readShort(),c=l.readShort(),u=l.readShort(),this.cache[t]=i===-1?new pZe(l,d,f,c,u):new hZe(l,i,d,f,c,u),this.cache[t]))},e.prototype.encode=function(t,r,n){var s,o,i,l,c;for(i=[],o=[],l=0,c=r.length;l<c;l++)s=t[r[l]],o.push(i.length),s&&(i=i.concat(s.encode(n)));return o.push(i.length),{table:i,offsets:o}},e}(),hZe=function(){function e(t,r,n,s,o,i){this.raw=t,this.numberOfContours=r,this.xMin=n,this.yMin=s,this.xMax=o,this.yMax=i,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),pZe=function(){function e(t,r,n,s,o){var i,l;for(this.raw=t,this.xMin=r,this.yMin=n,this.xMax=s,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],i=this.raw;l=i.readShort(),this.glyphOffsets.push(i.pos),this.glyphIDs.push(i.readUInt16()),32&l;)i.pos+=1&l?4:2,128&l?i.pos+=8:64&l?i.pos+=4:8&l&&(i.pos+=2)}return e.prototype.encode=function(){var t,r,n;for(r=new Np(qae.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),gZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return am(e,xf),e.prototype.tag="loca",e.prototype.parse=function(t){var r,n;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?function(){var s,o;for(o=[],n=0,s=this.length;n<s;n+=2)o.push(2*t.readUInt16());return o}.call(this):function(){var s,o;for(o=[],n=0,s=this.length;n<s;n+=4)o.push(t.readUInt32());return o}.call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var n=new Uint32Array(this.offsets.length),s=0,o=0,i=0;i<n.length;++i)if(n[i]=s,o<r.length&&r[o]==i){++o,n[i]=s;var l=this.offsets[i],c=this.offsets[i+1]-l;c>0&&(s+=c)}for(var d=new Array(4*n.length),u=0;u<n.length;++u)d[4*u+3]=255&n[u],d[4*u+2]=(65280&n[u])>>8,d[4*u+1]=(16711680&n[u])>>16,d[4*u]=(4278190080&n[u])>>24;return d},e}(),xZe=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,n,s,o;for(r in s=this.font.cmap.tables[0].codeMap,t={},o=this.subset)n=o[r],t[r]=s[n];return t},e.prototype.glyphsFor=function(t){var r,n,s,o,i,l,c;for(s={},i=0,l=t.length;i<l;i++)s[o=t[i]]=this.font.glyf.glyphFor(o);for(o in r=[],s)(n=s[o])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(o in c=this.glyphsFor(r))n=c[o],s[o]=n;return s},e.prototype.encode=function(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y;for(s in n=Bae.encode(this.generateCmap(),"unicode"),i=this.glyphsFor(t),m={0:0},y=n.charMap)m[(c=y[s]).old]=c.new;for(x in h=n.maxGlyphID,i)x in m||(m[x]=h++);return u=function(b){var w,j;for(w in j={},b)j[b[w]]=w;return j}(m),f=Object.keys(u).sort(function(b,w){return b-w}),g=function(){var b,w,j;for(j=[],b=0,w=f.length;b<w;b++)l=f[b],j.push(u[l]);return j}(),o=this.font.glyf.encode(i,g,m),d=this.font.loca.encode(o.offsets,g),v={cmap:this.font.cmap.raw(),glyf:o.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(v["OS/2"]=this.font.os2.raw()),this.font.directory.encode(v)},e}();Ca.API.PDFObject=function(){var e;function t(){}return e=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},t.convert=function(r){var n,s,o,i;if(Array.isArray(r))return"["+function(){var l,c,d;for(d=[],l=0,c=r.length;l<c;l++)n=r[l],d.push(t.convert(n));return d}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r?.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(s in o=["<<"],r)i=r[s],o.push("/"+s+" "+t.convert(i));return o.push(">>"),o.join(`
`)}return""+r},t}();const vZe=Object.freeze(Object.defineProperty({__proto__:null,AcroForm:KQe,AcroFormAppearance:ya,AcroFormButton:Ui,AcroFormCheckBox:lw,AcroFormChoiceField:Bg,AcroFormComboBox:zg,AcroFormEditBox:ow,AcroFormListBox:qg,AcroFormPasswordField:cw,AcroFormPushButton:iw,AcroFormRadioButton:Ug,AcroFormTextField:cp,GState:R1,ShadingPattern:Oh,TilingPattern:Eg,default:Ca,jsPDF:Ca},Symbol.toStringTag,{value:"Module"})),Si=e=>{const t=String(e??"").replace(/\D/g,"");if(!t)return"";const r=(Number(t)/100).toFixed(2),[n,s]=r.split(".");return`${n.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${s}`},jl=e=>{if(e==null||e==="")return NaN;const t=String(e).replace(/\./g,"").replace(",","."),r=parseFloat(t);return Number.isFinite(r)?r:NaN};function yZe({setIsModalOpen:e,setBookings:t,form:r,setForm:n,localCustomers:s,onOpenClientModal:o,onClientModalSuccess:i}){const{toast:l}=Xs(),{userProfile:c}=fo(),{loadAlerts:d}=sj(),{isPaymentModalOpen:u,closePaymentModal:f,editingBooking:h,paymentTotal:m,setPaymentTotal:x,participantsForm:g,setParticipantsForm:v,payMethods:y,openEditParticipantModal:b,protectPaymentModal:w,unprotectPaymentModal:j,onParticipantReplacedRef:_,lastVisibilityChangeTime:C,isModalProtected:A}=qN();window.__protectPaymentModal=w,p.useEffect(()=>(u&&(document.body.style.overflow="auto",document.body.style.pointerEvents="auto"),()=>{document.body.style.overflow="",document.body.style.pointerEvents=""}),[u]);const[S,P]=p.useState(""),[M,O]=p.useState([]);p.useState(null);const[I,T]=p.useState(null),[k,$]=p.useState(!1),[q,z]=p.useState(""),[F,V]=p.useState(!1),[ue,_e]=p.useState([]);p.useState(null);const[U,L]=p.useState(0),[G,de]=p.useState(!1),[X,W]=p.useState(""),[Y,me]=p.useState([]),[ee,ae]=p.useState([]),le=p.useRef(!1),Te=p.useRef({}),te=p.useRef({}),ie=p.useRef({}),[xt,vt]=p.useState(null),[dt,St]=p.useState(null),[ft,_t]=p.useState(!1),[gr,be]=p.useState("downloading"),[Nt,Wt]=p.useState(0),[_r,yr]=p.useState(null),[ve,at]=p.useState(""),[qt,$t]=p.useState(null),De=p.useRef(null),wt=p.useRef(null),Rt=p.useRef(null),Rr=p.useRef(null),Me=p.useRef([]),tt=p.useRef(null),ut=p.useRef(!1),sr=p.useRef(null),Sr=p.useRef([]),[xr,Wr]=p.useState({isOpen:!1,participantIndex:null,currentStatus:null}),qr=p.useRef(!1),Tr=p.useCallback((ke,Ae)=>{ae(et=>{const br=[...et];return ke>=0&&ke<br.length&&(Ae===""&&br[ke].nome&&(ie.current[ke]=br[ke].nome),Ae!==""&&delete ie.current[ke],br[ke]={...br[ke],nome:Ae}),v(br),br})},[v]),sn=p.useCallback(ke=>{const Ae=ie.current[ke];Ae&&(ae(et=>{const br=[...et];return ke>=0&&ke<br.length&&(br[ke]={...br[ke],nome:Ae}),delete ie.current[ke],v(br),br}),setTimeout(()=>{Te.current[ke]?.focus()},0))},[v]),Cn=p.useCallback((ke,Ae,et)=>{if(Ae==="Pago"){const br=jl(et);if(Number.isFinite(br)&&br>0)return}qr.current=!0,console.log(" [StatusConfirmation] Modal protegido por 3 segundos"),setTimeout(()=>{qr.current=!1,console.log(" [StatusConfirmation] Proteo removida")},3e3),Wr({isOpen:!0,participantIndex:ke,currentStatus:Ae})},[]),ze=p.useCallback(ke=>{const{participantIndex:Ae}=xr;Ae!==null&&(ae(et=>{const br=[...et];return Ae>=0&&Ae<br.length&&(br[Ae]={...br[Ae],status_pagamento:ke}),v(br),br}),setTimeout(()=>{console.log(" [StatusChange] Recarregando alertas..."),d().catch(et=>{console.error(" [StatusChange] Erro ao recarregar alertas:",et)})},500)),Wr({isOpen:!1,participantIndex:null,currentStatus:null})},[xr,v,d]),Fe=p.useCallback(ke=>!s||!Array.isArray(s)?!1:s.find(et=>et.id===ke)?.is_consumidor_final===!0,[s]),Le=p.useCallback(()=>{const ke=M||[],Ae=(ee||[]).map((Zt,Pn)=>({...Zt,_originalIndex:Pn})).filter(Zt=>!ke.includes(Zt._originalIndex)),et=Ae.find(Zt=>Fe(Zt.cliente_id)&&Zt.nome&&Zt.nome.toLowerCase().includes("cliente consumidor"));return et?et._originalIndex:Ae.find(Zt=>Fe(Zt.cliente_id)&&Zt.nome)?._originalIndex??null},[ee,M,Fe]),Ze=p.useCallback(ke=>{const Ae=M||[],br=(ee||[]).map((Pn,Ct)=>({...Pn,_originalIndex:Ct})).filter(Pn=>!Ae.includes(Pn._originalIndex)).filter(Pn=>Fe(Pn.cliente_id));if(br.length===0)return null;const Zt=br.findIndex(Pn=>Pn._originalIndex===ke);return Zt!==-1?Zt<br.length-1?br[Zt+1]._originalIndex:br[0]._originalIndex:null},[ee,M,Fe]),Ot=p.useCallback(ke=>{const Ae=M||[],br=(ee||[]).map((Pn,Ct)=>({...Pn,_originalIndex:Ct})).filter(Pn=>!Ae.includes(Pn._originalIndex)).filter(Pn=>Fe(Pn.cliente_id)),Zt=br.findIndex(Pn=>Pn._originalIndex===ke);return Zt>0?br[Zt-1]._originalIndex:null},[ee,M,Fe]),mt=p.useCallback(()=>{if(!y||y.length===0)return null;const ke=y.find(Ae=>Ae.codigo_interno==="01");return ke||y[0]},[y]),Qt=p.useMemo(()=>{const ke=ee||[],Ae=M||[];return ke.filter((et,br)=>!Ae.includes(br)).length},[ee,M]),bt=p.useMemo(()=>{const ke=ee||[],Ae=M||[],et=ke.filter((Tt,Xt)=>!Ae.includes(Xt)),br=jl(m);let Zt=0,Pn=0,Ct=0,lr=!1;et.forEach(Tt=>{let Xt=jl(Tt?.valor_cota);if(Tt?.aplicar_taxa===!0&&Number.isFinite(Xt)){const Wn=y.find(on=>String(on.id)===String(Tt.finalizadora_id)),xn=Number(Wn?.taxa_percentual||0);xn>0&&(Xt=Xt/(1+xn/100),lr=!0)}Number.isFinite(Xt)&&(Zt+=Xt),(Tt?.status_pagamento||"Pendente")==="Pago"?Pn++:Ct++});const Ye=Number.isFinite(br)?Zt-br:0;return{totalTarget:br,totalAssigned:Zt,diff:Ye,paid:Pn,pending:Ct,temTaxaAplicada:lr}},[ee,M,m,y]),zt=()=>{const ke=jl(m);if(!Number.isFinite(ke)||Qt===0)return;const Ae=ke/Qt,et=Si(String(Ae.toFixed(2)));ae(br=>{const Zt=[...br];return Zt.forEach((Pn,Ct)=>{Zt[Ct]={...Zt[Ct],valor_cota:et,status_pagamento:"Pago",aplicar_taxa:!1}}),Zt})},ne=()=>{ae(ke=>{const Ae=[...ke];return Ae.forEach((et,br)=>{Ae[br]={...Ae[br],valor_cota:"",status_pagamento:"Pendente",aplicar_taxa:!1}}),Ae})},He=()=>{ae(ke=>{const Ae=[...ke];return Ae.forEach((et,br)=>{const Zt=jl(et.valor_cota);if(Zt>0){const Ct=y.find(Ye=>String(Ye.id)===String(et.finalizadora_id)),lr=Number(Ct?.taxa_percentual||0);if(lr>0&&!et.aplicar_taxa){const Ye=Zt*(1+lr/100);Ae[br]={...Ae[br],aplicar_taxa:!0,valor_cota:Si(Ye.toFixed(2))}}}}),Ae})},Gt=(ke,Ae)=>{b(ke,Ae)},Ht=()=>{W(m||""),de(!0)},Fr=()=>{try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] confirmEditingTotal",{prev:m,next:X,timestamp:new Date().toISOString()})}catch{}x(X),de(!1)},cr=()=>{W(""),de(!1)},nn=async(ke={})=>{const{autoSave:Ae=!1}=ke;try{if(ut.current||k){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [SAVE-PAYMENTS] Salvamento ignorado (j existe um em andamento)",{autoSave:Ae})}catch{}return}ut.current=!0,$(!0);const et=h?.id,br=c?.codigo_empresa;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [SAVE-PAYMENTS] Iniciando salvamento",{autoSave:Ae,agendamentoId:et,timestamp:new Date().toISOString()})}catch{}if(!et||!br){l({title:"Erro ao salvar pagamentos",description:"Agendamento ou empresa indisponvel.",variant:"destructive"});return}const Zt=(ee||[]).filter((J,Oe)=>!(M||[]).includes(Oe)),Pn=G?X:m;try{if(G){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] forcing total from editing state before save",{prev:m,editingTotalValue:X,totalStrToSave:Pn,timestamp:new Date().toISOString()})}catch{}x(Pn),de(!1)}}catch{}let Ct=0;const lr=Zt.reduce((J,Oe)=>{const Je=Oe.status_pagamento||"Pendente";return J+(Je!=="Pago"?1:0)},0);try{localStorage.getItem("debug:agenda")==="1"&&(console.log(" [SAVE-PAYMENTS] Dados a salvar:",{totalParticipantes:Zt.length,pendentes:lr}),console.log("[ORDER-SAVE] savingIds:",Zt.map(J=>J.cliente_id)))}catch{}const Ye=new Date().toISOString();try{localStorage.getItem("debug:agenda")==="1"&&console.log(`

========== SALVAMENTO INICIADO ${Ye} ==========`)}catch{}const{data:Tt,error:Xt}=await Q.from("agendamento_participantes").select("*").eq("codigo_empresa",br).eq("agendamento_id",et).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(Xt)throw console.error(" Erro ao buscar participantes originais:",Xt),Xt;try{localStorage.getItem("debug:agenda")==="1"&&(console.log(` Participantes originais no banco: ${Tt?.length||0}`),console.log("[ORDER-SAVE] originalIds:",(Tt||[]).map(J=>J.cliente_id)))}catch{}Ct=0,Zt.forEach((J,Oe)=>{console.log(`  #${Oe+1} (novo): ${J.nome}`)}),console.log(" Fazendo recriao completa de participantes (soft-delete + insert)");try{const{error:J}=await Q.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).eq("codigo_empresa",br).eq("agendamento_id",et).is("deleted_at",null);if(J)throw console.error(" Erro ao aplicar soft-delete nos participantes atuais:",J),J}catch(J){throw console.error(" Falha ao soft-deletar participantes antes de recriar:",J),J}if(Zt.length>0){const J=Zt.map((Je,mr)=>{const ot=jl(Je.valor_cota),ar=mt(),ir=Je.finalizadora_id||(ar?.id?String(ar.id):null);return{codigo_empresa:br,agendamento_id:et,cliente_id:Je.cliente_id,nome:(Je?.nome||"").trim()||"Cliente Consumidor",valor_cota:Number.isFinite(ot)?ot:0,status_pagamento:Je.status_pagamento||"Pendente",finalizadora_id:ir,aplicar_taxa:Je.aplicar_taxa||!1,ordem:mr+1,is_representante:mr===0,deleted_at:null}}),{error:Oe}=await Q.from("agendamento_participantes").insert(J);if(Oe)throw console.error(" Erro ao inserir participantes recriados:",Oe),Oe}console.log(" Recriao completa de participantes concluda"),console.log(`========== SALVAMENTO CONCLUDO ==========

`);const Br=Zt.map(J=>({id:J.cliente_id,nome:J.nome,codigo:J.codigo!==null&&J.codigo!==void 0?J.codigo:null})),Wn=Br[0]||null,xn=Br.map(J=>J?.nome).filter(Boolean),on=jl(Pn),ua=Number.isFinite(on)?on:null;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] updating agendamentos.valor_total",{agendamentoId:et,codigo_empresa:br,totalStrToSave:Pn,totalNum:on,totalToPersist:ua,timestamp:new Date().toISOString()})}catch{}const{data:sa,error:wa}=await Q.from("agendamentos").update({cliente_id:Wn?.id??null,clientes:xn,valor_total:ua}).eq("codigo_empresa",br).eq("id",et).select("id, valor_total");try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] update agendamentos result",{ok:!wa,error:wa?wa.message||wa:null,data:sa,timestamp:new Date().toISOString()})}catch{}if(wa)throw wa;n(J=>({...J,selectedClients:Br})),t(J=>J.map(Oe=>Oe.id===et?{...Oe,customer:Wn?.nome||Oe.customer,cliente_id:Wn?.id??null,clientes:xn,valor_total:ua}:Oe));let Va=Zt;if(dt!==null){const J=Te.current?.[dt]?.value;typeof J=="string"&&(Va=[...Zt],dt>=0&&dt<Va.length&&(Va[dt]={...Va[dt],nome:J}))}ae(Va),O([]),Ae||(lr>0?l({title:"Pagamentos salvos",description:`${lr} ${lr===1?"pendente":"pendentes"}`,variant:"warning"}):l({title:"Pagamentos salvos",variant:"success"})),T(null),v(Zt);try{window.dispatchEvent(new CustomEvent("payments:saved",{detail:{agendamentoId:et,participants:Zt}}))}catch{}d().catch(J=>{console.error("[PaymentModal] Erro ao recarregar alertas:",J)});try{localStorage.getItem("debug:agenda")==="1"&&(console.log(" [SAVE-PAYMENTS] Salvamento concludo com sucesso"),console.log(" [SAVE-PAYMENTS] Contagem final de pendentes:",lr))}catch{}console.log(" [LOG 2 - FECHAR PAYMENT MODAL] Dados salvos no banco:"),console.log("   Total:",Zt.length),console.log("   Pendentes:",lr),Zt.forEach((J,Oe)=>{console.log(`   #${Oe+1}: ${J.nome} | Status: ${J.status_pagamento} | Valor: ${J.valor_cota}`)}),Ae&&console.log(" [SAVE-PAYMENTS] Salvamento em modo autoSave (sem fechar modal)")}catch(et){throw console.error(" [SAVE-PAYMENTS] Erro ao salvar:",et),l({title:"Erro ao salvar pagamentos",description:"Tente novamente.",variant:"destructive"}),et}finally{ut.current=!1,$(!1)}},Tn=p.useCallback(async(ke="close")=>{try{if(!u||le.current||ft&&gr==="downloading"||xr?.isOpen||F||A&&String(ke)==="interactOutside")return;le.current=!0;try{await nn({autoSave:!0})}catch(Ae){console.error("[PaymentModal] Falha ao salvar ao fechar:",Ae)}finally{try{j()}catch{}f({force:!0});try{window.dispatchEvent(new Event("paymentmodal:closed"))}catch{}}}catch{}finally{le.current=!1}},[u,ft,gr,xr?.isOpen,F,A,nn,f,j]);p.useEffect(()=>{const ke=Ae=>{if(u&&!F&&!ft&&(Ae.key==="Escape"&&(Ae.preventDefault(),Tn("escape-key")),Ae.key==="F8"&&(Ae.preventDefault(),m&&Qt>0&&zt()),Ae.key==="F9"&&(Ae.preventDefault(),Qt>0&&He()),Ae.key==="F10"&&(Ae.preventDefault(),Qt>0&&ne()),Ae.key==="Delete")){const et=document.activeElement;if(!(et&&et.tagName==="INPUT")){Ae.preventDefault();const Zt=Le();Zt!==null&&(Tr(Zt,""),setTimeout(()=>{Te.current[Zt]?.focus()},0))}}};return window.addEventListener("keydown",ke),()=>window.removeEventListener("keydown",ke)},[u,F,ft,m,Qt,zt,He,ne,Tn,ee,M,Fe,Tr,Le]),p.useEffect(()=>{if(u){const ke=Le();vt(ke)}},[u,ee,M,Le]),p.useEffect(()=>{if(u){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Modal aberto - payMethods:",y?.length||0,"initializedRef:",wt.current)}catch{}Rt.current=setTimeout(()=>{try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Timeout de 3s acionado - initializedRef:",wt.current,"payMethods:",y?.length||0)}catch{}if(!wt.current&&(!y||y.length===0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Inicializando com timeout (sem finalizadoras)")}catch{}const ke=(r?.selectedClients||[]).map(Ae=>{let et=Ae.codigo;if(et==null&&s&&Array.isArray(s)){const br=s.find(Zt=>Zt.id===Ae.id);et=br?.codigo!==null&&br?.codigo!==void 0?br.codigo:null}return{cliente_id:Ae.id,nome:Ae.nome,codigo:et,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1}});Array.isArray(ee)&&ee.length>0||ae(ke),wt.current=Date.now()}},3e3),!wt.current&&y&&y.length>0&&(Rt.current&&(clearTimeout(Rt.current),Rt.current=null),(async()=>{const{defaultMethod:Ae,defaultFinalizadoraId:et,defaultAplicarTaxa:br}=(()=>{const lr=mt(),Ye=lr?.id?String(lr.id):null,Tt=Number(lr?.taxa_percentual||0)>0;return{defaultMethod:lr,defaultFinalizadoraId:Ye,defaultAplicarTaxa:Tt}})();let Zt=[],Pn="nenhuma";if(h?.id)try{const{data:lr,error:Ye}=await Q.from("agendamento_participantes").select("*").eq("agendamento_id",h.id).eq("codigo_empresa",c?.codigo_empresa).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});Ye?console.error(" Erro ao buscar participantes:",Ye):lr&&lr.length>0?(Zt=lr.map(Tt=>({cliente_id:Tt.cliente_id,nome:Tt.nome,codigo:null,valor_cota:Tt.valor_cota?Si(String(Number(Tt.valor_cota).toFixed(2))):"0,00",status_pagamento:Tt.status_pagamento||"Pendente",finalizadora_id:Tt.finalizadora_id?String(Tt.finalizadora_id):et,aplicar_taxa:Tt.aplicar_taxa||!1})),Pn="banco de dados"):Pn="banco vazio"}catch(lr){console.error(" Erro ao buscar participantes:",lr)}Zt.length===0&&g&&g.length>0?(Zt=g,Pn="participantsForm (contexto)"):Zt.length===0&&r?.selectedClients&&r.selectedClients.length>0&&(Zt=(r?.selectedClients||[]).map(lr=>{let Ye=lr.codigo;if(Ye==null&&s&&Array.isArray(s)){const Tt=s.find(Xt=>Xt.id===lr.id);Ye=Tt?.codigo!==null&&Tt?.codigo!==void 0?Tt.codigo:null}return{cliente_id:lr.id,nome:lr.nome,codigo:Ye,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:et,aplicar_taxa:br}}),Pn="form.selectedClients");let Ct=Zt.map(lr=>{let Ye=lr.codigo;if(Ye==null&&s&&Array.isArray(s)){const Xt=s.find(Br=>Br.id===lr.cliente_id);Ye=Xt?.codigo!==null&&Xt?.codigo!==void 0?Xt.codigo:null}let Tt=lr.finalizadora_id;if(!Tt){const Xt=mt();Tt=Xt?.id?String(Xt.id):null}return{...lr,codigo:Ye??lr.codigo,finalizadora_id:Tt}});try{const lr=(r?.selectedClients||[]).slice();if(lr.length>0&&Ct.length>0){const Ye=new Map;Ct.forEach(Br=>{const Wn=Ye.get(Br.cliente_id)||[];Wn.push(Br),Ye.set(Br.cliente_id,Wn)});const Tt=new Map,Xt=[];for(const Br of lr){const Wn=Tt.get(Br.id)||0,on=(Ye.get(Br.id)||[])[Wn];if(on)Xt.push(on),Tt.set(Br.id,Wn+1);else{const ua=mt(),sa=ua?.id?String(ua.id):null;Xt.push({cliente_id:Br.id,nome:Br.nome,codigo:Br.codigo??null,valor_cota:"0,00",status_pagamento:"Pendente",finalizadora_id:sa,aplicar_taxa:Number(ua?.taxa_percentual||0)>0})}}Zt=Xt,Pn=Pn+" (reordenado pelos chips)"}}catch(lr){console.error("[PaymentModal] Falha ao reordenar por chips:",lr)}if(Ct=Zt.map(lr=>{let Ye=lr.codigo;if(Ye==null&&s&&Array.isArray(s)){const Tt=s.find(Xt=>Xt.id===lr.cliente_id);Ye=Tt?.codigo!==null&&Tt?.codigo!==void 0?Tt.codigo:null}return{...lr,codigo:Ye??lr.codigo,finalizadora_id:lr.finalizadora_id||(()=>{const Tt=mt();return Tt?.id?String(Tt.id):null})()}}),Ct.length===0&&h?.id){console.error(" ALERTA CRTICO: Nenhum participante encontrado em NENHUMA fonte!"),console.error(" Agendamento ID:",h.id),console.error(" Empresa:",c?.codigo_empresa),console.error(" Isso pode indicar perda de dados!");try{const{data:lr,error:Ye}=await Q.from("agendamento_participantes").select("*").eq("agendamento_id",h.id);console.error(" Busca sem filtro de empresa:",{encontrados:lr?.length||0,dados:lr,erro:Ye})}catch(lr){console.error(" Erro na busca de debug:",lr)}}if(Ct.length>0||!h?.id){Array.isArray(ee)&&ee.length>0||ae(Ct),wt.current=Date.now();try{if(localStorage.getItem("debug:agenda")==="1"){console.log(" [LOG 1 - ABRIR PAYMENT MODAL] Participantes carregados:"),console.log("   Total:",Ct.length),console.log("   Fonte:",Pn),Ct.forEach((Tt,Xt)=>{console.log(`   #${Xt+1}: ${Tt.nome} | Status: ${Tt.status_pagamento} | Valor: ${Tt.valor_cota}`)});const lr=(r?.selectedClients||[]).map(Tt=>Tt.id),Ye=Ct.map(Tt=>Tt.cliente_id);console.log("[ORDER] chipsIds:",lr),console.log("[ORDER] finalIds:",Ye)}}catch{}}else console.error(" BLOQUEADO: No vou sobrescrever com array vazio!"),console.error(" Mantendo dados anteriores para evitar perda.")})())}else Rt.current&&(clearTimeout(Rt.current),Rt.current=null),P(""),T(null),O([]),ae([]);return()=>{Rt.current&&clearTimeout(Rt.current)}},[u,y,mt,g,r?.selectedClients,s,ee]),p.useEffect(()=>{u&&!wt.current&&Array.isArray(ee)&&ee.length>0&&(wt.current=Date.now())},[u,ee]),p.useEffect(()=>{if(!u)return;const ke=(ee||[]).length;if(sr.current==null){sr.current=ke,Sr.current=Array.isArray(ee)?ee:[];return}const Ae=ke<sr.current;let et=[];try{const br=Array.isArray(Sr.current)?Sr.current:[],Zt=Array.isArray(ee)?ee:[],Pn=lr=>`${lr?.cliente_id??""}|${(lr?.nome??"").toLowerCase()}`,Ct=new Set(Zt.map(Pn));et=br.filter(lr=>!Ct.has(Pn(lr)))}catch{}if(sr.current=ke,Sr.current=Array.isArray(ee)?ee:[],Ae&&h?.id)try{const br=et.map(Zt=>Zt?.nome).filter(Boolean);console.log(" [PaymentModal] Participante(s) removido(s):",br);try{window.dispatchEvent(new CustomEvent("payments:participant-removed",{detail:{agendamentoId:h?.id,removed:et}}))}catch{}}catch{}},[u,ee,h?.id,nn]),p.useEffect(()=>{if(!u)return;const ke=p.useRef.__prevHidden=p.useRef.__prevHidden||{len:0},Ae=(M||[]).length,et=Ae>(ke.len||0);if(ke.len=Ae,et&&h?.id)try{console.log(" [PaymentModal] ndices ocultados (remoo lgica):",M)}catch{}},[M,u,h?.id,nn]),p.useEffect(()=>{wt.current=null},[h?.id]),p.useEffect(()=>(_.current=ke=>{me([ke]),setTimeout(()=>{me([])},1e3)},()=>{_.current=null}),[_]);const Gn=p.useCallback(ke=>{ae(ke)},[]);p.useEffect(()=>(u&&(v.updateLocal=Gn,v.getLocal=()=>ee),()=>{v.updateLocal&&(delete v.updateLocal,delete v.getLocal)}),[u,Gn,ee]),p.useLayoutEffect(()=>{if(!u)return;const ke=(r?.selectedClients||[]).slice();if(!(ke.length===0||!ee||ee.length===0||dt!==null||(ee||[]).some(et=>et?.status_pagamento&&et.status_pagamento!=="Pendente"||et?.valor_cota&&et.valor_cota!==""&&et.valor_cota!=="0,00")))try{const et=new Map;ee.forEach(Tt=>{const Xt=et.get(Tt.cliente_id)||[];Xt.push(Tt),et.set(Tt.cliente_id,Xt)});const br=new Map,Zt=[];for(const Tt of ke){const Xt=br.get(Tt.id)||0,Wn=(et.get(Tt.id)||[])[Xt];Wn?(Zt.push(Wn),br.set(Tt.id,Xt+1)):Zt.push({cliente_id:Tt.id,nome:Tt.nome,codigo:Tt.codigo??null,valor_cota:"0,00",status_pagamento:"Pendente",finalizadora_id:mt()?.id?String(mt().id):null,aplicar_taxa:Number(mt()?.taxa_percentual||0)>0})}const Pn=new Map(br),Ct=[];et.forEach((Tt,Xt)=>{const Br=Pn.get(Xt)||0;for(let Wn=Br;Wn<Tt.length;Wn++)Ct.push(Tt[Wn])});const lr=Zt.concat(Ct);if(lr.length!==ee.length||lr.some((Tt,Xt)=>Tt.cliente_id!==ee[Xt]?.cliente_id||Tt.nome!==ee[Xt]?.nome)){try{if(localStorage.getItem("debug:agenda")==="1"){const Tt=ke.map(Br=>Br.nome),Xt=lr.map(Br=>Br.nome);console.log("[ORDER] chipsNames:",Tt),console.log("[ORDER] finalNames (next):",Xt)}}catch{}ae(lr)}}catch(et){console.error("[PaymentModal] Falha ao reordenar aps mudana de chips:",et)}},[u,r?.selectedClients]),p.useEffect(()=>{F||(_e([]),z("")),L(0)},[F]),p.useEffect(()=>{F&&Me.current[U]&&Me.current[U]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[U,F]),p.useEffect(()=>{const ke=Ae=>{if(F){if(Ae.key==="Escape"){Ae.preventDefault(),V(!1),z(""),_e([]);try{j()}catch{}}if(Ae.key==="Enter"&&Ae.target.tagName!=="INPUT"&&ue.length>0){Ae.preventDefault();const et=ue.map(br=>({cliente_id:br.id,nome:br.nome,codigo:br.codigo,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:(()=>{const Zt=mt();return Zt?.id?String(Zt.id):null})(),aplicar_taxa:(()=>{const Zt=mt();return Number(Zt?.taxa_percentual||0)>0})()}));ae(br=>{const Zt=br.length,Pn=et.map((Ct,lr)=>Zt+lr);return me(Pn),setTimeout(()=>{me([])},1e3),[...br,...et]}),V(!1),_e([]),z("");try{j()}catch{}}}};return window.addEventListener("keydown",ke),()=>window.removeEventListener("keydown",ke)},[F,ue,mt,ae,l,z,V,_e]),p.useEffect(()=>{const ke=async()=>{await Tn("external:save-and-close")};return window.addEventListener("paymentmodal:save-and-close",ke),()=>window.removeEventListener("paymentmodal:save-and-close",ke)},[Tn]),p.useEffect(()=>{!ft&&qt&&(console.log(" [PDF] Revogando URL do blob ao fechar modal"),URL.revokeObjectURL(qt),$t(null))},[ft,qt]);const ta=p.useRef(null),Aa=async()=>{try{if(console.log(" [PDF] Iniciando gerao do PDF"),!ta.current)throw new Error("Elemento do relatrio no encontrado");console.log(" [PDF] Abrindo modal de download"),qt&&URL.revokeObjectURL(qt),_t(!0),be("downloading"),Wt(0),yr(null),$t(null),at("");const ke=(ee||[]).filter((Va,J)=>!(M||[]).includes(J)),Ae=20,et=Math.ceil(ke.length/Ae);Wt(5);const br=new Ca({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),Zt=297,Pn=210;for(let Va=0;Va<et;Va++){const J=Va*Ae,Oe=Math.min(J+Ae,ke.length),Je=ke.slice(J,Oe),mr=10+Math.floor(Va/et*80);Wt(mr);const ot=ta.current;if(!ot)throw new Error("Elemento do relatrio no encontrado durante a gerao");console.log(` [PDF] Capturando pgina ${Va+1}/${et} (participantes ${J+1}-${Oe})`);const ar={visibility:ot.style.visibility,opacity:ot.style.opacity};ot.style.visibility="visible",ot.style.opacity="1",console.log(` [PDF] Elemento innerHTML length: ${ot.innerHTML.length}`),console.log(` [PDF] Elemento scrollHeight: ${ot.scrollHeight}`),console.log(` [PDF] Elemento scrollWidth: ${ot.scrollWidth}`);const ir=ot.querySelector('div[style*="borderBottom"]'),In=ot.querySelectorAll('div[style*="borderBottom"]')[1];Va>0?(ir&&(ir.style.display="none"),In&&(In.style.display="none")):(ir&&(ir.style.display="block"),In&&(In.style.display="flex"));const ln=ot.querySelectorAll("tbody tr");console.log(` [PDF] Total de linhas na tabela: ${ln.length}`),ln.forEach(($e,Pe)=>{$e.style.display=Pe>=J&&Pe<Oe?"table-row":"none"});const Kr=ot.querySelector("#page-indicator");Kr&&(Kr.textContent=`Pgina ${Va+1} de ${et}`),console.log(" [PDF] Forando reflow..."),ot.offsetHeight,ot.getBoundingClientRect(),ot.scrollHeight,ot.offsetWidth,ot.clientHeight,console.log(" [PDF] Aguardando renderizao..."),await new Promise($e=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout($e,2e3)})})})}),console.log(" [PDF] Renderizao completa, iniciando captura...");const oe=ot.querySelectorAll("tbody tr");if(console.log(` [PDF] Linhas da tabela encontradas: ${oe.length}`),oe.forEach(($e,Pe)=>{const Vt=$e.querySelectorAll("td"),yt=Array.from(Vt).map(tr=>tr.textContent.trim()).join(" | ");console.log(` [PDF] Linha ${Pe+1}: ${yt}`)}),oe.length===0){console.warn(" [PDF] AVISO: Nenhuma linha de tabela encontrada! Verificando estrutura...");const $e=ot.querySelector("tbody");console.log(" [PDF] tbody existe:",!!$e),$e&&console.log(" [PDF] innerHTML do tbody:",$e.innerHTML.substring(0,500))}let Ke;try{const $e=ot.scrollHeight,Pe=ot.scrollWidth;if(console.log(` [PDF] Dimenses reais: width=${Pe}px, height=${$e}px`),Ke=await gXe(ot,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0,skipFonts:!1}),!Ke||Ke.length===0)throw new Error("Canvas vazio retornado pela captura");console.log(` [PDF] Pgina ${Va+1} capturada (${Ke.length} bytes, ${$e}px altura, ${oe.length} linhas)`)}catch($e){throw console.error(` [PDF] Erro ao capturar pgina ${Va+1}:`,$e),ot.style.visibility=ar.visibility,ot.style.opacity=ar.opacity,new Error(`Falha ao capturar pgina ${Va+1}: ${$e.message}`)}ot.style.visibility=ar.visibility,ot.style.opacity=ar.opacity,Va>0&&br.addPage();const ct=Zt,xe=ot.scrollHeight/ot.scrollWidth*Zt;br.addImage(Ke,"PNG",0,0,ct,xe,"","MEDIUM"),console.log(` [PDF] Pgina ${Va+1} adicionada ao PDF (${ct}mm x ${xe}mm)`)}if(ta.current){ta.current.querySelectorAll("tbody tr").forEach(Oe=>{Oe.style.display="table-row"});const J=ta.current.querySelector("#page-indicator");J&&(J.textContent="")}Wt(95);const Ct=et>1?` (${et} pginas)`:"",lr=(ee||[]).filter((Va,J)=>!(M||[]).includes(J));let Ye=lr.find(Va=>!s?.find(Oe=>Oe.id===Va.cliente_id)?.is_consumidor_final);!Ye&&lr.length>0&&(Ye=lr[0]);const Xt=(Ye?.nome||"sem-nome").trim().split(/\s+/),Br=Xt[0]||"sem",Wn=Xt.length>1?Xt[Xt.length-1]:"nome",on=`rel-${`${Br}-${Wn}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9-]+/g,"-").replace(/^-+|-+$/g,"")}-${h?.code||"0"}${Ct}.pdf`,ua=br.output("blob"),sa=URL.createObjectURL(ua);yr(ua),$t(sa),at(on),Wt(100);const wa=document.createElement("a");wa.href=sa,wa.download=on,wa.click(),await new Promise(Va=>setTimeout(Va,500)),console.log(" [PDF] PDF gerado com sucesso! Modal de download deve permanecer aberto."),console.log(" [PDF] isPaymentModalOpen deve continuar true"),be("success"),console.log(" [PDF] Status atualizado para success")}catch(ke){console.error(" [PDF] Erro ao gerar PDF:",ke),_t(!1),l({title:"Erro ao gerar PDF",description:ke?.message||"No foi possvel gerar o PDF.",variant:"destructive"})}};return a.jsxs(a.Fragment,{children:[a.jsx(zn,{open:u,onOpenChange:ke=>{if(console.log(" [PaymentModal] onOpenChange chamado:",{open:ke,isDownloadModalOpen:ft}),!ke){if(console.log(" [PaymentModal] Tentando fechar modal de pagamentos"),ft&&gr==="downloading"){console.log(" [PaymentModal] BLOQUEADO: Modal de download est gerando");return}Tn("x")}},children:a.jsx(qn,{forceMount:!0,className:"w-full max-w-screen-sm sm:max-w-[1100px] max-h-[90vh] overflow-y-auto overflow-x-hidden mx-auto px-5 sm:px-6 flex flex-col items-center sm:items-stretch",onOpenAutoFocus:ke=>ke.preventDefault(),onInteractOutside:async ke=>{const Ae=Date.now(),et=wt.current?Ae-wt.current:0,br=Ae-C;if(console.log(" [PaymentModal] onInteractOutside disparado:",{target:ke.target?.tagName,className:ke.target?.className?.substring?.(0,50),timeSinceInit:`${et}ms`,timeSinceVisibility:`${br}ms`,isAddParticipantOpen:F,isDownloadModalOpen:ft,statusConfirmationOpen:xr.isOpen,isModalProtected:A,timestamp:new Date().toISOString()}),xr.isOpen){console.log(" [PaymentModal] Bloqueado: modal de confirmao de status est aberto"),ke.preventDefault();return}if(ft){console.log(" [PaymentModal] Bloqueado: modal de download est aberto"),ke.preventDefault();return}if(A){console.log(" [PaymentModal] Bloqueado: modal protegido (protectPaymentModal ativo)"),ke.preventDefault();return}if(F){console.log(" [PaymentModal] Bloqueado: modal de adicionar participante aberto"),ke.preventDefault();return}if(wt.current&&et<500){console.log(" [PaymentModal] Bloqueado: modal abriu recentemente"),ke.preventDefault();return}if(br<3e3){console.log(` [PaymentModal] Bloqueado: mudana de visibilidade recente (${br}ms atrs)`),ke.preventDefault();return}ke.preventDefault(),await Tn("interactOutside")},onEscapeKeyDown:ke=>{ke.preventDefault(),Tn("escape")},children:!y||y.length===0?wt.current?a.jsxs(a.Fragment,{children:[a.jsxs(Bn,{className:"sr-only",children:[a.jsx($n,{children:"Aviso"}),a.jsx(la,{children:"Nenhuma forma de pagamento cadastrada"})]}),a.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4",children:[a.jsx(Jf,{className:"w-12 h-12 text-amber-500"}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("p",{className:"font-semibold text-amber-500",children:"Nenhuma forma de pagamento cadastrada"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Cadastre pelo menos uma finalizadora para gerenciar pagamentos."})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:f,children:"Fechar"}),a.jsx(H4,{to:"/finalizadoras",children:a.jsx(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:f,children:"Cadastrar Finalizadora"})})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(Bn,{className:"sr-only",children:[a.jsx($n,{children:"Carregando"}),a.jsx(la,{children:"Carregando formas de pagamento"})]}),a.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Carregando formas de pagamento..."})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(Bn,{className:"relative pb-4 w-full max-w-[600px] mx-auto sm:max-w-none sm:mx-0",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3 sm:gap-4",children:[a.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsx($n,{children:"Registrar pagamento"})}),a.jsx(la,{className:"hidden sm:block",children:"As alteraes so salvas ao fechar o modal."})]}),a.jsxs(Z,{type:"button",variant:"outline",size:"sm",onClick:Aa,className:"flex-shrink-0 gap-2 w-full sm:w-auto mt-2 sm:mt-0 sm:mr-12",title:"Baixar relatrio como imagem",children:[a.jsx(ys,{className:"w-4 h-4"}),a.jsx("span",{children:"Baixar Relatrio"})]})]})}),a.jsxs("div",{className:"space-y-3 sm:space-y-6 w-full max-w-[600px] mx-auto sm:max-w-none sm:mx-0",children:[a.jsxs("div",{className:"sm:hidden space-y-2 max-w-md mx-auto",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{className:"p-2 rounded-lg bg-emerald-600/10 border border-emerald-500/30 min-w-0 relative group",children:[a.jsx("div",{className:"text-[10px] text-emerald-300/80 mb-1 truncate",children:"Total"}),G?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(At,{type:"text",value:X,onChange:ke=>W(Si(ke.target.value)),className:"w-full h-6 text-xs text-center font-bold bg-emerald-950/50 border-emerald-400/50 text-emerald-300 px-1",placeholder:"0,00",autoFocus:!0,onKeyDown:ke=>{ke.key==="Enter"&&X!==m?Fr():ke.key==="Escape"&&cr()},onBlur:()=>{X!==m?Fr():cr()}}),X!==m&&a.jsx("button",{onMouseDown:ke=>ke.preventDefault(),onClick:Fr,className:"p-0.5 rounded hover:bg-emerald-500/20 transition-colors flex-shrink-0",title:"Confirmar",children:a.jsx(Lm,{className:"w-3 h-3 text-emerald-400"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-bold text-emerald-400 truncate",children:Si(m)||"R$ 0,00"}),a.jsx("button",{onClick:Ht,className:"absolute right-1 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-emerald-500/20 transition-colors",title:"Editar",children:a.jsx(xc,{className:"w-3 h-3 text-emerald-400"})})]})]}),a.jsxs("div",{className:`p-2 rounded-lg border min-w-0 ${bt.diff===0?"bg-emerald-600/10 border-emerald-500/30":bt.diff>0?"bg-amber-600/10 border-amber-500/30":"bg-rose-600/10 border-rose-500/30"}`,children:[a.jsx("div",{className:`text-[10px] mb-1 truncate ${bt.diff===0?"text-emerald-300/80":bt.diff>0?"text-amber-300/80":"text-rose-300/80"}`,children:"Diferena"}),a.jsxs("div",{className:`text-sm font-bold truncate ${bt.diff===0?"text-emerald-400":bt.diff>0?"text-amber-400":"text-rose-400"}`,children:[bt.diff>0?"+":"",Si(String(Math.abs(bt.diff).toFixed(2)))]})]})]}),a.jsxs("div",{className:"flex gap-1.5 text-xs justify-center",children:[a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"})," ",a.jsx("strong",{children:Qt})]}),a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Atribudo:"})," ",a.jsxs("strong",{children:["R$ ",bt.totalAssigned.toFixed(2)]})]}),a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Alvo:"})," ",a.jsxs("strong",{children:["R$ ",bt.totalTarget.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Z,{type:"button",size:"sm",className:"bg-sky-600 hover:bg-sky-500 text-white text-xs h-8 px-3",onClick:zt,disabled:!m||Qt===0,children:(()=>{const ke=jl(m);if(Number.isFinite(ke)&&Qt>0){const Ae=ke/Qt;return`Dividir (${Si(String(Ae.toFixed(2)))})`}return"Dividir"})()}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-amber-500/30 text-amber-400 hover:bg-amber-500/10 text-xs h-8 px-3 flex-1",onClick:He,disabled:Qt===0,children:"Aplicar taxas"}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-white/10 text-xs h-8 px-3 flex-1",onClick:ne,disabled:Qt===0,children:"Zerar"})]})]})]}),a.jsx("div",{className:"hidden sm:block p-4 rounded-lg border border-border bg-gradient-to-br from-surface-2 to-surface shadow-md",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start gap-3 w-full",children:[a.jsxs("div",{className:"flex flex-row gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(lt,{className:"font-bold text-base text-white",children:"Valor total a receber"}),a.jsx("div",{className:"w-[180px] px-3 py-2 rounded-md bg-gradient-to-br from-emerald-600/20 to-emerald-700/20 border-2 border-emerald-500/40 shadow-lg flex items-center justify-center gap-2 relative group",children:G?a.jsxs(a.Fragment,{children:[a.jsx(At,{type:"text",value:X,onChange:ke=>W(Si(ke.target.value)),className:"w-full h-8 text-center text-lg font-bold bg-emerald-950/50 border-emerald-400/50 text-emerald-300",placeholder:"0,00",autoFocus:!0,onKeyDown:ke=>{ke.key==="Enter"&&X!==m?Fr():ke.key==="Escape"&&cr()},onBlur:()=>{X!==m?Fr():cr()}}),X!==m&&a.jsx("button",{onMouseDown:ke=>ke.preventDefault(),onClick:Fr,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-emerald-500/20 transition-colors",title:"Confirmar (Enter)",children:a.jsx(Lm,{className:"w-4 h-4 text-emerald-400"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-xl font-bold text-emerald-400",children:Si(m)||"R$ 0,00"}),a.jsx("button",{onClick:Ht,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-emerald-500/20 transition-colors opacity-0 group-hover:opacity-100",title:"Editar valor total",children:a.jsx(xc,{className:"w-4 h-4 text-emerald-400"})})]})})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(lt,{className:"font-bold text-base text-white",children:"Diferena"}),a.jsx("div",{className:`w-[180px] px-3 py-2 rounded-md border-2 shadow-lg flex items-center justify-center ${bt.diff===0?"bg-gradient-to-br from-emerald-600/20 to-emerald-700/20 border-emerald-500/40":bt.diff>0?"bg-gradient-to-br from-amber-600/20 to-amber-700/20 border-amber-500/40":"bg-gradient-to-br from-rose-600/20 to-rose-700/20 border-rose-500/40"}`,children:a.jsxs("span",{className:`text-xl font-bold ${bt.diff===0?"text-emerald-400":bt.diff>0?"text-amber-400":"text-rose-400"}`,children:[bt.diff>0?"+":"",Si(String(Math.abs(bt.diff).toFixed(2)))]})})]})]}),a.jsxs("div",{className:"ml-auto flex flex-col gap-3 items-end",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"}),a.jsx("strong",{children:Qt})]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Atribudo:"}),a.jsxs("strong",{children:["R$ ",bt.totalAssigned.toFixed(2)]})]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Alvo:"}),a.jsxs("strong",{children:["R$ ",bt.totalTarget.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[a.jsx(Z,{type:"button",variant:"secondary",size:"sm",className:"bg-sky-600 hover:bg-sky-500 text-white flex-shrink-0",onClick:zt,disabled:!m||Qt===0,children:(()=>{const ke=jl(m);if(Number.isFinite(ke)&&Qt>0){const Ae=ke/Qt;return a.jsxs(a.Fragment,{children:["Dividir igualmente (",Si(String(Ae.toFixed(2)))," cada)",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-sky-700/50 rounded border border-sky-500/30",children:"F8"})]})}return a.jsxs(a.Fragment,{children:["Dividir igualmente",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-sky-700/50 rounded border border-sky-500/30",children:"F8"})]})})()}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-amber-500/30 text-amber-400 hover:bg-amber-500/10 flex-1 sm:flex-initial whitespace-nowrap",onClick:He,disabled:Qt===0,children:["Aplicar taxas",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-amber-700/50 rounded border border-amber-500/30",children:"F9"})]}),a.jsxs(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-white/10 flex-1 sm:flex-initial",onClick:ne,disabled:Qt===0,children:["Zerar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"F10"})]})]})]})]})]})}),(r.selectedClients||[]).length===0?a.jsx("div",{className:"text-xs text-text-muted italic",children:'Nenhum participante neste agendamento. Adicione participantes no campo "Clientes" do modal principal.'}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("div",{className:"relative flex-1 min-w-0",children:[a.jsx(At,{ref:De,type:"text",placeholder:"Buscar participante...",value:S,onChange:ke=>P(ke.target.value),className:"pr-16"}),a.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-amber-400 hover:text-amber-300",onClick:()=>{P(""),De.current?.focus()},children:"limpar"})]}),a.jsxs(Z,{type:"button",size:"sm",className:"bg-amber-500 hover:bg-amber-400 text-black shadow-md flex-shrink-0",onClick:ke=>{ke.preventDefault(),ke.stopPropagation(),w(2e3),V(!0)},children:[a.jsx("span",{className:"hidden sm:inline",children:"Adicionar participante +"}),a.jsx("span",{className:"sm:hidden",children:"Participante +"})]})]}),I?.type==="pending"&&a.jsxs("div",{role:"alert",className:"mb-2 rounded-md border border-amber-600/40 bg-amber-500/10 px-3 py-2 text-amber-200 flex items-start gap-3",children:[a.jsx(Jf,{className:"w-4 h-4 text-amber-300 mt-0.5"}),a.jsxs("div",{className:"flex-1 text-sm",children:[a.jsx("strong",{children:"Ateno:"})," Existem ",a.jsx("strong",{children:I.count})," participante(s) com status ",a.jsx("strong",{children:"Pendente"}),"."]}),a.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded bg-amber-500/20 hover:bg-amber-500/30 border border-amber-600/40",onClick:()=>T(null),children:"Entendi"})]}),a.jsx("div",{className:"border border-border rounded-md overflow-hidden",children:a.jsx("div",{className:"divide-y divide-border max-h-[50vh] overflow-y-scroll",children:(()=>{const ke=S.trim().toLowerCase(),Ae=M||[],br=(ee||[]).map((Zt,Pn)=>({...Zt,_originalIndex:Pn})).filter(Zt=>!Ae.includes(Zt._originalIndex)).filter(Zt=>!ke||String(Zt?.nome||"").toLowerCase().includes(ke));return br.length===0?a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Nenhum participante com esse nome"}):br.map(Zt=>{const Pn=`participant-${Zt._originalIndex}`,Ct=Zt._originalIndex,lr=Y.includes(Ct);return a.jsxs("div",{className:`p-2 sm:p-3 border-b last:border-b-0 transition-all duration-500 ease-out ${lr?"bg-white/10":""}`,children:[a.jsxs("div",{className:"sm:hidden space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[Zt.codigo!==null&&Zt.codigo!==void 0&&a.jsxs("span",{className:`text-xs font-bold rounded px-1.5 py-0.5 shrink-0 ${Zt.status_pagamento==="Pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",Zt.codigo]}),Fe(Zt.cliente_id)?a.jsxs("div",{className:"relative flex-1 min-w-0",children:[a.jsx("input",{ref:Ye=>{Ye&&(Te.current[Ct]=Ye)},type:"text",value:Zt.nome||"",onChange:Ye=>Tr(Ct,Ye.target.value),onFocus:()=>St(Ct),onKeyDown:Ye=>{if(Ye.key==="Enter"){Ye.preventDefault();const Tt=Ze(Ct);Tt!==null&&setTimeout(()=>{Te.current[Tt]?.focus()},0)}else if(Ye.key==="Delete"&&Zt.nome&&Ye.target===document.activeElement)Ye.preventDefault(),Ye.stopPropagation(),Tr(Ct,""),setTimeout(()=>{Te.current[Ct]?.focus()},0);else if(Ye.key==="ArrowDown"){Ye.preventDefault();const Tt=Ze(Ct);Tt!==null&&setTimeout(()=>{Te.current[Tt]?.focus()},0)}else if(Ye.key==="ArrowUp"){Ye.preventDefault();const Tt=Ot(Ct);Tt!==null&&setTimeout(()=>{Te.current[Tt]?.focus()},0)}},onBlur:async Ye=>{St(null);const Tt=(Ye.currentTarget?.value||"").trim();Tt===""?ie.current[Ct]&&sn(Ct):(ae(Xt=>{const Br=[...Xt];return Ct>=0&&Ct<Br.length&&(Br[Ct]={...Br[Ct],nome:Tt}),Br}),delete ie.current[Ct])},placeholder:"Nome do cliente...",className:"font-medium text-sm bg-black/40 text-white placeholder:text-white/50 border border-white/15 rounded px-2 py-0.5 pr-11 focus:border-white/30 focus:outline-none focus:ring-1 focus:ring-white/20 w-full",title:"Editar nome do Cliente Consumidor (histrico do agendamento)"}),Zt.nome?a.jsx("button",{type:"button",onClick:()=>{Tr(Ct,""),setTimeout(()=>{Te.current[Ct]?.focus()},0)},className:`absolute right-1 top-1/2 -translate-y-1/2 px-1.5 py-0.5 text-[10px] font-bold border rounded transition-all ${dt===Ct||!dt&&xt===Ct?"text-amber-300 bg-amber-500/20 border-amber-400/50 animate-pulse shadow-lg shadow-amber-500/20":"text-white/60 bg-white/10 hover:bg-white/20 hover:text-white/90 border-white/20"}`,title:dt===Ct||!dt&&xt===Ct?"Ser limpo ao pressionar Delete":"Limpar nome (tecla Delete)",children:"DEL"}):ie.current[Ct]?a.jsx("button",{type:"button",onClick:()=>sn(Ct),className:"absolute right-1 top-1/2 -translate-y-1/2 p-1 text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20 hover:text-emerald-300 border border-emerald-500/30 rounded transition-all",title:"Restaurar ltimo nome",children:a.jsx(c$,{className:"w-3 h-3"})}):null]}):a.jsx("span",{className:"font-medium text-sm truncate",children:Zt.nome})]}),a.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[a.jsx("button",{type:"button",className:"p-1 text-text-secondary hover:text-brand transition-colors",onClick:()=>Gt(Ct,Zt.nome),title:"Trocar",children:a.jsx(xc,{className:"w-4 h-4"})}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400 h-6 w-6 p-0",onClick:()=>{O(Ye=>[...Ye,Ct])},children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{children:[a.jsx(lt,{className:"text-[10px] text-text-muted",children:"Mtodo"}),a.jsxs(ea,{value:String(Zt.finalizadora_id||""),onValueChange:Ye=>{ae(Tt=>{const Xt=[...Tt];if(Ct>=0&&Ct<Xt.length){const Br=y.find(xn=>String(xn.id)===String(Ye)),Wn=Number(Br?.taxa_percentual||0)>0;Xt[Ct]={...Xt[Ct],finalizadora_id:Ye,aplicar_taxa:Wn?Xt[Ct].aplicar_taxa??!0:!1}}return Xt})},children:[a.jsx(Jn,{className:"h-8 text-xs",children:a.jsx(ra,{placeholder:"Mtodo"})}),a.jsx(Qn,{children:y.map(Ye=>a.jsx(Qe,{value:String(Ye.id),children:Ye.nome||Ye.tipo||"Outros"},Ye.id))})]}),(()=>{const Ye=y.find(Wn=>String(Wn.id)===String(Zt.finalizadora_id)),Tt=Number(Ye?.taxa_percentual||0);if(Tt<=0)return a.jsx("div",{className:"h-4 mt-1"});const Xt=jl(Zt.valor_cota),Br=Number.isFinite(Xt)&&Xt>0;return a.jsxs("label",{className:`flex items-center gap-1.5 mt-1 text-[11px] ${Br?"cursor-pointer":"cursor-not-allowed opacity-50"}`,title:Br?`Taxa de ${Tt.toFixed(2)}%`:"Informe o valor primeiro",children:[a.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!Zt.aplicar_taxa,disabled:!Br,onChange:Wn=>{if(!Br){l({title:"Valor necessrio",description:"Informe o valor antes de aplicar a taxa.",variant:"destructive"});return}ae(xn=>{const on=[...xn];if(Ct>=0&&Ct<on.length){const ua=Wn.target.checked;let sa=Xt;ua?sa=Xt*(1+Tt/100):sa=Xt/(1+Tt/100),on[Ct]={...on[Ct],aplicar_taxa:ua,valor_cota:Si(sa.toFixed(2))}}return on})},style:{accentColor:"#f59e0b"}}),a.jsxs("span",{className:"text-amber-500 font-medium",children:["Taxa (",Tt.toFixed(2),"%)"]})]})})()]}),a.jsxs("div",{className:"isolate",children:[a.jsx(lt,{className:"text-[10px] text-text-muted",children:"Valor"}),a.jsx(At,{ref:Ye=>{Ye&&(te.current[Ct]=Ye)},type:"text",inputMode:"decimal",placeholder:"R$ 0,00",value:Si(Zt.valor_cota),onChange:Ye=>{const Tt=Si(Ye.target.value),Xt=jl(Tt),Br=Number.isFinite(Xt)&&Xt>0?"Pago":"Pendente";ae(Wn=>{const xn=[...Wn];return Ct>=0&&Ct<xn.length&&(xn[Ct]={...xn[Ct],valor_cota:Tt,status_pagamento:Br,aplicar_taxa:Tt===""||Xt<=0?!1:xn[Ct].aplicar_taxa}),xn})},className:"h-8 text-xs text-text-primary placeholder:text-slate-400 bg-surface-2 border-border hover:border-border-hover focus:border-brand focus:ring-2 focus:ring-brand/20"})]})]}),a.jsx("div",{className:"flex justify-end",children:(()=>{const Ye=Zt.status_pagamento==="Pago",Tt=Number.isFinite(jl(Zt.valor_cota))&&jl(Zt.valor_cota)>0,Xt=Ye&&Tt;return a.jsx("button",{type:"button",onClick:()=>Cn(Ct,Zt.status_pagamento,Zt.valor_cota),disabled:Xt,className:`inline-flex items-center justify-center px-3 py-0.5 rounded text-xs font-medium border transition-all ${Ye&&Tt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 cursor-not-allowed":Ye?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 hover:bg-emerald-600/30 hover:border-emerald-600/60 cursor-pointer":"bg-amber-600/20 text-amber-400 border-amber-700/40 hover:bg-amber-600/30 hover:border-amber-600/60 cursor-pointer"}`,title:Xt?"No  possvel alterar (valor preenchido)":"Clique para alterar status",children:Ye?"Pago":"Pendente"})})()})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-3",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"flex items-center gap-2",children:[Zt.codigo!==null&&Zt.codigo!==void 0&&a.jsxs("span",{className:`text-sm font-bold rounded-md px-2.5 py-1 shadow-sm ${Zt.status_pagamento==="Pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",Zt.codigo]}),Fe(Zt.cliente_id)?a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:Ye=>{Ye&&(Te.current[Ct]=Ye)},type:"text",value:Zt.nome||"",onChange:Ye=>Tr(Ct,Ye.target.value),onFocus:()=>St(Ct),onKeyDown:Ye=>{if(Ye.key==="Enter"){Ye.preventDefault();const Tt=Ze(Ct);Tt!==null&&setTimeout(()=>{Te.current[Tt]?.focus()},0)}else if(Ye.key==="Delete"&&Zt.nome&&Ye.target===document.activeElement)Ye.preventDefault(),Ye.stopPropagation(),Tr(Ct,""),setTimeout(()=>{Te.current[Ct]?.focus()},0);else if(Ye.key==="ArrowDown"){Ye.preventDefault();const Tt=Ze(Ct);Tt!==null&&setTimeout(()=>{Te.current[Tt]?.focus()},0)}else if(Ye.key==="ArrowUp"){Ye.preventDefault();const Tt=Ot(Ct);Tt!==null&&setTimeout(()=>{Te.current[Tt]?.focus()},0)}},onBlur:async Ye=>{St(null);const Tt=(Ye.currentTarget?.value||"").trim();Tt===""?ie.current[Ct]&&sn(Ct):(ae(Xt=>{const Br=[...Xt];return Ct>=0&&Ct<Br.length&&(Br[Ct]={...Br[Ct],nome:Tt}),Br}),delete ie.current[Ct])},placeholder:"Nome do cliente...",className:"font-medium text-base bg-black/40 text-white placeholder:text-white/50 border border-white/15 rounded-md px-3 py-1.5 pr-14 focus:border-white/30 focus:outline-none focus:ring-2 focus:ring-white/20 min-w-[200px] max-w-[300px]",title:"Editar nome do Cliente Consumidor (histrico do agendamento)"}),Zt.nome?a.jsx("button",{type:"button",onClick:()=>{Tr(Ct,""),setTimeout(()=>{Te.current[Ct]?.focus()},0)},className:`absolute right-2 top-1/2 -translate-y-1/2 px-2 py-1 text-xs font-bold border rounded transition-all ${dt===Ct||!dt&&xt===Ct?"text-amber-300 bg-amber-500/20 border-amber-400/50 animate-pulse shadow-lg shadow-amber-500/30":"text-white/60 bg-white/10 hover:bg-white/20 hover:text-white/90 border-white/20 shadow-sm"}`,title:dt===Ct||!dt&&xt===Ct?"Ser limpo ao pressionar Delete":"Limpar nome (tecla Delete)",children:"DEL"}):ie.current[Ct]?a.jsx("button",{type:"button",onClick:()=>sn(Ct),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20 hover:text-emerald-300 border border-emerald-500/30 rounded transition-all shadow-sm",title:"Restaurar ltimo nome",children:a.jsx(c$,{className:"w-4 h-4"})}):null]}):a.jsx("span",{className:"font-medium text-base",children:Zt.nome}),a.jsx("button",{type:"button",className:"p-1 text-text-secondary hover:text-brand transition-colors",onClick:()=>Gt(Ct,Zt.nome),title:"Trocar participante",children:a.jsx(xc,{className:"w-5 h-5"})})]})}),a.jsx("div",{className:"isolate",children:a.jsx(At,{ref:Ye=>{Ye&&(te.current[Ct]=Ye)},type:"text",inputMode:"decimal",placeholder:"R$ 0,00",value:Si(Zt.valor_cota),onChange:Ye=>{const Tt=Si(Ye.target.value),Xt=jl(Tt),Br=Number.isFinite(Xt)&&Xt>0?"Pago":"Pendente";ae(Wn=>{const xn=[...Wn];return Ct>=0&&Ct<xn.length&&(xn[Ct]={...xn[Ct],valor_cota:Tt,status_pagamento:Br,aplicar_taxa:Tt===""||Xt<=0?!1:xn[Ct].aplicar_taxa}),xn})},className:"w-28 text-text-primary placeholder:text-slate-400 bg-surface-2 border-border hover:border-border-hover focus:border-brand focus:ring-2 focus:ring-brand/20"})}),a.jsxs("div",{className:"flex items-center gap-2 min-w-[240px] isolate",children:[a.jsxs(ea,{value:String(Zt.finalizadora_id||""),onValueChange:Ye=>{ae(Tt=>{const Xt=[...Tt];if(Ct>=0&&Ct<Xt.length){const Br=y.find(xn=>String(xn.id)===String(Ye)),Wn=Number(Br?.taxa_percentual||0)>0;Xt[Ct]={...Xt[Ct],finalizadora_id:Ye,aplicar_taxa:Wn?Xt[Ct].aplicar_taxa??!0:!1}}return Xt})},children:[a.jsx(Jn,{className:"w-[140px] flex-shrink-0",children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsx(Qn,{children:y.map(Ye=>a.jsx(Qe,{value:String(Ye.id),children:Ye.nome||Ye.tipo||"Outros"},Ye.id))})]}),a.jsx("div",{className:"flex-1 min-w-0 isolate",children:(()=>{const Ye=y.find(Wn=>String(Wn.id)===String(Zt.finalizadora_id)),Tt=Number(Ye?.taxa_percentual||0);if(Tt<=0)return a.jsx("div",{className:"h-5"});const Xt=jl(Zt.valor_cota),Br=Xt>0;return a.jsxs("label",{className:`flex items-center gap-1.5 text-xs transition-colors ${Br?"cursor-pointer hover:text-text-primary":"cursor-not-allowed opacity-50"}`,title:Br?`Taxa de ${Tt.toFixed(2)}%`:"Informe o valor primeiro",children:[a.jsx("input",{type:"checkbox",checked:!!Zt.aplicar_taxa,disabled:!Br,onChange:Wn=>{if(!Br){l({title:"Valor necessrio",description:"Informe o valor antes de aplicar a taxa.",variant:"destructive"});return}ae(xn=>{const on=[...xn];if(Ct>=0&&Ct<on.length){const ua=Wn.target.checked;let sa=Xt;ua?sa=Xt*(1+Tt/100):sa=Xt/(1+Tt/100),on[Ct]={...on[Ct],aplicar_taxa:ua,valor_cota:Si(sa.toFixed(2))}}return on})},className:`w-4 h-4 rounded border-2 border-amber-500 checked:bg-amber-500 checked:border-amber-500 focus:ring-2 focus:ring-amber-500 focus:ring-offset-1 ${Br?"cursor-pointer":"cursor-not-allowed"}`,style:{accentColor:"#f59e0b"}}),a.jsxs("span",{className:"whitespace-nowrap text-amber-500 font-medium",children:["Taxa (",Tt.toFixed(2),"%)"]})]})})()})]}),(()=>{const Ye=Zt.status_pagamento==="Pago",Tt=Number.isFinite(jl(Zt.valor_cota))&&jl(Zt.valor_cota)>0,Xt=Ye&&Tt;return a.jsx("button",{type:"button",onClick:()=>Cn(Ct,Zt.status_pagamento,Zt.valor_cota),disabled:Xt,className:`inline-flex items-center justify-center w-[90px] px-3 py-1 rounded text-sm font-medium border transition-all ${Ye&&Tt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 cursor-not-allowed":Ye?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 hover:bg-emerald-600/30 hover:border-emerald-600/60 cursor-pointer":"bg-amber-600/20 text-amber-400 border-amber-700/40 hover:bg-amber-600/30 hover:border-amber-600/60 cursor-pointer"}`,title:Xt?"No  possvel alterar (valor preenchido)":"Clique para alterar status",children:Ye?"Pago":"Pendente"})})(),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400",onClick:()=>{O(Ye=>[...Ye,Ct])},children:"Remover"})]})]},Pn)})})()})})]})]}),a.jsx(Ua,{className:"gap-2",children:a.jsxs(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:async()=>{await Tn("footer-close")},children:["Fechar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]})})]})})}),a.jsxs("div",{ref:ta,style:{position:"fixed",left:"0",top:"0",width:"900px",minHeight:"auto",padding:"30px",backgroundColor:"#ffffff !important",color:"#000000 !important",fontFamily:"Arial, sans-serif",opacity:"0",visibility:"hidden",zIndex:"-9999",pointerEvents:"none",overflow:"hidden"},children:[a.jsxs("div",{style:{marginBottom:"8px",paddingBottom:"6px",borderBottom:"2px solid #000",backgroundColor:"#fff",color:"#000"},children:[a.jsx("h1",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 6px 0",color:"#000",letterSpacing:"0.5px",textAlign:"center"},children:"RELATRIO DE PAGAMENTOS"}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"10px",color:"#000",fontWeight:"600"},children:[a.jsxs("div",{style:{display:"flex",gap:"20px",flex:1},children:[a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Data:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.start?new Date(h.start).toLocaleDateString("pt-BR"):"-"})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Quadra:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.court||"-"})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Cdigo:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.code?`#${h.code}`:"-"})]})]}),a.jsxs("div",{style:{display:"flex",gap:"30px",textAlign:"right"},children:[a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Total:"}),a.jsxs("strong",{style:{marginLeft:"4px",color:"#000",fontSize:"11px",display:"inline"},children:["R$ ",Si(m||0)]})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Diferena:"}),a.jsxs("strong",{style:{marginLeft:"4px",color:bt.diff<0?"#dc2626":"#16a34a",fontSize:"11px",display:"inline"},children:[bt.diff<0?"-":"","R$ ",Si(Math.abs(bt.diff).toFixed(2))]})]})]})]})]}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"8px",fontSize:"10px",backgroundColor:"#fff",fontFamily:"Arial, sans-serif",border:"1px solid #000",tableLayout:"fixed"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{backgroundColor:"#cccccc",borderBottom:"1px solid #000"},children:[a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"5%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"N"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"35%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Nome"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"10%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Cdigo"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"15%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Valor"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"20%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Forma"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"15%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Status"})]})}),a.jsx("tbody",{children:(()=>(ee||[]).filter((Ae,et)=>!(M||[]).includes(et)).map((Ae,et)=>{const br=y?.find(Xt=>String(Xt.id)===String(Ae.finalizadora_id)),Zt=Ae.status_pagamento==="Pago",Ct=s?.find(Xt=>Xt.id===Ae.cliente_id)?.is_consumidor_final,Ye=(Ae.nome||"Sem nome").trim().split(/\s+/).slice(0,2).join(" "),Tt=Ct?"0":Ae.codigo||"N/A";return a.jsxs("tr",{"data-participant-index":et,style:{backgroundColor:"#fff"},children:[a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word"},children:et+1}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"left",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word",overflow:"hidden"},children:Ye}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",fontSize:"10px",fontWeight:"600",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:Tt}),a.jsxs("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word"},children:["R$ ",Si(Ae.valor_cota||0)]}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",fontSize:"10px",fontWeight:"600",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:br?.nome||"N/D"}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:Zt?"#16a34a":"#ca8a04",fontSize:"10px",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:Zt?" Pago":" Pendente"})]},`participant-${et}-${Ae.cliente_id}`)}))()})]}),a.jsx("div",{style:{height:"2px",backgroundColor:"#fff"}}),a.jsxs("div",{style:{marginTop:"2px",textAlign:"center",fontSize:"10px",color:"#000",borderTop:"1px solid #000",paddingTop:"2px",display:"flex",justifyContent:"space-between",backgroundColor:"#fff"},children:[a.jsxs("div",{style:{color:"#000",fontWeight:"500"},children:["Gerado em: ",new Date().toLocaleString("pt-BR")]}),a.jsx("div",{id:"page-indicator",style:{fontSize:"10px",fontWeight:"bold",color:"#000"}})]})]}),a.jsx(zn,{open:F,onOpenChange:ke=>{if(!ke){_e([]),z("");try{j()}catch{}}V(ke)},children:a.jsxs(qn,{className:"sm:max-w-[500px]",onInteractOutside:ke=>{ke.preventDefault(),V(!1);try{j()}catch{}},children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Adicionar Participante"}),a.jsx(la,{children:"Selecione um cliente para adicionar aos pagamentos."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{ref:Rr,placeholder:"Buscar por cdigo ou nome...",value:q,onChange:ke=>{z(ke.target.value),L(0)},onKeyDown:ke=>{const Ae=q.toLowerCase().trim(),et=(s||[]).filter(lr=>{if(!Ae)return!0;const Ye=String(lr.codigo||""),Tt=(lr.nome||"").toLowerCase();return Ye.includes(Ae)||Tt.includes(Ae)}),br=et.find(lr=>lr?.is_consumidor_final===!0),Pn=et.filter(lr=>lr?.is_consumidor_final!==!0).sort((lr,Ye)=>{const Tt=lr.codigo||0,Xt=Ye.codigo||0;return Tt-Xt}),Ct=br?[br,...Pn]:Pn;if(ke.key==="ArrowDown")ke.preventDefault(),L(lr=>Math.min(lr+1,Ct.length-1));else if(ke.key==="ArrowUp")ke.preventDefault(),L(lr=>Math.max(lr-1,0));else if(ke.key==="Enter"&&Ct[U]){ke.preventDefault();const Ye={...Ct[U],timestamp:Date.now()};_e(Tt=>[...Tt,Ye])}},className:"pl-10 pr-10"}),q&&a.jsx("button",{type:"button",onClick:()=>z(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text",children:a.jsx(Yc,{className:"h-4 w-4"})})]}),a.jsx(Z,{type:"button",size:"sm",className:"bg-amber-500 hover:bg-amber-400 text-black shadow-md",onClick:()=>{o&&(w(15e3),o(()=>{V(!0)}),V(!1),z(""))},children:"+Novo"})]}),a.jsx("div",{ref:tt,className:"border rounded-md max-h-[400px] overflow-y-auto",children:(()=>{const ke=q.toLowerCase().trim(),Ae=(s||[]).filter(Ct=>{if(!ke)return!0;const lr=String(Ct.codigo||""),Ye=(Ct.nome||"").toLowerCase();return lr.includes(ke)||Ye.includes(ke)}),et=Ae.find(Ct=>Ct?.is_consumidor_final===!0),Zt=Ae.filter(Ct=>Ct?.is_consumidor_final!==!0).sort((Ct,lr)=>{const Ye=Ct.codigo||0,Tt=lr.codigo||0;return Ye-Tt}),Pn=et?[et,...Zt]:Zt;return Pn.length===0?a.jsx("div",{className:"p-8 text-center text-text-muted",children:"Nenhum cliente encontrado."}):Pn.map((Ct,lr)=>{const Ye=Ct?.is_consumidor_final===!0,Tt=ue.filter(Br=>Br.id===Ct.id).length,Xt=lr===U;return a.jsxs("div",{ref:Br=>{Me.current[lr]=Br},role:"button",tabIndex:0,className:`w-full px-4 py-3 text-left transition-all border-b border-border last:border-0 flex items-center gap-3 cursor-pointer ${Xt?"ring-2 ring-blue-500 ring-inset z-10":""} ${Ye?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":Tt>0?"bg-emerald-600/20 hover:bg-emerald-600/30":"hover:bg-surface-2"}`,onMouseEnter:()=>L(lr),onClick:Br=>{Br.preventDefault(),Br.stopPropagation();const Wn={...Ct,timestamp:Date.now()};_e(xn=>[...xn,Wn])},onKeyDown:Br=>{if(Br.key==="Enter"||Br.key===" "){Br.preventDefault();const Wn={...Ct,timestamp:Date.now()};_e(xn=>[...xn,Wn])}},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[(()=>Ct.codigo!==null&&Ct.codigo!==void 0?a.jsxs("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors ${Ye?"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Ct.codigo]}):null)(),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:`font-medium ${Ye?"text-amber-100/90":""}`,children:Ct.nome}),Ye&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),Tt>0&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-rose-600 hover:bg-rose-500 text-white text-base font-bold transition-colors",onClick:Br=>{Br.preventDefault(),Br.stopPropagation(),_e(Wn=>{const xn=Wn.findIndex(on=>on.id===Ct.id);if(xn!==-1){const on=[...Wn];return on.splice(xn,1),on}return Wn})},children:"-"}),a.jsx("span",{className:"inline-flex items-center justify-center min-w-[32px] h-7 px-2 rounded-full bg-sky-600 text-white text-base font-bold",children:Tt}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-emerald-600 hover:bg-emerald-500 text-white text-base font-bold transition-colors",onClick:Br=>{Br.preventDefault(),Br.stopPropagation();const Wn={...Ct,timestamp:Date.now()};_e(xn=>[...xn,Wn])},children:"+"})]})]},Ct.id)})})()})]}),a.jsxs(Ua,{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-text-muted",children:ue.length>0&&a.jsxs("span",{className:"font-medium",children:[ue.length," ",ue.length===1?"participante selecionado":"participantes selecionados"]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{type:"button",variant:"ghost",className:"border border-border",onClick:ke=>{ke.preventDefault(),ke.stopPropagation(),w(1e3),V(!1),z(""),_e([]);try{j()}catch{}},children:["Cancelar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]}),a.jsxs(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",disabled:ue.length===0,onClick:ke=>{console.log("[AddParticipant] Boto Salvar clicado"),ke.preventDefault(),ke.stopPropagation(),console.log("[AddParticipant] Protegendo modal de pagamentos (3000ms)"),w(3e3),console.log("[AddParticipant] Adicionando participantes:",ue.length);const Ae=ue.map(et=>({cliente_id:et.id,nome:et.nome,codigo:et.codigo,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:(()=>{const br=mt();return br?.id?String(br.id):null})(),aplicar_taxa:(()=>{const br=mt();return Number(br?.taxa_percentual||0)>0})()}));ae(et=>{const br=et.length,Zt=Ae.map((Pn,Ct)=>br+Ct);return me(Zt),setTimeout(()=>{me([])},1e3),[...et,...Ae]}),console.log("[AddParticipant] Fechando modal de adicionar participante"),V(!1),z(""),_e([]);try{j()}catch{}console.log("[AddParticipant] Concludo")},children:["Confirmar (",ue.length,")",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-emerald-700/50 rounded border border-emerald-500/30",children:""})]})]})]})]})}),a.jsx(zn,{open:ft,onOpenChange:ke=>{console.log(" [DownloadModal] onOpenChange chamado:",{open:ke,downloadStatus:gr}),!ke&&gr==="success"?(console.log(" [DownloadModal] Fechando modal de download (sucesso)"),_t(!1)):ke||console.log(" [DownloadModal] BLOQUEADO: Ainda baixando")},children:a.jsxs(qn,{className:"sm:max-w-md",onPointerDownOutside:ke=>{gr==="downloading"&&ke.preventDefault()},onEscapeKeyDown:ke=>{gr==="downloading"&&ke.preventDefault()},children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-center",children:gr==="downloading"?"Gerando PDF...":"PDF Gerado com Sucesso!"}),a.jsx(la,{className:"sr-only",children:gr==="downloading"?"Aguarde enquanto o relatrio de pagamentos est sendo gerado":"Relatrio de pagamentos gerado e baixado com sucesso"})]}),a.jsx("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:gr==="downloading"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-green-500"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Gerando seu relatrio..."}),a.jsxs("div",{className:"w-full max-w-xs",children:[a.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[a.jsx("span",{children:"Progresso"}),a.jsxs("span",{children:[Nt,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:a.jsx("div",{className:"bg-green-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${Nt}%`}})})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"rounded-full bg-green-100 p-3",children:a.jsx("svg",{className:"w-12 h-12 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),a.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Relatrio baixado com sucesso!"}),a.jsx("p",{className:"text-xs text-gray-400 text-center",children:ve})]})}),gr==="success"&&a.jsxs("div",{className:"flex flex-col gap-2",children:[navigator.share&&navigator.canShare&&navigator.canShare({files:[]})&&a.jsxs(Z,{onClick:async()=>{if(!_r){l({title:"Arquivo no disponvel",description:"Tente gerar o PDF novamente.",variant:"destructive"});return}try{console.log(" [PDF] Compartilhando via Web Share API...");const ke=new File([_r],ve,{type:"application/pdf"});await navigator.share({files:[ke],title:"Relatrio de Pagamentos",text:"Confira o relatrio de pagamentos"}),console.log(" [PDF] Compartilhado com sucesso"),l({title:"Compartilhado com sucesso!",variant:"success"})}catch(ke){if(ke.name==="AbortError"){console.log(" [PDF] Compartilhamento cancelado");return}console.error(" [PDF] Erro ao compartilhar:",ke),l({title:"Erro ao compartilhar",description:ke.message,variant:"destructive"})}},className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Compartilhar"]}),a.jsxs(Z,{onClick:()=>{qt?(console.log(" [PDF] Abrindo PDF em nova aba:",qt),window.open(qt,"_blank")):(console.error(" [PDF] URL do blob no disponvel"),l({title:"Erro ao abrir PDF",description:"URL do PDF no est disponvel.",variant:"destructive"}))},className:"w-full bg-green-600 hover:bg-green-700",children:[a.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Abrir PDF"]}),a.jsx("p",{className:"text-xs text-center text-gray-500 px-2",children:"O PDF foi baixado. Abra-o para visualizar, imprimir ou compartilhar."}),a.jsx(Z,{onClick:()=>_t(!1),variant:"ghost",className:"w-full",children:"Fechar"})]})]})}),a.jsx(zn,{open:xr.isOpen,onOpenChange:ke=>{if(!ke&&qr.current){console.log(" [StatusConfirmation] Bloqueado onOpenChange (protegido)");return}ke||(console.log(" [StatusConfirmation] Fechando modal via onOpenChange"),Wr({isOpen:!1,participantIndex:null,currentStatus:null}))},children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-[400px]",onInteractOutside:ke=>{qr.current&&(console.log(" [StatusConfirmation] Bloqueado clique fora"),ke.preventDefault())},onEscapeKeyDown:ke=>{qr.current&&(console.log(" [StatusConfirmation] Bloqueado ESC"),ke.preventDefault())},children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Alterar Status de Pagamento"}),a.jsx(la,{children:xr.currentStatus==="Pago"?a.jsxs(a.Fragment,{children:["Tem certeza que deseja marcar este participante como ",a.jsx("strong",{children:"Pendente"}),"?"]}):a.jsxs(a.Fragment,{children:["Tem certeza que deseja marcar este participante como ",a.jsx("strong",{children:"Pago"})," mesmo sem valor registrado?"]})})]}),a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/30",children:a.jsx("p",{className:"text-sm text-amber-400",children:xr.currentStatus==="Pago"?a.jsx(a.Fragment,{children:" Esta ao marcar o participante como pendente novamente para refazer o pagamento."}):a.jsx(a.Fragment,{children:" Esta ao marcar o participante como pago sem um valor especfico."})})})}),a.jsxs(Ua,{className:"gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>{Wr({isOpen:!1,participantIndex:null,currentStatus:null})},children:"Cancelar"}),a.jsx(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:()=>ze(xr.currentStatus==="Pago"?"Pendente":"Pago"),children:"Confirmar"})]})]})})]})}function bZe({form:e,setForm:t,localCustomers:r}){Xs(),fo();const{isEditParticipantModalOpen:n,closeEditParticipantModal:s,editParticipantData:o,participantsForm:i,setParticipantsForm:l,payMethods:c,protectPaymentModal:d,onParticipantReplacedRef:u}=qN(),[f,h]=p.useState(""),[m,x]=p.useState(!1),[g,v]=p.useState(0),y=Ce.useRef(null),b=Ce.useRef([]),w=Ce.useRef(null),j=O=>{const I=o.participantId;if(i[I]?.cliente_id===O.id)return;console.log(" [EditParticipantModal] Substituindo participante:",{de:o.participantName,para:O.nome,indice:I,id_para:O.id});const T=i[I];if(l.updateLocal&&l.getLocal){const k=l.getLocal();if(I>=0&&I<k.length){const $={cliente_id:O.id,nome:O.nome,codigo:O.codigo,valor_cota:T?.valor_cota||"",status_pagamento:T?.status_pagamento||"Pendente",finalizadora_id:T?.finalizadora_id||(c[0]?.id?String(c[0].id):null),aplicar_taxa:T?.aplicar_taxa||!1},q=[...k];q[I]=$,l.updateLocal(q)}}else l(k=>{if(I<0||I>=k.length)return k;const $={cliente_id:O.id,nome:O.nome,codigo:O.codigo,valor_cota:T?.valor_cota||"",status_pagamento:T?.status_pagamento||"Pendente",finalizadora_id:T?.finalizadora_id||(c[0]?.id?String(c[0].id):null),aplicar_taxa:T?.aplicar_taxa||!1},q=[...k];return q[I]=$,q});d(3e3),s(),h(""),u?.current&&u.current(I)};if(p.useEffect(()=>{n&&(h(""),x(!1),v(0))},[n]),p.useEffect(()=>{n&&b.current[g]&&b.current[g]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[g,n]),!n)return null;const _=f.trim().toLowerCase(),C=(r||[]).filter(O=>_?String(O?.nome||"").toLowerCase().includes(_):!0),A=C.find(O=>O?.is_consumidor_final===!0),P=C.filter(O=>O?.is_consumidor_final!==!0).sort((O,I)=>{const T=Number(O?.codigo),k=Number(I?.codigo);return Number.isFinite(T)&&Number.isFinite(k)?T-k:String(O?.nome||"").localeCompare(String(I?.nome||""))}),M=A?[A,...P]:P;return a.jsx(zn,{open:n,onOpenChange:O=>{console.log("[EditParticipantModal] onOpenChange:",O),O||(console.log("[EditParticipantModal] Protegendo modal de pagamentos"),d(2e3),s(),h(""))},modal:!0,children:a.jsxs(qn,{className:"sm:max-w-[500px]",onPointerDownOutside:O=>{console.log(" [EditParticipantModal] onPointerDownOutside - prevenindo"),O.preventDefault(),O.stopPropagation()},onInteractOutside:O=>{console.log(" [EditParticipantModal] onInteractOutside - prevenindo"),O.preventDefault(),O.stopPropagation(),d(2e3)},children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Trocar Participante"}),a.jsxs(la,{children:["Substituindo: ",a.jsx("strong",{children:o.participantName})]})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"edit-participant-search",children:"Buscar cliente"}),a.jsx(At,{ref:y,id:"edit-participant-search",type:"text",placeholder:"Digite o nome do cliente...",value:f,onChange:O=>{h(O.target.value),v(0)},onKeyDown:O=>{if(O.key==="ArrowDown")O.preventDefault(),v(I=>Math.min(I+1,M.length-1));else if(O.key==="ArrowUp")O.preventDefault(),v(I=>Math.max(I-1,0));else if(O.key==="Enter"&&M[g]){O.preventDefault();const I=M[g],T=o.participantId;i[T]?.cliente_id===I.id||(d(2e3),j(I))}},className:"mt-1",autoFocus:!0})]}),a.jsx("div",{ref:w,className:"border border-border rounded-md max-h-[300px] overflow-y-auto",children:m?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:"Carregando clientes..."}):M.length===0?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:_?"Nenhum cliente encontrado":"Nenhum cliente cadastrado"}):M.map((O,I)=>{const T=o.participantId,k=i[T]?.cliente_id===O.id,$=O?.is_consumidor_final===!0,q=I===g;return a.jsxs("button",{ref:z=>{b.current[I]=z},type:"button",className:Er(q&&"ring-2 ring-blue-500 ring-inset z-10","w-full px-4 py-3 text-left transition-all","border-b border-border last:border-b-0","flex items-center gap-3",k&&"bg-brand/10 cursor-not-allowed opacity-60",!k&&$&&"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40",!k&&!$&&"hover:bg-surface-2"),disabled:k,onMouseEnter:()=>v(I),onClick:z=>{z.preventDefault(),z.stopPropagation(),console.log("[EditParticipantModal] Cliente selecionado - protegendo modal"),d(2e3),j(O)},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[O.codigo!==null&&O.codigo!==void 0&&a.jsxs("span",{className:Er("inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors",$&&"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20",!$&&"bg-emerald-600/20 text-emerald-400"),children:["#",O.codigo]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:Er("font-medium",$&&"text-amber-100/90"),children:O.nome}),$&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),k&&a.jsx("span",{className:"text-xs text-brand font-medium",children:"Atual"})]},O.id)})})]}),a.jsx(Ua,{children:a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:O=>{console.log(" [EditParticipantModal] ========== BOTO CANCELAR CLICADO =========="),console.log(" [EditParticipantModal] preventDefault()"),O.preventDefault(),console.log(" [EditParticipantModal] stopPropagation()"),O.stopPropagation(),console.log(" [EditParticipantModal] Protegendo modal de pagamentos (2000ms)"),d(2e3),console.log(" [EditParticipantModal] Fechando modal de editar participante"),s(),console.log(" [EditParticipantModal] Limpando busca"),h(""),console.log(" [EditParticipantModal] ========== CANCELAR CONCLUDO ==========")},children:"Cancelar"})})]})})}const wZe=e=>e?e.trim().split(/\s+/).slice(0,2).join(" "):"",mh=56,bk=30,jZe=6,_Ze=24;function NZe({weekStart:e,weekBookings:t,activeCourtFilter:r,courtsMap:n,participantsByAgendamento:s,onBookingClick:o,onSlotClick:i,statusConfig:l,dayStartHour:c=jZe,dayEndHourExclusive:d=_Ze,weekDiasFuncionamento:u={},sidebarVisible:f=!1}){const h=p.useRef(null),m=p.useRef(null),[x,g]=Ce.useState(0),[v,y]=Ce.useState(window.innerWidth<768);Ce.useEffect(()=>{const S=()=>{y(window.innerWidth<768)};return window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const b=p.useMemo(()=>Array.from({length:7},(S,P)=>Ss(e,P)),[e]);p.useEffect(()=>{const S=()=>{m.current&&h.current&&(h.current.scrollLeft=m.current.scrollLeft)},P=()=>{h.current&&m.current&&(m.current.scrollLeft=h.current.scrollLeft)},M=()=>{if(m.current){const T=m.current.scrollHeight>m.current.clientHeight;g(T?17:0)}},O=m.current,I=h.current;return O&&O.addEventListener("scroll",S),I&&I.addEventListener("scroll",P),M(),window.addEventListener("resize",M),()=>{O&&O.removeEventListener("scroll",S),I&&I.removeEventListener("scroll",P),window.removeEventListener("resize",M)}},[]);const w=p.useMemo(()=>{if(r&&n[r]){const S=n[r],P=S.hora_inicio||`${c}:00:00`,M=S.hora_fim||`${d}:00:00`,[O]=String(P).split(":").map(Number),[I,T]=String(M).split(":").map(Number);let k=I===0&&T===0?24:I;return T>0&&k<24&&(k+=1),{start:O||c,end:k||d}}return{start:c,end:d}},[r,n,c,d]),j=p.useMemo(()=>Array.from({length:Math.max(0,w.end-w.start)},(S,P)=>w.start+P),[w]),_=p.useMemo(()=>Math.max(0,w.end-w.start)*(60/bk)*mh,[w]),C=p.useMemo(()=>{const S={};return b.forEach(P=>{S[or(P,"yyyy-MM-dd")]=[]}),t.forEach(P=>{const M=or(Po(P.start),"yyyy-MM-dd");S[M]&&S[M].push(P)}),S},[b,t]),A=(S,P)=>{const M=S.start.getHours()*60+S.start.getMinutes(),I=S.end.getHours()*60+S.end.getMinutes()-M,T=w.start*60,k=(M-T)/bk*mh,$=I/bk*mh,z=l[S.status]||{hex:"#888",text:"text-gray-400",label:"Unknown",icon:null},F=z.icon,V=40,ue=Math.max(V,$-4),_e=Math.min(1.3,ue/55),U=Math.max(11,Math.round(13*_e)),L=Math.max(10,Math.round(11*_e)),G=Math.max(9,Math.round(10*_e)),de=Math.max(14,Math.round(16*_e)),X=P?.[S.id]||[],W=X.filter(ee=>String(ee.status_pagamento||"").toLowerCase()==="pago").length,Y=X.length,me=I===30;return a.jsx("div",{id:`booking-${S.id}`,className:"absolute left-0.5 right-0.5 rounded-md border-2 bg-surface cursor-pointer transition-all hover:bg-surface-2 hover:shadow-md overflow-hidden",style:{top:`${k}px`,height:`${Math.max(V,$)}px`,borderColor:z.hex||"#888",borderLeftWidth:"3px",zIndex:5},onClick:()=>o(S),children:a.jsxs("div",{className:"h-full flex flex-col justify-center px-2 py-1",children:[a.jsx("div",{className:"flex items-center gap-1.5 mb-0.5",children:a.jsx("p",{className:"font-semibold truncate",style:{fontSize:`${U}px`,lineHeight:1.1,color:"#e2e8f0"},children:wZe(S.customer)})}),me&&(S.modality||Y>0)&&a.jsxs("div",{className:"flex items-center gap-1 w-full justify-between",style:{lineHeight:1},children:[S.modality&&a.jsx("span",{className:"text-xs font-bold text-white bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded px-1.5 py-0.5 whitespace-nowrap shadow-sm flex-shrink-0",style:{fontSize:Math.max(7,G-1)},children:S.modality}),Y>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-1.5 py-0.5 border flex items-center gap-0.5 whitespace-nowrap flex-shrink-0 ${W===Y?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(8,G-1)},children:[a.jsx(Vi,{style:{width:Math.max(10,G-1),height:Math.max(10,G-1)}}),a.jsxs("span",{children:[W,"/",Y]})]})]}),me&&a.jsxs("div",{className:"flex items-center gap-1.5 justify-between",children:[a.jsxs("span",{className:"font-semibold whitespace-nowrap",style:{fontSize:`${L}px`,color:"#999",lineHeight:1},children:[or(S.start,"HH:mm"),"",or(S.end,"HH:mm")]}),F&&a.jsxs("div",{className:"flex items-center gap-0.5",children:[!f&&!v&&a.jsx(F,{style:{width:Math.max(12,de-2),height:Math.max(12,de-2),color:z.hex}}),a.jsx("span",{className:"truncate font-semibold",style:{fontSize:`${L}px`,color:z.hex,lineHeight:1},children:z.label})]})]}),!me&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"truncate",style:{fontSize:`${L}px`,color:"#999",lineHeight:1,marginBottom:"2px"},children:[or(S.start,"HH:mm"),"",or(S.end,"HH:mm")]}),S.modality&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded px-1.5 py-0.5 whitespace-nowrap shadow-sm mb-0.5",style:{fontSize:Math.max(7,G-1),display:"inline-block",width:"fit-content"},children:S.modality}),a.jsxs("div",{className:"flex items-center gap-1 w-full justify-between",children:[F&&a.jsxs("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[!f&&!v&&a.jsx(F,{style:{width:de,height:de,color:z.hex}}),a.jsx("span",{className:"truncate font-semibold",style:{fontSize:`${G}px`,color:z.hex,lineHeight:1},children:S.status==="in_progress"?"Andamento":z.label})]}),Y>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-1.5 py-0.5 border flex items-center gap-0.5 whitespace-nowrap flex-shrink-0 ${W===Y?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(8,G-1)},children:[a.jsx(Vi,{style:{width:Math.max(12,G),height:Math.max(12,G)}}),a.jsxs("span",{children:[W,"/",Y]})]})]})]})]})},S.id)};return a.jsxs("div",{className:"flex-1 bg-surface rounded-lg border border-border flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"flex sticky top-0 z-20 bg-surface border-b border-border",children:[a.jsx("div",{className:"w-20 flex-shrink-0 flex items-center justify-center font-semibold text-sm border-r border-border bg-surface",children:"Horrios"}),a.jsxs("div",{ref:h,"data-header-scroll":!0,className:"flex flex-1 overflow-auto",style:{scrollbarWidth:"none",msOverflowStyle:"none",paddingRight:`${x}px`,minWidth:0},children:[a.jsx("style",{children:`
            [data-header-scroll]::-webkit-scrollbar {
              display: none;
            }
          `}),b.map(S=>a.jsxs("div",{className:"flex-1 basis-[140px] min-w-[140px] flex flex-col items-center justify-center py-3 border-r border-border bg-surface-2/50 text-center",children:[a.jsx("div",{className:"text-xs font-semibold text-text-muted",children:or(S,"EEE",{locale:Da}).toUpperCase()}),a.jsx("div",{className:"text-sm font-bold text-text-primary",children:or(S,"dd")})]},or(S,"yyyy-MM-dd")))]})]}),a.jsxs("div",{ref:m,className:"flex flex-1 overflow-auto",style:{minWidth:0},children:[a.jsxs("div",{className:"w-20 flex-shrink-0 bg-surface sticky left-0 z-10 flex flex-col relative",style:{borderRight:"1px solid var(--color-border)",minHeight:`${_}px`},children:[j.map(S=>a.jsxs(Ce.Fragment,{children:[a.jsx("div",{className:Er("relative border-b border-border/60",S%2===1&&"bg-surface-2/30"),style:{height:mh},children:a.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded px-1 text-sm font-bold whitespace-nowrap",children:[String(S).padStart(2,"0"),":00"]})}),a.jsx("div",{className:Er("relative border-b border-border/60",S%2===1&&"bg-surface-2/30"),style:{height:mh},children:a.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded px-1 text-sm font-bold whitespace-nowrap",children:[String(S).padStart(2,"0"),":30"]})})]},`time-${S}`)),a.jsx("div",{className:"absolute right-0 top-0 w-px bg-border pointer-events-none",style:{height:`${_}px`}})]}),b.map(S=>{const P=or(S,"yyyy-MM-dd"),M=C[P]||[],O=u[P]||{},I=r&&O[r]&&!O[r].funciona;return a.jsxs("div",{className:"flex-1 basis-[140px] min-w-[140px] relative border-r border-border bg-surface-2/10",style:{minHeight:`${_}px`},children:[j.map(T=>a.jsx("div",{className:Er("border-b border-border/60",T%2===1&&"bg-surface-2/5"),style:{height:mh*2},children:I?a.jsx("div",{className:"w-full h-full cursor-not-allowed bg-surface/60 flex items-center justify-center border-b border-border/60 transition-colors",onClick:k=>k.preventDefault(),children:a.jsxs("div",{className:"text-center pointer-events-none",children:[a.jsx(X4,{className:"h-5 w-5 text-text-primary mx-auto mb-1"}),a.jsx("div",{className:"text-xs font-medium text-text-primary mb-1",children:"Fechada"}),O[r]?.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:O[r].observacao})]})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"relative border-b border-border/60 transition-colors flex items-center justify-center cursor-pointer hover:bg-white/5",style:{height:mh},onClick:()=>{const k=new Date(S.getTime());k.setHours(T,0,0,0),console.log("Slot :00 clicked",{day:S,hour:T,slotDate:k,activeCourtFilter:r}),i?.(k,r)}}),a.jsx("div",{className:"relative border-b border-border/60 transition-colors flex items-center justify-center cursor-pointer hover:bg-white/5",style:{height:mh},onClick:()=>{const k=new Date(S.getTime());k.setHours(T,30,0,0),console.log("Slot :30 clicked",{day:S,hour:T,slotDate:k,activeCourtFilter:r}),i?.(k,r)}})]})},`${P}-${T}`)),M.map(T=>A(T,s))]},P)})]})]})}const _s=30,Xp=e=>{const t=String(e??"").replace(/\D/g,"");if(!t)return"";const r=(Number(t)/100).toFixed(2),[n,s]=r.split(".");return`${n.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${s}`},um=e=>{if(e==null||e==="")return NaN;const t=String(e).replace(/\./g,"").replace(",","."),r=parseFloat(t);return Number.isFinite(r)?r:NaN};function bU(e){const t=String(e||"").trim().split(/\s+/).filter(Boolean);return t.length===0?"":t.length===1?t[0]:`${t[0]} ${t[1]}`}const _l=56,SZe=6,oC=6,I3=24;Array.from({length:(I3-oC)*(60/_s)},(e,t)=>{const r=oC*60+t*_s,n=Math.floor(r/60),s=r%60;return{time:`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}`,isHourMark:s===0}});const Yp=["Futebol","Beach Tennis","Futevlei","Treino"];function bh(e){return _u(e,{weekStartsOn:1})}function CZe(e){const t=bh(e),r=Ss(t,6);return t.getMonth()===r.getMonth()?`${or(t,"dd")}-${or(r,"dd")} de ${or(r,"MMMM",{locale:Da})} de ${or(r,"yyyy")}`:`${or(t,"dd")} de ${or(t,"MMMM",{locale:Da})} - ${or(r,"dd")} de ${or(r,"MMMM",{locale:Da})} de ${or(r,"yyyy")}`}const el={scheduled:{label:"Agendado",accent:"bg-[#3B82F6]",text:"text-[#3B82F6]",border:"border-[#3B82F6]",hex:"#3B82F6",icon:ko},confirmed:{label:"Confirmado",accent:"bg-[#22C55E]",text:"text-[#22C55E]",border:"border-[#22C55E]",hex:"#22C55E",icon:Oi},in_progress:{label:"Em andamento",accent:"bg-[#FACC15]",text:"text-[#FACC15]",border:"border-[#FACC15]",hex:"#FACC15",icon:jG},finished:{label:"Finalizado",accent:"bg-[#6B7280]",text:"text-[#6B7280]",border:"border-[#6B7280]",hex:"#6B7280",icon:Fue},canceled:{label:"Cancelado",accent:"bg-[#EF4444]",text:"text-[#EF4444]",border:"border-[#EF4444]",hex:"#EF4444",icon:Dg},absent:{label:"Ausente",accent:"bg-[#F97316]",text:"text-[#F97316]",border:"border-[#F97316]",hex:"#F97316",icon:SG}},PZe={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},wU={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},jU=e=>{let t=Math.floor(e/60);const r=e%60;return t>=24&&(t=t%24),`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}`};function AZe({sidebarVisible:e=!1}){const{toast:t}=Xs(),{loadAlerts:r}=sj(),n=Mi(),{isPaymentModalOpen:s,openPaymentModal:o,closePaymentModal:i,isEditParticipantModalOpen:l,openEditParticipantModal:c,closeEditParticipantModal:d,editParticipantData:u,editingBooking:f,setEditingBooking:h,participantsForm:m,setParticipantsForm:x,paymentTotal:g,setPaymentTotal:v,payMethods:y,setPayMethods:b}=qN(),w=p.useMemo(()=>{try{return typeof window<"u"&&localStorage.getItem("debug:agenda")==="1"}catch{return!1}},[]),j=p.useCallback((...re)=>{if(w)try{console.log("[AgendaDbg]",...re)}catch{}},[w]);p.useEffect(()=>{try{Oe.current=Date.now()+2500,j("runAutomation:startup grace set",{until:Oe.current}),setTimeout(()=>{try{_n()}catch{}},2500+200)}catch{}const re=console.log,we=console.info,Ge=console.debug,ge=console.warn,nt=console.error,st=je=>{const ht=String(je||"");return ht.startsWith("[AgendaDbg]")||!1||ht.startsWith("[PulseDump]")||ht.startsWith("[Clientes:load]")||ht.startsWith("[AgendaSettings]")||ht.startsWith("[Auto]")||ht.startsWith("[DEBUG-PaymentModal]")||ht.startsWith(" EditGuard")};return console.log=(...je)=>{try{if(st(je[0]))return}catch{}return re(...je)},console.info=(...je)=>{try{if(st(je[0]))return}catch{}return we(...je)},console.debug=(...je)=>{try{if(st(je[0]))return}catch{}return Ge(...je)},console.warn=(...je)=>{try{if(st(je[0]))return}catch{}return ge(...je)},console.error=(...je)=>{try{if(st(je[0]))return}catch{}return nt(...je)},()=>{console.log=re,console.info=we,console.debug=Ge,console.warn=ge,console.error=nt}},[]);const _=p.useRef({active:!1,tag:"",start:0,timer:null,events:[]}),C=p.useCallback((re,we)=>{if(w)try{const Ge=Date.now(),ge=_.current&&_.current.active?Ge-(_.current.start||Ge):0;_.current.events.push({t:Ge,ms:ge,event:re,data:we})}catch{}},[w]),A=p.useCallback(re=>{if(w){try{if(!_.current.active)return;const{tag:we,start:Ge,events:ge}=_.current,nt=`[PulseDump] tag=${we} dur=${Date.now()-Ge}ms reason=${re}`;console.groupCollapsed(nt);for(const st of ge)console.log(` +${String(st.ms).padStart(4," ")}ms`,st.event,st.data||{});console.groupEnd()}catch{}try{_.current.timer&&clearTimeout(_.current.timer)}catch{}_.current={active:!1,tag:"",start:0,timer:null,events:[]}}},[w]),S=p.useCallback((re,we=5e3)=>{if(w){try{_.current.timer&&clearTimeout(_.current.timer)}catch{}_.current={active:!0,tag:re,start:Date.now(),timer:null,events:[]},_.current.timer=setTimeout(()=>A("timeout"),we),j("PulseStart",{tag:re,timeoutMs:we})}},[w,A,j]),{userProfile:P,authReady:M,company:O}=fo(),[I,T]=qC(),[k,$]=p.useState(new Date),[q,z]=p.useState("day"),[F,V]=p.useState(!1),[ue,_e]=p.useState({}),[U,L]=p.useState(!1),[G,de]=p.useState({}),[X,W]=p.useState("");p.useEffect(()=>{let re=!1;return(async()=>{try{if(!M||!O?.id)return;const{data:we,error:Ge}=await Q.from("agenda_settings").select("isis_subdomain").eq("empresa_id",O.id).single();if(re||Ge&&Ge.code!=="PGRST116")return;const ge=(we?.isis_subdomain||"").toLowerCase().replace(/[^a-z0-9]+/g,"").trim();W(ge)}catch{}})(),()=>{re=!0}},[M,O?.id]);const Y=p.useMemo(()=>{const re=O?.nome_fantasia||O?.nome||O?.razao_social||O?.codigoEmpresa||"";return String(re).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"").trim()},[O?.nome_fantasia,O?.nome,O?.razao_social,O?.codigoEmpresa]),me=p.useMemo(()=>{const re=X||Y;return re?`https://${re}.f7arena.com`:""},[X,Y]),ee=p.useCallback(async re=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(re);else{const we=document.createElement("textarea");we.value=re,we.style.position="fixed",we.style.top="0",we.style.left="0",we.style.opacity="0",document.body.appendChild(we),we.focus(),we.select(),document.execCommand("copy"),document.body.removeChild(we)}return!0}catch{return!1}},[]),[ae,le]=p.useState(!1),[Te,te]=p.useState(!1),[ie,xt]=p.useState(""),vt=p.useRef(null),[dt,St]=p.useState(!1),[ft,_t]=p.useState(new Date),gr=p.useRef(!1),be=p.useRef(""),Nt=p.useRef(null),Wt=p.useRef([]),_r=p.useRef({}),yr=p.useRef([]),ve=p.useRef(oC),at=p.useRef(I3),qt=p.useRef(new Date);p.useEffect(()=>{try{ae||_t(k||new Date)}catch{}},[k,ae]),p.useEffect(()=>{try{qt.current=ft||new Date}catch{}},[ft]);const $t=p.useCallback(()=>{try{return Nt.current||Wt.current?.[0]||""}catch{return""}},[]),De=p.useCallback((re=null)=>{try{const we=$t();if(!we)return[];const Ge=_r.current||{},ge=yr.current||[],nt=ve.current,st=at.current,je=re||ft||new Date,ht=(()=>{const ia=Ge?.[we]?.hora_inicio;if(!ia)return nt*60;const[ja,$a]=String(ia).split(":").map(Number);return ja*60+($a||0)})(),rt=(()=>{const ia=Ge?.[we]?.hora_fim;if(!ia)return st*60;const[ja,$a]=String(ia).split(":").map(Number);return(ja===0&&$a===0?24:ja)*60+($a||0)})(),nr=ia=>{const ja=Gd(ia),$a=Kd(ia);return ja===0&&$a===0?1440:ja*60+$a},yn=or(je,"yyyy-MM-dd"),fn=Ge?.[we]?.id,Ln=(ge||[]).filter(ia=>{const ja=ia.court===we,$a=fn!=null&&String(ia.court_id||"")===String(fn);return(ja||$a)&&or(ia.start,"yyyy-MM-dd")===yn&&ia.status!=="canceled"}).map(ia=>[nr(ia.start),nr(ia.end)]).sort((ia,ja)=>ia[0]-ja[0]),On=[];let ma=ht;for(const[ia,ja]of Ln)ia>ma&&On.push([ma,ia]),ma=Math.max(ma,ja);ma<rt&&On.push([ma,rt]);const Ja=new Date,Bs=or(Ja,"yyyy-MM-dd");let na=0;if(Bs===yn){const ia=Gd(Ja),ja=Kd(Ja),$a=ia*60+ja,js=_s||30;na=Math.ceil($a/js)*js}else if(Ja>je)return[];return na<=ht?On:na>=rt?[]:On.map(([ia,ja])=>[Math.max(ia,na),ja]).filter(([ia,ja])=>ja>ia).filter(([ia,ja])=>ja-ia>=60)}catch{return[]}},[$t,ft]),wt=p.useMemo(()=>{const re=me||"",we=ft||new Date,Ge=or(we,"EEEE",{locale:Da}).replace(/-feira\b/gi,"").trim(),ge=Ge?`${Ge.charAt(0).toUpperCase()}${Ge.slice(1)}`:"",nt=`${ge}${ge?", ":""}${or(we,"dd/MM",{locale:Da})}`,st=nr=>{let yn=Math.floor(nr/60),fn=nr%60;return yn>=24&&(yn=yn%24),`${String(yn).padStart(2,"0")}:${String(fn).padStart(2,"0")}`},ht=(De(we)||[]).map(([nr,yn])=>`${st(nr)}${st(yn)}`);if(ht.length===0)return`No momento no temos horrios disponveis para ${nt}.
Confira novamente mais tarde e agende pelo link abaixo 

${re}`.trim();const rt=ht.join(`
`);return`Horrios disponveis (${nt}):
${rt}

Agende pelo link abaixo 

${re}`.trim()},[me,ft,De]),Rt=p.useCallback(async()=>{if(me){xt("");try{vt.current=null}catch{}try{_t(k||new Date)}catch{}le(!0)}},[me,k]),Rr=p.useCallback(()=>{le(!1)},[]);p.useEffect(()=>{ae||St(!1)},[ae]);const Me=p.useCallback(re=>new Promise((we,Ge)=>{try{if(!re)return we(null);const ge=new Image;ge.crossOrigin="anonymous",ge.onload=()=>we(ge),ge.onerror=()=>we(null),ge.src=re}catch{we(null)}}),[]),tt=p.useCallback(async re=>await(await fetch(re)).blob(),[]),ut=p.useCallback(async()=>{const Ge=document.createElement("canvas");Ge.width=1080,Ge.height=1680;const ge=Ge.getContext("2d");if(!ge)throw new Error("Canvas indisponvel");const nt=ge.createLinearGradient(0,0,1080,1680);nt.addColorStop(0,"#07070A"),nt.addColorStop(1,"#0B0B10"),ge.fillStyle=nt,ge.fillRect(0,0,1080,1680);try{ge.save(),ge.globalAlpha=.55;const jr=ge.createRadialGradient(Math.round(1080*.55),Math.round(1680*.22),40,Math.round(1080*.55),Math.round(1680*.22),760);jr.addColorStop(0,"rgba(249,115,22,0.55)"),jr.addColorStop(1,"rgba(249,115,22,0)"),ge.fillStyle=jr,ge.fillRect(0,0,1080,1680),ge.restore()}catch{}const st=O?.logo_url||"",je=await Me(st),ht=1080/2;let rt=220;if(je){const en=Math.min(640/je.width,260/je.height),Yr=Math.round(je.width*en),gn=Math.round(je.height*en),Yn=Math.round(ht-Yr/2),Hn=130;ge.save(),ge.globalAlpha=.98,ge.drawImage(je,Yn,Hn,Yr,gn),ge.restore(),rt=Hn+gn}else ge.save(),ge.globalAlpha=.2,ge.fillStyle="white",ge.fillRect(Math.round(1080*.22),190,Math.round(1080*.56),10),ge.restore(),rt=230;const nr=(O?.nome_fantasia||O?.nome||O?.razao_social||"").toString().trim();ge.textAlign="center",ge.textBaseline="top",nr&&(ge.fillStyle="#E0E0E0",ge.font="600 40px system-ui, -apple-system, Segoe UI, Roboto, Arial",ge.fillText(nr,ht,rt+28),rt+=28+44);const yn="Horrios disponveis",fn=qt.current||new Date,Ln=or(fn,"EEEE",{locale:Da}).replace(/-feira\b/gi,"").trim(),On=Ln?`${Ln.charAt(0).toUpperCase()}${Ln.slice(1)}`:"",ma=`${On}${On?"  ":""}${or(fn,"dd/MM",{locale:Da})}`;ge.textAlign="center",ge.textBaseline="top";const Ja=rt+40;ge.fillStyle="#F8F8F8",ge.font="bold 72px system-ui, -apple-system, Segoe UI, Roboto, Arial",ge.fillText(yn,ht,Ja);const ia=ge.measureText(yn).width*.5,ja=Ja+72+10,$a=ht-ia/2;ge.save(),ge.fillStyle="#F5A623",ge.fillRect($a,ja,ia,2),ge.restore();const js=ja+22;ge.font="700 52px system-ui, -apple-system, Segoe UI, Roboto, Arial",ge.fillStyle="#F5A623",ge.fillText(ma,ht,js);const no=ge.measureText(ma).width,Ia=24,Ra=js+56,fs=ht-no/2-Ia/2,Js=no+Ia;ge.save();const yo=ge.createLinearGradient(fs,Ra,fs+Js,Ra);yo.addColorStop(0,"rgba(249,115,22,0.0)"),yo.addColorStop(.5,"rgba(249,115,22,0.9)"),yo.addColorStop(1,"rgba(249,115,22,0.0)"),ge.strokeStyle=yo,ge.lineWidth=4,ge.beginPath(),ge.moveTo(fs,Ra),ge.lineTo(fs+Js,Ra),ge.stroke(),ge.restore();const ai=De(),D=120,K=700,he=1080-240,Xe=720;ge.save(),ge.fillStyle="rgba(0,0,0,0.38)",ge.strokeStyle="rgba(255,255,255,0.10)",ge.lineWidth=2,((jr,mn,en,Yr,gn)=>{ge.beginPath(),ge.moveTo(jr+gn,mn),ge.lineTo(jr+en-gn,mn),ge.quadraticCurveTo(jr+en,mn,jr+en,mn+gn),ge.lineTo(jr+en,mn+Yr-gn),ge.quadraticCurveTo(jr+en,mn+Yr,jr+en-gn,mn+Yr),ge.lineTo(jr+gn,mn+Yr),ge.quadraticCurveTo(jr,mn+Yr,jr,mn+Yr-gn),ge.lineTo(jr,mn+gn),ge.quadraticCurveTo(jr,mn,jr+gn,mn),ge.closePath()})(D,K,he,Xe,28),ge.fill(),ge.stroke();const Dt=jr=>{let mn=Math.floor(jr/60),en=jr%60;return mn>=24&&(mn=mn%24),`${String(mn).padStart(2,"0")}:${String(en).padStart(2,"0")}`},Mt=(ai||[]).map(([jr,mn])=>`${Dt(jr)}${Dt(mn)}`),jt=10,Ve=Mt.slice(0,jt),Bt=Mt.length-Ve.length;ge.fillStyle="#FFFFFF",ge.font="700 54px system-ui, -apple-system, Segoe UI, Roboto, Arial",ge.shadowColor="rgba(0,0,0,0.6)",ge.shadowBlur=12,ge.shadowOffsetX=0,ge.shadowOffsetY=4;let Yt=K+96;const Ur=80;if(Ve.length===0)ge.fillText("Sem horrios disponveis",1080/2,Yt);else if(Mt.length===1)ge.fillStyle="#FFFFFF",ge.font="800 76px system-ui, -apple-system, Segoe UI, Roboto, Arial",ge.fillText(Mt[0],1080/2,Yt+12);else{for(const jr of Ve)ge.fillText(jr,1080/2,Yt),Yt+=Ur;Bt>0&&(ge.fillStyle="rgba(255,255,255,0.80)",ge.font="600 34px system-ui, -apple-system, Segoe UI, Roboto, Arial",ge.fillText(`+${Bt} intervalos`,1080/2,Yt+10))}ge.restore();try{const jr=(me||"").replace(/^https?:\/\//,"").trim();if(jr){ge.save(),ge.textAlign="center",ge.textBaseline="middle",ge.font="700 32px system-ui, -apple-system, Segoe UI, Roboto, Arial";const gn=ge.measureText(jr).width,Yn=Math.min(1080-200,Math.max(520,gn+30*2)),Hn=(1080-Yn)/2;ge.fillStyle="rgba(0,0,0,0.55)",ge.strokeStyle="rgba(245,166,35,0.55)",ge.lineWidth=2;const ns=24;ge.beginPath(),ge.moveTo(Hn+ns,1560),ge.lineTo(Hn+Yn-ns,1560),ge.quadraticCurveTo(Hn+Yn,1560,Hn+Yn,1560+ns),ge.lineTo(Hn+Yn,1560+64-ns),ge.quadraticCurveTo(Hn+Yn,1560+64,Hn+Yn-ns,1560+64),ge.lineTo(Hn+ns,1560+64),ge.quadraticCurveTo(Hn,1560+64,Hn,1560+64-ns),ge.lineTo(Hn,1560+ns),ge.quadraticCurveTo(Hn,1560,Hn+ns,1560),ge.closePath(),ge.fill(),ge.stroke(),ge.fillStyle="#F5A623",ge.shadowColor="rgba(0,0,0,0.55)",ge.shadowBlur=10,ge.shadowOffsetX=0,ge.shadowOffsetY=4,ge.fillText(jr,1080/2,1560+64/2),ge.restore()}}catch{}return Ge.toDataURL("image/png")},[O?.logo_url,Me,$t,De,me]);p.useEffect(()=>{gr.current=!!Te},[Te]),p.useEffect(()=>{be.current=ie||""},[ie]);const sr=p.useCallback(async()=>{if(!gr.current){if(be.current)return be.current;gr.current=!0,te(!0);try{const re=await ut();be.current=re,xt(re);try{vt.current=await tt(re)}catch{vt.current=null}return re}finally{gr.current=!1,te(!1)}}},[ut,tt]);p.useEffect(()=>{if(ae){try{vt.current=null}catch{}xt("");try{be.current=""}catch{}try{gr.current=!1}catch{}sr()}},[ft,ae,sr]),p.useEffect(()=>{ae&&sr()},[ae,sr]);const Sr=p.useCallback(async()=>{const we=await(async Ge=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(Ge);else{const ge=document.createElement("textarea");ge.value=Ge,ge.style.position="fixed",ge.style.top="0",ge.style.left="0",ge.style.opacity="0",document.body.appendChild(ge),ge.focus(),ge.select(),document.execCommand("copy"),document.body.removeChild(ge)}return!0}catch{return!1}})(wt);t({title:we?"Legenda copiada":"No foi possvel copiar",description:we?"Cole no story/status.":"Tente novamente.",variant:we?"success":"destructive"})},[wt,t]),xr=p.useCallback(async()=>{const re=await ee(me),we=(me||"").replace(/^https?:\/\//,"");t({title:re?"Link copiado":"No foi possvel copiar",description:we,variant:re?"success":"destructive"})},[ee,me,t]),Wr=p.useCallback(async()=>{try{const re=ie||await ut(),we=document.createElement("a");we.href=re;const ge=or(new Date,"yyyy-MM-dd-HH-mm");we.download=`horarios-${ge}.png`,document.body.appendChild(we),we.click(),document.body.removeChild(we),t({title:"Imagem baixada",description:"Agora  s postar no story/status.",variant:"success"})}catch{t({title:"Erro ao baixar imagem",description:"Tente novamente.",variant:"destructive"})}},[ie,ut,t]),qr=p.useCallback(async()=>{try{if(typeof window<"u"&&window.isSecureContext&&navigator.share){const re=await sr()||ie||await ut(),we=vt.current||await tt(re),ge=or(new Date,"yyyy-MM-dd-HH-mm"),st={files:[new File([we],`horarios-${ge}.png`,{type:"image/png"})]};try{if(!navigator.canShare||navigator.canShare(st)){await navigator.share(st);try{window.location.href="whatsapp://app"}catch{}return}}catch{}}await Wr();try{typeof window<"u"&&window.innerWidth<768?window.location.href="whatsapp://app":window.open("https://web.whatsapp.com/","_blank","noopener,noreferrer")}catch{}t({title:"Imagem pronta",description:"Imagem baixada. Abra o WhatsApp e envie no Status.",variant:"success"})}catch{await Wr()}},[ie,sr,ut,tt,Wr,t]),Tr=p.useCallback(async()=>{try{if(typeof window<"u"&&window.isSecureContext&&navigator.share){const re=await sr()||ie||await ut(),we=vt.current||await tt(re),ge=or(new Date,"yyyy-MM-dd-HH-mm"),st={files:[new File([we],`horarios-${ge}.png`,{type:"image/png"})]};try{!navigator.canShare||navigator.canShare(st)?await navigator.share(st):await Wr()}catch{await Wr()}}else await Wr();try{typeof window<"u"&&window.innerWidth<768?window.location.href="instagram://story-camera":window.open("https://www.instagram.com/","_blank","noopener,noreferrer")}catch{}}catch{await Wr()}},[ie,sr,ut,tt,Wr]);p.useCallback(async()=>{try{const re=ie||await ut(),we=vt.current||await tt(re),ge=or(new Date,"yyyy-MM-dd-HH-mm"),nt=new File([we],`horarios-${ge}.png`,{type:"image/png"}),st={text:wt,files:[nt]};if(navigator.share&&navigator.canShare&&navigator.canShare(st)){await navigator.share(st);return}if(navigator.share){await navigator.share({text:wt,url:me});return}const ht=`https://wa.me/?text=${encodeURIComponent(wt)}`;window.open(ht,"_blank","noopener,noreferrer"),await Sr(),await Wr()}catch{await Sr(),await Wr()}},[me,wt,ie,ut,tt,Sr,Wr]),p.useEffect(()=>{const re=we=>{if(we.key==="Escape"&&F){V(!1);return}if(we.key==="F10"){try{we.preventDefault()}catch{}V(Ge=>!Ge)}};return window.addEventListener("keydown",re),()=>window.removeEventListener("keydown",re)},[F]),p.useEffect(()=>{if(F&&window.innerWidth<768)if(screen.orientation&&screen.orientation.lock)screen.orientation.lock("landscape").catch(()=>{const re=document.getElementById("screen-orientation-meta");re&&re.setAttribute("content","landscape")});else{const re=document.getElementById("screen-orientation-meta");re&&re.setAttribute("content","landscape")}else if(!F&&window.innerWidth<768){screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock();const re=document.getElementById("screen-orientation-meta");re&&re.setAttribute("content","portrait-primary")}},[F]),p.useEffect(()=>{const re=I.get("date");if(re)try{const we=new Date(re+"T00:00:00");isNaN(we.getTime())||($(we),I.delete("date"),T(I,{replace:!0}))}catch(we){console.error("[AgendaPage] Erro ao parsear date da URL:",we)}},[I,T]);const[sn,Cn]=p.useState([]),ze=p.useRef([]);p.useEffect(()=>{ze.current=Array.isArray(sn)?sn:[]},[sn]);const[Fe,Le]=p.useState(!1),[Ze,Ot]=p.useState(""),mt=p.useRef(0),Qt=p.useRef(""),bt=p.useRef(!1),zt=p.useRef(0),[ne,He]=p.useState(!1),[Gt,Ht]=p.useState(!1),Fr=p.useRef(!1);p.useEffect(()=>{Fr.current||!M||!P?.codigo_empresa||k&&(Fr.current=!0,(async()=>{try{const re=Po(k),we=Ss(re,1),{data:Ge,error:ge}=await Q.from("agendamentos").select("id, codigo, inicio, fim, status, modalidade, quadra_id, cliente_id, auto_disabled, clientes, valor_total, created_by_isis").eq("codigo_empresa",P.codigo_empresa).gte("inicio",re.toISOString()).lt("inicio",we.toISOString()).order("inicio",{ascending:!0});if(ge)return;const nt=(Ge||[]).map(st=>({id:st.id,code:st.codigo,start:new Date(st.inicio),end:new Date(st.fim),status:st.status||"scheduled",modality:st.modalidade||"",customer:Array.isArray(st.clientes)&&st.clientes.length>0?st.clientes[0]:"",court:String(st.quadra_id||""),court_id:st.quadra_id,valor_total:st.valor_total??null,auto_disabled:!!st.auto_disabled,created_by_isis:!!st.created_by_isis}));Cn(st=>Array.isArray(st)&&st.length>0?st:nt)}catch{}})())},[M,P?.codigo_empresa,k,Q]);const[cr,nn]=p.useState(4),[Tn,Gn]=p.useState(!1),[ta,Aa]=p.useState(!1),ke=f,Ae=h,[et,br]=p.useState({}),Zt=p.useRef(0),Pn=p.useRef("");p.useEffect(()=>{const re=we=>{try{const Ge=we?.detail||{},ge=Ge.agendamentoId,nt=Ge.participants;if(!ge||!Array.isArray(nt))return;br(st=>{const je=st[ge]||[],ht=nt.map((rt,nr)=>{const yn=je[nr]||{};return{...yn,cliente_id:rt.cliente_id,nome:rt.nome,codigo:rt.codigo!==void 0?rt.codigo:yn.codigo??null,valor_cota:typeof rt.valor_cota=="string"?rt.valor_cota:yn.valor_cota??"",status_pagamento:rt.status_pagamento??yn.status_pagamento??"Pendente",finalizadora_id:rt.finalizadora_id??yn.finalizadora_id??null,aplicar_taxa:rt.aplicar_taxa??yn.aplicar_taxa??!1,ordem:nr+1}});return{...st,[ge]:ht}})}catch{}};return window.addEventListener("payments:saved",re),()=>window.removeEventListener("payments:saved",re)},[]);const Ct=p.useRef(!1);p.useEffect(()=>{Ct.current=ne,j("Modal state change:",{isModalOpen:ne}),C("modal",{open:ne})},[ne,j]);const lr=p.useRef("init"),Ye=p.useRef(0),Tt=p.useRef(!1),Xt=p.useRef(0),Br=p.useRef(!1),Wn=p.useRef(0),[xn,on]=p.useState(!1),ua=p.useRef(0),sa=p.useRef(!1),wa=p.useRef(0),Va=p.useCallback((re=800)=>{wa.current=Date.now()+re,j("UI:busy set",{ms:re})},[j]),J=p.useCallback(()=>Date.now()<wa.current,[]),Oe=p.useRef(0),Je=p.useRef(0),mr=p.useRef(!1),ot=p.useCallback(()=>{const re=Date.now();ne||re-Je.current<350||(Je.current=re,He(!0),mr.current=!0)},[ne]),ar=p.useRef(!1);p.useEffect(()=>{n.state?.openModal&&!ne&&!ar.current&&(ar.current=!0,ot(),window.history.replaceState({},document.title))},[n.state?.openModal,ne,ot]);const[ir,In]=p.useState({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),[ln,Kr]=p.useState(null),[oe,Ke]=p.useState(!0),ct=p.useRef(!0);p.useEffect(()=>{ct.current=!!oe},[oe]);const xe=p.useMemo(()=>Object.fromEntries((ln??[]).map(re=>[re.nome,re])),[ln]),$e=p.useMemo(()=>(ln??[]).map(re=>re.nome),[ln]),[Pe,Vt]=p.useState([]);p.useEffect(()=>{try{if(oe)return;const re=ln||[];if(!Array.isArray(re)||re.length===0||!Array.isArray(sn)||sn.length===0)return;let we=!1;const Ge=sn.map(ge=>{if(!ge)return ge;const nt=ge.court_id;if(nt==null)return ge;const st=re.find(je=>String(je.id)===String(nt));return st?.nome&&ge.court!==st.nome&&!($e||[]).includes(ge.court)?(we=!0,{...ge,court:st.nome}):ge});we&&Cn(Ge)}catch{}},[oe,ln,sn,$e]);const yt=P?.codigo_empresa,tr=p.useMemo(()=>yt?`quadras:list:${yt}`:"quadras:list",[yt]),dr=p.useMemo(()=>yt?`agenda:selectedCourts:${yt}`:"agenda:selectedCourts",[yt]),tn=p.useMemo(()=>yt?`agenda:viewFilter:${yt}`:"agenda:viewFilter",[yt]),[Lr,da]=p.useState(null),[rn,un]=p.useState(0);p.useEffect(()=>{try{Nt.current=Lr}catch{}},[Lr]),p.useEffect(()=>{try{Wt.current=Array.isArray(Pe)?Pe:[]}catch{}},[Pe]),p.useEffect(()=>{try{_r.current=xe||{}}catch{}},[xe]),p.useEffect(()=>{try{yr.current=Array.isArray(sn)?sn:[]}catch{}},[sn]),p.useEffect(()=>{Pe.length>0&&Lr===null&&da(Pe[0])},[Pe,Lr]);const[Dn,fa]=p.useState([]),Oa=p.useRef(null),us=p.useRef({scheduled:!0,canceledOnly:!1}),[Un,Ya]=p.useState(null),[$s,po]=p.useState(""),wi=p.useRef(0),zo=p.useRef(!1),ji=p.useRef(!1),[ec,rd]=p.useState(!1),[pl,Eu]=p.useState(()=>{try{return localStorage.getItem("agenda:hideCanceledInfo")==="1"}catch{return!1}});p.useEffect(()=>{try{localStorage.setItem("agenda:hideCanceledInfo",pl?"1":"0")}catch{}},[pl]);const Ko=p.useMemo(()=>{if(!P?.codigo_empresa)return null;const re=or(q==="week"?bh(k):k,"yyyy-MM-dd"),we=q==="week"?"week":"day";return`agenda:bookings:${P.codigo_empresa}:${we}:${re}`},[P?.codigo_empresa,k,q]),Hs=p.useMemo(()=>{if(!P?.codigo_empresa)return null;const re=or(k,"yyyy-MM-dd");return`agenda:participants:${P.codigo_empresa}:${re}`},[P?.codigo_empresa,k]),[tc,Xi]=p.useState(!1),Tl=p.useMemo(()=>({autoConfirmEnabled:!1,autoConfirmMinutesBefore:120,autoStartEnabled:!0,autoFinishEnabled:!0}),[]),[As,rc]=p.useState(Tl),[Ns,gl]=p.useState(Tl),[Dl,ku]=p.useState(!1),[xl,Yi]=p.useState(0),vl=p.useCallback(()=>Date.now()+(Number.isFinite(xl)?xl:0),[xl]),[R,fe]=p.useState(null);p.useEffect(()=>{(async()=>{if(console.log("[AgendaSettings][LOAD] Iniciando carregamento...",{authReady:M,company_id:O?.id}),!M||!O?.id){console.warn("[AgendaSettings][LOAD] Aguardando autenticao...");return}try{console.log("[AgendaSettings][LOAD] Modo:","PRODUO (wrapper)"),console.log("[AgendaSettings][LOAD] Buscando para empresa_id:",O.id);const{data:we,error:Ge}=await Q.from("agenda_settings").select("*").eq("empresa_id",O.id).maybeSingle();if(console.log("[AgendaSettings][LOAD] Resultado da query:",{data:we,error:Ge}),console.log("[AgendaSettings][LOAD] Data type:",we===null?"null":typeof we),Ge){console.error("[AgendaSettings][LOAD] ERRO ao carregar:",Ge);return}if(!we){console.warn("[AgendaSettings][LOAD] Nenhum registro encontrado (ainda no criado)");return}console.log("[AgendaSettings][LOAD]  Registro encontrado:",we);const ge={autoConfirmEnabled:!!we.auto_confirm_enabled,autoConfirmMinutesBefore:we.auto_confirm_enabled&&Number.isFinite(Number(we.auto_confirm_hours))?Number(we.auto_confirm_hours)*60:Tl.autoConfirmMinutesBefore,autoStartEnabled:!!we.auto_start_enabled,autoFinishEnabled:!!we.auto_finish_enabled};console.log("[AgendaSettings][LOAD]  Estado mapeado:",ge),rc(nt=>({...nt,...ge})),gl(ge),console.log("[AgendaSettings][LOAD]  Estados atualizados com sucesso!")}catch(we){console.warn("[AgendaSettings] unexpected load error",we)}})()},[M,O?.id]),p.useEffect(()=>{let re=!0,we=null,Ge=!1;const ge=async()=>{try{const{data:nt,error:st}=await Q.functions.invoke("time-br",{body:{}});if(!st&&nt&&re){const je=Number(nt.nowMs);if(Number.isFinite(je)){const ht=je-Date.now();Yi(ht),fe(Date.now());return}}if(!Ge){Ge=!0;try{console.warn("[TimeSync] time-br sem dados vlidos; usando relgio local.")}catch{}}}catch{if(!Ge){Ge=!0;try{console.warn("[TimeSync] time-br falhou; usando relgio local.")}catch{}}}};return ge(),we=setInterval(ge,5*60*1e3),()=>{re=!1,we&&clearInterval(we)}},[]);const[We,gt]=p.useState({}),Ut=2*60*60*1e3,zr=p.useCallback(re=>{gt(we=>({...we,[re]:Date.now()}))},[]),cn=p.useCallback(re=>{gt(we=>{if(!we||!(re in we))return we;const Ge={...we};return delete Ge[re],Ge})},[]),se=p.useCallback(re=>{const we=We?.[re];return typeof we=="number"&&Date.now()-we<Ut},[We]),[Se,Ee]=p.useState(null),it=p.useCallback(()=>new Promise(re=>{Ee({resolve:re})}),[]),Pt=p.useRef(new Map),hr=async()=>{console.log(" [AgendaSettings][SAVE] FUNO CHAMADA! "),console.log("[AgendaSettings][SAVE] Linha 509 - Antes do try");try{if(console.log("[AgendaSettings][SAVE] Linha 511 - Dentro do try"),console.log("[AgendaSettings][SAVE] authReady:",M),console.log("[AgendaSettings][SAVE] company:",O),!M||!O?.id){console.error("[AgendaSettings][SAVE] ERRO: No autenticado",{authReady:M,company:O}),t({title:"No autenticado",description:"Faa login para salvar as configuraes.",variant:"destructive"});return}console.log("[AgendaSettings][SAVE]  Autenticado! Preparando payload..."),console.log("[AgendaSettings][SAVE] automation atual:",As),ku(!0);const re={empresa_id:O.id,auto_confirm_enabled:!!As.autoConfirmEnabled,auto_confirm_hours:As.autoConfirmEnabled?Math.max(0,Math.round(Number(As.autoConfirmMinutesBefore||0)/60)):null,auto_start_enabled:!!As.autoStartEnabled,auto_finish_enabled:!!As.autoFinishEnabled};console.log("[AgendaSettings][SAVE] Payload preparado:",re),console.log("[AgendaSettings][SAVE] Modo:","PRODUO (wrapper)"),console.log("[AgendaSettings][SAVE] Supabase client type:",typeof Q.from);const{data:we,error:Ge}=await Q.from("agenda_settings").upsert(re,{onConflict:"empresa_id"}).select();if(console.log("[AgendaSettings][SAVE] Resultado do upsert:",{data:we,error:Ge}),console.log("[AgendaSettings][SAVE] Data type:",Array.isArray(we)?"array":typeof we),console.log("[AgendaSettings][SAVE] Data length:",we?.length),Ge)throw console.error("[AgendaSettings][SAVE]  ERRO no upsert:",Ge),Ge;!we||we.length===0?console.error("[AgendaSettings][SAVE]  AVISO: Upsert no retornou dados!"):console.log("[AgendaSettings][SAVE]  Dados salvos com sucesso:",we[0]),gl(As),console.log("[AgendaSettings][SAVE]  savedAutomation atualizado:",As),t({title:"Configuraes salvas",description:"As automaes da agenda foram atualizadas com sucesso."}),Xi(!1),console.log("[AgendaSettings][SAVE]  Salvamento concludo!")}catch(re){console.error(" [AgendaSettings][SAVE] ERRO CAPTURADO:",re),console.error("[AgendaSettings][SAVE] Stack:",re?.stack),console.error("[AgendaSettings][SAVE] Message:",re?.message);const we=re?.message||"Falha ao salvar as configuraes.";t({title:"Erro ao salvar",description:we,variant:"destructive"})}finally{console.log("[AgendaSettings][SAVE] Finally executado"),ku(!1)}},er=p.useCallback(async(re,we,Ge="user")=>{try{const ge=["canceled","finished","absent"],nt=["scheduled","confirmed","in_progress"],st=ge.includes(we),je=we==="canceled";let ht=!1;if(Ge==="user"&&nt.includes(we)){const fn=(sn||[]).find(ma=>ma.id===re),Ln=fn?ge.includes(fn.status):!1,On=fn?!!fn.auto_disabled:!1;(Ln||On)&&(ht=!!await it())}const rt=je?{canceled_by:Ge||"user",canceled_at:new Date().toISOString()}:{},nr=st?{status:we,auto_disabled:!0,...rt}:ht?{status:we,auto_disabled:!1}:{status:we},{error:yn}=await Q.from("agendamentos").update(nr).eq("codigo_empresa",P.codigo_empresa).eq("id",re).select("id");if(yn)throw yn;Cn(fn=>fn.map(Ln=>{if(Ln.id!==re)return Ln;const On={...Ln,status:we,customer:Ln.customer||""};return st?On.auto_disabled=!0:ht&&(On.auto_disabled=!1),On}));try{Pt.current.set(re,{status:we,ts:Date.now(),src:Ge})}catch{}try{const fn=JSON.parse(localStorage.getItem(Ko)||"[]");if(Array.isArray(fn)&&fn.length>0){const Ln=Array.isArray(fn)?fn.map(On=>{if(On.id!==re)return On;const ma={...On,status:we,customer:On.customer||""};return st?ma.auto_disabled=!0:ht&&(ma.auto_disabled=!1),ma}):fn;localStorage.setItem(Ko,JSON.stringify(Ln))}}catch{}if(Ge==="user")try{ht?cn(re):zr(re)}catch{}}catch(ge){console.error("Auto-status: falha ao atualizar",re,we,ge)}},[sn,Ko,zr,cn,it,ir]),Ar=p.useRef(!1),Cr=p.useRef(null),Lt=p.useRef(null),vn=p.useRef(null),Xr=p.useRef(!1),Or=p.useCallback(()=>{try{Cr.current&&(clearTimeout(Cr.current),Cr.current=null)}catch{}},[]),_n=p.useCallback(()=>{if(!M||!P?.codigo_empresa)return;if(Date.now()<(Oe.current||0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AutoDiag] scheduleNextAutomation:deferred returning-from-hidden")}catch{}Lt.current||(Lt.current=setTimeout(()=>{Lt.current=null;try{_n()}catch{}},800));return}if(Lt.current){try{clearTimeout(Lt.current)}catch{}Lt.current=null}if(!Xr.current){j("scheduleNextAutomation:skipped (initial data not ready)"),setTimeout(()=>_n(),800);return}if(Ct.current){j("scheduleNextAutomation:skipped (modal open)");return}C("auto:schedule"),Or();const we=vl();let Ge=1/0;const ge=nt=>{Number.isFinite(nt)&&nt>we&&nt<Ge&&(Ge=nt)};try{for(const nt of sn||[]){if(!nt||nt.auto_disabled||se(nt.id))continue;const st=nt.start instanceof Date?nt.start.getTime():new Date(nt.start).getTime(),je=nt.end instanceof Date?nt.end.getTime():new Date(nt.end).getTime();if(nt.status==="scheduled"&&Ns.autoConfirmEnabled){const ht=Number(Ns.autoConfirmMinutesBefore||0)*6e4;ge(st-ht),Ns.autoFinishEnabled&&ge(je)}nt.status==="confirmed"&&(Ns.autoStartEnabled&&ge(st),Ns.autoFinishEnabled&&ge(je)),nt.status==="in_progress"&&Ns.autoFinishEnabled&&ge(je)}}catch{}if(Ge!==1/0){const nt=Math.max(0,Math.min(Ge-we+250,6e5));try{console.debug("[Auto] next schedule in ms",nt)}catch{}try{an(Ge)}catch{}Cr.current=setTimeout(()=>{try{vn.current&&vn.current()}catch{}},nt)}},[M,P?.codigo_empresa,sn,Ns,se,Or,vl]),fr=p.useCallback(async re=>{try{if(!(typeof R=="number"&&Date.now()-R<6e5))try{const{data:ge}=await Q.functions.invoke("time-br",{body:{}}),nt=Number(ge?.nowMs);Number.isFinite(nt)&&(Yi(nt-Date.now()),fe(Date.now()))}catch{}try{_n()}catch{}let Ge=null;if(re?.id&&P?.codigo_empresa){const{data:ge}=await Q.from("agendamentos").select("id, inicio, fim, status, modalidade, quadra_id, cliente_id, auto_disabled").eq("codigo_empresa",P.codigo_empresa).eq("id",re.id).single();if(ge){const nt={...re,start:new Date(ge.inicio),end:new Date(ge.fim),status:ge.status||re.status,modality:ge.modalidade||re.modality,auto_disabled:!!ge.auto_disabled,customer:re.customer||""};Ge=nt,Cn(st=>st.map(je=>je.id===re.id?nt:je))}}try{const ge=Ge||re;if(ge&&ge.id){const nt=vl(),st=ge.start instanceof Date?ge.start.getTime():new Date(ge.start).getTime(),je=ge.end instanceof Date?ge.end.getTime():new Date(ge.end).getTime();if(!ge.auto_disabled&&!se(ge.id))if(ge.status==="in_progress"&&Ns.autoFinishEnabled&&Number.isFinite(je)&&nt>=je)await er(ge.id,"finished","automation");else if(ge.status==="scheduled"&&Ns.autoStartEnabled&&Number.isFinite(st)&&nt>=st)await er(ge.id,"in_progress","automation");else if(ge.status==="confirmed"&&Ns.autoStartEnabled&&Number.isFinite(st)&&nt>=st)await er(ge.id,"in_progress","automation");else if(ge.status==="scheduled"&&Ns.autoConfirmEnabled&&Number.isFinite(st)){const rt=Number(Ns.autoConfirmMinutesBefore||0)*6e4;nt>=st-rt&&await er(ge.id,"confirmed","automation")}else(ge.status==="scheduled"||ge.status==="confirmed")&&Ns.autoFinishEnabled&&Number.isFinite(je)&&nt>=je&&await er(ge.id,"finished","automation")}}catch{}try{vn.current&&vn.current()}catch{}try{console.log(" EditGuard | ok | tempo=",typeof R=="number"?"Servidor":"Local")}catch{}return{booking:Ge}}catch(we){try{console.warn(" EditGuard | falha leve",we?.message||we)}catch{}return{booking:null}}},[R,Q,P,Cn,_n,vl,As,se,er]);p.useEffect(()=>{if(!(!M||!P?.codigo_empresa)&&R&&!Xr.current){Xr.current=!0,j("initial-data:ready",{at:R});try{_n()}catch{}}},[R,M,P,_n,j]);const dn=p.useCallback(async()=>{if(!(!M||!P?.codigo_empresa)){if(Ct.current){j("runAutomation:skipped (modal open)");return}if(Date.now()<(Oe.current||0)){j("runAutomation:skipped (returning-from-hidden grace)");try{_n()}catch{}return}if(!Xr.current){j("runAutomation:skipped (initial data not ready)");try{_n()}catch{}return}if(!Ar.current){Ar.current=!0;try{try{console.debug("[Auto] tick")}catch{}C("auto:tick");const re=vl(),we=new Date(re),Ge=or(we,"yyyy-MM-dd");let ge=(sn||[]).filter(st=>or(st.start,"yyyy-MM-dd")===Ge);if(ge.length===0)try{const st=Po(we),je=Ss(st,1),{data:ht,error:rt}=await Q.from("agendamentos").select("id, inicio, fim, status, auto_disabled").eq("codigo_empresa",P.codigo_empresa).gte("inicio",st.toISOString()).lt("inicio",je.toISOString());!rt&&Array.isArray(ht)&&(ge=ht.map(nr=>({id:nr.id,start:new Date(nr.inicio),end:new Date(nr.fim),status:nr.status||"scheduled",auto_disabled:!!nr.auto_disabled})))}catch{}try{const{data:st,error:je}=await Q.from("agendamentos").select("id, inicio, fim, status, auto_disabled").eq("codigo_empresa",P.codigo_empresa).lt("fim",we.toISOString()).in("status",["scheduled","confirmed","in_progress"]);if(!je&&Array.isArray(st)&&st.length>0){const ht=st.map(nr=>({id:nr.id,start:new Date(nr.inicio),end:new Date(nr.fim),status:nr.status||"scheduled",auto_disabled:!!nr.auto_disabled})),rt=new Map(ge.map(nr=>[nr.id,nr]));for(const nr of ht)rt.has(nr.id)||rt.set(nr.id,nr);ge=Array.from(rt.values())}}catch{}let nt=!1;for(const st of ge){if(st.auto_disabled||se(st.id))continue;const je=st.start instanceof Date?st.start.getTime():new Date(st.start).getTime(),ht=st.end instanceof Date?st.end.getTime():new Date(st.end).getTime();if(st.status==="in_progress"&&Ns.autoFinishEnabled&&re>=ht){try{console.debug("[Auto] finish",{id:st.id})}catch{}await er(st.id,"finished","automation"),nt=!0;continue}if(st.status==="scheduled"&&Ns.autoStartEnabled&&re>=je){try{console.debug("[Auto] start-direct (skip confirm)",{id:st.id})}catch{}await er(st.id,"in_progress","automation"),nt=!0;continue}if(st.status==="confirmed"&&Ns.autoStartEnabled&&re>=je){try{console.debug("[Auto] start",{id:st.id})}catch{}await er(st.id,"in_progress","automation"),nt=!0;continue}if(st.status==="scheduled"&&Ns.autoConfirmEnabled){const rt=Number(Ns.autoConfirmMinutesBefore||0)*6e4;if(re>=je-rt){try{console.debug("[Auto] confirm",{id:st.id})}catch{}await er(st.id,"confirmed","automation"),nt=!0;continue}}if((st.status==="scheduled"||st.status==="confirmed")&&Ns.autoFinishEnabled&&re>=ht){try{console.debug("[Auto] catchup-finish",{id:st.id})}catch{}await er(st.id,"finished","automation"),nt=!0;continue}}if(nt)try{setTimeout(()=>{try{wr()}catch{}},800)}catch{}try{_n()}catch{}}finally{Ar.current=!1}}}},[M,P?.codigo_empresa,sn,Ns,er,se,_n,vl]);p.useEffect(()=>{vn.current=dn},[dn]),p.useEffect(()=>{const re=setInterval(dn,1e4);try{vn.current&&vn.current()}catch{}try{_n()}catch{}return()=>clearInterval(re)},[dn]),p.useEffect(()=>{const re=setInterval(()=>{try{if(!!!(Ns?.autoConfirmEnabled||Ns?.autoStartEnabled||Ns?.autoFinishEnabled))return;vn.current&&(console.debug("[Auto][Watchdog] forcing periodic automation run"),vn.current())}catch{}},18e5);return()=>clearInterval(re)},[Ns]),p.useEffect(()=>{if(Ko)try{const re=JSON.parse(localStorage.getItem(Ko)||"[]");if(Array.isArray(re)&&re.length>0){const we=re.map(Ge=>({...Ge,start:new Date(Ge.start),end:new Date(Ge.end),customer:Ge.customer||"",created_by_isis:!!Ge.created_by_isis}));j("cache:bookings:hydrate",{count:we.length,sample:we[0]}),C("cache:hydrate",{count:we.length}),Cn(Ge=>Ge&&Ge.length>0?Ge:we),Va(1200)}}catch{}},[Ko,j]),p.useEffect(()=>{const re=()=>{try{const ge=new Date().toISOString();if(document.visibilityState==="visible"){const nt=Date.now();Oe.current=nt+800}}catch{}},we=()=>{try{const ge=new Date().toISOString()}catch{}},Ge=()=>{try{const ge=new Date().toISOString()}catch{}};return document.addEventListener("visibilitychange",re),window.addEventListener("focus",we),window.addEventListener("blur",Ge),()=>{document.removeEventListener("visibilitychange",re),window.removeEventListener("focus",we),window.removeEventListener("blur",Ge)}},[ne,sn]),p.useEffect(()=>{try{_n()}catch{}return()=>{try{Or()}catch{}}},[sn,As,_n,Or]),p.useEffect(()=>{if(Hs)try{const re=JSON.parse(localStorage.getItem(Hs)||"{}");if(re&&typeof re=="object"){const we={};for(const[Ge,ge]of Object.entries(re||{})){const nt=Array.isArray(ge)?ge.slice():[];nt.sort((st,je)=>{const ht=Number.isFinite(Number(st?.ordem))?Number(st.ordem):Number.MAX_SAFE_INTEGER,rt=Number.isFinite(Number(je?.ordem))?Number(je.ordem):Number.MAX_SAFE_INTEGER;return ht!==rt?ht-rt:String(st?.id||"").localeCompare(String(je?.id||""))}),we[Ge]=nt}br(we),Pn.current=or(k,"yyyy-MM-dd")}}catch{}},[Hs]);const Dr=p.useCallback(async(re,we)=>{if(!M||!P?.codigo_empresa)return{map:{},ids:[]};const Ge=(Array.isArray(re)?re:[]).filter(Boolean);if(Ge.length===0)return{map:{},ids:[]};try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] fetchParticipantsBatch:start",{reqId:we,ids:Ge.length})}catch{}const{data:ge,error:nt}=await Q.from("agendamento_participantes").select("id, agendamento_id, codigo_empresa, cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey(nome, codigo)").in("agendamento_id",Ge).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(mt.current!==we)return{map:{},ids:Ge};if(nt)throw nt;const st={};for(const je of ge||[]){const ht=je.agendamento_id;st[ht]||(st[ht]=[]);const rt=je.nome||(Array.isArray(je.cliente)?je.cliente[0]?.nome:je.cliente?.nome)||"",nr=(Array.isArray(je.cliente)?je.cliente[0]?.codigo:je.cliente?.codigo)||null;st[ht].push({...je,nome:rt,codigo:nr})}for(const je of Ge){const ht=Array.isArray(st[je])?st[je].slice():[];ht.sort((rt,nr)=>{const yn=Number.isFinite(Number(rt?.ordem))?Number(rt.ordem):Number.MAX_SAFE_INTEGER,fn=Number.isFinite(Number(nr?.ordem))?Number(nr.ordem):Number.MAX_SAFE_INTEGER;return yn!==fn?yn-fn:String(rt?.id||"").localeCompare(String(nr?.id||""))}),st[je]=ht}br(je=>{const ht={...je};for(const rt of Ge)ht[rt]=st[rt]||[];try{Hs&&localStorage.setItem(Hs,JSON.stringify(ht))}catch{}return ht}),Cn(je=>{const ht=je||[];let rt=!1;const nr=ht.map(yn=>{const fn=st[yn.id];if(Array.isArray(fn)&&fn.length>0){const Ln=(fn.find(On=>On?.is_representante)||fn[0])?.nome||"";if(Ln&&Ln!==yn.customer)return rt=!0,{...yn,customer:Ln}}return yn});return rt?nr:je});try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] fetchParticipantsBatch:done",{reqId:we,rows:(ge||[]).length})}catch{}return{map:st,ids:Ge}},[M,P?.codigo_empresa,Hs,br,Cn]),wr=p.useCallback(async()=>{if(!M||!P?.codigo_empresa||ne)return;j("fetchBookings:start",{date:or(k,"yyyy-MM-dd"),empresa:P?.codigo_empresa}),C("fetch:start",{day:or(k,"yyyy-MM-dd")});const re=Po(k),we=q==="week"?bh(k):re,Ge=q==="week"?Ss(we,7):Ss(we,1),{data:ge,error:nt}=await Q.from("agendamentos").select(`
        id, codigo, codigo_empresa, quadra_id, cliente_id, clientes, valor_total, inicio, fim, modalidade, status, auto_disabled, created_by_isis,
        quadra:quadra_id ( nome )
      `).eq("codigo_empresa",P.codigo_empresa).gte("inicio",we.toISOString()).lt("inicio",Ge.toISOString()).order("inicio",{ascending:!0});if(nt){j("fetchBookings:error",{message:nt?.message,code:nt?.code,status:nt?.status}),C("fetch:error",{message:nt?.message,code:nt?.code,status:nt?.status}),t({title:"Erro ao carregar agendamentos",description:nt.message,variant:"destructive"}),zo.current||(zo.current=!0,setTimeout(wr,900));return}if(!ge||ge.length===0)return j("fetchBookings:empty-hit"),C("fetch:empty"),zo.current?zo.current=!1:(zo.current=!0,setTimeout(wr,700)),ze.current;zo.current=!1;const st=Date.now(),je=(()=>{try{const rt=Array.isArray(ze.current)?ze.current:[];return new Map(rt.map(nr=>[nr.id,nr]))}catch{return new Map}})(),ht=(ge||[]).map(rt=>{const nr=new Date(rt.inicio),yn=new Date(rt.fim),fn=je.get(rt.id),Ln=rt.quadra?.[0]?.nome||rt.quadra?.nome||Object.values(xe).find(na=>na.id===rt.quadra_id)?.nome||"",On=rt.quadra_id!=null?String(rt.quadra_id):"";let ma="";if(!ma&&rt.clientes)try{const na=typeof rt.clientes=="string"?JSON.parse(rt.clientes):rt.clientes;Array.isArray(na)&&na.length>0&&(ma=na[0]?.nome||na[0]||"")}catch{}const Ja=Pt.current.get(rt.id),Bs=Ja&&st-Ja.ts<4e3;return{id:rt.id,code:rt.codigo,court:Ln||On,court_id:rt.quadra_id,customer:fn&&fn.customer?fn.customer:ma,valor_total:rt.valor_total!==void 0?rt.valor_total:fn?.valor_total??null,start:nr,end:yn,status:Bs?Ja.status:rt.status||"scheduled",modality:rt.modalidade||"",auto_disabled:!!rt.auto_disabled,created_by_isis:!!rt.created_by_isis}});Cn(rt=>{const nr=Array.isArray(rt)?rt:[],yn=Array.isArray(ht)?ht:[];if(nr.length!==yn.length)return ht;for(let fn=0;fn<nr.length;fn++){const Ln=nr[fn],On=yn[fn];if(!Ln||!On)return ht;const ma=Ln.start instanceof Date?Ln.start.getTime():new Date(Ln.start).getTime(),Ja=Ln.end instanceof Date?Ln.end.getTime():new Date(Ln.end).getTime(),Bs=On.start instanceof Date?On.start.getTime():new Date(On.start).getTime(),na=On.end instanceof Date?On.end.getTime():new Date(On.end).getTime();if(Ln.id!==On.id||Ln.status!==On.status||Ln.modality!==On.modality||String(Ln.court||"")!==String(On.court||"")||String(Ln.court_id||"")!==String(On.court_id||"")||String(Ln.customer||"")!==String(On.customer||"")||Number(Ln.valor_total??NaN)!==Number(On.valor_total??NaN)||!!Ln.auto_disabled!=!!On.auto_disabled||ma!==Bs||Ja!==na)return ht}return rt});try{if(Ko){const rt=ht.map(nr=>({id:nr.id,code:nr.code,court:nr.court,court_id:nr.court_id,customer:nr.customer,valor_total:nr.valor_total??null,start:nr.start.toISOString(),end:nr.end.toISOString(),status:nr.status,modality:nr.modality,auto_disabled:nr.auto_disabled,created_by_isis:!!nr.created_by_isis}));localStorage.setItem(Ko,JSON.stringify(rt))}}catch{}return ht},[M,P?.codigo_empresa,k,xe,Ko,t,j,w,q,ne]);p.useEffect(()=>{(async()=>{if(!M||!P?.codigo_empresa||!k||ne)return;const we=or(q==="week"?bh(k):k,"yyyy-MM-dd"),Ge=`${P.codigo_empresa}:${q}:${we}`;if(Qt.current===Ge||bt.current)return;bt.current=!0;const ge=++mt.current;zt.current=Date.now();try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] start",{reqId:ge,bootKey:Ge,ts:new Date().toISOString()})}catch{}Le(!0),Ot("Carregando quadras");try{if(ct.current){const On=Date.now();let ma=!1;await new Promise(Ja=>{const Bs=setInterval(()=>{if(mt.current!==ge){clearInterval(Bs),Ja();return}if(ct.current||(clearInterval(Bs),Ja()),!ma&&Date.now()-On>5e3){ma=!0;try{console.warn("[AgendaBoot] aguardando courtsLoading >5s",{reqId:ge,bootKey:Ge})}catch{}}if(Date.now()-On>6500){try{console.warn("[AgendaBoot] timeout aguardando courtsLoading, prosseguindo boot",{reqId:ge,bootKey:Ge})}catch{}clearInterval(Bs),Ja()}},50)})}if(mt.current!==ge)return;Ot("Carregando agendamentos");try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] stage",{reqId:ge,stage:"bookings"})}catch{}const nt=Date.now();let st=!1;const je=setInterval(()=>{if(!st&&mt.current===ge&&Date.now()-nt>5e3){st=!0;try{console.warn("[AgendaBoot] aguardando fetchBookings >5s",{reqId:ge,bootKey:Ge})}catch{}}},250);let ht=await wr();try{clearInterval(je)}catch{}if(mt.current!==ge)return;let rt=Array.isArray(ht)?ht:[];if(rt.length===0){try{localStorage.getItem("debug:agenda")==="1"&&console.warn("[AgendaBoot] fetchBookings vazio, tentando novamente",{reqId:ge,bootKey:Ge})}catch{}if(await new Promise(On=>setTimeout(On,750)),ht=await wr(),mt.current!==ge)return;rt=Array.isArray(ht)?ht:[]}const nr=rt.map(On=>On.id).filter(Boolean);try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] bookings loaded",{reqId:ge,count:rt.length,idsCount:nr.length})}catch{}Ot("Carregando participantes");try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] stage",{reqId:ge,stage:"participants"})}catch{}const yn=Date.now();let fn=!1;const Ln=setInterval(()=>{if(!fn&&mt.current===ge&&Date.now()-yn>5e3){fn=!0;try{console.warn("[AgendaBoot] aguardando fetchParticipantsBatch >5s",{reqId:ge,bootKey:Ge,ids:nr.length})}catch{}}},250);await Dr(nr,ge);try{clearInterval(Ln)}catch{}Qt.current=Ge}catch(nt){try{console.warn("[AgendaBoot] erro ao carregar agenda:",{reqId:ge,bootKey:Ge,message:nt?.message,e:nt})}catch{}}finally{if(bt.current=!1,mt.current===ge){Le(!1),Ot("");try{const nt=Date.now()-(zt.current||Date.now());localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] done",{reqId:ge,bootKey:Ge,ms:nt})}catch{}}}})()},[M,P?.codigo_empresa,k,q,ne,oe,wr,Dr]),p.useEffect(()=>{if(w)try{const re=(sn||[]).map(we=>`${we.id}:${or(we.start,"HH:mm")}-${or(we.end,"HH:mm")}:${we.status}`).join(" | ");console.log("[AgendaDbg] bookings:changed",{count:Array.isArray(sn)?sn.length:0,summary:re})}catch{}},[sn,w]),p.useEffect(()=>{try{const re=Date.now()+1800;Xt.current=re,j("Picker:suppressClose window set",{until:re})}catch{}},[sn]),p.useEffect(()=>{M&&P?.codigo_empresa&&wr()},[M,P?.codigo_empresa,k,xe,Ko]);const Jr=p.useRef(null),[Mn,ha]=p.useState("idle"),[is,Gs]=p.useState(null),jn=p.useRef(!1);p.useEffect(()=>{if(!M||!P?.codigo_empresa)return;const re=Po(k),we=Ss(re,1),Ge=rt=>{try{const nr=new Date(rt);return nr>=re&&nr<we}catch{return!1}},ge=rt=>{const nr=rt?.new||rt?.old;if(nr&&nr.codigo_empresa===P.codigo_empresa&&(Ge(nr.inicio)||Ge(nr.fim))){try{console.debug("[Realtime] agendamentos change",{event:rt.eventType,id:nr.id})}catch{}Jr.current&&clearTimeout(Jr.current);try{Gs(Date.now())}catch{}if(Ct.current){j("Realtime:onChange deferred due to modal open"),jn.current=!0,C("rt:change:deferred",{id:nr.id,event:rt.eventType});return}j("Realtime:onChange scheduling fetchBookings"),C("rt:change",{id:nr.id,event:rt.eventType}),Jr.current=setTimeout(()=>{try{j("Realtime:debounced fetchBookings fire"),C("rt:debounced:fire"),Va(300),wr()}catch{}},400)}},nt=rt=>{const nr=rt?.new||rt?.old;if(nr&&nr.codigo_empresa===P.codigo_empresa){try{console.debug("[Realtime] agendamento_participantes change",{event:rt.eventType,agendamento_id:nr.agendamento_id})}catch{}Jr.current&&clearTimeout(Jr.current);try{Gs(Date.now())}catch{}if(Ct.current){j("Realtime:onParticipantsChange deferred due to modal open"),jn.current=!0,C("rt:participants:deferred",{agendamento_id:nr.agendamento_id,event:rt.eventType});return}j("Realtime:onParticipantsChange scheduling fetchBookings"),C("rt:participants",{agendamento_id:nr.agendamento_id,event:rt.eventType}),Jr.current=setTimeout(()=>{try{j("Realtime:participants debounced fetchBookings fire"),C("rt:participants:debounced:fire"),Va(300),wr()}catch{}},400)}},st=Q.channel(`agendamentos:${P.codigo_empresa}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamentos",filter:`codigo_empresa=eq.${P.codigo_empresa}`},ge).subscribe(rt=>{try{console.debug("[Realtime] channel status",rt)}catch{}try{ha(String(rt||"unknown"))}catch{}}),je=Q.channel(`agendamento_participantes:${P.codigo_empresa}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamento_participantes",filter:`codigo_empresa=eq.${P.codigo_empresa}`},nt).subscribe(),ht=setInterval(()=>{Ct.current||wr()},3e4);return()=>{try{Jr.current&&clearTimeout(Jr.current)}catch{}try{Q.removeChannel(st)}catch{}try{Q.removeChannel(je)}catch{}try{clearInterval(ht)}catch{}try{ha("polling")}catch{}}},[M,P?.codigo_empresa,k,wr]),p.useEffect(()=>{if(!ne&&jn.current){jn.current=!1;try{j("Modal closed: flushing pending realtime refresh"),C("rt:flushAfterModalClose"),wr()}catch{}}},[ne,wr,j]);const[Nr,an]=p.useState(null),Nn=p.useRef("");p.useEffect(()=>{try{const re=typeof R=="number"&&Date.now()-R<6e5,we=nr=>typeof nr=="number"?or(new Date(nr),"HH:mm:ss",{locale:Da}):"",Ge=nr=>typeof nr=="number"?or(new Date(nr),"HH:mm",{locale:Da}):"",ge=re?"":"",st=String(Mn).toUpperCase()==="SUBSCRIBED"||String(Mn).toLowerCase()==="polling"?"":"",je=typeof Nr=="number"?"":"",ht=Array.isArray(sn)?sn.length:0,rt=` Agenda | ${ge} Tempo=${re?"Servidor":"Local"} (${Math.round(xl)}ms, sync ${we(R)}) |  Realtime=${st} ${Mn}${is?` (${we(is)})`:""} | ${je} Prximo=${Ge(Nr)} |  Agendamentos=${ht}`;Nn.current!==rt&&(Nn.current=rt,console.log(rt)),typeof window<"u"&&(window.__AgendaConn={usingServer:re,serverOffsetMs:xl,lastTimeSyncAtMs:R,realtimeStatus:Mn,lastRealtimeEventAtMs:is,nextAutoAtMs:Nr})}catch{}},[xl,R,Mn,is,As,Nr,P?.codigo_empresa,k,Array.isArray(sn)?sn.length:0]),p.useEffect(()=>{const re=setInterval(()=>{try{const we=Date.now();if(we<(Oe.current||0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AutoDiag] reconcile:skipped returning-from-hidden")}catch{}return}if(ne){console.log("[AutoDiag] reconcile:skipped modal-open");return}const Ge=String(Mn||"").toUpperCase()==="SUBSCRIBED",ge=typeof is=="number"?we-is:1/0,nt=!Ge||ge>7*60*1e3,st=typeof Nr=="number"?we>Nr+60*1e3:!1;if(nt||st){console.debug("[Reconcile] forcing fetchBookings (stale=",nt," tickDue=",st,")"),wr();try{_n()}catch{}}}catch{}},3e5);return()=>clearInterval(re)},[Mn,is,Nr,wr,_n]),p.useEffect(()=>{(async()=>{if(!M||!P?.codigo_empresa||Date.now()<(Oe.current||0))return;if(Ct.current){j("Participants:skipped (modal open)");return}j("Participants:load start"),C("parts:start");const we=(sn||[]).map(ht=>ht.id).filter(Boolean),Ge=or(k,"yyyy-MM-dd");if(!we.length){if(Pn.current!==Ge){br({});try{Hs&&localStorage.setItem(Hs,"{}")}catch{}}Pn.current=Ge;return}const ge=++Zt.current,{data:nt,error:st}=await Q.from("agendamento_participantes").select("id, agendamento_id, codigo_empresa, cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey(nome, codigo)").in("agendamento_id",we).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(Zt.current!==ge)return;if(st){console.warn("[Participants] load error",st),j("Participants:error",{message:st?.message,code:st?.code,status:st?.status}),C("parts:error",{code:st?.code});return}const je={};for(const ht of nt||[]){const rt=ht.agendamento_id;je[rt]||(je[rt]=[]);const nr=ht.nome||(Array.isArray(ht.cliente)?ht.cliente[0]?.nome:ht.cliente?.nome)||"",yn=(Array.isArray(ht.cliente)?ht.cliente[0]?.codigo:ht.cliente?.codigo)||null;je[rt].push({...ht,nome:nr,codigo:yn})}for(const ht of we){const rt=Array.isArray(je[ht])?je[ht].slice():[];rt.sort((nr,yn)=>{const fn=Number.isFinite(Number(nr?.ordem))?Number(nr.ordem):Number.MAX_SAFE_INTEGER,Ln=Number.isFinite(Number(yn?.ordem))?Number(yn.ordem):Number.MAX_SAFE_INTEGER;return fn!==Ln?fn-Ln:String(nr?.id||"").localeCompare(String(yn?.id||""))}),je[ht]=rt}j("Participants:loaded",{bookings:we.length,rows:(nt||[]).length}),C("parts:loaded",{rows:(nt||[]).length}),Pn.current=Ge,br(ht=>{const rt={...ht};for(const nr of we)rt[nr]=je[nr]||[];try{Hs&&localStorage.setItem(Hs,JSON.stringify(rt))}catch{}return j("Participants:set state for ids",{ids:we}),C("parts:set",{idsCount:we.length}),rt}),Cn(ht=>{const rt=ht||[];let nr=!1;const yn=rt.map(fn=>{const Ln=je[fn.id];if(Array.isArray(Ln)&&Ln.length>0){const On=(Ln.find(ma=>ma?.is_representante)||Ln[0])?.nome||"";if(On&&On!==fn.customer)return nr=!0,{...fn,customer:On}}return fn});return nr?yn:ht})})()},[M,P?.codigo_empresa,sn,k,Hs,j]),p.useEffect(()=>{(async()=>{if(!(!M||!P?.codigo_empresa||!$e.length)){L(!0);try{const we=or(k,"yyyy-MM-dd"),Ge=k.getDay(),{data:ge,error:nt}=await Q.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",P.codigo_empresa).or(`and(tipo.eq.data_fechamento,data_fechamento.eq.${we}),and(tipo.eq.dia_semana,dia_semana.eq.${Ge})`);if(nt){console.error("Erro ao carregar dias de funcionamento:",nt);return}const st={};$e.forEach(je=>{const ht=xe[je];if(!ht)return;const rt=ge?.find(yn=>yn.quadra_id===ht.id&&yn.tipo==="data_fechamento"&&yn.data_fechamento===we);if(rt&&!rt.funciona){st[je]={funciona:!1,motivo:"data_especifica",observacao:rt.observacao||"Fechamento especial"};return}const nr=ge?.find(yn=>yn.quadra_id===ht.id&&yn.tipo==="dia_semana"&&yn.dia_semana===Ge);nr?st[je]={funciona:nr.funciona,motivo:nr.funciona?"normal":"dia_semana",observacao:nr.funciona?null:"Fechado neste dia da semana"}:st[je]={funciona:!0,motivo:"normal",observacao:null}}),_e(st)}catch(we){console.error("Erro ao verificar dias de funcionamento:",we)}finally{L(!1)}}})()},[M,P?.codigo_empresa,k,$e,xe]),p.useEffect(()=>{if(!M||!P?.codigo_empresa||$e.length===0)return;(async()=>{try{const we=new Date(k);we.setDate(we.getDate()-we.getDay());const{data:Ge,error:ge}=await Q.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",P.codigo_empresa);if(ge){console.error("Erro ao carregar funcionamento da semana:",ge);return}const nt={};for(let st=0;st<7;st++){const je=new Date(we);je.setDate(je.getDate()+st);const ht=or(je,"yyyy-MM-dd"),rt=je.getDay(),nr={};$e.forEach(yn=>{const fn=xe[yn];if(!fn)return;const Ln=Ge?.find(ma=>ma.quadra_id===fn.id&&ma.tipo==="data_fechamento"&&ma.data_fechamento===ht);if(Ln&&!Ln.funciona){nr[yn]={funciona:!1,motivo:"data_especifica",observacao:Ln.observacao||"Fechamento especial"};return}const On=Ge?.find(ma=>ma.quadra_id===fn.id&&ma.tipo==="dia_semana"&&ma.dia_semana===rt);On?nr[yn]={funciona:On.funciona,motivo:On.funciona?"normal":"dia_semana",observacao:On.funciona?null:"Fechado neste dia da semana"}:nr[yn]={funciona:!0,motivo:"normal",observacao:null}}),nt[ht]=nr}de(nt)}catch(we){console.error("Erro ao carregar funcionamento da semana:",we)}})()},[M,P?.codigo_empresa,k,$e,xe]),p.useEffect(()=>{Object.values(ue).some(we=>!we.funciona)&&Oa.current},[ue]),p.useEffect(()=>{if(yt)try{const re=JSON.parse(localStorage.getItem(tr)||"[]");Array.isArray(re)&&re.length&&(!ln||ln.length===0)&&(Kr(re),Ke(!1))}catch{}},[yt,tr]),p.useEffect(()=>{const re=async()=>{if(!P?.codigo_empresa)return;try{localStorage.getItem("debug:agenda")==="1"&&console.log("[Agenda][Courts] loadCourts:start",{empresa:P.codigo_empresa,hasCache:!!localStorage.getItem(tr)})}catch{}try{const nt=JSON.parse(localStorage.getItem(tr)||"[]");if(Array.isArray(nt)&&nt.length>0){const st=nt[0]?.codigo_empresa;if(st&&st!==P.codigo_empresa){console.warn(" [Cache Limpo] Quadras de outra empresa detectadas e removidas"),localStorage.removeItem(tr),localStorage.removeItem(dr),Kr([]);try{Vt([])}catch{}try{da(null)}catch{}try{setForm(je=>({...je,court:""}))}catch{}}}}catch{}(!ln||ln.length===0)&&Ke(!0);const{data:we,error:Ge}=await Q.from("quadras").select("id, nome, modalidades, hora_inicio, hora_fim, valor, codigo_empresa, status").eq("codigo_empresa",P.codigo_empresa).eq("status","Ativa").order("nome",{ascending:!0});if(Ge){console.error("Erro ao buscar quadras:",Ge),ji.current?Ke(!1):(ji.current=!0,setTimeout(re,900));try{localStorage.getItem("debug:agenda")==="1"&&console.warn("[Agenda][Courts] loadCourts:error",{empresa:P.codigo_empresa,message:Ge?.message,code:Ge?.code})}catch{}return}const ge=we||[];if(ge.length===0){let nt=0;try{const st=JSON.parse(localStorage.getItem("quadras:list")||"[]");nt=Array.isArray(st)?st.length:0}catch{}if(nt>0&&!ji.current){ji.current=!0,Ke(!1),setTimeout(re,700);return}}ji.current=!1,Kr(ge);try{localStorage.setItem(tr,JSON.stringify(ge))}catch{}Ke(!1);try{localStorage.getItem("debug:agenda")==="1"&&console.log("[Agenda][Courts] loadCourts:done",{empresa:P.codigo_empresa,count:Array.isArray(ge)?ge.length:0})}catch{}};M&&P?.codigo_empresa&&re()},[M,P?.codigo_empresa,tr,dr]),p.useEffect(()=>{try{if(oe)return;const re=$e||[];form?.court&&!re.includes(form.court)&&setForm(we=>({...we,court:re[0]||""})),(!form?.court||form.court==="")&&re.length>0&&setForm(we=>({...we,court:re[0]}))}catch{}},[oe,$e,P?.codigo_empresa]),p.useEffect(()=>{if(oe)return;const re=(()=>{try{return JSON.parse(localStorage.getItem(dr)||"[]")}catch{return[]}})(),we=(()=>{try{return JSON.parse(localStorage.getItem(tn)||"{}")}catch{return{}}})(),Ge=re.filter(ge=>$e.includes(ge));Ge.length>0?Vt(Ge):Pe.length===0&&Vt($e),we&&typeof we=="object"&&In(ge=>({...ge,canceledOnly:!1,...we}))},[oe,$e.length]),p.useEffect(()=>{try{localStorage.setItem(dr,JSON.stringify(Pe))}catch{}},[Pe,dr]),p.useEffect(()=>{try{localStorage.setItem(tn,JSON.stringify(ir))}catch{}},[ir,tn]);const Sn=p.useMemo(()=>{const re=Pe.map(Ge=>xe[Ge]?.hora_inicio||"06:00:00").map(Ge=>{const[ge,nt]=String(Ge).split(":").map(Number);return(ge||0)*60+(nt||0)});if(!re.length)return oC;const we=Math.min(...re);return Math.floor(we/60)},[Pe,xe]),hn=p.useMemo(()=>{const re=Pe.map(Ge=>xe[Ge]?.hora_fim||"24:00:00").map(Ge=>{const[ge,nt]=String(Ge).split(":").map(Number);return(ge===0&&nt===0?24:ge||0)*60+(nt||0)});if(!re.length)return I3;const we=Math.max(...re);return Math.ceil(we/60)},[Pe,xe]);p.useEffect(()=>{try{ve.current=Sn}catch{}},[Sn]),p.useEffect(()=>{try{at.current=hn}catch{}},[hn]),p.useEffect(()=>{const re=new Date,we=Gd(re),Ge=Kd(re);setTimeout(()=>{if(!Oa.current)return;const nt=Math.max(0,(we-Sn)*60+Ge)/_s;Oa.current.scrollTop=Math.max(0,nt*_l-120)},150)},[Sn]);const Pr=({booking:re,courtGridStart:we,courtGridEnd:Ge})=>{const ge=_l,nt=Ve=>{const Bt=Gd(Ve),Yt=Kd(Ve);return Bt===0&&Yt===0?1440:Bt*60+Yt},st=nt(re.start),je=nt(re.end),ht=we!==void 0?we:Lr?Ir.start*60:Sn*60,rt=Ge!==void 0?Ge:Lr?Ir.end*60:hn*60,nr=st-ht,yn=(rt-ht)/_s;let fn=Math.floor(nr/_s);const Ln=Math.max(0,je-st),On=Math.max(1,Math.ceil(Ln/_s));let ma=fn+On;fn=Math.max(0,Math.min(fn,yn-1)),ma=Math.max(0,Math.min(ma,yn)),ma<=fn&&(ma=fn+1),ma=Math.min(ma,yn);const Ja=fn*ge;let Bs=(ma-fn)*ge;const na=el[re.status]||el.confirmed,ia=na.icon,ja=na.border,$a=On===1,no=$a?4:SZe,Ia=Ja+no,Ra=Math.max($a?40:32,Bs-no*2),fs=Ln>=90,Js=2,yo=1.15,ai=fs?(()=>{const Ve=Math.min(Math.max((Ln-90)/90,0),1);return Math.min(yo+Ve*(Js-yo),Js)})():1,D=16,K=14,he=$a?16:24,Xe=Math.round(D*(fs?ai:1)),Ue=Math.round(K*(fs?ai:1)),Et=Math.round(he*(fs?ai:1)),Dt=et[re.id]||[],Mt=Dt.filter(Ve=>String(Ve.status_pagamento||"").toLowerCase()==="pago").length,jt=Dt.length;return a.jsxs(Mr.div,{layout:ne?!1:"position",initial:ne?!1:{opacity:0,y:6},animate:ne?!1:{opacity:1,y:0},exit:ne?!1:{opacity:0,y:6},id:`booking-${re.id}`,className:Er("absolute left-2 right-2 rounded-md border-2 bg-surface text-sm shadow-sm z-0 cursor-pointer",ja,"overflow-hidden transition-all duration-150 hover:bg-surface-2 hover:shadow-md"),style:{top:`${Ia}px`,height:`${Ra}px`},onClick:async()=>{const Ve=fr(re),Bt=new Promise(jr=>setTimeout(jr,600));let Yt=null;try{Yt=await Promise.race([Ve,Bt])}catch{}const Ur=Yt&&Yt.booking||sn.find(jr=>jr.id===re.id)||re;try{const jr=et[re.id]||[];console.log("[ORDER:CLICK] booking",{id:re.id,customer:Ur?.customer||re.customer,partsCount:jr.length}),jr.length>0&&console.table(jr.map((mn,en)=>({idx:en+1,ordem:mn?.ordem,nome:mn?.nome,cliente_id:mn?.cliente_id}))),console.log("[ORDER:CLICK] agendamento.clientes",Ur?.clientes??"(sem campo clientes)")}catch{}Ae(Ur),ot()},children:[a.jsx("div",{className:Er("absolute left-0 top-0 h-full w-[6px] rounded-l-md",na.accent)}),a.jsxs(Mr.div,{className:"flex-1 flex flex-col overflow-hidden pl-4 pr-3 py-2.5 md:pr-4 md:py-3",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[a.jsx("p",{className:"font-semibold text-text-primary truncate text-base",style:{fontSize:Xe,lineHeight:1.15},children:bU(re.customer)}),$a&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded-md px-2 py-0.5 whitespace-nowrap shadow-md",style:{fontSize:Ue},children:re.modality})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("span",{className:Er("text-text-muted font-semibold text-base whitespace-nowrap"),style:{fontSize:Xe},children:[or(re.start,"HH:mm"),"",or(re.end,"HH:mm")]}),$a&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(ia,{className:Er(na.text),style:{width:Et,height:Et}}),a.jsx("span",{className:Er("truncate font-semibold",na.text,"text-base"),style:{fontSize:Xe},children:na.label})]}),$a&&jt>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-2 py-0.5 border ${Mt===jt?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(11,Math.round(11*(fs?ai:1)))},children:[Mt,"/",jt]})]}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2 flex-wrap",children:[!$a&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded-md px-2.5 py-1 shadow-md",style:{fontSize:Ue},children:re.modality}),!$a&&a.jsxs("div",{className:"flex items-center gap-1.5 text-base flex-wrap justify-end",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(ia,{className:Er(na.text),style:{width:Et,height:Et}}),a.jsx("span",{className:Er("truncate font-semibold",na.text),style:{fontSize:Xe},children:(()=>typeof window<"u"&&window.innerWidth<768&&re.status==="in_progress"?"Andamento":na.label)()})]}),jt>0&&(()=>{const Ve=typeof window<"u"&&window.innerWidth<768;return a.jsxs("span",{className:Er("font-bold rounded-full border flex items-center gap-1 whitespace-nowrap",$a?"px-2 py-0.5 text-xs":"px-2.5 py-1 text-sm",Mt===jt?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"),style:{fontSize:Math.max($a?11:13,Math.round(($a?11:13)*(fs?ai:1)))},children:[a.jsx(Vi,{className:"w-3 h-3 flex-shrink-0"}),a.jsxs("span",{className:"whitespace-nowrap",children:[Mt,"/",jt,Ve?"":" pagos"]})]})})()]})]})]})]})},pn=()=>{p.useRef(Math.random().toString(36).slice(2)),qN();const re=p.useRef(0),we=p.useRef(""),Ge=Re=>{if(!Re)return"";if(typeof Re=="string")return Re;const pt=Re.nome||Re.name||"",Ft=Re.codigo??Re.code;return Ft!=null?`[${Ft}] ${pt}`:pt},ge=Re=>Re?typeof Re=="string"?Re:Re.nome||Re.name||"":"",nt=Re=>{const pt=xe[Re];if(!pt)return{start:Sn*60,end:hn*60};const[Ft,Jt]=String(pt.hora_inicio||"06:00:00").split(":").map(Number),[pr,Qr]=String(pt.hora_fim||"24:00:00").split(":").map(Number),kn=pr===0&&Qr===0?24:pr;return{start:Ft*60+(Jt||0),end:kn*60+(Qr||0)}},st=()=>{const Re=Gd(new Date),pt=Kd(new Date),Ft=Re*60+pt,Jt=$e[0]||"",pr=nt(Jt);return Math.max(pr.start,Math.min(pr.end-_s,Math.round(Ft/_s)*_s))},[je,ht]=p.useState(()=>{let Re=[];try{if(Array.isArray(Et)&&Et.length>0?Re=Et:Array.isArray(he.current)&&he.current.length>0&&(Re=he.current),Re.length>0)try{nr.current=!0}catch{}}catch{}return{selectedClients:Re,court:(()=>$e.find(Jt=>!ue[Jt]||ue[Jt].funciona)||$e[0]||"")(),modality:Yp[0],status:"scheduled",date:k,startMinutes:st(),endMinutes:st()+60}}),rt=p.useRef([]),nr=p.useRef(!1),yn=p.useRef(null);p.useEffect(()=>{rt.current=Array.isArray(je.selectedClients)?je.selectedClients:[];try{(rt.current||[]).length>0&&(nr.current=!0)}catch{}},[je.selectedClients]);const[fn,Ln]=p.useState(!1),[On,ma]=p.useState(""),Ja=p.useRef(""),Bs=p.useRef(""),na=p.useCallback(Re=>{try{Ja.current=String(Re||""),Bs.current=new Error("selectedClients:set").stack||""}catch{}},[]),ia=p.useRef(!1);p.useEffect(()=>{try{if(!ne||!ke?.id||ia.current)return;const Re=et[ke.id]||[];if(!Array.isArray(Re)||Re.length===0)return;const pt=Re.map(pr=>({id:pr.cliente_id,nome:pr.nome,codigo:pr.codigo??null})),Ft=Array.isArray(je.selectedClients)?je.selectedClients:[];if(!(Ft.length===pt.length&&Ft.every((pr,Qr)=>pr&&pt[Qr]&&pr.id===pt[Qr].id))){try{na("edit:apply-from-participants")}catch{}ht(pr=>({...pr,selectedClients:pt}));try{he.current=pt}catch{}try{Mt(pt)}catch{}try{nr.current=!0}catch{}try{ua.current=Date.now()+1500}catch{}try{console.log("[ORDER:OPEN_MODAL] chips (aplicados)",pt.map(pr=>pr.nome)),console.table(Re.map((pr,Qr)=>({idx:Qr+1,ordem:pr?.ordem,nome:pr?.nome,cliente_id:pr?.cliente_id})))}catch{}}ia.current=!0}catch{}},[ne,ke?.id,et]),p.useEffect(()=>{try{if(!ne)return;const Re=Array.isArray(je.selectedClients)?je.selectedClients:[];if(Re.length>0&&console.log("[ORDER:CHIPS] atual:",Re.map(pt=>pt.nome)),ke?.id){const pt=Array.isArray(et?.[ke.id])?et[ke.id]:[],Ft=pt.map(Qr=>String(Qr?.cliente_id??"")),Jt=Re.map(Qr=>String(Qr?.id??""));if(Ft.length>0&&Ft.join("|")!==Jt.join("|")){console.warn("[ORDER:CHIPS][MISMATCH]",{bookingId:ke.id,ref:pt.map(Qr=>({ordem:Qr?.ordem,nome:Qr?.nome,id:Qr?.cliente_id})),cur:Re.map((Qr,kn)=>({idx:kn+1,nome:Qr?.nome,id:Qr?.id})),lastReason:Ja.current});try{console.warn(Bs.current)}catch{}}}}catch{}},[ne,je.selectedClients,ke?.id,et]);const[ja,$a]=p.useState(0),js=p.useRef(0),no=p.useRef(!1);p.useEffect(()=>{const Re=()=>{try{if(document.visibilityState==="hidden"){no.current=!!(xn||fn);const pt=Date.now();try{ua.current=pt+1200}catch{}try{Xt.current=pt+1200}catch{}try{js.current=pt+800}catch{}}else if(document.visibilityState==="visible"){const pt=no.current;no.current=!1;const Ft=Date.now();try{ua.current=Math.max(ua.current||0,Ft+600)}catch{}try{Xt.current=Math.max(Xt.current||0,Ft+600)}catch{}try{js.current=Math.max(js.current||0,Ft+400)}catch{}pt&&!Ct.current&&setTimeout(()=>{Ct.current||(Ln(!0),on(!0))},60)}}catch{}};return document.addEventListener("visibilitychange",Re),()=>document.removeEventListener("visibilitychange",Re)},[xn,fn,ne]),p.useEffect(()=>{},[fn,xn]);const Ia=p.useRef(0);p.useEffect(()=>{const Re=Array.isArray(je.selectedClients)?je.selectedClients.length:-1,pt=Ia.current;Re!==pt&&(Ia.current=Re)},[je.selectedClients,fn,xn]);const[Ra,fs]=p.useState(!1),[Js,yo]=p.useState(null),[ai,D]=p.useState(!1),K=p.useRef(!1),he=p.useRef([]),Xe=p.useRef("init"),Ue=p.useRef(!1),[Et,Dt]=p.useState([]),Mt=p.useCallback(Re=>{Dt(Re)},[]),jt=p.useRef(null),Ve=p.useRef(null),Bt=p.useRef([]);p.useEffect(()=>{xn&&Bt.current[ja]&&Bt.current[ja]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[ja,xn]),p.useEffect(()=>{xn&&$a(0)},[xn]);const[Yt,Ur]=p.useState(!1),[jr,mn]=p.useState(!1);p.useState(!1);const[en,Yr]=p.useState(!1);p.useEffect(()=>{if(!s)return;let Re=!1;return(async()=>{try{if(!M||!P?.codigo_empresa)return;const pt=await $h({somenteAtivas:!0,codigoEmpresa:P.codigo_empresa});Re||b(Array.isArray(pt)?pt:[])}catch{}})(),()=>{Re=!0}},[s,M,P?.codigo_empresa]),p.useEffect(()=>{if(!s||!Array.isArray(y)||y.length===0)return;const Re=String(y[0].id);x(pt=>pt.length===0&&Array.isArray(je.selectedClients)&&je.selectedClients.length>0?je.selectedClients.map(pr=>({cliente_id:pr.id,nome:pr.nome,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:Re})):pt.map(Jt=>({...Jt,finalizadora_id:Jt.finalizadora_id&&Jt.finalizadora_id!==""?Jt.finalizadora_id:Re})))},[s,y]);const gn=p.useCallback((Re,pt)=>{try{const Ft=Date.now(),Jt=Ft<(wi.current||0)||Ft<(Xt.current||0),pr=!xn,Qr=!!Ue.current;let kn=Array.isArray(pt)?pt:[];if(kn.length===0&&pr&&Jt&&!Qr){const An=Array.isArray(he.current)?he.current:[];An.length>0&&(kn=An)}try{if(!ke&&Array.isArray(kn)&&kn.length>0&&yn.current){const An=kn.findIndex(Fa=>Fa&&Fa.id===yn.current);An>0&&(kn=[kn[An],...kn.filter((ws,as)=>as!==An)])}}catch{}try{na(`applySelectedClients:${Re}`)}catch{}ht(An=>({...An,selectedClients:kn})),Array.isArray(kn)&&kn.length>0&&(he.current=kn,Mt(kn),Ue.current=!1);try{Xe.current=Re}catch{}}catch{}},[xn,ht,Mt]);p.useState(""),p.useRef(null),p.useEffect(()=>{try{Ye.current=Date.now()}catch{}},[fn,jr]),p.useEffect(()=>{if(w){if(Tt.current=fn,fn)S("customer-picker",6e3),C("picker:open"),Br.current=!0,on(!0);else if(C("picker:close"),A("picker-close"),jn.current){jn.current=!1;try{j("Picker closed: flushing pending refresh"),C("picker:flush"),wr()}catch{}}}},[fn]);const Yn=p.useCallback((Re,pt={})=>{if(w)try{const Ft=new Date().toISOString(),Jt=lr.current,pr=!!Br.current,Qr=!!K.current}catch{}},[w,ne,fn,xn,jr,Ra]);p.useEffect(()=>{w&&Yn("state-change",{isCustomerPickerOpen:fn,effectiveCustomerPickerOpen:xn})},[w,fn,xn]),p.useEffect(()=>{if(!ne||xn)return;const Re=Array.isArray(je.selectedClients)?je.selectedClients:[],pt=Array.isArray(he.current)?he.current:[],Ft=Date.now()<(ua.current||0);if(Re.length===0&&pt.length>0&&!Ue.current&&Ft)Xe.current="global:restore",ht(Jt=>({...Jt,selectedClients:pt}));else if(Re.length===0&&pt.length>0&&Ue.current&&!Ft)try{he.current=[]}catch{}},[ne,xn,je.selectedClients]),p.useEffect(()=>{if(!ne)return;let Re=Br.current;try{const Ft=localStorage.getItem("agenda:customerPicker:desiredAt");if(Ft){const Jt=Number(Ft);Number.isFinite(Jt)&&Date.now()-Jt<3e3&&(Re=!0)}}catch{}if(!Re||fn||Date.now()<Xt.current||J())return;const pt=Date.now();pt-Wn.current<800||(Wn.current=pt,lr.current="open",Ln(!0),on(!0))},[fn,ne]),p.useEffect(()=>{const Re=Array.isArray(je.selectedClients)?je.selectedClients:[];Re.length>0&&(he.current=Re,Mt(Re))},[je.selectedClients]),p.useEffect(()=>{if(!ne||xn||Br.current)return;const Re=Array.isArray(je.selectedClients)?je.selectedClients:[],pt=(()=>{const Ft=Array.isArray(he.current)?he.current:[];return Ft&&Ft.length>0?Ft:[]})();Re.length===0&&pt.length>0&&!Ue.current&&(ht(Ft=>({...Ft,selectedClients:pt})),K.current=!1)},[xn,ne]);const Hn=p.useRef(0);p.useEffect(()=>{try{const Re=Date.now(),pt=Array.isArray(rt.current)?rt.current:[],Ft=Array.isArray(he.current)?he.current:[];if(Re-Hn.current>300&&(Hn.current=Re),ne&&!xn&&pt.length===0&&Ft.length>0&&!Ue.current){try{wi.current=Date.now()+2e3}catch{}try{const Jt=Xt?.current||0,pr={ts:new Date().toISOString(),reason:"empty-after-close",modalOpen:ne,pickerOpen:xn,formLen:Array.isArray(je?.selectedClients)?je.selectedClients.length:NaN,curLen:pt.length,lastLen:Ft.length,clearedByUser:!!Ue?.current,lastAction:Xe?.current,chipsLen:Array.isArray(Et)?Et.length:NaN,clientsLoading:!!jr,suppressUntil:Jt}}catch{}Mt(Ft),ht(Jt=>({...Jt,selectedClients:[...Ft]}));try{Promise.resolve().then(()=>{ht(Jt=>({...Jt,selectedClients:[...he.current]}))})}catch{}try{requestAnimationFrame(()=>{ht(Jt=>({...Jt,selectedClients:[...he.current||[]]}))})}catch{}setTimeout(()=>{const Jt=Array.isArray(rt.current)?rt.current:[],pr=Array.isArray(he.current)?he.current:[];Jt.length===0&&pr.length>0&&ht(Qr=>({...Qr,selectedClients:[...pr]}))},25),setTimeout(()=>{const Jt=Array.isArray(rt.current)?rt.current:[],pr=Array.isArray(he.current)?he.current:[];Jt.length===0&&pr.length>0&&ht(Qr=>({...Qr,selectedClients:[...pr]}))},120),setTimeout(()=>{const Jt=Array.isArray(rt.current)?rt.current:[],pr=Array.isArray(he.current)?he.current:[];Jt.length===0&&pr.length>0&&ht(Qr=>({...Qr,selectedClients:[...pr]}))},240)}}catch{}},[je.selectedClients,xn,ne]),p.useEffect(()=>{try{const Re=now<(wi.current||0),pt=Array.isArray(rt.current)?rt.current:[],Ft=Array.isArray(he.current)?he.current:[],Jt=now<(ua.current||0);if(ne&&!xn&&(Re||Jt)&&pt.length===0&&Ft.length>0&&!Ue.current){Dt(Ft),ht(pr=>({...pr,selectedClients:[...Ft]}));try{requestAnimationFrame(()=>ht(pr=>({...pr,selectedClients:[...he.current||[]]})))}catch{}setTimeout(()=>ht(pr=>({...pr,selectedClients:[...he.current||[]]})),32),setTimeout(()=>ht(pr=>({...pr,selectedClients:[...he.current||[]]})),96)}}catch{}},[je.selectedClients,xn,ne]),p.useEffect(()=>{Date.now()<(Oe.current||0)},[je.selectedClients,ne,xn]);const[ns,Do]=p.useState([]);p.useEffect(()=>{s&&Do([])},[s]);const Ta=p.useRef(!1),Kn=p.useRef(!1),[ao,Ms]=p.useState(null);p.useState(null);const bs=p.useRef(!1);p.useEffect(()=>{const Re=Array.isArray(je.selectedClients)?je.selectedClients:[],pt=ao,Ft=pt&&Re.some(Jt=>Jt&&Jt.id===pt);if(Re.length>0&&!Ft){let Jt=Re[0]?.id||null;try{if(ke?.id){const pr=et?.[ke.id]||[],Qr=Array.isArray(pr)?pr.find(kn=>kn?.is_representante===!0):null;Qr?.cliente_id&&Re.some(kn=>String(kn?.id)===String(Qr.cliente_id))&&(Jt=Qr.cliente_id)}}catch{}Ms(Jt)}else Re.length===0&&pt&&Ms(null)},[je.selectedClients,ne,ke,et]);const Xn=p.useRef(!1),pa=p.useRef(!1),[ps,qs]=p.useState(Dn),Ji=p.useRef(0);p.useEffect(()=>{if(!(Date.now()<(Oe.current||0)))if(jr){Ji.current||(Ji.current=Date.now());const pt=setTimeout(()=>{jr&&(!Array.isArray(ps)||ps.length===0)&&mn(!1)},2e3);return()=>clearTimeout(pt)}else Ji.current=0},[jr,ps]);const kc=p.useMemo(()=>Array.isArray(je.selectedClients)?je.selectedClients:[],[je.selectedClients]),Ml=p.useMemo(()=>{const Re=kc||[];if(Re.length===0)return"Adicionar clientes";const pt=Re[0]?.nome||"Cliente",Ft=Re.length-1;return Ft>0?`${pt} +${Ft}`:pt},[kc]),ba=p.useMemo(()=>{const Re=Array.isArray(je.selectedClients)?je.selectedClients:[],pt=Array.isArray(rt.current)?rt.current:[],Ft=Array.isArray(he.current)?he.current:[],Jt=Array.isArray(Et)?Et:[];return Re.length>0&&Re.every(pr=>pr?.nome)?Re:Re.length>0?Re.map(pr=>{if(pr?.nome)return pr;const Qr=pt.find(ws=>ws?.id===pr?.id),kn=Ft.find(ws=>ws?.id===pr?.id),An=Jt.find(ws=>ws?.id===pr?.id),Fa=(ps||[]).find(ws=>ws?.id===pr?.id);return{...pr,nome:Qr?.nome||kn?.nome||An?.nome||Fa?.nome||pr?.nome||"Cliente"}}):pt.length>0&&pt.every(pr=>pr?.nome)?pt:Jt.length>0&&Jt.every(pr=>pr?.nome)?Jt:Ft.length>0&&Ft.every(pr=>pr?.nome)?Ft:Re},[je.selectedClients,Et,ps]),Qa=!!(ne&&ke?.id&&!(Array.isArray(et?.[ke.id])&&et[ke.id].length>0));p.useEffect(()=>{if(!(Date.now()<(Oe.current||0)))try{j("Chips:effective change",{effectiveLen:Array.isArray(kc)?kc.length:0,formLen:Array.isArray(je.selectedClients)?je.selectedClients.length:0,lastLen:Array.isArray(he.current)?he.current.length:0,pickerOpen:fn})}catch{}},[kc,je.selectedClients,fn]);const so=p.useRef(null),_i=p.useRef(!1);p.useEffect(()=>{if(ne){Array.isArray(Dn)&&Dn.length>0&&qs(Dn);try{if(!ps||ps.length===0){const Re=P?.codigo_empresa?`clientes:list:${P.codigo_empresa}`:null;if(Re){const pt=JSON.parse(localStorage.getItem(Re)||"[]");Array.isArray(pt)&&pt.length>0&&qs(pt)}}}catch{}}},[ne,Dn]),p.useEffect(()=>{ne||(so.current=null,mn(!1))},[ne]),p.useEffect(()=>{ne||(Ta.current=!1,Kn.current=!1,Yr(!1),pa.current=!1)},[ne]);const nd=p.useRef(!1);p.useEffect(()=>{if(ne&&!nd.current?nd.current=!0:!ne&&nd.current,ke)ad.current=!1;else{if(ad.current)return;ad.current=!0;try{if(Date.now()<(re.current||0))return}catch{}try{Br.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{Ue.current=!1}catch{}try{try{he.current=[]}catch{}try{Dt([])}catch{}ht(Re=>({...Re,selectedClients:[]}))}catch{}}},[ne,ke]);const ad=p.useRef(!1);p.useEffect(()=>{if(!ne){ad.current=!1;try{we.current="";try{he.current=[]}catch{}try{Dt([])}catch{}try{nr.current=!1}catch{}try{re.current=0}catch{}try{ua.current=0}catch{}Ht(!1),nn(4);try{Xt.current=0}catch{}try{lr.current=null}catch{}try{Br.current=!1}catch{}ht(Re=>({...Re,selectedClients:[]})),Ms(null)}catch{}return}if(ke)ad.current=!1;else{if(ad.current)return;ad.current=!0;try{if(Date.now()<(re.current||0))return}catch{}try{Br.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{Ue.current=!1}catch{}try{try{he.current=[]}catch{}try{Dt([])}catch{}ht(Re=>({...Re,selectedClients:[]}))}catch{}}},[ne,ke]);const Rl=p.useCallback(async(Re={})=>{const{autoSave:pt=!1}=Re;if(!en){Yr(!0);try{const Ft=xe[je.court];if(!Ft){t({title:"Selecione uma quadra",variant:"destructive"}),Ta.current=!1,Kn.current=!1;return}const Jt=je.startMinutes,pr=je.endMinutes;if(!(Number.isFinite(Jt)&&Number.isFinite(pr)&&pr>Jt)){t({title:"Horrio invlido",variant:"destructive"}),Ta.current=!1,Kn.current=!1;return}if(!wf(Jt,pr)){t({title:"Conflito de horrio",description:"O horrio selecionado est ocupado.",variant:"destructive"}),Ta.current=!1,Kn.current=!1;return}const kn=(zs,go)=>new Date(zs.getFullYear(),zs.getMonth(),zs.getDate(),Math.floor(go/60),go%60,0,0),An=kn(je.date,Jt),Fa=kn(je.date,pr);let ws=Array.isArray(je.selectedClients)&&je.selectedClients.length>0?je.selectedClients:Array.isArray(rt.current)?rt.current:[];if((!ws||ws.length===0)&&ke?.id)try{const zs=Array.isArray(he.current)?he.current:[];zs&&zs.length>0&&(ws=zs,ht(go=>({...go,selectedClients:zs})))}catch{}const as=[...ws];console.log(" [FIX] selNowSnapshot criado:",as.length,"participantes"),console.log(" [FIX] form.selectedClients:",je.selectedClients?.length||0),console.log(" [FIX] editingBooking.id:",ke?.id),console.log(" [LOG 3 - FECHAR MODAL AGENDAMENTO] Estado ao salvar:"),console.log("   Participantes selecionados:",as.length),as.forEach((zs,go)=>{console.log(`   #${go+1}: ${zs.nome}`)}),console.log("   participantsForm (contexto):",(m||[]).length),(m||[]).forEach((zs,go)=>{console.log(`   #${go+1}: ${zs.nome} | Status: ${zs.status_pagamento} | Valor: ${zs.valor_cota}`)});let ca=as,Ni=!1,Zi=!1;if(ke?.id){const go=(et[ke.id]||[]).map(E=>String(E?.cliente_id??"")),Ll=as.map(E=>String(E?.id??"")),mi=go.join("|"),ac=Ll.join("|");Zi=mi!==ac;const Is=[...go].sort().join("|"),N=[...Ll].sort().join("|");Ni=Is!==N,console.log(" [DEBUG] Comparao de ordem:"),console.log("   ordemAtual:",ac),console.log("   ordemBanco:",mi),console.log("   mudouOrdem:",Zi),console.log("   mudouParticipantes:",Ni)}const Fl=Ni||Zi;let Vd=0;(!Number.isFinite(Vd)||Vd<0||Vd>=(ca||[]).length)&&(Vd=0);const nc=ca[0],Wd=ca.map(ge).filter(Boolean);if(!ke?.id&&!nc?.id){t({title:"Selecione um cliente",description:"Para criar um agendamento, selecione pelo menos um cliente.",variant:"destructive"});return}if(ke?.id){const zs=ke.status,go=je.status!==zs,Ll={quadra_id:Ft.id,cliente_id:nc?.id??null,clientes:Wd,inicio:An.toISOString(),fim:Fa.toISOString(),modalidade:je.modality};if(!go){let H=je.status;try{const ce=vl(),ye=An.getTime();if(!!As?.autoConfirmEnabled&&Number.isFinite(Number(As?.autoConfirmMinutesBefore))){const Ne=Number(As.autoConfirmMinutesBefore)*6e4,Ie=ye-Ne;H==="confirmed"&&ce<Ie?H="scheduled":H==="scheduled"&&ce>=Ie&&(H="confirmed")}}catch{}Ll.status=H}const{error:mi}=await Q.from("agendamentos").update(Ll).eq("codigo_empresa",P.codigo_empresa).eq("id",ke.id);if(mi)throw mi;const{data:ac}=await Q.from("agendamento_participantes").select("*").eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0}),Is=ac||[],N=(Is||[]).some(H=>{const ce=Number(H?.valor_cota)||0,ye=H?.status_pagamento||"Pendente";return ce>0||ye==="Pago"});if(console.log(" [SAVE-BOOKING] houveMudancaDeParticipantes:",Ni),console.log(" [SAVE-BOOKING] currentArray.length:",Is.length),console.log(" [SAVE-BOOKING] selNowFinal.length:",ca.length),console.log(" [SAVE-BOOKING] hasPayments:",N),Fl)if(!ca||ca.length===0)console.error(" [SAVE-BOOKING] PROTEO ACIONADA: No vou deletar participantes com selNowFinal vazio!"),console.error(" [SAVE-BOOKING] Isso evita perda de dados. Verifique por que selNowFinal est vazio.");else if(N){try{const pe=(Is||[]).map(Ne=>Ne?.id).filter(Boolean);if(pe.length>0){const{error:Ne}=await Q.from("agendamento_participantes").update({ordem:null,is_representante:!1}).in("id",pe).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id).is("deleted_at",null);Ne&&console.error("Erro ao liberar ordens antes do update (com pagamentos):",Ne)}}catch(pe){console.error("Erro inesperado ao liberar ordens antes do update (com pagamentos):",pe)}const H=new Map;try{(Is||[]).forEach(pe=>{const Ne=String(pe?.cliente_id??""),Ie=H.get(Ne)||[];Ie.push(pe),H.set(Ne,Ie)})}catch{}const ce=new Map,ye=new Set;for(let pe=0;pe<ca.length;pe++){const Ne=ca[pe];if(!Ne?.id)continue;const Ie=String(Ne.id),qe=ce.get(Ie)||0,Kt=(H.get(Ie)||[])[qe]||null;if(ce.set(Ie,qe+1),Kt?.id){ye.add(Kt.id);const Be={cliente_id:Ne.id,nome:Kt.nome??Ne.nome,ordem:pe+1,is_representante:pe===Vd,deleted_at:null},{error:It}=await Q.from("agendamento_participantes").update(Be).eq("id",Kt.id).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id);It&&console.error("Erro ao atualizar participante (com pagamentos):",It)}else{const Be={codigo_empresa:P.codigo_empresa,agendamento_id:ke.id,cliente_id:Ne.id,nome:Ne.nome,ordem:pe+1,valor_cota:0,status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1,pago_em:null,is_representante:pe===Vd,deleted_at:null},{error:It}=await Q.from("agendamento_participantes").insert([Be]);It&&console.error("Erro ao inserir participante (com pagamentos):",It)}}try{const pe=(Is||[]).filter(Ne=>Ne?.id&&!ye.has(Ne.id)).map(Ne=>Ne.id);if(pe.length>0){const{error:Ne}=await Q.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).in("id",pe).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id);Ne&&console.error("Erro ao remover participantes (com pagamentos):",Ne)}}catch{}}else{const H=Math.min(Is.length,ca.length);try{const ce=(Is||[]).map(ye=>ye?.id).filter(Boolean);if(ce.length>0){const{error:ye}=await Q.from("agendamento_participantes").update({ordem:null,is_representante:!1}).in("id",ce).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id).is("deleted_at",null);ye&&console.error("Erro ao liberar ordens antes do update:",ye)}}catch(ce){console.error("Erro inesperado ao liberar ordens antes do update:",ce)}try{await Q.from("agendamento_participantes").update({is_representante:!1}).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id).is("deleted_at",null)}catch{}for(let ce=0;ce<H;ce++){const ye=Is[ce],pe=ca[ce];if(!ye?.id||!pe?.id)continue;const Ne=String(ye.cliente_id)===String(pe.id),Ie={cliente_id:pe.id,nome:pe.nome,ordem:ce+1,is_representante:!1,deleted_at:null};Ne||(Ie.valor_cota=0,Ie.status_pagamento="Pendente",Ie.finalizadora_id=null,Ie.aplicar_taxa=!1,Ie.pago_em=null);const{error:qe}=await Q.from("agendamento_participantes").update(Ie).eq("id",ye.id).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id);qe&&console.error("Erro ao atualizar participante:",qe)}if(ca.length<Is.length){const ce=Is.slice(ca.length).map(ye=>ye?.id).filter(Boolean);if(ce.length>0){const{error:ye}=await Q.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).in("id",ce).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id);ye&&console.error("Erro ao remover participantes:",ye)}}if(ca.length>Is.length){const ce=Is.length,ye=ca.slice(ce).map((pe,Ne)=>({codigo_empresa:P.codigo_empresa,agendamento_id:ke.id,cliente_id:pe.id,nome:pe.nome,ordem:ce+Ne+1,valor_cota:0,status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1,pago_em:null,is_representante:!1,deleted_at:null}));if(ye.length>0){const{error:pe}=await Q.from("agendamento_participantes").insert(ye);pe&&console.error("Erro ao inserir participantes:",pe)}}try{const ce=Vd+1;if(Number.isFinite(ce)&&ce>0){const{error:ye}=await Q.from("agendamento_participantes").update({is_representante:!0}).eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id).eq("ordem",ce).is("deleted_at",null);ye&&console.error("Erro ao marcar representante:",ye)}}catch{}}const E=nc?.nome||nc?.name||ge(nc)||Wd[0]||ke.customer,B={...ke,court:je.court,customer:E,start:An,end:Fa,modality:je.modality,...go?{}:{status:Ll.status??je.status}};if(Cn(H=>H.map(ce=>ce.id===ke.id?B:ce)),Ae(B),go)try{He(!1),await er(ke.id,je.status,"user")}catch{}if(pt||t({title:"Agendamento atualizado"}),Kn.current=!0,Ta.current=!1,!N||Fl){const H=new Map;try{(Is||[]).forEach(pe=>{const Ne=String(pe?.cliente_id??""),Ie=H.get(Ne)||[];Ie.push(pe),H.set(Ne,Ie)})}catch{}const ce=new Map,ye=ca.map((pe,Ne)=>{const Ie=String(pe?.id??""),qe=ce.get(Ie)||0,Kt=(H.get(Ie)||[])[qe]||null;ce.set(Ie,qe+1);const Be=!!Kt;return{cliente_id:pe.id,nome:pe.nome,codigo:pe.codigo||null,valor_cota:Be?Kt.valor_cota??0:0,status_pagamento:Be?Kt.status_pagamento??"Pendente":"Pendente",finalizadora_id:Be?Kt.finalizadora_id??null:null,aplicar_taxa:Be?Kt.aplicar_taxa??!1:!1,ordem:Ne+1,is_representante:Ne===Vd,deleted_at:null}});br(pe=>({...pe,[ke.id]:ye})),console.log(" [FIX] houveMudancaDeParticipantes =",Ni),Ni?(console.log(" [FIX] Mudana de participantes detectada - reconstruindo participantsForm"),x(ye.map(pe=>({cliente_id:pe.cliente_id,nome:pe.nome,codigo:pe.codigo,valor_cota:pe.valor_cota?Xp(String(Number(pe.valor_cota).toFixed(2))):"",status_pagamento:pe.status_pagamento,finalizadora_id:pe.finalizadora_id?String(pe.finalizadora_id):y?.[0]?.id?String(y[0].id):null,aplicar_taxa:pe.aplicar_taxa})))):(console.log(" [FIX] Sem mudana de participantes - preservando dados de pagamento do contexto"),x(pe=>{const Ne=Array.isArray(pe)?pe:[],Ie=new Map;try{Ne.forEach(Kt=>{const Be=String(Kt?.cliente_id??""),It=Ie.get(Be)||[];It.push(Kt),Ie.set(Be,It)})}catch{}const qe=new Map,kt=ye.map(Kt=>{const Be=String(Kt?.cliente_id??""),It=qe.get(Be)||0,$r=(Ie.get(Be)||[])[It]||null;return qe.set(Be,It+1),$r?{cliente_id:Kt.cliente_id,nome:$r.nome||Kt.nome,codigo:$r.codigo??Kt.codigo,valor_cota:$r.valor_cota||Kt.valor_cota,status_pagamento:$r.status_pagamento||Kt.status_pagamento,finalizadora_id:$r.finalizadora_id??Kt.finalizadora_id,aplicar_taxa:$r.aplicar_taxa??Kt.aplicar_taxa}:Kt});return console.log(" [FIX] Dados de pagamento preservados:",kt),kt.length>0?kt:ye})),console.log(" [LOG 3 - RESULTADO FINAL] participantsForm aps atualizao:"),console.log("   Total:",ye.length),ye.forEach((pe,Ne)=>{console.log(`   #${Ne+1}: ${pe.nome} | Status: ${pe.status_pagamento} | Valor: ${pe.valor_cota}`)})}if(r().catch(H=>{console.error("[AgendaPage] Erro ao recarregar alertas:",H)}),!pt){try{he.current=[]}catch{}try{Dt([])}catch{}He(!1)}return}let rh=null;try{const{data:zs}=await Q.from("agendamentos").select("id, status, codigo").eq("codigo_empresa",P.codigo_empresa).eq("quadra_id",Ft.id).eq("inicio",An.toISOString()).eq("fim",Fa.toISOString()).limit(1);Array.isArray(zs)&&zs.length>0&&(rh=zs[0])}catch{}if(rh?.id&&rh.status!=="canceled"){const zs={id:rh.id,code:rh.codigo,court:je.court,customer:nc?.nome||Wd[0]||"",start:An,end:Fa,status:je.status,modality:je.modality};Cn(go=>go.some(mi=>mi.id===rh.id)?go:[...go,zs]),t({title:"Agendamento confirmado"}),Kn.current=!0,He(!1);return}if(Gt&&cr>1){const zs=[],go=[];for(let Is=0;Is<cr;Is++){const N=Ss(je.date,Is*7),E=new Date(N);E.setHours(Math.floor(je.startMinutes/60),je.startMinutes%60,0,0);const B=new Date(N);B.setHours(Math.floor(je.endMinutes/60),je.endMinutes%60,0,0),zs.push({codigo_empresa:P.codigo_empresa,quadra_id:Ft.id,cliente_id:nc?.id??null,clientes:Wd,inicio:E.toISOString(),fim:B.toISOString(),modalidade:je.modality,status:je.status})}const{data:Ll,error:mi}=await Q.from("agendamentos").insert(zs).select("id, codigo, inicio, fim");if(mi)throw mi;const ac=[];for(const Is of Ll){const N=ca.map((E,B)=>({codigo_empresa:P.codigo_empresa,agendamento_id:Is.id,cliente_id:E.id,nome:E.nome,valor_cota:0,status_pagamento:"Pendente",ordem:B+1}));ac.push(...N),go.push({id:Is.id,code:Is.codigo,court:je.court,customer:nc?.nome||Wd[0]||"",start:new Date(Is.inicio),end:new Date(Is.fim),status:je.status,modality:je.modality})}ac.length>0&&await Q.from("agendamento_participantes").insert(ac),Cn(Is=>[...Is,...go]),t({title:`${cr} Agendamentos criados!`,description:"Agendamentos recorrentes criados com sucesso.",variant:"success"}),Ht(!1),nn(4)}else{const{data:zs,error:go}=await Q.from("agendamentos").insert({codigo_empresa:P.codigo_empresa,quadra_id:Ft.id,cliente_id:nc?.id??null,clientes:Wd,inicio:An.toISOString(),fim:Fa.toISOString(),modalidade:je.modality,status:je.status}).select("id, codigo").single();if(go)throw go;const Ll={id:zs.id,code:zs.codigo,court:je.court,customer:nc?.nome||Wd[0]||"",start:An,end:Fa,status:je.status,modality:je.modality};Cn(mi=>[...mi,Ll]),t({title:"Agendamento criado",variant:"success",duration:2e3}),r().catch(mi=>{console.error("[AgendaPage] Erro ao recarregar alertas:",mi)});try{const mi=ca.map((ac,Is)=>({codigo_empresa:P.codigo_empresa,agendamento_id:zs.id,cliente_id:ac.id,nome:ac.nome,valor_cota:0,status_pagamento:"Pendente",ordem:Is+1,is_representante:Is===0,deleted_at:null}));if(mi.length>0){const{error:ac}=await Q.from("agendamento_participantes").insert(mi);if(!ac){const Is=mi.map(N=>({agendamento_id:N.agendamento_id,cliente_id:N.cliente_id,nome:N.nome,codigo:ca.find(E=>E.id===N.cliente_id)?.codigo||null,valor_cota:N.valor_cota,status_pagamento:N.status_pagamento,ordem:N.ordem}));br(N=>({...N,[zs.id]:Is}))}}}catch{}}Kn.current=!0,Ta.current=!1;try{he.current=[]}catch{}try{Dt([])}catch{}He(!1)}catch(Ft){t({title:"Erro ao salvar agendamento",description:Ft?.message||"Tentando novamente automaticamente",variant:"destructive"})}finally{Yr(!1)}}},[en,xe,je,ke,P,wf,Cn,t,He,er]),Iu=p.useCallback(async()=>{if(!ke?.id){He(!1),Ae(null),Ya(null),bs.current=!1,Ht(!1),nn(4);return}try{await Rl({autoSave:!0})}catch(Re){console.error(" [Close] Erro ao salvar ao fechar modal:",Re)}finally{try{he.current=[]}catch{}try{Dt([])}catch{}He(!1),Ae(null),Ya(null),bs.current=!1,Ht(!1),nn(4)}},[ke?.id,Rl,Dt,Ae,He,Ya]);p.useEffect(()=>{const Re=async()=>{if(!ne||!P?.codigo_empresa)return;const pt=String(P.codigo_empresa);if(so.current!==pt)try{mn(!0);try{const pr=`clientes:list:${P.codigo_empresa}`,Qr=JSON.parse(localStorage.getItem(pr)||"[]");if(Array.isArray(Qr)&&Qr.length>0){qs(Qr);try{fa(kn=>JSON.stringify(kn)===JSON.stringify(Qr)?kn:Qr)}catch{}}}catch{}const{data:Ft,error:Jt}=await Q.from("clientes").select("id, nome, codigo, email, telefone, status, codigo_empresa, is_consumidor_final").eq("codigo_empresa",P.codigo_empresa).eq("status","active").eq("flag_cliente",!0).order("nome",{ascending:!0});if(Jt){console.error("Falha ao carregar clientes:",Jt);return}if(Array.isArray(Ft)){if(Ft.length===0){let pr=0;try{const Qr=`clientes:list:${P.codigo_empresa}`,kn=JSON.parse(localStorage.getItem(Qr)||"[]");pr=Array.isArray(kn)?kn.length:0}catch{}if(pr>0&&!_i.current){_i.current=!0,setTimeout(Re,700);return}}_i.current=!1,so.current=pt,qs(Ft);try{const pr=`clientes:list:${P.codigo_empresa}`;localStorage.setItem(pr,JSON.stringify(Ft))}catch{}try{fa(pr=>JSON.stringify(pr)===JSON.stringify(Ft)?pr:Ft)}catch{}}}catch{}finally{mn(!1)}};Re()},[ne,P?.codigo_empresa]),p.useEffect(()=>{try{if(ke?.id){const Qr=ke?.valor_total,kn=Number(Qr);if(Qr!=null&&Qr!==""&&Number.isFinite(kn)){v(Xp(String(kn.toFixed(2))));return}}}catch{}const Re=xe[je.court];if(!Re)return;const pt=Number(Re.valor||0);if(!Number.isFinite(pt)||pt<=0)return;const Ft=Math.max(0,je.endMinutes-je.startMinutes);if(Ft<=0)return;const Jt=Ft/_s,pr=Math.round(pt*Jt*100)/100;v(Xp(String(pr.toFixed(2))))},[xe,je.court,je.startMinutes,je.endMinutes]),p.useEffect(()=>{if(ne&&!pa.current)if(ke){const Re=Gd(ke.start)*60+Kd(ke.start),pt=Gd(ke.end)*60+Kd(ke.end),Ft=(()=>{try{if(($e||[]).includes(ke.court))return ke.court;const An=ke.court_id;if(An!=null){const Fa=(ln||[]).find(ws=>String(ws.id)===String(An));if(Fa?.nome)return Fa.nome}}catch{}return($e||[])[0]||""})(),Jt=et[ke.id]||[],pr=Jt.filter(An=>An&&An.cliente_id).map(An=>({id:An.cliente_id,nome:An.nome,codigo:An.codigo||null})),Qr=xe[Ft]?.modalidades||Yp,kn=Qr.includes(ke.modality)?ke.modality:Qr[0]||"";try{na("edit:init-from-cache")}catch{}ht({selectedClients:pr,court:Ft,modality:kn,status:ke.status,date:Po(ke.start),startMinutes:Re,endMinutes:pt}),Xn.current=!0,x(Jt.map(An=>({cliente_id:An.cliente_id,nome:An.nome,codigo:An.codigo,valor_cota:(()=>{const Fa=Number.isFinite(Number(An.valor_cota))?Number(An.valor_cota):um(An.valor_cota);return Xp(String((Number.isFinite(Fa)?Fa:0).toFixed(2)))})(),status_pagamento:An.status_pagamento||"Pendente",finalizadora_id:An.finalizadora_id||null,aplicar_taxa:An.aplicar_taxa||!1}))),Ms(pr[0]?.id||null),(async()=>{try{const{data:An,error:Fa}=await Q.from("agendamento_participantes").select("cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey ( nome, codigo )").eq("codigo_empresa",P.codigo_empresa).eq("agendamento_id",ke.id).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(!Fa&&Array.isArray(An)){const ws=An.slice();try{Ms(String(ws[0]?.cliente_id||"")||null)}catch{}const as=ws.filter(ca=>ca&&ca.cliente_id).map(ca=>({id:ca.cliente_id,nome:ca.nome||ca.cliente?.nome||"",codigo:ca.cliente?.codigo||null}));ht(ca=>{try{na("edit:background-refresh")}catch{}return(Array.isArray(ca.selectedClients)?ca.selectedClients:[]).length>0?ca:{...ca,selectedClients:as}}),x(ws.map(ca=>({cliente_id:ca.cliente_id,nome:ca.nome||ca.cliente?.nome||"",codigo:ca.cliente?.codigo||null,valor_cota:(()=>{const Ni=Number.isFinite(Number(ca.valor_cota))?Number(ca.valor_cota):um(ca.valor_cota);return Xp(String((Number.isFinite(Ni)?Ni:0).toFixed(2)))})(),status_pagamento:ca.status_pagamento||"Pendente",finalizadora_id:ca.finalizadora_id?String(ca.finalizadora_id):null,aplicar_taxa:ca.aplicar_taxa||!1})))}}catch(An){console.error("Falha ao carregar participantes (refresh)",An)}})(),pa.current=!0}else if(Un){const Re=($e||[]).includes(Un.court)?Un.court:($e||[])[0]||"",pt={selectedClients:nr.current?Array.isArray(je.selectedClients)?je.selectedClients:[]:[],court:Re,modality:(()=>(xe[Re]?.modalidades||Yp)[0]||"")(),status:"scheduled",date:Un.date??k,startMinutes:Un.startMinutes??st(),endMinutes:Un.endMinutes??st()+60};ht(pt),x([]),Xn.current=!0,pa.current=!0}else{const Re=$e[0]||"",pt=xe[Re]?.modalidades||Yp,Ft=Array.isArray(Et)?Et:[],Jt=nr.current?Array.isArray(je.selectedClients)?je.selectedClients:[]:Ft.length>0?Ft:[];if(!nr.current&&Ft.length>0)try{nr.current=!0}catch{}ht({selectedClients:Jt,court:Re,modality:pt[0]||"",status:"scheduled",date:k,startMinutes:st(),endMinutes:st()+60}),x([]),Xn.current=!0,pa.current=!0}},[ne,ke,k,Un,$e,Yp,et]),p.useEffect(()=>{if(ne&&ke){pa.current=!1,bs.current=!1,nr.current||ht(Re=>({...Re,selectedClients:[]}));try{Ue.current=!1}catch{}}},[ke,ne]),p.useEffect(()=>{if(ne)try{bs.current=!1}catch{}},[ne]),p.useEffect(()=>{if(!ne||!ke||bs.current)return;const Re=et[ke.id]||[];if(!Re.length)return;const pt=Re.slice();try{Ms(String(pt[0]?.cliente_id||"")||null)}catch{}const Ft=pt.filter(Jt=>Jt&&Jt.cliente_id).map(Jt=>({id:Jt.cliente_id,nome:Jt.nome,codigo:Jt.codigo||null}));if(Ft.length>0){try{localStorage.getItem("debug:agenda")==="1"&&(console.log("[ORDER-AGENDA] chipsIdsNow:",chipsNow.map(Jt=>Jt.id)),console.log("[ORDER-AGENDA] selectedFromPartsIds:",Ft.map(Jt=>Jt.id)))}catch{}ht(Jt=>{try{na("edit:prefill-tardy")}catch{}return(Array.isArray(Jt.selectedClients)?Jt.selectedClients:[]).length>0?Jt:{...Jt,selectedClients:Ft}}),x(pt.map(Jt=>({cliente_id:Jt.cliente_id,nome:Jt.nome,codigo:Jt.codigo||null,valor_cota:(()=>{const pr=Number.isFinite(Number(Jt.valor_cota))?Number(Jt.valor_cota):um(Jt.valor_cota);return Xp(String((Number.isFinite(pr)?pr:0).toFixed(2)))})(),status_pagamento:Jt.status_pagamento||"Pendente",finalizadora_id:Jt.finalizadora_id||null,aplicar_taxa:Jt.aplicar_taxa||!1}))),bs.current=!0}},[ne,ke,et]);const Ou=p.useCallback(async()=>{try{if(s)return;if(!ke?.id){o();return}if(en)return;try{try{Ta.current=!1}catch{}try{Kn.current=!1}catch{}await Rl({autoSave:!0}),await Promise.resolve()}catch{}Kn.current&&o()}catch{}},[s,ke?.id,en,Rl,o]);p.useEffect(()=>{const Re=pt=>{ne&&(s||ke&&(pt.key==="F3"&&(pt.preventDefault(),Ur(!0)),pt.key==="F4"&&(pt.preventDefault(),Ou())))};return window.addEventListener("keydown",Re),()=>window.removeEventListener("keydown",Re)},[ne,ke,s,Ou,Ur,Rl,Ta,Kn,He,je]);const Ic=p.useMemo(()=>{const Re=xe[je.court];if(!Re)return{start:Sn*60,end:hn*60};const[pt,Ft]=String(Re.hora_inicio||"06:00:00").split(":").map(Number),[Jt,pr]=String(Re.hora_fim||"24:00:00").split(":").map(Number),Qr=Jt===0&&pr===0?24:Jt;return{start:pt*60+(Ft||0),end:Qr*60+(pr||0)}},[xe,je.court,Sn,hn]),Rj=p.useCallback((Re,pt)=>{const Ft=or(je.date,"yyyy-MM-dd"),Jt=Qr=>{const kn=Gd(Qr),An=Kd(Qr);return kn===0&&An===0?1440:kn*60+An},pr=xe?.[je.court]?.id;return sn.filter(Qr=>{const kn=Qr.court===je.court,An=pr!=null&&String(Qr.court_id||"")===String(pr);return(kn||An)&&or(Qr.start,"yyyy-MM-dd")===Ft&&Qr.status!=="canceled"&&(!ke||Qr.id!==ke.id)}).map(Qr=>[Jt(Qr.start),Jt(Qr.end)]).sort((Qr,kn)=>Qr[0]-kn[0])},[sn,je.court,je.date,ke]),qp=p.useMemo(()=>{try{return Rj()}catch{return[]}},[Rj]),GP=(Re,pt,Ft,Jt)=>Re<Jt&&Ft<pt;function wf(Re,pt){if(pt<=Re||Re<Ic.start||pt>Ic.end)return!1;for(const[Ft,Jt]of qp)if(GP(Re,pt,Ft,Jt))return!1;return!0}const Fj=Re=>{let pt=Re+_s;if(!wf(Re,pt))return null;for(;pt+_s<=Ic.end&&wf(Re,pt+_s);)pt+=_s;return pt},KP=p.useMemo(()=>{const Re=Ic,pt=[];for(let Ft=Re.start;Ft<=Re.end;Ft+=_s){const Jt=wf(Ft,Ft+_s);let pr=Math.floor(Ft/60);const Qr=Ft%60;pr>=24&&Ft===1440&&(pr=0),pt.push({value:Ft,label:`${String(pr).padStart(2,"0")}:${String(Qr).padStart(2,"0")}`,available:Jt})}return pt},[Ic,qp]),jf=p.useMemo(()=>{const Re=Fj(je.startMinutes),pt=[];for(let Ft=je.startMinutes+_s;Ft<=Ic.end;Ft+=_s){const Jt=!!Re&&Ft<=Re;let pr=Math.floor(Ft/60);const Qr=Ft%60;pr>=24&&(pr=pr%24),pt.push({value:Ft,label:`${String(pr).padStart(2,"0")}:${String(Qr).padStart(2,"0")}`,available:Jt})}return pt},[je.startMinutes,qp,Ic]);p.useEffect(()=>{if(Xn.current){Xn.current=!1;return}const pt=(()=>{if(wf(je.startMinutes,je.startMinutes+_s))return je.startMinutes;for(let pr=Math.max(Ic.start,je.startMinutes);pr<=Ic.end-_s;pr+=_s)if(wf(pr,pr+_s))return pr;for(let pr=Ic.start;pr<=Ic.end-_s;pr+=_s)if(wf(pr,pr+_s))return pr;return je.startMinutes})();if(pt!==je.startMinutes){ht(pr=>({...pr,startMinutes:pt}));return}const Ft=Fj(pt);if(!Ft)return;let Jt=je.endMinutes;(!Number.isFinite(Jt)||Jt<=pt||Jt>Ft)&&(Jt=Math.min(pt+60,Ft),Jt<pt+_s&&(Jt=pt+_s),ht(pr=>({...pr,endMinutes:Jt})))},[je.startMinutes,je.court,je.date,qp,Ic]);const sd=p.useMemo(()=>xe[je.court]?.modalidades||Yp,[xe,je.court]);p.useEffect(()=>{const Re=xe[je.court]?.modalidades||Yp;Re.includes(je.modality)||ht(pt=>({...pt,modality:Re[0]||""}))},[je.court,xe]),p.useEffect(()=>{if(Xn.current||!Ql(je.date,k))return;if(ue[je.court]&&!ue[je.court].funciona){const Ft=$e.find(Jt=>!ue[Jt]||ue[Jt].funciona);Ft&&ht(Jt=>({...Jt,court:Ft}))}},[je.court,je.date,ue,$e,k]);const Tu=p.useMemo(()=>{const Re=Math.max(0,je.endMinutes-je.startMinutes),pt=Math.floor(Re/60),Ft=Re%60;return pt>0&&Ft>0?`${pt}h ${Ft}min`:pt>0?`${pt}h`:`${Ft}min`},[je.startMinutes,je.endMinutes]),Lj=p.useMemo(()=>{if(!ne)return"";const Re=new Date,pt=Gd(Re)*60+Kd(Re),Ft=Number(je.startMinutes),Jt=Number(je.endMinutes),pr=Qr=>{let kn=Math.floor(Qr/60);const An=Qr%60;return kn>=24&&(kn=kn%24),`${String(kn).padStart(2,"0")}:${String(An).padStart(2,"0")}`};if(As.autoConfirmEnabled&&je.status==="scheduled"){const Qr=Math.max(0,Ft-Number(As.autoConfirmMinutesBefore||0));if(pt<Qr)return`Este agendamento est com automao ativa (Confirmar automaticamente s ${pr(Qr)})`}return As.autoStartEnabled&&je.status==="confirmed"&&pt<Ft?`Este agendamento est com automao ativa (Iniciar automaticamente s ${pr(Ft)})`:As.autoFinishEnabled&&je.status==="in_progress"&&pt<Jt?`Este agendamento est com automao ativa (Finalizar automaticamente s ${pr(Jt)})`:""},[ne,je.startMinutes,je.endMinutes,je.status,As]),Iy=p.useMemo(()=>(m||[]).length,[m]),Ud=p.useMemo(()=>{const pt=(m||[]).map(An=>{const Fa=um(An?.valor_cota);return Number.isFinite(Fa)?Fa:0}).reduce((An,Fa)=>An+Fa,0),Ft=um(g),Jt=Number.isFinite(Ft)?Ft:0,pr=Number((Jt-pt).toFixed(2));let Qr=0,kn=0;for(const An of m||[])(An?.status_pagamento||"Pendente")==="Pago"?Qr++:kn++;return{totalAssigned:pt,totalTarget:Jt,diff:pr,paid:Qr,pending:kn}},[m,g]);p.useEffect(()=>{const Re=um(g);if(!Number.isFinite(Re)||Re<=0)return;(m||[]).some(Ft=>um(Ft?.valor_cota)>=Re)&&(m||[]).some(Ft=>Ft.status_pagamento!=="Pago")&&x(Ft=>Ft.map(Jt=>({...Jt,status_pagamento:"Pago"})))},[m,g]),p.useCallback(()=>{const Re=(je.selectedClients||[]).length;if(!Re)return;const pt=um(g);if(!Number.isFinite(pt)||pt<0)return;const Ft=Math.round(pt*100),Jt=Math.floor(Ft/Re);let pr=Ft-Jt*Re;x(Qr=>{const kn=(je.selectedClients||[]).slice(),An=new Map,Fa=new Map;return(Qr||[]).forEach(as=>{const ca=Fa.get(as.cliente_id)||[];ca.push(as),Fa.set(as.cliente_id,ca)}),kn.map(as=>{const ca=An.get(as.id)||0,Zi=(Fa.get(as.id)||[])[ca];An.set(as.id,ca+1);const Fl=Jt+(pr>0?1:0);pr>0&&pr--;const Vd=(Fl/100).toFixed(2),nc=Xp(String(Vd)),Wd=um(nc);return{cliente_id:as.id,nome:as.nome,codigo:Zi?.codigo??as.codigo??null,valor_cota:nc,status_pagamento:Number.isFinite(Wd)&&Wd>0?"Pago":"Pendente",finalizadora_id:Zi?.finalizadora_id??null,aplicar_taxa:Zi?.aplicar_taxa??!1}})})},[je.selectedClients,g,x]),p.useCallback(()=>{x(Re=>Re.map(pt=>({...pt,valor_cota:"",status_pagamento:"Pendente"})))},[x]);const Qi=p.useCallback(async()=>{try{Br.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{lr.current="close"}catch{}try{Ln(!1),on(!1)}catch{}},[ke?.id,Rl]);return a.jsxs(a.Fragment,{children:[Se&&a.jsx(zn,{open:!0,onOpenChange:Re=>{if(!Re&&Se){try{Se.resolve(!1)}catch{}Ee(null)}},children:a.jsxs(qn,{onOpenAutoFocus:Re=>Re.preventDefault(),children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Reativar automao?"}),a.jsx(la,{children:"Ao reativar, este agendamento voltar a ser atualizado automaticamente (incio e trmino) pelas regras da agenda."})]}),a.jsx(Ua,{children:a.jsxs("div",{className:"ml-auto flex gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>{try{Se?.resolve(!1)}catch{}Ee(null)},children:"Cancelar"}),a.jsx(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:()=>{try{Se?.resolve(!0)}catch{}Ee(null)},children:"Reativar"})]})})]})}),ne&&a.jsx(zn,{open:!0,onOpenChange:async Re=>{if(Re)He(!0);else{try{const pt=Date.now()<(Xt.current||0);if(xn||Ra||pt){try{const Ft={ts:new Date().toISOString(),hook:"Dialog:onOpenChange(blocked)",effectiveCustomerPickerOpen:xn,isClientFormOpen:Ra,suppressUntil:Xt.current,formLen:Array.isArray(je?.selectedClients)?je.selectedClients.length:NaN,curLen:Array.isArray(rt.current)?rt.current.length:NaN,lastLen:Array.isArray(he.current)?he.current.length:NaN};console.warn("[CustomerPicker][DIALOG:block-close]",Ft)}catch{}return}}catch{}try{const pt={ts:new Date().toISOString(),hook:"Dialog:onOpenChange(allow-close)",effectiveCustomerPickerOpen:xn,isClientFormOpen:Ra,suppressUntil:Xt.current,formLen:Array.isArray(je?.selectedClients)?je.selectedClients.length:NaN,curLen:Array.isArray(rt.current)?rt.current.length:NaN,lastLen:Array.isArray(he.current)?he.current.length:NaN};console.warn("[CustomerPicker][DIALOG:allow-close]",pt)}catch{}if(s&&console.log("[Dialog] Fechamento solicitado com PaymentModal aberto - iniciando coordenao"),console.log(" [FLUXO CRTICO] Solicitao de fechamento do modal de agendamento recebida"),console.log(" Estado atual:",{isPaymentModalOpen:s,editingBooking:ke?.id,timestamp:new Date().toISOString()}),s&&typeof window<"u"){console.log(" [FLUXO CRTICO] PaymentModal aberto - solicitando save-and-close");try{await new Promise(pt=>{const Ft=()=>{window.removeEventListener("paymentmodal:closed",Ft),console.log(" [FLUXO CRTICO] PaymentModal confirmou fechamento"),pt()},Jt=setTimeout(()=>{window.removeEventListener("paymentmodal:closed",Ft),console.warn(" [FLUXO CRTICO] Timeout aguardando PaymentModal fechar"),pt()},3e3),pr=()=>{clearTimeout(Jt),Ft()};window.addEventListener("paymentmodal:closed",pr,{once:!0}),window.dispatchEvent(new Event("paymentmodal:save-and-close"))})}catch{}}await Iu(),console.log(" [FLUXO CRTICO] Modal de agendamento fechado")}},children:a.jsxs(qn,{forceMount:!0,disableAnimations:!0,alignTop:!0,className:"sm:max-w-[960px] max-h-[85vh] min-h-[360px] flex flex-col p-0",onOpenAutoFocus:Re=>Re.preventDefault(),onInteractOutside:async Re=>{try{const pt=Date.now()<(Xt.current||0);if(s||xn||Ra||pt){try{const Ft={ts:new Date().toISOString(),hook:"DialogContent:onInteractOutside(blocked)",effectiveCustomerPickerOpen:xn,isClientFormOpen:Ra,isPaymentModalOpen:s,suppressUntil:Xt.current,formLen:Array.isArray(je?.selectedClients)?je.selectedClients.length:NaN,curLen:Array.isArray(rt.current)?rt.current.length:NaN,lastLen:Array.isArray(he.current)?he.current.length:NaN}}catch{}Re.preventDefault();return}if(ke?.id){Re.preventDefault(),await Iu();return}}catch{}},onEscapeKeyDown:Re=>{try{const pt=Date.now()<(Xt.current||0);if(s||xn||Ra||pt){Re.preventDefault();return}}catch{}},children:[a.jsxs(Bn,{className:"px-6 pt-6 pb-4 flex-shrink-0",children:[a.jsxs($n,{className:"flex items-center justify-between gap-3 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{children:ke?(()=>{const Re=ke?.code,pt=typeof Re=="number"?String(Re).padStart(3,"0"):null;return pt?`Editar agendamento - ${pt}`:"Editar Agendamento"})():"Novo Agendamento"}),ke?.created_by_isis&&a.jsxs("span",{className:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs bg-fuchsia-600/10 text-fuchsia-400 border-fuchsia-700/30",title:"Criado pela sis",children:[a.jsx("span",{className:"rounded-full overflow-hidden bg-background w-4 h-4 flex items-center justify-center shadow-[0_0_0_2px_rgba(0,0,0,0.25)]",children:a.jsx(cl,{size:"xs",className:"w-4 h-4"})}),"Criado pela sis"]})]}),ke&&(()=>{Ud?.pending===0&&Iy>0;const Re=(Ud?.pending||0)>0,pt="inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs",Ft="bg-emerald-600/10 text-emerald-400 border-emerald-700/30",Jt="bg-amber-600/15 text-amber-400 border-amber-700/30",pr=Qr=>a.jsx("span",{"aria-hidden":!0,className:`inline-block w-2 h-2 rounded-full ${Qr}`});return a.jsxs("span",{className:`${pt} ${Re?Jt:Ft}`,title:Re?"H pagamentos pendentes":"Todos participantes pagos","aria-live":"polite",children:[pr(Re?"bg-amber-400":"bg-emerald-400"),a.jsx("span",{className:"tracking-wide",children:"Pagos"}),a.jsx("strong",{className:"text-base font-semibold tabular-nums",children:Ud?.paid||0}),a.jsx("span",{className:"opacity-60",children:"/"}),a.jsx("span",{className:"text-base font-semibold tabular-nums",children:Iy})]})})(),a.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md border text-sm bg-white/5 border-white/10 text-text-primary mr-12 max-w-full",title:"Data do agendamento",children:[a.jsx(ko,{className:"w-4 h-4 opacity-80"}),a.jsxs("span",{className:"font-semibold",children:[or(je.date,"dd/MM/yyyy"),(()=>{const Re=Number(je?.startMinutes),pt=Number(je?.endMinutes);if(!(Number.isFinite(Re)&&Number.isFinite(pt)&&pt>Re))return"";const Jt=pr=>{let Qr=Math.floor(pr/60);const kn=pr%60;return Qr>=24&&(Qr=Qr%24),`${String(Qr).padStart(2,"0")}:${String(kn).padStart(2,"0")}`};return`  ${Jt(Re)}${Jt(pt)}`})()]})]})]}),a.jsx(la,{children:ke?"As alteraes so salvas automaticamente enquanto voc edita.":"Preencha os detalhes para criar uma nova reserva."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-4 pb-4",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"clientes-field",className:"font-bold",children:"Clientes"}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsxs(Qo,{modal:!1,open:xn,onOpenChange:Re=>{const pt=Date.now(),Ft=pt<(ua.current||0)||pt<(Xt.current||0)||pt<(js.current||0)||J();if(!((Ra||jr)&&Re===!1)){if(!Re&&Ft){Yn("onOpenChange:blocked:guard-window");return}if(!Re&&lr.current!=="close"){Yn("onOpenChange:blocked:sticky-close");return}if(Re){Br.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}on(!0),Yn("open:accepted")}else{Br.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{const Jt=Array.isArray(rt.current)?[...rt.current]:[];Jt.length>0?(Xe.current="onOpenChange:close:preserve",Mt(Jt),gn("onOpenChange:close:preserve",Jt)):Ue.current||(Xe.current="onOpenChange:close:empty",gn("onOpenChange:close:empty",[]))}catch{}try{Xt.current=Date.now()+1500}catch{}try{const Jt={ts:new Date().toISOString(),hook:"onOpenChange(false)",formLen:Array.isArray(je?.selectedClients)?je.selectedClients.length:NaN,curLen:Array.isArray(rt.current)?rt.current.length:NaN,lastLen:Array.isArray(he.current)?he.current.length:NaN,chipsLen:Array.isArray(Et)?Et.length:NaN,clientsLoading:!!jr,lastAction:Xe?.current,clearedByUser:!!Ue?.current,suppressUntil:Xt.current};console.warn("[CustomerPicker][CLOSE:onOpenChange]",Jt)}catch{}on(!1),Yn("close:accepted")}!Re&&K.current&&(D(!0),K.current=!1,setTimeout(()=>D(!1),1200)),lr.current=Re?"open":"close",Ln(Re)}},children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"outline",className:Er("min-w-[180px] justify-between",ai&&"ring-2 ring-emerald-500/40 ring-offset-2 ring-offset-transparent transition-shadow"),onClick:()=>{Yn("trigger:click");try{lr.current="open"}catch{}try{Br.current=!0,localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}Ln(!0),on(!0),setTimeout(()=>{Ln(!0),on(!0),Yn("trigger:reassert-open")},30),Yn("trigger:after-set-open")},children:[Ml,a.jsx(gx,{className:"w-4 h-4 ml-2 opacity-60"})]})}),a.jsx(Ho,{forceMount:!0,side:"bottom",align:"start",className:"w-[360px] p-2 z-[9999]",onPointerDownOutside:Re=>{const pt=Date.now();if(pt<(ua.current||0)||pt<(Xt.current||0)||pt<(js.current||0)||J()){Re.preventDefault();return}if(Ra||jr){Re.preventDefault();return}try{const Jt=Array.isArray(rt.current)?[...rt.current]:[];Jt.length>0?(Xe.current="outside:close:snapshot",he.current=Jt,Mt(Jt),gn("outside:close:apply",Jt),Ue.current=!1):(Xe.current="outside:close:empty",Ue.current&&(he.current=[],console.warn("[CustomerPicker][outside:close:empty:cleared]",{ts:new Date().toISOString()})),gn("outside:close:empty",[]))}catch{}try{Xt.current=Date.now()+1500}catch{}try{const Jt={ts:new Date().toISOString(),hook:"onPointerDownOutside",formLen:Array.isArray(je?.selectedClients)?je.selectedClients.length:NaN,curLen:Array.isArray(rt.current)?rt.current.length:NaN,lastLen:Array.isArray(he.current)?he.current.length:NaN,chipsLen:Array.isArray(Et)?Et.length:NaN,clientsLoading:!!jr,lastAction:Xe?.current,clearedByUser:!!Ue?.current,suppressUntil:Xt.current}}catch{}K.current=!0,lr.current="close",Br.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}Ln(!1),on(!1)},onFocusOutside:Re=>{Yn("focusOutside"),(Ra||jr)&&Re.preventDefault()},onEscapeKeyDown:Re=>{Yn("escapeKeyDown"),(Ra||jr)&&Re.preventDefault()},children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{ref:jt,placeholder:"Buscar por cdigo ou nome...",value:On,onChange:Re=>{ma(Re.target.value),$a(0)},onKeyDown:Re=>{if(Re.key==="ArrowDown"||Re.key==="ArrowUp"){Re.preventDefault();const pt=(ps||[]).filter(kn=>{const An=On.trim().toLowerCase();return An?String(Ge(kn)||"").toLowerCase().includes(An):!0}),Ft=pt.find(kn=>kn?.is_consumidor_final===!0),pr=pt.filter(kn=>kn?.is_consumidor_final!==!0).slice().sort((kn,An)=>{const Fa=typeof kn=="object"&&Number.isFinite(Number(kn?.codigo))?Number(kn.codigo):1/0,ws=typeof An=="object"&&Number.isFinite(Number(An?.codigo))?Number(An.codigo):1/0;if(Fa!==ws)return Fa-ws;const as=String(ge(kn)||"").toLowerCase(),ca=String(ge(An)||"").toLowerCase();return as.localeCompare(ca)}),Qr=Ft?[Ft,...pr]:pr;Re.key==="ArrowDown"?$a(kn=>Math.min(kn+1,Qr.length-1)):$a(kn=>Math.max(kn-1,0))}if(Re.key==="Enter"){Re.preventDefault();const pt=(ps||[]).filter(An=>{const Fa=On.trim().toLowerCase();return Fa?String(Ge(An)||"").toLowerCase().includes(Fa):!0}),Ft=pt.find(An=>An?.is_consumidor_final===!0),pr=pt.filter(An=>An?.is_consumidor_final!==!0).slice().sort((An,Fa)=>{const ws=typeof An=="object"&&Number.isFinite(Number(An?.codigo))?Number(An.codigo):1/0,as=typeof Fa=="object"&&Number.isFinite(Number(Fa?.codigo))?Number(Fa.codigo):1/0;if(ws!==as)return ws-as;const ca=String(ge(An)||"").toLowerCase(),Ni=String(ge(Fa)||"").toLowerCase();return ca.localeCompare(Ni)}),kn=(Ft?[Ft,...pr]:pr)[ja];if(kn){const An=kn.id,Fa=ge(kn),ws=kn.codigo,as={id:An,nome:Fa,codigo:ws},ca=[...Array.isArray(rt.current)?rt.current:[],as];try{(rt.current||[]).length===0&&(yn.current=An||null)}catch{}try{Ue.current=!1}catch{}try{ca.length>0&&(he.current=ca)}catch{}try{rt.current=ca}catch{}gn("keyboard:enter",ca),Br.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}}}},className:"pl-10 pr-10"}),On&&a.jsx("button",{type:"button","aria-label":"Limpar busca",className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary p-1 rounded hover:bg-white/10",onClick:()=>{ma(""),jt.current?.focus()},children:a.jsx(Yc,{className:"w-4 h-4"})})]}),a.jsxs("div",{ref:Ve,className:"max-h-[260px] overflow-y-auto divide-y divide-border rounded-md border border-border",onWheel:Re=>{Re.stopPropagation()},onTouchMove:Re=>{Re.stopPropagation()},style:{overscrollBehavior:"contain"},children:[jr&&(ps||[]).length===0&&a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Carregando clientes"}),!jr&&(ps||[]).length===0&&a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Nenhum cliente encontrado"}),!jr&&(()=>{const Re=(ps||[]).filter(Qr=>{const kn=On.trim().toLowerCase();return kn?String(Ge(Qr)||"").toLowerCase().includes(kn):!0}),pt=Re.find(Qr=>Qr?.is_consumidor_final===!0),Jt=Re.filter(Qr=>Qr?.is_consumidor_final!==!0).slice().sort((Qr,kn)=>{const An=typeof Qr=="object"&&Number.isFinite(Number(Qr?.codigo))?Number(Qr.codigo):1/0,Fa=typeof kn=="object"&&Number.isFinite(Number(kn?.codigo))?Number(kn.codigo):1/0;if(An!==Fa)return An-Fa;const ws=String(ge(Qr)||"").toLowerCase(),as=String(ge(kn)||"").toLowerCase();return ws.localeCompare(as)});return pt?[pt,...Jt]:Jt})().map((Re,pt)=>{const Ft=Re?.is_consumidor_final===!0,Jt=typeof Re=="object"?Re.id:null,pr=ge(Re),Qr=typeof Re=="object"?Re.codigo:null,kn=String(pr||"").toLowerCase(),An=as=>as.id&&Jt?as.id===Jt:String(as.nome||"").toLowerCase()===kn,Fa=(je.selectedClients||[]).some(An),ws=pt===ja;return a.jsxs("button",{ref:as=>{Bt.current[pt]=as},type:"button",className:`w-full text-left py-3 px-4 flex items-center gap-3 transition-all border-b border-border last:border-0 ${ws?"ring-2 ring-blue-500 ring-inset z-10":""} ${Ft?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":Fa?"bg-emerald-600/20 hover:bg-emerald-600/30":"hover:bg-surface-2"}`,onMouseEnter:()=>$a(pt),onMouseDown:as=>{as.stopPropagation()},role:"option","aria-checked":Fa,onClick:()=>{const as={id:Jt,nome:pr,codigo:Qr},ca=[...Array.isArray(rt.current)?rt.current:[],as];try{(rt.current||[]).length===0&&(yn.current=Jt||null)}catch{}try{Ue.current=!1}catch{}try{ca.length>0&&(he.current=ca)}catch{}try{rt.current=ca}catch{}gn("list:add",ca),Br.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[Qr!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors ${Ft?"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Qr]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:`font-medium truncate ${Ft?"text-amber-100/90":""}`,children:pr}),Ft&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),(()=>{const as=(je.selectedClients||[]).filter(ca=>An(ca)).length;return as>0?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-rose-600 hover:bg-rose-500 text-white text-base font-bold transition-colors",onClick:ca=>{ca.stopPropagation();const Ni=Array.isArray(rt.current)?rt.current:[],Zi=Ni.findIndex(Fl=>An(Fl));if(Zi!==-1){const Fl=[...Ni];Fl.splice(Zi,1);try{Ue.current=Fl.length===0}catch{}try{Fl.length===0&&(yn.current=null)}catch{}try{Fl.length>0&&(he.current=Fl)}catch{}try{rt.current=Fl}catch{}gn("list:remove-one",Fl)}},children:"-"}),a.jsx("span",{className:"inline-flex items-center justify-center min-w-[32px] h-7 px-2 rounded-full bg-sky-600 text-white text-base font-bold",children:as}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-emerald-600 hover:bg-emerald-500 text-white text-base font-bold transition-colors",onClick:ca=>{ca.stopPropagation();const Ni={id:Jt,nome:pr,codigo:Qr},Zi=[...Array.isArray(rt.current)?rt.current:[],Ni];try{(rt.current||[]).length===0&&(yn.current=Jt||null)}catch{}try{Ue.current=!1}catch{}try{Zi.length>0&&(he.current=Zi)}catch{}try{rt.current=Zi}catch{}gn("list:add-one",Zi)},children:"+"})]}):null})()]},Jt||kn)})]}),a.jsxs("div",{className:"flex items-center justify-between pt-1",children:[a.jsx(Z,{type:"button",size:"sm",className:"bg-emerald-600 hover:bg-emerald-500 text-white shadow-md ring-2 ring-emerald-400/40 ring-offset-2 ring-offset-transparent",onMouseDown:Re=>{try{Xt.current=Date.now()+3e3}catch{}try{ua.current=Date.now()+3500}catch{}try{re.current=Date.now()+5e3}catch{}try{lr.current="close"}catch{}try{Br.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}Re.stopPropagation()},onClick:()=>{lr.current="close",Br.current=!1;try{re.current=Date.now()+5e3}catch{}try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}sa.current=!0;const pt=Array.isArray(rt.current)?[...rt.current]:[];try{pt.length>0&&(Xe.current="conclude:close:snapshot",he.current=pt)}catch{}Mt(pt);try{ua.current=Date.now()+3e3}catch{}gn("conclude:close:apply",pt),ht(Ft=>({...Ft,selectedClients:[...pt]}));try{Ue.current=!1}catch{}try{Xt.current=Date.now()+2500}catch{}Ln(!1),on(!1),setTimeout(()=>{try{Xt.current=Date.now()+2500}catch{}Ln(!1),on(!1)},15),setTimeout(()=>{try{Xt.current=Date.now()+2500}catch{}Ln(!1),on(!1)},120);try{Xt.current=Date.now()+2500}catch{}try{const Ft={ts:new Date().toISOString(),hook:"conclude:click",formLen:Array.isArray(je?.selectedClients)?je.selectedClients.length:NaN,curLen:Array.isArray(rt.current)?rt.current.length:NaN,lastLen:Array.isArray(he.current)?he.current.length:NaN,chipsLen:Array.isArray(Et)?Et.length:NaN,clientsLoading:!!jr,lastAction:Xe?.current,clearedByUser:!!Ue?.current,suppressUntil:Xt.current,selectionLockUntil:ua.current,restoreGuardUntil:wi.current,modalSessionId:we.current||"",closingAt:null,pickerOpen:!!xn,modalOpen:!!ne}}catch{}setTimeout(()=>{try{sa.current=!1}catch{}},3e3)},children:"Concluir"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:"text-xs text-text-muted",children:[(kc||[]).length," selecionado(s)"]})})]})]})})]}),a.jsx(Z,{type:"button",onClick:()=>{try{const Re=Array.isArray(rt.current)?rt.current:[];Re.length>0&&(he.current=Re,Mt(Re))}catch{}Br.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}lr.current="close",Ln(!1),on(!1),yo(null),fs(!0)},children:"+ Novo"})]}),Qa?a.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-text-muted",children:[a.jsx(ll,{className:"w-4 h-4 animate-spin"}),"Carregando participantes..."]}):ba.length>0?a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ba.map((Re,pt)=>{const Ft=String(Re?.nome||"").toLowerCase(),Jt=`${Re?.id||Ft}-${pt}`,pr=Re?.id||`__name:${Ft}`;return a.jsxs("span",{className:"text-sm font-medium bg-white/5 border border-white/10 rounded px-2 py-1 flex items-center gap-2",children:[bU(Re.nome),a.jsxs("button",{type:"button","aria-label":"Remover cliente",title:"Remover cliente",className:"text-text-muted hover:text-red-400 p-1 rounded hover:bg-red-500/10",onClick:()=>{j("CustomerPicker:chip:remove",{token:pr,chipIdx:pt});const Qr=(Array.isArray(rt.current)?rt.current:[]).filter((kn,An)=>An!==pt);try{Ue.current=Qr.length===0}catch{}try{he.current=Qr}catch{}try{rt.current=Qr}catch{}gn("chips:remove",Qr)},children:[a.jsx(Yc,{className:"w-5 h-5"}),a.jsx("span",{className:"sr-only",children:"Remover"})]})]},Jt)})}):null]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"quadra-select",className:"font-bold",children:"Quadra"}),a.jsxs(ea,{value:je.court,onValueChange:Re=>ht(pt=>({...pt,court:Re})),children:[a.jsx(Jn,{className:"mt-1",onMouseDown:()=>{xn&&setTimeout(Qi,0)},children:a.jsx(ra,{children:je.court&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:_h(je.court)}}),a.jsx("span",{children:je.court})]})})}),a.jsx(Qn,{className:"z-[60]",children:$e.map(Re=>{const pt=or(je.date,"yyyy-MM-dd"),Ft=G[pt]||{},Jt=Ft[Re]&&!Ft[Re].funciona;return a.jsx(Qe,{value:Re,disabled:Jt,className:Jt?"opacity-50 cursor-not-allowed":"",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:_h(Re)}}),a.jsx("span",{children:Re}),Jt&&a.jsx("span",{className:"text-xs text-text-muted ml-auto",children:"(Fechada)"})]})},Re)})})]})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"modalidade-select",className:"font-bold",children:"Modalidade"}),a.jsxs(ea,{value:je.modality,onValueChange:Re=>ht(pt=>({...pt,modality:Re})),children:[a.jsx(Jn,{className:"mt-1",onMouseDown:()=>{xn&&setTimeout(Qi,0)},children:a.jsx(ra,{})}),a.jsx(Qn,{children:(sd||[]).map(Re=>a.jsx(Qe,{value:Re,children:Re},Re))})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"status-select",className:"font-bold",children:"Status"}),a.jsxs(ea,{value:je.status,onValueChange:Re=>ht(pt=>({...pt,status:Re})),children:[a.jsx(Jn,{className:"mt-1",onMouseDown:()=>{xn&&setTimeout(Qi,0)},children:a.jsx(ra,{})}),a.jsx(Qn,{children:Object.keys(el).map(Re=>a.jsx(Qe,{value:Re,children:a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{"aria-hidden":!0,className:`inline-block h-4 w-1 rounded ${el[Re].accent}`}),el[Re].label]})},Re))})]}),Lj&&a.jsx("div",{className:"mt-1.5 text-xs text-text-primary font-medium bg-brand/5 border border-brand/20 rounded px-2 py-1.5",children:Lj})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"horario-inicio",className:"font-bold",children:"Horrio"}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsxs(ea,{value:String(je.startMinutes),onValueChange:Re=>ht(pt=>({...pt,startMinutes:Number(Re)})),children:[a.jsx(Jn,{className:"w-32","aria-label":"Hora incio",onMouseDown:()=>{xn&&setTimeout(Qi,0)},children:a.jsx(ra,{})}),a.jsx(Qn,{className:"max-h-[300px] z-[60] [&>div]:scrollbar-thin [&>div]:scrollbar-track-surface [&>div]:scrollbar-thumb-brand/40 [&>div]:hover:scrollbar-thumb-brand/60",children:KP.map(Re=>a.jsx(Qe,{value:String(Re.value),disabled:!Re.available,className:Er(!Re.available&&"opacity-60"),children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[Re.available?a.jsx(xu,{className:"w-4 h-4 opacity-80"}):a.jsx(u0,{className:"w-4 h-4 opacity-80"}),Re.label]})},Re.value))})]}),a.jsxs(ea,{value:String(je.endMinutes),onValueChange:Re=>ht(pt=>({...pt,endMinutes:Number(Re)})),children:[a.jsx(Jn,{className:"w-32","aria-label":"Hora fim",onMouseDown:()=>{xn&&setTimeout(Qi,0)},children:a.jsx(ra,{})}),a.jsx(Qn,{className:"max-h-[300px] z-[60] [&>div]:scrollbar-thin [&>div]:scrollbar-track-surface [&>div]:scrollbar-thumb-brand/40 [&>div]:hover:scrollbar-thumb-brand/60",children:jf.map(Re=>a.jsx(Qe,{value:String(Re.value),disabled:!Re.available,className:Er(!Re.available&&"opacity-60"),children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[Re.available?a.jsx(xu,{className:"w-4 h-4 opacity-80"}):a.jsx(u0,{className:"w-4 h-4 opacity-80"}),Re.label]})},Re.value))})]})]}),a.jsxs("div",{className:"mt-1 inline-block text-xs font-semibold text-text-secondary bg-white/5 border border-white/10 rounded px-2 py-0.5",children:["Durao: ",Tu]})]}),!ke&&a.jsxs("div",{className:"border-t border-border pt-4 mt-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("input",{type:"checkbox",id:"is-recorrente",checked:Gt,onChange:Re=>Ht(Re.target.checked),className:"mt-1 h-4 w-4 rounded border-gray-300 text-brand focus:ring-brand"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"is-recorrente",className:"font-semibold text-text-primary cursor-pointer",children:"Agendamento Fixo (Recorrente)"}),a.jsx("p",{className:"text-xs text-text-secondary mt-0.5",children:"Criar este agendamento automaticamente nas prximas semanas, no mesmo dia e horrio"})]})]}),Gt&&a.jsxs("div",{className:"ml-7 mt-3 space-y-3",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"quantidade-semanas",className:"text-sm font-medium",children:"Repetir por quantas semanas?"}),a.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-md bg-surface-2",children:[a.jsx("button",{type:"button",onClick:()=>nn(Re=>Math.max(2,(Re||2)-1)),className:"px-3 py-2 hover:bg-surface-3 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:cr<=2,children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),a.jsx("div",{className:"px-4 py-2 min-w-[60px] text-center font-semibold border-x border-border",children:cr}),a.jsx("button",{type:"button",onClick:()=>nn(Re=>(Re||2)+1),className:"px-3 py-2 hover:bg-surface-3 transition-colors",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),a.jsxs("span",{className:"text-sm text-text-secondary",children:["semanas (",cr," agendamentos)"]})]})]}),je.date&&cr>=2&&a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-slate-300 mb-2 uppercase tracking-wide",children:"Datas que sero criadas:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:cr}).map((Re,pt)=>{const Ft=Ss(je.date,pt*7);return a.jsxs("div",{className:"inline-flex items-center gap-1.5 bg-slate-700/50 border border-slate-600 rounded px-2 py-1",children:[a.jsx("svg",{className:"w-3.5 h-3.5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),a.jsx("span",{className:"text-xs font-medium text-white",children:or(Ft,"dd/MM/yyyy '('EEEE')'",{locale:Da})})]},pt)})})]}),a.jsx("div",{className:"bg-slate-800/50 border-l-4 border-blue-600 rounded-r-lg p-3",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),a.jsxs("div",{className:"text-xs text-gray-300",children:[a.jsx("p",{className:"font-semibold mb-1 text-blue-300",children:"Importante: Revise os dados antes de salvar"}),a.jsxs("p",{children:["Sero criados ",a.jsxs("strong",{className:"text-white",children:[cr," agendamentos"]})," incluindo a data selecionada e as prximas ",cr-1," semanas. Editar ou cancelar depois exigir alterar cada agendamento individualmente."]})]})]})})]})]})]})]})}),a.jsx(Ua,{className:"flex-shrink-0 border-t border-border bg-surface px-6 py-3",children:a.jsxs("div",{className:"w-full flex flex-col gap-3 sm:flex-row sm:items-center",children:[ke&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:mr-auto w-full sm:w-auto",children:[a.jsxs(Z,{type:"button",variant:"destructive",className:"bg-red-600 hover:bg-red-500 text-white border border-red-700 w-full sm:w-auto justify-center",onClick:()=>Ur(!0),children:[a.jsx(Dg,{className:"w-4 h-4 mr-2 opacity-90"}),"Cancelar agendamento",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-red-700/50 rounded border border-red-500/30",children:"F3"})]}),a.jsxs(Z,{type:"button",variant:"secondary",className:"bg-teal-600 hover:bg-teal-500 text-white border-teal-700 w-full sm:w-auto justify-center",onClick:()=>{Ou()},children:[a.jsx(Vi,{className:"w-4 h-4 mr-2 opacity-90"}),a.jsx("span",{className:"hidden sm:inline",children:"Gerenciar Pagamentos"}),a.jsx("span",{className:"sm:hidden",children:"Pagamentos"}),a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-teal-700/50 rounded border border-teal-500/30",children:"F4"})]})]}),a.jsx(Xu,{open:Yt,onOpenChange:Ur,children:a.jsxs(nu,{children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Cancelar agendamento?"}),a.jsx(iu,{children:'Ao cancelar, este agendamento deixar de aparecer na agenda padro. Ele s ser visvel ao selecionar o filtro "Cancelados".'})]}),a.jsxs(su,{children:[a.jsx(lu,{children:"Voltar"}),a.jsx(Yu,{className:"bg-red-600 hover:bg-red-500",onClick:async()=>{try{Ur(!1),He(!1),await er(ke.id,"canceled","user"),t({title:"Agendamento cancelado"})}catch(Re){t({title:"Erro ao cancelar",description:Re?.message||"Tente novamente."})}},children:"Confirmar cancelamento"})]})]})})]}),a.jsxs("div",{className:"flex gap-2 w-full sm:w-auto sm:ml-auto",children:[a.jsxs(Z,{type:"button",variant:"ghost",className:"border border-white/10 flex-1 sm:flex-none",onClick:async()=>{await Iu()},children:["Fechar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]}),!ke?.id&&a.jsxs(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white disabled:opacity-60 disabled:cursor-not-allowed flex-1 sm:flex-none",disabled:en,onClick:async()=>{try{if(en)return;if(Gt&&!ke){Gn(!0);return}Ta.current=!0,Kn.current=!1,await Rl()}catch{}},children:["Salvar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-emerald-700/50 rounded border border-emerald-500/30",children:""})]})]})]})})]})}),a.jsx(Xu,{open:Tn,onOpenChange:Gn,children:a.jsxs(nu,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(au,{children:[a.jsxs(ou,{className:"flex items-center gap-3 text-xl",children:[a.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-lg bg-orange-600/20 border border-orange-600/40",children:a.jsx("svg",{className:"w-6 h-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),"Confirmar Criao de Agendamentos Recorrentes"]}),a.jsxs(iu,{className:"space-y-4 mt-4",children:[je.date&&cr>=2&&a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-slate-300 mb-2 uppercase tracking-wide",children:" Datas que sero criadas:"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from({length:cr}).map((Re,pt)=>{const Ft=Ss(je.date,pt*7);return a.jsxs("div",{className:"flex items-center gap-2 bg-slate-700/50 border border-slate-600 rounded px-2 py-1.5",children:[a.jsxs("span",{className:"text-xs font-semibold text-slate-400",children:["#",pt+1]}),a.jsx("span",{className:"text-xs font-medium text-white",children:or(Ft,"dd/MM/yyyy '('EEEE')'",{locale:Da})})]},pt)})})]}),a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wide",children:"Resumo do Agendamento"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Quadra"}),a.jsx("span",{className:"font-semibold text-white",children:xe[je.court]?.name||je.court})]}),a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Horrio"}),a.jsxs("span",{className:"font-semibold text-white font-mono",children:[jU(je.startMinutes)," - ",jU(je.endMinutes)]})]}),a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Modalidade"}),a.jsx("span",{className:"font-semibold text-white",children:je.modality})]}),a.jsxs("div",{className:"flex items-start justify-between py-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Participantes"}),a.jsx("div",{className:"text-right max-w-xs",children:je.selectedClients?.length>0?a.jsxs("div",{className:"font-semibold text-white",children:[ta?je.selectedClients.map(Re=>Re.nome).join(", "):je.selectedClients.slice(0,3).map(Re=>Re.nome).join(", "),!ta&&je.selectedClients.length>3&&a.jsxs("span",{className:"text-slate-400",children:[" +",je.selectedClients.length-3]}),je.selectedClients.length>3&&a.jsxs(a.Fragment,{children:[" ",a.jsx("button",{type:"button",onClick:()=>Aa(!ta),className:"text-xs text-blue-400 hover:text-blue-300 underline inline",children:ta?"Ver menos":"Ver todos"})]})]}):a.jsx("span",{className:"font-semibold text-white",children:"Nenhum participante"})})]})]})]}),a.jsx("div",{className:"bg-red-900/30 border-l-4 border-red-600 rounded-r-lg p-4",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-red-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsx("div",{children:a.jsxs("p",{className:"text-sm text-gray-300",children:[a.jsx("strong",{className:"text-red-300",children:"Importante:"})," Aps criar, editar ou cancelar exigir alterar cada agendamento individualmente. Certifique-se de que todos os dados esto corretos!"]})})]})})]})]}),a.jsxs(su,{className:"gap-2",children:[a.jsx(lu,{onClick:()=>{Gn(!1),Aa(!1)},className:"border-slate-600 hover:bg-slate-800",children:"Cancelar e Revisar"}),a.jsxs(Yu,{className:"bg-emerald-700 hover:bg-emerald-600 text-white font-semibold",onClick:async()=>{Gn(!1),Aa(!1),Ta.current=!0,Kn.current=!1,await Rl()},children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirmar e Criar ",cr," Agendamentos"]})]})]})}),Ra&&a.jsx(jne,{open:Ra,onOpenChange:Re=>{fs(Re),Re||(yo(null),window.__paymentModalCallback&&(window.__paymentModalCallback=null))},client:Js,onSaved:Re=>{try{if(Re&&typeof Re=="object"){console.warn("[CustomerPicker][onSaved:START]",{clientId:Re.id,clientName:Re.nome,currentSelection:Array.isArray(rt.current)?rt.current.length:0});try{re.current=Date.now()+3e3,ua.current=Date.now()+3e3,wi.current=Date.now()+3e3}catch{}(ps||[]).some(Ft=>typeof Ft=="object"?Ft.id===Re.id:!1)||(qs(Ft=>[...Ft||[],Re]),fa(Ft=>[...Ft||[],Re])),ht(Ft=>{const Jt=Array.isArray(Ft.selectedClients)?Ft.selectedClients:[],pr={id:Re.id,nome:Re.nome||Re.name||ge(Re),codigo:Re.codigo},Qr=Jt.filter(An=>An.id!==Re.id),kn=[pr,...Qr];try{rt.current=kn}catch{}try{he.current=kn}catch{}try{Mt(kn)}catch{}try{Ue.current=!1}catch{}return console.warn("[CustomerPicker][onSaved:COMPLETE]",{newClientId:Re.id,newClientName:Re.nome,totalSelected:kn.length,refsSynced:!0,protectionActive:!0}),{...Ft,selectedClients:kn}}),Promise.resolve().then(()=>{try{const Ft=Array.isArray(rt.current)?rt.current:[];ht(Jt=>(Array.isArray(Jt.selectedClients)?Jt.selectedClients:[]).length>0?Jt:Ft.length>0?(console.warn("[CustomerPicker][onSaved:REASSERT]",{count:Ft.length}),{...Jt,selectedClients:[...Ft]}):Jt)}catch{}})}if(window.__paymentModalCallback&&typeof window.__paymentModalCallback=="function")try{window.__protectPaymentModal&&window.__protectPaymentModal(3e3),window.__paymentModalCallback(),window.__paymentModalCallback=null}catch(pt){console.error("[PaymentModal][callback:ERROR]",pt)}}catch(pt){console.error("[CustomerPicker][onSaved:ERROR]",pt)}}}),s&&a.jsx(yZe,{setIsModalOpen:He,setBookings:Cn,form:je,setForm:ht,localCustomers:ps,onOpenClientModal:Re=>{fs(!0),window.__paymentModalCallback=Re}}),l&&a.jsx(bZe,{form:je,setForm:ht,localCustomers:ps})]})},vr=p.useMemo(()=>{const re=or(k,"yyyy-MM-dd");let we=sn.filter(nt=>or(nt.start,"yyyy-MM-dd")===re);if(!!!R){if(we=we.filter(nt=>nt.status!=="canceled"),$s.trim()){const nt=$s.trim().toLowerCase();we=we.filter(st=>(st.customer||"").toLowerCase().includes(nt)||(st.court||"").toLowerCase().includes(nt)||(el[st.status]?.label||"").toLowerCase().includes(nt))}return we}let ge=ir.canceledOnly?we.filter(nt=>nt.status==="canceled"):we.filter(nt=>nt.status!=="canceled");if(ir.pendingPayments&&(ge=ge.filter(nt=>{const st=et[nt.id]||[];return st.some(ht=>String(ht.status_pagamento||"").toLowerCase()!=="pago")&&st.length>0})),$s.trim()){const nt=$s.trim().toLowerCase();ge=ge.filter(st=>(st.customer||"").toLowerCase().includes(nt)||(st.court||"").toLowerCase().includes(nt)||(el[st.status]?.label||"").toLowerCase().includes(nt))}try{const nt=Date.now(),st=(sn||[]).filter(ht=>or(ht.start,"yyyy-MM-dd")===re).filter(ht=>ht.status!=="canceled").filter(ht=>{const rt=Pt.current.get(ht.id);return rt&&rt.src==="automation"&&nt-rt.ts<2e3}),je=new Map(ge.map(ht=>[ht.id,ht]));for(const ht of st)je.has(ht.id)||je.set(ht.id,ht);ge=Array.from(je.values())}catch{}return ge},[sn,k,ir.scheduled,ir.canceledOnly,ir.pendingPayments,$s,et,R]),kr=p.useMemo(()=>{const re=or(k,"yyyy-MM-dd"),we=Lr||Pe[0],Ge=sn.filter(nt=>or(nt.start,"yyyy-MM-dd")===re&&nt.status!=="canceled"&&nt.court===we);let ge=0;return Ge.forEach(nt=>{const je=(et[nt.id]||[]).filter(ht=>String(ht.status_pagamento||"").toLowerCase()!=="pago").length;ge+=je}),{totalBookings:Ge.length,totalPendingPayments:ge}},[sn,k,et,Lr,Pe]),Vr=p.useMemo(()=>{const re=bh(k),we=Ss(re,6);let Ge=sn.filter(st=>{const je=Po(st.start),ht=Po(re),rt=Po(we);return je>=ht&&je<=rt});if(!!!R){if(Ge=Ge.filter(st=>st.status!=="canceled"),$s.trim()){const st=$s.trim().toLowerCase();Ge=Ge.filter(je=>(je.customer||"").toLowerCase().includes(st)||(je.court||"").toLowerCase().includes(st)||(el[je.status]?.label||"").toLowerCase().includes(st))}return Ge}let nt=ir.canceledOnly?Ge.filter(st=>st.status==="canceled"):Ge.filter(st=>st.status!=="canceled");if(ir.pendingPayments&&(nt=nt.filter(st=>{const je=et[st.id]||[];return je.some(rt=>String(rt.status_pagamento||"").toLowerCase()!=="pago")&&je.length>0})),$s.trim()){const st=$s.trim().toLowerCase();nt=nt.filter(je=>(je.customer||"").toLowerCase().includes(st)||(je.court||"").toLowerCase().includes(st)||(el[je.status]?.label||"").toLowerCase().includes(st))}try{const st=Date.now(),je=(sn||[]).filter(rt=>{const nr=Po(rt.start);return nr>=Po(re)&&nr<=Po(we)}).filter(rt=>rt.status!=="canceled").filter(rt=>{const nr=Pt.current.get(rt.id);return nr&&nr.src==="automation"&&st-nr.ts<2e3}),ht=new Map(nt.map(rt=>[rt.id,rt]));for(const rt of je)ht.has(rt.id)||ht.set(rt.id,rt);nt=Array.from(ht.values())}catch{}return nt},[sn,k,ir.scheduled,ir.canceledOnly,ir.pendingPayments,$s,et,R]);p.useEffect(()=>{if(!$s.trim()||!(ir.scheduled||ir.canceledOnly||ir.pendingPayments)||!vr||vr.length===0)return;const re=[...vr].sort((Ge,ge)=>Ge.start-ge.start)[0];if(!re?.id)return;const we=document.getElementById(`booking-${re.id}`);we?.scrollIntoView&&we.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},[$s,vr,ir.scheduled,ir.canceledOnly,ir.pendingPayments]),p.useEffect(()=>{const re=Oa.current,we=us.current||{},Ge=ir.canceledOnly&&!we.canceledOnly,ge=ir.scheduled&&!we.scheduled&&!ir.canceledOnly,nt=ir.pendingPayments&&!we.pendingPayments;if(!re||!Ge&&!ge&&!nt){us.current={scheduled:ir.scheduled,canceledOnly:ir.canceledOnly,pendingPayments:ir.pendingPayments};return}const st=vr||[];if(st.length===0){us.current={scheduled:ir.scheduled,canceledOnly:ir.canceledOnly,pendingPayments:ir.pendingPayments};return}const je=re.getBoundingClientRect();if(!st.some(rt=>{const nr=document.getElementById(`booking-${rt.id}`);if(!nr)return!1;const yn=nr.getBoundingClientRect();return yn.bottom>je.top&&yn.top<je.bottom})){const rt=[...st].sort((yn,fn)=>yn.start-fn.start)[0],nr=rt&&document.getElementById(`booking-${rt.id}`);nr?.scrollIntoView&&nr.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}us.current={scheduled:ir.scheduled,canceledOnly:ir.canceledOnly,pendingPayments:ir.pendingPayments}},[ir.scheduled,ir.canceledOnly,ir.pendingPayments,vr]);const Ir=p.useMemo(()=>{if(!Lr||!xe[Lr])return{start:Sn,end:hn};const re=xe[Lr],we=re.hora_inicio||`${Sn}:00:00`,Ge=re.hora_fim||`${hn}:00:00`,[ge,nt]=String(we).split(":").map(Number),[st,je]=String(Ge).split(":").map(Number),ht=st===0&&je===0?24:st,rt=ht*60+(je||0);return{start:ge||Sn,end:ht||hn,startMinutes:(ge||0)*60+(nt||0),endMinutes:rt}},[Lr,xe,Sn,hn]);return p.useMemo(()=>{const re=Ir.start,we=Ir.end;return Array.from({length:Math.max(0,we-re)},(Ge,ge)=>re+ge)},[Ir]),p.useMemo(()=>{const re=Ir.start,we=Ir.end;return Math.max(0,we-re)*(60/_s)*_l},[Ir]),a.jsxs(a.Fragment,{children:[a.jsxs(Mr.div,{variants:ne?void 0:PZe,initial:ne?!1:"hidden",animate:ne?!1:"visible",className:Er("h-full w-full flex flex-col md:px-0",F&&"fixed inset-0 z-40 bg-surface"),children:[a.jsx(Mr.div,{variants:wU,className:"p-3 bg-surface mb-6 md:rounded-lg",children:a.jsxs("div",{className:"max-w-[1200px] mx-auto w-full flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>$(q==="day"?Kv(k,1):Kv(k,7)),children:a.jsx(zI,{className:"h-5 w-5"})}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"ghost",className:"w-full sm:w-auto max-w-full justify-center text-base font-semibold whitespace-nowrap truncate",children:[a.jsx(ko,{className:"mr-2 h-5 w-5"}),q==="day"?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden sm:inline",children:or(k,"EEE, dd 'de' MMMM 'de' yyyy",{locale:Da})}),a.jsx("span",{className:"sm:hidden",children:or(k,"EEE, dd/MM/yyyy",{locale:Da})})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden sm:inline",children:CZe(k)}),a.jsxs("span",{className:"sm:hidden",children:[or(bh(k),"dd/MM/yyyy")," - ",or(Ss(bh(k),6),"dd/MM/yyyy")]})]})]})}),a.jsx(Ho,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:k,onSelect:re=>re&&$(re),initialFocus:!0})})]}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>$(q==="day"?Ss(k,1):Ss(k,7)),children:a.jsx(Yg,{className:"h-5 w-5"})})]}),Pe.length>0&&a.jsx("div",{className:"hidden md:flex md:justify-center md:flex-1",children:Pe.length===1?a.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 rounded-lg w-52 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:_h(Pe[0])}}),a.jsx("span",{className:"font-semibold text-sm",children:Pe[0]})]}):a.jsxs(ea,{value:Lr||Pe[0],onValueChange:re=>{da(re)},children:[a.jsx(Jn,{className:"w-52 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10 hover:border-brand/50 hover:bg-gradient-to-r hover:from-brand/10 hover:to-brand/15 transition-all shadow-sm",children:a.jsx(ra,{placeholder:"Selecionar quadra"})}),a.jsx(Qn,{className:"border-brand/30",children:Pe.map(re=>{const we=_h(re);return a.jsx(Qe,{value:re,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:we}}),a.jsx("span",{className:"font-semibold",children:re})]})},re)})})]})}),a.jsxs("div",{className:"flex flex-col gap-3 w-full md:w-auto md:ml-auto",children:[a.jsxs("div",{className:"flex items-center gap-3 justify-center md:hidden",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-lg bg-surface-2/30 p-0.5",children:[a.jsx(Z,{variant:q==="day"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("day"),children:"Dia"}),a.jsx(Z,{variant:q==="week"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("week"),children:"Semana"})]}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsxs(Z,{variant:"outline",size:"sm",className:"gap-2",disabled:$e.length===0,children:[a.jsx(f$,{className:"h-4 w-4"})," Filtros"]})}),a.jsxs(Qu,{align:"end",className:"w-64",children:[a.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[a.jsx(l3,{className:"p-0",children:"Exibio"}),a.jsx(Z,{variant:"ghost",size:"sm",className:"h-7 text-xs text-text-muted hover:text-text-primary",onClick:()=>In({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),children:"Limpar"})]}),a.jsx(L_,{}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ko,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Agendados"})]}),a.jsx(Ks,{checked:ir.scheduled,onCheckedChange:re=>In(we=>({...we,scheduled:!!re,canceledOnly:re?!1:we.canceledOnly}))})]})}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(UI,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Livres"})]}),a.jsx(Ks,{checked:ir.available,onCheckedChange:re=>In(we=>({...we,available:!!re,canceledOnly:re?!1:we.canceledOnly}))})]})}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Dg,{className:"h-4 w-4 text-rose-400"}),a.jsx("span",{children:"Cancelados"})]}),a.jsx(Ks,{checked:ir.canceledOnly,onCheckedChange:re=>{const we=!!re;In(Ge=>({...Ge,canceledOnly:we,scheduled:we?!1:Ge.scheduled,available:we?!1:Ge.available})),we&&!pl&&rd(!0)}})]})}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Vi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{children:"Pagamentos Pendentes"})]}),a.jsx(Ks,{checked:ir.pendingPayments,onCheckedChange:re=>In(we=>({...we,pendingPayments:!!re}))})]})})]})]}),a.jsxs("div",{className:"relative inline-block group",children:[a.jsx(Z,{variant:F?"default":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>V(!F),"aria-label":F?"Minimizar grid":"Expandir grid",children:F?a.jsx(i$,{className:"h-4 w-4"}):a.jsx(o$,{className:"h-4 w-4"})}),a.jsx("div",{className:"hidden group-hover:block absolute right-0 mt-1 z-50 pointer-events-none",children:a.jsx("div",{className:"px-2 py-1 rounded-md bg-surface-2 text-xs text-text-primary border border-border shadow",children:F?"Minimizar (F10)":"Expandir (F10)"})})]}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Xi(!0),disabled:$e.length===0,"aria-label":"Configurar agenda",title:"Configurar agenda",children:a.jsx(Xc,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"flex items-center gap-3 justify-end flex-shrink-0",children:[a.jsxs("div",{className:"relative w-full sm:w-56",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar agendamento...",className:"pl-9",value:$s,onChange:re=>po(re.target.value),onBlur:()=>po("")}),$s&&a.jsx("button",{type:"button","aria-label":"Limpar busca",className:"absolute right-2 top-1/2 -translate-y-1/2 px-2 py-0.5 rounded text-xs font-medium text-primary hover:bg-surface-2",onClick:()=>po(""),children:"Limpar"})]}),a.jsxs(Z,{size:"sm",onClick:()=>{Ae(null),Ya(null),ot()},"aria-label":"Novo agendamento",className:"gap-2",disabled:$e.length===0||Pe.every(re=>ue[re]&&!ue[re].funciona),children:[a.jsx(to,{className:"h-4 w-4"})," Agendar"]})]}),Pe.length>0&&a.jsxs("div",{className:"md:hidden flex items-center justify-center gap-2",children:[Pe.length===1?a.jsxs("div",{className:"inline-flex items-center justify-center gap-3 px-4 py-2 rounded-lg w-auto h-10 max-w-full border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:_h(Pe[0])}}),a.jsx("span",{className:"font-semibold text-sm text-center whitespace-nowrap truncate",children:Pe[0]})]}):a.jsxs(ea,{value:Pe[rn%Pe.length],onValueChange:re=>{const we=Pe.indexOf(re);we!==-1&&un(we)},children:[a.jsx(Jn,{className:"w-48 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10 hover:border-brand/50 hover:bg-gradient-to-r hover:from-brand/10 hover:to-brand/15 transition-all shadow-sm",children:a.jsx(ra,{placeholder:"Selecionar quadra"})}),a.jsx(Qn,{className:"border-brand/30",children:Pe.map(re=>{const we=_h(re);return a.jsx(Qe,{value:re,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:we}}),a.jsx("span",{className:"font-semibold",children:re})]})},re)})})]}),me&&a.jsx("button",{type:"button",onClick:async()=>{try{navigator.vibrate&&navigator.vibrate(30)}catch{}Rt()},className:"inline-flex items-center justify-center p-2 rounded-md border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-colors","aria-label":"Compartilhar",title:"Compartilhar",children:a.jsx(d$,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"hidden md:flex items-center gap-3 justify-end",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-lg bg-surface-2/30 p-0.5",children:[a.jsx(Z,{variant:q==="day"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("day"),children:"Dia"}),a.jsx(Z,{variant:q==="week"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("week"),children:"Semana"})]}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsxs(Z,{variant:"outline",size:"sm",className:"gap-2",disabled:$e.length===0,children:[a.jsx(f$,{className:"h-4 w-4"})," Filtros"]})}),a.jsxs(Qu,{align:"end",className:"w-64",children:[a.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[a.jsx(l3,{className:"p-0",children:"Exibio"}),a.jsx(Z,{variant:"ghost",size:"sm",className:"h-7 text-xs text-text-muted hover:text-text-primary",onClick:()=>In({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),children:"Limpar"})]}),a.jsx(L_,{}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ko,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Agendados"})]}),a.jsx(Ks,{checked:ir.scheduled,onCheckedChange:re=>In(we=>({...we,scheduled:!!re,canceledOnly:re?!1:we.canceledOnly}))})]})}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(UI,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Livres"})]}),a.jsx(Ks,{checked:ir.available,onCheckedChange:re=>In(we=>({...we,available:!!re,canceledOnly:re?!1:we.canceledOnly}))})]})}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Dg,{className:"h-4 w-4 text-rose-400"}),a.jsx("span",{children:"Cancelados"})]}),a.jsx(Ks,{checked:ir.canceledOnly,onCheckedChange:re=>{const we=!!re;In(Ge=>({...Ge,canceledOnly:we,scheduled:we?!1:Ge.scheduled,available:we?!1:Ge.available})),we&&!pl&&rd(!0)}})]})}),a.jsx(vs,{onClick:re=>re.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Vi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{children:"Pagamentos Pendentes"})]}),a.jsx(Ks,{checked:ir.pendingPayments,onCheckedChange:re=>In(we=>({...we,pendingPayments:!!re}))})]})})]})]}),a.jsxs("div",{className:"relative inline-block group",children:[a.jsx(Z,{variant:F?"default":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>V(!F),"aria-label":F?"Minimizar grid":"Expandir grid",children:F?a.jsx(i$,{className:"h-4 w-4"}):a.jsx(o$,{className:"h-4 w-4"})}),a.jsx("div",{className:"hidden group-hover:block absolute right-0 mt-1 z-50 pointer-events-none",children:a.jsx("div",{className:"px-2 py-1 rounded-md bg-surface-2 text-xs text-text-primary border border-border shadow",children:F?"Minimizar (F10)":"Expandir (F10)"})})]}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Xi(!0),disabled:$e.length===0,"aria-label":"Configurar agenda",title:"Configurar agenda",children:a.jsx(Xc,{className:"h-5 w-5"})})]})]})]})}),a.jsx(zn,{open:tc,onOpenChange:re=>{re||rc(Ns),Xi(re)},children:a.jsxs(qn,{className:"sm:max-w-[680px]",onOpenAutoFocus:re=>re.preventDefault(),children:[a.jsx(Bn,{className:"pb-3 border-b border-border bg-surface-2/40 rounded-t-lg px-2 -mx-2 -mt-2",children:a.jsx($n,{className:"text-base font-semibold tracking-tight",children:"Configuraes da Agenda"})}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[a.jsx(Oi,{className:"h-4 w-4",style:{color:el.confirmed.hex}}),a.jsx("span",{className:"text-sm font-medium",children:"Confirmao automtica"})]}),a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-3",style:{borderLeftWidth:3,borderLeftColor:el.confirmed.hex},children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{id:"autoConfirmEnabled",checked:As.autoConfirmEnabled,onCheckedChange:re=>rc(we=>({...we,autoConfirmEnabled:!!re}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:el.confirmed.hex}}),a.jsx(lt,{htmlFor:"autoConfirmEnabled",className:"font-medium",children:"Confirmao automtica"})]})]})}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(lt,{htmlFor:"autoconfirm-hours",className:"text-sm text-text-muted",children:"Confirmar se faltar"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(ea,{value:String(Math.max(0,Math.round((As.autoConfirmMinutesBefore||0)/60))),onValueChange:re=>rc(we=>({...we,autoConfirmMinutesBefore:Math.max(0,Number(re))*60})),disabled:!As.autoConfirmEnabled,children:[a.jsx(Jn,{className:"w-32",children:a.jsx(ra,{placeholder:"Horas"})}),a.jsxs(Qn,{align:"start",children:[a.jsx(Qe,{value:"0",children:"Imediato"}),a.jsx(Qe,{value:"1",children:"1 h"}),a.jsx(Qe,{value:"2",children:"2 h"}),a.jsx(Qe,{value:"3",children:"3 h"}),a.jsx(Qe,{value:"4",children:"4 h"}),a.jsx(Qe,{value:"6",children:"6 h"}),a.jsx(Qe,{value:"8",children:"8 h"}),a.jsx(Qe,{value:"12",children:"12 h"}),a.jsx(Qe,{value:"24",children:"24 h"})]})]}),a.jsx("span",{className:"text-sm text-text-muted",children:"antes"})]})]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[a.jsx(jG,{className:"h-4 w-4",style:{color:el.in_progress.hex}}),a.jsx("span",{className:"text-sm font-medium",children:"Transies automticas"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-2",style:{borderLeftWidth:3,borderLeftColor:el.in_progress.hex},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{id:"autoStartEnabled",checked:As.autoStartEnabled,onCheckedChange:re=>rc(we=>({...we,autoStartEnabled:!!re}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:el.in_progress.hex}}),a.jsx(lt,{htmlFor:"autoStartEnabled",className:"font-medium",children:"Iniciar no horrio"})]})]}),a.jsx("p",{className:"text-xs text-text-muted ml-7",children:"Confirmado  Em andamento no horrio de incio."})]}),a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-2",style:{borderLeftWidth:3,borderLeftColor:el.finished.hex},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{id:"autoFinishEnabled",checked:As.autoFinishEnabled,onCheckedChange:re=>rc(we=>({...we,autoFinishEnabled:!!re}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:el.finished.hex}}),a.jsx(lt,{htmlFor:"autoFinishEnabled",className:"font-medium",children:"Finalizar ao trmino"})]})]}),a.jsx("p",{className:"text-xs text-text-muted ml-7",children:"Em andamento  Finalizado no horrio de trmino."})]})]})]})]}),a.jsxs(Ua,{className:"mt-2 gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>Xi(!1),children:"Cancelar"}),a.jsx(Z,{type:"button",variant:"default",onClick:()=>{console.log(" BOTO SALVAR CLICADO!"),hr()},disabled:Dl,children:Dl?"Salvando":"Salvar"})]})]})}),a.jsx(zn,{open:ec,onOpenChange:rd,children:a.jsxs(qn,{className:"sm:max-w-[520px]",onOpenAutoFocus:re=>re.preventDefault(),children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Sobre agendamentos cancelados"}),a.jsx(la,{children:"Agendamentos cancelados no aparecem na agenda quando o filtro no est selecionado e no ocupam horrio."})]}),a.jsxs("div",{className:"flex items-start gap-3 mt-2",children:[a.jsx(Ks,{id:"hide-canceled-info",checked:pl,onCheckedChange:re=>Eu(!!re),className:"mt-0.5"}),a.jsx(lt,{htmlFor:"hide-canceled-info",className:"text-sm cursor-pointer text-text-secondary",children:"No mostrar novamente"})]}),a.jsx(Ua,{className:"mt-4",children:a.jsx(Z,{type:"button",onClick:()=>rd(!1),children:"Entendi"})})]})}),!oe&&$e.length===0&&a.jsxs("div",{className:"mb-4 p-4 rounded-lg border border-border bg-surface text-sm flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:"Nenhuma quadra encontrada"}),a.jsx("div",{className:"text-text-muted",children:"Cadastre suas quadras para comear a usar a agenda."})]}),a.jsx(Z,{asChild:!0,className:"w-full sm:w-auto",children:a.jsxs(H4,{to:"/quadras",children:[a.jsx("span",{className:"hidden sm:inline",children:"Ir para Cadastros  Quadras"}),a.jsx("span",{className:"sm:hidden",children:"Adicionar"})]})})]}),Fe?a.jsx("div",{className:"mt-4 rounded-xl border border-border bg-surface/70 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-surface/60",children:a.jsxs("div",{className:"flex items-center justify-center gap-4 px-6 py-8",children:[a.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full border-2 border-border/60 border-t-brand animate-spin"}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Carregando agenda"}),a.jsx("div",{className:"text-xs text-text-muted truncate",children:Ze||"Aguarde um instante"}),a.jsx("div",{className:"mt-3 h-1.5 w-56 max-w-[70vw] rounded-full bg-border/40 overflow-hidden",children:a.jsx("div",{className:"h-full w-1/2 bg-gradient-to-r from-brand/30 via-brand to-brand/30 animate-pulse"})})]})]})}):a.jsxs(a.Fragment,{children:[Pe.length>0&&q==="week"&&(()=>{const re=Lr||Pe[0],we=R?Vr.filter(Ge=>{const ge=Ge.court===re,nt=xe?.[re]||{},st=String(nt.id||nt.codigo||""),je=st&&String(Ge.court_id||"")===st;return ge||je}):Vr;return a.jsx(a.Fragment,{children:a.jsx(NZe,{weekStart:bh(k),weekBookings:we,activeCourtFilter:re,courtsMap:xe,participantsByAgendamento:et,onBookingClick:Ge=>{Ae(Ge),He(!0)},onSlotClick:(Ge,ge)=>{Ae(null);const nt=Ge.getHours()*60+Ge.getMinutes(),st=ge||Lr||Pe[0],je=or(Ge,"yyyy-MM-dd"),ht=xe?.[st]?.id,rt=(()=>{try{return(sn||[]).filter(On=>{const ma=On.court===st,Ja=ht!=null&&String(On.court_id||"")===String(ht);return(ma||Ja)&&or(On.start,"yyyy-MM-dd")===je&&On.status!=="canceled"}).map(On=>Gd(On.start)*60+Kd(On.start)).filter(On=>On>nt).sort((On,ma)=>On-ma)[0]}catch{}})(),nr=(()=>{const On=xe[st]?.hora_fim;if(!On)return hn*60;const[ma,Ja]=String(On).split(":").map(Number);return(ma===0&&(Ja||0)===0?24:ma)*60+(Ja||0)})(),yn=typeof rt=="number"?rt:nr;let fn=Math.min(nt+60,yn);fn-nt<30&&(yn-30>=nt?fn=yn:fn=Math.min(nr,nt+30));const Ln={date:Po(Ge),court:st,startMinutes:nt,endMinutes:fn};console.log("onSlotClick in AgendaPage - BEFORE setPrefill",{slotDate:Ge,court:ge,activeCourtFilter:Lr,selectedCourts:Pe,startMinutes:nt,endMinutes:fn,prefillData:Ln}),Ya(Ln),console.log("onSlotClick in AgendaPage - AFTER setPrefill (state not updated yet)"),ot()},statusConfig:el,dayStartHour:Sn,dayEndHourExclusive:hn,weekDiasFuncionamento:G,sidebarVisible:e},`weekly-${re}`)})})(),Pe.length>0&&q==="day"&&(()=>{const re=typeof window<"u"&&window.innerWidth<768,we=re?[Pe[rn%Pe.length]]:Lr?[Lr]:Pe,Ge=re?we[0]:Lr,ge=(()=>{if(Ge&&xe[Ge]){const je=xe[Ge],ht=je.hora_inicio||`${Sn}:00:00`,rt=je.hora_fim||`${hn}:00:00`,[nr]=String(ht).split(":").map(Number),[yn,fn]=String(rt).split(":").map(Number);let Ln=yn===0&&fn===0?24:yn;return fn>0&&Ln<24&&(Ln+=1),{start:nr||Sn,end:Ln||hn}}return{start:Sn,end:hn}})(),nt=Array.from({length:Math.max(0,ge.end-ge.start)},(je,ht)=>ge.start+ht),st=Math.max(0,ge.end-ge.start)*(60/_s)*_l;return we.some(je=>ue[je]&&!ue[je].funciona),a.jsx(a.Fragment,{children:a.jsx(Mr.div,{variants:ne?void 0:wU,className:Er("bg-surface fx-scroll","overflow-auto",re?"":"rounded-lg border border-border"),ref:Oa,style:{flex:"1 1 auto",minWidth:0},children:a.jsxs("div",{className:Er("grid",!re&&"mx-auto"),style:{gridTemplateColumns:re?"60px 1fr":we.length===1?"120px 760px":we.length===2?"120px repeat(2, 520px)":`120px repeat(${we.length}, 1fr)`,width:re?"100%":we.length<=2?"fit-content":void 0,columnGap:re?"4px":"16px"},children:[a.jsxs("div",{className:"sticky left-0 bg-surface z-20",children:[a.jsx("div",{className:"sticky top-0 z-20 h-14 border-b border-r border-border bg-surface flex items-center justify-center px-2",children:a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"ghost",className:"hover:bg-surface-2/50 text-lg font-semibold",children:Ql(k,new Date)?"Hoje":or(k,"EEEE",{locale:Da})})}),a.jsxs(Qu,{align:"center",children:[a.jsx(vs,{onClick:()=>$(new Date),children:"Hoje"}),a.jsx(L_,{}),(()=>{const je=["Segunda","Tera","Quarta","Quinta","Sexta","Sbado","Domingo"],ht=_u(k,{weekStartsOn:1,locale:Da});return je.map((rt,nr)=>a.jsx(vs,{onClick:()=>$(Ss(ht,nr)),children:rt},rt))})()]})]})}),nt.map(je=>a.jsxs("div",{className:Er("border-r border-border",je%2===1&&"bg-surface-2/30"),children:[a.jsx("div",{className:"relative border-b border-border/80",style:{height:_l},children:a.jsxs("span",{className:Er("absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded font-bold",re?"px-1 text-sm":"px-2 text-lg"),children:[String(je).padStart(2,"0"),":00"]})}),a.jsx("div",{className:"relative border-b border-border/80",style:{height:_l},children:a.jsxs("span",{className:Er("absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded font-bold",re?"px-1 text-sm":"px-2 text-lg"),children:[String(je).padStart(2,"0"),":30"]})})]},`time-${je}`))]}),we.map((je,ht)=>a.jsxs("div",{className:"relative border-r border-border",children:[a.jsx("div",{className:"h-14 border-b border-border sticky top-0 bg-surface z-10 flex items-center justify-center",children:ht===0&&a.jsxs("div",{className:"flex items-center justify-center gap-4 px-3",children:[kr.totalBookings>0&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-surface-2/50",children:[a.jsx("span",{className:"text-lg",children:""}),a.jsx("span",{className:"font-bold text-text-primary",children:kr.totalBookings}),a.jsxs("span",{className:"font-semibold text-xs text-text-muted",children:["agendamento",kr.totalBookings!==1?"s":""]})]}),kr.totalPendingPayments>0&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-surface-2/50",children:[a.jsx("span",{className:"text-lg",children:""}),a.jsx("span",{className:"font-bold text-text-primary",children:kr.totalPendingPayments}),a.jsxs("span",{className:"font-semibold text-xs text-text-muted",children:["pendente",kr.totalPendingPayments!==1?"s":""]})]}),me&&!re&&a.jsxs("button",{type:"button",onClick:async()=>{try{navigator.vibrate&&navigator.vibrate(30)}catch{}Rt()},className:Er("inline-flex items-center rounded-md text-xs border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-colors",re?"p-2":"gap-2 px-3 py-1.5"),"aria-label":"Compartilhar",title:"Compartilhar",children:[a.jsx(d$,{className:"w-4 h-4"}),!re&&a.jsx("span",{className:"hidden sm:inline",children:"Compartilhar"})]})]})}),a.jsxs("div",{className:Er("relative"),style:{height:st},children:[ue[je]&&!ue[je].funciona?(()=>nt.map(rt=>a.jsx("div",{className:"absolute w-full cursor-not-allowed bg-surface/60 flex items-center justify-center border-b border-border/30 transition-colors",style:{height:_l*2,top:nt.indexOf(rt)*_l*2},children:a.jsxs("div",{className:"text-center pointer-events-none",children:[a.jsx(X4,{className:"h-5 w-5 text-text-primary mx-auto mb-1"}),a.jsx("div",{className:"text-xs font-medium text-text-primary mb-1",children:"Fechada"}),ue[je].observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:ue[je].observacao})]})},`closed-${je}-${rt}`)))():null,(ir.scheduled||ir.canceledOnly||ir.pendingPayments)&&(()=>{const rt=ge.start*60,nr=ge.end*60,yn=(()=>{const ja=xe[je]?.hora_inicio,$a=xe[je]?.hora_fim,[js,no]=String(ja||`${ge.start}:00:00`).split(":").map(Number),[Ia,Ra]=String($a||`${ge.end}:00:00`).split(":").map(Number),fs=Ia===0&&Ra===0?24:Ia||0;return{start:(js||0)*60+(no||0),end:fs*60+(Ra||0)}})(),fn=Math.max(yn.start,rt),Ln=Math.min(yn.end,nr),On=Math.max(0,Math.floor((fn-rt)/_s)),ma=Math.max(On,Math.ceil((Ln-rt)/_s)),Ja=Math.max(0,(nr-rt)/_s),Bs=On*_l,na=Math.min(Ja,Math.max(0,ma-On)),ia=Math.max(0,(Ja-ma)*_l);return a.jsxs(a.Fragment,{children:[Bs>0&&a.jsx("div",{style:{height:Bs}}),Array.from({length:na},(ja,$a)=>{const js=On+$a,Ia=(Math.floor(js/(60/_s))+Math.floor(rt/60))%2===1;return a.jsx("div",{className:Er("border-b border-border/80",Ia&&"bg-surface-2/30"),style:{height:_l}},`base-${je}-slot-${js}`)}),ia>0&&a.jsx("div",{style:{height:ia}})]})})(),vr.filter(rt=>{if(!R)return!0;const nr=rt.court===je,yn=xe?.[je]||{},fn=String(yn.id||yn.codigo||""),Ln=fn&&String(rt.court_id||"")===fn;return nr||Ln}).map(rt=>a.jsx(Pr,{booking:rt,courtGridStart:ge.start*60,courtGridEnd:ge.end*60},rt.id)),ir.available&&!(ue[je]&&!ue[je].funciona)&&(()=>{const rt=(()=>{const na=xe[je]?.hora_inicio;if(!na)return Sn*60;const[ia,ja]=String(na).split(":").map(Number);return ia*60+(ja||0)})(),nr=(()=>{const na=xe[je]?.hora_fim;if(!na)return hn*60;const[ia,ja]=String(na).split(":").map(Number);return(ia===0&&ja===0?24:ia)*60+(ja||0)})(),yn=na=>{const ia=Gd(na),ja=Kd(na);return ia===0&&ja===0?1440:ia*60+ja},fn=or(k,"yyyy-MM-dd"),Ln=xe?.[je]?.id,On=sn.filter(na=>{const ia=na.court===je,ja=Ln!=null&&String(na.court_id||"")===String(Ln);return(ia||ja)&&or(na.start,"yyyy-MM-dd")===fn&&na.status!=="canceled"}).map(na=>[yn(na.start),yn(na.end)]).sort((na,ia)=>na[0]-ia[0]),ma=[];let Ja=rt;for(const[na,ia]of On)na>Ja&&ma.push([Ja,na]),Ja=Math.max(Ja,ia);Ja<nr&&ma.push([Ja,nr]);const Bs=({startM:na,endM:ia})=>{const[ja,$a]=p.useState(null),js=ge.start*60,no=Math.floor((na-js)/_s),Ia=Math.max(1,Math.ceil((ia-na)/_s)),Ra=no+Ia,fs=no*_l-1,Js=(Ra-no)*_l+2;let yo=Math.floor(na/60),ai=Math.floor(ia/60);yo>=24&&(yo=yo%24),ai>=24&&(ai=ai%24);const D=`${String(yo).padStart(2,"0")}:${String(na%60).padStart(2,"0")}`,K=`${String(ai).padStart(2,"0")}:${String(ia%60).padStart(2,"0")}`;return a.jsxs("div",{className:Er("absolute left-2 right-2 rounded-md border-2 border-dashed text-sm z-0 cursor-pointer","border-[#10B981]","bg-transparent hover:border-[#10B981]/80 hover:shadow-sm"),style:{top:`${fs}px`,height:`${Js}px`},onMouseMove:he=>{const Xe=he.currentTarget.getBoundingClientRect(),Ue=Math.min(Math.max(0,he.clientY-Xe.top),Xe.height);let Et=Math.floor(Ue/_l);Et=Math.max(0,Math.min(Et,Ia-1)),$a(Et)},onMouseLeave:()=>$a(null),onClick:he=>{const Xe=he.currentTarget.getBoundingClientRect(),Ue=Math.min(Math.max(0,he.clientY-Xe.top),Xe.height),Et=Math.floor(Ue/_l);let Dt=na+Et*_s;Dt=Math.max(na,Math.min(Dt,ia-_s));const Mt=(()=>{const Bt=xe?.[je]?.id;return sn.filter(Ur=>{const jr=Ur.court===je,mn=Bt!=null&&String(Ur.court_id||"")===String(Bt);return(jr||mn)&&or(Ur.start,"yyyy-MM-dd")===fn}).map(Ur=>Gd(Ur.start)*60+Kd(Ur.start)).filter(Ur=>Ur>Dt).sort((Ur,jr)=>Ur-jr)[0]})(),jt=typeof Mt=="number"?Mt:nr;let Ve=Math.min(Dt+60,jt);if(Ve-Dt<30){const Bt=jt-30;Bt>=na?(Dt=Math.max(na,Math.min(Dt,Bt)),Ve=jt):(Dt=na,Ve=Math.min(jt,ia))}Ae(null);{const Bt=$e||[],Yt=Bt.includes(je)?je:Bt[0]||"";Ya({court:Yt,date:k,startMinutes:Dt,endMinutes:Ve})}try{lastNonEmptySelectionRef.current=[],setChipsSnapshot([])}catch{}ot()},title:`Livre: ${D}${K}`,children:[ja!==null&&a.jsx("div",{className:"pointer-events-none absolute left-[6px] right-[6px] rounded-md border border-white/10 bg-white/5",style:{top:`${ja*_l}px`,height:`${_l}px`}}),a.jsxs("div",{className:"h-full px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"font-medium text-[#10B981]",children:"Livre"}),a.jsxs("span",{className:"text-text-muted",children:[D,"",K]})]})]})};return ma.map(([na,ia],ja)=>a.jsx(Bs,{startM:na,endM:ia},`free-${je}-${ja}`))})()]})]},je))]})})})})()]})]}),pn(),a.jsx(zn,{open:ae,onOpenChange:re=>{re||Rr()},children:a.jsxs(qn,{className:"w-[calc(100vw-24px)] sm:w-full max-w-[980px] max-h-[85vh] overflow-y-auto mx-auto p-4 sm:p-6",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Compartilhar"}),a.jsx(la,{children:"Gere uma imagem pronta para Story/Status."})]}),a.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[a.jsx(Z,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>_t(re=>Kv(re||new Date,1)),"aria-label":"Dia anterior",title:"Dia anterior",children:a.jsx(zI,{className:"h-5 w-5"})}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"ghost",className:"w-full sm:w-auto max-w-full justify-center text-base font-semibold whitespace-nowrap truncate",children:[a.jsx(ko,{className:"mr-2 h-5 w-5"}),a.jsx("span",{className:"sm:hidden",children:`${or(ft||new Date,"EEEE",{locale:Da}).replace(/-feira\b/gi,"").trim()}, ${or(ft||new Date,"dd/MM",{locale:Da})}`}),a.jsx("span",{className:"hidden sm:inline",children:`${or(ft||new Date,"EEEE",{locale:Da}).replace(/-feira\b/gi,"").trim()}, ${or(ft||new Date,"dd 'de' MMMM 'de' yyyy",{locale:Da})}`})]})}),a.jsx(Ho,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:ft||new Date,onSelect:re=>re&&_t(re),initialFocus:!0})})]}),a.jsx(Z,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>_t(re=>Ss(re||new Date,1)),"aria-label":"Prximo dia",title:"Prximo dia",children:a.jsx(Yg,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[a.jsx("div",{className:"w-full",children:a.jsx("div",{className:"w-full rounded-xl border border-white/10 bg-black/25 overflow-hidden shadow-[0_0_0_1px_rgba(255,255,255,0.06)]",children:a.jsx("div",{className:"w-full aspect-[9/16] flex items-center justify-center",children:ie?a.jsx("img",{src:ie,alt:"Prvia",className:"w-full h-full object-cover"}):a.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 text-text-muted",children:[a.jsx(ll,{className:"w-5 h-5 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Gerando imagem"})]})})})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Legenda"}),a.jsxs("button",{type:"button",onClick:Sr,className:"inline-flex items-center gap-2 px-2 py-1 rounded-md border border-white/10 bg-black/10 hover:bg-black/20 transition-colors","aria-label":"Copiar legenda",title:"Copiar legenda",children:[a.jsx(Q4,{className:"w-4 h-4"}),a.jsx("span",{className:"text-xs",children:"Copiar"})]})]}),a.jsx("pre",{className:"whitespace-pre-wrap text-sm text-text-primary font-sans leading-relaxed",children:wt})]}),a.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[a.jsx("div",{className:"text-xs text-text-muted mb-3",children:"Compartilhar"}),a.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-1",children:[a.jsxs("button",{type:"button",onClick:Wr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:a.jsx("img",{src:"/imagem.png",alt:"Imagem",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Imagem"})]}),a.jsxs("button",{type:"button",onClick:qr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-emerald-500/15 border border-emerald-400/20 flex items-center justify-center",children:a.jsx("img",{src:"/whattsapp.png",alt:"WhatsApp",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"WhatsApp"})]}),a.jsxs("button",{type:"button",onClick:Tr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-fuchsia-500/15 border border-fuchsia-400/20 flex items-center justify-center",children:a.jsx("img",{src:"/instagram.png",alt:"Instagram",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Instagram"})]}),a.jsxs("button",{type:"button",onClick:xr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:a.jsx(Gue,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Link"})]})]})]})]})]}),a.jsx(Ua,{children:a.jsx(Z,{type:"button",variant:"outline",onClick:Rr,children:"Fechar"})})]})})]})}function _U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function NU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_U(Object(r),!0).forEach(function(n){fje(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_U(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fc(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var SU=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),wk=function(){return Math.random().toString(36).substring(7).split("").join(".")},CU={INIT:"@@redux/INIT"+wk(),REPLACE:"@@redux/REPLACE"+wk(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+wk()}};function EZe(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function zae(e,t,r){var n;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Fc(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Fc(1));return r(zae)(e,t)}if(typeof e!="function")throw new Error(Fc(2));var s=e,o=t,i=[],l=i,c=!1;function d(){l===i&&(l=i.slice())}function u(){if(c)throw new Error(Fc(3));return o}function f(g){if(typeof g!="function")throw new Error(Fc(4));if(c)throw new Error(Fc(5));var v=!0;return d(),l.push(g),function(){if(v){if(c)throw new Error(Fc(6));v=!1,d();var b=l.indexOf(g);l.splice(b,1),i=null}}}function h(g){if(!EZe(g))throw new Error(Fc(7));if(typeof g.type>"u")throw new Error(Fc(8));if(c)throw new Error(Fc(9));try{c=!0,o=s(o,g)}finally{c=!1}for(var v=i=l,y=0;y<v.length;y++){var b=v[y];b()}return g}function m(g){if(typeof g!="function")throw new Error(Fc(10));s=g,h({type:CU.REPLACE})}function x(){var g,v=f;return g={subscribe:function(b){if(typeof b!="object"||b===null)throw new Error(Fc(11));function w(){b.next&&b.next(u())}w();var j=v(w);return{unsubscribe:j}}},g[SU]=function(){return this},g}return h({type:CU.INIT}),n={dispatch:h,subscribe:f,getState:u,replaceReducer:m},n[SU]=x,n}function PU(e,t){return function(){return t(e.apply(this,arguments))}}function AU(e,t){if(typeof e=="function")return PU(e,t);if(typeof e!="object"||e===null)throw new Error(Fc(16));var r={};for(var n in e){var s=e[n];typeof s=="function"&&(r[n]=PU(s,t))}return r}function Uae(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?function(n){return n}:t.length===1?t[0]:t.reduce(function(n,s){return function(){return n(s.apply(void 0,arguments))}})}function kZe(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return function(){var s=n.apply(void 0,arguments),o=function(){throw new Error(Fc(15))},i={getState:s.getState,dispatch:function(){return o.apply(void 0,arguments)}},l=t.map(function(c){return c(i)});return o=Uae.apply(void 0,l)(s.dispatch),NU(NU({},s),{},{dispatch:o})}}}var Vae=Ce.createContext(null);function IZe(e){e()}var Wae=IZe,OZe=function(t){return Wae=t},TZe=function(){return Wae};function DZe(){var e=TZe(),t=null,r=null;return{clear:function(){t=null,r=null},notify:function(){e(function(){for(var s=t;s;)s.callback(),s=s.next})},get:function(){for(var s=[],o=t;o;)s.push(o),o=o.next;return s},subscribe:function(s){var o=!0,i=r={callback:s,next:null,prev:r};return i.prev?i.prev.next=i:t=i,function(){!o||t===null||(o=!1,i.next?i.next.prev=i.prev:r=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}var EU={notify:function(){},get:function(){return[]}};function Hae(e,t){var r,n=EU;function s(f){return c(),n.subscribe(f)}function o(){n.notify()}function i(){u.onStateChange&&u.onStateChange()}function l(){return!!r}function c(){r||(r=t?t.addNestedSub(i):e.subscribe(i),n=DZe())}function d(){r&&(r(),r=void 0,n.clear(),n=EU)}var u={addNestedSub:s,notifyNestedSubs:o,handleChangeWrapper:i,isSubscribed:l,trySubscribe:c,tryUnsubscribe:d,getListeners:function(){return n}};return u}var Gae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?p.useLayoutEffect:p.useEffect;function MZe(e){var t=e.store,r=e.context,n=e.children,s=p.useMemo(function(){var l=Hae(t);return{store:t,subscription:l}},[t]),o=p.useMemo(function(){return t.getState()},[t]);Gae(function(){var l=s.subscription;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==t.getState()&&l.notifyNestedSubs(),function(){l.tryUnsubscribe(),l.onStateChange=null}},[s,o]);var i=r||Vae;return Ce.createElement(i.Provider,{value:s},n)}var Kae={exports:{}},ho={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hl=typeof Symbol=="function"&&Symbol.for,VR=hl?Symbol.for("react.element"):60103,WR=hl?Symbol.for("react.portal"):60106,SP=hl?Symbol.for("react.fragment"):60107,CP=hl?Symbol.for("react.strict_mode"):60108,PP=hl?Symbol.for("react.profiler"):60114,AP=hl?Symbol.for("react.provider"):60109,EP=hl?Symbol.for("react.context"):60110,HR=hl?Symbol.for("react.async_mode"):60111,kP=hl?Symbol.for("react.concurrent_mode"):60111,IP=hl?Symbol.for("react.forward_ref"):60112,OP=hl?Symbol.for("react.suspense"):60113,RZe=hl?Symbol.for("react.suspense_list"):60120,TP=hl?Symbol.for("react.memo"):60115,DP=hl?Symbol.for("react.lazy"):60116,FZe=hl?Symbol.for("react.block"):60121,LZe=hl?Symbol.for("react.fundamental"):60117,$Ze=hl?Symbol.for("react.responder"):60118,BZe=hl?Symbol.for("react.scope"):60119;function zd(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case VR:switch(e=e.type,e){case HR:case kP:case SP:case PP:case CP:case OP:return e;default:switch(e=e&&e.$$typeof,e){case EP:case IP:case DP:case TP:case AP:return e;default:return t}}case WR:return t}}}function Xae(e){return zd(e)===kP}ho.AsyncMode=HR;ho.ConcurrentMode=kP;ho.ContextConsumer=EP;ho.ContextProvider=AP;ho.Element=VR;ho.ForwardRef=IP;ho.Fragment=SP;ho.Lazy=DP;ho.Memo=TP;ho.Portal=WR;ho.Profiler=PP;ho.StrictMode=CP;ho.Suspense=OP;ho.isAsyncMode=function(e){return Xae(e)||zd(e)===HR};ho.isConcurrentMode=Xae;ho.isContextConsumer=function(e){return zd(e)===EP};ho.isContextProvider=function(e){return zd(e)===AP};ho.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===VR};ho.isForwardRef=function(e){return zd(e)===IP};ho.isFragment=function(e){return zd(e)===SP};ho.isLazy=function(e){return zd(e)===DP};ho.isMemo=function(e){return zd(e)===TP};ho.isPortal=function(e){return zd(e)===WR};ho.isProfiler=function(e){return zd(e)===PP};ho.isStrictMode=function(e){return zd(e)===CP};ho.isSuspense=function(e){return zd(e)===OP};ho.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===SP||e===kP||e===PP||e===CP||e===OP||e===RZe||typeof e=="object"&&e!==null&&(e.$$typeof===DP||e.$$typeof===TP||e.$$typeof===AP||e.$$typeof===EP||e.$$typeof===IP||e.$$typeof===LZe||e.$$typeof===$Ze||e.$$typeof===BZe||e.$$typeof===FZe)};ho.typeOf=zd;Kae.exports=ho;var qZe=Kae.exports,GR=qZe,zZe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},UZe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},VZe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Yae={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},KR={};KR[GR.ForwardRef]=VZe;KR[GR.Memo]=Yae;function kU(e){return GR.isMemo(e)?Yae:KR[e.$$typeof]||zZe}var WZe=Object.defineProperty,HZe=Object.getOwnPropertyNames,IU=Object.getOwnPropertySymbols,GZe=Object.getOwnPropertyDescriptor,KZe=Object.getPrototypeOf,OU=Object.prototype;function Jae(e,t,r){if(typeof t!="string"){if(OU){var n=KZe(t);n&&n!==OU&&Jae(e,n,r)}var s=HZe(t);IU&&(s=s.concat(IU(t)));for(var o=kU(e),i=kU(t),l=0;l<s.length;++l){var c=s[l];if(!UZe[c]&&!(r&&r[c])&&!(i&&i[c])&&!(o&&o[c])){var d=GZe(t,c);try{WZe(e,c,d)}catch{}}}}return e}var XZe=Jae;const TU=Ls(XZe);var Qae={exports:{}},_o={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MP=60103,RP=60106,Nj=60107,Sj=60108,Cj=60114,Pj=60109,Aj=60110,Ej=60112,kj=60113,XR=60120,Ij=60115,Oj=60116,Zae=60121,ese=60122,tse=60117,rse=60129,nse=60131;if(typeof Symbol=="function"&&Symbol.for){var Nl=Symbol.for;MP=Nl("react.element"),RP=Nl("react.portal"),Nj=Nl("react.fragment"),Sj=Nl("react.strict_mode"),Cj=Nl("react.profiler"),Pj=Nl("react.provider"),Aj=Nl("react.context"),Ej=Nl("react.forward_ref"),kj=Nl("react.suspense"),XR=Nl("react.suspense_list"),Ij=Nl("react.memo"),Oj=Nl("react.lazy"),Zae=Nl("react.block"),ese=Nl("react.server.block"),tse=Nl("react.fundamental"),rse=Nl("react.debug_trace_mode"),nse=Nl("react.legacy_hidden")}function vf(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case MP:switch(e=e.type,e){case Nj:case Cj:case Sj:case kj:case XR:return e;default:switch(e=e&&e.$$typeof,e){case Aj:case Ej:case Oj:case Ij:case Pj:return e;default:return t}}case RP:return t}}}var YZe=Pj,JZe=MP,QZe=Ej,ZZe=Nj,eet=Oj,tet=Ij,ret=RP,net=Cj,aet=Sj,set=kj;_o.ContextConsumer=Aj;_o.ContextProvider=YZe;_o.Element=JZe;_o.ForwardRef=QZe;_o.Fragment=ZZe;_o.Lazy=eet;_o.Memo=tet;_o.Portal=ret;_o.Profiler=net;_o.StrictMode=aet;_o.Suspense=set;_o.isAsyncMode=function(){return!1};_o.isConcurrentMode=function(){return!1};_o.isContextConsumer=function(e){return vf(e)===Aj};_o.isContextProvider=function(e){return vf(e)===Pj};_o.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===MP};_o.isForwardRef=function(e){return vf(e)===Ej};_o.isFragment=function(e){return vf(e)===Nj};_o.isLazy=function(e){return vf(e)===Oj};_o.isMemo=function(e){return vf(e)===Ij};_o.isPortal=function(e){return vf(e)===RP};_o.isProfiler=function(e){return vf(e)===Cj};_o.isStrictMode=function(e){return vf(e)===Sj};_o.isSuspense=function(e){return vf(e)===kj};_o.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Nj||e===Cj||e===rse||e===Sj||e===kj||e===XR||e===nse||typeof e=="object"&&e!==null&&(e.$$typeof===Oj||e.$$typeof===Ij||e.$$typeof===Pj||e.$$typeof===Aj||e.$$typeof===Ej||e.$$typeof===tse||e.$$typeof===Zae||e[0]===ese)};_o.typeOf=vf;Qae.exports=_o;var oet=Qae.exports,iet=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],cet=["reactReduxForwardedRef"],det=[],uet=[null,null];function fet(e,t){var r=e[1];return[t.payload,r+1]}function DU(e,t,r){Gae(function(){return e.apply(void 0,t)},r)}function met(e,t,r,n,s,o,i){e.current=n,t.current=s,r.current=!1,o.current&&(o.current=null,i())}function het(e,t,r,n,s,o,i,l,c,d){if(e){var u=!1,f=null,h=function(){if(!u){var g=t.getState(),v,y;try{v=n(g,s.current)}catch(b){y=b,f=b}y||(f=null),v===o.current?i.current||c():(o.current=v,l.current=v,i.current=!0,d({type:"STORE_UPDATED",payload:{error:y}}))}};r.onStateChange=h,r.trySubscribe(),h();var m=function(){if(u=!0,r.tryUnsubscribe(),r.onStateChange=null,f)throw f};return m}}var pet=function(){return[null,0]};function get(e,t){t===void 0&&(t={});var r=t,n=r.getDisplayName,s=n===void 0?function(w){return"ConnectAdvanced("+w+")"}:n,o=r.methodName,i=o===void 0?"connectAdvanced":o,l=r.renderCountProp,c=l===void 0?void 0:l,d=r.shouldHandleStateChanges,u=d===void 0?!0:d,f=r.storeKey,h=f===void 0?"store":f;r.withRef;var m=r.forwardRef,x=m===void 0?!1:m,g=r.context,v=g===void 0?Vae:g,y=_S(r,iet),b=v;return function(j){var _=j.displayName||j.name||"Component",C=s(_),A=Wa({},y,{getDisplayName:s,methodName:i,renderCountProp:c,shouldHandleStateChanges:u,storeKey:h,displayName:C,wrappedComponentName:_,WrappedComponent:j}),S=y.pure;function P(k){return e(k.dispatch,A)}var M=S?p.useMemo:function(k){return k()};function O(k){var $=p.useMemo(function(){var St=k.reactReduxForwardedRef,ft=_S(k,cet);return[k.context,St,ft]},[k]),q=$[0],z=$[1],F=$[2],V=p.useMemo(function(){return q&&q.Consumer&&oet.isContextConsumer(Ce.createElement(q.Consumer,null))?q:b},[q,b]),ue=p.useContext(V),_e=!!k.store&&!!k.store.getState&&!!k.store.dispatch;ue&&ue.store;var U=_e?k.store:ue.store,L=p.useMemo(function(){return P(U)},[U]),G=p.useMemo(function(){if(!u)return uet;var St=Hae(U,_e?null:ue.subscription),ft=St.notifyNestedSubs.bind(St);return[St,ft]},[U,_e,ue]),de=G[0],X=G[1],W=p.useMemo(function(){return _e?ue:Wa({},ue,{subscription:de})},[_e,ue,de]),Y=p.useReducer(fet,det,pet),me=Y[0],ee=me[0],ae=Y[1];if(ee&&ee.error)throw ee.error;var le=p.useRef(),Te=p.useRef(F),te=p.useRef(),ie=p.useRef(!1),xt=M(function(){return te.current&&F===Te.current?te.current:L(U.getState(),F)},[U,ee,F]);DU(met,[Te,le,ie,F,xt,te,X]),DU(het,[u,U,de,L,Te,le,ie,te,X,ae],[U,de,L]);var vt=p.useMemo(function(){return Ce.createElement(j,Wa({},xt,{ref:z}))},[z,j,xt]),dt=p.useMemo(function(){return u?Ce.createElement(V.Provider,{value:W},vt):vt},[V,vt,W]);return dt}var I=S?Ce.memo(O):O;if(I.WrappedComponent=j,I.displayName=O.displayName=C,x){var T=Ce.forwardRef(function($,q){return Ce.createElement(I,Wa({},$,{reactReduxForwardedRef:q}))});return T.displayName=C,T.WrappedComponent=j,TU(T,j)}return TU(I,j)}}function MU(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function jk(e,t){if(MU(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var s=0;s<r.length;s++)if(!Object.prototype.hasOwnProperty.call(t,r[s])||!MU(e[r[s]],t[r[s]]))return!1;return!0}function xet(e,t){var r={},n=function(i){var l=e[i];typeof l=="function"&&(r[i]=function(){return t(l.apply(void 0,arguments))})};for(var s in e)n(s);return r}function YR(e){return function(r,n){var s=e(r,n);function o(){return s}return o.dependsOnOwnProps=!1,o}}function RU(e){return e.dependsOnOwnProps!==null&&e.dependsOnOwnProps!==void 0?!!e.dependsOnOwnProps:e.length!==1}function ase(e,t){return function(n,s){s.displayName;var o=function(l,c){return o.dependsOnOwnProps?o.mapToProps(l,c):o.mapToProps(l)};return o.dependsOnOwnProps=!0,o.mapToProps=function(l,c){o.mapToProps=e,o.dependsOnOwnProps=RU(e);var d=o(l,c);return typeof d=="function"&&(o.mapToProps=d,o.dependsOnOwnProps=RU(d),d=o(l,c)),d},o}}function vet(e){return typeof e=="function"?ase(e):void 0}function yet(e){return e?void 0:YR(function(t){return{dispatch:t}})}function bet(e){return e&&typeof e=="object"?YR(function(t){return xet(e,t)}):void 0}const wet=[vet,yet,bet];function jet(e){return typeof e=="function"?ase(e):void 0}function _et(e){return e?void 0:YR(function(){return{}})}const Net=[jet,_et];function Cet(e,t,r){return Wa({},r,e,t)}function Pet(e){return function(r,n){n.displayName;var s=n.pure,o=n.areMergedPropsEqual,i=!1,l;return function(d,u,f){var h=e(d,u,f);return i?(!s||!o(h,l))&&(l=h):(i=!0,l=h),l}}}function Aet(e){return typeof e=="function"?Pet(e):void 0}function Eet(e){return e?void 0:function(){return Cet}}const ket=[Aet,Eet];var Iet=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function Oet(e,t,r,n){return function(o,i){return r(e(o,i),t(n,i),i)}}function Tet(e,t,r,n,s){var o=s.areStatesEqual,i=s.areOwnPropsEqual,l=s.areStatePropsEqual,c=!1,d,u,f,h,m;function x(w,j){return d=w,u=j,f=e(d,u),h=t(n,u),m=r(f,h,u),c=!0,m}function g(){return f=e(d,u),t.dependsOnOwnProps&&(h=t(n,u)),m=r(f,h,u),m}function v(){return e.dependsOnOwnProps&&(f=e(d,u)),t.dependsOnOwnProps&&(h=t(n,u)),m=r(f,h,u),m}function y(){var w=e(d,u),j=!l(w,f);return f=w,j&&(m=r(f,h,u)),m}function b(w,j){var _=!i(j,u),C=!o(w,d,j,u);return d=w,u=j,_&&C?g():_?v():C?y():m}return function(j,_){return c?b(j,_):x(j,_)}}function Det(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,s=t.initMergeProps,o=_S(t,Iet),i=r(e,o),l=n(e,o),c=s(e,o),d=o.pure?Tet:Oet;return d(i,l,c,e,o)}var Met=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function _k(e,t,r){for(var n=t.length-1;n>=0;n--){var s=t[n](e);if(s)return s}return function(o,i){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+i.wrappedComponentName+".")}}function Ret(e,t){return e===t}function Fet(e){var t=e===void 0?{}:e,r=t.connectHOC,n=r===void 0?get:r,s=t.mapStateToPropsFactories,o=s===void 0?Net:s,i=t.mapDispatchToPropsFactories,l=i===void 0?wet:i,c=t.mergePropsFactories,d=c===void 0?ket:c,u=t.selectorFactory,f=u===void 0?Det:u;return function(m,x,g,v){v===void 0&&(v={});var y=v,b=y.pure,w=b===void 0?!0:b,j=y.areStatesEqual,_=j===void 0?Ret:j,C=y.areOwnPropsEqual,A=C===void 0?jk:C,S=y.areStatePropsEqual,P=S===void 0?jk:S,M=y.areMergedPropsEqual,O=M===void 0?jk:M,I=_S(y,Met),T=_k(m,o,"mapStateToProps"),k=_k(x,l,"mapDispatchToProps"),$=_k(g,d,"mergeProps");return n(f,Wa({methodName:"connect",getDisplayName:function(z){return"Connect("+z+")"},shouldHandleStateChanges:!!m,initMapStateToProps:T,initMapDispatchToProps:k,initMergeProps:$,pure:w,areStatesEqual:_,areOwnPropsEqual:A,areStatePropsEqual:P,areMergedPropsEqual:O},I))}}const sse=Fet();OZe(Xm.unstable_batchedUpdates);function Let(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function ose(e,t){var r=p.useState(function(){return{inputs:t,result:e()}})[0],n=p.useRef(!0),s=p.useRef(r),o=n.current||!!(t&&s.current.inputs&&Let(t,s.current.inputs)),i=o?s.current:{inputs:t,result:e()};return p.useEffect(function(){n.current=!1,s.current=i},[i]),i.result}function $et(e,t){return ose(function(){return e},t)}var Vs=ose,Ma=$et,Zu=function(t){var r=t.top,n=t.right,s=t.bottom,o=t.left,i=n-o,l=s-r,c={top:r,right:n,bottom:s,left:o,width:i,height:l,x:o,y:r,center:{x:(n+o)/2,y:(s+r)/2}};return c},JR=function(t,r){return{top:t.top-r.top,left:t.left-r.left,bottom:t.bottom+r.bottom,right:t.right+r.right}},FU=function(t,r){return{top:t.top+r.top,left:t.left+r.left,bottom:t.bottom-r.bottom,right:t.right-r.right}},Bet=function(t,r){return{top:t.top+r.y,left:t.left+r.x,bottom:t.bottom+r.y,right:t.right+r.x}},Nk={top:0,right:0,bottom:0,left:0},QR=function(t){var r=t.borderBox,n=t.margin,s=n===void 0?Nk:n,o=t.border,i=o===void 0?Nk:o,l=t.padding,c=l===void 0?Nk:l,d=Zu(JR(r,s)),u=Zu(FU(r,i)),f=Zu(FU(u,c));return{marginBox:d,borderBox:Zu(r),paddingBox:u,contentBox:f,margin:s,border:i,padding:c}},Qd=function(t){var r=t.slice(0,-2),n=t.slice(-2);if(n!=="px")return 0;var s=Number(r);return isNaN(s)&&bp(!1),s},qet=function(){return{x:window.pageXOffset,y:window.pageYOffset}},iC=function(t,r){var n=t.borderBox,s=t.border,o=t.margin,i=t.padding,l=Bet(n,r);return QR({borderBox:l,border:s,margin:o,padding:i})},lC=function(t,r){return r===void 0&&(r=qet()),iC(t,r)},ise=function(t,r){var n={top:Qd(r.marginTop),right:Qd(r.marginRight),bottom:Qd(r.marginBottom),left:Qd(r.marginLeft)},s={top:Qd(r.paddingTop),right:Qd(r.paddingRight),bottom:Qd(r.paddingBottom),left:Qd(r.paddingLeft)},o={top:Qd(r.borderTopWidth),right:Qd(r.borderRightWidth),bottom:Qd(r.borderBottomWidth),left:Qd(r.borderLeftWidth)};return QR({borderBox:t,margin:n,padding:s,border:o})},lse=function(t){var r=t.getBoundingClientRect(),n=window.getComputedStyle(t);return ise(r,n)},LU=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function zet(e,t){return!!(e===t||LU(e)&&LU(t))}function Uet(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!zet(e[r],t[r]))return!1;return!0}function ul(e,t){t===void 0&&(t=Uet);var r,n=[],s,o=!1;function i(){for(var l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];return o&&r===this&&t(l,n)||(s=e.apply(this,l),o=!0,r=this,n=l),s}return i}var Vet=function(t){var r=[],n=null,s=function(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];r=l,!n&&(n=requestAnimationFrame(function(){n=null,t.apply(void 0,r)}))};return s.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},s};const F1=Vet;function cse(e,t){}cse.bind(null,"warn");cse.bind(null,"error");function dp(){}function Wet(e,t){return Wa({},e,{},t)}function pu(e,t,r){var n=t.map(function(s){var o=Wet(r,s.options);return e.addEventListener(s.eventName,s.fn,o),function(){e.removeEventListener(s.eventName,s.fn,o)}});return function(){n.forEach(function(o){o()})}}var Het="Invariant failed";function cC(e){this.message=e}cC.prototype.toString=function(){return this.message};function Vn(e,t){if(!e)throw new cC(Het)}var Get=function(e){BZ(t,e);function t(){for(var n,s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.callbacks=null,n.unbind=dp,n.onWindowError=function(l){var c=n.getCallbacks();c.isDragging()&&c.tryAbort();var d=l.error;d instanceof cC&&l.preventDefault()},n.getCallbacks=function(){if(!n.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return n.callbacks},n.setCallbacks=function(l){n.callbacks=l},n}var r=t.prototype;return r.componentDidMount=function(){this.unbind=pu(window,[{eventName:"error",fn:this.onWindowError}])},r.componentDidCatch=function(s){if(s instanceof cC){this.setState({});return}throw s},r.componentWillUnmount=function(){this.unbind()},r.render=function(){return this.props.children(this.setCallbacks)},t}(Ce.Component),Ket=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,dC=function(t){return t+1},Xet=function(t){return`
  You have lifted an item in position `+dC(t.source.index)+`
`},dse=function(t,r){var n=t.droppableId===r.droppableId,s=dC(t.index),o=dC(r.index);return n?`
      You have moved the item from position `+s+`
      to position `+o+`
    `:`
    You have moved the item from position `+s+`
    in list `+t.droppableId+`
    to list `+r.droppableId+`
    in position `+o+`
  `},use=function(t,r,n){var s=r.droppableId===n.droppableId;return s?`
      The item `+t+`
      has been combined with `+n.draggableId:`
      The item `+t+`
      in list `+r.droppableId+`
      has been combined with `+n.draggableId+`
      in list `+n.droppableId+`
    `},Yet=function(t){var r=t.destination;if(r)return dse(t.source,r);var n=t.combine;return n?use(t.draggableId,t.source,n):"You are over an area that cannot be dropped on"},$U=function(t){return`
  The item has returned to its starting position
  of `+dC(t.index)+`
`},Jet=function(t){if(t.reason==="CANCEL")return`
      Movement cancelled.
      `+$U(t.source)+`
    `;var r=t.destination,n=t.combine;return r?`
      You have dropped the item.
      `+dse(t.source,r)+`
    `:n?`
      You have dropped the item.
      `+use(t.draggableId,t.source,n)+`
    `:`
    The item has been dropped while not over a drop area.
    `+$U(t.source)+`
  `},U_={dragHandleUsageInstructions:Ket,onDragStart:Xet,onDragUpdate:Yet,onDragEnd:Jet},fl={x:0,y:0},Al=function(t,r){return{x:t.x+r.x,y:t.y+r.y}},Ad=function(t,r){return{x:t.x-r.x,y:t.y-r.y}},up=function(t,r){return t.x===r.x&&t.y===r.y},Ay=function(t){return{x:t.x!==0?-t.x:0,y:t.y!==0?-t.y:0}},fx=function(t,r,n){var s;return n===void 0&&(n=0),s={},s[t]=r,s[t==="x"?"y":"x"]=n,s},L1=function(t,r){return Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))},BU=function(t,r){return Math.min.apply(Math,r.map(function(n){return L1(t,n)}))},fse=function(t){return function(r){return{x:t(r.x),y:t(r.y)}}},Qet=function(e,t){var r=Zu({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return r.width<=0||r.height<=0?null:r},Tj=function(t,r){return{top:t.top+r.y,left:t.left+r.x,bottom:t.bottom+r.y,right:t.right+r.x}},qU=function(t){return[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.bottom}]},Zet={top:0,right:0,bottom:0,left:0},ett=function(t,r){return r?Tj(t,r.scroll.diff.displacement):t},ttt=function(t,r,n){if(n&&n.increasedBy){var s;return Wa({},t,(s={},s[r.end]=t[r.end]+n.increasedBy[r.line],s))}return t},rtt=function(t,r){return r&&r.shouldClipSubject?Qet(r.pageMarginBox,t):Zu(t)},K0=function(e){var t=e.page,r=e.withPlaceholder,n=e.axis,s=e.frame,o=ett(t.marginBox,s),i=ttt(o,n,r),l=rtt(i,s);return{page:t,withPlaceholder:r,active:l}},ZR=function(e,t){e.frame||Vn(!1);var r=e.frame,n=Ad(t,r.scroll.initial),s=Ay(n),o=Wa({},r,{scroll:{initial:r.scroll.initial,current:t,diff:{value:n,displacement:s},max:r.scroll.max}}),i=K0({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:o}),l=Wa({},e,{frame:o,subject:i});return l};function uC(e){return Object.values?Object.values(e):Object.keys(e).map(function(t){return e[t]})}function eF(e,t){if(e.findIndex)return e.findIndex(t);for(var r=0;r<e.length;r++)if(t(e[r]))return r;return-1}function Bp(e,t){if(e.find)return e.find(t);var r=eF(e,t);if(r!==-1)return e[r]}function mse(e){return Array.prototype.slice.call(e)}var hse=ul(function(e){return e.reduce(function(t,r){return t[r.descriptor.id]=r,t},{})}),pse=ul(function(e){return e.reduce(function(t,r){return t[r.descriptor.id]=r,t},{})}),FP=ul(function(e){return uC(e)}),ntt=ul(function(e){return uC(e)}),Ey=ul(function(e,t){var r=ntt(t).filter(function(n){return e===n.descriptor.droppableId}).sort(function(n,s){return n.descriptor.index-s.descriptor.index});return r});function tF(e){return e.at&&e.at.type==="REORDER"?e.at.destination:null}function LP(e){return e.at&&e.at.type==="COMBINE"?e.at.combine:null}var $P=ul(function(e,t){return t.filter(function(r){return r.descriptor.id!==e.descriptor.id})}),att=function(e){var t=e.isMovingForward,r=e.draggable,n=e.destination,s=e.insideDestination,o=e.previousImpact;if(!n.isCombineEnabled)return null;var i=tF(o);if(!i)return null;function l(g){var v={type:"COMBINE",combine:{draggableId:g,droppableId:n.descriptor.id}};return Wa({},o,{at:v})}var c=o.displaced.all,d=c.length?c[0]:null;if(t)return d?l(d):null;var u=$P(r,s);if(!d){if(!u.length)return null;var f=u[u.length-1];return l(f.descriptor.id)}var h=eF(u,function(g){return g.descriptor.id===d});h===-1&&Vn(!1);var m=h-1;if(m<0)return null;var x=u[m];return l(x.descriptor.id)},ky=function(e,t){return e.descriptor.droppableId===t.descriptor.id},gse={point:fl,value:0},$1={invisible:{},visible:{},all:[]},stt={displaced:$1,displacedBy:gse,at:null},yu=function(e,t){return function(r){return e<=r&&r<=t}},xse=function(e){var t=yu(e.top,e.bottom),r=yu(e.left,e.right);return function(n){var s=t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right);if(s)return!0;var o=t(n.top)||t(n.bottom),i=r(n.left)||r(n.right),l=o&&i;if(l)return!0;var c=n.top<e.top&&n.bottom>e.bottom,d=n.left<e.left&&n.right>e.right,u=c&&d;if(u)return!0;var f=c&&i||d&&o;return f}},ott=function(e){var t=yu(e.top,e.bottom),r=yu(e.left,e.right);return function(n){var s=t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right);return s}},rF={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},vse={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},itt=function(e){return function(t){var r=yu(t.top,t.bottom),n=yu(t.left,t.right);return function(s){return e===rF?r(s.top)&&r(s.bottom):n(s.left)&&n(s.right)}}},ltt=function(t,r){var n=r.frame?r.frame.scroll.diff.displacement:fl;return Tj(t,n)},ctt=function(t,r,n){return r.subject.active?n(r.subject.active)(t):!1},dtt=function(t,r,n){return n(r)(t)},nF=function(t){var r=t.target,n=t.destination,s=t.viewport,o=t.withDroppableDisplacement,i=t.isVisibleThroughFrameFn,l=o?ltt(r,n):r;return ctt(l,n,i)&&dtt(l,s,i)},utt=function(t){return nF(Wa({},t,{isVisibleThroughFrameFn:xse}))},yse=function(t){return nF(Wa({},t,{isVisibleThroughFrameFn:ott}))},ftt=function(t){return nF(Wa({},t,{isVisibleThroughFrameFn:itt(t.destination.axis)}))},mtt=function(t,r,n){if(typeof n=="boolean")return n;if(!r)return!0;var s=r.invisible,o=r.visible;if(s[t])return!1;var i=o[t];return i?i.shouldAnimate:!0};function htt(e,t){var r=e.page.marginBox,n={top:t.point.y,right:0,bottom:0,left:t.point.x};return Zu(JR(r,n))}function B1(e){var t=e.afterDragging,r=e.destination,n=e.displacedBy,s=e.viewport,o=e.forceShouldAnimate,i=e.last;return t.reduce(function(c,d){var u=htt(d,n),f=d.descriptor.id;c.all.push(f);var h=utt({target:u,destination:r,viewport:s,withDroppableDisplacement:!0});if(!h)return c.invisible[d.descriptor.id]=!0,c;var m=mtt(f,i,o),x={draggableId:f,shouldAnimate:m};return c.visible[f]=x,c},{all:[],visible:{},invisible:{}})}function ptt(e,t){if(!e.length)return 0;var r=e[e.length-1].descriptor.index;return t.inHomeList?r:r+1}function zU(e){var t=e.insideDestination,r=e.inHomeList,n=e.displacedBy,s=e.destination,o=ptt(t,{inHomeList:r});return{displaced:$1,displacedBy:n,at:{type:"REORDER",destination:{droppableId:s.descriptor.id,index:o}}}}function fC(e){var t=e.draggable,r=e.insideDestination,n=e.destination,s=e.viewport,o=e.displacedBy,i=e.last,l=e.index,c=e.forceShouldAnimate,d=ky(t,n);if(l==null)return zU({insideDestination:r,inHomeList:d,displacedBy:o,destination:n});var u=Bp(r,function(g){return g.descriptor.index===l});if(!u)return zU({insideDestination:r,inHomeList:d,displacedBy:o,destination:n});var f=$P(t,r),h=r.indexOf(u),m=f.slice(h),x=B1({afterDragging:m,destination:n,displacedBy:o,last:i,viewport:s.frame,forceShouldAnimate:c});return{displaced:x,displacedBy:o,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:l}}}}function Sp(e,t){return!!t.effected[e]}var gtt=function(e){var t=e.isMovingForward,r=e.destination,n=e.draggables,s=e.combine,o=e.afterCritical;if(!r.isCombineEnabled)return null;var i=s.draggableId,l=n[i],c=l.descriptor.index,d=Sp(i,o);return d?t?c:c-1:t?c+1:c},xtt=function(e){var t=e.isMovingForward,r=e.isInHomeList,n=e.insideDestination,s=e.location;if(!n.length)return null;var o=s.index,i=t?o+1:o-1,l=n[0].descriptor.index,c=n[n.length-1].descriptor.index,d=r?c:c+1;return i<l||i>d?null:i},vtt=function(e){var t=e.isMovingForward,r=e.isInHomeList,n=e.draggable,s=e.draggables,o=e.destination,i=e.insideDestination,l=e.previousImpact,c=e.viewport,d=e.afterCritical,u=l.at;if(u||Vn(!1),u.type==="REORDER"){var f=xtt({isMovingForward:t,isInHomeList:r,location:u.destination,insideDestination:i});return f==null?null:fC({draggable:n,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:f})}var h=gtt({isMovingForward:t,destination:o,displaced:l.displaced,draggables:s,combine:u.combine,afterCritical:d});return h==null?null:fC({draggable:n,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:h})},ytt=function(e){var t=e.displaced,r=e.afterCritical,n=e.combineWith,s=e.displacedBy,o=!!(t.visible[n]||t.invisible[n]);return Sp(n,r)?o?fl:Ay(s.point):o?s.point:fl},btt=function(e){var t=e.afterCritical,r=e.impact,n=e.draggables,s=LP(r);s||Vn(!1);var o=s.draggableId,i=n[o].page.borderBox.center,l=ytt({displaced:r.displaced,afterCritical:t,combineWith:o,displacedBy:r.displacedBy});return Al(i,l)},bse=function(t,r){return r.margin[t.start]+r.borderBox[t.size]/2},wtt=function(t,r){return r.margin[t.end]+r.borderBox[t.size]/2},aF=function(t,r,n){return r[t.crossAxisStart]+n.margin[t.crossAxisStart]+n.borderBox[t.crossAxisSize]/2},UU=function(t){var r=t.axis,n=t.moveRelativeTo,s=t.isMoving;return fx(r.line,n.marginBox[r.end]+bse(r,s),aF(r,n.marginBox,s))},VU=function(t){var r=t.axis,n=t.moveRelativeTo,s=t.isMoving;return fx(r.line,n.marginBox[r.start]-wtt(r,s),aF(r,n.marginBox,s))},jtt=function(t){var r=t.axis,n=t.moveInto,s=t.isMoving;return fx(r.line,n.contentBox[r.start]+bse(r,s),aF(r,n.contentBox,s))},_tt=function(e){var t=e.impact,r=e.draggable,n=e.draggables,s=e.droppable,o=e.afterCritical,i=Ey(s.descriptor.id,n),l=r.page,c=s.axis;if(!i.length)return jtt({axis:c,moveInto:s.page,isMoving:l});var d=t.displaced,u=t.displacedBy,f=d.all[0];if(f){var h=n[f];if(Sp(f,o))return VU({axis:c,moveRelativeTo:h.page,isMoving:l});var m=iC(h.page,u.point);return VU({axis:c,moveRelativeTo:m,isMoving:l})}var x=i[i.length-1];if(x.descriptor.id===r.descriptor.id)return l.borderBox.center;if(Sp(x.descriptor.id,o)){var g=iC(x.page,Ay(o.displacedBy.point));return UU({axis:c,moveRelativeTo:g,isMoving:l})}return UU({axis:c,moveRelativeTo:x.page,isMoving:l})},O3=function(e,t){var r=e.frame;return r?Al(t,r.scroll.diff.displacement):t},Ntt=function(t){var r=t.impact,n=t.draggable,s=t.droppable,o=t.draggables,i=t.afterCritical,l=n.page.borderBox.center,c=r.at;return!s||!c?l:c.type==="REORDER"?_tt({impact:r,draggable:n,draggables:o,droppable:s,afterCritical:i}):btt({impact:r,draggables:o,afterCritical:i})},BP=function(e){var t=Ntt(e),r=e.droppable,n=r?O3(r,t):t;return n},wse=function(e,t){var r=Ad(t,e.scroll.initial),n=Ay(r),s=Zu({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),o={frame:s,scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:r,displacement:n}}};return o};function WU(e,t){return e.map(function(r){return t[r]})}function Stt(e,t){for(var r=0;r<t.length;r++){var n=t[r].visible[e];if(n)return n}return null}var Ctt=function(e){var t=e.impact,r=e.viewport,n=e.destination,s=e.draggables,o=e.maxScrollChange,i=wse(r,Al(r.scroll.current,o)),l=n.frame?ZR(n,Al(n.frame.scroll.current,o)):n,c=t.displaced,d=B1({afterDragging:WU(c.all,s),destination:n,displacedBy:t.displacedBy,viewport:i.frame,last:c,forceShouldAnimate:!1}),u=B1({afterDragging:WU(c.all,s),destination:l,displacedBy:t.displacedBy,viewport:r.frame,last:c,forceShouldAnimate:!1}),f={},h={},m=[c,d,u];c.all.forEach(function(g){var v=Stt(g,m);if(v){h[g]=v;return}f[g]=!0});var x=Wa({},t,{displaced:{all:c.all,invisible:f,visible:h}});return x},Ptt=function(e,t){return Al(e.scroll.diff.displacement,t)},sF=function(e){var t=e.pageBorderBoxCenter,r=e.draggable,n=e.viewport,s=Ptt(n,t),o=Ad(s,r.page.borderBox.center);return Al(r.client.borderBox.center,o)},jse=function(e){var t=e.draggable,r=e.destination,n=e.newPageBorderBoxCenter,s=e.viewport,o=e.withDroppableDisplacement,i=e.onlyOnMainAxis,l=i===void 0?!1:i,c=Ad(n,t.page.borderBox.center),d=Tj(t.page.borderBox,c),u={target:d,destination:r,withDroppableDisplacement:o,viewport:s};return l?ftt(u):yse(u)},Att=function(e){var t=e.isMovingForward,r=e.draggable,n=e.destination,s=e.draggables,o=e.previousImpact,i=e.viewport,l=e.previousPageBorderBoxCenter,c=e.previousClientSelection,d=e.afterCritical;if(!n.isEnabled)return null;var u=Ey(n.descriptor.id,s),f=ky(r,n),h=att({isMovingForward:t,draggable:r,destination:n,insideDestination:u,previousImpact:o})||vtt({isMovingForward:t,isInHomeList:f,draggable:r,draggables:s,destination:n,insideDestination:u,previousImpact:o,viewport:i,afterCritical:d});if(!h)return null;var m=BP({impact:h,draggable:r,droppable:n,draggables:s,afterCritical:d}),x=jse({draggable:r,destination:n,newPageBorderBoxCenter:m,viewport:i.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});if(x){var g=sF({pageBorderBoxCenter:m,draggable:r,viewport:i});return{clientSelection:g,impact:h,scrollJumpRequest:null}}var v=Ad(m,l),y=Ctt({impact:h,viewport:i,destination:n,draggables:s,maxScrollChange:v});return{clientSelection:c,impact:y,scrollJumpRequest:v}},lc=function(t){var r=t.subject.active;return r||Vn(!1),r},Ett=function(e){var t=e.isMovingForward,r=e.pageBorderBoxCenter,n=e.source,s=e.droppables,o=e.viewport,i=n.subject.active;if(!i)return null;var l=n.axis,c=yu(i[l.start],i[l.end]),d=FP(s).filter(function(f){return f!==n}).filter(function(f){return f.isEnabled}).filter(function(f){return!!f.subject.active}).filter(function(f){return xse(o.frame)(lc(f))}).filter(function(f){var h=lc(f);return t?i[l.crossAxisEnd]<h[l.crossAxisEnd]:h[l.crossAxisStart]<i[l.crossAxisStart]}).filter(function(f){var h=lc(f),m=yu(h[l.start],h[l.end]);return c(h[l.start])||c(h[l.end])||m(i[l.start])||m(i[l.end])}).sort(function(f,h){var m=lc(f)[l.crossAxisStart],x=lc(h)[l.crossAxisStart];return t?m-x:x-m}).filter(function(f,h,m){return lc(f)[l.crossAxisStart]===lc(m[0])[l.crossAxisStart]});if(!d.length)return null;if(d.length===1)return d[0];var u=d.filter(function(f){var h=yu(lc(f)[l.start],lc(f)[l.end]);return h(r[l.line])});return u.length===1?u[0]:u.length>1?u.sort(function(f,h){return lc(f)[l.start]-lc(h)[l.start]})[0]:d.sort(function(f,h){var m=BU(r,qU(lc(f))),x=BU(r,qU(lc(h)));return m!==x?m-x:lc(f)[l.start]-lc(h)[l.start]})[0]},HU=function(t,r){var n=t.page.borderBox.center;return Sp(t.descriptor.id,r)?Ad(n,r.displacedBy.point):n},ktt=function(t,r){var n=t.page.borderBox;return Sp(t.descriptor.id,r)?Tj(n,Ay(r.displacedBy.point)):n},Itt=function(e){var t=e.pageBorderBoxCenter,r=e.viewport,n=e.destination,s=e.insideDestination,o=e.afterCritical,i=s.filter(function(l){return yse({target:ktt(l,o),destination:n,viewport:r.frame,withDroppableDisplacement:!0})}).sort(function(l,c){var d=L1(t,O3(n,HU(l,o))),u=L1(t,O3(n,HU(c,o)));return d<u?-1:u<d?1:l.descriptor.index-c.descriptor.index});return i[0]||null},Dj=ul(function(t,r){var n=r[t.line];return{value:n,point:fx(t.line,n)}}),Ott=function(t,r,n){var s=t.axis;if(t.descriptor.mode==="virtual")return fx(s.line,r[s.line]);var o=t.subject.page.contentBox[s.size],i=Ey(t.descriptor.id,n),l=i.reduce(function(u,f){return u+f.client.marginBox[s.size]},0),c=l+r[s.line],d=c-o;return d<=0?null:fx(s.line,d)},_se=function(t,r){return Wa({},t,{scroll:Wa({},t.scroll,{max:r})})},Nse=function(t,r,n){var s=t.frame;ky(r,t)&&Vn(!1),t.subject.withPlaceholder&&Vn(!1);var o=Dj(t.axis,r.displaceBy).point,i=Ott(t,o,n),l={placeholderSize:o,increasedBy:i,oldFrameMaxScroll:t.frame?t.frame.scroll.max:null};if(!s){var c=K0({page:t.subject.page,withPlaceholder:l,axis:t.axis,frame:t.frame});return Wa({},t,{subject:c})}var d=i?Al(s.scroll.max,i):s.scroll.max,u=_se(s,d),f=K0({page:t.subject.page,withPlaceholder:l,axis:t.axis,frame:u});return Wa({},t,{subject:f,frame:u})},Ttt=function(t){var r=t.subject.withPlaceholder;r||Vn(!1);var n=t.frame;if(!n){var s=K0({page:t.subject.page,axis:t.axis,frame:null,withPlaceholder:null});return Wa({},t,{subject:s})}var o=r.oldFrameMaxScroll;o||Vn(!1);var i=_se(n,o),l=K0({page:t.subject.page,axis:t.axis,frame:i,withPlaceholder:null});return Wa({},t,{subject:l,frame:i})},Dtt=function(e){var t=e.previousPageBorderBoxCenter,r=e.moveRelativeTo,n=e.insideDestination,s=e.draggable,o=e.draggables,i=e.destination,l=e.viewport,c=e.afterCritical;if(!r){if(n.length)return null;var d={displaced:$1,displacedBy:gse,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:0}}},u=BP({impact:d,draggable:s,droppable:i,draggables:o,afterCritical:c}),f=ky(s,i)?i:Nse(i,s,o),h=jse({draggable:s,destination:f,newPageBorderBoxCenter:u,viewport:l.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});return h?d:null}var m=t[i.axis.line]<=r.page.borderBox.center[i.axis.line],x=function(){var v=r.descriptor.index;return r.descriptor.id===s.descriptor.id||m?v:v+1}(),g=Dj(i.axis,s.displaceBy);return fC({draggable:s,insideDestination:n,destination:i,viewport:l,displacedBy:g,last:$1,index:x})},Mtt=function(e){var t=e.isMovingForward,r=e.previousPageBorderBoxCenter,n=e.draggable,s=e.isOver,o=e.draggables,i=e.droppables,l=e.viewport,c=e.afterCritical,d=Ett({isMovingForward:t,pageBorderBoxCenter:r,source:s,droppables:i,viewport:l});if(!d)return null;var u=Ey(d.descriptor.id,o),f=Itt({pageBorderBoxCenter:r,viewport:l,destination:d,insideDestination:u,afterCritical:c}),h=Dtt({previousPageBorderBoxCenter:r,destination:d,draggable:n,draggables:o,moveRelativeTo:f,insideDestination:u,viewport:l,afterCritical:c});if(!h)return null;var m=BP({impact:h,draggable:n,droppable:d,draggables:o,afterCritical:c}),x=sF({pageBorderBoxCenter:m,draggable:n,viewport:l});return{clientSelection:x,impact:h,scrollJumpRequest:null}},Dd=function(e){var t=e.at;return t?t.type==="REORDER"?t.destination.droppableId:t.combine.droppableId:null},Rtt=function(t,r){var n=Dd(t);return n?r[n]:null},Ftt=function(e){var t=e.state,r=e.type,n=Rtt(t.impact,t.dimensions.droppables),s=!!n,o=t.dimensions.droppables[t.critical.droppable.id],i=n||o,l=i.axis.direction,c=l==="vertical"&&(r==="MOVE_UP"||r==="MOVE_DOWN")||l==="horizontal"&&(r==="MOVE_LEFT"||r==="MOVE_RIGHT");if(c&&!s)return null;var d=r==="MOVE_DOWN"||r==="MOVE_RIGHT",u=t.dimensions.draggables[t.critical.draggable.id],f=t.current.page.borderBoxCenter,h=t.dimensions,m=h.draggables,x=h.droppables;return c?Att({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,destination:i,draggables:m,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):Mtt({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,isOver:i,draggables:m,droppables:x,viewport:t.viewport,afterCritical:t.afterCritical})};function cg(e){return e.phase==="DRAGGING"||e.phase==="COLLECTING"}function Sse(e){var t=yu(e.top,e.bottom),r=yu(e.left,e.right);return function(s){return t(s.y)&&r(s.x)}}function Ltt(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top}function $tt(e){var t=e.pageBorderBox,r=e.draggable,n=e.candidates,s=r.page.borderBox.center,o=n.map(function(i){var l=i.axis,c=fx(i.axis.line,t.center[l.line],i.page.borderBox.center[l.crossAxisLine]);return{id:i.descriptor.id,distance:L1(s,c)}}).sort(function(i,l){return l.distance-i.distance});return o[0]?o[0].id:null}function Btt(e){var t=e.pageBorderBox,r=e.draggable,n=e.droppables,s=FP(n).filter(function(o){if(!o.isEnabled)return!1;var i=o.subject.active;if(!i||!Ltt(t,i))return!1;if(Sse(i)(t.center))return!0;var l=o.axis,c=i.center[l.crossAxisLine],d=t[l.crossAxisStart],u=t[l.crossAxisEnd],f=yu(i[l.crossAxisStart],i[l.crossAxisEnd]),h=f(d),m=f(u);return!h&&!m?!0:h?d<c:u>c});return s.length?s.length===1?s[0].descriptor.id:$tt({pageBorderBox:t,draggable:r,candidates:s}):null}var Cse=function(t,r){return Zu(Tj(t,r))},qtt=function(e,t){var r=e.frame;return r?Cse(t,r.scroll.diff.value):t};function Pse(e){var t=e.displaced,r=e.id;return!!(t.visible[r]||t.invisible[r])}function ztt(e){var t=e.draggable,r=e.closest,n=e.inHomeList;return r?n&&r.descriptor.index>t.descriptor.index?r.descriptor.index-1:r.descriptor.index:null}var Utt=function(e){var t=e.pageBorderBoxWithDroppableScroll,r=e.draggable,n=e.destination,s=e.insideDestination,o=e.last,i=e.viewport,l=e.afterCritical,c=n.axis,d=Dj(n.axis,r.displaceBy),u=d.value,f=t[c.start],h=t[c.end],m=$P(r,s),x=Bp(m,function(v){var y=v.descriptor.id,b=v.page.borderBox.center[c.line],w=Sp(y,l),j=Pse({displaced:o,id:y});return w?j?h<=b:f<b-u:j?h<=b+u:f<b}),g=ztt({draggable:r,closest:x,inHomeList:ky(r,n)});return fC({draggable:r,insideDestination:s,destination:n,viewport:i,last:o,displacedBy:d,index:g})},Vtt=4,Wtt=function(e){var t=e.draggable,r=e.pageBorderBoxWithDroppableScroll,n=e.previousImpact,s=e.destination,o=e.insideDestination,i=e.afterCritical;if(!s.isCombineEnabled)return null;var l=s.axis,c=Dj(s.axis,t.displaceBy),d=c.value,u=r[l.start],f=r[l.end],h=$P(t,o),m=Bp(h,function(g){var v=g.descriptor.id,y=g.page.borderBox,b=y[l.size],w=b/Vtt,j=Sp(v,i),_=Pse({displaced:n.displaced,id:v});return j?_?f>y[l.start]+w&&f<y[l.end]-w:u>y[l.start]-d+w&&u<y[l.end]-d-w:_?f>y[l.start]+d+w&&f<y[l.end]+d-w:u>y[l.start]+w&&u<y[l.end]-w});if(!m)return null;var x={displacedBy:c,displaced:n.displaced,at:{type:"COMBINE",combine:{draggableId:m.descriptor.id,droppableId:s.descriptor.id}}};return x},Ase=function(e){var t=e.pageOffset,r=e.draggable,n=e.draggables,s=e.droppables,o=e.previousImpact,i=e.viewport,l=e.afterCritical,c=Cse(r.page.borderBox,t),d=Btt({pageBorderBox:c,draggable:r,droppables:s});if(!d)return stt;var u=s[d],f=Ey(u.descriptor.id,n),h=qtt(u,c);return Wtt({pageBorderBoxWithDroppableScroll:h,draggable:r,previousImpact:o,destination:u,insideDestination:f,afterCritical:l})||Utt({pageBorderBoxWithDroppableScroll:h,draggable:r,destination:u,insideDestination:f,last:o.displaced,viewport:i,afterCritical:l})},oF=function(e,t){var r;return Wa({},e,(r={},r[t.descriptor.id]=t,r))},Htt=function(t){var r=t.previousImpact,n=t.impact,s=t.droppables,o=Dd(r),i=Dd(n);if(!o||o===i)return s;var l=s[o];if(!l.subject.withPlaceholder)return s;var c=Ttt(l);return oF(s,c)},Gtt=function(e){var t=e.draggable,r=e.draggables,n=e.droppables,s=e.previousImpact,o=e.impact,i=Htt({previousImpact:s,impact:o,droppables:n}),l=Dd(o);if(!l)return i;var c=n[l];if(ky(t,c)||c.subject.withPlaceholder)return i;var d=Nse(c,t,r);return oF(i,d)},dw=function(e){var t=e.state,r=e.clientSelection,n=e.dimensions,s=e.viewport,o=e.impact,i=e.scrollJumpRequest,l=s||t.viewport,c=n||t.dimensions,d=r||t.current.client.selection,u=Ad(d,t.initial.client.selection),f={offset:u,selection:d,borderBoxCenter:Al(t.initial.client.borderBoxCenter,u)},h={selection:Al(f.selection,l.scroll.current),borderBoxCenter:Al(f.borderBoxCenter,l.scroll.current),offset:Al(f.offset,l.scroll.diff.value)},m={client:f,page:h};if(t.phase==="COLLECTING")return Wa({phase:"COLLECTING"},t,{dimensions:c,viewport:l,current:m});var x=c.draggables[t.critical.draggable.id],g=o||Ase({pageOffset:h.offset,draggable:x,draggables:c.draggables,droppables:c.droppables,previousImpact:t.impact,viewport:l,afterCritical:t.afterCritical}),v=Gtt({draggable:x,impact:g,previousImpact:t.impact,draggables:c.draggables,droppables:c.droppables}),y=Wa({},t,{current:m,dimensions:{draggables:c.draggables,droppables:v},impact:g,viewport:l,scrollJumpRequest:i||null,forceShouldAnimate:i?!1:null});return y};function Ktt(e,t){return e.map(function(r){return t[r]})}var Ese=function(e){var t=e.impact,r=e.viewport,n=e.draggables,s=e.destination,o=e.forceShouldAnimate,i=t.displaced,l=Ktt(i.all,n),c=B1({afterDragging:l,destination:s,displacedBy:t.displacedBy,viewport:r.frame,forceShouldAnimate:o,last:i});return Wa({},t,{displaced:c})},kse=function(e){var t=e.impact,r=e.draggable,n=e.droppable,s=e.draggables,o=e.viewport,i=e.afterCritical,l=BP({impact:t,draggable:r,draggables:s,droppable:n,afterCritical:i});return sF({pageBorderBoxCenter:l,draggable:r,viewport:o})},Ise=function(e){var t=e.state,r=e.dimensions,n=e.viewport;t.movementMode!=="SNAP"&&Vn(!1);var s=t.impact,o=n||t.viewport,i=r||t.dimensions,l=i.draggables,c=i.droppables,d=l[t.critical.draggable.id],u=Dd(s);u||Vn(!1);var f=c[u],h=Ese({impact:s,viewport:o,destination:f,draggables:l}),m=kse({impact:h,draggable:d,droppable:f,draggables:l,viewport:o,afterCritical:t.afterCritical});return dw({impact:h,clientSelection:m,state:t,dimensions:i,viewport:o})},Xtt=function(e){return{index:e.index,droppableId:e.droppableId}},Ose=function(e){var t=e.draggable,r=e.home,n=e.draggables,s=e.viewport,o=Dj(r.axis,t.displaceBy),i=Ey(r.descriptor.id,n),l=i.indexOf(t);l===-1&&Vn(!1);var c=i.slice(l+1),d=c.reduce(function(m,x){return m[x.descriptor.id]=!0,m},{}),u={inVirtualList:r.descriptor.mode==="virtual",displacedBy:o,effected:d},f=B1({afterDragging:c,destination:r,displacedBy:o,last:null,viewport:s.frame,forceShouldAnimate:!1}),h={displaced:f,displacedBy:o,at:{type:"REORDER",destination:Xtt(t.descriptor)}};return{impact:h,afterCritical:u}},Ytt=function(e,t){return{draggables:e.draggables,droppables:oF(e.droppables,t)}},Jtt=function(e){var t=e.draggable,r=e.offset,n=e.initialWindowScroll,s=iC(t.client,r),o=lC(s,n),i=Wa({},t,{placeholder:Wa({},t.placeholder,{client:s}),client:s,page:o});return i},Qtt=function(e){var t=e.frame;return t||Vn(!1),t},Ztt=function(e){var t=e.additions,r=e.updatedDroppables,n=e.viewport,s=n.scroll.diff.value;return t.map(function(o){var i=o.descriptor.droppableId,l=r[i],c=Qtt(l),d=c.scroll.diff.value,u=Al(s,d),f=Jtt({draggable:o,offset:u,initialWindowScroll:n.scroll.initial});return f})},ert=function(e){var t=e.state,r=e.published,n=r.modified.map(function(w){var j=t.dimensions.droppables[w.droppableId],_=ZR(j,w.scroll);return _}),s=Wa({},t.dimensions.droppables,{},hse(n)),o=pse(Ztt({additions:r.additions,updatedDroppables:s,viewport:t.viewport})),i=Wa({},t.dimensions.draggables,{},o);r.removals.forEach(function(w){delete i[w]});var l={droppables:s,draggables:i},c=Dd(t.impact),d=c?l.droppables[c]:null,u=l.draggables[t.critical.draggable.id],f=l.droppables[t.critical.droppable.id],h=Ose({draggable:u,home:f,draggables:i,viewport:t.viewport}),m=h.impact,x=h.afterCritical,g=d&&d.isCombineEnabled?t.impact:m,v=Ase({pageOffset:t.current.page.offset,draggable:l.draggables[t.critical.draggable.id],draggables:l.draggables,droppables:l.droppables,previousImpact:g,viewport:t.viewport,afterCritical:x}),y=Wa({phase:"DRAGGING"},t,{phase:"DRAGGING",impact:v,onLiftImpact:m,dimensions:l,afterCritical:x,forceShouldAnimate:!1});if(t.phase==="COLLECTING")return y;var b=Wa({phase:"DROP_PENDING"},y,{phase:"DROP_PENDING",reason:t.reason,isWaiting:!1});return b},T3=function(t){return t.movementMode==="SNAP"},Sk=function(t,r,n){var s=Ytt(t.dimensions,r);return!T3(t)||n?dw({state:t,dimensions:s}):Ise({state:t,dimensions:s})};function Ck(e){return e.isDragging&&e.movementMode==="SNAP"?Wa({phase:"DRAGGING"},e,{scrollJumpRequest:null}):e}var GU={phase:"IDLE",completed:null,shouldFlush:!1},trt=function(e,t){if(e===void 0&&(e=GU),t.type==="FLUSH")return Wa({},GU,{shouldFlush:!0});if(t.type==="INITIAL_PUBLISH"){e.phase!=="IDLE"&&Vn(!1);var r=t.payload,n=r.critical,s=r.clientSelection,o=r.viewport,i=r.dimensions,l=r.movementMode,c=i.draggables[n.draggable.id],d=i.droppables[n.droppable.id],u={selection:s,borderBoxCenter:c.client.borderBox.center,offset:fl},f={client:u,page:{selection:Al(u.selection,o.scroll.initial),borderBoxCenter:Al(u.selection,o.scroll.initial),offset:Al(u.selection,o.scroll.diff.value)}},h=FP(i.droppables).every(function(ae){return!ae.isFixedOnPage}),m=Ose({draggable:c,home:d,draggables:i.draggables,viewport:o}),x=m.impact,g=m.afterCritical,v={phase:"DRAGGING",isDragging:!0,critical:n,movementMode:l,dimensions:i,initial:f,current:f,isWindowScrollAllowed:h,impact:x,afterCritical:g,onLiftImpact:x,viewport:o,scrollJumpRequest:null,forceShouldAnimate:null};return v}if(t.type==="COLLECTION_STARTING"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&Vn(!1);var y=Wa({phase:"COLLECTING"},e,{phase:"COLLECTING"});return y}if(t.type==="PUBLISH_WHILE_DRAGGING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"||Vn(!1),ert({state:e,published:t.payload});if(t.type==="MOVE"){if(e.phase==="DROP_PENDING")return e;cg(e)||Vn(!1);var b=t.payload.client;return up(b,e.current.client.selection)?e:dw({state:e,clientSelection:b,impact:T3(e)?e.impact:null})}if(t.type==="UPDATE_DROPPABLE_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="COLLECTING")return Ck(e);cg(e)||Vn(!1);var w=t.payload,j=w.id,_=w.newScroll,C=e.dimensions.droppables[j];if(!C)return e;var A=ZR(C,_);return Sk(e,A,!1)}if(t.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(e.phase==="DROP_PENDING")return e;cg(e)||Vn(!1);var S=t.payload,P=S.id,M=S.isEnabled,O=e.dimensions.droppables[P];O||Vn(!1),O.isEnabled===M&&Vn(!1);var I=Wa({},O,{isEnabled:M});return Sk(e,I,!0)}if(t.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(e.phase==="DROP_PENDING")return e;cg(e)||Vn(!1);var T=t.payload,k=T.id,$=T.isCombineEnabled,q=e.dimensions.droppables[k];q||Vn(!1),q.isCombineEnabled===$&&Vn(!1);var z=Wa({},q,{isCombineEnabled:$});return Sk(e,z,!0)}if(t.type==="MOVE_BY_WINDOW_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="DROP_ANIMATING")return e;cg(e)||Vn(!1),e.isWindowScrollAllowed||Vn(!1);var F=t.payload.newScroll;if(up(e.viewport.scroll.current,F))return Ck(e);var V=wse(e.viewport,F);return T3(e)?Ise({state:e,viewport:V}):dw({state:e,viewport:V})}if(t.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!cg(e))return e;var ue=t.payload.maxScroll;if(up(ue,e.viewport.scroll.max))return e;var _e=Wa({},e.viewport,{scroll:Wa({},e.viewport.scroll,{max:ue})});return Wa({phase:"DRAGGING"},e,{viewport:_e})}if(t.type==="MOVE_UP"||t.type==="MOVE_DOWN"||t.type==="MOVE_LEFT"||t.type==="MOVE_RIGHT"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&Vn(!1);var U=Ftt({state:e,type:t.type});return U?dw({state:e,impact:U.impact,clientSelection:U.clientSelection,scrollJumpRequest:U.scrollJumpRequest}):e}if(t.type==="DROP_PENDING"){var L=t.payload.reason;e.phase!=="COLLECTING"&&Vn(!1);var G=Wa({phase:"DROP_PENDING"},e,{phase:"DROP_PENDING",isWaiting:!0,reason:L});return G}if(t.type==="DROP_ANIMATE"){var de=t.payload,X=de.completed,W=de.dropDuration,Y=de.newHomeClientOffset;e.phase==="DRAGGING"||e.phase==="DROP_PENDING"||Vn(!1);var me={phase:"DROP_ANIMATING",completed:X,dropDuration:W,newHomeClientOffset:Y,dimensions:e.dimensions};return me}if(t.type==="DROP_COMPLETE"){var ee=t.payload.completed;return{phase:"IDLE",completed:ee,shouldFlush:!1}}return e},rrt=function(t){return{type:"BEFORE_INITIAL_CAPTURE",payload:t}},nrt=function(t){return{type:"LIFT",payload:t}},art=function(t){return{type:"INITIAL_PUBLISH",payload:t}},srt=function(t){return{type:"PUBLISH_WHILE_DRAGGING",payload:t}},ort=function(){return{type:"COLLECTION_STARTING",payload:null}},irt=function(t){return{type:"UPDATE_DROPPABLE_SCROLL",payload:t}},lrt=function(t){return{type:"UPDATE_DROPPABLE_IS_ENABLED",payload:t}},crt=function(t){return{type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:t}},Tse=function(t){return{type:"MOVE",payload:t}},drt=function(t){return{type:"MOVE_BY_WINDOW_SCROLL",payload:t}},urt=function(t){return{type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:t}},frt=function(){return{type:"MOVE_UP",payload:null}},mrt=function(){return{type:"MOVE_DOWN",payload:null}},hrt=function(){return{type:"MOVE_RIGHT",payload:null}},prt=function(){return{type:"MOVE_LEFT",payload:null}},iF=function(){return{type:"FLUSH",payload:null}},grt=function(t){return{type:"DROP_ANIMATE",payload:t}},lF=function(t){return{type:"DROP_COMPLETE",payload:t}},Dse=function(t){return{type:"DROP",payload:t}},xrt=function(t){return{type:"DROP_PENDING",payload:t}},Mse=function(){return{type:"DROP_ANIMATION_FINISHED",payload:null}},vrt=function(e){return function(t){var r=t.getState,n=t.dispatch;return function(s){return function(o){if(o.type!=="LIFT"){s(o);return}var i=o.payload,l=i.id,c=i.clientSelection,d=i.movementMode,u=r();u.phase==="DROP_ANIMATING"&&n(lF({completed:u.completed})),r().phase!=="IDLE"&&Vn(!1),n(iF()),n(rrt({draggableId:l,movementMode:d}));var f={shouldPublishImmediately:d==="SNAP"},h={draggableId:l,scrollOptions:f},m=e.startPublishing(h),x=m.critical,g=m.dimensions,v=m.viewport;n(art({critical:x,dimensions:g,clientSelection:c,movementMode:d,viewport:v}))}}}},yrt=function(e){return function(){return function(t){return function(r){r.type==="INITIAL_PUBLISH"&&e.dragging(),r.type==="DROP_ANIMATE"&&e.dropping(r.payload.completed.result.reason),(r.type==="FLUSH"||r.type==="DROP_COMPLETE")&&e.resting(),t(r)}}}},cF={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},q1={opacity:{drop:0,combining:.7},scale:{drop:.75}},dF={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},Jp=dF.outOfTheWay+"s "+cF.outOfTheWay,uw={fluid:"opacity "+Jp,snap:"transform "+Jp+", opacity "+Jp,drop:function(t){var r=t+"s "+cF.drop;return"transform "+r+", opacity "+r},outOfTheWay:"transform "+Jp,placeholder:"height "+Jp+", width "+Jp+", margin "+Jp},KU=function(t){return up(t,fl)?null:"translate("+t.x+"px, "+t.y+"px)"},D3={moveTo:KU,drop:function(t,r){var n=KU(t);return n?r?n+" scale("+q1.scale.drop+")":n:null}},M3=dF.minDropTime,Rse=dF.maxDropTime,brt=Rse-M3,XU=1500,wrt=.6,jrt=function(e){var t=e.current,r=e.destination,n=e.reason,s=L1(t,r);if(s<=0)return M3;if(s>=XU)return Rse;var o=s/XU,i=M3+brt*o,l=n==="CANCEL"?i*wrt:i;return Number(l.toFixed(2))},_rt=function(e){var t=e.impact,r=e.draggable,n=e.dimensions,s=e.viewport,o=e.afterCritical,i=n.draggables,l=n.droppables,c=Dd(t),d=c?l[c]:null,u=l[r.descriptor.droppableId],f=kse({impact:t,draggable:r,draggables:i,afterCritical:o,droppable:d||u,viewport:s}),h=Ad(f,r.client.borderBox.center);return h},Nrt=function(e){var t=e.draggables,r=e.reason,n=e.lastImpact,s=e.home,o=e.viewport,i=e.onLiftImpact;if(!n.at||r!=="DROP"){var l=Ese({draggables:t,impact:i,destination:s,viewport:o,forceShouldAnimate:!0});return{impact:l,didDropInsideDroppable:!1}}if(n.at.type==="REORDER")return{impact:n,didDropInsideDroppable:!0};var c=Wa({},n,{displaced:$1});return{impact:c,didDropInsideDroppable:!0}},Srt=function(e){var t=e.getState,r=e.dispatch;return function(n){return function(s){if(s.type!=="DROP"){n(s);return}var o=t(),i=s.payload.reason;if(o.phase==="COLLECTING"){r(xrt({reason:i}));return}if(o.phase!=="IDLE"){var l=o.phase==="DROP_PENDING"&&o.isWaiting;l&&Vn(!1),o.phase==="DRAGGING"||o.phase==="DROP_PENDING"||Vn(!1);var c=o.critical,d=o.dimensions,u=d.draggables[o.critical.draggable.id],f=Nrt({reason:i,lastImpact:o.impact,afterCritical:o.afterCritical,onLiftImpact:o.onLiftImpact,home:o.dimensions.droppables[o.critical.droppable.id],viewport:o.viewport,draggables:o.dimensions.draggables}),h=f.impact,m=f.didDropInsideDroppable,x=m?tF(h):null,g=m?LP(h):null,v={index:c.draggable.index,droppableId:c.droppable.id},y={draggableId:u.descriptor.id,type:u.descriptor.type,source:v,reason:i,mode:o.movementMode,destination:x,combine:g},b=_rt({impact:h,draggable:u,dimensions:d,viewport:o.viewport,afterCritical:o.afterCritical}),w={critical:o.critical,afterCritical:o.afterCritical,result:y,impact:h},j=!up(o.current.client.offset,b)||!!y.combine;if(!j){r(lF({completed:w}));return}var _=jrt({current:o.current.client.offset,destination:b,reason:i}),C={newHomeClientOffset:b,dropDuration:_,completed:w};r(grt(C))}}}},Fse=function(){return{x:window.pageXOffset,y:window.pageYOffset}};function Crt(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(r){r.target!==window&&r.target!==window.document||e()}}}function Prt(e){var t=e.onWindowScroll;function r(){t(Fse())}var n=F1(r),s=Crt(n),o=dp;function i(){return o!==dp}function l(){i()&&Vn(!1),o=pu(window,[s])}function c(){i()||Vn(!1),n.cancel(),o(),o=dp}return{start:l,stop:c,isActive:i}}var Art=function(t){return t.type==="DROP_COMPLETE"||t.type==="DROP_ANIMATE"||t.type==="FLUSH"},Ert=function(e){var t=Prt({onWindowScroll:function(n){e.dispatch(drt({newScroll:n}))}});return function(r){return function(n){!t.isActive()&&n.type==="INITIAL_PUBLISH"&&t.start(),t.isActive()&&Art(n)&&t.stop(),r(n)}}},krt=function(e){var t=!1,r=!1,n=setTimeout(function(){r=!0}),s=function(i){t||r||(t=!0,e(i),clearTimeout(n))};return s.wasCalled=function(){return t},s},Irt=function(){var e=[],t=function(o){var i=eF(e,function(d){return d.timerId===o});i===-1&&Vn(!1);var l=e.splice(i,1),c=l[0];c.callback()},r=function(o){var i=setTimeout(function(){return t(i)}),l={timerId:i,callback:o};e.push(l)},n=function(){if(e.length){var o=[].concat(e);e.length=0,o.forEach(function(i){clearTimeout(i.timerId),i.callback()})}};return{add:r,flush:n}},Ort=function(t,r){return t==null&&r==null?!0:t==null||r==null?!1:t.droppableId===r.droppableId&&t.index===r.index},Trt=function(t,r){return t==null&&r==null?!0:t==null||r==null?!1:t.draggableId===r.draggableId&&t.droppableId===r.droppableId},Drt=function(t,r){if(t===r)return!0;var n=t.draggable.id===r.draggable.id&&t.draggable.droppableId===r.draggable.droppableId&&t.draggable.type===r.draggable.type&&t.draggable.index===r.draggable.index,s=t.droppable.id===r.droppable.id&&t.droppable.type===r.droppable.type;return n&&s},lb=function(t,r){r()},t_=function(t,r){return{draggableId:t.draggable.id,type:t.droppable.type,source:{droppableId:t.droppable.id,index:t.draggable.index},mode:r}},Pk=function(t,r,n,s){if(!t){n(s(r));return}var o=krt(n),i={announce:o};t(r,i),o.wasCalled()||n(s(r))},Mrt=function(e,t){var r=Irt(),n=null,s=function(h,m){n&&Vn(!1),lb("onBeforeCapture",function(){var x=e().onBeforeCapture;if(x){var g={draggableId:h,mode:m};x(g)}})},o=function(h,m){n&&Vn(!1),lb("onBeforeDragStart",function(){var x=e().onBeforeDragStart;x&&x(t_(h,m))})},i=function(h,m){n&&Vn(!1);var x=t_(h,m);n={mode:m,lastCritical:h,lastLocation:x.source,lastCombine:null},r.add(function(){lb("onDragStart",function(){return Pk(e().onDragStart,x,t,U_.onDragStart)})})},l=function(h,m){var x=tF(m),g=LP(m);n||Vn(!1);var v=!Drt(h,n.lastCritical);v&&(n.lastCritical=h);var y=!Ort(n.lastLocation,x);y&&(n.lastLocation=x);var b=!Trt(n.lastCombine,g);if(b&&(n.lastCombine=g),!(!v&&!y&&!b)){var w=Wa({},t_(h,n.mode),{combine:g,destination:x});r.add(function(){lb("onDragUpdate",function(){return Pk(e().onDragUpdate,w,t,U_.onDragUpdate)})})}},c=function(){n||Vn(!1),r.flush()},d=function(h){n||Vn(!1),n=null,lb("onDragEnd",function(){return Pk(e().onDragEnd,h,t,U_.onDragEnd)})},u=function(){if(n){var h=Wa({},t_(n.lastCritical,n.mode),{combine:null,destination:null,reason:"CANCEL"});d(h)}};return{beforeCapture:s,beforeStart:o,start:i,update:l,flush:c,drop:d,abort:u}},Rrt=function(e,t){var r=Mrt(e,t);return function(n){return function(s){return function(o){if(o.type==="BEFORE_INITIAL_CAPTURE"){r.beforeCapture(o.payload.draggableId,o.payload.movementMode);return}if(o.type==="INITIAL_PUBLISH"){var i=o.payload.critical;r.beforeStart(i,o.payload.movementMode),s(o),r.start(i,o.payload.movementMode);return}if(o.type==="DROP_COMPLETE"){var l=o.payload.completed.result;r.flush(),s(o),r.drop(l);return}if(s(o),o.type==="FLUSH"){r.abort();return}var c=n.getState();c.phase==="DRAGGING"&&r.update(c.critical,c.impact)}}}},Frt=function(e){return function(t){return function(r){if(r.type!=="DROP_ANIMATION_FINISHED"){t(r);return}var n=e.getState();n.phase!=="DROP_ANIMATING"&&Vn(!1),e.dispatch(lF({completed:n.completed}))}}},Lrt=function(e){var t=null,r=null;function n(){r&&(cancelAnimationFrame(r),r=null),t&&(t(),t=null)}return function(s){return function(o){if((o.type==="FLUSH"||o.type==="DROP_COMPLETE"||o.type==="DROP_ANIMATION_FINISHED")&&n(),s(o),o.type==="DROP_ANIMATE"){var i={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){var c=e.getState();c.phase==="DROP_ANIMATING"&&e.dispatch(Mse())}};r=requestAnimationFrame(function(){r=null,t=pu(window,[i])})}}}},$rt=function(e){return function(){return function(t){return function(r){(r.type==="DROP_COMPLETE"||r.type==="FLUSH"||r.type==="DROP_ANIMATE")&&e.stopPublishing(),t(r)}}}},Brt=function(e){var t=!1;return function(){return function(r){return function(n){if(n.type==="INITIAL_PUBLISH"){t=!0,e.tryRecordFocus(n.payload.critical.draggable.id),r(n),e.tryRestoreFocusRecorded();return}if(r(n),!!t){if(n.type==="FLUSH"){t=!1,e.tryRestoreFocusRecorded();return}if(n.type==="DROP_COMPLETE"){t=!1;var s=n.payload.completed.result;s.combine&&e.tryShiftRecord(s.draggableId,s.combine.draggableId),e.tryRestoreFocusRecorded()}}}}}},qrt=function(t){return t.type==="DROP_COMPLETE"||t.type==="DROP_ANIMATE"||t.type==="FLUSH"},zrt=function(e){return function(t){return function(r){return function(n){if(qrt(n)){e.stop(),r(n);return}if(n.type==="INITIAL_PUBLISH"){r(n);var s=t.getState();s.phase!=="DRAGGING"&&Vn(!1),e.start(s);return}r(n),e.scroll(t.getState())}}}},Urt=function(e){return function(t){return function(r){if(t(r),r.type==="PUBLISH_WHILE_DRAGGING"){var n=e.getState();n.phase==="DROP_PENDING"&&(n.isWaiting||e.dispatch(Dse({reason:n.reason})))}}}},Vrt=Uae,Wrt=function(e){var t=e.dimensionMarshal,r=e.focusMarshal,n=e.styleMarshal,s=e.getResponders,o=e.announce,i=e.autoScroller;return zae(trt,Vrt(kZe(yrt(n),$rt(t),vrt(t),Srt,Frt,Lrt,Urt,zrt(i),Ert,Brt(r),Rrt(s,o))))},Ak=function(){return{additions:{},removals:{},modified:{}}};function Hrt(e){var t=e.registry,r=e.callbacks,n=Ak(),s=null,o=function(){s||(r.collectionStarting(),s=requestAnimationFrame(function(){s=null;var u=n,f=u.additions,h=u.removals,m=u.modified,x=Object.keys(f).map(function(y){return t.draggable.getById(y).getDimension(fl)}).sort(function(y,b){return y.descriptor.index-b.descriptor.index}),g=Object.keys(m).map(function(y){var b=t.droppable.getById(y),w=b.callbacks.getScrollWhileDragging();return{droppableId:y,scroll:w}}),v={additions:x,removals:Object.keys(h),modified:g};n=Ak(),r.publish(v)}))},i=function(u){var f=u.descriptor.id;n.additions[f]=u,n.modified[u.descriptor.droppableId]=!0,n.removals[f]&&delete n.removals[f],o()},l=function(u){var f=u.descriptor;n.removals[f.id]=!0,n.modified[f.droppableId]=!0,n.additions[f.id]&&delete n.additions[f.id],o()},c=function(){s&&(cancelAnimationFrame(s),s=null,n=Ak())};return{add:i,remove:l,stop:c}}var Lse=function(e){var t=e.scrollHeight,r=e.scrollWidth,n=e.height,s=e.width,o=Ad({x:r,y:t},{x:s,y:n}),i={x:Math.max(0,o.x),y:Math.max(0,o.y)};return i},$se=function(){var e=document.documentElement;return e||Vn(!1),e},Bse=function(){var e=$se(),t=Lse({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight});return t},Grt=function(){var e=Fse(),t=Bse(),r=e.y,n=e.x,s=$se(),o=s.clientWidth,i=s.clientHeight,l=n+o,c=r+i,d=Zu({top:r,left:n,right:l,bottom:c}),u={frame:d,scroll:{initial:e,current:e,max:t,diff:{value:fl,displacement:fl}}};return u},Krt=function(e){var t=e.critical,r=e.scrollOptions,n=e.registry,s=Grt(),o=s.scroll.current,i=t.droppable,l=n.droppable.getAllByType(i.type).map(function(f){return f.callbacks.getDimensionAndWatchScroll(o,r)}),c=n.draggable.getAllByType(t.draggable.type).map(function(f){return f.getDimension(o)}),d={draggables:pse(c),droppables:hse(l)},u={dimensions:d,critical:t,viewport:s};return u};function YU(e,t,r){if(r.descriptor.id===t.id||r.descriptor.type!==t.type)return!1;var n=e.droppable.getById(r.descriptor.droppableId);return n.descriptor.mode==="virtual"}var Xrt=function(e,t){var r=null,n=Hrt({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),s=function(m,x){e.droppable.exists(m)||Vn(!1),r&&t.updateDroppableIsEnabled({id:m,isEnabled:x})},o=function(m,x){r&&(e.droppable.exists(m)||Vn(!1),t.updateDroppableIsCombineEnabled({id:m,isCombineEnabled:x}))},i=function(m,x){r&&(e.droppable.exists(m)||Vn(!1),t.updateDroppableScroll({id:m,newScroll:x}))},l=function(m,x){r&&e.droppable.getById(m).callbacks.scroll(x)},c=function(){if(r){n.stop();var m=r.critical.droppable;e.droppable.getAllByType(m.type).forEach(function(x){return x.callbacks.dragStopped()}),r.unsubscribe(),r=null}},d=function(m){r||Vn(!1);var x=r.critical.draggable;m.type==="ADDITION"&&YU(e,x,m.value)&&n.add(m.value),m.type==="REMOVAL"&&YU(e,x,m.value)&&n.remove(m.value)},u=function(m){r&&Vn(!1);var x=e.draggable.getById(m.draggableId),g=e.droppable.getById(x.descriptor.droppableId),v={draggable:x.descriptor,droppable:g.descriptor},y=e.subscribe(d);return r={critical:v,unsubscribe:y},Krt({critical:v,registry:e,scrollOptions:m.scrollOptions})},f={updateDroppableIsEnabled:s,updateDroppableIsCombineEnabled:o,scrollDroppable:l,updateDroppableScroll:i,startPublishing:u,stopPublishing:c};return f},qse=function(e,t){return e.phase==="IDLE"?!0:e.phase!=="DROP_ANIMATING"||e.completed.result.draggableId===t?!1:e.completed.result.reason==="DROP"},Yrt=function(e){window.scrollBy(e.x,e.y)},Jrt=ul(function(e){return FP(e).filter(function(t){return!(!t.isEnabled||!t.frame)})}),Qrt=function(t,r){var n=Bp(Jrt(r),function(s){return s.frame||Vn(!1),Sse(s.frame.pageMarginBox)(t)});return n},Zrt=function(e){var t=e.center,r=e.destination,n=e.droppables;if(r){var s=n[r];return s.frame?s:null}var o=Qrt(t,n);return o},fp={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:function(t){return Math.pow(t,2)},durationDampening:{stopDampeningAt:1200,accelerateAt:360}},ent=function(e,t){var r=e[t.size]*fp.startFromPercentage,n=e[t.size]*fp.maxScrollAtPercentage,s={startScrollingFrom:r,maxScrollValueAt:n};return s},zse=function(e){var t=e.startOfRange,r=e.endOfRange,n=e.current,s=r-t;if(s===0)return 0;var o=n-t,i=o/s;return i},uF=1,tnt=function(e,t){if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return fp.maxPixelScroll;if(e===t.startScrollingFrom)return uF;var r=zse({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),n=1-r,s=fp.maxPixelScroll*fp.ease(n);return Math.ceil(s)},JU=fp.durationDampening.accelerateAt,QU=fp.durationDampening.stopDampeningAt,rnt=function(e,t){var r=t,n=QU,s=Date.now(),o=s-r;if(o>=QU)return e;if(o<JU)return uF;var i=zse({startOfRange:JU,endOfRange:n,current:o}),l=e*fp.ease(i);return Math.ceil(l)},ZU=function(e){var t=e.distanceToEdge,r=e.thresholds,n=e.dragStartTime,s=e.shouldUseTimeDampening,o=tnt(t,r);return o===0?0:s?Math.max(rnt(o,n),uF):o},eV=function(e){var t=e.container,r=e.distanceToEdges,n=e.dragStartTime,s=e.axis,o=e.shouldUseTimeDampening,i=ent(t,s),l=r[s.end]<r[s.start];return l?ZU({distanceToEdge:r[s.end],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o}):-1*ZU({distanceToEdge:r[s.start],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o})},nnt=function(e){var t=e.container,r=e.subject,n=e.proposedScroll,s=r.height>t.height,o=r.width>t.width;return!o&&!s?n:o&&s?null:{x:o?0:n.x,y:s?0:n.y}},ant=fse(function(e){return e===0?0:e}),Use=function(e){var t=e.dragStartTime,r=e.container,n=e.subject,s=e.center,o=e.shouldUseTimeDampening,i={top:s.y-r.top,right:r.right-s.x,bottom:r.bottom-s.y,left:s.x-r.left},l=eV({container:r,distanceToEdges:i,dragStartTime:t,axis:rF,shouldUseTimeDampening:o}),c=eV({container:r,distanceToEdges:i,dragStartTime:t,axis:vse,shouldUseTimeDampening:o}),d=ant({x:c,y:l});if(up(d,fl))return null;var u=nnt({container:r,subject:n,proposedScroll:d});return u?up(u,fl)?null:u:null},snt=fse(function(e){return e===0?0:e>0?1:-1}),fF=function(){var e=function(r,n){return r<0?r:r>n?r-n:0};return function(t){var r=t.current,n=t.max,s=t.change,o=Al(r,s),i={x:e(o.x,n.x),y:e(o.y,n.y)};return up(i,fl)?null:i}}(),Vse=function(t){var r=t.max,n=t.current,s=t.change,o={x:Math.max(n.x,r.x),y:Math.max(n.y,r.y)},i=snt(s),l=fF({max:o,current:n,change:i});return!l||i.x!==0&&l.x===0||i.y!==0&&l.y===0},mF=function(t,r){return Vse({current:t.scroll.current,max:t.scroll.max,change:r})},ont=function(t,r){if(!mF(t,r))return null;var n=t.scroll.max,s=t.scroll.current;return fF({current:s,max:n,change:r})},hF=function(t,r){var n=t.frame;return n?Vse({current:n.scroll.current,max:n.scroll.max,change:r}):!1},int=function(t,r){var n=t.frame;return!n||!hF(t,r)?null:fF({current:n.scroll.current,max:n.scroll.max,change:r})},lnt=function(e){var t=e.viewport,r=e.subject,n=e.center,s=e.dragStartTime,o=e.shouldUseTimeDampening,i=Use({dragStartTime:s,container:t.frame,subject:r,center:n,shouldUseTimeDampening:o});return i&&mF(t,i)?i:null},cnt=function(e){var t=e.droppable,r=e.subject,n=e.center,s=e.dragStartTime,o=e.shouldUseTimeDampening,i=t.frame;if(!i)return null;var l=Use({dragStartTime:s,container:i.pageMarginBox,subject:r,center:n,shouldUseTimeDampening:o});return l&&hF(t,l)?l:null},tV=function(e){var t=e.state,r=e.dragStartTime,n=e.shouldUseTimeDampening,s=e.scrollWindow,o=e.scrollDroppable,i=t.current.page.borderBoxCenter,l=t.dimensions.draggables[t.critical.draggable.id],c=l.page.marginBox;if(t.isWindowScrollAllowed){var d=t.viewport,u=lnt({dragStartTime:r,viewport:d,subject:c,center:i,shouldUseTimeDampening:n});if(u){s(u);return}}var f=Zrt({center:i,destination:Dd(t.impact),droppables:t.dimensions.droppables});if(f){var h=cnt({dragStartTime:r,droppable:f,subject:c,center:i,shouldUseTimeDampening:n});h&&o(f.descriptor.id,h)}},dnt=function(e){var t=e.scrollWindow,r=e.scrollDroppable,n=F1(t),s=F1(r),o=null,i=function(u){o||Vn(!1);var f=o,h=f.shouldUseTimeDampening,m=f.dragStartTime;tV({state:u,scrollWindow:n,scrollDroppable:s,dragStartTime:m,shouldUseTimeDampening:h})},l=function(u){o&&Vn(!1);var f=Date.now(),h=!1,m=function(){h=!0};tV({state:u,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:m,scrollDroppable:m}),o={dragStartTime:f,shouldUseTimeDampening:h},h&&i(u)},c=function(){o&&(n.cancel(),s.cancel(),o=null)};return{start:l,stop:c,scroll:i}},unt=function(e){var t=e.move,r=e.scrollDroppable,n=e.scrollWindow,s=function(d,u){var f=Al(d.current.client.selection,u);t({client:f})},o=function(d,u){if(!hF(d,u))return u;var f=int(d,u);if(!f)return r(d.descriptor.id,u),null;var h=Ad(u,f);r(d.descriptor.id,h);var m=Ad(u,h);return m},i=function(d,u,f){if(!d||!mF(u,f))return f;var h=ont(u,f);if(!h)return n(f),null;var m=Ad(f,h);n(m);var x=Ad(f,m);return x},l=function(d){var u=d.scrollJumpRequest;if(u){var f=Dd(d.impact);f||Vn(!1);var h=o(d.dimensions.droppables[f],u);if(h){var m=d.viewport,x=i(d.isWindowScrollAllowed,m,h);x&&s(d,x)}}};return l},fnt=function(e){var t=e.scrollDroppable,r=e.scrollWindow,n=e.move,s=dnt({scrollWindow:r,scrollDroppable:t}),o=unt({move:n,scrollWindow:r,scrollDroppable:t}),i=function(d){if(d.phase==="DRAGGING"){if(d.movementMode==="FLUID"){s.scroll(d);return}d.scrollJumpRequest&&o(d)}},l={scroll:i,start:s.start,stop:s.stop};return l},X0="data-rbd",Y0=function(){var e=X0+"-drag-handle";return{base:e,draggableId:e+"-draggable-id",contextId:e+"-context-id"}}(),R3=function(){var e=X0+"-draggable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),mnt=function(){var e=X0+"-droppable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),rV={contextId:X0+"-scroll-container-context-id"},hnt=function(t){return function(r){return"["+r+'="'+t+'"]'}},cb=function(t,r){return t.map(function(n){var s=n.styles[r];return s?n.selector+" { "+s+" }":""}).join(" ")},pnt="pointer-events: none;",gnt=function(e){var t=hnt(e),r=function(){var l=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:t(Y0.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:l,dragging:pnt,dropAnimating:l}}}(),n=function(){var l=`
      transition: `+uw.outOfTheWay+`;
    `;return{selector:t(R3.contextId),styles:{dragging:l,dropAnimating:l,userCancel:l}}}(),s={selector:t(mnt.contextId),styles:{always:"overflow-anchor: none;"}},o={selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}},i=[n,r,s,o];return{always:cb(i,"always"),resting:cb(i,"resting"),dragging:cb(i,"dragging"),dropAnimating:cb(i,"dropAnimating"),userCancel:cb(i,"userCancel")}},Md=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?p.useLayoutEffect:p.useEffect,Ek=function(){var t=document.querySelector("head");return t||Vn(!1),t},nV=function(t){var r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.type="text/css",r};function xnt(e,t){var r=Vs(function(){return gnt(e)},[e]),n=p.useRef(null),s=p.useRef(null),o=Ma(ul(function(f){var h=s.current;h||Vn(!1),h.textContent=f}),[]),i=Ma(function(f){var h=n.current;h||Vn(!1),h.textContent=f},[]);Md(function(){!n.current&&!s.current||Vn(!1);var f=nV(t),h=nV(t);return n.current=f,s.current=h,f.setAttribute(X0+"-always",e),h.setAttribute(X0+"-dynamic",e),Ek().appendChild(f),Ek().appendChild(h),i(r.always),o(r.resting),function(){var m=function(g){var v=g.current;v||Vn(!1),Ek().removeChild(v),g.current=null};m(n),m(s)}},[t,i,o,r.always,r.resting,e]);var l=Ma(function(){return o(r.dragging)},[o,r.dragging]),c=Ma(function(f){if(f==="DROP"){o(r.dropAnimating);return}o(r.userCancel)},[o,r.dropAnimating,r.userCancel]),d=Ma(function(){s.current&&o(r.resting)},[o,r.resting]),u=Vs(function(){return{dragging:l,dropping:c,resting:d}},[l,c,d]);return u}var Wse=function(e){return e&&e.ownerDocument?e.ownerDocument.defaultView:window};function qP(e){return e instanceof Wse(e).HTMLElement}function vnt(e,t){var r="["+Y0.contextId+'="'+e+'"]',n=mse(document.querySelectorAll(r));if(!n.length)return null;var s=Bp(n,function(o){return o.getAttribute(Y0.draggableId)===t});return!s||!qP(s)?null:s}function ynt(e){var t=p.useRef({}),r=p.useRef(null),n=p.useRef(null),s=p.useRef(!1),o=Ma(function(h,m){var x={id:h,focus:m};return t.current[h]=x,function(){var v=t.current,y=v[h];y!==x&&delete v[h]}},[]),i=Ma(function(h){var m=vnt(e,h);m&&m!==document.activeElement&&m.focus()},[e]),l=Ma(function(h,m){r.current===h&&(r.current=m)},[]),c=Ma(function(){n.current||s.current&&(n.current=requestAnimationFrame(function(){n.current=null;var h=r.current;h&&i(h)}))},[i]),d=Ma(function(h){r.current=null;var m=document.activeElement;m&&m.getAttribute(Y0.draggableId)===h&&(r.current=h)},[]);Md(function(){return s.current=!0,function(){s.current=!1;var h=n.current;h&&cancelAnimationFrame(h)}},[]);var u=Vs(function(){return{register:o,tryRecordFocus:d,tryRestoreFocusRecorded:c,tryShiftRecord:l}},[o,d,c,l]);return u}function bnt(){var e={draggables:{},droppables:{}},t=[];function r(f){return t.push(f),function(){var m=t.indexOf(f);m!==-1&&t.splice(m,1)}}function n(f){t.length&&t.forEach(function(h){return h(f)})}function s(f){return e.draggables[f]||null}function o(f){var h=s(f);return h||Vn(!1),h}var i={register:function(h){e.draggables[h.descriptor.id]=h,n({type:"ADDITION",value:h})},update:function(h,m){var x=e.draggables[m.descriptor.id];x&&x.uniqueId===h.uniqueId&&(delete e.draggables[m.descriptor.id],e.draggables[h.descriptor.id]=h)},unregister:function(h){var m=h.descriptor.id,x=s(m);x&&h.uniqueId===x.uniqueId&&(delete e.draggables[m],n({type:"REMOVAL",value:h}))},getById:o,findById:s,exists:function(h){return!!s(h)},getAllByType:function(h){return uC(e.draggables).filter(function(m){return m.descriptor.type===h})}};function l(f){return e.droppables[f]||null}function c(f){var h=l(f);return h||Vn(!1),h}var d={register:function(h){e.droppables[h.descriptor.id]=h},unregister:function(h){var m=l(h.descriptor.id);m&&h.uniqueId===m.uniqueId&&delete e.droppables[h.descriptor.id]},getById:c,findById:l,exists:function(h){return!!l(h)},getAllByType:function(h){return uC(e.droppables).filter(function(m){return m.descriptor.type===h})}};function u(){e.draggables={},e.droppables={},t.length=0}return{draggable:i,droppable:d,subscribe:r,clean:u}}function wnt(){var e=Vs(bnt,[]);return p.useEffect(function(){return function(){requestAnimationFrame(e.clean)}},[e]),e}var pF=Ce.createContext(null),mC=function(){var e=document.body;return e||Vn(!1),e},jnt={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},_nt=function(t){return"rbd-announcement-"+t};function Nnt(e){var t=Vs(function(){return _nt(e)},[e]),r=p.useRef(null);p.useEffect(function(){var o=document.createElement("div");return r.current=o,o.id=t,o.setAttribute("aria-live","assertive"),o.setAttribute("aria-atomic","true"),Wa(o.style,jnt),mC().appendChild(o),function(){setTimeout(function(){var c=mC();c.contains(o)&&c.removeChild(o),o===r.current&&(r.current=null)})}},[t]);var n=Ma(function(s){var o=r.current;if(o){o.textContent=s;return}},[]);return n}var Snt=0,Cnt={separator:"::"};function gF(e,t){return t===void 0&&(t=Cnt),Vs(function(){return""+e+t.separator+Snt++},[t.separator,e])}function Pnt(e){var t=e.contextId,r=e.uniqueId;return"rbd-hidden-text-"+t+"-"+r}function Ant(e){var t=e.contextId,r=e.text,n=gF("hidden-text",{separator:"-"}),s=Vs(function(){return Pnt({contextId:t,uniqueId:n})},[n,t]);return p.useEffect(function(){var i=document.createElement("div");return i.id=s,i.textContent=r,i.style.display="none",mC().appendChild(i),function(){var c=mC();c.contains(i)&&c.removeChild(i)}},[s,r]),s}var zP=Ce.createContext(null);function Hse(e){var t=p.useRef(e);return p.useEffect(function(){t.current=e}),t}function Ent(){var e=null;function t(){return!!e}function r(i){return i===e}function n(i){e&&Vn(!1);var l={abandon:i};return e=l,l}function s(){e||Vn(!1),e=null}function o(){e&&(e.abandon(),s())}return{isClaimed:t,isActive:r,claim:n,release:s,tryAbandon:o}}var knt=9,Int=13,xF=27,Gse=32,Ont=33,Tnt=34,Dnt=35,Mnt=36,Rnt=37,Fnt=38,Lnt=39,$nt=40,r_,Bnt=(r_={},r_[Int]=!0,r_[knt]=!0,r_),Kse=function(e){Bnt[e.keyCode]&&e.preventDefault()},UP=function(){var e="visibilitychange";if(typeof document>"u")return e;var t=[e,"ms"+e,"webkit"+e,"moz"+e,"o"+e],r=Bp(t,function(n){return"on"+n in document});return r||e}(),Xse=0,aV=5;function qnt(e,t){return Math.abs(t.x-e.x)>=aV||Math.abs(t.y-e.y)>=aV}var sV={type:"IDLE"};function znt(e){var t=e.cancel,r=e.completed,n=e.getPhase,s=e.setPhase;return[{eventName:"mousemove",fn:function(i){var l=i.button,c=i.clientX,d=i.clientY;if(l===Xse){var u={x:c,y:d},f=n();if(f.type==="DRAGGING"){i.preventDefault(),f.actions.move(u);return}f.type!=="PENDING"&&Vn(!1);var h=f.point;if(qnt(h,u)){i.preventDefault();var m=f.actions.fluidLift(u);s({type:"DRAGGING",actions:m})}}}},{eventName:"mouseup",fn:function(i){var l=n();if(l.type!=="DRAGGING"){t();return}i.preventDefault(),l.actions.drop({shouldBlockNextClick:!0}),r()}},{eventName:"mousedown",fn:function(i){n().type==="DRAGGING"&&i.preventDefault(),t()}},{eventName:"keydown",fn:function(i){var l=n();if(l.type==="PENDING"){t();return}if(i.keyCode===xF){i.preventDefault(),t();return}Kse(i)}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(){n().type==="PENDING"&&t()}},{eventName:"webkitmouseforcedown",fn:function(i){var l=n();if(l.type==="IDLE"&&Vn(!1),l.actions.shouldRespectForcePress()){t();return}i.preventDefault()}},{eventName:UP,fn:t}]}function Unt(e){var t=p.useRef(sV),r=p.useRef(dp),n=Vs(function(){return{eventName:"mousedown",fn:function(f){if(!f.defaultPrevented&&f.button===Xse&&!(f.ctrlKey||f.metaKey||f.shiftKey||f.altKey)){var h=e.findClosestDraggableId(f);if(h){var m=e.tryGetLock(h,i,{sourceEvent:f});if(m){f.preventDefault();var x={x:f.clientX,y:f.clientY};r.current(),d(m,x)}}}}}},[e]),s=Vs(function(){return{eventName:"webkitmouseforcewillbegin",fn:function(f){if(!f.defaultPrevented){var h=e.findClosestDraggableId(f);if(h){var m=e.findOptionsForDraggable(h);m&&(m.shouldRespectForcePress||e.canGetLock(h)&&f.preventDefault())}}}}},[e]),o=Ma(function(){var f={passive:!1,capture:!0};r.current=pu(window,[s,n],f)},[s,n]),i=Ma(function(){var u=t.current;u.type!=="IDLE"&&(t.current=sV,r.current(),o())},[o]),l=Ma(function(){var u=t.current;i(),u.type==="DRAGGING"&&u.actions.cancel({shouldBlockNextClick:!0}),u.type==="PENDING"&&u.actions.abort()},[i]),c=Ma(function(){var f={capture:!0,passive:!1},h=znt({cancel:l,completed:i,getPhase:function(){return t.current},setPhase:function(x){t.current=x}});r.current=pu(window,h,f)},[l,i]),d=Ma(function(f,h){t.current.type!=="IDLE"&&Vn(!1),t.current={type:"PENDING",point:h,actions:f},c()},[c]);Md(function(){return o(),function(){r.current()}},[o])}var ev;function Vnt(){}var Wnt=(ev={},ev[Tnt]=!0,ev[Ont]=!0,ev[Mnt]=!0,ev[Dnt]=!0,ev);function Hnt(e,t){function r(){t(),e.cancel()}function n(){t(),e.drop()}return[{eventName:"keydown",fn:function(o){if(o.keyCode===xF){o.preventDefault(),r();return}if(o.keyCode===Gse){o.preventDefault(),n();return}if(o.keyCode===$nt){o.preventDefault(),e.moveDown();return}if(o.keyCode===Fnt){o.preventDefault(),e.moveUp();return}if(o.keyCode===Lnt){o.preventDefault(),e.moveRight();return}if(o.keyCode===Rnt){o.preventDefault(),e.moveLeft();return}if(Wnt[o.keyCode]){o.preventDefault();return}Kse(o)}},{eventName:"mousedown",fn:r},{eventName:"mouseup",fn:r},{eventName:"click",fn:r},{eventName:"touchstart",fn:r},{eventName:"resize",fn:r},{eventName:"wheel",fn:r,options:{passive:!0}},{eventName:UP,fn:r}]}function Gnt(e){var t=p.useRef(Vnt),r=Vs(function(){return{eventName:"keydown",fn:function(o){if(o.defaultPrevented||o.keyCode!==Gse)return;var i=e.findClosestDraggableId(o);if(!i)return;var l=e.tryGetLock(i,u,{sourceEvent:o});if(!l)return;o.preventDefault();var c=!0,d=l.snapLift();t.current();function u(){c||Vn(!1),c=!1,t.current(),n()}t.current=pu(window,Hnt(d,u),{capture:!0,passive:!1})}}},[e]),n=Ma(function(){var o={passive:!1,capture:!0};t.current=pu(window,[r],o)},[r]);Md(function(){return n(),function(){t.current()}},[n])}var kk={type:"IDLE"},Knt=120,Xnt=.15;function Ynt(e){var t=e.cancel,r=e.getPhase;return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:function(s){s.preventDefault()}},{eventName:"keydown",fn:function(s){if(r().type!=="DRAGGING"){t();return}s.keyCode===xF&&s.preventDefault(),t()}},{eventName:UP,fn:t}]}function Jnt(e){var t=e.cancel,r=e.completed,n=e.getPhase;return[{eventName:"touchmove",options:{capture:!1},fn:function(o){var i=n();if(i.type!=="DRAGGING"){t();return}i.hasMoved=!0;var l=o.touches[0],c=l.clientX,d=l.clientY,u={x:c,y:d};o.preventDefault(),i.actions.move(u)}},{eventName:"touchend",fn:function(o){var i=n();if(i.type!=="DRAGGING"){t();return}o.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),r()}},{eventName:"touchcancel",fn:function(o){if(n().type!=="DRAGGING"){t();return}o.preventDefault(),t()}},{eventName:"touchforcechange",fn:function(o){var i=n();i.type==="IDLE"&&Vn(!1);var l=o.touches[0];if(l){var c=l.force>=Xnt;if(c){var d=i.actions.shouldRespectForcePress();if(i.type==="PENDING"){d&&t();return}if(d){if(i.hasMoved){o.preventDefault();return}t();return}o.preventDefault()}}}},{eventName:UP,fn:t}]}function Qnt(e){var t=p.useRef(kk),r=p.useRef(dp),n=Ma(function(){return t.current},[]),s=Ma(function(m){t.current=m},[]),o=Vs(function(){return{eventName:"touchstart",fn:function(m){if(!m.defaultPrevented){var x=e.findClosestDraggableId(m);if(x){var g=e.tryGetLock(x,l,{sourceEvent:m});if(g){var v=m.touches[0],y=v.clientX,b=v.clientY,w={x:y,y:b};r.current(),f(g,w)}}}}}},[e]),i=Ma(function(){var m={capture:!0,passive:!1};r.current=pu(window,[o],m)},[o]),l=Ma(function(){var h=t.current;h.type!=="IDLE"&&(h.type==="PENDING"&&clearTimeout(h.longPressTimerId),s(kk),r.current(),i())},[i,s]),c=Ma(function(){var h=t.current;l(),h.type==="DRAGGING"&&h.actions.cancel({shouldBlockNextClick:!0}),h.type==="PENDING"&&h.actions.abort()},[l]),d=Ma(function(){var m={capture:!0,passive:!1},x={cancel:c,completed:l,getPhase:n},g=pu(window,Jnt(x),m),v=pu(window,Ynt(x),m);r.current=function(){g(),v()}},[c,n,l]),u=Ma(function(){var m=n();m.type!=="PENDING"&&Vn(!1);var x=m.actions.fluidLift(m.point);s({type:"DRAGGING",actions:x,hasMoved:!1})},[n,s]),f=Ma(function(m,x){n().type!=="IDLE"&&Vn(!1);var g=setTimeout(u,Knt);s({type:"PENDING",point:x,actions:m,longPressTimerId:g}),d()},[d,n,s,u]);Md(function(){return i(),function(){r.current();var x=n();x.type==="PENDING"&&(clearTimeout(x.longPressTimerId),s(kk))}},[n,i,s]),Md(function(){var m=pu(window,[{eventName:"touchmove",fn:function(){},options:{capture:!1,passive:!1}}]);return m},[])}var Znt={input:!0,button:!0,textarea:!0,select:!0,option:!0,optgroup:!0,video:!0,audio:!0};function Yse(e,t){if(t==null)return!1;var r=!!Znt[t.tagName.toLowerCase()];if(r)return!0;var n=t.getAttribute("contenteditable");return n==="true"||n===""?!0:t===e?!1:Yse(e,t.parentElement)}function eat(e,t){var r=t.target;return qP(r)?Yse(e,r):!1}var tat=function(e){return Zu(e.getBoundingClientRect()).center};function rat(e){return e instanceof Wse(e).Element}var nat=function(){var e="matches";if(typeof document>"u")return e;var t=[e,"msMatchesSelector","webkitMatchesSelector"],r=Bp(t,function(n){return n in Element.prototype});return r||e}();function Jse(e,t){return e==null?null:e[nat](t)?e:Jse(e.parentElement,t)}function aat(e,t){return e.closest?e.closest(t):Jse(e,t)}function sat(e){return"["+Y0.contextId+'="'+e+'"]'}function oat(e,t){var r=t.target;if(!rat(r))return null;var n=sat(e),s=aat(r,n);return!s||!qP(s)?null:s}function iat(e,t){var r=oat(e,t);return r?r.getAttribute(Y0.draggableId):null}function lat(e,t){var r="["+R3.contextId+'="'+e+'"]',n=mse(document.querySelectorAll(r)),s=Bp(n,function(o){return o.getAttribute(R3.id)===t});return!s||!qP(s)?null:s}function cat(e){e.preventDefault()}function n_(e){var t=e.expected,r=e.phase,n=e.isLockActive;return e.shouldWarn,!(!n()||t!==r)}function Qse(e){var t=e.lockAPI,r=e.store,n=e.registry,s=e.draggableId;if(t.isClaimed())return!1;var o=n.draggable.findById(s);return!(!o||!o.options.isEnabled||!qse(r.getState(),s))}function dat(e){var t=e.lockAPI,r=e.contextId,n=e.store,s=e.registry,o=e.draggableId,i=e.forceSensorStop,l=e.sourceEvent,c=Qse({lockAPI:t,store:n,registry:s,draggableId:o});if(!c)return null;var d=s.draggable.getById(o),u=lat(r,d.descriptor.id);if(!u||l&&!d.options.canDragInteractiveElements&&eat(u,l))return null;var f=t.claim(i||dp),h="PRE_DRAG";function m(){return d.options.shouldRespectForcePress}function x(){return t.isActive(f)}function g(C,A){n_({expected:C,phase:h,isLockActive:x,shouldWarn:!0})&&n.dispatch(A())}var v=g.bind(null,"DRAGGING");function y(C){function A(){t.release(),h="COMPLETED"}h!=="PRE_DRAG"&&(A(),h!=="PRE_DRAG"&&Vn(!1)),n.dispatch(nrt(C.liftActionArgs)),h="DRAGGING";function S(P,M){if(M===void 0&&(M={shouldBlockNextClick:!1}),C.cleanup(),M.shouldBlockNextClick){var O=pu(window,[{eventName:"click",fn:cat,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(O)}A(),n.dispatch(Dse({reason:P}))}return Wa({isActive:function(){return n_({expected:"DRAGGING",phase:h,isLockActive:x,shouldWarn:!1})},shouldRespectForcePress:m,drop:function(M){return S("DROP",M)},cancel:function(M){return S("CANCEL",M)}},C.actions)}function b(C){var A=F1(function(P){v(function(){return Tse({client:P})})}),S=y({liftActionArgs:{id:o,clientSelection:C,movementMode:"FLUID"},cleanup:function(){return A.cancel()},actions:{move:A}});return Wa({},S,{move:A})}function w(){var C={moveUp:function(){return v(frt)},moveRight:function(){return v(hrt)},moveDown:function(){return v(mrt)},moveLeft:function(){return v(prt)}};return y({liftActionArgs:{id:o,clientSelection:tat(u),movementMode:"SNAP"},cleanup:dp,actions:C})}function j(){var C=n_({expected:"PRE_DRAG",phase:h,isLockActive:x,shouldWarn:!0});C&&t.release()}var _={isActive:function(){return n_({expected:"PRE_DRAG",phase:h,isLockActive:x,shouldWarn:!1})},shouldRespectForcePress:m,fluidLift:b,snapLift:w,abort:j};return _}var uat=[Unt,Gnt,Qnt];function fat(e){var t=e.contextId,r=e.store,n=e.registry,s=e.customSensors,o=e.enableDefaultSensors,i=[].concat(o?uat:[],s||[]),l=p.useState(function(){return Ent()})[0],c=Ma(function(b,w){b.isDragging&&!w.isDragging&&l.tryAbandon()},[l]);Md(function(){var b=r.getState(),w=r.subscribe(function(){var j=r.getState();c(b,j),b=j});return w},[l,r,c]),Md(function(){return l.tryAbandon},[l.tryAbandon]);for(var d=Ma(function(y){return Qse({lockAPI:l,registry:n,store:r,draggableId:y})},[l,n,r]),u=Ma(function(y,b,w){return dat({lockAPI:l,registry:n,contextId:t,store:r,draggableId:y,forceSensorStop:b,sourceEvent:w&&w.sourceEvent?w.sourceEvent:null})},[t,l,n,r]),f=Ma(function(y){return iat(t,y)},[t]),h=Ma(function(y){var b=n.draggable.findById(y);return b?b.options:null},[n.draggable]),m=Ma(function(){l.isClaimed()&&(l.tryAbandon(),r.getState().phase!=="IDLE"&&r.dispatch(iF()))},[l,r]),x=Ma(l.isClaimed,[l]),g=Vs(function(){return{canGetLock:d,tryGetLock:u,findClosestDraggableId:f,findOptionsForDraggable:h,tryReleaseLock:m,isLockClaimed:x}},[d,u,f,h,m,x]),v=0;v<i.length;v++)i[v](g)}var mat=function(t){return{onBeforeCapture:t.onBeforeCapture,onBeforeDragStart:t.onBeforeDragStart,onDragStart:t.onDragStart,onDragEnd:t.onDragEnd,onDragUpdate:t.onDragUpdate}};function db(e){return e.current||Vn(!1),e.current}function hat(e){var t=e.contextId,r=e.setCallbacks,n=e.sensors,s=e.nonce,o=e.dragHandleUsageInstructions,i=p.useRef(null),l=Hse(e),c=Ma(function(){return mat(l.current)},[l]),d=Nnt(t),u=Ant({contextId:t,text:o}),f=xnt(t,s),h=Ma(function(P){db(i).dispatch(P)},[]),m=Vs(function(){return AU({publishWhileDragging:srt,updateDroppableScroll:irt,updateDroppableIsEnabled:lrt,updateDroppableIsCombineEnabled:crt,collectionStarting:ort},h)},[h]),x=wnt(),g=Vs(function(){return Xrt(x,m)},[x,m]),v=Vs(function(){return fnt(Wa({scrollWindow:Yrt,scrollDroppable:g.scrollDroppable},AU({move:Tse},h)))},[g.scrollDroppable,h]),y=ynt(t),b=Vs(function(){return Wrt({announce:d,autoScroller:v,dimensionMarshal:g,focusMarshal:y,getResponders:c,styleMarshal:f})},[d,v,g,y,c,f]);i.current=b;var w=Ma(function(){var P=db(i),M=P.getState();M.phase!=="IDLE"&&P.dispatch(iF())},[]),j=Ma(function(){var P=db(i).getState();return P.isDragging||P.phase==="DROP_ANIMATING"},[]),_=Vs(function(){return{isDragging:j,tryAbort:w}},[j,w]);r(_);var C=Ma(function(P){return qse(db(i).getState(),P)},[]),A=Ma(function(){return cg(db(i).getState())},[]),S=Vs(function(){return{marshal:g,focus:y,contextId:t,canLift:C,isMovementAllowed:A,dragHandleUsageInstructionsId:u,registry:x}},[t,g,u,y,C,A,x]);return fat({contextId:t,store:b,registry:x,customSensors:n,enableDefaultSensors:e.enableDefaultSensors!==!1}),p.useEffect(function(){return w},[w]),Ce.createElement(zP.Provider,{value:S},Ce.createElement(MZe,{context:pF,store:b},e.children))}var pat=0;function gat(){return Vs(function(){return""+pat++},[])}function xat(e){var t=gat(),r=e.dragHandleUsageInstructions||U_.dragHandleUsageInstructions;return Ce.createElement(Get,null,function(n){return Ce.createElement(hat,{nonce:e.nonce,contextId:t,setCallbacks:n,dragHandleUsageInstructions:r,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd},e.children)})}var Zse=function(t){return function(r){return t===r}},vat=Zse("scroll"),yat=Zse("auto"),oV=function(t,r){return r(t.overflowX)||r(t.overflowY)},bat=function(t){var r=window.getComputedStyle(t),n={overflowX:r.overflowX,overflowY:r.overflowY};return oV(n,vat)||oV(n,yat)},wat=function(){return!1},jat=function e(t){return t==null?null:t===document.body?wat()?t:null:t===document.documentElement?null:bat(t)?t:e(t.parentElement)},F3=function(e){return{x:e.scrollLeft,y:e.scrollTop}},_at=function e(t){if(!t)return!1;var r=window.getComputedStyle(t);return r.position==="fixed"?!0:e(t.parentElement)},Nat=function(e){var t=jat(e),r=_at(e);return{closestScrollable:t,isFixedOnPage:r}},Sat=function(e){var t=e.descriptor,r=e.isEnabled,n=e.isCombineEnabled,s=e.isFixedOnPage,o=e.direction,i=e.client,l=e.page,c=e.closest,d=function(){if(!c)return null;var m=c.scrollSize,x=c.client,g=Lse({scrollHeight:m.scrollHeight,scrollWidth:m.scrollWidth,height:x.paddingBox.height,width:x.paddingBox.width});return{pageMarginBox:c.page.marginBox,frameClient:x,scrollSize:m,shouldClipSubject:c.shouldClipSubject,scroll:{initial:c.scroll,current:c.scroll,max:g,diff:{value:fl,displacement:fl}}}}(),u=o==="vertical"?rF:vse,f=K0({page:l,withPlaceholder:null,axis:u,frame:d}),h={descriptor:t,isCombineEnabled:n,isFixedOnPage:s,axis:u,isEnabled:r,client:i,page:l,frame:d,subject:f};return h},Cat=function(t,r){var n=lse(t);if(!r||t!==r)return n;var s=n.paddingBox.top-r.scrollTop,o=n.paddingBox.left-r.scrollLeft,i=s+r.scrollHeight,l=o+r.scrollWidth,c={top:s,right:l,bottom:i,left:o},d=JR(c,n.border),u=QR({borderBox:d,margin:n.margin,border:n.border,padding:n.padding});return u},Pat=function(e){var t=e.ref,r=e.descriptor,n=e.env,s=e.windowScroll,o=e.direction,i=e.isDropDisabled,l=e.isCombineEnabled,c=e.shouldClipSubject,d=n.closestScrollable,u=Cat(t,d),f=lC(u,s),h=function(){if(!d)return null;var x=lse(d),g={scrollHeight:d.scrollHeight,scrollWidth:d.scrollWidth};return{client:x,page:lC(x,s),scroll:F3(d),scrollSize:g,shouldClipSubject:c}}(),m=Sat({descriptor:r,isEnabled:!i,isCombineEnabled:l,isFixedOnPage:n.isFixedOnPage,direction:o,client:u,page:f,closest:h});return m},Aat={passive:!1},Eat={passive:!0},iV=function(e){return e.shouldPublishImmediately?Aat:Eat};function hC(e){var t=p.useContext(e);return t||Vn(!1),t}var a_=function(t){return t&&t.env.closestScrollable||null};function kat(e){var t=p.useRef(null),r=hC(zP),n=gF("droppable"),s=r.registry,o=r.marshal,i=Hse(e),l=Vs(function(){return{id:e.droppableId,type:e.type,mode:e.mode}},[e.droppableId,e.mode,e.type]),c=p.useRef(l),d=Vs(function(){return ul(function(j,_){t.current||Vn(!1);var C={x:j,y:_};o.updateDroppableScroll(l.id,C)})},[l.id,o]),u=Ma(function(){var j=t.current;return!j||!j.env.closestScrollable?fl:F3(j.env.closestScrollable)},[]),f=Ma(function(){var j=u();d(j.x,j.y)},[u,d]),h=Vs(function(){return F1(f)},[f]),m=Ma(function(){var j=t.current,_=a_(j);j&&_||Vn(!1);var C=j.scrollOptions;if(C.shouldPublishImmediately){f();return}h()},[h,f]),x=Ma(function(j,_){t.current&&Vn(!1);var C=i.current,A=C.getDroppableRef();A||Vn(!1);var S=Nat(A),P={ref:A,descriptor:l,env:S,scrollOptions:_};t.current=P;var M=Pat({ref:A,descriptor:l,env:S,windowScroll:j,direction:C.direction,isDropDisabled:C.isDropDisabled,isCombineEnabled:C.isCombineEnabled,shouldClipSubject:!C.ignoreContainerClipping}),O=S.closestScrollable;return O&&(O.setAttribute(rV.contextId,r.contextId),O.addEventListener("scroll",m,iV(P.scrollOptions))),M},[r.contextId,l,m,i]),g=Ma(function(){var j=t.current,_=a_(j);return j&&_||Vn(!1),F3(_)},[]),v=Ma(function(){var j=t.current;j||Vn(!1);var _=a_(j);t.current=null,_&&(h.cancel(),_.removeAttribute(rV.contextId),_.removeEventListener("scroll",m,iV(j.scrollOptions)))},[m,h]),y=Ma(function(j){var _=t.current;_||Vn(!1);var C=a_(_);C||Vn(!1),C.scrollTop+=j.y,C.scrollLeft+=j.x},[]),b=Vs(function(){return{getDimensionAndWatchScroll:x,getScrollWhileDragging:g,dragStopped:v,scroll:y}},[v,x,g,y]),w=Vs(function(){return{uniqueId:n,descriptor:l,callbacks:b}},[b,l,n]);Md(function(){return c.current=w.descriptor,s.droppable.register(w),function(){t.current&&v(),s.droppable.unregister(w)}},[b,l,v,w,o,s.droppable]),Md(function(){t.current&&o.updateDroppableIsEnabled(c.current.id,!e.isDropDisabled)},[e.isDropDisabled,o]),Md(function(){t.current&&o.updateDroppableIsCombineEnabled(c.current.id,e.isCombineEnabled)},[e.isCombineEnabled,o])}function Ik(){}var lV={width:0,height:0,margin:Zet},Iat=function(t){var r=t.isAnimatingOpenOnMount,n=t.placeholder,s=t.animate;return r||s==="close"?lV:{height:n.client.borderBox.height,width:n.client.borderBox.width,margin:n.client.margin}},Oat=function(t){var r=t.isAnimatingOpenOnMount,n=t.placeholder,s=t.animate,o=Iat({isAnimatingOpenOnMount:r,placeholder:n,animate:s});return{display:n.display,boxSizing:"border-box",width:o.width,height:o.height,marginTop:o.margin.top,marginRight:o.margin.right,marginBottom:o.margin.bottom,marginLeft:o.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:s!=="none"?uw.placeholder:null}};function Tat(e){var t=p.useRef(null),r=Ma(function(){t.current&&(clearTimeout(t.current),t.current=null)},[]),n=e.animate,s=e.onTransitionEnd,o=e.onClose,i=e.contextId,l=p.useState(e.animate==="open"),c=l[0],d=l[1];p.useEffect(function(){return c?n!=="open"?(r(),d(!1),Ik):t.current?Ik:(t.current=setTimeout(function(){t.current=null,d(!1)}),r):Ik},[n,c,r]);var u=Ma(function(h){h.propertyName==="height"&&(s(),n==="close"&&o())},[n,o,s]),f=Oat({isAnimatingOpenOnMount:c,animate:e.animate,placeholder:e.placeholder});return Ce.createElement(e.placeholder.tagName,{style:f,"data-rbd-placeholder-context-id":i,onTransitionEnd:u,ref:e.innerRef})}var Dat=Ce.memo(Tat),vF=Ce.createContext(null),Mat=function(e){BZ(t,e);function t(){for(var n,s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.state={isVisible:!!n.props.on,data:n.props.on,animate:n.props.shouldAnimate&&n.props.on?"open":"none"},n.onClose=function(){n.state.animate==="close"&&n.setState({isVisible:!1})},n}t.getDerivedStateFromProps=function(s,o){return s.shouldAnimate?s.on?{isVisible:!0,data:s.on,animate:"open"}:o.isVisible?{isVisible:!0,data:o.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!s.on,data:s.on,animate:"none"}};var r=t.prototype;return r.render=function(){if(!this.state.isVisible)return null;var s={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(s)},t}(Ce.PureComponent),cV={dragging:5e3,dropAnimating:4500},Rat=function(t,r){return r?uw.drop(r.duration):t?uw.snap:uw.fluid},Fat=function(t,r){return t?r?q1.opacity.drop:q1.opacity.combining:null},Lat=function(t){return t.forceShouldAnimate!=null?t.forceShouldAnimate:t.mode==="SNAP"};function $at(e){var t=e.dimension,r=t.client,n=e.offset,s=e.combineWith,o=e.dropping,i=!!s,l=Lat(e),c=!!o,d=c?D3.drop(n,i):D3.moveTo(n),u={position:"fixed",top:r.marginBox.top,left:r.marginBox.left,boxSizing:"border-box",width:r.borderBox.width,height:r.borderBox.height,transition:Rat(l,o),transform:d,opacity:Fat(i,c),zIndex:c?cV.dropAnimating:cV.dragging,pointerEvents:"none"};return u}function Bat(e){return{transform:D3.moveTo(e.offset),transition:e.shouldAnimateDisplacement?null:"none"}}function qat(e){return e.type==="DRAGGING"?$at(e):Bat(e)}function zat(e,t,r){r===void 0&&(r=fl);var n=window.getComputedStyle(t),s=t.getBoundingClientRect(),o=ise(s,n),i=lC(o,r),l={client:o,tagName:t.tagName.toLowerCase(),display:n.display},c={x:o.marginBox.width,y:o.marginBox.height},d={descriptor:e,placeholder:l,displaceBy:c,client:o,page:i};return d}function Uat(e){var t=gF("draggable"),r=e.descriptor,n=e.registry,s=e.getDraggableRef,o=e.canDragInteractiveElements,i=e.shouldRespectForcePress,l=e.isEnabled,c=Vs(function(){return{canDragInteractiveElements:o,shouldRespectForcePress:i,isEnabled:l}},[o,l,i]),d=Ma(function(m){var x=s();return x||Vn(!1),zat(r,x,m)},[r,s]),u=Vs(function(){return{uniqueId:t,descriptor:r,options:c,getDimension:d}},[r,d,c,t]),f=p.useRef(u),h=p.useRef(!0);Md(function(){return n.draggable.register(f.current),function(){return n.draggable.unregister(f.current)}},[n.draggable]),Md(function(){if(h.current){h.current=!1;return}var m=f.current;f.current=u,n.draggable.update(u,m)},[u,n.draggable])}function Vat(e){e.preventDefault()}function Wat(e){var t=p.useRef(null),r=Ma(function(P){t.current=P},[]),n=Ma(function(){return t.current},[]),s=hC(zP),o=s.contextId,i=s.dragHandleUsageInstructionsId,l=s.registry,c=hC(vF),d=c.type,u=c.droppableId,f=Vs(function(){return{id:e.draggableId,index:e.index,type:d,droppableId:u}},[e.draggableId,e.index,d,u]),h=e.children,m=e.draggableId,x=e.isEnabled,g=e.shouldRespectForcePress,v=e.canDragInteractiveElements,y=e.isClone,b=e.mapped,w=e.dropAnimationFinished;if(!y){var j=Vs(function(){return{descriptor:f,registry:l,getDraggableRef:n,canDragInteractiveElements:v,shouldRespectForcePress:g,isEnabled:x}},[f,l,n,v,g,x]);Uat(j)}var _=Vs(function(){return x?{tabIndex:0,role:"button","aria-describedby":i,"data-rbd-drag-handle-draggable-id":m,"data-rbd-drag-handle-context-id":o,draggable:!1,onDragStart:Vat}:null},[o,i,m,x]),C=Ma(function(P){b.type==="DRAGGING"&&b.dropping&&P.propertyName==="transform"&&w()},[w,b]),A=Vs(function(){var P=qat(b),M=b.type==="DRAGGING"&&b.dropping?C:null,O={innerRef:r,draggableProps:{"data-rbd-draggable-context-id":o,"data-rbd-draggable-id":m,style:P,onTransitionEnd:M},dragHandleProps:_};return O},[o,_,m,b,C,r]),S=Vs(function(){return{draggableId:f.id,type:f.type,source:{index:f.index,droppableId:f.droppableId}}},[f.droppableId,f.id,f.index,f.type]);return h(A,b.snapshot,S)}var eoe=function(e,t){return e===t},toe=function(e){var t=e.combine,r=e.destination;return r?r.droppableId:t?t.droppableId:null},Hat=function(t){return t.combine?t.combine.draggableId:null},Gat=function(t){return t.at&&t.at.type==="COMBINE"?t.at.combine.draggableId:null};function Kat(){var e=ul(function(s,o){return{x:s,y:o}}),t=ul(function(s,o,i,l,c){return{isDragging:!0,isClone:o,isDropAnimating:!!c,dropAnimation:c,mode:s,draggingOver:i,combineWith:l,combineTargetFor:null}}),r=ul(function(s,o,i,l,c,d,u){return{mapped:{type:"DRAGGING",dropping:null,draggingOver:c,combineWith:d,mode:o,offset:s,dimension:i,forceShouldAnimate:u,snapshot:t(o,l,c,d,null)}}}),n=function(o,i){if(o.isDragging){if(o.critical.draggable.id!==i.draggableId)return null;var l=o.current.client.offset,c=o.dimensions.draggables[i.draggableId],d=Dd(o.impact),u=Gat(o.impact),f=o.forceShouldAnimate;return r(e(l.x,l.y),o.movementMode,c,i.isClone,d,u,f)}if(o.phase==="DROP_ANIMATING"){var h=o.completed;if(h.result.draggableId!==i.draggableId)return null;var m=i.isClone,x=o.dimensions.draggables[i.draggableId],g=h.result,v=g.mode,y=toe(g),b=Hat(g),w=o.dropDuration,j={duration:w,curve:cF.drop,moveTo:o.newHomeClientOffset,opacity:b?q1.opacity.drop:null,scale:b?q1.scale.drop:null};return{mapped:{type:"DRAGGING",offset:o.newHomeClientOffset,dimension:x,dropping:j,draggingOver:y,combineWith:b,mode:v,forceShouldAnimate:null,snapshot:t(v,m,y,b,j)}}}return null};return n}function roe(e){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}var Xat={mapped:{type:"SECONDARY",offset:fl,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:roe(null)}};function Yat(){var e=ul(function(i,l){return{x:i,y:l}}),t=ul(roe),r=ul(function(i,l,c){return l===void 0&&(l=null),{mapped:{type:"SECONDARY",offset:i,combineTargetFor:l,shouldAnimateDisplacement:c,snapshot:t(l)}}}),n=function(l){return l?r(fl,l,!0):null},s=function(l,c,d,u){var f=d.displaced.visible[l],h=!!(u.inVirtualList&&u.effected[l]),m=LP(d),x=m&&m.draggableId===l?c:null;if(!f){if(!h)return n(x);if(d.displaced.invisible[l])return null;var g=Ay(u.displacedBy.point),v=e(g.x,g.y);return r(v,x,!0)}if(h)return n(x);var y=d.displacedBy.point,b=e(y.x,y.y);return r(b,x,f.shouldAnimate)},o=function(l,c){if(l.isDragging)return l.critical.draggable.id===c.draggableId?null:s(c.draggableId,l.critical.draggable.id,l.impact,l.afterCritical);if(l.phase==="DROP_ANIMATING"){var d=l.completed;return d.result.draggableId===c.draggableId?null:s(c.draggableId,d.result.draggableId,d.impact,d.afterCritical)}return null};return o}var Jat=function(){var t=Kat(),r=Yat(),n=function(o,i){return t(o,i)||r(o,i)||Xat};return n},Qat={dropAnimationFinished:Mse},Zat=sse(Jat,Qat,null,{context:pF,pure:!0,areStatePropsEqual:eoe})(Wat);function noe(e){var t=hC(vF),r=t.isUsingCloneFor;return r===e.draggableId&&!e.isClone?null:Ce.createElement(Zat,e)}function est(e){var t=typeof e.isDragDisabled=="boolean"?!e.isDragDisabled:!0,r=!!e.disableInteractiveElementBlocking,n=!!e.shouldRespectForcePress;return Ce.createElement(noe,Wa({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:r,shouldRespectForcePress:n}))}function tst(e){var t=p.useContext(zP);t||Vn(!1);var r=t.contextId,n=t.isMovementAllowed,s=p.useRef(null),o=p.useRef(null),i=e.children,l=e.droppableId,c=e.type,d=e.mode,u=e.direction,f=e.ignoreContainerClipping,h=e.isDropDisabled,m=e.isCombineEnabled,x=e.snapshot,g=e.useClone,v=e.updateViewportMaxScroll,y=e.getContainerForClone,b=Ma(function(){return s.current},[]),w=Ma(function(O){s.current=O},[]);Ma(function(){return o.current},[]);var j=Ma(function(O){o.current=O},[]),_=Ma(function(){n()&&v({maxScroll:Bse()})},[n,v]);kat({droppableId:l,type:c,mode:d,direction:u,isDropDisabled:h,isCombineEnabled:m,ignoreContainerClipping:f,getDroppableRef:b});var C=Ce.createElement(Mat,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},function(O){var I=O.onClose,T=O.data,k=O.animate;return Ce.createElement(Dat,{placeholder:T,onClose:I,innerRef:j,animate:k,contextId:r,onTransitionEnd:_})}),A=Vs(function(){return{innerRef:w,placeholder:C,droppableProps:{"data-rbd-droppable-id":l,"data-rbd-droppable-context-id":r}}},[r,l,C,w]),S=g?g.dragging.draggableId:null,P=Vs(function(){return{droppableId:l,type:c,isUsingCloneFor:S}},[l,S,c]);function M(){if(!g)return null;var O=g.dragging,I=g.render,T=Ce.createElement(noe,{draggableId:O.draggableId,index:O.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},function(k,$){return I(k,$,O)});return U4.createPortal(T,y())}return Ce.createElement(vF.Provider,{value:P},i(A,x),M())}var Ok=function(t,r){return t===r.droppable.type},dV=function(t,r){return r.draggables[t.draggable.id]},rst=function(){var t={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},r=Wa({},t,{shouldAnimatePlaceholder:!1}),n=ul(function(i){return{draggableId:i.id,type:i.type,source:{index:i.index,droppableId:i.droppableId}}}),s=ul(function(i,l,c,d,u,f){var h=u.descriptor.id,m=u.descriptor.droppableId===i;if(m){var x=f?{render:f,dragging:n(u.descriptor)}:null,g={isDraggingOver:c,draggingOverWith:c?h:null,draggingFromThisWith:h,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!1,snapshot:g,useClone:x}}if(!l)return r;if(!d)return t;var v={isDraggingOver:c,draggingOverWith:h,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!0,snapshot:v,useClone:null}}),o=function(l,c){var d=c.droppableId,u=c.type,f=!c.isDropDisabled,h=c.renderClone;if(l.isDragging){var m=l.critical;if(!Ok(u,m))return r;var x=dV(m,l.dimensions),g=Dd(l.impact)===d;return s(d,f,g,g,x,h)}if(l.phase==="DROP_ANIMATING"){var v=l.completed;if(!Ok(u,v.critical))return r;var y=dV(v.critical,l.dimensions);return s(d,f,toe(v.result)===d,Dd(v.impact)===d,y,h)}if(l.phase==="IDLE"&&l.completed&&!l.shouldFlush){var b=l.completed;if(!Ok(u,b.critical))return r;var w=Dd(b.impact)===d,j=!!(b.impact.at&&b.impact.at.type==="COMBINE"),_=b.critical.droppable.id===d;return w?j?t:r:_?t:r}return r};return o},nst={updateViewportMaxScroll:urt};function ast(){return document.body||Vn(!1),document.body}var sst={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:ast},aoe=sse(rst,nst,null,{context:pF,pure:!0,areStatePropsEqual:eoe})(tst);aoe.defaultProps=sst;function tv({className:e,...t}){return a.jsx("div",{className:Er("animate-pulse rounded-md bg-muted/20",e),...t})}function VP(e){return{id:e.id,code:e.codigo_produto??"",name:e.nome,category:e.categoria??"",type:e.tipo_produto==="uso_interno"?"Uso Interno":"Venda",cost:Number(e.valor_custo??e.preco_custo??0),price:Number(e.valor_venda??e.preco_venda??0),stock:Number(e.estoque??e.estoque_atual??0),minStock:Number(e.estoque_minimo??0),status:e.status??(e.ativo===!1||Number(e.estoque??0)===0?"inactive":Number(e.estoque??0)>0&&Number(e.estoque??0)<=Number(e.estoque_minimo??0)?"low_stock":"active"),validade:e.validade?new Date(e.validade):null,barcode:e.codigo_barras??"",barcodeBox:e.codigo_barras_caixa??"",reference:e.referencia??"",brand:e.marca??"",group:e.grupo??"",unit:e.unidade??"UN",initialStock:Number(e.estoque_inicial??0),currentStock:Number(e.estoque_atual??e.estoque??0),weight:e.peso!=null?Number(e.peso):null,buyPrice:e.preco_compra!=null?Number(e.preco_compra):null,costsPercent:e.custos_percent!=null?Number(e.custos_percent):null,costPrice:e.preco_custo!=null?Number(e.preco_custo):null,marginPercent:e.lucro_percent!=null?Number(e.lucro_percent):null,salePrice:e.preco_venda!=null?Number(e.preco_venda):null,wholesaleQty:e.qtd_atacado!=null?Number(e.qtd_atacado):null,wholesalePrice:e.preco_atacado!=null?Number(e.preco_atacado):null,commissionPercent:e.comissao_percent!=null?Number(e.comissao_percent):null,discountPercent:e.desconto_percent!=null?Number(e.desconto_percent):null,cfopInterno:e.cfop_interno??"",cstIcmsInterno:e.cst_icms_interno??"",csosnInterno:e.csosn_interno??"",aliqIcmsInterno:e.aliquota_icms_interno!=null?Number(e.aliquota_icms_interno):null,cfopExterno:e.cfop_externo??"",cstIcmsExterno:e.cst_icms_externo??"",csosnExterno:e.csosn_externo??"",aliqIcmsExterno:e.aliquota_icms_externo!=null?Number(e.aliquota_icms_externo):null,cstPisEntrada:e.cst_pis_entrada??"",cstPisSaida:e.cst_pis_saida??"",aliqPisPercent:e.aliquota_pis_percent!=null?Number(e.aliquota_pis_percent):null,aliqCofinsPercent:e.aliquota_cofins_percent!=null?Number(e.aliquota_cofins_percent):null,cstIpi:e.cst_ipi??"",aliqIpiPercent:e.aliquota_ipi_percent!=null?Number(e.aliquota_ipi_percent):null,fcpPercent:e.fcp_percent!=null?Number(e.fcp_percent):null,mvaPercent:e.mva_percent!=null?Number(e.mva_percent):null,baseReduzidaPercent:e.base_reduzida_percent!=null?Number(e.base_reduzida_percent):null,ncm:e.ncm??"",ncmDescription:e.descricao_ncm??"",cest:e.cest??"",active:e.ativo??!0,allowSale:e.permite_venda??!0,payCommission:e.paga_comissao??!1,variablePrice:e.preco_variavel??!1,composition:e.composicao??!1,service:e.servico??!1,hasGrid:e.grade??!1,usePriceTable:e.usar_tabela_preco??!1,fuel:e.combustivel??!1,useImei:e.usa_imei??!1,stockByGrid:e.controle_estoque_por_grade??!1,showInApp:e.mostrar_no_app??!1,dataImportacao:e.data_importacao?new Date(e.data_importacao):null,importadoViaXml:e.importado_via_xml??!1}}async function ost({from:e,to:t,codigoEmpresa:r,limit:n=1e3}={}){if(!e||!t)throw new Error("Perodo invlido");const s=(e instanceof Date?e:new Date(e)).toISOString(),o=(t instanceof Date?t:new Date(t)).toISOString(),{data:i,error:l}=await Di(x=>{let g=Q.from("comanda_itens").select("produto_id, quantidade, created_at").gte("created_at",s).lte("created_at",o).limit(n).abortSignal(x);return r&&(g=g.eq("codigo_empresa",r)),g},2e4,"Timeout getSoldProductsByPeriod (20s)");if(l)throw l;const c=new Map;for(const x of i||[]){const g=x.produto_id,v=Number(x.quantidade||0);c.set(g,(c.get(g)||0)+v)}const d=Array.from(c.entries()).sort((x,g)=>g[1]-x[1]);if(d.length===0)return[];const u=d.map(([x])=>x),{data:f,error:h}=await Di(x=>{let g=Q.from("produtos").select("id, nome").in("id",u).abortSignal(x);return r&&(g=g.eq("codigo_empresa",r)),g},15e3,"Timeout getSoldProductsByPeriod:produtos (15s)");if(h)throw h;const m=new Map((f||[]).map(x=>[x.id,x.nome]));return d.map(([x,g])=>({id:x,name:m.get(x)||String(x),total:g}))}async function e0({productId:e,delta:t,codigoEmpresa:r}){const n=Number(t);if(!e||!Number.isFinite(n)||n===0)throw new Error("Parmetros invlidos para ajuste de estoque");const{data:s,error:o}=await Di(d=>{let u=Q.from("produtos").select("id, estoque, estoque_atual").eq("id",e).single().abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},1e4,"Timeout get current stock (10s)");if(o)throw o;const l=Number(s?.estoque??s?.estoque_atual??0)+n,{error:c}=await Di(d=>{let u=Q.from("produtos").update({estoque:l,estoque_atual:l}).eq("id",e).abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},1e4,"Timeout update stock (10s)");if(c)throw c;return{id:e,stock:l}}async function ist({limit:e=5,codigoEmpresa:t}={}){const r=new Date;r.setHours(0,0,0,0);const n=r.toISOString(),{data:s,error:o}=await Di(h=>{let m=Q.from("comanda_itens").select("produto_id, quantidade, created_at").gte("created_at",n).abortSignal(h);return t&&(m=m.eq("codigo_empresa",t)),m},15e3,"Timeout getMostSoldProductsToday (15s)");if(o)throw o;const i=new Map;for(const h of s||[]){const m=h.produto_id,x=Number(h.quantidade||0);i.set(m,(i.get(m)||0)+x)}const l=Array.from(i.entries()).sort((h,m)=>m[1]-h[1]).slice(0,e);if(l.length===0)return[];const c=l.map(([h])=>h),{data:d,error:u}=await Di(h=>{let m=Q.from("produtos").select("id, nome").in("id",c).abortSignal(h);return t&&(m=m.eq("codigo_empresa",t)),m},15e3,"Timeout getMostSoldProductsToday:produtos (15s)");if(u)throw u;const f=new Map((d||[]).map(h=>[h.id,h.nome]));return l.map(([h,m])=>({id:h,name:f.get(h)||String(h),total:m}))}async function uV({codigoEmpresa:e}={}){if(!e)throw new Error("codigoEmpresa  obrigatrio");const{data:t,error:r}=await Di(l=>Q.from("produtos").select("codigo_produto").eq("codigo_empresa",e).order("codigo_produto",{ascending:!0}).abortSignal(l),15e3,"Timeout getNextProductCode (15s)");if(r)throw r;const n=new Set;for(const l of t||[]){const c=(l.codigo_produto||"").trim();if(/^\d+$/.test(c)){const d=parseInt(c,10);Number.isFinite(d)&&d>0&&n.add(d)}}let s=1;const o=(n.size||0)+1e3;let i=0;for(;n.has(s)&&i<o;)s+=1,i+=1;return(!Number.isFinite(s)||s<=0)&&(s=1),String(s).padStart(4,"0")}function soe(e){return{codigo_produto:e.code||null,nome:e.name,categoria:e.category||null,tipo_produto:e.type==="Uso Interno"?"uso_interno":"venda",valor_custo:e.cost!=null?Number(e.cost):0,valor_venda:e.price!=null?Number(e.price):0,estoque:e.stock!=null?Number(e.stock):0,estoque_minimo:e.minStock!=null?Number(e.minStock):0,status:e.status||null,validade:e.validade?new Date(e.validade).toISOString().slice(0,10):null,codigo_barras:e.barcode||null,codigo_barras_caixa:e.barcodeBox||null,referencia:e.reference||null,marca:e.brand||null,grupo:e.group||null,unidade:e.unit||null,estoque_inicial:e.initialStock!=null?Number(e.initialStock):null,estoque_atual:e.currentStock!=null?Number(e.currentStock):null,peso:e.weight!=null?Number(e.weight):null,preco_compra:e.buyPrice!=null?Number(e.buyPrice):null,custos_percent:e.costsPercent!=null?Number(e.costsPercent):null,preco_custo:e.costPrice!=null?Number(e.costPrice):null,lucro_percent:e.marginPercent!=null?Number(e.marginPercent):null,preco_venda:e.salePrice!=null?Number(e.salePrice):null,qtd_atacado:e.wholesaleQty!=null?Number(e.wholesaleQty):null,preco_atacado:e.wholesalePrice!=null?Number(e.wholesalePrice):null,comissao_percent:e.commissionPercent!=null?Number(e.commissionPercent):null,desconto_percent:e.discountPercent!=null?Number(e.discountPercent):null,cfop_interno:e.cfopInterno||null,cst_icms_interno:e.cstIcmsInterno||null,csosn_interno:e.csosnInterno||null,aliquota_icms_interno:e.aliqIcmsInterno!=null?Number(e.aliqIcmsInterno):null,cfop_externo:e.cfopExterno||null,cst_icms_externo:e.cstIcmsExterno||null,csosn_externo:e.csosnExterno||null,aliquota_icms_externo:e.aliqIcmsExterno!=null?Number(e.aliqIcmsExterno):null,cst_pis_entrada:e.cstPisEntrada||null,cst_pis_saida:e.cstPisSaida||null,aliquota_pis_percent:e.aliqPisPercent!=null?Number(e.aliqPisPercent):null,aliquota_cofins_percent:e.aliqCofinsPercent!=null?Number(e.aliqCofinsPercent):null,cst_ipi:e.cstIpi||null,aliquota_ipi_percent:e.aliqIpiPercent!=null?Number(e.aliqIpiPercent):null,fcp_percent:e.fcpPercent!=null?Number(e.fcpPercent):null,mva_percent:e.mvaPercent!=null?Number(e.mvaPercent):null,base_reduzida_percent:e.baseReduzidaPercent!=null?Number(e.baseReduzidaPercent):null,ncm:e.ncm||null,descricao_ncm:e.ncmDescription||null,cest:e.cest||null,ativo:e.active!=null?!!e.active:!0,permite_venda:e.allowSale!=null?!!e.allowSale:!0,paga_comissao:e.payCommission!=null?!!e.payCommission:!1,preco_variavel:e.variablePrice!=null?!!e.variablePrice:!1,composicao:e.composition!=null?!!e.composition:!1,servico:e.service!=null?!!e.service:!1,grade:e.hasGrid!=null?!!e.hasGrid:!1,usar_tabela_preco:e.usePriceTable!=null?!!e.usePriceTable:!1,combustivel:e.fuel!=null?!!e.fuel:!1,usa_imei:e.useImei!=null?!!e.useImei:!1,controle_estoque_por_grade:e.stockByGrid!=null?!!e.stockByGrid:!1,mostrar_no_app:e.showInApp!=null?!!e.showInApp:!1,importado_via_xml:e.importedViaXML===!0,data_importacao:e.dataImportacao?e.dataImportacao instanceof Date?e.dataImportacao.toISOString():new Date(e.dataImportacao).toISOString():null,xml_chave:e.xmlChave||null,xml_numero:e.xmlNumero||null,xml_serie:e.xmlSerie||null,xml_emissao:e.xmlEmissao?new Date(e.xmlEmissao).toISOString():null}}async function mf(e={}){const{includeInactive:t=!1,search:r="",codigoEmpresa:n}=e;console.log("[products.api] ====== listProducts INICIO ======"),console.log("[products.api] Parametros:",{includeInactive:t,search:r,codigoEmpresa:n});const{data:s,error:o}=await Di(c=>{let d=Q.from("produtos").select("*").eq("codigo_empresa",n).order("nome",{ascending:!0}).abortSignal(c);if(t||(d=d.neq("status","inactive"),d=d.or("ativo.is.null,ativo.eq.true"),console.log("[products.api] Filtro aplicado: status != inactive AND (ativo IS NULL OR ativo = true)")),r&&r.trim().length>0){const u=r.trim();d=d.or(`nome.ilike.%${u}%,codigo_produto.ilike.%${u}%`)}return d},15e3,"Timeout listProducts (15s)");if(o)throw console.error("[products.api] listProducts:error",o),o;const i=(s||[]).map(VP);console.log("[products.api] listProducts RETORNOU:",i.length,"produtos"),console.log("[products.api] includeInactive:",t),console.log("[products.api] Produtos:",i.map(c=>({id:c.id,name:c.name,code:c.code})));const l=i.filter(c=>!c.code||c.code.trim()==="");return console.log("[products.api] Produtos SEM cdigo:",l.length),l.length>0&&l.forEach(c=>{console.log("  -",c.name,"| active:",c.active,"| status:",c.status,"| code:",c.code||"NULL")}),i}async function lst(e={}){const{includeInactive:t=!1,search:r="",codigoEmpresa:n,page:s=1,pageSize:o=100}=e;if(!n)return{data:[],count:0};const i=s>0?s:1,l=o>0?o:100,c=(i-1)*l,d=c+l-1;console.log("[products.api] ====== listProductsPaged INICIO ======",{includeInactive:t,search:r,codigoEmpresa:n,page:i,pageSize:l});try{const{data:u,error:f,count:h}=await Di(x=>{let g=Q.from("produtos").select("*",{count:"exact"}).eq("codigo_empresa",n).order("nome",{ascending:!0}).range(c,d).abortSignal(x);if(t||(g=g.neq("status","inactive"),g=g.or("ativo.is.null,ativo.eq.true")),r&&r.trim().length>0){const v=r.trim();g=g.or(`nome.ilike.%${v}%,codigo_produto.ilike.%${v}%`)}return g},2e4,"Timeout listProductsPaged (20s)");if(f)throw console.error("[products.api] listProductsPaged:error",f),f;const m=(u||[]).map(VP);return console.log("[products.api] listProductsPaged RETORNOU:",m.length,"produtos de",h||0),{data:m,count:h||0}}catch(u){return console.error("[products.api] listProductsPaged:exception",u),{data:[],count:0}}}async function pC(e,t={}){const{codigoEmpresa:r}=t,n=soe(e);r&&(n.codigo_empresa=r),console.info("[products.api] createProduct: payload",n);const s=async()=>Di(d=>Q.from("produtos").insert(n).select("*").single().abortSignal(d),15e3,"Timeout createProduct (15s)"),o=d=>{if(!d)return!1;if(d.code&&String(d.code)==="23505")return!0;const u=[d.message,d.details,d.hint].filter(Boolean).join(" ").toLowerCase();return u.includes("duplicate key")||u.includes("unique constraint")||u.includes("ux_produtos_empresa_codigo_produto")||u.includes("codigo_produto")};let i,l;if({data:i,error:l}=await s(),l&&o(l)&&n.codigo_produto){console.warn("[products.api] createProduct: duplicate code, trying to free code from inactive product");const{data:d,error:u}=await Di(h=>Q.from("produtos").select("id,status").eq("codigo_produto",n.codigo_produto).eq("status","inactive").limit(1).abortSignal(h),15e3,"Timeout find duplicate product (15s)"),f=Array.isArray(d)&&d.length>0?d[0]:null;if(!u&&f&&f.status==="inactive"){const{error:h}=await Di(m=>Q.from("produtos").update({codigo_produto:null}).eq("id",f.id).abortSignal(m),15e3,"Timeout clear duplicate code (15s)");h||({data:i,error:l}=await s())}else{const h=n.codigo_produto;n.codigo_produto=null,console.warn("[products.api] createProduct: no inactive found for duplicate code, retrying with codigo_produto = null (original:",h,")"),{data:i,error:l}=await s()}}if(l)throw console.error("[products.api] createProduct:error",l),l;const c=VP(i);return console.info("[products.api] createProduct: ok",c),c}async function z1(e,t,r={}){const n=soe(t);n.data_importacao=null,console.info("[products.api] updateProduct: id",e,"payload",n);const{data:s,error:o}=await Di(l=>Q.from("produtos").update(n).eq("id",e).select("*").single().abortSignal(l),15e3,"Timeout updateProduct (15s)");if(o)throw console.error("[products.api] updateProduct:error",o),o;const i=VP(s);return console.info("[products.api] updateProduct: ok",i),i}async function Di(e,t,r){const n=new AbortController,s=setTimeout(()=>n.abort(new Error(r)),t);try{return await e(n.signal)}catch(o){throw o?.name==="AbortError"?new Error(r):o}finally{clearTimeout(s)}}async function yF(e){console.info("[products.api] deleteProduct (soft): id",e);const{error:t}=await Di(r=>Q.from("produtos").update({status:"inactive",codigo_produto:null}).eq("id",e).abortSignal(r),15e3,"Timeout deleteProduct (15s)");if(t)throw console.error("[products.api] deleteProduct:error",t),t;return console.info("[products.api] deleteProduct: ok (inativado)"),!0}async function cst({ids:e,status:t}){const r=Array.isArray(e)?e.filter(Boolean):[];if(!r.length)throw new Error("Nenhum produto selecionado para atualizao em massa");if(!["active","inactive","low_stock"].includes(t))throw new Error("Status invlido para atualizao em massa");const n=t!=="inactive";console.info("[products.api] bulkUpdateProductStatus:start",{count:r.length,status:t});const{error:s}=await Di(o=>Q.from("produtos").update({status:t,ativo:n}).in("id",r).abortSignal(o),2e4,"Timeout bulkUpdateProductStatus (20s)");if(s)throw console.error("[products.api] bulkUpdateProductStatus:error",s),s;return console.info("[products.api] bulkUpdateProductStatus:ok",{count:r.length,status:t}),!0}async function dst({ids:e}){const t=Array.isArray(e)?e.filter(Boolean):[];if(!t.length)throw new Error("Nenhum produto selecionado para limpar flag de novo");console.info("[products.api] bulkClearNewFlag:start",{count:t.length});const{error:r}=await Di(n=>Q.from("produtos").update({data_importacao:null}).in("id",t).abortSignal(n),2e4,"Timeout bulkClearNewFlag (20s)");if(r)throw console.error("[products.api] bulkClearNewFlag:error",r),r;return console.info("[products.api] bulkClearNewFlag:ok",{count:t.length}),!0}async function fV(e={}){const{codigoEmpresa:t}=e;console.info("[products.api] listCategories: start");const{data:r,error:n}=await Di(i=>{let l=Q.from("produto_categorias").select("nome").eq("ativa",!0).order("nome",{ascending:!0}).abortSignal(i);return t&&(l=l.eq("codigo_empresa",t)),l},15e3,"Timeout listCategories (15s)");if(n)throw console.error("[products.api] listCategories:error",n),n;const s=[],o=new Set;for(const i of r||[]){const l=(i?.nome||"").trim();if(!l)continue;const c=l.toLowerCase();o.has(c)||(o.add(c),s.push(l))}return console.info("[products.api] listCategories: ok",{count:s.length}),s}async function ust(e,t={}){const{codigoEmpresa:r}=t,n=String(e||"").trim();if(!n)throw new Error("Nome da categoria invlido");console.info("[products.api] createCategory:",n);const s={nome:n};r&&(s.codigo_empresa=r);const{data:o,error:i}=await Di(l=>Q.from("produto_categorias").insert(s).select("nome").single().abortSignal(l),15e3,"Timeout createCategory (15s)");if(i)throw console.error("[products.api] createCategory:error",i),i;return o?.nome||n}async function fst(e,t={}){const{codigoEmpresa:r}=t,n=String(e||"").trim();if(!n)throw new Error("Nome da categoria invlido");console.info("[products.api] removeCategory:",n);const{count:s,error:o}=await Di(d=>{let u=Q.from("produtos").select("id",{count:"exact",head:!0}).eq("categoria",n).neq("status","inactive").abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},15e3,"Timeout removeCategory:count (15s)");if(o)throw console.error("[products.api] removeCategory:count:error",o),o;if((s??0)>0){const d=new Error("Categoria possui produtos ativos vinculados");throw console.warn("[products.api] removeCategory: blocked by active products",{nome:n,prodCount:s}),d}const{data:i,error:l}=await Di(d=>{let u=Q.from("produto_categorias").update({ativa:!1}).eq("nome",n).select("nome").abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},15e3,"Timeout removeCategory (15s)");if(l)throw console.error("[products.api] removeCategory:error",l),l;if((Array.isArray(i)?i.length:0)===0){const d=new Error("Categoria no encontrada para desativar");throw console.warn("[products.api] removeCategory: no rows affected",{nome:n}),d}return!0}function mst({item:e,onApply:t,onClose:r,codigoEmpresa:n}){const{toast:s}=Xs(),[o,i]=p.useState(e?.desconto_tipo||"percentual"),[l,c]=p.useState(e?.desconto_valor||0),[d,u]=p.useState(e?.desconto_motivo||""),[f,h]=p.useState(!1);if(!e)return null;const m=Number(e.price||e.preco_unitario||0),x=Number(e.quantity||e.quantidade||1),g=m*x,v=o==="percentual"?g*(1-l/100):g-l,y=async()=>{try{if(h(!0),l<0){s({title:"Erro",description:"Desconto no pode ser negativo",variant:"destructive"});return}if(o==="percentual"&&l>100){s({title:"Erro",description:"Desconto percentual no pode ser maior que 100%",variant:"destructive"});return}console.log("Aplicando desconto:",{itemId:e.id,desconto_tipo:o,desconto_valor:Number(l),desconto_motivo:d||null,codigoEmpresa:n});const w=await xKe({itemId:e.id,desconto_tipo:o,desconto_valor:Number(l),desconto_motivo:d||null,codigoEmpresa:n});console.log("Resultado:",w),s({title:"Sucesso",description:"Desconto aplicado!",variant:"success"}),t(),r()}catch(w){console.error("Erro ao aplicar desconto:",w),s({title:"Erro",description:w.message||"Falha ao aplicar desconto",variant:"destructive"})}finally{h(!1)}},b=async()=>{try{h(!0),await yKe({itemId:e.id,codigoEmpresa:n}),s({title:"Sucesso",description:"Desconto removido!",variant:"success"}),t(),r()}catch(w){console.error("Erro ao remover desconto:",w),s({title:"Erro",description:w.message||"Falha ao remover desconto",variant:"destructive"})}finally{h(!1)}};return a.jsx(zn,{open:!0,onOpenChange:r,children:a.jsxs(qn,{overlayClassName:"z-[90]",className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[91]",children:[a.jsx(Bn,{children:a.jsxs($n,{className:"text-lg font-bold",children:["Desconto - ",e.name]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(lt,{className:"text-sm font-semibold mb-2 block",children:"Tipo de Desconto"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:o==="percentual"?"default":"outline",onClick:()=>i("percentual"),disabled:f,className:"flex-1",children:"Percentual (%)"}),a.jsx(Z,{variant:o==="fixo"?"default":"outline",onClick:()=>i("fixo"),disabled:f,className:"flex-1",children:"Fixo (R$)"})]})]}),a.jsxs("div",{children:[a.jsxs(lt,{htmlFor:"desconto-valor",className:"text-sm font-semibold",children:["Valor ",o==="percentual"?"(%)":"(R$)"]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx(At,{id:"desconto-valor",type:"text",value:o==="percentual"?l===0?"":l:l===0?"":`R$ ${l.toFixed(2)}`,onChange:w=>{let j=w.target.value.trim();if(j===""){c(0);return}o==="fixo"&&(j=j.replace(/[^\d.,]/g,"").replace(",","."));let _=Number(j);isNaN(_)&&(_=0),o==="percentual"&&_>100&&(_=100),_<0&&(_=0),c(_)},placeholder:o==="percentual"?"0":"0,00",disabled:f,className:"mt-1"}),o==="percentual"&&a.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary font-semibold",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"desconto-motivo",className:"text-sm font-semibold",children:"Motivo"}),a.jsxs("select",{id:"desconto-motivo",value:d,onChange:w=>u(w.target.value),className:"w-full border border-border rounded-md p-2 mt-1 text-sm bg-background",disabled:f,children:[a.jsx("option",{value:"",children:"Selecione um motivo..."}),a.jsx("option",{value:"Promoo",children:"Promoo"}),a.jsx("option",{value:"Meia entrada",children:"Meia entrada"}),a.jsx("option",{value:"Cortesia",children:"Cortesia"}),a.jsx("option",{value:"Ajuste",children:"Ajuste"}),a.jsx("option",{value:"Outro",children:"Outro"})]})]}),a.jsxs("div",{className:"bg-surface-2 p-4 rounded-lg space-y-2 border border-border",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:"Preo Original:"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",g.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm text-destructive font-semibold",children:[a.jsx("span",{children:"Desconto:"}),a.jsxs("span",{children:["-R$ ",(g-v).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-base font-bold border-t border-border pt-2",children:[a.jsx("span",{children:"Total do Item:"}),a.jsxs("span",{className:"text-brand",children:["R$ ",Math.max(0,v).toFixed(2)]})]})]}),d&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded",children:[a.jsx("strong",{children:"Motivo:"})," ",d]})]}),a.jsxs(Ua,{className:"flex gap-2",children:[a.jsx(Z,{variant:"outline",onClick:r,disabled:f,children:"Cancelar"}),e.desconto_valor>0&&a.jsxs(Z,{variant:"destructive",onClick:b,disabled:f,size:"sm",className:"gap-2",children:[a.jsx(Sc,{className:"w-4 h-4"}),"Remover"]}),a.jsx(Z,{onClick:y,disabled:f,className:"gap-2",children:f?"Aplicando...":"Aplicar Desconto"})]})]})})}function ooe({comanda:e,subtotal:t,onApply:r,onClose:n,codigoEmpresa:s}){const{toast:o}=Xs(),[i,l]=p.useState(e?.desconto_tipo||"percentual"),[c,d]=p.useState(e?.desconto_valor||0),[u,f]=p.useState(e?.desconto_motivo||""),[h,m]=p.useState(!1);if(!e)return null;const x=i==="percentual"?t*c/100:c,g=Math.max(0,t-x),v=async()=>{try{if(m(!0),c<0){o({title:"Erro",description:"Desconto no pode ser negativo",variant:"destructive"});return}if(i==="percentual"&&c>100){o({title:"Erro",description:"Desconto percentual no pode ser maior que 100%",variant:"destructive"});return}if(x>t){o({title:"Erro",description:"Desconto no pode ser maior que o subtotal",variant:"destructive"});return}console.log("Aplicando desconto comanda:",{comandaId:e.id,desconto_tipo:i,desconto_valor:Number(c),desconto_motivo:u||null,codigoEmpresa:s});const b=await vKe({comandaId:e.id,desconto_tipo:i,desconto_valor:Number(c),desconto_motivo:u||null,codigoEmpresa:s});console.log("Resultado comanda:",b),o({title:"Sucesso",description:"Desconto aplicado na comanda!",variant:"success"}),r?.(b),n()}catch(b){console.error("Erro ao aplicar desconto:",b),o({title:"Erro",description:b.message||"Falha ao aplicar desconto",variant:"destructive"})}finally{m(!1)}},y=async()=>{try{m(!0);const b=await bKe({comandaId:e.id,codigoEmpresa:s});o({title:"Sucesso",description:"Desconto removido!",variant:"success"}),r?.(b),n()}catch(b){console.error("Erro ao remover desconto:",b),o({title:"Erro",description:b.message||"Falha ao remover desconto",variant:"destructive"})}finally{m(!1)}};return a.jsx(zn,{open:!0,modal:!0,onOpenChange:n,children:a.jsxs(qn,{overlayClassName:"z-[80]",className:"sm:max-w-[420px] w-[92vw] max-h-[75vh] flex flex-col animate-none p-3 sm:p-6",style:{zIndex:1e3},onOpenAutoFocus:b=>b.preventDefault(),onKeyDown:b=>b.stopPropagation(),onKeyDownCapture:b=>b.stopPropagation(),onEscapeKeyDown:b=>b.stopPropagation(),children:[a.jsx(Bn,{className:"pr-6",children:a.jsxs($n,{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(Zue,{className:"w-6 h-6 text-brand"}),"Desconto da Comanda"]})}),a.jsxs("div",{className:"mt-2 space-y-4 flex-1 overflow-y-auto thin-scroll pr-0 sm:pr-1",children:[a.jsxs("div",{children:[a.jsx(lt,{className:"text-sm font-semibold mb-2 block",children:"Tipo de Desconto"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:i==="percentual"?"default":"outline",onClick:()=>l("percentual"),disabled:h,className:"flex-1",children:"Percentual (%)"}),a.jsx(Z,{variant:i==="fixo"?"default":"outline",onClick:()=>l("fixo"),disabled:h,className:"flex-1",children:"Fixo (R$)"})]})]}),a.jsxs("div",{children:[a.jsxs(lt,{htmlFor:"desconto-valor",className:"text-sm font-semibold",children:["Valor ",i==="percentual"?"(%)":"(R$)"]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx(At,{id:"desconto-valor",type:"text",name:"desconto-valor",autoComplete:"off",autoCorrect:"off",spellCheck:!1,value:i==="percentual"?c===0?"":String(c):c===0?"":new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(c),onChange:b=>{const w=b.target.value||"";if(w.trim()===""){d(0);return}if(i==="fixo"){const C=w.replace(/\D/g,""),A=C?Number(C)/100:0;d(A);return}let j=w.replace(/[^\d.,]/g,"").replace(",","."),_=Number(j);isNaN(_)&&(_=0),_<0&&(_=0),_>100&&(_=100),d(_)},placeholder:i==="percentual"?"0":"0,00",disabled:h,className:"mt-1"}),i==="percentual"&&a.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary font-semibold",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"desconto-motivo",className:"text-sm font-semibold",children:"Motivo"}),a.jsxs("select",{id:"desconto-motivo",value:u,onChange:b=>f(b.target.value),className:"w-full border border-border rounded-md p-2 mt-1 text-sm bg-background",disabled:h,children:[a.jsx("option",{value:"",children:"Selecione um motivo..."}),a.jsx("option",{value:"Promoo",children:"Promoo"}),a.jsx("option",{value:"Cortesia",children:"Cortesia"}),a.jsx("option",{value:"Ajuste",children:"Ajuste"}),a.jsx("option",{value:"Outro",children:"Outro"})]})]}),a.jsxs("div",{className:"bg-surface-2 p-4 rounded-lg space-y-2 border border-border",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:"Subtotal:"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",t.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm text-destructive font-semibold",children:[a.jsx("span",{children:"Desconto:"}),a.jsxs("span",{children:["-R$ ",x.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-base font-bold border-t border-border pt-2",children:[a.jsx("span",{children:"Total da Comanda:"}),a.jsxs("span",{className:"text-brand",children:["R$ ",g.toFixed(2)]})]})]}),u&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded",children:[a.jsx("strong",{children:"Motivo:"})," ",u]})]}),a.jsxs(Ua,{className:"flex flex-col sm:flex-row gap-2 sm:justify-end pt-3 border-t border-border mt-2",children:[a.jsx(Z,{variant:"outline",onClick:n,disabled:h,className:"w-full sm:w-auto",children:"Cancelar"}),e.desconto_valor>0&&a.jsxs(Z,{variant:"destructive",onClick:y,disabled:h,size:"sm",className:"gap-2 w-full sm:w-auto",children:[a.jsx(Sc,{className:"w-4 h-4"}),"Remover"]}),a.jsx(Z,{onClick:v,disabled:h,className:"gap-2 w-full sm:w-auto",children:h?"Aplicando...":"Aplicar Desconto"})]})]})})}const hst={available:{label:"Livre",color:"border-success/50 bg-success/10 text-success",icon:Oi},"in-use":{label:"Em Uso",color:"border-warning/50 bg-warning/10 text-warning",icon:xu},"awaiting-payment":{label:"Pagamento",color:"border-info/50 bg-info/10 text-info",icon:ol}};function pst(){const{toast:e}=Xs(),{userProfile:t,authReady:r}=fo(),n=Ol(),[s,o]=p.useState([]),[i,l]=p.useState(null),[c,d]=p.useState(!1),[u,f]=p.useState(0);p.useRef(!1);const[h,m]=p.useState(!1);p.useState([]);const[x,g]=p.useState(!1),[v,y]=p.useState(new Map),[b,w]=p.useState(!1);p.useRef(null),p.useRef(null);const j=p.useRef([]),_=p.useRef(null),[C,A]=p.useState(0),[S,P]=p.useState("tables");p.useRef(null);const[M,O]=p.useState("order");p.useRef(null),p.useRef(null),p.useState(!1);const[I,T]=p.useState(null),[k,$]=p.useState(null),[q,z]=p.useState(!1),[F,V]=p.useState(!1),[ue,_e]=p.useState(!1),[U,L]=p.useState(null),[G,de]=p.useState(!1),[X,W]=p.useState([]),[Y,me]=p.useState(!1),[ee,ae]=p.useState(!1),[le,Te]=p.useState(!1),[te,ie]=p.useState(!1),[xt,vt]=p.useState(!1),[dt,St]=p.useState(!1),[ft,_t]=p.useState(!1),[gr,be]=p.useState(!1),[Nt,Wt]=p.useState(null),[_r,yr]=p.useState(""),[ve,at]=p.useState(!1),[qt,$t]=p.useState(!1),[De,wt]=p.useState([]),[Rt,Rr]=p.useState(null),[Me,tt]=p.useState(null),[ut,sr]=p.useState(!1),Sr=p.useRef(""),[xr,Wr]=p.useState(!1),[qr,Tr]=p.useState(!1),[sn,Cn]=p.useState("order"),[ze,Fe]=p.useState(!1),[Le,Ze]=p.useState(""),[Ot,mt]=p.useState(()=>{try{return typeof window<"u"&&window.innerWidth<=640}catch{return!1}}),[Qt,bt]=p.useState(null),[zt,ne]=p.useState(null),[He,Gt]=p.useState(!1);p.useEffect(()=>{const se=t?.codigo_empresa;se&&(async()=>{try{if(Array.isArray(De)&&De.length>0)return;const Se=await $h({somenteAtivas:!0,codigoEmpresa:se});wt(Array.isArray(Se)?Se:[])}catch{}})()},[t?.codigo_empresa]);const Ht=p.useMemo(()=>{const se=new Map,Se=i?.order||[];for(const Ee of Se){const it=String(Ee.productId);se.set(it,(se.get(it)||0)+Number(Ee.quantity||0))}return se},[i?.order]),Fr=async se=>{try{const Se=i?.order||[],Ee=Se.find(Or=>String(Or.productId)===String(se.id));if(!Ee)return;const it=Number(Ee.quantity||0)-1;if(String(Ee.id||"").startsWith("tmp-")){const Or=it>0?Se.map(dn=>dn.id===Ee.id?{...dn,quantity:it}:dn):Se.filter(dn=>dn.id!==Ee.id),_n=Or.reduce((dn,Dr)=>dn+Number(Dr.price||0)*Number(Dr.quantity||0),0),fr={...i,order:Or,totalHint:_n};l(fr),o(dn=>dn.map(Dr=>Dr.id===fr.id?{...Dr,totalHint:_n}:Dr)),setTimeout(async()=>{try{const Dr=(await ii({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Mn=>({id:Mn.id,productId:Mn.produto_id,name:Mn.descricao||"Item",price:Number(Mn.preco_unitario||0),quantity:Number(Mn.quantidade||1)})),wr=(Dr||[]).reduce((Mn,ha)=>Mn+Number(ha.price||0)*Number(ha.quantity||0),0),Jr={...i,order:Dr,totalHint:wr};l(Jr),o(Mn=>Mn.map(ha=>ha.id===Jr.id?{...ha,totalHint:wr}:ha))}catch{}},300);return}const hr=i,er=s,Ar=it>0?Se.map(Or=>Or.id===Ee.id?{...Or,quantity:it}:Or):Se.filter(Or=>Or.id!==Ee.id),Cr=Ar.reduce((Or,_n)=>Or+Number(_n.price||0)*Number(_n.quantity||0),0),Lt={...i,order:Ar,totalHint:Cr};l(Lt),o(Or=>Or.map(_n=>_n.id===Lt.id?{..._n,totalHint:Cr}:_n));try{it>0?await eu({itemId:Ee.id,quantidade:it,codigoEmpresa:t?.codigo_empresa}):await Mv({itemId:Ee.id,codigoEmpresa:t?.codigo_empresa})}catch(Or){throw l(hr),o(er),Or}const vn=Math.max(it,0);let Xr=!1;for(let Or=0;Or<3&&!Xr;Or++){const fr=(await ii({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Dr=>({id:Dr.id,productId:Dr.produto_id,name:Dr.descricao||"Item",price:Number(Dr.preco_unitario||0),quantity:Number(Dr.quantidade||1)}));if((fr.find(Dr=>String(Dr.productId)===String(se.id))?.quantity||0)===vn){const Dr=fr.reduce((Jr,Mn)=>Jr+Number(Mn.price||0)*Number(Mn.quantity||0),0),wr={...i,order:fr,totalHint:Dr};l(wr),o(Jr=>Jr.map(Mn=>Mn.id===wr.id?wr:Mn)),Xr=!0;break}await new Promise(Dr=>setTimeout(Dr,180*(Or+1)))}try{const Or=await kh({codigoEmpresa:t?.codigo_empresa}),_n=new Map;for(const fr of Or||[]){const dn=String(fr.produto_id),Dr=Number(fr.quantidade||0);_n.set(dn,(_n.get(dn)||0)+Dr)}y(_n)}catch(Or){console.error("[decProduct] Erro ao atualizar estoque reservado:",Or)}}catch(Se){console.error("[decProduct] Erro:",Se),e({title:"Falha ao alterar quantidade",description:Se?.message||"Tente novamente",variant:"destructive"})}},cr=p.useRef(null),nn=p.useCallback(()=>{try{const se=cr.current;if(!se)return 1;const Ee=window.getComputedStyle(se).gridTemplateColumns||"";if(Ee){const Pt=Ee.split(" ").filter(Boolean).length;if(Pt>0)return Pt}const it=se.querySelector("[data-table-id]");if(it){const Pt=it.getBoundingClientRect().width,hr=se.getBoundingClientRect().width;if(Pt>0)return Math.max(1,Math.floor(hr/Pt))}return 1}catch{return 1}},[]),[Tn,Gn]=p.useState(!1),ta=p.useRef(!1);p.useEffect(()=>{ta.current=ve},[ve]);const Aa=p.useRef(0),ke=p.useRef(null),Ae=p.useRef(null),et=p.useRef(null),br=p.useRef(null),Zt=p.useRef([]);p.useRef(null);const Pn=p.useRef(!1),Ct=p.useRef(null),lr=p.useRef(null);Mi();const Ye=p.useMemo(()=>(s||[]).find(se=>se.status==="available")?.id||null,[s]),Tt=ee||xt||F||x||ve||ut||h||q||qr||ue||b||!1,Xt=async se=>{try{if(!se)return;if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}if(qt)return;if($t(!0),l(Se=>!Se||Se.id!==se.id?se:Se),se.status==="available"||!se.comandaId){Wt(se),vt(!0);return}try{await ot(se)}catch{try{const it=(await ii({comandaId:se.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(er=>({id:er.id,productId:er.produto_id,name:er.descricao||"Item",price:Number(er.preco_unitario||0),quantity:Number(er.quantidade||1)}));let Pt=null;try{const Ar=(await rl({comandaId:se.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Cr=>Cr?.nome).filter(Boolean);Pt=Ar.length?Ar.join(", "):null}catch{}const hr={...se,order:it,customer:Pt};l(hr),o(er=>er.map(Ar=>Ar.id===hr.id?hr:Ar))}catch{}}}finally{$t(!1)}};p.useEffect(()=>{const se=()=>{try{mt(typeof window<"u"&&window.innerWidth<=640)}catch{mt(!1)}};return se(),window.addEventListener("resize",se),()=>window.removeEventListener("resize",se)},[]),p.useEffect(()=>{const se=async Se=>{try{if(b)return;const Ee=String(Se.target?.tagName||"").toLowerCase();if(["input","textarea","select"].includes(Ee)||Se.target?.isContentEditable||Tt)return;if(Se.key==="F1"){Se.preventDefault();try{const Pt=(s||[]).filter(hr=>hr.status==="available");Pt.length>0?(l(Pt[0]),Wt?.(Pt[0])):!i&&Array.isArray(s)&&s.length>0&&(l(s[0]),Wt?.(s[0]))}catch{}vt(!0);return}if(Se.key==="F2"){Se.preventDefault(),i?.comandaId?await Va():e({title:"Nenhuma comanda selecionada",description:"Selecione uma mesa com comanda aberta antes de fechar.",variant:"warning"});return}if(Se.key==="F10"){Se.preventDefault(),c?e({title:"Caixa j est aberto",description:"Use F11 para ver detalhes do caixa.",variant:"info"}):sr(!0);return}if(Se.key==="F11"){Se.preventDefault(),g(!0);return}if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(Se.key)){if(S!=="tables"||!i||!Array.isArray(s)||s.length===0)return;Se.preventDefault(),Se.stopPropagation();let Pt=Math.max(0,s.findIndex(Lt=>Lt.id===i?.id));Pt<0&&(Pt=0);let hr=nn(),er=Pt;Se.key==="ArrowRight"&&(er=Pt+1),Se.key==="ArrowLeft"&&(er=Pt-1),Se.key==="ArrowDown"&&(er=Pt+hr),Se.key==="ArrowUp"&&(er=Pt-hr);const Ar=s.length;er=(er%Ar+Ar)%Ar;const Cr=s[er];Cr&&Cr.id!==i?.id&&(l(Cr),setTimeout(()=>{try{document.querySelector(`[data-table-id="${Cr.id}"]`)?.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}catch{}},0));return}if(Se.key==="Enter"){if(S!=="tables")return;Se.preventDefault(),Se.stopPropagation(),i&&!qt&&await Xt(i);return}if(Se.key==="Escape"){if(Se.preventDefault(),i&&(M==="products"||sn==="products")){O("order"),Cn("order");return}if(i){l(null);return}return}if(Se.key==="p"||Se.key==="P"){if(Se.preventDefault(),h){setTimeout(()=>{try{_.current?.focus()}catch{}},0);return}if(i){w(!0);try{Tr(!1)}catch{}return}m(!0),setTimeout(()=>{try{_.current?.focus()}catch{}},50);return}}catch{}};return window.addEventListener("keydown",se),()=>window.removeEventListener("keydown",se)},[Tt,i?.id,s,nn,b]),p.useEffect(()=>{try{i?.id&&t?.codigo_empresa&&localStorage.setItem(`vendas:selected:${t.codigo_empresa}`,String(i.id))}catch{}},[i?.id,t?.codigo_empresa]),p.useEffect(()=>{(async()=>{try{if(!i&&t?.codigo_empresa&&Array.isArray(s)&&s.length>0){const Se=localStorage.getItem(`vendas:selected:${t.codigo_empresa}`);if(Se){const Ee=s.find(it=>String(it.id)===String(Se));if(Ee)if(P("tables"),Ee.comandaId)try{await ot(Ee),P("tables")}catch(it){console.error("[Restore Selection] Erro ao carregar detalhes:",it),localStorage.removeItem(`vendas:selected:${t.codigo_empresa}`)}else localStorage.removeItem(`vendas:selected:${t.codigo_empresa}`)}}}catch(Se){console.error("[Restore Selection] Erro:",Se)}})()},[s,i,t?.codigo_empresa]);const Br=p.useCallback(async()=>{try{const se=await qh({codigoEmpresa:t?.codigo_empresa});d(!!(se&&(se.id||se?.length)))}catch{d(!1)}},[t?.codigo_empresa]),Wn=async()=>{const se=t?.codigo_empresa||null;try{if(!se)return;const[Se,Ee]=await Promise.all([P1({codigoEmpresa:se}).catch(()=>null),qh({codigoEmpresa:se}).catch(()=>null)]);if(!Ee?.id){T(null);return}let it=0,Pt=[];try{Pt=await $g({caixaSessaoId:Ee.id,codigoEmpresa:se}),it=(Pt||[]).filter(er=>(er?.tipo||"")==="sangria").reduce((er,Ar)=>er+Number(Ar?.valor||0),0)}catch{}const hr={saldo_inicial:Ee.saldo_inicial||0,totalPorFinalizadora:Se?.totalPorFinalizadora||Se?.porFinalizadora||{},totalEntradas:Se?.totalEntradas||Se?.entradas||0,totalSangria:it,totalSaidas:it,sessaoId:Ee.id,movimentacoes:Pt};Ce.startTransition(()=>{T(hr)})}catch{Ce.startTransition(()=>{T(null)})}finally{}},xn=p.useRef(!1);p.useEffect(()=>{x&&!xn.current?(xn.current=!0,Wn().catch(()=>{})):x||(xn.current=!1)},[x]);const on=p.useRef(!0);p.useEffect(()=>(on.current=!0,()=>{on.current=!1}),[]);const ua=p.useRef(0),sa=p.useRef(0),wa=p.useRef(0);p.useEffect(()=>{const se=t?.codigo_empresa||null,Se=se?`vendas:tables:${se}`:null,Ee=()=>{try{if(!Se)return;const Pt=JSON.parse(localStorage.getItem(Se)||"[]");Array.isArray(Pt)&&Pt.length>0&&o(Pt)}catch{}};se&&Ee();const it=async()=>{try{if(!r||!se)return;const Pt=++wa.current,hr=setTimeout(()=>{on.current&&Ee()},2e3),er=setTimeout(()=>{on.current&&wa.current===Pt&&Ee()},1e4),[Ar,Cr]=await Promise.all([Bh(se),kh({codigoEmpresa:se}).catch(()=>[])]);if(on.current&&wa.current===Pt){const wr=new Map;for(const Jr of Cr||[]){const Mn=String(Jr.produto_id),ha=Number(Jr.quantidade||0);wr.set(Mn,(wr.get(Mn)||0)+ha)}y(wr)}let Lt=[];try{Lt=await wd({codigoEmpresa:se})}catch(wr){console.error("[VendasPage:load] Erro ao carregar comandas abertas:",wr)}const vn=await(async()=>{try{return await JS((Lt||[]).map(wr=>wr.id),se)}catch{return{}}})(),Xr=await(async()=>{try{const wr=await Promise.all((Lt||[]).map(async Jr=>{try{const ha=(await rl({comandaId:Jr.id,codigoEmpresa:se})||[]).map(is=>is?.nome).filter(Boolean);return[Jr.id,ha.length?ha.join(", "):null]}catch{return[Jr.id,null]}}));return Object.fromEntries(wr)}catch{return{}}})(),Or=new Map;(Lt||[]).forEach(wr=>Or.set(wr.mesa_id,wr));const fr=(Ar||[]).map(wr=>{const Jr=Or.get(wr.id);let Mn,ha=null,is=null,Gs=0,jn=null;return Jr?(Mn=Jr.status==="awaiting-payment"||Jr.status==="awaiting_payment"?"awaiting-payment":"in-use",ha=Jr.id,is=Xr[Jr.id]||null,Gs=vn[Jr.id]||0,jn=Jr.aberto_em||null):Mn="available",{id:wr.id,number:wr.numero,name:wr.nome||null,status:Mn,order:[],customer:is,comandaId:ha,totalHint:Gs,aberto_em:jn}}).map(wr=>i&&wr.id===i.id?{...wr,order:i.order||[],customer:i.customer||wr.customer}:wr);if(!on.current||wa.current!==Pt){clearTimeout(hr),clearTimeout(er);return}if(o(fr),(fr||[]).length===0)try{Se&&localStorage.removeItem(Se)}catch{}else try{Se&&localStorage.setItem(Se,JSON.stringify(fr))}catch{}const dn=se?`vendas:selected:${se}`:null;if(dn)try{const wr=localStorage.getItem(dn);if(wr){const Jr=fr.find(Mn=>String(Mn.id)===String(wr));Jr&&!Jr.comandaId&&localStorage.removeItem(dn)}}catch{}sa.current=Array.isArray(fr)?fr.length:0,ua.current=Date.now();let Dr=null;try{const wr=se?`vendas:selected:${se}`:null,Jr=wr?localStorage.getItem(wr):null;if(Jr){const Mn=fr.find(ha=>String(ha.id)===String(Jr));Mn&&(Dr=Mn)}}catch{}Dr?ve||l(wr=>!wr||wr.id!==Dr.id?Dr:{...Dr,order:wr.order||Dr.order||[],customer:wr.customer||Dr.customer||null,observacoes:wr.observacoes??Dr.observacoes??null,desconto_tipo:wr.desconto_tipo??Dr.desconto_tipo??null,desconto_valor:wr.desconto_valor??Dr.desconto_valor??0,desconto_motivo:wr.desconto_motivo??Dr.desconto_motivo??null}):ve||l(wr=>{const Jr=wr?fr.find(ha=>ha.id===wr.id):null;return Jr?{...Jr,order:wr.order||Jr.order||[],customer:wr.customer||Jr.customer||null,observacoes:wr.observacoes??Jr.observacoes??null,desconto_tipo:wr.desconto_tipo??Jr.desconto_tipo??null,desconto_valor:wr.desconto_valor??Jr.desconto_valor??0,desconto_motivo:wr.desconto_motivo??Jr.desconto_motivo??null}:fr[0]||null}),clearTimeout(hr),clearTimeout(er)}catch(Pt){console.error("Erro ao carregar mesas:",Pt)}};return Ee(),r&&se&&it(),()=>{}},[r,t?.codigo_empresa]),p.useEffect(()=>{if(!r||!t?.codigo_empresa)return;let se=!1;const Se=t.codigo_empresa;return(async()=>{try{const Ee=await mf({includeInactive:!1,codigoEmpresa:Se});se||W(Ee||[])}catch(Ee){console.warn("Falha ao carregar produtos:",Ee?.message||Ee),se||W([])}})(),()=>{se=!0}},[r,t?.codigo_empresa]),p.useEffect(()=>{!r||!t?.codigo_empresa||Br()},[r,t?.codigo_empresa,Br]),p.useEffect(()=>{let se=!0;return(async()=>{try{if(!t?.codigo_empresa){se&&f(0);return}const Se=await wd({codigoEmpresa:t?.codigo_empresa});if(!se)return;f(Array.isArray(Se)?Se.length:0)}catch{se&&f(0)}})(),()=>{se=!1}},[t?.codigo_empresa,s.length]),p.useEffect(()=>{const se=t?.codigo_empresa||null,Se=se?`vendas:selected:${se}`:null;try{Se&&i?.id&&localStorage.setItem(Se,String(i.id))}catch{}i?.comandaId&&(!i.order||i.order.length===0)&&ot(i)},[i?.id,i?.comandaId]),p.useEffect(()=>()=>{},[i?.comandaId,Tt,ue]);const Va=async()=>{try{if(!i?.comandaId){e({title:"Selecione uma mesa com comanda aberta",variant:"warning"});return}await wm({codigoEmpresa:t?.codigo_empresa});try{const it=(await ii({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(hr=>({id:hr.id,productId:hr.produto_id,name:hr.descricao||"Item",price:Number(hr.preco_unitario||0),quantity:Number(hr.quantidade||1),desconto_tipo:hr.desconto_tipo||null,desconto_valor:Number(hr.desconto_valor||0),desconto_motivo:hr.desconto_motivo||null})),Pt={...i,order:it};l(Pt),o(hr=>hr.map(er=>er.id===Pt.id?Pt:er))}catch{}const se=await $h({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa});wt(se||[]);const Se=se&&se[0]&&se[0].id?se[0].id:null;Rr(Se),tt(Se),at(!0)}catch(se){e({title:"Falha ao carregar finalizadoras",description:se?.message||"Tente novamente",variant:"destructive"})}},J=se=>{if(!se.destination)return;const Se=Array.from(s),[Ee]=Se.splice(se.source.index,1);Se.splice(se.destination.index,0,Ee),o(Se),e({title:"Layout das mesas atualizado!",description:"As posies foram salvas temporariamente.",variant:"success"})},Oe=(se,Se)=>{let Ee=0;for(const Pt of se||[]){let hr=(Pt.price||0)*(Pt.quantity||1);Pt.desconto_tipo==="percentual"&&Pt.desconto_valor>0?hr*=1-Pt.desconto_valor/100:Pt.desconto_tipo==="fixo"&&Pt.desconto_valor>0&&(hr-=Pt.desconto_valor),Ee+=Math.max(0,hr)}let it=Ee;return Se?.desconto_tipo==="percentual"&&Se?.desconto_valor>0?it*=1-Se.desconto_valor/100:Se?.desconto_tipo==="fixo"&&Se?.desconto_valor>0&&(it-=Se.desconto_valor),Math.max(0,it)},Je=se=>{if(!se)return"";const Se=se.trim().split(/\s+/);return Se.length<=2?se:Se.slice(0,2).join(" ")},mr=se=>{if(!se)return"";const Se=it=>String(it).replace(/^\s*[\[]+\s*/g,"").replace(/\s*[\]]+\s*$/g,"").trim(),Ee=se.split(",").map(it=>Se(it)).filter(Boolean);return Ee.length===0?"":Ee.length===1?Je(Ee[0]):`${Je(Ee[0])} +${Ee.length-1}`},ot=async se=>{try{if(!se?.comandaId)return;const Ee=(await ii({comandaId:se.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(er=>({id:er.id,productId:er.produto_id,name:er.descricao||"Item",price:Number(er.preco_unitario||0),quantity:Number(er.quantidade||1),desconto_tipo:er.desconto_tipo||null,desconto_valor:Number(er.desconto_valor||0),desconto_motivo:er.desconto_motivo||null}));let it=se.customer||null;try{const Ar=(await rl({comandaId:se.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Cr=>Cr?.nome).filter(Boolean);it=Ar.length?Ar.join(", "):null}catch{}let Pt=se;try{const Ar=(await wd({codigoEmpresa:t?.codigo_empresa}))?.find(Cr=>Cr.id===se.comandaId);Ar&&(Pt={...se,desconto_tipo:Ar.desconto_tipo||null,desconto_valor:Number(Ar.desconto_valor||0),desconto_motivo:Ar.desconto_motivo||null,observacoes:Ar.observacoes||null})}catch{}const hr={...Pt,status:se.status==="awaiting-payment"?"awaiting-payment":"in-use",order:Ee,customer:it};l(hr),o(er=>er.map(Ar=>Ar.id===hr.id?hr:Ar))}catch(Se){console.warn("[VendasPage] Falha ao recarregar detalhes da mesa selecionada:",Se)}},ar=async({showToast:se=!1}={})=>{try{const Se=t?.codigo_empresa;if(!Se)return;const Ee=await Bh(Se);let it=[];try{it=await wd({codigoEmpresa:Se})}catch(Lt){console.error("[refreshTablesLight] Erro ao carregar comandas:",Lt)}const Pt=new Map((it||[]).map(Lt=>[Lt.mesa_id,Lt])),hr={},er={};try{const Lt=(it||[]).map(Or=>Or.id);(await Promise.all(Lt.map(async Or=>{try{return{id:Or,vinculos:await rl({comandaId:Or,codigoEmpresa:Se})}}catch{return{id:Or,vinculos:[]}}}))).forEach(({id:Or,vinculos:_n})=>{const fr=(_n||[]).map(dn=>dn?.nome).filter(Boolean);hr[Or]=fr.length?fr.join(", "):null}),(await Promise.all(Lt.map(async Or=>{try{const fr=(await ii({comandaId:Or,codigoEmpresa:Se})||[]).reduce((dn,Dr)=>{const wr=(Dr.quantidade||0)*(Dr.preco_unitario||0)-(Dr.desconto||0);return dn+wr},0);return{comandaId:Or,total:fr}}catch(_n){return console.error(`[refreshTablesLight] Erro ao buscar itens da comanda ${Or}:`,_n),{comandaId:Or,total:0}}}))).forEach(({comandaId:Or,total:_n})=>{er[Or]=_n})}catch(Lt){console.error("[refreshTablesLight] Erro ao carregar clientes/totais:",Lt)}const Cr=(Ee||[]).map(Lt=>{const vn=Pt.get(Lt.id);let Xr,Or=null,_n=null,fr=0;return vn?(Xr=vn.status==="awaiting-payment"||vn.status==="awaiting_payment"?"awaiting-payment":"in-use",Or=vn.id,_n=hr[vn.id]||null,fr=er[vn.id]||0):Xr="available",{id:Lt.id,number:Lt.numero,name:Lt.nome||null,status:Xr,order:[],customer:_n,comandaId:Or,totalHint:fr}}).map(Lt=>{if(i&&Lt.id===i.id)return i.status==="available"?{...Lt,status:"available",comandaId:null,order:[],customer:null,totalHint:0}:Lt.comandaId?{...Lt,order:i.order||[],customer:i.customer||Lt.customer}:{...Lt,order:[],customer:null};try{const vn=oe.current.get(Lt.id);if(vn&&Date.now()-vn<3e4)return{...Lt,status:"available",comandaId:null,order:[],customer:null,totalHint:0}}catch{}return Lt});if(o(Cr),i){const Lt=Cr.find(vn=>vn.id===i.id);Lt&&!Lt.comandaId&&l({...Lt,order:[],customer:null})}}catch(Se){console.error("[refreshTablesLight] Erro fatal:",Se),se&&e({title:"Erro ao atualizar mesas",description:"Recarregue a pgina se o problema persistir",variant:"destructive"})}},ir=p.useRef(null);p.useEffect(()=>{ir.current=i},[i]);const In=p.useRef(null),ln=p.useRef(null),Kr=p.useRef(null),oe=p.useRef(new Map);p.useEffect(()=>{const se=t?.codigo_empresa;if(!se)return;try{const it=typeof window<"u"?window.localStorage.getItem("custom-auth-token"):null;if(it&&it.trim())Q.realtime.setAuth(it.trim());else{let Pt="";try{Pt=(new URL(Q.supabaseUrl||"").host||"").split(".")[0]||""}catch{}const hr=Pt?`sb-${Pt}-auth-token`:"sb-auth-token",er=typeof window<"u"?window.localStorage.getItem(hr):null;if(er)try{const Ar=JSON.parse(er),Cr=Ar?.access_token||Ar?.currentSession?.access_token;Cr&&Q.realtime.setAuth(Cr)}catch{}}}catch{}const Se=Q.channel(`loja:${se}`),Ee=it=>{if(ta.current)return;const Pt=it?.table||it?.table_name||"",hr=it?.new||it?.old||{},er=it?.eventType||it?.type||it?.event||"";let Ar=!0;if(Pt!=="comanda_itens"&&Pt!=="comanda_clientes"){const Cr=hr?.codigo_empresa;Cr!=null&&Cr!==""&&(Ar=String(Cr)===String(se||""))}if(!Ar){try{console.log("[Realtime][Vendas] IGNORADO por empresa",{t:Pt,evt:er,rowEmpresa:hr?.codigo_empresa,codigoEmpresa:se})}catch{}return}try{console.log("[Realtime][Vendas] payload recebido",{t:Pt,evt:er,row:hr,codigoEmpresa:se})}catch{}(async()=>{try{await ar({showToast:!1})}catch{}})()};if(Se.on("postgres_changes",{event:"*",schema:"public",table:"comandas"},Ee).on("postgres_changes",{event:"*",schema:"public",table:"comanda_itens"},Ee).on("postgres_changes",{event:"*",schema:"public",table:"comanda_clientes"},Ee).on("postgres_changes",{event:"*",schema:"public",table:"pagamentos",filter:`codigo_empresa=eq.${se}`},Ee).on("postgres_changes",{event:"*",schema:"public",table:"mesas"},Ee).subscribe(),In.current=Se,Kr.current)try{clearInterval(Kr.current)}catch{}return Kr.current=setInterval(async()=>{if(!ta.current)try{await ar({showToast:!1})}catch{}},6e4),()=>{if(In.current){try{Q.removeChannel(In.current)}catch{}In.current=null}if(ln.current){try{clearTimeout(ln.current)}catch{}ln.current=null}if(Kr.current){try{clearInterval(Kr.current)}catch{}Kr.current=null}}},[t?.codigo_empresa]);const Ke=({table:se,provided:Se,isDragging:Ee})=>{const it=hst[se.status],Pt=it.icon,hr=Array.isArray(se.order)?se.order:[],er=hr.filter(Or=>String(Or.id||"").startsWith("tmp-")).reduce((Or,_n)=>Or+Number(_n.quantity||0)*Number(_n.price||0),0),Ar=hr.filter(Or=>!String(Or.id||"").startsWith("tmp-")).reduce((Or,_n)=>Or+Number(_n.quantity||0)*Number(_n.price||0),0),Cr=Number(se.totalHint||0);mr(se.customer);const Lt=se.status==="available"&&se.id===Ye,vn=se.status==="in-use"||se.status==="awaiting-payment"?(Cr>0?Cr:Ar)+er:0,Xr=se.status==="available"?"text-success bg-success/10 border-success/30":se.status==="in-use"?"text-warning bg-warning/10 border-warning/30":"text-info bg-info/10 border-info/30";return a.jsxs("div",{ref:Se?.innerRef,"data-table-id":se.id,...Se?.draggableProps||{},className:Er("p-4 rounded-lg border bg-surface flex flex-col relative h-44 shadow-sm min-w-[240px]",Ee&&"shadow-lg",S==="tables"&&i?.id===se.id&&"ring-2 ring-brand/60 bg-surface-2",c?"cursor-pointer":"cursor-not-allowed opacity-60"),onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}Xt(se)},children:[a.jsx("div",{...Se?.dragHandleProps||{},className:"absolute top-2 right-2 text-text-muted opacity-60 hover:opacity-100",children:a.jsx(Bue,{size:14})}),a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Pt,{className:"w-5 h-5 text-text-secondary"}),a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("span",{className:"text-lg font-semibold text-text-primary truncate",children:se.name?se.name:`Mesa ${se.number}`}),Lt&&a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F1"})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(se.status==="in-use"||se.status==="awaiting-payment")&&se.aberto_em&&a.jsxs("div",{className:"flex items-center gap-0.5 text-xs text-text-secondary",children:[a.jsx(xu,{className:"w-3.5 h-3.5 text-text-muted"}),a.jsx("span",{className:"font-medium",children:(()=>{try{const Or=new Date(se.aberto_em),fr=new Date-Or,dn=Math.floor(fr/6e4),Dr=Math.floor(dn/60),wr=dn%60;return dn<1?"agora":Dr===0?`${wr}m`:Dr>0&&wr===0?`${Dr}h`:`${Dr}h${wr}m`}catch{return""}})()})]}),a.jsx("span",{className:Er("text-[11px] font-medium px-2 py-0.5 rounded-full border flex-shrink-0",Xr),children:it.label})]})]}),a.jsx("div",{className:Er("flex-1 flex items-center justify-center"),children:se.status==="available"?a.jsx("img",{src:"/mesalivre.png",alt:"Mesa livre",className:Er("w-16 h-16 object-contain opacity-80",i?.id===se.id&&"opacity-100")}):se.status==="in-use"?a.jsx("img",{src:"/mesaocupada.png",alt:"Mesa ocupada",className:Er("w-16 h-16 object-contain opacity-80",i?.id===se.id&&"opacity-100")}):a.jsx("div",{className:Er("w-16 h-16 rounded-lg bg-info/20 border-2 border-info/40 flex items-center justify-center",i?.id===se.id&&"bg-info/30 border-info/60"),children:a.jsx(ol,{className:"w-8 h-8 text-info"})})}),a.jsx("div",{className:"w-full mt-auto",children:se.status==="in-use"||se.status==="awaiting-payment"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[a.jsx(vc,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),a.jsx("div",{className:"text-sm sm:text-base font-medium text-text-primary truncate",title:se.customer||"",children:mr(se.customer)||""})]}),a.jsxs("div",{className:"flex items-center gap-1 justify-between",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Vi,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),a.jsxs("div",{className:"text-sm font-bold text-text-secondary",children:["R$ ",vn.toFixed(2)]})]}),a.jsx("button",{onClick:Or=>{Or.stopPropagation(),n(`/historico?mesa=${se.id}`)},className:"p-1 hover:bg-surface-2 rounded transition-colors",title:"Ver histrico desta mesa",children:a.jsx(ol,{className:"w-4 h-4 text-text-secondary hover:text-text-primary"})})]})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Sem comanda"}),a.jsx("button",{onClick:Or=>{Or.stopPropagation(),n(`/historico?mesa=${se.id}`)},className:"p-1 hover:bg-surface-2 rounded transition-colors",title:"Ver histrico desta mesa",children:a.jsx(ol,{className:"w-4 h-4 text-text-secondary hover:text-text-primary"})})]})})]})},ct=()=>{const se=i?Oe(i.order,i):0,[Se,Ee]=p.useState(!1),[it,Pt]=p.useState([]),[hr,er]=p.useState(1),[Ar,Cr]=p.useState([]),Lt=p.useRef(new Map),vn=typeof window<"u"&&window.innerWidth<=640,Xr=p.useRef(!1),Or=Nr=>{const an=String(Nr||"").replace(/\D/g,"");return an?Number(an)/100:0},_n=Nr=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.max(0,Number(Nr)||0)),fr=Nr=>{const an=(De||[]).find(Sn=>String(Sn.id)===String(Nr.methodId)),Nn=an&&an.taxa_percentual!=null?Number(an.taxa_percentual):0;return Number.isFinite(Nn)?Nn/100:0},dn=Nr=>(De||[]).find(an=>String(an.id)===String(Nr)),[Dr,wr]=p.useState(null);p.useEffect(()=>(Ae.current=Pt,et.current=er,br.current=i?.comandaId||null,()=>{Ae.current=null,et.current=null,br.current=null}),[i?.comandaId]),p.useEffect(()=>{Zt.current=it||[]},[it]);const Jr=(Nr,an)=>{try{if(vn)return;const Nn=(it||[]).findIndex(Sn=>Sn.id===an);if(Nn>=0){const Sn=(it||[])[Nn+1]||null;if(Sn&&Lt.current.get(Sn.id)){const hn=Lt.current.get(Sn.id);setTimeout(()=>{try{hn.focus(),hn.select?.()}catch{}},0);return}}if(Nr&&Nr instanceof HTMLElement){const Sn=Array.from(document.querySelectorAll('input[data-pay-value="1"]')),hn=Sn.indexOf(Nr);if(hn>=0&&Sn[hn+1]){const Pr=Sn[hn+1];setTimeout(()=>{try{Pr.focus(),Pr.select?.()}catch{}},0);return}}Xr.current=!0,Pt(Sn=>{const hn=Ar[0]?.id||"",Pr=De&&De[0]&&De[0].id?De[0].id:null,pn=Array.isArray(Sn)?Sn:[],kr=pn.reduce((Ir,re)=>Math.max(Ir,Number(re?.id||0)),0)+1,Vr=[...pn,{id:kr,clientId:hn,methodId:Pr,value:"",chargeFee:!0}];return er(Ir=>Math.max(Ir,kr+1)),vn||setTimeout(()=>{const Ir=Lt.current.get(kr);if(Ir)try{Ir.focus(),Ir.select?.()}catch{}},0),Vr})}catch{}};p.useEffect(()=>{let Nr=!0;return(async()=>{try{if(!ve||!i?.comandaId)return;let Nn=[],Sn=[];try{const[Ir,re]=await Promise.all([dKe({comandaId:i.comandaId,status:"Pendente",codigoEmpresa:t?.codigo_empresa}).catch(()=>[]),rl({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa}).catch(()=>[])]);Nn=Array.isArray(Ir)?Ir:[],Sn=(Array.isArray(re)?re:[]).map(Ge=>{const ge=Ge?.cliente_id??Ge?.clientes?.id??Ge?.id??null,nt=Ge?.clientes?.nome??Ge?.nome??Ge?.nome_livre??"";return!ge&&nt?{id:`livre-${Ge?.id||Math.random()}`,nome:nt}:ge?{id:ge,nome:nt}:null}).filter(Boolean)}catch{}if(!Nr)return;if(Cr(Sn),Array.isArray(Nn)&&Nn.length>0){const Ir=Nn.map((re,we)=>{const Ge=Number(re.valor||0),nt={id:we+1,clientId:re.cliente_id||null,methodId:re.finalizadora_id||null,chargeFee:!0},st=fr(nt),je=Ge,ht=nt.chargeFee!==!1?je*(1+st):je;return{...nt,baseValue:je,value:_n(ht)}});Pt(Ir),er(Ir.length+1),Xr.current=!1;return}let hn=De&&De[0]&&De[0].id?De[0].id:null,Pr=Sn[0]?.id||null;const pn=se>0?se:0,vr={id:1,clientId:Pr,methodId:hn,baseValue:pn,chargeFee:!0},kr=fr(vr),Vr=vr.chargeFee?pn*(1+kr):pn;Pt([{...vr,value:_n(Vr)}]),er(2),Xr.current=!1}catch(Nn){console.error(Nn)}})(),()=>{Nr=!1}},[ve,i?.comandaId]),p.useEffect(()=>{if(!ve||!i?.comandaId||!Array.isArray(it)||it.length===0||!Xr.current)return;ke.current&&clearTimeout(ke.current);const Nr=setTimeout(async()=>{if(Xr.current)try{const an=(it||[]).map(Nn=>{const Sn=Number(Nn.baseValue||0),hn=(De||[]).find(pn=>String(pn.id)===String(Nn.methodId)),Pr=hn?.tipo||hn?.nome||"outros";return{clienteId:Nn.clientId||null,finalizadoraId:Nn.methodId||null,metodo:Pr,valor:Sn}});Aa.current=Date.now(),await Gx({comandaId:i.comandaId,linhas:an,codigoEmpresa:t?.codigo_empresa})}catch(an){console.warn("[PayDialog] Falha ao salvar rascunho de pagamentos (debounced):",an)}},400);return ke.current=Nr,()=>{clearTimeout(Nr),ke.current===Nr&&(ke.current=null)}},[ve,i?.comandaId,it,De,t?.codigo_empresa]),p.useEffect(()=>{let Nr=!0;return(async()=>{try{if(!ve||Array.isArray(De)&&De.length>0)return;const Nn=await $h({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa});if(!Nr)return;wt(Nn||[])}catch{}})(),()=>{Nr=!1}},[ve]),p.useEffect(()=>{ve&&(!Array.isArray(De)||De.length===0||Pt(Nr=>{if(!Array.isArray(Nr)||Nr.length===0)return Nr;const an=De&&De[0]&&De[0].id?De[0].id:null;if(!an)return Nr;let Nn=!1;const Sn=Nr.map(hn=>{if(!hn.methodId){Nn=!0;const Pr={...hn,methodId:an},pn=fr(Pr),vr=Pr.chargeFee!==!1?Number(Pr.baseValue||0)*(1+pn):Number(Pr.baseValue||0);return{...Pr,value:_n(vr)}}return hn});return Nn?Sn:Nr}))},[ve,De]);const Mn=async()=>{try{if(!i?.comandaId)return;const Nr=t?.codigo_empresa;if(!Nr){e({title:"Empresa no definida",variant:"destructive"});return}if(!Array.isArray(it)||it.length===0){e({title:"Informe os pagamentos",description:"Adicione pelo menos uma forma de pagamento.",variant:"warning"});return}for(const re of it){if(!re.methodId){e({title:"Forma de pagamento faltando",description:"Selecione a finalizadora em todas as linhas.",variant:"warning"});return}if(Or(re.value)<=0){e({title:"Valor invlido",description:"Informe valores maiores que zero.",variant:"warning"});return}}be(!0);const an=se>0?se:0,Nn=(it||[]).reduce((re,we)=>re+Or(we.value),0),Sn=(it||[]).reduce((re,we)=>{const Ge=Number(we.baseValue||0),ge=fr(we);return re+(we.chargeFee!==!1&&ge>0?Ge*ge:0)},0),hn=an+Sn,Pr=Nn-hn,pn=Math.abs(Pr),vr=i.comandaId,kr=i.id;o(re=>re.map(we=>we.id===kr?{...we,status:"available",order:[],comandaId:null,customer:null,totalHint:0}:we)),l(re=>re&&re.id===kr?null:re),at(!1);try{Tr(!1)}catch{}let Vr=se;if(Vr<=0)try{Vr=(await ii({comandaId:vr,codigoEmpresa:t?.codigo_empresa})||[]).reduce((Ge,ge)=>Ge+Number(ge.quantidade||0)*Number(ge.preco_unitario||0),0)}catch{}Ee(!0),be(!0),await wm({codigoEmpresa:t?.codigo_empresa});try{const re=(it||[]).map(we=>{const Ge=Number(we.baseValue||0),ge=(De||[]).find(st=>String(st.id)===String(we.methodId)),nt=ge?.tipo||ge?.nome||"outros";return{clienteId:we.clientId||null,finalizadoraId:we.methodId||null,metodo:nt,valor:Ge}});await Gx({comandaId:vr,linhas:re,codigoEmpresa:Nr})}catch(re){console.warn("[PayDialog] Falha ao salvar rascunho antes de promover:",re)}await uKe({comandaId:vr,codigoEmpresa:Nr}),await V0({comandaId:vr,codigoEmpresa:t?.codigo_empresa,diferencaPagamento:Pr});try{t?.codigo_empresa&&localStorage.removeItem(`vendas:tables:${t.codigo_empresa}`)}catch{}try{const re=await Bh(t?.codigo_empresa),we=await wd({codigoEmpresa:t?.codigo_empresa}),Ge={};await Promise.all((we||[]).map(async nt=>{try{const je=(await rl({comandaId:nt.id,codigoEmpresa:t?.codigo_empresa})||[]).map(ht=>ht?.nome).filter(Boolean);Ge[nt.id]=je.length?je.join(", "):null}catch{Ge[nt.id]=null}}));const ge=(re||[]).map(nt=>{const st=(we||[]).find(je=>je.mesa_id===nt.id);return{id:nt.id,name:nt.nome||`Mesa ${nt.numero}`,status:st?"in-use":"available",comandaId:st?.id||null,customer:st?Ge[st.id]:null,order:[],totalHint:0,aberto_em:st?.aberto_em||null}});o(ge)}catch{}const Ir=pn>.009?Pr>0?` | Diferena cobrada a mais: R$ ${pn.toFixed(2)}`:` | Diferena cobrada a menos: R$ ${pn.toFixed(2)}`:"";e({title:"Pagamento registrado",description:`Total itens R$ ${Vr.toFixed(2)} | Pagamentos R$ ${Nn.toFixed(2)}${Ir}`,variant:"success"})}catch(Nr){e({title:"Falha ao registrar pagamento",description:Nr?.message||"Tente novamente",variant:"destructive"})}finally{Ee(!1),be(!1)}};it&&it.length>0;const ha=se>0?se:0,is=(it||[]).reduce((Nr,an)=>Nr+Or(an.value),0),Gs=(it||[]).reduce((Nr,an)=>{const Nn=Number(an.baseValue||0),Sn=fr(an);return Nr+(an.chargeFee!==!1&&Sn>0?Nn*Sn:0)},0),jn=ha+Gs;return a.jsx(zn,{open:ve,onOpenChange:Nr=>{He||at(Nr)},children:a.jsxs(qn,{onOpenAutoFocus:Nr=>Nr.preventDefault(),className:"sm:max-w-xl w-[92vw] max-h-[80vh] min-h-0 animate-none flex flex-col overflow-hidden p-3 sm:p-6",onKeyDown:Nr=>Nr.stopPropagation(),onKeyDownCapture:Nr=>Nr.stopPropagation(),children:[a.jsx(Bn,{className:"flex flex-col gap-1 pr-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3",children:[a.jsx($n,{className:"text-2xl font-bold",children:"Fechar Conta"}),!Ot&&a.jsx(Z,{type:"button",size:"sm",variant:"outline",className:"self-start sm:self-auto",onClick:()=>Gt(!0),children:"Desconto"})]})}),a.jsxs("div",{className:"flex-1 min-h-0 flex flex-col space-y-2",children:[(()=>{let Nr=0,an=0;for(const hn of i?.order||[]){const Pr=(hn.price||0)*(hn.quantity||1);Nr+=Pr,hn.desconto_tipo==="percentual"&&hn.desconto_valor>0?an+=Pr*(hn.desconto_valor/100):hn.desconto_tipo==="fixo"&&hn.desconto_valor>0&&(an+=hn.desconto_valor)}const Nn=Nr-an;let Sn=0;return i?.desconto_tipo==="percentual"&&i?.desconto_valor>0?Sn=Nn*(i.desconto_valor/100):i?.desconto_tipo==="fixo"&&i?.desconto_valor>0&&(Sn=i.desconto_valor),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm text-text-secondary",children:[a.jsx("span",{children:"Subtotal"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Nr.toFixed(2)]})]}),Sn>5e-4&&a.jsxs("div",{className:"flex items-center justify-between text-sm text-destructive",children:[a.jsx("span",{children:"Desconto da comanda"}),a.jsxs("span",{className:"font-semibold",children:["-R$ ",Sn.toFixed(2)]})]}),a.jsxs("div",{className:"border-t border-border pt-1 mt-1 flex items-center justify-between text-lg font-semibold",children:[a.jsx("span",{children:"Total com desconto"}),a.jsxs("span",{children:["R$ ",se.toFixed(2)]})]})]})})(),(()=>{const Nr=jn,an=is;let Nn=Nr-an,Sn=0;return Nn<0&&(Sn=Math.abs(Nn),Nn=0),a.jsxs("div",{className:"space-y-1 text-xs text-text-muted pt-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Total a pagar"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Nr.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Pagamentos"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",an.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center justify-between font-semibold",children:[a.jsx("span",{children:"Restante"}),a.jsxs("span",{className:Math.abs(Nn)<.005?"text-emerald-600":"text-amber-600",children:["R$ ",Nn.toFixed(2)]})]}),Sn>0&&a.jsxs("div",{className:"flex items-center justify-between font-semibold",children:[a.jsx("span",{children:"Troco"}),a.jsxs("span",{children:["R$ ",Sn.toFixed(2)]})]})]})})(),a.jsxs("div",{className:"flex-1 space-y-2 overflow-y-auto thin-scroll pr-0 sm:pr-1",children:[a.jsx(lt,{className:"block",children:"Pagamentos"}),a.jsx("div",{className:"sm:hidden space-y-2",children:(it||[]).map((Nr,an)=>{const Nn=hn=>{if(!hn)return"Cliente";const Pr=(Ar||[]).find(pn=>String(pn.id)===String(hn));return Pr?.nome?Pr.nome:"Cliente"};(Ar||[]).length>1;const Sn=(Ar||[])[0]||null;return a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"rounded-md bg-surface-2 border border-border overflow-hidden",children:[a.jsxs("button",{type:"button",className:"w-full flex items-center justify-between gap-2 px-3 py-2 text-left",onClick:()=>wr(hn=>hn===Nr.id?null:Nr.id),children:[a.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[a.jsx("span",{className:"text-xs text-text-secondary truncate",children:Nn(Sn?.id||Nr.clientId)}),a.jsxs("span",{className:"text-xs font-semibold text-text-primary truncate",children:[Nr.methodId&&dn(Nr.methodId)?.nome||"Forma no selecionada","  R$ ",Nr.value||"0,00"]})]}),a.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:it.length>1&&an>0&&a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:hn=>{hn.stopPropagation(),Xr.current=!0,Pt(Pr=>{const pn=Pr.filter(Ir=>Ir.id!==Nr.id);if(pn.length===0)return[];const vr=se>0?se:0,kr=Math.floor(vr/pn.length*100)/100,Vr=vr-kr*pn.length;return pn.map((Ir,re)=>{const we=re===pn.length-1?kr+Vr:kr,Ge={...Ir},ge=fr(Ge),st=Ge.chargeFee!==!1&&ge>0?we/(1+ge):we;return{...Ge,baseValue:st,value:_n(we)}})})},children:a.jsx(Sc,{className:"h-3 w-3"})})})]}),Dr===Nr.id&&a.jsxs("div",{className:"px-3 pb-3 pt-1 space-y-2 border-t border-border/60",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(ea,{value:String(Nr.methodId||""),onValueChange:hn=>{Xr.current=!0;const Pr=(it||[]).map(pn=>{if(pn.id!==Nr.id)return pn;const vr=String(hn),kr={...pn,methodId:vr},Vr=fr(kr),Ir=kr.chargeFee!==!1?Number(kr.baseValue||0)*(1+Vr):Number(kr.baseValue||0);return{...kr,value:_n(Ir)}});Pt(Pr);try{const pn=i?.comandaId,vr=t?.codigo_empresa;if(pn&&vr){const kr=Pr.map(Vr=>{const Ir=Number(Vr.baseValue||0),re=(De||[]).find(Ge=>String(Ge.id)===String(Vr.methodId)),we=re?.tipo||re?.nome||"outros";return{clienteId:Vr.clientId||null,finalizadoraId:Vr.methodId||null,metodo:we,valor:Ir}});Aa.current=Date.now(),Gx({comandaId:pn,linhas:kr,codigoEmpresa:vr}).then(()=>{}).catch(Vr=>{console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora (bg):",Vr),Xr.current=!0}),Xr.current=!1}}catch(pn){console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora:",pn)}},children:[a.jsx(Jn,{className:"flex-1 h-9 truncate text-sm",children:a.jsx(ra,{placeholder:"Forma de pagamento"})}),a.jsx(Qn,{children:(De||[]).map(hn=>a.jsx(Qe,{value:String(hn.id),children:hn.nome},String(hn.id)))})]}),a.jsx(At,{placeholder:"0,00",inputMode:"numeric",value:Nr.value,className:"w-28 h-9 text-sm",onChange:hn=>{Xr.current=!0;const Pr=(hn.target.value||"").replace(/\D/g,""),pn=Pr?Number(Pr)/100:0;Pt(vr=>vr.map(kr=>{if(kr.id!==Nr.id)return kr;const Vr=fr(kr),Ir=kr.chargeFee!==!1&&Vr>0?pn/(1+Vr):pn,re=kr.chargeFee!==!1?Ir*(1+Vr):Ir;return{...kr,baseValue:Ir,value:_n(re)}}))},onKeyDown:hn=>{if(hn.stopPropagation(),hn.key==="Enter"){hn.preventDefault(),Jr(hn.currentTarget,Nr.id);return}["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(hn.key)||/^[0-9]$/.test(hn.key)||hn.preventDefault()},onBeforeInput:hn=>{const Pr=hn.data??"";Pr&&/\D/.test(Pr)&&hn.preventDefault()}})]}),a.jsx("div",{className:"-mt-1 pl-1",children:(()=>{const hn=fr(Nr),Pr=hn*100,pn=Nr.chargeFee!==!1,vr=Nr.baseValue!=null?Number(Nr.baseValue):(()=>{const Ir=(Nr.value||"").toString().replace(/\D/g,""),re=Ir?Number(Ir)/100:0;return pn&&hn>0?re/(1+hn):re})();if(!Pr||Pr<=0||!Number.isFinite(vr)||vr<=0)return null;const kr=pn?vr*hn:0;return a.jsxs("button",{type:"button",onClick:async()=>{Xr.current=!0;const Vr=(it||[]).map(Ir=>{if(Ir.id!==Nr.id)return Ir;const re=fr(Ir),we=Ir.chargeFee!==!1,Ge=Ir.baseValue!=null?Number(Ir.baseValue):Or(Ir.value),ge=we?Ge:Ge*(1+re);return{...Ir,chargeFee:!we,baseValue:Ge,value:_n(ge)}});Pt(Vr);try{const Ir=i?.comandaId,re=t?.codigo_empresa;if(Ir&&re){const we=Vr.map(Ge=>({clienteId:Ge.clientId||null,finalizadoraId:Ge.methodId||null,metodo:(De||[]).find(ge=>String(ge.id)===String(Ge.methodId))?.tipo||(De||[]).find(ge=>String(ge.id)===String(Ge.methodId))?.nome||"outros",valor:Number(Ge.baseValue||0)}));Aa.current=Date.now(),await Gx({comandaId:Ir,linhas:we,codigoEmpresa:re}),Xr.current=!1}}catch(Ir){console.warn("[PayDialog] Falha ao salvar rascunho aps alternar taxa:",Ir)}},className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",pn?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:pn?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",pn?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",kr.toFixed(2)]})]})})()})]})]})},"payline-m-"+Nr.id)})}),(it||[]).map((Nr,an)=>{const Nn=Pr=>{if(!Pr)return"Cliente";const pn=(Ar||[]).find(vr=>String(vr.id)===String(Pr));return pn?.nome?pn.nome:"Cliente"},Sn=(Ar||[]).length>1,hn=(Ar||[])[0]||null;return(Ar||[]).filter(Pr=>String(Pr.id)!==String(hn?.id||"")),a.jsxs("div",{className:"hidden sm:grid sm:grid-cols-12 gap-2 items-center",children:[a.jsx("div",{className:"sm:col-span-1 flex sm:justify-start",children:it.length>1&&an>0&&a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"h-8 w-8",onClick:()=>{Xr.current=!0,Pt(Pr=>{const pn=Pr.filter(Ir=>Ir.id!==Nr.id);if(pn.length===0)return[];const vr=se>0?se:0,kr=Math.floor(vr/pn.length*100)/100,Vr=vr-kr*pn.length;return pn.map((Ir,re)=>{const we=re===pn.length-1?kr+Vr:kr,Ge={...Ir},ge=fr(Ge),st=Ge.chargeFee!==!1&&ge>0?we/(1+ge):we;return{...Ge,baseValue:st,value:_n(we)}})})},children:a.jsx(Sc,{size:14})})}),an===0?a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:Nn(hn?.id||Nr.clientId)})}):Sn?a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(ea,{value:Nr.clientId||"",onValueChange:Pr=>Pt(pn=>pn.map(vr=>vr.id===Nr.id?{...vr,clientId:Pr}:vr)),children:[a.jsx(Jn,{className:"w-full truncate",children:a.jsx(ra,{placeholder:"Cliente"})}),a.jsx(Qn,{children:(Ar||[]).map(Pr=>a.jsx(Qe,{value:Pr.id,children:Pr.nome},Pr.id))})]})}):a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:Nn(hn?.id||Nr.clientId)})}),a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(ea,{value:String(Nr.methodId||""),onValueChange:Pr=>{Xr.current=!0;const pn=(it||[]).map(vr=>{if(vr.id!==Nr.id)return vr;const kr=String(Pr),Vr={...vr,methodId:kr},Ir=fr(Vr),re=Vr.chargeFee!==!1?Number(Vr.baseValue||0)*(1+Ir):Number(Vr.baseValue||0);return{...Vr,value:_n(re)}});Pt(pn);try{const vr=i?.comandaId,kr=t?.codigo_empresa;if(vr&&kr){const Vr=pn.map(Ir=>{const re=Number(Ir.baseValue||0),we=(De||[]).find(ge=>String(ge.id)===String(Ir.methodId)),Ge=we?.tipo||we?.nome||"outros";return{clienteId:Ir.clientId||null,finalizadoraId:Ir.methodId||null,metodo:Ge,valor:re}});Aa.current=Date.now(),Gx({comandaId:vr,linhas:Vr,codigoEmpresa:kr}).then(()=>{}).catch(Ir=>{console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora (bg):",Ir),Xr.current=!0}),Xr.current=!1}}catch(vr){console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora:",vr)}},children:[a.jsx(Jn,{className:"w-full truncate",children:a.jsx(ra,{placeholder:"Forma de pagamento"})}),a.jsx(Qn,{children:(De||[]).map(Pr=>a.jsx(Qe,{value:String(Pr.id),children:Pr.nome},String(Pr.id)))})]})}),a.jsx("div",{className:"sm:col-span-3",children:a.jsx(At,{placeholder:"0,00",inputMode:"numeric",value:Nr.value,"data-pay-value":"1",ref:Pr=>{Pr?Lt.current.set(Nr.id,Pr):Lt.current.delete(Nr.id)},onChange:Pr=>{Xr.current=!0;const pn=(Pr.target.value||"").replace(/\D/g,""),vr=pn?Number(pn)/100:0;Pt(kr=>kr.map(Vr=>{if(Vr.id!==Nr.id)return Vr;const Ir=fr(Vr),re=Vr.chargeFee!==!1&&Ir>0?vr/(1+Ir):vr,we=Vr.chargeFee!==!1?re*(1+Ir):re;return{...Vr,baseValue:re,value:_n(we)}}))},onKeyDown:Pr=>{if(Pr.stopPropagation(),Pr.key==="Enter"){Pr.preventDefault(),Jr(Pr.currentTarget,Nr.id);return}["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Pr.key)||/^[0-9]$/.test(Pr.key)||Pr.preventDefault()},onBeforeInput:Pr=>{const pn=Pr.data??"";pn&&/\D/.test(pn)&&Pr.preventDefault()}})}),a.jsx("div",{className:"sm:col-span-12 -mt-1 pl-1",children:(()=>{const Pr=fr(Nr),pn=Pr*100,vr=Nr.chargeFee!==!1,kr=Nr.baseValue!=null?Number(Nr.baseValue):(()=>{const re=(Nr.value||"").toString().replace(/\D/g,""),we=re?Number(re)/100:0;return vr&&Pr>0?we/(1+Pr):we})();if(!pn||pn<=0||!Number.isFinite(kr)||kr<=0)return null;const Vr=vr?kr*Pr:0;return a.jsxs("button",{type:"button",onClick:async()=>{Xr.current=!0;const Ir=(it||[]).map(re=>{if(re.id!==Nr.id)return re;const we=fr(re),Ge=re.chargeFee!==!1,ge=re.baseValue!=null?Number(re.baseValue):Or(re.value),nt=Ge?ge:ge*(1+we);return{...re,chargeFee:!Ge,baseValue:ge,value:_n(nt)}});Pt(Ir);try{const re=i?.comandaId,we=t?.codigo_empresa;if(re&&we){const Ge=Ir.map(ge=>({clienteId:ge.clientId||null,finalizadoraId:ge.methodId||null,metodo:(De||[]).find(nt=>String(nt.id)===String(ge.methodId))?.tipo||(De||[]).find(nt=>String(nt.id)===String(ge.methodId))?.nome||"outros",valor:Number(ge.baseValue||0)}));Aa.current=Date.now(),await Gx({comandaId:re,linhas:Ge,codigoEmpresa:we}),Xr.current=!1}}catch(re){console.warn("[PayDialog] Falha ao salvar rascunho aps alternar taxa:",re)}},className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",vr?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:vr?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",vr?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",Vr.toFixed(2)]})]})})()})]},"payline-"+Nr.id)}),a.jsx("div",{children:a.jsx(Z,{type:"button",variant:"secondary",size:"sm",className:"pointer-events-auto",onClick:Nr=>{Nr.preventDefault(),Nr.stopPropagation(),Xr.current=!0,Pt(an=>{const Nn=Array.isArray(an)?an:[],hn=Nn.reduce((we,Ge)=>Math.max(we,Number(Ge?.id||0)),0)+1,Pr=Ar[0]?.id||"",pn=De&&De[0]&&De[0].id?De[0].id:null,vr=[...Nn,{id:hn,clientId:Pr,methodId:pn,value:"",chargeFee:!0}],kr=se>0?se:0,Vr=Math.floor(kr/vr.length*100)/100,Ir=kr-Vr*vr.length,re=vr.map((we,Ge)=>{const ge=Ge===vr.length-1?Vr+Ir:Vr,nt=fr(we),je=we.chargeFee!==!1&&nt>0?ge/(1+nt):ge;return{...we,baseValue:je,value:_n(ge)}});return er(we=>Math.max(we,hn+1)),re})},children:"Adicionar forma"})})]})]}),a.jsxs(Ua,{className:"sticky bottom-0 bg-surface/95 backdrop-blur supports-[backdrop-filter]:bg-surface/75 border-t border-border",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>at(!1),disabled:Se,children:"Cancelar"}),a.jsx(Z,{type:"button",onClick:Mn,disabled:!(it&&it.length>0&&!Se),children:Se?"Processando...":"Confirmar Pagamento"})]})]})})},xe=Ce.memo(({open:se,onOpenChange:Se,cashSummary:Ee})=>{const it=Jr=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Jr||0)),[Pt,hr]=p.useState(!0);p.useEffect(()=>{hr(!!se)},[se]);const er=p.useMemo(()=>{const Jr=Number(Ee?.saldo_inicial??Ee?.saldoInicial??0),Mn=Ee?.totalPorFinalizadora||Ee?.porFinalizadora||{},ha=Number(Ee?.totalEntradas??Ee?.entradas??0),is=ha>0?ha:Object.values(Mn||{}).reduce((an,Nn)=>an+Number(Nn||0),0),Gs=Number(Ee?.sangria??Ee?.totalSangria??0),jn=Number(Ee?.totalSaidas??Ee?.saidas??Gs),Nr=Math.max(0,Jr+is-jn);return{saldoInicial:Jr,porFinalizadora:Mn,entradasInformadas:ha,entradasCalc:is,sangriaVal:Gs,saidas:jn,saldoAtual:Nr}},[Ee]);p.useEffect(()=>{if(se&&Ee){const Jr=setTimeout(()=>hr(!1),50);return()=>clearTimeout(Jr)}},[se,Ee]);const{porFinalizadora:Ar,sangriaVal:Cr}=er,[Lt,vn]=p.useState(!1),[Xr,Or]=p.useState(""),[_n,fr]=p.useState(""),[dn,Dr]=p.useState(!1),wr=async()=>{try{Dr(!0);const Jr=String(Xr||"").replace(/\D/g,""),Mn=Jr?Number(Jr)/100:0;if(Mn<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await wm({codigoEmpresa:t?.codigo_empresa}),await u3({tipo:"sangria",valor:Mn,observacao:_n,codigoEmpresa:t?.codigo_empresa}),vn(!1),Or(""),fr(""),await Wn(),e({title:"Sangria registrada",variant:"success"})}catch(Jr){e({title:"Falha ao registrar sangria",description:Jr?.message||"Tente novamente",variant:"destructive"})}finally{Dr(!1)}};return a.jsx(zn,{open:se,onOpenChange:Se,children:a.jsxs(qn,{forceMount:!0,className:"sm:max-w-lg w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden",onOpenAutoFocus:Jr=>Jr.preventDefault(),onKeyDown:Jr=>Jr.stopPropagation(),onKeyDownCapture:Jr=>Jr.stopPropagation(),onPointerDownOutside:Jr=>Jr.stopPropagation(),onInteractOutside:Jr=>Jr.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),a.jsx(la,{children:"Resumo da sesso atual do caixa."})]}),Pt||!Ee?a.jsxs("div",{className:"px-4 space-y-3",children:[a.jsx(tv,{className:"h-16 w-full"}),a.jsx(tv,{className:"h-16 w-full"}),a.jsx(tv,{className:"h-12 w-full"})]}):a.jsxs("div",{className:"px-1",children:[Object.keys(Ar).length===0?a.jsx("div",{className:"p-3 text-sm text-text-muted border rounded-md",children:"Nenhuma finalizadora registrada ainda."}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"rounded-md border border-border overflow-hidden divide-y divide-border",children:Object.entries(Ar).map(([Jr,Mn])=>a.jsxs("li",{className:"bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:String(Jr)}),a.jsx("span",{className:"text-sm font-semibold tabular-nums",children:it(Mn)})]},Jr))}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Sangrias"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-danger",children:it(Cr)})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted leading-relaxed px-1",children:'Sadas incluem sangrias e ajustes. Use "Registrar Sangria" para lanar uma retirada.'})]}),a.jsxs(Ua,{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"mr-auto"}),a.jsx(Z,{variant:"destructive",onClick:()=>vn(!0),children:"Registrar Sangria"}),a.jsx(Z,{variant:"secondary",onClick:()=>Se(!1),children:"Fechar"})]}),a.jsx(zn,{open:Lt,onOpenChange:vn,children:a.jsxs(qn,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Jr=>Jr.stopPropagation(),onKeyDownCapture:Jr=>Jr.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold",children:"Registrar Sangria"}),a.jsx(la,{children:"Informe o valor a retirar do caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"sangria-valor",children:"Valor"}),a.jsx(At,{id:"sangria-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:Xr,onChange:Jr=>{const Mn=(Jr.target.value||"").replace(/\D/g,""),ha=Mn?Number(Mn)/100:0,is=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(ha);Or(is)},onKeyDown:Jr=>{Jr.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Jr.key)&&(/^[0-9]$/.test(Jr.key)||Jr.preventDefault())},onBeforeInput:Jr=>{const Mn=Jr.data??"";Mn&&/\D/.test(Mn)&&Jr.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"sangria-obs",children:"Observao"}),a.jsx(At,{id:"sangria-obs",placeholder:"Opcional",value:_n,onChange:Jr=>fr(Jr.target.value)})]})]}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>vn(!1),disabled:dn,children:"Cancelar"}),a.jsx(Z,{onClick:wr,disabled:dn,children:dn?"Registrando...":"Confirmar"})]})]})})]})})}),$e=()=>{const se=async()=>{if(U)try{await Mv({itemId:U.id,codigoEmpresa:t?.codigo_empresa});try{await ot(i)}catch{}e({title:"Item removido",description:U.name,variant:"warning"})}catch(Se){e({title:"Falha ao remover item",description:Se?.message||"Tente novamente",variant:"destructive"})}finally{de(!1),L(null)}};return a.jsx(Xu,{open:G,onOpenChange:de,children:a.jsxs(nu,{children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Remover item?"}),a.jsxs(iu,{children:['Tem certeza que deseja remover "',U?.name,'" da comanda? Esta ao no pode ser desfeita.']})]}),a.jsxs(su,{children:[a.jsx(lu,{children:"Cancelar"}),a.jsx(Yu,{onClick:se,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})})},Pe=()=>{const se=i,Se=se?.order||[],Ee=se?Oe(Se):0;return a.jsx(zn,{open:F,onOpenChange:V,children:a.jsxs(qn,{className:"sm:max-w-xl w-[92vw] animate-none",onKeyDown:it=>it.stopPropagation(),onKeyDownCapture:it=>it.stopPropagation(),onPointerDownOutside:it=>it.stopPropagation(),onInteractOutside:it=>it.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsxs($n,{className:"text-2xl font-bold",children:["Comanda da Mesa ",se?.number??""]}),a.jsx(la,{children:se?.customer?`Cliente: ${se.customer}`:"Sem cliente vinculado"})]}),a.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto thin-scroll",children:Se.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum item na comanda."}):a.jsx("ul",{className:"divide-y divide-border",children:Se.map(it=>a.jsxs("li",{className:"py-2 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:it.name}),a.jsxs("div",{className:"text-xs text-text-muted",children:["Qtd: ",it.quantity,"  Unit: R$ ",Number(it.price||0).toFixed(2)]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"font-semibold",children:["R$ ",(Number(it.price||0)*Number(it.quantity||0)).toFixed(2)]})})]},it.id))})}),a.jsxs(Ua,{children:[a.jsxs("div",{className:"mr-auto text-sm font-semibold",children:["Total: R$ ",Ee.toFixed(2)]}),a.jsx(Z,{variant:"secondary",onClick:()=>V(!1),children:"Fechar"}),se?.comandaId&&a.jsxs(Z,{variant:"outline",onClick:()=>window.open(`/print-comanda?comanda=${se.comandaId}`,"_blank"),children:[a.jsx(_G,{className:"mr-2 h-4 w-4"})," Imprimir"]}),a.jsxs(Z,{onClick:async()=>{V(!1),await Va()},disabled:!se||Se.length===0,children:[a.jsx(Vi,{className:"mr-2 h-4 w-4"})," Fechar Conta",a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-amber-600 border border-amber-700 rounded shadow-sm",children:"F2"})]})]})]})})},Vt=p.useMemo(()=>Pe,[i?.id,F]),yt=({table:se})=>{const[Se,Ee]=p.useState(""),[it,Pt]=p.useState(!1),[hr,er]=p.useState(!1),Ar=async()=>{if(!(!se?.comandaId||it))try{Pt(!0),await wKe({comandaId:se.comandaId,observacoes:Se,codigoEmpresa:Number(t?.codigo_empresa)}),e({title:"Observaes salvas",description:"As observaes da comanda foram atualizadas."});try{await ot(se)}catch(Cr){console.error("Erro ao recarregar detalhes da comanda aps salvar observaes:",Cr)}}catch(Cr){Cr?.code!=="42804"&&(console.error("Erro ao salvar observao:",Cr),e({title:"Erro ao salvar observaes",description:"Tente novamente mais tarde.",variant:"destructive"}))}finally{Pt(!1)}};return p.useEffect(()=>{if(!se?.comandaId){Ee("");return}Ee(se.observacoes||"")},[se?.comandaId,se?.observacoes]),se?a.jsxs("div",{className:"flex flex-col h-full p-4 space-y-4 overflow-y-auto thin-scroll",children:[se.order&&se.order.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(lt,{className:"text-sm font-semibold",children:"Descontos por Item"}),a.jsx(Z,{size:"xs",variant:"ghost",className:"h-6 px-2 text-[11px]",onClick:()=>er(Cr=>!Cr),children:hr?"Esconder":`Mostrar (${se.order.length})`})]}),hr&&a.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:se.order.map(Cr=>a.jsx("button",{onClick:()=>ne(Cr),className:"w-full p-3 rounded border border-border bg-surface hover:bg-surface-2 transition text-left",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm font-semibold truncate",children:Cr.name}),a.jsxs("p",{className:"text-xs text-text-secondary",children:["Qtd: ",Cr.quantity,"  R$ ",(Cr.price||0).toFixed(2)]})]}),a.jsx("div",{className:"text-right flex-shrink-0",children:Cr.desconto_valor>0?a.jsxs("span",{className:"text-xs font-bold text-destructive",children:["-",Cr.desconto_tipo==="percentual"?Cr.desconto_valor+"%":"R$"+(Cr.desconto_valor||0).toFixed(2)]}):a.jsx("span",{className:"text-xs text-text-muted",children:"Sem desconto"})})]})},Cr.id))})]}),se.comandaId&&a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx(lt,{className:"text-sm font-semibold",children:"Observaes"}),it&&a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Salvando..."})]}),a.jsx("textarea",{className:"border border-border rounded p-3 text-sm resize-none bg-background min-h-20",placeholder:"Ex: sem cebola, urgente, etc.",value:Se,onChange:Cr=>{const Lt=Cr.target.value;Ee(Lt)},onKeyDown:async Cr=>{Cr.key==="Enter"&&!Cr.shiftKey&&(Cr.preventDefault(),await Ar())}})]}),!Ot&&se.comandaId&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{className:"text-sm font-semibold",children:"Desconto da Comanda"}),a.jsx(Z,{size:"sm",variant:se.desconto_valor>0?"default":"outline",onClick:()=>Gt(!0),className:"w-full gap-2",children:se.desconto_valor>0?a.jsxs(a.Fragment,{children:[a.jsx("span",{children:"Desconto Ativo:"}),a.jsxs("span",{className:"font-bold",children:["-",se.desconto_tipo==="percentual"?se.desconto_valor+"%":"R$"+se.desconto_valor.toFixed(2)]})]}):"Aplicar Desconto"}),se.desconto_motivo&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded border border-border",children:[a.jsx("strong",{children:"Motivo:"})," ",se.desconto_motivo]})]})]}):a.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:a.jsxs("div",{className:"text-center",children:[a.jsx(ol,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),a.jsx("p",{children:"Selecione uma mesa"})]})})},tr=({table:se})=>{if(!se)return a.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:a.jsxs("div",{className:"text-center",children:[a.jsx(zv,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),a.jsx("p",{children:"Selecione uma mesa para ver a comanda"})]})});if(Tn)return a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2",children:[a.jsx("div",{className:"h-0 w-0","aria-hidden":"true"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap",disabled:!c,onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de abrir uma mesa.",variant:"warning"});return}Wt(se),vt(!0)},children:"Abrir Mesa"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 thin-scroll",children:[a.jsx(tv,{className:"h-20 w-full"}),a.jsx(tv,{className:"h-20 w-full"}),a.jsx(tv,{className:"h-20 w-full"})]}),a.jsxs("div",{className:"p-4 border-t border-border mt-auto",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm font-semibold text-text-secondary mb-2",children:[a.jsx("span",{children:"Total"}),a.jsx("span",{children:"R$ 0,00"})]}),a.jsx(Z,{size:"lg",className:"w-full",disabled:!c,children:"Fechar Conta"})]})]});const Se=Oe(se.order,se),Ee=mr(se.customer),it=async()=>{if(!se?.comandaId)return;const Ar=(await ii({comandaId:se.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Xr=>({id:Xr.id,productId:Xr.produto_id,name:Xr.descricao||"Item",price:Number(Xr.preco_unitario||0),quantity:Number(Xr.quantidade||1)})),Cr=(Ar||[]).reduce((Xr,Or)=>Xr+Number(Or.price||0)*Number(Or.quantity||0),0);let Lt=se.customer||null;try{const Or=(await rl({comandaId:se.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(_n=>_n?.nome).filter(Boolean);Lt=Or.length?Or.join(", "):null}catch{}const vn={...se,order:Ar,customer:Lt,totalHint:Cr};l(vn),o(Xr=>Xr.map(Or=>Or.id===vn.id?vn:Or))},Pt=async(er,Ar)=>{try{const Lt=Number(er.quantity||1)+Ar;if(Lt<=0){L(er),de(!0),setTimeout(async()=>{G||await it()},100);return}const vn=Number(er.price||0)*Number(Ar||0);vn&&(l(Xr=>Xr&&{...Xr,totalHint:Math.max(0,Number(Xr.totalHint||0)+vn)}),o(Xr=>Xr.map(Or=>Or.id===i?.id?{...Or,totalHint:Math.max(0,Number(Or.totalHint||0)+vn)}:Or))),await eu({itemId:er.id,quantidade:Lt,codigoEmpresa:t?.codigo_empresa}),await it(),e({title:"Quantidade atualizada",description:`${er.name}: ${Lt}`,variant:"success"})}catch(Cr){e({title:"Falha ao atualizar quantidade",description:Cr?.message||"Tente novamente",variant:"destructive"})}},hr=async er=>{L(er),de(!0),setTimeout(async()=>{G||await it()},100)};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col h-full",onMouseDown:er=>{er.target===er.currentTarget&&er.preventDefault()},children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-center md:justify-between gap-2",children:[Ee?a.jsx("div",{className:"hidden sm:block text-sm font-medium text-text-primary leading-none truncate",title:se.customer||"",children:Ee}):a.jsx("div",{className:"h-0 w-0","aria-hidden":"true"}),a.jsx("div",{className:"flex items-center gap-2",children:se.comandaId?a.jsxs(a.Fragment,{children:[a.jsxs(Z,{size:"sm",className:"h-8 px-3 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-black/60 text-white border border-white/10 shadow-sm hover:bg-black/80 hover:shadow transition-all flex items-center",onClick:()=>{_e(!0);try{w(!1)}catch{}try{z(!1)}catch{}try{at(!1)}catch{}try{Tr(!1)}catch{}try{V(!1)}catch{}},children:[a.jsx(vc,{size:12,className:"text-white/80 mr-1.5"}),"Clientes"]}),a.jsxs(Z,{size:"sm",variant:"outline",className:"h-8 px-3 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-black/60 text-white border border-white/10 shadow-sm hover:bg-black/80 hover:shadow transition-all",onClick:()=>V(!0),children:[a.jsx("span",{className:"inline-flex items-center justify-center h-5 w-5 rounded-full bg-black/40 border border-white/10 mr-1.5",children:a.jsx(ol,{size:12,className:"text-white/80"})}),"Comanda"]}),a.jsxs(Xu,{children:[a.jsx(Sg,{asChild:!0,children:a.jsx(Z,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-red-600 hover:bg-red-500 text-white border border-red-600/70 focus:outline-none focus:ring-0 focus-visible:ring-0 shadow-none",children:"Cancelar"})}),a.jsxs(nu,{className:"sm:max-w-[420px] animate-none",onKeyDown:er=>er.stopPropagation(),children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Cancelar comanda?"}),a.jsx(iu,{children:"Esta ao no pode ser desfeita. Os itens sero descartados e a mesa voltar a ficar livre."})]}),a.jsxs(su,{children:[a.jsx(lu,{children:"Voltar"}),a.jsx(Yu,{disabled:ft,onClick:async er=>{const Ar=er.currentTarget.closest('[role="alertdialog"]');Ar&&Ar.querySelector("[data-radix-collection-item]")?.click();try{_t(!0);const Cr=t?.codigo_empresa;if(Cr)try{localStorage.removeItem(`vendas:selected:${Cr}`),localStorage.removeItem(`vendas:tables:${Cr}`)}catch{}await Uz({comandaId:se.comandaId,codigoEmpresa:Cr}),l(null);try{Tr(!1)}catch{}await ar({showToast:!1}),e({title:"Comanda cancelada",variant:"success"})}catch(Cr){console.error("[Cancelar Comanda] Erro:",Cr),e({title:"Falha ao cancelar comanda",description:Cr?.message||"Tente novamente",variant:"destructive"});try{await ar({showToast:!1})}catch(Lt){console.error("[Cancelar Comanda] Erro ao recarregar aps falha:",Lt)}}finally{_t(!1)}},children:"Confirmar Cancelamento"})]})]})]})]}):a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap",disabled:!c,onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de abrir uma mesa.",variant:"warning"});return}Wt(se),vt(!0)},children:"Abrir Mesa"})})})]}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-3 thin-scroll",children:se.order.length===0?a.jsx("div",{className:"text-center text-text-muted pt-16",children:a.jsx("p",{children:"Comanda vazia. Adicione produtos na aba ao lado."})}):a.jsx("ul",{className:"space-y-3",children:se.order.map(er=>a.jsxs("li",{className:"p-2 rounded-md border border-border/30 bg-surface",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("p",{className:"text-sm font-semibold text-text-primary truncate",title:er.name,children:er.name})}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>Pt(er,-1),children:a.jsx(Nv,{size:12})}),a.jsx("span",{className:"w-7 text-center font-semibold text-sm",children:er.quantity}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>Pt(er,1),children:a.jsx(to,{size:12})})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-right flex-1",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsxs("span",{className:"font-bold text-text-primary",children:["R$ ",(er.price*er.quantity).toFixed(2)]}),er.desconto_valor>0&&a.jsxs("span",{className:"text-xs font-semibold text-destructive",children:["-",er.desconto_tipo==="percentual"?er.desconto_valor+"%":"R$"+(er.desconto_valor||0).toFixed(2)]})]})}),a.jsx(Z,{variant:"ghost",size:"icon",className:"text-danger/80 hover:text-danger h-7 w-7",onClick:()=>hr(er),children:a.jsx(Sc,{size:14})})]})]})]},er.id))})}),a.jsxs("div",{className:"p-3 border-t border-border mt-auto space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm font-semibold text-text-secondary",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",Se.toFixed(2)]})]}),a.jsxs(Z,{size:"lg",className:"w-full",onClick:Va,children:[a.jsx(Vi,{className:"mr-2"})," Fechar Conta",a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-amber-600 border border-amber-700 rounded shadow-sm",children:"F2"})]})]})]}),a.jsx(ct,{})]})},dr=()=>{const[se,Se]=p.useState(""),[Ee,it]=p.useState(""),Pt=async()=>{try{if(Y)return;me(!0);const hr=(se??"").toString().trim(),er=hr?Number(hr):void 0;if(er!==void 0&&(Number.isNaN(er)||er<=0)){e({title:"Nmero invlido",description:"Informe um nmero positivo.",variant:"warning"});return}const Ar=await fKe({numero:er,nome:(Ee||"").trim()||void 0,codigoEmpresa:t?.codigo_empresa}),Cr={id:Ar.id,number:Ar.numero,name:Ar.nome,status:"available",order:[],customer:null,comandaId:null,totalHint:0};o(Lt=>(Lt.some(Or=>Or.id===Cr.id)?Lt.map(Or=>Or.id===Cr.id?Cr:Or):[...Lt,Cr]).slice().sort((Or,_n)=>Number(Or.number)-Number(_n.number))),Ce.startTransition(()=>{l(Cr),Te(!1)}),e({title:"Mesa criada",description:`Mesa ${Ar.numero} adicionada`,variant:"success"}),Se(""),it("")}catch(hr){e({title:"Falha ao criar mesa",description:hr?.message||"Tente novamente",variant:"destructive"})}finally{me(!1)}};return a.jsx(zn,{open:le,onOpenChange:hr=>{Te(hr),hr||(Se(""),it(""))},children:a.jsxs(qn,{className:"sm:max-w-md w-[92vw]",children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-2xl font-bold",children:"Nova Mesa"}),a.jsx(la,{children:"Informe o nome da mesa. Se deixar em branco, ser criada com numerao automtica."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(lt,{htmlFor:"nova-mesa-nome",children:"Nome da mesa"}),a.jsx(At,{id:"nova-mesa-nome",type:"text",placeholder:"Ex: Mesa 1, Varanda, etc.",value:Ee,onChange:hr=>it(hr.target.value),onKeyDown:hr=>{hr.stopPropagation(),hr.key==="Enter"&&!Y&&(hr.preventDefault(),Pt())},onKeyPress:hr=>hr.stopPropagation()})]}),a.jsxs(Ua,{children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>Te(!1),disabled:Y,children:"Cancelar"}),a.jsx(Z,{type:"button",onClick:Pt,disabled:Y,children:Y?"Criando...":"Criar Mesa"})]})]})})},tn=()=>{const[se,Se]=p.useState([]),[Ee,it]=p.useState(new Set),[Pt,hr]=p.useState(!1),{userProfile:er}=fo(),{toast:Ar}=Xs(),Cr=async()=>{try{hr(!0);const fr=await lKe(er?.codigo_empresa);Se(Array.isArray(fr)?fr:[])}catch(fr){Ar({title:"Falha ao listar mesas",description:fr?.message||"Tente novamente",variant:"destructive"})}finally{hr(!1)}};p.useEffect(()=>{te&&Cr()},[te]);const Lt=fr=>{const dn=new Set(Ee);dn.has(fr)?dn.delete(fr):dn.add(fr),it(dn)},vn=(se||[]).length>0&&(se||[]).every(fr=>Ee.has(fr.id)),Xr=()=>{(se||[]).length!==0&&it(vn?new Set:new Set((se||[]).map(fr=>fr.id)))},Or=async()=>{const fr=se.filter(dn=>Ee.has(dn.id)&&dn.status==="available").map(dn=>dn.id);if(fr.length===0){Ar({title:"Selecione mesas disponveis",variant:"warning"});return}try{for(const dn of fr)await iKe({mesaId:dn,codigoEmpresa:er?.codigo_empresa});Ar({title:"Mesas inativadas",description:`${fr.length} mesa(s)`,variant:"success"});try{await ar({showToast:!1})}catch{}await Cr()}catch(dn){Ar({title:"Falha ao inativar",description:dn?.message||"Tente novamente",variant:"destructive"})}},_n=async()=>{const fr=se.filter(dn=>Ee.has(dn.id)&&dn.status==="inactive").map(dn=>dn.id);if(fr.length===0){Ar({title:"Selecione mesas inativas",variant:"warning"});return}try{for(const dn of fr)await cKe({mesaId:dn,codigoEmpresa:er?.codigo_empresa});Ar({title:"Mesas reativadas",description:`${fr.length} mesa(s)`,variant:"success"});try{await ar({showToast:!1})}catch{}await Cr()}catch(dn){Ar({title:"Falha ao reativar",description:dn?.message||"Tente novamente",variant:"destructive"})}};return a.jsx(zn,{open:te,onOpenChange:fr=>{ie(fr),fr||it(new Set)},children:a.jsxs(qn,{className:"sm:max-w-xl w-[92vw]",children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-2xl font-bold",children:"Gerenciar Mesas"}),a.jsx(la,{children:"Selecione mesas e ative/inative."})]}),a.jsxs("div",{className:"space-y-3 max-h-[50vh] overflow-auto thin-scroll",children:[a.jsxs("div",{className:"flex items-center gap-2 px-1",children:[a.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded-sm border border-amber-500/60 bg-black accent-amber-400",checked:vn,onChange:Xr}),a.jsx("span",{className:"text-sm select-none",children:"Selecionar todas"})]}),Pt?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando..."}):a.jsx("ul",{className:"space-y-1",children:se.map(fr=>{const dn=String(fr.status||"").toLowerCase(),Dr=dn==="inactive",wr=Dr?"Inativa":dn==="available"?"Disponvel":dn==="occupied"?"Ocupada":dn==="awaiting-payment"?"Aguardando Pagamento":fr.status||"",Jr=Dr?"bg-slate-500/15 text-slate-300 border border-slate-500/30":dn==="available"?"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30":"bg-amber-500/15 text-amber-300 border border-amber-500/30";return a.jsxs("li",{className:"flex items-center justify-between gap-3 border border-border/40 rounded px-2 py-1.5",children:[a.jsxs("label",{className:"flex items-center gap-2 select-none min-w-0",children:[a.jsx("input",{type:"checkbox",checked:Ee.has(fr.id),onChange:()=>Lt(fr.id),className:"h-4 w-4 rounded-sm border border-amber-500/60 bg-black accent-amber-400"}),a.jsx("span",{className:"text-sm whitespace-nowrap truncate max-w-[55vw] md:max-w-[32rem]",children:fr.nome||`Mesa ${fr.numero}`})]}),a.jsx("span",{className:`text-[11px] px-2 py-0.5 rounded-full font-semibold whitespace-nowrap ${Jr}`,children:wr})]},fr.id)})})]}),a.jsxs(Ua,{className:"flex items-center justify-end gap-2",children:[a.jsx(Z,{type:"button",variant:"destructive",onClick:Or,disabled:Pt,children:"Inativar"}),a.jsx(Z,{type:"button",onClick:_n,disabled:Pt,children:"Ativar"})]})]})})},Lr=async se=>{try{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}if(!i?.comandaId){e({title:"Selecione uma mesa",description:"Abra a comanda clicando na mesa primeiro.",variant:"destructive"});return}const Se=Number(se.stock??se.currentStock??0),Ee=v.get(String(se.id))||0,it=Math.max(0,Se-Ee);if(((i?.order||[]).find(fr=>String(fr.productId)===String(se.id))?.quantity||0)+1>it){e({title:"Estoque insuficiente",description:`${se.name} - Estoque disponvel: ${it} (${Se} total, ${Ee} reservado em outras comandas)`,variant:"destructive"});return}const er=Number(se.salePrice??se.price??0),Cr=(await ii({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).find(fr=>String(fr.produto_id)===String(se.id));let Lt;if(Cr){const fr=Number(Cr.quantidade||0);await eu({itemId:Cr.id,quantidade:fr+1,codigoEmpresa:t?.codigo_empresa}),Lt={id:Cr.id,productId:Cr.produto_id,name:Cr.descricao||se.name,price:er,quantity:fr+1}}else Lt=await f3({comandaId:i.comandaId,produtoId:se.id,descricao:se.name,quantidade:1,precoUnitario:er,codigoEmpresa:t?.codigo_empresa});const Xr=(await ii({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(fr=>({id:fr.id,productId:fr.produto_id,name:fr.descricao||"Item",price:Number(fr.preco_unitario||0),quantity:Number(fr.quantidade||1)})),Or=(Xr||[]).reduce((fr,dn)=>fr+Number(dn.price||0)*Number(dn.quantity||0),0),_n={...i,order:Xr,totalHint:Or};l(_n),o(fr=>fr.map(dn=>dn.id===_n.id?_n:dn));try{const fr=await kh({codigoEmpresa:t?.codigo_empresa}),dn=new Map;for(const Dr of fr||[]){const wr=String(Dr.produto_id),Jr=Number(Dr.quantidade||0);dn.set(wr,(dn.get(wr)||0)+Jr)}y(dn)}catch(fr){console.error("[addProductToComanda] Erro ao atualizar estoque reservado:",fr)}bt(se.id),setTimeout(()=>{bt(fr=>fr===se.id?null:fr)},500),e({title:"Produto adicionado",variant:"success"})}catch(Se){console.error("[addProductToComanda] EXCEPTION:",Se),e({title:"Falha ao adicionar produto",description:Se?.message||"Tente novamente",variant:"destructive"})}},da=()=>{const[se,Se]=p.useState(""),[Ee,it]=p.useState("all"),Pt=p.useRef(null),hr=p.useRef(0),er=p.useRef(null),Cr=(X||[]).slice().sort((Lt,vn)=>{const Xr=Lt.code||"",Or=vn.code||"";return/^\d+$/.test(Xr)&&/^\d+$/.test(Or)?parseInt(Xr,10)-parseInt(Or,10):Xr.localeCompare(Or)}).filter(Lt=>{const vn=se.trim().toLowerCase(),Xr=!vn||(Lt.name||"").toLowerCase().includes(vn)||String(Lt.code||"").toLowerCase().includes(vn);if(Ee==="all")return Xr;const Or=Number(Lt.stock??Lt.currentStock??0),_n=v.get(String(Lt.id))||0,fr=Math.max(0,Or-_n);return Ee==="available"?Xr&&fr>0:Ee==="low"?Xr&&fr>0&&fr<=5:Ee==="out"?Xr&&fr<=0:Xr});return i?a.jsx(zn,{open:b,onOpenChange:Lt=>{if(w(Lt),P(Lt?"panel":"tables"),Lt)try{Tr(!1)}catch{}},children:a.jsxs(qn,{overlayClassName:"z-[88]",className:"w-[95vw] sm:max-w-4xl max-h-[80vh] sm:max-h-[85vh] flex flex-col p-0 gap-0 focus:outline-none focus-visible:outline-none !overflow-visible z-[89]",style:{scrollBehavior:"auto"},onOpenAutoFocus:Lt=>{Lt.preventDefault(),P("panel")},onWheel:Lt=>{Lt.stopPropagation()},onKeyDown:Lt=>{const vn=Lt.target,Xr=vn&&(vn.tagName==="INPUT"||vn.closest("input")),Or=vn&&vn.closest("[data-product-card]");if(!["ArrowDown","ArrowUp","Home","End","Enter","Delete","Escape"].includes(Lt.key)||Xr||Or)return;Lt.preventDefault(),Lt.stopPropagation();const _n=C||0,fr=Cr.length;if(Lt.key==="ArrowDown"){const dn=Math.min(_n+1,fr-1);A(dn),hr.current=dn,requestAnimationFrame(()=>j.current[dn]?.focus());return}if(Lt.key==="ArrowUp"){const dn=Math.max(_n-1,0);A(dn),hr.current=dn,requestAnimationFrame(()=>j.current[dn]?.focus());return}if(Lt.key==="Home"){A(0),hr.current=0,requestAnimationFrame(()=>j.current[0]?.focus());return}if(Lt.key==="End"){const dn=Math.max(0,fr-1);A(dn),hr.current=dn,requestAnimationFrame(()=>j.current[dn]?.focus());return}if(Lt.key==="Escape"){w(!1);return}},children:[a.jsxs(Bn,{className:"px-6 py-4 border-b border-border",children:[a.jsxs($n,{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(zv,{className:"w-6 h-6 text-brand"}),"Adicionar Produtos"]}),a.jsxs(la,{className:"text-base mt-2",children:["Mesa ",i.number,"  ",mr(i.customer)||"Sem cliente"]})]}),a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-border bg-surface/50",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-text-muted"}),a.jsx("input",{ref:Pt,type:"text",className:"w-full pl-10 pr-4 py-3 text-base rounded-lg bg-background border-2 border-border focus:border-brand focus:ring-2 focus:ring-brand/20 transition-all outline-none",placeholder:"Digite o nome ou cdigo do produto...",value:se,onChange:Lt=>Se(Lt.target.value),onClick:Lt=>{Lt.stopPropagation(),Lt.currentTarget.focus(),P("panel")},onFocus:Lt=>{Lt.stopPropagation(),P("panel")},onKeyDown:Lt=>{if(Lt.stopPropagation(),Lt.nativeEvent&&typeof Lt.nativeEvent.stopImmediatePropagation=="function"&&Lt.nativeEvent.stopImmediatePropagation(),P("panel"),["ArrowDown","ArrowUp","Home","End","Escape"].includes(Lt.key)){Lt.preventDefault();const vn=C||0,Xr=Cr.length;if(Lt.key==="ArrowDown"){A(Math.min(vn+1,Xr-1));return}if(Lt.key==="ArrowUp"){A(Math.max(vn-1,0));return}if(Lt.key==="Home"){A(0);return}if(Lt.key==="End"){A(Xr-1);return}if(Lt.key==="Escape"){w(!1);return}}}})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4 mt-3",children:[a.jsx("button",{onClick:()=>it("all"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="all"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Todos"}),a.jsx("button",{onClick:()=>it("available"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="available"?"bg-success text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Disponvel"}),a.jsx("button",{onClick:()=>it("low"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="low"?"bg-warning text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Estoque Baixo"}),a.jsx("button",{onClick:()=>it("out"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="out"?"bg-destructive text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Sem Estoque"}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2 ml-auto text-xs text-text-muted flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface border border-border rounded text-xs font-mono",children:""}),a.jsx("span",{children:"Navegar"})]}),a.jsx("div",{className:"w-px h-3 bg-border"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface border border-border rounded text-xs font-mono",children:"Esc"}),a.jsx("span",{children:"Fechar"})]})]})]})]}),a.jsx("div",{ref:er,className:"flex-1 overflow-y-auto px-6 py-4 focus:outline-none",tabIndex:-1,onKeyDown:Lt=>{["ArrowDown","ArrowUp","Home","End","PageDown","PageUp","Space"].includes(Lt.key)&&(Lt.preventDefault(),Lt.stopPropagation(),Lt.nativeEvent&&typeof Lt.nativeEvent.stopImmediatePropagation=="function"&&Lt.nativeEvent.stopImmediatePropagation()),Lt.stopPropagation();const vn=Lt.target,Xr=vn&&(vn.tagName==="INPUT"||vn.closest("input"));if(!["ArrowDown","ArrowUp","Home","End","Escape"].includes(Lt.key)||Xr)return;const Or=C||0,_n=Cr.length;if(Lt.key==="ArrowDown"){const fr=Math.min(Or+1,_n-1);A(fr),hr.current=fr,requestAnimationFrame(()=>j.current[fr]?.focus());return}if(Lt.key==="ArrowUp"){const fr=Math.max(Or-1,0);A(fr),hr.current=fr,requestAnimationFrame(()=>j.current[fr]?.focus());return}if(Lt.key==="Home"){A(0),hr.current=0,requestAnimationFrame(()=>j.current[0]?.focus());return}if(Lt.key==="End"){const fr=Math.max(0,_n-1);A(fr),hr.current=fr,requestAnimationFrame(()=>j.current[fr]?.focus());return}if(Lt.key==="Escape"){w(!1);return}},children:Cr.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[a.jsx(zv,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhum produto encontrado"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Tente ajustar sua busca ou cadastre novos produtos"}),a.jsxs(Z,{onClick:()=>{w(!1),n("/produtos")},children:[a.jsx(to,{className:"w-4 h-4 mr-2"}),"Cadastrar Produtos"]})]}):a.jsx("div",{className:"flex flex-col gap-1.5",children:Cr.map((Lt,vn)=>{const Xr=(i?.order||[]).reduce((wr,Jr)=>wr+(String(Jr.productId)===String(Lt.id)?Number(Jr.quantity||0):0),0),Or=Number(Lt.stock??Lt.currentStock??0),_n=v.get(String(Lt.id))||0,fr=Math.max(0,Or-_n),dn=vn===C,Dr=Lt.id===Qt;return a.jsxs("div",{ref:wr=>{j.current[vn]=wr},"data-product-card":!0,className:Er("flex items-center gap-2 sm:gap-4 p-2.5 sm:p-3 rounded-lg border-2 transition-colors duration-500 outline-none focus:outline-none focus-visible:outline-none",fr===0&&Xr===0?"opacity-50 cursor-not-allowed bg-surface-2 border-border":"cursor-pointer",dn?"border-brand bg-brand/5 shadow-md":fr>0?"border-border bg-surface hover:border-brand/50 hover:bg-surface-2":Xr>0?"border-border bg-surface":"border-border",Dr&&"bg-brand/8"),tabIndex:fr>0||Xr>0?0:-1,onKeyDown:wr=>{if(["ArrowDown","ArrowUp","Home","End","PageDown","PageUp","Space"].includes(wr.key)&&(wr.preventDefault(),wr.stopPropagation(),wr.nativeEvent&&typeof wr.nativeEvent.stopImmediatePropagation=="function"&&wr.nativeEvent.stopImmediatePropagation()),!["ArrowDown","ArrowUp","Home","End","Escape"].includes(wr.key))return;wr.stopPropagation();const Jr=Cr.length;if(wr.key==="ArrowDown"){const Mn=Math.min(vn+1,Jr-1);A(Mn),hr.current=Mn,requestAnimationFrame(()=>j.current[Mn]?.focus());return}if(wr.key==="ArrowUp"){const Mn=Math.max(vn-1,0);A(Mn),hr.current=Mn,requestAnimationFrame(()=>j.current[Mn]?.focus());return}if(wr.key==="Home"){A(0),hr.current=0,requestAnimationFrame(()=>j.current[0]?.focus());return}if(wr.key==="End"){const Mn=Math.max(0,Jr-1);A(Mn),hr.current=Mn,requestAnimationFrame(()=>j.current[Mn]?.focus());return}if(wr.key==="Escape"){w(!1);return}},onClick:()=>{fr===0&&Xr===0||(A(vn),hr.current=vn,requestAnimationFrame(()=>j.current[vn]?.focus()))},onMouseDown:wr=>{if(fr===0&&Xr===0){wr.preventDefault();return}wr.currentTarget.focus()},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Lt.code&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-mono font-semibold bg-surface-2 border border-border rounded",children:Lt.code}),a.jsx("h4",{className:"font-semibold text-sm sm:text-base text-text-primary truncate",children:Lt.name})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] sm:text-xs mt-0.5",children:[a.jsx("span",{className:Er("font-bold",fr===0?"text-text-muted":"text-brand"),children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Lt.salePrice??Lt.price??0))}),a.jsxs("span",{className:"text-text-muted whitespace-nowrap",children:["Estoque: ",a.jsx("span",{className:Er("font-semibold",fr<=5?"text-destructive":"text-text-secondary"),children:fr})]}),Xr>0&&a.jsxs("span",{className:"px-2 py-0.5 bg-brand/10 text-brand text-[11px] font-semibold rounded whitespace-nowrap",children:[Xr,"x na comanda"]})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[a.jsx(Z,{size:"icon",variant:"outline",onClick:wr=>{wr.stopPropagation(),Fr(Lt)},disabled:Xr===0,className:"h-8 w-8 p-0",children:a.jsx(Nv,{className:"w-4 h-4"})}),a.jsx(Z,{size:"icon",onClick:wr=>{wr.stopPropagation(),Lr(Lt)},disabled:fr===0,className:"h-8 w-8 p-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",children:a.jsx(to,{className:"w-4 h-4"})})]})]},Lt.id)})},(i?.order||[]).map(Lt=>`${String(Lt.productId)}:${Number(Lt.quantity||0)}`).join("|"))}),a.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-t border-border bg-surface/50",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2",children:[a.jsxs("div",{className:"hidden sm:block text-sm text-text-muted",children:[Cr.length," produto",Cr.length!==1?"s":"","  ",(i.order||[]).length," ite",(i.order||[]).length!==1?"ns":"m"," na comanda"]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 w-full sm:w-auto",children:[a.jsxs("div",{className:"text-left sm:text-right",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Total"}),a.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.totalHint||0)})]}),a.jsx(Z,{onClick:()=>w(!1),className:"px-4 sm:px-6 min-w-[96px] sm:min-w-[120px]",size:"sm",children:"Concluir"})]})]})})]})]})}):null},[rn,un]=p.useState(null),[Dn,fa]=p.useState([]),[Oa,us]=p.useState(!1),[Un,Ya]=p.useState(""),[$s,po]=p.useState(!1),[wi,zo]=p.useState([]),[ji,ec]=p.useState(!1),[rd,pl]=p.useState(null),[Eu,Ko]=p.useState([]),[Hs,tc]=p.useState(!1),[Xi,Tl]=p.useState(null),As=p.useRef(null);p.useEffect(()=>{As.current=rn},[rn]);const rc=p.useMemo(()=>{const se=new Map;for(const Se of Dn||[]){const Ee=Se.productId,it=Number(Se.quantity||0);se.set(Ee,(se.get(Ee)||0)+it)}return se},[Dn]),Ns=async se=>{if(!se)return;const Ee=(await ii({comandaId:se,codigoEmpresa:t?.codigo_empresa})||[]).map(it=>({id:it.id,productId:it.produto_id,name:it.descricao||"Item",price:Number(it.preco_unitario||0),quantity:Number(it.quantidade||1)}));fa(Ee)},gl=async se=>{try{const Se=t?.codigo_empresa;if(!Se){e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}let Ee=rn;if(!Ee){if(Ee=(await $_({codigoEmpresa:Se}))?.id,!Ee){e({title:"Falha ao iniciar venda no balco",description:"No foi possvel criar ou recuperar a comanda.",variant:"destructive"});return}un(Ee)}const it=Number(se.salePrice??se.price??0);await f3({comandaId:Ee,produtoId:se.id,descricao:se.name,quantidade:1,precoUnitario:it,codigoEmpresa:Se}),await Ns(Ee),e({title:"Produto adicionado (balco)",description:se.name,variant:"success"})}catch(Se){e({title:"Falha ao adicionar produto (balco)",description:Se?.message||"Tente novamente",variant:"destructive"})}},Dl=async se=>{if(!(!rn||!se)){po(!1);try{await tw({comandaId:rn,clienteIds:[se],nomesLivres:[],codigoEmpresa:t?.codigo_empresa}),pl(se),Ko(Se=>{const Ee=new Set((Se||[]).map(it=>String(it)));return Ee.add(String(se)),Array.from(Ee)}),Ya(""),zo([]),e({title:"Cliente associado",variant:"success"})}catch(Se){e({title:"Falha ao associar cliente",description:Se?.message||"Tente novamente",variant:"destructive"}),po(!0)}}},ku=async()=>{if(rn)try{const se=Oe(Dn,null);if(se<=0){e({title:"Sem itens",description:"Adicione itens antes de pagar.",variant:"warning"});return}us(!0),await wm({codigoEmpresa:t?.codigo_empresa});let Se=De;if(!Array.isArray(Se)||Se.length===0)try{Se=await $h({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa}),wt(Se)}catch{}const Ee=Se?.[0],it=Ee?.tipo||Ee?.nome||"outros";await AR({comandaId:rn,finalizadoraId:Ee?.id,metodo:it,valor:se,codigoEmpresa:t?.codigo_empresa}),await V0({comandaId:rn,codigoEmpresa:t?.codigo_empresa}),e({title:"Pagamento registrado (balco)",description:`R$ ${se.toFixed(2)}`,variant:"success"}),fa([]),un(null),m(!1)}catch(se){e({title:"Falha no pagamento (balco)",description:se?.message||"Tente novamente",variant:"destructive"})}finally{us(!1)}},xl=()=>{p.useEffect(()=>{let Se=!0;return(async()=>{if(h)try{us(!0);const it=t?.codigo_empresa;if(!it){Se&&e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}const Pt=await Dv({codigoEmpresa:it});if(!Se)return;if(Pt?.id){un(Pt.id),await Ns(Pt.id);try{const hr=await rl({comandaId:Pt.id,codigoEmpresa:it}),er=(hr||[]).map(Cr=>Cr?.cliente_id).filter(Boolean).map(Cr=>String(Cr));Ko(er);const Ar=Array.isArray(hr)&&hr.length>0?hr[0]:null;Ar?.cliente_id&&pl(Ar.cliente_id)}catch{}}else un(null),fa([])}catch(it){Se&&e({title:"Falha ao abrir Modo Balco",description:it?.message||"Tente novamente",variant:"destructive"})}finally{Se&&us(!1)}})(),()=>{Se=!1}},[h]),p.useEffect(()=>{if(!$s)return;let Se=!0;const it=setTimeout(async()=>{try{ec(!0);const Pt=await ew({searchTerm:Un,limit:20,codigoEmpresa:t?.codigo_empresa});Se&&zo(Pt||[])}catch{Se&&zo([])}finally{Se&&ec(!1)}},250);return()=>{Se=!1,clearTimeout(it)}},[$s,Un]);const se=Oe(Dn,null);return a.jsx(zn,{open:h,onOpenChange:m,children:a.jsxs(qn,{className:"max-w-4xl h-[90vh]",onKeyDown:Se=>Se.stopPropagation(),onKeyDownCapture:Se=>Se.stopPropagation(),onPointerDownOutside:Se=>Se.stopPropagation(),onInteractOutside:Se=>Se.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-2xl font-bold",children:"Modo Balco"}),a.jsx(la,{children:"Venda rpida para clientes sem mesa."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-6 h-full overflow-hidden pt-4",children:[a.jsxs("div",{className:"col-span-1 flex flex-col border-r border-border pr-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Catlogo de Produtos"}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>po(!0),children:rd?a.jsxs(a.Fragment,{children:[a.jsx(Oi,{className:"mr-1 h-4 w-4 text-success"})," Cliente"]}):"Cliente"})]}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar produto...",className:"pl-9",value:Un,onChange:Se=>Ya(Se.target.value),ref:_})]}),a.jsx("div",{className:"flex-1 overflow-y-auto -mr-4 pr-4 thin-scroll",children:a.jsxs("ul",{className:"space-y-2",children:[(X||[]).filter(Se=>{const Ee=Un.trim().toLowerCase();return Ee?(Se.name||"").toLowerCase().includes(Ee)||(Se.code||"").toLowerCase().includes(Ee):!0}).sort((Se,Ee)=>{const it=Se.code||"",Pt=Ee.code||"";return/^\d+$/.test(it)&&/^\d+$/.test(Pt)?parseInt(it,10)-parseInt(Pt,10):it.localeCompare(Pt)}).map(Se=>{const Ee=(Dn||[]).reduce((er,Ar)=>er+(String(Ar.productId)===String(Se.id)?Number(Ar.quantity||0):0),0),it=Number(Se.stock??Se.currentStock??0),Pt=v.get(String(Se.id))||0,hr=Math.max(0,it-Pt);return a.jsxs("li",{className:"flex items-center p-2 rounded-md hover:bg-surface-2 transition-colors",onClick:()=>{Tl(Se),tc(!0)},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"font-semibold truncate",title:`${Se.code?`[${Se.code}] `:""}${Se.name}`,children:[Se.code&&a.jsxs("span",{className:"text-text-muted",children:["[",Se.code,"]"]})," ",Se.name]}),Ee>0&&a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-brand/15 text-brand border border-brand/30 flex-shrink-0",children:["x",Ee]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["R$ ",Number(Se.salePrice??Se.price??0).toFixed(2)]}),a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-surface-2 text-text-secondary border border-border flex-shrink-0",children:["Qtd ",hr]})]})]}),a.jsx(Z,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:er=>{er.stopPropagation(),gl(Se)},"aria-label":`Adicionar ${Se.name}`,children:a.jsx(to,{size:16})})]},Se.id)}),(!X||X.length===0)&&a.jsxs("li",{className:"text-center text-text-muted py-8",children:[a.jsx("div",{className:"mb-3",children:"Nenhum produto cadastrado. Cadastre produtos para vender no balco."}),a.jsx(Z,{size:"sm",onClick:()=>n("/produtos"),children:"Cadastrar Produtos"})]})]})})]}),a.jsxs("div",{className:"col-span-1 flex flex-col",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Comanda do Balco"}),a.jsx("div",{className:"flex-1 overflow-y-auto bg-surface-2 rounded-lg p-4 thin-scroll",children:Dn.length===0?a.jsx("p",{className:"text-center text-text-muted pt-16",children:"Adicione produtos  comanda."}):a.jsx("ul",{className:"divide-y divide-border",children:Dn.map(Se=>a.jsxs("li",{className:"py-2 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:Se.name}),a.jsxs("div",{className:"text-xs text-text-muted",children:["Qtd: ",Se.quantity,"  Unit: R$ ",Number(Se.price||0).toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"font-semibold mr-2",children:["R$ ",(Number(Se.price||0)*Number(Se.quantity||0)).toFixed(2)]}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:async()=>{const Ee=Number(Se.quantity||1)-1;if(Ee<=0)L(Se),de(!0),setTimeout(async()=>{G||await Ns(rn)},100);else try{await eu({itemId:Se.id,quantidade:Ee,codigoEmpresa:t?.codigo_empresa}),await Ns(rn)}catch(it){e({title:"Falha ao atualizar",description:it?.message||"Tente novamente",variant:"destructive"})}},children:a.jsx(Nv,{size:14})}),a.jsx("span",{className:"w-8 text-center font-semibold",children:Se.quantity}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:async()=>{try{await eu({itemId:Se.id,quantidade:Number(Se.quantity||1)+1,codigoEmpresa:t?.codigo_empresa}),await Ns(rn)}catch(Ee){e({title:"Falha ao atualizar",description:Ee?.message||"Tente novamente",variant:"destructive"})}},children:a.jsx(to,{size:14})})]})]},Se.id))})}),a.jsxs("div",{className:"p-4 border-t border-border mt-auto",children:[a.jsxs("div",{className:"flex justify-between items-center text-xl font-bold mb-4",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",se.toFixed(2)]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(Xu,{children:[a.jsx(Sg,{asChild:!0,children:a.jsx(Z,{size:"lg",className:"flex-1 bg-red-600 hover:bg-red-500 text-white border border-red-600/70",children:"Cancelar"})}),a.jsxs(nu,{className:"sm:max-w-[420px] animate-none",onKeyDown:Se=>Se.stopPropagation(),children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Cancelar comanda do balco?"}),a.jsx(iu,{children:"Os itens sero descartados e o balco ser limpo. Esta ao no pode ser desfeita."})]}),a.jsxs(su,{children:[a.jsx(lu,{children:"Voltar"}),a.jsx(Yu,{onClick:async()=>{try{if(!rn){m(!1);return}await Uz({comandaId:rn,codigoEmpresa:t?.codigo_empresa}),fa([]),un(null),m(!1),e({title:"Comanda cancelada (balco)",variant:"success"})}catch(Se){e({title:"Falha ao cancelar",description:Se?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar Cancelamento"})]})]})]}),a.jsxs(Z,{size:"lg",className:"flex-1",onClick:ku,disabled:Oa||se<=0,children:[a.jsx(Vi,{className:"mr-2"})," Finalizar Pagamento"]})]})]})]})]}),$s&&a.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center",onClick:Se=>{Se.target===Se.currentTarget&&po(!1)},onKeyDown:Se=>{Se.key==="Escape"&&po(!1)},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border shadow-lg w-full max-w-md p-4",role:"dialog","aria-modal":"true",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"text-lg font-semibold",children:"Selecionar Cliente"}),a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>po(!1),children:"Fechar"})]}),a.jsxs("div",{className:"relative mb-2",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Nome, e-mail, telefone ou cdigo",className:"pl-9",value:Un,onChange:Se=>Ya(Se.target.value)})]}),a.jsx("div",{className:"max-h-64 overflow-auto thin-scroll border rounded-md",children:ji?a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Carregando clientes..."}):wi.length>0?a.jsx("ul",{children:wi.map(Se=>{const Ee=Array.isArray(Eu)&&Eu.includes(String(Se.id));return a.jsxs("li",{className:Er("p-2 flex items-center justify-between cursor-pointer hover:bg-surface-2",Ee&&"bg-surface-2"),onClick:()=>Dl(Se.id),children:[a.jsx("div",{children:a.jsxs("div",{className:"font-medium",children:[Se.codigo!=null?String(Se.codigo)+" - ":"",Se.nome]})}),Ee&&a.jsx(Oi,{size:16,className:"text-success"})]},Se.id)})}):a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum cliente encontrado."})})]})})]})})},Yi=()=>{const se=Xi,Se=se&&rc.get(se.id)||0,Ee=se?Number(se.salePrice??se.price??0):0,it=Pt=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Pt||0));return a.jsx(zn,{open:Hs,onOpenChange:Pt=>{tc(Pt),Pt||Tl(null)},children:a.jsxs(qn,{className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[61]",onKeyDown:Pt=>Pt.stopPropagation(),onPointerDownOutside:Pt=>Pt.stopPropagation(),onInteractOutside:Pt=>Pt.stopPropagation(),onEscapeKeyDown:Pt=>{Pt.preventDefault(),Pt.stopPropagation()},children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold break-words",title:se?.name||"",children:se?.name||"Produto"}),a.jsx(la,{children:"Detalhes do produto (Balco)."})]}),se?a.jsxs("div",{className:"space-y-3 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:it(Ee)})]}),se.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:se.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof se.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:se.stock})]}),typeof se.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:se.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",Se]})]})]})]}):null,a.jsxs(Ua,{className:"flex items-center justify-between gap-2",children:[a.jsxs(Z,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{se&&n("/produtos",{state:{productId:se.id,productName:se.name}})},children:[a.jsx(ol,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(Z,{variant:"outline",onClick:()=>{tc(!1),Tl(null)},children:"Fechar"}),a.jsx(Z,{onClick:async()=>{se&&(await gl(se),tc(!1),Tl(null))},children:"Adicionar"})]})]})})},vl=()=>{const[se,Se]=p.useState(""),[Ee,it]=p.useState(!1),[Pt,hr]=p.useState([]),[er,Ar]=p.useState([]),[Cr,Lt]=p.useState(0),[vn,Xr]=p.useState(!1),[Or,_n]=p.useState(0),fr=p.useRef([]),dn=p.useRef(null),Dr=p.useRef(null),wr=p.useRef(null),Jr=p.useRef(null),Mn=p.useRef(0),ha=p.useRef(0);p.useEffect(()=>{let jn=!0;return(async()=>{try{it(!0);const an=await ew({searchTerm:se,limit:20});if(!jn)return;const Nn=(an||[]).slice(),Sn=String(se||"").trim().toLowerCase(),hn=Pr=>{const pn=String(Pr?.nome||"").toLowerCase();return Sn?pn.startsWith(Sn)?0:pn.includes(Sn)?1:2:2};Nn.sort((Pr,pn)=>{const vr=hn(Pr),kr=hn(pn);if(vr!==kr)return vr-kr;const Vr=Number(Pr?.codigo||0),Ir=Number(pn?.codigo||0);return Vr-Ir}),hr(Nn),_n(0)}catch{if(!jn)return;hr([])}finally{jn&&it(!1)}})(),()=>{jn=!1}},[se]);const is=p.useRef(!1);p.useEffect(()=>{try{xt&&!is.current&&(is.current=!0,wr.current&&(wr.current.scrollTop=0),dn.current&&(dn.current.scrollTop=0),Dr.current&&(Dr.current.scrollTop=0)),xt||(is.current=!1)}catch{}},[xt]),p.useEffect(()=>{try{xt&&Array.isArray(Pt)&&Pt.length>0&&(_n(0),setTimeout(()=>{try{dn.current?.focus(),Dr.current&&(Dr.current.scrollTop=0)}catch{}},0))}catch{}},[xt,Pt.length]);const Gs=async(jn=null)=>{try{if(!Nt)return;St(!0);const Nr=await pKe({mesaId:Nt.id,codigoEmpresa:t?.codigo_empresa}),Nn=Array.isArray(jn)?jn:er,Sn=Array.isArray(Nn)?Array.from(new Set(Nn)):[];let hn=[],Pr=Math.max(0,Number(Cr||0));Sn.length===0&&Pr===0&&(Pr=1);for(let kr=0;kr<Pr;kr++)hn.push("Consumidor");await tw({comandaId:Nr.id,clienteIds:Sn,nomesLivres:hn,codigoEmpresa:t?.codigo_empresa,replace:!0});let pn=null;try{const kr=await rl({comandaId:Nr.id,codigoEmpresa:t?.codigo_empresa}),Ir=(Array.isArray(kr)?kr:[]).map(re=>re?.nome).filter(Boolean);pn=Ir.length?Ir.join(", "):null}catch(kr){console.error("[confirmOpen] Erro ao buscar vnculos:",kr)}if(!pn){const kr=Array.isArray(Sn)?Sn:[],Vr=Array.isArray(Pt)?Pt:[];pn=kr.length?kr.map(Ir=>Vr.find(re=>re.id===Ir)?.nome).filter(Boolean).join(", "):hn.length>0?hn.join(", "):""}const vr={...Nt,comandaId:Nr.id,status:"in-use",customer:pn||null,order:[]};l(vr),o(kr=>kr.map(Vr=>Vr.id===vr.id?vr:Vr)),await new Promise(kr=>setTimeout(kr,500));try{const kr=await Bh(t?.codigo_empresa),Vr=await wd({codigoEmpresa:t?.codigo_empresa}),Ir={},re={},we=Array.isArray(Vr)?Vr:[];await Promise.all(we.map(async ge=>{try{const nt=await rl({comandaId:ge.id,codigoEmpresa:t?.codigo_empresa}),je=(Array.isArray(nt)?nt:[]).map(yn=>yn?.nome).filter(Boolean);Ir[ge.id]=je.length?je.join(", "):null;const ht=await ii({comandaId:ge.id,codigoEmpresa:t?.codigo_empresa}),nr=(Array.isArray(ht)?ht:[]).reduce((yn,fn)=>{const Ln=(fn.quantidade||0)*(fn.preco_unitario||0)-(fn.desconto||0);return yn+Ln},0);re[ge.id]=nr}catch(nt){console.error("[confirmOpen] Erro ao buscar dados da comanda:",nt),Ir[ge.id]=null,re[ge.id]=0}}));const Ge=(kr||[]).map(ge=>{const nt=(Vr||[]).find(je=>je.mesa_id===ge.id),st=nt?Ir[nt.id]!==null?Ir[nt.id]:pn:null;return{id:ge.id,name:ge.nome||`Mesa ${ge.numero}`,status:nt?"in-use":"available",comandaId:nt?.id||null,customer:st,order:[],totalHint:nt&&re[nt.id]||0,aberto_em:nt?.aberto_em||null}});o(Ge)}catch(kr){console.error("[confirmOpen] Erro ao atualizar mesas:",kr)}vt(!1),Wt(null),yr(""),Ar([]),Lt(0),Xr(!1),e({title:"Mesa aberta",description:pn?`Comanda criada para: ${pn}`:"Comanda criada.",variant:"success"})}catch(Nr){console.error("[confirmOpen] Falha ao abrir mesa:",Nr?.message||Nr,Nr?.stack),e({title:"Falha ao abrir mesa",description:Nr?.message||"Tente novamente",variant:"destructive"})}finally{St(!1)}};return a.jsx(zn,{open:xt,onOpenChange:jn=>{vt(jn),jn||(Wt(null),yr(""),Ar([]),Lt(0),Xr(!1))},children:a.jsxs(qn,{className:"w-[95vw] max-w-md h-[560px] max-h-[75vh] flex flex-col animate-none overflow-hidden",onOpenAutoFocus:jn=>jn.preventDefault(),onPointerDownOutside:jn=>{jn.preventDefault(),jn.stopPropagation()},onInteractOutside:jn=>{jn.preventDefault(),jn.stopPropagation()},onEscapeKeyDown:jn=>{jn.preventDefault(),vt(!1)},onKeyDown:jn=>{jn.key==="Escape"&&(jn.preventDefault(),jn.stopPropagation(),vt(!1))},ref:wr,children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsxs($n,{className:"text-xl font-bold",children:["Abrir Mesa ",Nt?`#${Nt.number}`:""]}),a.jsx(la,{className:"text-sm",children:"Selecione um ou mais clientes para a mesa."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto thin-scroll min-h-0 space-y-2 py-2",ref:Dr,children:[a.jsxs("div",{children:[a.jsx(lt,{className:"text-sm font-medium mb-1.5 block",children:"Buscar cliente"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Nome, telefone ou cdigo",className:"pl-8 h-9 text-sm",value:se,ref:Jr,onChange:jn=>{ha.current=Date.now(),Se(jn.target.value)},onKeyDown:jn=>{if(jn.key==="Enter"){jn.preventDefault();try{if(Array.isArray(Pt)&&Pt.length>0){const Nr=Math.min(Math.max(Or||0,0),Pt.length-1),an=Pt[Nr];an?.id&&Ar(Nn=>Nn.includes(an.id)?Nn.filter(Sn=>Sn!==an.id):[...Nn,an.id])}}catch{}Se(""),setTimeout(()=>{try{dn.current?.focus()}catch{}},0)}else ha.current=Date.now()}})]}),a.jsx(Z,{type:"button",size:"icon",title:"Cadastrar cliente",className:"h-9 w-9 flex-shrink-0 bg-brand text-black hover:bg-brand/90",onClick:()=>{window.location.href="/clientes"},children:a.jsx(to,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"mt-1.5 text-[12px] text-text-muted flex items-center gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:""})," seleciona"]}),a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:""})," desmarca"]}),a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:"Enter"})," confirma"]}),a.jsx("span",{className:"inline-flex items-center gap-1",children:"Digite para buscar"})]})]}),a.jsx("div",{className:"min-h-[8px]",children:er.length>0&&a.jsxs("div",{className:"bg-success/10 border border-success/30 rounded-md p-2.5",children:[a.jsxs("div",{className:"text-xs font-medium text-success mb-1",children:[er.length," cliente",er.length>1?"s":""," selecionado",er.length>1?"s":""]}),a.jsx("div",{className:"text-sm text-text-primary",children:Pt.filter(jn=>er.includes(jn.id)).map(jn=>jn.nome).join(", ")})]})}),a.jsx("div",{className:"border rounded-md focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0",role:"listbox","aria-label":"Clientes","aria-activedescendant":Pt&&Pt.length>0&&Pt[Or]&&Pt[Or].id?`ot-option-${Pt[Or].id}`:void 0,ref:dn,tabIndex:0,onKeyDown:jn=>{try{if(jn.key&&jn.key.length===1&&!jn.ctrlKey&&!jn.metaKey&&!jn.altKey||jn.key==="Backspace"){jn.preventDefault(),jn.stopPropagation();let an=String(se||"");jn.key==="Backspace"?an=an.slice(0,-1):an+=jn.key,Se(an),ha.current=Date.now();try{Dr.current&&(Dr.current.scrollTop=0)}catch{}setTimeout(()=>{try{if(Jr.current){Jr.current.focus();const Nn=an.length;Jr.current.setSelectionRange?.(Nn,Nn)}}catch{}},0);return}if(["ArrowDown","ArrowUp","Home","End","ArrowRight","ArrowLeft"," "].includes(jn.key)){let an=Or||0;const Nn=Pt.length;jn.key==="ArrowDown"&&(an=Math.min(an+1,Nn-1)),jn.key==="ArrowUp"&&(an=Math.max(an-1,0)),jn.key==="Home"&&(an=0),jn.key==="End"&&(an=Nn-1),_n(an),setTimeout(()=>{try{fr.current[an]?.scrollIntoView({block:"nearest"})}catch{}},0);const Sn=Pt[an],hn=Sn?.codigo===0;if(jn.key==="ArrowRight"&&Sn?.id&&(hn?(Xr(!0),Lt(Pr=>Pr+1)):(yr(""),Ar(Pr=>Pr.includes(Sn.id)?Pr:[...Pr,Sn.id]))),jn.key==="ArrowLeft"&&Sn?.id)if(hn){const Pr=Math.max(0,Cr-1);Lt(Pr),Pr===0&&Xr(!1)}else Ar(Pr=>Pr.filter(pn=>pn!==Sn.id));jn.key===" "&&Sn?.id&&(yr(""),Ar(Pr=>Pr.includes(Sn.id)?Pr.filter(pn=>pn!==Sn.id):[...Pr,Sn.id]));return}if(jn.key==="Enter"){jn.preventDefault();const an=Math.min(Math.max(Or||0,0),Pt.length-1),Nn=Pt[an];if(Date.now()-ha.current<600||document.activeElement===Jr.current||se&&se.length>0){Nn?.id&&(yr(""),Ar(Pr=>Pr.includes(Nn.id)?Pr.filter(pn=>pn!==Nn.id):[...Pr,Nn.id])),Se(""),setTimeout(()=>{try{dn.current?.focus(),Dr.current&&(Dr.current.scrollTop=0)}catch{}},0);return}if(Nn?.id){const Pr=er.includes(Nn.id)?er:[...er,Nn.id];er.includes(Nn.id)||Ar(pn=>[...pn,Nn.id]),setTimeout(()=>{try{Gs(Pr)}catch{}},0);return}setTimeout(()=>{try{Gs(er)}catch{}},0);return}}catch{}},children:Ee?a.jsx("div",{className:"p-3 text-center text-sm text-text-muted",children:"Carregando..."}):Pt.length>0?a.jsx("ul",{className:"divide-y divide-border",children:Pt.map((jn,Nr)=>{const an=jn.codigo===0,Nn=er.includes(jn.id),Sn=Nr===(Or||0),hn=an?Cr:0;return a.jsxs("li",{id:`ot-option-${jn.id}`,ref:Pr=>{fr.current[Nr]=Pr},role:"option","aria-selected":Sn,className:Er("p-2.5 flex items-center gap-2 cursor-pointer transition-colors outline-none focus:outline-none focus-visible:outline-none border border-transparent",an?"bg-amber-500/5 border-l-2 border-l-amber-500/40":"",Nn&&!an?"bg-success/10 hover:bg-success/15":"hover:bg-surface-2",vn&&an?"bg-amber-500/10":"",Sn?"bg-brand/10":""),onClick:()=>{an?vn||(Xr(!0),Lt(1)):(yr(""),Ar(Pr=>Pr.includes(jn.id)?Pr.filter(pn=>pn!==jn.id):[...Pr,jn.id]))},onDoubleClick:()=>{if(!an){const Pr=er.includes(jn.id)?er:[...er,jn.id];Ar(Pr),setTimeout(()=>{try{Gs(Pr)}catch{}},0)}},onMouseEnter:()=>{Date.now()-(Mn.current||0)>300&&_n(Nr)},tabIndex:-1,children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[!an&&a.jsx("span",{className:Er("w-2 h-2 rounded-full flex-shrink-0",Nn?"bg-success":Sn?"bg-brand":"bg-border")}),a.jsxs("div",{className:"font-medium text-sm truncate",children:[jn.codigo!=null&&jn.codigo!==0?`${jn.codigo} - `:"",jn.nome,an&&a.jsx("span",{className:"ml-2 text-xs text-amber-600",children:"Cliente Padro"})]})]}),an?vn?a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx(Z,{type:"button",size:"sm",variant:"ghost",className:"h-7 w-7 p-0 hover:bg-red-500/10",onClick:Pr=>{Pr.stopPropagation();const pn=Math.max(0,Cr-1);Lt(pn),pn===0&&Xr(!1)},children:a.jsx(Nv,{className:"h-4 w-4"})}),a.jsx("div",{className:"w-8 h-7 flex items-center justify-center bg-surface-2 rounded text-sm font-medium",children:hn}),a.jsx(Z,{type:"button",size:"sm",variant:"ghost",className:"h-7 w-7 p-0 hover:bg-green-500/10",onClick:Pr=>{Pr.stopPropagation(),Lt(pn=>pn+1)},children:a.jsx(to,{className:"h-4 w-4"})})]}):null:a.jsx("div",{className:"ml-2 flex-shrink-0",children:Nn?a.jsx(Oi,{size:18,className:"text-success"}):a.jsx("div",{className:"w-[18px] h-[18px] rounded-full border-2 border-border"})})]},jn.id)})}):a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:"Nenhum cliente encontrado"})})]}),a.jsxs(Ua,{className:"flex-shrink-0 pt-3",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>{vt(!1),Wt(null),yr(""),Ar([])},children:"Cancelar"}),a.jsx(Z,{onClick:()=>Gs(),disabled:!Nt||dt,children:dt?"Abrindo...":"Confirmar Abertura"})]})]})})},R=()=>{const[se,Se]=p.useState("");return p.useEffect(()=>{Sr.current&&Se(Sr.current)},[]),a.jsxs(a.Fragment,{children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Abrir Caixa"}),a.jsx(iu,{children:"Insira o valor inicial (suprimento) para abrir o caixa."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(lt,{htmlFor:"initial-value",children:"Valor Inicial"}),a.jsxs("div",{className:"relative mt-2",children:[a.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:"R$"}),a.jsx(At,{id:"initial-value",type:"text",inputMode:"numeric",pattern:"[0-9.,]*",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,name:"cash-open-initial",placeholder:"0,00",className:"pl-9 font-semibold",value:se,onChange:Ee=>{const it=(Ee.target.value||"").replace(/\D/g,""),Pt=it?Number(it)/100:0,hr=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Pt);Se(hr),Sr.current=hr},onKeyDown:Ee=>{Ee.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ee.key)&&(/^[0-9]$/.test(Ee.key)||Ee.preventDefault())},onBeforeInput:Ee=>{const it=Ee.data??"";it&&/\D/.test(it)&&Ee.preventDefault()},onMouseDown:Ee=>Ee.stopPropagation()})]})]}),a.jsxs(su,{children:[a.jsx(lu,{onClick:()=>sr(!1),children:"Cancelar"}),a.jsx(Yu,{onClick:async()=>{if(!xr){Wr(!0);try{const Ee=String(se).replace(/\./g,"").replace(",","."),it=Number(Ee)||0;try{localStorage.setItem("cash:opening",String(Date.now()))}catch{}await wm({saldoInicial:it,codigoEmpresa:t?.codigo_empresa}),await Br(),await ar({showToast:!1}),sr(!1),e({title:"Caixa aberto com sucesso!",variant:"success"}),Sr.current="",Se("")}catch(Ee){e({title:"Falha ao abrir caixa",description:Ee?.message||"Tente novamente",variant:"destructive"})}finally{try{localStorage.removeItem("cash:opening")}catch{}Wr(!1)}}},children:"Confirmar Abertura"})]})]})},fe=()=>a.jsxs(Xu,{open:ut,onOpenChange:sr,children:[a.jsx(Sg,{asChild:!0,children:a.jsxs(Z,{variant:"success",size:"sm",disabled:c||xr,onClick:()=>sr(!0),className:"px-3 whitespace-nowrap",children:[a.jsx(NG,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Abrir"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Abrir Caixa"}),a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-emerald-700 border border-emerald-800 rounded shadow-sm",children:"F10"})]})}),a.jsx(nu,{className:"sm:max-w-[425px] animate-none",onKeyDown:se=>se.stopPropagation(),onKeyDownCapture:se=>se.stopPropagation(),onEscapeKeyDown:se=>se.preventDefault(),onPointerDownOutside:se=>{se.preventDefault(),se.stopPropagation()},onInteractOutside:se=>{se.preventDefault(),se.stopPropagation()},children:a.jsx(R,{})})]}),We=()=>{const[se,Se]=p.useState({loading:!1,saldoInicial:0,resumo:null}),[Ee,it]=p.useState(!1),[Pt,hr]=p.useState(!1),[er,Ar]=p.useState(!1),[Cr,Lt]=p.useState(!1),[vn,Xr]=p.useState(""),Or=async()=>{try{Se({loading:!0,saldoInicial:0,resumo:null});const Dr=await qh({codigoEmpresa:t?.codigo_empresa}),wr=await P1({codigoEmpresa:t?.codigo_empresa});Se({loading:!1,saldoInicial:Number(Dr?.saldo_inicial||0),resumo:wr||{totalPorFinalizadora:{}}})}catch{Se({loading:!1,saldoInicial:0,resumo:{totalPorFinalizadora:{}}})}},_n=se?.resumo?.totalPorFinalizadora||{},fr=Object.values(_n).reduce((Dr,wr)=>Dr+Number(wr||0),0),dn=Number(se.saldoInicial||0)+fr;return a.jsxs(a.Fragment,{children:[a.jsxs(Xu,{open:Ee,onOpenChange:Dr=>{it(Dr),Dr&&Or()},children:[a.jsx(Sg,{asChild:!0,children:a.jsxs(Z,{variant:"destructive",size:"sm",disabled:!c,onClick:()=>it(!0),className:"px-3 whitespace-nowrap",children:[a.jsx(u0,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Fechar"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Fechar Caixa"})]})}),a.jsxs(nu,{className:"sm:max-w-[425px] w-[92vw] max-h-[85vh] animate-none",onOpenAutoFocus:Dr=>Dr.preventDefault(),onKeyDown:Dr=>Dr.stopPropagation(),onKeyDownCapture:Dr=>Dr.stopPropagation(),onPointerDownOutside:Dr=>{Dr.preventDefault(),Dr.stopPropagation()},onInteractOutside:Dr=>{Dr.preventDefault(),Dr.stopPropagation()},children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Fechar Caixa"}),a.jsx(iu,{children:"Confira os valores e confirme o fechamento do caixa. Esta ao  irreversvel."})]}),er&&a.jsxs("div",{className:"md:hidden mb-2 text-[12px] text-warning bg-warning/10 border border-warning/30 rounded px-2 py-1 flex items-center gap-1",children:[a.jsx(kd,{className:"h-3.5 w-3.5"}),"Existem comandas abertas. Finalize-as antes de fechar o caixa."]}),se.loading?a.jsx("div",{className:"py-4 text-text-muted",children:"Carregando resumo"}):a.jsxs("div",{className:"py-4 space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial:"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(se.saldoInicial||0).toFixed(2)]})]}),Object.keys(_n).length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos nesta sesso."}):Object.entries(_n).map(([Dr,wr])=>a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"text-text-secondary",children:[String(Dr),":"]})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(wr||0).toFixed(2)]})]},Dr)),a.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[a.jsx("span",{className:"text-text-primary",children:"Total em Caixa:"})," ",a.jsxs("span",{className:"font-mono text-success",children:["R$ ",Number(dn||0).toFixed(2)]})]})]}),a.jsxs(su,{children:[a.jsx(lu,{onClick:()=>it(!1),disabled:Cr,children:"Cancelar"}),a.jsx(Yu,{onClick:()=>{hr(!0)},disabled:Cr,children:"Continuar"})]})]})]}),a.jsx(Xu,{open:Pt,onOpenChange:Dr=>{Cr||hr(Dr)},children:a.jsxs(nu,{className:"sm:max-w-[425px] w-[92vw] max-h-[85vh] animate-none",onOpenAutoFocus:Dr=>Dr.preventDefault(),onEscapeKeyDown:Dr=>{Cr||Dr.preventDefault()},onKeyDown:Dr=>Dr.stopPropagation(),onKeyDownCapture:Dr=>Dr.stopPropagation(),onPointerDownOutside:Dr=>{Cr||(Dr.preventDefault(),Dr.stopPropagation())},onInteractOutside:Dr=>{Cr||(Dr.preventDefault(),Dr.stopPropagation())},children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Confirmar Fechamento do Caixa"}),a.jsx(iu,{children:"Informe o saldo final para finalizar o fechamento."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(lt,{htmlFor:"valor-contado-final",className:"text-sm font-medium text-text-primary mb-2 block",children:"Saldo Final (opcional)"}),a.jsx("input",{id:"valor-contado-final",type:"text",placeholder:"R$ 0,00",value:vn,onChange:Dr=>{let wr=Dr.target.value.replace(/\D/g,"");wr.length>0&&(wr=(Number(wr)/100).toFixed(2),wr=wr.replace(".",","),wr="R$ "+wr),Xr(wr)},className:"w-full px-3 py-2 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),a.jsxs(su,{children:[a.jsx(lu,{onClick:()=>{hr(!1)},disabled:Cr,children:"Voltar"}),a.jsx(Yu,{onClick:async()=>{try{if(Cr)return;Lt(!0);const Dr=Number(se.saldoInicial||0)+fr,wr=vn?Number(vn.replace(/[^0-9,]/g,"").replace(",",".")):null;await ine({saldoFinal:Dr,valorFinalDinheiro:wr,codigoEmpresa:t?.codigo_empresa}),d(!1),typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{hr(!1),it(!1),Xr(""),e({title:"Caixa fechado!",description:`Saldo final: R$ ${Dr.toFixed(2)}`,duration:4e3})}):(hr(!1),it(!1),Xr(""),e({title:"Caixa fechado!",description:`Saldo final: R$ ${Dr.toFixed(2)}`,duration:4e3})),setTimeout(async()=>{try{await qh({codigoEmpresa:t?.codigo_empresa})}catch{}},0)}catch(Dr){console.error(Dr);const wr=Dr?.message||"Tente novamente";if(Ot){Ze(wr.includes("Existem")?wr:`Falha ao fechar caixa: ${wr}`);try{hr(!1),it(!1)}catch{}typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{Fe(!0)}):Fe(!0),setTimeout(()=>Fe(!1),2600)}else e({title:"Falha ao fechar caixa",description:wr,variant:"destructive"})}finally{Lt(!1)}},children:"Confirmar Fechamento"})]})]})})]})},gt=()=>{const[se,Se]=p.useState(""),[Ee,it]=p.useState([]),[Pt,hr]=p.useState([]),[er,Ar]=p.useState(!1),[Cr,Lt]=p.useState(new Set),vn=p.useRef([]),Xr=p.useRef(!1),[Or,_n]=p.useState(0);p.useRef([]);const fr=p.useRef(null);p.useRef(0);const[dn,Dr]=p.useState(!1),[wr,Jr]=p.useState(null),[Mn,ha]=p.useState(null),[is,Gs]=p.useState("");p.useEffect(()=>{let vr=!0;const kr=async()=>{if(!(!ue||!i?.comandaId)&&!(Xr.current&&se===""))try{Ar(!0);const Vr=await rl({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa});if(!vr)return;const Ir=(Vr||[]).map(Ge=>({id:Ge.id,cliente_id:Ge.cliente_id,nome:Ge.nome||"",tipo:Ge.tipo||(Ge.cliente_id?"cadastrado":"livre")}));hr(Ir),vn.current=JSON.parse(JSON.stringify(Ir)),Lt(new Set);const re=await ew({searchTerm:se,limit:50,codigoEmpresa:t?.codigo_empresa});if(!vr)return;const we=(re||[]).slice().sort((Ge,ge)=>Number(Ge?.codigo||0)-Number(ge?.codigo||0));it(we),_n(0),Xr.current=!0}catch(Vr){console.error("Erro ao carregar clientes:",Vr)}finally{vr&&Ar(!1)}};return ue?(kr(),()=>{vr=!1}):(Xr.current=!1,Se(""),()=>{vr=!1})},[ue,i?.comandaId]),p.useEffect(()=>{ue&&Array.isArray(Ee)&&Ee.length>0&&(_n(0),setTimeout(()=>{try{const vr=document.querySelector('[role="dialog"]');if(vr){const kr=vr.querySelector(".overflow-y-auto");kr&&(kr.scrollTop=0)}}catch{}},0))},[ue,Ee.length]),p.useEffect(()=>(ue&&i?.comandaId?(Pn.current=!0,Ct.current=i.comandaId,lr.current=vr=>{hr(vr||[]),jn(vr||[])}):ue||Pn.current&&Ct.current===i?.comandaId&&(Pn.current=!1,Ct.current=null,lr.current=null),()=>{ue||(Pn.current=!1,Ct.current=null,lr.current=null)}),[ue,i?.comandaId]);const jn=vr=>{try{if(!i?.id)return;const kr=(vr||[]).map(Ir=>Ir?.nome).filter(Boolean),Vr=kr.length?kr.join(", "):null;l(Ir=>Ir&&Ir.id===i.id?{...Ir,customer:Vr}:Ir),o(Ir=>Ir.map(re=>re.id===i.id?{...re,customer:Vr}:re))}catch(kr){console.error("[ManageClientsDialog] Erro ao sincronizar nomes na mesa:",kr)}},Nr=()=>{try{console.log("[ManageClientsDialog] addConsumidor clicado")}catch{}i?.comandaId&&(async()=>{try{Ar(!0);const{data:vr,error:kr}=await Q.from("comanda_clientes").insert({comanda_id:i.comandaId,nome_livre:"Consumidor",codigo_empresa:t?.codigo_empresa}).select("id, cliente_id, nome_livre").single();if(kr)throw kr;const Vr={id:vr.id,cliente_id:vr.cliente_id,nome:vr.nome_livre||"Consumidor",tipo:"livre"};hr(Ir=>{const re=[...Ir,Vr];return jn(re),re}),ha(Vr.id),Gs(Vr.nome||"Consumidor")}catch(vr){console.error("[ManageClientsDialog] Erro ao adicionar consumidor:",vr),e({title:"Falha ao adicionar consumidor",description:vr?.message||"Tente novamente",variant:"destructive"})}finally{Ar(!1)}})()},an=vr=>{try{console.log("[ManageClientsDialog] addClientFromModal clicado:",vr)}catch{}if(!i?.comandaId)return;const kr=Ee.find(Vr=>Vr.id===vr);kr&&(async()=>{try{Ar(!0);const{data:Vr,error:Ir}=await Q.from("comanda_clientes").insert({comanda_id:i.comandaId,cliente_id:vr,codigo_empresa:t?.codigo_empresa}).select("id, cliente_id").single();if(Ir)throw Ir;const re={id:Vr.id,cliente_id:Vr.cliente_id,nome:kr.nome,tipo:"cadastrado"};hr(we=>{const Ge=[...we,re];return jn(Ge),Ge}),Dr(!1)}catch(Vr){console.error("[ManageClientsDialog] Erro ao adicionar cliente:",Vr),e({title:"Falha ao adicionar cliente",description:Vr?.message||"Tente novamente",variant:"destructive"})}finally{Ar(!1)}})()},Nn=(vr,kr)=>{const Vr=Ee.find(re=>re.id===kr);!Vr||!Pt.find(re=>re.id===vr)||(async()=>{try{if(Ar(!0),String(vr).startsWith("temp-")){const{data:re,error:we}=await Q.from("comanda_clientes").insert({comanda_id:i.comandaId,cliente_id:kr,codigo_empresa:t?.codigo_empresa}).select("id, cliente_id").single();if(we)throw we;const Ge={id:re.id,cliente_id:re.cliente_id,nome:Vr.nome,tipo:"cadastrado"};hr(ge=>{const nt=[...ge.filter(st=>st.id!==vr),Ge];return jn(nt),nt})}else{const{error:re}=await Q.from("comanda_clientes").update({cliente_id:kr,nome_livre:null}).eq("id",vr).eq("codigo_empresa",t?.codigo_empresa);if(re)throw re;hr(we=>{const Ge=we.map(ge=>ge.id===vr?{...ge,cliente_id:kr,nome:Vr.nome,tipo:"cadastrado"}:ge);return jn(Ge),Ge})}Jr(null),Dr(!1)}catch(re){console.error("[ManageClientsDialog] Erro ao trocar cliente:",re),e({title:"Falha ao trocar cliente",description:re?.message||"Tente novamente",variant:"destructive"})}finally{Ar(!1)}})()},Sn=vr=>{if(Pt.find(Vr=>Vr.id===vr)){if(String(vr).startsWith("temp-")||!i?.comandaId){hr(Vr=>{const Ir=Vr.filter(re=>re.id!==vr);return jn(Ir),Ir});return}(async()=>{try{Ar(!0);const{error:Vr}=await Q.from("comanda_clientes").delete().eq("id",vr).eq("codigo_empresa",t?.codigo_empresa);if(Vr)throw Vr;hr(Ir=>{const re=Ir.filter(we=>we.id!==vr);return jn(re),re})}catch(Vr){console.error("[ManageClientsDialog] Erro ao remover cliente:",Vr),e({title:"Falha ao remover cliente",description:Vr?.message||"Tente novamente",variant:"destructive"})}finally{Ar(!1)}})()}},hn=vr=>{try{console.log("[ManageClientsDialog] startEditConsumidor clicado:",vr)}catch{}const kr=Pt.find(Vr=>Vr.id===vr);kr&&(ha(vr),Gs(kr.nome||"Consumidor"))},Pr=()=>{if(!Mn||!i?.comandaId)return;const vr=is.trim()||"Consumidor";(async()=>{try{if(Ar(!0),!String(Mn).startsWith("temp-")){const{error:kr}=await Q.from("comanda_clientes").update({nome_livre:vr}).eq("id",Mn).eq("codigo_empresa",t?.codigo_empresa);if(kr)throw kr}hr(kr=>{const Vr=kr.map(Ir=>Ir.id===Mn?{...Ir,nome:vr}:Ir);return jn(Vr),Vr})}catch(kr){console.error("[ManageClientsDialog] Erro ao salvar consumidor:",kr),e({title:"Falha ao salvar cliente",description:kr?.message||"Tente novamente",variant:"destructive"})}finally{Ar(!1),ha(null),Gs("")}})()},pn=async()=>{_e(!1)};return a.jsxs(zn,{open:ue,onOpenChange:_e,children:[a.jsxs(qn,{className:"sm:max-w-[480px] w-[92vw] max-h-[85vh] h-[85vh] animate-none flex flex-col overflow-hidden",onOpenAutoFocus:vr=>vr.preventDefault(),onPointerDownOutside:vr=>{vr.preventDefault(),vr.stopPropagation()},onInteractOutside:vr=>{vr.preventDefault(),vr.stopPropagation()},onEscapeKeyDown:vr=>vr.preventDefault(),children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsx($n,{children:"Gerenciar Clientes da Mesa"}),a.jsx(la,{children:"Gerencie os clientes vinculados a esta mesa."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 space-y-4 thin-scroll",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-sm font-medium text-text-primary",children:["Clientes vinculados (",Pt.length,"):"]}),Pt.length===0?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted border border-dashed rounded-md",children:"Nenhum cliente vinculado ainda"}):a.jsx("div",{className:"space-y-2",children:Pt.map(vr=>{const kr=vr.tipo==="livre",Vr=Mn===vr.id;return a.jsx("div",{className:Er("flex items-center gap-2 p-2 rounded-md border",kr?"bg-amber-500/10 border-amber-500/30":"bg-surface-2 border-border"),children:Vr?a.jsxs(a.Fragment,{children:[a.jsx(At,{value:is,onChange:Ir=>Gs(Ir.target.value),onKeyDown:Ir=>{Ir.key==="Enter"&&Pr(),Ir.key==="Escape"&&(ha(null),Gs("")),Ir.stopPropagation()},className:"flex-1 h-8",autoFocus:!0}),a.jsx(Z,{size:"sm",onClick:Pr,className:"h-8 px-2",children:a.jsx(Oi,{className:"h-4 w-4"})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:Er("flex-1 text-sm truncate p-1 rounded",kr?"cursor-pointer hover:bg-amber-500/10":"cursor-default"),onClick:()=>kr&&hn(vr.id),title:kr?"Clique para editar":"",children:[a.jsx("span",{children:vr.nome}),kr&&a.jsx("span",{className:"ml-2 text-[11px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-600 border border-amber-500/30 align-middle",children:"Cliente Padro"})]}),!kr&&a.jsx(Z,{size:"sm",variant:"ghost",onClick:()=>{Jr(vr.id),Dr(!0)},className:"h-7 px-2",title:"Trocar cliente",children:a.jsx(xc,{className:"h-4 w-4"})}),a.jsx(Z,{size:"sm",variant:"ghost",onClick:()=>Sn(vr.id),className:"h-7 px-2 text-destructive hover:text-destructive",children:a.jsx(Yc,{className:"h-4 w-4"})})]})},vr.id)})})]}),a.jsxs(Z,{onClick:()=>{Jr(null),Dr(!0)},className:"w-full",size:"sm",children:[a.jsx(to,{className:"h-4 w-4 mr-2"}),"Adicionar Cliente"]})]}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>_e(!1),disabled:er,children:"Cancelar"}),a.jsx(Z,{onClick:pn,disabled:er,children:er?"Salvando...":`Confirmar ${Cr.size>0?`(${Cr.size} alteraes)`:""}`})]})]}),a.jsx(zn,{open:dn,onOpenChange:Dr,children:a.jsxs(qn,{className:"sm:max-w-[500px] max-h-[80vh] flex flex-col",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:wr?"Trocar Cliente":"Adicionar Cliente"}),a.jsx(la,{children:"Selecione um cliente da lista"})]}),a.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar cliente...",className:"pl-9",value:se,onChange:vr=>Se(vr.target.value)})]}),a.jsx("div",{className:"flex-1 border rounded-md overflow-y-auto thin-scroll",role:"listbox","aria-label":"Clientes disponveis",ref:fr,tabIndex:0,children:er?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Carregando..."}):Ee.length===0?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Nenhum cliente encontrado"}):a.jsx("ul",{className:"divide-y divide-border",children:Ee.map(vr=>{const kr=vr.codigo===0,Vr=Pt.some(Ir=>Ir.cliente_id===vr.id&&Ir.tipo==="cadastrado");return a.jsxs("li",{className:Er("p-3 cursor-pointer transition-colors flex items-center justify-between",kr?"bg-amber-500/5 hover:bg-amber-500/10":"hover:bg-surface-2"),onClick:()=>{kr?wr?(Jr(null),Dr(!1)):(Nr(),Dr(!1)):wr?Nn(wr,vr.id):an(vr.id)},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"font-medium truncate flex items-center gap-2",children:[kr?"Cliente Consumidor":`${vr?.codigo?`${vr.codigo} - `:""}${vr?.nome||""}`,kr&&a.jsx("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-600 border border-amber-500/30",children:"Cliente Padro"})]}),!kr&&vr.telefone&&a.jsx("div",{className:"text-xs text-text-muted",children:vr.telefone}),kr&&a.jsx("div",{className:"text-xs text-text-muted",children:"Clique para adicionar consumidor"})]}),Vr&&!kr&&a.jsx(Oi,{className:"h-5 w-5 text-success ml-2 flex-shrink-0"})]},vr.id)})})})]}),a.jsx(Ua,{children:a.jsx(Z,{variant:"outline",onClick:()=>Dr(!1),children:"Cancelar"})})]})})]})},Ut=()=>{const se=Se=>Se==="available"?"bg-success/10 border-success/30 text-success":Se==="in-use"?"bg-warning/10 border-warning/30 text-warning":Se==="awaiting-payment"?"bg-info/10 border-info/30 text-info":"bg-surface-2 border-border text-text-secondary";return a.jsx("div",{className:"md:hidden space-y-2",children:s.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("div",{className:"text-text-muted mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhuma mesa encontrada"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Crie sua primeira mesa para comear"})]}):s.map(Se=>{const Ee=Oe(Se.order||[],Se),it=Se.totalHint>0?Se.totalHint:Ee;return a.jsx("div",{onClick:async()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}await Xt(Se),Se.status!=="available"&&Tr(!0)},className:Er("p-3 rounded-lg border-2 bg-surface transition-all active:scale-[0.98]",se(Se.status),i?.id===Se.id&&"ring-2 ring-brand/60",c?"cursor-pointer":"cursor-not-allowed opacity-60"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("h3",{className:"font-bold text-base truncate",children:Se.name||`Mesa ${Se.number}`}),Se.status==="available"&&Se.id===Ye&&a.jsx("kbd",{className:"hidden md:inline px-2 py-1 text-xs font-bold font-mono text-gray-400 bg-transparent border border-gray-300/50 rounded flex-shrink-0",children:"F1"})]})}),Se.status==="in-use"||Se.status==="awaiting-payment"?a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-text-secondary",children:[a.jsx(vc,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:mr(Se.customer)||"Sem cliente"})]}),a.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-semibold text-text-primary",children:[a.jsx(Vi,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsxs("span",{children:["R$ ",it.toFixed(2)]})]})]}):a.jsx("div",{className:"text-xs text-text-muted",children:"Mesa disponvel"})]}),a.jsx("div",{className:"w-12 flex items-center justify-center ml-1 mr-1",children:Se.status==="available"?a.jsx("img",{src:"/mesalivre.png",alt:"Mesa livre",className:"w-10 h-10 object-contain opacity-80"}):a.jsx("img",{src:"/mesaocupada.png",alt:"Mesa ocupada",className:"w-10 h-10 object-contain opacity-80"})}),a.jsx(Yg,{className:"w-5 h-5 text-text-muted flex-shrink-0 ml-1"})]})},Se.id)})})},zr=()=>i?a.jsx(zn,{open:qr,modal:!q,onOpenChange:se=>{He||!se&&q||(Tr(se),se||ne(null),se&&P("tables"))},children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-2xl max-h-[85vh] flex flex-col p-0 gap-0 animate-none",children:[a.jsxs("div",{className:"p-4 border-b border-border bg-surface-2",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx($n,{className:"text-xl font-bold",children:i.name||`Mesa ${i.number}`})}),a.jsx(la,{className:"sr-only",children:"Visualizao da comanda e produtos da mesa selecionada"}),(i.status==="in-use"||i.status==="awaiting-payment")&&a.jsxs("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(vc,{className:"w-4 h-4"}),a.jsx("span",{children:mr(i.customer)||"Sem cliente"})]}),i.order&&i.order.length>0&&a.jsxs("div",{className:"flex items-center gap-1 font-semibold text-text-primary",children:[a.jsx(Vi,{className:"w-4 h-4"}),a.jsxs("span",{children:["R$ ",(i.totalHint>0?i.totalHint:Oe(i.order||[])).toFixed(2)]})]})]})]}),a.jsxs(Sd,{value:sn,onValueChange:se=>{if(Cn(se),ne(null),se==="products"&&i){w(!0);try{Tr(!1)}catch{}Cn("order")}},className:"flex flex-col flex-1 min-h-0",children:[a.jsxs(jc,{className:"grid w-full grid-cols-3 m-2 rounded-lg",children:[a.jsx(Ga,{value:"order",className:"text-sm flex items-center justify-center gap-2",children:"Comanda"}),a.jsx(Ga,{value:"details",className:"text-sm flex items-center justify-center gap-2",children:"Detalhes"}),a.jsxs(Ga,{value:"products",className:"text-sm flex items-center justify-center gap-2",onClick:()=>{if(i){w(!0);try{Tr(!1)}catch{}}},children:["Produtos",a.jsx("kbd",{className:"hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"P"})]})]}),a.jsx(vo,{value:"order",className:"flex-1 overflow-hidden min-h-0 m-0",onKeyDown:se=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(se.key)&&P("tables")},children:a.jsx(tr,{table:i})}),a.jsx(vo,{value:"details",className:"flex-1 overflow-hidden min-h-0 m-0",children:a.jsx(yt,{table:i})})]})]})}):null,cn=()=>{const se=k,Se=se&&Ht.get(se.id)||0,Ee=se?Number(se.salePrice??se.price??0):0,it=Pt=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Pt||0));return a.jsx(zn,{open:q,onOpenChange:Pt=>{z(Pt),Pt||$(null)},children:a.jsxs(qn,{overlayClassName:"z-[70]",className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[71]",onOpenAutoFocus:Pt=>{},onKeyDown:Pt=>Pt.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold break-words",title:se?.name||"",children:se?.name||"Produto"}),a.jsx(la,{children:"Detalhes do produto e aes rpidas."})]}),se?a.jsxs("div",{className:"space-y-3 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:it(Ee)})]}),se.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:se.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof se.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:se.stock})]}),typeof se.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:se.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",Se]})]})]})]}):null,a.jsxs(Ua,{className:"flex items-center justify-between gap-2",children:[a.jsxs(Z,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{se&&n("/produtos",{state:{productId:se.id,productName:se.name}})},children:[a.jsx(ol,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(Z,{variant:"outline",onClick:()=>{z(!1),$(null)},children:"Fechar"}),a.jsx(Z,{onClick:async()=>{se&&(await Lr(se),z(!1),$(null))},children:"Adicionar"})]})]})})};return a.jsxs(a.Fragment,{children:[a.jsx(cn,{}),a.jsx(Yi,{}),a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"md:hidden mb-2 w-full",children:a.jsx(Sd,{value:"mesas",onValueChange:se=>{se==="mesas"&&n("/vendas"),se==="balcao"&&n("/balcao"),se==="historico"&&n("/historico")},children:a.jsxs(jc,{className:"grid w-full grid-cols-3",children:[a.jsx(Ga,{value:"mesas",className:"text-xs",title:"Pressione B para alternar",children:"Mesas"}),a.jsx(Ga,{value:"balcao",className:"text-xs",title:"Pressione B para alternar",children:"Balco"}),a.jsx(Ga,{value:"historico",className:"text-xs",title:"Pressione H para ir ao histrico",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center justify-between mb-2 md:mb-6 gap-2 md:gap-3 pr-2",children:[a.jsx("div",{className:"hidden md:flex items-center gap-2 md:gap-3",children:a.jsx(Sd,{value:"mesas",onValueChange:se=>{se==="mesas"&&n("/vendas"),se==="balcao"&&n("/balcao"),se==="historico"&&n("/historico")},children:a.jsxs(jc,{className:"inline-flex",children:[a.jsx(Ga,{value:"mesas",className:"text-sm",title:"Pressione B para alternar",children:"Mesas"}),a.jsx(Ga,{value:"balcao",className:"text-sm",title:"Pressione B para alternar",children:"Balco"}),a.jsx(Ga,{value:"historico",className:"text-sm",title:"Pressione H para ir ao histrico",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[a.jsx(fe,{}),a.jsx(We,{}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>g(!0),className:"px-2.5",children:[a.jsx(Y4,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Detalhes"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Detalhes do Caixa"}),a.jsx("kbd",{className:"ml-2 hidden lg:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F11"})]}),a.jsx("div",{className:"hidden md:block w-px h-6 bg-border mx-1"}),a.jsx(Z,{onClick:()=>ie(!0),className:"inline-flex h-9 w-9 p-0 items-center justify-center shrink-0",size:"icon",variant:"outline",title:"Gerenciar Mesas",children:a.jsx(Xc,{className:"h-4 w-4"})}),a.jsxs(Z,{onClick:()=>Te(!0),className:"hidden md:flex px-3",size:"sm",children:[a.jsx(to,{className:"mr-2 h-4 w-4"})," Nova Mesa",a.jsx("kbd",{className:"ml-2 hidden lg:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F1"})]})]})]}),!c&&u>0&&a.jsxs("div",{className:"md:hidden mb-3 text-[11px] text-warning flex items-center gap-2",children:[a.jsx(kd,{className:"h-3 w-3"}),"H comandas abertas, mas o caixa parece fechado.",a.jsx(Z,{size:"sm",variant:"outline",className:"h-6 px-2 text-[11px]",onClick:()=>sr(!0),children:"Reabrir sesso"})]}),a.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-visible min-h-0",children:[a.jsxs("div",{className:"lg:col-span-2 bg-surface rounded-lg border border-border p-4 md:p-6 overflow-y-auto thin-scroll min-h-0",tabIndex:0,onKeyDown:se=>{S==="tables"&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(se.key)&&se.preventDefault()},onClick:se=>{se.stopPropagation(),se.preventDefault(),P("tables"),!i&&s.length>0&&l(s[0]),se.currentTarget.focus()},onFocus:()=>{P("tables"),!i&&s.length>0&&l(s[0])},style:{outline:S==="tables"?"2px solid rgba(148, 163, 184, 0.4)":"none",outlineOffset:"-2px",transition:"outline 0.15s ease"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 gap-4",children:[a.jsx("h2",{className:"text-xl font-bold",children:"Mapa de Mesas"}),a.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-text-muted flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:""}),a.jsx("span",{children:"Navegar"})]}),a.jsx("div",{className:"w-px h-3 bg-border"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"Enter"}),a.jsx("span",{children:"Selecionar"})]})]}),a.jsx(Z,{type:"button",className:"md:hidden h-9 w-9 p-0 bg-amber-400 text-black hover:bg-amber-300 flex-shrink-0",size:"icon",title:"Nova Mesa",onClick:()=>Te(!0),children:a.jsx(to,{className:"h-5 w-5"})})]}),a.jsx(Ut,{}),a.jsx("div",{className:"hidden md:block",children:a.jsx(xat,{onDragEnd:J,children:a.jsx(aoe,{droppableId:"tables",children:se=>a.jsxs("div",{...se.droppableProps,ref:Se=>{se.innerRef(Se),cr.current=Se},role:"grid","aria-label":"Lista de mesas",className:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(240px,1fr))]",children:[s.length===0?a.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("div",{className:"text-text-muted mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhuma mesa encontrada"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Crie sua primeira mesa para comear a receber pedidos"}),a.jsxs(Z,{onClick:()=>Te(!0),className:"flex items-center gap-2",children:[a.jsx(to,{size:16}),"Criar Nova Mesa"]})]}):s.map((Se,Ee)=>a.jsx(est,{draggableId:Se.id,index:Ee,children:(it,Pt)=>a.jsx(Ke,{table:Se,provided:it,isDragging:Pt.isDragging})},Se.id)),se.placeholder]})})})})]}),a.jsx("div",{className:"hidden md:flex bg-surface rounded-lg border border-border flex-col min-h-0 transition-all overflow-hidden",style:{boxShadow:S==="panel"?"inset 0 0 0 2px rgba(148, 163, 184, 0.4)":"none"},children:a.jsxs(Sd,{value:M,onValueChange:se=>{O(se),se==="products"&&i&&(w(!0),O("order"))},className:"flex flex-col h-full",children:[a.jsxs(jc,{className:"grid w-full grid-cols-3 m-2",children:[a.jsx(Ga,{value:"order",className:"flex items-center justify-center gap-2 text-xs",children:"Comanda"}),a.jsx(Ga,{value:"details",className:"flex items-center justify-center gap-2 text-xs",children:"Detalhes"}),a.jsxs(Ga,{value:"products",onClick:()=>{i&&w(!0)},className:"flex items-center justify-center gap-2 text-xs",children:["Produtos",a.jsx("kbd",{className:"hidden md:inline px-1 py-0.5 text-[10px] font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"P"})]})]}),a.jsx(vo,{value:"order",className:"flex-1 overflow-hidden min-h-0",children:a.jsx(tr,{table:i})}),a.jsx(vo,{value:"details",className:"flex-1 overflow-hidden min-h-0",children:a.jsx(yt,{table:i})})]})})]})]}),a.jsx(zr,{}),a.jsx(xl,{}),a.jsx(xe,{open:x,onOpenChange:g,cashSummary:I}),a.jsx(Vt,{}),a.jsx($e,{}),ue?a.jsx(gt,{}):null,a.jsx(vl,{}),a.jsx(dr,{}),a.jsx(tn,{}),ze&&a.jsx("div",{className:"fixed left-3 right-3 z-[9999]",role:"alert","aria-live":"assertive",style:{bottom:"calc(12px + env(safe-area-inset-bottom, 0px))"},children:a.jsxs("div",{className:"pointer-events-none flex items-start gap-2 rounded-md border border-amber-500 bg-amber-400 text-black px-3 py-2 shadow-lg",children:[a.jsx(kd,{className:"h-4 w-4 mt-0.5","aria-hidden":"true"}),a.jsx("div",{className:"text-sm font-semibold leading-snug drop-shadow-[0_1px_0_rgba(255,255,255,0.25)]",children:Le||"Ateno"})]})}),zt&&a.jsx(mst,{item:zt,onApply:()=>{i&&ot(i)},onClose:()=>{ne(null)},codigoEmpresa:t?.codigo_empresa}),!Ot&&i&&He&&a.jsx(ooe,{comanda:{id:i.comandaId,desconto_tipo:i.desconto_tipo||null,desconto_valor:Number(i.desconto_valor||0),desconto_motivo:i.desconto_motivo||null},subtotal:(()=>{let se=0,Se=0;for(const Ee of i.order||[]){const it=(Ee.price||0)*(Ee.quantity||1);se+=it,Ee.desconto_tipo==="percentual"&&Ee.desconto_valor>0?Se+=it*(Ee.desconto_valor/100):Ee.desconto_tipo==="fixo"&&Ee.desconto_valor>0&&(Se+=Ee.desconto_valor)}return Math.max(0,se-Se)})(),onApply:se=>{(async()=>(se&&l(Se=>!Se||Se.comandaId!==se.id?Se:{...Se,desconto_tipo:se.desconto_tipo||null,desconto_valor:Number(se.desconto_valor||0),desconto_motivo:se.desconto_motivo||null}),i&&await ot(i),Gt(!1)))()},onClose:()=>Gt(!1),codigoEmpresa:t?.codigo_empresa}),(dt||ft||gr)&&a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80",children:a.jsxs("div",{className:"px-8 py-6 rounded-xl bg-surface border border-border shadow-2xl flex flex-col items-center gap-4 max-w-sm w-[85vw] text-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-brand border-t-transparent animate-spin","aria-hidden":"true"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"block text-base font-semibold text-text-primary",children:dt?"Abrindo mesa...":ft?"Cancelando comanda...":"Fechando conta..."}),a.jsx("span",{className:"block text-xs text-text-muted",children:dt?"Aguarde, estamos criando a comanda e sincronizando com os outros dispositivos.":ft?"Aguarde, estamos cancelando a comanda e liberando a mesa em todos os dispositivos.":"Aguarde, estamos registrando os pagamentos e liberando a mesa em todos os dispositivos."})]})]})}),p.useMemo(()=>a.jsx(da,{},(i?.order||[]).map(se=>`${String(se.productId)}:${Number(se.quantity||0)}`).join("|")),[b,i?.id,i?.order])]})}function gst(){const{toast:e}=Xs(),t=Ol(),{userProfile:r}=fo(),[n,s]=p.useState(null),[o,i]=p.useState([]),[l,c]=p.useState([]),[d,u]=p.useState(!0),[f,h]=p.useState(!1),[m,x]=p.useState(!1),[g,v]=p.useState(!1),[y,b]=p.useState(""),[w,j]=p.useState(""),[_,C]=p.useState(null),[A,S]=p.useState(null),[P,M]=p.useState(!1),O=p.useRef(!1),[I,T]=p.useState(new Map),[k,$]=p.useState(!1),[q,z]=p.useState(!1),[F,V]=p.useState(!1),[ue,_e]=p.useState(!1),[U,L]=p.useState(null),[G,de]=p.useState(!1),[X,W]=p.useState(!1),[Y,me]=p.useState([]);p.useState(null);const[ee,ae]=p.useState(!1),[le,Te]=p.useState([]),[te,ie]=p.useState(1),[xt,vt]=p.useState([]),[dt,St]=p.useState(!1),[ft,_t]=p.useState({tipo:null,valor:0,motivo:""}),[gr,be]=p.useState(null),[Nt,Wt]=p.useState(null),[_r,yr]=p.useState(!1),[ve,at]=p.useState(null),[qt,$t]=p.useState(!1),[De,wt]=p.useState(""),[Rt,Rr]=p.useState(!1),[Me,tt]=p.useState(""),[ut,sr]=p.useState(()=>{try{return typeof window<"u"&&window.innerWidth<=640}catch{return!1}});p.useEffect(()=>{const oe=()=>{try{sr(typeof window<"u"&&window.innerWidth<=640)}catch{sr(!1)}};return oe(),window.addEventListener("resize",oe),()=>window.removeEventListener("resize",oe)},[]),p.useState("cadastrado");const[Sr,xr]=p.useState(""),[Wr,qr]=p.useState([]),[Tr,sn]=p.useState([]);p.useState(!1),p.useState(!1);const[Cn,ze]=p.useState(!1),[Fe,Le]=p.useState(!1),[Ze,Ot]=p.useState(0),[mt,Qt]=p.useState("all"),[bt,zt]=p.useState(()=>{try{return localStorage.getItem("balcao_sort_order")||"code"}catch{return"code"}}),ne=p.useRef([]),He=p.useRef(null),[Gt,Ht]=p.useState(()=>{try{const oe=localStorage.getItem("balcao_left_panel_width");return oe?parseFloat(oe):50}catch{return 50}}),[Fr,cr]=p.useState(!1),nn=p.useRef(null),Tn=p.useRef(0),Gn=p.useRef([]);p.useEffect(()=>{Gn.current=l},[l]);const ta=p.useRef(!1);p.useEffect(()=>(ta.current=!0,()=>{ta.current=!1}),[]);const Aa=p.useRef(null),ke=p.useRef(null),Ae=p.useRef(null),et=p.useRef(null);p.useEffect(()=>{et.current=n},[n]),p.useEffect(()=>{const oe=r?.codigo_empresa;if(!oe)return;try{const xe=typeof window<"u"?window.localStorage.getItem("custom-auth-token"):null;if(xe&&xe.trim())Q.realtime.setAuth(xe.trim());else{let $e="";try{$e=(new URL(Q.supabaseUrl||"").host||"").split(".")[0]||""}catch{}const Pe=$e?`sb-${$e}-auth-token`:"sb-auth-token",Vt=typeof window<"u"?window.localStorage.getItem(Pe):null;if(Vt)try{const yt=JSON.parse(Vt),tr=yt?.access_token||yt?.currentSession?.access_token;tr&&Q.realtime.setAuth(tr)}catch{}}}catch{}const Ke=Q.channel(`loja:${oe}`),ct=async xe=>{const $e=xe?.table||xe?.table_name||"",Pe=xe?.new||xe?.old||{},Vt=xe?.eventType||xe?.type||xe?.event||"";try{if($e==="comanda_itens"){const yt=xe?.new?.comanda_id||xe?.old?.comanda_id||Pe?.comanda_id||null;if(yt){const tr=et.current;if(tr&&String(tr)===String(yt)){try{await Je(tr,2)}catch{}try{const dr=await kh({codigoEmpresa:oe}),tn=new Map;for(const Lr of dr||[])tn.set(Lr.produto_id,(tn.get(Lr.produto_id)||0)+Number(Lr.quantidade||0));T(tn)}catch{}return}try{const dr=await Dv({codigoEmpresa:oe});if(dr?.id&&String(dr.id)===String(yt)){s(dr.id);try{await Je(dr.id,2)}catch{}try{const tn=await kh({codigoEmpresa:oe}),Lr=new Map;for(const da of tn||[])Lr.set(da.produto_id,(Lr.get(da.produto_id)||0)+Number(da.quantidade||0));T(Lr)}catch{}return}}catch{}}}if($e==="comanda_clientes"){const yt=xe?.new?.comanda_id||xe?.old?.comanda_id||Pe?.comanda_id||null;if(yt&&et.current&&String(et.current)===String(yt)){try{await Je(yt,2)}catch{}return}}if($e==="comandas"){const yt=Pe?.mesa_id,tr=Pe?.id||xe?.old?.id||null,dr=String(Pe?.status||"").toLowerCase(),tn=String(Vt||"").toUpperCase()==="DELETE"||dr.includes("fechad")||dr.includes("closed")||dr.includes("encerr"),Lr=String(Vt||"").toUpperCase()==="INSERT";if(tn&&yt==null&&et.current&&tr&&String(et.current)===String(tr)){c([]),s(null),sn([]),b(""),Le(!1);try{localStorage.removeItem(Oe.comandaId),localStorage.removeItem(Oe.items),localStorage.removeItem(Oe.customerName),localStorage.removeItem(Oe.pendingClientIds),localStorage.removeItem(Oe.clientChosen)}catch{}}if(Lr&&yt==null&&["open","awaiting-payment","awaiting_payment"].includes(dr)){s(tr);try{await Je(tr,2)}catch{}}}}catch{}if(ke.current)try{clearTimeout(ke.current)}catch{}ke.current=setTimeout(async()=>{const yt=et.current;if(yt)try{await Je(yt,2)}catch{}else try{const tr=await Dv({codigoEmpresa:oe});if(tr?.id){s(tr.id);try{await Je(tr.id,2)}catch{}}}catch{}},250)};if(Ke.on("postgres_changes",{event:"*",schema:"public",table:"comandas",filter:`codigo_empresa=eq.${oe}`},ct).on("postgres_changes",{event:"*",schema:"public",table:"comanda_itens"},ct).on("postgres_changes",{event:"*",schema:"public",table:"comanda_clientes"},ct).subscribe(),Aa.current=Ke,Ae.current)try{clearInterval(Ae.current)}catch{}return Ae.current=setInterval(async()=>{const xe=et.current;if(xe)try{await Je(xe,1)}catch{}else try{const $e=await Dv({codigoEmpresa:oe});if($e?.id){s($e.id);try{await Je($e.id,1)}catch{}}}catch{}},6e4),()=>{if(Aa.current){try{Q.removeChannel(Aa.current)}catch{}Aa.current=null}if(ke.current){try{clearTimeout(ke.current)}catch{}ke.current=null}if(Ae.current){try{clearInterval(Ae.current)}catch{}Ae.current=null}}},[r?.codigo_empresa]),p.useEffect(()=>{(l||[]).length>0&&(O.current=!0)},[l]),p.useEffect(()=>{n&&O.current&&(l||[]).length===0&&Je(n,2)},[n,l?.length]),p.useEffect(()=>{if(G)return;let oe=!0;return(async()=>{try{const Ke=await qh({codigoEmpresa:r?.codigo_empresa});oe&&$(!!Ke)}catch{oe&&$(!1)}})(),()=>{oe=!1}},[r?.codigo_empresa,G]);const br=async()=>{const oe=r?.codigo_empresa||null;try{if(!oe)return;_e(!0);const[Ke,ct]=await Promise.all([P1({codigoEmpresa:oe}).catch(()=>null),qh({codigoEmpresa:oe}).catch(()=>null)]);if(!ct?.id){L(null);return}let xe=0,$e=0,Pe=[];try{Pe=await $g({caixaSessaoId:ct.id,codigoEmpresa:oe}),xe=(Pe||[]).filter(yt=>String(yt?.tipo||"").toLowerCase()==="sangria").reduce((yt,tr)=>yt+Number(tr?.valor||0),0),$e=(Pe||[]).filter(yt=>String(yt?.tipo||"").toLowerCase()==="suprimento").reduce((yt,tr)=>yt+Number(tr?.valor||0),0)}catch{}const Vt={saldo_inicial:ct.saldo_inicial||0,totalPorFinalizadora:Ke?.totalPorFinalizadora||Ke?.porFinalizadora||{},totalEntradas:Ke?.totalEntradas||Ke?.entradas||0,totalSangria:xe,totalSuprimento:$e,totalSaidas:xe,sessaoId:ct.id,movimentacoes:Pe};L(Vt)}catch{L(null)}finally{_e(!1)}};p.useEffect(()=>{let oe=!0;return(async()=>{try{if(!X||!n)return;const ct=r?.codigo_empresa;let xe=[];try{const Vt=await rl({comandaId:n,codigoEmpresa:ct});xe=(Array.isArray(Vt)?Vt:[]).map(tr=>{const dr=tr?.clientes?.id??tr?.cliente_id??tr?.id??null,tn=tr?.clientes?.nome??tr?.nome??tr?.nome_livre??"";return dr?{id:dr,nome:tn}:null}).filter(Boolean)}catch{xe=[]}if(!oe)return;vt(xe);const Pe=Array.isArray(Tr)&&Tr.length>0?Tr:xe.map(Vt=>Vt.id);if(!Array.isArray(Pe)||Pe.length===0)return;Te(Vt=>{let yt=Vt&&Vt.length?[...Vt]:[{id:1,clientId:Pe[0],methodId:Y[0]?.id||"",value:""}];yt[0]||(yt[0]={id:1,clientId:Pe[0],methodId:Y[0]?.id||"",value:""}),yt[0].clientId=Pe[0];const tr=new Set([yt[0].clientId].filter(Boolean));for(let dr=1;dr<yt.length;dr++){if(!yt[dr].clientId||tr.has(yt[dr].clientId)){const tn=(Pe||[]).find(Lr=>!tr.has(Lr));yt[dr].clientId=tn||Pe[0]}tr.add(yt[dr].clientId)}return yt})}catch{}})(),()=>{oe=!1}},[X,Tr,n,r?.codigo_empresa]),p.useEffect(()=>{let oe=!0;return(async()=>{try{if(!X||!n)return;const{data:ct}=await Q.from("comandas").select("desconto_tipo, desconto_valor, desconto_motivo").eq("id",n).single();if(!oe)return;_t({tipo:ct?.desconto_tipo||null,valor:Number(ct?.desconto_valor||0),motivo:ct?.desconto_motivo||""})}catch{oe&&_t({tipo:null,valor:0,motivo:""})}})(),()=>{oe=!1}},[X,n]);const Zt=oe=>{const Ke=String(oe||"").replace(/\D/g,"");return Ke?Number(Ke)/100:0},Pn=oe=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(oe),Ct=oe=>(Y||[]).find(Ke=>String(Ke.id)===String(oe)),lr=oe=>Number(Ct(oe.methodId)?.taxa_percentual||0),Ye=oe=>{const Ke=Zt(oe.value),ct=lr(oe);return!oe.chargeFee||!ct?Ke:Ke/(1+ct/100)},Tt=oe=>{const Ke=Ye(oe),ct=lr(oe);return!oe.chargeFee||!ct||Ke<=0?0:Ke*(ct/100)},Xt=(oe,Ke)=>{const ct=lr(oe);if(oe.chargeFee&&ct>0){const xe=Ke*(1+ct/100);return{...oe,value:Pn(xe)}}return{...oe,value:Pn(Ke)}},Br=()=>(le||[]).reduce((oe,Ke)=>oe+Ye(Ke),0),Wn=()=>(le||[]).reduce((oe,Ke)=>oe+Tt(Ke),0),xn=()=>Br()+Wn();p.useEffect(()=>{try{if(!X)return;let oe=0;try{oe=(l||[]).reduce((yt,tr)=>yt+Number(tr.quantity||0)*Number(tr.price||0),0)}catch{}const Ke=ft?.tipo,ct=Number(ft?.valor||0);let xe=0;Ke==="percentual"&&ct>0?xe=oe*(ct/100):Ke==="fixo"&&ct>0&&(xe=ct);const $e=Math.max(0,oe-xe),Pe=Br(),Vt=$e-Pe;Math.abs(Vt)>.009&&Math.abs(Vt)<=.05&&Array.isArray(le)&&le.length>0&&Te(yt=>yt.map((tr,dr,tn)=>{if(dr!==tn.length-1)return tr;const Lr=Ye(tr)+Vt;return Xt(tr,Lr)}))}catch{}},[le,X]);const on=async()=>{try{if(v(!0),!n){e({title:"Nenhuma comanda aberta",description:"Adicione itens para abrir uma comanda.",variant:"warning"});return}const oe=r?.codigo_empresa;if(!oe){e({title:"Empresa no definida",variant:"destructive"});return}try{const{data:tr,error:dr}=await Q.from("comandas").select("id").eq("id",n).eq("codigo_empresa",oe).single();if(dr||!tr){console.error("[confirmPay] Comanda no encontrada no banco:",n),e({title:"Comanda invlida",description:"A comanda no existe mais. Criando nova comanda...",variant:"warning"}),s(null),c([]);try{localStorage.removeItem(Oe.comandaId),localStorage.removeItem(Oe.items)}catch{}await mr();return}}catch(tr){console.error("[confirmPay] Erro ao validar comanda:",tr),e({title:"Erro de validao",description:"No foi possvel validar a comanda.",variant:"destructive"});return}if(!Array.isArray(le)||le.length===0){e({title:"Informe os pagamentos",description:"Adicione pelo menos uma forma de pagamento.",variant:"warning"});return}for(const tr of le){if(!tr.methodId){e({title:"Forma de pagamento faltando",description:"Selecione a finalizadora em todas as linhas.",variant:"warning"});return}if(!String(tr.value||"").replace(/\D/g,"")){e({title:"Valor invlido",description:"Informe valores maiores que zero.",variant:"warning"});return}}let Ke=0;try{Ke=(await ii({comandaId:n,codigoEmpresa:oe})||[]).reduce((dr,tn)=>dr+Number(tn.quantidade||0)*Number(tn.preco_unitario||0),0)}catch{}const ct=ft?.tipo,xe=Number(ft?.valor||0);let $e=0;ct==="percentual"&&xe>0?$e=Ke*(xe/100):ct==="fixo"&&xe>0&&($e=xe);const Pe=Math.max(0,Ke-$e),Vt=Br(),yt=Math.abs(Vt-Pe);if(yt>.009&&yt<=.05){const tr=Pe-Vt;Te(dr=>dr.map((tn,Lr,da)=>{if(Lr!==da.length-1)return tn;const rn=Ye(tn)+tr;return Xt(tn,rn)}))}else if(yt>.05){const tr=Pe-Vt;tr>0?e({title:"Valor insuficiente",description:`Faltam R$ ${tr.toFixed(2)} para fechar o total.`,variant:"warning"}):e({title:"Valor excedente",description:`Excedeu em R$ ${Math.abs(tr).toFixed(2)}. Ajuste os valores.`,variant:"warning"});return}ae(!0),await wm({codigoEmpresa:oe});for(const tr of le){const dr=Zt(tr.value),tn=Y.find(da=>String(da.id)===String(tr.methodId)),Lr=tn?.nome||tn?.tipo||"outros";await AR({comandaId:n,finalizadoraId:tr.methodId,metodo:Lr,valor:dr,status:"Pago",codigoEmpresa:oe,clienteId:tr.clientId||null})}await V0({comandaId:n,codigoEmpresa:oe}),s(null),c([]),sn([]),b(""),Le(!1),Te([]);try{localStorage.removeItem(Oe.comandaId),localStorage.removeItem(Oe.items),localStorage.removeItem(Oe.customerName)}catch{}e({title:"Pagamento concludo",description:`Total R$ ${Pe.toFixed(2)}`,variant:"success"}),W(!1)}catch(oe){e({title:"Falha ao concluir",description:oe?.message||"Tente novamente",variant:"destructive"})}finally{ae(!1),v(!1)}};p.useEffect(()=>{(async()=>{try{if(!q)return;await br()}catch{}})()},[q,r?.codigo_empresa]);const ua=()=>{const[oe,Ke]=p.useState(""),ct=p.useRef(null);return p.useEffect(()=>{if(typeof window<"u"&&window.innerWidth<=640)return;const $e=setTimeout(()=>{try{ct.current?.focus()}catch{}},0);return()=>clearTimeout($e)},[]),a.jsxs(a.Fragment,{children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Abrir Caixa"}),a.jsx(iu,{children:"Insira o valor inicial (suprimento) para abrir o caixa."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(lt,{className:"mb-2 block",htmlFor:"open-cash-initial",children:"Saldo inicial"}),a.jsx(At,{id:"open-cash-initial",ref:ct,type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:oe,onChange:xe=>{const $e=(xe.target.value||"").replace(/\D/g,""),Pe=$e?Number($e)/100:0,Vt=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Pe);Ke(Vt)},onKeyDown:xe=>{xe.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(xe.key)&&(/^[0-9]$/.test(xe.key)||xe.preventDefault())},onBeforeInput:xe=>{const $e=xe.data??"";$e&&/\D/.test($e)&&xe.preventDefault()}}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Digite nmeros; a mscara formata em reais automaticamente."})]}),a.jsxs(su,{children:[a.jsx(lu,{onClick:()=>V(!1),children:"Cancelar"}),a.jsx(Yu,{onClick:async()=>{try{const xe=String(oe||"").replace(/\D/g,""),$e=xe?Number(xe)/100:0;await wm({saldoInicial:$e,codigoEmpresa:r?.codigo_empresa}),$(!0),V(!1),e({title:"Caixa aberto com sucesso!",variant:"success"})}catch(xe){e({title:"Falha ao abrir caixa",description:xe?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar Abertura"})]})]})},sa=()=>a.jsxs(Xu,{open:F,onOpenChange:V,children:[a.jsx(Sg,{asChild:!0,children:a.jsxs(Z,{variant:"success",size:"sm",disabled:k,onClick:()=>V(!0),className:"px-3",children:[a.jsx(NG,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Abrir"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Abrir Caixa"})]})}),a.jsx(nu,{className:"sm:max-w-[425px] w-[92vw] animate-none",onKeyDown:oe=>oe.stopPropagation(),onEscapeKeyDown:oe=>{oe.preventDefault(),oe.stopPropagation()},onPointerDownOutside:oe=>{oe.preventDefault(),oe.stopPropagation()},onFocusOutside:oe=>{oe.preventDefault(),oe.stopPropagation()},onInteractOutside:oe=>{oe.preventDefault(),oe.stopPropagation()},onOpenAutoFocus:oe=>{oe.preventDefault()},onCloseAutoFocus:oe=>{oe.preventDefault()},children:a.jsx(ua,{})})]}),wa=()=>{const[oe,Ke]=p.useState({loading:!1,saldoInicial:0,resumo:null}),[ct,xe]=p.useState(!1),[$e,Pe]=p.useState(""),[Vt,yt]=p.useState(!1),tr=async()=>{try{Ke({loading:!0,saldoInicial:0,resumo:null});const un=await qh({codigoEmpresa:r?.codigo_empresa}),Dn=await P1({codigoEmpresa:r?.codigo_empresa});Ke({loading:!1,saldoInicial:Number(un?.saldo_inicial||0),resumo:Dn||{totalPorFinalizadora:{}}})}catch{Ke({loading:!1,saldoInicial:0,resumo:{totalPorFinalizadora:{}}})}},dr=oe?.resumo?.totalPorFinalizadora||{},tn=Object.values(dr).reduce((un,Dn)=>un+Number(Dn||0),0),Lr=Number(oe.saldoInicial||0)+tn,da=Number(U?.totalSuprimento||0),rn=Number(U?.totalSangria||0);return a.jsxs(Xu,{open:G,onOpenChange:un=>{un&&(de(!0),yt(!1),tr())},children:[a.jsx(Sg,{asChild:!0,children:a.jsxs(Z,{variant:"destructive",size:"sm",disabled:!k,onClick:()=>{de(!0)},className:"px-3",children:[a.jsx(u0,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2",children:"Fechar Caixa"})]})}),a.jsxs(nu,{className:"sm-max-w-[425px] animate-none",onKeyDown:un=>un.stopPropagation(),onEscapeKeyDown:un=>{un.preventDefault(),un.stopPropagation()},onPointerDownOutside:un=>{un.preventDefault(),un.stopPropagation()},onFocusOutside:un=>{un.preventDefault(),un.stopPropagation()},onInteractOutside:un=>{un.preventDefault(),un.stopPropagation()},onOpenAutoFocus:un=>{un.preventDefault()},onCloseAutoFocus:un=>{un.preventDefault()},children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Fechar Caixa"}),a.jsx(iu,{children:"Confira os valores e confirme o fechamento do caixa. Esta ao  irreversvel."})]}),ct&&a.jsxs("div",{className:"md:hidden mb-2 text-[12px] text-warning bg-warning/10 border border-warning/30 rounded px-2 py-1 flex items-center gap-1",children:[a.jsx(kd,{className:"h-3.5 w-3.5"}),"Existem comandas abertas. Finalize-as antes de fechar o caixa."]}),oe.loading?a.jsx("div",{className:"py-4 text-text-muted",children:"Carregando resumo"}):a.jsx("div",{className:"py-4 space-y-2",children:Vt?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(oe.saldoInicial||0).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Final"})," ",a.jsx("span",{className:"font-mono",children:(()=>{const un=String($e||"").replace(/\D/g,""),Dn=un?Number(un)/100:0;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Dn)})()})]})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx(lt,{className:"mb-1 block",children:"Saldo Final (opcional)"}),a.jsx(At,{type:"text",inputMode:"numeric",placeholder:"0,00",value:$e,onChange:un=>{const Dn=(un.target.value||"").replace(/\D/g,""),fa=Dn?Number(Dn)/100:0,Oa=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(fa);Pe(Oa)},onKeyDown:un=>{un.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(un.key)&&(/^[0-9]$/.test(un.key)||un.preventDefault())},onBeforeInput:un=>{const Dn=un.data??"";Dn&&/\D/.test(Dn)&&un.preventDefault()}})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mb-1",children:"Resumo"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(oe.saldoInicial||0).toFixed(2)]})]}),Object.keys(dr).length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos nesta sesso."}):a.jsx("div",{className:"space-y-1",children:Object.entries(dr).map(([un,Dn])=>a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:String(un)})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(Dn||0).toFixed(2)]})]},un))}),a.jsx("div",{className:"my-2 h-px bg-border"}),a.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mb-1",children:"Conferncia"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Suprimentos"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",da.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Sangrias"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",rn.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between font-medium text-base",children:[a.jsx("span",{className:"text-text-secondary",children:"Total em Caixa"})," ",a.jsxs("span",{className:"font-mono text-success",children:["R$ ",Number(Lr||0).toFixed(2)]})]})]})}),a.jsx(su,{children:Vt?a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:()=>yt(!1),children:"Voltar"}),a.jsx(Z,{onClick:async()=>{try{try{const fa=await wd({codigoEmpresa:r?.codigo_empresa});if(Array.isArray(fa)&&fa.length>0){ut?(xe(!0),e({title:"Fechamento bloqueado",description:`Existem ${fa.length} comandas abertas. Feche todas antes de encerrar o caixa.`,variant:"warning"})):e({title:"Fechamento bloqueado",description:`Existem ${fa.length} comandas abertas. Feche todas antes de encerrar o caixa.`,variant:"warning",duration:2500});return}}catch{}const un=String($e||"").replace(/\D/g,""),Dn=un?Number(un)/100:0;await ine({codigoEmpresa:r?.codigo_empresa,valorFinalDinheiro:Dn}),$(!1),de(!1),e({title:"Caixa fechado!",description:"Fechamento registrado com sucesso.",variant:"success"})}catch(un){e({title:"Falha ao fechar caixa",description:un?.message||"Tente novamente",variant:"destructive"})}},children:"Fechar Caixa"})]}):a.jsxs(a.Fragment,{children:[a.jsx(lu,{onClick:()=>de(!1),children:"Cancelar"}),a.jsx(Z,{onClick:()=>yt(!0),children:"Confirmar Fechamento"})]})})]})]})},Va=()=>{const oe=Un=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Un||0)),[Ke,ct]=p.useState(!1),[xe,$e]=p.useState(!1),[Pe,Vt]=p.useState(""),[yt,tr]=p.useState(""),[dr,tn]=p.useState(!1),Lr=async()=>{try{tn(!0);const Un=String(Pe||"").replace(/\D/g,""),Ya=Un?Number(Un)/100:0;if(Ya<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await wm({codigoEmpresa:r?.codigo_empresa}),await u3({tipo:"sangria",valor:Ya,observacao:yt,codigoEmpresa:r?.codigo_empresa}),ct(!1),Vt(""),tr(""),await br(),e({title:"Sangria registrada",variant:"success"})}catch(Un){e({title:"Falha ao registrar sangria",description:Un?.message||"Tente novamente",variant:"destructive"})}finally{tn(!1)}},[da,rn]=p.useState(""),[un,Dn]=p.useState(""),[fa,Oa]=p.useState(!1),us=async()=>{try{Oa(!0);const Un=String(da||"").replace(/\D/g,""),Ya=Un?Number(Un)/100:0;if(Ya<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await wm({codigoEmpresa:r?.codigo_empresa}),await u3({tipo:"suprimento",valor:Ya,observacao:un,codigoEmpresa:r?.codigo_empresa}),$e(!1),rn(""),Dn(""),await br(),e({title:"Suprimento registrado",variant:"success"})}catch(Un){e({title:"Falha ao registrar suprimento",description:Un?.message||"Tente novamente",variant:"destructive"})}finally{Oa(!1)}};return a.jsx(zn,{open:q,onOpenChange:z,children:a.jsxs(qn,{className:"sm:max-w-lg w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden",onKeyDown:Un=>Un.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),a.jsx(la,{children:ue?"Carregando resumo...":U?"Resumo da sesso atual do caixa.":"Nenhuma sesso de caixa aberta."})]}),U?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex-1 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Saldo Inicial"}),a.jsx("div",{className:"text-base md:text-lg font-bold tabular-nums leading-tight",children:oe(U.saldo_inicial)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Entradas"}),a.jsx("div",{className:"text-base md:text-lg font-bold text-success tabular-nums leading-tight",children:oe(U.totalEntradas)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Sadas"}),a.jsx("div",{className:"text-base md:text-lg font-bold text-danger tabular-nums leading-tight",children:oe(U.totalSangria)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Saldo Atual"}),a.jsx("div",{className:"text-base md:text-lg font-bold tabular-nums leading-tight",children:oe((U.saldo_inicial||0)+(U.totalEntradas||0)-(U.totalSangria||0))})]})]}),a.jsxs("div",{className:"mt-5",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h4",{className:"text-sm font-semibold text-text-secondary",children:"Totais por Finalizadora"})}),Object.keys(U.totalPorFinalizadora||{}).length===0?a.jsx("div",{className:"p-3 text-sm text-text-muted border rounded-md",children:"Nenhuma finalizadora registrada ainda."}):a.jsx("ul",{className:"rounded-md border border-border overflow-hidden divide-y divide-border",children:Object.entries(U.totalPorFinalizadora||{}).map(([Un,Ya])=>a.jsxs("li",{className:"bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:String(Un)}),a.jsx("span",{className:"text-sm font-semibold tabular-nums",children:oe(Ya)})]},Un))}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Suprimentos"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-success",children:oe(U.totalSuprimento||0)})]}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Sangrias"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-danger",children:oe(U.totalSangria||0)})]})]})]}),a.jsxs(Ua,{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"mr-auto"}),a.jsx(Z,{variant:"outline",onClick:()=>$e(!0),children:"Registrar Suprimento"}),a.jsx(Z,{variant:"destructive",onClick:()=>ct(!0),children:"Registrar Sangria"}),a.jsx(Z,{variant:"secondary",onClick:()=>z(!1),children:"Fechar"})]}),a.jsx(zn,{open:xe,onOpenChange:$e,children:a.jsxs(qn,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Un=>Un.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold",children:"Registrar Suprimento"}),a.jsx(la,{children:"Informe o valor de entrada no caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"flex-1 flex flex-col space-y-3",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"r-valor",children:"Valor"}),a.jsx(At,{id:"r-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:da,onChange:Un=>{const Ya=(Un.target.value||"").replace(/\D/g,""),$s=Ya?Number(Ya)/100:0,po=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format($s);rn(po)},onKeyDown:Un=>{Un.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Un.key)&&(/^[0-9]$/.test(Un.key)||Un.preventDefault())},onBeforeInput:Un=>{const Ya=Un.data??"";Ya&&/\D/.test(Ya)&&Un.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"r-obs",children:"Observao"}),a.jsx(At,{id:"r-obs",placeholder:"Opcional",value:un,onChange:Un=>Dn(Un.target.value)})]})]}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>$e(!1),disabled:fa,children:"Cancelar"}),a.jsx(Z,{onClick:us,disabled:fa,children:fa?"Registrando...":"Confirmar"})]})]})}),a.jsx(zn,{open:Ke,onOpenChange:ct,children:a.jsxs(qn,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Un=>Un.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold",children:"Registrar Sangria"}),a.jsx(la,{children:"Informe o valor a retirar do caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"s-valor",children:"Valor"}),a.jsx(At,{id:"s-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:Pe,onChange:Un=>{const Ya=(Un.target.value||"").replace(/\D/g,""),$s=Ya?Number(Ya)/100:0,po=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format($s);Vt(po)},onKeyDown:Un=>{Un.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Un.key)&&(/^[0-9]$/.test(Un.key)||Un.preventDefault())},onBeforeInput:Un=>{const Ya=Un.data??"";Ya&&/\D/.test(Ya)&&Un.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"s-obs",children:"Observao"}),a.jsx(At,{id:"s-obs",placeholder:"Opcional",value:yt,onChange:Un=>tr(Un.target.value)})]})]}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>ct(!1),disabled:dr,children:"Cancelar"}),a.jsx(Z,{onClick:Lr,disabled:dr,children:dr?"Registrando...":"Confirmar"})]})]})})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma sesso de caixa aberta."})]})})},J=r?.codigo_empresa||"anon",Oe={comandaId:`balcao:comandaId:${J}`,items:`balcao:items:${J}`,customerName:`balcao:customer:${J}`,clientChosen:`balcao:clientChosen:${J}`,pendingClientIds:`balcao:pendingClientIds:${J}`,missCount:`balcao:missCount:${J}`,lastMissTs:`balcao:lastMissTs:${J}`},Je=async(oe,Ke=3)=>{if(!oe)return;const ct=r?.codigo_empresa,xe=++Tn.current;for(let $e=0;$e<Ke;$e++)try{const Pe=await ii({comandaId:oe,codigoEmpresa:ct});if(xe!==Tn.current)return;const Vt=(Pe||[]).map(yt=>({id:yt.id,productId:yt.produto_id,name:yt.descricao||"Item",price:Number(yt.preco_unitario||0),quantity:Number(yt.quantidade||1)}));c(Vt);try{const yt=await rl({comandaId:oe,codigoEmpresa:ct});if(xe!==Tn.current)return;const tr=(yt||[]).map(Lr=>Lr?.nome).filter(Boolean),dr=tr.length?tr.join(", "):"";b(dr),Le(!!dr);const tn=Array.from(new Set((yt||[]).map(Lr=>Lr?.cliente_id).filter(Boolean)));tn.length>0&&sn(tn)}catch{b(""),Le(!1)}break}catch(Pe){if($e===Ke-1)e({title:"Falha ao atualizar itens",description:Pe?.message||"Tente novamente",variant:"destructive"});else{const Vt=350*($e+1),yt=Math.floor(Math.random()*120);await new Promise(tr=>setTimeout(tr,Vt+yt))}}},mr=async()=>{try{u(!0);let oe=setTimeout(()=>{ta.current&&u(!1)},1e4);const Ke=r?.codigo_empresa;if(!Ke){ta.current&&u(!1);return}try{const Pe=localStorage.getItem(Oe.comandaId),Vt=JSON.parse(localStorage.getItem(Oe.items)||"[]"),yt=localStorage.getItem(Oe.customerName)||"",tr=localStorage.getItem(Oe.clientChosen),dr=JSON.parse(localStorage.getItem(Oe.pendingClientIds)||"[]");Pe&&s(Number.isNaN(+Pe)?Pe:Number(Pe)),Array.isArray(Vt)&&Vt.length>0&&c(Vt),yt&&b(yt),tr==="true"&&Le(!0),Array.isArray(dr)&&dr.length>0&&sn(dr)}catch{}const ct=localStorage.getItem(Oe.comandaId),xe=ct?Number.isNaN(+ct)?ct:Number(ct):null,$e=await Dv({codigoEmpresa:Ke}).catch(()=>null);if($e?.id)s($e.id),await Je($e.id);else if(xe)s(xe),await Je(xe,3);else{let Pe=0,Vt=0;try{Pe=Number(localStorage.getItem(Oe.missCount)||"0"),Vt=Number(localStorage.getItem(Oe.lastMissTs)||"0")}catch{}const yt=Date.now(),dr=yt-Vt<9e4?Pe+1:1;try{localStorage.setItem(Oe.missCount,String(dr)),localStorage.setItem(Oe.lastMissTs,String(yt))}catch{}try{const tn=localStorage.getItem(Oe.customerName)||"",Lr=localStorage.getItem(Oe.clientChosen)==="true",da=JSON.parse(localStorage.getItem(Oe.pendingClientIds)||"[]");b(tn||""),Le(!!Lr),sn(Array.isArray(da)?da:[])}catch{}if(s(null),dr>=2){c([]);try{localStorage.removeItem(Oe.comandaId),localStorage.removeItem(Oe.items)}catch{}}else try{const tn=JSON.parse(localStorage.getItem(Oe.items)||"[]");Array.isArray(tn)&&tn.length>0&&c(tn)}catch{}}try{const Pe=await mf({includeInactive:!1,search:w?.trim()||void 0,codigoEmpresa:Ke});ta.current&&i(Pe||[])}catch{i([])}clearTimeout(oe)}catch(oe){e({title:"Falha ao carregar Modo Balco",description:oe?.message||"Tente novamente",variant:"destructive"})}finally{ta.current&&u(!1)}},ot=async()=>{try{M(!0),x(!0);const oe=r?.codigo_empresa;if(n&&oe)try{try{await Q.from("comanda_itens").delete().eq("comanda_id",n).eq("codigo_empresa",oe)}catch{}try{await Q.from("comanda_clientes").delete().eq("comanda_id",n).eq("codigo_empresa",oe)}catch{}await Q.from("comandas").delete().eq("id",n).eq("codigo_empresa",oe)}catch{}}finally{s(null),c([]),sn([]),b(""),Le(!1),S(null);try{localStorage.removeItem(Oe.comandaId),localStorage.removeItem(Oe.items),localStorage.removeItem(Oe.customerName)}catch{}M(!1),e({title:"Venda cancelada",variant:"success"}),x(!1)}};p.useEffect(()=>{let oe=!1;(async()=>{await mr(),!oe&&ta.current&&!n&&(Gn.current||[]).length===0&&(oe=!0,setTimeout(()=>{ta.current&&mr()},700))})()},[r?.codigo_empresa]),p.useEffect(()=>{try{n&&localStorage.setItem(Oe.comandaId,String(n)),localStorage.setItem(Oe.items,JSON.stringify(l||[])),localStorage.setItem(Oe.customerName,y||""),localStorage.setItem(Oe.clientChosen,Fe?"true":"false"),n?localStorage.removeItem(Oe.pendingClientIds):localStorage.setItem(Oe.pendingClientIds,JSON.stringify(Tr||[]))}catch{}},[n,l,y,Fe,Tr]),p.useEffect(()=>{const oe=()=>{n&&Je(n,2)},Ke=()=>{document.visibilityState==="visible"&&n&&Je(n,2)};return window.addEventListener("focus",oe),document.addEventListener("visibilitychange",Ke),()=>{window.removeEventListener("focus",oe),document.removeEventListener("visibilitychange",Ke)}},[n]),p.useEffect(()=>{const oe=Ke=>{const ct=Ke.target;if(!(ct&&(ct.tagName==="INPUT"||ct.tagName==="TEXTAREA"))){if(Ke.key==="p"||Ke.key==="P"){Ke.preventDefault(),He.current?.focus();return}if((Ke.key==="c"||Ke.key==="C")&&k&&Fe){Ke.preventDefault(),ze(!0);return}if(Ke.key==="Escape"){if(qt){$t(!1);return}if(Cn){ze(!1);return}if(X){W(!1);return}if(_r){yr(!1);return}}}};return window.addEventListener("keydown",oe),()=>window.removeEventListener("keydown",oe)},[k,Fe,qt,Cn,X,_r]),p.useEffect(()=>{const oe=ct=>{if(!Fr||!nn.current)return;const $e=nn.current.getBoundingClientRect(),Pe=18;$e.width-Pe;const yt=(ct.clientX-$e.left)/$e.width*100;yt>=20&&yt<=80&&Ht(yt)},Ke=()=>{if(Fr){cr(!1);try{localStorage.setItem("balcao_left_panel_width",String(Gt))}catch{}}};return Fr&&(document.addEventListener("mousemove",oe),document.addEventListener("mouseup",Ke),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",oe),document.removeEventListener("mouseup",Ke),document.body.style.cursor="",document.body.style.userSelect=""}},[Fr,Gt]),p.useEffect(()=>{let oe=!0;const Ke=setTimeout(async()=>{try{const ct=await mf({includeInactive:!1,search:w?.trim()||void 0,codigoEmpresa:r?.codigo_empresa});if(!oe)return;let xe=ct||[];if(w?.trim()){const $e=w.trim().toLowerCase();xe=xe.filter(Pe=>(Pe.name||"").toLowerCase().includes($e)||(Pe.code||"").toLowerCase().includes($e))}xe.sort(($e,Pe)=>{const Vt=$e.code||"",yt=Pe.code||"";return/^\d+$/.test(Vt)&&/^\d+$/.test(yt)?parseInt(Vt,10)-parseInt(yt,10):Vt.localeCompare(yt)}),i(xe)}catch{oe&&i([])}},300);return()=>{oe=!1,clearTimeout(Ke)}},[w]),p.useEffect(()=>{if(G)return;let oe=!0;const Ke=async()=>{try{const xe=r?.codigo_empresa;if(!xe)return;const $e=await kh({codigoEmpresa:xe});if(!oe)return;const Pe=new Map;for(const Vt of $e||[]){const yt=Vt.produto_id,tr=Number(Vt.quantidade||0);Pe.set(yt,(Pe.get(yt)||0)+tr)}T(Pe)}catch(xe){console.error("[BalcaoPage] Erro ao buscar estoque reservado:",xe),oe&&T(new Map)}};Ke();const ct=setInterval(Ke,5e3);return()=>{oe=!1,clearInterval(ct)}},[r?.codigo_empresa,l,G]),p.useEffect(()=>{if(G)return;let oe=!0;const Ke=setTimeout(async()=>{try{const ct=await ew({searchTerm:Sr,limit:20,codigoEmpresa:r?.codigo_empresa});if(!oe)return;const xe=(ct||[]).slice().sort(($e,Pe)=>Number($e?.codigo||0)-Number(Pe?.codigo||0));if(qr(xe),!n&&!Fe&&Cn&&(!Tr||Tr.length===0)){const $e=xe?.find(Pe=>Pe?.codigo===0);if($e){sn([$e.id]);try{localStorage.setItem(Oe.pendingClientIds,JSON.stringify([$e.id]))}catch{}}}}catch{oe&&qr([])}},250);return()=>{oe=!1,clearTimeout(Ke)}},[Sr,Cn,G]);const ar=p.useMemo(()=>l.reduce((oe,Ke)=>oe+Number(Ke.price||0)*Number(Ke.quantity||0),0),[l]),ir=p.useMemo(()=>{try{const oe=(l||[]).reduce(($e,Pe)=>$e+Number(Pe.price||0)*Number(Pe.quantity||0),0),Ke=ft?.tipo,ct=Number(ft?.valor||0);let xe=0;return Ke==="percentual"&&ct>0?xe=oe*(ct/100):Ke==="fixo"&&ct>0&&(xe=ct),Math.max(0,oe-xe)}catch{return ar}},[l,ft,ar]),In=p.useMemo(()=>{const oe=new Map;for(const Ke of l||[]){const ct=Ke.productId;if(!ct)continue;const xe=Number(Ke.quantity||0);oe.set(ct,(oe.get(ct)||0)+xe)}return oe},[l]),ln=async(oe,Ke={})=>{try{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}if(!Fe&&!Ke.skipClientCheck){S(oe),ze(!0),e({title:"Selecione o cliente",description:"Escolha um cliente cadastrado antes de vender.",variant:"warning"});return}const ct=r?.codigo_empresa;if(!ct){e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}if(_)return;const xe=Number(oe.stock??oe.currentStock??0),$e=I.get(oe.id)||0,Pe=Math.max(0,xe-$e),Vt=Number(oe.minStock??0);if(Pe<=0){e({title:"Sem estoque disponvel",description:`Produto "${oe.name}" est sem estoque (${xe} total, ${$e} reservado em outras comandas).`,variant:"destructive"});return}C(oe.id);let yt=n;const tr=!yt;if(!yt)try{h(!0);const Lr=await $_({codigoEmpresa:ct});yt=Lr.id,s(Lr.id),await new Promise(rn=>setTimeout(rn,300));const{data:da}=await Q.from("comandas").select("id").eq("id",yt).eq("codigo_empresa",ct).single();if(!da)throw new Error("Comanda criada mas no acessvel via RLS")}catch(Lr){if(Lr?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para vender",description:"Voc precisa abrir o caixa antes de iniciar uma comanda no Balco.",variant:"warning"});return}throw Lr}finally{h(!1)}const dr=Number(oe.salePrice??oe.price??0),tn=(Gn.current||[]).find(Lr=>Lr.productId===oe.id);tn?await eu({itemId:tn.id,quantidade:Number(tn.quantity||0)+1,codigoEmpresa:ct}):await f3({comandaId:yt,produtoId:oe.id,descricao:oe.name,quantidade:1,precoUnitario:dr,codigoEmpresa:ct}),await Je(yt);try{const Lr=await kh({codigoEmpresa:ct}),da=new Map;for(const rn of Lr||[]){const un=rn.produto_id,Dn=Number(rn.quantidade||0);da.set(un,(da.get(un)||0)+Dn)}T(da)}catch(Lr){console.error("[BalcaoPage:addProduct] Erro ao atualizar estoque reservado:",Lr)}if(tr)try{const Lr=Array.from(new Set(Tr||[]));if(Lr.length>0){await tw({comandaId:yt,clienteIds:Lr,nomesLivres:[],codigoEmpresa:ct,replace:!0}),await Je(yt);const rn=(await rl({comandaId:yt,codigoEmpresa:ct})||[]).map(un=>un?.nome).filter(Boolean);b(rn.length?rn.join(", "):""),Le(!0);try{localStorage.removeItem(Oe.pendingClientIds),localStorage.setItem(Oe.customerName,rn.length?rn.join(", "):""),localStorage.setItem(Oe.clientChosen,"true")}catch(un){console.error("Erro ao atualizar cache local:",un)}}}catch(Lr){console.error("Erro ao associar clientes:",Lr)}xe-1<=0?e({title:"ltima unidade vendida",description:`"${oe.name}" esgotou aps esta venda.`,variant:"warning"}):xe-1<=Vt?e({title:"Estoque baixo",description:`"${oe.name}" atingiu nvel de estoque baixo.`,variant:"warning"}):e({title:"Produto adicionado",description:oe.name,variant:"success"})}catch(ct){const xe=String(ct?.message||"").toLowerCase();ct?.code==="OUT_OF_STOCK"||xe.includes("sem estoque")?e({title:"Sem estoque",description:"Este produto est sem estoque.",variant:"destructive"}):ct?.code==="INSUFFICIENT_STOCK"||xe.includes("insuficiente")?e({title:"Estoque insuficiente",description:ct?.message||"Quantidade maior que o disponvel.",variant:"destructive"}):e({title:"Falha ao adicionar",description:ct?.message||"Tente novamente",variant:"destructive"})}finally{C(null)}},Kr=async()=>{try{if(ae(!0),!Fe){ze(!0),e({title:"Selecione o cliente",description:"Escolha um cliente cadastrado antes de pagar.",variant:"warning"}),ae(!1);return}const oe=r?.codigo_empresa;if(!oe){e({title:"Empresa no definida",variant:"destructive"});return}if(!n)try{h(!0);const Dn=await $_({codigoEmpresa:oe});if(!Dn?.id){e({title:"Comanda no encontrada",description:"Abra uma comanda antes de pagar.",variant:"destructive"}),ae(!1);return}s(Dn.id)}catch(Dn){if(Dn?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para pagar",description:" necessrio abrir o caixa antes de iniciar/confirmar uma venda.",variant:"warning"}),ae(!1);return}throw Dn}finally{h(!1)}try{await oKe({comandaId:n,codigoEmpresa:oe})}catch(Dn){const fa=Array.isArray(Dn?.items)&&Dn.items.length?Dn.items.map(Oa=>`${Oa.name} (solicitado ${Oa.solicitado}, estoque ${Oa.estoque})`).join("; "):Dn?.message||"Estoque insuficiente na comanda";e({title:"Estoque insuficiente",description:fa,variant:"destructive",duration:7e3}),ae(!1);return}const Ke=await $h({somenteAtivas:!0,codigoEmpresa:oe});me(Ke||[]);let ct=[];try{const Dn=await rl({comandaId:n,codigoEmpresa:oe});ct=(Array.isArray(Dn)?Dn:[]).map(Oa=>{const us=Oa?.cliente_id??Oa?.clientes?.id??null,Un=Oa?.clientes?.nome??Oa?.nome??Oa?.nome_livre??"";return us?{id:us,nome:Un}:null}).filter(Boolean)}catch{ct=[]}vt(ct);const xe=Ke&&Ke[0]&&Ke[0].id?Ke[0].id:null,$e=Tr&&Tr.length>0?Tr[0]:ct[0]?.id||null;let Pe=0;try{Pe=(await ii({comandaId:n,codigoEmpresa:oe})||[]).reduce((fa,Oa)=>fa+Number(Oa.quantidade||0)*Number(Oa.preco_unitario||0),0)}catch{}const Vt=ft?.tipo,yt=Number(ft?.valor||0);let tr=0;Vt==="percentual"&&yt>0?tr=Pe*(yt/100):Vt==="fixo"&&yt>0&&(tr=yt);const dr=Math.max(0,Pe-tr),tn=(Ke||[]).find(Dn=>String(Dn.id)===String(xe)),Lr=Number(tn?.taxa_percentual||0),da=Lr>0,rn=da?dr*(1+Lr/100):dr,un=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(rn);Te([{id:1,clientId:$e,methodId:xe,value:un,chargeFee:da}]),ie(2),W(!0),ae(!1);return}catch(oe){if(oe?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para pagar",description:" necessrio abrir o caixa antes de iniciar/confirmar uma venda.",variant:"warning"}),ae(!1);return}e({title:"Falha ao iniciar pagamento",description:oe?.message||"Tente novamente",variant:"destructive"})}finally{ae(!1)}};return a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"md:hidden mb-2 w-full",children:a.jsx(Sd,{value:"balcao",onValueChange:oe=>{oe==="mesas"&&t("/vendas"),oe==="balcao"&&t("/balcao"),oe==="historico"&&t("/historico")},children:a.jsxs(jc,{className:"grid w-full grid-cols-3",children:[a.jsx(Ga,{value:"mesas",className:"text-xs",children:"Mesas"}),a.jsx(Ga,{value:"balcao",className:"text-xs",children:"Balco"}),a.jsx(Ga,{value:"historico",className:"text-xs",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center justify-between mb-2 md:mb-6 gap-2 md:gap-4",children:[a.jsx("div",{className:"hidden md:flex items-center gap-2 md:gap-3",children:a.jsx(Sd,{value:"balcao",onValueChange:oe=>{oe==="mesas"&&t("/vendas"),oe==="balcao"&&t("/balcao"),oe==="historico"&&t("/historico")},children:a.jsxs(jc,{className:"inline-flex",children:[a.jsx(Ga,{value:"mesas",className:"text-sm",children:"Mesas"}),a.jsx(Ga,{value:"balcao",className:"text-sm",children:"Balco"}),a.jsx(Ga,{value:"historico",className:"text-sm",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-3 md:ml-auto",children:[a.jsx(sa,{}),a.jsx(wa,{}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>z(!0),className:"px-3",children:[a.jsx(Y4,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Detalhes"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Detalhes do Caixa"})]})]})]}),a.jsx("div",{className:"md:hidden flex-1 flex flex-col",children:a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden bg-surface flex-1 min-h-0",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Comanda"}),a.jsx("div",{className:"text-base font-bold truncate",children:"Balco"}),Fe&&y&&a.jsx("div",{className:"text-[11px] text-text-muted truncate mt-0.5",children:y})]}),a.jsx("div",{className:"flex flex-col items-end gap-1",children:Fe?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsxs(Z,{size:"sm",className:"h-8 px-2 text-xs bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}$t(!0)},children:[a.jsx(to,{className:"h-4 w-4 mr-1"})," Produto"]}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs",onClick:()=>ze(!0),children:"+ Cliente"})]}),a.jsxs("span",{className:"text-xs text-text-muted whitespace-nowrap",children:["Total: R$ ",ar.toFixed(2)]})]}):a.jsx(Z,{size:"sm",className:"h-8 px-3 text-xs bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}ze(!0)},children:"Iniciar venda"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3 thin-scroll min-h-0",children:Fe?l.length===0?a.jsxs("div",{className:"text-center pt-8 text-xs text-text-muted space-y-2",children:[a.jsx("div",{children:"Comanda criada para o cliente."}),a.jsxs("div",{children:["Use o boto ",a.jsx("span",{className:"font-semibold",children:"Produto"})," para adicionar itens."]})]}):a.jsx("ul",{className:"space-y-2",children:l.map(oe=>a.jsxs("li",{className:"p-2 rounded-md border border-border/40 bg-surface-2",children:[a.jsx("div",{className:"text-sm font-medium truncate",title:oe.name,children:oe.name}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Ke=>{Ke.stopPropagation();const ct=r?.codigo_empresa;if(!ct){e({title:"Empresa no definida",variant:"destructive"});return}const xe=Number(oe.quantity||1)-1;try{xe<=0?(await Mv({itemId:oe.id,codigoEmpresa:ct}),c($e=>$e.filter(Pe=>Pe.id!==oe.id))):(await eu({itemId:oe.id,quantidade:xe,codigoEmpresa:ct}),c($e=>$e.map(Pe=>Pe.id===oe.id?{...Pe,quantity:xe}:Pe)))}catch($e){e({title:"Falha ao atualizar item",description:$e?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-7 text-center text-sm font-semibold",children:oe.quantity}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Ke=>{Ke.stopPropagation();const ct=r?.codigo_empresa;if(!ct){e({title:"Empresa no definida",variant:"destructive"});return}const xe=Number(oe.quantity||1)+1;try{await eu({itemId:oe.id,quantidade:xe,codigoEmpresa:ct}),c($e=>$e.map(Pe=>Pe.id===oe.id?{...Pe,quantity:xe}:Pe))}catch($e){e({title:"Falha ao atualizar item",description:$e?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]}),a.jsxs("span",{className:"text-sm font-semibold whitespace-nowrap",children:["R$ ",(Number(oe.quantity)*Number(oe.price)).toFixed(2)]})]})]},oe.id))}):a.jsx("div",{className:"text-center pt-8 text-xs text-text-muted space-y-2",children:a.jsxs("div",{children:["Para comear, toque em ",a.jsx("span",{className:"font-semibold",children:"Iniciar venda"})," e selecione o cliente."]})})}),a.jsx("div",{className:"p-3 border-t border-border flex gap-2",children:Fe?a.jsxs(a.Fragment,{children:[a.jsx(Z,{className:"flex-1",variant:"outline",size:"sm",onClick:ot,disabled:P,children:"Cancelar"}),a.jsx(Z,{className:"flex-1",size:"sm",disabled:ar<=0,onClick:Kr,children:"Finalizar"})]}):a.jsx(Z,{className:"flex-1",size:"sm",variant:"outline",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}ze(!0)},children:"Iniciar venda"})})]})}),a.jsx(Va,{}),a.jsx(zn,{open:_r,onOpenChange:oe=>{yr(oe),oe||Wt(null)},children:a.jsxs(qn,{className:"sm:max-w-[420px] w-full max-h-[85vh] flex flex-col animate-none",onKeyDown:oe=>oe.stopPropagation(),onPointerDownOutside:oe=>oe.stopPropagation(),onInteractOutside:oe=>oe.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold break-words",title:Nt?.name||"",children:Nt?.name||"Produto"}),a.jsx(la,{children:"Detalhes do produto e aes rpidas."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Nt?.price??Nt?.salePrice??0))})]}),Nt?.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:Nt.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof Nt?.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:Nt.stock})]}),typeof Nt?.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:Nt.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",In.get(Nt?.id)||0]})]})]})]}),a.jsxs(Ua,{className:"flex items-center justify-between gap-2",children:[a.jsxs(Z,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{Nt&&t("/produtos",{state:{productId:Nt.id,productName:Nt.name}})},children:[a.jsx(ol,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(Z,{variant:"outline",onClick:()=>{yr(!1),Wt(null)},children:"Fechar"}),a.jsx(Z,{onClick:async()=>{Nt&&(await ln(Nt,{skipClientCheck:!1}),yr(!1),Wt(null))},children:"Adicionar"})]})]})}),(f||m||g)&&a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80",children:a.jsxs("div",{className:"px-8 py-6 rounded-xl bg-surface border border-border shadow-2xl flex flex-col items-center gap-4 max-w-sm w-[85vw] text-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-brand border-t-transparent animate-spin","aria-hidden":"true"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"block text-base font-semibold text-text-primary",children:f?"Abrindo venda...":m?"Cancelando venda...":"Fechando conta..."}),a.jsx("span",{className:"block text-xs text-text-muted",children:f?"Aguarde, estamos iniciando a venda e sincronizando com os dispositivos.":m?"Aguarde, estamos cancelando a venda e limpando os itens.":"Aguarde, estamos registrando o pagamento e encerrando a venda."})]})]})}),a.jsx(zn,{open:qt,onOpenChange:$t,children:a.jsxs(qn,{className:"sm:max-w-xl w-[92vw] sm:w-auto max-h-[85vh] flex flex-col overflow-hidden animate-none p-3 sm:p-6",onOpenAutoFocus:oe=>oe.preventDefault(),onKeyDown:oe=>oe.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsxs($n,{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(zv,{className:"w-6 h-6 text-brand"}),"Adicionar Produtos"]}),a.jsx(la,{className:"text-base mt-2",children:"Balco  Busque e adicione produtos  comanda atual"})]}),a.jsx("div",{className:"px-3 pt-0 pb-3 sm:p-4 sm:pt-0",children:a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar produto...",className:"pl-9",value:De,onChange:oe=>wt(oe.target.value)})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-0 sm:px-4 pb-3 sm:pb-4 thin-scroll",children:[a.jsx("ul",{className:"space-y-2",children:(o||[]).filter(oe=>{const Ke=(De||"").toLowerCase();if(!Ke)return!0;const ct=String(oe.name||oe.descricao||"").toLowerCase(),xe=String(oe.code||oe.codigo||"").toLowerCase();return ct.includes(Ke)||xe.includes(Ke)}).sort((oe,Ke)=>{const ct=oe.code?parseInt(oe.code,10):999999,xe=Ke.code?parseInt(Ke.code,10):999999;return ct-xe}).map(oe=>{const Ke=In.get(oe.id)||0,ct=Number(oe.stock??oe.currentStock??0),xe=Math.max(0,ct-Ke),$e=Number(oe.salePrice??oe.price??0),Pe=xe===0;return a.jsxs("li",{className:`flex items-center w-full px-3 sm:px-2 py-2 sm:py-2 rounded-md border border-border/40 transition-colors ${Pe?"opacity-50 grayscale":"hover:bg-surface-2"}`,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[a.jsxs("p",{className:"font-semibold text-xs sm:text-sm truncate w-full",title:`${oe.code?`[${oe.code}] `:""}${oe.name}`,children:[oe.code&&a.jsxs("span",{className:"text-text-muted",children:["[",oe.code,"]"]})," ",oe.name]}),Ke>0&&a.jsxs("span",{className:"inline-flex items-center justify-center px-1.5 py-0.5 bg-brand/10 text-brand text-[11px] font-semibold rounded whitespace-nowrap flex-shrink-0",children:[Ke,"x na comanda"]})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] sm:text-xs mt-0.5",children:[a.jsxs("span",{className:`font-bold ${xe===0?"text-text-muted":"text-brand"}`,children:["R$ ",$e.toFixed(2)]}),a.jsxs("span",{className:"text-text-muted whitespace-nowrap",children:["Estoque:"," ",a.jsx("span",{className:`font-semibold ${xe<=5?"text-destructive":"text-text-secondary"}`,children:xe})]})]})]}),a.jsx(Z,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:async()=>{await ln(oe)},"aria-label":`Adicionar ${oe.name}`,children:a.jsx(to,{className:"h-4 w-4"})})]},oe.id)})}),Array.isArray(o)&&o.length===0&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(zv,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Nenhum produto encontrado."})]})]}),a.jsx(Ua,{children:a.jsx(Z,{variant:"outline",onClick:()=>$t(!1),children:"Fechar"})})]})}),a.jsxs("div",{ref:nn,className:"hidden md:flex gap-0 h-full overflow-hidden relative",children:[a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden",style:{width:`${Gt}%`},children:[a.jsxs("div",{className:"p-4 border-b border-border space-y-3 cursor-pointer",onClick:oe=>{oe.target.tagName==="INPUT"||oe.target.tagName==="BUTTON"||oe.target.closest("button")||He.current?.focus()},children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar produto...",className:"pl-9",value:w,onChange:oe=>j(oe.target.value),onKeyDown:oe=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(oe.key)&&oe.stopPropagation()}})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("button",{onClick:()=>Qt("all"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${mt==="all"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Todos"}),a.jsx("button",{onClick:()=>Qt("available"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${mt==="available"?"bg-success text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Disponvel"}),a.jsx("button",{onClick:()=>Qt("low"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${mt==="low"?"bg-warning text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Estoque Baixo"}),a.jsx("button",{onClick:()=>Qt("out"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${mt==="out"?"bg-destructive text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Sem Estoque"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{zt("code");try{localStorage.setItem("balcao_sort_order","code")}catch{}},className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${bt==="code"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,title:"Ordenar por cdigo",children:"Cdigo"}),a.jsx("button",{onClick:()=>{zt("name");try{localStorage.setItem("balcao_sort_order","name")}catch{}},className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${bt==="name"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,title:"Ordenar por nome",children:"A-Z"})]})]}),a.jsx("div",{className:"flex items-center gap-4 text-sm text-text-muted cursor-pointer",onClick:()=>He.current?.focus(),children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("kbd",{className:"px-2 py-1 bg-surface border border-border rounded text-xs font-mono",children:""}),a.jsx("span",{children:"Navegar"})]})})]}),a.jsx("div",{ref:He,className:"flex-1 overflow-y-auto p-4 thin-scroll focus:outline-none focus:ring-2 focus:ring-brand/20",tabIndex:0,onClick:()=>He.current?.focus(),onKeyDown:oe=>{const Ke=o.filter($e=>{const Pe=w.trim().toLowerCase(),Vt=!Pe||($e.name||"").toLowerCase().includes(Pe)||String($e.code||"").toLowerCase().includes(Pe);if(mt==="all")return Vt;const yt=I.get($e.id)||0,tr=Number($e.stock??$e.currentStock??0),dr=Math.max(0,tr-yt);return mt==="available"?Vt&&dr>0:mt==="low"?Vt&&dr>0&&dr<=5:mt==="out"?Vt&&dr<=0:Vt}).sort(($e,Pe)=>{if(bt==="name"){const Vt=($e.name||"").toLowerCase(),yt=(Pe.name||"").toLowerCase();return Vt.localeCompare(yt)}else{const Vt=$e.code?parseInt($e.code,10):999999,yt=Pe.code?parseInt(Pe.code,10):999999;return Vt-yt}});if(!["ArrowDown","ArrowUp","Home","End"].includes(oe.key))return;oe.preventDefault();const ct=Ze||0,xe=Ke.length;if(oe.key==="ArrowDown"){const $e=Math.min(ct+1,xe-1);Ot($e),requestAnimationFrame(()=>ne.current[$e]?.scrollIntoView({block:"nearest"}))}if(oe.key==="ArrowUp"){const $e=Math.max(ct-1,0);Ot($e),requestAnimationFrame(()=>ne.current[$e]?.scrollIntoView({block:"nearest"}))}if(oe.key==="Home"&&(Ot(0),requestAnimationFrame(()=>ne.current[0]?.scrollIntoView({block:"nearest"}))),oe.key==="End"){const $e=Math.max(0,xe-1);Ot($e),requestAnimationFrame(()=>ne.current[$e]?.scrollIntoView({block:"nearest"}))}},children:(o||[]).length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12",children:[a.jsx(zv,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("p",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhum produto cadastrado"}),a.jsx("p",{className:"text-sm text-text-muted mb-6 text-center",children:"Cadastre produtos para comear a vender"}),a.jsxs(Z,{onClick:()=>t("/produtos"),children:[a.jsx(to,{className:"mr-2 h-4 w-4"}),"Cadastrar Produto"]})]}):a.jsx("ul",{className:"space-y-2",children:o.filter(oe=>{const Ke=w.trim().toLowerCase(),ct=!Ke||(oe.name||"").toLowerCase().includes(Ke)||String(oe.code||"").toLowerCase().includes(Ke);if(mt==="all")return ct;const xe=I.get(oe.id)||0,$e=Number(oe.stock??oe.currentStock??0),Pe=Math.max(0,$e-xe);return mt==="available"?ct&&Pe>0:mt==="low"?ct&&Pe>0&&Pe<=5:mt==="out"?ct&&Pe<=0:ct}).sort((oe,Ke)=>{if(bt==="name"){const ct=(oe.name||"").toLowerCase(),xe=(Ke.name||"").toLowerCase();return ct.localeCompare(xe)}else{const ct=oe.code?parseInt(oe.code,10):999999,xe=Ke.code?parseInt(Ke.code,10):999999;return ct-xe}}).map((oe,Ke)=>{const ct=In.get(oe.id)||0,xe=I.get(oe.id)||0,$e=Number(oe.stock??oe.currentStock??0),Pe=Math.max(0,$e-xe),Vt=Number(oe.salePrice??oe.price??0),yt=Ke===Ze;return a.jsx(Ce.Fragment,{children:a.jsxs("li",{ref:tr=>{ne.current[Ke]=tr},className:`flex items-center gap-3 p-2 rounded-md transition-colors border-2 ${yt?"border-brand bg-brand/5":"border-transparent hover:bg-surface-2"} ${Pe===0&&ct===0?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{Ot(Ke),He.current?.focus()},children:[a.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:tr=>{tr.stopPropagation(),Wt({...oe,qty:ct,remaining:Pe,price:Vt}),yr(!0)},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsxs("p",{className:"font-semibold truncate",title:`${oe.code?`[${oe.code}] `:""}${oe.name}`,children:[oe.code&&a.jsxs("span",{className:"text-text-muted",children:["[",oe.code,"]"]})," ",oe.name]}),ct>0&&a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-brand/15 text-brand border border-brand/30 flex-shrink-0",children:["x",ct]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["R$ ",Vt.toFixed(2)]}),a.jsxs("span",{className:`text-xs font-medium whitespace-nowrap ${Pe<=0?"text-destructive":Pe<=5?"text-warning":"text-text-secondary"}`,children:["Estoque: ",Pe]})]})]}),a.jsx(Z,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:tr=>{tr.stopPropagation(),ln(oe)},disabled:Pe===0,"aria-label":`Adicionar ${oe.name}`,children:a.jsx(to,{className:"h-4 w-4"})})]})},oe.id)})})})]}),a.jsx("div",{className:"w-2 bg-border hover:bg-brand cursor-col-resize transition-colors flex-shrink-0 mx-2",onMouseDown:()=>cr(!0),title:"Arraste para redimensionar"}),a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden",style:{width:`${100-Gt}%`},children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2 flex-wrap",children:[a.jsxs("div",{className:"min-w-0 flex-shrink",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Comanda"}),a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"text-base font-bold whitespace-nowrap",children:"Balco"}),y?a.jsx("span",{className:"truncate text-[11px] px-2 py-0.5 rounded-full border border-border bg-surface-2 text-text-secondary",children:y}):null]})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 flex-wrap",children:[a.jsxs(Z,{size:"sm",className:"md:hidden h-8 px-2 text-xs whitespace-nowrap bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}$t(!0)},title:"Adicionar produto",children:[a.jsx(to,{className:"h-4 w-4 mr-1"}),"Produto"]}),Fe&&a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs whitespace-nowrap",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar clientes.",variant:"warning"});return}ze(!0)},children:"+ Cliente"}),Fe?a.jsxs(Xu,{children:[a.jsx(Sg,{asChild:!0,children:a.jsx(Z,{size:"sm",className:"h-8 px-2 text-xs whitespace-nowrap bg-red-600 hover:bg-red-500 text-white border border-red-600/70 focus:outline-none focus:ring-0 focus-visible:ring-0 shadow-none",disabled:P,children:P?"Cancelando...":"Cancelar"})}),a.jsxs(nu,{className:"sm:max-w-[420px] animate-none",onKeyDown:oe=>oe.stopPropagation(),children:[a.jsxs(au,{children:[a.jsx(ou,{children:"Cancelar venda do balco?"}),a.jsx(iu,{children:"Os itens sero descartados e a venda ser limpa. Esta ao no pode ser desfeita."})]}),a.jsxs(su,{children:[a.jsx(lu,{children:"Voltar"}),a.jsx(Yu,{onClick:ot,children:"Confirmar Cancelamento"})]})]})]}):a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs opacity-60 cursor-not-allowed whitespace-nowrap",disabled:!0,children:"Cancelar"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 thin-scroll",children:Fe?l.length===0?a.jsx("div",{className:"text-center text-text-muted pt-16",children:'Comanda vazia. Use o boto "+" para adicionar produtos.'}):a.jsx("ul",{className:"space-y-3 pr-1",children:l.map(oe=>a.jsxs("li",{className:"p-2 rounded-md border border-border/30 bg-surface hover:bg-surface-2 transition-colors",children:[a.jsx("div",{className:"min-w-0 flex-1",children:a.jsx("div",{className:"font-medium truncate",title:oe.name,children:oe.name})}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Ke=>{Ke.stopPropagation();const ct=r?.codigo_empresa;if(!ct){e({title:"Empresa no definida",variant:"destructive"});return}const xe=Number(oe.quantity||1)-1;try{xe<=0?(await Mv({itemId:oe.id,codigoEmpresa:ct}),c($e=>$e.filter(Pe=>Pe.id!==oe.id))):(await eu({itemId:oe.id,quantidade:xe,codigoEmpresa:ct}),c($e=>$e.map(Pe=>Pe.id===oe.id?{...Pe,quantity:xe}:Pe)));try{const $e=await kh({codigoEmpresa:ct}),Pe=new Map;for(const Vt of $e||[]){const yt=Vt.produto_id,tr=Number(Vt.quantidade||0);Pe.set(yt,(Pe.get(yt)||0)+tr)}T(Pe)}catch($e){console.error("[BalcaoPage:removeItem] Erro ao atualizar estoque reservado:",$e)}}catch($e){const Pe=String($e?.message||"").toLowerCase();$e?.code==="INSUFFICIENT_STOCK"||Pe.includes("insuficiente")?e({title:"Estoque insuficiente",description:$e?.message||"Quantidade maior que o disponvel.",variant:"warning"}):e({title:"Falha ao atualizar item",description:$e?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-7 text-center font-semibold",children:oe.quantity}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Ke=>{Ke.stopPropagation();const ct=r?.codigo_empresa;if(!ct){e({title:"Empresa no definida",variant:"destructive"});return}const xe=Number(oe.quantity||1)+1;try{await eu({itemId:oe.id,quantidade:xe,codigoEmpresa:ct}),c($e=>$e.map(Pe=>Pe.id===oe.id?{...Pe,quantity:xe}:Pe))}catch($e){const Pe=String($e?.message||"").toLowerCase();$e?.code==="INSUFFICIENT_STOCK"||Pe.includes("insuficiente")?e({title:"Estoque insuficiente",description:$e?.message||"Quantidade maior que o disponvel.",variant:"warning"}):e({title:"Falha ao atualizar item",description:$e?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"font-semibold whitespace-nowrap",children:["R$ ",(Number(oe.quantity)*Number(oe.price)).toFixed(2)]}),a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-surface text-text-secondary border border-border",children:["x",oe.quantity]})]})]})]},oe.id))}):a.jsxs("div",{className:"text-center pt-12",children:[a.jsx("div",{className:"text-sm text-text-secondary mb-3",children:"Para comear, inicie uma nova venda e selecione o cliente."}),a.jsx(Z,{disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}ze(!0)},children:"Iniciar nova venda"})]})}),a.jsxs("div",{className:"p-4 border-t border-border",children:[a.jsxs("div",{className:"flex justify-between items-center text-lg font-bold mb-3",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",ir.toFixed(2)]})]}),a.jsx(Z,{size:"lg",className:"w-full",onClick:Kr,disabled:ir<=0,children:"Finalizar Pagamento"})]})]})]}),a.jsx(zn,{open:X,onOpenChange:W,children:a.jsxs(qn,{className:"sm:max-w-xl w-[92vw] max-h-[80vh] min-h-0 flex flex-col overflow-hidden animate-none p-3 sm:p-6",onKeyDown:oe=>oe.stopPropagation(),children:[a.jsx(Bn,{className:"flex flex-col gap-1 pr-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3",children:[a.jsx($n,{className:"text-2xl font-bold",children:"Fechar Conta"}),a.jsx(Z,{type:"button",size:"sm",variant:"outline",className:"self-start sm:self-auto",onClick:()=>St(!0),children:"Desconto"})]})}),a.jsxs("div",{className:"flex-1 min-h-0 flex flex-col space-y-3",children:[(()=>{const oe=(l||[]).reduce((Vt,yt)=>Vt+Number(yt.quantity||0)*Number(yt.price||0),0),Ke=ft?.tipo,ct=Number(ft?.valor||0);let xe=0;Ke==="percentual"&&ct>0?xe=oe*(ct/100):Ke==="fixo"&&ct>0&&(xe=ct);const $e=Math.max(0,oe-xe),Pe=xe>5e-4;return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-sm text-text-secondary",children:[a.jsx("span",{children:"Subtotal"}),a.jsxs("span",{children:["R$ ",oe.toFixed(2)]})]}),Pe&&a.jsxs("div",{className:"flex justify-between text-sm text-destructive",children:[a.jsx("span",{children:"Desconto da comanda"}),a.jsxs("span",{children:["-R$ ",xe.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t border-border pt-1 mt-1",children:[a.jsx("span",{children:"Total com desconto"}),a.jsxs("span",{children:["R$ ",$e.toFixed(2)]})]})]})})(),a.jsxs("div",{className:"flex-1 min-h-0 space-y-2 overflow-y-auto thin-scroll pr-0 sm:pr-1",children:[a.jsx(lt,{className:"block",children:"Pagamentos"}),(()=>null)(),(()=>null)(),(le||[]).map((oe,Ke)=>{const ct=Pe=>{if(!Pe)return y||"Cliente";const Vt=String(Pe),yt=(xt||[]).find(dr=>String(dr.id)===Vt);if(yt?.nome)return yt.nome;const tr=(Wr||[]).find(dr=>String(dr.id)===Vt);return tr?.nome?tr.nome:y||"Cliente"},xe=(xt||[]).length>1,$e=(xt||[])[0]||null;return(xt||[]).filter(Pe=>String(Pe.id)!==String($e?.id||"")),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"sm:hidden rounded-md bg-surface-2 border border-border overflow-hidden",children:[a.jsxs("button",{type:"button",className:"w-full flex items-center justify-between gap-2 px-3 py-2 text-left",onClick:()=>be(Pe=>Pe===oe.id?null:oe.id),children:[a.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[a.jsx("span",{className:"text-xs text-text-secondary truncate",children:ct($e?.id||oe.clientId)}),a.jsxs("span",{className:"text-xs font-semibold text-text-primary truncate",children:[oe.methodId&&Ct(oe.methodId)?.nome||"Forma no selecionada","  R$ ",oe.value||"0,00"]})]}),a.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:le.length>1&&Ke>0&&a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:Pe=>{Pe.stopPropagation(),Te(Vt=>{const yt=Vt.filter(Dn=>Dn.id!==oe.id);if(yt.length===0)return[];const tr=(l||[]).reduce((Dn,fa)=>Dn+Number(fa.quantity||0)*Number(fa.price||0),0),dr=ft?.tipo,tn=Number(ft?.valor||0);let Lr=0;dr==="percentual"&&tn>0?Lr=tr*(tn/100):dr==="fixo"&&tn>0&&(Lr=tn);const da=Math.max(0,tr-Lr),rn=Math.floor(da/yt.length*100)/100,un=da-rn*yt.length;return yt.map((Dn,fa)=>{const Oa=fa===yt.length-1?rn+un:rn;return Xt(Dn,Oa)})})},children:a.jsx(Sc,{className:"h-3 w-3"})})})]}),gr===oe.id&&a.jsxs("div",{className:"px-3 pb-3 pt-1 space-y-2 border-t border-border/60",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(ea,{value:oe.methodId||"",onValueChange:Pe=>Te(Vt=>Vt.map(yt=>{if(yt.id!==oe.id)return yt;const tr=Ct(Pe),dr=Number(tr?.taxa_percentual||0);if(dr>0){const Lr=Ye(yt)*(1+dr/100);return{...yt,methodId:Pe,chargeFee:!0,value:Pn(Lr)}}else{const tn=Ye(yt);return{...yt,methodId:Pe,chargeFee:!1,value:Pn(tn)}}})),children:[a.jsx(Jn,{className:"flex-1 h-9 truncate text-sm",children:a.jsx(ra,{placeholder:"Forma de pagamento"})}),a.jsx(Qn,{children:(Y||[]).map(Pe=>a.jsx(Qe,{value:Pe.id,children:Pe.nome},Pe.id))})]}),a.jsx(At,{placeholder:"0,00",inputMode:"numeric",value:oe.value,className:"w-28 h-9 text-sm",onChange:Pe=>{const Vt=(Pe.target.value||"").replace(/\D/g,""),yt=Vt?Number(Vt)/100:0,tr=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(yt);Te(dr=>dr.map(tn=>tn.id===oe.id?{...tn,value:tr}:tn))},onKeyDown:Pe=>{Pe.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Pe.key)&&(/^[0-9]$/.test(Pe.key)||Pe.preventDefault())},onBeforeInput:Pe=>{const Vt=Pe.data??"";Vt&&/\D/.test(Vt)&&Pe.preventDefault()}})]}),(()=>{const Pe=lr(oe);if(!Pe)return null;const Vt=Tt(oe),yt=!!oe.chargeFee;return a.jsxs("button",{type:"button",onClick:()=>Te(tr=>tr.map(dr=>{if(dr.id!==oe.id)return dr;const tn=Ye(dr);if(!yt){const Lr=tn*(1+Pe/100);return{...dr,chargeFee:!0,value:Pn(Lr)}}return{...dr,chargeFee:!1,value:Pn(tn)}})),className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-[11px] font-medium border transition-colors w-full justify-between",yt?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:yt?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",yt?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{className:"text-[11px]",children:["Taxa R$ ",Vt.toFixed(2)]})]})})()]})]}),a.jsxs("div",{className:"hidden sm:grid grid-cols-12 gap-2 items-start",children:[a.jsx("div",{className:"sm:col-span-1 flex sm:justify-start",children:le.length>1&&Ke>0&&a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>{Te(Pe=>{const Vt=Pe.filter(un=>un.id!==oe.id);if(Vt.length===0)return[];const yt=(l||[]).reduce((un,Dn)=>un+Number(Dn.quantity||0)*Number(Dn.price||0),0),tr=ft?.tipo,dr=Number(ft?.valor||0);let tn=0;tr==="percentual"&&dr>0?tn=yt*(dr/100):tr==="fixo"&&dr>0&&(tn=dr);const Lr=Math.max(0,yt-tn),da=Math.floor(Lr/Vt.length*100)/100,rn=Lr-da*Vt.length;return Vt.map((un,Dn)=>{const fa=Dn===Vt.length-1?da+rn:da;return Xt(un,fa)})})},children:a.jsx(Sc,{className:"h-4 w-4"})})}),Ke===0?a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:ct($e?.id||oe.clientId)})}):xe?a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(ea,{value:oe.clientId||"",onValueChange:Pe=>Te(Vt=>Vt.map(yt=>yt.id===oe.id?{...yt,clientId:Pe}:yt)),children:[a.jsx(Jn,{className:"w-full truncate",children:a.jsx(ra,{placeholder:"Cliente"})}),a.jsx(Qn,{children:(xt||[]).map(Pe=>a.jsx(Qe,{value:Pe.id,children:Pe.nome},Pe.id))})]})}):a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:ct($e?.id||oe.clientId)})}),a.jsxs("div",{className:"sm:col-span-4",children:[a.jsxs(ea,{value:oe.methodId||"",onValueChange:Pe=>Te(Vt=>Vt.map(yt=>{if(yt.id!==oe.id)return yt;const tr=Ct(Pe),dr=Number(tr?.taxa_percentual||0);if(dr>0){const Lr=Ye(yt)*(1+dr/100);return{...yt,methodId:Pe,chargeFee:!0,value:Pn(Lr)}}else{const tn=Ye(yt);return{...yt,methodId:Pe,chargeFee:!1,value:Pn(tn)}}})),children:[a.jsx(Jn,{className:"w-full h-9 truncate",children:a.jsx(ra,{placeholder:"Forma de pagamento"})}),a.jsx(Qn,{children:(Y||[]).map(Pe=>a.jsx(Qe,{value:Pe.id,children:Pe.nome},Pe.id))})]}),(()=>{const Pe=lr(oe);if(!Pe)return null;const Vt=Tt(oe),yt=!!oe.chargeFee;return a.jsx("div",{className:"mt-1",children:a.jsxs("button",{type:"button",onClick:()=>Te(tr=>tr.map(dr=>{if(dr.id!==oe.id)return dr;const tn=Ye(dr);if(!yt){const Lr=tn*(1+Pe/100);return{...dr,chargeFee:!0,value:Pn(Lr)}}return{...dr,chargeFee:!1,value:Pn(tn)}})),className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",yt?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:yt?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",yt?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",Vt.toFixed(2)]})]})})})()]}),a.jsx("div",{className:"sm:col-span-3",children:a.jsx(At,{placeholder:"0,00",inputMode:"numeric",value:oe.value,className:"h-9",onChange:Pe=>{const Vt=(Pe.target.value||"").replace(/\D/g,""),yt=Vt?Number(Vt)/100:0,tr=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(yt);Te(dr=>dr.map(tn=>tn.id===oe.id?{...tn,value:tr}:tn))},onKeyDown:Pe=>{Pe.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Pe.key)&&(/^[0-9]$/.test(Pe.key)||Pe.preventDefault())},onBeforeInput:Pe=>{const Vt=Pe.data??"";Vt&&/\D/.test(Vt)&&Pe.preventDefault()}})})]})]},oe.id)}),a.jsx("div",{children:a.jsx(Z,{type:"button",variant:"secondary",size:"sm",onClick:()=>{Te(oe=>{const ct=Array.isArray(Tr)&&Tr.length>0?Tr:(xt||[]).map(Oa=>Oa.id),xe=new Set(oe.map(Oa=>Oa.clientId).filter(Boolean)),Pe=(ct||[]).filter(Oa=>!xe.has(Oa))[0]||ct[0]||"",Vt=Y[0]?.id||"",yt=Ct(Vt),tr=Number(yt?.taxa_percentual||0)>0,dr=[...oe,{id:te,clientId:Pe,methodId:Vt,value:"",chargeFee:tr}],tn=(l||[]).reduce((Oa,us)=>Oa+Number(us.quantity||0)*Number(us.price||0),0),Lr=ft?.tipo,da=Number(ft?.valor||0);let rn=0;Lr==="percentual"&&da>0?rn=tn*(da/100):Lr==="fixo"&&da>0&&(rn=da);const un=Math.max(0,tn-rn),Dn=Math.floor(un/dr.length*100)/100,fa=un-Dn*dr.length;return dr.map((Oa,us)=>{const Un=us===dr.length-1?Dn+fa:Dn;return Xt(Oa,Un)})}),ie(oe=>oe+1)},children:"Adicionar forma"})}),(()=>{const oe=xn(),Ke=Wn(),ct=(l||[]).reduce((tn,Lr)=>tn+Number(Lr.quantity||0)*Number(Lr.price||0),0),xe=ft?.tipo,$e=Number(ft?.valor||0);let Pe=0;xe==="percentual"&&$e>0?Pe=ct*($e/100):xe==="fixo"&&$e>0&&(Pe=$e);const Vt=Math.max(0,ct-Pe),yt=Math.max(0,Vt+Ke);let tr=yt-oe,dr=0;return tr<0&&(dr=Math.abs(tr),tr=0),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"flex justify-between font-semibold border-t border-border pt-1 mt-1",children:[a.jsx("span",{children:"Total a pagar"}),a.jsxs("span",{children:["R$ ",yt.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between pt-1",children:[a.jsx("span",{className:"text-text-secondary",children:"Pagamentos"}),a.jsxs("span",{children:["R$ ",oe.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between font-semibold",children:[a.jsx("span",{children:"Restante"}),a.jsxs("span",{className:Math.abs(tr)<.005?"text-success":"text-warning",children:["R$ ",tr.toFixed(2)]})]}),dr>0&&a.jsxs("div",{className:"flex justify-between font-semibold text-text-secondary",children:[a.jsx("span",{children:"Troco"}),a.jsxs("span",{children:["R$ ",dr.toFixed(2)]})]})]})})()]})]}),a.jsxs(Ua,{className:"sticky bottom-0 bg-surface/95 backdrop-blur supports-[backdrop-filter]:bg-surface/75 border-t border-border",children:[a.jsx(Z,{variant:"outline",onClick:()=>W(!1),disabled:ee,children:"Cancelar"}),a.jsx(Z,{onClick:on,disabled:ee,children:ee?"Processando...":"Confirmar Pagamento"})]})]})}),dt&&a.jsx(ooe,{comanda:{id:n,desconto_tipo:ft?.tipo,desconto_valor:Number(ft?.valor||0),desconto_motivo:ft?.motivo||""},subtotal:(l||[]).reduce((oe,Ke)=>oe+Number(Ke.quantity||0)*Number(Ke.price||0),0),onApply:async()=>{try{const{data:oe}=await Q.from("comandas").select("desconto_tipo, desconto_valor, desconto_motivo").eq("id",n).single();_t({tipo:oe?.desconto_tipo||null,valor:Number(oe?.desconto_valor||0),motivo:oe?.desconto_motivo||""})}catch{}St(!1)},onClose:()=>St(!1),codigoEmpresa:r?.codigo_empresa}),a.jsx(zn,{open:Cn,onOpenChange:oe=>ze(oe),children:a.jsxs(qn,{className:"max-w-lg",onOpenAutoFocus:oe=>oe.preventDefault(),onKeyDown:oe=>oe.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-2xl font-bold",children:"Identificar Cliente"}),a.jsx(la,{children:"Selecione um cliente cadastrado para esta venda."})]}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"w-full",children:[a.jsx(lt,{className:"mb-1 block",children:"Buscar cliente"}),a.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Nome, e-mail, telefone ou cdigo",className:"pl-9",value:Sr,onChange:oe=>xr(oe.target.value),onKeyDown:oe=>oe.stopPropagation()})]}),a.jsx(Z,{type:"button",size:"icon",title:"Cadastrar cliente",className:"ml-2 bg-brand text-black hover:bg-brand/90 border border-brand",onClick:()=>{window.location.href="/clientes"},children:a.jsx(to,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"mt-2 max-h-48 overflow-auto border rounded-md thin-scroll",children:a.jsxs("ul",{children:[(Wr||[]).map(oe=>{const Ke=(Tr||[]).includes(oe.id);return a.jsxs("li",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-surface-2 ${oe?.codigo===0?"bg-warning/10 border-l-4 border-warning":""} ${Ke?"bg-surface-2":""}`,onClick:()=>{sn(ct=>{const xe=new Set(ct||[]);xe.has(oe.id)?xe.delete(oe.id):xe.add(oe.id);const $e=Array.from(xe);try{localStorage.setItem(Oe.pendingClientIds,JSON.stringify($e))}catch{}return $e})},children:[a.jsx("div",{children:a.jsxs("div",{className:"font-medium",children:[oe.codigo!=null?String(oe.codigo)+" - ":"",oe.nome,oe?.codigo===0&&a.jsx("span",{className:"ml-2 text-xs text-warning",children:"(Padro)"})]})}),a.jsx(Oi,{size:16,className:Ke?"text-success":"text-text-muted opacity-40"})]},oe.id)}),(!Wr||Wr.length===0)&&a.jsx("li",{className:"p-2 text-sm text-text-muted",children:"Nenhum cliente encontrado."})]})})]})}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>ze(!1),children:"Fechar"}),a.jsx(Z,{onClick:async()=>{try{const oe=Array.from(new Set(Tr||[]));if(oe.length===0){e({title:"Selecione pelo menos um cliente",variant:"warning"});return}const Ke=r?.codigo_empresa;if(n){try{const{data:$e,error:Pe}=await Q.from("comandas").select("id").eq("id",n).eq("codigo_empresa",Ke).single();if(Pe||!$e){console.error("[ClientWizard] Comanda no encontrada:",n),e({title:"Comanda invlida",description:"A comanda no existe mais. Reiniciando...",variant:"warning"}),s(null),c([]),Le(!1),b("");try{localStorage.removeItem(Oe.comandaId),localStorage.removeItem(Oe.items),localStorage.removeItem(Oe.customerName),localStorage.removeItem(Oe.clientChosen)}catch{}ze(!1);return}}catch($e){console.error("[ClientWizard] Erro ao validar comanda:",$e),e({title:"Erro de validao",variant:"destructive"});return}try{await tw({comandaId:n,clienteIds:oe,nomesLivres:[],codigoEmpresa:Ke,replace:!0})}catch($e){if($e?.message?.includes("violates foreign key")){console.error("[ClientWizard] Foreign key error, limpando cache:",$e),s(null),c([]);try{localStorage.removeItem(Oe.comandaId),localStorage.removeItem(Oe.items)}catch{}e({title:"Comanda invlida",description:"Reinicie a venda.",variant:"destructive"}),ze(!1);return}if(!$e?.message?.includes("duplicate"))throw $e}const xe=(await rl({comandaId:n,codigoEmpresa:Ke})||[]).map($e=>$e?.nome).filter(Boolean);b(xe.length?xe.join(", "):""),Le(!0),ze(!1)}else{if(!Ke){e({title:"Empresa no definida",variant:"destructive"});return}try{h(!0);const ct=await $_({codigoEmpresa:Ke});if(!ct?.id){e({title:"Falha ao abrir venda",description:"No foi possvel criar a comanda.",variant:"destructive"});return}const xe=ct.id;await tw({comandaId:xe,clienteIds:oe,nomesLivres:[],codigoEmpresa:Ke,replace:!0}),s(xe);const $e=(Wr||[]).filter(Vt=>oe.includes(Vt.id)).map(Vt=>Vt?.nome).filter(Boolean),Pe=$e.length?$e.join(", "):"";b(Pe),Le(!0);try{localStorage.setItem(Oe.comandaId,String(xe)),localStorage.setItem(Oe.customerName,Pe||""),localStorage.setItem(Oe.clientChosen,"true"),localStorage.removeItem(Oe.pendingClientIds)}catch{}try{await Je(xe,2)}catch{}ze(!1)}catch(ct){console.error("[ClientWizard] Erro ao criar comanda de balco:",ct),e({title:"Falha ao iniciar venda",description:ct?.message||"Tente novamente.",variant:"destructive"});return}finally{h(!1)}}if(A){const ct=A;S(null),await ln(ct,{skipClientCheck:!0})}}catch(oe){e({title:"Falha ao iniciar venda",description:oe?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar"})]})]})}),a.jsx(zn,{open:!!ve,onOpenChange:oe=>!oe&&at(null),children:a.jsx(qn,{className:"sm:max-w-[425px]",children:ve&&a.jsxs(a.Fragment,{children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-lg",children:ve.name}),a.jsx(la,{className:"text-sm",children:"Detalhes do item"})]}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Preo Unitrio"}),a.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Number(ve.price).toFixed(2)]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:async oe=>{oe.stopPropagation();const Ke=r?.codigo_empresa;if(!Ke){e({title:"Empresa no definida",variant:"destructive"});return}const ct=Math.max(0,ve.quantity-1);try{ct<=0?(await Mv({itemId:ve.id,codigoEmpresa:Ke}),at(null)):(await eu({itemId:ve.id,quantidade:ct,codigoEmpresa:Ke}),at({...ve,quantity:ct}));const xe=await ii({comandaId:n,codigoEmpresa:Ke});c((xe||[]).map($e=>({id:$e.id,productId:$e.produto_id,name:$e.descricao||"Item",price:Number($e.preco_unitario||0),quantity:Number($e.quantidade||1)})))}catch(xe){e({title:"Erro ao atualizar quantidade",description:xe?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-8 text-center font-semibold",children:ve.quantity}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:async oe=>{oe.stopPropagation();const Ke=r?.codigo_empresa;if(!Ke){e({title:"Empresa no definida",variant:"destructive"});return}const ct=ve.quantity+1;try{await eu({itemId:ve.id,quantidade:ct,codigoEmpresa:Ke}),at({...ve,quantity:ct});const xe=await ii({comandaId:n,codigoEmpresa:Ke});c((xe||[]).map($e=>({id:$e.id,productId:$e.produto_id,name:$e.descricao||"Item",price:Number($e.preco_unitario||0),quantity:Number($e.quantidade||1)})))}catch(xe){e({title:"Erro ao atualizar quantidade",description:xe?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Subtotal"}),a.jsxs("p",{className:"text-lg font-bold",children:["R$ ",(ve.quantity*ve.price).toFixed(2)]})]})]}),a.jsx(Ua,{children:a.jsx(Z,{variant:"destructive",onClick:async()=>{try{const oe=r?.codigo_empresa;if(!oe){e({title:"Empresa no definida",variant:"destructive"});return}await Mv({itemId:ve.id,codigoEmpresa:oe});const Ke=await ii({comandaId:n,codigoEmpresa:oe});c((Ke||[]).map(ct=>({id:ct.id,productId:ct.produto_id,name:ct.descricao||"Item",price:Number(ct.preco_unitario||0),quantity:Number(ct.quantidade||1)}))),at(null),e({title:"Item removido",variant:"success"})}catch(oe){e({title:"Falha ao remover item",description:oe?.message||"Tente novamente",variant:"destructive"})}},children:"Remover Item"})})]})})}),Rt&&a.jsx("div",{className:"fixed left-3 right-3 z-[9999] md:hidden",role:"alert","aria-live":"assertive",style:{bottom:"calc(12px + env(safe-area-inset-bottom, 0px))"},children:a.jsxs("div",{className:"pointer-events-none flex items-start gap-2 rounded-md border border-amber-500 bg-amber-400 text-black px-3 py-2 shadow-lg",children:[a.jsx(kd,{className:"h-4 w-4 mt-0.5","aria-hidden":"true"}),a.jsx("div",{className:"text-sm font-semibold leading-snug drop-shadow-[0_1px_0_rgba(255,255,255,0.25)]",children:Me||"Ateno"})]})})]})}async function ioe({userId:e,scope:t}){if(!e||!t)return null;try{const{data:r,error:n}=await Q.from("user_ui_settings").select("settings").eq("user_id",e).eq("scope",t).maybeSingle();return n?(console.error("[user_ui_settings] getUserUISettings:error",n),null):r?.settings||null}catch(r){return console.error("[user_ui_settings] getUserUISettings:exception",r),null}}async function loe({userId:e,scope:t,settings:r}){if(!(!e||!t))try{const n={user_id:e,scope:t,settings:r||{},updated_at:new Date().toISOString()},{error:s}=await Q.from("user_ui_settings").upsert(n,{onConflict:"user_id,scope"});s&&console.error("[user_ui_settings] saveUserUISettings:error",s)}catch(n){console.error("[user_ui_settings] saveUserUISettings:exception",n)}}function gC(e){try{const r=new DOMParser().parseFromString(e,"text/xml"),n=r.querySelector("parsererror");if(n)throw new Error("XML invlido: "+n.textContent);const s=xst(r),o=vst(r),i=yst(r),l=bst(r),c=i.reduce((u,f)=>u+(f.valorTotal||0),0),d={produtos:i,fornecedor:o,pagamentos:l,nfe:{...s,totalNota:c},success:!0};return console.log("[XMLParser] Resultado final:",d),{data:d,success:!0}}catch(t){return console.error("[XMLParser] Erro ao fazer parse do XML:",t),{produtos:[],fornecedor:null,nfe:null,success:!1,error:t.message}}}function xst(e){const t=e.querySelector("ide");if(!t)return null;let r="";const n=e.querySelector("chNFe");if(n&&(r=n.textContent.trim()),!r){const s=e.querySelector("infNFe");if(s){const o=s.getAttribute("Id");o&&(r=o.replace("NFe",""))}}return{numero:Ba(t,"nNF"),serie:Ba(t,"serie"),dataEmissao:Ba(t,"dhEmi"),chaveAcesso:r,tipo:Ba(t,"tpNF")==="0"?"Entrada":"Sada",naturezaOperacao:Ba(t,"natOp"),modelo:Ba(t,"mod")||null}}function vst(e){const t=e.querySelector("emit");return t?{cnpj:Ba(t,"CNPJ"),razaoSocial:Ba(t,"xNome"),nomeFantasia:Ba(t,"xFant"),endereco:{logradouro:Ba(t,"xLgr"),numero:Ba(t,"nro"),bairro:Ba(t,"xBairro"),cidade:Ba(t,"xMun"),uf:Ba(t,"UF"),cep:Ba(t,"CEP"),codigoIBGE:Ba(t,"cMun"),fone:Ba(t,"fone")},ie:Ba(t,"IE"),iest:Ba(t,"IEST"),im:Ba(t,"IM"),crt:Ba(t,"CRT")}:null}function yst(e){const t=e.querySelectorAll("det"),r=new Map;return t.forEach((n,s)=>{const o=n.querySelector("prod"),i=n.querySelector("imposto");if(!o)return;const l=Ba(o,"cProd"),c=Ba(o,"cEAN"),d=Ba(o,"xProd"),u=parseFloat(Ba(o,"qCom")||"0"),f=c&&c!=="SEM GTIN"?`ean:${c}`:l?`cod:${l}`:`nome:${d.toLowerCase().trim()}`;if(r.has(f)){const h=r.get(f);h.quantidade+=u,h.valorTotal+=parseFloat(Ba(o,"vProd")||"0")}else{const h={codigo:l,ean:c,nome:d,ncm:Ba(o,"NCM"),cest:Ba(o,"CEST"),cfop:Ba(o,"CFOP"),unidade:Ba(o,"uCom"),quantidade:u,valorUnitario:parseFloat(Ba(o,"vUnCom")||"0"),precoVenda:parseFloat(Ba(o,"vUnCom")||"0"),valorTotal:parseFloat(Ba(o,"vProd")||"0"),desconto:parseFloat(Ba(o,"vDesc")||"0"),impostos:jst(i),descricao:d,origem:s+1};r.set(f,h)}}),Array.from(r.values())}function bst(e){const t=e.querySelectorAll("pag"),r=[];return t.forEach(n=>{const s=Ba(n,"tPag"),o=parseFloat(Ba(n,"vPag")||"0");s&&r.push({codigoSefaz:s,valor:o,nome:wst(s)})}),console.log("[XMLParser] Pagamentos extrados:",r),r}function wst(e){return{"01":"Dinheiro","02":"Cheque","03":"Carto de Crdito","04":"Carto de Dbito","05":"Carto da Loja",10:"Vale Alimentao",11:"Vale Refeio",12:"Vale Presente",13:"Vale Combustvel",14:"Duplicata Mercantil",15:"Boleto Bancrio",16:"Depsito Bancrio",17:"PIX Dinmico",18:"Transferncia Bancria",19:"Programa de Fidelidade",20:"PIX Esttico",21:"Crdito em Loja",22:"Pagamento Eletrnico",90:"Sem Pagamento",99:"Outros"}[e]||"Outros"}function jst(e){if(!e)return{};const t={},r=e.querySelector("ICMS");if(r){const i=r.children[0];i&&(t.icms={cst:Ba(i,"CST"),csosn:Ba(i,"CSOSN"),aliquota:parseFloat(Ba(i,"pICMS")||"0"),valor:parseFloat(Ba(i,"vICMS")||"0"),orig:Ba(i,"orig"),fcpAliquota:parseFloat(Ba(i,"pFCP")||"0"),mva:parseFloat(Ba(i,"pMVAST")||"0"),pRedBC:parseFloat(Ba(i,"pRedBC")||"0")})}const n=e.querySelector("PIS");if(n){const i=n.children[0];i&&(t.pis={cst:Ba(i,"CST"),aliquota:parseFloat(Ba(i,"pPIS")||"0"),valor:parseFloat(Ba(i,"vPIS")||"0")})}const s=e.querySelector("COFINS");if(s){const i=s.children[0];i&&(t.cofins={cst:Ba(i,"CST"),aliquota:parseFloat(Ba(i,"pCOFINS")||"0"),valor:parseFloat(Ba(i,"vCOFINS")||"0")})}const o=e.querySelector("IPI");if(o){const i=o.querySelector("IPITrib");i&&(t.ipi={cst:Ba(i,"CST"),aliquota:parseFloat(Ba(i,"pIPI")||"0"),valor:parseFloat(Ba(i,"vIPI")||"0")})}return t}function Ba(e,t){if(!e)return"";const r=e.querySelector(t);return r?r.textContent.trim():""}function xC(e,t){const r=e.unidade?.toUpperCase().trim()||"";if(e.ean&&e.ean!=="SEM GTIN"){const s=t.find(i=>{const l=i.unit?.toUpperCase().trim()||"";return i.barcode===e.ean&&l===r});if(s)return s;const o=t.find(i=>i.barcode===e.ean);o&&console.log("[xmlParser] EAN igual mas unidade diferente (no considerar o mesmo produto):",{ean:e.ean,unidadeXML:r,unidadeSistema:(o.unit||"").toUpperCase()})}if(e.codigo){const s=t.find(i=>{const l=i.unit?.toUpperCase().trim()||"";return i.code===e.codigo&&l===r});if(s)return s;const o=t.find(i=>i.code===e.codigo);o&&console.log("[xmlParser] Cdigo igual mas unidade diferente (no considerar o mesmo produto):",{codigo:e.codigo,unidadeXML:r,unidadeSistema:(o.unit||"").toUpperCase()})}const n=e.nome?.toLowerCase().trim()||"";if(n){const s=t.find(o=>{const i=o.name?.toLowerCase().trim()||"",l=o.unit?.toUpperCase().trim()||"",c=i===n,d=l===r,u=c&&d;return c&&!d&&(console.log("[xmlParser] Nome igual mas UNIDADE diferente - NO  o mesmo produto:"),console.log("  Nome XML:",n,"| Unidade XML:",r),console.log("  Nome Sistema:",i,"| Unidade Sistema:",l)),u&&(console.log("[xmlParser] MATCH ENCONTRADO (nome + unidade):"),console.log("  XML:",n,"| Unidade:",r),console.log("  Sistema:",i,"| Unidade:",l),console.log("  Produto:",o)),u});if(s)return console.log("[xmlParser] Produto existente encontrado por nome + unidade:",s.name,s.unit),s}return console.log("[xmlParser] Nenhum produto encontrado para:",n,"| Unidade:",r),null}function L3(e,t){const r=e.valorUnitario||0,n=30,s=r>0?r/(1-n/100):0;return{code:e.codigo||"",name:e.nome||"",barcode:e.ean&&e.ean!=="SEM GTIN"?e.ean:"",ncm:e.ncm||"",cest:e.cest||"",unit:e.unidade||"UN",costPrice:r,salePrice:s,price:s,stock:0,minStock:0,status:"active",active:!0,type:"Venda",category:"Importados",cfopInterno:e.cfop||"",cstIcmsInterno:e.impostos?.icms?.cst||"",csosnInterno:e.impostos?.icms?.csosn||"",aliqIcmsInterno:e.impostos?.icms?.aliquota||0,fcpPercent:e.impostos?.icms?.fcpAliquota||0,mvaPercent:e.impostos?.icms?.mva||0,baseReduzidaPercent:e.impostos?.icms?.pRedBC||0,cstPisEntrada:e.impostos?.pis?.cst||"",aliqPisPercent:e.impostos?.pis?.aliquota||0,aliqCofinsPercent:e.impostos?.cofins?.aliquota||0,cstIpi:e.impostos?.ipi?.cst||"",aliqIpiPercent:e.impostos?.ipi?.aliquota||0,codigo_empresa:t,importedViaXML:!0,dataImportacao:new Date,xmlChave:e?.xmlChave||null,xmlNumero:e?.xmlNumero||null,xmlSerie:e?.xmlSerie||null,xmlEmissao:e?.xmlEmissao||null}}async function _st(e,t){if(!e||!t)return null;const r=e.replace(/\D/g,"");try{const{data:n,error:s}=await Q.from("clientes").select("*").eq("codigo_empresa",t).eq("cnpj",r).eq("flag_fornecedor",!0).maybeSingle();if(s)throw s;return n}catch(n){throw console.error("[Suppliers] Erro ao buscar fornecedor:",n),n}}async function Nst(e,t){if(!e||!t)throw new Error("Dados do fornecedor e cdigo da empresa so obrigatrios");const r=e.cnpj?.replace(/\D/g,"")||"";if(!r)throw new Error("CNPJ do fornecedor no encontrado no XML");const n={codigo_empresa:t,tipo_pessoa:"PJ",cnpj:r,nome:e.razaoSocial||"Fornecedor Importado",apelido:e.nomeFantasia||e.razaoSocial,flag_fornecedor:!0,flag_cliente:!1,status:"active",endereco:e.endereco?.logradouro||null,numero:e.endereco?.numero||null,complemento:e.endereco?.complemento||null,bairro:e.endereco?.bairro||null,cidade:e.endereco?.cidade||null,uf:e.endereco?.uf||null,cep:e.endereco?.cep?.replace(/\D/g,"")||null,cidade_ibge:e.endereco?.codigoIBGE||null,telefone:e.endereco?.fone||null,ie:e.ie||null,iest:e.iest||null,im:e.im||null};try{const{data:s,error:o}=await Q.from("clientes").insert(n).select().single();if(o)throw o;return console.log("[Suppliers] Fornecedor criado:",s),s}catch(s){throw console.error("[Suppliers] Erro ao criar fornecedor:",s),s}}async function Sst(e,t){if(!e?.cnpj)throw new Error("CNPJ do fornecedor no encontrado no XML");try{const r=await _st(e.cnpj,t);if(r){console.log("[Suppliers] Fornecedor encontrado:",r.razao_social||r.nome);const s={},o=e.endereco||{},i=l=>l==null||String(l).trim()===""?null:l;return!i(r.ie)&&i(e.ie)&&(s.ie=e.ie),!i(r.iest)&&i(e.iest)&&(s.iest=e.iest),!i(r.im)&&i(e.im)&&(s.im=e.im),!i(r.endereco)&&i(o.logradouro)&&(s.endereco=o.logradouro),!i(r.numero)&&i(o.numero)&&(s.numero=o.numero),!i(r.complemento)&&i(o.complemento)&&(s.complemento=o.complemento),!i(r.bairro)&&i(o.bairro)&&(s.bairro=o.bairro),!i(r.cidade)&&i(o.cidade)&&(s.cidade=o.cidade),!i(r.uf)&&i(o.uf)&&(s.uf=o.uf),!i(r.cep)&&i(o.cep)&&(s.cep=String(o.cep).replace(/\D/g,"")),!i(r.cidade_ibge)&&i(o.codigoIBGE)&&(s.cidade_ibge=o.codigoIBGE),!i(r.telefone)&&i(o.fone)&&(s.telefone=o.fone),!i(r.nome)&&i(e.razaoSocial)&&(s.nome=e.razaoSocial),!i(r.apelido)&&(i(e.nomeFantasia)||i(e.razaoSocial))&&(s.apelido=e.nomeFantasia||e.razaoSocial),Object.keys(s).length>0?(await Q.from("clientes").update(s).eq("id",r.id),console.log("[Suppliers] Fornecedor atualizado com campos faltantes:",s),{...r,...s}):r}return console.log("[Suppliers] Criando novo fornecedor:",e.razaoSocial),await Nst(e,t)}catch(r){throw console.error("[Suppliers] Erro ao buscar/criar fornecedor:",r),r}}async function Cst(e){if(!e)return[];try{const{data:t,error:r}=await Q.from("clientes").select("*").eq("codigo_empresa",e).eq("flag_fornecedor",!0).order("nome",{ascending:!0});if(r)throw r;return t||[]}catch(t){return console.error("[Suppliers] Erro ao listar fornecedores:",t),[]}}async function Pst(e,t){if(!e||!t)return null;try{const{data:r,error:n}=await Q.from("compras").select("*").eq("codigo_empresa",t).eq("chave_nfe",e).order("ativo",{ascending:!1}).maybeSingle();if(n)throw n;return r}catch(r){throw console.error("[Purchases] Erro ao buscar compra:",r),r}}async function Ast(e){const t={codigo_empresa:e.codigoEmpresa,fornecedor_id:e.fornecedorId,chave_nfe:e.chaveNfe,numero_nfe:e.numeroNfe,serie_nfe:e.serieNfe,data_emissao:e.dataEmissao,tipo_operacao:e.tipoOperacao,natureza_operacao:e.naturezaOperacao,valor_produtos:e.valorProdutos,valor_total:e.valorTotal,forma_pagamento:e.formaPagamento||null,status:"processada",observacoes:e.observacoes||null,xml_completo:e.xmlCompleto||null};try{const{data:r,error:n}=await Q.from("compras").insert(t).select().single();if(n)throw n;return console.log("[Purchases] Compra criada:",r.numero_nfe,"ID:",r.id),r}catch(r){throw console.error("[Purchases] Erro ao criar compra:",r),r}}async function coe(e,t){if(!e||!t||t.length===0)throw new Error("ID da compra e itens so obrigatrios");const r=t.map(n=>({compra_id:e,produto_id:n.produtoId||null,codigo_produto_xml:n.codigoProdutoXML||null,nome_produto_xml:n.nomeProdutoXML,ean_xml:n.eanXML||null,ncm_xml:n.ncmXML||null,cfop_xml:n.cfopXML||null,unidade_xml:n.unidadeXML||null,quantidade:n.quantidade,valor_unitario:n.valorUnitario,valor_total:n.valorTotal,valor_desconto:n.valorDesconto||0,valor_frete:n.valorFrete||0,valor_seguro:n.valorSeguro||0,valor_outras_despesas:n.valorOutrasDespesas||0,icms_aliquota:n.icmsAliquota||null,icms_valor:n.icmsValor||null,ipi_aliquota:n.ipiAliquota||null,ipi_valor:n.ipiValor||null,pis_aliquota:n.pisAliquota||null,pis_valor:n.pisValor||null,cofins_aliquota:n.cofinsAliquota||null,cofins_valor:n.cofinsValor||null,vinculado_manualmente:n.vinculadoManualmente||!1,observacoes:n.observacoes||null,selecionado_na_importacao:n.selecionadoNaImportacao||!1}));try{const{data:n,error:s}=await Q.from("compras_itens").insert(r).select();if(s)throw s;return console.log("[Purchases] Itens criados:",n.length),n}catch(n){throw console.error("[Purchases] Erro ao criar itens:",n),n}}async function Est(e,t={}){if(!e)return{data:[],count:0};try{const r=t.page&&t.page>0?t.page:1,n=t.pageSize&&t.pageSize>0?t.pageSize:100,s=(r-1)*n,o=s+n-1;let i=Q.from("compras").select("*,fornecedor:clientes!compras_fornecedor_id_fkey(id,nome,cnpj)",{count:"exact"}).eq("codigo_empresa",e);t.apenasInativas?i=i.eq("ativo",!1):t.incluirInativas||(i=i.eq("ativo",!0)),t.status&&(i=i.eq("status",t.status)),t.fornecedorId&&(i=i.eq("fornecedor_id",t.fornecedorId)),t.dataInicio&&(i=i.gte("data_emissao",t.dataInicio)),t.dataFim&&(i=i.lte("data_emissao",t.dataFim)),i=i.order("data_emissao",{ascending:!1}).range(s,o);const{data:l,error:c,count:d}=await i;if(c)throw c;return{data:l||[],count:d??0}}catch(r){return console.error("[Purchases] Erro ao listar compras:",r),{data:[],count:0}}}async function doe(e){try{const{data:t,error:r}=await Q.from("compras_itens").select(`
        *,
        produto:produto_id(id, nome, codigo_produto, codigo_barras, data_importacao)
      `).eq("compra_id",e).order("criado_em",{ascending:!0});if(r)throw console.error("[Purchases] Erro ao buscar itens:",r),r;return t}catch(t){throw console.error("[Purchases] Erro ao buscar itens:",t),t}}async function kst(e,t,r){if(!e||!t)throw new Error("ID da compra e motivo so obrigatrios");try{const{data:n,error:s}=await Q.from("compras").update({ativo:!1,motivo_inativacao:t,inativado_em:new Date().toISOString(),inativado_por:r}).eq("id",e).select().single();if(s)throw s;return console.log("[Purchases] Compra inativada:",e),n}catch(n){throw console.error("[Purchases] Erro ao inativar compra:",n),n}}async function Ist(e){try{console.log("[Purchases] Deletando itens da compra:",e);const{error:t}=await Q.from("compras_itens").delete().eq("compra_id",e);if(t)throw console.error("[Purchases] Erro ao deletar itens:",t),t;return console.log("[Purchases] Itens deletados com sucesso"),!0}catch(t){throw console.error("[Purchases] Erro ao deletar itens:",t),t}}async function Ost(e,t){try{return console.log("[Purchases] Reprocessando XML da compra:",e),await Ist(e),await coe(e,t),console.log("[Purchases] XML reprocessado com sucesso"),!0}catch(r){throw console.error("[Purchases] Erro ao reprocessar XML:",r),r}}async function Tst(e,t){try{console.log("[Purchases] Atualizando compra:",e,t);const{data:r,error:n}=await Q.from("compras").update({fornecedor_id:t.fornecedorId,numero_nfe:t.numeroNfe,serie_nfe:t.serieNfe,data_emissao:t.dataEmissao,tipo_operacao:t.tipoOperacao,natureza_operacao:t.naturezaOperacao,valor_produtos:t.valorProdutos,valor_total:t.valorTotal,forma_pagamento:t.formaPagamento,observacoes:t.observacoes,atualizado_em:new Date().toISOString()}).eq("id",e).select().single();if(n)throw console.error("[Purchases] Erro ao atualizar compra:",n),n;return console.log("[Purchases] Compra atualizada:",r),r}catch(r){throw console.error("[Purchases] Erro ao atualizar compra:",r),r}}function uoe({isOpen:e,onClose:t,onSelect:r,currentProduct:n}){const{userProfile:s}=fo(),[o,i]=p.useState([]),[l,c]=p.useState(!0),[d,u]=p.useState(""),[f,h]=p.useState(null);p.useEffect(()=>{e&&s?.codigo_empresa&&m()},[e,s?.codigo_empresa]);const m=async()=>{try{c(!0),console.log("[ProductSelectionModal] Carregando produtos para empresa:",s.codigo_empresa);const y=await mf({codigoEmpresa:s.codigo_empresa,includeInactive:!1,search:""});console.log("[ProductSelectionModal] Produtos carregados:",y?.length||0),console.log("[ProductSelectionModal] Primeiro produto:",y?.[0]),console.log("[ProductSelectionModal] Estrutura do produto:",Object.keys(y?.[0]||{})),i(y||[])}catch(y){console.error("[ProductSelectionModal] Erro ao carregar produtos:",y),i([])}finally{c(!1)}},x=p.useMemo(()=>{if(console.log("[ProductSelectionModal] Filtrando produtos. Total:",o.length,"Busca:",d),!d.trim())return o;const y=d.toLowerCase().trim(),b=o.filter(w=>(w.name||w.nome)?.toLowerCase().includes(y)||(w.code||w.codigo_produto)?.toLowerCase().includes(y)||(w.barcode||w.codigo_barras)?.toLowerCase().includes(y));return console.log("[ProductSelectionModal] Produtos filtrados:",b.length),b},[o,d]),g=()=>{f?(console.log("[ProductSelectionModal] Produto selecionado para vinculao:",f),console.log("[ProductSelectionModal] ID do produto:",f.id),console.log("[ProductSelectionModal] Nome do produto:",f.name),r(f),v()):console.log("[ProductSelectionModal] ERRO: Nenhum produto selecionado")},v=()=>{u(""),h(null),t()};return a.jsx(zn,{open:e,onOpenChange:v,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-3xl max-h-[80vh] overflow-hidden flex flex-col bg-black text-white border border-neutral-700",children:[a.jsxs(Bn,{className:"bg-neutral-900 -mx-6 -mt-6 mb-4 px-6 py-4 border-b border-neutral-600",children:[a.jsxs($n,{className:"flex items-center gap-2 text-white",children:[a.jsx(ju,{className:"h-5 w-5 text-yellow-500"}),"Selecionar Produto para Vinculao"]}),a.jsx(la,{className:"text-neutral-300",children:"Busque e selecione um produto cadastrado para vincular ao item do XML"})]}),a.jsx("div",{className:"px-6 pb-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-400"}),a.jsx(At,{placeholder:"Buscar por nome, cdigo do produto ou cdigo de barras...",value:d,onChange:y=>u(y.target.value),className:"pl-10 bg-neutral-900 border-neutral-600 text-white placeholder-neutral-400 focus:border-yellow-500",autoFocus:!0})]})}),a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col px-6",children:l?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500 mb-4"}),a.jsx("p",{className:"text-neutral-400",children:"Carregando produtos..."})]})}):x.length===0?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(ju,{className:"h-12 w-12 text-neutral-400 mx-auto mb-4"}),a.jsx("p",{className:"text-neutral-400",children:d?"Nenhum produto encontrado":"Nenhum produto cadastrado"}),d&&a.jsx("p",{className:"text-sm text-neutral-500 mt-2",children:"Tente buscar por nome, cdigo ou cdigo de barras"})]})}):a.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:a.jsx("ul",{className:"space-y-2",children:x.map(y=>{const b=y.code||y.codigo_produto,w=y.name||y.nome||"Produto sem nome",j=y.stock||y.estoque||0,_=Number(y.salePrice||y.preco_venda||0),C=f?.id===y.id;return a.jsxs("li",{className:`flex items-center gap-3 p-3 rounded-lg transition-all cursor-pointer border-2 ${C?"border-yellow-500 bg-yellow-500/10":"border-neutral-600 bg-black hover:border-yellow-400 hover:bg-neutral-900"}`,onClick:()=>h(y),children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsxs("p",{className:"font-semibold text-white truncate",title:`${b?`[${b}] `:""}${w}`,children:[b&&a.jsxs("span",{className:"text-neutral-400",children:["[",b,"]"]})," ",w]})}),a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("p",{className:"text-sm text-neutral-300",children:["R$ ",_.toFixed(2)]}),a.jsxs("span",{className:"text-xs font-medium text-neutral-400 whitespace-nowrap",children:["Estoque: ",j]})]})]}),C&&a.jsx(Lm,{className:"h-5 w-5 text-yellow-500 flex-shrink-0"})]},y.id)})})})}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-600 px-6 pb-6",children:[a.jsxs("div",{className:"text-sm text-neutral-400",children:[x.length," produto",x.length!==1?"s":"",d&&` encontrado${x.length!==1?"s":""}`]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:"outline",onClick:v,className:"border-neutral-600 text-neutral-300 hover:bg-neutral-700",children:"Cancelar"}),a.jsxs(Z,{onClick:g,disabled:!f,className:"gap-2 bg-yellow-600 hover:bg-yellow-700 text-black",children:[a.jsx(Lm,{className:"h-4 w-4"}),"Vincular Produto"]})]})]})]})})}function foe({isOpen:e,onClose:t,onConfirm:r,products:n,editedProducts:s,isReprocess:o=!1,allProducts:i=[]}){if(!e||!n)return null;const l=n.filter(d=>d.selected),c=l.reduce((d,u,f)=>{const h=u.originalIndex!==void 0?u.originalIndex:f,m=s[h]||{},x=m.linkedProductId,g=m.updatePrice,v=Number(m.quantity||m.qty||u.xml?.quantidade||0);let y=0;if(m.salePrice!=null?y=Number(m.salePrice):m.margin!=null&&u.xml?.valorUnitario?y=Number(u.xml.valorUnitario)*(1+m.margin/100):u.xml?.precoVenda&&(y=Number(u.xml.precoVenda)),u.isNew&&!x)d.newProducts.push({name:m.name||u.xml?.nome,quantity:v,price:y,total:v*(u.xml?.valorUnitario||0),xmlName:u.xml?.nome});else if(x||u.existing){const b=x&&i.find(A=>A.id===x)||u.existing,w=Number(b?.stock||0),j=Number(b?.preco_venda||b?.salePrice||b?.price||0),_=o?0:v,C=o?w:w+v;d.updatedProducts.push({name:b?.name||m.name||u.xml?.nome,currentStock:w,newStock:C,stockChange:_,currentPrice:j,newPrice:g?y:j,priceChange:g?y-j:0,willUpdatePrice:g,total:v*(u.xml?.valorUnitario||0),xmlName:u.xml?.nome,isLinked:!!x,linkedProductId:x,linkedProductName:x?b?.name:null})}else x&&d.linkedProducts.push({xmlName:u.xml?.nome,linkedName:m.name||u.xml?.nome,quantity:v,total:v*(u.xml?.valorUnitario||0),linkedProductId:x});return d.totalValue+=v*(u.xml?.valorUnitario||0),d.totalItems+=v,d},{newProducts:[],updatedProducts:[],linkedProducts:[],totalValue:0,totalItems:0});return a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsx(Bn,{children:a.jsxs($n,{className:"flex items-center gap-2",children:[a.jsx(Jf,{className:"h-5 w-5 text-warning"}),"Confirmar ",o?"Reprocessamento":"Importao"]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(ju,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Total de Produtos"})]}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:l.length})]}),a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(que,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Total de Itens"})]}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:c.totalItems})]}),a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(Vi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Valor Total"})]}),a.jsxs("p",{className:"text-2xl font-bold text-text-primary",children:["R$ ",c.totalValue.toFixed(2)]})]})]}),!o&&c.newProducts.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(to,{className:"h-4 w-4 text-success"}),"Produtos que sero criados (",c.newProducts.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:c.newProducts.map((d,u)=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-text-primary",children:d.name}),a.jsxs("p",{className:"text-sm text-text-muted",children:["Quantidade: ",d.quantity,"  Preo unit.: R$ ",(d.total/d.quantity).toFixed(2),"  Total: R$ ",d.total.toFixed(2)]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",d.total.toFixed(2)]})})]},u))})]}),!o&&c.updatedProducts.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Tg,{className:"h-4 w-4 text-info"}),"Produtos que sero atualizados (",c.updatedProducts.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:c.updatedProducts.map((d,u)=>a.jsx("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[d.isLinked?a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(wG,{className:"h-4 w-4 text-warning"}),a.jsxs("p",{className:"font-medium text-text-primary",children:[d.xmlName,"  ",d.linkedProductName||d.name]})]}):a.jsx("p",{className:"font-medium text-text-primary",children:d.name}),a.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[o?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Estoque:"}),a.jsx("span",{className:"font-medium text-text-primary",children:d.currentStock}),a.jsx("span",{className:"text-text-muted",children:"(sem alterao no reprocesso)"})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Estoque:"}),a.jsx("span",{className:"font-medium text-text-primary",children:d.currentStock}),a.jsx($m,{className:"h-3 w-3 text-success"}),a.jsx("span",{className:"font-medium text-success",children:d.newStock}),a.jsxs("span",{className:"text-success",children:["(+",d.stockChange,")"]})]}),d.willUpdatePrice&&d.priceChange!==0&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Preo:"}),a.jsxs("span",{className:"font-medium text-text-primary",children:["R$ ",d.currentPrice.toFixed(2)]}),d.priceChange>0?a.jsx($m,{className:"h-3 w-3 text-success"}):a.jsx(nfe,{className:"h-3 w-3 text-destructive"}),a.jsxs("span",{className:`font-medium ${d.priceChange>0?"text-success":"text-destructive"}`,children:["R$ ",d.newPrice.toFixed(2)]}),a.jsxs("span",{className:d.priceChange>0?"text-success":"text-destructive",children:["(",d.priceChange>0?"+":"","R$ ",d.priceChange.toFixed(2),")"]})]})]})]}),a.jsxs("div",{className:"text-right",children:[o?a.jsxs("p",{className:"text-xs text-text-muted",children:["Total NF-e (custo): R$ ",d.total.toFixed(2)]}):a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit.: R$ ",(d.total/d.stockChange).toFixed(2)]}),a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",d.total.toFixed(2)]})]})]})},u))})]}),o&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Tg,{className:"h-4 w-4 text-info"}),"Itens da NF-e que sero reprocessados (",l.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:l.map((d,u)=>{const f=d.originalIndex!==void 0?d.originalIndex:u,h=s[f]||{},m=Number(h.quantity||h.qty||d.xml?.quantidade||0),x=Number(d.xml?.valorUnitario||0),g=m*x;return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-text-primary",children:d.xml?.nome}),a.jsxs("p",{className:"text-sm text-text-muted",children:["Quantidade: ",m,"  Valor unit.: R$ ",x.toFixed(2),"  Total: R$ ",g.toFixed(2)]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",g.toFixed(2)]})})]},u)})})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Jf,{className:"h-5 w-5 text-warning flex-shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-warning mb-2",children:o?"Ateno - Reprocessamento":"Ateno - Importao"}),a.jsxs("ul",{className:"text-sm text-text-muted space-y-1",children:[o?a.jsxs(a.Fragment,{children:[a.jsx("li",{children:" Os itens atuais da compra sero substitudos pelos selecionados"}),a.jsx("li",{children:" As quantidades de estoque sero ajustadas conforme as mudanas"}),a.jsx("li",{children:" Esta ao no pode ser desfeita automaticamente"})]}):a.jsxs(a.Fragment,{children:[a.jsx("li",{children:" Os produtos selecionados sero criados ou atualizados no sistema"}),a.jsx("li",{children:" As quantidades sero adicionadas ao estoque atual"}),a.jsx("li",{children:" Uma nova compra ser registrada no histrico"})]}),a.jsx("li",{children:" Verifique cuidadosamente as informaes antes de confirmar"})]})]})]})})]}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[a.jsxs("div",{className:"text-sm text-text-muted",children:[l.length," produto",l.length!==1?"s":""," selecionado",l.length!==1?"s":""]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:"outline",onClick:t,children:"Cancelar"}),a.jsxs(Z,{onClick:r,className:"gap-2",children:[a.jsx(Tg,{className:"h-4 w-4"}),"Confirmar ",o?"Reprocessamento":"Importao"]})]})]})]})})}function Dst({open:e,onOpenChange:t,products:r,codigoEmpresa:n,onSuccess:s}){const{toast:o}=Xs(),[i,l]=p.useState("upload"),[c,d]=p.useState(null),[u,f]=p.useState(null),[h,m]=p.useState([]),[x,g]=p.useState(!1),[v,y]=p.useState({created:0,updated:0,errors:0,details:[]}),[b,w]=p.useState({}),[j,_]=p.useState({}),[C,A]=p.useState({isOpen:!1,productIndex:null,currentProduct:null}),[S,P]=p.useState({isOpen:!1}),M=()=>{const L=u?.nfe?.modelo;return L==="55"?"NF-e":L==="65"?"NFC-e":"NF-e / NFC-e"},O=async L=>{const G=L.target.files?.[0];if(!G){console.log("[XMLImport] Nenhum arquivo selecionado");return}if(console.log("[XMLImport] Arquivo selecionado:",G.name),!G.name.endsWith(".xml")){o({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}d(G);try{console.log("[XMLImport] Lendo contedo do arquivo...");const de=await G.text();console.log("[XMLImport] Arquivo lido, parseando XML...");const X=gC(de);if(console.log("[XMLImport] XML parseado:",X),!X.success){o({title:"Erro ao ler XML",description:X.error||"XML invlido",variant:"destructive"});return}if(!X.data?.produtos||X.data.produtos.length===0){o({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}f(X.data);let W=r;try{W=await mf({search:"",codigoEmpresa:n,includeInactive:!0})||r,console.log("[XMLImport] Produtos carregados para validao:",W.length),console.log("[XMLImport] Nomes dos produtos:",W.map(ae=>ae.name))}catch(ee){console.warn("[XMLImport] No foi possvel carregar lista completa, usando cache:",ee)}const Y=X.data.produtos.map((ee,ae)=>{const le=xC(ee,W),Te={...ee};if(ee.impostos){const{icms:te,pis:ie,cofins:xt,ipi:vt}=ee.impostos;te&&(Te.icmsAliquota=te.aliquota??Te.icmsAliquota,Te.icmsValor=te.valor??Te.icmsValor),vt&&(Te.ipiAliquota=vt.aliquota??Te.ipiAliquota,Te.ipiValor=vt.valor??Te.ipiValor),ie&&(Te.pisAliquota=ie.aliquota??Te.pisAliquota,Te.pisValor=ie.valor??Te.pisValor),xt&&(Te.cofinsAliquota=xt.aliquota??Te.cofinsAliquota,Te.cofinsValor=xt.valor??Te.cofinsValor)}return{xml:Te,existing:le,isNew:!le,willCreate:!le,willUpdate:!!le,selected:!0,index:ae}});m(Y);const me={};Y.forEach((ee,ae)=>{ee.xml.precoVenda&&(me[ae]={salePrice:Number(ee.xml.precoVenda)})}),console.log("[XMLImport] Pr-populando editedProducts:",me),w(me),console.log("[XMLImport] Preview preparado, mudando para step preview. Total produtos:",Y.length),l("preview")}catch(de){console.error("[XMLImport] Erro ao processar arquivo:",de),o({title:"Erro ao processar XML",description:de.message,variant:"destructive"})}},I=()=>{P({isOpen:!0})},T=async()=>{P({isOpen:!1});let L="";if(c)try{L=await c.text()}catch(W){console.error("[XMLImport] Erro ao ler XML:",W),o({title:"Erro ao ler XML",description:"No foi possvel ler o arquivo XML.",variant:"destructive"});return}l("processing"),g(!0);const G={created:0,updated:0,errors:0,skipped:0,details:[],supplierId:null},de=h.filter(W=>W.selected);if(de.length===0){o({title:"Nenhum produto selecionado",description:"Selecione ao menos um produto para importar.",variant:"warning"}),g(!1),l("preview");return}let X=null;if(u?.fornecedor)try{X=await Sst(u.fornecedor,n),G.supplierId=X.id,console.log("[XMLImport] Fornecedor processado:",X.razao_social,"ID:",X.id)}catch(W){console.error("[XMLImport] Erro ao processar fornecedor:",W),o({title:"Aviso",description:"No foi possvel criar/vincular o fornecedor, mas os produtos sero importados.",variant:"warning"})}console.log("[XMLImport] Processando apenas produtos selecionados:",de.length);for(const W of de){const Y=b[W.index]||{},me=Y.name||W.xml.nome,ee=Y.qty!==void 0?Y.qty:Number(W.xml.quantidade),ae=Y.margin,le=Y.salePrice,Te=Y.linkedProductId;try{if(Te&&Te!=="force-new"){ee>0&&await e0({productId:Te,delta:ee,codigoEmpresa:n}),G.updated++,G.details.push({produto:me,acao:`Vinculado - Estoque atualizado (+${ee})`,status:"success"});continue}if(W.isNew||Te==="force-new"){const te=L3(W.xml,n);if(Y.name&&(te.name=Y.name),le!=null)te.salePrice=le,te.price=le;else if(ae!=null&&ae>0){const ie=te.costPrice||0;if(ie>0){const xt=ie*(1+ae/100);te.salePrice=xt,te.price=xt}}else te.salePrice!=null&&te.price==null&&(te.price=te.salePrice);te.stock=ee,te.initialStock=ee,te.currentStock=ee,te.importedViaXML=!0,te.category="Importados",u?.nfe&&(te.xmlChave=u.nfe.chaveAcesso||null,te.xmlNumero=u.nfe.numero||null,te.xmlSerie=u.nfe.serie||null,te.xmlEmissao=u.nfe.dataEmissao||null);try{await pC(te,{codigoEmpresa:n}),G.created++,G.details.push({produto:me,acao:"Criado",status:"success"})}catch(ie){if(ie.message?.includes("duplicate")||ie.message?.includes("unique constraint")){console.warn("[XMLImport] Produto j existe, tentando atualizar estoque:",W.xml.nome);const vt=(await mf({search:W.xml.nome,codigoEmpresa:n,includeInactive:!0})).find(dt=>{const St=(dt.name||"").toLowerCase().trim()===(W.xml.nome||"").toLowerCase().trim(),ft=(dt.unit||"").toUpperCase().trim()===(W.xml.unidade||"").toUpperCase().trim(),_t=(dt.barcode||"")===(W.xml.ean||""),gr=(dt.code||"")===(W.xml.codigo||""),be=St&&ft||_t&&ft||gr&&ft;return!be&&(_t||gr)&&!ft&&console.log("[XMLImport] Encontrado mesmo EAN/Cdigo porm unidade diferente. NO unir:",{nomeSistema:dt.name,unidadeSistema:dt.unit,nomeXML:W.xml.nome,unidadeXML:W.xml.unidade,ean:W.xml.ean,codigo:W.xml.codigo}),be});if(vt&&Number(W.xml.quantidade)>0)await e0({productId:vt.id,delta:Number(W.xml.quantidade)||0,codigoEmpresa:n}),G.updated++,G.details.push({produto:W.xml.nome,acao:"J existe - Estoque atualizado",status:"success"});else if(vt)G.skipped++,G.details.push({produto:W.xml.nome,acao:"Sem quantidade para ajustar",status:"warning"});else try{console.log("[XMLImport] Duplicate report mas no encontrou por nome+unidade/EAN+unidade/cdigo+unidade. Tentando criar novo produto.");const dt=L3(W.xml,n);dt.salePrice!=null&&dt.price==null&&(dt.price=dt.salePrice);const St=Number(W.xml.quantidade)||0;dt.stock=St,dt.initialStock=St,dt.currentStock=St,await pC(dt,{codigoEmpresa:n}),G.created++,G.details.push({produto:W.xml.nome,acao:"Criado aps checagem",status:"success"})}catch(dt){console.warn("[XMLImport] Falhou ao criar aps duplicate:",dt),G.skipped++,G.details.push({produto:W.xml.nome,acao:"Falha ao criar aps duplicate",status:"warning"})}}else throw ie}}else{const te=Number(W.xml.quantidade)||0;if(te>0&&await e0({productId:W.existing.id,delta:te,codigoEmpresa:n}),Y.updatePrice===!0){const xt=Number(W.xml.valorUnitario)||0;if(xt>0)try{const vt={costPrice:xt};if(le!=null)vt.salePrice=le,vt.price=le;else if(ae!=null&&ae>0){const dt=xt*(1+ae/100);vt.salePrice=dt,vt.price=dt}await z1(W.existing.id,vt)}catch(vt){console.warn("[XMLImport] Falha ao atualizar preo do produto existente",vt)}}try{const xt=W.existing||{},vt=W.xml.impostos||{},dt=vt.icms||{},St=vt.pis||{},ft=vt.cofins||{},_t=vt.ipi||{},gr={},be=Nt=>Nt==null||typeof Nt=="string"&&Nt.trim()==="";be(xt.ncm)&&W.xml.ncm&&(gr.ncm=W.xml.ncm),be(xt.cfopInterno)&&W.xml.cfop&&(gr.cfopInterno=W.xml.cfop),be(xt.cstIcmsInterno)&&dt.cst&&(gr.cstIcmsInterno=dt.cst),be(xt.csosnInterno)&&dt.csosn&&(gr.csosnInterno=dt.csosn),be(xt.cstIpi)&&_t.cst&&(gr.cstIpi=_t.cst),be(xt.cstPisEntrada)&&St.cst&&(gr.cstPisEntrada=St.cst),xt.aliqIcmsInterno==null&&Number(dt.aliquota||0)>0&&(gr.aliqIcmsInterno=Number(dt.aliquota)),xt.aliqIpiPercent==null&&Number(_t.aliquota||0)>=0&&(gr.aliqIpiPercent=Number(_t.aliquota)),xt.aliqPisPercent==null&&Number(St.aliquota||0)>=0&&(gr.aliqPisPercent=Number(St.aliquota)),xt.aliqCofinsPercent==null&&Number(ft.aliquota||0)>=0&&(gr.aliqCofinsPercent=Number(ft.aliquota)),xt.fcpPercent==null&&Number(dt.fcpAliquota||0)>0&&(gr.fcpPercent=Number(dt.fcpAliquota)),xt.mvaPercent==null&&Number(dt.mva||0)>0&&(gr.mvaPercent=Number(dt.mva)),xt.baseReduzidaPercent==null&&Number(dt.pRedBC||0)>0&&(gr.baseReduzidaPercent=Number(dt.pRedBC)),Object.keys(gr).length>0&&(await z1(W.existing.id,gr),console.log("[XMLImport] Produto existente atualizado com fiscais faltantes",{id:W.existing.id,patch:gr}))}catch(xt){console.warn("[XMLImport] Falha ao completar fiscais no produto existente",xt)}G.updated++,G.details.push({produto:W.xml.nome,acao:te>0?`Estoque +${te} (somado)`:"Verificado",status:"success"})}}catch(te){console.error("[XMLImport] Erro ao processar produto:",W.xml.nome,te),G.errors++,G.details.push({produto:W.xml.nome,acao:"Erro",status:"error",error:te.message})}}if(u?.nfe?.chaveAcesso&&X)try{const W=await Pst(u.nfe.chaveAcesso,n);let Y=W;if(!W||!W.ativo){const ee={codigoEmpresa:n,fornecedorId:X.id,chaveNfe:u.nfe.chaveAcesso,numeroNfe:u.nfe.numero,serieNfe:u.nfe.serie,dataEmissao:u.nfe.dataEmissao,tipoOperacao:u.nfe.tipo||"Entrada",naturezaOperacao:u.nfe.naturezaOperacao,valorProdutos:u.nfe.totalNota||0,valorTotal:u.nfe.totalNota||0,xmlCompleto:L,formaPagamento:u.pagamentos&&u.pagamentos.length>0?u.pagamentos.map(ae=>ae.nome).join(", "):null};Y=await Ast(ee),console.log("[XMLImport] Nova compra registrada:",Y.numero_nfe)}else console.log("[XMLImport] NF-e j existe, adicionando novos itens:",W.numero_nfe),G.purchaseAlreadyExists=!0;const me=de.map(ee=>{const ae=b[ee.index]||{},le=ae.linkedProductId;let Te=null;return le&&le!=="force-new"?Te=le:ee.existing&&!le&&(Te=ee.existing.id),{produtoId:Te,codigoProdutoXML:ee.xml.codigo,nomeProdutoXML:ee.xml.nome,eanXML:ee.xml.ean,ncmXML:ee.xml.ncm,cfopXML:ee.xml.cfop,unidadeXML:ee.xml.unidade,quantidade:ae.qty!==void 0?ae.qty:Number(ee.xml.quantidade),valorUnitario:Number(ee.xml.valorUnitario)||0,valorTotal:Number(ee.xml.valorTotal)||0,valorDesconto:ee.xml.valorDesconto||0,valorFrete:ee.xml.valorFrete||0,valorSeguro:ee.xml.valorSeguro||0,valorOutrasDespesas:ee.xml.valorOutrasDespesas||0,icmsAliquota:ee.xml.icmsAliquota,icmsValor:ee.xml.icmsValor,ipiAliquota:ee.xml.ipiAliquota,ipiValor:ee.xml.ipiValor,pisAliquota:ee.xml.pisAliquota,pisValor:ee.xml.pisValor,cofinsAliquota:ee.xml.cofinsAliquota,cofinsValor:ee.xml.cofinsValor,vinculadoManualmente:!!ae.linkedProductId,observacoes:ae.observacoes||null,selecionadoNaImportacao:ee.selected}});await coe(Y.id,me),console.log("[XMLImport] Itens adicionados  compra:",me.length),G.purchaseId=Y.id}catch(W){console.error("[XMLImport] Erro ao registrar compra:",W)}y(G),g(!1),l("done"),G.purchaseAlreadyExists?o({title:"NF-e j importada!",description:`Esta NF-e j existe no sistema. ${G.created} produto(s) criado(s), ${G.updated} atualizado(s).`,variant:"warning"}):G.errors===0?o({title:"Importao concluda!",description:`${G.created} produto(s) criado(s), ${G.updated} atualizado(s).`,variant:"success"}):o({title:"Importao concluda com erros",description:`${G.created} criado(s), ${G.updated} atualizado(s), ${G.errors} erro(s).`,variant:"warning"}),s&&s()},k=()=>{console.log("[XMLImport] Fechando modal"),l("upload"),d(null),f(null),m([]),w({}),_({}),y({created:0,updated:0,errors:0,details:[]}),t(!1)};Ce.useEffect(()=>{e&&console.log("[XMLImport] Modal aberto. Step atual:",i)},[e,i]);const $=()=>{l("upload"),d(null),f(null),m([]),w({}),_({})},q=L=>{m(G=>G.map((de,X)=>X===L?{...de,selected:!de.selected}:de))},z=()=>{const L=h.every(G=>G.selected);m(G=>G.map(de=>({...de,selected:!L})))},F=(L,G,de)=>{w(X=>({...X,[L]:{...X[L],[G]:de}}))},V=(L,G)=>{console.log("[XMLImportModal] handleLinkProduct chamado:",{index:L,productId:G}),console.log("[XMLImportModal] Estado editedProducts completo antes:",b),console.log("[XMLImportModal] Estado editedProducts[index] antes:",b[L]),w(de=>{console.log("[XMLImportModal] Estado prev no setEditedProducts:",de);const X={...de,[L]:{...de[L],linkedProductId:G}};return console.log("[XMLImportModal] Novo estado editedProducts:",X),X})},ue=(L,G)=>!L||!G?0:L*(1+G/100),_e=(L,G,de)=>b[L]?.[G]??de,U=L=>{_(G=>({...G,[L]:!G[L]}))};return a.jsxs(zn,{open:e,onOpenChange:k,children:[a.jsxs(qn,{className:"w-[95vw] sm:max-w-4xl max-h-[85vh] flex flex-col",children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsxs($n,{className:"flex items-center gap-2 text-2xl font-bold",children:[a.jsx("span",{children:"Importar XML de Compra"}),u?.nfe&&a.jsx("span",{className:"inline-flex items-center rounded-full bg-surface-2 border border-border px-2 py-0.5 text-xs font-semibold text-text-muted uppercase tracking-wide",children:M()})]}),a.jsxs(la,{children:[i==="upload"&&"Selecione o arquivo XML da nota fiscal de entrada",i==="preview"&&"Revise os produtos que sero importados",i==="processing"&&"Processando produtos...",i==="done"&&"Importao finalizada"]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-2 py-1",children:[i==="upload"&&a.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:a.jsx("div",{className:"w-full max-w-md",children:a.jsxs("label",{htmlFor:"xml-upload",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-border rounded-lg cursor-pointer bg-surface hover:bg-surface-2 transition-colors",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(tD,{className:"w-12 h-12 mb-4 text-text-muted"}),a.jsx("p",{className:"mb-2 text-sm text-text-primary font-semibold",children:"Clique para selecionar ou arraste o arquivo"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Arquivo XML de NF-e (Nota Fiscal Eletrnica)"})]}),a.jsx("input",{id:"xml-upload",type:"file",accept:".xml",className:"hidden",onChange:O})]})})}),i==="preview"&&a.jsxs("div",{className:"space-y-4",children:[u?.nfe&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"font-semibold mb-2",children:["Informaes da ",M()]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",a.jsx("span",{className:"font-mono",children:u.nfe.numero})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",a.jsx("span",{className:"font-mono",children:u.nfe.serie})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Tipo:"})," ",a.jsx("span",{children:u.nfe.tipo})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Fornecedor:"})," ",a.jsx("span",{children:u.fornecedor?.razaoSocial})]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2 min-w-[200px]",children:[a.jsxs("div",{className:"bg-brand/10 rounded-lg p-3 border border-brand/20",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Valor Total NF-e"}),a.jsxs("p",{className:"text-xl font-bold text-brand",children:["R$ ",Number(u.nfe.totalNota||0).toFixed(2)]})]}),u.pagamentos&&u.pagamentos.length>0&&a.jsxs("div",{className:"bg-success/10 rounded-lg p-2.5 border border-success/20",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Forma de Pagamento"}),a.jsx("p",{className:"text-sm font-semibold text-success",children:u.pagamentos.map(L=>L.nome).join(", ")})]})]})]}),u.nfe.chaveAcesso&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-border",children:[a.jsx("span",{className:"text-text-muted text-xs",children:"Chave de Acesso:"}),a.jsx("p",{className:"font-mono text-xs break-all",children:u.nfe.chaveAcesso})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4 px-2",children:[a.jsx(Z,{variant:"outline",size:"sm",onClick:z,children:h.every(L=>L.selected)?"Desmarcar Todos":"Selecionar Todos"}),a.jsxs("span",{className:"text-sm text-text-muted",children:[h.filter(L=>L.selected).length," de ",h.length," selecionados"]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3 text-base",children:"Produtos Encontrados"}),a.jsx("div",{className:"space-y-2",children:h.map((L,G)=>{const de=_e(G,"linkedProductId",null),X=_e(G,"name",L.xml.nome),W=_e(G,"quantity",L.xml.quantidade),Y=_e(G,"margin",L.xml.margem),me=_e(G,"salePrice",null),ee=L.xml.valorUnitario||0;let ae=me;ae==null&&!L.isNew&&L.existing&&(ae=Number(L.existing.preco_venda||L.existing.salePrice||L.existing.price||0)),ae==null&&Y!=null&&(ae=ue(ee,Y)),ae==null&&L.xml.precoVenda&&(ae=Number(L.xml.precoVenda));let le=null;if(Y!=null)le=Y;else if(ae!=null&&ee>0&&ae>0){const te=(ae-ee)/ee*100;le=Math.max(-999,Math.min(9999,te))}const Te=j[G];return a.jsxs("div",{className:Er("rounded-lg border transition-all",L.selected?L.isNew?"bg-success/10 border-success/30":"bg-info/10 border-info/30":"bg-surface opacity-60 border-border"),children:[a.jsxs("div",{className:"p-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("input",{type:"checkbox",checked:L.selected,onChange:()=>q(G),className:"w-4 h-4 rounded border-border accent-warning cursor-pointer"}),a.jsx("button",{onClick:()=>U(G),className:"p-0.5 hover:bg-surface-2 rounded transition-colors",children:Te?a.jsx(gx,{className:"w-4 h-4 text-text-muted"}):a.jsx(Yg,{className:"w-4 h-4 text-text-muted"})}),a.jsx("div",{children:L.isNew?a.jsx(to,{className:"w-5 h-5 text-success"}):a.jsx(Tg,{className:"w-5 h-5 text-info"})})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:X}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-text-muted mt-0.5",children:[L.xml.codigo&&a.jsxs("span",{className:"flex-shrink-0",children:["#",L.xml.codigo]}),a.jsxs("span",{children:["Qtd: ",W]})]})]}),a.jsx("div",{className:"flex-shrink-0 ml-2",children:L.isNew?a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-success/20 text-success font-medium",children:"Novo"}):a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-info/20 text-info font-medium",children:"Cadastrado"})})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-muted",children:[a.jsxs("span",{children:["R$ ",Number(ee).toFixed(2),ae?`  R$ ${ae.toFixed(2)}`:""]}),le!=null&&a.jsxs("span",{className:"ml-2 "+(le>0?"text-success":le<0?"text-destructive":"text-text-muted"),children:[le.toFixed(1),"%"]})]})]})]}),Te&&a.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3 border-t border-border/50",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Nome do Produto"}),a.jsx("input",{type:"text",value:X,onChange:te=>F(G,"name",te.target.value),disabled:!L.selected,className:"w-full px-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>F(G,"qty",Math.max(0,W-1)),disabled:!L.selected||W<=0,className:"w-9 h-9 rounded-md border border-border bg-surface hover:bg-surface-2 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:a.jsx(Nv,{className:"w-4 h-4"})}),a.jsx("input",{type:"text",value:W,onChange:te=>{const ie=te.target.value.replace(/\D/g,"");F(G,"qty",ie===""?0:Number(ie))},disabled:!L.selected,className:"w-14 text-center px-2 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50"}),a.jsx("button",{type:"button",onClick:()=>F(G,"qty",W+1),disabled:!L.selected,className:"w-9 h-9 rounded-md bg-warning hover:bg-warning/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center text-black font-bold shadow-sm",children:a.jsx(to,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Margem %"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:(()=>{const te=_e(G,"margin",null);if(te!=null)return String(te);if(!L.isNew&&L.existing&&ee>0){const ie=Number(L.existing.preco_venda||L.existing.salePrice||L.existing.price||0);if(ie>0)return((ie-ee)/ee*100).toFixed(1)}return""})(),onChange:te=>{const ie=te.target.value;if(ie===""){F(G,"margin",null);return}const xt=ie.replace(/[^0-9.,\-]/g,"").replace(",",".");if(xt==="."||xt==="-"||xt==="-.")return;const vt=parseFloat(xt);if(!isNaN(vt)&&(F(G,"margin",vt),ee>0)){const dt=ue(ee,vt);F(G,"salePrice",dt)}},disabled:!L.selected,placeholder:"0",className:"w-24 pl-3 pr-6 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right"}),a.jsx("span",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Custo"}),a.jsx("div",{className:"px-3 py-2 bg-surface/50 rounded-md border border-border",children:a.jsxs("span",{className:"text-sm font-semibold",children:["R$ ",ee.toFixed(2)]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Preo Venda"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"R$"}),a.jsx("input",{type:"text",value:(()=>{const te=_e(G,"salePrice",ae);return te==null?"":Number(te).toFixed(2).replace(".",",")})(),onChange:te=>{const ie=te.target.value.replace(/\D/g,"");if(ie===""){F(G,"salePrice",null);return}const xt=Number(ie)/100;if(F(G,"salePrice",xt),xt>0&&ee>0){const vt=(xt-ee)/ee*100;F(G,"margin",Math.round(vt*100)/100)}},disabled:!L.selected,placeholder:"0,00",className:"w-28 pl-7 pr-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right font-semibold text-success"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:L.isNew?"Vincular a Produto Existente (Opcional)":"Ao para este Produto"}),a.jsx("div",{className:"flex gap-2",children:a.jsxs(ea,{value:de==="force-new"?"force-new":de||(L.isNew?"new":L.existing?.id||"new"),onValueChange:te=>{te==="new"||te===L.existing?.id?V(G,null):te==="search"?A({isOpen:!0,productIndex:G,currentProduct:L}):V(G,te)},disabled:!L.selected,children:[a.jsx(Jn,{className:"flex-1 hover:bg-white/5 transition-colors text-xs sm:text-sm",children:a.jsx(ra,{placeholder:L.isNew?"Criar novo":"Atualizar existente",children:de&&de!=="force-new"&&de!=="new"?(()=>{const te=r?.find(ie=>ie.id===de);return te?`Vinculado: ${te.name}`:L.isNew?"Criar novo":"Atualizar existente"})():de==="force-new"?"Criar novo (ignorar)":L.isNew?"Criar novo":"Atualizar existente"})}),a.jsxs(Qn,{className:"max-h-[300px] overflow-y-auto text-xs sm:text-sm",children:[L.isNew?a.jsx(Qe,{value:"new",children:"Criar novo produto"}):a.jsxs(Qe,{value:L.existing?.id||"new",children:["Atualizar: ",L.existing?.name," (Estoque: ",L.existing?.stock||0,")"]}),!L.isNew&&a.jsx(Qe,{value:"force-new",children:"Criar novo (ignorar existente)"}),a.jsx(Qe,{value:"search",children:"Buscar produto para vincular"})]})]})})]}),!L.isNew&&a.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:_e(G,"updatePrice",!1),onChange:te=>F(G,"updatePrice",te.target.checked),disabled:!L.selected,className:"w-4 h-4 rounded border-border bg-surface text-brand focus:ring-2 focus:ring-brand/50 disabled:opacity-50 disabled:cursor-not-allowed"}),a.jsx("span",{className:"text-text-secondary",children:"Atualizar preo de custo e venda deste produto"})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[L.xml.codigo&&a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["Cdigo: ",L.xml.codigo]}),L.xml.ean&&L.xml.ean!=="SEM GTIN"&&a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["EAN: ",L.xml.ean]}),a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["Unidade: ",L.xml.unidade]})]})]})]},G)})})]}),a.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-success"}),a.jsxs("span",{children:[h.filter(L=>L.isNew&&L.selected).length," novos"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-info"}),a.jsxs("span",{children:[h.filter(L=>!L.isNew&&L.selected).length," existentes"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-warning"}),a.jsxs("span",{children:[h.filter(L=>b[L.index]?.linkedProductId).length," vinculados"]})]})]})]}),i==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(ll,{className:"w-12 h-12 animate-spin text-warning mb-4"}),a.jsx("p",{className:"text-lg font-semibold",children:"Processando produtos..."}),a.jsx("p",{className:"text-sm text-text-muted",children:"Aguarde enquanto importamos os produtos"})]}),i==="done"&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-6 border border-border text-center",children:[a.jsx(Oi,{className:"w-16 h-16 text-success mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Importao Concluda!"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-success",children:v.created}),a.jsx("p",{className:"text-sm text-text-muted",children:"Criados"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-info",children:v.updated}),a.jsx("p",{className:"text-sm text-text-muted",children:"Atualizados"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-danger",children:v.errors}),a.jsx("p",{className:"text-sm text-text-muted",children:"Erros"})]})]})]}),v.details.length>0&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Detalhes"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:v.details.map((L,G)=>a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[L.status==="success"?a.jsx(Oi,{className:"w-4 h-4 text-success flex-shrink-0"}):a.jsx(kd,{className:"w-4 h-4 text-danger flex-shrink-0"}),a.jsx("span",{className:"flex-1 truncate",children:L.produto}),a.jsx("span",{className:Er("text-xs px-2 py-1 rounded",L.status==="success"?"bg-success/20 text-success":"bg-danger/20 text-danger"),children:L.acao})]},G))})]})]})]}),a.jsxs(Ua,{children:[i==="upload"&&a.jsx(Z,{variant:"outline",onClick:k,children:"Cancelar"}),i==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:$,children:"Voltar"}),a.jsxs(Z,{onClick:I,disabled:h.filter(L=>L.selected).length===0,children:["Confirmar Importao (",h.filter(L=>L.selected).length," de ",h.length," produtos)"]})]}),i==="done"&&a.jsx(Z,{onClick:k,children:"Fechar"})]})]}),a.jsx(uoe,{isOpen:C.isOpen,onClose:()=>A({isOpen:!1,productIndex:null,currentProduct:null}),onSelect:L=>{console.log("[XMLImportModal] onSelect chamado com produto:",L),console.log("[XMLImportModal] Index do produto:",C.productIndex),V(C.productIndex,L.id),A({isOpen:!1,productIndex:null,currentProduct:null})},currentProduct:C.currentProduct}),a.jsx(foe,{isOpen:S.isOpen,onClose:()=>P({isOpen:!1}),onConfirm:T,products:h.map((L,G)=>({...L,originalIndex:G})),editedProducts:b,allProducts:r,isReprocess:!1})]})}const Mst=[],Rst=[],Fst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},$3={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},mV="produtosPage:settings";function Lst(e){const t=["Cdigo","Produto","Categoria","Tipo","Unidade","Preo Custo","Preo Venda","% Lucro","Estoque","Estoque Mn.","Validade","Status","Ativo","EAN-13","EAN-13 Caixa","Referncia","Marca","Grupo","NCM","Descrio NCM","CEST","Usar CSOSN","CFOP Interno","CST ICMS Interno","CSOSN Interno","Aliq ICMS Interno (%)","CFOP Externo","CST ICMS Externo","CSOSN Externo","Aliq ICMS Externo (%)","CST PIS Entrada","CST PIS Sada","Aliq PIS (%)","Aliq COFINS (%)","CST IPI","Aliq IPI (%)","FCP (%)","MVA (%)","Base Reduzida (%)"],r=";",n=g=>{const v=Number(g??0);return Number.isFinite(v)?v.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):"0,00"},s=g=>`R$ ${n(g)}`,o=g=>{const v=Number(g??0);return Number.isFinite(v)?v.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},i=g=>{if(!g)return"";try{if(typeof g=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(g)){const[y,b,w]=g.split("-");return`${w}/${b}/${y}`}const v=new Date(g);if(!isNaN(v)){const y=String(v.getDate()).padStart(2,"0"),b=String(v.getMonth()+1).padStart(2,"0"),w=v.getFullYear();return`${y}/${b}/${w}`}}catch{}return String(g)},l=g=>g==="active"?"Ativo":g==="low_stock"?"Estoque Baixo":g==="inactive"?"Inativo":"",c=g=>g?"Sim":"No",d=g=>g??"",u=g=>{const v=g==null?"":String(g);return/[";\n]/.test(v)?`"${v.replace(/"/g,'""')}"`:v},f=[];f.push("\uFEFF"+t.join(r));for(const g of e){const v=[d(g.code),d(g.name),d(g.category),d(g.type),d(g.unit),s(g.costPrice),s(g.price??g.salePrice),o(g.marginPercent),Number(g.stock??0),Number(g.minStock??0),i(g.validade),l(g.status),c(g.active!==!1),d(g.barcode),d(g.barcodeBox),d(g.reference),d(g.brand),d(g.group),d(g.ncm),d(g.ncmDescription),d(g.cest),g.useCsosn?"Sim":"",d(g.cfopInterno),d(g.cstIcmsInterno),d(g.csosnInterno),o(g.aliqIcmsInterno),d(g.cfopExterno),d(g.cstIcmsExterno),d(g.csosnExterno),o(g.aliqIcmsExterno),d(g.cstPisEntrada),d(g.cstPisSaida),o(g.aliqPisPercent),o(g.aliqCofinsPercent),d(g.cstIpi),o(g.aliqIpiPercent),o(g.fcpPercent),o(g.mvaPercent),o(g.baseReduzidaPercent)].map(u).join(r);f.push(v)}const h=new Blob([f.join(`
`)],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(h),x=document.createElement("a");x.href=m,x.download="produtos.csv",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m)}function xd(e,{action:t}={}){const r=String(e?.message||e||"").toLowerCase();if(r.includes("categoria possui produtos ativos vinculados"))return{title:"No  possvel remover",description:"Existem produtos ativos vinculados a esta categoria. Inative ou recategoriz-os antes."};if(r.includes("categoria no encontrada"))return{title:"Categoria no encontrada",description:"No foi possvel localizar a categoria para desativao."};if(r.includes("duplicate key")&&r.includes("ux_produtos_empresa_codigo_produto"))return{title:"Cdigo j cadastrado",description:"J existe um produto com este cdigo na sua empresa. Informe outro cdigo."};if(r.includes("duplicate key")&&r.includes("unique constraint"))return{title:"Registro j existe",description:"J existe um registro com estes dados."};if(r.includes("permission denied")||r.includes("violates row-level security")||r.includes("rls"))return{title:"Sem permisso",description:"Voc no tem permisso para executar esta ao."};const n=r.match(/null value in column "([^"]+)" violates not-null constraint/);return n?{title:"Campo obrigatrio",description:`Preencha o campo "${n[1].replace(/_/g," ")}".`}:r.includes("invalid input syntax")||r.includes("invalid input value")?{title:"Valor invlido",description:"Revise os valores informados (formato invlido)."}:r.includes("violates check constraint")?{title:"Valor invlido",description:"Os dados informados no atendem s regras do sistema."}:r.includes("violates foreign key constraint")?r.includes("update or delete on table")?{title:"No  possvel excluir",description:"Existem registros vinculados que impedem a excluso."}:{title:"Relao invlida",description:"O registro relacionado no foi encontrado ou  invlido."}:r.includes("failed to fetch")||r.includes("networkerror")||r.includes("network error")?{title:"Falha de conexo",description:"Verifique sua internet e tente novamente."}:r.includes("timeout")?{title:"Tempo esgotado",description:"A operao demorou demais. Tente novamente."}:r.includes("rate limit")||r.includes("too many requests")||r.includes("status code 429")?{title:"Muitas solicitaes",description:"Aguarde alguns segundos e tente novamente."}:t==="save"?{title:"Falha ao salvar",description:"No foi possvel salvar o produto. Tente novamente."}:t==="delete"?{title:"Falha ao inativar",description:"No foi possvel inativar o produto."}:t==="fetch"?{title:"Erro ao carregar",description:"No foi possvel atualizar a lista de produtos."}:t==="export"?{title:"Falha ao exportar",description:"No foi possvel gerar o arquivo."}:{title:"Erro",description:e?.message||"Ocorreu um erro."}}const Tk=({icon:e,title:t,value:r,subtitle:n,color:s,onClick:o,isActive:i})=>{const l=e;return a.jsxs(Mr.div,{variants:$3,className:Er("bg-surface rounded-2xl border-2 p-3 sm:p-4 flex flex-col justify-between gap-2 cursor-pointer transition-all duration-300",i?`${s}/30 border-${s}`:"border-border hover:border-border-hover"),onClick:o,children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[a.jsx("p",{className:"text-text-secondary text-xs sm:text-sm font-semibold leading-snug whitespace-nowrap overflow-hidden text-ellipsis",children:t}),a.jsx(l,{className:Er("w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0",s)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold text-text-primary leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:r}),a.jsx("p",{className:"hidden sm:block text-xs text-text-muted",children:n})]})]})};function $st({open:e,onOpenChange:t,product:r,onSave:n,categories:s,onCreateCategory:o,suggestedCode:i,onRefreshProducts:l,products:c}){const{toast:d}=Xs(),{userProfile:u}=fo(),[f,h]=p.useState("dados"),[m,x]=p.useState(r?.code||""),[g,v]=p.useState(r?.name||""),[y,b]=p.useState(r?.category||""),[w,j]=p.useState(r?.type||"Venda"),[_,C]=p.useState(r?.unit||"UN"),[A,S]=p.useState(r?.active??!0),[P,M]=p.useState(r?.barcode||""),[O,I]=p.useState(r?.barcodeBox||""),[T,k]=p.useState(r?.reference||""),[$,q]=p.useState(r?.brand||""),[z,F]=p.useState(r?.group||""),[V,ue]=p.useState(!!r?.allowSale),[_e,U]=p.useState(!!r?.payCommission),[L,G]=p.useState(!!r?.variablePrice),[de,X]=p.useState(!!r?.composition),[W,Y]=p.useState(!!r?.service),[me,ee]=p.useState(!!r?.hasGrid),[ae,le]=p.useState(!!r?.usePriceTable),[Te,te]=p.useState(!!r?.fuel),[ie,xt]=p.useState(!!r?.useImei),[vt,dt]=p.useState(!!r?.stockByGrid),[St,ft]=p.useState(!!r?.showInApp),[_t,gr]=p.useState(r?.costPrice!=null?Number(r.costPrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.cost!=null?Number(r.cost).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),[be,Nt]=p.useState(r?.salePrice!=null?Number(r.salePrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.price!=null?Number(r.price).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),[Wt,_r]=p.useState(r?.marginPercent!=null?String(Number(r.marginPercent).toFixed(2)).replace(".",","):""),[yr,ve]=p.useState(r?.stock?String(r.stock):""),[at,qt]=p.useState(r?.minStock?String(r.minStock):""),[$t,De]=p.useState(r?.status||"active"),[wt,Rt]=p.useState(r?.validade||null),[Rr,Me]=p.useState(!1),[tt,ut]=p.useState(!1),[sr,Sr]=p.useState(""),[xr,Wr]=p.useState(!0),[qr,Tr]=p.useState(!!(r?.csosnInterno||r?.csosnExterno)),[sn,Cn]=p.useState(r?.cfopInterno||""),[ze,Fe]=p.useState(r?.cstIcmsInterno||""),[Le,Ze]=p.useState(r?.csosnInterno||""),[Ot,mt]=p.useState(r?.aliqIcmsInterno!=null?String(r.aliqIcmsInterno).replace(".",","):""),[Qt,bt]=p.useState(r?.cfopExterno||""),[zt,ne]=p.useState(r?.cstIcmsExterno||""),[He,Gt]=p.useState(r?.csosnExterno||""),[Ht,Fr]=p.useState(r?.aliqIcmsExterno!=null?String(r.aliqIcmsExterno).replace(".",","):""),[cr,nn]=p.useState(r?.cstPisEntrada||""),[Tn,Gn]=p.useState(r?.cstPisSaida||""),[ta,Aa]=p.useState(r?.aliqPisPercent!=null?String(r.aliqPisPercent).replace(".",","):""),[ke,Ae]=p.useState(r?.aliqCofinsPercent!=null?String(r.aliqCofinsPercent).replace(".",","):""),[et,br]=p.useState(r?.cstIpi||""),[Zt,Pn]=p.useState(r?.aliqIpiPercent!=null?String(r.aliqIpiPercent).replace(".",","):""),[Ct,lr]=p.useState(r?.fcpPercent!=null?String(r.fcpPercent).replace(".",","):""),[Ye,Tt]=p.useState(r?.mvaPercent!=null?String(r.mvaPercent).replace(".",","):""),[Xt,Br]=p.useState(r?.baseReduzidaPercent!=null?String(r.baseReduzidaPercent).replace(".",","):""),[Wn,xn]=p.useState(r?.ncm||""),[on,ua]=p.useState(r?.ncmDescription||""),[sa,wa]=p.useState(r?.cest||""),[Va,J]=p.useState(!1),[Oe,Je]=p.useState(!1),mr=xe=>{const $e=String(xe||"").replace(/\D/g,"");return($e?Number($e)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},ot=xe=>{if(!xe)return 0;const $e=String(xe).replace(/\./g,"").replace(",","."),Pe=Number($e);return Number.isFinite(Pe)?Pe:0},ar=xe=>{const $e=String(xe||"").replace(/[^\d,]/g,"");return $e?`% ${$e}`:""},ir=xe=>{if(xe==null||xe==="")return 0;const $e=String(xe).replace(/\./g,"").replace(",","."),Pe=Number($e);return Number.isFinite(Pe)?Pe:0},In=xe=>String(xe||"").replace(/\D/g,"").slice(0,13),ln=xe=>String(xe||"").replace(/\D/g,"").slice(0,4),Kr=xe=>String(xe||"").replace(/\D/g,"").slice(0,8),oe=xe=>String(xe||"").replace(/\D/g,"").slice(0,7);p.useEffect(()=>{x(r?.code||""),v(r?.name||""),b(r?.category||""),j(r?.type||"Venda"),C(r?.unit||"UN"),S(r?.active??!0),M(r?.barcode||""),I(r?.barcodeBox||""),k(r?.reference||""),q(r?.brand||""),F(r?.group||""),ue(!!r?.allowSale),U(!!r?.payCommission),G(!!r?.variablePrice),X(!!r?.composition),Y(!!r?.service),ee(!!r?.hasGrid),le(!!r?.usePriceTable),te(!!r?.fuel),xt(!!r?.useImei),dt(!!r?.stockByGrid),ft(!!r?.showInApp),gr(r?.costPrice!=null?Number(r.costPrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.cost!=null?Number(r.cost).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),Nt(r?.salePrice!=null?Number(r.salePrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.price!=null?Number(r.price).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),_r(r?.marginPercent!=null?String(Number(r.marginPercent).toFixed(2)).replace(".",","):""),ve(r?.stock?String(r.stock):""),qt(r?.minStock?String(r.minStock):""),De(r?.status||"active"),Rt(r?.validade||null),Tr(!!(r?.csosnInterno||r?.csosnExterno)),Cn(r?.cfopInterno||""),Fe(r?.cstIcmsInterno||""),Ze(r?.csosnInterno||""),mt(r?.aliqIcmsInterno!=null?String(r.aliqIcmsInterno).replace(".",","):""),bt(r?.cfopExterno||""),ne(r?.cstIcmsExterno||""),Gt(r?.csosnExterno||""),Fr(r?.aliqIcmsExterno!=null?String(r.aliqIcmsExterno).replace(".",","):""),nn(r?.cstPisEntrada||""),Gn(r?.cstPisSaida||""),Aa(r?.aliqPisPercent!=null?String(r.aliqPisPercent).replace(".",","):""),Ae(r?.aliqCofinsPercent!=null?String(r.aliqCofinsPercent).replace(".",","):""),br(r?.cstIpi||""),Pn(r?.aliqIpiPercent!=null?String(r.aliqIpiPercent).replace(".",","):""),lr(r?.fcpPercent!=null?String(r.fcpPercent).replace(".",","):""),Tt(r?.mvaPercent!=null?String(r.mvaPercent).replace(".",","):""),Br(r?.baseReduzidaPercent!=null?String(r.baseReduzidaPercent).replace(".",","):""),xn(r?.ncm||""),ua(r?.ncmDescription||""),wa(r?.cest||""),Wr(!0),!r&&i&&!m&&x(i),J(!1),Je(!1)},[r,e]);const Ke=p.useRef("salePrice");p.useEffect(()=>{if(Ke.current==="salePrice"){const xe=ot(_t),$e=ot(be);if($e>0){const Pe=($e-xe)/$e*100;_r(Pe.toFixed(2).replace(".",","))}else _r("")}},[_t,be]),p.useEffect(()=>{if(Ke.current==="marginPercent"){const xe=setTimeout(()=>{const $e=ot(_t),Pe=ir(Wt);if(console.log("[Margem] Custo:",$e,"Margem:",Pe),$e>0&&Pe>0)if(Pe>=100){const Vt=$e*(1+Pe/100);console.log("[Margem] Preo calculado (markup):",Vt),Nt(Vt.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}else{const Vt=$e/(1-Pe/100);console.log("[Margem] Preo calculado (margem):",Vt),Nt(Vt.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}},500);return()=>clearTimeout(xe)}},[Wt,_t]);const ct=async xe=>{if(xe.preventDefault(),Rr)return;const $e=[];if(g?.trim()||$e.push("Descrio"),_?.trim()||$e.push("Unidade"),w||$e.push("Tipo de Produto"),ot(be)<=0&&$e.push("Preo de Venda"),$e.length){d({title:"Preencha os campos obrigatrios",description:$e.join(", "),variant:"destructive"});return}console.log("[ProdutosPage] handleSave - Estado active antes de salvar:",A);let Pe=$t;A?$t==="inactive"&&A&&(Pe="active"):Pe="inactive",console.log("[ProdutosPage] handleSave - Status ajustado:",Pe);const Vt={id:r?.id,code:m?.trim()||"",name:g,category:y,type:w,stock:Number(yr||0),minStock:Number(at||0),status:Pe,validade:wt,unit:_,active:A,barcode:In(P),barcodeBox:In(O),reference:T?.trim()||null,brand:$?.trim()||null,group:z?.trim()||null,cost:ot(_t),price:ot(be),buyPrice:null,costsPercent:null,costPrice:ot(_t),salePrice:ot(be),marginPercent:ir(Wt),allowSale:V,payCommission:_e,variablePrice:L,composition:de,service:W,hasGrid:me,usePriceTable:ae,fuel:Te,useImei:ie,stockByGrid:vt,showInApp:St,cfopInterno:ln(sn)||null,cstIcmsInterno:qr?null:ze||null,csosnInterno:qr&&Le||null,aliqIcmsInterno:ir(Ot),cfopExterno:ln(Qt)||null,cstIcmsExterno:qr?null:zt||null,csosnExterno:qr&&He||null,aliqIcmsExterno:ir(Ht),cstPisEntrada:cr||null,cstPisSaida:Tn||null,aliqPisPercent:ir(ta),aliqCofinsPercent:ir(ke),cstIpi:et||null,aliqIpiPercent:ir(Zt),fcpPercent:ir(Ct),mvaPercent:ir(Ye),baseReduzidaPercent:ir(Xt),ncm:Kr(Wn)||null,ncmDescription:on||null,cest:oe(sa)||null};try{Me(!0),console.log("[Produtos] Salvando produto",Vt);const yt=2e4,tr=new Promise((dr,tn)=>setTimeout(()=>tn(new Error("Timeout ao salvar produto (20s)")),yt));await Promise.race([n(Vt),tr]),d({title:"Produto salvo",description:"O produto foi salvo com sucesso.",variant:"success",duration:4e3,className:"bg-amber-500 text-black shadow-xl"}),t(!1)}catch(yt){console.error("[Produtos] Erro ao salvar",yt);const tr=xd(yt,{action:"save"});d({title:tr.title,description:tr.description,variant:"destructive",duration:6e3})}finally{Me(!1)}};return p.useEffect(()=>{e||Me(!1)},[e]),a.jsxs(zn,{open:e,onOpenChange:t,children:[a.jsxs(qn,{className:"w-[90vw] sm:max-w-[780px] max-h-[80vh] sm:max-h-[85vh] flex flex-col",onKeyDown:xe=>{xe.key==="F5"&&(xe.preventDefault(),ct(xe)),xe.key==="Escape"&&(xe.preventDefault(),t(!1))},children:[a.jsx(Bn,{children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{children:[a.jsx($n,{className:"text-lg sm:text-xl",children:r?"Detalhes do Produto":"Novo Produto"}),a.jsx(la,{className:"text-xs sm:text-sm",children:"Preencha as informaes e use as abas para navegar."})]})})}),a.jsx("form",{onSubmit:ct,className:"grid gap-4 py-2 flex-1 overflow-y-auto pr-1 fx-scroll",children:a.jsxs(Sd,{value:f,onValueChange:h,className:"w-full",children:[a.jsx("div",{className:"sm:hidden mb-4",children:a.jsxs(ea,{value:f,onValueChange:h,children:[a.jsx(Jn,{className:"w-full",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"dados",children:"Dados"}),a.jsx(Qe,{value:"estoque",children:"Estoque"}),a.jsx(Qe,{value:"preco",children:"Preo e Lucro"}),a.jsx(Qe,{value:"impostos",children:"Impostos"}),a.jsx(Qe,{value:"outras",children:"Outras Info"})]})]})}),a.jsxs(jc,{className:"hidden sm:grid grid-cols-5 gap-1",children:[a.jsx(Ga,{value:"dados",children:"Dados"}),a.jsx(Ga,{value:"estoque",children:"Estoque"}),a.jsx(Ga,{value:"preco",children:"Preo e Lucro"}),a.jsx(Ga,{value:"impostos",children:"Impostos"}),a.jsx(Ga,{value:"outras",children:"Outras Info"})]}),a.jsx("div",{className:"mt-2 text-[10px] sm:text-[11px] text-text-muted",children:"* Campo obrigatrio"}),a.jsxs(vo,{value:"dados",className:"space-y-3 mt-2",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{htmlFor:"code",className:"text-left sm:text-right text-xs sm:text-sm",children:["Cdigo ",a.jsx("span",{className:"text-text-muted text-[10px] sm:text-xs",children:"(auto)"})]}),a.jsx(At,{id:"code",value:m,onChange:xe=>x(xe.target.value.replace(/\D/g,"")),className:"col-span-1 sm:col-span-3 text-sm",placeholder:i||"Ex.: 0001",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{htmlFor:"name",className:"text-left sm:text-right text-xs sm:text-sm",children:["Descrio ",!g?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(At,{id:"name",value:g,onChange:xe=>v(xe.target.value),className:"col-span-1 sm:col-span-3 text-sm",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"category",className:"text-left sm:text-right text-xs sm:text-sm",children:"Categoria"}),a.jsxs("div",{className:"col-span-3 flex gap-2 items-center",children:[a.jsxs(ea,{value:y,onValueChange:xe=>xr&&b(xe),children:[a.jsx(Jn,{className:"w-full",disabled:!xr,children:a.jsx(ra,{placeholder:"Selecione..."})}),a.jsx(Qn,{children:s.map(xe=>a.jsx(Qe,{value:xe,children:xe},xe))})]}),a.jsxs(Z,{type:"button",onClick:()=>ut(xe=>!xe),className:"bg-amber-500 hover:bg-amber-400 text-black inline-flex items-center gap-2 whitespace-nowrap px-3",title:tt?"Fechar":"Adicionar nova categoria",disabled:!xr,children:[a.jsx("span",{className:"font-bold",children:"+"}),a.jsx("span",{children:"Novo"})]})]})]}),tt&&a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx("div",{className:"col-span-1"}),a.jsxs("div",{className:"col-span-3 flex gap-2",children:[a.jsx(At,{value:sr,onChange:xe=>Sr(xe.target.value),placeholder:"Nome da nova categoria"}),a.jsx(Z,{type:"button",onClick:async()=>{const xe=sr.trim();if(xe)try{if(s.includes(xe)){d({title:"Categoria j existe",description:"Escolha outro nome.",variant:"destructive"});return}await o?.(xe),b(xe),Sr(""),ut(!1),d({title:"Categoria adicionada",description:"Ela j est selecionada no formulrio.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch($e){console.error("[Produto] add category inline:error",$e);const Pe=xd($e,{action:"save"});d({title:Pe.title,description:Pe.description,variant:"destructive"})}},children:"Adicionar"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{htmlFor:"unit",className:"text-left sm:text-right text-xs sm:text-sm",children:["Unidade ",!_?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsxs(ea,{value:_,onValueChange:xe=>xr&&C(xe),children:[a.jsx(Jn,{className:"col-span-1 sm:col-span-3 text-sm",disabled:!xr,children:a.jsx(ra,{placeholder:"Selecione a unidade"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"UN",children:"UN - Unidade"}),a.jsx(Qe,{value:"CX",children:"CX - Caixa"}),a.jsx(Qe,{value:"PC",children:"PC - Pea"}),a.jsx(Qe,{value:"KG",children:"KG - Quilograma"}),a.jsx(Qe,{value:"G",children:"G - Grama"}),a.jsx(Qe,{value:"L",children:"L - Litro"}),a.jsx(Qe,{value:"ML",children:"ML - Mililitro"}),a.jsx(Qe,{value:"M",children:"M - Metro"}),a.jsx(Qe,{value:"M2",children:"M - Metro Quadrado"}),a.jsx(Qe,{value:"M3",children:"M - Metro Cbico"}),a.jsx(Qe,{value:"PAR",children:"PAR - Par"}),a.jsx(Qe,{value:"DZ",children:"DZ - Dzia"}),a.jsx(Qe,{value:"FD",children:"FD - Fardo"}),a.jsx(Qe,{value:"SC",children:"SC - Saco"}),a.jsx(Qe,{value:"PT",children:"PT - Pacote"}),a.jsx(Qe,{value:"SERV",children:"SERV - Servio"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{className:"text-left sm:text-right text-xs sm:text-sm",children:["Tipo ",!w&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsxs(ea,{value:w,onValueChange:xe=>xr&&j(xe),children:[a.jsx(Jn,{className:"col-span-1 sm:col-span-3 text-sm",disabled:!xr,children:a.jsx(ra,{placeholder:"Selecione o tipo"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"Venda",children:"Produto para Venda"}),a.jsx(Qe,{value:"Uso Interno",children:"Produto de Uso Interno"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-left sm:text-right text-xs sm:text-sm",children:"Ativo"}),a.jsx("div",{className:"col-span-1 sm:col-span-3",children:r?a.jsxs(a.Fragment,{children:[a.jsx(Ks,{checked:A,onCheckedChange:xe=>{console.log("[ProdutosPage] Checkbox active mudou para:",xe),S(!!xe)},disabled:!xr}),a.jsx("span",{className:"ml-2 text-xs sm:text-sm",children:"Ativo"})]}):a.jsxs(ea,{value:A?"ativo":"inativo",onValueChange:xe=>{console.log("[ProdutosPage] Select active mudou para:",xe),S(xe==="ativo")},children:[a.jsx(Jn,{className:"w-full sm:w-48 text-sm",disabled:!xr,children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"ativo",children:"Ativo"}),a.jsx(Qe,{value:"inativo",children:"Inativo"})]})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"barcode",className:"text-left sm:text-right text-xs sm:text-sm",children:"EAN-13"}),a.jsx(At,{id:"barcode",value:P,onChange:xe=>M(In(xe.target.value)),className:"col-span-1 sm:col-span-3 text-sm",placeholder:"789...",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{htmlFor:"validade",className:"text-left sm:text-right text-xs sm:text-sm",children:["Validade ",a.jsx("span",{className:"text-text-muted text-[10px] sm:text-xs",children:"(Opcional)"})]}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:Er("col-span-1 sm:col-span-3 justify-start text-left font-normal text-xs sm:text-sm",!wt&&"text-muted-foreground"),disabled:!xr,children:[a.jsx(P_,{className:"mr-2 h-3 w-3 sm:h-4 sm:w-4"}),wt?or(wt,"dd/MM/yyyy"):a.jsx("span",{children:"Selecione a data"})]})}),a.jsx(Ho,{className:"p-0 w-[280px] sm:w-[300px]",children:a.jsx("div",{className:"w-[280px] sm:w-[300px] min-h-[300px] sm:min-h-[332px]",children:a.jsx(ei,{mode:"single",selected:wt,onSelect:Rt,initialFocus:!0,fixedWeeks:!0})})})]})]})]}),a.jsx(vo,{value:"estoque",className:"space-y-3 mt-2",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"grid grid-cols-2 items-center gap-2",children:[a.jsx(lt,{htmlFor:"stock",className:"text-right",children:"Estoque"}),a.jsx(At,{id:"stock",value:yr,onChange:xe=>ve(xe.target.value.replace(/[^0-9]/g,"")),disabled:!xr,className:"col-span-1",inputMode:"numeric"})]}),a.jsxs("div",{className:"grid grid-cols-2 items-center gap-4",children:[a.jsx(lt,{htmlFor:"minStock",className:"text-right",children:"Estoque Mn."}),a.jsx(At,{id:"minStock",value:at,onChange:xe=>qt(xe.target.value.replace(/[^0-9]/g,"")),disabled:!xr,inputMode:"numeric"})]})]})}),a.jsxs(vo,{value:"preco",className:"space-y-3 mt-2",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"costPrice",className:"text-xs sm:text-right",children:"Preo de Custo (R$)"}),a.jsx(At,{id:"costPrice",inputMode:"numeric",placeholder:"Ex.: 10,00",value:`R$ ${_t||"0,00"}`,onChange:xe=>{gr(mr(xe.target.value))},disabled:!xr,className:"sm:col-span-3 text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{htmlFor:"salePrice",className:"text-xs sm:text-right",children:["Preo de Venda (R$) ",(!be||ot(be)<=0)&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(At,{id:"salePrice",inputMode:"numeric",placeholder:"Ex.: 15,00",value:`R$ ${be||"0,00"}`,onChange:xe=>{Ke.current="salePrice",Nt(mr(xe.target.value))},disabled:!xr,className:"sm:col-span-3 text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"marginPercent",className:"text-xs sm:text-right",children:"% de Lucro (Margem)"}),a.jsx(At,{id:"marginPercent",type:"text",placeholder:"Ex.: 40",value:Wt?`% ${Wt}`:"",onChange:xe=>{Ke.current="marginPercent";const $e=xe.target.value.replace(/[^\d,]/g,"");_r($e)},onBlur:()=>{if(Ke.current==="marginPercent"){const xe=ot(_t),$e=ir(Wt);if(xe>0&&$e>0)if($e>=100){const Pe=xe*(1+$e/100);Nt(Pe.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}else{const Pe=xe/(1-$e/100);Nt(Pe.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}}},disabled:!xr,className:"sm:col-span-3 text-xs sm:text-sm"})]})]}),a.jsxs(vo,{value:"impostos",className:"space-y-4 mt-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ks,{id:"useCsosn",checked:qr,onCheckedChange:xe=>Tr(!!xe),disabled:!xr}),a.jsx(lt,{htmlFor:"useCsosn",className:"cursor-pointer text-xs sm:text-sm",children:"Usar CSOSN (Simples Nacional)"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"ICMS - Operao Interna"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{className:"text-xs sm:text-right",children:["CFOP ",!sn?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(At,{value:sn,onChange:xe=>Cn(ln(xe.target.value)),className:Er("sm:col-span-3 text-xs sm:text-sm",!sn?.trim()&&"border-danger focus-visible:ring-danger/60"),placeholder:"5102",disabled:!xr})]}),!qr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CST"}),a.jsx(At,{value:ze,onChange:xe=>Fe(xe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"00, 20, 40...",disabled:!xr})]}),qr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CSOSN"}),a.jsx(At,{value:Le,onChange:xe=>Ze(xe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"101, 102...",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"Alquota ICMS (%)"}),a.jsx(At,{value:`${Ot||""}`,onChange:xe=>mt(ar(xe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!xr})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"ICMS - Operao Externa"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{className:"text-xs sm:text-right",children:["CFOP ",!Qt?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(At,{value:Qt,onChange:xe=>bt(ln(xe.target.value)),className:Er("sm:col-span-3 text-xs sm:text-sm",!Qt?.trim()&&"border-danger focus-visible:ring-danger/60"),placeholder:"6102",disabled:!xr})]}),!qr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CST"}),a.jsx(At,{value:zt,onChange:xe=>ne(xe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"00, 20, 40...",disabled:!xr})]}),qr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CSOSN"}),a.jsx(At,{value:He,onChange:xe=>Gt(xe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"101, 102...",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"Alquota ICMS (%)"}),a.jsx(At,{value:`${Ht||""}`,onChange:xe=>Fr(ar(xe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!xr})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"PIS/COFINS"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CST PIS Entrada"}),a.jsx(At,{value:cr,onChange:xe=>nn(xe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"50, 70...",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CST PIS Sada"}),a.jsx(At,{value:Tn,onChange:xe=>Gn(xe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"01, 04...",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"Alquota PIS (%)"}),a.jsx(At,{value:`${ta||""}`,onChange:xe=>Aa(ar(xe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,65",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"Alquota COFINS (%)"}),a.jsx(At,{value:`${ke||""}`,onChange:xe=>Ae(ar(xe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"3,00",disabled:!xr})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"IPI"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CST IPI"}),a.jsx(At,{value:et,onChange:xe=>br(xe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"50, 99...",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"Alquota IPI (%)"}),a.jsx(At,{value:`${Zt||""}`,onChange:xe=>Pn(ar(xe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!xr})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"FCP (%)"}),a.jsx(At,{value:`${Ct||""}`,onChange:xe=>lr(ar(xe.target.value)),placeholder:"2,00",disabled:!xr,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"MVA (%)"}),a.jsx(At,{value:`${Ye||""}`,onChange:xe=>Tt(ar(xe.target.value)),placeholder:"40,00",disabled:!xr,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"Base Reduzida (%)"}),a.jsx(At,{value:`${Xt||""}`,onChange:xe=>Br(ar(xe.target.value)),placeholder:"0,00",disabled:!xr,className:"text-xs sm:text-sm"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(lt,{className:"text-xs sm:text-right",children:["NCM ",!Wn?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(At,{value:Wn,onChange:xe=>xn(Kr(xe.target.value)),placeholder:"00000000",disabled:!xr,className:Er("text-xs sm:text-sm",!Wn?.trim()&&"border-danger focus-visible:ring-danger/60")})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"CEST"}),a.jsx(At,{value:sa,onChange:xe=>wa(oe(xe.target.value)),placeholder:"0000000",disabled:!xr,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4 sm:col-span-2",children:[a.jsx(lt,{className:"text-xs sm:text-right",children:"Descrio NCM"}),a.jsx(At,{value:on,onChange:xe=>ua(xe.target.value),placeholder:"Descrio do NCM",disabled:!xr,className:"text-sm"})]})]})]}),a.jsxs(vo,{value:"outras",className:"space-y-3 mt-2",children:[r&&a.jsxs("div",{className:"pb-4 mb-4 border-b border-border",children:[a.jsx(Z,{type:"button",onClick:()=>J(!0),disabled:!xr,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:"Desmembrar e Unir Produto"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Divida o preo por quantidade e opcionalmente una com outro produto"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"barcode2",className:"text-xs sm:text-right",children:"Cdigo de Barras"}),a.jsx(At,{id:"barcode2",value:P,onChange:xe=>M(In(xe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"EAN-13",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"barcodeBox",className:"text-xs sm:text-right",children:"Cdigo Barras (Caixa)"}),a.jsx(At,{id:"barcodeBox",value:O,onChange:xe=>I(In(xe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"EAN-13 da caixa",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"reference",className:"text-xs sm:text-right",children:"Referncia"}),a.jsx(At,{id:"reference",value:T,onChange:xe=>k(xe.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: REF-123",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"brand",className:"text-xs sm:text-right",children:"Marca"}),a.jsx(At,{id:"brand",value:$,onChange:xe=>q(xe.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: Nike",disabled:!xr})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(lt,{htmlFor:"group",className:"text-xs sm:text-right",children:"Grupo"}),a.jsx(At,{id:"group",value:z,onChange:xe=>F(xe.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: Calados",disabled:!xr})]})]}),!1]})}),a.jsxs(Ua,{children:[a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",children:"Cancelar"})}),a.jsx(Z,{type:"button",onClick:ct,disabled:Rr||!xr,title:"F5 para salvar",children:Rr?"Salvando...":"Salvar Produto"})]})]}),a.jsx(Bst,{open:Va,onOpenChange:J,product:r,currentPrice:be,allProducts:c,userProfile:u,onApply:async(xe,$e,Pe,Vt)=>{if(!Pe)Nt(xe),ve($e),J(!1),d({title:"Preo desmembrado!",description:`Preo unitrio: R$ ${ot(xe).toFixed(2)} | Estoque: ${$e}`,variant:"success"});else try{const yt=Number($e),tr=await e0({productId:Pe.id,delta:yt,codigoEmpresa:u?.codigo_empresa}),dr=Number(tr?.stock??Number(Pe.stock||0)+yt);if(Vt){const tn={...Pe,stock:dr,salePrice:ot(xe),price:ot(xe)};await z1(Pe.id,tn)}await yF(r.id),d({title:"Produto desmembrado e unido!",description:`${Pe.name}: novo estoque = ${dr} | preo unitrio = R$ ${ot(xe).toFixed(2)}`,variant:"success"}),J(!1),t(!1);try{typeof l=="function"&&l()}catch{}}catch(yt){console.error("[Desmembrar e Unir] Erro:",yt),d({title:"Erro ao processar",description:yt?.message||"Tente novamente",variant:"destructive"})}}})]})}function Bst({open:e,onOpenChange:t,product:r,currentPrice:n,allProducts:s,userProfile:o,onApply:i}){const[l,c]=p.useState(""),[d,u]=p.useState(""),[f,h]=p.useState(!1),[m,x]=p.useState(""),[g,v]=p.useState(null),[y,b]=p.useState(!1),w=S=>{const P=String(S||"").replace(/\D/g,"");return(P?Number(P)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},j=S=>{if(!S)return 0;const P=String(S).replace(/\./g,"").replace(",","."),M=Number(P);return Number.isFinite(M)?M:0};p.useEffect(()=>{e&&n&&(c(n),u(""),h(!1),x(""),v(null),b(!1))},[e,n]);const _=l&&d&&Number(d)>0?j(l)/Number(d):0,C=(s||[]).filter(S=>{if(!r||S.id===r.id)return!1;if(!m.trim())return!0;const P=m.toLowerCase();return(S.name||"").toLowerCase().includes(P)||(S.code||"").toLowerCase().includes(P)}).slice(0,10),A=g?Number(d||0)+Number(g.stock||0):0;return a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-[650px] max-h-[85vh] flex flex-col overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Desmembrar e Unir Produto"}),a.jsx(la,{children:"Divida o preo por quantidade e opcionalmente una com outro produto"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-sm font-semibold",children:"1. Desmembrar Preo"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{children:"Valor Total (R$)"}),a.jsx(At,{inputMode:"numeric",placeholder:"0,00",value:`R$ ${l||"0,00"}`,onChange:S=>c(w(S.target.value))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{children:"Quantidade de Unidades"}),a.jsx(At,{type:"text",inputMode:"numeric",placeholder:"0",value:d,onChange:S=>u(S.target.value.replace(/[^0-9]/g,""))})]}),_>0&&a.jsx("div",{className:"bg-muted/50 border border-border p-3 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Preo Unitrio:"}),a.jsxs("span",{className:"text-lg font-bold",children:["R$ ",_.toFixed(2)]})]})})]}),_>0&&a.jsxs("div",{className:"space-y-3 border-t pt-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{id:"wantToMerge",checked:f,onCheckedChange:S=>{h(!!S),S||(v(null),x(""),b(!1))}}),a.jsx(lt,{htmlFor:"wantToMerge",className:"cursor-pointer text-sm font-semibold",children:"2. Unir com outro produto (opcional)"})]}),f&&a.jsxs("div",{className:"space-y-3 ml-6",children:[a.jsx("div",{className:"bg-muted/30 border border-border p-3 rounded-lg",children:a.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.jsx("strong",{children:"Produto atual:"})," ",r?.name," (ser inativado aps unio)"]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{children:"Buscar Produto Destino"}),a.jsx(At,{placeholder:"Digite o nome ou cdigo...",value:m,onChange:S=>x(S.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(lt,{className:"text-xs",children:["Produtos Disponveis (",C.length,")"]}),a.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:C.length===0?a.jsx("p",{className:"text-xs text-muted-foreground p-2 text-center",children:"Nenhum produto encontrado"}):C.map(S=>a.jsx("div",{onClick:()=>v(S),className:Er("p-2 rounded-md cursor-pointer border transition-colors",g?.id===S.id?"bg-primary/10 border-primary":"bg-background hover:bg-muted/50 border-transparent"),children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium truncate",children:S.name}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[S.code&&`Cdigo: ${S.code}  `,"Estoque: ",S.stock||0,"  R$ ",Number(S.price||S.salePrice||0).toFixed(2)]})]}),g?.id===S.id&&a.jsx(Oi,{className:"w-4 h-4 text-primary flex-shrink-0"})]})},S.id))})]}),g&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"bg-primary/5 border border-primary/20 p-3 rounded-lg",children:[a.jsx("p",{className:"text-xs font-medium mb-1",children:"Resumo da Unio:"}),a.jsxs("div",{className:"text-xs space-y-0.5 text-muted-foreground",children:[a.jsxs("p",{children:[" Destino: ",a.jsx("strong",{children:g.name})]}),a.jsxs("p",{children:[" Estoque atual: ",g.stock||0]}),a.jsxs("p",{children:[" Estoque a somar: +",d]}),a.jsxs("p",{className:"text-primary font-bold",children:[" Novo estoque: ",A]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{id:"updatePrice",checked:y,onCheckedChange:S=>b(!!S)}),a.jsxs(lt,{htmlFor:"updatePrice",className:"cursor-pointer text-xs",children:["Atualizar preo do destino para R$ ",_.toFixed(2)]})]})]})]})]})]}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),a.jsx(Z,{onClick:()=>{if(_>0){const S=_.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});i(S,d,f?g:null,y)}},disabled:_<=0||f&&!g,children:f&&g?"Desmembrar e Unir":"Aplicar Desmembramento"})]})]})})}function qst({open:e,onOpenChange:t,categories:r,onAddCategory:n,onRemoveCategory:s}){const{toast:o}=Xs(),[i,l]=p.useState(""),[c,d]=p.useState(!1),u=async()=>{const h=i.trim();if(h){if(r.includes(h)){o({title:"Categoria j existe",description:"Escolha outro nome.",variant:"destructive"});return}try{d(!0),await n(h),l(""),o({title:"Categoria adicionada",description:"Ela j aparece na lista.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(m){console.error("[Categorias] add:error",m);const x=xd(m,{action:"save"});o({title:x.title,description:x.description,variant:"destructive"})}finally{d(!1)}}},f=async h=>{try{d(!0),await s(h),o({title:"Categoria desativada",description:"A categoria foi marcada como inativa.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(m){console.error("[Categorias] remove:error",m);const x=xd(m,{action:"save"});o({title:x.title,description:x.description,variant:"destructive"})}finally{d(!1)}};return a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"w-[90vw] sm:max-w-[480px]",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Gerenciar Categorias"}),a.jsx(la,{children:"Adicione ou remova categorias de produtos."})]}),a.jsxs("div",{className:"py-4 space-y-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx(At,{value:i,onChange:h=>l(h.target.value),placeholder:"Nome da nova categoria"}),a.jsx(Z,{onClick:u,disabled:c,children:c?"Processando...":"Adicionar"})]}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map(h=>a.jsxs("div",{className:"flex items-center justify-between bg-surface-2 p-2 rounded-md",children:[a.jsx("span",{className:"font-semibold",children:h}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-danger/80 hover:text-danger",onClick:()=>f(h),disabled:c,children:a.jsx(Sc,{size:14})})]},h))})]})]})})}function zst(){const{toast:e}=Xs(),{userProfile:t,authReady:r}=fo();Mi();const[n,s]=p.useState(Mst),[o,i]=p.useState(Rst),[l,c]=p.useState([]),[d,u]=p.useState("");p.useState("list");const[f,h]=p.useState(!0),[m,x]=p.useState(null),[g,v]=p.useState(!1),[y,b]=p.useState(!1),[w,j]=p.useState("all"),[_,C]=p.useState(""),[A,S]=p.useState({type:"all",category:"all",status:"active",newOnly:!1}),[P,M]=p.useState(!1),[O,I]=p.useState(!1),[T,k]=p.useState(!1),[$,q]=p.useState(null),[z,F]=p.useState({by:"code",dir:"asc"}),V=p.useRef(!0),ue=p.useRef(0),_e=p.useRef(0);p.useRef(!1);const[U,L]=p.useState(!1),[G,de]=p.useState("paged"),X=G==="paged",[W,Y]=p.useState(1),[me]=p.useState(100),[ee,ae]=p.useState(0);p.useEffect(()=>(V.current=!0,()=>{V.current=!1}),[]),p.useEffect(()=>{try{const ne=localStorage.getItem(mV);if(!ne)return;const He=JSON.parse(ne);He&&typeof He=="object"&&((He.listMode==="paged"||He.listMode==="all")&&de(He.listMode),typeof He.showStats=="boolean"&&h(He.showStats))}catch{}},[]),p.useEffect(()=>{(async()=>{if(!t?.codigo_empresa||!t?.id&&!t?.user_id)return;const He=t.id||t.user_id,Gt=`produtos:${t.codigo_empresa}`,Ht=await ioe({userId:He,scope:Gt});Ht&&((Ht.listMode==="paged"||Ht.listMode==="all")&&de(Ht.listMode),typeof Ht.showStats=="boolean"&&h(Ht.showStats))})()},[t?.codigo_empresa,t?.id]),p.useEffect(()=>{try{const ne={listMode:G,showStats:f};localStorage.setItem(mV,JSON.stringify(ne))}catch{}if(t?.codigo_empresa&&(t?.id||t?.user_id)){const ne=t.id||t.user_id,He=`produtos:${t.codigo_empresa}`;loe({userId:ne,scope:He,settings:{listMode:G,showStats:f}})}},[G,f,t?.codigo_empresa,t?.id]);const le=async()=>{const ne=t?.codigo_empresa||null;if(!r||!ne)return;const He=`produtos:list:${ne}`;M(!0);const Gt=setTimeout(()=>{if(V.current)try{const Ht=JSON.parse(localStorage.getItem(He)||"[]");Array.isArray(Ht)&&Ht.length>0&&(console.warn("[Produtos] slow fallback: using cached snapshot"),s(Ht))}catch{}},2e3);try{const Ht=A.status==="all"||A.status==="inactive";let Fr=[];if(X){console.log("[Produtos] refetchProducts - modo paginado - Filtro status:",A.status,"includeInactive:",Ht,"page:",W,"pageSize:",me);const cr=await lst({includeInactive:Ht,search:_,codigoEmpresa:ne,page:W,pageSize:me});if(!V.current)return;Fr=cr?.data||[];const nn=cr?.count||0;console.log("[Produtos] refetchProducts - Produtos carregados (paginado):",Fr.length,"de",nn),s(Fr),ae(nn)}else{if(console.log("[Produtos] refetchProducts - modo TODOS - Filtro status:",A.status,"includeInactive:",Ht),Fr=await mf({includeInactive:Ht,search:_,codigoEmpresa:ne}),!V.current)return;console.log("[Produtos] refetchProducts - Produtos carregados (todos):",Fr.length),s(Fr),ae(Fr.length)}try{localStorage.setItem(He,JSON.stringify(Fr))}catch{}_e.current=Fr.length,ue.current=Date.now()}catch(Ht){console.error("[Produtos] refetchProducts:error",Ht);const Fr=xd(Ht,{action:"fetch"});e({title:Fr.title,description:Fr.description,variant:"destructive"})}finally{clearTimeout(Gt),M(!1)}};p.useEffect(()=>{const ne=(()=>{try{const cr=localStorage.getItem("auth:userProfile");return cr&&JSON.parse(cr)?.codigo_empresa||null}catch{return null}})(),He=t?.codigo_empresa||ne;if(!He)return;const Gt=`produtos:list:${He}`,Ht=(()=>{try{return JSON.parse(localStorage.getItem(Gt)||"[]")}catch{return[]}})();Array.isArray(Ht)&&Ht.length>0&&(s(Ht),_e.current=Ht.length);const Fr=async(cr=3)=>{for(let nn=0;nn<cr;nn++)try{if(V.current){await le();break}}catch(Tn){console.warn(`[ProdutosPage] Tentativa ${nn+1} falhou:`,Tn),nn===cr-1?console.error("[ProdutosPage] Todas as tentativas falharam"):await new Promise(Gn=>setTimeout(Gn,1e3*(nn+1)))}};try{const cr=JSON.parse(localStorage.getItem(`produtos:cats:${He}`)||"[]");Array.isArray(cr)&&cr.length>0&&i(cr)}catch{}if(r&&t?.codigo_empresa){const cr=setTimeout(()=>Fr(),100);return(async()=>{try{const nn=await fV({codigoEmpresa:t.codigo_empresa});if(!V.current)return;i(nn);try{localStorage.setItem(`produtos:cats:${t.codigo_empresa}`,JSON.stringify(nn))}catch{}}catch(nn){console.error("[Categorias] load on mount:error",nn)}})(),()=>clearTimeout(cr)}},[r,t?.codigo_empresa]),p.useEffect(()=>{const ne=()=>{(Date.now()-(ue.current||0)>3e4||_e.current===0)&&le()},He=()=>{document.visibilityState==="visible"&&(Date.now()-(ue.current||0)>3e4||_e.current===0)&&le()};return window.addEventListener("focus",ne),document.addEventListener("visibilitychange",He),()=>{window.removeEventListener("focus",ne),document.removeEventListener("visibilitychange",He)}},[r,t?.codigo_empresa]),p.useEffect(()=>{Y(1),r&&le()},[A.status,r]),p.useEffect(()=>{const ne=setTimeout(()=>{Y(1),r&&le()},300);return()=>clearTimeout(ne)},[_,r]),p.useEffect(()=>{Y(1),r&&le()},[G,r]);const[Te,te]=p.useState("N/A");p.useEffect(()=>{let ne=!0;return(async()=>{try{const He=await ist({limit:1,codigoEmpresa:t?.codigo_empresa});if(!ne)return;if(Array.isArray(He)&&He.length>0){const Gt=He[0];te(`${Gt.name} (${Gt.total})`)}else te("")}catch{ne&&te("N/A")}})(),()=>{ne=!1}},[t?.codigo_empresa]);const[ie,xt]=p.useState(!1),[vt,dt]=p.useState(()=>{const ne=new Date;return ne.setHours(0,0,0,0),ne}),[St,ft]=p.useState(!1),[_t,gr]=p.useState(()=>new Date),[be,Nt]=p.useState(!1),[Wt,_r]=p.useState([]),[yr,ve]=p.useState(!1),at=async()=>{try{Nt(!0);const ne=await ost({from:vt,to:_t,codigoEmpresa:t?.codigo_empresa});_r(ne||[])}catch(ne){e({title:"Falha ao carregar vendas do perodo",description:ne?.message||"Tente novamente",variant:"destructive"})}finally{Nt(!1)}},qt=p.useMemo(()=>{const ne=new Date;return{mostSold:Te,lowStock:n.filter(He=>He.status==="low_stock"||He.stock>0&&He.stock<=He.minStock).length,expired:n.filter(He=>He.validade&&He.validade<ne).length}},[n,Te]),$t=p.useMemo(()=>{const ne=new Date;return n.filter(He=>{const Gt=w==="all"?!0:w==="low_stock"?He.status==="low_stock"||He.stock>0&&He.stock<=He.minStock:w==="expired"?He.validade&&He.validade<ne:!1,Ht=A.status==="all"?!0:He.status===A.status,Fr=A.type==="all"||He.type===A.type,cr=A.category==="all"||He.category===A.category,nn=!A.newOnly||He.dataImportacao&&(()=>Math.floor((new Date-He.dataImportacao)/864e5)<=7)();return Gt&&Ht&&Fr&&cr&&nn})},[n,w,A]),De=ne=>ne?.dataImportacao?Math.floor((new Date-ne.dataImportacao)/(1e3*60*60*24))<=7:!1,wt=p.useMemo(()=>{const ne=[...$t],He=z.dir==="asc"?1:-1,Gt=(Fr,cr)=>Number.isFinite(Fr)?Fr:cr,Ht=Fr=>{if(!Fr)return NaN;if(Fr instanceof Date)return Fr.getTime();const cr=new Date(Fr);return Number.isNaN(cr.getTime())?NaN:cr.getTime()};return ne.sort((Fr,cr)=>{if(z.by==="code"){const nn=Gt(parseInt((Fr.code||"").trim(),10),1/0),Tn=Gt(parseInt((cr.code||"").trim(),10),1/0);return nn===Tn?0:nn>Tn?He:-He}if(z.by==="name"){const nn=(Fr.name||"").toString(),Tn=(cr.name||"").toString();return nn.localeCompare(Tn,"pt-BR",{sensitivity:"base"})*He}if(z.by==="validade"){const nn=Gt(Ht(Fr.validade),1/0),Tn=Gt(Ht(cr.validade),1/0);return nn===Tn?0:nn>Tn?He:-He}return 0}),ne},[$t,z]),Rt=p.useMemo(()=>{if(!me)return 1;const ne=Math.ceil((ee||0)/me);return ne>0?ne:1},[ee,me]),Rr=ne=>{F(He=>He.by===ne?{by:ne,dir:He.dir==="asc"?"desc":"asc"}:{by:ne,dir:"asc"})},Me=ne=>{j(He=>He===ne?"all":ne)},tt=()=>{dt(()=>{const ne=new Date;return ne.setHours(0,0,0,0),ne}),gr(new Date),xt(!0),setTimeout(at,0)},ut=(ne,He)=>{S(Gt=>({...Gt,[ne]:He}))},sr=async()=>{x(null);const ne=t?.codigo_empresa||null;let He="";if(ne)try{He=await uV({codigoEmpresa:ne})}catch(Gt){console.error("[Produtos] handleAddNew: falha ao obter prximo cdigo",Gt)}u(He||""),v(!0)},Sr=ne=>{x(ne),v(!0)},xr=()=>{try{Lst(wt),e({title:"Exportao concluda",description:`${wt.length} produto(s) exportado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(ne){console.error("[Produtos] export:error",ne);const He=xd(ne,{action:"export"});e({title:He.title,description:He.description,variant:"destructive"})}},Wr=ne=>{c(He=>He.includes(ne)?He.filter(Gt=>Gt!==ne):[...He,ne])},qr=()=>{const ne=wt.map(He=>He.id);ne.length&&c(ne)},Tr=()=>{c([])},sn=ne=>{ne?qr():Tr()},Cn=p.useMemo(()=>wt.filter(ne=>l.includes(ne.id)),[wt,l]),ze=p.useMemo(()=>Cn.some(De),[Cn]),Fe=async ne=>{if(l.length)try{await cst({ids:l,status:ne}),await le(),Tr(),e({title:ne==="inactive"?"Produtos inativados":"Produtos atualizados",description:`${l.length} produto(s) atualizado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(He){const Gt=xd(He,{action:"save"});e({title:Gt.title,description:Gt.description,variant:"destructive"})}},Le=async()=>{if(!(!l.length||!ze))try{await dst({ids:l}),await le(),Tr(),e({title:"Novos removidos",description:"A etiqueta de novo foi removida dos produtos selecionados.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(ne){const He=xd(ne,{action:"save"});e({title:He.title,description:He.description,variant:"destructive"})}},Ze=async()=>{const ne=t?.codigo_empresa||null;if(!(!r||!ne))try{const He=await fV({codigoEmpresa:ne});if(!V.current)return;i(He);try{localStorage.setItem(`produtos:cats:${ne}`,JSON.stringify(He))}catch{}}catch(He){console.error("[Categorias] load on mount:error",He)}},Ot=async ne=>{i(He=>{if(He.includes(ne))return He;const Gt=[...He,ne];return Gt.sort((Ht,Fr)=>Ht.localeCompare(Fr,"pt-BR")),Gt});try{await ust(ne,{codigoEmpresa:t?.codigo_empresa}),await Ze()}catch(He){i(Ht=>Ht.filter(Fr=>Fr!==ne)),console.error("[Categorias] add:error",He);const Gt=xd(He,{action:"save"});e({title:Gt.title,description:Gt.description,variant:"destructive"})}},mt=async ne=>{if(n.some(Ht=>Ht.category===ne&&Ht.status!=="inactive"))throw new Error("Categoria possui produtos ativos vinculados");const Gt=o;i(Ht=>Ht.filter(Fr=>Fr!==ne));try{await fst(ne,{codigoEmpresa:t?.codigo_empresa}),await Ze()}catch(Ht){i(Gt),console.error("[Categorias] remove:error",Ht);const Fr=xd(Ht,{action:"save"});e({title:Fr.title,description:Fr.description,variant:"destructive"})}},Qt=async ne=>{try{if(console.log("[Produtos] handleSaveProduct",ne),!ne||typeof ne!="object"){console.warn("[Produtos] handleSaveProduct chamado sem payload vlido. Ignorando.");return}const He=t?.codigo_empresa||null;if(!ne.code&&He)try{const Ht=await uV({codigoEmpresa:He});ne.code=Ht}catch(Ht){console.error("[Produtos] Falha ao obter prximo cdigo automtico",Ht)}const Gt=async Ht=>{const cr=new Promise((nn,Tn)=>setTimeout(()=>Tn(new Error("Timeout update/create (12s)")),12e3));return Promise.race([Ht,cr])};if(ne.id){const Ht=await Gt(z1(ne.id,ne,{codigoEmpresa:He}));console.log("[Produtos] Produto atualizado - active:",Ht.active,"status:",Ht.status),s(Fr=>Fr.map(cr=>cr.id===Ht.id?Ht:cr)),await le(),console.log("[Produtos] Refetch concludo aps update")}else{ne.dataImportacao||(ne.dataImportacao=new Date);const Ht=await Gt(pC(ne,{codigoEmpresa:He}));console.log("[Produtos] Produto criado",Ht),s(Fr=>[Ht,...Fr]),setTimeout(()=>{le().catch(Fr=>console.error("[Produtos] refetch ps-create falhou",Fr))},0)}}catch(He){console.error("[Produtos] Erro no handleSaveProduct",He);const Gt=xd(He,{action:"save"});throw e({title:Gt.title,description:Gt.description,variant:"destructive"}),He}},bt=ne=>{q(ne),I(!0)},zt=async()=>{if($?.id)try{k(!0),await yF($.id),s(He=>He.filter(Gt=>Gt.id!==$.id)),await le();const ne=xd(null,{action:"delete"});e({variant:"success",title:ne.title,description:`Produto "${$.name}" foi inativado com sucesso.`})}catch(ne){const He=xd(ne,{action:"delete"});e({variant:"destructive",...He})}finally{k(!1),I(!1),q(null)}};return a.jsxs(a.Fragment,{children:[a.jsxs(Mr.div,{variants:Fst,initial:"hidden",animate:"visible",className:"flex flex-col",children:[a.jsxs(Mr.div,{variants:$3,className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-black text-text-primary tracking-tighter",children:"Controle de Produtos"}),a.jsx("p",{className:"text-text-secondary hidden md:block",children:"Controle total sobre seu inventrio e estoque."})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full hidden md:flex items-center justify-center",onClick:()=>L(!0),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(Xc,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"hidden md:flex items-center gap-2 flex-wrap",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:()=>h(ne=>!ne),title:f?"Ocultar resumo":"Mostrar resumo","aria-label":f?"Ocultar resumo":"Mostrar resumo",children:f?a.jsx(Og,{className:"h-4 w-4"}):a.jsx(Jg,{className:"h-4 w-4"})}),a.jsxs(Z,{variant:"outline",onClick:xr,children:[a.jsx(ys,{className:"mr-2 h-4 w-4"})," Exportar"]}),a.jsxs(Z,{variant:"secondary",onClick:()=>ft(!0),children:[a.jsx(ol,{className:"mr-2 h-4 w-4"})," Importar XML"]}),a.jsxs(Z,{onClick:sr,children:[a.jsx(to,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]}),a.jsxs("div",{className:"mt-2 flex md:hidden items-center gap-2",children:[a.jsxs(Z,{variant:"outline",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:xr,title:"Exportar CSV","aria-label":"Exportar CSV",children:[a.jsx(ys,{className:"h-4 w-4"}),a.jsx("span",{children:"CSV"})]}),a.jsxs(Z,{variant:"secondary",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:()=>ft(!0),title:"Importar XML","aria-label":"Importar XML",children:[a.jsx(ol,{className:"h-4 w-4"}),a.jsx("span",{children:"XML"})]}),a.jsxs(Z,{className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:sr,title:"Novo Produto","aria-label":"Novo Produto",children:[a.jsx(to,{className:"h-4 w-4"}),a.jsx("span",{children:"Prod"})]}),a.jsxs(Z,{variant:"outline",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:()=>b(!0),title:"Gerenciar categorias","aria-label":"Gerenciar categorias",children:[a.jsx(u2,{className:"h-4 w-4"}),a.jsx("span",{children:"Cat."})]}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-xl flex items-center justify-center ml-auto",onClick:()=>L(!0),title:"Configuraes da aba","aria-label":"Configuraes da aba",children:a.jsx(Xc,{className:"h-4 w-4"})}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-xl flex items-center justify-center ml-auto",onClick:()=>h(ne=>!ne),title:f?"Ocultar resumo":"Mostrar resumo","aria-label":f?"Ocultar resumo":"Mostrar resumo",children:f?a.jsx(Og,{className:"h-5 w-5"}):a.jsx(Jg,{className:"h-5 w-5"})})]})]}),f&&a.jsxs("div",{className:"grid grid-cols-3 gap-3 md:gap-6 mb-6",children:[a.jsx(Tk,{icon:Nd,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Mais Vendido (Dia)"}),a.jsx("span",{className:"md:hidden",children:"+ vendidos"})]}),value:qt.mostSold,subtitle:"Produto com mais sadas hoje",color:"text-brand",onClick:tt}),a.jsx(Tk,{icon:Jf,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Estoque Baixo"}),a.jsx("span",{className:"md:hidden",children:"Est. baixo"})]}),value:qt.lowStock,subtitle:"Produtos precisando de reposio",color:"text-warning",onClick:()=>Me("low_stock"),isActive:w==="low_stock"}),a.jsx(Tk,{icon:P_,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Vendidos"}),a.jsx("span",{className:"md:hidden",children:"Vencidos"})]}),value:qt.expired,subtitle:"Produtos fora da data de validade",color:"text-danger",onClick:()=>Me("expired"),isActive:w==="expired"})]}),a.jsx(zn,{open:ie,onOpenChange:xt,children:a.jsxs(qn,{className:"max-w-2xl",onKeyDown:ne=>ne.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold",children:"Vendas por Perodo"}),a.jsx(la,{children:"Selecione o intervalo de datas e visualize os produtos vendidos."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Incio"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start",children:[a.jsx(P_,{className:"mr-2 h-4 w-4"}),vt?or(vt,"dd/MM/yyyy"):"Incio"]})}),a.jsx(Ho,{className:"p-0 w-[300px]",children:a.jsx("div",{className:"w-[300px] min-h-[332px]",children:a.jsx(ei,{mode:"single",selected:vt,onSelect:ne=>ne&&dt(ne),initialFocus:!0,fixedWeeks:!0})})})]})]}),a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Fim"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start",children:[a.jsx(P_,{className:"mr-2 h-4 w-4"}),_t?or(_t,"dd/MM/yyyy"):"Fim"]})}),a.jsx(Ho,{className:"p-0 w-[300px]",children:a.jsx("div",{className:"w-[300px] min-h-[332px]",children:a.jsx(ei,{mode:"single",selected:_t,onSelect:ne=>ne&&gr(ne),initialFocus:!0,fixedWeeks:!0})})})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{type:"button",onClick:at,disabled:be,className:"w-full",children:be?"Carregando...":"Aplicar"}),a.jsx(Z,{type:"button",variant:"secondary",onClick:()=>{try{const ne=Wt||[],He=";",Gt=()=>{const nn=["Produto;Quantidade"];for(const Tn of ne)nn.push(`${(Tn.name||"").replace(/;/g,",")}${He}${Number(Tn.total||0)}`);return nn.join(`
`)},Ht=new Blob(["\uFEFF"+Gt()],{type:"text/csv;charset=utf-8;"}),Fr=URL.createObjectURL(Ht),cr=document.createElement("a");cr.href=Fr,cr.download="vendas-periodo.csv",document.body.appendChild(cr),cr.click(),document.body.removeChild(cr),URL.revokeObjectURL(Fr),e({title:"Exportao concluda",description:`${ne.length} linha(s)`,variant:"success"})}catch(ne){e({title:"Falha ao exportar",description:ne?.message||"Tente novamente",variant:"destructive"})}},children:"Exportar CSV"})]})]}),a.jsx("div",{className:"mt-3 border rounded-md max-h-[50vh] overflow-auto thin-scroll",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-surface-2",children:[a.jsx("th",{className:"text-left p-2",children:"Produto"}),a.jsx("th",{className:"text-right p-2",children:"Quantidade"})]})}),a.jsxs("tbody",{children:[(Wt||[]).length===0&&!be&&a.jsx("tr",{children:a.jsx("td",{colSpan:2,className:"p-3 text-text-muted",children:"Nenhum item no perodo."})}),(Wt||[]).map(ne=>a.jsxs("tr",{className:"border-t border-border",children:[a.jsx("td",{className:"p-2",children:ne.name}),a.jsx("td",{className:"p-2 text-right font-mono",children:Number(ne.total||0)})]},ne.id))]})]})}),a.jsx(Ua,{children:a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",children:"Fechar"})})})]})}),a.jsx(zn,{open:U,onOpenChange:L,children:a.jsxs(qn,{className:"max-w-2xl",children:[a.jsx(Bn,{children:a.jsx($n,{children:"Configuraes da aba"})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[11px] font-medium text-text-muted",children:"Modo de listagem"}),a.jsxs(ea,{value:G,onValueChange:de,children:[a.jsx(Jn,{className:"w-[200px] h-8 text-xs",children:a.jsx(ra,{placeholder:"Paginado"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"paged",children:"Paginado (100 por pgina)"}),a.jsx(Qe,{value:"all",children:"Todos (sem paginao)"})]})]})]}),a.jsx("div",{className:"flex items-center justify-between pt-1",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{id:"produtos-show-stats",checked:f,onCheckedChange:h}),a.jsx("label",{htmlFor:"produtos-show-stats",className:"text-xs font-medium text-text-primary",children:"Mostrar cards de resumo no topo"})]})})]}),a.jsx(Ua,{children:a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",children:"Fechar"})})})]})}),a.jsxs(Mr.div,{variants:$3,className:"bg-surface rounded-lg border border-border flex flex-col",children:[a.jsxs("div",{className:"p-3 pb-4 sm:p-4 border-b border-border space-y-3 flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar por nome ou cdigo...",className:"pl-9 text-sm",value:_,onChange:ne=>C(ne.target.value)})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex md:hidden items-center justify-center",onClick:()=>ve(!0),"aria-label":"Abrir filtros",title:"Filtros",children:a.jsx(wN,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"hidden md:flex w-full items-center gap-3",children:[a.jsx("div",{className:"flex-1 min-w-[120px]",children:a.jsxs(ea,{value:A.type,onValueChange:ne=>ut("type",ne),children:[a.jsx(Jn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Tipos"}),a.jsx(Qe,{value:"Venda",children:"Venda"}),a.jsx(Qe,{value:"Uso Interno",children:"Uso Interno"})]})]})}),a.jsx("div",{className:"flex-1 min-w-[140px]",children:a.jsxs(ea,{value:A.category,onValueChange:ne=>ut("category",ne),children:[a.jsx(Jn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Categorias"}),o.map(ne=>a.jsx(Qe,{value:ne,children:ne},ne))]})]})}),a.jsx("div",{className:"flex-1 max-w-[180px]",children:a.jsxs(ea,{value:A.status,onValueChange:ne=>ut("status",ne),children:[a.jsx(Jn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Status"}),a.jsx(Qe,{value:"active",children:"Ativo"}),a.jsx(Qe,{value:"low_stock",children:"Estoque Baixo"}),a.jsx(Qe,{value:"inactive",children:"Inativo"})]})]})}),a.jsxs("div",{className:"flex-1 flex justify-end gap-2 min-w-[160px]",children:[a.jsxs(Z,{variant:"outline",onClick:()=>ut("newOnly",!A.newOnly),className:Er("text-xs sm:text-sm rounded-full px-3 border border-border bg-surface-2 hover:bg-surface flex items-center gap-1 whitespace-nowrap",A.newOnly&&"bg-amber-500 text-black border-amber-500 hover:bg-amber-400"),size:"sm",children:[a.jsx("span",{className:"mr-1",children:""}),a.jsx("span",{children:"Novos"})]}),a.jsxs(Z,{variant:"outline",onClick:()=>b(!0),className:"text-xs sm:text-sm rounded-full px-3 border border-border bg-surface-2 hover:bg-surface flex items-center gap-1 whitespace-nowrap",size:"sm",children:[a.jsx(u2,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.jsx("span",{children:"Categorias"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex items-center justify-center",onClick:()=>L(ne=>!ne),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(Xc,{className:"h-4 w-4"})})]})]})]}),l.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"px-3 sm:px-4 py-2.5 border-b border-border flex md:hidden items-center gap-2 text-xs",children:[a.jsxs("span",{className:"font-medium mr-2",children:[l.length," sel."]}),a.jsxs("button",{type:"button",className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border bg-surface-2",onClick:()=>{const ne=wt.length>0&&wt.every(He=>l.includes(He.id));sn(!ne)},children:[a.jsx(Ks,{checked:wt.length>0&&wt.every(ne=>l.includes(ne.id)),className:"h-4 w-4"}),a.jsx("span",{children:"Todos"})]}),a.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>Fe("active"),children:a.jsx(Oi,{className:"h-4 w-4"})}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8 text-danger border-danger/60 hover:bg-danger/10",onClick:()=>Fe("inactive"),children:a.jsx(Sc,{className:"h-4 w-4"})}),ze&&a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8 border-amber-500/70 text-amber-700 hover:bg-amber-500/10",onClick:Le,children:a.jsx(u2,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"hidden md:flex px-4 py-2 border-b border-border items-center gap-3 text-xs",children:[a.jsx("span",{className:"font-medium text-text-secondary whitespace-nowrap",children:l.length===0?"Nenhum item selecionado":`${l.length} produto${l.length>1?"s":""} selecionado${l.length>1?"s":""}`}),a.jsxs("div",{className:"flex flex-1 flex-wrap items-center justify-end gap-2",children:[a.jsxs(Z,{variant:"outline",size:"xs",className:"h-7 px-3 rounded-full border border-border bg-surface-2 hover:bg-surface flex items-center gap-1",onClick:qr,children:[a.jsx(Oi,{className:"h-3 w-3"}),a.jsx("span",{children:"Marcar filtrados"})]}),a.jsxs(Z,{variant:"outline",size:"xs",className:"h-7 px-3 rounded-full border border-border bg-surface-2 hover:bg-surface flex items-center gap-1",onClick:Tr,children:[a.jsx(wN,{className:"h-3 w-3"}),a.jsx("span",{children:"Limpar seleo"})]}),a.jsxs(Z,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full border-emerald-500/70 text-emerald-300 bg-emerald-500/10 hover:bg-emerald-500/20 flex items-center gap-1",onClick:()=>Fe("active"),children:[a.jsx(Oi,{className:"h-3 w-3"}),a.jsx("span",{children:"Ativar itens"})]}),a.jsxs(Z,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full text-danger border-danger/60 hover:bg-danger/10 flex items-center gap-1",onClick:()=>Fe("inactive"),children:[a.jsx(Og,{className:"h-3 w-3"}),a.jsx("span",{children:"Desativar itens"})]}),ze&&a.jsxs(Z,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full border-amber-500/70 text-amber-500 hover:bg-amber-500/10 flex items-center gap-1",onClick:Le,children:[a.jsx(u2,{className:"h-3 w-3"}),a.jsx("span",{children:'Limpar tag "Novo"'})]})]})]})]}),a.jsx("div",{children:wt.length===0?a.jsxs("div",{className:"p-10 text-center text-text-secondary",children:[a.jsx("p",{className:"text-lg mb-3",children:"Nenhum produto cadastrado."}),a.jsxs(Z,{onClick:sr,children:[a.jsx(to,{className:"mr-2 h-4 w-4"}),"Cadastrar primeiro produto"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden p-3 space-y-3",children:wt.map(ne=>{const He=l.includes(ne.id);return a.jsxs("div",{className:Er("rounded-lg border bg-surface p-4 space-y-3 cursor-pointer",He?"border-brand/70 bg-brand/5":"border-border"),onClick:()=>Sr(ne),children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsx("button",{type:"button",className:"pt-1 pr-2 -ml-1 flex items-center justify-center w-9 h-9",onClick:Gt=>{Gt.stopPropagation(),Wr(ne.id)},children:a.jsx(Ks,{checked:He,className:"h-5 w-5 border-2"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-semibold text-base text-text-primary truncate",title:ne.name,children:ne.name}),ne.dataImportacao&&(()=>Math.floor((new Date-ne.dataImportacao)/864e5)<=7?a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand text-xs font-medium flex-shrink-0",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Novo"})]}):null)()]}),a.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:ne.category||"Sem categoria"})]}),a.jsx("span",{className:Er("inline-flex px-2 py-0.5 rounded-full text-xs border flex-shrink-0",ne.status==="active"&&"bg-emerald-50/5 border-emerald-500/30 text-emerald-400",ne.status==="low_stock"&&"bg-amber-50/5 border-amber-500/30 text-amber-400",ne.status==="inactive"&&"bg-surface-2 border-border text-text-muted"),children:ne.status==="active"?"Ativo":ne.status==="low_stock"?"Estoque Baixo":"Inativo"})]}),a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-text-muted",children:[ne.code&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Cd."}),a.jsx("span",{className:"font-mono text-text-primary text-xs",children:ne.code})]}),a.jsx("span",{className:"mx-1 text-text-muted",children:""}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"R$"}),a.jsx("span",{className:"font-semibold text-text-primary",children:ne.price.toFixed(2)})]}),a.jsx("span",{className:"mx-1 text-text-muted",children:""}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Est."}),a.jsx("span",{className:"font-medium text-text-primary",children:ne.stock})]}),ne.validade&&a.jsx("span",{className:"mx-1 text-text-muted",children:""}),ne.validade&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Val."}),a.jsx("span",{className:"text-text-primary",children:(()=>{const Gt=ne.validade instanceof Date?ne.validade:x8(String(ne.validade));return isNaN(Gt)?"-":or(Gt,"dd/MM/yy")})()})]}),a.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:Gt=>{Gt.stopPropagation(),Sr(ne)},className:"h-7 w-7",children:a.jsx(xc,{className:"h-3.5 w-3.5"})}),a.jsx(Z,{variant:"outline",size:"icon",onClick:Gt=>{Gt.stopPropagation(),bt(ne)},className:"h-7 w-7 text-danger hover:text-danger",children:a.jsx(Sc,{className:"h-3.5 w-3.5"})})]})]})]},ne.id)})}),a.jsx("div",{className:"hidden md:block rounded-lg border border-border overflow-hidden",children:a.jsxs("table",{className:"w-full text-sm bg-surface table-fixed",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{className:"border-b border-border",children:[a.jsx("th",{className:"p-3 w-10 text-center",children:a.jsx(Ks,{checked:wt.length>0&&wt.every(ne=>l.includes(ne.id)),onCheckedChange:ne=>sn(!!ne)})}),a.jsxs("th",{className:"p-3 text-left font-semibold select-none cursor-pointer whitespace-nowrap w-[110px]",onClick:()=>Rr("code"),children:["Cdigo ",z.by==="code"?z.dir==="asc"?"":"":""]}),a.jsxs("th",{className:"p-3 text-left font-semibold select-none cursor-pointer whitespace-nowrap w-[40%]",onClick:()=>Rr("name"),children:["Produto ",z.by==="name"?z.dir==="asc"?"":"":""]}),a.jsx("th",{className:"p-3 text-left font-semibold whitespace-nowrap w-[18%]",children:"Categoria"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[120px]",children:"Preo"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[110px]",children:"Estoque"}),a.jsxs("th",{className:"p-3 text-center font-semibold select-none cursor-pointer whitespace-nowrap w-[120px]",onClick:()=>Rr("validade"),children:["Validade ",z.by==="validade"?z.dir==="asc"?"":"":""]}),a.jsx("th",{className:"p-3 text-center font-semibold whitespace-nowrap w-[140px]",children:"Status"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[90px]",children:"Aes"})]})}),a.jsx("tbody",{className:"text-text-primary divide-y divide-border",children:wt.map(ne=>a.jsxs("tr",{className:"hover:bg-surface-2 transition-colors group cursor-pointer align-middle",children:[a.jsx("td",{className:"p-3 text-center align-middle",children:a.jsx(Ks,{checked:l.includes(ne.id),onCheckedChange:()=>Wr(ne.id)})}),a.jsx("td",{className:"p-3 font-mono text-sm text-text-secondary align-middle whitespace-nowrap",onClick:()=>Sr(ne),children:ne.code||"-"}),a.jsx("td",{className:"p-3 font-semibold align-middle text-text-primary whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>Sr(ne),title:ne.name,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"truncate",children:ne.name}),ne.dataImportacao&&(()=>Math.floor((new Date-ne.dataImportacao)/864e5)<=7?a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand text-xs font-medium flex-shrink-0",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Novo"})]}):null)()]})}),a.jsx("td",{className:"p-3 text-text-secondary align-middle whitespace-nowrap",onClick:()=>Sr(ne),children:ne.category}),a.jsxs("td",{className:"p-3 text-right font-mono tabular-nums align-middle whitespace-nowrap",onClick:()=>Sr(ne),children:["R$ ",ne.price.toFixed(2)]}),a.jsx("td",{className:"p-3 text-right font-mono tabular-nums align-middle whitespace-nowrap",onClick:()=>Sr(ne),children:ne.stock}),a.jsx("td",{className:"p-3 text-center font-mono tabular-nums whitespace-nowrap",onClick:()=>Sr(ne),children:(()=>{if(!ne.validade)return"-";const He=ne.validade instanceof Date?ne.validade:x8(String(ne.validade));return isNaN(He)?"-":or(He,"dd/MM/yy")})()}),a.jsx("td",{className:"p-3 text-center whitespace-nowrap",onClick:()=>Sr(ne),children:a.jsx("span",{className:Er("px-2 py-1 text-xs font-bold rounded-full",ne.status==="active"&&"bg-success/10 text-success",ne.status==="low_stock"&&"bg-warning/10 text-warning",ne.status==="inactive"&&"bg-danger/10 text-danger"),children:ne.status==="active"?"Ativo":ne.status==="low_stock"?"Estoque Baixo":"Inativo"})}),a.jsx("td",{className:"p-3 whitespace-nowrap",children:a.jsx("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-text-muted hover:text-danger",onClick:He=>{He.stopPropagation(),bt(ne)},children:a.jsx(Sc,{size:14})})})})]},ne.id))})]})})]})}),X&&a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-2 text-xs sm:text-sm text-text-muted px-3 sm:px-4 pb-3",children:[a.jsxs("span",{children:["Pgina ",W," de ",Rt," (",ee," produto(s))"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>Y(ne=>Math.max(1,ne-1)),disabled:W<=1,children:"Anterior"}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>Y(ne=>Math.min(Rt,ne+1)),disabled:W>=Rt,children:"Prxima"})]})]})]})]}),a.jsx($st,{open:g,onOpenChange:v,product:m,categories:o,onSave:Qt,onCreateCategory:Ot,suggestedCode:m?void 0:d,onRefreshProducts:le,products:n}),a.jsx(zn,{open:O,onOpenChange:I,children:a.jsxs(qn,{className:"sm:max-w-[480px]",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Excluir produto"}),a.jsxs(la,{children:["Tem certeza que deseja excluir o produto",$?` "${$.name}"`:"","? Esta ao no pode ser desfeita."]})]}),a.jsxs(Ua,{children:[a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",disabled:T,children:"Cancelar"})}),a.jsx(Z,{type:"button",variant:"destructive",onClick:zt,disabled:T,children:T?"Excluindo...":"Excluir"})]})]})}),a.jsx(Dst,{open:St,onOpenChange:ft,products:n,codigoEmpresa:t?.codigo_empresa,onSuccess:()=>{le(),ft(!1)}}),a.jsx(zn,{open:yr,onOpenChange:ve,children:a.jsxs(qn,{className:"w-[90vw] sm:max-w-[420px]",children:[a.jsx(Bn,{children:a.jsx($n,{className:"text-base",children:"Filtros de Produtos"})}),a.jsxs("div",{className:"space-y-3 py-2 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(lt,{className:"text-xs",children:"Tipo"}),a.jsxs(ea,{value:A.type,onValueChange:ne=>ut("type",ne),children:[a.jsx(Jn,{className:"text-xs",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todos"}),a.jsx(Qe,{value:"Venda",children:"Venda"}),a.jsx(Qe,{value:"Uso Interno",children:"Uso Interno"})]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(lt,{className:"text-xs",children:"Categoria"}),a.jsxs(ea,{value:A.category,onValueChange:ne=>ut("category",ne),children:[a.jsx(Jn,{className:"text-xs",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todas"}),o.map(ne=>a.jsx(Qe,{value:ne,children:ne},ne))]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(lt,{className:"text-xs",children:"Status"}),a.jsxs(ea,{value:A.status,onValueChange:ne=>ut("status",ne),children:[a.jsx(Jn,{className:"text-xs",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todos"}),a.jsx(Qe,{value:"active",children:"Ativo"}),a.jsx(Qe,{value:"low_stock",children:"Estoque Baixo"}),a.jsx(Qe,{value:"inactive",children:"Inativo"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[a.jsx(Ks,{id:"mobileNewOnly",checked:!!A.newOnly,onCheckedChange:ne=>ut("newOnly",!!ne)}),a.jsx(lt,{htmlFor:"mobileNewOnly",className:"text-xs flex items-center gap-1",children:a.jsx("span",{children:"Somente Novos"})})]})]}),a.jsxs(Ua,{className:"flex justify-between mt-2",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"text-xs",onClick:()=>{S({type:"all",category:"all",status:"active",newOnly:!1}),ve(!1)},children:"Limpar"}),a.jsx(Z,{type:"button",size:"sm",className:"text-xs",onClick:()=>ve(!1),children:"Aplicar"})]})]})}),a.jsx(qst,{open:y,onOpenChange:b,categories:o,onAddCategory:Ot,onRemoveCategory:mt})]})}function Ust({purchase:e,items:t,onClose:r,onEdit:n,onReprocess:s,onDownloadXML:o,onInactivate:i}){if(!e)return null;const l=t.reduce((d,u)=>d+Number(u.valor_total||0),0),c=d=>d?.data_importacao?zwe(new Date,new Date(d.data_importacao))<=7:!1;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-3 py-4 bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"relative w-[95vw] sm:w-full sm:max-w-4xl max-h-[85vh] bg-surface rounded-xl shadow-2xl border border-border overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"relative bg-surface border-b border-border p-4",children:[a.jsx("button",{onClick:r,className:"absolute top-3 right-3 p-1.5 hover:bg-surface-2 rounded-lg transition-colors",children:a.jsx(Yc,{className:"h-4 w-4 text-text-muted"})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4 pr-0 sm:pr-10",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 bg-brand/10 rounded-lg",children:a.jsx(ol,{className:"h-5 w-5 text-brand"})}),a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-bold text-text-primary mb-0.5",children:["NF-e ",e.numero_nfe,e.serie_nfe&&` / Srie ${e.serie_nfe}`]}),a.jsx("p",{className:"text-text-muted text-xs",children:e.natureza_operacao||"Nota Fiscal Eletrnica"})]})]}),a.jsxs("div",{className:"mt-3 sm:mt-0 sm:text-right",children:[a.jsx("p",{className:"text-text-muted text-xs mb-0.5",children:"Valor Total"}),a.jsxs("p",{className:"text-xl sm:text-2xl font-bold text-success whitespace-nowrap",children:["R$ ",Number(e.valor_total||0).toFixed(2)]})]})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-6",children:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-surface-2 rounded-lg border border-border p-4",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a.jsx(Tf,{className:"h-4 w-4 text-brand"})}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-0.5",children:"Fornecedor"}),a.jsx("p",{className:"font-semibold text-base text-text-primary leading-snug break-words",children:e.fornecedor?.nome||"No identificado"}),e.fornecedor?.cnpj&&a.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:["CNPJ: ",e.fornecedor.cnpj]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-5 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(ko,{className:"h-3.5 w-3.5 text-info"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Emisso"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.data_emissao?or(new Date(e.data_emissao),"dd/MM/yyyy",{locale:Da}):"No informada"})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(afe,{className:"h-3.5 w-3.5 text-warning"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Operao"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.tipo_operacao||"Entrada"})]}),e.forma_pagamento&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(Rh,{className:"h-3.5 w-3.5 text-success"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Pagamento"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.forma_pagamento})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-1",children:"Valor dos Produtos"}),a.jsxs("p",{className:"font-semibold text-text-primary",children:["R$ ",l.toFixed(2)]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-1",children:"Valor Total NF-e"}),a.jsxs("p",{className:"font-semibold text-brand",children:["R$ ",Number(e.valor_total||0).toFixed(2)]})]})]})]})}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-base font-semibold text-text-primary flex items-center gap-2 mb-3",children:[a.jsx(ju,{className:"h-4 w-4 text-brand"}),"Produtos da NF-e",a.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-brand/10 text-brand font-medium ml-2",children:t.length})]}),a.jsx("div",{className:"space-y-2",children:t.map((d,u)=>a.jsx("div",{className:"p-3 bg-surface-2 rounded-lg border border-border hover:border-brand/30 transition-colors",children:a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-brand/10 text-brand text-xs font-bold flex items-center justify-center mt-0.5",children:u+1}),a.jsxs("div",{className:"flex-1",children:[d.produto?.nome?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"font-medium text-base text-text-primary mb-0.5",children:["Produto atual: ",d.produto.nome]}),d.nome_produto_xml&&a.jsxs("p",{className:"text-xs text-text-muted mb-1",children:["XML original: ",a.jsx("span",{className:"font-medium text-text-primary",children:d.nome_produto_xml})]})]}):a.jsx("p",{className:"font-medium text-sm text-text-primary mb-1",children:d.nome_produto_xml}),a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-0.5 text-xs text-text-muted mb-1.5",children:[(d.produto?.codigo_produto||d.codigo_produto_xml)&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"Cd:"})," ",d.produto?.codigo_produto||d.codigo_produto_xml]}),d.ean_xml&&d.ean_xml!=="SEM GTIN"&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"EAN:"})," ",d.ean_xml]}),d.ncm_xml&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"NCM:"})," ",d.ncm_xml]}),d.unidade_xml&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"Un:"})," ",d.unidade_xml]}),d.produto&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-success/20 text-success font-medium",children:" Cadastrado"}),d.produto&&c(d.produto)&&a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand font-medium",children:[a.jsx(UI,{className:"h-3 w-3"}),"Novo"]}),d.vinculado_manualmente&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-warning/20 text-warning font-medium",children:" Vinculado"}),!d.produto&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-text-muted/20 text-text-muted font-medium",children:" No importado"})]})]})]})}),a.jsxs("div",{className:"flex-shrink-0 text-right",children:[a.jsxs("div",{className:"mb-1.5",children:[a.jsx("span",{className:"text-xs text-text-muted mr-1",children:"Qtd:"}),a.jsx("span",{className:"font-bold text-base text-warning",children:d.quantidade})]}),a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit: ",a.jsxs("span",{className:"font-semibold text-success",children:["R$ ",Number(d.valor_unitario||0).toFixed(2)]})]}),a.jsxs("p",{className:"text-sm font-bold text-text-primary",children:["Total: R$ ",Number(d.valor_total||0).toFixed(2)]})]})]})]})},u))})]}),e.chave_nfe&&a.jsxs("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("p",{className:"text-xs font-medium text-text-muted mb-1.5 flex items-center gap-1.5",children:[a.jsx(ol,{className:"h-3 w-3"}),"Chave de Acesso NF-e:"]}),a.jsx("p",{className:"font-mono text-xs text-text-primary break-all leading-relaxed select-all",children:e.chave_nfe})]})]})}),a.jsxs("div",{className:"p-3 sm:p-4 bg-surface-2 border-t border-border flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsx("div",{className:"flex flex-wrap gap-2",children:e.ativo&&a.jsxs(a.Fragment,{children:[a.jsxs(Z,{onClick:()=>n?.(e),size:"sm",variant:"outline",className:"gap-2",children:[a.jsx(xc,{className:"h-4 w-4"}),"Editar"]}),a.jsxs(Z,{onClick:()=>s?.(e),size:"sm",variant:"outline",className:"gap-2",disabled:!e.xml_completo,children:[a.jsx(Tg,{className:"h-4 w-4"}),"Reprocessar"]}),e.xml_completo&&a.jsx(a.Fragment,{children:a.jsxs(Z,{onClick:()=>o?.(e),size:"sm",variant:"outline",className:"gap-2",children:[a.jsx(ys,{className:"h-4 w-4"}),"XML"]})}),a.jsxs(Z,{onClick:()=>i?.(e),size:"sm",variant:"outline",className:"gap-2 text-destructive hover:text-destructive",children:[a.jsx(Sc,{className:"h-4 w-4"}),"Inativar"]})]})}),a.jsx(Z,{onClick:r,variant:"outline",className:"w-full sm:w-auto",children:"Fechar"})]})]})})}function Vst({open:e,onOpenChange:t,purchase:r,products:n,codigoEmpresa:s,onSuccess:o,autoFile:i}){const{toast:l}=Xs(),[c,d]=p.useState("upload"),[u,f]=p.useState(null),[h,m]=p.useState(null),[x,g]=p.useState([]),[v,y]=p.useState(!1),[b,w]=p.useState({created:0,updated:0,errors:0,details:[]}),[j,_]=p.useState({}),[C,A]=p.useState({}),[S,P]=p.useState({}),[M,O]=p.useState({isOpen:!1,productIndex:null,currentProduct:null}),[I,T]=p.useState({isOpen:!1}),k=()=>{const W=h?.nfe?.modelo||r?.modelo_nfe;return W==="55"?"NF-e":W==="65"?"NFC-e":"NF-e / NFC-e"},$=(W,Y,me)=>j[W]?.[Y]??me,q=(W,Y)=>!W||!Y?0:W*(1+Y/100),z=W=>{A(Y=>({...Y,[W]:!Y[W]}))},F=(W,Y,me)=>{console.log("[XMLReprocessModal] handleEditProduct chamado:",{index:W,field:Y,value:me}),_(ee=>{const ae={...ee,[W]:{...ee[W],[Y]:me}};return console.log("[XMLReprocessModal] Novo estado editedProducts:",ae),ae})},V=W=>{g(Y=>Y.map((me,ee)=>{if(ee===W){const ae=!me.selected;return P(le=>({...le,[W]:ae})),{...me,selected:ae}}return me}))},ue=(W,Y)=>{console.log("[XMLReprocessModal] handleLinkProduct chamado:",{index:W,productId:Y}),console.log("[XMLReprocessModal] Estado editedProducts antes:",j[W]),F(W,"linkedProductId",Y),console.log("[XMLReprocessModal] Estado editedProducts depois:",{...j,[W]:{...j[W],linkedProductId:Y}})};p.useEffect(()=>{i&&e&&_e(i)},[i,e]);const _e=async W=>{f(W);try{console.log("[XMLReprocess] Processando arquivo automtico..."),console.log("[XMLReprocess] Purchase data:",r);const me=await W.text();console.log("[XMLReprocess] XML content length:",me.length);const ee=gC(me);if(!ee.success){l({title:"Erro ao ler XML",description:ee.error||"XML invlido",variant:"destructive"});return}console.log("[XMLReprocess] Dados parseados:",ee.data),console.log("[XMLReprocess] Produtos encontrados:",ee.data?.produtos?.length||0),console.log("[XMLReprocess] Comparando chaves:",{xmlChave:ee.data?.nfe?.chaveAcesso,purchaseChave:r?.chave_nfe,match:ee.data?.nfe?.chaveAcesso===r?.chave_nfe}),m(ee.data);const ae=await doe(r.id);console.log("[XMLReprocess] Itens da compra original:",ae.length);const le=ee.data?.produtos?.map((te,ie)=>{const xt=xC(te,n),vt=!xt,dt=ae.find(_t=>te.codigo&&_t.codigo_produto_xml?_t.codigo_produto_xml===te.codigo:_t.nome_produto_xml===te.nome),St=!!dt,ft=dt?.selecionado_na_importacao||!1;return console.log(`[XMLReprocess] Produto ${ie+1}: ${te.nome}`),console.log(`  - Cdigo XML: ${te.codigo}`),console.log("  - originalItem encontrado:",dt?`${dt.nome_produto_xml} (cdigo: ${dt.codigo_produto_xml})`:"NO ENCONTRADO"),console.log(`  - wasImported: ${St}`),console.log(`  - wasSelectedInOriginalImport: ${ft}`),{index:ie,xml:te,existing:xt,isNew:vt,wasImported:St,selected:S[ie]!==void 0?S[ie]:St}})||[];console.log("[XMLReprocess] Preview preparado:",le.length,"produtos"),console.log("[XMLReprocess] Produtos marcados:",le.filter(te=>te.selected).length),console.log("[XMLReprocess] Produtos importados originalmente:",le.filter(te=>te.wasImported).length),console.log("[XMLReprocess] Items da compra original detalhado:"),ae.forEach((te,ie)=>{console.log(`  ${ie+1}. ${te.nome_produto_xml} (cdigo: ${te.codigo_produto_xml}) - selecionado_na_importacao: ${te.selecionado_na_importacao}`)}),g(le);const Te={};le.forEach((te,ie)=>{te.xml.precoVenda&&(Te[ie]={salePrice:Number(te.xml.precoVenda)})}),console.log("[XMLReprocess] Pr-populando editedProducts:",Te),_(Te),d("preview")}catch(me){console.error("[XMLReprocess] Erro ao processar arquivo automtico:",me),l({title:"Erro",description:"Erro ao processar o XML salvo.",variant:"destructive"})}},U=async W=>{const Y=W.target.files?.[0];if(!Y){console.log("[XMLReprocess] Nenhum arquivo selecionado");return}if(console.log("[XMLReprocess] Arquivo selecionado:",Y.name),!Y.name.endsWith(".xml")){l({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}f(Y);try{console.log("[XMLReprocess] Lendo contedo do arquivo...");const me=await Y.text();console.log("[XMLReprocess] Arquivo lido, parseando XML...");const ee=gC(me);if(console.log("[XMLReprocess] XML parseado:",ee),!ee.success){l({title:"Erro ao ler XML",description:ee.error||"XML invlido",variant:"destructive"});return}if(!ee.data?.produtos||ee.data.produtos.length===0){l({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}if(ee.data?.nfe?.chaveAcesso!==r?.chave_nfe){l({title:"XML incompatvel",description:"Este XML no corresponde  NF-e selecionada. Verifique a chave de acesso.",variant:"destructive"});return}m(ee.data);let ae=n;try{ae=await mf({search:"",codigoEmpresa:s,includeInactive:!0})||n,console.log("[XMLReprocess] Produtos carregados para validao:",ae.length)}catch(te){console.warn("[XMLReprocess] No foi possvel carregar lista completa, usando cache:",te)}const le=ee.data.produtos.map((te,ie)=>{const xt=xC(te,ae);return{xml:te,existing:xt,isNew:!xt,willCreate:!xt,willUpdate:!!xt,selected:!0,index:ie}});g(le);const Te={};le.forEach((te,ie)=>{te.xml.precoVenda&&(Te[ie]={salePrice:Number(te.xml.precoVenda)})}),console.log("[XMLReprocess] Pr-populando editedProducts:",Te),_(Te),console.log("[XMLReprocess] Preview preparado, mudando para step preview. Total produtos:",le.length),d("preview")}catch(me){console.error("[XMLReprocess] Erro ao processar arquivo:",me),l({title:"Erro",description:"Erro ao processar o arquivo XML.",variant:"destructive"})}},L=()=>{T({isOpen:!0})},G=async()=>{if(T({isOpen:!1}),!h||!r){l({title:"Erro",description:"Dados insuficientes para reprocessamento.",variant:"destructive"});return}y(!0),d("processing");const W={created:0,updated:0,removed:0,errors:0,details:[]},Y=x.filter(ee=>ee.selected),me=x.filter(ee=>!ee.selected);console.log("[XMLReprocess] Iniciando reprocessamento para compra:",r.id),console.log("[XMLReprocess] Produtos selecionados:",Y.length),console.log("[XMLReprocess] Produtos desmarcados:",me.length);try{for(const ee of me){const le=(j[ee.index]||{}).name||ee.xml.nome,Te=Number(ee.xml.quantidade);try{if(ee.isNew){const te=ee.existing;te&&(await yF(te.id),W.removed++,W.details.push({produto:le,acao:"Produto removido (era novo e foi desmarcado)",status:"success"}))}else{const te=ee.existing;te&&Te>0&&(await e0({productId:te.id,delta:-Te,codigoEmpresa:r.codigo_empresa}),W.updated++,W.details.push({produto:le,acao:`Estoque revertido -${Te}`,status:"success"}))}}catch(te){console.error(`[XMLReprocess] Erro ao processar produto desmarcado: ${le}`,te),W.errors++,W.details.push({produto:le,acao:`Erro ao reverter: ${te.message}`,status:"error"})}}for(const ee of Y){const ae=j[ee.index]||{},le=ae.name||ee.xml.nome,Te=ae.qty!==void 0?ae.qty:Number(ee.xml.quantidade),te=ae.margin,ie=ae.salePrice,xt=ae.linkedProductId;try{if(ee.isNew&&(!xt||xt==="new")){const vt=L3(ee.xml,r.codigo_empresa);if(le&&(vt.name=le),ie!=null)vt.salePrice=ie,vt.price=ie;else if(te!=null&&te>0){const St=vt.costPrice||0;if(St>0){const ft=St*(1+te/100);vt.salePrice=ft,vt.price=ft}}else vt.salePrice!=null&&vt.price==null&&(vt.price=vt.salePrice);const dt=await pC(vt,{codigoEmpresa:r.codigo_empresa});Te>0&&await e0({productId:dt.id,delta:Te,codigoEmpresa:r.codigo_empresa}),W.created++,W.details.push({produto:le,acao:Te>0?`Criado com estoque ${Te}`:"Criado",status:"success"})}else{const vt=xt&&xt!=="force-new"&&xt!=="new"?n.find(dt=>dt.id===xt):ee.existing;if(ae.updatePrice&&vt){const dt=Number(ee.xml.valorUnitario)||0,St={};if(dt>0&&(St.costPrice=dt),ie!=null)St.salePrice=ie,St.price=ie;else if(te!=null&&te>0&&dt>0){const ft=dt*(1+te/100);St.salePrice=ft,St.price=ft}await z1(vt.id,St)}W.updated++,W.details.push({produto:le,acao:ae.updatePrice?"Preo atualizado":"Mantido sem alteraes",status:"success"})}}catch(vt){console.error(`[XMLReprocess] Erro ao processar produto: ${le}`,vt),W.errors++,W.details.push({produto:le,acao:`Erro: ${vt.message}`,status:"error"})}}}catch(ee){console.error("[XMLReprocess] Erro geral no reprocessamento:",ee),W.errors++,W.details.push({produto:"Sistema",acao:`Erro geral: ${ee.message}`,status:"error",error:ee.message})}try{const ee=Y.map(ae=>{const le=j[ae.index]||{},Te=le.linkedProductId;let te=null;return Te&&Te!=="force-new"?te=Te:!ae.isNew&&Te!=="force-new"&&(te=ae.existing?.id||null),{produtoId:te,codigoProdutoXML:ae.xml.codigo,nomeProdutoXML:ae.xml.nome,eanXML:ae.xml.ean,ncmXML:ae.xml.ncm,cfopXML:ae.xml.cfop,unidadeXML:ae.xml.unidade,quantidade:le.qty!==void 0?le.qty:Number(ae.xml.quantidade),valorUnitario:Number(ae.xml.valorUnitario)||0,valorTotal:Number(ae.xml.valorTotal)||0,vinculadoManualmente:!!Te&&Te!=="force-new"}});await Ost(r.id,ee),console.log("[XMLReprocess] Itens reprocessados:",ee.length)}catch(ee){console.error("[XMLReprocess] Erro ao reprocessar itens da compra:",ee),W.errors++,W.details.push({produto:"Itens da NF-e",acao:"Erro ao reprocessar",status:"error",error:ee.message})}w(W),y(!1),d("done"),W.errors===0?l({title:"Reprocessamento concludo!",description:`${W.created} produto(s) criado(s), ${W.updated} atualizado(s).`,variant:"success"}):l({title:"Reprocessamento com erros",description:`${W.errors} erro(s) encontrado(s). Verifique os detalhes.`,variant:"destructive"}),o&&o()};p.useEffect(()=>{e||(d("upload"),f(null),m(null),g([]),_({}),A({}),w({created:0,updated:0,errors:0,details:[]}),y(!1),P({}))},[e]);const de=()=>{t(!1)},X=x.filter(W=>W.selected).length;return a.jsxs(zn,{open:e,onOpenChange:de,children:[a.jsxs(qn,{className:"w-[95vw] sm:max-w-4xl max-h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs(Bn,{children:[a.jsxs($n,{className:"flex items-center gap-2",children:[a.jsx(Tg,{className:"h-5 w-5"}),a.jsx("span",{children:"Reprocessar XML"}),a.jsx("span",{className:"inline-flex items-center rounded-full bg-surface-2 border border-border px-2 py-0.5 text-xs font-semibold text-text-muted uppercase tracking-wide",children:k()}),a.jsx("span",{className:"text-sm text-text-muted",children:r?.numero_nfe})]}),a.jsx(la,{children:"Reimporte o XML para atualizar os produtos e itens desta NF-e. Os itens atuais sero substitudos pelos novos."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto",children:[c==="upload"&&a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center",children:[a.jsx(tD,{className:"h-12 w-12 mx-auto text-text-muted mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Selecione o arquivo XML"}),a.jsxs("p",{className:"text-text-muted mb-4",children:["Faa upload do XML da NF-e ",r?.numero_nfe," para reprocessar os produtos"]}),a.jsx("input",{type:"file",accept:".xml",onChange:U,className:"hidden",id:"xml-reprocess-upload"}),a.jsx("label",{htmlFor:"xml-reprocess-upload",children:a.jsx(Z,{asChild:!0,children:a.jsx("span",{children:"Selecionar XML"})})})]})}),c==="preview"&&h&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Informaes da NF-e"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",h.nfe.numero]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",h.nfe.serie]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Modelo:"})," ",k()]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Fornecedor:"})," ",h.fornecedor?.nome]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Total:"})," R$ ",Number(h.nfe.totalNota||0).toFixed(2)]})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"font-semibold text-base",children:"Produtos Encontrados"}),a.jsxs("span",{className:"text-sm text-text-muted",children:[x.filter(W=>W.selected).length," de ",x.length," selecionados"]})]}),a.jsx("div",{className:"space-y-2",children:x.map((W,Y)=>{const me=$(Y,"name",W.xml.nome),ee=$(Y,"qty",Number(W.xml.quantidade)),ae=$(Y,"linkedProductId",null),le=W.xml.valorUnitario||0,Te=$(Y,"margin",null);let ie=$(Y,"salePrice",null);ie==null&&!W.isNew&&W.existing&&(ie=Number(W.existing.preco_venda||W.existing.salePrice||W.existing.price||0)),ie==null&&Te!=null&&(ie=q(le,Te)),ie==null&&W.xml.precoVenda&&(ie=Number(W.xml.precoVenda));let xt=null;if(Te!=null)xt=Te;else if(ie!=null&&le>0&&ie>0){const dt=(ie-le)/le*100;xt=Math.max(-999,Math.min(9999,dt))}const vt=C[Y];return a.jsxs("div",{className:Er("rounded-lg border transition-all",W.selected?"bg-info/10 border-info/30":"bg-surface opacity-60 border-border"),children:[a.jsxs("div",{className:"p-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("input",{type:"checkbox",checked:W.selected,onChange:()=>V(Y),className:"w-4 h-4 rounded border-border accent-warning cursor-pointer"}),a.jsx("button",{onClick:()=>z(Y),className:"p-0.5 hover:bg-surface-2 rounded transition-colors",children:vt?a.jsx(gx,{className:"w-4 h-4 text-text-muted"}):a.jsx(Yg,{className:"w-4 h-4 text-text-muted"})}),a.jsx("div",{children:ae?a.jsx(wG,{className:"w-5 h-5 text-warning"}):a.jsx(Tg,{className:"w-5 h-5 text-info"})})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:ae&&ae!=="force-new"&&ae!=="new"?(()=>{const dt=n.find(St=>St.id===ae);return dt?dt.name:me})():me}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-text-muted mt-0.5",children:[W.xml.codigo&&a.jsxs("span",{className:"flex-shrink-0",children:["#",W.xml.codigo]}),a.jsxs("span",{children:["Qtd: ",ee]})]})]}),a.jsx("div",{className:"flex-shrink-0 ml-2",children:ae?a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-warning/20 text-warning font-medium",children:"Vinculado"}):a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-info/20 text-info font-medium",children:"Cadastrado"})})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-muted",children:[a.jsxs("span",{children:["R$ ",le.toFixed(2),ie?`  R$ ${ie.toFixed(2)}`:""]}),xt!=null&&a.jsxs("span",{className:"ml-2 "+(xt>0?"text-success":xt<0?"text-destructive":"text-text-muted"),children:[xt.toFixed(1),"%"]})]})]})]}),vt&&a.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3 border-t border-border/50",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Nome do Produto"}),a.jsx("input",{type:"text",value:me,onChange:dt=>F(Y,"name",dt.target.value),disabled:!W.selected,className:"w-full px-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>F(Y,"qty",Math.max(0,ee-1)),disabled:!W.selected||ee<=0,className:"w-9 h-9 rounded-md border border-border bg-surface hover:bg-surface-2 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:a.jsx(Nv,{className:"w-4 h-4"})}),a.jsx("input",{type:"text",value:ee,onChange:dt=>{const St=dt.target.value.replace(/\D/g,"");F(Y,"qty",St===""?0:Number(St))},disabled:!W.selected,className:"w-14 text-center px-2 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50"}),a.jsx("button",{type:"button",onClick:()=>F(Y,"qty",ee+1),disabled:!W.selected,className:"w-9 h-9 rounded-md bg-warning hover:bg-warning/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center text-black font-bold shadow-sm",children:a.jsx(to,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Margem %"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:(()=>{const dt=$(Y,"margin",null);return dt!=null?String(dt):""})(),onChange:dt=>{const St=dt.target.value;if(St===""){F(Y,"margin",null),F(Y,"salePrice",null);return}const ft=St.replace(/[^0-9.,\-]/g,"").replace(",",".");if(ft==="."||ft==="-"||ft==="-.")return;const _t=parseFloat(ft);if(!isNaN(_t)&&(F(Y,"margin",_t),le>0)){const gr=q(le,_t);F(Y,"salePrice",gr)}},disabled:!W.selected,placeholder:"0",className:"w-24 pl-3 pr-6 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right"}),a.jsx("span",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Custo"}),a.jsx("div",{className:"px-3 py-2 bg-surface/50 rounded-md border border-border",children:a.jsxs("span",{className:"text-sm font-semibold",children:["R$ ",le.toFixed(2)]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Preo Venda"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"R$"}),a.jsx("input",{type:"text",value:(()=>{const dt=$(Y,"salePrice",ie);return dt==null?"":Number(dt).toFixed(2).replace(".",",")})(),onChange:dt=>{const St=dt.target.value.replace(/\D/g,"");if(St===""){F(Y,"salePrice",null);return}const ft=Number(St)/100;if(F(Y,"salePrice",ft),ft>0&&le>0){const _t=(ft-le)/le*100;F(Y,"margin",Math.round(_t*100)/100)}},disabled:!W.selected,placeholder:"0,00",className:"w-28 pl-7 pr-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right font-semibold text-success"})]})]})]}),a.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[a.jsx("input",{type:"checkbox",id:`update-price-${Y}`,checked:$(Y,"updatePrice",!1),onChange:dt=>F(Y,"updatePrice",dt.target.checked),disabled:!W.selected,className:"w-4 h-4 text-brand bg-surface border-border rounded focus:ring-brand focus:ring-2 disabled:opacity-50"}),a.jsx("label",{htmlFor:`update-price-${Y}`,className:"text-sm text-text-primary select-none cursor-pointer",children:"Atualizar preo do produto no sistema"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Vincular a Produto Existente (Opcional)"}),a.jsxs(ea,{value:ae==="force-new"?"force-new":ae||(W.isNew?"new":W.existing?.id||"new"),onValueChange:dt=>{dt==="new"||dt===W.existing?.id?ue(Y,null):dt==="search"?O({isOpen:!0,productIndex:Y,currentProduct:W}):ue(Y,dt)},disabled:!W.selected,children:[a.jsx(Jn,{className:"w-full hover:bg-white/5 transition-colors",children:a.jsx(ra,{placeholder:W.isNew?" Criar como novo produto":" Atualizar produto existente"})}),a.jsxs(Qn,{className:"max-h-[300px] overflow-y-auto",children:[W.isNew?a.jsx(Qe,{value:"new",children:" Criar como novo produto"}):a.jsxs(Qe,{value:W.existing?.id||"new",children:[" Atualizar: ",W.existing?.name," (Estoque atual: ",W.existing?.stock||0,")"]}),!W.isNew&&a.jsx(Qe,{value:"force-new",children:" Criar como novo produto (ignorar existente)"}),a.jsx(Qe,{value:"search",children:" Buscar produto para vincular..."})]})]})]})]})]},Y)})})]})]}),c==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(ll,{className:"h-12 w-12 animate-spin text-brand mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Reprocessando XML..."}),a.jsx("p",{className:"text-text-muted",children:"Atualizando produtos e itens da NF-e"})]}),c==="done"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center py-6",children:[b.errors===0?a.jsx(Oi,{className:"h-12 w-12 text-success mx-auto mb-4"}):a.jsx(kd,{className:"h-12 w-12 text-warning mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:b.errors===0?"Reprocessamento Concludo!":"Reprocessamento com Erros"}),a.jsxs("div",{className:"text-text-muted",children:[b.created," produto(s) criado(s), ",b.updated," atualizado(s)",b.errors>0&&`, ${b.errors} erro(s)`]})]}),b.details.length>0&&a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-3",children:"Detalhes do Reprocessamento"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:b.details.map((W,Y)=>a.jsxs("div",{className:Er("flex items-center gap-3 p-2 rounded",W.status==="success"?"bg-green-50 text-green-800":W.status==="error"?"bg-red-50 text-red-800":"bg-gray-50 text-gray-800"),children:[W.status==="success"?a.jsx(Oi,{className:"h-4 w-4 flex-shrink-0"}):a.jsx(kd,{className:"h-4 w-4 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:W.produto}),a.jsx("div",{className:"text-xs",children:W.acao}),W.error&&a.jsx("div",{className:"text-xs mt-1 opacity-75",children:W.error})]})]},Y))})]})]})]}),a.jsxs(Ua,{children:[c==="upload"&&a.jsx(Z,{variant:"outline",onClick:de,children:"Cancelar"}),c==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:()=>d("upload"),children:"Voltar"}),a.jsxs(Z,{onClick:L,disabled:X===0,children:["Reprocessar (",X," produtos)"]})]}),c==="done"&&a.jsx(Z,{onClick:de,children:"Fechar"})]})]}),a.jsx(uoe,{isOpen:M.isOpen,onClose:()=>O({isOpen:!1,productIndex:null,currentProduct:null}),onSelect:W=>{console.log("[XMLReprocessModal] onSelect chamado com produto:",W),console.log("[XMLReprocessModal] Index do produto:",M.productIndex),ue(M.productIndex,W.id),O({isOpen:!1,productIndex:null,currentProduct:null})},currentProduct:M.currentProduct}),a.jsx(foe,{isOpen:I.isOpen,onClose:()=>T({isOpen:!1}),onConfirm:G,products:x.map((W,Y)=>({...W,originalIndex:Y})),editedProducts:j,allProducts:n,isReprocess:!0})]})}const hV="comprasPage:settings";function moe(){const{user:e,userProfile:t}=fo(),[r,n]=p.useState([]),[s,o]=p.useState(!0),[i,l]=p.useState(""),[c,d]=p.useState(null),[u,f]=p.useState([]),[h,m]=p.useState(!1),[x,g]=p.useState(()=>Cc(new Date)),[v,y]=p.useState(()=>h5(new Date)),[b,w]=p.useState("all"),[j,_]=p.useState(!0),[C,A]=p.useState(!1),[S,P]=p.useState("active"),[M,O]=p.useState({show:!1,purchase:null}),[I,T]=p.useState(""),[k,$]=p.useState({show:!1,purchase:null}),[q,z]=p.useState({}),[F,V]=p.useState({show:!1,purchase:null}),[ue,_e]=p.useState([]),[U,L]=p.useState(!1),[G,de]=p.useState(!1),[X,W]=p.useState("paged"),Y=X==="paged",[me,ee]=p.useState(1),[ae]=p.useState(100),[le,Te]=p.useState(0),[te,ie]=p.useState(!1),xt=De=>{const wt=String(De||"").replace(/\D/g,"");return(wt?Number(wt)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},vt=async()=>{try{ie(!0);const De=(ve||[]).filter(Wr=>!!Wr.xml_completo).map(Wr=>({tipo:"entrada",chave:Wr.chave_nfe,xml:Wr.xml_completo}));if(!De.length){alert("Nenhum XML disponvel nos resultados filtrados.");return}const wt=Wr=>String(Wr||"").replace(/[^0-9A-Za-z_-]/g,""),Rt=x?or(x,"yyyy-MM-dd"):"",Rr=v?or(v,"yyyy-MM-dd"):"",Me=`nfe-entrada-filtrados-${wt(Rt)}_a_${wt(Rr)}-xml.zip`,{data:tt,error:ut}=await Q.functions.invoke("emissor",{body:{acao:"export_zip",ambiente:"homologacao",cnpj:"",dados:{items:De,includePdf:!1,zipName:Me}},responseType:"arrayBuffer"});if(ut)throw ut;const sr=new Blob([tt],{type:"application/zip"}),Sr=URL.createObjectURL(sr),xr=document.createElement("a");xr.href=Sr,xr.download=Me,document.body.appendChild(xr),xr.click(),document.body.removeChild(xr),URL.revokeObjectURL(Sr)}catch(De){alert(`Falha ao exportar ZIP: ${De?.message||De}`)}finally{ie(!1)}},dt=De=>{if(!De.xml_completo){alert("XML no disponvel para esta NF-e");return}const wt=new Blob([De.xml_completo],{type:"text/xml;charset=utf-8"}),Rt=URL.createObjectURL(wt),Rr=document.createElement("a");Rr.href=Rt,Rr.download=`${De.chave_nfe}.xml`,document.body.appendChild(Rr),Rr.click(),document.body.removeChild(Rr),URL.revokeObjectURL(Rt)},St=async De=>{if(!De.xml_completo){alert("XML no disponvel para reprocessamento automtico");return}if(confirm("Deseja reprocessar esta NF-e? Isso substituir todos os itens atuais pelos dados do XML original."))try{console.log("[ComprasPage] Iniciando reprocessamento para purchase:",De),console.log("[ComprasPage] Chave NF-e:",De.chave_nfe),console.log("[ComprasPage] XML disponvel:",!!De.xml_completo);const wt=new Blob([De.xml_completo],{type:"text/xml"}),Rt=new File([wt],`${De.chave_nfe}.xml`,{type:"text/xml"});V({show:!0,purchase:De,autoFile:Rt})}catch(wt){console.error("Erro no reprocessamento automtico:",wt),alert("Erro ao iniciar reprocessamento automtico")}},ft=De=>{if(!De)return 0;const wt=String(De).replace(/\./g,"").replace(",",".");return parseFloat(wt)||0};p.useEffect(()=>{try{const De=localStorage.getItem(hV);if(!De)return;const wt=JSON.parse(De);wt&&typeof wt=="object"&&((wt.listMode==="paged"||wt.listMode==="all")&&W(wt.listMode),typeof wt.showStats=="boolean"&&_(wt.showStats))}catch{}},[]),p.useEffect(()=>{(async()=>{if(!e?.id||!t?.codigo_empresa)return;const wt=`compras:${t.codigo_empresa}`,Rt=await ioe({userId:e.id,scope:wt});Rt&&((Rt.listMode==="paged"||Rt.listMode==="all")&&W(Rt.listMode),typeof Rt.showStats=="boolean"&&_(Rt.showStats))})()},[e?.id,t?.codigo_empresa]),p.useEffect(()=>{try{const De={listMode:X,showStats:j};localStorage.setItem(hV,JSON.stringify(De))}catch{}if(e?.id&&t?.codigo_empresa){const De=`compras:${t.codigo_empresa}`;loe({userId:e.id,scope:De,settings:{listMode:X,showStats:j}})}},[X,j,e?.id,t?.codigo_empresa]),p.useEffect(()=>{t?.codigo_empresa&&(gr(),_t())},[t,S,b,x,v,me,X]),p.useEffect(()=>{ee(1)},[S,b,x,v,X]);const _t=async()=>{try{const De=await mf({codigoEmpresa:t.codigo_empresa});_e(De||[])}catch(De){console.error("[Compras] Erro ao carregar produtos:",De)}},gr=async()=>{try{o(!0);let De=null,wt=null;if(x){const ut=new Date(x);ut.setHours(0,0,0,0),De=ut.toISOString()}if(v){const ut=new Date(v);ut.setHours(23,59,59,999),wt=ut.toISOString()}const Me={incluirInativas:S==="all"||S==="inactive",apenasInativas:S==="inactive",fornecedorId:b!=="all"?b:void 0,dataInicio:De,dataFim:wt,page:Y?me:1,pageSize:Y?ae:1e4},tt=await Est(t.codigo_empresa,Me);n(tt?.data||[]),Te(tt?.count||0)}catch(De){console.error("[Compras] Erro ao carregar compras:",De)}finally{o(!1)}},be=async De=>{d(De),m(!0);try{const wt=await doe(De.id);f(wt||[])}catch(wt){console.error("[Compras] Erro ao carregar itens:",wt),f([])}finally{m(!1)}},Nt=()=>{d(null),f([])},Wt=De=>{$({show:!0,purchase:De}),z({numeroNfe:De.numero_nfe||"",serieNfe:De.serie_nfe||"",dataEmissao:De.data_emissao?De.data_emissao.split("T")[0]:"",tipoOperacao:De.tipo_operacao||"",naturezaOperacao:De.natureza_operacao||"",valorProdutos:xt((De.valor_produtos||0)*100),valorTotal:xt((De.valor_total||0)*100),formaPagamento:De.forma_pagamento||"",observacoes:De.observacoes||""})},_r=async()=>{try{await Tst(k.purchase.id,{...q,valorProdutos:ft(q.valorProdutos),valorTotal:ft(q.valorTotal),fornecedorId:k.purchase.fornecedor_id}),await gr(),$({show:!1,purchase:null}),z({}),console.log("Compra editada com sucesso!")}catch(De){console.error("Erro ao editar compra:",De)}},yr=p.useMemo(()=>{const De=new Map;return r.forEach(wt=>{wt.fornecedor?.id&&De.set(wt.fornecedor.id,wt.fornecedor)}),Array.from(De.values())},[r]),ve=p.useMemo(()=>r.filter(De=>{if(i){const wt=i.toLowerCase();if(!(De.numero_nfe?.toLowerCase().includes(wt)||De.fornecedor?.nome?.toLowerCase().includes(wt)||De.chave_nfe?.toLowerCase().includes(wt)))return!1}return!0}),[r,i]),at=p.useMemo(()=>{const De=ve.reduce((tt,ut)=>tt+Number(ut.valor_total||0),0),wt=ve.length,Rt=wt>0?De/wt:0,Rr={};ve.forEach(tt=>{const ut=tt.fornecedor?.id||"unknown",sr=tt.fornecedor?.nome||"No identificado";Rr[ut]||(Rr[ut]={name:sr,total:0,count:0}),Rr[ut].total+=Number(tt.valor_total||0),Rr[ut].count+=1});const Me=Object.values(Rr).sort((tt,ut)=>ut.total-tt.total).slice(0,5);return{total:De,count:wt,avgTicket:Rt,topSuppliers:Me}},[ve]),qt=p.useMemo(()=>{if(!ae)return 1;const De=Math.ceil((le||0)/ae);return De>0?De:1},[le,ae]),$t=()=>{const De=["NF-e","Serie","Data Emissao","Fornecedor","CNPJ","Tipo","Valor Total","Valor Produtos","Forma Pagamento"],wt=ve.map(tt=>[tt.numero_nfe||"",tt.serie_nfe||"",tt.data_emissao?or(new Date(tt.data_emissao),"dd/MM/yyyy"):"",(tt.fornecedor?.nome||"").replace(/,/g," "),tt.fornecedor?.cnpj||"",tt.tipo_operacao||"",Number(tt.valor_total||0).toFixed(2),Number(tt.valor_produtos||0).toFixed(2),(tt.forma_pagamento||"").replace(/,/g," ")]),Rt=[De,...wt].map(tt=>tt.join(";")).join(`
`),Rr=new Blob(["\uFEFF"+Rt],{type:"text/csv;charset=utf-8;"}),Me=document.createElement("a");Me.href=URL.createObjectURL(Rr),Me.download=`compras_${or(new Date,"yyyy-MM-dd")}.csv`,Me.click()};return a.jsxs("div",{className:"px-3 py-4 md:p-6 max-w-7xl mx-auto",children:[a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx("h1",{className:"text-3xl font-bold text-text-primary",children:"Compras (NF-e)"}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex items-center justify-center",onClick:()=>de(!0),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(Xc,{className:"h-4 w-4"})}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"h-9",disabled:te,children:"Aes"})}),a.jsx(Qu,{align:"end",children:a.jsxs(vs,{disabled:ve.length===0,onClick:vt,children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]})})]})]}),a.jsxs("div",{className:"flex flex-row flex-wrap items-end gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted block mb-1",children:"Perodo Inicial"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start text-left font-normal h-9 text-sm",children:[a.jsx(ko,{className:"mr-2 h-4 w-4"}),x?or(x,"dd/MM/yyyy"):a.jsx("span",{children:"Selecionar"})]})}),a.jsx(Ho,{className:"w-auto p-0 z-50",align:"end",children:a.jsx(ei,{mode:"single",selected:x,onSelect:g,locale:Da})})]})]}),a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted block mb-1",children:"Perodo Final"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start text-left font-normal h-9 text-sm",children:[a.jsx(ko,{className:"mr-2 h-4 w-4"}),v?or(v,"dd/MM/yyyy"):a.jsx("span",{children:"Selecionar"})]})}),a.jsx(Ho,{className:"w-auto p-0 z-50",align:"end",children:a.jsx(ei,{mode:"single",selected:v,onSelect:y,locale:Da})})]})]}),(x||v)&&a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>{g(null),y(null)},className:"h-8 px-3 text-xs",children:"Limpar"})]})]})}),j&&ve.length>0&&a.jsxs("div",{className:"mb-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(ol,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"NF-es"})]}),a.jsx("p",{className:"text-lg md:text-2xl font-bold text-text-primary leading-none",children:at.count})]}),a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(Vi,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"Total"})]}),a.jsxs("p",{className:"text-base md:text-2xl font-bold text-success leading-none whitespace-nowrap",children:["R$ ",at.total.toFixed(2)]})]}),a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(Tf,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"Fornec."})]}),a.jsx("p",{className:"text-lg md:text-2xl font-bold text-info leading-none",children:yr.length})]})]}),at.topSuppliers.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(C_,{className:"h-4 w-4"}),"Top 5 Fornecedores"]}),a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>A(!0),className:"text-xs",children:"Ver Todos"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:at.topSuppliers.map((De,wt)=>{const Rt=De.total/at.total*100;return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsx("span",{className:"text-text-primary font-medium truncate flex-1",title:De.name,children:De.name}),a.jsxs("span",{className:"text-text-muted text-xs ml-2 flex-shrink-0",children:["R$ ",De.total.toFixed(2)]})]}),a.jsx("div",{className:"w-full bg-surface-2 rounded-full h-1.5",children:a.jsx("div",{className:"bg-brand rounded-full h-1.5 transition-all",style:{width:`${Rt}%`}})})]},wt)})})]})]}),a.jsx("div",{className:"mb-6 space-y-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3 md:gap-4 md:flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2 w-full md:flex-1 md:min-w-[250px]",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar por NF-e, fornecedor ou chave...",value:i,onChange:De=>l(De.target.value),className:"pl-10"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex md:hidden items-center justify-center",onClick:()=>L(De=>!De),"aria-label":"Filtros",children:a.jsx(wN,{className:"h-4 w-4"})})]}),U&&a.jsxs("div",{className:"md:hidden mt-1 space-y-3 px-0.5",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Fornecedor"}),a.jsxs(ea,{value:b,onValueChange:w,children:[a.jsxs(Jn,{className:"w-full text-sm",children:[a.jsx(Tf,{className:"h-4 w-4 mr-2 flex-shrink-0"}),a.jsx("div",{className:"truncate",children:a.jsx(ra,{placeholder:"Todos"})})]}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todos"}),yr.map(De=>a.jsx(Qe,{value:De.id,children:a.jsx("div",{className:"truncate max-w-[220px]",title:De.nome,children:De.nome})},De.id))]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Status"}),a.jsxs(ea,{value:S,onValueChange:P,children:[a.jsx(Jn,{className:"w-full text-sm",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"active",children:"Apenas ativas"}),a.jsx(Qe,{value:"all",children:"Todas"}),a.jsx(Qe,{value:"inactive",children:"Apenas inativas"})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1 border-t border-border/60",children:[a.jsxs(Z,{type:"button",variant:"ghost",size:"sm",className:"gap-2 text-xs px-2",onClick:()=>_(!j),children:[a.jsx(C_,{className:"h-4 w-4"}),j?"Ocultar estatsticas":"Mostrar estatsticas"]}),a.jsxs(Z,{type:"button",variant:"outline",size:"sm",onClick:$t,disabled:ve.length===0,className:"gap-1 text-xs px-3",children:[a.jsx(ys,{className:"h-4 w-4"}),"CSV"]})]})]}),a.jsxs("div",{className:"hidden md:flex md:items-center md:gap-4 md:flex-wrap w-full",children:[a.jsxs(ea,{value:b,onValueChange:w,children:[a.jsxs(Jn,{className:"w-full md:w-[220px]",children:[a.jsx(Tf,{className:"h-4 w-4 mr-2 flex-shrink-0"}),a.jsx("div",{className:"truncate",children:a.jsx(ra,{placeholder:"Fornecedor"})})]}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todos"}),yr.map(De=>a.jsx(Qe,{value:De.id,children:a.jsx("div",{className:"truncate max-w-[180px]",title:De.nome,children:De.nome})},De.id))]})]}),a.jsxs(Z,{variant:"outline",onClick:$t,disabled:ve.length===0,className:"gap-2 w-full sm:w-auto justify-center",children:[a.jsx(ys,{className:"h-4 w-4"}),"Exportar CSV"]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs(Z,{variant:"ghost",size:"sm",onClick:()=>_(!j),className:"gap-2",children:[a.jsx(C_,{className:"h-4 w-4"}),j?"Ocultar":"Mostrar"]}),a.jsxs(ea,{value:S,onValueChange:P,children:[a.jsx(Jn,{className:"w-[140px]",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"active",children:"Apenas ativas"}),a.jsx(Qe,{value:"all",children:"Todas"}),a.jsx(Qe,{value:"inactive",children:"Apenas inativas"})]})]})]})]})]})}),s?a.jsxs("div",{className:"text-center py-12 bg-surface rounded-lg border border-border",children:[a.jsx(ju,{className:"h-12 w-12 mx-auto text-text-muted mb-4"}),a.jsx("p",{className:"text-text-muted",children:i?"Nenhuma compra encontrada":"Nenhuma NF-e importada ainda"}),a.jsx("p",{className:"text-sm text-text-muted mt-2",children:"Importe XMLs de NF-e na pgina de Produtos"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid gap-3",children:ve.map(De=>a.jsx("div",{className:`rounded-lg border overflow-hidden transition-all hover:shadow-lg ${De.ativo===!1?"bg-gray-900/60 border-red-500 shadow-red-500/20":"bg-surface border-border hover:border-brand/50"}`,onClick:()=>be(De),children:a.jsx("div",{className:"p-4",children:a.jsx("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:a.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[a.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[a.jsx(ol,{className:"h-6 w-6 text-brand mt-0.5 flex-shrink-0"}),a.jsx("div",{className:"min-w-0",children:a.jsxs("h3",{className:`font-semibold text-sm md:text-base leading-snug ${De.ativo===!1?"text-red-600":"text-text-primary"}`,children:["NF-e ",De.numero_nfe," / Srie ",De.serie_nfe,De.ativo===!1&&a.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 bg-red-100 text-red-700 text-[10px] rounded-full font-medium align-middle",children:"INATIVA"})]})})]}),a.jsx("div",{className:"sm:hidden flex items-center",children:a.jsxs("span",{className:"text-success font-semibold text-xs whitespace-nowrap pr-2",children:["R$ ",Number(De.valor_total||0).toFixed(2)]})})]}),a.jsxs("div",{className:"space-y-2.5",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[a.jsx(Tf,{className:"h-5 w-5 flex-shrink-0 text-brand"}),a.jsx("span",{className:"font-medium text-text-primary text-sm md:text-base overflow-hidden truncate",title:De.fornecedor?.nome||"Fornecedor no identificado",children:De.fornecedor?.nome||"Fornecedor no identificado"})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1.5 text-xs md:text-sm text-text-muted",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ko,{className:"h-4 w-4"}),a.jsx("span",{children:De.data_emissao?or(new Date(De.data_emissao),"dd/MM/yyyy",{locale:Da}):"Data no informada"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ju,{className:"h-4 w-4"}),a.jsx("span",{children:De.tipo_operacao||"Entrada"})]}),De.chave_nfe&&a.jsxs("div",{className:"text-[10px] md:text-xs max-w-[180px] md:max-w-xs overflow-hidden whitespace-nowrap truncate",children:[a.jsx("span",{className:"font-medium",children:"Chave:"})," ",De.chave_nfe.length>20?De.chave_nfe.slice(0,20)+"...":De.chave_nfe]})]}),De.natureza_operacao&&a.jsx("p",{className:"text-[10px] md:text-xs text-text-muted overflow-hidden whitespace-nowrap truncate",title:De.natureza_operacao,children:De.natureza_operacao})]})]}),a.jsxs("div",{className:"hidden sm:flex sm:flex-col sm:gap-3 sm:mt-0 sm:w-auto",children:[a.jsx("div",{className:"w-full flex justify-end",children:a.jsxs("div",{className:"text-right text-text-muted",children:[a.jsxs("span",{className:"text-success font-semibold text-base md:text-lg whitespace-nowrap",children:["R$ ",Number(De.valor_total||0).toFixed(2)]}),a.jsxs("p",{className:"text-[11px] md:text-xs mt-0.5",children:["Produtos: R$ ",Number(De.valor_produtos||0).toFixed(2)]})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full justify-end",children:[a.jsxs(Z,{onClick:wt=>{wt.stopPropagation(),be(De)},size:"sm",className:"gap-2 w-full justify-center",children:[a.jsx(Jg,{className:"h-4 w-4"}),a.jsx("span",{className:"text-xs sm:text-sm",children:"Detalhes"})]}),De.ativo&&a.jsxs(Z,{onClick:wt=>{wt.stopPropagation(),Wt(De)},size:"sm",variant:"outline",className:"gap-2 w-full justify-center",children:[a.jsx(xc,{className:"h-4 w-4"}),a.jsx("span",{className:"text-xs sm:text-sm",children:"Editar"})]})]})]})]})})})},De.id))}),Y&&a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-2 text-xs sm:text-sm text-text-muted",children:[a.jsxs("span",{children:["Pgina ",me," de ",qt," (",le," NF-es)"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>ee(De=>Math.max(1,De-1)),disabled:me<=1,children:"Anterior"}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>ee(De=>Math.min(qt,De+1)),disabled:me>=qt,children:"Prxima"})]})]})]}),a.jsx(zn,{open:G,onOpenChange:de,children:a.jsxs(qn,{className:"w-[90vw] sm:max-w-md max-h-[80vh] flex flex-col",children:[a.jsx(Bn,{children:a.jsx($n,{children:"Configuraes de Compras"})}),a.jsxs("div",{className:"space-y-4 text-sm",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Modo de listagem"}),a.jsxs(ea,{value:X,onValueChange:W,children:[a.jsx(Jn,{className:"w-full h-9 text-sm",children:a.jsx(ra,{placeholder:"Paginado"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"paged",children:"Paginado (100 por pgina)"}),a.jsx(Qe,{value:"all",children:"Todos (sem paginao)"})]})]})]}),a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{id:"compras-show-stats",checked:j,onCheckedChange:_}),a.jsx("label",{htmlFor:"compras-show-stats",className:"text-xs font-medium text-text-primary",children:"Mostrar cards de estatsticas"})]})})]})]})}),a.jsx(zn,{open:M.show,onOpenChange:De=>O({show:De,purchase:null}),children:a.jsxs(qn,{className:"w-[90vw] sm:max-w-md",children:[a.jsx(Bn,{children:a.jsx($n,{children:"Inativar NF-e"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["Tem certeza que deseja inativar a NF-e ",a.jsx("strong",{children:M.purchase?.numero_nfe}),"?"]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Motivo da inativao:"}),a.jsx(At,{value:I,onChange:De=>T(De.target.value),placeholder:"Ex: NF-e duplicada, erro na importao...",className:"w-full"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx(Z,{variant:"outline",onClick:()=>{O({show:!1,purchase:null}),T("")},children:"Cancelar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!I.trim()){alert("Por favor, informe o motivo da inativao");return}try{await kst(M.purchase.id,I.trim(),t.id),O({show:!1,purchase:null}),T(""),gr()}catch(De){console.error("Erro ao inativar compra:",De),alert("Erro ao inativar NF-e. Tente novamente.")}},disabled:!I.trim(),children:"Inativar"})]})]})]})}),c&&a.jsx(Ust,{purchase:c,items:h?[]:u,onClose:Nt,onEdit:Wt,onReprocess:St,onDownloadXML:dt,onInactivate:De=>O({show:!0,purchase:De})}),a.jsx(zn,{open:C,onOpenChange:A,children:a.jsxs(qn,{className:"w-[90vw] sm:max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[a.jsx(Bn,{children:a.jsx($n,{children:"Todos os Fornecedores"})}),a.jsx("div",{className:"px-6 py-3 bg-surface-2 border-y border-border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-muted",children:"Valor Total Geral"}),a.jsxs("span",{className:"text-2xl font-bold text-success",children:["R$ ",at.total.toFixed(2)]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:a.jsx("div",{className:"space-y-3 pr-2",children:Object.entries(ve.reduce((De,wt)=>{const Rt=wt.fornecedor?.id||"unknown",Rr=wt.fornecedor?.nome||"No identificado";return De[Rt]||(De[Rt]={name:Rr,total:0,count:0}),De[Rt].total+=Number(wt.valor_total||0),De[Rt].count+=1,De},{})).sort(([,De],[,wt])=>wt.total-De.total).map(([De,wt],Rt)=>{const Rr=wt.total/at.total*100;return a.jsxs("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-brand/10 text-brand text-xs font-bold flex items-center justify-center",children:Rt+1}),a.jsx("span",{className:"font-medium text-text-primary",children:wt.name})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"font-bold text-success",children:["R$ ",wt.total.toFixed(2)]}),a.jsxs("p",{className:"text-xs text-text-muted",children:[wt.count," NF-es"]})]})]}),a.jsx("div",{className:"w-full bg-surface rounded-full h-2",children:a.jsx("div",{className:"bg-brand rounded-full h-2 transition-all",style:{width:`${Rr}%`}})})]},De)})})})]})}),a.jsx(zn,{open:k.show,onOpenChange:De=>$({show:De,purchase:null}),children:a.jsxs(qn,{className:"w-[90vw] sm:max-w-2xl max-h-[80vh] flex flex-col",onOpenAutoFocus:De=>De.preventDefault(),children:[a.jsx(Bn,{children:a.jsx($n,{children:"Editar NF-e"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Nmero NF-e"}),a.jsx(At,{value:q.numeroNfe||"",onChange:De=>z(wt=>({...wt,numeroNfe:De.target.value})),placeholder:"Nmero da NF-e"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Srie"}),a.jsx(At,{value:q.serieNfe||"",onChange:De=>z(wt=>({...wt,serieNfe:De.target.value})),placeholder:"Srie"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Data de Emisso"}),a.jsx(At,{type:"date",value:q.dataEmissao||"",onChange:De=>z(wt=>({...wt,dataEmissao:De.target.value}))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Tipo de Operao"}),a.jsxs(ea,{value:q.tipoOperacao||"",onValueChange:De=>z(wt=>({...wt,tipoOperacao:De})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione o tipo"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"Entrada",children:"0 - Entrada"}),a.jsx(Qe,{value:"Sada",children:"1 - Sada"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Natureza da Operao"}),a.jsxs(ea,{value:q.naturezaOperacao||"",onValueChange:De=>z(wt=>({...wt,naturezaOperacao:De})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione a natureza"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"Compra para comercializao",children:"Compra para comercializao"}),a.jsx(Qe,{value:"Compra para industrializao",children:"Compra para industrializao"}),a.jsx(Qe,{value:"Compra para uso ou consumo",children:"Compra para uso ou consumo"}),a.jsx(Qe,{value:"Compra de ativo imobilizado",children:"Compra de ativo imobilizado"}),a.jsx(Qe,{value:"Compra de material para uso ou consumo",children:"Compra de material para uso ou consumo"}),a.jsx(Qe,{value:"Devoluo de venda de produo do estabelecimento",children:"Devoluo de venda de produo do estabelecimento"}),a.jsx(Qe,{value:"Devoluo de venda de mercadoria adquirida ou recebida de terceiros",children:"Devoluo de venda de mercadoria adquirida ou recebida de terceiros"}),a.jsx(Qe,{value:"Remessa de mercadoria por conta e ordem de terceiros",children:"Remessa de mercadoria por conta e ordem de terceiros"}),a.jsx(Qe,{value:"Retorno de mercadoria remetida por conta e ordem de terceiros",children:"Retorno de mercadoria remetida por conta e ordem de terceiros"}),a.jsx(Qe,{value:"Remessa para industrializao por encomenda",children:"Remessa para industrializao por encomenda"}),a.jsx(Qe,{value:"Retorno de mercadoria remetida para industrializao por encomenda",children:"Retorno de mercadoria remetida para industrializao por encomenda"}),a.jsx(Qe,{value:"Transferncia de produo do estabelecimento",children:"Transferncia de produo do estabelecimento"}),a.jsx(Qe,{value:"Transferncia de mercadoria adquirida ou recebida de terceiros",children:"Transferncia de mercadoria adquirida ou recebida de terceiros"})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Valor dos Produtos"}),a.jsx(At,{inputMode:"numeric",placeholder:"R$ 0,00",value:`R$ ${q.valorProdutos||"0,00"}`,onChange:De=>z(wt=>({...wt,valorProdutos:xt(De.target.value)}))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Valor Total"}),a.jsx(At,{inputMode:"numeric",placeholder:"R$ 0,00",value:`R$ ${q.valorTotal||"0,00"}`,onChange:De=>z(wt=>({...wt,valorTotal:xt(De.target.value)}))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Forma de Pagamento"}),a.jsxs(ea,{value:q.formaPagamento||"",onValueChange:De=>z(wt=>({...wt,formaPagamento:De})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione a forma de pagamento"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"01 - Dinheiro",children:"01 - Dinheiro"}),a.jsx(Qe,{value:"02 - Cheque",children:"02 - Cheque"}),a.jsx(Qe,{value:"03 - Carto de Crdito",children:"03 - Carto de Crdito"}),a.jsx(Qe,{value:"04 - Carto de Dbito",children:"04 - Carto de Dbito"}),a.jsx(Qe,{value:"05 - Carto da Loja (Private Label)",children:"05 - Carto da Loja (Private Label)"}),a.jsx(Qe,{value:"10 - Vale Alimentao",children:"10 - Vale Alimentao"}),a.jsx(Qe,{value:"11 - Vale Refeio",children:"11 - Vale Refeio"}),a.jsx(Qe,{value:"12 - Vale Presente",children:"12 - Vale Presente"}),a.jsx(Qe,{value:"13 - Vale Combustvel",children:"13 - Vale Combustvel"}),a.jsx(Qe,{value:"14 - Duplicata Mercantil",children:"14 - Duplicata Mercantil"}),a.jsx(Qe,{value:"15 - Boleto Bancrio",children:"15 - Boleto Bancrio"}),a.jsx(Qe,{value:"16 - Depsito Bancrio",children:"16 - Depsito Bancrio"}),a.jsx(Qe,{value:"17 - PIX Dinmico (QR-Code)",children:"17 - PIX Dinmico (QR-Code)"}),a.jsx(Qe,{value:"18 - Transferncia Bancria / Carteira Digital",children:"18 - Transferncia Bancria / Carteira Digital"}),a.jsx(Qe,{value:"19 - Programa de Fidelidade / Cashback",children:"19 - Programa de Fidelidade / Cashback"}),a.jsx(Qe,{value:"20 - PIX Esttico",children:"20 - PIX Esttico"}),a.jsx(Qe,{value:"21 - Crdito em Loja",children:"21 - Crdito em Loja"}),a.jsx(Qe,{value:"22 - Pagamento Eletrnico no Informado",children:"22 - Pagamento Eletrnico no Informado"}),a.jsx(Qe,{value:"90 - Sem Pagamento",children:"90 - Sem Pagamento"}),a.jsx(Qe,{value:"99 - Outros",children:"99 - Outros"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Observaes"}),a.jsx(At,{value:q.observacoes||"",onChange:De=>z(wt=>({...wt,observacoes:De.target.value})),placeholder:"Observaes adicionais"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>$({show:!1,purchase:null}),children:"Cancelar"}),a.jsx(Z,{onClick:_r,children:"Salvar Alteraes"})]})]})]})}),a.jsx(Vst,{open:F.show,onOpenChange:De=>V({show:De,purchase:null}),purchase:F.purchase,products:ue,codigoEmpresa:t?.codigo_empresa,autoFile:F.autoFile,onSuccess:()=>{gr(),V({show:!1,purchase:null})}})]})}const uc=Ce.forwardRef(({className:e,...t},r)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:r,className:Er("w-full caption-bottom text-sm",e),...t})}));uc.displayName="Table";const fc=Ce.forwardRef(({className:e,...t},r)=>a.jsx("thead",{ref:r,className:Er("[&_tr]:border-b",e),...t}));fc.displayName="TableHeader";const mc=Ce.forwardRef(({className:e,...t},r)=>a.jsx("tbody",{ref:r,className:Er("[&_tr:last-child]:border-0",e),...t}));mc.displayName="TableBody";const Wst=Ce.forwardRef(({className:e,...t},r)=>a.jsx("tfoot",{ref:r,className:Er("bg-primary font-medium text-primary-foreground",e),...t}));Wst.displayName="TableFooter";const Fs=Ce.forwardRef(({className:e,...t},r)=>a.jsx("tr",{ref:r,className:Er("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));Fs.displayName="TableRow";const _a=Ce.forwardRef(({className:e,...t},r)=>a.jsx("th",{ref:r,className:Er("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));_a.displayName="TableHead";const oa=Ce.forwardRef(({className:e,...t},r)=>a.jsx("td",{ref:r,className:Er("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));oa.displayName="TableCell";const Hst=Ce.forwardRef(({className:e,...t},r)=>a.jsx("caption",{ref:r,className:Er("mt-4 text-sm text-muted-foreground",e),...t}));Hst.displayName="TableCaption";const Gst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},hoe={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},s_=({icon:e,title:t,value:r,color:n,onClick:s,isActive:o})=>{const i=e;return a.jsxs(Mr.div,{variants:hoe,className:Er("bg-surface rounded-lg border p-4 flex items-center gap-4 cursor-pointer transition-all duration-200",o?"border-brand ring-2 ring-brand/50":"border-border hover:border-brand/50"),onClick:s,children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${n}/20`,children:a.jsx(i,{className:`w-6 h-6 ${n}`})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary text-sm font-medium",children:t}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r})]})]})};function Kst({open:e,onOpenChange:t,client:r,onEdit:n,onInactivate:s,codigoEmpresa:o}){const{toast:i}=Xs(),l={scheduled:{bg:"bg-[#3B82F6]/10",text:"text-[#3B82F6]",border:"border-[#3B82F6]/30"},confirmed:{bg:"bg-[#22C55E]/10",text:"text-[#22C55E]",border:"border-[#22C55E]/30"},in_progress:{bg:"bg-[#FACC15]/10",text:"text-[#FACC15]",border:"border-[#FACC15]/30"},finished:{bg:"bg-[#6B7280]/10",text:"text-[#6B7280]",border:"border-[#6B7280]/30"},canceled:{bg:"bg-[#EF4444]/10",text:"text-[#EF4444]",border:"border-[#EF4444]/30"},absent:{bg:"bg-[#F97316]/10",text:"text-[#F97316]",border:"border-[#F97316]/30"}},c=({label:T,value:k})=>a.jsxs("div",{className:"grid grid-cols-12 items-start gap-3 py-2 border-b border-border/50",children:[a.jsx("div",{className:"col-span-5 sm:col-span-4",children:a.jsx("span",{className:"block text-[11px] uppercase tracking-wide text-text-muted font-semibold",children:T})}),a.jsx("div",{className:"col-span-7 sm:col-span-8",children:a.jsx("span",{className:"block text-sm font-medium text-text-primary break-words",children:k})})]}),[d,u]=p.useState(!1),[f,h]=p.useState([]),[m,x]=p.useState(!1),[g,v]=p.useState([]),y=p.useRef(!1),b=p.useRef(!1),[w,j]=p.useState(!1),[_,C]=p.useState(null),[A,S]=p.useState(!1),[P,M]=p.useState(null),O=p.useMemo(()=>{try{const T=(f||[]).map($=>({kind:"comanda",ts:new Date($.aberto_em||$.created_at||0).getTime(),data:$})),k=(g||[]).map($=>({kind:"agendamento",ts:new Date($.inicio||0).getTime(),data:$}));return[...T,...k].sort(($,q)=>q.ts-$.ts).slice(0,10)}catch{return[]}},[f,g]),I=async T=>{try{if(j(!0),C(T?.kind||null),S(!0),M(null),T?.kind==="comanda"){const k=T?.data?.comanda_id;if(!k){S(!1);return}let $=Q.from("comanda_itens").select("id, quantidade, preco_unitario, desconto, produto:produtos!comanda_itens_produto_id_fkey ( nome )").eq("comanda_id",k);o&&($=$.eq("codigo_empresa",o));const{data:q}=await $,z=(q||[]).map(W=>({id:W.id,quantidade:W.quantidade,preco_unitario:W.preco_unitario,desconto:W.desconto,produto_nome:W.produto?.[0]?.nome||W.produto?.nome||"Item"}));let F=Q.from("pagamentos").select("id, valor, status, recebido_em, metodo").eq("comanda_id",k);o&&(F=F.eq("codigo_empresa",o));const{data:V}=await F,ue=V||[];let _e=Q.from("comanda_clientes").select("cliente:clientes!comanda_clientes_cliente_id_fkey ( id, nome, email, telefone )").eq("comanda_id",k);o&&(_e=_e.eq("codigo_empresa",o));const{data:U}=await _e,L=(U||[]).map(W=>W.cliente?.[0]||W.cliente).filter(Boolean),G=(z||[]).reduce((W,Y)=>W+(Number(Y.quantidade||0)*Number(Y.preco_unitario||0)-Number(Y.desconto||0)),0),de=(ue||[]).filter(W=>(W.status||"Pago")!=="Cancelado"&&(W.status||"Pago")!=="Estornado").reduce((W,Y)=>W+Number(Y.valor||0),0),X=Math.max(0,G-de);M({comandaId:k,mesa_title:T?.data?.mesa_title||"Balco",status:T?.data?.status||"open",itens:z||[],pagamentos:ue||[],clientes:L,totalItens:G,totalPagos:de,saldo:X,aberto_em:T?.data?.aberto_em||T?.data?.created_at||null,fechado_em:T?.data?.fechado_em||null})}else if(T?.kind==="agendamento"){const k=T?.data?.id;if(!k){S(!1);return}let $=[];try{const{data:F}=await Q.from("agendamento_participantes").select("cliente_id, nome, valor_cota, status_pagamento").eq("agendamento_id",k).limit(200);$=F||[]}catch{$=[]}const q=Array.from(new Set(($||[]).map(F=>F.cliente_id).filter(Boolean)));let z=[];if(z=($||[]).map(F=>({id:F.cliente_id,nome:F.nome||null,email:null,telefone:null,codigo:null,valor_cota:F.valor_cota??null,status_pagamento:F.status_pagamento||null})),q.length>0)try{const{data:F}=await Q.from("clientes").select("id,nome,email,telefone,codigo").in("id",q),V=new Map((F||[]).map(ue=>[String(ue.id),ue]));z=z.map(ue=>{const _e=V.get(String(ue.id));return _e?{...ue,nome:ue.nome||_e.nome,email:_e.email,telefone:_e.telefone,codigo:_e.codigo}:ue})}catch{}M({id:k,inicio:T?.data?.inicio||null,fim:T?.data?.fim||null,status:T?.data?.status||null,modalidade:T?.data?.modalidade||null,quadra_nome:T?.data?.quadra_nome||null,participantes:z})}}catch{}finally{S(!1)}};return p.useEffect(()=>{let T=!1;if(e&&(y.current=!1,b.current=!1),e&&r?.id&&!o)return u(!1),x(!1),()=>{T=!0};const k=async()=>{if(!e||!r?.id)return;u(!0);const q=Number(r?.codigo??-1)===0;let z=Q.from("comanda_clientes").select("comanda_id, created_at");q?z=z.is("cliente_id",null):z=z.eq("cliente_id",r.id),z=z.order("created_at",{ascending:!1}).limit(50),o&&(z=z.eq("codigo_empresa",o));const{data:F,error:V}=await z;if(V)throw V;const ue=Array.from(new Set((F||[]).map(de=>de.comanda_id).filter(Boolean)));let _e=[];if(!q){let de=Q.from("comandas").select("id, status, aberto_em, fechado_em").eq("cliente_id",r.id).order("aberto_em",{ascending:!1}).limit(10);o&&(de=de.eq("codigo_empresa",o));const{data:X,error:W}=await de;if(W)throw W;_e=X||[]}const U=Array.from(new Set((_e||[]).map(de=>de.id))),L=Array.from(new Set([...ue,...U]));if(L.length===0){h([]),u(!1);return}let G;try{G=setTimeout(()=>u(!1),1e4)}catch{}try{let de=Q.from("comandas").select("id,status,aberto_em,fechado_em, mesa:mesas!comandas_mesa_id_fkey ( nome, numero )").in("id",L);o&&(de=de.eq("codigo_empresa",o));const{data:X,error:W}=await de;if(W)throw W;const Y=new Map((X||[]).map(_t=>[_t.id,_t]));let me=Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",L);o&&(me=me.eq("codigo_empresa",o));const{data:ee,error:ae}=await me;if(ae)throw ae;const le={};for(const _t of ee||[]){const gr=Number(_t.quantidade||0)*Number(_t.preco_unitario||0),be=Number(_t.desconto||0);le[_t.comanda_id]=(le[_t.comanda_id]||0)+Math.max(0,gr-be)}let Te=Q.from("pagamentos").select("comanda_id, valor, status, recebido_em, metodo").in("comanda_id",L);o&&(Te=Te.eq("codigo_empresa",o));const{data:te,error:ie}=await Te;if(ie)throw ie;const xt={};for(const _t of te||[])(_t.status||"Pago")!=="Cancelado"&&(_t.status||"Pago")!=="Estornado"&&(xt[_t.comanda_id]=(xt[_t.comanda_id]||0)+Number(_t.valor||0));const vt=(_t,gr=null)=>{const be=Y.get(_t)||{},Nt=Number(le[_t]||0),Wt=Number(xt[_t]||0),_r=Math.max(0,Nt-Wt),yr=be.mesa?.[0]?.nome||be.mesa?.nome||null,ve=be.mesa?.[0]?.numero||be.mesa?.numero||null,at=yr||(ve!=null?`Mesa ${ve}`:"Balco");return{comanda_id:_t,created_at:gr,aberto_em:be.aberto_em||null,fechado_em:be.fechado_em||null,status:be.status||"open",total:Nt,pago:Wt,saldo:_r,mesa_title:at}},dt=(F||[]).map(_t=>vt(_t.comanda_id,_t.created_at)),St=(_e||[]).filter(_t=>!(ue||[]).includes(_t.id)).map(_t=>vt(_t.id,_t.aberto_em)),ft=[...dt,...St].sort((_t,gr)=>{const be=new Date(_t.aberto_em||_t.created_at||0).getTime();return new Date(gr.aberto_em||gr.created_at||0).getTime()-be}).slice(0,10);if(!T&&ft.length===0&&!y.current){y.current=!0,console.debug("[ClientDetailsModal] loadHistory: empty result, retrying once..."),setTimeout(()=>{e&&r?.id&&k()},700);return}T||h(ft)}catch(de){i({title:"Falha ao carregar histrico do cliente",description:de?.message||"Tente novamente",variant:"destructive"})}finally{try{clearTimeout(G)}catch{}T||u(!1)}},$=async()=>{if(!e||!r?.id)return;x(!0);let q;try{q=setTimeout(()=>x(!1),1e4)}catch{}try{console.debug("[ClientDetailsModal] loadBookings: start",{clientId:r.id,codigoEmpresa:o});let z=Q.from("agendamentos").select(`
            id, inicio, fim, status, modalidade,
            quadra:quadra_id ( nome )
          `).eq("cliente_id",r.id).order("inicio",{ascending:!1}).limit(10);o&&(z=z.eq("codigo_empresa",o));const{data:F,error:V}=await z;if(V)throw V;const ue=(F||[]).map(me=>({id:me.id,inicio:me.inicio,fim:me.fim,status:me.status,modalidade:me.modalidade,quadra_nome:me.quadra?.[0]?.nome||me.quadra?.nome||null}));let _e=Q.from("v_agendamento_participantes").select("agendamento_id").eq("cliente_id",r.id).limit(30);const{data:U,error:L}=await _e;if(L)throw L;const G=Array.from(new Set((U||[]).map(me=>me.agendamento_id).filter(Boolean))),de=new Set((ue||[]).map(me=>me.id)),X=G.filter(me=>!de.has(me));let W=[];if(X.length>0){let me=Q.from("agendamentos").select(`
              id, inicio, fim, status, modalidade,
              quadra:quadra_id ( nome )
            `).in("id",X);o&&(me=me.eq("codigo_empresa",o));const{data:ee,error:ae}=await me;if(ae)throw ae;W=(ee||[]).map(le=>({id:le.id,inicio:le.inicio,fim:le.fim,status:le.status,modalidade:le.modalidade,quadra_nome:le.quadra?.[0]?.nome||le.quadra?.nome||null}))}const Y=[...ue,...W].sort((me,ee)=>new Date(ee.inicio)-new Date(me.inicio)).slice(0,10);if(!T&&Y.length===0&&!b.current){b.current=!0,console.debug("[ClientDetailsModal] loadBookings: empty result, retrying once..."),setTimeout(()=>{e&&r?.id&&$()},700);return}T||v(Y)}catch(z){console.warn("[ClientDetailsModal] Falha ao carregar agendamentos do cliente:",z)}finally{try{clearTimeout(q)}catch{}T||x(!1)}};return k(),$(),()=>{T=!0,e||(u(!1),x(!1))}},[e,r?.id,o]),r?a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto w-full",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Detalhes do Cliente"}),a.jsx(la,{children:"Informaes cadastrais e histrico recente deste cliente."})]}),a.jsxs("div",{className:"p-4 sm:p-6 space-y-6 sm:space-y-8",children:[a.jsx("div",{className:"overflow-hidden",children:a.jsx("div",{className:"flex items-start justify-between gap-4",children:a.jsxs("div",{className:"min-w-0",children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-extrabold tracking-tight text-text-primary truncate",children:r.nome}),a.jsxs("div",{className:"mt-2 flex items-center flex-wrap gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-surface-2 border border-border text-text-secondary",children:["Cdigo: ",a.jsx("span",{className:"text-text-primary font-mono",children:r.codigo})]}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold border ${r.status==="active"?"bg-emerald-500/10 text-emerald-400 border-emerald-400/30":"bg-rose-500/10 text-rose-400 border-rose-400/30"}`,children:r.status==="active"?"Ativo":"Inativo"}),r.flag_cliente&&a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),r.flag_fornecedor&&a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]}),a.jsx("span",{className:"mt-2 block text-sm text-text-secondary truncate",children:r.email||""})]})})}),a.jsx("div",{className:"grid grid-cols-1 gap-8",children:a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-text-secondary mb-2",children:"Informaes Cadastrais"}),a.jsxs("div",{className:"bg-surface-2 p-3 sm:p-4 rounded-lg space-y-1",children:[a.jsx(c,{label:"Cdigo",value:r.codigo}),a.jsx(c,{label:"CPF/CNPJ",value:r.cpf||r.cnpj||""}),a.jsx(c,{label:"Telefone",value:r.telefone||""}),a.jsx(c,{label:"Aniversrio",value:r.aniversario?new Date(r.aniversario).toLocaleDateString("pt-BR"):""}),a.jsx(c,{label:"Email",value:r.email||""}),a.jsx(c,{label:"Status",value:r.status==="active"?"Ativo":"Inativo"})]})]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary",children:[a.jsx(zue,{className:"w-5 h-5 text-text-secondary"}),a.jsx("h4",{className:"font-semibold",children:"Histrico Recente"})]}),a.jsx("div",{className:"bg-surface-2 p-3 sm:p-4 rounded-lg",children:d&&m?a.jsx("div",{className:"text-center py-8 text-sm text-text-muted",children:"Carregando histrico..."}):O&&O.length>0?a.jsx("div",{className:"max-h-64 overflow-y-auto thin-scroll pr-1",children:a.jsx("div",{className:"space-y-3",children:O.map((T,k)=>a.jsxs("div",{className:"group flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 p-3 rounded-md border border-border/60 bg-background cursor-pointer transition-colors transition-shadow hover:bg-surface-2/60 hover:shadow-md hover:border-brand/30",title:"Clique para ver detalhes",onClick:()=>I(T),children:[a.jsx("div",{className:"min-w-0",children:T.kind==="comanda"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:T.data.mesa_title||"Balco"}),a.jsx("div",{className:"text-xs text-text-secondary truncate",children:(()=>{const $=T.data;return $.aberto_em?new Date($.aberto_em).toLocaleString("pt-BR"):new Date($.created_at).toLocaleString("pt-BR")})()})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:T.data.modalidade||"Agendamento"}),a.jsxs("div",{className:"text-xs text-text-secondary truncate",children:[new Date(T.data.inicio).toLocaleString("pt-BR"),"  ",T.data.quadra_nome||"Quadra"]})]})}),a.jsx("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-end",children:T.kind==="comanda"?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:Er("px-2 py-1 text-[11px] font-semibold rounded-full border",T.data.status==="closed"||T.data.fechado_em?"bg-success/10 text-success border-success/30":T.data.status==="awaiting-payment"?"bg-info/10 text-info border-info/30":"bg-warning/10 text-warning border-warning/30"),children:T.data.status==="closed"||T.data.fechado_em?"Fechada":T.data.status==="awaiting-payment"?"Pagamento":"Em uso"}),a.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[11px] text-text-secondary whitespace-nowrap",children:"Clique para detalhes"})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:Er("px-2 py-1 text-[11px] font-semibold rounded-full border",(()=>{const $=String(T.data.status||"").toLowerCase(),q=l[$]||l.scheduled;return`${q.bg} ${q.text} ${q.border}`})()),children:(()=>{switch(T.data.status){case"finished":return"Finalizado";case"canceled":return"Cancelado";case"in_progress":return"Em andamento";case"confirmed":return"Confirmado";case"absent":return"Ausente";case"scheduled":default:return"Agendado"}})()}),a.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[11px] text-text-secondary whitespace-nowrap",children:"Clique para detalhes"})]})})]},`${T.kind}-${k}`))})}):a.jsx("div",{className:"text-center py-8 text-sm text-text-muted",children:"Sem registros recentes para este cliente."})})]}),a.jsx(zn,{open:w,onOpenChange:j,children:a.jsxs(qn,{className:"sm:max-w-[700px] w-full max-h-[85vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:_==="comanda"?P?.mesa_title||"Detalhes da Comanda":"Detalhes do Agendamento"}),a.jsx(la,{children:_==="comanda"?"Itens e pagamentos desta comanda.":"Informaes do agendamento e participantes."}),a.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:"Cliente:"}),a.jsx("span",{className:"text-sm font-medium text-text-primary",children:r?.nome||""}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-surface-2 border border-border text-text-secondary",children:["Cdigo: ",a.jsx("span",{className:"text-text-primary font-mono",children:r?.codigo??""})]})]})]}),a.jsx("div",{className:"space-y-4",children:A?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando detalhes..."}):_==="comanda"&&P?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Status"}),a.jsx("p",{className:"font-semibold",children:(()=>{const T=String(P.status||"").toLowerCase();return T==="closed"||P.fechado_em?"Fechada":T==="awaiting-payment"?"Aguardando pagamento":"Aberta"})()})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Abertura"}),a.jsx("p",{className:"font-semibold",children:P.aberto_em?new Date(P.aberto_em).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Fechamento"}),a.jsx("p",{className:"font-semibold",children:P.fechado_em?new Date(P.fechado_em).toLocaleString("pt-BR"):""})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Itens"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(P.itens||[]).map(T=>a.jsxs("div",{className:"p-2 flex flex-col sm:grid sm:grid-cols-12 gap-1 sm:gap-2 text-sm",children:[a.jsx("div",{className:"sm:col-span-6 font-medium",children:T.produto_nome||"Item"}),a.jsxs("div",{className:"sm:col-span-2 sm:text-right text-text-muted",children:["Qtd: ",Number(T.quantidade||0)]}),a.jsxs("div",{className:"sm:col-span-2 sm:text-right",children:["R$ ",Number(T.preco_unitario||0).toFixed(2)]}),a.jsx("div",{className:"sm:col-span-2 sm:text-right text-text-secondary",children:Number(T.desconto||0)?`- R$ ${Number(T.desconto||0).toFixed(2)}`:""})]},T.id)),(!P.itens||P.itens.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum item."})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Pagamentos"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(P.pagamentos||[]).map(T=>a.jsxs("div",{className:"p-2 flex items-center justify-between text-sm",children:[a.jsxs("span",{className:"truncate",children:[T.metodo||""," ",T.status?`(${T.status})`:""]}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Number(T.valor||0).toFixed(2)]})]},T.id)),(!P.pagamentos||P.pagamentos.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum pagamento registrado."})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total de Itens"}),a.jsxs("p",{className:"font-bold",children:["R$ ",Number(P.totalItens||0).toFixed(2)]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total Pago"}),a.jsxs("p",{className:"font-bold text-success",children:["R$ ",Number(P.totalPagos||0).toFixed(2)]})]})]})]}):_==="agendamento"&&P?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Modalidade"}),a.jsx("p",{className:"font-semibold",children:P.modalidade||""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Quadra"}),a.jsx("p",{className:"font-semibold",children:P.quadra_nome||""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Incio"}),a.jsx("p",{className:"font-semibold",children:P.inicio?new Date(P.inicio).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Fim"}),a.jsx("p",{className:"font-semibold",children:P.fim?new Date(P.fim).toLocaleString("pt-BR"):""})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Participantes"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(P.participantes||[]).map((T,k)=>a.jsxs("div",{className:"p-2 text-sm flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3",children:[a.jsx("div",{className:"min-w-0",children:a.jsxs("div",{className:"flex items-center gap-2",children:[T.codigo!==null&&T.codigo!==void 0&&a.jsxs("span",{className:`text-xs font-bold rounded px-1.5 py-0.5 shrink-0 ${String(T.status_pagamento||"").toLowerCase()==="pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",T.codigo]}),a.jsx("span",{className:"font-medium truncate",children:T.nome||"Participante"})]})}),a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-end",children:[T.valor_cota!=null&&a.jsxs("span",{className:"text-xs font-semibold text-text-secondary",children:["R$ ",Number(T.valor_cota||0).toFixed(2)]}),a.jsx("span",{className:`text-[11px] font-semibold rounded-full px-2 py-0.5 border ${String(T.status_pagamento||"").toLowerCase()==="pago"?"bg-success/10 text-success border-success/30":"bg-warning/10 text-warning border-warning/30"}`,children:String(T.status_pagamento||T.status_pagamento_text||"Pendente")})]})]},`${T.id}-${k}`)),(!P.participantes||P.participantes.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum participante encontrado."})]})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma informao para exibir."})}),a.jsx(Ua,{children:a.jsx(Z,{variant:"outline",onClick:()=>j(!1),children:"Fechar"})})]})})]}),a.jsxs(Ua,{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-0 sm:justify-between",children:[!r?.is_consumidor_final&&a.jsx("div",{className:"w-full sm:flex-1",children:a.jsxs(Z,{type:"button",variant:"destructive",className:"bg-red-600 hover:bg-red-500 text-white w-full sm:w-auto",onClick:()=>s?.(r),children:[a.jsx(SG,{className:"mr-2 h-4 w-4"})," Inativar Cliente"]})}),a.jsxs("div",{className:"flex gap-2 w-full sm:w-auto sm:ml-auto",children:[a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"flex-1 sm:flex-none",children:"Fechar"})}),!r?.is_consumidor_final&&a.jsxs(Z,{onClick:()=>n(r),className:"flex-1 sm:flex-none",children:[a.jsx(xc,{className:"mr-2 h-4 w-4"})," Editar Cliente"]})]})]})]})}):null}function Xst(){const{toast:e}=Xs(),{userProfile:t,authReady:r}=fo(),n=Mi(),[s,o]=p.useState(()=>{try{const L=localStorage.getItem("auth:userProfile"),G=L&&JSON.parse(L)?.codigo_empresa||null,de=G?`clientes:list:${G}`:"clientes:list",X=JSON.parse(localStorage.getItem(de)||"[]");return Array.isArray(X)?X:[]}catch{return[]}}),[i,l]=p.useState(!1),[c,d]=p.useState(!0),[u,f]=p.useState(!1),[h,m]=p.useState(!1),[x,g]=p.useState(null),[v,y]=p.useState(null),[b,w]=p.useState({searchTerm:"",status:"all",tipo:"todos"}),j=p.useRef(!1),_=p.useRef(0),C=p.useRef(0),A=p.useRef(!1);p.useEffect(()=>{n.state?.openModal&&!u&&!A.current&&(A.current=!0,f(!0),window.history.replaceState({},document.title))},[n.state?.openModal,u]);const S=async()=>{try{const L=s&&s.length>0;if(L||l(!0),!t?.codigo_empresa)return;const G=`clientes:list:${t.codigo_empresa}`;let de=Q.from("clientes").select("*, is_consumidor_final").eq("codigo_empresa",t.codigo_empresa).order("codigo",{ascending:!0});if(b.searchTerm.trim()!==""){const ee=b.searchTerm.trim();/^\d+$/.test(ee)?de=de.or(`codigo.eq.${ee},nome.ilike.%${ee}%,email.ilike.%${ee}%,telefone.ilike.%${ee}%`):de=de.or(`nome.ilike.%${ee}%,email.ilike.%${ee}%,telefone.ilike.%${ee}%`)}b.status!=="all"&&(de=de.eq("status",b.status));const X=setTimeout(()=>{try{if(!L){const ee=JSON.parse(localStorage.getItem(G)||"[]");Array.isArray(ee)&&ee.length>0&&(console.warn("[Clientes] slow fallback: using cached snapshot"),o(ee),C.current=ee.length)}}catch{}},2e3),{data:W,error:Y}=await de;if(Y){if(!j.current){j.current=!0,setTimeout(S,900);return}throw Y}const me=W||[];if(me.length===0&&L&&!j.current){j.current=!0,setTimeout(S,700);return}j.current=!1,o(me);try{localStorage.setItem(G,JSON.stringify(me))}catch{}C.current=me.length,_.current=Date.now()}catch(L){e({title:"Erro ao carregar clientes",description:L.message,variant:"destructive"})}finally{l(!1);try{clearTimeout(slowFallback)}catch{}}};p.useEffect(()=>{try{const L=localStorage.getItem("auth:userProfile"),G=t?.codigo_empresa||L&&JSON.parse(L)?.codigo_empresa||null;if(G){const de=`clientes:list:${G}`,X=JSON.parse(localStorage.getItem(de)||"[]");Array.isArray(X)&&X.length&&s.length===0&&(o(X),C.current=X.length)}}catch{}if(r&&t?.codigo_empresa){const L=setTimeout(S,50);return()=>clearTimeout(L)}return()=>{}},[r,t?.codigo_empresa]),p.useEffect(()=>{if(r&&t?.codigo_empresa){const L=setTimeout(S,200);return()=>clearTimeout(L)}return()=>{}},[b.searchTerm,b.status,r,t?.codigo_empresa]),p.useEffect(()=>{const L=()=>{(Date.now()-(_.current||0)>3e4||C.current===0)&&r&&t?.codigo_empresa&&S()},G=()=>{document.visibilityState==="visible"&&(Date.now()-(_.current||0)>3e4||C.current===0)&&r&&t?.codigo_empresa&&S()};return window.addEventListener("focus",L),document.addEventListener("visibilitychange",G),()=>{window.removeEventListener("focus",L),document.removeEventListener("visibilitychange",G)}},[r,t?.codigo_empresa]);const P=p.useMemo(()=>{const G=new Date().getMonth();return{total:s.length,birthdays:s.filter(de=>de.aniversario&&new Date(de.aniversario).getMonth()===G).length,active:s.filter(de=>de.status==="active").length}},[s]);function M(L){const G=["Cdigo","Tipo Pessoa","Nome/Razo Social","Apelido/Nome Fantasia","CPF","CNPJ","RG","IE","Email","Telefone","Fone 2","Celular 1","Celular 2","WhatsApp","CEP","Endereo","Nmero","Complemento","Bairro","Cidade","UF","Cidade IBGE","Limite Crdito","Tipo Recebimento","Regime Tributrio","Tipo Contribuinte","Aniversrio","Sexo","Estado Civil","Nome da Me","Nome do Pai","Observaes"," Cliente"," Fornecedor"," Funcionrio"," Administradora"," Parceiro","CCF/SPC","Status"],de=";",X=te=>{if(!te)return"";try{const ie=new Date(te);if(!isNaN(ie)){const xt=String(ie.getDate()).padStart(2,"0"),vt=String(ie.getMonth()+1).padStart(2,"0"),dt=ie.getFullYear();return`${xt}/${vt}/${dt}`}}catch{}return String(te)},W=te=>{const ie=Number(te??0);return Number.isFinite(ie)?ie.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},Y=te=>te?"Sim":"No",me=te=>{const ie=te==null?"":String(te);return/[";\n]/.test(ie)?`"${ie.replace(/"/g,'""')}"`:ie},ee=[];ee.push("\uFEFF"+G.join(de));for(const te of L){const ie=[te.codigo??"",te.tipo_pessoa||"",te.nome||"",te.apelido||"",te.cpf||"",te.cnpj||"",te.rg||"",te.ie||"",te.email||"",te.telefone||"",te.fone2||"",te.celular1||"",te.celular2||"",te.whatsapp||"",te.cep||"",te.endereco||"",te.numero||"",te.complemento||"",te.bairro||"",te.cidade||"",te.uf||"",te.cidade_ibge||"",W(te.limite_credito),te.tipo_recebimento||"",te.regime_tributario||"",te.tipo_contribuinte||"",X(te.aniversario),te.sexo||"",te.estado_civil||"",te.nome_mae||"",te.nome_pai||"",te.observacoes||"",Y(!!te.flag_cliente),Y(!!te.flag_fornecedor),Y(!!te.flag_funcionario),Y(!!te.flag_administradora),Y(!!te.flag_parceiro),Y(!!te.flag_ccf_spc),te.status==="active"?"Ativo":"Inativo"].map(me).join(de);ee.push(ie)}const ae=new Blob([ee.join(`
`)],{type:"text/csv;charset=utf-8;"}),le=URL.createObjectURL(ae),Te=document.createElement("a");Te.href=le,Te.download="clientes.csv",document.body.appendChild(Te),Te.click(),document.body.removeChild(Te),URL.revokeObjectURL(le)}const O=()=>{try{M(I),e({title:"Exportao concluda",description:`${I.length} cliente(s) exportado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(L){e({title:"Falha ao exportar",description:L?.message||"No foi possvel gerar o arquivo.",variant:"destructive"})}},I=p.useMemo(()=>(new Date().getMonth(),s.filter(G=>{const de=b.searchTerm.toLowerCase()===""||(G.nome||"").toLowerCase().includes(b.searchTerm.toLowerCase())||(G.cpf||"").includes(b.searchTerm)||(G.telefone||"").includes(b.searchTerm),X=b.status==="all"||G.status===b.status;let W=!0;return b.tipo==="clientes"?W=G.flag_cliente===!0:b.tipo==="fornecedores"?W=G.flag_fornecedor===!0:b.tipo==="ambos"&&(W=G.flag_cliente===!0&&G.flag_fornecedor===!0),de&&X&&W})),[s,b]),[T,k]=p.useState({by:"codigo",dir:"asc"}),$=L=>{k(G=>G.by===L&&G.dir==="asc"?{by:L,dir:"desc"}:{by:L,dir:"asc"})},q=p.useMemo(()=>{const L=I.find(Y=>Y?.is_consumidor_final===!0),de=[...I.filter(Y=>Y?.is_consumidor_final!==!0)],X=T.dir==="asc"?1:-1,W=(Y,me)=>Number.isFinite(Y)?Y:me;return de.sort((Y,me)=>{if(T.by==="codigo"){const ee=W(parseInt(String(Y.codigo||"").trim(),10),1/0),ae=W(parseInt(String(me.codigo||"").trim(),10),1/0);return ee===ae?0:ee>ae?X:-X}if(T.by==="nome"){const ee=(Y.nome||"").toString(),ae=(me.nome||"").toString();return ee.localeCompare(ae,"pt-BR",{sensitivity:"base"})*X}return 0}),L?[L,...de]:de},[I,T]),z=L=>{g(L),m(!0)},F=()=>{y(null),f(!0)},V=L=>{m(!1),y(L),f(!0)},ue=async L=>{try{const{error:G}=await Q.from("clientes").update({status:"inactive"}).eq("id",L.id);if(G)throw G;m(!1),e({title:"Cliente inativado",description:`${L.nome} foi marcado como inativo.`}),S()}catch(G){e({title:"Erro ao inativar cliente",description:G.message,variant:"destructive"})}},_e=()=>{w({searchTerm:"",status:"all",tipo:"todos"})},U=b.searchTerm!==""||b.status!=="all"||b.tipo!=="todos";return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-full flex flex-col",children:a.jsxs(Mr.div,{variants:Gst,initial:"hidden",animate:"visible",children:[a.jsxs(Mr.div,{variants:hoe,className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary tracking-tighter",children:"Clientes & Fornecedores"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Gesto completa de clientes e fornecedores"})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:()=>d(L=>!L),title:c?"Ocultar resumo":"Mostrar resumo","aria-label":c?"Ocultar resumo":"Mostrar resumo",className:"flex-shrink-0",children:c?a.jsx(Og,{className:"h-4 w-4"}):a.jsx(Jg,{className:"h-4 w-4"})}),a.jsxs(Z,{variant:"outline",onClick:O,className:"text-sm",children:[a.jsx(ys,{className:"mr-2 h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),a.jsx("span",{className:"sm:hidden",children:"CSV"})]}),a.jsxs(Z,{onClick:F,className:"text-sm",children:[a.jsx(to,{className:"mr-2 h-4 w-4"})," ",a.jsx("span",{className:"hidden xs:inline",children:"Novo"}),a.jsx("span",{className:"xs:hidden",children:"Novo"})]})]})]}),c&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[a.jsx(s_,{icon:vc,title:"Total de Clientes",value:s.filter(L=>L.flag_cliente).length,color:"text-brand",onClick:()=>w(L=>({...L,tipo:"clientes"})),isActive:b.tipo==="clientes"}),a.jsx(s_,{icon:vc,title:"Total de Fornecedores",value:s.filter(L=>L.flag_fornecedor).length,color:"text-purple-500",onClick:()=>w(L=>({...L,tipo:"fornecedores"})),isActive:b.tipo==="fornecedores"}),a.jsx(s_,{icon:$ue,title:"Aniversariantes do Ms",value:P.birthdays,color:"text-info",onClick:()=>w(L=>({...L,tipo:"todos"})),isActive:b.tipo==="todos"}),a.jsx(s_,{icon:$m,title:"Ativos",value:P.active,color:"text-success",onClick:()=>w(L=>({...L,status:"active"})),isActive:b.status==="active"})]}),a.jsx(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsxs("div",{className:"p-4 border-b border-border flex flex-col gap-4",children:[a.jsxs("div",{className:"relative w-full",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar por nome, CPF ou telefone...",className:"pl-9",value:b.searchTerm,onChange:L=>w(G=>({...G,searchTerm:L.target.value}))})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[a.jsxs(ea,{value:b.tipo,onValueChange:L=>w(G=>({...G,tipo:L})),children:[a.jsx(Jn,{className:"w-full sm:w-[200px]",children:a.jsx(ra,{placeholder:"Tipo"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"todos",children:"Todos"}),a.jsx(Qe,{value:"clientes",children:"Apenas Clientes"}),a.jsx(Qe,{value:"fornecedores",children:"Apenas Fornecedores"}),a.jsx(Qe,{value:"ambos",children:"Clientes e Fornecedores"})]})]}),a.jsxs(ea,{value:b.status,onValueChange:L=>w(G=>({...G,status:L})),children:[a.jsx(Jn,{className:"w-full sm:w-[180px]",children:a.jsx(ra,{placeholder:"Status"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todos os Status"}),a.jsx(Qe,{value:"active",children:"Ativos"}),a.jsx(Qe,{value:"inactive",children:"Inativos"})]})]}),U&&a.jsxs(Z,{variant:"ghost",onClick:_e,className:"w-full sm:w-auto",children:[a.jsx(Dg,{className:"mr-2 h-4 w-4"}),"Limpar Filtros"]})]})]}),a.jsx("div",{className:"md:hidden space-y-3 p-4",children:i?a.jsx("div",{className:"text-center py-8 text-text-muted",children:"Carregando..."}):q.length>0?q.map(L=>{const G=L?.is_consumidor_final===!0;return a.jsxs("div",{className:Er("rounded-lg border bg-surface p-4 space-y-3 cursor-pointer transition-all",G?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-4 border-l-amber-500/40 border-t-border border-r-border border-b-border":"border-border hover:border-brand/50"),onClick:()=>z(L),children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx("span",{className:Er("font-mono text-sm font-semibold",G?"text-amber-300/90":"text-text-primary"),children:L.codigo}),a.jsx("span",{className:Er("px-2 py-0.5 text-xs font-semibold rounded-full flex-shrink-0",L.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:L.status==="active"?"Ativo":"Inativo"})]}),a.jsxs("div",{children:[a.jsx("h3",{className:Er("font-semibold text-base mb-1",G?"text-amber-100/90":"text-text-primary"),children:L.nome||""}),G&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium mb-1",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]}),a.jsx("p",{className:"text-sm text-text-muted",children:L.cpf&&`CPF: ${L.cpf}`||L.cnpj&&`CNPJ: ${L.cnpj}`||(L.apelido?`Apelido: ${L.apelido}`:" ")})]}),a.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[L.flag_cliente&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),L.flag_fornecedor&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]}),(L.telefone||L.email)&&a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Contato"}),a.jsx("span",{className:"text-sm font-medium",children:L.telefone||L.email})]}),a.jsx("div",{className:"text-xs text-text-muted text-center pt-2 border-t border-border/50",children:"Toque para ver detalhes"})]},L.id)}):a.jsx("div",{className:"text-center py-8 text-text-muted",children:"Nenhum cliente encontrado com os filtros aplicados."})}),a.jsx("div",{className:"hidden md:block",children:a.jsxs(uc,{children:[a.jsx(fc,{className:"sticky top-0 bg-surface-2 z-10",children:a.jsxs(Fs,{className:"border-b border-border",children:[a.jsxs(_a,{className:"select-none cursor-pointer text-text-secondary",onClick:()=>$("codigo"),title:"Ordenar por cdigo",children:["Cdigo ",T.by==="codigo"?T.dir==="asc"?"":"":""]}),a.jsxs(_a,{className:"text-text-secondary select-none cursor-pointer",onClick:()=>$("nome"),title:"Ordenar por nome",children:["Cliente ",T.by==="nome"?T.dir==="asc"?"":"":""]}),a.jsx(_a,{className:"text-text-secondary",children:"Contato"}),a.jsx(_a,{className:"text-text-secondary",children:"Tipo"}),a.jsx(_a,{className:"text-text-secondary",children:"Status"})]})}),a.jsx(mc,{children:i?a.jsx(Fs,{children:a.jsx(oa,{colSpan:5,className:"h-24 text-center",children:"Carregando..."})}):q.length>0?q.map(L=>{const G=L?.is_consumidor_final===!0;return a.jsxs(Fs,{className:Er("cursor-pointer transition-all",G?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":"hover:bg-surface-2"),onClick:()=>z(L),children:[a.jsx(oa,{className:Er("font-mono text-base font-semibold",G?"text-amber-300/90":"text-text-primary"),children:L.codigo}),a.jsx(oa,{children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:Er("text-base font-semibold truncate",G?"text-amber-100/90":"text-text-primary"),children:L.nome||""}),G&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]}),a.jsx("span",{className:"text-xs text-text-muted truncate",children:L.cpf&&`CPF: ${L.cpf}`||L.cnpj&&`CNPJ: ${L.cnpj}`||(L.apelido?`Apelido: ${L.apelido}`:" ")})]})}),a.jsx(oa,{children:a.jsx("div",{className:"flex flex-col",children:a.jsx("span",{className:"text-sm truncate",children:L.telefone||L.email||""})})}),a.jsx(oa,{children:a.jsxs("div",{className:"flex flex-wrap gap-1",children:[L.flag_cliente&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),L.flag_fornecedor&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]})}),a.jsx(oa,{children:a.jsx("span",{className:Er("px-2 py-1 text-xs font-semibold rounded-full",L.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:L.status==="active"?"Ativo":"Inativo"})})]},L.id)}):a.jsx(Fs,{children:a.jsx(oa,{colSpan:5,className:"h-24 text-center",children:"Nenhum cliente encontrado com os filtros aplicados."})})})]})})]})})]})}),a.jsx(jne,{open:u,onOpenChange:f,client:v,onSaved:S}),a.jsx(Kst,{open:h,onOpenChange:m,client:x,onEdit:V,onInactivate:ue,codigoEmpresa:t?.codigo_empresa})]})}const Yst=[],Jst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},poe={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},Dk=({icon:e,title:t,value:r,color:n})=>{const s=e;return a.jsxs(Mr.div,{variants:poe,className:"bg-surface rounded-lg border border-border p-4 flex items-center gap-4",children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${n}/20`,children:a.jsx(s,{className:`w-6 h-6 ${n}`})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary text-sm font-medium",children:t}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r})]})]})};function Qst({open:e,onOpenChange:t,member:r,onEdit:n}){return r?a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"sm:max-w-[500px] w-full",children:[a.jsx(Bn,{children:a.jsx($n,{children:"Detalhes do Funcionrio"})}),a.jsxs("div",{className:"p-4 sm:p-6 space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-xl font-bold",children:r.name}),a.jsx("p",{className:"text-brand font-semibold",children:r.role})]}),a.jsxs("div",{className:"bg-surface-2 p-8 rounded-lg text-center border border-border",children:[a.jsx("p",{className:"text-lg font-semibold text-text-secondary",children:" Em desenvolvimento"}),a.jsx("p",{className:"text-sm text-text-muted mt-2",children:"Detalhes completos do funcionrio estaro disponveis em breve."})]})]}),a.jsxs(Ua,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Fechar"})}),a.jsxs(Z,{onClick:()=>n(r),className:"w-full sm:w-auto",children:[a.jsx(xc,{className:"mr-2 h-4 w-4"})," Editar"]})]})]})}):null}function Zst({open:e,onOpenChange:t,member:r,onSave:n,loading:s}){const{toast:o}=Xs(),[i,l]=p.useState(r?.name||""),[c,d]=p.useState(r?.role||"");p.useEffect(()=>{e&&(l(r?.name||""),d(r?.role||""))},[r,e]);const u=async f=>{if(f.preventDefault(),!i.trim()){o({title:"Nome  obrigatrio",variant:"destructive"});return}await n({name:i.trim(),role:c.trim()})};return a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"sm:max-w-[700px] w-full",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:r?"Editar Funcionrio":"Novo Funcionrio"}),a.jsx(la,{children:"Informe apenas nome e cargo. O cargo  livre (texto)."})]}),a.jsx("form",{onSubmit:u,className:"py-2",children:a.jsx("div",{className:"bg-surface-2 border border-border rounded-lg p-4 space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{htmlFor:"name",children:"Nome"}),a.jsxs("div",{className:"relative",children:[a.jsx(Tf,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{id:"name",value:i,onChange:f=>l(f.target.value),className:"pl-9",placeholder:"Ex.: Maria Silva"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{htmlFor:"role",children:"Cargo"}),a.jsxs("div",{className:"relative",children:[a.jsx(Vue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{id:"role",value:c,onChange:f=>d(f.target.value),className:"pl-9",placeholder:"Ex.: Gerente, Caixa, ..."})]})]})]})})}),a.jsxs(Ua,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(tp,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Cancelar"})}),a.jsx(Z,{type:"submit",onClick:u,disabled:!!s,className:"w-full sm:w-auto",children:s?"Salvando...":"Salvar"})]})]})})}function eot(){const{company:e,authReady:t,userProfile:r}=fo(),{toast:n}=Xs(),[s,o]=p.useState(Yst),[i,l]=p.useState(!1),[c,d]=p.useState(!1),[u,f]=p.useState(null),[h,m]=p.useState(null),[x,g]=p.useState(""),[v,y]=p.useState(!1),b=p.useRef(!1),w=p.useRef(!0);p.useEffect(()=>(w.current=!0,()=>{w.current=!1}),[]);const j=async()=>{try{const T=e?.codigo_empresa||null;if(!T&&!e?.id)return;const k=T?`team:list:${T}`:"team:list",$=setTimeout(()=>{if(w.current)try{const U=localStorage.getItem(k),L=U?JSON.parse(U):[];Array.isArray(L)&&L.length>0&&(console.warn("[Equipe] slow fallback: using cached snapshot"),o(L))}catch{}},5e3);let q=Q.from("colaboradores").select("*").order("nome",{ascending:!0});T&&(q=q.eq("codigo_empresa",T));const{data:z,error:F}=await q;if(F){if(!b.current){b.current=!0,setTimeout(j,800);return}throw F}let ue=(z||[]).map(U=>({id:U.id,name:U.nome||"",role:U.cargo||"user",status:U.ativo===!1?"inactive":"active",online:!1,permissions:{}}));const _e=r?.codigo_empresa&&e?.codigo_empresa&&r.codigo_empresa===e.codigo_empresa;if(r?.id&&_e&&(ue.some(L=>L.id===r.id)||(ue=[{id:r.id,name:r.nome||"Voc",role:r.cargo||"user",status:"active",online:!1,permissions:{}},...ue])),!w.current)return;o(ue);try{localStorage.setItem(k,JSON.stringify(ue))}catch{}}catch(T){console.error("Falha ao carregar equipe:",T);const k=e?.codigo_empresa||null,$=k?`team:list:${k}`:"team:list";try{const q=localStorage.getItem($);q&&w.current&&o(JSON.parse(q))}catch{}}finally{b.current=!1}};p.useEffect(()=>{const T=e?.codigo_empresa||null;if(!(!t||!T)){try{const k=localStorage.getItem(`team:list:${T}`),$=k?JSON.parse(k):[];Array.isArray($)&&$.length>0&&o($)}catch{}j()}},[t,e?.codigo_empresa]),p.useEffect(()=>{const T=()=>{document.visibilityState==="visible"&&t&&(e?.codigo_empresa||e?.id)&&j()},k=()=>{t&&(e?.codigo_empresa||e?.id)&&j()};return document.addEventListener("visibilitychange",T),window.addEventListener("focus",k),()=>{document.removeEventListener("visibilitychange",T),window.removeEventListener("focus",k)}},[t,e?.codigo_empresa,e?.id]);const _=p.useMemo(()=>({total:s.length,active:s.filter(T=>T.status==="active").length,inactive:s.filter(T=>T.status==="inactive").length}),[s]),C=p.useMemo(()=>s.filter(T=>T.name.toLowerCase().includes(x.toLowerCase())||T.role.toLowerCase().includes(x.toLowerCase())),[s,x]),A=T=>{f(T),d(!0)},S=()=>{m(null),l(!0)},P=T=>{d(!1),m(T),l(!0)},M=T=>{m(T),l(!0)},O=async({name:T,role:k})=>{try{if(y(!0),!e?.codigo_empresa&&!e?.id)throw new Error("Empresa no encontrada para o usurio atual.");let $=e?.codigo_empresa||null;if(!$&&e?.id){const{data:q}=await Q.from("empresas").select("codigo_empresa").eq("id",e.id).single();$=q?.codigo_empresa||null}if(!$)throw new Error("Empresa sem cdigo. Defina o cdigo da empresa antes de adicionar colaboradores.");if(h){const{error:q}=await Q.from("colaboradores").update({nome:T,cargo:k}).eq("id",h.id);if(q)throw q;n({title:"Funcionrio atualizado",description:h.name,variant:"default"})}else{const{error:q}=await Q.from("colaboradores").insert({codigo_empresa:$,nome:T,cargo:k,ativo:!0});if(q)throw q;n({title:"Funcionrio criado com sucesso",description:T,variant:"success"})}await j(),l(!1),m(null)}catch($){n({title:"Erro ao salvar funcionrio",description:$.message||String($),variant:"destructive"})}finally{y(!1)}},I=async T=>{try{if(!(e?.id||e?.codigo_empresa))return;const k=s[0]?.id;if(T.id===k){n({title:"Ao no permitida",description:"No  possvel desativar o primeiro funcionrio.",variant:"destructive"});return}if(r?.id&&T.id===r.id){n({title:"Ao no permitida",description:"Voc no pode desativar o seu prprio usurio.",variant:"destructive"});return}if(s.filter(q=>q.status==="active").length<=1){n({title:"Ao no permitida",description:"Deve haver pelo menos um funcionrio ativo.",variant:"destructive"});return}const{error:$}=await Q.from("colaboradores").update({ativo:!1}).eq("id",T.id);if($)throw $;n({title:"Funcionrio desativado",description:T.name}),await j()}catch(k){n({title:"Erro ao desativar",description:k.message||String(k),variant:"destructive"})}};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-full flex flex-col",children:a.jsxs(Mr.div,{variants:Jst,initial:"hidden",animate:"visible",children:[a.jsxs(Mr.div,{variants:poe,className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary tracking-tighter",children:"Gesto de Equipe"}),a.jsx("p",{className:"text-sm sm:text-base text-text-secondary",children:"Controle de funcionrios, permisses e logs."})]}),a.jsxs(Z,{onClick:S,disabled:!t||!e?.codigo_empresa,title:t?e?.codigo_empresa?"":"Empresa sem cdigo. Defina o cdigo da empresa antes.":"Aguardando autenticao...",children:[a.jsx(to,{className:"mr-2 h-4 w-4"})," Novo Funcionrio"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsx(Dk,{icon:vc,title:"Total",value:_.total,color:"text-brand"}),a.jsx(Dk,{icon:sfe,title:"Ativos",value:_.active,color:"text-success"}),a.jsx(Dk,{icon:tfe,title:"Desativados",value:_.inactive,color:"text-danger"})]}),a.jsx(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar por nome ou cargo...",className:"pl-9",value:x,onChange:T=>g(T.target.value)})]})}),a.jsx("div",{className:"md:hidden p-4 space-y-3",children:C.length===0?a.jsx("div",{className:"text-center py-10 text-text-muted",children:"Nenhum funcionrio cadastrado."}):C.map((T,k)=>a.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4 space-y-3",onClick:()=>A(T),children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-base text-text-primary truncate",children:T.name}),a.jsx("p",{className:"text-sm text-text-muted mt-0.5",children:T.role})]}),a.jsx("span",{className:Er("inline-flex px-2 py-0.5 rounded-full text-xs font-semibold flex-shrink-0",T.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:T.status==="active"?"Ativo":"Inativo"})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx(Z,{variant:"outline",size:"sm",onClick:$=>{$.stopPropagation(),A(T)},className:"flex-1",children:"Ver Detalhes"}),a.jsx(Z,{variant:"outline",size:"sm",onClick:$=>{$.stopPropagation(),M(T)},children:a.jsx(xc,{className:"h-3 w-3"})}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{variant:"outline",size:"sm",onClick:$=>$.stopPropagation(),children:a.jsx(l$,{className:"h-3 w-3"})})}),a.jsx(Qu,{align:"end",children:a.jsx(vs,{className:"text-danger",disabled:k===0||s.filter($=>$.status==="active").length<=1||r?.id&&T.id===r.id,onClick:$=>{$.stopPropagation(),I(T)},children:"Desativar"})})]})]})]},T.id))}),a.jsx("div",{className:"hidden md:block",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Funcionrio"}),a.jsx(_a,{children:"Cargo"}),a.jsx(_a,{children:"Status"}),a.jsx(_a,{className:"w-[80px] text-center",children:"Aes"})]})}),a.jsxs(mc,{children:[C.length===0&&a.jsx(Fs,{children:a.jsx(oa,{colSpan:4,className:"text-center py-10 text-text-muted",children:"Nenhum funcionrio cadastrado."})}),C.map((T,k)=>a.jsxs(Fs,{className:"cursor-pointer",onClick:()=>A(T),children:[a.jsx(oa,{className:"font-medium",children:a.jsx("div",{className:"flex items-center gap-3",children:a.jsx("span",{children:T.name})})}),a.jsx(oa,{children:T.role}),a.jsx(oa,{children:a.jsx("span",{className:Er("px-2 py-1 text-xs font-semibold rounded-full",T.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:T.status==="active"?"Ativo":"Inativo"})}),a.jsx(oa,{className:"text-center",children:a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{variant:"ghost",className:"h-8 w-8 p-0 mx-auto",onClick:$=>$.stopPropagation(),children:a.jsx(l$,{className:"h-4 w-4"})})}),a.jsxs(Qu,{align:"end",children:[a.jsx(vs,{onClick:$=>{$.stopPropagation(),A(T)},children:"Ver Detalhes"}),a.jsx(vs,{onClick:$=>{$.stopPropagation(),M(T)},children:"Editar"}),a.jsx(vs,{className:"text-danger",disabled:k===0||s.filter($=>$.status==="active").length<=1||r?.id&&T.id===r.id,onClick:$=>{$.stopPropagation(),I(T)},children:"Desativar"})]})]})})]},T.id))]})]})})]})})]})}),a.jsx(Zst,{open:i,onOpenChange:l,member:h,onSave:O,loading:v}),a.jsx(Qst,{open:c,onOpenChange:d,member:u,onEdit:P})]})}const tot="v2.0.2";function hh({title:e,icon:t,children:r,className:n="",collapsible:s=!1,defaultOpen:o=!0}){return s?a.jsx("div",{className:`bg-surface rounded-lg border border-border shadow-sm ${n}`,children:a.jsxs("details",{className:"group",open:o,children:[a.jsxs("summary",{className:"list-none cursor-pointer select-none p-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[t&&a.jsx(t,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"text-base font-semibold",children:e})]}),a.jsx("span",{className:"text-xs text-text-secondary group-open:rotate-180 transition-transform",children:""})]}),a.jsx("div",{className:"px-4 pb-4",children:r})]})}):a.jsxs("div",{className:`bg-surface rounded-lg border border-border shadow-sm p-4 ${n}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t&&a.jsx(t,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"text-base font-semibold",children:e})]}),r]})}function ph({label:e,value:t}){return a.jsxs("div",{className:"flex items-center justify-between gap-3 py-1 text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:e}),a.jsx("span",{className:"font-medium truncate",children:t||""})]})}function rot(){const{userProfile:e,company:t,authReady:r,loading:n}=fo();Mi();const[s,o]=p.useState("Agenda"),[i,l]=p.useState("Mdia"),[c,d]=p.useState(""),[u,f]=p.useState(""),[h,m]=p.useState(!0),[x,g]=p.useState(()=>window.__installPrompt||null),[v,y]=p.useState(!1),[b,w]=p.useState(!1),[j,_]=p.useState(!1),[C,A]=p.useState("unknown"),S="Fluxo7 Arena",P="fluxo7team@gmail.com",M="https://wa.me/5534998936088",O="tel:+5534998936088",I="+55 (34) 99893-6088";p.useEffect(()=>{try{const V=window.matchMedia("(pointer:fine)"),ue=()=>m(V.matches);return ue(),V.addEventListener?.("change",ue),()=>V.removeEventListener?.("change",ue)}catch{m(!0)}},[]),p.useEffect(()=>{const V=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;w(V);const ue=navigator.userAgent;ue.includes("Chrome")&&!ue.includes("Edg")?A("chrome"):ue.includes("Edg")?A("edge"):ue.includes("Firefox")?A("firefox"):ue.includes("Safari")&&!ue.includes("Chrome")?A("safari"):A("other"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&y(!0),window.__installPrompt&&!x&&g(window.__installPrompt);const _e=()=>{y(!0),g(null),_(!1)};return window.addEventListener("appinstalled",_e),()=>{window.removeEventListener("appinstalled",_e)}},[x]);const T=async()=>{if(x)try{await x.prompt();const{outcome:V}=await x.userChoice;V==="accepted"?(y(!0),_(!1)):_(!0),g(null),window.__installPrompt=null}catch(V){console.error("Erro ao mostrar prompt de instalao:",V),_(!0)}else _(!0)},k=()=>{navigator.share?navigator.share({title:"F7 Arena",text:"Adicione F7 Arena  sua tela inicial",url:window.location.href}).catch(()=>{alert(`Para adicionar  tela inicial:

1. Toque no boto de Compartilhar (cone de quadrado com seta)
2. Role para baixo
3. Toque em "Adicionar  Tela de Incio"`)}):alert(`Para adicionar  tela inicial:

1. Toque no boto de Compartilhar (cone de quadrado com seta)
2. Role para baixo
3. Toque em "Adicionar  Tela de Incio"`)},$=p.useMemo(()=>{try{return{empresa:t?.nome||t?.fantasia||t?.razao_social||t?.razaoSocial||t?.displayName||t?.codigo_empresa||"",usuario:e?.nome||e?.name||e?.email||"",dataHora:new Date().toLocaleString("pt-BR")}}catch{return{empresa:"",usuario:"",dataHora:new Date().toLocaleString("pt-BR")}}},[t?.nome,t?.fantasia,t?.razao_social,t?.razaoSocial,t?.displayName,t?.codigo_empresa,e?.nome,e?.name,e?.email]),q=p.useMemo(()=>[`[${S} - Suporte]`,`Assunto: ${c||"(sem assunto)"} `,`Categoria: ${s} `,`Severidade: ${i}`,"","Descrio:",(u||"(adicione uma descrio detalhada, passos para reproduzir, prints se possvel)")+`
`," Dados ",`Empresa: ${$.empresa}`,`Usurio: ${$.usuario}`,`Data e Hora: ${$.dataHora}`].join(`
`),[c,s,i,u,$]),z=`${M}?text=${encodeURIComponent(q)}`,F=`mailto:${P}?subject=${encodeURIComponent(`[Suporte] ${c||"Assunto"}`)}&body=${encodeURIComponent(q)}`;return a.jsxs("div",{className:"px-4 md:px-6 lg:px-8 py-4 md:py-6",children:[a.jsxs("div",{className:"bg-surface rounded-xl border border-border p-5 md:p-6 mb-6",children:[a.jsxs("div",{className:"flex items-start md:items-center justify-between gap-4 flex-col md:flex-row",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand/10 border border-brand/30 flex items-center justify-center",children:a.jsx(bG,{className:"w-5 h-5 text-brand"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl md:text-2xl font-semibold",children:"Suporte"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Precisa de ajuda? Fale com a gente ou consulte as respostas rpidas abaixo."})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center",children:a.jsx(Nd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-base md:text-xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-base md:text-xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-base md:text-xl",style:{color:"#B0B0B0"},children:" Arena"})]})]}),a.jsxs("div",{className:"text-xs text-text-secondary mt-1",children:["Verso ",tot]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4",children:[a.jsx(hh,{title:"Status",icon:yb,children:a.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[a.jsx(ph,{label:"Empresa",value:$.empresa}),a.jsx(ph,{label:"Usurio",value:`${$.usuario}`})]})}),a.jsx(hh,{title:"Fale com a gente",icon:kA,children:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("a",{href:M,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-brand text-black hover:opacity-90 transition",children:[a.jsx(kA,{className:"w-4 h-4"})," WhatsApp"]}),a.jsxs("a",{href:`mailto:${P}`,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(f0,{className:"w-4 h-4"})," E-mail"]}),a.jsxs("a",{href:O,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(Ow,{className:"w-4 h-4"})," ",h?I:"Telefone"]})]})}),!v&&b&&a.jsx(hh,{title:"Adicionar  Tela Inicial",icon:IA,children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-text-secondary",children:"Crie um atalho do F7 Arena na sua tela inicial para acesso rpido."}),a.jsxs("button",{onClick:k,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-md bg-brand text-black font-medium hover:opacity-90 transition",children:[a.jsx(u$,{className:"w-4 h-4"})," Criar Atalho"]}),a.jsxs("details",{className:"text-xs text-text-muted",children:[a.jsx("summary",{className:"cursor-pointer hover:text-text-secondary",children:"Como fazer manualmente?"}),a.jsxs("div",{className:"mt-2 space-y-1 pl-2",children:[a.jsxs("p",{children:["1. Toque no boto ",a.jsx(u$,{className:"inline w-3 h-3"})," (Compartilhar)"]}),a.jsx("p",{children:'2. Role para baixo e toque em "Adicionar  Tela de Incio"'}),a.jsx("p",{children:'3. Toque em "Adicionar"'})]})]})]})}),!v&&!b&&a.jsx(hh,{title:"Instalar Aplicativo",icon:IA,children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-text-secondary",children:"Instale o F7 Arena no seu dispositivo para acesso rpido e experincia completa de aplicativo."}),a.jsxs("button",{onClick:T,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-md bg-brand text-black font-medium hover:opacity-90 transition",children:[a.jsx(ys,{className:"w-4 h-4"})," Instalar App"]}),a.jsx("p",{className:"text-xs text-text-muted text-center",children:"Pode demorar alguns segundos. Se no aparecer nada, veja as instrues no tutorial."})]})}),v&&a.jsx(hh,{title:"Aplicativo Instalado",icon:yb,children:a.jsxs("div",{className:"flex items-center gap-2 text-sm text-success",children:[a.jsx(yb,{className:"w-4 h-4"}),a.jsx("span",{children:"F7 Arena est instalado no seu dispositivo!"})]})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2 space-y-3",children:a.jsx(hh,{title:"Perguntas Frequentes (FAQ)",children:a.jsxs("div",{className:"divide-y divide-border/60",children:[a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como abrir comanda de balco?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Abra o caixa antes. A tela de balco utiliza uma comanda sem mesa (mesa_id nulo). Se no existir, o sistema cria ao abrir o balco; caso o caixa esteja fechado, a abertura da comanda  bloqueada."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Por que no consigo fechar o caixa?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"O fechamento  bloqueado se houver comandas com itens em aberto (inclui balco e mesas). Finalize ou feche as comandas pendentes antes de encerrar o caixa."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como adicionar participantes no agendamento?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"No modal de agendamento, selecione um ou mais clientes. Aps salvar, o chip de pagamentos  atualizado imediatamente. Se no visualizar, recarregue os dados da agenda."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como ver o histrico completo do cliente?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Abra o cliente e utilize o Histrico Recente, que combina comandas e agendamentos em uma nica timeline com totais e status."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como ajustar estoque mnimo e ver mais vendidos?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Na aba de Produtos voc pode gerenciar estoque, preos e relatrios. Utilize filtros e exportaes para anlise."})]})]})})}),a.jsx("div",{className:"lg:col-span-1",children:a.jsxs("div",{className:"space-y-3 lg:sticky lg:top-6",children:[a.jsx(hh,{title:"Reportar um problema",icon:kue,collapsible:!0,defaultOpen:!1,children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Categoria"}),a.jsxs("select",{value:s,onChange:V=>o(V.target.value),className:"w-full mt-1 px-2 py-2 rounded-md bg-background border border-border",children:[a.jsx("option",{children:"Agenda"}),a.jsx("option",{children:"Vendas"}),a.jsx("option",{children:"Clientes"}),a.jsx("option",{children:"Produtos"}),a.jsx("option",{children:"Financeiro"}),a.jsx("option",{children:"Outros"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Severidade"}),a.jsxs("select",{value:i,onChange:V=>l(V.target.value),className:"w-full mt-1 px-2 py-2 rounded-md bg-background border border-border",children:[a.jsx("option",{children:"Baixa"}),a.jsx("option",{children:"Mdia"}),a.jsx("option",{children:"Alta"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Assunto"}),a.jsx("input",{value:c,onChange:V=>d(V.target.value),placeholder:"Ex.: Erro ao salvar agendamento",className:"w-full mt-1 px-3 py-2 rounded-md bg-background border border-border"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Descrio"}),a.jsx("textarea",{value:u,onChange:V=>f(V.target.value),rows:4,placeholder:"Descreva o que aconteceu, passos para reproduzir, expectativa.",className:"w-full mt-1 px-3 py-2 rounded-md bg-background border border-border resize-y"})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 pt-1",children:[a.jsxs("a",{href:z,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-brand text-black hover:opacity-90 transition",children:[a.jsx(kA,{className:"w-4 h-4"})," Enviar no WhatsApp"]}),a.jsxs("a",{href:F,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(f0,{className:"w-4 h-4"})," Enviar por E-mail"]}),a.jsxs("a",{href:O,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(Ow,{className:"w-4 h-4"})," ",h?I:"Ligar agora"]})]})]})}),a.jsx(hh,{title:"Diagnstico",icon:Rue,children:a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsx(ph,{label:"Empresa",value:$.empresa}),a.jsx(ph,{label:"Usurio",value:`${$.usuario}`}),a.jsx(ph,{label:"Data/Hora",value:$.dataHora}),a.jsx(ph,{label:"Canal - WhatsApp",value:"(34) 99893-6088"}),a.jsx(ph,{label:"Canal - E-mail",value:"fluxo7team@gmail.com"}),a.jsx(ph,{label:"Canal - Telefone",value:"(34) 99893-6088"})]})})]})})]}),a.jsx(zn,{open:j,onOpenChange:_,children:a.jsxs(qn,{className:"max-w-2xl max-h-[85vh] overflow-y-auto",children:[a.jsx(Bn,{children:a.jsxs($n,{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-xl bg-brand/10 border border-brand/30 flex items-center justify-center",children:a.jsx(ys,{className:"w-6 h-6 text-brand"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold",children:"Como Instalar o F7 Arena"}),a.jsx("p",{className:"text-sm text-text-secondary font-normal",children:"Siga as instrues para o seu navegador"})]})]})}),a.jsxs("div",{className:"mt-6 space-y-6",children:[(C==="chrome"||C==="edge")&&a.jsxs("div",{className:"bg-gradient-to-br from-brand/10 to-brand/5 rounded-xl p-6 border-2 border-brand/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand flex items-center justify-center",children:a.jsx(Due,{className:"w-6 h-6 text-black"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Chrome (Celular)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Siga os passos abaixo"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"1"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-semibold mb-2",children:["Toque nos 3 pontinhos ",a.jsx("span",{className:"text-2xl",children:""})]}),a.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"No canto superior direito da tela"}),a.jsx("div",{className:"bg-background/50 rounded-md p-3 border border-border/50",children:a.jsx("p",{className:"text-xs text-text-muted",children:" Os 3 pontinhos ficam ao lado da barra de endereo"})})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"2"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure uma destas opes:"}),a.jsxs("div",{className:"space-y-2 mb-3",children:[a.jsx("div",{className:"bg-brand/20 rounded-md p-3 border-2 border-brand/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Instalar aplicativo"'})}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-text-muted text-sm font-medium",children:[a.jsx("div",{className:"h-px bg-border flex-1"}),a.jsx("span",{children:"OU"}),a.jsx("div",{className:"h-px bg-border flex-1"})]}),a.jsx("div",{className:"bg-brand/20 rounded-md p-3 border-2 border-brand/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Adicionar  tela inicial"'})})]}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Toque em qualquer uma dessas opes no menu"})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"3"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-2",children:"Confirme a instalao"}),a.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"Aparecer uma janela perguntando se deseja instalar"}),a.jsx("div",{className:"bg-success/10 rounded-md p-3 border border-success/30",children:a.jsx("p",{className:"text-sm font-medium text-center",children:' Toque em "Instalar"'})})]})]})}),a.jsxs("div",{className:"bg-success/5 rounded-lg p-4 border border-success/20",children:[a.jsx("p",{className:"text-sm font-medium text-success mb-1",children:" Pronto!"}),a.jsx("p",{className:"text-xs text-text-secondary",children:"O app aparecer na sua tela inicial e voc poder abri-lo como qualquer outro aplicativo!"})]})]})]}),C==="firefox"&&a.jsxs("div",{className:"bg-gradient-to-br from-orange-500/10 to-orange-500/5 rounded-xl p-6 border-2 border-orange-500/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-500 flex items-center justify-center",children:a.jsx(Que,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Firefox (Celular)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Siga os passos abaixo"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold",children:"1"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-semibold mb-2",children:["Toque nos 3 pontinhos ",a.jsx("span",{className:"text-2xl",children:""})]}),a.jsx("p",{className:"text-sm text-text-secondary",children:"No canto inferior direito da tela"})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold",children:"2"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure uma destas opes:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-orange-500/20 rounded-md p-3 border-2 border-orange-500/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Instalar"'})}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-text-muted text-sm font-medium",children:[a.jsx("div",{className:"h-px bg-border flex-1"}),a.jsx("span",{children:"OU"}),a.jsx("div",{className:"h-px bg-border flex-1"})]}),a.jsx("div",{className:"bg-orange-500/20 rounded-md p-3 border-2 border-orange-500/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Adicionar  tela inicial"'})})]})]})]})}),a.jsxs("div",{className:"bg-success/5 rounded-lg p-4 border border-success/20",children:[a.jsx("p",{className:"text-sm font-medium text-success mb-1",children:" Pronto!"}),a.jsx("p",{className:"text-xs text-text-secondary",children:"O app ser adicionado  sua tela inicial!"})]})]})]}),(C==="safari"||C==="other")&&a.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-500/5 rounded-xl p-6 border-2 border-purple-500/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center",children:a.jsx(IA,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Outros Navegadores"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Instrues gerais"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-surface rounded-lg p-4 border border-border",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure no menu do navegador:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Instalar aplicativo"'})}),a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Adicionar  tela inicial"'})}),a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Criar atalho"'})})]})]}),a.jsx("div",{className:"bg-background/50 rounded-lg p-4 border border-border/50",children:a.jsx("p",{className:"text-sm text-text-muted",children:" Geralmente a opo est no menu de 3 pontos ou 3 linhas do navegador"})})]})]}),a.jsxs("div",{className:"bg-brand/5 rounded-lg p-4 border border-brand/20",children:[a.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[a.jsx(yb,{className:"w-5 h-5 text-brand"}),"Benefcios do App Instalado"]}),a.jsxs("ul",{className:"space-y-1.5 text-sm text-text-secondary",children:[a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Acesso rpido direto da rea de trabalho ou menu iniciar"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Funciona em tela cheia, sem barras do navegador"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Notificaes e atualizaes automticas"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Melhor desempenho e experincia de uso"]})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{onClick:()=>_(!1),className:"px-6 py-2.5 rounded-md bg-surface-2 hover:bg-surface text-text-primary font-medium transition",children:"Entendi"})})]})]})})]})}function goe(e,t,r,n,s){n=n||{};var o=1.15,i=s.internal.scaleFactor,l=s.internal.getFontSize()/i,c=s.getLineHeightFactor?s.getLineHeightFactor():o,d=l*c,u=/\r\n|\r|\n/g,f="",h=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(f=typeof e=="string"?e.split(u):e,h=f.length||1),r+=l*(2-o),n.valign==="middle"?r-=h/2*d:n.valign==="bottom"&&(r-=h*d),n.halign==="center"||n.halign==="right"){var m=l;if(n.halign==="center"&&(m*=.5),f&&h>=1){for(var x=0;x<f.length;x++)s.text(f[x],t-s.getStringUnitWidth(f[x])*m,r),r+=d;return s}t-=s.getStringUnitWidth(e)*m}return n.halign==="justify"?s.text(e,t,r,{maxWidth:n.maxWidth||100,align:"justify"}):s.text(e,t,r),s}var pV={},t0=function(){function e(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return e.setDefaults=function(t,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=t:pV=t},e.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},e.prototype.applyStyles=function(t,r){var n,s,o;r===void 0&&(r=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var i=this.jsPDFDocument.internal.getFont(),l=i.fontStyle,c=i.fontName;if(t.font&&(c=t.font),t.fontStyle){l=t.fontStyle;var d=this.getFontList()[c];d&&d.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(d[0]),l=d[0])}if(this.jsPDFDocument.setFont(c,l),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!r){var u=e.unifyColor(t.fillColor);u&&(n=this.jsPDFDocument).setFillColor.apply(n,u),u=e.unifyColor(t.textColor),u&&(s=this.jsPDFDocument).setTextColor.apply(s,u),u=e.unifyColor(t.lineColor),u&&(o=this.jsPDFDocument).setDrawColor.apply(o,u),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(t,r,n){return this.jsPDFDocument.splitTextToSize(t,r,n)},e.prototype.rect=function(t,r,n,s,o){return this.jsPDFDocument.rect(t,r,n,s,o)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return pV||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},e.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},e.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}(),B3=function(e,t){return B3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},B3(e,t)};function xoe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");B3(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var voe=function(e){xoe(t,e);function t(r){var n=e.call(this)||this;return n._element=r,n}return t}(Array);function not(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function aot(e){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[e]}function vC(e,t,r){r.applyStyles(t,!0);var n=Array.isArray(e)?e:[e],s=n.map(function(o){return r.getTextWidth(o)}).reduce(function(o,i){return Math.max(o,i)},0);return s}function yoe(e,t,r,n){var s=t.settings.tableLineWidth,o=t.settings.tableLineColor;e.applyStyles({lineWidth:s,lineColor:o});var i=boe(s,!1);i&&e.rect(r.x,r.y,t.getWidth(e.pageSize().width),n.y-r.y,i)}function boe(e,t){var r=e>0,n=t||t===0;return r&&n?"DF":r?"S":n?"F":null}function WP(e,t){var r,n,s,o;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===3)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e.length===1?e=e[0]:e=t}return typeof e=="object"?(typeof e.vertical=="number"&&(e.top=e.vertical,e.bottom=e.vertical),typeof e.horizontal=="number"&&(e.right=e.horizontal,e.left=e.horizontal),{left:(r=e.left)!==null&&r!==void 0?r:t,top:(n=e.top)!==null&&n!==void 0?n:t,right:(s=e.right)!==null&&s!==void 0?s:t,bottom:(o=e.bottom)!==null&&o!==void 0?o:t}):(typeof e!="number"&&(e=t),{top:e,right:e,bottom:e,left:e})}function woe(e,t){var r=WP(t.settings.margin,0);return e.pageSize().width-(r.left+r.right)}function sot(e,t,r,n,s){var o={},i=1.3333333333333333,l=Mk(t,function(w){return s.getComputedStyle(w).backgroundColor});l!=null&&(o.fillColor=l);var c=Mk(t,function(w){return s.getComputedStyle(w).color});c!=null&&(o.textColor=c);var d=iot(n,r);d&&(o.cellPadding=d);var u="borderTopColor",f=i*r,h=n.borderTopWidth;if(n.borderBottomWidth===h&&n.borderRightWidth===h&&n.borderLeftWidth===h){var m=(parseFloat(h)||0)/f;m&&(o.lineWidth=m)}else o.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/f,right:(parseFloat(n.borderRightWidth)||0)/f,bottom:(parseFloat(n.borderBottomWidth)||0)/f,left:(parseFloat(n.borderLeftWidth)||0)/f},o.lineWidth.top||(o.lineWidth.right?u="borderRightColor":o.lineWidth.bottom?u="borderBottomColor":o.lineWidth.left&&(u="borderLeftColor"));var x=Mk(t,function(w){return s.getComputedStyle(w)[u]});x!=null&&(o.lineColor=x);var g=["left","right","center","justify"];g.indexOf(n.textAlign)!==-1&&(o.halign=n.textAlign),g=["middle","bottom","top"],g.indexOf(n.verticalAlign)!==-1&&(o.valign=n.verticalAlign);var v=parseInt(n.fontSize||"");isNaN(v)||(o.fontSize=v/i);var y=oot(n);y&&(o.fontStyle=y);var b=(n.fontFamily||"").toLowerCase();return e.indexOf(b)!==-1&&(o.font=b),o}function oot(e){var t="";return(e.fontWeight==="bold"||e.fontWeight==="bolder"||parseInt(e.fontWeight)>=700)&&(t="bold"),(e.fontStyle==="italic"||e.fontStyle==="oblique")&&(t+="italic"),t}function Mk(e,t){var r=joe(e,t);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var s=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],o=parseInt(n[4]);return o===0||isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function joe(e,t){var r=t(e);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?e.parentElement==null?null:joe(e.parentElement,t):r}function iot(e,t){var r=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],n=96/(72/t),s=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,o=r.map(function(l){return parseInt(l||"0")/n}),i=WP(o,0);return s>i.top&&(i.top=s),s>i.bottom&&(i.bottom=s),i}function _oe(e,t,r,n,s){var o,i;n===void 0&&(n=!1),s===void 0&&(s=!1);var l;typeof t=="string"?l=r.document.querySelector(t):l=t;var c=Object.keys(e.getFontList()),d=e.scaleFactor(),u=[],f=[],h=[];if(!l)return console.error("Html table could not be found with input: ",t),{head:u,body:f,foot:h};for(var m=0;m<l.rows.length;m++){var x=l.rows[m],g=(i=(o=x?.parentElement)===null||o===void 0?void 0:o.tagName)===null||i===void 0?void 0:i.toLowerCase(),v=lot(c,d,r,x,n,s);v&&(g==="thead"?u.push(v):g==="tfoot"?h.push(v):f.push(v))}return{head:u,body:f,foot:h}}function lot(e,t,r,n,s,o){for(var i=new voe(n),l=0;l<n.cells.length;l++){var c=n.cells[l],d=r.getComputedStyle(c);if(s||d.display!=="none"){var u=void 0;o&&(u=sot(e,c,t,d,r)),i.push({rowSpan:c.rowSpan,colSpan:c.colSpan,styles:u,_element:c,content:cot(c)})}}var f=r.getComputedStyle(n);if(i.length>0&&(s||f.display!=="none"))return i}function cot(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),t.innerText||t.textContent||""}function dot(e,t,r){for(var n=0,s=[e,t,r];n<s.length;n++){var o=s[n];o&&typeof o!="object"&&console.error("The options parameter should be of type object, is: "+typeof o),o.startY&&typeof o.startY!="number"&&(console.error("Invalid value for startY option",o.startY),delete o.startY)}}function Am(e,t,r,n,s){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),i=1;i<arguments.length;i++){var l=arguments[i];if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c])}return o}function bF(e,t){var r=new t0(e),n=r.getDocumentOptions(),s=r.getGlobalOptions();dot(s,n,t);var o=Am({},s,n,t),i;typeof window<"u"&&(i=window);var l=uot(s,n,t),c=fot(s,n,t),d=mot(r,o),u=pot(r,o,i);return{id:t.tableId,content:u,hooks:c,styles:l,settings:d}}function uot(e,t,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},s=function(c){if(c==="columnStyles"){var d=e[c],u=t[c],f=r[c];n.columnStyles=Am({},d,u,f)}else{var h=[e,t,r],m=h.map(function(x){return x[c]||{}});n[c]=Am({},m[0],m[1],m[2])}},o=0,i=Object.keys(n);o<i.length;o++){var l=i[o];s(l)}return n}function fot(e,t,r){for(var n=[e,t,r],s={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},o=0,i=n;o<i.length;o++){var l=i[o];l.didParseCell&&s.didParseCell.push(l.didParseCell),l.willDrawCell&&s.willDrawCell.push(l.willDrawCell),l.didDrawCell&&s.didDrawCell.push(l.didDrawCell),l.willDrawPage&&s.willDrawPage.push(l.willDrawPage),l.didDrawPage&&s.didDrawPage.push(l.didDrawPage)}return s}function mot(e,t){var r,n,s,o,i,l,c,d,u,f,h,m,x=WP(t.margin,40/e.scaleFactor()),g=(r=hot(e,t.startY))!==null&&r!==void 0?r:x.top,v;t.showFoot===!0?v="everyPage":t.showFoot===!1?v="never":v=(n=t.showFoot)!==null&&n!==void 0?n:"everyPage";var y;t.showHead===!0?y="everyPage":t.showHead===!1?y="never":y=(s=t.showHead)!==null&&s!==void 0?s:"everyPage";var b=(o=t.useCss)!==null&&o!==void 0?o:!1,w=t.theme||(b?"plain":"striped"),j=!!t.horizontalPageBreak,_=(i=t.horizontalPageBreakRepeat)!==null&&i!==void 0?i:null;return{includeHiddenHtml:(l=t.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:b,theme:w,startY:g,margin:x,pageBreak:(c=t.pageBreak)!==null&&c!==void 0?c:"auto",rowPageBreak:(d=t.rowPageBreak)!==null&&d!==void 0?d:"auto",tableWidth:(u=t.tableWidth)!==null&&u!==void 0?u:"auto",showHead:y,showFoot:v,tableLineWidth:(f=t.tableLineWidth)!==null&&f!==void 0?f:0,tableLineColor:(h=t.tableLineColor)!==null&&h!==void 0?h:200,horizontalPageBreak:j,horizontalPageBreakRepeat:_,horizontalPageBreakBehaviour:(m=t.horizontalPageBreakBehaviour)!==null&&m!==void 0?m:"afterAllRows"}}function hot(e,t){var r=e.getLastAutoTable(),n=e.scaleFactor(),s=e.pageNumber(),o=!1;if(r&&r.startPageNumber){var i=r.startPageNumber+r.pageNumber-1;o=i===s}return typeof t=="number"?t:(t==null||t===!1)&&o&&r?.finalY!=null?r.finalY+20/n:null}function pot(e,t,r){var n=t.head||[],s=t.body||[],o=t.foot||[];if(t.html){var i=t.includeHiddenHtml;if(r){var l=_oe(e,t.html,r,i,t.useCss)||{};n=l.head||n,s=l.body||n,o=l.foot||n}else console.error("Cannot parse html in non browser environment")}var c=t.columns||got(n,s,o);return{columns:c,head:n,body:s,foot:o}}function got(e,t,r){var n=e[0]||t[0]||r[0]||[],s=[];return Object.keys(n).filter(function(o){return o!=="_element"}).forEach(function(o){var i=1,l;Array.isArray(n)?l=n[parseInt(o)]:l=n[o],typeof l=="object"&&!Array.isArray(l)&&(i=l?.colSpan||1);for(var c=0;c<i;c++){var d=void 0;Array.isArray(n)?d=s.length:d=o+(c>0?"_".concat(c):"");var u={dataKey:d};s.push(u)}}),s}var yC=function(){function e(t,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=t.getDocument()}return e}(),Noe=function(e){xoe(t,e);function t(r,n,s,o,i,l){var c=e.call(this,r,n,l)||this;return c.cell=s,c.row=o,c.column=i,c.section=o.section,c}return t}(yC),Soe=function(){function e(t,r){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return e.prototype.getHeadHeight=function(t){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.getFootHeight=function(t){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(t,r,n,s,o,i){for(var l=0,c=r;l<c.length;l++){var d=c[l],u=new Noe(t,this,n,s,o,i),f=d(u)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],f)return!1}return!0},e.prototype.callEndPageHooks=function(t,r){t.applyStyles(t.userStyles);for(var n=0,s=this.hooks.didDrawPage;n<s.length;n++){var o=s[n];o(new yC(t,this,r))}},e.prototype.callWillDrawPageHooks=function(t,r){for(var n=0,s=this.hooks.willDrawPage;n<s.length;n++){var o=s[n];o(new yC(t,this,r))}},e.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(s,o){return s+o.wrappedWidth},0);return r}else{var n=this.settings.margin;return t-n.left-n.right}},e}(),wF=function(){function e(t,r,n,s,o){o===void 0&&(o=!1),this.height=0,this.raw=t,t instanceof voe&&(this.raw=t._element,this.element=t._element),this.index=r,this.section=n,this.cells=s,this.spansMultiplePages=o}return e.prototype.getMaxCellHeight=function(t){var r=this;return t.reduce(function(n,s){var o;return Math.max(n,((o=r.cells[s.index])===null||o===void 0?void 0:o.height)||0)},0)},e.prototype.hasRowSpan=function(t){var r=this;return t.filter(function(n){var s=r.cells[n.index];return s?s.rowSpan>1:!1}).length>0},e.prototype.canEntireRowFit=function(t,r){return this.getMaxCellHeight(r)<=t},e.prototype.getMinimumRowHeight=function(t,r){var n=this;return t.reduce(function(s,o){var i=n.cells[o.index];if(!i)return 0;var l=r.getLineHeight(i.styles.fontSize),c=i.padding("vertical"),d=c+l;return d>s?d:s},0)},e}(),jF=function(){function e(t,r,n){var s;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=t;var o=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,o=(s=t.content)!==null&&s!==void 0?s:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var i=o!=null?""+o:"",l=/\r\n|\r|\n/g;this.text=i.split(l)}return e.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");t=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var s=this.width-this.padding("horizontal");n=this.x+s/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:t}},e.prototype.getContentHeight=function(t,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,s=this.styles.fontSize/t*r,o=n*s+this.padding("vertical");return Math.max(o,this.styles.minCellHeight)},e.prototype.padding=function(t){var r=WP(this.styles.cellPadding,0);return t==="vertical"?r.top+r.bottom:t==="horizontal"?r.left+r.right:r[t]},e}(),Coe=function(){function e(t,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=r,this.index=n}return e.prototype.getMaxCustomCellWidth=function(t){for(var r=0,n=0,s=t.allRows();n<s.length;n++){var o=s[n],i=o.cells[this.index];i&&typeof i.styles.cellWidth=="number"&&(r=Math.max(r,i.styles.cellWidth))}return r},e}();function xot(e,t){vot(e,t);var r=[],n=0;t.columns.forEach(function(o){var i=o.getMaxCustomCellWidth(t);i?o.width=i:(o.width=o.wrappedWidth,r.push(o)),n+=o.width});var s=t.getWidth(e.pageSize().width)-n;s&&(s=q3(r,s,function(o){return Math.max(o.minReadableWidth,o.minWidth)})),s&&(s=q3(r,s,function(o){return o.minWidth})),s=Math.abs(s),!t.settings.horizontalPageBreak&&s>.1/e.scaleFactor()&&(s=s<1?s:Math.round(s),console.warn("Of the table content, ".concat(s," units width could not fit page"))),bot(t),wot(t,e),yot(t)}function vot(e,t){var r=e.scaleFactor(),n=t.settings.horizontalPageBreak,s=woe(e,t);t.allRows().forEach(function(o){for(var i=0,l=t.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d){var u=t.hooks.didParseCell;t.callCellHooks(e,u,d,o,c,null);var f=d.padding("horizontal");d.contentWidth=vC(d.text,d.styles,e)+f;var h=vC(d.text.join(" ").split(/[^\S\u00A0]+/),d.styles,e);if(d.minReadableWidth=h+d.padding("horizontal"),typeof d.styles.cellWidth=="number")d.minWidth=d.styles.cellWidth,d.wrappedWidth=d.styles.cellWidth;else if(d.styles.cellWidth==="wrap"||n===!0)d.contentWidth>s?(d.minWidth=s,d.wrappedWidth=s):(d.minWidth=d.contentWidth,d.wrappedWidth=d.contentWidth);else{var m=10/r;d.minWidth=d.styles.minCellWidth||m,d.wrappedWidth=d.contentWidth,d.minWidth>d.wrappedWidth&&(d.wrappedWidth=d.minWidth)}}}}),t.allRows().forEach(function(o){for(var i=0,l=t.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d&&d.colSpan===1)c.wrappedWidth=Math.max(c.wrappedWidth,d.wrappedWidth),c.minWidth=Math.max(c.minWidth,d.minWidth),c.minReadableWidth=Math.max(c.minReadableWidth,d.minReadableWidth);else{var u=t.styles.columnStyles[c.dataKey]||t.styles.columnStyles[c.index]||{},f=u.cellWidth||u.minCellWidth;f&&typeof f=="number"&&(c.minWidth=f,c.wrappedWidth=f)}d&&(d.colSpan>1&&!c.minWidth&&(c.minWidth=d.minWidth),d.colSpan>1&&!c.wrappedWidth&&(c.wrappedWidth=d.minWidth))}})}function q3(e,t,r){for(var n=t,s=e.reduce(function(m,x){return m+x.wrappedWidth},0),o=0;o<e.length;o++){var i=e[o],l=i.wrappedWidth/s,c=n*l,d=i.width+c,u=r(i),f=d<u?u:d;t-=f-i.width,i.width=f}if(t=Math.round(t*1e10)/1e10,t){var h=e.filter(function(m){return t<0?m.width>r(m):!0});h.length&&(t=q3(h,t,r))}return t}function yot(e){for(var t={},r=1,n=e.allRows(),s=0;s<n.length;s++)for(var o=n[s],i=0,l=e.columns;i<l.length;i++){var c=l[i],d=t[c.index];if(r>1)r--,delete o.cells[c.index];else if(d)d.cell.height+=o.height,r=d.cell.colSpan,delete o.cells[c.index],d.left--,d.left<=1&&delete t[c.index];else{var u=o.cells[c.index];if(!u)continue;if(u.height=o.height,u.rowSpan>1){var f=n.length-s,h=u.rowSpan>f?f:u.rowSpan;t[c.index]={cell:u,left:h,row:o}}}}}function bot(e){for(var t=e.allRows(),r=0;r<t.length;r++)for(var n=t[r],s=null,o=0,i=0,l=0;l<e.columns.length;l++){var c=e.columns[l];if(i-=1,i>1&&e.columns[l+1])o+=c.width,delete n.cells[c.index];else if(s){var d=s;delete n.cells[c.index],s=null,d.width=c.width+o}else{var d=n.cells[c.index];if(!d)continue;if(i=d.colSpan,o=0,d.colSpan>1){s=d,o+=c.width;continue}d.width=c.width+o}}}function wot(e,t){for(var r={count:0,height:0},n=0,s=e.allRows();n<s.length;n++){for(var o=s[n],i=0,l=e.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d){t.applyStyles(d.styles,!0);var u=d.width-d.padding("horizontal");if(d.styles.overflow==="linebreak")d.text=t.splitTextToSize(d.text,u+1/t.scaleFactor(),{fontSize:d.styles.fontSize});else if(d.styles.overflow==="ellipsize")d.text=gV(d.text,u,d.styles,t,"...");else if(d.styles.overflow==="hidden")d.text=gV(d.text,u,d.styles,t,"");else if(typeof d.styles.overflow=="function"){var f=d.styles.overflow(d.text,u);typeof f=="string"?d.text=[f]:d.text=f}d.contentHeight=d.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var h=d.contentHeight/d.rowSpan;d.rowSpan>1&&r.count*r.height<h*d.rowSpan?r={height:h,count:d.rowSpan}:r&&r.count>0&&r.height>h&&(h=r.height),h>o.height&&(o.height=h)}}r.count--}}function gV(e,t,r,n,s){return e.map(function(o){return jot(o,t,r,n,s)})}function jot(e,t,r,n,s){var o=1e4*n.scaleFactor();if(t=Math.ceil(t*o)/o,t>=vC(e,r,n))return e;for(;t<vC(e+s,r,n)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+s}function _F(e,t){var r=new t0(e),n=_ot(t,r.scaleFactor()),s=new Soe(t,n);return xot(r,s),r.applyStyles(r.userStyles),s}function _ot(e,t){var r=e.content,n=Sot(r.columns);if(r.head.length===0){var s=xV(n,"head");s&&r.head.push(s)}if(r.foot.length===0){var s=xV(n,"foot");s&&r.foot.push(s)}var o=e.settings.theme,i=e.styles;return{columns:n,head:Rk("head",r.head,n,i,o,t),body:Rk("body",r.body,n,i,o,t),foot:Rk("foot",r.foot,n,i,o,t)}}function Rk(e,t,r,n,s,o){var i={},l=t.map(function(c,d){for(var u=0,f={},h=0,m=0,x=0,g=r;x<g.length;x++){var v=g[x];if(i[v.index]==null||i[v.index].left===0)if(m===0){var y=void 0;Array.isArray(c)?y=c[v.index-h-u]:y=c[v.dataKey];var b={};typeof y=="object"&&!Array.isArray(y)&&(b=y?.styles||{});var w=Cot(e,v,d,s,n,o,b),j=new jF(y,w,e);f[v.dataKey]=j,f[v.index]=j,m=j.colSpan-1,i[v.index]={left:j.rowSpan-1,times:m}}else m--,h++;else i[v.index].left--,m=i[v.index].times,u++}return new wF(c,d,e,f)});return l}function xV(e,t){var r={};return e.forEach(function(n){if(n.raw!=null){var s=Not(t,n.raw);s!=null&&(r[n.dataKey]=s)}}),Object.keys(r).length>0?r:null}function Not(e,t){if(e==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(e==="foot"&&typeof t=="object")return t.footer;return null}function Sot(e){return e.map(function(t,r){var n,s;return typeof t=="object"?s=(n=t.dataKey)!==null&&n!==void 0?n:r:s=r,new Coe(s,t,r)})}function Cot(e,t,r,n,s,o,i){var l=aot(n),c;e==="head"?c=s.headStyles:e==="body"?c=s.bodyStyles:e==="foot"&&(c=s.footStyles);var d=Am({},l.table,l[e],s.styles,c),u=s.columnStyles[t.dataKey]||s.columnStyles[t.index]||{},f=e==="body"?u:{},h=e==="body"&&r%2===0?Am({},l.alternateRow,s.alternateRowStyles):{},m=not(o),x=Am({},m,d,h,f);return Am(x,i)}function Pot(e,t,r){var n;r===void 0&&(r={});var s=woe(e,t),o=new Map,i=[],l=[],c=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?c=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(c=[t.settings.horizontalPageBreakRepeat]),c.forEach(function(h){var m=t.columns.find(function(x){return x.dataKey===h||x.index===h});m&&!o.has(m.index)&&(o.set(m.index,!0),i.push(m.index),l.push(t.columns[m.index]),s-=m.wrappedWidth)});for(var d=!0,u=(n=r?.start)!==null&&n!==void 0?n:0;u<t.columns.length;){if(o.has(u)){u++;continue}var f=t.columns[u].wrappedWidth;if(d||s>=f)d=!1,i.push(u),l.push(t.columns[u]),s-=f;else break;u++}return{colIndexes:i,columns:l,lastIndex:u-1}}function Aot(e,t){for(var r=[],n=0;n<t.columns.length;n++){var s=Pot(e,t,{start:n});s.columns.length&&(r.push(s),n=s.lastIndex)}return r}function NF(e,t){var r=t.settings,n=r.startY,s=r.margin,o={x:s.left,y:n},i=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),l=n+s.bottom+i;if(r.pageBreak==="avoid"){var c=t.body,d=c.reduce(function(h,m){return h+m.height},0);l+=d}var u=new t0(e);(r.pageBreak==="always"||r.startY!=null&&l>u.pageSize().height)&&(Aoe(u),o.y=s.top),t.callWillDrawPageHooks(u,o);var f=Am({},o);t.startPageNumber=u.pageNumber(),r.horizontalPageBreak?Eot(u,t,f,o):(u.applyStyles(u.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&t.head.forEach(function(h){return Gm(u,t,h,o,t.columns)}),u.applyStyles(u.userStyles),t.body.forEach(function(h,m){var x=m===t.body.length-1;bC(u,t,h,x,f,o,t.columns)}),u.applyStyles(u.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&t.foot.forEach(function(h){return Gm(u,t,h,o,t.columns)})),yoe(u,t,f,o),t.callEndPageHooks(u,o),t.finalY=o.y,e.lastAutoTable=t,u.applyStyles(u.userStyles)}function Eot(e,t,r,n){var s=Aot(e,t),o=t.settings;if(o.horizontalPageBreakBehaviour==="afterAllRows")s.forEach(function(d,u){e.applyStyles(e.userStyles),u>0?fw(e,t,r,n,d.columns,!0):vV(e,t,n,d.columns),kot(e,t,r,n,d.columns),Fk(e,t,n,d.columns)});else for(var i=-1,l=s[0],c=function(){var d=i;if(l){e.applyStyles(e.userStyles);var u=l.columns;i>=0?fw(e,t,r,n,u,!0):vV(e,t,n,u),d=yV(e,t,i+1,n,u),Fk(e,t,n,u)}var f=d-i;s.slice(1).forEach(function(h){e.applyStyles(e.userStyles),fw(e,t,r,n,h.columns,!0),yV(e,t,i+1,n,h.columns,f),Fk(e,t,n,h.columns)}),i=d};i<t.body.length-1;)c()}function vV(e,t,r,n){var s=t.settings;e.applyStyles(e.userStyles),(s.showHead==="firstPage"||s.showHead==="everyPage")&&t.head.forEach(function(o){return Gm(e,t,o,r,n)})}function kot(e,t,r,n,s){e.applyStyles(e.userStyles),t.body.forEach(function(o,i){var l=i===t.body.length-1;bC(e,t,o,l,r,n,s)})}function yV(e,t,r,n,s,o){e.applyStyles(e.userStyles),o=o??t.body.length;var i=Math.min(r+o,t.body.length),l=-1;return t.body.slice(r,i).forEach(function(c,d){var u=r+d===t.body.length-1,f=Poe(e,t,u,n);c.canEntireRowFit(f,s)&&(Gm(e,t,c,n,s),l=r+d)}),l}function Fk(e,t,r,n){var s=t.settings;e.applyStyles(e.userStyles),(s.showFoot==="lastPage"||s.showFoot==="everyPage")&&t.foot.forEach(function(o){return Gm(e,t,o,r,n)})}function Iot(e,t,r){var n=r.getLineHeight(e.styles.fontSize),s=e.padding("vertical"),o=Math.floor((t-s)/n);return Math.max(0,o)}function Oot(e,t,r,n){var s={};e.spansMultiplePages=!0,e.height=0;for(var o=0,i=0,l=r.columns;i<l.length;i++){var c=l[i],d=e.cells[c.index];if(d){Array.isArray(d.text)||(d.text=[d.text]);var u=new jF(d.raw,d.styles,d.section);u=Am(u,d),u.text=[];var f=Iot(d,t,n);d.text.length>f&&(u.text=d.text.splice(f,d.text.length));var h=n.scaleFactor(),m=n.getLineHeightFactor();d.contentHeight=d.getContentHeight(h,m),d.contentHeight>=t&&(d.contentHeight=t,u.styles.minCellHeight-=t),d.contentHeight>e.height&&(e.height=d.contentHeight),u.contentHeight=u.getContentHeight(h,m),u.contentHeight>o&&(o=u.contentHeight),s[c.index]=u}}var x=new wF(e.raw,-1,e.section,s,!0);x.height=o;for(var g=0,v=r.columns;g<v.length;g++){var c=v[g],u=x.cells[c.index];u&&(u.height=x.height);var d=e.cells[c.index];d&&(d.height=e.height)}return x}function Tot(e,t,r,n){var s=e.pageSize().height,o=n.settings.margin,i=o.top+o.bottom,l=s-i;t.section==="body"&&(l-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var c=t.getMinimumRowHeight(n.columns,e),d=c<r;if(c>l)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!d)return!1;var u=t.hasRowSpan(n.columns),f=t.getMaxCellHeight(n.columns)>l;return f?(u&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(u||n.settings.rowPageBreak==="avoid")}function bC(e,t,r,n,s,o,i){var l=Poe(e,t,n,o);if(r.canEntireRowFit(l,i))Gm(e,t,r,o,i);else if(Tot(e,r,l,t)){var c=Oot(r,l,t,e);Gm(e,t,r,o,i),fw(e,t,s,o,i),bC(e,t,c,n,s,o,i)}else fw(e,t,s,o,i),bC(e,t,r,n,s,o,i)}function Gm(e,t,r,n,s){n.x=t.settings.margin.left;for(var o=0,i=s;o<i.length;o++){var l=i[o],c=r.cells[l.index];if(!c){n.x+=l.width;continue}e.applyStyles(c.styles),c.x=n.x,c.y=n.y;var d=t.callCellHooks(e,t.hooks.willDrawCell,c,r,l,n);if(d===!1){n.x+=l.width;continue}Dot(e,c,n);var u=c.getTextPos();goe(c.text,u.x,u.y,{halign:c.styles.halign,valign:c.styles.valign,maxWidth:Math.ceil(c.width-c.padding("left")-c.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,c,r,l,n),n.x+=l.width}n.y+=r.height}function Dot(e,t,r){var n=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),typeof n.lineWidth=="number"){var s=boe(n.lineWidth,n.fillColor);s&&e.rect(t.x,r.y,t.width,t.height,s)}else typeof n.lineWidth=="object"&&(n.fillColor&&e.rect(t.x,r.y,t.width,t.height,"F"),Mot(e,t,r,n.lineWidth))}function Mot(e,t,r,n){var s,o,i,l;n.top&&(s=r.x,o=r.y,i=r.x+t.width,l=r.y,n.right&&(i+=.5*n.right),n.left&&(s-=.5*n.left),c(n.top,s,o,i,l)),n.bottom&&(s=r.x,o=r.y+t.height,i=r.x+t.width,l=r.y+t.height,n.right&&(i+=.5*n.right),n.left&&(s-=.5*n.left),c(n.bottom,s,o,i,l)),n.left&&(s=r.x,o=r.y,i=r.x,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.left,s,o,i,l)),n.right&&(s=r.x+t.width,o=r.y,i=r.x+t.width,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.right,s,o,i,l));function c(d,u,f,h,m){e.getDocument().setLineWidth(d),e.getDocument().line(u,f,h,m,"S")}}function Poe(e,t,r,n){var s=t.settings.margin.bottom,o=t.settings.showFoot;return(o==="everyPage"||o==="lastPage"&&r)&&(s+=t.getFootHeight(t.columns)),e.pageSize().height-n.y-s}function fw(e,t,r,n,s,o){s===void 0&&(s=[]),o===void 0&&(o=!1),e.applyStyles(e.userStyles),t.settings.showFoot==="everyPage"&&!o&&t.foot.forEach(function(l){return Gm(e,t,l,n,s)}),t.callEndPageHooks(e,n);var i=t.settings.margin;yoe(e,t,r,n),Aoe(e),t.pageNumber++,n.x=i.left,n.y=i.top,r.y=i.top,t.callWillDrawPageHooks(e,n),t.settings.showHead==="everyPage"&&(t.head.forEach(function(l){return Gm(e,t,l,n,s)}),e.applyStyles(e.userStyles))}function Aoe(e){var t=e.pageNumber();e.setPage(t+1);var r=e.pageNumber();return r===t?(e.addPage(),!0):!1}function Eoe(e){e.API.autoTable=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0],s=bF(this,n),o=_F(this,s);return NF(this,o),this},e.API.lastAutoTable=!1,e.API.autoTableText=function(t,r,n,s){goe(t,r,n,s,this)},e.API.autoTableSetDefaults=function(t){return t0.setDefaults(t,this),this},e.autoTableSetDefaults=function(t,r){t0.setDefaults(t,r)},e.API.autoTableHtmlToJson=function(t,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var s=new t0(this),o=_oe(s,t,window,r,!1),i=o.head,l=o.body,c=((n=i[0])===null||n===void 0?void 0:n.map(function(d){return d.content}))||[];return{columns:c,rows:l,data:l}}}var Lk;function bV(e,t){var r=bF(e,t),n=_F(e,r);NF(e,n)}function Rot(e,t){var r=bF(e,t);return _F(e,r)}function Fot(e,t){NF(e,t)}try{if(typeof window<"u"&&window){var wV=window,jV=wV.jsPDF||((Lk=wV.jspdf)===null||Lk===void 0?void 0:Lk.jsPDF);jV&&Eoe(jV)}}catch(e){console.error("Could not apply autoTable plugin",e)}const Lot=Object.freeze(Object.defineProperty({__proto__:null,Cell:jF,CellHookData:Noe,Column:Coe,HookData:yC,Row:wF,Table:Soe,__createTable:Rot,__drawTable:Fot,applyPlugin:Eoe,autoTable:bV,default:bV},Symbol.toStringTag,{value:"Module"})),$ot={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.08,delayChildren:.1}}},dc={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};function o_({icon:e,label:t,value:r,delta:n,positive:s=!0,color:o="brand"}){return a.jsxs(Mr.div,{variants:dc,className:"fx-card border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(e,{className:`w-4 h-4 text-${o}`}),a.jsx("span",{children:t})]}),n!=null&&a.jsxs("div",{className:`text-xs font-bold ${s?"text-success":"text-danger"}`,children:[s?"+":"",n]})]}),a.jsx("div",{className:"text-3xl font-bold text-text-primary tabular-nums",children:r})]})}function Bot(){const{toast:e}=Xs(),{userProfile:t}=fo(),[r,n]=qC(),[s,o]=p.useState(r.get("tab")||"visao-geral"),[i,l]=p.useState(!1),[c,d]=p.useState(()=>{const J=new Date;return new Date(J.getFullYear(),J.getMonth(),1).toISOString().slice(0,10)}),[u,f]=p.useState(()=>new Date().toISOString().slice(0,10)),[h,m]=p.useState(null),[x,g]=p.useState(0),[v,y]=p.useState(0),[b,w]=p.useState([]),[j,_]=p.useState([]),[C,A]=p.useState([]),[S,P]=p.useState([]),[M,O]=p.useState([]),[I,T]=p.useState(0),[k,$]=p.useState(0),[q,z]=p.useState(!1),[F,V]=p.useState(!1),[ue,_e]=p.useState(null),[U,L]=p.useState([]),[G,de]=p.useState(!1),[X,W]=p.useState(!1),[Y,me]=p.useState(!1),[ee,ae]=p.useState(null),[le,Te]=p.useState([]),[te,ie]=p.useState([]);p.useState({open:!1,tipo:"suprimento",valor:"",observacao:"",loading:!1});const[xt,vt]=p.useState(!1),[dt,St]=p.useState(!1),[ft,_t]=p.useState(null),[gr,be]=p.useState([]),[Nt,Wt]=p.useState(""),[_r,yr]=p.useState("all"),[ve,at]=p.useState("all"),[qt,$t]=p.useState([]),[De,wt]=p.useState(""),[Rt,Rr]=p.useState("all"),[Me,tt]=p.useState("all"),[ut,sr]=p.useState(new Set),[Sr,xr]=p.useState(!1),[Wr,qr]=p.useState(!1),[Tr,sn]=p.useState(null),[Cn,ze]=p.useState([]),[Fe,Le]=p.useState(!1),[Ze,Ot]=p.useState([]);p.useState("");const mt=J=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(J||0)),Qt=J=>Number(J||0).toFixed(2),bt=async(J,Oe,Je,mr)=>{try{const{default:ot}=await Wf(()=>Promise.resolve().then(()=>vZe),void 0);await Wf(()=>Promise.resolve().then(()=>Lot),void 0);const ar=new ot("p","mm","a4"),ir=ar.internal.pageSize.getWidth();if(ar.setFontSize(20),ar.setTextColor(245,158,11),ar.text(J,14,20),ar.setDrawColor(245,158,11),ar.setLineWidth(.5),ar.line(14,23,ir-14,23),ar.setFontSize(10),ar.setTextColor(100,100,100),ar.text(`Perodo: ${c||"N/A"} at ${u||"N/A"}`,14,30),ar.text(`Gerado em: ${new Date().toLocaleString("pt-BR")}`,14,35),typeof ar.autoTable=="function"){ar.autoTable({head:[Oe],body:Je,startY:42,theme:"striped",headStyles:{fillColor:[245,158,11],textColor:[255,255,255],fontStyle:"bold",fontSize:11},bodyStyles:{fontSize:10,textColor:[50,50,50]},alternateRowStyles:{fillColor:[249,249,249]},margin:{top:42,left:14,right:14}});const In=ar.lastAutoTable.finalY||50;ar.setFontSize(8),ar.setTextColor(150,150,150),ar.text("Relatrio gerado por Fluxo7Arena - Sistema de Gesto de Quadras Esportivas",ir/2,In+15,{align:"center"})}else{let In=45;ar.setFontSize(11),ar.setTextColor(0,0,0),Oe.forEach((ln,Kr)=>{const oe=14+Kr*60;ar.text(ln,oe,In)}),In+=7,ar.setFontSize(10),Je.forEach(ln=>{ln.forEach((Kr,oe)=>{const Ke=14+oe*60;ar.text(String(Kr),Ke,In)}),In+=6})}ar.save(`${mr}_${or(new Date,"yyyy-MM-dd")}.pdf`),e({title:"PDF baixado com sucesso!",description:"O arquivo foi salvo na sua pasta de downloads"})}catch(ot){console.error("Erro ao gerar PDF:",ot),e({title:"Erro ao gerar PDF",description:ot.message,variant:"destructive"})}},zt=async()=>{try{const J=["Abertura","Fechamento","Saldo Inicial","Saldo Final","Valor Final (Dinheiro)","Diferena","Status"],Oe=(te||[]).map(Je=>[Je?.aberto_em?new Date(Je.aberto_em).toLocaleString("pt-BR"):"-",Je?.fechado_em?new Date(Je.fechado_em).toLocaleString("pt-BR"):"-",mt(Je?.saldo_inicial||0),Je?.saldo_final!=null?mt(Je.saldo_final):mt(0),Je?.valor_final_dinheiro!=null?mt(Je.valor_final_dinheiro):"",Je?.diferenca_dinheiro!=null?mt(Je.diferenca_dinheiro):"",String(Je?.status||"").toUpperCase()]);await bt("Fechamentos de Caixa",J,Oe,"fechamentos_caixa")}catch(J){e({title:"Erro ao exportar PDF",description:J?.message||"Tente novamente",variant:"destructive"})}},ne=()=>{try{const J=";",Je=[["Abertura","Fechamento","Saldo Inicial","Saldo Final","Valor Final (Dinheiro)","Diferena","Status"].join(J)];(te||[]).forEach(ir=>{const In=ir?.aberto_em?new Date(ir.aberto_em).toLocaleString("pt-BR"):"-",ln=ir?.fechado_em?new Date(ir.fechado_em).toLocaleString("pt-BR"):"-",Kr=Number(ir?.saldo_inicial||0).toFixed(2).replace(".",","),oe=(ir?.saldo_final!=null?Number(ir.saldo_final):0).toFixed(2).replace(".",","),Ke=ir?.valor_final_dinheiro!=null?Number(ir.valor_final_dinheiro):null,ct=ir?.diferenca_dinheiro!=null?Number(ir.diferenca_dinheiro):null,xe=String(ir?.status||"").toUpperCase();Je.push([In,ln,Kr,oe,Ke!=null?Ke.toFixed(2).replace(".",","):"",ct!=null?ct.toFixed(2).replace(".",","):"",xe].join(J))});const mr=new Blob(["\uFEFF"+Je.join(`
`)],{type:"text/csv;charset=utf-8;"}),ot=URL.createObjectURL(mr),ar=document.createElement("a");ar.href=ot,ar.download=`fechamentos_caixa_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(ar),ar.click(),document.body.removeChild(ar),URL.revokeObjectURL(ot),e({title:"CSV baixado com sucesso!"})}catch(J){e({title:"Erro ao exportar CSV",description:J?.message||"Tente novamente",variant:"destructive"})}},He=({cx:J,cy:Oe,midAngle:Je,outerRadius:mr,percent:ot})=>{const ar=Math.PI/180,ir=(mr||0)+12,In=J+ir*Math.cos(-Je*ar),ln=Oe+ir*Math.sin(-Je*ar);return a.jsx("text",{x:In,y:ln,fill:"#fff",textAnchor:In>J?"start":"end",dominantBaseline:"central",style:{pointerEvents:"none",fontSize:15,fontWeight:700},children:`${Math.round((ot||0)*100)}%`})},Gt=J=>{const Oe=Ae!=null&&Ae!==J;return{transition:"opacity 320ms ease-in-out, filter 320ms ease-in-out",opacity:Oe?.25:1,filter:Oe?"grayscale(15%)":"none",cursor:"pointer"}};p.useEffect(()=>{(async()=>{if(!Wr||!Tr||Tr.origem!=="Comanda"||!Tr.comanda_id){ze([]),Ot([]);return}try{Le(!0);const Oe=t?.codigo_empresa;let Je=Q.from("comanda_itens").select("descricao, quantidade, preco_unitario").eq("comanda_id",Tr.comanda_id);Oe&&(Je=Je.eq("codigo_empresa",Oe));const{data:mr}=await Je;ze(mr||[]);let ot=Q.from("pagamentos").select("id, valor, metodo, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").eq("comanda_id",Tr.comanda_id);Oe&&(ot=ot.eq("codigo_empresa",Oe));const{data:ar}=await ot;Ot(ar||[])}catch(Oe){console.warn("[Financeiro][RecebimentoModal] Falha ao carregar itens da comanda:",Oe?.message),ze([]),Ot([])}finally{Le(!1)}})()},[Wr,Tr,t?.codigo_empresa]);const Ht=async()=>{try{l(!0);const J=Tn(c)||void 0,Oe=Gn(u)||void 0,Je=t?.codigo_empresa;console.debug("[Financeiro][VisaoGeral] Carregando com perodo:",{fromISO:J,toISO:Oe,codigo:Je});const mr=await hu({from:J,to:Oe}).catch(()=>null);m(mr||{totalPorFinalizadora:{},totalEntradas:0,totalVendasBrutas:0,totalDescontos:0,totalVendasLiquidas:0}),console.debug("[Financeiro][VisaoGeral] Resumo calculado:",mr);try{let ot=Q.from("pagamentos").select("valor, status").eq("codigo_empresa",Je);J&&(ot=ot.gte("recebido_em",J)),Oe&&(ot=ot.lte("recebido_em",Oe));const{data:ar}=await ot,ir=(ar||[]).reduce((oe,Ke)=>{const ct=Ke.status||"Pago";return ct==="Cancelado"||ct==="Estornado"?oe:oe+Number(Ke.valor||0)},0);g(ir);let In=Q.from("agendamentos").select("id").eq("codigo_empresa",Je);J&&(In=In.gte("inicio",J)),Oe&&(In=In.lte("inicio",Oe));const{data:ln}=await In;let Kr=0;if(ln&&ln.length>0){const oe=ln.map(ct=>ct.id),{data:Ke}=await Q.from("agendamento_participantes").select("valor_cota, aplicar_taxa, finalizadoras!agp_finalizadora_id_fkey(taxa_percentual)").eq("codigo_empresa",Je).in("agendamento_id",oe).eq("status_pagamento","Pago");Kr=(Ke||[]).reduce((ct,xe)=>{let $e=Number(xe.valor_cota||0);if(xe.aplicar_taxa===!0){const Pe=Number(xe.finalizadoras?.taxa_percentual||0);Pe>0&&($e=$e/(1+Pe/100))}return ct+$e},0)}y(Kr),console.debug("[Financeiro][VisaoGeral] Receitas por origem:",{totalComandas:ir,totalAg:Kr})}catch(ot){console.warn("[Financeiro][VisaoGeral] Falha ao calcular KPIs por origem:",ot?.message),g(0),y(0)}try{let ot=Q.from("pagamentos").select("valor, status, origem").eq("codigo_empresa",Je).eq("origem","xml");J&&(ot=ot.gte("recebido_em",J)),Oe&&(ot=ot.lte("recebido_em",Oe));const{data:ar}=await ot,ir=(ar||[]).reduce((ln,Kr)=>["Cancelado","Estornado"].includes(Kr.status)?ln:ln+Number(Kr.valor||0),0);T(ir);const{count:In}=await Q.from("produtos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",Je).or("importado_via_xml.is.true,categoria.ilike.Importados").gte("criado_em",J).lte("criado_em",Oe);$(In||0)}catch(ot){console.warn("[Financeiro][VisaoGeral] Falha KPIs XML:",ot?.message),T(0),$(0)}if(Je){let ot=Q.from("comandas").select("id").eq("status","closed");Je&&(ot=ot.eq("codigo_empresa",Je)),J&&(ot=ot.gte("fechado_em",J)),Oe&&(ot=ot.lte("fechado_em",Oe));const{data:ar,error:ir}=await ot;if(ir)throw ir;const In=(ar||[]).map(Ke=>Ke.id);console.debug("[Financeiro][VisaoGeral] Comandas fechadas:",In.length);let ln=[];if(In.length>0){let Ke=Q.from("comanda_itens").select("produto_id, quantidade, preco_unitario, produtos!comanda_itens_produto_id_fkey(nome)").in("comanda_id",In);Je&&(Ke=Ke.eq("codigo_empresa",Je));const{data:ct}=await Ke;ln=ct||[]}const Kr={};(ln||[]).forEach(Ke=>{const ct=Ke.produtos?.nome||"Produto sem nome",xe=Number(Ke.quantidade||0),$e=xe*Number(Ke.preco_unitario||0);Kr[ct]||(Kr[ct]={quantidade:0,valor:0}),Kr[ct].quantidade+=xe,Kr[ct].valor+=$e});const oe=Object.entries(Kr).map(([Ke,ct])=>({nome:Ke,quantidade:ct.quantidade,valor:ct.valor})).sort((Ke,ct)=>ct.valor-Ke.valor);A(oe),w(oe.slice(0,5)),console.debug("[Financeiro][VisaoGeral] Produtos agregados:",{total:oe.length,top5:oe.slice(0,5)})}if(Je)try{let ot=Q.from("pagamentos").select("comanda_id, valor, status").eq("codigo_empresa",Je).neq("status","Cancelado").neq("status","Estornado");J&&(ot=ot.gte("recebido_em",J)),Oe&&(ot=ot.lte("recebido_em",Oe));const{data:ar}=await ot;console.debug("[Financeiro][VisaoGeral] Pagamentos carregados:",(ar||[]).length);const ir=Array.from(new Set((ar||[]).map(xe=>xe.comanda_id).filter(Boolean)));let In=[];if(ir.length>0){let xe=Q.from("comanda_clientes").select("comanda_id, cliente_id, nome_livre").in("comanda_id",ir).eq("codigo_empresa",Je);const{data:$e}=await xe;In=$e||[]}console.debug("[Financeiro][VisaoGeral] Vinculos comanda_clientes:",In.length);const ln=Array.from(new Set(In.map(xe=>xe.cliente_id).filter(Boolean))),Kr={};if(ln.length>0){const{data:xe}=await Q.from("clientes").select("id, nome").in("id",ln).eq("codigo_empresa",Je);(xe||[]).forEach($e=>{Kr[$e.id]=$e.nome})}const oe={};In.forEach(xe=>{const $e=xe.nome_livre||Kr[xe.cliente_id]||`Cliente ${xe.cliente_id||""}`;oe[xe.comanda_id]||(oe[xe.comanda_id]=new Set),$e&&oe[xe.comanda_id].add($e)});const Ke={};(ar||[]).forEach(xe=>{const $e=Array.from(oe[xe.comanda_id]||[]),Pe=Number(xe.valor||0);if($e.length===0){const Vt="Sem cliente";Ke[Vt]||(Ke[Vt]={id:null,nome:Vt,valor:0}),Ke[Vt].valor+=Pe}else $e.forEach(Vt=>{Ke[Vt]||(Ke[Vt]={id:null,nome:Vt,valor:0}),Ke[Vt].valor+=Pe})});try{const xe=new Map(Object.values(Kr).map((Lr,da)=>[Object.keys(Kr)[da],Lr]));let $e=Q.from("v_agendamento_participantes").select("agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text");Je&&($e=$e.eq("codigo_empresa",Je));let{data:Pe}=await $e;Pe=Pe||[];const Vt=Array.from(new Set(Pe.map(Lr=>Lr.agendamento_id).filter(Boolean)));let yt=new Set;if(Vt.length>0){let Lr=Q.from("agendamentos").select("id, inicio").in("id",Vt);Je&&(Lr=Lr.eq("codigo_empresa",Je));const{data:da}=await Lr,rn=J?new Date(J).getTime():null,un=Oe?new Date(Oe).getTime():null;(da||[]).forEach(Dn=>{const fa=Dn?.inicio?new Date(Dn.inicio).getTime():null;fa!=null&&(rn==null||fa>=rn)&&(un==null||fa<=un)&&yt.add(Dn.id)})}const tr=Pe.filter(Lr=>yt.has(Lr.agendamento_id));console.debug("[Financeiro][Agendamentos] participantes no perodo (by agendamento.inicio):",tr.length);const tn=Array.from(new Set((tr||[]).map(Lr=>Lr.cliente_id).filter(Boolean).map(String))).filter(Lr=>!xe.has(Lr));if(tn.length>0){const{data:Lr}=await Q.from("clientes").select("id,nome").in("id",tn);(Lr||[]).forEach(da=>xe.set(String(da.id),da.nome))}(tr||[]).forEach(Lr=>{const da=String(Lr.status_pagamento||Lr.status_pagamento_text||"pago").toLowerCase();if(["cancelado","estornado"].includes(da))return;const rn=Lr.cliente_id,un=rn?xe.get(String(rn))||`Cliente ${rn}`:null;if(!un)return;const Dn=Number(Lr.valor_cota||0);Ke[un]||(Ke[un]={id:rn||null,nome:un,valor:0}),Ke[un].valor+=Dn})}catch{}const ct=Object.values(Ke).sort((xe,$e)=>$e.valor-xe.valor);P(ct),_(ct.slice(0,5)),console.debug("[Financeiro][VisaoGeral] Clientes agregados:",{total:ct.length,top5:ct.slice(0,5)})}catch(ot){console.error("Erro ao carregar top clientes:",ot),_([]),P([])}if(Je&&J&&Oe)try{let ot=Q.from("pagamentos").select("recebido_em, valor, status").eq("codigo_empresa",Je).gte("recebido_em",J).lte("recebido_em",Oe).order("recebido_em",{ascending:!0});const{data:ar}=await ot;let ir=Q.from("v_agendamentos_detalhado").select("inicio, valor_pago, status_pagamento").eq("codigo_empresa",Je).eq("status_pagamento","Pago").gte("inicio",J).lte("inicio",Oe).order("inicio",{ascending:!0});const{data:In}=await ir,ln={};(ar||[]).forEach(oe=>{if(["Cancelado","Estornado"].includes(oe.status))return;const Ke=new Date(oe.recebido_em).toLocaleDateString("pt-BR");ln[Ke]=(ln[Ke]||0)+Number(oe.valor||0)}),(In||[]).forEach(oe=>{const Ke=new Date(oe.inicio).toLocaleDateString("pt-BR");ln[Ke]=(ln[Ke]||0)+Number(oe.valor_pago||0)});const Kr=Object.entries(ln).map(([oe,Ke])=>({data:oe,valor:Ke})).sort((oe,Ke)=>{const[ct,xe,$e]=oe.data.split("/").map(Number),[Pe,Vt,yt]=Ke.data.split("/").map(Number);return new Date($e,xe-1,ct).getTime()-new Date(yt,Vt-1,Pe).getTime()});O(Kr),console.debug("[Financeiro][VisaoGeral] Evoluo diria:",Kr.length,"dias")}catch(ot){console.warn("[Financeiro][VisaoGeral] Falha ao calcular evoluo diria:",ot?.message),O([])}else O([])}catch(J){e({title:"Falha ao carregar viso geral",description:J?.message||"Tente novamente",variant:"destructive"})}finally{l(!1)}},Fr=async()=>{try{const J=t?.codigo_empresa,Oe=await qh({codigoEmpresa:J});if(me(!!Oe),Oe){const[mr,ot]=await Promise.all([P1({codigoEmpresa:J}),$g({caixaSessaoId:Oe.id,codigoEmpresa:J})]);ae(mr||null),Te(ot||[])}else ae(null),Te([]);const Je=await lne({limit:50,codigoEmpresa:J});if(console.log("[FinanceiroPage][loadCaixa] Histrico recebido de listarFechamentosCaixa:",Je?.length,"sesses"),Je&&Je.length>0){console.log("[FinanceiroPage][loadCaixa] Primeira sesso do histrico:",Je[0]);const mr=Je.filter(ot=>ot.valor_final_dinheiro!=null);console.log("[FinanceiroPage][loadCaixa] Sesses com valor_final_dinheiro:",mr.length,"/",Je.length)}ie(Je||[])}catch(J){e({title:"Falha ao carregar caixa",description:J?.message,variant:"destructive"})}},cr=async()=>{try{l(!0);const J=t?.codigo_empresa,Oe=Tn(c)||void 0,Je=Gn(u)||void 0;let mr=Q.from("pagamentos").select("id, comanda_id, valor, status, metodo, recebido_em, origem, xml_chave, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").eq("codigo_empresa",J).order("recebido_em",{ascending:!1});Oe&&(mr=mr.gte("recebido_em",Oe)),Je&&(mr=mr.lte("recebido_em",Je));const{data:ot}=await mr;let ar=new Map,ir=new Map;try{const Ke=Array.from(new Set((ot||[]).map(ct=>ct.comanda_id).filter(Boolean)));if(Ke.length>0){const{data:ct}=await Q.from("comandas").select("id, cliente_id, tipo").in("id",Ke).eq("codigo_empresa",J),xe=Array.from(new Set((ct||[]).map(Vt=>Vt.cliente_id).filter(Boolean)));let $e=new Map;if(xe.length>0){const{data:Vt}=await Q.from("clientes").select("id, nome").in("id",xe).eq("codigo_empresa",J);$e=new Map((Vt||[]).map(yt=>[yt.id,yt.nome]))}for(const Vt of ct||[]){if(!Vt)continue;const yt=$e.get(Vt.cliente_id)||null;ar.set(Vt.id,yt),ir.set(Vt.id,Vt.tipo||null)}const Pe=(ct||[]).filter(Vt=>!Vt?.cliente_id).map(Vt=>Vt.id);if(Pe.length>0)try{const{data:Vt}=await Q.from("comanda_clientes").select("comanda_id, cliente_id").in("comanda_id",Pe).eq("codigo_empresa",J),yt=Array.from(new Set((Vt||[]).map(tr=>tr.cliente_id).filter(Boolean)));if(yt.length>0){const{data:tr}=await Q.from("clientes").select("id, nome").in("id",yt).eq("codigo_empresa",J),dr=new Map((tr||[]).map(tn=>[tn.id,tn.nome]));for(const tn of Vt||[]){const Lr=dr.get(tn.cliente_id)||null;Lr&&!ar.get(tn.comanda_id)&&ar.set(tn.comanda_id,Lr)}}}catch{console.debug("[Financeiro][Recebimentos] comanda_clientes indisponvel (ok)")}}}catch(Ke){console.warn("[Financeiro][Recebimentos] Falha ao buscar clientes de comandas:",Ke?.message)}let In=Q.from("v_agendamentos_detalhado").select("agendamento_id, agendamento_codigo, inicio, quadra_nome, participante_nome, valor_cota, status_pagamento, finalizadora_nome").eq("codigo_empresa",J).eq("status_pagamento","Pago").order("inicio",{ascending:!1});Oe&&(In=In.gte("inicio",Oe)),Je&&(In=In.lte("inicio",Je));const{data:ln}=await In,Kr=(ot||[]).map(Ke=>({id:Ke.id,origem:ir.get(Ke.comanda_id||"")==="balcao"?"Balco":"Comanda",comanda_id:Ke.comanda_id||null,recebido_em:Ke.recebido_em,finalizadoras:Ke.finalizadoras,metodo:Ke.metodo,valor:Ke.valor,status:Ke.status,descricao:ar.get(Ke.comanda_id||"")||null,fonte:Ke.origem||"manual",xml_chave:Ke.xml_chave||null})),oe=(ln||[]).map((Ke,ct)=>({id:`ag-${Ke.agendamento_id}-${ct}`,origem:"Agendamento",recebido_em:Ke.inicio,finalizadoras:Ke.finalizadora_nome?{nome:Ke.finalizadora_nome}:null,metodo:Ke.finalizadora_nome||null,valor:Ke.valor_cota,status:Ke.status_pagamento,descricao:`#${Ke.agendamento_codigo} - ${Ke.participante_nome} (${Ke.quadra_nome||""})`,agendamento_codigo:Ke.agendamento_codigo,quadra_nome:Ke.quadra_nome,participante_nome:Ke.participante_nome,fonte:null}));be([...Kr,...oe])}catch(J){e({title:"Falha ao carregar recebimentos",description:J?.message,variant:"destructive"})}finally{l(!1)}},nn=async()=>{try{l(!0);const J=t?.codigo_empresa,Oe=Tn(c)||void 0,Je=Gn(u)||void 0;let mr=Q.from("v_agendamentos_detalhado").select("agendamento_id, agendamento_codigo, inicio, fim, quadra_nome, participante_nome, cliente_id, valor_cota, finalizadora_nome, status_pagamento").eq("codigo_empresa",J).order("inicio",{ascending:!1});Oe&&(mr=mr.gte("inicio",Oe)),Je&&(mr=mr.lte("inicio",Je));const{data:ot}=await mr,ar=[...new Set((ot||[]).map(ln=>ln.cliente_id).filter(Boolean))];let ir={};if(ar.length>0){const{data:ln}=await Q.from("clientes").select("id, is_consumidor_final, codigo").in("id",ar).eq("codigo_empresa",J);ln&&(ir=Object.fromEntries(ln.map(Kr=>[Kr.id,Kr])))}const In=(ot||[]).map(ln=>({...ln,is_consumidor_final:ir[ln.cliente_id]?.is_consumidor_final||!1,cliente_codigo:ir[ln.cliente_id]?.codigo||null}));$t(In)}catch(J){e({title:"Falha ao carregar agendamentos",description:J?.message,variant:"destructive"})}finally{l(!1)}};p.useEffect(()=>{n({tab:s})},[s]);const Tn=J=>{if(!J)return null;if(typeof J=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(J)){const[Oe,Je,mr]=J.split("-").map(Number);return new Date(Oe,Je-1,mr,0,0,0,0).toISOString()}return new Date(J).toISOString()},Gn=J=>{if(!J)return null;if(typeof J=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(J)){const[Oe,Je,mr]=J.split("-").map(Number);return new Date(Oe,Je-1,mr,23,59,59,999).toISOString()}return new Date(J).toISOString()};p.useEffect(()=>{t?.codigo_empresa&&(s==="visao-geral"||s==="relatorios"?Ht():s==="caixa"?Fr():s==="recebimentos"?cr():s==="agendamentos"&&nn())},[s,c,u,t?.codigo_empresa]);const ta=p.useMemo(()=>{const J=h?.totalPorFinalizadora||{},Oe=Object.entries(J).map(([Je,mr])=>({name:Je,valor:Number(mr||0)}));return Oe.sort((Je,mr)=>mr.valor-Je.valor),Oe},[h]),[Aa,ke]=p.useState(null),[Ae,et]=p.useState(null),br={start:90,end:-270},Zt=(J,Oe,Je)=>J+(Oe-J)*Je,Pn=J=>J<.5?4*J*J*J:1-Math.pow(-2*J+2,3)/2,Ct=J=>{const Oe=Number(x||0),Je=Number(v||0),mr=Math.max(1e-4,Oe+Je),ot=360*(Oe/mr);return J===0?{a:br.start,b:br.start-ot}:{a:br.start-ot,b:br.end}},[lr,Ye]=p.useState({from:null,to:null,t:1}),Tt=Ae??Aa;p.useEffect(()=>{if(Tt==null)return;const J=Ct(Tt);Ye(ar=>({from:ar.to||J,to:J,t:0}));let Oe;const Je=performance.now(),mr=380,ot=ar=>{const ir=Math.min(1,(ar-Je)/mr),In=Pn(ir);Ye(ln=>({...ln,t:In})),ir<1&&(Oe=requestAnimationFrame(ot))};return Oe=requestAnimationFrame(ot),()=>Oe&&cancelAnimationFrame(Oe)},[Tt,x,v]);const Xt=86,Br=94,Wn=80,[xn,on]=p.useState({from:[Xt,Xt],to:[Xt,Xt],t:1});p.useEffect(()=>{const J=Tt===0?[Br,Wn]:Tt===1?[Wn,Br]:[Xt,Xt];on(ar=>({from:ar.to||J,to:J,t:0}));let Oe;const Je=performance.now(),mr=380,ot=ar=>{const ir=Math.min(1,(ar-Je)/mr),In=Pn(ir);on(ln=>({...ln,t:In})),ir<1&&(Oe=requestAnimationFrame(ot))};return Oe=requestAnimationFrame(ot),()=>Oe&&cancelAnimationFrame(Oe)},[Tt]);const ua=({cx:J,cy:Oe,outerRadius:Je})=>{if(!lr.from||!lr.to)return null;const mr=Zt(lr.from.a,lr.to.a,lr.t),ot=Zt(lr.from.b,lr.to.b,lr.t),ar=Tt===0?"#22C55E":"#F59E0B";return a.jsx(JM,{cx:J,cy:Oe,innerRadius:0,outerRadius:(Je||0)+4,startAngle:mr,endAngle:ot,fill:ar,fillOpacity:.18,stroke:"transparent"})},sa=p.useMemo(()=>{let J=gr;if(Nt){const Oe=Nt.toLowerCase();J=J.filter(Je=>(Je.descricao||"").toLowerCase().includes(Oe)||(Je.finalizadoras?.nome||"").toLowerCase().includes(Oe)||String(Je.valor||"").includes(Oe)||(Je.origem||"").toLowerCase().includes(Oe))}return _r!=="all"&&(J=J.filter(Oe=>(Oe.finalizadoras?.nome||Oe.metodo)===_r)),ve!=="all"&&(J=J.filter(Oe=>(Oe.fonte||"manual")===ve)),J},[gr,Nt,_r,ve]),wa=p.useMemo(()=>{const J={};return(qt||[]).forEach(Oe=>{const Je=Oe.agendamento_id||Oe.agendamento_codigo;J[Je]||(J[Je]={agendamento_id:Oe.agendamento_id,agendamento_codigo:Oe.agendamento_codigo,inicio:Oe.inicio,fim:Oe.fim,quadra_nome:Oe.quadra_nome,participantes:[],total:0,totalPago:0,totalPendente:0,statusGeral:"Pendente",representante:"",representanteClienteId:null,representanteCodigo:null,isRepresentanteConsumidor:!1}),J[Je].participantes.push(Oe),J[Je].total+=Number(Oe.valor_cota||0),Oe.status_pagamento==="Pago"?J[Je].totalPago+=Number(Oe.valor_cota||0):J[Je].totalPendente+=Number(Oe.valor_cota||0)}),Object.values(J).forEach(Oe=>{const Je=Oe.participantes.every(ot=>ot.status_pagamento==="Pago");if(Oe.participantes.every(ot=>ot.status_pagamento==="Cancelado")?Oe.statusGeral="Cancelado":Je?Oe.statusGeral="Pago":Oe.statusGeral="Pendente",Oe.participantes.length>0){let ot=Oe.participantes.find(ir=>!ir.is_consumidor_final);ot||(ot=Oe.participantes[0]);let ar=ot?.participante_nome||"";ot?.is_consumidor_final&&ar&&(ar.toLowerCase().includes("cliente consumidor")||(ar=ar)),Oe.representante=ar,Oe.representanteClienteId=ot?.cliente_id||null,Oe.representanteCodigo=ot?.is_consumidor_final?0:ot?.cliente_codigo??null,Oe.isRepresentanteConsumidor=ot?.is_consumidor_final||!1}}),Object.values(J).sort((Oe,Je)=>new Date(Je.inicio)-new Date(Oe.inicio))},[qt]),Va=p.useMemo(()=>{const J=De.toLowerCase().trim();return wa.filter(Oe=>{if(Rt!=="all"&&(Rt==="Pago"&&Oe.statusGeral!=="Pago"||Rt==="Pendente"&&Oe.statusGeral!=="Pendente"||Rt==="Cancelado"&&Oe.statusGeral!=="Cancelado")||Me!=="all"&&!Oe.participantes.some(ir=>ir.finalizadora_nome===Me))return!1;if(!J)return!0;const Je=String(Oe.agendamento_codigo||""),mr=String(Oe.quadra_nome||"").toLowerCase(),ot=Oe.participantes.map(ar=>String(ar.participante_nome||"").toLowerCase()).join(" ");return Je.includes(J)||mr.includes(J)||ot.includes(J)})},[wa,De,Rt,Me]);return a.jsx(a.Fragment,{children:a.jsxs(Mr.div,{variants:$ot,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsx(Mr.div,{variants:dc,className:"fx-card p-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Financeiro"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Gesto completa das finanas da empresa"})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-stretch sm:items-center gap-3 w-full sm:w-auto",children:[a.jsxs("div",{className:"flex flex-col justify-center flex-1 sm:flex-initial",children:[a.jsx("label",{className:"text-xs text-text-secondary mb-1",children:"Incio"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"h-9 w-full sm:w-[160px] pl-3 pr-3 flex items-center gap-2 justify-start text-left font-medium bg-black border-warning/40 text-white hover:bg-black/80 hover:border-warning",children:[a.jsx(ko,{className:"h-5 w-5 text-warning flex-shrink-0"}),a.jsx("span",{className:"font-mono tracking-wide text-sm leading-none",children:c?or(new Date(c+"T00:00:00"),"dd/MM/yyyy",{locale:Da}):"Selecione"})]})}),a.jsx(Ho,{className:"w-auto p-0 bg-black border-warning/40",align:"start",children:a.jsx(ei,{mode:"single",selected:c?new Date(c+"T00:00:00"):void 0,onSelect:J=>J&&d(or(J,"yyyy-MM-dd")),initialFocus:!0,classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md border-warning/40"}})})]})]}),a.jsxs("div",{className:"flex flex-col justify-center flex-1 sm:flex-initial",children:[a.jsx("label",{className:"text-xs text-text-secondary mb-1",children:"Fim"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"h-9 w-full sm:w-[160px] pl-3 pr-3 flex items-center gap-2 justify-start text-left font-medium bg-black border-warning/40 text-white hover:bg-black/80 hover:border-warning",children:[a.jsx(ko,{className:"h-5 w-5 text-warning flex-shrink-0"}),a.jsx("span",{className:"font-mono tracking-wide text-sm leading-none",children:u?or(new Date(u+"T00:00:00"),"dd/MM/yyyy",{locale:Da}):"Selecione"})]})}),a.jsx(Ho,{className:"w-auto p-0 bg-black border-warning/40",align:"start",children:a.jsx(ei,{mode:"single",selected:u?new Date(u+"T00:00:00"):void 0,onSelect:J=>J&&f(or(J,"yyyy-MM-dd")),initialFocus:!0,classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md border-warning/40"}})})]})]})]})]})}),a.jsxs(Sd,{value:s,onValueChange:o,children:[a.jsx("div",{className:"md:hidden mb-4",children:a.jsxs(ea,{value:s,onValueChange:o,children:[a.jsx(Jn,{className:"w-full h-11 bg-black border-warning/40 text-white",children:a.jsx(ra,{placeholder:"Selecione uma aba"})}),a.jsxs(Qn,{className:"bg-black text-white border-warning/40",children:[a.jsx(Qe,{value:"visao-geral",children:"Viso Geral"}),a.jsx(Qe,{value:"caixa",children:"Caixa"}),a.jsx(Qe,{value:"recebimentos",children:"Recebimentos"}),a.jsx(Qe,{value:"agendamentos",children:"Agendamentos"}),a.jsx(Qe,{value:"relatorios",children:"Relatrios"})]})]})}),a.jsxs(jc,{className:"hidden md:grid w-full grid-cols-5",children:[a.jsx(Ga,{value:"visao-geral",children:"Viso Geral"}),a.jsx(Ga,{value:"caixa",children:"Caixa"}),a.jsx(Ga,{value:"recebimentos",children:"Recebimentos"}),a.jsx(Ga,{value:"agendamentos",children:"Agendamentos"}),a.jsx(Ga,{value:"relatorios",children:"Relatrios"})]}),a.jsxs(vo,{value:"visao-geral",className:"space-y-6 mt-6",children:[a.jsxs(Mr.div,{variants:dc,className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[a.jsx(o_,{icon:CG,label:"Total Geral",value:mt(Number(x||0)+Number(v||0)),color:"brand"}),a.jsx(o_,{icon:X1,label:"Comandas",value:mt(x),color:"success"}),a.jsx(o_,{icon:ko,label:"Agendamentos",value:mt(v),color:"success"}),a.jsx(o_,{icon:Rh,label:"XML (Recebimentos)",value:mt(I),color:"success"})]}),a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(Rh,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Proporo de Receita"})]})}),Number(x||0)+Number(v||0)===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem receitas no perodo."}):a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[a.jsx("div",{className:"w-full md:flex-1 h-[280px]",children:a.jsx(Hb,{width:"100%",height:"100%",children:a.jsxs(vUe,{children:[a.jsxs(em,{data:function(){const J=Zt(xn.from?.[0]??Xt,xn.to?.[0]??Xt,xn.t),Oe=Zt(xn.from?.[1]??Xt,xn.to?.[1]??Xt,xn.t);return[{name:"Comandas",value:Number(x||0),fill:"#22C55E",outerRadius:J},{name:"Agendamentos",value:Number(v||0),fill:"#F59E0B",outerRadius:Oe}]}(),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:0,stroke:"transparent",label:!1,labelLine:!1,isAnimationActive:!0,animationBegin:50,animationDuration:500,startAngle:br.start,endAngle:br.end,activeIndex:Tt,activeShape:void 0,onMouseEnter:(J,Oe)=>ke(Oe),onMouseLeave:()=>ke(null),onClick:(J,Oe)=>{et(Je=>Je===Oe?null:Oe),ke(Oe)},children:[a.jsx(Kw,{fill:"#22C55E",style:Gt(0)},"c"),a.jsx(Kw,{fill:"#F59E0B",style:Gt(1)},"a")]}),ua({cx:"50%",cy:"50%",outerRadius:92}),a.jsx(em,{data:function(){const J=Zt(xn.from?.[0]??Xt,xn.to?.[0]??Xt,xn.t),Oe=Zt(xn.from?.[1]??Xt,xn.to?.[1]??Xt,xn.t);return[{name:"Comandas",value:Number(x||0),fill:"transparent",outerRadius:J},{name:"Agendamentos",value:Number(v||0),fill:"transparent",outerRadius:Oe}]}(),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:0,stroke:"transparent",label:He,labelLine:!1,isAnimationActive:!1,startAngle:br.start,endAngle:br.end}),a.jsx(Lc,{formatter:J=>mt(J),contentStyle:{background:"rgba(10, 10, 10, 0.95)",border:"1px solid #fbbf24",borderRadius:"8px",padding:"8px 10px",color:"#fff"},labelStyle:{color:"#fff"},itemStyle:{color:"#fff"},cursor:{fill:"rgba(251, 191, 36, 0.06)"}})]})})}),a.jsx("div",{className:"w-full md:w-64 space-y-3 md:pr-2",children:[{name:"Comandas",value:Number(x||0),color:"#22C55E"},{name:"Agendamentos",value:Number(v||0),color:"#F59E0B"}].map((J,Oe)=>a.jsxs("div",{className:`flex items-center justify-between px-3 py-2 rounded-md transition-all duration-200 ${Aa===Oe?"bg-white/5":"hover:bg-white/5"} cursor-pointer ${Ae!=null&&Ae!==Oe?"opacity-60":""}`,onMouseEnter:()=>ke(Oe),onMouseLeave:()=>ke(null),onClick:()=>et(Je=>Je===Oe?null:Oe),role:"button",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-sm",style:{backgroundColor:J.color}}),a.jsx("span",{className:"text-sm text-text-secondary",children:J.name})]}),a.jsx("div",{className:`text-sm font-semibold ${Ae!=null&&Ae!==Oe?"opacity-70":""}`,children:mt(J.value)})]},J.name))})]})]}),a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(Rh,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Entradas por Finalizadora"})]})}),ta.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos no perodo."}):a.jsx("div",{className:"h-[280px]",children:a.jsx(Hb,{width:"100%",height:"100%",children:a.jsxs(xUe,{data:ta,margin:{top:8,right:8,left:8,bottom:8},children:[a.jsx(BS,{strokeDasharray:"3 3",stroke:"#333"}),a.jsx(jp,{dataKey:"name",stroke:"#aaa"}),a.jsx(_p,{stroke:"#aaa",tickFormatter:J=>mt(J),width:80}),a.jsx(Lc,{formatter:J=>mt(J),labelFormatter:J=>`Finalizadora: ${J}`,contentStyle:{background:"rgba(10, 10, 10, 0.95)",border:"1px solid #fbbf24",borderRadius:"8px",padding:"8px 12px",color:"#fff"},cursor:{fill:"rgba(251, 191, 36, 0.1)"}}),a.jsx(Mg,{}),a.jsx(Sx,{dataKey:"valor",name:"Valor",fill:"#fbbf24"})]})})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4 border-0 ring-0 outline-none focus-visible:outline-none shadow-none cursor-pointer",onClick:()=>z(!0),children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider mb-3",children:[a.jsx(ju,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Produtos mais vendidos"}),C.length>5&&a.jsx(Z,{variant:"outline",size:"xs",className:"ml-auto h-7 px-2",onClick:()=>z(!0),children:"Ver todos"})]}),b.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados no perodo."}):a.jsx("div",{className:"space-y-2",children:b.map((J,Oe)=>a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border last:border-0",children:[a.jsxs("span",{className:"text-sm text-text-primary",children:[Oe+1,". ",J.nome]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:mt(J.valor)}),a.jsxs("span",{className:"text-sm font-bold text-brand",children:["x",J.quantidade]})]})]},Oe))})]}),a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4 border-0 ring-0 outline-none focus-visible:outline-none shadow-none cursor-pointer",onClick:()=>V(!0),children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider mb-3",children:[a.jsx(vc,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Clientes (por valor pago)"}),S.length>5&&a.jsx(Z,{variant:"outline",size:"xs",className:"ml-auto h-7 px-2",onClick:()=>V(!0),children:"Ver todos"})]}),j.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados no perodo."}):a.jsx("div",{className:"space-y-2",children:j.map((J,Oe)=>a.jsxs("button",{className:"w-full flex items-center justify-between py-2 border-b border-border last:border-0 hover:bg-surface-2 rounded-sm px-2 text-left",onClick:()=>{_e(J),V(!0)},children:[a.jsxs("span",{className:"text-sm text-text-primary",children:[Oe+1,". ",J.nome]}),a.jsx("span",{className:"text-sm font-bold text-success",children:mt(J.valor)})]},Oe))})]})]})]}),a.jsx(vo,{value:"agendamentos",className:"space-y-6 mt-6",children:a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"Agendamentos (Pagamentos por Participante)"}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:items-center",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar (#cdigo, participante, quadra)",value:De,onChange:J=>wt(J.target.value),className:"pl-10 pr-10 w-full md:w-[260px] bg-black border-warning/40 text-white placeholder:text-white/60"}),a.jsxs(Qo,{open:Sr,onOpenChange:xr,children:[a.jsx(Zo,{asChild:!0,children:a.jsx(Z,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0 hover:bg-warning/20",title:"Selecionar cliente",children:a.jsx("svg",{className:"h-4 w-4 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})}),a.jsx(Ho,{className:"w-[280px] p-2 bg-surface border-border",align:"end",children:a.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto",children:[a.jsx("div",{className:"text-xs font-semibold text-text-secondary px-2 py-1 sticky top-0 bg-surface z-10",children:"Selecionar Cliente"}),(()=>{const J=new Map;qt.forEach(Je=>{const mr=Je.participante_nome;mr&&!J.has(mr)&&J.set(mr,{nome:mr,codigo:Je.cliente_codigo||0,is_consumidor:Je.is_consumidor_final||!1})});const Oe=Array.from(J.values()).sort((Je,mr)=>Je.is_consumidor!==mr.is_consumidor?Je.is_consumidor?1:-1:Je.nome.localeCompare(mr.nome));return Oe.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-4",children:"Nenhum participante encontrado"}):Oe.map((Je,mr)=>a.jsxs("button",{onClick:()=>{wt(Je.nome),xr(!1)},className:"w-full flex items-center gap-2 px-2 py-2 hover:bg-surface-2 rounded text-left transition-colors",children:[a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[24px] h-5 px-1 rounded text-[10px] font-bold ${Je.codigo===0?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Je.codigo]}),a.jsx("span",{className:"text-sm text-text-primary flex-1 truncate",children:Je.nome})]},mr))})()]})})]})]}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[a.jsxs(ea,{value:Rt,onValueChange:Rr,children:[a.jsx(Jn,{className:"w-full md:w-[170px] h-9 bg-black border-warning/40 text-white",children:a.jsx(ra,{placeholder:"Todos os Status"})}),a.jsxs(Qn,{className:"bg-black text-white border-warning/40",children:[a.jsx(Qe,{value:"all",children:"Todos os Status"}),a.jsx(Qe,{value:"Pago",children:"Pago"}),a.jsx(Qe,{value:"Pendente",children:"Pendente"}),a.jsx(Qe,{value:"Cancelado",children:"Cancelado"})]})]}),a.jsxs(ea,{value:Me,onValueChange:tt,children:[a.jsx(Jn,{className:"w-full md:w-[220px] h-9 bg-black border-warning/40 text-white",children:a.jsx(ra,{placeholder:"Todas as Finalizadoras"})}),a.jsxs(Qn,{className:"bg-black text-white border-warning/40",children:[a.jsx(Qe,{value:"all",children:"Todas as Finalizadoras"}),[...new Set((qt||[]).map(J=>J.finalizadora_nome).filter(Boolean))].map(J=>a.jsx(Qe,{value:J,children:J},J))]})]})]}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>{try{const J=";",Je=[["Data","Horrio","Cdigo","Representante","Quadra","Participantes","Total","Pago","Pendente","Status"].join(J)];Va.forEach(Kr=>{const oe=Kr.inicio?new Date(Kr.inicio).toLocaleDateString("pt-BR"):"",Ke=Kr.inicio&&Kr.fim?`${new Date(Kr.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}-${new Date(Kr.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:"",ct=Kr.participantes.length,xe=Kr.participantes.filter(yt=>yt.status_pagamento==="Pago").length,$e=Kr.participantes.filter(yt=>yt.status_pagamento==="Pendente").length,Pe=String(Qt(Kr.total)).replace(".",","),Vt=[oe,Ke,Kr.agendamento_codigo??"",(Kr.representante??"").replace(/"/g,'""'),(Kr.quadra_nome??"").replace(/"/g,'""'),ct,Pe,xe,$e,Kr.statusGeral??""].map(yt=>`"${yt}"`).join(J);Je.push(Vt)});const mr="\uFEFF"+Je.join(`
`),ot=new Blob([mr],{type:"text/csv;charset=utf-8;"}),ar=URL.createObjectURL(ot),ir=document.createElement("a");ir.href=ar;const In=c?new Date(c+"T00:00:00").toLocaleDateString("pt-BR").replace(/\//g,"-"):"",ln=u?new Date(u+"T00:00:00").toLocaleDateString("pt-BR").replace(/\//g,"-"):"";ir.download=`agendamentos_${In}_a_${ln}.csv`,document.body.appendChild(ir),ir.click(),document.body.removeChild(ir),URL.revokeObjectURL(ar),e({title:"CSV exportado com sucesso!"})}catch(J){e({title:"Falha ao exportar CSV",description:J?.message,variant:"destructive"})}},children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Exportar CSV"]})]})]}),i?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):Va.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros no perodo."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{className:"w-12"}),a.jsx(_a,{children:"Data/Hora"}),a.jsx(_a,{children:"Cdigo"}),a.jsx(_a,{children:"Representante"}),a.jsx(_a,{children:"Quadra"}),a.jsx(_a,{className:"text-right",children:"Participantes"}),a.jsx(_a,{className:"text-right",children:"Total"}),a.jsx(_a,{children:"Status"})]})}),a.jsx(mc,{children:Va.map(J=>{const Oe=ut.has(J.agendamento_id||J.agendamento_codigo);return a.jsxs(Ce.Fragment,{children:[a.jsxs(Fs,{className:"cursor-pointer hover:bg-surface-2",onClick:()=>{const Je=J.agendamento_id||J.agendamento_codigo;sr(mr=>{const ot=new Set(mr);return ot.has(Je)?ot.delete(Je):ot.add(Je),ot})},children:[a.jsx(oa,{children:a.jsx("div",{className:`transition-transform ${Oe?"rotate-90":""}`,children:""})}),a.jsx(oa,{children:J.inicio?a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:new Date(J.inicio).toLocaleDateString("pt-BR")}),a.jsxs("span",{className:"font-medium",children:[new Date(J.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),J.fim&&` - ${new Date(J.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`]})]}):""}),a.jsxs(oa,{className:"font-semibold",children:["#",J.agendamento_codigo||""]}),a.jsx(oa,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[J.representanteCodigo!==null&&J.representanteCodigo!==void 0&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[32px] h-6 px-1.5 rounded text-xs font-bold ${J.representanteCodigo===0||J.representanteCodigo==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",J.representanteCodigo]}),a.jsx("span",{className:"text-text-primary",children:J.representante||""})]})}),a.jsx(oa,{children:J.quadra_nome||""}),a.jsx(oa,{className:"text-right",children:J.participantes.length}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.total)}),a.jsx(oa,{children:a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${J.statusGeral==="Pago"?"bg-success/20 text-success":J.statusGeral==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:J.statusGeral==="Parcial"?"Pendente":J.statusGeral})})]}),Oe&&J.participantes.map((Je,mr)=>{const ot=Je.is_consumidor_final?0:Je.cliente_codigo??null;return a.jsxs(Fs,{className:"bg-surface-2/30 hover:bg-surface-2/50 transition-colors",children:[a.jsx(oa,{}),a.jsx(oa,{colSpan:2}),a.jsx(oa,{className:"pl-8 text-sm text-text-secondary",children:a.jsxs("div",{className:"flex items-center gap-2",children:[ot!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[28px] h-5 px-1 rounded text-[10px] font-bold ${ot===0||ot==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",ot]}),a.jsx("span",{children:Je.participante_nome||""})]})}),a.jsx(oa,{className:"text-sm text-text-secondary",children:Je.finalizadora_nome||""}),a.jsx(oa,{}),a.jsx(oa,{className:"text-right text-sm font-medium",children:mt(Je.valor_cota)}),a.jsx(oa,{className:"text-sm",children:a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs ${Je.status_pagamento==="Pago"?"bg-success/20 text-success":Je.status_pagamento==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:Je.status_pagamento||"Pendente"})})]},`${J.agendamento_codigo}-${mr}`)})]},J.agendamento_id||J.agendamento_codigo)})})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:Va.map(J=>{const Oe=ut.has(J.agendamento_id||J.agendamento_codigo);return a.jsxs("div",{className:"bg-surface-2 rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>{const Je=J.agendamento_id||J.agendamento_codigo;sr(mr=>{const ot=new Set(mr);return ot.has(Je)?ot.delete(Je):ot.add(Je),ot})},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`transition-transform text-text-secondary ${Oe?"rotate-90":""}`,children:""}),a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["#",J.agendamento_codigo||""]})]}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${J.statusGeral==="Pago"?"bg-success/20 text-success":J.statusGeral==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:J.statusGeral==="Parcial"?"Pendente":J.statusGeral})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Data:"}),a.jsx("span",{className:"text-text-primary",children:J.inicio?new Date(J.inicio).toLocaleDateString("pt-BR"):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Horrio:"}),a.jsx("span",{className:"text-text-primary font-medium",children:J.inicio&&J.fim?`${new Date(J.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})} - ${new Date(J.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:""})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Representante:"}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[J.representanteCodigo!==null&&J.representanteCodigo!==void 0&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[28px] h-5 px-1 rounded text-[10px] font-bold ${J.representanteCodigo===0||J.representanteCodigo==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",J.representanteCodigo]}),a.jsx("span",{className:"text-text-primary font-medium",children:J.representante||""})]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Quadra:"}),a.jsx("span",{className:"text-text-primary font-medium",children:J.quadra_nome||""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"}),a.jsx("span",{className:"text-text-primary",children:J.participantes.length})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border/50",children:[a.jsx("span",{className:"text-text-secondary",children:"Total:"}),a.jsx("span",{className:"font-bold text-lg text-success",children:mt(J.total)})]})]})]}),Oe&&a.jsx("div",{className:"border-t border-border/50 bg-surface-2/20",children:J.participantes.map((Je,mr)=>{const ot=Je.is_consumidor_final?0:Je.cliente_codigo??null;return a.jsxs("div",{className:"px-4 py-3 border-b border-border/30 last:border-b-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[ot!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[24px] h-4 px-1 rounded text-[9px] font-bold ${ot===0||ot==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",ot]}),a.jsx("div",{className:"font-medium text-sm",children:Je.participante_nome||""})]}),a.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full ${Je.status_pagamento==="Pago"?"bg-success/20 text-success":Je.status_pagamento==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:Je.status_pagamento||"Pendente"})]}),a.jsxs("div",{className:"flex justify-between text-xs",children:[a.jsx("span",{className:"text-text-secondary",children:Je.finalizadora_nome||""}),a.jsx("span",{className:"font-semibold text-success",children:mt(Je.valor_cota)})]})]},mr)})})]},J.agendamento_id||J.agendamento_codigo)})})]})]})}),a.jsx(vo,{value:"caixa",className:"space-y-6 mt-6",children:a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[a.jsx("h3",{className:"text-base font-bold",children:"Fechamentos Anteriores"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",onClick:ne,children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:zt,children:[a.jsx(Ox,{className:"h-4 w-4 mr-2"})," PDF"]})]})]}),te.length===0?a.jsx("div",{className:"text-sm text-text-secondary",children:"Nenhum fechamento encontrado."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Aberto em"}),a.jsx(_a,{children:"Fechado em"}),a.jsx(_a,{className:"text-right",children:"Saldo Inicial"}),a.jsx(_a,{className:"text-right",children:"Saldo Final (contado)"}),a.jsx(_a,{children:"Status"})]})}),a.jsxs(mc,{children:[(()=>{console.log("[FinanceiroPage][Render] Renderizando histrico, total de sesses:",te.length);const J=te.filter(Oe=>Oe.valor_final_dinheiro!=null);return console.log("[FinanceiroPage][Render] Sesses com valor_final_dinheiro no render:",J.length),te.length>0&&console.log("[FinanceiroPage][Render] Primeira sesso no array history:",te[0]),null})(),te.map(J=>a.jsxs(Fs,{className:"cursor-pointer hover:bg-surface-2",onClick:async()=>{vt(!0),St(!0),_t(null);try{const Oe=t?.codigo_empresa,Je=typeof performance<"u"&&performance.now?performance.now():Date.now();console.log("[Caixa][Fechamento][Open]",{sessaoId:J.id,from:J.aberto_em,to:J.fechado_em,codigo:Oe});let mr=await QS({caixaSessaoId:J.id,codigoEmpresa:Oe}),ar=(tr=>{if(!tr)return null;if(tr.total_bruto!=null||tr.por_finalizadora!=null){let dr=tr.por_finalizadora;if(dr&&typeof dr=="string")try{dr=JSON.parse(dr)}catch{dr={}}return{from:tr.periodo_de||null,to:tr.periodo_ate||null,totalPorFinalizadora:dr||{},totalEntradas:Number(tr.total_entradas||0),totalVendasBrutas:Number(tr.total_bruto||0),totalDescontos:Number(tr.total_descontos||0),totalVendasLiquidas:Number(tr.total_liquido||0)}}return tr})(mr);ar||(console.log("[Caixa][Fechamento] Snapshot ausente, calculando resumo por perodo..."),ar=await hu({from:J.aberto_em,to:J.fechado_em||new Date().toISOString(),codigoEmpresa:Oe}));const ir={...J,saldo_inicial:mr&&typeof mr.saldo_inicial<"u"?Number(mr.saldo_inicial):J.saldo_inicial,saldo_final:mr&&typeof mr.saldo_final<"u"?Number(mr.saldo_final):J.saldo_final};if(!ar||!ar.totalPorFinalizadora||Object.keys(ar.totalPorFinalizadora).length===0)try{const tr=J.aberto_em,dr=J.fechado_em||new Date().toISOString();let tn=Q.from("pagamentos").select("metodo, valor, status, recebido_em, finalizadoras:finalizadoras!pagamentos_finalizadora_id_fkey(nome)").gte("recebido_em",tr).lte("recebido_em",dr);Oe&&(tn=tn.eq("codigo_empresa",Oe));const{data:Lr}=await tn,da={};let rn=0;for(const un of Lr||[]){if(!((un.status||"Pago")!=="Cancelado"&&(un.status||"Pago")!=="Estornado"))continue;const fa=un.finalizadoras?.nome||un.metodo||"Outros",Oa=Number(un.valor||0);da[fa]=(da[fa]||0)+Oa,rn+=Oa}ar={...ar||{},totalPorFinalizadora:da,totalEntradas:Number(ar?.totalEntradas||0)||rn},console.log("[Caixa][Fechamento][FallbackPF]",{methods:Object.keys(da).length})}catch{}const ln=await $g({caixaSessaoId:J.id,codigoEmpresa:Oe}),Kr=mr&&mr.movimentos?mr.movimentos:null,oe=J.aberto_em,Ke=J.fechado_em||new Date().toISOString();let ct=Q.from("pagamentos").select("id, valor, status, metodo, recebido_em, finalizadoras:finalizadoras!pagamentos_finalizadora_id_fkey(nome)").gte("recebido_em",oe).lte("recebido_em",Ke).order("recebido_em",{ascending:!1});Oe&&(ct=ct.eq("codigo_empresa",Oe));const{data:xe}=await ct;console.log("[Caixa][Fechamento][Pays]",{count:(xe||[]).length});const $e=mr&&typeof mr.valor_final_dinheiro<"u"?Number(mr.valor_final_dinheiro):null;_t({resumo:ar,movimentacoes:ln,movimentosAgg:Kr,pagamentos:xe||[],sessao:ir,valorFinalContado:$e});const Pe=typeof performance<"u"&&performance.now?performance.now():Date.now(),Vt=Array.isArray(ln)?ln.length:0,yt=ar&&ar.totalPorFinalizadora?Object.keys(ar.totalPorFinalizadora).length:0;console.log("[Caixa][Fechamento][Loaded]",{sessaoId:J.id,finCount:yt,movCount:Vt,ms:Math.round(Pe-Je)})}catch(Oe){console.error("[Caixa][Fechamento][Error]",{sessaoId:J.id,message:Oe?.message,code:Oe?.code}),e({title:"Falha ao carregar fechamento",description:Oe?.message||"Tente novamente",variant:"destructive"})}finally{St(!1)}},children:[a.jsx(oa,{children:J.aberto_em?new Date(J.aberto_em).toLocaleString("pt-BR"):""}),a.jsx(oa,{children:J.fechado_em?new Date(J.fechado_em).toLocaleString("pt-BR"):""}),a.jsx(oa,{className:"text-right",children:mt(J.saldo_inicial)}),a.jsx(oa,{className:"text-right",children:J.valor_final_dinheiro!=null?mt(J.valor_final_dinheiro):""}),a.jsx(oa,{children:String(J.status||"").toLowerCase()==="open"?"Aberto":"Fechado"})]},J.id))]})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:te.map(J=>a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 cursor-pointer hover:bg-surface-2/80 transition-colors",onClick:async()=>{vt(!0),St(!0),_t(null);try{const Oe=t?.codigo_empresa;let Je=await QS({caixaSessaoId:J.id,codigoEmpresa:Oe}),ot=(Kr=>{if(!Kr)return null;if(Kr.total_bruto!=null||Kr.por_finalizadora!=null){let oe=Kr.por_finalizadora;if(oe&&typeof oe=="string")try{oe=JSON.parse(oe)}catch{oe={}}return{from:Kr.periodo_de||null,to:Kr.periodo_ate||null,totalPorFinalizadora:oe||{},totalEntradas:Number(Kr.total_entradas||0),totalVendasBrutas:Number(Kr.total_bruto||0),totalDescontos:Number(Kr.total_descontos||0),totalVendasLiquidas:Number(Kr.total_liquido||0)}}return Kr})(Je);ot||(ot=await hu({from:J.aberto_em,to:J.fechado_em||new Date().toISOString(),codigoEmpresa:Oe}));const ar={...J,saldo_inicial:Je&&typeof Je.saldo_inicial<"u"?Number(Je.saldo_inicial):J.saldo_inicial,saldo_final:Je&&typeof Je.saldo_final<"u"?Number(Je.saldo_final):J.saldo_final},ir=await $g({caixaSessaoId:J.id,codigoEmpresa:Oe}),In=Je&&Je.movimentos?Je.movimentos:null,ln=Je&&typeof Je.valor_final_dinheiro<"u"?Number(Je.valor_final_dinheiro):null;_t({resumo:ot,movimentacoes:ir,movimentosAgg:In,sessao:ar,pagamentos:[],valorFinalContado:ln})}catch(Oe){console.error("[Caixa][Fechamento][Error]",Oe),e({title:"Erro ao carregar detalhes",description:Oe?.message,variant:"destructive"})}finally{St(!1)}},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["Sesso #",J.id]}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${J.status==="fechado"?"bg-success/20 text-success":"bg-warning/20 text-warning"}`,children:String(J.status||"").toLowerCase()==="open"?"Aberto":"Fechado"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Aberto em:"}),a.jsx("span",{className:"text-text-primary",children:J.aberto_em?new Date(J.aberto_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Fechado em:"}),a.jsx("span",{className:"text-text-primary",children:J.fechado_em?new Date(J.fechado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Saldo Inicial:"}),a.jsx("span",{className:"font-semibold text-info",children:mt(J.saldo_inicial)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Saldo Final (contado):"}),a.jsx("span",{className:"font-semibold text-success",children:J.valor_final_dinheiro!=null?mt(J.valor_final_dinheiro):""})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted text-center",children:"Toque para ver detalhes"})]},J.id))})]})]})}),a.jsx(vo,{value:"recebimentos",className:"space-y-6 mt-6",children:a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"Todos os Recebimentos"}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar...",value:Nt,onChange:J=>Wt(J.target.value),className:"pl-10 w-full md:w-[200px]"})]}),a.jsxs(ea,{value:ve,onValueChange:at,children:[a.jsx(Jn,{className:"w-full md:w-[160px] h-9 bg-black border-warning/40 text-white",children:a.jsx(ra,{placeholder:"Todas as Fontes"})}),a.jsxs(Qn,{className:"bg-black text-white border-warning/40",children:[a.jsx(Qe,{value:"all",children:"Todas as Fontes"}),a.jsx(Qe,{value:"manual",children:"Manual"}),a.jsx(Qe,{value:"xml",children:"XML"})]})]}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>{try{const J=sa||[],Je=[["Data/Hora","Origem","Fonte","Descrio","Finalizadora","Valor","Status"].join(";")];for(const Kr of J){const oe=[Kr.recebido_em?new Date(Kr.recebido_em).toLocaleString("pt-BR"):"",Kr.origem??"",Kr.fonte??"",(Kr.descricao??"").replaceAll('"','""'),(Kr.finalizadoras?.nome||Kr.metodo||"").replaceAll('"','""'),String(Qt(Kr.valor)).replace(".",","),Kr.status??""].map(Ke=>`"${String(Ke)}"`).join(";");Je.push(oe)}const mr="\uFEFF"+Je.join(`
`),ot=new Blob([mr],{type:"text/csv;charset=utf-8;"}),ar=URL.createObjectURL(ot),ir=c?new Date(c+"T00:00:00").toLocaleDateString("pt-BR"):"",In=u?new Date(u+"T00:00:00").toLocaleDateString("pt-BR"):"",ln=document.createElement("a");ln.href=ar,ln.download=`recebimentos_${ir}_a_${In}.csv`,document.body.appendChild(ln),ln.click(),document.body.removeChild(ln),URL.revokeObjectURL(ar)}catch(J){e({title:"Falha ao exportar CSV",description:J?.message,variant:"destructive"})}},children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Exportar CSV"]})]})]}),i?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):sa.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros no perodo."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Data/Hora"}),a.jsx(_a,{children:"Origem"}),a.jsx(_a,{children:"Fonte"}),a.jsx(_a,{children:"Descrio"}),a.jsx(_a,{children:"Finalizadora"}),a.jsx(_a,{className:"text-right",children:"Valor"}),a.jsx(_a,{children:"Status"})]})}),a.jsx(mc,{children:sa.map(J=>a.jsxs(Fs,{className:"cursor-pointer hover:bg-surface-2",onClick:()=>{sn(J),qr(!0)},children:[a.jsx(oa,{children:J.recebido_em?new Date(J.recebido_em).toLocaleString("pt-BR"):""}),a.jsx(oa,{children:J.origem||""}),a.jsx(oa,{children:J.fonte?J.fonte.toUpperCase():""}),a.jsx(oa,{className:"truncate max-w-[260px]",title:J.descricao||"",children:J.descricao||""}),a.jsx(oa,{children:J.finalizadoras?.nome||J.metodo||""}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.valor)}),a.jsx(oa,{children:J.status||""})]},J.id))})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:sa.map(J=>a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 cursor-pointer hover:bg-surface-2/80 transition-colors",onClick:()=>{sn(J),qr(!0)},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary",children:J.origem||"Recebimento"}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${J.status==="Pago"?"bg-success/20 text-success":J.status==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:J.status||"Pendente"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Data/Hora:"}),a.jsx("span",{className:"text-text-primary",children:J.recebido_em?new Date(J.recebido_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Fonte:"}),a.jsx("span",{className:"text-text-primary font-medium",children:J.fonte?J.fonte.toUpperCase():""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Finalizadora:"}),a.jsx("span",{className:"text-text-primary",children:J.finalizadoras?.nome||J.metodo||""})]}),J.descricao&&a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:"text-text-secondary",children:"Descrio:"}),a.jsx("span",{className:"text-text-primary text-xs bg-surface/50 p-2 rounded",children:J.descricao})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border/50",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor:"}),a.jsx("span",{className:"font-bold text-lg text-success",children:mt(J.valor)})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted text-center",children:"Toque para ver detalhes"})]},J.id))})]})]})}),a.jsxs(vo,{value:"relatorios",className:"space-y-6 mt-6",children:[a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Vi,{className:"w-5 h-5 text-success"}),"Faturamento Consolidado"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Resumo geral das receitas no perodo"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const Oe=[["Mtrica","Valor"],["Receita de Comandas",mt(x)],["Receita de Agendamentos",mt(v)],["Receita Total",mt(Number(x||0)+Number(v||0))],["Perodo",`${c||"N/A"} at ${u||"N/A"}`]].map(ar=>ar.map(ir=>`"${ir}"`).join(";")).join(`
`),Je=new Blob(["\uFEFF"+Oe],{type:"text/csv;charset=utf-8;"}),mr=URL.createObjectURL(Je),ot=document.createElement("a");ot.href=mr,ot.download=`faturamento_consolidado_${or(new Date,"yyyy-MM-dd")}.csv`,ot.click(),URL.revokeObjectURL(mr),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ys,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const J=[["Receita de Comandas",mt(x)],["Receita de Agendamentos",mt(v)],["Receita Total",mt(Number(x||0)+Number(v||0))]];bt("Faturamento Consolidado",["Mtrica","Valor"],J,"faturamento_consolidado")},children:[a.jsx(Ox,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"p-4 bg-success/5 border border-success/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Comandas"}),a.jsx("div",{className:"text-2xl font-bold text-success",children:mt(x)}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Vendas no perodo"})]}),a.jsxs("div",{className:"p-4 bg-purple-500/5 border border-purple-500/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Agendamentos"}),a.jsx("div",{className:"text-2xl font-bold text-purple-400",children:mt(v)}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Reservas pagas"})]}),a.jsxs("div",{className:"p-4 bg-brand/5 border border-brand/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Total"}),a.jsx("div",{className:"text-2xl font-bold text-brand",children:mt(Number(x||0)+Number(v||0))}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Perodo selecionado"})]})]})]}),a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Rh,{className:"w-5 h-5 text-info"}),"Pagamentos por Mtodo"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Distribuio por finalizadora"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-info/10 border-info/40 text-info hover:bg-info/20",onClick:()=>{const J=h?.totalPorFinalizadora||{},Oe=Object.entries(J).map(([ln,Kr])=>[ln,mt(Kr)]).sort((ln,Kr)=>{const oe=Number(String(ln[1]).replace(/[^\d,]/g,"").replace(",","."));return Number(String(Kr[1]).replace(/[^\d,]/g,"").replace(",","."))-oe}),Je=Object.values(J).reduce((ln,Kr)=>ln+Kr,0),ot=[["Mtodo de Pagamento","Valor","% do Total"],...Oe.map(([ln,Kr])=>{const Ke=((Object.entries(J).find(([ct])=>ct===ln)?.[1]||0)/Je*100).toFixed(1)+"%";return[ln,Kr,Ke]}),["TOTAL",mt(Je),"100%"]].map(ln=>ln.map(Kr=>`"${Kr}"`).join(";")).join(`
`),ar=new Blob(["\uFEFF"+ot],{type:"text/csv;charset=utf-8;"}),ir=URL.createObjectURL(ar),In=document.createElement("a");In.href=ir,In.download=`pagamentos_por_metodo_${or(new Date,"yyyy-MM-dd")}.csv`,In.click(),URL.revokeObjectURL(ir),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ys,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-info/10 border-info/40 text-info hover:bg-info/20",onClick:()=>{const J=h?.totalPorFinalizadora||{},Oe=Object.values(J).reduce((mr,ot)=>mr+ot,0),Je=Object.entries(J).sort(([,mr],[,ot])=>ot-mr).map(([mr,ot])=>[mr,mt(ot),(ot/Oe*100).toFixed(1)+"%"]);Je.push(["TOTAL",mt(Oe),"100%"]),bt("Pagamentos por Mtodo",["Mtodo","Valor","% do Total"],Je,"pagamentos_por_metodo")},children:[a.jsx(Ox,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),Object.keys(h?.totalPorFinalizadora||{}).length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem pagamentos no perodo."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Mtodo de Pagamento"}),a.jsx(_a,{className:"text-right",children:"Valor"}),a.jsx(_a,{className:"text-right",children:"% do Total"})]})}),a.jsxs(mc,{children:[Object.entries(h?.totalPorFinalizadora||{}).sort(([,J],[,Oe])=>Oe-J).map(([J,Oe])=>{const Je=Object.values(h?.totalPorFinalizadora||{}).reduce((ot,ar)=>ot+ar,0),mr=(Oe/Je*100).toFixed(1);return a.jsxs(Fs,{children:[a.jsx(oa,{className:"font-medium",children:J}),a.jsx(oa,{className:"text-right font-semibold",children:mt(Oe)}),a.jsxs(oa,{className:"text-right text-text-secondary",children:[mr,"%"]})]},J)}),a.jsxs(Fs,{className:"bg-surface-2 font-bold",children:[a.jsx(oa,{children:"TOTAL"}),a.jsx(oa,{className:"text-right",children:mt(Object.values(h?.totalPorFinalizadora||{}).reduce((J,Oe)=>J+Oe,0))}),a.jsx(oa,{className:"text-right",children:"100%"})]})]})]})})]}),a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(ju,{className:"w-5 h-5 text-purple-400"}),"Produtos Mais Vendidos"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Top produtos por faturamento"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-purple-500/10 border-purple-500/40 text-purple-400 hover:bg-purple-500/20",onClick:()=>{const Oe=[["Posio","Produto","Faturamento"],...C.slice(0,50).map((ar,ir)=>[ir+1,ar.nome,mt(ar.valor)])].map(ar=>ar.map(ir=>`"${ir}"`).join(";")).join(`
`),Je=new Blob(["\uFEFF"+Oe],{type:"text/csv;charset=utf-8;"}),mr=URL.createObjectURL(Je),ot=document.createElement("a");ot.href=mr,ot.download=`produtos_vendidos_${or(new Date,"yyyy-MM-dd")}.csv`,ot.click(),URL.revokeObjectURL(mr),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ys,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-purple-500/10 border-purple-500/40 text-purple-400 hover:bg-purple-500/20",onClick:()=>{const J=C.slice(0,50).map((Oe,Je)=>[Je+1,Oe.nome,mt(Oe.valor)]);bt("Produtos Mais Vendidos",["#","Produto","Faturamento"],J,"produtos_vendidos")},children:[a.jsx(Ox,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),C.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem produtos vendidos no perodo."}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{className:"w-16",children:"#"}),a.jsx(_a,{children:"Produto"}),a.jsx(_a,{className:"text-right",children:"Faturamento"})]})}),a.jsx(mc,{children:C.slice(0,20).map((J,Oe)=>a.jsxs(Fs,{children:[a.jsx(oa,{className:"text-text-secondary font-mono",children:Oe+1}),a.jsx(oa,{className:"font-medium",children:J.nome}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.valor)})]},`${J.nome}-${Oe}`))})]}),C.length>20&&a.jsx("div",{className:"text-center mt-4",children:a.jsxs(Z,{variant:"ghost",size:"sm",className:"text-brand hover:text-brand/80",onClick:()=>z(!0),children:["Ver todos os ",C.length," produtos"]})})]})]}),a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(vc,{className:"w-5 h-5 text-warning"}),"Clientes que Mais Consomem"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Ranking por faturamento total"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-warning/10 border-warning/40 text-warning hover:bg-warning/20",onClick:()=>{const Oe=[["Posio","Cliente","Faturamento"],...S.slice(0,50).map((ar,ir)=>[ir+1,ar.nome,mt(ar.valor)])].map(ar=>ar.map(ir=>`"${ir}"`).join(";")).join(`
`),Je=new Blob(["\uFEFF"+Oe],{type:"text/csv;charset=utf-8;"}),mr=URL.createObjectURL(Je),ot=document.createElement("a");ot.href=mr,ot.download=`clientes_top_${or(new Date,"yyyy-MM-dd")}.csv`,ot.click(),URL.revokeObjectURL(mr),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ys,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-warning/10 border-warning/40 text-warning hover:bg-warning/20",onClick:()=>{const J=S.slice(0,50).map((Oe,Je)=>[Je+1,Oe.nome,mt(Oe.valor)]);bt("Clientes que Mais Consomem",["#","Cliente","Total Gasto"],J,"clientes_top")},children:[a.jsx(Ox,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),S.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem dados de clientes no perodo."}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{className:"w-16",children:"#"}),a.jsx(_a,{children:"Cliente"}),a.jsx(_a,{className:"text-right",children:"Total Gasto"})]})}),a.jsx(mc,{children:S.slice(0,20).map((J,Oe)=>a.jsxs(Fs,{children:[a.jsx(oa,{className:"text-text-secondary font-mono",children:Oe+1}),a.jsx(oa,{className:"font-medium",children:J.nome}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.valor)})]},`${J.nome}-${Oe}`))})]}),S.length>20&&a.jsx("div",{className:"text-center mt-4",children:a.jsxs(Z,{variant:"ghost",size:"sm",className:"text-brand hover:text-brand/80",onClick:()=>V(!0),children:["Ver todos os ",S.length," clientes"]})})]})]}),a.jsxs(Mr.div,{variants:dc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx($m,{className:"w-5 h-5 text-success"}),"Evoluo Diria de Receitas"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Faturamento dia a dia no perodo"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const Oe=[["Data","Receita"],...M.map(ar=>[ar.data,mt(ar.valor)])].map(ar=>ar.map(ir=>`"${ir}"`).join(";")).join(`
`),Je=new Blob(["\uFEFF"+Oe],{type:"text/csv;charset=utf-8;"}),mr=URL.createObjectURL(Je),ot=document.createElement("a");ot.href=mr,ot.download=`evolucao_diaria_${or(new Date,"yyyy-MM-dd")}.csv`,ot.click(),URL.revokeObjectURL(mr),e({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ys,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const J=M.map(Oe=>[Oe.data,mt(Oe.valor)]);bt("Evoluo Diria de Receitas",["Data","Receita"],J,"evolucao_diaria")},children:[a.jsx(Ox,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),M.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem dados de evoluo no perodo."}):a.jsx("div",{className:"h-80",children:a.jsx(Hb,{width:"100%",height:"100%",children:a.jsxs(Uee,{data:M,margin:{top:5,right:20,bottom:5,left:0},children:[a.jsx(BS,{strokeDasharray:"3 3",stroke:"#2a2a2a"}),a.jsx(jp,{dataKey:"data",stroke:"#888",tick:{fill:"#888",fontSize:11},tickFormatter:J=>{const Oe=J.split("/");return`${Oe[0]}/${Oe[1]}`}}),a.jsx(_p,{stroke:"#888",tick:{fill:"#888",fontSize:11},tickFormatter:J=>`R$ ${(J/1e3).toFixed(0)}k`}),a.jsx(Lc,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px"},labelStyle:{color:"#fff"},itemStyle:{color:"#22C55E"},formatter:J=>[mt(J),"Receita"]}),a.jsx(_y,{type:"monotone",dataKey:"valor",stroke:"#22C55E",strokeWidth:2,dot:{fill:"#22C55E",r:4},activeDot:{r:6}})]})})})]})]})]}),a.jsx(zn,{open:Wr,onOpenChange:qr,children:a.jsxs(qn,{className:"max-w-lg",children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-xl font-bold",children:"Detalhes do Recebimento"}),a.jsx(la,{children:Tr?.origem==="Comanda"?"Operao de comanda":Tr?.origem==="Agendamento"?"Operao de agendamento":"Operao"})]}),Tr&&a.jsxs("div",{className:"space-y-3 text-sm",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Data/Hora"}),a.jsx("div",{className:"font-medium",children:Tr.recebido_em?new Date(Tr.recebido_em).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Valor"}),a.jsx("div",{className:"font-semibold",children:mt(Tr.valor)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Origem"}),a.jsx("div",{children:Tr.origem||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Fonte"}),a.jsx("div",{children:Tr.fonte?Tr.fonte.toUpperCase():""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Finalizadora"}),a.jsx("div",{children:Tr.finalizadoras?.nome||Tr.metodo||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Status"}),a.jsx("div",{children:Tr.status||""})]})]}),Tr.origem==="Comanda"&&a.jsxs("div",{className:"mt-2 p-3 rounded border border-border",children:[a.jsx("div",{className:"font-semibold mb-2",children:"Comanda"}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Cliente"}),a.jsx("div",{children:Tr.descricao||""})]})}),a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"text-text-muted mb-1",children:"Produtos"}),Fe?a.jsx("div",{className:"text-xs text-text-muted",children:"Carregando itens..."}):Cn.length===0?a.jsx("div",{className:"text-xs text-text-muted",children:"Sem itens encontrados."}):a.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:Cn.map((J,Oe)=>a.jsxs("div",{className:"text-xs flex justify-between gap-3",children:[a.jsxs("div",{className:"truncate",children:[a.jsx("span",{className:"font-mono",children:Qt(J.quantidade)}),a.jsx("span",{children:" x "}),a.jsx("span",{className:"font-medium",children:J.descricao})]}),a.jsx("div",{className:"whitespace-nowrap",children:mt(Number(J.preco_unitario||0)*Number(J.quantidade||0))})]},Oe))})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("div",{className:"text-text-muted mb-1",children:"Pagamentos"}),Ze.length===0?a.jsx("div",{className:"text-xs text-text-muted",children:"Sem pagamentos adicionais."}):a.jsxs("div",{className:"space-y-1",children:[Ze.map((J,Oe)=>a.jsxs("div",{className:"text-xs flex justify-between gap-3",children:[a.jsx("div",{className:"truncate",children:a.jsx("span",{className:"font-medium",children:J.finalizadoras?.nome||J.metodo||""})}),a.jsx("div",{className:"whitespace-nowrap",children:mt(J.valor)})]},J.id||Oe)),a.jsxs("div",{className:"text-xs flex justify-between gap-3 pt-2 border-t border-border",children:[a.jsx("div",{className:"font-semibold",children:"Total"}),a.jsx("div",{className:"font-semibold",children:mt(Ze.reduce((J,Oe)=>J+Number(Oe.valor||0),0))})]})]})]})]}),Tr.origem==="Agendamento"&&a.jsxs("div",{className:"mt-2 p-3 rounded border border-border",children:[a.jsx("div",{className:"font-semibold mb-2",children:"Agendamento"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Cdigo"}),a.jsxs("div",{className:"font-mono",children:["#",Tr.agendamento_codigo]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Participante"}),a.jsx("div",{children:Tr.participante_nome})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("div",{className:"text-text-muted",children:"Quadra"}),a.jsx("div",{children:Tr.quadra_nome||""})]})]})]})]})]})}),a.jsx(zn,{open:q,onOpenChange:z,children:a.jsxs(qn,{className:"max-w-2xl bg-surface text-text-primary border-0",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Todos os Produtos"}),a.jsx(la,{children:"Ordenados por valor de vendas"})]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Produto"}),a.jsx(_a,{className:"text-center",children:"Quantidade"}),a.jsx(_a,{className:"text-right",children:"Valor Total"})]})}),a.jsx(mc,{children:C.map((J,Oe)=>a.jsxs(Fs,{children:[a.jsxs(oa,{children:[Oe+1,". ",J.nome]}),a.jsxs(oa,{className:"text-center",children:["x",J.quantidade]}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.valor)})]},`${J.nome}-${Oe}`))})]})})]})}),a.jsx(zn,{open:xt,onOpenChange:vt,children:a.jsxs(qn,{className:"sm:max-w-[900px] w-full max-h-[85vh] overflow-y-auto bg-surface text-text-primary border-0",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Fechamento do Caixa"}),a.jsxs(la,{children:[ft?.sessao?.aberto_em?`${new Date(ft.sessao.aberto_em).toLocaleString("pt-BR")}`:"",ft?.sessao?.fechado_em?`  ${new Date(ft.sessao.fechado_em).toLocaleString("pt-BR")}`:""]})]}),dt?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando..."}):ft?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Inicial"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:mt(ft.sessao?.saldo_inicial)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total do Dia"}),a.jsx("p",{className:"text-2xl font-bold text-success tabular-nums",children:(()=>{const J=Number(ft.resumo?.totalEntradas||0),Oe=Array.isArray(ft.movimentacoes)?ft.movimentacoes:[];let Je=0,mr=0,ot=0,ar=0;for(const In of Oe){const ln=String(In?.tipo||"").toLowerCase(),Kr=Number(In?.valor||0);ln==="suprimento"?Je+=Kr:ln==="sangria"?mr+=Kr:ln==="troco"?ot+=Kr:ln==="ajuste"&&(ar+=Kr)}const ir=J+Je+ar-mr-ot;return mt(ir)})()})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:(()=>{const J=ft&&typeof ft.valorFinalContado=="number"?ft.valorFinalContado:null;return J!=null?mt(J):""})()})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Descontos"}),a.jsx("p",{className:"text-2xl font-bold text-warning tabular-nums",children:mt(ft.resumo?.totalDescontos)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Lquido"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:mt(ft.resumo?.totalVendasLiquidas)})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Entradas por Finalizadora"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:ft.resumo?.totalPorFinalizadora&&Object.keys(ft.resumo.totalPorFinalizadora).length>0?Object.entries(ft.resumo.totalPorFinalizadora).map(([J,Oe])=>a.jsxs("div",{className:"bg-surface-2 rounded-md p-2 border border-border flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate",children:String(J)}),a.jsx("span",{className:"text-sm font-semibold",children:mt(Oe)})]},J)):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos."})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Movimentaes"}),!ft.movimentacoes||ft.movimentacoes.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem movimentaes nesta sesso."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Data"}),a.jsx(_a,{children:"Tipo"}),a.jsx(_a,{children:"Obs"}),a.jsx(_a,{className:"text-right",children:"Valor"})]})}),a.jsx(mc,{children:ft.movimentacoes.map(J=>a.jsxs(Fs,{children:[a.jsx(oa,{children:J.created_at?new Date(J.created_at).toLocaleString("pt-BR"):""}),a.jsx(oa,{className:"capitalize",children:J.tipo||""}),a.jsx(oa,{className:"truncate max-w-[280px]",title:J.observacao||"",children:J.observacao||""}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.valor)})]},J.id))})]})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Recebimentos"}),!ft.pagamentos||ft.pagamentos.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem recebimentos no perodo deste caixa."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Data/Hora"}),a.jsx(_a,{children:"Finalizadora"}),a.jsx(_a,{className:"text-right",children:"Valor"}),a.jsx(_a,{children:"Status"})]})}),a.jsx(mc,{children:ft.pagamentos.map(J=>a.jsxs(Fs,{children:[a.jsx(oa,{children:J.recebido_em?new Date(J.recebido_em).toLocaleString("pt-BR"):""}),a.jsx(oa,{children:J.finalizadoras?.nome||J.metodo||""}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.valor)}),a.jsx(oa,{children:J.status||""})]},J.id))})]})})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados."})]})}),a.jsx(zn,{open:F,onOpenChange:J=>{V(J),J||(_e(null),L([]))},children:a.jsxs(qn,{className:"max-w-2xl bg-surface text-text-primary border-0",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Clientes"}),a.jsx(la,{children:"Ordenados por valor pago no perodo selecionado"})]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto border border-border rounded-md",children:a.jsxs(uc,{children:[a.jsx(fc,{children:a.jsxs(Fs,{children:[a.jsx(_a,{children:"Cliente"}),a.jsx(_a,{className:"text-right",children:"Pago"})]})}),a.jsx(mc,{children:S.map((J,Oe)=>a.jsxs(Fs,{className:"cursor-pointer hover:bg-brand/10",onClick:async()=>{W(!0),_e(J),de(!0);try{const Je=Tn(c),mr=Gn(u),ot=(J.nome||"").trim(),ar=t?.codigo_empresa;let ir=Q.from("clientes").select("id, nome").eq("codigo_empresa",ar).ilike("nome",`%${ot}%`);const{data:In}=await ir,ln=new Set((In||[]).map(dr=>dr.id));let Kr=Q.from("comanda_clientes").select("comanda_id").eq("codigo_empresa",ar).ilike("nome_livre",`%${ot}%`);const{data:oe}=await Kr;let Ke=new Set((oe||[]).map(dr=>dr.comanda_id));if(ln.size>0){let dr=Q.from("comanda_clientes").select("comanda_id, cliente_id").eq("codigo_empresa",ar).in("cliente_id",Array.from(ln));const{data:tn}=await dr;(tn||[]).forEach(Lr=>Ke.add(Lr.comanda_id))}const ct=Array.from(Ke);let xe=Q.from("pagamentos").select("id, valor, recebido_em, metodo, finalizadoras!pagamentos_finalizadora_id_fkey(nome), comanda_id, status").in("comanda_id",ct).neq("status","Cancelado").neq("status","Estornado").order("recebido_em",{ascending:!1}).limit(50);Je&&(xe=xe.gte("recebido_em",Je)),mr&&(xe=xe.lte("recebido_em",mr));const{data:$e}=await xe,Pe=$e||[],Vt=Array.from(new Set(Pe.map(dr=>dr.comanda_id).filter(Boolean))),yt={};if(Vt.length>0){let dr=Q.from("comandas").select("id, tipo, mesa_id").in("id",Vt);const{data:tn}=await dr,Lr=Array.from(new Set((tn||[]).map(rn=>rn.mesa_id).filter(Boolean))),da={};if(Lr.length>0){let rn=Q.from("mesas").select("id, numero, nome").in("id",Lr);const{data:un}=await rn;(un||[]).forEach(Dn=>{da[Dn.id]=(Dn.nome||`Mesa ${Dn.numero||""}`).trim()})}(tn||[]).forEach(rn=>{let un="";const Dn=String(rn?.tipo||"").toLowerCase();Dn==="balcao"||Dn==="balco"?un="Balco":Dn==="mesa"||rn.mesa_id?un=da[rn.mesa_id]||"Mesa":Dn==="agendamento"&&(un="Agendamento"),yt[rn.id]=un})}let tr=Pe.map(dr=>({...dr,origem:dr.comanda_id&&yt[dr.comanda_id]||""}));try{const dr=t?.codigo_empresa;let tn=[];if(ln&&ln.size>0){let fa=Q.from("v_agendamento_participantes").select("id, agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text").in("cliente_id",Array.from(ln));dr&&(fa=fa.eq("codigo_empresa",dr));const{data:Oa}=await fa;if(tn=Oa||[],tn.length===0&&dr){let us=Q.from("v_agendamento_participantes").select("id, agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text").in("cliente_id",Array.from(ln));const{data:Un}=await us;tn=Un||[]}}let Lr=[...tn];const da=Array.from(new Set(Lr.map(fa=>fa.agendamento_id).filter(Boolean)));let rn=new Set;const un={};if(da.length>0){let fa=Q.from("agendamentos").select("id, inicio").in("id",da);dr&&(fa=fa.eq("codigo_empresa",dr));const{data:Oa}=await fa,us=Je?new Date(Je).getTime():null,Un=mr?new Date(mr).getTime():null;(Oa||[]).forEach(Ya=>{const $s=Ya?.inicio?new Date(Ya.inicio).getTime():null;$s!=null&&(us==null||$s>=us)&&(Un==null||$s<=Un)&&rn.add(Ya.id),Ya?.id&&(un[Ya.id]=Ya.inicio||null)})}Lr=Lr.filter(fa=>rn.has(fa.agendamento_id));const Dn=new Set;console.debug("[Financeiro][Agendamentos][Detalhe] encontrados:",Lr.length),Lr.forEach(fa=>{const Oa=`${fa.id}`;if(Dn.has(Oa))return;Dn.add(Oa);const us=String(fa.status_pagamento||fa.status_pagamento_text||"pago").toLowerCase();if(["cancelado","estornado"].includes(us))return;const Un=fa.finalizadora_nome||fa.metodo||fa.metodo_pagamento||fa.forma_pagamento||"Agendamento";tr.push({id:`ag-${fa.id}`,recebido_em:un[fa.agendamento_id]||null,finalizadoras:Un?{nome:Un}:null,metodo:Un,origem:"Agendamento",valor:fa.valor_cota})})}catch{}L(tr)}finally{de(!1)}},children:[a.jsx(oa,{children:J.nome}),a.jsx(oa,{className:"text-right font-semibold",children:mt(J.valor)})]},`${J.nome}-${Oe}`))})]})})]})}),a.jsx(zn,{open:X,onOpenChange:W,children:a.jsxs(qn,{className:"max-w-5xl w-[95vw] md:w-[90vw] max-h-[85vh] bg-surface text-text-primary border-0 overflow-hidden flex flex-col",children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsx($n,{className:"text-lg md:text-xl",children:"Detalhes do Cliente"}),a.jsx(la,{className:"text-sm md:text-base",children:ue?.nome})]}),ue?a.jsxs("div",{className:"space-y-4 flex-1 overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 bg-surface-2 rounded-lg flex-shrink-0",children:[a.jsx("span",{className:"text-sm md:text-base text-text-secondary",children:"Total Pago no Perodo"}),a.jsx("span",{className:"text-lg md:text-2xl font-bold text-success",children:mt(ue.valor)})]}),G?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Carregando detalhes..."}):U.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem pagamentos no perodo selecionado."}):a.jsx("div",{className:"flex-1 overflow-auto border border-border rounded-md",children:a.jsxs(uc,{children:[a.jsx(fc,{className:"sticky top-0 bg-surface z-10",children:a.jsxs(Fs,{children:[a.jsx(_a,{className:"text-xs md:text-sm w-[70px] md:w-auto",children:"Data"}),a.jsx(_a,{className:"text-xs md:text-sm w-[80px] md:w-auto",children:"Finaliz."}),a.jsx(_a,{className:"text-xs md:text-sm w-[60px] md:w-auto",children:"Origem"}),a.jsx(_a,{className:"text-right text-xs md:text-sm w-[70px] md:w-auto",children:"Valor"})]})}),a.jsx(mc,{children:U.map(J=>a.jsxs(Fs,{children:[a.jsx(oa,{className:"text-xs md:text-sm w-[70px] md:w-auto",children:a.jsx("div",{className:"text-[10px] md:text-xs leading-tight",children:J.recebido_em?new Date(J.recebido_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""})}),a.jsx(oa,{className:"text-xs md:text-sm w-[80px] md:w-auto",children:a.jsx("div",{className:"truncate max-w-[80px] md:max-w-[200px] text-[10px] md:text-xs",title:J.finalizadoras?.nome||J.metodo||"",children:J.finalizadoras?.nome||J.metodo||""})}),a.jsx(oa,{className:"text-xs md:text-sm w-[60px] md:w-auto",children:a.jsx("div",{className:"truncate max-w-[60px] md:max-w-[150px] text-[10px] md:text-xs",title:J.origem||"",children:J.origem||""})}),a.jsx(oa,{className:"text-right font-semibold text-xs md:text-sm w-[70px] md:w-auto",children:a.jsx("div",{className:"text-[10px] md:text-xs whitespace-nowrap",children:mt(J.valor)})})]},J.id))})]})})]}):a.jsx("div",{className:"text-sm text-text-muted py-8 text-center",children:"Nenhum cliente selecionado"})]})})]})})}const qot={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.06,delayChildren:.05}}},SF={hidden:{opacity:0,y:12},visible:{opacity:1,y:0,transition:{duration:.35}}};function zot({children:e,className:t=""}){return a.jsx(Mr.div,{variants:SF,className:`fx-card ${t}`,children:e})}const $k=({icon:e,title:t,value:r,subtitle:n,color:s})=>{const o=e;return a.jsxs(Mr.div,{variants:SF,className:"bg-surface rounded-lg border-2 border-border hover:border-border-hover p-4 flex flex-col justify-between gap-2 transition-all duration-300",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("p",{className:"text-text-secondary text-sm font-semibold",children:t}),a.jsx(o,{className:`w-5 h-5 ${s}`})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r}),a.jsx("p",{className:"text-xs text-text-muted",children:n})]})]})};function _V({label:e,...t}){return a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:e}),a.jsx("input",{...t,className:`bg-surface-2 border border-border rounded-md px-3 py-2 text-sm ${t.className||""}`})]})}function Uot(){const{toast:e}=Xs(),{userProfile:t,authReady:r}=fo(),n=p.useRef(!1),[s,o]=p.useState(()=>{try{const be=JSON.parse(localStorage.getItem("quadras:list")||"[]");return Array.isArray(be)?be:[]}catch{return[]}}),[i,l]=p.useState(()=>{try{const be=JSON.parse(localStorage.getItem("quadras:list")||"[]");return!(Array.isArray(be)&&be.length>0)}catch{return!0}}),[c,d]=p.useState(!1),[u,f]=p.useState(!1),[h,m]=p.useState({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),[x,g]=p.useState(""),[v,y]=p.useState(!1),[b,w]=p.useState(null),[j,_]=p.useState({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),[C,A]=p.useState(""),[S,P]=p.useState(!0),[M,O]=p.useState({mostUsed:"-",topClient:"-",totalBookings:"-"}),[I,T]=p.useState(!1),[k,$]=p.useState(null),[q,z]=p.useState({0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0}),[F,V]=p.useState([]),[ue,_e]=p.useState(""),[U,L]=p.useState(""),[G,de]=p.useState(!1),X=be=>{if(!be)return null;const[Nt,Wt]=String(be).split(":");return`${Nt.padStart(2,"0")}:${Wt.padStart(2,"0")}:00`},W=be=>{const Nt=String(be??"").replace(/\D/g,"");if(!Nt)return"";const Wt=(Number(Nt)/100).toFixed(2),[_r,yr]=Wt.split(".");return`${_r.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${yr}`},Y=be=>{if(be==null||be==="")return NaN;const Nt=String(be).replace(/\./g,"").replace(",","."),Wt=parseFloat(Nt);return Number.isFinite(Wt)?Wt:NaN},me=(be,Nt=!1)=>{if(be==null||!Number.isFinite(Number(be)))return"-";const _r=Number(be).toFixed(2).split("."),yr=_r[0],ve=_r[1],qt=`${yr.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${ve}`;return Nt?`R$ ${qt}`:qt},ee=be=>{if(!be)return"";const[Nt,Wt]=String(be).split(":");return`${String(Nt).padStart(2,"0")}:${String(Wt).padStart(2,"0")}`},ae=be=>{if(!be)return 0;const[Nt,Wt]=String(be).split(":").map(Number);return(Nt===0&&Wt===0?24:Nt||0)*60+(Wt||0)},le=be=>{if(!be)return!1;const Nt=String(be).split(":");if(Nt.length<2)return!1;const Wt=Number(Nt[1]);return Wt===0||Wt===30},Te=be=>{if(!be)return"";const[Nt,Wt]=String(be).split(":");let _r=Math.max(0,Math.min(23,parseInt(Nt||"0",10))),yr=Math.max(0,Math.min(59,parseInt(Wt||"0",10)));const ve=Math.round(yr/30);if(ve>=2?(_r+=1,yr=0):yr=ve*30,_r>=24)return"23:59";const at=String(_r).padStart(2,"0"),qt=String(yr).padStart(2,"0");return`${at}:${qt}`};p.useEffect(()=>{if(!c)return;const be=setTimeout(()=>{console.error("[Quadras] add/update stuck >15s",{route:"/quadras",codigo_empresa:t?.codigo_empresa,editingId:b,formQuadra:h,editForm:j})},15e3);return()=>clearTimeout(be)},[c,t?.codigo_empresa,b,h,j]);const te=async()=>{if(!t?.codigo_empresa)return;const be=s&&s.length>0;be||l(!0);const{data:Nt,error:Wt}=await Q.from("quadras").select("*").eq("codigo_empresa",t.codigo_empresa).order("nome",{ascending:!0});if(Wt){if(!n.current){n.current=!0,setTimeout(te,800),be||l(!1);return}e({title:"Erro ao carregar quadras",description:Wt.message}),be||l(!1);return}const _r=Nt||[];if(_r.length===0&&be&&!n.current){n.current=!0,setTimeout(te,600),be||l(!1);return}n.current=!1,o(_r);try{localStorage.setItem("quadras:list",JSON.stringify(_r))}catch{}be||l(!1)},ie=be=>{w(be.id),_({nome:be.nome||"",descricao:be.descricao||"",modalidades:Array.isArray(be.modalidades)?be.modalidades:be.modalidades?[be.modalidades]:[],tipo:be.tipo||"Descoberta",status:be.status||"Ativa",hora_inicio:ee(be.hora_inicio||"06:00:00"),hora_fim:ee(be.hora_fim||"24:00:00")||"23:59",valor_hora:be.valor!=null&&be.valor!==""?W(String((Number(be.valor)*2).toFixed(2))):""}),A(""),y(!0)},xt=async()=>{if(!j.nome?.trim()){e({title:"Nome obrigatrio",description:"Informe um nome para a quadra."});return}if(!j.hora_inicio||!j.hora_fim){e({title:"Horrio obrigatrio",description:"Informe horrio de abertura e fechamento."});return}if(!le(j.hora_inicio)||!le(j.hora_fim)){e({title:"Intervalo invlido",description:"Use apenas horrios em horas cheias ou :30."});return}if(ae(j.hora_fim)<=ae(j.hora_inicio)){e({title:"Horrio invlido",description:"Fechamento deve ser depois da abertura."});return}if(!j.modalidades?.length){e({title:"Adicione ao menos uma modalidade",description:"Informe e adicione uma modalidade usando o boto +."});return}if(!t?.codigo_empresa||!b){e({title:"Atualizao indisponvel",description:"Dados insuficientes para atualizar."});return}d(!0);const be={nome:j.nome.trim(),descricao:j.descricao?.trim()||null,modalidades:j.modalidades,tipo:j.tipo,status:j.status,hora_inicio:X(j.hora_inicio),hora_fim:X(j.hora_fim==="24:00"?"23:59":j.hora_fim)};if(j.valor_hora!=null&&String(j.valor_hora).trim()!==""){const yr=Y(j.valor_hora);!Number.isNaN(yr)&&Number.isFinite(yr)&&(be.valor=Math.round(yr/2*100)/100)}else be.valor=null;const Nt=(yr,ve)=>Promise.race([yr,new Promise((at,qt)=>setTimeout(()=>qt(new Error("Timeout ao atualizar quadra (>12s)")),ve))]);let Wt,_r;try{({data:Wt,error:_r}=await Nt(Q.from("quadras").update(be).eq("codigo_empresa",t.codigo_empresa).eq("id",b).select("id,nome,descricao,modalidades,tipo,status,hora_inicio,hora_fim,valor").single(),12e3))}catch(yr){console.error("update timeout/error",yr),e({title:"Tempo excedido",description:"Sem resposta do servidor ao atualizar. Verifique conexo e tente novamente."}),d(!1);return}if(d(!1),_r){e({title:"Erro ao atualizar quadra",description:_r.message});return}if(!Wt){await te(),e({title:"Quadra atualizada",description:`${be.nome} foi atualizada.`}),y(!1),w(null),A("");return}e({title:"Quadra atualizada",description:`${Wt.nome} foi atualizada.`}),y(!1),w(null),A(""),o(yr=>yr.map(ve=>ve.id===Wt.id?Wt:ve).sort((ve,at)=>ve.nome.localeCompare(at.nome)))};p.useEffect(()=>{try{const be=JSON.parse(localStorage.getItem("quadras:list")||"[]");Array.isArray(be)&&be.length&&s.length===0&&(o(be),l(!1))}catch{}},[]),p.useEffect(()=>{r&&t?.codigo_empresa&&(te(),vt())},[r,t?.codigo_empresa]);const vt=async()=>{if(t?.codigo_empresa)try{const be=new Date;be.setDate(be.getDate()-30);const{data:Nt}=await Q.from("agendamentos").select("quadra_id, cliente_id, quadras!inner(nome), clientes(nome, codigo)").eq("codigo_empresa",t.codigo_empresa).gte("inicio",be.toISOString()).neq("status","canceled");if(!Nt||Nt.length===0){O({mostUsed:"Sem dados",topClient:"Sem dados",totalBookings:"0"});return}const Wt={};Nt.forEach(at=>{const qt=at.quadras?.nome||"Sem nome";Wt[qt]=(Wt[qt]||0)+1});const _r=Object.entries(Wt).sort((at,qt)=>qt[1]-at[1])[0],yr={};Nt.forEach(at=>{if(at.cliente_id&&at.clientes?.nome){const qt=at.clientes?.codigo;if(qt===0||qt==="0")return;const $t=at.clientes.nome;yr[$t]=(yr[$t]||0)+1}});const ve=Object.entries(yr).sort((at,qt)=>qt[1]-at[1])[0];O({mostUsed:_r?`${_r[0]} (${_r[1]})`:"Sem dados",topClient:ve?`${ve[0]} (${ve[1]})`:"Sem dados",totalBookings:Nt.length.toString()})}catch(be){console.error("Erro ao carregar stats:",be),O({mostUsed:"Erro",topClient:"Erro",totalBookings:"0"})}},dt=async()=>{if(console.groupCollapsed("[Quadras] addQuadra: CLICK"),console.time("[Quadras] addQuadra duration"),console.log("pre-validate",{codigo_empresa:t?.codigo_empresa,formQuadra:h}),!h.nome?.trim()){e({title:"Nome obrigatrio",description:"Informe um nome para a quadra."}),console.warn("validation: missing nome"),console.groupEnd();return}if(!h.modalidades?.length){e({title:"Adicione ao menos uma modalidade",description:"Informe e adicione uma modalidade usando o boto +."});return}if(!h.hora_inicio||!h.hora_fim){e({title:"Horrio obrigatrio",description:"Informe horrio de abertura e fechamento."});return}if(!le(h.hora_inicio)||!le(h.hora_fim)){e({title:"Intervalo invlido",description:"Use apenas horrios em horas cheias ou :30."});return}if(ae(h.hora_fim)<=ae(h.hora_inicio)){e({title:"Horrio invlido",description:"Fechamento deve ser depois da abertura."});return}if(!t?.codigo_empresa){e({title:"Empresa no localizada",description:"Associe o usurio a uma empresa para cadastrar quadras."});return}d(!0),console.log("validated, building payload");const be={codigo_empresa:t.codigo_empresa,nome:h.nome.trim(),descricao:h.descricao?.trim()||null,modalidades:h.modalidades,tipo:h.tipo,status:h.status,hora_inicio:X(h.hora_inicio),hora_fim:X(h.hora_fim==="24:00"?"23:59":h.hora_fim)};if(h.valor_hora!=null&&String(h.valor_hora).trim()!==""){const yr=Y(h.valor_hora);!Number.isNaN(yr)&&Number.isFinite(yr)&&(be.valor=Math.round(yr/2*100)/100)}console.log("payload",be);const Nt=(yr,ve)=>Promise.race([yr,new Promise((at,qt)=>setTimeout(()=>qt(new Error("Timeout ao inserir quadra (>12s)")),ve))]);let Wt,_r;try{({data:Wt,error:_r}=await Nt(Q.from("quadras").insert(be).select("id,nome,descricao,modalidades,tipo,status,hora_inicio,hora_fim,valor").single(),12e3))}catch(yr){d(!1),console.error("insert timeout/error",yr),e({title:"Tempo excedido",description:"Sem resposta do servidor ao cadastrar. Verifique conexo e tente novamente."}),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}if(d(!1),_r){e({title:"Erro ao cadastrar quadra",description:_r.message}),console.error("insert error",{code:_r.code,message:_r.message,details:_r.details}),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}if(!Wt){console.warn("insert success sem representao; recarregando lista"),await te(),e({title:"Quadra adicionada",description:`${be.nome} foi cadastrada.`}),m({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),f(!1),g(""),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}console.log("insert success",{id:Wt?.id,nome:Wt?.nome}),e({title:"Quadra adicionada",description:`${Wt.nome} foi cadastrada.`}),m({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),f(!1),g(""),o(yr=>[Wt,...yr].sort((ve,at)=>ve.nome.localeCompare(at.nome))),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd()},St=async be=>{$(be),de(!0);try{const{data:Nt,error:Wt}=await Q.from("quadras_dias_funcionamento").select("*").eq("quadra_id",be.id).eq("codigo_empresa",t.codigo_empresa);if(Wt)throw Wt;const _r={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0},yr=[];Nt?.forEach(ve=>{ve.tipo==="dia_semana"?_r[ve.dia_semana]=ve.funciona:ve.tipo==="data_fechamento"&&yr.push(ve)}),z(_r),V(yr),T(!0)}catch(Nt){console.error("Erro ao carregar dias de funcionamento:",Nt),e({title:"Erro",description:"No foi possvel carregar as configuraes."})}finally{de(!1)}},ft=async()=>{if(k){de(!0);try{await Q.from("quadras_dias_funcionamento").delete().eq("quadra_id",k.id).eq("tipo","dia_semana");const be=Object.entries(q).map(([Wt,_r])=>({quadra_id:k.id,codigo_empresa:t.codigo_empresa,tipo:"dia_semana",dia_semana:parseInt(Wt),funciona:_r,observacao:"Configurao de dias da semana"})),{error:Nt}=await Q.from("quadras_dias_funcionamento").insert(be);if(Nt)throw Nt;e({title:"Sucesso",description:"Dias da semana salvos com sucesso!"})}catch(be){console.error("Erro ao salvar dias da semana:",be),e({title:"Erro",description:"No foi possvel salvar as configuraes."})}finally{de(!1)}}},_t=async()=>{if(!(!k||!ue)){de(!0);try{const{data:be,error:Nt}=await Q.from("quadras_dias_funcionamento").insert({quadra_id:k.id,codigo_empresa:t.codigo_empresa,tipo:"data_fechamento",data_fechamento:ue,funciona:!1,observacao:U||"Fechamento especial"}).select().single();if(Nt)throw Nt;V(Wt=>[...Wt,be]),_e(""),L(""),e({title:"Sucesso",description:"Data de fechamento adicionada!"})}catch(be){console.error("Erro ao adicionar data de fechamento:",be),e({title:"Erro",description:"No foi possvel adicionar a data de fechamento."})}finally{de(!1)}}},gr=async be=>{de(!0);try{const{error:Nt}=await Q.from("quadras_dias_funcionamento").delete().eq("id",be);if(Nt)throw Nt;V(Wt=>Wt.filter(_r=>_r.id!==be)),e({title:"Sucesso",description:"Data de fechamento removida!"})}catch(Nt){console.error("Erro ao remover data de fechamento:",Nt),e({title:"Erro",description:"No foi possvel remover a data de fechamento."})}finally{de(!1)}};return a.jsx(a.Fragment,{children:a.jsxs(Mr.div,{variants:qot,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsxs(Mr.div,{variants:SF,className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-black text-text-primary tracking-tighter",children:"Controle de Quadras"}),a.jsx("p",{className:"text-text-secondary",children:"Gerencie as quadras e horrios disponveis."})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:()=>P(be=>!be),title:S?"Ocultar resumo":"Mostrar resumo","aria-label":S?"Ocultar resumo":"Mostrar resumo",children:S?a.jsx(Og,{className:"h-4 w-4"}):a.jsx(Jg,{className:"h-4 w-4"})}),a.jsx(Z,{onClick:()=>f(!0),className:"shadow-sm",children:"Adicionar Quadra"})]})]}),S&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsx($k,{icon:Nd,title:"Quadra Mais Usada",value:M.mostUsed,subtitle:"ltimos 30 dias",color:"text-brand"}),a.jsx($k,{icon:vc,title:"Cliente Top",value:M.topClient,subtitle:"Mais agendamentos no ms",color:"text-purple"}),a.jsx($k,{icon:$m,title:"Total de Agendamentos",value:M.totalBookings,subtitle:"ltimos 30 dias",color:"text-success"})]}),a.jsxs(zot,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Quadras"}),a.jsx("div",{className:"text-xs text-text-muted",children:i?"Carregando...":`${s.length} registro(s)`})]}),!i&&s.length===0?a.jsxs("div",{className:"text-sm text-text-muted py-8 text-center",children:[a.jsx("div",{className:"font-medium mb-1",children:"Nenhuma quadra cadastrada"}),a.jsx("div",{className:"mb-4",children:'Clique em "Adicionar Quadra" para cadastrar a primeira.'}),a.jsx(Z,{onClick:()=>f(!0),children:"Adicionar Quadra"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden space-y-3",children:s.map(be=>a.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:_h(be.nome),boxShadow:"0 0 0 2px rgba(255,255,255,0.06)"},"aria-hidden":"true"}),a.jsx("span",{className:"font-semibold text-base text-text-primary truncate",children:be.nome})]}),a.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs border flex-shrink-0 ${be.status==="Ativa"?"bg-emerald-50/5 border-emerald-500/30 text-emerald-400":be.status==="Manuteno"?"bg-amber-50/5 border-amber-500/30 text-amber-400":"bg-surface-2 border-border text-text-muted"}`,children:be.status})]}),Array.isArray(be.modalidades)&&be.modalidades.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted mb-1 block",children:"Modalidades"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:be.modalidades.map(Nt=>a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-xs",children:Nt},Nt))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Valor/hora"}),a.jsx("span",{className:"text-sm font-medium",children:be.valor==null||be.valor===""?"-":me(Number(be.valor)*2,!0)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Funcionamento"}),a.jsxs("span",{className:"text-sm font-medium",children:[ee(be.hora_inicio)," - ",ee(be.hora_fim==="24:00:00"?"23:59:00":be.hora_fim)]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>St(be),className:"flex items-center gap-1",children:[a.jsx(ko,{className:"h-3 w-3"}),"Dias"]}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>ie(be),children:"Editar"})]})]},be.id))}),a.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-border bg-surface-0",children:a.jsxs(uc,{children:[a.jsx(fc,{className:"bg-surface-2/60 backdrop-blur supports-[backdrop-filter]:bg-surface-2/70",children:a.jsxs(Fs,{children:[a.jsx(_a,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Nome"}),a.jsx(_a,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Modalidades"}),a.jsx(_a,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Valor por hora"}),a.jsx(_a,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Funcionamento"}),a.jsx(_a,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Status"}),a.jsx(_a,{className:"text-right text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Aes"})]})}),a.jsx(mc,{children:s.map(be=>a.jsxs(Fs,{className:"hover:bg-surface-2/40 transition-colors",children:[a.jsx(oa,{className:"font-medium text-sm md:text-base text-text-primary",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:_h(be.nome),boxShadow:"0 0 0 2px rgba(255,255,255,0.06)"},"aria-hidden":"true"}),a.jsx("span",{children:be.nome})]})}),a.jsx(oa,{className:"text-sm md:text-base",children:Array.isArray(be.modalidades)&&be.modalidades.length>0?a.jsx("div",{className:"flex flex-wrap gap-1",children:be.modalidades.map(Nt=>a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-[11px] md:text-xs",children:Nt},Nt))}):be.modalidades||""}),a.jsx(oa,{className:"text-sm md:text-base",children:be.valor==null||be.valor===""?"-":a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-[11px] md:text-xs",children:me(Number(be.valor)*2,!0)})}),a.jsxs(oa,{className:"text-sm md:text-base",children:[ee(be.hora_inicio)," - ",ee(be.hora_fim==="24:00:00"?"23:59:00":be.hora_fim)]}),a.jsx(oa,{className:"text-sm md:text-base",children:a.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-[11px] md:text-xs border ${be.status==="Ativa"?"bg-emerald-50/5 border-emerald-500/30 text-emerald-400":be.status==="Manuteno"?"bg-amber-50/5 border-amber-500/30 text-amber-400":"bg-surface-2 border-border text-text-muted"}`,children:be.status})}),a.jsx(oa,{className:"text-right",children:a.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>St(be),className:"text-sm",children:[a.jsx(ko,{className:"h-3 w-3 mr-1"}),"Dias"]}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>ie(be),className:"text-sm",children:"Editar"})]})})]},be.id))})]})})]})]}),a.jsx(zn,{open:u,onOpenChange:f,children:a.jsxs(qn,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Adicionar Quadra"}),a.jsx(la,{children:"Cadastre uma nova quadra da sua empresa."})]}),a.jsxs("div",{className:"grid gap-4 py-2",children:[a.jsx(_V,{label:"Nome",value:h.nome,onChange:be=>m({...h,nome:be.target.value}),placeholder:"Ex.: Quadra Society 2"}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Descrio (opcional)"}),a.jsx("textarea",{value:h.descricao,onChange:be=>m({...h,descricao:be.target.value}),placeholder:"Ex.: Quadra oficial com grama sinttica, iluminao LED, vestirios completos",rows:3,className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm resize-none"})]}),a.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Modalidades"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:x,onChange:be=>g(be.target.value),onKeyDown:be=>{if(be.key==="Enter"){be.preventDefault();const Nt=x.trim();if(!Nt)return;m(Wt=>Wt.modalidades.some(yr=>yr.toLowerCase()===Nt.toLowerCase())?Wt:{...Wt,modalidades:[...Wt.modalidades,Nt]}),g("")}},placeholder:"Ex.: Society",className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-60 sm:w-72 focus:outline-none focus:ring-2 focus:ring-primary/30"}),a.jsx(Z,{type:"button",variant:"secondary",className:"bg-amber-500 hover:bg-amber-400 text-black disabled:opacity-50 disabled:cursor-not-allowed",disabled:!x.trim(),onClick:()=>{const be=x.trim();be&&(m(Nt=>Nt.modalidades.some(_r=>_r.toLowerCase()===be.toLowerCase())?Nt:{...Nt,modalidades:[...Nt.modalidades,be]}),g(""))},"aria-label":"Adicionar modalidade",title:"Adicionar modalidade",children:"+"})]}),h.modalidades.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:h.modalidades.map(be=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border bg-surface-2 text-xs",children:[a.jsx("span",{className:"px-0.5",children:be}),a.jsx("button",{type:"button",className:"text-text-muted hover:text-destructive/80",onClick:()=>m(Nt=>({...Nt,modalidades:Nt.modalidades.filter(Wt=>Wt!==be)})),"aria-label":`Remover ${be}`,title:`Remover ${be}`,children:""})]},be))})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Tipo"}),a.jsxs("select",{value:h.tipo,onChange:be=>m({...h,tipo:be.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Descoberta"}),a.jsx("option",{children:"Coberta"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Valor por hora (R$)"}),a.jsx("input",{type:"text",inputMode:"decimal",step:"0.01",placeholder:"0,00",value:h.valor_hora,onChange:be=>m({...h,valor_hora:W(be.target.value)}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-40"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Abertura"}),a.jsx("input",{type:"time",step:"1800",value:h.hora_inicio,onChange:be=>m({...h,hora_inicio:be.target.value}),onBlur:be=>m(Nt=>({...Nt,hora_inicio:Te(be.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Fechamento"}),a.jsx("input",{type:"time",step:"1800",value:h.hora_fim,onChange:be=>m({...h,hora_fim:be.target.value}),onBlur:be=>m(Nt=>({...Nt,hora_fim:Te(be.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Status"}),a.jsxs("select",{value:h.status,onChange:be=>m({...h,status:be.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Ativa"}),a.jsx("option",{children:"Inativa"}),a.jsx("option",{children:"Manuteno"})]})]})]}),a.jsx(Ua,{children:a.jsx(Z,{onClick:dt,disabled:c||h.modalidades.length===0,children:c?"Adicionando...":"Salvar"})})]})}),a.jsx(zn,{open:v,onOpenChange:y,children:a.jsxs(qn,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Editar Quadra"}),a.jsx(la,{children:"Atualize os dados da quadra selecionada."})]}),a.jsxs("div",{className:"grid gap-4 py-2",children:[a.jsx(_V,{label:"Nome",value:j.nome,onChange:be=>_({...j,nome:be.target.value}),placeholder:"Ex.: Quadra Society 2"}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Descrio (opcional)"}),a.jsx("textarea",{value:j.descricao,onChange:be=>_({...j,descricao:be.target.value}),placeholder:"Ex.: Quadra oficial com grama sinttica, iluminao LED, vestirios completos",rows:3,className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm resize-none"})]}),a.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Modalidades"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:C,onChange:be=>A(be.target.value),onKeyDown:be=>{if(be.key==="Enter"){be.preventDefault();const Nt=C.trim();if(!Nt)return;_(Wt=>Wt.modalidades.some(yr=>yr.toLowerCase()===Nt.toLowerCase())?Wt:{...Wt,modalidades:[...Wt.modalidades,Nt]}),A("")}},placeholder:"Ex.: Society",className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-60 sm:w-72 focus:outline-none focus:ring-2 focus:ring-primary/30"}),a.jsx(Z,{type:"button",variant:"secondary",onClick:()=>{const be=C.trim();be&&(_(Nt=>Nt.modalidades.some(_r=>_r.toLowerCase()===be.toLowerCase())?Nt:{...Nt,modalidades:[...Nt.modalidades,be]}),A(""))},children:"+"})]}),j.modalidades.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:j.modalidades.map(be=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border bg-surface-2 text-xs",children:[a.jsx("span",{className:"px-0.5",children:be}),a.jsx("button",{type:"button",className:"text-text-muted hover:text-destructive/80",onClick:()=>_(Nt=>({...Nt,modalidades:Nt.modalidades.filter(Wt=>Wt!==be)})),"aria-label":`Remover ${be}`,title:`Remover ${be}`,children:""})]},be))})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Tipo"}),a.jsxs("select",{value:j.tipo,onChange:be=>_({...j,tipo:be.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Descoberta"}),a.jsx("option",{children:"Coberta"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Valor por hora (R$)"}),a.jsx("input",{type:"text",inputMode:"decimal",step:"0.01",placeholder:"0,00",value:j.valor_hora,onChange:be=>_({...j,valor_hora:W(be.target.value)}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-40"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Abertura"}),a.jsx("input",{type:"time",step:"1800",value:j.hora_inicio,onChange:be=>_({...j,hora_inicio:be.target.value}),onBlur:be=>_(Nt=>({...Nt,hora_inicio:Te(be.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Fechamento"}),a.jsx("input",{type:"time",step:"1800",value:j.hora_fim,onChange:be=>_({...j,hora_fim:be.target.value}),onBlur:be=>_(Nt=>({...Nt,hora_fim:Te(be.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Status"}),a.jsxs("select",{value:j.status,onChange:be=>_({...j,status:be.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Ativa"}),a.jsx("option",{children:"Inativa"}),a.jsx("option",{children:"Manuteno"})]})]})]}),a.jsx(Ua,{children:a.jsx(Z,{onClick:xt,disabled:c||j.modalidades.length===0,children:c?"Salvando...":"Salvar alteraes"})})]})}),a.jsx(zn,{open:I,onOpenChange:T,children:a.jsxs(qn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-hidden pointer-events-none",children:[a.jsx("div",{className:"fixed inset-0 z-50 backdrop-blur-lg bg-black/60 flex items-center justify-center pointer-events-auto",children:a.jsx("div",{className:"rounded-2xl border border-white/30 bg-slate-900 shadow-2xl max-w-sm w-full text-center mx-4",children:a.jsxs("div",{className:"px-8 py-10",children:[a.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[a.jsx("div",{className:"w-14 h-14 bg-brand rounded-xl flex items-center justify-center flex-shrink-0",children:a.jsx(Nd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline select-none",children:[a.jsx("span",{className:"font-extrabold text-3xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-3xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-3xl",style:{color:"#FFFFFF"},children:" Arena"})]})]}),a.jsx("div",{className:"text-2xl font-bold text-white mb-3",children:"Em Desenvolvimento"}),a.jsx("p",{className:"text-base text-gray-200",children:"Esta funcionalidade est sendo desenvolvida e em breve estar disponvel."}),a.jsx("div",{className:"mt-8 flex items-center justify-center",children:a.jsx(Z,{variant:"outline",onClick:()=>T(!1),children:"Fechar"})})]})})}),a.jsxs(Bn,{children:[a.jsxs($n,{className:"flex items-center gap-2",children:[a.jsx(ko,{className:"h-5 w-5"}),"Dias de Funcionamento - ",k?.nome]}),a.jsx(la,{children:"Configure os dias da semana que a quadra funciona e adicione datas especficas de fechamento."})]}),G?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando configuraes..."})}):a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:"Dias da Semana"}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{key:0,label:"Domingo",short:"Dom"},{key:1,label:"Segunda",short:"Seg"},{key:2,label:"Tera",short:"Ter"},{key:3,label:"Quarta",short:"Qua"},{key:4,label:"Quinta",short:"Qui"},{key:5,label:"Sexta",short:"Sex"},{key:6,label:"Sbado",short:"Sb"}].map(be=>a.jsxs("label",{className:"flex items-center gap-2 p-3 rounded-lg border border-border hover:bg-surface-2/50 cursor-pointer transition-colors",children:[a.jsx("input",{type:"checkbox",checked:q[be.key],onChange:Nt=>z(Wt=>({...Wt,[be.key]:Nt.target.checked})),className:"w-4 h-4 text-primary bg-surface-2 border-border rounded focus:ring-primary focus:ring-2"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-medium text-text-primary",children:be.short}),a.jsx("span",{className:"text-xs text-text-muted hidden sm:block",children:be.label})]})]},be.key))}),a.jsx("div",{className:"mt-4",children:a.jsx(Z,{onClick:ft,disabled:G,size:"sm",children:G?"Salvando...":"Salvar Dias da Semana"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:"Datas de Fechamento"}),a.jsx("div",{className:"bg-surface-2/30 rounded-lg p-4 mb-4",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Data"}),a.jsx("input",{type:"date",value:ue,onChange:be=>_e(be.target.value),className:"w-full bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Observao"}),a.jsx("input",{type:"text",placeholder:"Ex: Feriado, Manuteno",value:U,onChange:be=>L(be.target.value),className:"w-full bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx(Z,{onClick:_t,disabled:!ue||G,size:"sm",className:"w-full sm:w-auto",children:"Adicionar"})})]})}),F.length>0?a.jsx("div",{className:"space-y-2",children:F.map(be=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2/50 rounded-lg border border-border",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(xu,{className:"h-4 w-4 text-text-muted"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-text-primary",children:new Date(be.data_fechamento+"T00:00:00").toLocaleDateString("pt-BR")}),be.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:be.observacao})]})]}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>gr(be.id),disabled:G,className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:a.jsx(Yc,{className:"h-3 w-3"})})]},be.id))}):a.jsx("div",{className:"text-center py-6 text-sm text-text-muted",children:"Nenhuma data de fechamento configurada"})]})]}),a.jsx(Ua,{children:a.jsx(Z,{variant:"outline",onClick:()=>T(!1),children:"Fechar"})})]})})]})})}function yf(e){const t=String(e||"").toLowerCase();return t.includes("/producao")||t.includes("/produo")?"producao":"homologacao"}async function bf({acao:e,ambiente:t,cnpj:r,dados:n}){const s={acao:e,ambiente:t||"homologacao",cnpj:(r||"").replace(/\D/g,""),dados:n||{}},{data:o,error:i}=await Q.functions.invoke("emissor",{body:s});if(i){const l=new Error(i.message||"Erro na API fiscal");throw l.response=i,l}if(o&&o.status&&o.status>=400&&!o.ok){const l=new Error(o.message||"Erro na API fiscal");throw l.status=o.status,l.response=o.response,l}return o}async function Vot({baseUrl:e,apiKey:t,cnpj:r}){try{const n=yf(e),s=await bf({acao:"teste_conexao",ambiente:n,cnpj:r,dados:{}}),o=s?.status,i={via:s?.via||"edge",ambiente:s?.ambiente||n};return o===200?{reachable:!0,authorized:!0,status:o,response:s?.response,meta:i}:o===400?{reachable:!0,authorized:!0,status:o,response:s?.response,meta:i}:o===401||o===403?{reachable:!0,authorized:!1,status:o,response:s?.response,meta:i}:o===404?{reachable:!1,authorized:!1,status:o,response:s?.response,meta:i}:{reachable:!0,authorized:null,status:o,response:s?.response,meta:i}}catch(n){return{reachable:!1,authorized:!1,error:n?.message||String(n)}}}async function NV({baseUrl:e,apiKey:t,cnpj:r,dados:n}){if(!r)throw new Error("cnpj obrigatrio");if(!n)throw new Error("dados obrigatrio");const s=yf(e);return bf({acao:"nfce_enviar",ambiente:s,cnpj:r,dados:n})}async function rv({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfce_consultar",ambiente:s,cnpj:r,dados:n})}async function SV({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfce_cancelar",ambiente:s,cnpj:r,dados:n})}async function nv({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfce_pdf",ambiente:s,cnpj:r,dados:n})}async function av({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfce_xml",ambiente:s,cnpj:r,dados:n})}async function Wot({baseUrl:e,apiKey:t,cnpj:r,dados:n}){if(!r)throw new Error("cnpj obrigatrio");if(!n)throw new Error("dados obrigatrio");const s=yf(e),o={...n};try{delete o.Numero}catch{}try{delete o.Serie}catch{}return bf({acao:"nfe_enviar",ambiente:s,cnpj:r,dados:o})}async function i_({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfe_consultar",ambiente:s,cnpj:r,dados:n})}async function Hot({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfe_cancelar",ambiente:s,cnpj:r,dados:n})}async function l_({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfe_pdf",ambiente:s,cnpj:r,dados:n})}async function c_({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=yf(e);return bf({acao:"nfe_xml",ambiente:s,cnpj:r,dados:n})}function tl(e){const t=(e?.ambiente||"homologacao").toLowerCase(),r=t==="producao",n=r?e?.transmitenota_base_url_prod||e?.transmitenota_base_url||"":e?.transmitenota_base_url_hml||e?.transmitenota_base_url||"",s=r?e?.transmitenota_apikey_prod||e?.transmitenota_apikey||"":e?.transmitenota_apikey_hml||e?.transmitenota_apikey||"";return{baseUrl:n||(r?"/api/producao":"/api/homologacao"),apiKey:s,ambiente:t,cnpj:(e?.cnpj||"").replace(/\D/g,"")}}const Got={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.06,delayChildren:.05}}},Kot={hidden:{opacity:0,y:12},visible:{opacity:1,y:0,transition:{duration:.35}}};function CV({children:e,className:t=""}){return a.jsx(Mr.div,{variants:Kot,className:`fx-card ${t}`,children:e})}function Ci({label:e,...t}){return a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:e}),a.jsx("input",{...t,className:`bg-surface-2 border border-border rounded-md px-3 py-2 text-sm ${t.className||""}`})]})}function Xot(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,18)}function Yot(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,15)}function fm(e){return String(e||"").replace(/\D/g,"")}function Jot(){const{toast:e}=Xs(),{company:t,userProfile:r,reloadCompany:n}=fo(),[s,o]=p.useState(!1),[i,l]=p.useState({razao_social:"",nome_fantasia:"",cnpj:"",email:"",telefone:"",endereco:"",logo_url:"",inscricao_estadual:"",regime_tributario:"",ambiente:"homologacao",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",nfce_serie:"1",nfce_numeracao:"1",nfce_itoken:"",nfe_serie:"",nfe_numeracao:"",transmitenota_apikey:"",transmitenota_base_url:"",transmitenota_base_url_hml:"",transmitenota_apikey_hml:"",transmitenota_base_url_prod:"",transmitenota_apikey_prod:""}),c=p.useRef(null),[d,u]=p.useState(""),f=p.useRef(!0);p.useEffect(()=>(f.current=!0,()=>{f.current=!1}),[]),p.useEffect(()=>{(async()=>{try{const y=r?.codigo_empresa||null;if(!y)return;const b=`empresa:form:${y}`;try{const A=localStorage.getItem(b);if(A){const S=JSON.parse(A);S&&typeof S=="object"&&(l(P=>({...P,...S})),S.logo_url&&u(`${S.logo_url.split("?")[0]}?v=${Date.now()}`))}}catch{}const w=setTimeout(()=>{if(f.current)try{const A=localStorage.getItem(b);if(A){const S=JSON.parse(A);S&&typeof S=="object"&&(console.warn("[Empresas] slow fallback: using cached form"),l(P=>({...P,...S})),S.logo_url&&u(`${S.logo_url.split("?")[0]}?v=${Date.now()}`))}}catch{}},5e3),{data:j,error:_}=await Q.from("empresas").select("*").eq("codigo_empresa",y).single();if(clearTimeout(w),_)throw _;if(!f.current)return;const C={razao_social:j?.razao_social||"",nome_fantasia:j?.nome_fantasia||j?.nome||"",cnpj:j?.cnpj||"",email:j?.email||"",telefone:j?.telefone||"",endereco:j?.endereco||"",logo_url:j?.logo_url||"",inscricao_estadual:j?.inscricao_estadual||"",regime_tributario:j?.regime_tributario!=null?String(j.regime_tributario):"",ambiente:j?.ambiente||"homologacao",logradouro:j?.logradouro||"",numero:j?.numero||"",complemento:j?.complemento||"",bairro:j?.bairro||"",cidade:j?.cidade||"",uf:j?.uf||"",cep:j?.cep||"",codigo_municipio_ibge:j?.codigo_municipio_ibge||"",nfce_serie:j?.nfce_serie!=null?String(j.nfce_serie):"1",nfce_numeracao:j?.nfce_numeracao!=null?String(j.nfce_numeracao):"1",nfce_itoken:j?.nfce_itoken||"",nfe_serie:j?.nfe_serie!=null?String(j.nfe_serie):"",nfe_numeracao:j?.nfe_numeracao!=null?String(j.nfe_numeracao):"",transmitenota_apikey:j?.transmitenota_apikey||"",transmitenota_base_url:j?.transmitenota_base_url||"",transmitenota_base_url_hml:j?.transmitenota_base_url_hml||"",transmitenota_apikey_hml:j?.transmitenota_apikey_hml||"",transmitenota_base_url_prod:j?.transmitenota_base_url_prod||"",transmitenota_apikey_prod:j?.transmitenota_apikey_prod||""};l(C),u(C.logo_url?`${C.logo_url.split("?")[0]}?v=${Date.now()}`:"");try{localStorage.setItem(b,JSON.stringify(C))}catch{}}catch(y){console.warn("Falha ao carregar empresa:",y)}})()},[r?.codigo_empresa]),p.useEffect(()=>{if(!i.logo_url){u("");return}const v=i.logo_url.split("?")[0];u(`${v}?v=${Date.now()}`)},[i.logo_url]);const h=async v=>{if(v.preventDefault(),!s){if(!i.razao_social?.trim()||!i.cnpj?.trim()){e({title:"Campos obrigatrios",description:"Preencha Razo Social e CNPJ."});return}if(!r?.codigo_empresa){e({title:"Empresa no vinculada",description:"No foi possvel identificar a empresa do usurio para salvar."});return}try{o(!0);const y={nome:i.nome_fantasia||i.razao_social||"Empresa",razao_social:i.razao_social||null,nome_fantasia:i.nome_fantasia||null,cnpj:i.cnpj?.replace(/\D/g,"")||null,email:i.email||null,telefone:i.telefone||null,endereco:i.endereco||null,logo_url:i.logo_url||null,inscricao_estadual:i.inscricao_estadual?.trim()||null,regime_tributario:i.regime_tributario?Number(i.regime_tributario):null,ambiente:i.ambiente||"homologacao",logradouro:i.logradouro?.trim()||null,numero:i.numero?.trim()||null,complemento:i.complemento?.trim()||null,bairro:i.bairro?.trim()||null,cidade:i.cidade?.trim()||null,uf:(i.uf||"").toUpperCase().slice(0,2)||null,cep:fm(i.cep)||null,codigo_municipio_ibge:i.codigo_municipio_ibge?.trim()||null,nfce_serie:i.nfce_serie?Number(i.nfce_serie):null,nfce_numeracao:i.nfce_numeracao?Number(i.nfce_numeracao):null,nfce_itoken:i.nfce_itoken?.trim()||null,nfe_serie:i.nfe_serie?Number(i.nfe_serie):null,nfe_numeracao:i.nfe_numeracao?Number(i.nfe_numeracao):null,transmitenota_apikey:i.transmitenota_apikey?.trim()||null,transmitenota_base_url:i.transmitenota_base_url?.trim()||null,transmitenota_base_url_hml:i.transmitenota_base_url_hml?.trim()||null,transmitenota_apikey_hml:i.transmitenota_apikey_hml?.trim()||null,transmitenota_base_url_prod:i.transmitenota_base_url_prod?.trim()||null,transmitenota_apikey_prod:i.transmitenota_apikey_prod?.trim()||null},b=async(w,j=1)=>{try{const{error:_}=await Q.from("empresas").upsert({codigo_empresa:r.codigo_empresa,...w},{onConflict:"codigo_empresa"}).select("id").single();if(_)throw _;return!0}catch(_){const A=String(_?.message||"").match(/the '([^']+)' column|column\s+"([^"]+)"\s+of/i),S=A&&(A[1]||A[2])?A[1]||A[2]:null;if(S&&w.hasOwnProperty(S)&&j<=5){console.warn("[Empresas] Removendo coluna inexistente e tentando novamente:",S);const P={...w};return delete P[S],await b(P,j+1)}throw _}};await b(y),await n?.(),e({title:"Dados salvos",description:"As informaes da empresa foram atualizadas."})}catch(y){console.error(y);const b=(y?.message||y?.hint||"").toString()||"No foi possvel salvar os dados. Verifique as permisses e tente novamente.";e({title:"Erro ao salvar",description:b})}finally{o(!1)}}},m=async v=>{try{const y=v.target.files?.[0];if(!y)return;if(!r?.codigo_empresa){e({title:"Empresa no vinculada",description:"Seu usurio no est associado a uma empresa."});return}const b=y.name.split(".").pop()?.toLowerCase()||"png",w=`${r.codigo_empresa}/logo.${b}`,j=(()=>{try{return(localStorage.getItem("custom-auth-token")||"").trim()}catch{return""}})();if(j){const A=`${yO}/storage/v1/object/logos/${w}`,S=await fetch(A,{method:"POST",headers:{Authorization:`Bearer ${j}`,apikey:bO,"x-upsert":"true","Content-Type":y.type||"application/octet-stream"},body:y});if(!S.ok){const P=await S.text();let M;try{M=P?JSON.parse(P):null}catch{}const O=M?.message||M?.error||S.statusText||"Falha no upload",I=new Error(O);throw I.status=S.status,I.response=M||P,I}}else{const{data:{session:A}}=await Q.auth.getSession(),S=A?.access_token||"";if(S){const P=`${yO}/storage/v1/object/logos/${w}`,M=await fetch(P,{method:"POST",headers:{Authorization:`Bearer ${S}`,apikey:bO,"x-upsert":"true","Content-Type":y.type||"application/octet-stream"},body:y});if(!M.ok){const O=await M.text();let I;try{I=O?JSON.parse(O):null}catch{}const T=I?.message||I?.error||M.statusText||"Falha no upload",k=new Error(T);throw k.status=M.status,k.response=I||O,k}}else{const{error:P}=await Q.storage.from("logos").upload(w,y,{upsert:!0,contentType:y.type||void 0});if(P)throw P}}const{data:_}=Q.storage.from("logos").getPublicUrl(w),C=_?.publicUrl||"";l(A=>({...A,logo_url:C})),u(C?`${C}?v=${Date.now()}`:""),e({title:"Logo enviada",description:"A imagem foi carregada com sucesso. Lembre-se de salvar."})}catch(y){console.error("Falha no upload da logo:",y),e({title:"Erro no upload",description:"No foi possvel enviar a logo. Tente outro arquivo."})}finally{c.current&&(c.current.value="")}};function x(v){return String(v||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim()}async function g(){const v=fm(i.cnpj);if(v.length!==14){e({title:"CNPJ invlido",description:"Informe 14 dgitos para buscar.",variant:"destructive"});return}try{o(!0);const y=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${v}`);if(!y.ok){let k="Falha ao consultar CNPJ";try{const $=await y.json();$?.message&&(k=$.message)}catch{}throw new Error(k)}const b=await y.json();try{console.info("[empresas] BuscarCNPJ:payload",b)}catch{}const w=b.razao_social||b.nome||"",j=b.nome_fantasia||"",_=b.logradouro||"",C=(b.numero||"").toString(),A=b.complemento||"",S=b.bairro||"",P=b.municipio||b.localidade||"",M=b.uf||"",O=fm(b.cep);let I="";try{if(P&&M){const k=await fetch(`https://brasilapi.com.br/api/ibge/municipios/v1/${M}`);if(k.ok){const $=await k.json(),q=x(P),z=($||[]).find(F=>x(F.nome)===q);(z?.codigo_ibge||z?.codigo)&&(I=String(z.codigo_ibge||z.codigo))}}}catch{}const T=`${_}${C?", "+C:""}${S?" - "+S:""}${P||M?" - "+P+"/"+M:""}`;l(k=>({...k,razao_social:w,nome_fantasia:j||w,logradouro:_,numero:C,complemento:A,bairro:S,cidade:P,uf:M,cep:O,endereco:T||k.endereco,codigo_municipio_ibge:I||""}));try{console.info("[empresas] BuscarCNPJ:setForm",{razao:w,fantasia:j,logradouro:_,numero:C,complemento:A,bairro:S,cidade:P,uf:M,cep:O,codigoIBGE:I,enderecoFull:T})}catch{}e({title:"CNPJ carregado",description:"Dados preenchidos automaticamente."})}catch(y){e({title:"Falha ao buscar CNPJ",description:y.message||"Tente novamente.",variant:"destructive"})}finally{o(!1)}}return a.jsx(a.Fragment,{children:a.jsxs(Mr.div,{variants:Got,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsx(CV,{children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Cadastros  Empresa"})})}),a.jsxs(CV,{children:[a.jsx("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Dados da Empresa"}),a.jsxs("form",{onSubmit:h,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsx(Ci,{label:"Razo Social",value:i.razao_social,onChange:v=>l({...i,razao_social:v.target.value}),placeholder:"Ex.: Fluxo7 Arena LTDA"}),a.jsx(Ci,{label:"Nome Fantasia",value:i.nome_fantasia,onChange:v=>l({...i,nome_fantasia:v.target.value}),placeholder:"Ex.: Fluxo7 Arena"}),a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Ci,{label:"CNPJ",type:"text",inputMode:"numeric",value:i.cnpj,onChange:v=>l({...i,cnpj:Xot(v.target.value)}),placeholder:"00.000.000/0000-00"})}),a.jsx(Z,{type:"button",variant:"outline",onClick:g,disabled:s,children:"Buscar CNPJ"})]}),a.jsx(Ci,{label:"Email",type:"email",value:i.email,onChange:v=>l({...i,email:v.target.value}),placeholder:"contato@empresa.com"}),a.jsx(Ci,{label:"Telefone",type:"tel",inputMode:"tel",value:i.telefone,onChange:v=>l({...i,telefone:Yot(v.target.value)}),placeholder:"(11) 99999-9999"}),a.jsx(Ci,{label:"Endereo",value:i.endereco,onChange:v=>l({...i,endereco:v.target.value}),placeholder:"Rua, nmero, bairro, cidade",className:"md:col-span-2 lg:col-span-2"}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(Ci,{label:"Inscrio Estadual",value:i.inscricao_estadual,onChange:v=>l({...i,inscricao_estadual:v.target.value})}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Regime Tributrio (CRT)"}),a.jsxs("select",{value:i.regime_tributario,onChange:v=>l({...i,regime_tributario:v.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Selecione"}),a.jsx("option",{value:"1",children:"1 - Simples Nacional"}),a.jsx("option",{value:"2",children:"2 - Simples (excesso sublimite)"}),a.jsx("option",{value:"3",children:"3 - Regime Normal"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Ambiente"}),a.jsxs("select",{value:i.ambiente,onChange:v=>l({...i,ambiente:v.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{value:"homologacao",children:"Homologao"}),a.jsx("option",{value:"producao",children:"Produo"})]})]})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-6 gap-4",children:[a.jsx("div",{className:"md:col-span-3",children:a.jsx(Ci,{label:"Logradouro",value:i.logradouro,onChange:v=>l({...i,logradouro:v.target.value})})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(Ci,{label:"Nmero",value:i.numero,onChange:v=>l({...i,numero:v.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Ci,{label:"Complemento",value:i.complemento,onChange:v=>l({...i,complemento:v.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Ci,{label:"Bairro",value:i.bairro,onChange:v=>l({...i,bairro:v.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Ci,{label:"Cidade",value:i.cidade,onChange:v=>l({...i,cidade:v.target.value})})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(Ci,{label:"UF",value:i.uf,onChange:v=>l({...i,uf:(v.target.value||"").toUpperCase().slice(0,2)}),placeholder:"UF"})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(Ci,{label:"CEP",value:i.cep,onChange:v=>l({...i,cep:fm(v.target.value).slice(0,8)}),placeholder:"00000000"})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Ci,{label:"Cdigo IBGE Municpio (cMun)",value:i.codigo_municipio_ibge,onChange:v=>l({...i,codigo_municipio_ibge:fm(v.target.value).slice(0,7)})})})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(Ci,{label:"NFC-e Srie",value:i.nfce_serie,onChange:v=>l({...i,nfce_serie:fm(v.target.value).slice(0,3)})}),a.jsx(Ci,{label:"NFC-e Numerao Inicial",value:i.nfce_numeracao,onChange:v=>l({...i,nfce_numeracao:fm(v.target.value).slice(0,9)})}),a.jsx(Ci,{label:"NFC-e IToken (CSC)",value:i.nfce_itoken,onChange:v=>l({...i,nfce_itoken:v.target.value})})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(Ci,{label:"NF-e Srie (opcional)",value:i.nfe_serie,onChange:v=>l({...i,nfe_serie:fm(v.target.value).slice(0,3)})}),a.jsx(Ci,{label:"NF-e Numerao (opcional)",value:i.nfe_numeracao,onChange:v=>l({...i,nfe_numeracao:fm(v.target.value).slice(0,9)})})]}),!1,a.jsx("div",{className:"md:col-span-2 lg:col-span-2 grid grid-cols-1 gap-3",children:a.jsxs("div",{className:"flex items-center gap-4",children:[d||i.logo_url?a.jsx("img",{src:d||i.logo_url,alt:"Logo da empresa",className:"w-16 h-16 rounded-md object-cover border border-border"}):a.jsx("div",{className:"w-16 h-16 rounded-md border border-dashed border-border/60 bg-surface-2/40 flex items-center justify-center text-xs text-text-muted",children:"Sem logo"}),a.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Upload da Logo"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>c.current?.click(),className:"px-3",children:"Escolher imagem"}),a.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:m,className:"hidden"}),(d||i.logo_url)&&a.jsx("span",{className:"text-xs text-text-muted truncate max-w-[260px]",title:i.logo_url||d,children:"Logo selecionada"})]}),a.jsx("span",{className:"text-[11px] text-text-muted",children:"Formatos: PNG/JPG. Tamanho recomendado: 256x256."})]})]})}),a.jsx("div",{className:"flex items-end",children:a.jsx(Z,{type:"submit",className:"w-full md:w-auto",disabled:s,children:s?"Salvando...":"Salvar"})})]})]})]})})}const Qot={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},V_={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},PV=[{codigo:"01",nome:"Dinheiro"},{codigo:"02",nome:"Cheque"},{codigo:"03",nome:"Carto de Crdito"},{codigo:"04",nome:"Carto de Dbito"},{codigo:"05",nome:"Carto da Loja (Private Label)"},{codigo:"10",nome:"Vale Alimentao"},{codigo:"11",nome:"Vale Refeio"},{codigo:"12",nome:"Vale Presente"},{codigo:"13",nome:"Vale Combustvel"},{codigo:"14",nome:"Duplicata Mercantil"},{codigo:"15",nome:"Boleto Bancrio"},{codigo:"16",nome:"Depsito Bancrio"},{codigo:"17",nome:"PIX Dinmico (QR-Code)"},{codigo:"18",nome:"Transferncia Bancria / Carteira Digital"},{codigo:"19",nome:"Programa de Fidelidade / Cashback"},{codigo:"20",nome:"PIX Esttico"},{codigo:"21",nome:"Crdito em Loja"},{codigo:"22",nome:"Pagamento Eletrnico no Informado"},{codigo:"90",nome:"Sem Pagamento"},{codigo:"99",nome:"Outros"}],Bk=({icon:e,title:t,value:r,subtitle:n,color:s,onClick:o,isActive:i})=>a.jsx(Mr.div,{variants:V_,onClick:o,className:Er("bg-surface rounded-lg border md:border-2 p-3 md:p-4 transition-all text-center h-[90px] md:h-auto",o?"cursor-pointer hover:shadow-md":"",i?`border-${s} bg-${s}/5`:"border-border",o&&!i?"hover:border-border-hover":""),children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 md:flex-row md:items-center md:gap-3 h-full",children:[a.jsx("div",{className:Er("p-1.5 md:p-2 rounded-lg",`bg-${s}/10`),children:a.jsx(e,{className:Er("w-4 h-4 md:w-5 md:h-5",`text-${s}`)})}),a.jsxs("div",{className:"flex-1 md:text-left",children:[a.jsx("p",{className:"text-base md:text-2xl font-bold text-text-primary leading-none",children:r}),a.jsx("p",{className:"text-[10px] md:text-xs font-semibold text-text-secondary md:mt-0.5",children:t}),a.jsx("p",{className:"hidden md:block text-xs text-text-muted",children:n})]})]})});function Zot(){const{toast:e}=Xs(),{userProfile:t,authReady:r}=fo(),[n,s]=p.useState([]),[o,i]=p.useState(!1),[l,c]=p.useState(!1),[d,u]=p.useState(""),[f,h]=p.useState("all"),[m,x]=p.useState("all"),[g,v]=p.useState(!0),[y,b]=p.useState(null),[w,j]=p.useState(!1),[_,C]=p.useState(null),[A,S]=p.useState({codigo_interno:"",codigo_sefaz:"",nome:"",taxa_percentual:"",ativo:!0}),[P,M]=p.useState(!1),[O,I]=p.useState(""),[T,k]=p.useState(!1),[$,q]=p.useState(null),[z,F]=p.useState(null),[V,ue]=p.useState(!1),[_e,U]=p.useState("mes"),[L,G]=p.useState(!1),[de,X]=p.useState([]),[W,Y]=p.useState("customizado"),[me,ee]=p.useState(""),[ae,le]=p.useState(""),[Te,te]=p.useState(!1),[ie,xt]=p.useState(!1);p.useEffect(()=>{const ve=()=>{try{xt(typeof window<"u"&&window.innerWidth<=640)}catch{}};return ve(),window.addEventListener("resize",ve),()=>window.removeEventListener("resize",ve)},[]);const vt=async()=>{try{i(!0);const ve=t?.codigo_empresa;if(!ve)return;const at=await $h({somenteAtivas:!1,codigoEmpresa:ve});console.log(" Finalizadoras carregadas:",at),console.log(" Primeira finalizadora:",at?.[0]),s(Array.isArray(at)?at:[])}catch(ve){e({title:"Erro ao carregar",description:ve?.message,variant:"destructive"})}finally{i(!1)}},dt=p.useMemo(()=>{const ve=n.length,at=n.filter(wt=>wt.ativo).length,qt=n.length>0?n.reduce((wt,Rt)=>{const Rr=Rt.nome||"Sem nome";return wt[Rr]=(wt[Rr]||0)+1,wt},{}):{},$t=Object.entries(qt).sort((wt,Rt)=>Rt[1]-wt[1])[0],De=$t?$t[0]:"-";return{total:ve,ativas:at,maisUsada:De}},[n]),St=p.useMemo(()=>{let ve=[...n];if(d){const at=d.toLowerCase();ve=ve.filter(qt=>{const $t=String(qt.tipo||"").toLowerCase(),De=String(qt.nome||"").toLowerCase(),wt=String(qt.codigo_interno||"").toLowerCase(),Rt=at.replace(/\D/g,""),Rr=String(qt.codigo_interno||"").replace(/\D/g,"");return $t.includes(at)||De.includes(at)||wt.includes(at)||!!Rt&&Rr===Rt})}return f!=="all"&&(ve=ve.filter(at=>at.tipo===f)),m!=="all"&&(ve=ve.filter(at=>m==="active"?at.ativo:!at.ativo)),y==="ativas"&&(ve=ve.filter(at=>at.ativo)),ve.sort((at,qt)=>{const $t=parseInt(at.codigo_interno)||0,De=parseInt(qt.codigo_interno)||0;return $t-De}),ve},[n,d,f,m,y]),ft=()=>{C(null);const ve=n.reduce((qt,$t)=>{const De=parseInt($t.codigo_interno)||0;return De>qt?De:qt},0),at=String(ve+1).padStart(2,"0");S({codigo_interno:at,codigo_sefaz:"",nome:"",taxa_percentual:"",ativo:!0}),j(!0)},_t=ve=>{C(ve),S({codigo_interno:ve.codigo_interno||"",codigo_sefaz:ve.codigo_sefaz||"",nome:ve.nome||"",taxa_percentual:ve.taxa_percentual!=null?String(ve.taxa_percentual):"",ativo:ve.ativo!==!1}),j(!0)},gr=async(ve,at="mes")=>{try{ue(!0);const qt=t?.codigo_empresa;if(!qt)return;const $t=new Date;let De,wt=$t.toISOString();switch(at){case"hoje":De=new Date($t.setHours(0,0,0,0)).toISOString();break;case"semana":De=new Date($t.setDate($t.getDate()-7)).toISOString();break;case"mes":De=new Date($t.setMonth($t.getMonth()-1)).toISOString();break;default:De=new Date($t.setMonth($t.getMonth()-1)).toISOString()}const{data:Rt,error:Rr}=await Q.from("pagamentos").select("valor, recebido_em, status").eq("finalizadora_id",ve).eq("codigo_empresa",qt).gte("recebido_em",De).lte("recebido_em",wt).neq("status","Cancelado").neq("status","Estornado");if(Rr)throw Rr;const Me=Rt?.length||0,tt=Rt?.reduce((Sr,xr)=>Sr+(Number(xr.valor)||0),0)||0,ut=Me>0?tt/Me:0,sr=Rt?.[Rt.length-1]?.recebido_em||null;F({transacoes:Me,faturamento:tt,ticketMedio:ut,ultimaUtilizacao:sr})}catch(qt){console.error("Erro ao carregar estatsticas:",qt),e({title:"Erro ao carregar estatsticas",description:qt?.message,variant:"destructive"})}finally{ue(!1)}},be=async(ve="customizado",at=null,qt=null)=>{try{te(!0);const $t=t?.codigo_empresa;if(!$t)return;let De,wt;if(ve==="customizado"&&at&&qt)De=new Date(at).toISOString(),wt=new Date(qt+"T23:59:59").toISOString();else{const ut=new Date;switch(wt=ut.toISOString(),ve){case"hoje":De=new Date(ut.setHours(0,0,0,0)).toISOString();break;case"semana":De=new Date(ut.setDate(ut.getDate()-7)).toISOString();break;case"mes":De=new Date(ut.setMonth(ut.getMonth()-1)).toISOString();break;default:De=new Date(ut.setMonth(ut.getMonth()-1)).toISOString()}}const{data:Rt,error:Rr}=await Q.from("pagamentos").select("finalizadora_id, valor, finalizadoras!pagamentos_finalizadora_id_fkey(id, codigo_interno, nome)").eq("codigo_empresa",$t).gte("recebido_em",De).lte("recebido_em",wt).neq("status","Cancelado").neq("status","Estornado");if(Rr)throw Rr;const Me={};Rt?.forEach(ut=>{const sr=ut.finalizadora_id;sr&&(Me[sr]||(Me[sr]={id:sr,codigo:ut.finalizadoras?.codigo_interno||"-",nome:ut.finalizadoras?.nome||"Sem nome",total:0,transacoes:0}),Me[sr].total+=Number(ut.valor)||0,Me[sr].transacoes+=1)});const tt=Object.values(Me).sort((ut,sr)=>sr.total-ut.total);X(tt)}catch($t){console.error("Erro ao carregar ranking:",$t),e({title:"Erro ao carregar ranking",description:$t?.message,variant:"destructive"})}finally{te(!1)}},Nt=()=>{G(!0),Y("customizado");const ve=new Date,at=new Date;at.setMonth(at.getMonth()-1),ee(at.toISOString().split("T")[0]),le(ve.toISOString().split("T")[0]),be("customizado",at.toISOString().split("T")[0],ve.toISOString().split("T")[0])},Wt=ve=>{q(ve),k(!0),U("mes"),gr(ve.id,"mes")},_r=async()=>{try{if(!A.nome?.trim()){e({title:"Nome  obrigatrio",variant:"warning"});return}if(!A.codigo_sefaz){e({title:"Cdigo SEFAZ  obrigatrio",variant:"warning"});return}if(A.codigo_interno?.trim()&&n.some($t=>$t.codigo_interno===A.codigo_interno.trim()&&(!_||$t.id!==_.id))){e({title:"Cdigo j existe",description:"Este cdigo interno j est em uso por outra finalizadora",variant:"warning"});return}c(!0);const ve=t?.codigo_empresa,at={codigo_interno:A.codigo_interno?.trim()||null,codigo_sefaz:A.codigo_sefaz,nome:A.nome.trim(),tipo:"outros",taxa_percentual:A.taxa_percentual===""?null:Number(A.taxa_percentual),ativo:A.ativo};_?(await aKe(_.id,at,ve),e({title:"Finalizadora atualizada!",variant:"success"})):(await nKe(at,ve),e({title:"Finalizadora criada!",variant:"success"})),j(!1),await vt()}catch(ve){e({title:"Erro ao salvar",description:ve?.message,variant:"destructive"})}finally{c(!1)}},yr=async ve=>{try{await sKe(ve.id,!ve.ativo,t?.codigo_empresa),e({title:ve.ativo?"Desativada":"Ativada",variant:"success"}),await vt()}catch(at){e({title:"Erro ao alterar status",description:at?.message,variant:"destructive"})}};return p.useEffect(()=>{r&&t?.codigo_empresa&&vt()},[r,t?.codigo_empresa]),a.jsxs(a.Fragment,{children:[a.jsxs(Mr.div,{variants:Qot,initial:"hidden",animate:"visible",className:"flex-1 space-y-6 p-4 md:p-6",children:[a.jsxs(Mr.div,{variants:V_,className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"min-w-0",children:a.jsx("h1",{className:"text-2xl md:text-3xl font-black text-text-primary tracking-tight leading-tight",children:"Finalizadoras"})}),a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx(Z,{variant:"ghost",size:"icon",onClick:()=>v(!g),className:"h-9 w-9",children:g?a.jsx(Og,{className:"h-5 w-5"}):a.jsx(Jg,{className:"h-5 w-5"})}),a.jsxs(Z,{onClick:ft,className:"gap-2 h-9 px-3 whitespace-nowrap",children:[a.jsx(to,{className:"h-4 w-4"}),a.jsx("span",{className:"md:hidden",children:"Nova"}),a.jsx("span",{className:"hidden md:inline",children:"Nova Finalizadora"})]})]})]}),g&&a.jsxs("div",{className:"grid grid-cols-3 gap-3 md:grid-cols-3 md:gap-6",children:[a.jsx(Bk,{icon:Rh,title:"Total",value:dt.total,subtitle:"Finalizadoras cadastradas",color:"brand"}),a.jsx(Bk,{icon:Vi,title:"Ativas",value:dt.ativas,subtitle:"Disponveis para uso",color:"success",onClick:()=>b(y==="ativas"?null:"ativas"),isActive:y==="ativas"}),a.jsx(Bk,{icon:$m,title:"Mais Usada",value:dt.maisUsada,subtitle:"Mtodo mais popular",color:"warning",onClick:Nt})]}),a.jsx(Mr.div,{variants:V_,className:"bg-surface rounded-lg border border-border p-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative min-w-0 basis-0 flex-grow",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar finalizadora...",value:d,onChange:ve=>u(ve.target.value),className:"pl-10 h-11"})]}),a.jsxs(ea,{value:m,onValueChange:x,children:[a.jsx(Jn,{className:"w-[110px] md:w-[180px]",children:a.jsx(ra,{placeholder:"Filtrar por status"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todos"}),a.jsx(Qe,{value:"active",children:"Ativas"}),a.jsx(Qe,{value:"inactive",children:"Inativas"})]})]})]})}),a.jsx(Mr.div,{variants:V_,className:"bg-surface rounded-lg border border-border overflow-hidden",children:o?a.jsxs("div",{className:"p-12 text-center",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):St.length===0?a.jsxs("div",{className:"p-12 text-center text-text-muted",children:[a.jsx(Rh,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"Nenhuma finalizadora encontrada"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden divide-y divide-border",children:St.map(ve=>a.jsxs("div",{className:"p-3 flex flex-col gap-2 hover:bg-surface-2/50 cursor-pointer",onClick:()=>Wt(ve),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"px-2 py-0.5 rounded-md bg-surface-2 border border-border font-mono text-xs text-text-secondary",children:ve.codigo_interno||"-"}),a.jsx("span",{className:"font-semibold text-sm text-text-primary truncate",title:ve.nome,children:ve.nome})]}),a.jsxs("span",{className:Er("inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[11px] font-medium",ve.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Er("w-1.5 h-1.5 rounded-full",ve.ativo?"bg-success":"bg-muted")}),ve.ativo?"Ativa":"Inativa"]})]}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsxs("span",{children:["Taxa: ",ve.taxa_percentual?`${ve.taxa_percentual}%`:"-"]})}),a.jsxs("div",{className:"flex items-center gap-2",onClick:at=>at.stopPropagation(),children:[a.jsx(Z,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>_t(ve),children:a.jsx(xc,{className:"h-4 w-4"})}),a.jsx(Z,{variant:ve.ativo?"ghost":"default",size:"sm",className:"h-7 px-2",onClick:()=>yr(ve),children:ve.ativo?"Desativar":"Ativar"})]})]})]},ve.id))}),a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-surface-2 border-b border-border",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Cdigo"}),a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Descrio"}),a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Taxa (%)"}),a.jsx("th",{className:"text-center px-6 py-4 text-sm font-semibold text-text-secondary",children:"Status"}),a.jsx("th",{className:"text-right px-6 py-4 text-sm font-semibold text-text-secondary",children:"Aes"})]})}),a.jsx("tbody",{className:"divide-y divide-border",children:St.map(ve=>a.jsxs("tr",{className:"hover:bg-surface-2/50 transition-colors cursor-pointer",onClick:()=>Wt(ve),children:[a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"font-mono text-sm text-text-primary",children:ve.codigo_interno||"-"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"font-semibold text-text-primary",children:ve.nome})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-text-secondary",children:ve.taxa_percentual?`${ve.taxa_percentual}%`:"-"})}),a.jsx("td",{className:"px-6 py-4 text-center",children:a.jsxs("span",{className:Er("inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium",ve.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Er("w-2 h-2 rounded-full",ve.ativo?"bg-success":"bg-muted")}),ve.ativo?"Ativa":"Inativa"]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex justify-end gap-2",onClick:at=>at.stopPropagation(),children:[a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>_t(ve),children:a.jsx(xc,{className:"h-4 w-4"})}),a.jsx(Z,{variant:ve.ativo?"ghost":"default",size:"sm",onClick:()=>yr(ve),children:ve.ativo?"Desativar":"Ativar"})]})})]},ve.id))})]})})]})})]}),a.jsx(zn,{open:w,onOpenChange:j,children:a.jsxs(qn,{className:"sm:max-w-[500px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:_?"Editar Finalizadora":"Nova Finalizadora"}),a.jsx(la,{children:_?"Atualize as informaes da finalizadora":"Adicione um novo mtodo de pagamento"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{htmlFor:"codigo_interno",children:"Cdigo Finalizadora"}),a.jsx(At,{id:"codigo_interno",type:"text",placeholder:"Ex: 01, 02, 03...",value:A.codigo_interno,onChange:ve=>S({...A,codigo_interno:ve.target.value})}),a.jsx("p",{className:"text-xs text-text-muted",children:"Gerado automaticamente, mas pode ser editado"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{htmlFor:"nome",children:"Descrio *"}),a.jsx(At,{id:"nome",placeholder:"Ex: PIX, Dinheiro, Carto de Crdito...",value:A.nome,onChange:ve=>S({...A,nome:ve.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{htmlFor:"codigo_sefaz",children:"Forma de Pagamento NF-e/NFC-e *"}),a.jsx(Z,{type:"button",variant:"outline",className:"justify-between w-full",onClick:()=>M(!0),children:A.codigo_sefaz?`${A.codigo_sefaz} - ${PV.find(ve=>ve.codigo===A.codigo_sefaz)?.nome||""}`:"Selecione a forma de pagamento"}),a.jsx("p",{className:"text-xs text-text-muted",children:"A lista abrir em um modal com rolagem."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(lt,{htmlFor:"taxa",children:"Taxa"}),a.jsxs("div",{className:"relative",children:[a.jsx(At,{id:"taxa",inputMode:"decimal",placeholder:"0,00",className:"pr-10",value:A.taxa_percentual,onChange:ve=>{const at=String(ve.target.value).replace(/[^0-9.,]/g,"").replace(/,/g,".");if(at===""){S({...A,taxa_percentual:""});return}const qt=Number(at);if(Number.isFinite(qt)){const $t=Math.max(0,Math.min(100,qt));S({...A,taxa_percentual:String($t)})}},onBlur:()=>{const ve=String(A.taxa_percentual||"").replace(/,/g,".");if(ve==="")return;const at=Number(ve);if(Number.isFinite(at)){const qt=Math.max(0,Math.min(100,at));S($t=>({...$t,taxa_percentual:qt.toFixed(2)}))}}}),a.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-text-muted text-sm",children:"%"})]}),a.jsx("p",{className:"text-xs text-text-muted",children:"Deixe vazio se no houver taxa"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"ativo",checked:A.ativo,onChange:ve=>S({...A,ativo:ve.target.checked}),className:"h-4 w-4 rounded border-border"}),a.jsx(lt,{htmlFor:"ativo",className:"text-sm font-normal cursor-pointer",children:"Finalizadora ativa"})]})]}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>j(!1),disabled:l,children:"Cancelar"}),a.jsx(Z,{onClick:_r,disabled:l,children:l?"Salvando...":"Salvar"})]})]})}),a.jsx(zn,{open:P,onOpenChange:M,children:a.jsxs(qn,{className:"sm:max-w-[520px] w-[92vw]",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Selecionar Forma de Pagamento (SEFAZ)"}),a.jsx(la,{children:"Busque por cdigo ou nome"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(At,{placeholder:"Ex.: 03, crdito, pix...",value:O,onChange:ve=>I(ve.target.value)}),a.jsx("div",{className:"max-h-[420px] overflow-auto fx-scroll rounded-md border border-border",children:a.jsx("ul",{className:"divide-y divide-border",children:PV.filter(ve=>{const at=(O||"").toLowerCase();return at?ve.codigo.includes(at)||String(ve.nome).toLowerCase().includes(at):!0}).map(ve=>a.jsx("li",{children:a.jsxs("button",{type:"button",className:`w-full text-left px-3 py-2 hover:bg-surface-2 ${A.codigo_sefaz===ve.codigo?"bg-surface-2":""}`,onClick:()=>{S(at=>({...at,codigo_sefaz:ve.codigo})),M(!1)},children:[a.jsx("span",{className:"font-mono mr-2 text-text-secondary",children:ve.codigo}),a.jsx("span",{children:ve.nome})]})},ve.codigo))})})]})]})}),a.jsx(zn,{open:T,onOpenChange:k,children:a.jsxs(qn,{className:"sm:max-w-[700px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Detalhes da Finalizadora"}),a.jsx(la,{children:"Estatsticas e informaes completas"})]}),$&&a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Informaes"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Cdigo Finalizadora"}),a.jsx("p",{className:"font-mono text-sm text-text-primary",children:$.codigo_interno||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Forma de Pagamento NF-e/NFC-e"}),a.jsx("p",{className:"font-mono text-sm text-text-primary",children:$.codigo_sefaz||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Descrio"}),a.jsx("p",{className:"font-medium text-text-primary",children:$.nome})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Taxa"}),a.jsx("p",{className:"font-medium text-text-primary",children:$.taxa_percentual?`${$.taxa_percentual}%`:"Sem taxa"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Status"}),a.jsxs("span",{className:Er("inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium",$.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Er("w-2 h-2 rounded-full",$.ativo?"bg-success":"bg-muted")}),$.ativo?"Ativa":"Inativa"]})]})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Perodo de Anlise"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:_e==="hoje"?"default":"outline",size:"sm",onClick:()=>{U("hoje"),gr($.id,"hoje")},children:"Hoje"}),a.jsx(Z,{variant:_e==="semana"?"default":"outline",size:"sm",onClick:()=>{U("semana"),gr($.id,"semana")},children:"7 Dias"}),a.jsx(Z,{variant:_e==="mes"?"default":"outline",size:"sm",onClick:()=>{U("mes"),gr($.id,"mes")},children:"30 Dias"})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Estatsticas de Uso"}),V?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-brand border-t-transparent"})}):z?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Total de Transaes"}),a.jsx("span",{className:"font-semibold text-text-primary",children:z.transacoes})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Faturamento Total"}),a.jsxs("span",{className:"font-semibold text-success",children:["R$ ",z.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Ticket Mdio"}),a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",z.ticketMedio.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"ltima Utilizao"}),a.jsx("span",{className:"font-medium text-text-muted",children:z.ultimaUtilizacao?new Date(z.ultimaUtilizacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Nunca utilizada"})]})]}):a.jsx("div",{className:"text-center py-8 text-text-muted",children:a.jsx("p",{className:"text-sm",children:"Nenhum dado disponvel"})})]})]}),a.jsxs(Ua,{children:[a.jsx(Z,{variant:"outline",onClick:()=>k(!1),children:"Fechar"}),a.jsxs(Z,{onClick:()=>{k(!1),_t($)},children:[a.jsx(xc,{className:"h-4 w-4 mr-2"}),"Editar"]})]})]})}),a.jsx(zn,{open:L,onOpenChange:G,children:a.jsxs(qn,{className:"sm:max-w-[700px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Ranking de Finalizadoras"}),a.jsx(la,{children:"Faturamento por forma de pagamento"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx(Z,{variant:W==="hoje"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{Y("hoje"),be("hoje")},children:"Hoje"}),a.jsx(Z,{variant:W==="semana"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{Y("semana"),be("semana")},children:"7 Dias"}),a.jsx(Z,{variant:W==="mes"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{Y("mes"),be("mes")},children:"30 Dias"}),a.jsx(Z,{variant:W==="customizado"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>Y("customizado"),children:"Perodo"})]}),W==="customizado"&&(ie?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx(lt,{className:"text-xs",children:"Data Inicial"}),a.jsx("input",{type:"date",className:"mt-1 h-9 w-full rounded-md border border-border bg-surface px-2 text-sm text-text-primary",value:me,onChange:ve=>ee(ve.target.value)})]}),a.jsxs("div",{children:[a.jsx(lt,{className:"text-xs",children:"Data Final"}),a.jsx("input",{type:"date",className:"mt-1 h-9 w-full rounded-md border border-border bg-surface px-2 text-sm text-text-primary",value:ae,onChange:ve=>le(ve.target.value)})]})]}),a.jsx(Z,{className:"w-full",onClick:()=>be("customizado",me,ae),disabled:!me||!ae||Te,children:Te?"Buscando...":"Buscar"})]}):a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(lt,{children:"Data Inicial"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:Er("w-full justify-start text-left font-normal",!me&&"text-text-muted"),children:[a.jsx(ko,{className:"mr-2 h-4 w-4"}),me?new Date(me+"T12:00:00").toLocaleDateString("pt-BR"):"Selecione"]})}),a.jsx(Ho,{className:"w-auto p-0 bg-surface border border-border",align:"start",children:a.jsx(e3,{mode:"single",selected:me?new Date(me+"T12:00:00"):void 0,onSelect:ve=>{if(ve){const at=ve.getFullYear(),qt=String(ve.getMonth()+1).padStart(2,"0"),$t=String(ve.getDate()).padStart(2,"0");ee(`${at}-${qt}-${$t}`)}},className:"p-3"})})]})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx(lt,{children:"Data Final"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:Er("w-full justify-start text-left font-normal",!ae&&"text-text-muted"),children:[a.jsx(ko,{className:"mr-2 h-4 w-4"}),ae?new Date(ae+"T12:00:00").toLocaleDateString("pt-BR"):"Selecione"]})}),a.jsx(Ho,{className:"w-auto p-0 bg-surface border border-border",align:"start",children:a.jsx(e3,{mode:"single",selected:ae?new Date(ae+"T12:00:00"):void 0,onSelect:ve=>{if(ve){const at=ve.getFullYear(),qt=String(ve.getMonth()+1).padStart(2,"0"),$t=String(ve.getDate()).padStart(2,"0");le(`${at}-${qt}-${$t}`)}},className:"p-3"})})]})]}),a.jsx(Z,{onClick:()=>be("customizado",me,ae),disabled:!me||!ae||Te,children:"Buscar"})]}))]}),Te?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-brand border-t-transparent"})}):de.length===0?a.jsx("div",{className:"text-center py-12 text-text-muted",children:a.jsx("p",{children:"Nenhuma transao no perodo selecionado"})}):a.jsx("div",{className:"space-y-3",children:de.map((ve,at)=>a.jsx("div",{className:"bg-surface-2 rounded-lg p-3 md:p-4 border border-border",children:a.jsxs("div",{className:"flex items-start md:items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-start md:items-center gap-2 md:gap-3 flex-1 min-w-0",children:[a.jsxs("div",{className:Er("flex items-center justify-center w-7 h-7 md:w-8 md:h-8 rounded-full font-bold text-xs md:text-sm flex-shrink-0",at===0?"bg-warning/20 text-warning":at===1?"bg-info/20 text-info":at===2?"bg-success/20 text-success":"bg-muted/20 text-muted"),children:[at+1,""]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[a.jsx("span",{className:"font-mono text-[10px] md:text-xs text-text-muted",children:ve.codigo}),a.jsx("span",{className:"font-semibold text-sm md:text-base text-text-primary truncate",children:ve.nome})]}),a.jsxs("p",{className:"text-[10px] md:text-xs text-text-muted",children:[ve.transacoes," transaes"]})]})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsxs("p",{className:"text-base md:text-lg font-bold text-success whitespace-nowrap",children:["R$ ",ve.total.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),a.jsxs("p",{className:"text-[10px] md:text-xs text-text-muted whitespace-nowrap",children:["Mdia: R$ ",(ve.total/ve.transacoes).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})},ve.id))})]}),a.jsx(Ua,{children:a.jsx(Z,{variant:"outline",onClick:()=>G(!1),children:"Fechar"})})]})})]})}function eit(){return a.jsxs("div",{className:"p-8",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Pgina de Teste"}),a.jsx("p",{children:"Esta  uma pgina de teste para verificar se o roteamento est funcionando corretamente."})]})}function tit(){const[e,t]=p.useState(!1),[r,n]=p.useState(""),[s,o]=p.useState("Manuteno em andamento. Volte em breve!"),[i,l]=p.useState(!1),[c,d]=p.useState("");p.useEffect(()=>{try{const h=localStorage.getItem("maintenance:active")==="false",m=localStorage.getItem("maintenance:end")||"",x=localStorage.getItem("maintenance:message")||"Manuteno em andamento. Volte em breve!";t(h),n(m),o(x)}catch{}},[]);const u=h=>{if(h?.preventDefault(),e&&!r){alert("Defina uma data de trmino para a manuteno");return}localStorage.setItem("maintenance:active",e),localStorage.setItem("maintenance:end",r),localStorage.setItem("maintenance:message",s),window.dispatchEvent(new Event("storage")),l(!1),d(" Configuraes salvas!"),setTimeout(()=>d(""),3e3)},f=()=>{const h=!e;if(t(h),localStorage.setItem("maintenance:active",String(h)),h&&!r){const m=new Date;m.setDate(m.getDate()+1);const x=m.toISOString().slice(0,16);n(x),localStorage.setItem("maintenance:end",x)}window.dispatchEvent(new Event("storage")),d(h?" Modo manuteno ATIVADO":" Modo manuteno DESATIVADO"),setTimeout(()=>d(""),3e3)};return a.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg mt-10",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Controle de Manuteno"}),a.jsx("button",{onClick:f,className:`inline-flex items-center px-4 py-2 rounded-md font-medium ${e?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:e?"Manuteno ATIVA":"Manuteno INATIVA"})]}),e&&a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"font-medium text-lg",children:"Configuraes"}),a.jsxs("button",{onClick:()=>l(!i),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-sm",children:[a.jsx(xc,{className:"w-4 h-4"}),i?"Ocultar":"Editar"]})]}),i?a.jsxs("form",{onSubmit:u,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Trmino"}),a.jsx("div",{className:"relative",children:a.jsx("input",{type:"datetime-local",value:r,onChange:h=>n(h.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",min:new Date().toISOString().slice(0,16),required:!0})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensagem de Manuteno"}),a.jsx("textarea",{value:s,onChange:h=>o(h.target.value),rows:3,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Ex: Estamos em manuteno programada. Volte em breve!",required:!0})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[a.jsx(efe,{className:"inline w-4 h-4 mr-1"}),"Salvar"]})]})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Trmino:"}),a.jsx("p",{className:"text-gray-900",children:r?new Date(r).toLocaleString():"No definido"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Mensagem:"}),a.jsx("p",{className:"text-gray-900 whitespace-pre-line",children:s})]})]})]}),a.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600",children:[a.jsx("h3",{className:"font-medium mb-2",children:"Como usar:"}),a.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[a.jsx("li",{children:"Ative/desative o boto no topo"}),a.jsx("li",{children:"Defina a data de trmino e uma mensagem amigvel"}),a.jsx("li",{children:"Salve as configuraes"}),a.jsx("li",{children:"Para acessar durante a manuteno, use a senha no link"})]})]}),c&&a.jsx("div",{className:"fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg",children:c})]})}function rit(e){const t=new URLSearchParams(e.startsWith("#")?e.slice(1):e),r=t.get("access_token"),n=t.get("refresh_token");return{access_token:r,refresh_token:n}}const nit=()=>{const{toast:e}=Xs(),t=Ol(),[r,n]=p.useState(""),[s,o]=p.useState(""),[i,l]=p.useState(!1),[c,d]=p.useState(!1),u=p.useMemo(()=>rit(window.location.hash),[]);p.useEffect(()=>{(async()=>{const{data:{session:m}}=await Q.auth.getSession();if(m){d(!0);return}if(u.access_token&&u.refresh_token){const{data:x,error:g}=await Q.auth.setSession({access_token:u.access_token,refresh_token:u.refresh_token});g&&e({title:"Link invlido ou expirado",description:"Abra o link do email novamente.",variant:"destructive"}),d(!!x?.session)}else e({title:"Link invlido",description:"Abra o link de redefinio enviado por email.",variant:"destructive"})})()},[]);const f=async h=>{if(h.preventDefault(),r.length<6){e({title:"Senha muito curta",description:"A senha deve ter pelo menos 6 caracteres.",variant:"destructive"});return}if(r!==s){e({title:"Senhas no conferem",description:"As senhas digitadas so diferentes.",variant:"destructive"});return}l(!0);const{data:m,error:x}=await Q.auth.updateUser({password:r});if(l(!1),x){e({title:"Erro ao redefinir senha",description:x.message||"Tente novamente.",variant:"destructive"});return}e({title:"Senha redefinida",description:"Voc j pode acessar o sistema.",variant:"default"}),t("/")};return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:a.jsxs("div",{className:"w-full max-w-md bg-surface rounded-xl border border-border p-6 shadow",children:[a.jsx("h1",{className:"text-2xl font-semibold mb-2 text-text-primary",children:"Redefinir senha"}),a.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"Defina uma nova senha para sua conta."}),a.jsxs("form",{onSubmit:f,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1 text-text-secondary",children:"Nova senha"}),a.jsx(At,{type:"password",value:r,onChange:h=>n(h.target.value),placeholder:"",disabled:!c||i})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1 text-text-secondary",children:"Confirmar nova senha"}),a.jsx(At,{type:"password",value:s,onChange:h=>o(h.target.value),placeholder:"",disabled:!c||i})]}),a.jsx(Z,{type:"submit",className:"w-full",disabled:!c||i,children:i?"Salvando...":"Salvar nova senha"})]})]})})};function ait(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var koe=p,sit=ait(koe);function AV(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oit(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var iit=!!(typeof window<"u"&&window.document&&window.document.createElement);function lit(e,t,r){if(typeof e!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof t!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof r<"u"&&typeof r!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function n(s){return s.displayName||s.name||"Component"}return function(o){if(typeof o!="function")throw new Error("Expected WrappedComponent to be a React component.");var i=[],l;function c(){l=e(i.map(function(u){return u.props})),d.canUseDOM?t(l):r&&(l=r(l))}var d=function(u){oit(f,u);function f(){return u.apply(this,arguments)||this}f.peek=function(){return l},f.rewind=function(){if(f.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var x=l;return l=void 0,i=[],x};var h=f.prototype;return h.UNSAFE_componentWillMount=function(){i.push(this),c()},h.componentDidUpdate=function(){c()},h.componentWillUnmount=function(){var x=i.indexOf(this);i.splice(x,1),c()},h.render=function(){return sit.createElement(o,this.props)},f}(koe.PureComponent);return AV(d,"displayName","SideEffect("+n(o)+")"),AV(d,"canUseDOM",iit),d}}var cit=lit;const dit=Ls(cit);var uit=typeof Element<"u",fit=typeof Map=="function",mit=typeof Set=="function",hit=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function W_(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,s;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!W_(e[n],t[n]))return!1;return!0}var o;if(fit&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(o=e.entries();!(n=o.next()).done;)if(!t.has(n.value[0]))return!1;for(o=e.entries();!(n=o.next()).done;)if(!W_(n.value[1],t.get(n.value[0])))return!1;return!0}if(mit&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(o=e.entries();!(n=o.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(hit&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[n]))return!1;if(uit&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((s[n]==="_owner"||s[n]==="__v"||s[n]==="__o")&&e.$$typeof)&&!W_(e[s[n]],t[s[n]]))return!1;return!0}return e!==e&&t!==t}var pit=function(t,r){try{return W_(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}};const git=Ls(pit);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var EV=Object.getOwnPropertySymbols,xit=Object.prototype.hasOwnProperty,vit=Object.prototype.propertyIsEnumerable;function yit(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function bit(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(o){return t[o]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(o){s[o]=o}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var wit=bit()?Object.assign:function(e,t){for(var r,n=yit(e),s,o=1;o<arguments.length;o++){r=Object(arguments[o]);for(var i in r)xit.call(r,i)&&(n[i]=r[i]);if(EV){s=EV(r);for(var l=0;l<s.length;l++)vit.call(r,s[l])&&(n[s[l]]=r[s[l]])}}return n};const jit=Ls(wit);var Vg={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},hs={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(hs).map(function(e){return hs[e]});var Vo={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},wC={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},U1={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},_it=Object.keys(wC).reduce(function(e,t){return e[wC[t]]=t,e},{}),Nit=[hs.NOSCRIPT,hs.SCRIPT,hs.STYLE],ef="data-react-helmet",Sit=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cit=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Pit=function(){function e(t,r){for(var n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Rc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ait=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},kV=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},Eit=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e},z3=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},kit=function(t){var r=r0(t,hs.TITLE),n=r0(t,U1.TITLE_TEMPLATE);if(n&&r)return n.replace(/%s/g,function(){return Array.isArray(r)?r.join(""):r});var s=r0(t,U1.DEFAULT_TITLE);return r||s||void 0},Iit=function(t){return r0(t,U1.ON_CHANGE_CLIENT_STATE)||function(){}},qk=function(t,r){return r.filter(function(n){return typeof n[t]<"u"}).map(function(n){return n[t]}).reduce(function(n,s){return Rc({},n,s)},{})},Oit=function(t,r){return r.filter(function(n){return typeof n[hs.BASE]<"u"}).map(function(n){return n[hs.BASE]}).reverse().reduce(function(n,s){if(!n.length)for(var o=Object.keys(s),i=0;i<o.length;i++){var l=o[i],c=l.toLowerCase();if(t.indexOf(c)!==-1&&s[c])return n.concat(s)}return n},[])},ub=function(t,r,n){var s={};return n.filter(function(o){return Array.isArray(o[t])?!0:(typeof o[t]<"u"&&Rit("Helmet: "+t+' should be of type "Array". Instead found type "'+Sit(o[t])+'"'),!1)}).map(function(o){return o[t]}).reverse().reduce(function(o,i){var l={};i.filter(function(h){for(var m=void 0,x=Object.keys(h),g=0;g<x.length;g++){var v=x[g],y=v.toLowerCase();r.indexOf(y)!==-1&&!(m===Vo.REL&&h[m].toLowerCase()==="canonical")&&!(y===Vo.REL&&h[y].toLowerCase()==="stylesheet")&&(m=y),r.indexOf(v)!==-1&&(v===Vo.INNER_HTML||v===Vo.CSS_TEXT||v===Vo.ITEM_PROP)&&(m=v)}if(!m||!h[m])return!1;var b=h[m].toLowerCase();return s[m]||(s[m]={}),l[m]||(l[m]={}),s[m][b]?!1:(l[m][b]=!0,!0)}).reverse().forEach(function(h){return o.push(h)});for(var c=Object.keys(l),d=0;d<c.length;d++){var u=c[d],f=jit({},s[u],l[u]);s[u]=f}return o},[]).reverse()},r0=function(t,r){for(var n=t.length-1;n>=0;n--){var s=t[n];if(s.hasOwnProperty(r))return s[r]}return null},Tit=function(t){return{baseTag:Oit([Vo.HREF,Vo.TARGET],t),bodyAttributes:qk(Vg.BODY,t),defer:r0(t,U1.DEFER),encode:r0(t,U1.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:qk(Vg.HTML,t),linkTags:ub(hs.LINK,[Vo.REL,Vo.HREF],t),metaTags:ub(hs.META,[Vo.NAME,Vo.CHARSET,Vo.HTTPEQUIV,Vo.PROPERTY,Vo.ITEM_PROP],t),noscriptTags:ub(hs.NOSCRIPT,[Vo.INNER_HTML],t),onChangeClientState:Iit(t),scriptTags:ub(hs.SCRIPT,[Vo.SRC,Vo.INNER_HTML],t),styleTags:ub(hs.STYLE,[Vo.CSS_TEXT],t),title:kit(t),titleAttributes:qk(Vg.TITLE,t)}},U3=function(){var e=Date.now();return function(t){var r=Date.now();r-e>16?(e=r,t(r)):setTimeout(function(){U3(t)},0)}}(),IV=function(t){return clearTimeout(t)},Dit=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||U3:global.requestAnimationFrame||U3,Mit=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||IV:global.cancelAnimationFrame||IV,Rit=function(t){return console&&typeof console.warn=="function"&&console.warn(t)},fb=null,Fit=function(t){fb&&Mit(fb),t.defer?fb=Dit(function(){OV(t,function(){fb=null})}):(OV(t),fb=null)},OV=function(t,r){var n=t.baseTag,s=t.bodyAttributes,o=t.htmlAttributes,i=t.linkTags,l=t.metaTags,c=t.noscriptTags,d=t.onChangeClientState,u=t.scriptTags,f=t.styleTags,h=t.title,m=t.titleAttributes;V3(hs.BODY,s),V3(hs.HTML,o),Lit(h,m);var x={baseTag:sv(hs.BASE,n),linkTags:sv(hs.LINK,i),metaTags:sv(hs.META,l),noscriptTags:sv(hs.NOSCRIPT,c),scriptTags:sv(hs.SCRIPT,u),styleTags:sv(hs.STYLE,f)},g={},v={};Object.keys(x).forEach(function(y){var b=x[y],w=b.newTags,j=b.oldTags;w.length&&(g[y]=w),j.length&&(v[y]=x[y].oldTags)}),r&&r(),d(t,g,v)},Ioe=function(t){return Array.isArray(t)?t.join(""):t},Lit=function(t,r){typeof t<"u"&&document.title!==t&&(document.title=Ioe(t)),V3(hs.TITLE,r)},V3=function(t,r){var n=document.getElementsByTagName(t)[0];if(n){for(var s=n.getAttribute(ef),o=s?s.split(","):[],i=[].concat(o),l=Object.keys(r),c=0;c<l.length;c++){var d=l[c],u=r[d]||"";n.getAttribute(d)!==u&&n.setAttribute(d,u),o.indexOf(d)===-1&&o.push(d);var f=i.indexOf(d);f!==-1&&i.splice(f,1)}for(var h=i.length-1;h>=0;h--)n.removeAttribute(i[h]);o.length===i.length?n.removeAttribute(ef):n.getAttribute(ef)!==l.join(",")&&n.setAttribute(ef,l.join(","))}},sv=function(t,r){var n=document.head||document.querySelector(hs.HEAD),s=n.querySelectorAll(t+"["+ef+"]"),o=Array.prototype.slice.call(s),i=[],l=void 0;return r&&r.length&&r.forEach(function(c){var d=document.createElement(t);for(var u in c)if(c.hasOwnProperty(u))if(u===Vo.INNER_HTML)d.innerHTML=c.innerHTML;else if(u===Vo.CSS_TEXT)d.styleSheet?d.styleSheet.cssText=c.cssText:d.appendChild(document.createTextNode(c.cssText));else{var f=typeof c[u]>"u"?"":c[u];d.setAttribute(u,f)}d.setAttribute(ef,"true"),o.some(function(h,m){return l=m,d.isEqualNode(h)})?o.splice(l,1):i.push(d)}),o.forEach(function(c){return c.parentNode.removeChild(c)}),i.forEach(function(c){return n.appendChild(c)}),{oldTags:o,newTags:i}},Ooe=function(t){return Object.keys(t).reduce(function(r,n){var s=typeof t[n]<"u"?n+'="'+t[n]+'"':""+n;return r?r+" "+s:s},"")},$it=function(t,r,n,s){var o=Ooe(n),i=Ioe(r);return o?"<"+t+" "+ef+'="true" '+o+">"+z3(i,s)+"</"+t+">":"<"+t+" "+ef+'="true">'+z3(i,s)+"</"+t+">"},Bit=function(t,r,n){return r.reduce(function(s,o){var i=Object.keys(o).filter(function(d){return!(d===Vo.INNER_HTML||d===Vo.CSS_TEXT)}).reduce(function(d,u){var f=typeof o[u]>"u"?u:u+'="'+z3(o[u],n)+'"';return d?d+" "+f:f},""),l=o.innerHTML||o.cssText||"",c=Nit.indexOf(t)===-1;return s+"<"+t+" "+ef+'="true" '+i+(c?"/>":">"+l+"</"+t+">")},"")},Toe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(n,s){return n[wC[s]||s]=t[s],n},r)},qit=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(n,s){return n[_it[s]||s]=t[s],n},r)},zit=function(t,r,n){var s,o=(s={key:r},s[ef]=!0,s),i=Toe(n,o);return[Ce.createElement(hs.TITLE,i,r)]},Uit=function(t,r){return r.map(function(n,s){var o,i=(o={key:s},o[ef]=!0,o);return Object.keys(n).forEach(function(l){var c=wC[l]||l;if(c===Vo.INNER_HTML||c===Vo.CSS_TEXT){var d=n.innerHTML||n.cssText;i.dangerouslySetInnerHTML={__html:d}}else i[c]=n[l]}),Ce.createElement(t,i)})},mm=function(t,r,n){switch(t){case hs.TITLE:return{toComponent:function(){return zit(t,r.title,r.titleAttributes)},toString:function(){return $it(t,r.title,r.titleAttributes,n)}};case Vg.BODY:case Vg.HTML:return{toComponent:function(){return Toe(r)},toString:function(){return Ooe(r)}};default:return{toComponent:function(){return Uit(t,r)},toString:function(){return Bit(t,r,n)}}}},Doe=function(t){var r=t.baseTag,n=t.bodyAttributes,s=t.encode,o=t.htmlAttributes,i=t.linkTags,l=t.metaTags,c=t.noscriptTags,d=t.scriptTags,u=t.styleTags,f=t.title,h=f===void 0?"":f,m=t.titleAttributes;return{base:mm(hs.BASE,r,s),bodyAttributes:mm(Vg.BODY,n,s),htmlAttributes:mm(Vg.HTML,o,s),link:mm(hs.LINK,i,s),meta:mm(hs.META,l,s),noscript:mm(hs.NOSCRIPT,c,s),script:mm(hs.SCRIPT,d,s),style:mm(hs.STYLE,u,s),title:mm(hs.TITLE,{title:h,titleAttributes:m},s)}},Vit=function(t){var r,n;return n=r=function(s){Ait(o,s);function o(){return Cit(this,o),Eit(this,s.apply(this,arguments))}return o.prototype.shouldComponentUpdate=function(l){return!git(this.props,l)},o.prototype.mapNestedChildrenToProps=function(l,c){if(!c)return null;switch(l.type){case hs.SCRIPT:case hs.NOSCRIPT:return{innerHTML:c};case hs.STYLE:return{cssText:c}}throw new Error("<"+l.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},o.prototype.flattenArrayTypeChildren=function(l){var c,d=l.child,u=l.arrayTypeChildren,f=l.newChildProps,h=l.nestedChildren;return Rc({},u,(c={},c[d.type]=[].concat(u[d.type]||[],[Rc({},f,this.mapNestedChildrenToProps(d,h))]),c))},o.prototype.mapObjectTypeChildren=function(l){var c,d,u=l.child,f=l.newProps,h=l.newChildProps,m=l.nestedChildren;switch(u.type){case hs.TITLE:return Rc({},f,(c={},c[u.type]=m,c.titleAttributes=Rc({},h),c));case hs.BODY:return Rc({},f,{bodyAttributes:Rc({},h)});case hs.HTML:return Rc({},f,{htmlAttributes:Rc({},h)})}return Rc({},f,(d={},d[u.type]=Rc({},h),d))},o.prototype.mapArrayTypeChildrenToProps=function(l,c){var d=Rc({},c);return Object.keys(l).forEach(function(u){var f;d=Rc({},d,(f={},f[u]=l[u],f))}),d},o.prototype.warnOnInvalidChildren=function(l,c){return!0},o.prototype.mapChildrenToProps=function(l,c){var d=this,u={};return Ce.Children.forEach(l,function(f){if(!(!f||!f.props)){var h=f.props,m=h.children,x=kV(h,["children"]),g=qit(x);switch(d.warnOnInvalidChildren(f,m),f.type){case hs.LINK:case hs.META:case hs.NOSCRIPT:case hs.SCRIPT:case hs.STYLE:u=d.flattenArrayTypeChildren({child:f,arrayTypeChildren:u,newChildProps:g,nestedChildren:m});break;default:c=d.mapObjectTypeChildren({child:f,newProps:c,newChildProps:g,nestedChildren:m});break}}}),c=this.mapArrayTypeChildrenToProps(u,c),c},o.prototype.render=function(){var l=this.props,c=l.children,d=kV(l,["children"]),u=Rc({},d);return c&&(u=this.mapChildrenToProps(c,u)),Ce.createElement(t,u)},Pit(o,null,[{key:"canUseDOM",set:function(l){t.canUseDOM=l}}]),o}(Ce.Component),r.propTypes={base:La.object,bodyAttributes:La.object,children:La.oneOfType([La.arrayOf(La.node),La.node]),defaultTitle:La.string,defer:La.bool,encodeSpecialCharacters:La.bool,htmlAttributes:La.object,link:La.arrayOf(La.object),meta:La.arrayOf(La.object),noscript:La.arrayOf(La.object),onChangeClientState:La.func,script:La.arrayOf(La.object),style:La.arrayOf(La.object),title:La.string,titleAttributes:La.object,titleTemplate:La.string},r.defaultProps={defer:!0,encodeSpecialCharacters:!0},r.peek=t.peek,r.rewind=function(){var s=t.rewind();return s||(s=Doe({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),s},n},Wit=function(){return null},Hit=dit(Tit,Fit,Doe)(Wit),J0=Vit(Hit);J0.renderStatic=J0.rewind;function cc(e){return e??""}function d_(e){return String(e||"").replace(/\D/g,"")}function Git(){const{userProfile:e}=fo(),{toast:t}=Xs(),r=Ol(),[n,s]=p.useState(!0),[o,i]=p.useState(!1),[l,c]=p.useState(null),[d,u]=p.useState({inscricao_estadual:"",regime_tributario:"",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",nfce_serie:"1",nfce_numeracao:"1",nfce_itoken:"",nfe_serie:"",nfe_numeracao:"",ambiente:"homologacao",transmitenota_apikey:"",transmitenota_base_url:"",transmitenota_base_url_hml:"",transmitenota_apikey_hml:"",transmitenota_base_url_prod:"",transmitenota_apikey_prod:""}),[f,h]=p.useState(!0),[m,x]=p.useState(!1),[g,v]=p.useState(""),[y,b]=p.useState(""),[w,j]=p.useState(!1);p.useEffect(()=>{async function T(){if(!e?.codigo_empresa)return;s(!0);const{data:k,error:$}=await Q.from("empresas").select("*").eq("codigo_empresa",e.codigo_empresa).single();$?t({title:"Erro ao carregar",description:$.message,variant:"destructive"}):k&&(c(k),u({inscricao_estadual:cc(k.inscricao_estadual),regime_tributario:k.regime_tributario?String(k.regime_tributario):"",logradouro:cc(k.logradouro),numero:cc(k.numero),complemento:cc(k.complemento),bairro:cc(k.bairro),cidade:cc(k.cidade),uf:cc(k.uf),cep:d_(k.cep),codigo_municipio_ibge:cc(k.codigo_municipio_ibge),nfce_serie:k.nfce_serie!=null?String(k.nfce_serie):"1",nfce_numeracao:k.nfce_numeracao!=null?String(k.nfce_numeracao):"1",nfce_itoken:cc(k.nfce_itoken),nfe_serie:k.nfe_serie!=null?String(k.nfe_serie):"",nfe_numeracao:k.nfe_numeracao!=null?String(k.nfe_numeracao):"",ambiente:k.ambiente||"homologacao",transmitenota_apikey:cc(k.transmitenota_apikey),transmitenota_base_url:cc(k.transmitenota_base_url),transmitenota_base_url_hml:cc(k.transmitenota_base_url_hml),transmitenota_apikey_hml:cc(k.transmitenota_apikey_hml),transmitenota_base_url_prod:cc(k.transmitenota_base_url_prod),transmitenota_apikey_prod:cc(k.transmitenota_apikey_prod)})),s(!1)}T()},[e?.codigo_empresa]),p.useEffect(()=>{if(l?.codigo_empresa)try{const T=`cfgfiscal_hash_${l.codigo_empresa}`,k=!!l?.cfgfiscal_hash,$=!!localStorage.getItem(T);x(k||$)}catch{}},[l?.codigo_empresa]);const _=T=>k=>{const $=k?.target?k.target.value:k;u(q=>({...q,[T]:$}))};async function C(T){try{const k=(typeof window<"u"?window.crypto:typeof globalThis<"u"?globalThis.crypto:null)||null;if(k&&k.subtle&&typeof TextEncoder<"u"){const q=new TextEncoder().encode(T),z=await k.subtle.digest("SHA-256",q);return Array.from(new Uint8Array(z)).map(F=>F.toString(16).padStart(2,"0")).join("")}}catch{}return A(T)}function A(T){const k=unescape(encodeURIComponent(T));return S(k)}function S(T){for(var k=function(vt,dt){return vt>>>dt|vt<<32-dt},$=Math.pow,q=$(2,32),z="length",F,V,ue="",_e=[],U=T[z]*8,L=S.h=S.h||[],G=S.k=S.k||[],de=G[z],X={},W=2;de<64;W++)if(!X[W]){for(F=0;F<313;F+=W)X[F]=W;L[de]=$(W,.5)*q|0,G[de++]=$(W,1/3)*q|0}for(T+="";T[z]%64-56;)T+="\0";for(F=0;F<T[z];F++)V=T.charCodeAt(F),_e[F>>2]|=V<<(3-F)%4*8;for(_e[_e[z]]=U/q|0,_e[_e[z]]=U,V=0;V<_e[z];){var Y=_e.slice(V,V+=16),me=L;for(L=L.slice(0),F=0;F<64;F++){var ee=Y[F-15],ae=Y[F-2],le=L[0],Te=L[4],te=L[7]+(k(Te,6)^k(Te,11)^k(Te,25))+(Te&L[5]^~Te&L[6])+G[F]+(Y[F]=F<16?Y[F]:Y[F-16]+(k(ee,7)^k(ee,18)^ee>>>3)+Y[F-7]+(k(ae,17)^k(ae,19)^ae>>>10)|0),ie=(k(le,2)^k(le,13)^k(le,22))+(le&L[1]^le&L[2]^L[1]&L[2]);L=[te+ie|0,le,L[1],L[2],L[3]+te|0,L[4],L[5],L[6]]}for(F=0;F<8;F++)L[F]=L[F]+me[F]|0}for(F=0;F<8;F++)for(V=3;V+1;V--){var xt=L[F]>>V*8&255;ue+=(xt<16?0:"")+xt.toString(16)}return ue}async function P(T){if(T?.preventDefault?.(),!(w||!l?.cnpj))try{j(!0);const k=`cfgfiscal_hash_${l.codigo_empresa}`,$=l?.cfgfiscal_hash||"",q=localStorage.getItem(k)||"",z=$||q;if(!z){t({title:"Nenhuma senha definida",variant:"destructive"});return}await C(String(g||"")+"|"+String(l.cnpj||""))===z?(h(!0),v(""),t({title:"Acesso liberado"})):t({title:"Senha incorreta",variant:"destructive"})}finally{j(!1)}}async function M(T){if(T?.preventDefault?.(),!(w||!l?.cnpj)){if(!g||g.length<8){t({title:"Defina uma senha com 8+ caracteres",variant:"destructive"});return}if(g!==y){t({title:"Senhas no conferem",variant:"destructive"});return}try{j(!0);const k=`cfgfiscal_hash_${l.codigo_empresa}`,$=await C(String(g)+"|"+String(l.cnpj||""));let q=!1;try{const{error:z}=await Q.from("empresas").update({cfgfiscal_hash:$}).eq("codigo_empresa",l.codigo_empresa).select("id").single();if(!z){q=!0,c(F=>({...F,cfgfiscal_hash:$}));try{localStorage.removeItem(k)}catch{}}}catch{}if(!q)try{localStorage.setItem(k,$)}catch{}h(!0),v(""),b(""),t({title:"Senha definida"})}finally{j(!1)}}}async function O(T){if(T?.preventDefault?.(),!e?.codigo_empresa)return;const k={inscricao_estadual:d.inscricao_estadual?.trim()||null,regime_tributario:d.regime_tributario?Number(d.regime_tributario):null,logradouro:d.logradouro?.trim()||null,numero:d.numero?.trim()||null,complemento:d.complemento?.trim()||null,bairro:d.bairro?.trim()||null,cidade:d.cidade?.trim()||null,uf:d.uf?.trim().toUpperCase()||null,cep:d_(d.cep)||null,codigo_municipio_ibge:d.codigo_municipio_ibge?.trim()||null,nfce_serie:d.nfce_serie?Number(d.nfce_serie):null,nfce_numeracao:d.nfce_numeracao?Number(d.nfce_numeracao):null,nfce_itoken:d.nfce_itoken?.trim()||null,nfe_serie:d.nfe_serie?Number(d.nfe_serie):null,nfe_numeracao:d.nfe_numeracao?Number(d.nfe_numeracao):null,ambiente:d.ambiente||"homologacao",transmitenota_apikey:d.transmitenota_apikey?.trim()||null,transmitenota_base_url:d.transmitenota_base_url?.trim()||null,transmitenota_base_url_hml:d.transmitenota_base_url_hml?.trim()||null,transmitenota_apikey_hml:d.transmitenota_apikey_hml?.trim()||null,transmitenota_base_url_prod:d.transmitenota_base_url_prod?.trim()||null,transmitenota_apikey_prod:d.transmitenota_apikey_prod?.trim()||null};try{i(!0);const{error:$}=await Q.from("empresas").update(k).eq("codigo_empresa",e.codigo_empresa).select("id").single();if($)throw $;t({title:"Configuraes salvas",description:"Dados fiscais atualizados."})}catch($){t({title:"Erro ao salvar",description:$.message,variant:"destructive"})}finally{i(!1)}}async function I(T){const k=d_(l?.cnpj||"");if(k.length!==14){t({title:"CNPJ invlido",description:"Salve um CNPJ vlido (14 dgitos) nos dados da empresa.",variant:"destructive"});return}const $=T==="prod",q=$?"/api/producao":"/api/homologacao";try{const z=await Vot({baseUrl:q,apiKey:"",cnpj:k});if(!z.reachable){t({title:"Sem conexo",description:z.error||`Endpoint inacessvel (${z.status||"sem status"})`,variant:"destructive"});return}if(z.authorized===!1){t({title:"Credenciais invlidas",description:`HTTP ${z.status}. Verifique ApiKey e CNPJ.`,variant:"destructive"});return}const F=z.status===200?"OK":z.status===400?"Conectado (dados mnimos ausentes; credenciais vlidas)":`Conectado (HTTP ${z.status})`,V=z.meta?`  via ${z.meta.via||"edge"}  ambiente ${z.meta.ambiente||($?"producao":"homologacao")}`:"";t({title:`Conexo ${$?"PROD":"HML"}: sucesso`,description:F+V})}catch(z){t({title:"Falha no teste",description:z.message||"Erro inesperado",variant:"destructive"})}}return f?a.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[a.jsx(J0,{children:a.jsx("title",{children:"Configurao Fiscal"})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>r(-1),children:"Voltar"}),a.jsxs("div",{className:"text-right",children:[a.jsx("h1",{className:"text-2xl font-semibold leading-tight",children:"Configurao Fiscal"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Dados que sero usados na emisso de NFC-e/NF-e."})]})]}),a.jsxs("form",{onSubmit:O,className:"grid gap-6 bg-surface border border-border rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"Inscrio Estadual"}),a.jsx(At,{value:d.inscricao_estadual,onChange:_("inscricao_estadual")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Regime Tributrio (CRT)"}),a.jsxs(ea,{value:d.regime_tributario,onValueChange:_("regime_tributario"),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"1",children:"1 - Simples Nacional"}),a.jsx(Qe,{value:"2",children:"2 - Simples Nacional (excesso sublimite)"}),a.jsx(Qe,{value:"3",children:"3 - Regime Normal"})]})]})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Ambiente"}),a.jsxs(ea,{value:d.ambiente,onValueChange:_("ambiente"),children:[a.jsx(Jn,{children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"homologacao",children:"Homologao"}),a.jsx(Qe,{value:"producao",children:"Produo"})]})]})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"sm:col-span-3",children:[a.jsx(lt,{children:"Logradouro"}),a.jsx(At,{value:d.logradouro,onChange:_("logradouro")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Nmero"}),a.jsx(At,{value:d.numero,onChange:_("numero")})]}),a.jsxs("div",{className:"sm:col-span-2",children:[a.jsx(lt,{children:"Complemento"}),a.jsx(At,{value:d.complemento,onChange:_("complemento")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Bairro"}),a.jsx(At,{value:d.bairro,onChange:_("bairro")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"CEP"}),a.jsx(At,{value:d.cep,onChange:T=>_("cep")({target:{value:d_(T.target.value)}})})]}),a.jsxs("div",{className:"sm:col-span-2",children:[a.jsx(lt,{children:"Cidade"}),a.jsx(At,{value:d.cidade,onChange:_("cidade")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"UF"}),a.jsx(At,{value:d.uf,onChange:T=>_("uf")({target:{value:String(T.target.value||"").toUpperCase().slice(0,2)}})})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Cdigo IBGE Municpio (cMun)"}),a.jsx(At,{value:d.codigo_municipio_ibge,onChange:_("codigo_municipio_ibge")})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"NFC-e Srie"}),a.jsx(At,{value:d.nfce_serie,onChange:_("nfce_serie")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"NFC-e Numerao Inicial"}),a.jsx(At,{value:d.nfce_numeracao,onChange:_("nfce_numeracao")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"NFC-e IToken (CSC)"}),a.jsx(At,{value:d.nfce_itoken,onChange:_("nfce_itoken")})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"NF-e Srie (opcional)"}),a.jsx(At,{value:d.nfe_serie,onChange:_("nfe_serie")})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"NF-e Numerao (opcional)"}),a.jsx(At,{value:d.nfe_numeracao,onChange:_("nfe_numeracao")})]}),a.jsxs("div",{className:"hidden",children:[a.jsx(lt,{children:"ApiKey do Emissor"}),a.jsx(At,{value:d.transmitenota_apikey,readOnly:!0,disabled:!0})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"border border-border rounded-md p-3",children:[a.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Emissor Fiscal  Homologao"}),a.jsxs("div",{className:"hidden",children:[a.jsx(lt,{className:"text-xs",children:"Base URL (HML)"}),a.jsx(At,{value:d.transmitenota_base_url_hml,readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3"})]}),a.jsx(lt,{className:"text-xs",children:"ApiKey (HML)  Gerenciado no servidor"}),a.jsx(At,{value:d.transmitenota_apikey_hml?"":"",readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3",children:a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>I("hml"),disabled:o||n,children:n?"Testando...":"Testar conexo HML"})})]}),a.jsxs("div",{className:"border border-border rounded-md p-3",children:[a.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Emissor Fiscal  Produo"}),a.jsxs("div",{className:"hidden",children:[a.jsx(lt,{className:"text-xs",children:"Base URL (PROD)"}),a.jsx(At,{value:d.transmitenota_base_url_prod,readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3"})]}),a.jsx(lt,{className:"text-xs",children:"ApiKey (PROD)  Gerenciado no servidor"}),a.jsx(At,{value:d.transmitenota_apikey_prod?"":"",readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3",children:a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>I("prod"),disabled:o||n,children:n?"Testando...":"Testar conexo PROD"})})]})]}),a.jsx("div",{className:"flex gap-3 mt-4",children:a.jsx(Z,{type:"submit",disabled:o||n,children:o?"Salvando...":"Salvar Configuraes"})})]})]}):a.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[a.jsx(J0,{children:a.jsx("title",{children:"Configurao Fiscal"})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>r(-1),children:"Voltar"}),a.jsxs("div",{className:"text-right",children:[a.jsx("h1",{className:"text-2xl font-semibold leading-tight",children:"Configurao Fiscal"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Acesso restrito."})]})]}),a.jsx("div",{className:"max-w-md mx-auto grid gap-4 bg-surface border border-border rounded-lg p-4 shadow-sm",children:n?a.jsx("div",{className:"text-sm text-text-secondary",children:"Carregando..."}):m?a.jsxs(a.Fragment,{children:[a.jsx(lt,{children:"Senha"}),a.jsx(At,{type:"password",value:g,onChange:T=>v(T.target.value)}),a.jsx(Z,{type:"button",onClick:P,disabled:w||!g,children:w?"Verificando...":"Desbloquear"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm",children:"Defina uma senha para proteger esta aba."}),a.jsx(lt,{children:"Nova senha"}),a.jsx(At,{type:"password",value:g,onChange:T=>v(T.target.value)}),a.jsx(lt,{children:"Confirmar senha"}),a.jsx(At,{type:"password",value:y,onChange:T=>b(T.target.value)}),a.jsx(Z,{type:"button",onClick:M,disabled:w||!g||!y,children:w?"Salvando...":"Definir senha"})]})})]})}function Rd(e){return String(e||"").replace(/\D/g,"")}function Kl(e){if(e==null)return 0;let t=String(e).trim();if(!t)return 0;t.includes(",")&&t.includes(".")?t=t.replace(/\./g,"").replace(",","."):t.includes(",")&&(t=t.replace(",","."));const r=Number(t);return Number.isFinite(r)?r:0}function Moe(e){return(Array.isArray(e?.itens)?e.itens:[]).map((r,n)=>{const s=Kl(r.quantidade),o=Kl(r.preco_unitario),i=Kl(r.desconto_percent),l=Kl(r.desconto_valor),c=Kl(r.acrescimos_valor),d=Kl(r.frete_valor),u=Kl(r.seguro_valor),f=s*o,h=i?f*i/100:l,m=Math.max(0,f-h+c+d+u),x=r.impostos||{},g=x.icms||{},v=x.pis||{},y=x.cofins||{},b={numero_item:n+1,codigo_produto:r.codigo||n+1,descricao:r.descricao||`Item ${n+1}`,cfop:Number(r.cfop||5102),unidade_comercial:r.unidade||"UN",quantidade_comercial:s,valor_unitario_comercial:ro(o),codigo_ncm:Rd(r.ncm).slice(0,8)||"",valor_desconto:h?ro(h):"",valor_frete:d?ro(d):"",valor_seguro:u?ro(u):"",valor_outras_despesas:c?ro(c):"",valor_total:ro(m),valor_total_sem_desconto:ro(f),icms_orig:Number(x.origem||0)};if(g.csosn&&(b.icms_csosn=Number(g.csosn)),g.cst&&(b.icms_cst=Number(g.cst)),v.cst&&(b.pis_situacao_tributaria=v.cst),y.cst&&(b.cofins_situacao_tributaria=y.cst),v.aliquota){const w=Kl(v.aliquota);b.base_calculo_pis=ro(m),b.aliquota_pis=TV(w/100),b.valor_pis=ro(m*w/100)}if(y.aliquota){const w=Kl(y.aliquota);b.base_calculo_cofins=ro(m),b.aliquota_cofins=TV(w/100),b.valor_cofins=ro(m*w/100)}return b})}function Kit({form:e,finalizadoras:t=[]}){const r=Moe(e),n=r.reduce((h,m)=>h+Number(m.valor_total||0),0),s=Kl(e?.totais?.frete),o=Kl(e?.totais?.outras_despesas),i=Kl(e?.totais?.desconto_geral),l=n-i+s+o,c=Array.isArray(e?.pagamentos)?e.pagamentos:[],d=c.reduce((h,m)=>h+Kl(m.valor),0),u=Math.max(0,d-l),f=(()=>{if(!c.length)return"90";const h=c[0];return t.find(x=>String(x.id)===String(h.finalizadora_id))?.codigo_sefaz||"99"})();return{tipo_operacao:e?.tipo_nota==="entrada"?0:1,natureza_operacao:e?.natOp||"Venda de mercadoria",forma_pagamento:0,meio_pagamento:f,data_emissao:e?.data_emissao?new Date(e.data_emissao+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),data_saida_entrada:e?.data_saida?new Date(e.data_saida+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),hora_saida_entrada:new Date().toTimeString().slice(0,8),finalidade_emissao:Number(e?.finNFe||1),modalidade_frete:e?.transporte?.tipo_frete||"9",valor_frete:s?ro(s):"0",valor_seguro:"0",valor_ipi:"0",valor_total:ro(l),valor_total_sem_desconto:ro(n),valor_troco:u?ro(u):"",...e?.cpf_cnpj?{nome_destinatario:e?.nome||"",cnpj_destinatario:Rd(e?.cpf_cnpj),inscricao_estadual_destinatario:e?.ie_isento?"ISENTO":e?.inscricao_estadual||"",email_destinatario:e?.email||"",telefone_destinatario:Rd(e?.telefone||""),logradouro_destinatario:e?.logradouro||"",numero_destinatario:e?.numero||"",complemento_destinatario:"",bairro_destinatario:e?.bairro||"",municipio_destinatario:e?.cidade||"",codigo_cidade:e?.codigo_municipio_ibge||"",uf_destinatario:e?.uf||"",pais_destinatario:"Brasil",cep_destinatario:Rd(e?.cep||""),indicador_ie_destinatario:Number(e?.indIEDest||9)}:{},Itens:[r]}}function Xit({form:e}){const t=Moe(e),r=t.reduce((l,c)=>l+Number(c.valor_total||0),0),n=Kl(e?.totais?.frete),s=Kl(e?.totais?.outras_despesas),o=Kl(e?.totais?.desconto_geral),i=r-o+n+s;return{tipo_operacao:e?.tipo_nota==="entrada"?0:1,natureza_operacao:e?.natOp||"Venda de mercadoria",forma_pagamento:0,meio_pagamento:"01",data_emissao:e?.data_emissao?new Date(e.data_emissao+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),data_saida_entrada:e?.data_saida?new Date(e.data_saida+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),hora_saida_entrada:new Date().toTimeString().slice(0,8),finalidade_emissao:Number(e?.finNFe||1),modalidade_frete:Number(e?.transporte?.tipo_frete??9),valor_frete:n?ro(n):"0",valor_seguro:"0",valor_ipi:"0",valor_total:ro(i),valor_total_sem_desconto:ro(r),icms_base_calculo:"0",icms_valor_total:"0",icms_base_calculo_st:"0",icms_valor_total_st:"0",icms_modalidade_base_calculo:0,icms_valor:"0",informacoes_adicionais_contribuinte:e?.adicionais?.obs_gerais||"",nome_transportadora:e?.transporte?.transportadora||"",cnpj_transportadora:"",endereco_transportadora:"",municipio_transportadora:"",uf_transportadora:"",inscricao_estadual_transportadora:"",nome_destinatario:e?.nome||"",cnpj_destinatario:Rd(e?.cpf_cnpj||""),inscricao_estadual_destinatario:e?.ie_isento?"ISENTO":e?.inscricao_estadual||"",email_destinatario:e?.email||"",telefone_destinatario:Rd(e?.telefone||""),logradouro_destinatario:e?.logradouro||"",numero_destinatario:e?.numero||"",complemento_destinatario:"",bairro_destinatario:e?.bairro||"",municipio_destinatario:e?.cidade||"",uf_destinatario:e?.uf||"",pais_destinatario:"Brasil",cep_destinatario:Rd(e?.cep||""),indicador_ie_destinatario:Number(e?.indIEDest??1),Itens:t.map(l=>[l])}}function ro(e){const t=Number(e??0);return Number.isFinite(t)?t.toFixed(2):"0.00"}function TV(e){const t=Number(e??0);return Number.isFinite(t)?t.toFixed(4):"0.0000"}function Yit(e){return e==null?"":String(e)}function Jit(e,t){const r=Number(t||0);if(!Array.isArray(e)||e.length===0||r<=0)return e;const n=e.map(d=>Number(d.valor_total||0)),s=n.reduce((d,u)=>d+(Number.isFinite(u)?u:0),0);if(!(s>0))return e;const i=n.map(d=>r*(d/s)).map(d=>Number(ro(d)));let l=i.reduce((d,u)=>d+u,0),c=Number(ro(r-l));if(Math.abs(c)>=.01){const d=e.length-1;i[d]=Number(ro(i[d]+c)),l=i.reduce((u,f)=>u+f,0),c=Number(ro(r-l))}return e.map((d,u)=>{const f=i[u]||0,h=Number(d.valor_desconto||0)||0,m=Number(d.valor_total||0)||0,x=Math.max(0,h+f),g=Math.max(0,m-f);return{...d,valor_desconto:x?ro(x):"",valor_total:ro(g)}})}function Qit(e){return e?.length,0}function Zit(e,t){if(!e?.length)return"90";const r=e[0];return t.find(s=>s.id===r.finalizadora_id)?.codigo_sefaz||"99"}function elt(e,t){if(t){const r=Rd(t.cpf||t.cnpj||t.cpf_cnpj||t.cpf_cnpj_limpo);return{nome:t.nome||t.nome_completo||t.razao_social||"",cpf_cnpj:r||void 0,ie:t.inscricao_estadual||void 0,email:t.email||void 0,telefone:Rd(t.telefone)||void 0,endereco:{logradouro:t.logradouro||t.endereco||"",numero:Yit(t.numero||""),complemento:t.complemento||"",bairro:t.bairro||"",municipio:t.municipio||t.cidade||"",uf:t.uf||"",cep:Rd(t.cep),codigo_cidade:t.codigo_municipio||t.codigo_municipio_ibge||void 0,pais:t.pais||"Brasil"},indicador_ie_destinatario:t.indicador_ie_destinatario||9}}return null}async function dg({comandaId:e,codigoEmpresa:t}){if(!e)throw new Error("comandaId obrigatrio");if(!t)throw new Error("codigoEmpresa obrigatrio");const{data:r,error:n}=await Q.from("empresas").select("*").eq("codigo_empresa",t).single();if(n)throw n;const{data:s,error:o}=await Q.from("comandas").select("*").eq("codigo_empresa",t).eq("id",e).single();if(o)throw o;let i=null;if(s.cliente_id){const{data:S}=await Q.from("clientes").select("*").eq("id",s.cliente_id).single();i=S||null}else{const{data:S}=await Q.from("comanda_clientes").select("clientes:clientes!comanda_clientes_cliente_id_fkey(*)").eq("comanda_id",s.id).limit(1),P=Array.isArray(S)&&S.length?S[0]:null;P?.clientes&&(i=P.clientes)}const{data:l,error:c}=await Q.from("comanda_itens").select("*").eq("comanda_id",s.id);if(c)throw c;const d=Array.from(new Set(l.map(S=>S.produto_id).filter(Boolean)));let u=new Map;if(d.length){const{data:S}=await Q.from("produtos").select("*").in("id",d);(S||[]).forEach(P=>u.set(P.id,P))}const{data:f}=await Q.from("pagamentos").select("*").eq("comanda_id",s.id),h=Array.from(new Set((f||[]).map(S=>S.finalizadora_id).filter(Boolean)));let m=[];if(h.length){const{data:S}=await Q.from("finalizadoras").select("*").in("id",h);m=S||[]}const x=l.reduce((S,P)=>S+Number(P.quantidade||0)*Number(P.preco_unitario||0),0),g=l.reduce((S,P)=>S+Number(P.desconto||0),0),v=Math.max(0,x-g);let y=0;s?.desconto_tipo==="percentual"&&Number(s?.desconto_valor||0)>0?y=v*(Number(s.desconto_valor)/100):s?.desconto_tipo==="fixo"&&Number(s?.desconto_valor||0)>0&&(y=Number(s.desconto_valor));const b=elt(s,i);let w=l.map((S,P)=>{const M=u.get(S.produto_id)||{},O=Number(S.quantidade||0),I=Number(S.preco_unitario||0),T=Number(S.desconto||0),k=O*I-T,$=M.cfop_interno||M.cfop||5102,q=(M.ncm||"").replace(/\D/g,"").slice(0,8)||"",z=M.unidade||M.unit||"UN",F=M.csosn_interno||M.csosn||null;M.cst_icms_interno||M.cstIcmsInterno;const V=M.cst_pis_saida||M.cstPisSaida||"07",ue=M.cst_cofins_saida||M.cstCofinsSaida||"07",_e=M.icms_origem??0;return{numero_item:P+1,codigo_produto:M.code||M.codigo||M.id,descricao:M.name||M.descricao||S.descricao||"Item",cfop:Number($),unidade_comercial:z,quantidade_comercial:O,valor_unitario_comercial:ro(I),codigo_ncm:q,valor_desconto:T?ro(T):"",valor_frete:"",valor_seguro:"",valor_outras_despesas:"",valor_total:ro(k),valor_total_sem_desconto:ro(O*I),icms_csosn:F?Number(F):void 0,icms_orig:Number(_e)||0,pis_situacao_tributaria:V,base_calculo_pis:"",aliquota_pis:"",valor_pis:"",cofins_situacao_tributaria:ue,base_calculo_cofins:"",aliquota_cofins:"",valor_cofins:""}});y>5e-4&&(w=Jit(w,y));const j=w.reduce((S,P)=>S+Number(P.valor_total||0),0),_={tipo_operacao:1,natureza_operacao:"Venda de mercadoria",forma_pagamento:Qit(f),meio_pagamento:Zit(f,m),data_emissao:new Date(s.fechado_em||s.updated_at||Date.now()).toLocaleDateString("pt-BR"),data_saida_entrada:new Date(s.fechado_em||Date.now()).toLocaleDateString("pt-BR"),hora_saida_entrada:new Date(s.fechado_em||Date.now()).toTimeString().slice(0,8),finalidade_emissao:1,modalidade_frete:"9",valor_frete:"0",valor_seguro:"0",valor_ipi:"0",valor_total:ro(j),valor_total_sem_desconto:ro(x),...b?{nome_destinatario:b.nome,cnpj_destinatario:b.cpf_cnpj,inscricao_estadual_destinatario:b.ie,email_destinatario:b.email,telefone_destinatario:b.telefone,logradouro_destinatario:b.endereco.logradouro,numero_destinatario:b.endereco.numero,complemento_destinatario:b.endereco.complemento,bairro_destinatario:b.endereco.bairro,municipio_destinatario:b.endereco.municipio,codigo_cidade:b.endereco.codigo_cidade,uf_destinatario:b.endereco.uf,pais_destinatario:b.endereco.pais,cep_destinatario:b.endereco.cep,indicador_ie_destinatario:b.indicador_ie_destinatario}:{},Itens:w.map(S=>[S])},C=[];r?.inscricao_estadual||C.push("Inscrio Estadual (empresa)"),r?.regime_tributario||C.push("CRT/Regime Tributrio (empresa)"),(!r?.cidade||!r?.uf)&&C.push("Cidade/UF (empresa)"),r?.codigo_municipio_ibge||C.push("Cdigo IBGE do municpio (empresa)"),r?.nfce_serie||C.push("NFC-e Srie (empresa)"),!r?.nfce_itoken&&r?.ambiente==="producao"&&C.push("NFC-e IToken/CSC (produo)"),Rd(r?.cnpj)||C.push("CNPJ da empresa"),l.forEach(S=>{const P=u.get(S.produto_id)||{},M=Rd(P.ncm||"").slice(0,8);(!M||/^0+$/.test(M))&&C.push(`Produto ${P.name||P.id}: NCM vlido`),!P.cfop_interno&&!P.cfop&&C.push(`Produto ${P.name||P.id}: CFOP interno`)});const A={ApiKey:r?.transmitenota_apikey||"",Cnpj:Rd(r?.cnpj),Dados:_};return{empresa:r,comanda:s,cliente:i,itens:l,pagamentos:f,finalizadoras:m,payload:A,missing:C}}async function tlt({comandaId:e,codigoEmpresa:t,modelo:r="65",overrides:n={}}){if(!e)throw new Error("ID da comanda  obrigatrio");if(!t)throw new Error("Cdigo da empresa  obrigatrio");const{data:s,error:o}=await Q.from("vendas").select("*").eq("id",e).eq("codigo_empresa",t).single();if(o)throw new Error(`Erro ao buscar comanda: ${o.message}`);if(!s)throw new Error("Comanda no encontrada");const{data:i,error:l}=await Q.from("itens_venda").select(`
      *,
      produtos!itens_venda_produto_id_fkey (
        id,
        nome,
        codigo,
        ncm,
        cest,
        cfopInterno,
        cfopExterno,
        cstIcmsInterno,
        cstIcmsExterno,
        csosnInterno,
        csosnExterno,
        aliqIcmsInterno,
        aliqIcmsExterno,
        cstPisEntrada,
        cstPisSaida,
        aliqPisPercent,
        aliqCofinsPercent,
        cstIpi,
        aliqIpiPercent
      )
    `).eq("comanda_id",e).eq("codigo_empresa",t);if(l)throw new Error(`Erro ao buscar itens: ${l.message}`);const{data:c,error:d}=await Q.from("pagamentos").select(`
      *,
      finalizadoras!pagamentos_finalizadora_id_fkey (
        id,
        codigo_sefaz,
        nome
      )
    `).eq("comanda_id",e).eq("codigo_empresa",t).neq("status","Cancelado").neq("status","Estornado");if(d)throw new Error(`Erro ao buscar pagamentos: ${d.message}`);const{data:u,error:f}=await Q.from("empresas").select("*").eq("codigo_empresa",t).single();if(f)throw new Error(`Erro ao buscar empresa: ${f.message}`);let h=null;if(s.cliente_id){const{data:m}=await Q.from("clientes").select("*").eq("id",s.cliente_id).eq("codigo_empresa",t).single();h=m}return rlt({comanda:s,itens:i||[],pagamentos:c||[],empresa:u,cliente:h,modelo:r,overrides:n})}function rlt({comanda:e,itens:t,pagamentos:r,empresa:n,cliente:s,modelo:o="65",overrides:i={}}){const c=new Date().toISOString(),d=String(i.nNF||e.numero||"1"),u=o==="55"?"55":"65",f=u==="55"?"NF-e":"NFC-e",h=t.reduce((k,$)=>k+(Number($.preco_total)||0),0),m=Number(e.desconto)||0,x=h-m,g=String(i.natOp||"VENDA"),v=String(i.serie||"1"),y=String(i.tpAmb||(n.ambiente==="producao"?"1":"2")),b=String(i.tpNF||"1"),w=String(i.indFinal||"1"),j=String(i.indPres||"1"),_=s&&s.uf&&n.uf&&s.uf!==n.uf?"2":"1",C=String(i.idDest||_),S=String({AC:"12",AL:"27",AM:"13",AP:"16",BA:"29",CE:"23",DF:"53",ES:"32",GO:"52",MA:"21",MG:"31",MS:"50",MT:"51",PA:"15",PB:"25",PE:"26",PI:"22",PR:"41",RJ:"33",RN:"24",RO:"11",RR:"14",RS:"43",SC:"42",SE:"28",SP:"35",TO:"17"}[(n.uf||"").toUpperCase()]||n.codigo_uf||"35"),P=String(n.codigo_municipio_ibge||n.codigo_municipio||""),M=s?`
    <dest>
      <${s.tipo_pessoa==="PJ"?"CNPJ":"CPF"}>${s.cpf_cnpj||""}</${s.tipo_pessoa==="PJ"?"CNPJ":"CPF"}>
      <xNome>${Mc(s.nome||s.razao_social||"")}</xNome>
      <enderDest>
        <xLgr>${Mc(s.logradouro||"")}</xLgr>
        <nro>${Mc(s.numero||"S/N")}</nro>
        <xBairro>${Mc(s.bairro||"")}</xBairro>
        <cMun>${s.codigo_municipio||s.codigo_municipio_ibge||""}</cMun>
        <xMun>${Mc(s.municipio||s.cidade||"")}</xMun>
        <UF>${s.uf||""}</UF>
        <CEP>${(s.cep||"").replace(/\D/g,"")}</CEP>
        <cPais>1058</cPais>
        <xPais>BRASIL</xPais>
      </enderDest>
      <indIEDest>9</indIEDest>
      ${s.email?`<email>${Mc(s.email)}</email>`:""}
    </dest>`:`
    <dest>
      <indIEDest>9</indIEDest>
    </dest>`,O=t.map((k,$)=>{const q=k.produtos||{},z=Number(k.preco_unitario)||0,F=Number(k.quantidade)||1,V=Number(k.preco_total)||z*F;return`
    <det nItem="${$+1}">
      <prod>
        <cProd>${Mc(q.codigo||k.produto_id)}</cProd>
        <cEAN>SEM GTIN</cEAN>
        <xProd>${Mc(q.nome||"Produto")}</xProd>
        <NCM>${q.ncm||"00000000"}</NCM>
        ${q.cest?`<CEST>${q.cest}</CEST>`:""}
        <CFOP>${q.cfopInterno||"5102"}</CFOP>
        <uCom>UN</uCom>
        <qCom>${F.toFixed(4)}</qCom>
        <vUnCom>${z.toFixed(10)}</vUnCom>
        <vProd>${V.toFixed(2)}</vProd>
        <cEANTrib>SEM GTIN</cEANTrib>
        <uTrib>UN</uTrib>
        <qTrib>${F.toFixed(4)}</qTrib>
        <vUnTrib>${z.toFixed(10)}</vUnTrib>
        <indTot>1</indTot>
      </prod>
      <imposto>
        <ICMS>
          ${q.csosnInterno?`
          <ICMSSN102>
            <orig>0</orig>
            <CSOSN>${q.csosnInterno}</CSOSN>
          </ICMSSN102>`:`
          <ICMS00>
            <orig>0</orig>
            <CST>${q.cstIcmsInterno||"00"}</CST>
            <modBC>3</modBC>
            <vBC>${V.toFixed(2)}</vBC>
            <pICMS>${q.aliqIcmsInterno||"0.00"}</pICMS>
            <vICMS>${(V*(Number(q.aliqIcmsInterno)||0)/100).toFixed(2)}</vICMS>
          </ICMS00>`}
        </ICMS>
        <PIS>
          <PISAliq>
            <CST>${q.cstPisSaida||"01"}</CST>
            <vBC>${V.toFixed(2)}</vBC>
            <pPIS>${q.aliqPisPercent||"0.00"}</pPIS>
            <vPIS>${(V*(Number(q.aliqPisPercent)||0)/100).toFixed(2)}</vPIS>
          </PISAliq>
        </PIS>
        <COFINS>
          <COFINSAliq>
            <CST>${q.cstPisSaida||"01"}</CST>
            <vBC>${V.toFixed(2)}</vBC>
            <pCOFINS>${q.aliqCofinsPercent||"0.00"}</pCOFINS>
            <vCOFINS>${(V*(Number(q.aliqCofinsPercent)||0)/100).toFixed(2)}</vCOFINS>
          </COFINSAliq>
        </COFINS>
      </imposto>
    </det>`}).join(""),I=r.map(k=>{const $=k.finalizadoras?.codigo_sefaz||"99",q=Number(k.valor)||0;return`
    <pag>
      <detPag>
        <tPag>${$}</tPag>
        <vPag>${q.toFixed(2)}</vPag>
      </detPag>
    </pag>`}).join("");return`<?xml version="1.0" encoding="UTF-8"?>
<nfeProc versao="4.00" xmlns="http://www.portalfiscal.inf.br/nfe">
  <NFe xmlns="http://www.portalfiscal.inf.br/nfe">
    <infNFe versao="4.00" Id="NFe${n.cnpj||""}${d.padStart(9,"0")}">
      <ide>
        <cUF>${S}</cUF>
        <cNF>${d.padStart(8,"0")}</cNF>
        <natOp>${g}</natOp>
        <mod>${u}</mod>
        <serie>${v}</serie>
        <nNF>${d}</nNF>
        <dhEmi>${c}</dhEmi>
        <tpNF>${b}</tpNF>
        <idDest>${C}</idDest>
        <cMunFG>${P}</cMunFG>
        <tpImp>4</tpImp>
        <tpEmis>1</tpEmis>
        <tpAmb>${y}</tpAmb>
        <finNFe>1</finNFe>
        <indFinal>${w}</indFinal>
        <indPres>${j}</indPres>
        <procEmi>0</procEmi>
        <verProc>1.0.0</verProc>
      </ide>
      <emit>
        <CNPJ>${n.cnpj||""}</CNPJ>
        <xNome>${Mc(n.razao_social||n.nome_fantasia||"")}</xNome>
        <xFant>${Mc(n.nome_fantasia||"")}</xFant>
        <enderEmit>
          <xLgr>${Mc(n.logradouro||"")}</xLgr>
          <nro>${Mc(n.numero||"S/N")}</nro>
          <xBairro>${Mc(n.bairro||"")}</xBairro>
          <cMun>${n.codigo_municipio_ibge||n.codigo_municipio||""}</cMun>
          <xMun>${Mc(n.municipio||n.cidade||"")}</xMun>
          <UF>${n.uf||""}</UF>
          <CEP>${(n.cep||"").replace(/\D/g,"")}</CEP>
          <cPais>1058</cPais>
          <xPais>BRASIL</xPais>
          <fone>${(n.telefone||"").replace(/\D/g,"")}</fone>
        </enderEmit>
        <IE>${n.inscricao_estadual||""}</IE>
        <CRT>${n.regime_tributario||"1"}</CRT>
      </emit>
      ${M}
      ${O}
      <total>
        <ICMSTot>
          <vBC>0.00</vBC>
          <vICMS>0.00</vICMS>
          <vICMSDeson>0.00</vICMSDeson>
          <vFCP>0.00</vFCP>
          <vBCST>0.00</vBCST>
          <vST>0.00</vST>
          <vFCPST>0.00</vFCPST>
          <vFCPSTRet>0.00</vFCPSTRet>
          <vProd>${h.toFixed(2)}</vProd>
          <vFrete>0.00</vFrete>
          <vSeg>0.00</vSeg>
          <vDesc>${m.toFixed(2)}</vDesc>
          <vII>0.00</vII>
          <vIPI>0.00</vIPI>
          <vIPIDevol>0.00</vIPIDevol>
          <vPIS>0.00</vPIS>
          <vCOFINS>0.00</vCOFINS>
          <vOutro>0.00</vOutro>
          <vNF>${x.toFixed(2)}</vNF>
        </ICMSTot>
      </total>
      <transp>
        <modFrete>9</modFrete>
      </transp>
      ${I}
      <infAdic>
        <infCpl>Comanda: ${e.id} | Modelo: ${f}</infCpl>
      </infAdic>
    </infNFe>
  </NFe>
</nfeProc>`}function Mc(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}const DV=[{code:"1102",desc:"Compra para industrializao, comercializao ou prestao de servios"},{code:"5101",desc:"Venda de produo do estabelecimento"},{code:"5102",desc:"Venda de mercadoria adquirida de terceiros"},{code:"5103",desc:"Venda de produo do estabelecimento, efetuada fora do estabelecimento"},{code:"5104",desc:"Venda de mercadoria adquirida de terceiros, efetuada fora do estabelecimento"},{code:"5405",desc:"Venda de mercadoria adquirida de terceiros, sujeita a ST"},{code:"5949",desc:"Outras sadas de mercadorias no especificadas"},{code:"5915",desc:"Remessa em bonificao, doao ou brinde"},{code:"5109",desc:"Venda de produo do estabelecimento, destinada a no contribuinte"},{code:"5110",desc:"Venda de mercadoria adquirida de terceiros, destinada a no contribuinte"},{code:"5401",desc:"Venda de produo do estabelecimento, sujeita a ST"},{code:"5403",desc:"Venda de mercadoria, de terceiros, sujeita a ST, efetuada pelo industrial substituto"},{code:"2102",desc:"Compra para industrializao, comercializao ou prestao de servios (fora do estado)"},{code:"6101",desc:"Venda de produo do estabelecimento (fora do estado)"},{code:"6102",desc:"Venda de mercadoria adquirida de terceiros (fora do estado)"},{code:"6403",desc:"Venda de produo do estabelecimento, sujeita a ST (fora do estado)"},{code:"6915",desc:"Remessa em bonificao, doao ou brinde (fora do estado)"}];function Zs(e){return Number(e||0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}function mb(e){if(!e)return"";try{return new Date(e).toLocaleString("pt-BR")}catch{return""}}const Za=e=>e==null||String(e).trim()==="";function MV({label:e,value:t,onChange:r}){const[n,s]=Ce.useState(!1),o=Ce.useRef(null),i=Ce.useRef(null),[l,c]=Ce.useState({top:0,left:0}),d=m=>{try{const[x,g,v]=String(m||"").split("-").map(Number);return x&&g&&v?new Date(x,g-1,v):null}catch{return null}},u=m=>{const x=g=>String(g).padStart(2,"0");return`${m.getFullYear()}-${x(m.getMonth()+1)}-${x(m.getDate())}`},f=Ce.useCallback(()=>{if(!i.current)return;const m=i.current.getBoundingClientRect(),x=280,g=Math.min(Math.max(8,m.left),window.innerWidth-x-8),v=Math.min(m.bottom+6,window.innerHeight-8-260);c({top:v,left:g})},[]);Ce.useEffect(()=>{if(!n)return;f();const m=()=>f(),x=()=>f();return window.addEventListener("scroll",m,!0),window.addEventListener("resize",x),()=>{window.removeEventListener("scroll",m,!0),window.removeEventListener("resize",x)}},[n,f]);const h=d(t);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"relative",ref:o,children:a.jsx("button",{ref:i,type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs",onClick:()=>s(m=>!m),children:t?new Date(t+"T00:00:00").toLocaleDateString("pt-BR"):e})}),n&&U4.createPortal(a.jsx("div",{className:"fixed z-[1000] p-2 bg-black text-white border border-warning/40 rounded-md shadow-xl",style:{top:l.top,left:l.left,width:280},children:a.jsx(ei,{mode:"single",selected:h||void 0,onSelect:m=>{m&&(r(u(m)),s(!1))},showOutsideDays:!0,classNames:{caption_label:"text-[11px] font-medium text-white",head_cell:"text-[10px] text-warning/80 w-7",day:"h-7 w-7 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}),document.body)]})}function nlt(){const{userProfile:e}=fo(),t=e?.codigo_empresa,{toast:r}=Xs(),n=Ol(),[s,o]=p.useState([]),[i,l]=p.useState(!1),[c,d]=p.useState([]),[u,f]=p.useState(!1),[h,m]=p.useState(""),[x,g]=p.useState(""),[v,y]=p.useState("all"),b=D=>String(D).padStart(2,"0"),w=new Date,j=w.getFullYear(),_=w.getMonth()+1,C=`${j}-${b(_)}-01`,A=`${j}-${b(_)}-${b(new Date(j,_,0).getDate())}`,[S,P]=p.useState(C),[M,O]=p.useState(A),[I,T]=p.useState(!1),[k,$]=p.useState(null),[q,z]=p.useState("nfce");e&&(e.cargo||e.papel);const F=!0,V=!0,[ue,_e]=p.useState("aberto_em"),[U,L]=p.useState("desc"),[G,de]=p.useState(1),[X,W]=p.useState(50),[Y,me]=p.useState([]),ee=D=>Y.includes(D),ae=(D,K)=>{me(he=>K?Array.from(new Set([...he||[],D])):(he||[]).filter(Xe=>Xe!==D)),$(he=>K?D:he===D?null:he)},le=(D="filtered")=>{const K=";",he=Ve=>{let Bt=String(Ve??"");return Bt=Bt.replaceAll('"','""'),Bt=Bt.replaceAll(";","|"),`"${Bt}"`},Ue=[["Numero","Serie","Status","Destinatario","Origem","Chave","DataEmissao","ValorTotal"].join(K)];let Et=[];if(D==="selected"){const Ve=new Set(Y);k&&Ve.add(k),Et=(Nr||[]).filter(Bt=>Ve.has(Bt.id))}else Et=Nr||[];Et.forEach(Ve=>{const Bt=Ve.status||"pendente",Yt=Ve.destinatario?.nome||"",Ur=Ve.origem==="comanda"?`Comanda ${Ve.comanda_id??""}`:Ve.origem||"manual",jr=Ve.data_emissao||Ve.criado_em||Ve.created_at||"",mn=[Ve.numero??"",Ve.serie??"",Bt,Yt,Ur,Ve.xml_chave??"",jr,String(Ve.valor_total??"")];Ue.push(mn.map(he).join(K))});const Dt=new Blob(["\uFEFF"+Ue.join(`\r
`)],{type:"text/csv;charset=utf-8;"}),Mt=URL.createObjectURL(Dt),jt=document.createElement("a");jt.href=Mt,jt.download=`nfe-${D}-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(jt),jt.click(),document.body.removeChild(jt),URL.revokeObjectURL(Mt)},[Te,te]=p.useState(!1),ie=async D=>{try{if(!Pe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:K,cnpj:he}=tl(Pe);if(!he){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const Xe=D.xml_chave||"";let Ue;if(Xe)Ue={chave_nota:Xe,chave:Xe};else if(D.numero&&D.serie)Ue={numero:D.numero,serie:D.serie};else{r({title:"Sem referncia para consultar",description:"Preencha nmero/srie ou emita para obter a chave",variant:"warning"});return}r({title:"Consultando status...",description:`NF-e ${D.numero||""}/${D.serie||""}`});let Et=null,Dt="",Mt="",jt=!1,Ve=D.xml_url||null,Bt=D.pdf_url||null,Yt=D.xml_chave||null,Ur=D.numero||null,jr=D.serie||null;try{Et=await i_({baseUrl:K,cnpj:he,dados:Ue}),Dt=String(Et?.status||Et?.cStat||""),Mt=Et?.xMotivo||Et?.mensagem||Et?.message||"Retorno da consulta",jt=Dt==="100"||/autorizad/i.test(Mt),Ve=Et?.url_xml||Et?.xml_url||Ve,Bt=Et?.url_pdf||Et?.pdf_url||Bt,Yt=Et?.chave_nota||Et?.chave||Et?.Chave||Yt,Ur=Et?.numero||Et?.Numero||Ur,jr=Et?.serie||Et?.Serie||jr}catch(en){Mt=en?.message||String(en)}if(!jt||!Bt&&!Ve){try{const en=await l_({baseUrl:K,cnpj:he,dados:Ue});Bt=en?.url_pdf||en?.pdf_url||Bt,Yt=en?.chave||en?.Chave||Yt}catch{}try{const en=await c_({baseUrl:K,cnpj:he,dados:Ue});Ve=en?.url_xml||en?.xml_url||Ve,Yt=Yt||en?.chave||en?.Chave||Yt}catch{}(Bt||Ve)&&(jt=!0)}const mn=jt?"autorizada":/rejeit/i.test(Mt)?"rejeitada":Dt||D.status||"pendente";await Q.from("notas_fiscais").update({status:mn,xml_url:Ve,pdf_url:Bt,xml_chave:Yt,numero:Ur,serie:jr}).eq("id",D.id).eq("codigo_empresa",t),await ha(),r({title:jt?"Autorizada":`Status ${Dt||""}`.trim(),description:Mt||"Consulta concluda",variant:jt?"success":"default"})}catch(K){r({title:"Falha ao consultar",description:K?.message||String(K),variant:"destructive"})}},xt=async D=>{try{if(!D)return;const K=($s||"").trim();if(!K){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}if(!Pe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:he,cnpj:Xe}=tl(Pe);if(!Xe){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const Ue=D.xml_chave?{chave_nota:D.xml_chave,chave:D.xml_chave,motivo:K}:{numero:D.numero,serie:D.serie,motivo:K};await Hot({baseUrl:he,cnpj:Xe,dados:Ue}),await Q.from("notas_fiscais").update({status:"cancelada"}).eq("id",D.id).eq("codigo_empresa",t),await ha(),r({title:"NF-e cancelada"}),Ya(null),po("")}catch(K){r({title:"Falha ao cancelar",description:K?.message||String(K),variant:"destructive"})}},vt=async()=>{try{const D=c||[],K=k||Y&&Y[0];if(!K){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const he=D.find(Xe=>Xe.id===K);if(!he){r({title:"NF-e no encontrada na lista",variant:"warning"});return}await ie(he)}catch(D){r({title:"Falha ao consultar NF-e",description:D?.message||String(D),variant:"destructive"})}},dt=async()=>{try{const D=c||[],K=k||Y&&Y[0];if(!K){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const he=D.find(Xe=>Xe.id===K);if(!he){r({title:"NF-e no encontrada na lista",variant:"warning"});return}Ya(he),po("")}catch(D){r({title:"Falha ao cancelar NF-e",description:D?.message||String(D),variant:"destructive"})}},St=async()=>{try{const D=c||[],K=k||Y&&Y[0];if(!K){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const he=D.find(Ue=>Ue.id===K);if(!he){r({title:"NF-e no encontrada na lista",variant:"warning"});return}const Xe=he?.draft_data;if(!Xe||!Array.isArray(Xe.itens)||Xe.itens.length===0){Xt(he.id),he.draft_data&&et(he.draft_data),Tn(!0),r({title:"Rascunho incompleto",description:"Abra o rascunho para revisar e emitir.",variant:"warning"});return}await er(Xe,he.id)}catch(D){r({title:"Falha ao emitir NF-e",description:D?.message||String(D),variant:"destructive"})}},ft=async()=>{if(!Tt||!t){r({title:"Rascunho no iniciado",variant:"warning"});return}try{Wn(!0);const he=(Ae.itens||[]).map(Ue=>{const Et=Ee(Ue.preco_unitario)||0,Dt=Ee(Ue.quantidade)||1,Mt=Et*Dt,jt=Ee(Ue.desconto_percent)||0,Ve=Ee(Ue.desconto_valor)||0,Bt=Ee(Ue.acrescimos_valor)||0,Yt=jt?Mt*jt/100:Ve;return{preco_total:Mt-Yt+Bt}}).reduce((Ue,Et)=>Ue+(Number(Et.preco_total)||0),0)-(Ee(Ae.totais?.desconto_geral)||0)+(Ee(Ae.totais?.frete)||0)+(Ee(Ae.totais?.outras_despesas)||0),Xe={tipo_pessoa:Ae.tipo_pessoa,cpf_cnpj:Ae.cpf_cnpj,nome:Ae.nome,email:Ae.email,telefone:Ae.telefone,inscricao_estadual:Ae.ie_isento?"ISENTO":Ae.inscricao_estadual,logradouro:Ae.logradouro,numero:Ae.numero,bairro:Ae.bairro,cidade:Ae.cidade,uf:Ae.uf,cep:Ae.cep,codigo_municipio_ibge:Ae.codigo_municipio_ibge};await Q.from("notas_fiscais").update({draft_data:Ae,valor_total:Number.isFinite(he)?he:null,destinatario:Xe,numero:Ae.nNF?Number(Ae.nNF):null,serie:Ae.serie?Number(Ae.serie):null}).eq("id",Tt).eq("codigo_empresa",t),await ha(),r({title:"Rascunho salvo"}),Tn(!1)}catch(D){r({title:"Falha ao salvar rascunho",description:D?.message||String(D),variant:"destructive"})}finally{Wn(!1)}},_t=async D=>{if(!D||!t)return null;try{const K=(s||[]).find(Mt=>Mt.id===D),he=Number(K?.total||K?.total_com_desconto||0)||0,{ambiente:Xe}=tl(Pe||{}),{data:Ue,error:Et}=await Q.from("notas_fiscais").insert({codigo_empresa:t,origem:"comanda",comanda_id:D,modelo:"55",numero:null,serie:null,status:"rascunho",xml_url:null,pdf_url:null,valor_total:he,destinatario:null,ambiente:Xe||"homologacao"}).select("id").single();if(Et)throw Et;await ha();const Dt=Ue?.id||null;return Dt&&Xt(Dt),Dt}catch(K){return r({title:"Falha ao criar rascunho",description:K?.message||String(K),variant:"destructive"}),null}},gr=async()=>{if(!t)return null;try{const{ambiente:D}=tl(Pe||{}),{data:K,error:he}=await Q.from("notas_fiscais").insert({codigo_empresa:t,origem:"manual",comanda_id:null,modelo:"55",numero:null,serie:null,status:"rascunho",xml_url:null,pdf_url:null,valor_total:null,destinatario:null,ambiente:D||"homologacao"}).select("id").single();if(he)throw he;await ha();const Xe=K?.id||null;return Xe&&Xt(Xe),et({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:ke,data_saida:ke,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{tipo:"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:"",parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}),ta(""),Tn(!0),Xe}catch(D){return r({title:"Falha ao criar rascunho manual",description:D?.message||String(D),variant:"destructive"}),null}},[be,Nt]=p.useState([]),Wt=D=>be.includes(D);p.useEffect(()=>{const D=setTimeout(()=>g(h),300);return()=>clearTimeout(D)},[h]);const[_r,yr]=p.useState(!1),[ve,at]=p.useState(!1);p.useEffect(()=>{try{const D=String({}.VITE_MAINTENANCE_MODE||"").toLowerCase()==="true",K=localStorage.getItem("maintenance:active")==="true",he=localStorage.getItem("maintenance:end"),Xe=he?new Date>new Date(he):!1,Ue=(D||K)&&!Xe,Et=(()=>{try{const Dt=localStorage.getItem("maintenance:bypass")==="1",Mt=sessionStorage.getItem("maintenance:bypass")==="1",jt=document.cookie.split(";").some(Ve=>Ve.trim()==="fx_maint_bypass=1");return Dt||Mt||jt}catch{return!1}})();yr(!1),at(!0)}catch{yr(!1),at(!0)}},[]);const[qt,$t]=p.useState(!1),[De,wt]=p.useState(!1),[Rt,Rr]=p.useState(null),[Me,tt]=p.useState([]),[ut,sr]=p.useState(!1),[Sr,xr]=p.useState(null),[Wr,qr]=p.useState(!1),[Tr,sn]=p.useState(!1),[Cn,ze]=p.useState({}),[Fe,Le]=p.useState([]),[Ze,Ot]=p.useState(!1),[mt,Qt]=p.useState(!1),[bt,zt]=p.useState(""),[ne,He]=p.useState(null),[Gt,Ht]=p.useState({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:""}),[Fr,cr]=p.useState(!1),[nn,Tn]=p.useState(!1),[Gn,ta]=p.useState(""),Aa=new Date,ke=`${Aa.getFullYear()}-${b(Aa.getMonth()+1)}-${b(Aa.getDate())}`,[Ae,et]=p.useState({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:ke,data_saida:ke,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{tipo:"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:"",parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}),[br,Zt]=p.useState([]),[Pn,Ct]=p.useState(!1),[lr,Ye]=p.useState({codigo:"",descricao:""}),[Tt,Xt]=p.useState(null),[Br,Wn]=p.useState(!1),[xn,on]=p.useState(!1),[ua,sa]=p.useState(!1),[wa,Va]=p.useState(null),[J,Oe]=p.useState("");p.useState(!1);const[Je,mr]=p.useState(!1),[ot,ar]=p.useState(!1),ir=p.useMemo(()=>{const D=Ae||{},K=D.itens||[],he=D.pagamentos||[],Xe=String(D.modelo)==="65",Ue=!!(D.modelo&&D.serie&&D.natOp&&D.data_emissao&&D.tipo_nota&&D.finNFe),Et=Array.isArray(K)&&K.length>0,Dt=Et&&K.every(Bt=>{const Yt=Bt.impostos||{},Ur=Yt.icms||{},jr=Yt.pis||{},mn=Yt.cofins||{},en=!!(Yt.origem&&(Ur.cst||Ur.csosn)),Yr=jr.aliquota!==void 0&&String(jr.aliquota).trim()!=="",gn=mn.aliquota!==void 0&&String(mn.aliquota).trim()!=="";return en&&Yr&&gn}),Mt=Et&&Dt,jt=!!(D.transporte&&D.transporte.tipo_frete);let Ve=!0;if(Xe){const Bt=K.reduce((Yr,gn)=>{const Yn=Ee(gn.preco_unitario)||0,Hn=Ee(gn.quantidade)||1,ns=Yn*Hn,Do=Ee(gn.desconto_percent)||0,Ta=Ee(gn.desconto_valor)||0,Kn=Do?ns*Do/100:Ta,ao=Ee(gn.acrescimos_valor)||0,Ms=Math.max(0,ns-Kn+ao);return Yr+Ms},0),Yt=Ee(D.totais?.desconto_geral)||0,Ur=Ee(D.totais?.frete)||0,jr=Ee(D.totais?.outras_despesas)||0,mn=Bt-Yt+Ur+jr,en=he.reduce((Yr,gn)=>Yr+(Ee(gn.valor)||0),0);Ve=he.length>0&&en+.009>=mn}return{identOk:Ue,produtosOk:Mt,pagamentosOk:Ve,totaisOk:!0,transpOk:jt}},[Ae]),[In,ln]=p.useState("cliente"),[Kr,oe]=p.useState("ident"),[Ke,ct]=p.useState(!1),[xe,$e]=p.useState(""),[Pe,Vt]=p.useState(null),[yt,tr]=p.useState([]),[dr,tn]=p.useState(""),[Lr,da]=p.useState(null),[rn,un]=p.useState(!1),[Dn,fa]=p.useState(null),[Oa,us]=p.useState(null),[Un,Ya]=p.useState(null),[$s,po]=p.useState(""),[wi,zo]=p.useState(!1);p.useState(!1);const[ji,ec]=p.useState("");p.useState("");const[rd,pl]=p.useState([]),[Eu,Ko]=p.useState("cliente"),[Hs,tc]=p.useState([]),[Xi,Tl]=p.useState(null);p.useState("");const[As,rc]=p.useState(!1),[Ns,gl]=p.useState(!1),[Dl,ku]=p.useState(""),[xl,Yi]=p.useState(null),[vl,R]=p.useState(""),[fe,We]=p.useState(!0),[gt,Ut]=p.useState(!1),[zr,cn]=p.useState(!1),se=async({tipo:D,scope:K,includePdf:he})=>{try{if(!Pe){r({title:"Empresa no carregada",variant:"warning"});return}const Xe=tl(Pe),Ue=Xe?.ambiente||"homologacao",Et=Xe?.cnpj||"";if(!Et){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}cn(!0);let Dt=[];if(D==="nfce"){let en=[];if(K==="selected"){const Yr=new Set(Y);k&&Yr.add(k),en=(s||[]).filter(gn=>Yr.has(gn.id))}else en=is||[];Dt=en.map(Yr=>({tipo:"nfce",chave:Yr.xml_chave,numero:Yr.nf_numero,serie:Yr.nf_serie,searchkey:Yr.xml_protocolo}))}else if(D==="nfe"){let en=[];if(K==="selected"){const Yr=new Set(Y);k&&Yr.add(k),en=(c||[]).filter(gn=>Yr.has(gn.id))}else en=Nr||[];Dt=en.map(Yr=>({tipo:"nfe",chave:Yr.xml_chave,numero:Yr.numero,serie:Yr.serie}))}if(Dt=Dt.filter(en=>en.chave||en.numero&&en.serie||en.searchkey),!Dt.length){r({title:"Nada para exportar",description:"Nenhum documento elegvel encontrado.",variant:"warning"});return}const Mt=en=>String(en||"").replace(/[^0-9A-Za-z_-]/g,""),jt=`${D}-${K}-${Mt(S)}_a_${Mt(M)}${he?"-xml-pdf":"-xml"}.zip`,Ve=`${Q.supabaseUrl}/functions/v1/emissor`,Bt=await fetch(Ve,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q.supabaseKey}`,apikey:Q.supabaseKey,Accept:"application/zip"},body:JSON.stringify({acao:"export_zip",ambiente:Ue,cnpj:Et,dados:{items:Dt,includePdf:he,zipName:jt}})});if(!Bt.ok){const en=await Bt.text();throw new Error(en||"Falha ao gerar ZIP")}const Yt=await Bt.arrayBuffer(),Ur=new Blob([Yt],{type:"application/zip"}),jr=URL.createObjectURL(Ur),mn=document.createElement("a");mn.href=jr,mn.download=jt,document.body.appendChild(mn),mn.click(),document.body.removeChild(mn),URL.revokeObjectURL(jr),r({title:"Exportao iniciada",description:`${Dt.length} documentos adicionados ao ZIP`})}catch(Xe){r({title:"Falha na exportao",description:Xe?.message||String(Xe),variant:"destructive"})}finally{cn(!1)}},Se=D=>String(D||"").replace(/\D/g,""),Ee=D=>{if(D==null)return 0;let K=String(D).trim();if(!K)return 0;const he=K.includes(","),Xe=K.includes(".");he&&Xe?K=K.replace(/\./g,"").replace(",","."):he&&(K=K.replace(",","."));const Ue=Number(K);return Number.isFinite(Ue)?Ue:0},it=D=>{try{const K=Ee(D?.totais?.desconto_geral)||0,he=Array.isArray(D?.itens)?D.itens:[];if(!K||!he.length)return D;const Xe=he.map(Bt=>{const Yt=Ee(Bt.quantidade),Ur=Ee(Bt.preco_unitario),jr=Yt*Ur,mn=Ee(Bt.desconto_percent),en=Ee(Bt.desconto_valor),Yr=Ee(Bt.acrescimos_valor),gn=Ee(Bt.frete_valor),Yn=Ee(Bt.seguro_valor),Hn=mn?jr*mn/100:en;return Math.max(0,jr-Hn+Yr+gn+Yn)}),Ue=Xe.reduce((Bt,Yt)=>Bt+Yt,0);if(!(Ue>0))return D;const Dt=Xe.map(Bt=>K*(Bt/Ue)).map(Bt=>Number(Bt.toFixed(2)));let Mt=Dt.reduce((Bt,Yt)=>Bt+Yt,0),jt=Number((K-Mt).toFixed(2));if(Math.abs(jt)>=.01){const Bt=Dt.length-1;Dt[Bt]=Number((Dt[Bt]+jt).toFixed(2)),Mt=Dt.reduce((Yt,Ur)=>Yt+Ur,0)}const Ve=he.map((Bt,Yt)=>{const Ur=Ee(Bt.desconto_percent),jr=Ee(Bt.preco_unitario),en=Ee(Bt.quantidade)*jr,Yr=Ur?en*Ur/100:Ee(Bt.desconto_valor),gn=Number((Yr+(Dt[Yt]||0)).toFixed(2));return{...Bt,desconto_percent:"",desconto_valor:gn.toFixed(2)}});return{...D,itens:Ve,totais:{...D?.totais||{},desconto_geral:"0.00"}}}catch{return D}};p.useEffect(()=>{et(D=>({...D,baixar_estoque:D.tipo_nota!=="entrada"}))},[Ae.tipo_nota]),p.useEffect(()=>{Ko(Ae.tipo_nota==="entrada"?"fornecedor":"cliente")},[Ae.tipo_nota]),p.useEffect(()=>{et(D=>({...D,cfop_padrao:Xr(D.uf)}))},[Ae.tipo_nota,xe,Ae.uf]),p.useEffect(()=>{if(!nn||!t)return;let D=!0;return(async()=>{try{const K=[{id:"5102",codigo:"5102",descricao:"Venda de mercadoria adquirida ou recebida de terceiros",tipo_nota:"saida"},{id:"5101",codigo:"5101",descricao:"Venda de produo do estabelecimento",tipo_nota:"saida"},{id:"6102",codigo:"6102",descricao:"Venda de mercadoria para fora do estado (terceiros)",tipo_nota:"saida"},{id:"6101",codigo:"6101",descricao:"Venda de produo para fora do estado",tipo_nota:"saida"}],{data:he,error:Xe}=await Q.from("cfops").select("id, codigo, descricao, tipo_nota").eq("codigo_empresa",t).order("codigo");if(Xe)throw Xe;if(!D)return;const Ue=Array.isArray(he)?he:[],Et=new Set(Ue.map(Mt=>String(Mt.codigo))),Dt=[...Ue,...K.filter(Mt=>!Et.has(String(Mt.codigo)))];Zt(Dt)}catch(K){console.error("[FiscalHub][CFOP] Falha ao carregar CFOPs",K),Zt([{id:"5102",codigo:"5102",descricao:"Venda de mercadoria adquirida ou recebida de terceiros",tipo_nota:"saida"},{id:"5101",codigo:"5101",descricao:"Venda de produo do estabelecimento",tipo_nota:"saida"},{id:"6102",codigo:"6102",descricao:"Venda de mercadoria para fora do estado (terceiros)",tipo_nota:"saida"},{id:"6101",codigo:"6101",descricao:"Venda de produo para fora do estado",tipo_nota:"saida"}])}})(),()=>{D=!1}},[nn,t]);const Pt=p.useRef(Ae.cfop_padrao);p.useEffect(()=>{const D=Pt.current,K=Ae.cfop_padrao||"";Pt.current=K,!(!fe||!K)&&et(he=>{const Xe=he.itens||[];let Ue=!1;const Et=Xe.map(Dt=>{const Mt=String(Dt.cfop||"");return Mt===""||D&&Mt===D?(Ue=!0,{...Dt,cfop:K}):Dt});return Ue?{...he,itens:Et}:he})},[Ae.cfop_padrao,fe]);const hr=D=>{const K=String(D||"").replace(/\D/g,""),he=K?Number(K)/100:0;return new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(he)},er=async(D=null,K=null)=>{try{const he=D&&typeof D=="object"&&("nativeEvent"in D||"preventDefault"in D||"target"in D),Xe=!D||he?Ae:D,Ue=Xe.itens||[];try{console.log("[FiscalHub][emitirNota] start",{modelo:Xe.modelo,itensLen:Array.isArray(Ue)?Ue.length:0})}catch{}if(!Array.isArray(Ue)||Ue.length===0){try{console.warn("[FiscalHub][emitirNota] itens ausentes",{form:Xe})}catch{}r({title:"Sem itens",variant:"warning"});return}if(!Pe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:Et,cnpj:Dt}=tl(Pe);if(!Dt){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const Mt=String(Xe.modelo)==="65",jt=it(Xe);let Ve=Mt?Kit({form:jt,finalizadoras:Hs||[]}):Xit({form:jt});try{console.log("[FiscalHub][emitirNota] payload gerado (antes do preflight)",{isNFCe:Mt,Dados:Ve})}catch{}if(!Mt){if((!Ve||typeof Ve!="object")&&(Ve={}),"forma_pagamento"in Ve||(Ve.forma_pagamento=0),!("meio_pagamento"in Ve)||!Ve.meio_pagamento){let Xn="99";const pa=Array.isArray(jt?.pagamentos)?jt.pagamentos[0]:null;if(pa?.finalizadora_id&&Array.isArray(Hs)&&Hs.length){const ps=Hs.find(qs=>String(qs.id)===String(pa.finalizadora_id));ps?.codigo_sefaz&&(Xn=String(ps.codigo_sefaz).padStart(2,"0"))}Ve.meio_pagamento=Xn}else Ve.meio_pagamento=String(Ve.meio_pagamento).padStart(2,"0");(!Ve.natureza_operacao||String(Ve.natureza_operacao).trim().length<15)&&(Ve.natureza_operacao="Venda de mercadoria");try{const pa=(Array.isArray(Ve.Itens)?Ve.Itens:[]).reduce((ps,qs)=>ps+(Number(qs?.valor_total_sem_desconto)||0),0);pa>0&&(Ve.valor_total_sem_desconto=pa.toFixed(2))}catch{}if("numero_destinatario"in Ve){const Xn=String(Ve.numero_destinatario||"").trim();(!Xn||/^s\/?n$/i.test(Xn))&&(Ve.numero_destinatario="0")}let Ta=Number(jt?.serie||1)||1;if(jt?.nNF)Ve.Numero=Number(jt.nNF),Ve.Serie=Ta;else try{try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"start",mensagem:`serie=${Ta}`})}catch{}const{data:Xn,error:pa}=await Q.rpc("reservar_numero_fiscal",{p_modelo:"55",p_serie:Ta,p_codigo_empresa:t});if(pa)throw pa;const ps=Number(Xn);et(qs=>({...qs,nNF:String(ps),serie:String(Ta)})),Ve.Numero=ps,Ve.Serie=Ta;try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"success",mensagem:`numero=${ps}`})}catch{}}catch(Xn){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"error",mensagem:Xn?.message||String(Xn)})}catch{}r({title:"Falha ao reservar numerao NF-e",description:Xn?.message||String(Xn),variant:"destructive"});return}try{const Xn=String(jt?.cpf_cnpj||"").replace(/\D/g,""),pa=String(jt?.inscricao_estadual||"").trim();Xn.length===14?jt?.ie_isento?Ve.indicador_ie_destinatario=2:pa&&pa.toUpperCase()!=="ISENTO"?Ve.indicador_ie_destinatario=1:Ve.indicador_ie_destinatario=9:Ve.indicador_ie_destinatario=9}catch{}const Kn=[],Ms=(Xn=>String(Xn||"").replace(/\D/g,""))(jt?.cpf_cnpj);if(Ms||Kn.push("Informe CPF/CNPJ do destinatrio"),jt?.nome||Kn.push("Informe o nome/razo social do destinatrio"),jt?.logradouro||Kn.push("Informe o logradouro do destinatrio"),jt?.bairro||Kn.push("Informe o bairro do destinatrio"),jt?.cidade||Kn.push("Informe a cidade do destinatrio"),jt?.uf||Kn.push("Informe a UF do destinatrio"),jt?.cep||Kn.push("Informe o CEP do destinatrio"),jt?.codigo_municipio_ibge||Kn.push("Informe o cdigo IBGE do municpio do destinatrio"),Ms.length===14){const Xn=String(jt?.inscricao_estadual||"").trim();!jt?.ie_isento&&(!Xn||Xn.toUpperCase()==="ISENTO")&&Kn.push("Informe a IE do destinatrio ou marque ISENTO")}const bs=Array.isArray(jt?.itens)?jt.itens:[];bs.length||Kn.push("Adicione ao menos 1 item"),bs.forEach((Xn,pa)=>{const ps=String(Xn?.ncm||"").trim(),qs=Number((Xn?.quantidade||"").toString().replace(",",".")),Ji=String(Xn?.preco_unitario||"").trim(),kc=String(Xn?.cfop||"").trim(),Ml=(Xn?.impostos||{}).icms||{},ba=(Xn?.impostos||{}).pis||{},Qa=(Xn?.impostos||{}).cofins||{};(!ps||/^0+$/.test(ps))&&Kn.push(`Item ${pa+1}: NCM invlido`),kc||Kn.push(`Item ${pa+1}: CFOP obrigatrio`),(!qs||qs<=0)&&Kn.push(`Item ${pa+1}: quantidade invlida`),(Ji===""||Ji==null)&&Kn.push(`Item ${pa+1}: preo unitrio obrigatrio`),Ml.cst||Ml.csosn||Kn.push(`Item ${pa+1}: preencha ICMS (CST/CSOSN)`);const so=String(ba.cst||"").trim(),_i=String(Qa.cst||"").trim();so==="01"&&String(ba.aliquota||"").trim()===""&&Kn.push(`Item ${pa+1}: preencha alquota de PIS (CST 01)`),_i==="01"&&String(Qa.aliquota||"").trim()===""&&Kn.push(`Item ${pa+1}: preencha alquota de COFINS (CST 01)`)});try{Array.isArray(Ve?.Itens)&&(Array.isArray(Ve.Itens[0])?Ve.Itens[0]=Ve.Itens[0].map(Xn=>{const pa={...Xn},ps=Number(String(pa.aliquota_pis||"").replace(",","."))||0,qs=Number(String(pa.aliquota_cofins||"").replace(",","."))||0;return String(pa.pis_situacao_tributaria||"").trim()==="01"&&ps<=0&&(pa.pis_situacao_tributaria="07",pa.base_calculo_pis="",pa.aliquota_pis="",pa.valor_pis=""),String(pa.cofins_situacao_tributaria||"").trim()==="01"&&qs<=0&&(pa.cofins_situacao_tributaria="07",pa.base_calculo_cofins="",pa.aliquota_cofins="",pa.valor_cofins=""),pa}):Ve.Itens=Ve.Itens.map(Xn=>{const pa={...Xn},ps=Number(String(pa.aliquota_pis||"").replace(",","."))||0,qs=Number(String(pa.aliquota_cofins||"").replace(",","."))||0;return String(pa.pis_situacao_tributaria||"").trim()==="01"&&ps<=0&&(pa.pis_situacao_tributaria="07",pa.base_calculo_pis="",pa.aliquota_pis="",pa.valor_pis=""),String(pa.cofins_situacao_tributaria||"").trim()==="01"&&qs<=0&&(pa.cofins_situacao_tributaria="07",pa.base_calculo_cofins="",pa.aliquota_cofins="",pa.valor_cofins=""),pa}))}catch{}if(Kn.length){r({title:"Faltam dados para emitir NF-e",description:Kn.slice(0,6).join("  ")+(Kn.length>6?`  (+${Kn.length-6} itens)`:""),variant:"destructive"});return}}const Bt=K??Tt;if(Bt&&t)try{await Q.from("notas_fiscais").update({status:"processando"}).eq("id",Bt).eq("codigo_empresa",t)}catch{}r({title:"Enviando nota...",description:`Modelo ${Xe.modelo}`});try{Mt&&Array.isArray(Ve?.Itens)&&!Array.isArray(Ve.Itens[0])&&(Ve.Itens=[Ve.Itens]),console.log("[FiscalHub][emitirNota] payload final (antes do envio)",{Dados:Ve})}catch{}let Yt,Ur=null;try{Mt?Yt=await NV({baseUrl:Et,cnpj:Dt,dados:Ve}):Yt=await Wot({baseUrl:Et,cnpj:Dt,dados:Ve})}catch(Ta){Ur=Ta}try{console.log("[FiscalHub][emitirNota] resposta envio",{ok:!Ur,resp:Yt,envioErro:Ur})}catch{}if(!Ur&&Yt&&typeof Yt?.status=="string"&&/erro/i.test(Yt.status)){const Ta=Yt?.codigo||Yt?.Codigo||"",Kn=Yt?.campo||Yt?.Campo||"",ao=Yt?.descricao||Yt?.Descricao||Yt?.mensagem||Yt?.message||"Falha na emisso",Ms=[Kn,ao].filter(Boolean).join("  ");r({title:`Erro na emisso${Ta?` ${Ta}`:""}`,description:Ms,variant:"destructive"});const bs=K??Tt;if(bs&&t)try{await Q.from("notas_fiscais").update({status:"erro"}).eq("id",bs).eq("codigo_empresa",t),await ha()}catch{}return}if(Ur){if(!Mt){const Ta=Ur?.status?`HTTP ${Ur.status}`:"Erro de transporte",Kn=typeof Ur?.response=="string"&&Ur.response||Ur?.response?.message||Ur?.message||"Tentando consultar status";r({title:"Envio com erro",description:`${Ta}. ${Kn}`.trim(),variant:"warning"})}}else r({title:"Envio solicitado",description:"Consultando status..."});const jr=Yt?.chave_nota||Yt?.chave||Yt?.Chave||"";let mn=null;const en=Ta=>new Promise(Kn=>setTimeout(Kn,Ta));for(let Ta=0;Ta<5;Ta++){const Kn=jr?{chave_nota:jr,chave:jr}:{numero:jt?.nNF,serie:jt?.serie};try{Mt?mn=await rv({baseUrl:Et,cnpj:Dt,dados:Kn}):mn=await i_({baseUrl:Et,cnpj:Dt,dados:Kn})}catch{}const ao=String(mn?.status||mn?.cStat||""),Ms=mn?.xMotivo||mn?.mensagem||mn?.message||"";if(ao==="100"||/autorizad/i.test(Ms))break;await en(2e3)}let Yr=mn?.url_xml||mn?.xml_url||Yt?.url_xml||null,gn=mn?.url_pdf||mn?.pdf_url||Yt?.url_pdf||null,Yn=jr||mn?.chave_nota||mn?.chave||mn?.Chave||"";if(!gn||!Yr){const Ta=Yn?{chave_nota:Yn,chave:Yn}:{numero:jt?.nNF,serie:jt?.serie};try{if(Mt){const Kn=await nv({baseUrl:Et,cnpj:Dt,dados:Ta});gn=gn||Kn?.url_pdf||Kn?.pdf_url||null,Yn=Yn||Kn?.chave||Kn?.Chave||""}else{const Kn=await l_({baseUrl:Et,cnpj:Dt,dados:Ta});gn=gn||Kn?.url_pdf||Kn?.pdf_url||null,Yn=Yn||Kn?.chave||Kn?.Chave||""}}catch{}try{if(Mt){const Kn=await av({baseUrl:Et,cnpj:Dt,dados:Ta});Yr=Yr||Kn?.url_xml||Kn?.xml_url||null,Yn=Yn||Kn?.chave||Kn?.Chave||""}else{const Kn=await c_({baseUrl:Et,cnpj:Dt,dados:Ta});Yr=Yr||Kn?.url_xml||Kn?.xml_url||null,Yn=Yn||Kn?.chave||Kn?.Chave||""}}catch{}}const Hn=String(mn?.status||mn?.cStat||""),ns=mn?.xMotivo||mn?.mensagem||mn?.message||"Status retornado",Do=Hn==="100"||/autorizad/i.test(ns);if(r(Do?{title:"Autorizada",description:ns,variant:"success"}:Hn?{title:`Status: ${Hn}`,description:ns,variant:"warning"}:{title:"Consulta retornada",description:ns}),Bt&&t)try{const Ta=Do||gn||Yr?"autorizada":/rejeit/i.test(ns)?"rejeitada":Ur?"processando":"pendente";await Q.from("notas_fiscais").update({status:Ta,xml_chave:Yn||jr||null,xml_url:Yr||null,pdf_url:gn||null,numero:Xe?.nNF?Number(Xe.nNF):null,serie:Xe?.serie?Number(Xe.serie):null,ambiente:tl(Pe||{}).ambiente||null}).eq("id",Bt).eq("codigo_empresa",t),await ha()}catch{}}catch(he){r({title:"Falha na emisso",description:he?.message||String(he),variant:"destructive"})}},Ar=async D=>{try{const K=D||Dl;if(!K){r({title:"Selecione uma comanda para importar",variant:"warning"});return}const he=await ii({comandaId:K,codigoEmpresa:t});if(!he||!he.length){r({title:"Nenhum item encontrado nesta comanda",variant:"warning"});return}console.log("[FiscalHub][NF-e manual] Itens da comanda para importao:",{comandaId:K,itens:he});const Xe=Array.from(new Set((he||[]).map(Mt=>Mt.produto_id).filter(Boolean)));let Ue=[];if(Xe.length)try{let Mt=Q.from("produtos").select("id, nome, codigo_produto, unidade, ncm, cest, cfop_interno, cfop_externo, cst_icms_interno, csosn_interno, aliquota_icms_interno, cst_pis_saida, aliquota_pis_percent, aliquota_cofins_percent, cst_ipi, aliquota_ipi_percent").in("id",Xe);t&&(Mt=Mt.eq("codigo_empresa",t));const{data:jt}=await Mt;Ue=jt||[]}catch{Ue=[]}console.log("[FiscalHub][NF-e manual] Produtos carregados para os itens da comanda:",{prodIds:Xe,prods:Ue});const Et=new Map((Ue||[]).map(Mt=>[Mt.id,Mt])),Dt=(he||[]).map(Mt=>{const jt=Et.get(Mt.produto_id)||null,Ve=jt?.cfop_interno||jt?.cfop_externo||Xr(Ae.uf),Bt=(jt?.unidade||"UN").toString().toUpperCase(),Yt=Number(Mt.preco_unitario||0)||0,Ur=jt?.aliquota_pis_percent,jr=jt?.aliquota_cofins_percent,mn=jt?.cst_pis_saida||((Ur??null)!=null?"01":""),en=(jr??null)!=null?"01":"",Yr=Number(Mt.quantidade||1)||1,gn=Yt*Yr,Yn=gn>0?gn.toFixed(2):"",Hn=ao=>{const Ms=Number(ao??0);return!Ms||!gn?"":(gn*(Ms/100)).toFixed(2)},ns=Hn(jt?.aliquota_icms_interno),Do=Hn(Ur),Ta=Hn(jr),Kn=Hn(jt?.aliquota_ipi_percent);return{descricao:Mt.descricao||jt?.nome||"Item",codigo:jt?.codigo_produto||"",ncm:jt?.ncm||"",cest:jt?.cest||"",cfop:Ve||"5102",unidade:Bt,quantidade:String(Yr),preco_unitario:Yt.toFixed(2),desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",obs:"",impostos:{origem:"",icms:{cst:jt?.cst_icms_interno||"",csosn:jt?.csosn_interno||"",base:Yn,aliquota:jt?.aliquota_icms_interno!=null?String(jt.aliquota_icms_interno):"",valor:ns},icmsst:{base:"",aliquota:"",valor:""},pis:{cst:mn,aliquota:Ur!=null?String(Ur):"",valor:Do},cofins:{cst:en,aliquota:jr!=null?String(jr):"",valor:Ta},ipi:{cst:jt?.cst_ipi||"",aliquota:jt?.aliquota_ipi_percent!=null?String(jt.aliquota_ipi_percent):"",valor:Kn},iss:{aliquota:"",valor:""}}}});if(console.log("[FiscalHub][NF-e manual] Itens mapeados para o construtor manual:",Dt),!Dt.length){r({title:"Nenhum item encontrado nesta comanda",variant:"warning"});return}et(Mt=>({...Mt,itens:Dt})),gl(!1),r({title:"Itens importados"})}catch(K){r({title:"Falha ao importar itens",description:K?.message||"Tente novamente",variant:"destructive"})}},Cr=async D=>{if(console.log("[FiscalHub][NF-e manual] openManualFromComanda called with id:",D),!D){r({title:"Selecione uma comanda",variant:"warning"});return}const K=(s||[]).find(he=>he.id===D);console.log("[FiscalHub][NF-e manual] Comanda selecionada para NF-e:",K),ln("cliente"),Tn(!0),et(()=>{const he=new Date,Xe=`${he.getFullYear()}-${b(he.getMonth()+1)}-${b(he.getDate())}`,Ue=Number(K?.total||0)||0,Et=(K?.finalizadorasStr||"").trim(),Dt=(Hs||[]).find(Mt=>{const jt=(Mt?.nome||"").trim().toLowerCase(),Ve=Et.toLowerCase();return!jt||!Ve?!1:Ve===jt||Ve.startsWith(jt)||jt.startsWith(Ve)});return{natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:Xe,data_saida:Xe,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{finalizadora_id:Dt?.id||"",tipo:Dt?.nome||K?.finalizadorasStr||"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:hr(Ue.toFixed(2)),parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}});try{const he=(K?.clientesStr||"").split(",")[0].trim();if(he&&t){const{data:Xe}=await Q.from("clientes").select("*").eq("codigo_empresa",t).ilike("nome",he).limit(1).single();Xe&&(console.log("[FiscalHub][NF-e manual] Cliente principal encontrado para pr-preenchimento do destinatrio:",Xe),dn(Xe))}}catch(he){console.warn("[FiscalHub][NF-e manual] Falha ao pr-preencher destinatrio a partir da comanda:",he)}ku(String(D)),console.log("[FiscalHub][NF-e manual] Preparando importao de itens da comanda para NF-e, comandaId=",String(D));try{await Ar(String(D))}catch(he){console.error("[FiscalHub][NF-e manual] Erro ao importar itens da comanda para NF-e:",he)}},Lt=Array.isArray(DV)?DV:[];p.useEffect(()=>{let D=!1;async function K(){if(t)try{const{data:he}=await Q.from("empresas").select("uf").eq("codigo_empresa",t).single();D||$e(he?.uf||"")}catch{}}return K(),()=>{D=!0}},[t]),p.useEffect(()=>{let D=!1;async function K(){if(t)try{const{data:he}=await Q.from("empresas").select("razao_social, nome_fantasia, cnpj, inscricao_estadual, regime_tributario, endereco, logradouro, numero, bairro, cidade, uf, cep, codigo_municipio_ibge, nfe_serie, nfce_serie, ambiente, transmitenota_apikey, transmitenota_base_url, transmitenota_apikey_hml, transmitenota_base_url_hml, transmitenota_apikey_prod, transmitenota_base_url_prod").eq("codigo_empresa",t).single();D||Vt(he||null)}catch{D||Vt(null)}}return K(),()=>{D=!0}},[t]),p.useEffect(()=>{Pe&&et(D=>{const K=D.modelo==="65"?Pe.nfce_serie||D.serie:Pe.nfe_serie||D.serie,he=String(K||D.serie||"1");return String(D.serie||"")===he?D:{...D,serie:he}})},[Pe,Ae.modelo]),p.useEffect(()=>{let D=!0;async function K(){if(!(!nn||!t))try{const he=await mf({includeInactive:!1,codigoEmpresa:t});D&&tr(he||[])}catch{D&&tr([])}}return K(),()=>{D=!1}},[nn,t]);const vn=p.useMemo(()=>{const D=(dr||"").trim().toLowerCase(),K=(yt||[]).slice().sort((he,Xe)=>{const Ue=Number(String(he.code||0).replace(/\D/g,""))||0,Et=Number(String(Xe.code||0).replace(/\D/g,""))||0;return Ue-Et});return D?K.filter(he=>(he.name||"").toLowerCase().includes(D)||(he.code||"").toLowerCase().includes(D)).slice(0,100):K.slice(0,100)},[yt,dr]),Xr=(D,K=Ae.tipo_nota)=>{const he=String(xe||"").toUpperCase(),Xe=String(D||"").toUpperCase(),Et=!!he&&!!Xe?Xe===he:!0;return K!=="entrada"?Et?"5102":"6102":Et?"1102":"2102"},Or=D=>{const he=(Lt.find(Xe=>Xe.code===D)?.desc||"").toLowerCase();return Ae.tipo_nota==="entrada"&&(he.includes("compra")||he.includes("entrada"))?"COMPRA":he.includes("venda")?"VENDA":he.includes("devolu")?"DEVOLUCAO":he.includes("transfer")?"TRANSFERENCIA":he.includes("bonifica")?"BONIFICACAO":he.includes("remessa")?"REMESSA":he.includes("demonstra")?"DEMONSTRACAO":Ae.natOp||"VENDA"},_n=(D,K)=>{et(he=>{const Xe=[...he.itens],Ue=K?.cfopInterno||K?.cfopExterno||Xr(he.uf),Et=Number(K?.price??K?.salePrice??0)||0,Dt=String(he.uf||"").toUpperCase()===String(xe||"").toUpperCase(),Mt=Dt?K?.cstIcmsInterno||"":K?.cstIcmsExterno||"",jt=Dt?K?.csosnInterno||"":K?.csosnExterno||"",Ve=Dt?K?.aliqIcmsInterno??null:K?.aliqIcmsExterno??null,Bt=K?.cstPisSaida||((K?.aliqPisPercent??null)!=null?"01":""),Yt=K?.aliqPisPercent??null,Ur=(K?.aliqCofinsPercent??null)!=null?"01":"",jr=K?.aliqCofinsPercent??null,mn=K?.cstIpi||"",en=K?.aliqIpiPercent??null;Xe[D]={...Xe[D],descricao:K?.name||Xe[D].descricao,codigo:K?.code||Xe[D].codigo,cod_barras:K?.barcode||K?.ean||K?.gtin||K?.bar_code||Xe[D].cod_barras,unidade:(K?.unit||"UN").toString().toUpperCase(),ncm:K?.ncm||Xe[D].ncm,cest:K?.cest||Xe[D].cest,cfop:Ue||Xe[D].cfop,preco_unitario:Et?Et.toFixed(2):Xe[D].preco_unitario,impostos:{...Xe[D].impostos||{},icms:{...Xe[D].impostos?.icms||{},cst:Mt||Xe[D].impostos?.icms?.cst||"",csosn:jt||Xe[D].impostos?.icms?.csosn||"",aliquota:Ve!=null?String(Ve):Xe[D].impostos?.icms?.aliquota||""},pis:{...Xe[D].impostos?.pis||{},cst:Bt||Xe[D].impostos?.pis?.cst||"",aliquota:Yt!=null?String(Yt):Xe[D].impostos?.pis?.aliquota||""},cofins:{...Xe[D].impostos?.cofins||{},cst:Ur||Xe[D].impostos?.cofins?.cst||"",aliquota:jr!=null?String(jr):Xe[D].impostos?.cofins?.aliquota||""},ipi:{...Xe[D].impostos?.ipi||{},cst:mn||Xe[D].impostos?.ipi?.cst||"",aliquota:en!=null?String(en):Xe[D].impostos?.ipi?.aliquota||""}}};const Yr=Or(Ue||Xe[D].cfop);return{...he,itens:Xe,natOp:Yr}}),da(null)};p.useEffect(()=>{let D=!0;async function K(){if(!(!wi&&!nn||!t))try{const[he,Xe]=await Promise.all([ew({searchTerm:null,limit:200,codigoEmpresa:t}),Cst(t)]),Ue=[...he||[],...Xe||[]];D&&pl(Ue)}catch{D&&pl([])}}return K(),()=>{D=!1}},[wi,nn,t]),p.useEffect(()=>{wi&&ec("")},[wi]);const fr=p.useMemo(()=>{const D=(ji||"").trim().toLowerCase(),K=(rd||[]).slice().sort((he,Xe)=>{const Ue=Number(String(he.codigo||he.codigo_cliente||he.codigo_fornecedor||he.code||0).replace(/\D/g,""))||0,Et=Number(String(Xe.codigo||Xe.codigo_cliente||Xe.codigo_fornecedor||Xe.code||0).replace(/\D/g,""))||0;return Ue-Et});return D?K.filter(he=>{const Xe=String(he.codigo||he.codigo_cliente||he.codigo_fornecedor||he.code||"").toLowerCase(),Ue=String(he.nome||he.razao_social||he.apelido||"").toLowerCase(),Et=String(he.cnpj||he.cpf||"").toLowerCase();return Xe.includes(D)||Ue.includes(D)||Et.includes(D)}):K},[rd,ji]),dn=D=>{if(!D)return;const K=(D.tipo_pessoa||"PJ")==="PJ"||!!D.cnpj;et(he=>({...he,parte_tipo:D.is_fornecedor?"fornecedor":"cliente",party_id:D.id||"",party_codigo:String(D.codigo||D.codigo_cliente||D.codigo_fornecedor||D.code||""),tipo_pessoa:K?"PJ":"PF",cpf_cnpj:(D.cnpj||D.cpf||"").toString(),nome:D.nome||D.razao_social||D.apelido||"",email:D.email||"",telefone:D.telefone||"",logradouro:D.endereco||D.logradouro||"",numero:D.numero||"",bairro:D.bairro||"",cidade:D.cidade||"",uf:D.uf||"",cep:D.cep||"",codigo_municipio_ibge:D.cidade_ibge||D.codigo_municipio_ibge||"",inscricao_estadual:D.ie||D.inscricao_estadual||"",ie_isento:D.ie==="ISENTO"||!1})),zo(!1)};p.useEffect(()=>{let D=!0;async function K(){if(!(!nn||Kr!=="pagamentos"))try{const he=await $h({somenteAtivas:!0,codigoEmpresa:t});D&&tc(Array.isArray(he)?he:[])}catch{D&&tc([])}}return K(),()=>{D=!1}},[nn,Kr,t]);const Dr=async D=>{const K=Se(D);if(K.length===8)try{ct(!0);let he=null;try{const Xe=await fetch(`https://brasilapi.com.br/api/cep/v2/${K}`);Xe.ok&&(he=await Xe.json())}catch{}if(!he)try{const Xe=await fetch(`https://viacep.com.br/ws/${K}/json/`);Xe.ok&&(he=await Xe.json())}catch{}if(he){const Xe=he.street||he.logradouro||"",Ue=he.neighborhood||he.bairro||"",Et=he.city||he.localidade||"",Dt=(he.state||he.uf||"").toString().toUpperCase().slice(0,2),Mt=he.city_ibge_code||he.ibge||"";et(jt=>({...jt,logradouro:Xe||jt.logradouro,bairro:Ue||jt.bairro,cidade:Et||jt.cidade,uf:Dt||jt.uf,codigo_municipio_ibge:Mt||jt.codigo_municipio_ibge}))}}finally{ct(!1)}},wr=()=>{try{const D=localStorage.getItem("auth:userProfile");return D&&JSON.parse(D)?.codigo_empresa||null}catch{return null}},Jr=()=>{let D=null,K=null;if(S&&(D=new Date(S+"T00:00:00").toISOString()),M){const he=new Date(M+"T00:00:00");he.setDate(he.getDate()+1),K=he.toISOString()}return{fromISO:D,toISOExclusive:K}},Mn=async()=>{if(t){l(!0);try{let D=Q.from("comandas").select("*").eq("codigo_empresa",t).not("fechado_em","is",null).neq("status","cancelled").order("aberto_em",{ascending:!1}).limit(300);const{fromISO:K,toISOExclusive:he}=Jr();K&&(D=D.gte("aberto_em",K)),he&&(D=D.lt("aberto_em",he));const{data:Xe,error:Ue}=await D;if(Ue)throw Ue;const Et=Xe||[],Dt=Et.map(jr=>jr.id);let Mt={};if(Dt.length)try{Mt=await JS(Dt,t)}catch{Mt={}}let jt=[];try{jt=await Bh(t)}catch{jt=[]}const Ve=new Map((jt||[]).map(jr=>[jr.id,jr.numero]));let Bt={},Yt={};try{Bt=await c3(Dt)}catch{Bt={}}try{Yt=await d3(Dt)}catch{Yt={}}const Ur=Et.map(jr=>{const mn=Number(Mt[jr.id]||0),en=jr?.desconto_tipo,Yr=Number(jr?.desconto_valor||0);let gn=0;en==="percentual"&&Yr>0?gn=mn*(Yr/100):en==="fixo"&&Yr>0&&(gn=Yr);const Yn=Math.max(0,mn-gn);return{...jr,total_sem_desconto:mn,total:Yn,mesaNumero:Ve.get(jr.mesa_id),clientesStr:Array.isArray(Bt[jr.id])?Bt[jr.id].join(", "):Bt[jr.id]||"",finalizadorasStr:Array.isArray(Yt[jr.id])?Yt[jr.id].join(", "):Yt[jr.id]||""}});o(Ur)}catch(D){r({title:"Erro ao carregar",description:D.message,variant:"destructive"})}finally{l(!1)}}};p.useEffect(()=>{Mn()},[t,S,M]);const ha=async()=>{if(t){f(!0);try{let D=Q.from("notas_fiscais").select("*").eq("codigo_empresa",t).eq("modelo","55").order("id",{ascending:!1});const{data:K,error:he}=await D;if(he)throw he;d(K||[])}catch(D){r({title:"Erro ao carregar NF-e",description:D.message,variant:"destructive"})}finally{f(!1)}}};p.useEffect(()=>{ha()},[t]),p.useEffect(()=>{let D=!1;async function K(){if(t)try{const{data:he}=await Q.from("empresas").select("cnpj, inscricao_estadual, regime_tributario, cidade, uf, codigo_municipio_ibge, nfce_serie, nfce_itoken, ambiente, transmitenota_apikey, transmitenota_base_url, transmitenota_apikey_hml, transmitenota_base_url_hml, transmitenota_apikey_prod, transmitenota_base_url_prod").eq("codigo_empresa",t).single();if(D)return;const Xe=[],Ue=Dt=>String(Dt||"").replace(/\D/g,"");(!Ue(he?.cnpj)||Ue(he?.cnpj).length!==14)&&Xe.push("CNPJ"),he?.inscricao_estadual||Xe.push("Inscrio Estadual"),he?.regime_tributario||Xe.push("CRT"),(!he?.cidade||!he?.uf)&&Xe.push("Cidade/UF"),he?.codigo_municipio_ibge||Xe.push("cMun IBGE"),he?.nfce_serie||Xe.push("Srie NFC-e"),String(he?.ambiente||"homologacao")==="producao"&&!he?.nfce_itoken&&Xe.push("CSC/IToken"),Le(Xe)}catch{}}return K(),()=>{D=!0}},[t]),p.useEffect(()=>{if(!t)return;const D=setInterval(()=>{Mn()},2e4);return()=>clearInterval(D)},[t,S,M]);const is=p.useMemo(()=>{const D=(x||"").trim().toLowerCase(),K=he=>{const Xe=he.nf_status||"pendente";return I?Xe==="pendente"||Xe==="rejeitada":v==="all"?!0:Xe===v};return(s||[]).filter(he=>K(he)).filter(he=>{if(!D)return!0;const Xe=String(he.mesaNumero||""),Ue=String(he.clientesStr||""),Et=String(he.finalizadorasStr||"");return(he.xml_chave||"").toLowerCase().includes(D)||String(he.nf_numero||"").includes(D)||Xe.toLowerCase().includes(D)||Ue.toLowerCase().includes(D)||Et.toLowerCase().includes(D)})},[s,x,v,I]),Gs=p.useMemo(()=>{const D=(x||"").trim().toLowerCase();return(c||[]).filter(K=>{const he=(K.status||"pendente").toLowerCase();if(I&&!["pendente","rejeitada","rascunho"].includes(he))return!1;if(v!=="all"){if(v==="pendente"){if(!["pendente","rascunho"].includes(he))return!1}else if(v==="processando"){if(he!=="processando")return!1}else if(v==="autorizada"){if(!["autorizada","emitida"].includes(he))return!1}else if(v==="rejeitada"){if(he!=="rejeitada")return!1}else if(v==="cancelada"&&he!=="cancelada")return!1}if(S||M){const jt=K.data_emissao||K.criado_em||K.created_at||null;if(jt){const Ve=new Date(jt);if(S){const Bt=new Date(S+"T00:00:00");if(Ve<Bt)return!1}if(M){const Bt=new Date(M+"T23:59:59.999");if(Ve>Bt)return!1}}}if(!D)return!0;const Xe=String(K.numero??"").toLowerCase(),Ue=String(K.serie??"").toLowerCase(),Et=String(K.destinatario?.nome||"").toLowerCase(),Mt=(K.origem==="comanda"?`comanda ${K.comanda_id??""}`:"manual").toLowerCase();return Xe.includes(D)||Ue.includes(D)||Et.includes(D)||Mt.includes(D)})},[c,x,v,I,S,M]),jn=p.useMemo(()=>{const D=[...is||[]],K=U==="asc"?1:-1;return D.sort((he,Xe)=>{const Ue=Dt=>Dt==null?"":String(Dt).toLowerCase(),Et=Dt=>Dt==null?0:Number(Dt)||0;return ue==="aberto_em"?(new Date(he.aberto_em).getTime()-new Date(Xe.aberto_em).getTime())*K:ue==="nf_status"?Ue(he.nf_status).localeCompare(Ue(Xe.nf_status))*K:ue==="mesa"?(Et(he.mesaNumero)-Et(Xe.mesaNumero))*K:ue==="nf_numero"?(Et(he.nf_numero)-Et(Xe.nf_numero))*K:ue==="total"?(Number(he.total||he.total_com_desconto||0)-Number(Xe.total||Xe.total_com_desconto||0))*K:0})},[is,ue,U]),Nr=p.useMemo(()=>[...Gs||[]].sort((K,he)=>{const Xe=K.data_emissao||K.criado_em||K.created_at||null,Ue=he.data_emissao||he.criado_em||he.created_at||null,Et=Xe?new Date(Xe).getTime():0;return(Ue?new Date(Ue).getTime():0)-Et}),[Gs]),an=Math.max(1,Math.ceil((jn||[]).length/X));p.useEffect(()=>{G>an&&de(an)},[an]);const Nn=p.useMemo(()=>{const D=(G-1)*X;return(jn||[]).slice(D,D+X)},[jn,G,X]),Sn=p.useMemo(()=>{const D=(G-1)*X;return(Nr||[]).slice(D,D+X)},[Nr,G,X]),hn=Math.max(1,Math.ceil((Nr||[]).length/X)),Pr=p.useMemo(()=>!Nn||Nn.length===0?!1:Nn.every(D=>Y.includes(D.id)),[Nn,Y]),pn=D=>{me(K=>{if(D){const Xe=(Nn||[]).map(Ue=>Ue.id);return Array.from(new Set([...K||[],...Xe]))}const he=new Set((Nn||[]).map(Xe=>Xe.id));return(K||[]).filter(Xe=>!he.has(Xe))})},vr=D=>{$(D),Nt(K=>K.includes(D)?K.filter(he=>he!==D):[...K,D])},kr=p.useMemo(()=>(s||[]).filter(D=>Y.includes(D.id)),[s,Y]),Vr=p.useMemo(()=>kr.filter(D=>["pendente","rejeitada"].includes(String(D.nf_status||"pendente").toLowerCase())).map(D=>D.id),[kr]),Ir=p.useMemo(()=>kr.filter(D=>["processando","rejeitada","pendente","erro"].includes(String(D.nf_status||"").toLowerCase())).map(D=>D.id),[kr]),re=p.useMemo(()=>kr.filter(D=>String(D.nf_status||"").toLowerCase()==="autorizada").map(D=>D.id),[kr]),we=Y.length>0,Ge=we&&Vr.length===kr.length,ge=we&&Ir.length===kr.length,nt=we&&re.length===kr.length,st=p.useMemo(()=>{const D=k||Y&&Y[0];return D&&(s||[]).find(K=>K.id===D)||null},[s,k,Y]),je=!!st&&["autorizada","cancelada"].includes(String(st.nf_status||"").toLowerCase()),ht=p.useMemo(()=>(c||[]).filter(D=>Y.includes(D.id)),[c,Y]),rt=p.useMemo(()=>ht.filter(D=>{const K=String(D.status||"rascunho").toLowerCase();return["rascunho","pendente","rejeitada"].includes(K)}).map(D=>D.id),[ht]),nr=p.useMemo(()=>ht.filter(D=>String(D.status||"rascunho").toLowerCase()!=="rascunho").map(D=>D.id),[ht]),yn=p.useMemo(()=>ht.filter(D=>{const K=String(D.status||"rascunho").toLowerCase();return["autorizada","emitida"].includes(K)}).map(D=>D.id),[ht]),fn=ht.length>0,Ln=fn&&rt.length===ht.length,On=fn&&nr.length===ht.length,ma=fn&&yn.length===ht.length,Ja=p.useMemo(()=>{const D=k||Y&&Y[0];return D&&(c||[]).find(K=>K.id===D)||null},[c,k,Y]),Bs=!!Ja&&["autorizada","emitida","cancelada"].includes(String(Ja.status||"").toLowerCase()),na=async()=>{if(!Vr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}const D=Y.length-Vr.length,K=`Emitindo ${Vr.length} NFC-e elegveis${D>0?` (ignorando ${D} no elegveis)`:""}...`;r({title:"Emisso de NFC-e",description:K});for(const he of Vr)await Js(he)},ia=async()=>{if(!Ir.length){r({title:"Nenhum elegvel",description:"Selecione notas para consultar.",variant:"destructive"});return}const D=Y.length-Ir.length,K=`Consultando ${Ir.length} NFC-e${D>0?` (ignorando ${D})`:""}...`;r({title:"Consulta de NFC-e",description:K});for(const he of Ir)await yo(he)},ja=async()=>{if(!re.length){r({title:"Nenhum elegvel",description:"Selecione NFC-e autorizadas para cancelar.",variant:"destructive"});return}const D=re[0];Yi(D),R("")},$a=(D="filtered")=>{const K=";",he=Ve=>{let Bt=String(Ve??"");return Bt=Bt.replaceAll('"','""'),Bt=Bt.replaceAll(";","|"),`"${Bt}"`},Ue=[["Comanda","Mesa","Clientes","Finalizadoras","StatusNF","Numero","Serie","Chave","AutorizadoEm","CanceladoEm","Total"].join(K)];let Et=[];if(D==="selected"){const Ve=new Set(Y);k&&Ve.add(k),Et=(s||[]).filter(Bt=>Ve.has(Bt.id))}else Et=is||[];Et.forEach(Ve=>{const Yt=[Ve.mesaNumero?`Mesa ${Ve.mesaNumero}`:"Balco",Ve.mesaNumero??"",Ve.clientesStr||"",Ve.finalizadorasStr||"",Ve.nf_status??"",Ve.nf_numero??"",Ve.nf_serie??"",Ve.xml_chave??"",Ve.nf_autorizado_em??"",Ve.nf_cancelado_em??"",String(Ve.total??"")];Ue.push(Yt.map(he).join(K))});const Dt=new Blob(["\uFEFF"+Ue.join(`\r
`)],{type:"text/csv;charset=utf-8;"}),Mt=URL.createObjectURL(Dt),jt=document.createElement("a");jt.href=Mt,jt.download=`central-fiscal-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(jt),jt.click(),document.body.removeChild(jt),URL.revokeObjectURL(Mt)},js=D=>{const K=(D||"pendente").toLowerCase(),he={rascunho:"bg-surface-2 text-text-secondary border border-border/60",pendente:"bg-amber-500/15 text-amber-400 border border-amber-400/30",processando:"bg-blue-500/15 text-blue-400 border border-blue-400/30",autorizada:"bg-emerald-500/15 text-emerald-400 border border-emerald-400/30",rejeitada:"bg-red-500/15 text-red-400 border border-red-400/30",cancelada:"bg-red-500/15 text-red-400 border border-red-400/30"};return he[K]||he.pendente},no=async D=>{try{wt(!0),xr(D);const K=t||wr(),{empresa:he,payload:Xe,missing:Ue}=await dg({comandaId:D,codigoEmpresa:K});Rr(Xe),tt(Ue||[]);try{const Et=tl(he||{}),Dt=!!Et&&(Et.cnpj||"").length===14&&!!Et.apiKey&&!!Et.baseUrl;qr(Dt),sn(Dt&&(!Ue||Ue.length===0))}catch{qr(!1),sn(!1)}ze(Et=>({...Et,[D]:(Ue||[]).length})),$t(!0)}catch(K){r({title:"Falha ao gerar prvia",description:K.message,variant:"destructive"})}finally{wt(!1)}},Ia=async(D,K)=>{await Q.from("comandas").update(K).eq("id",D).eq("codigo_empresa",t)},Ra=async()=>{if(ne)try{Qt(!0);const D=Number(Gt.serie||1)||1;let K=null;try{try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ne,status:"start",mensagem:`serie=${D}`})}catch{}const{data:Ue,error:Et}=await Q.rpc("reservar_numero_fiscal",{p_modelo:"55",p_serie:D,p_codigo_empresa:t});if(Et)throw Et;K=Number(Ue);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ne,status:"success",mensagem:`numero=${K}`})}catch{}}catch(Ue){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ne,status:"error",mensagem:Ue?.message||String(Ue)})}catch{}r({title:"Falha ao reservar numerao NF-e",description:Ue?.message||String(Ue),variant:"destructive"}),Qt(!1);return}Ht(Ue=>({...Ue,nNF:String(K),serie:String(D)}));const he={...Gt,nNF:String(K),serie:String(D),idDest:Gt.idDest==="auto"||!Gt.idDest?void 0:Gt.idDest};try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ne,status:"start",request:he})}catch{}const Xe=await tlt({comandaId:ne,codigoEmpresa:t,modelo:"55",overrides:he});zt(Xe);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ne,status:"success"})}catch{}r({title:"XML NF-e gerado"})}catch(D){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ne,status:"error",mensagem:D?.message||String(D)})}catch{}r({title:"Falha ao gerar XML",description:D.message,variant:"destructive"})}finally{Qt(!1)}},fs=async()=>{if(!(!bt||!ne))try{cr(!0);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ne,status:"start"})}catch{}const D=`nfe/${t}/${ne}-${Date.now()}.xml`,K=new Blob([bt],{type:"text/xml;charset=utf-8"}),{error:he}=await Q.storage.from("fiscal").upload(D,K,{contentType:"text/xml"});if(he)throw he;const{data:Xe}=await Q.storage.from("fiscal").getPublicUrl(D),Ue=Xe?.publicUrl||null;await Q.from("comandas").update({nf_xml_url:Ue||D,nf_status:"pendente"}).eq("id",ne).eq("codigo_empresa",t);try{const Et=s.find(jt=>jt.id===ne),Dt=Number(Et?.total||0),{ambiente:Mt}=tl(Pe||{});await Q.from("notas_fiscais").insert({codigo_empresa:t,origem:"comanda",comanda_id:ne,modelo:"55",numero:Gt.nNF?Number(Gt.nNF):null,serie:Gt.serie?Number(Gt.serie):null,status:"pendente",xml_url:Ue||D,pdf_url:null,valor_total:isFinite(Dt)?Dt:null,destinatario:null,ambiente:Mt||"homologacao"})}catch{}try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ne,status:"success"})}catch{}r({title:"XML salvo",description:Ue?"Link pblico gerado.":"Arquivo salvo no Storage."}),await Mn()}catch(D){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ne,status:"error",mensagem:D?.message||String(D)})}catch{}r({title:"Falha ao salvar XML",description:D.message,variant:"destructive"})}finally{cr(!1)}},Js=async D=>{try{l(!0);const{empresa:K,payload:he,missing:Xe}=await dg({comandaId:D,codigoEmpresa:t});if(Xe&&Xe.length){r({title:"Pendncias para emisso",description:Xe.join(", "),variant:"destructive"});return}try{const Yr=s.find(Do=>Do.id===D),gn=Yr&&(Yr.nf_status==="erro"||Yr.nf_status==="rejeitada"),Yn=!Yr?.xml_chave,Hn=!Yr?.nf_numero,ns=!Yr?.nf_serie;Yr&&gn&&Yn&&Hn&&ns&&await Ia(D,{nf_status:null,nf_modelo:null,nf_serie:null,nf_numero:null,nf_protocolo:null,xml_chave:null,nf_xml_url:null,nf_pdf_url:null,xml_protocolo:null})}catch{}try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"start",request:he?.Dados||null})}catch{}const Ue=tl(K);if(!Ue.cnpj||Ue.cnpj.length!==14){r({title:"CNPJ invlido",description:"CNPJ da empresa est ausente ou invlido (14 dgitos).",variant:"destructive"});return}const Et=Number(K?.nfce_serie||K?.nfe_serie||1)||1;let Dt=null;try{const{data:Yr,error:gn}=await Q.rpc("reservar_numero_fiscal",{p_modelo:"65",p_serie:Et,p_codigo_empresa:t});if(gn)throw gn;Dt=Number(Yr)}catch(Yr){r({title:"Falha ao reservar numerao",description:Yr?.message||String(Yr),variant:"destructive"});return}await Ia(D,{nf_numero:Dt,nf_serie:Et});try{he&&he.Dados&&(he.Dados.Numero=Dt,he.Dados.Serie=Et)}catch{}await Ia(D,{nf_status:"processando"});let Mt;try{Mt=await NV({baseUrl:Ue.baseUrl,cnpj:Ue.cnpj,dados:he.Dados}),console.log("[FiscalHub][NFC-e emitir] resposta completa:",Mt)}catch(Yr){console.error("[FiscalHub][NFC-e emitir] erro ao enviar NFC-e:",Yr),await Ia(D,{nf_status:"processando"});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"error",mensagem:Yr?.message||String(Yr)})}catch{}try{const gn=s.find(Xn=>Xn.id===D)||{};let Yn=gn.xml_protocolo||null,Hn=null;if(Yn)Hn=await rv({baseUrl:Ue.baseUrl,cnpj:Ue.cnpj,dados:{searchkey:Yn,SearchKey:Yn}});else{const Xn=gn.nf_numero||Dt,pa=gn.nf_serie||Et,ps=Xn&&pa?{numero:Xn,Numero:Xn,serie:pa,Serie:pa}:gn.xml_chave?{chave:gn.xml_chave,Chave:gn.xml_chave}:{};Hn=await rv({baseUrl:Ue.baseUrl,cnpj:Ue.cnpj,dados:ps});const qs=Hn?.searchkey||Hn?.SearchKey||Hn?.searchKey||null;qs&&(Yn=qs,await Ia(D,{xml_protocolo:qs}))}const ns=String(Hn?.status||Hn?.Status||Hn?.cStat||"").toLowerCase();if(!!(Hn?.autorizada||Hn?.Autorizada||Hn?.sucesso||Hn?.Sucesso||ns==="100")){const Xn=Hn?.chave||Hn?.Chave||gn.xml_chave||null,pa=Hn?.pdf_url||Hn?.PdfUrl||null,ps=Hn?.xml_url||Hn?.XmlUrl||null,qs=Hn?.numero||Hn?.Numero||gn.nf_numero||null,Ji=Hn?.serie||Hn?.Serie||gn.nf_serie||null;await Ia(D,{nf_status:"autorizada",xml_chave:Xn,nf_pdf_url:pa,nf_xml_url:ps,nf_numero:qs,nf_serie:Ji});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"success",response:Hn||null})}catch{}r({title:"NFC-e autorizada",description:"Documento autorizado aps fallback de consulta.",variant:"success"}),await Mn();return}const Ta=gn.nf_numero||Dt,Kn=gn.nf_serie||Et;let ao=null,Ms=null,bs=gn.xml_chave||null;if(Yn){try{const Xn=await nv({baseUrl:Ue.baseUrl,cnpj:Ue.cnpj,dados:{searchkey:Yn,SearchKey:Yn}});console.log("[FiscalHub][NFC-e emitir->PDF fallback] resp:",Xn),ao=Xn?.pdf_url||Xn?.PdfUrl||null,bs=Xn?.chave||Xn?.Chave||bs}catch{}try{const Xn=await av({baseUrl:Ue.baseUrl,cnpj:Ue.cnpj,dados:{searchkey:Yn,SearchKey:Yn}});console.log("[FiscalHub][NFC-e emitir->XML fallback] resp:",Xn),Ms=Xn?.xml_url||Xn?.XmlUrl||null,bs=bs||Xn?.chave||Xn?.Chave||bs}catch{}}else{try{const Xn=await nv({baseUrl:Ue.baseUrl,cnpj:Ue.cnpj,dados:{numero:Ta,Numero:Ta,serie:Kn,Serie:Kn}});console.log("[FiscalHub][NFC-e emitir->PDF fallback] resp:",Xn),ao=Xn?.pdf_url||Xn?.PdfUrl||null,bs=Xn?.chave||Xn?.Chave||bs}catch{}try{const Xn=await av({baseUrl:Ue.baseUrl,cnpj:Ue.cnpj,dados:{numero:Ta,Numero:Ta,serie:Kn,Serie:Kn}});console.log("[FiscalHub][NFC-e emitir->XML fallback] resp:",Xn),Ms=Xn?.xml_url||Xn?.XmlUrl||null,bs=bs||Xn?.chave||Xn?.Chave||bs}catch{}}if(ao||Ms||bs){await Ia(D,{nf_status:ao||Ms?"autorizada":"processando",nf_pdf_url:ao||gn.nf_pdf_url,nf_xml_url:Ms||gn.nf_xml_url,xml_chave:bs||gn.xml_chave,nf_numero:Ta,nf_serie:Kn}),ao&&(r({title:"NFC-e autorizada",description:"DANFE encontrada (fallback).",variant:"success"}),window.open(ao,"_blank")),await Mn();return}}catch{}throw Yr}const jt=Mt?.chave||Mt?.Chave||Mt?.chaveAcesso||null,Ve=Mt?.numero||Mt?.Numero||null,Bt=Mt?.serie||Mt?.Serie||null,Yt=Mt?.pdf_url||Mt?.PdfUrl||null,Ur=Mt?.xml_url||Mt?.XmlUrl||null,jr=Mt?.protocolo||Mt?.Protocolo||null,mn=Mt?.searchkey||Mt?.SearchKey||Mt?.searchKey||null,en=!!(Mt?.autorizada||Mt?.Autorizada||Mt?.sucesso||Mt?.Sucesso||jt);await Ia(D,{nf_status:en?"autorizada":"processando",xml_chave:jt,nf_numero:Ve,nf_serie:Bt,nf_pdf_url:Yt,nf_xml_url:Ur,xml_protocolo:jr||mn});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"success",response:Mt||null})}catch{}r({title:en?"NFC-e autorizada":"Emisso enviada",description:en?"Documento autorizado.":"Aguardando autorizao."}),await Mn()}catch(K){r({title:"Falha ao emitir",description:K.message,variant:"destructive"})}finally{l(!1)}},yo=async D=>{try{l(!0);const K=s.find(en=>en.id===D);if(!K)return;const{empresa:he}=await dg({comandaId:D,codigoEmpresa:t}),Xe=tl(he);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"start",request:K.xml_protocolo?{searchkey:K.xml_protocolo}:{numero:K.nf_numero,serie:K.nf_serie}})}catch{}let Ue=null,Et=!1,Dt="",Mt="Consulta retornada",jt=K.nf_pdf_url,Ve=K.nf_xml_url,Bt=K.xml_chave,Yt=K.nf_numero,Ur=K.nf_serie;const jr=!!K.xml_protocolo;if(jr)try{Ue=await rv({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:{SearchKey:K.xml_protocolo,searchkey:K.xml_protocolo}}),console.log("[FiscalHub][NFC-e consulta] resposta completa:",Ue),Dt=String(Ue?.status||Ue?.Status||Ue?.cStat||"").toLowerCase(),Mt=Ue?.xMotivo||Ue?.mensagem||Ue?.message||Mt,Et=!!(Ue?.autorizada||Ue?.Autorizada||Ue?.sucesso||Ue?.Sucesso||Dt==="100"),jt=Ue?.pdf_url||Ue?.PdfUrl||jt,Ve=Ue?.xml_url||Ue?.XmlUrl||Ve,Bt=Ue?.chave||Ue?.Chave||Bt,Yt=Ue?.numero||Ue?.Numero||Yt,Ur=Ue?.serie||Ue?.Serie||Ur}catch(en){console.warn("[FiscalHub][NFC-e consulta] consulta por SearchKey falhou, tentando PDF/XML direto",en)}if(!jt&&!Ve){const en=jr?{searchkey:K.xml_protocolo||"",SearchKey:K.xml_protocolo||""}:{numero:Yt,Numero:Yt,serie:Ur,Serie:Ur};try{const Yr=await nv({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:en});console.log("[FiscalHub][NFC-e consulta] PDF resp:",Yr),jt=Yr?.pdf_url||Yr?.PdfUrl||jt,Bt=Yr?.chave||Yr?.Chave||Bt}catch(Yr){console.warn("[FiscalHub][NFC-e consulta] PDF erro:",Yr)}try{const Yr=await av({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:en});console.log("[FiscalHub][NFC-e consulta] XML resp:",Yr),Ve=Yr?.xml_url||Yr?.XmlUrl||Ve,Bt=Bt||Yr?.chave||Yr?.Chave||Bt}catch(Yr){console.warn("[FiscalHub][NFC-e consulta] XML erro:",Yr)}Et=!!(jt||Ve||Et),Dt=Et?"100":K.nf_status||"pendente",Mt=Et?"Documento localizado":Mt}let mn=K.nf_status||"processando";Et?mn="autorizada":Dt&&Dt.includes&&Dt.includes("rejeit")?mn="rejeitada":Dt==="erro"?mn=K.nf_status||"pendente":typeof Dt=="string"&&Dt&&(mn=Dt),await Ia(D,{nf_status:mn,nf_pdf_url:jt,nf_xml_url:Ve,xml_chave:Bt,nf_numero:Yt,nf_serie:Ur});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"success",response:Ue||null})}catch{}r({title:Et?"NFC-e autorizada":`Status: ${Dt||mn}`,description:Mt,variant:Et?"success":"warning"}),await Mn()}catch(K){r({title:"Falha ao consultar",description:K.message,variant:"destructive"})}finally{l(!1)}},ai=async(D,K)=>{try{const he=(K||"").trim();if(!he){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}l(!0);const{empresa:Xe}=await dg({comandaId:D,codigoEmpresa:t}),Ue=tl(Xe),Et=s.find(Ve=>Ve.id===D),Dt=Et&&Et.xml_chave?{chave:Et.xml_chave,motivo:he}:{numero:Et?.nf_numero,serie:Et?.nf_serie,motivo:he};try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"start",request:Dt})}catch{}let Mt=await SV({baseUrl:Ue.baseUrl,apiKey:Ue.apiKey,cnpj:Ue.cnpj,dados:Dt});try{const Ve=Mt&&typeof Mt.status=="string"&&/erro/i.test(Mt.status),Bt=Mt?.codigo||Mt?.Codigo||"",Yt=(Mt?.campo||Mt?.Campo||"").toString().toLowerCase();if(Ve&&(Bt==="1301"||Yt==="searchkey")&&Et?.xml_protocolo){const jr={searchkey:Et.xml_protocolo,SearchKey:Et.xml_protocolo,motivo:he};try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"retry_searchkey",request:jr})}catch{}Mt=await SV({baseUrl:Ue.baseUrl,apiKey:Ue.apiKey,cnpj:Ue.cnpj,dados:jr})}}catch{}if(Mt&&typeof Mt.status=="string"&&/erro/i.test(Mt.status)){const Ve=Mt?.codigo||Mt?.Codigo||"",Bt=Mt?.campo||Mt?.Campo||"",Yt=Mt?.descricao||Mt?.Descricao||Mt?.mensagem||Mt?.message||"Falha ao cancelar NFC-e",Ur=[Bt,Yt].filter(Boolean).join("  ");r({title:`Erro ao cancelar${Ve?` ${Ve}`:""}`,description:Ur,variant:"destructive"});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"business_error",response:Mt||null})}catch{}return}await Ia(D,{nf_status:"cancelada"});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"success",response:Mt||null})}catch{}r({title:"NFC-e cancelada"}),await Mn()}catch(he){r({title:"Falha ao cancelar",description:he.message,variant:"destructive"})}finally{l(!1)}};return a.jsxs("div",{className:"relative p-4",children:[a.jsx(J0,{children:a.jsx("title",{children:"Central Fiscal"})}),!1,a.jsxs(Sd,{value:q,onValueChange:z,className:"w-full",children:[a.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Central Fiscal"}),a.jsxs("div",{className:"flex items-center gap-2 sm:hidden",children:[a.jsxs(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>$a("filtered"),title:"Exportar CSV das comandas/NF",children:[a.jsx(ys,{className:"w-4 h-4 mr-1"}),a.jsx("span",{children:"CSV"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>n("/configuracao-fiscal"),title:"Configurao Fiscal da Empresa",children:a.jsx(Xc,{className:"w-4 h-4"})})]})]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1 hidden sm:block",children:"Acompanhe NFC-e e NF-e, pendncias e cancelamentos em um s lugar."}),(()=>{const K=tl(Pe||{})?.ambiente||"homologacao",he=K==="producao"?"Produo":"Homologao",Xe=K==="producao"?"bg-emerald-500/15 text-emerald-600 border-emerald-600/30":"bg-amber-500/15 text-amber-700 border-amber-600/30";return a.jsxs("div",{className:["mt-2 inline-flex items-center gap-2 text-[11px] px-2 py-0.5 rounded-full border hidden sm:inline-flex",Xe].join(" "),children:[a.jsx("span",{children:"Ambiente:"}),a.jsx("strong",{children:he})]})})()]}),a.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[a.jsxs(jc,{className:"hidden sm:inline-flex rounded-full bg-surface-2 px-1 py-0.5",children:[a.jsx(Ga,{value:"nfce",children:"NFC-e"}),a.jsx(Ga,{value:"nfe",children:"NF-e"}),a.jsx(Ga,{value:"compras",children:"NF-e Entrada (Compras)"})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsxs(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>$a("filtered"),title:"Exportar CSV das comandas/NF",children:[a.jsx(ys,{className:"w-4 h-4 mr-1"}),a.jsx("span",{children:"CSV"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>n("/configuracao-fiscal"),title:"Configurao Fiscal da Empresa",children:a.jsx(Xc,{className:"w-4 h-4"})})]})]})]}),a.jsxs(jc,{className:"sm:hidden w-full justify-start rounded-lg bg-surface-2 px-1 py-1 overflow-x-auto",children:[a.jsx(Ga,{value:"nfce",className:"flex-1 min-w-[90px]",children:"NFC-e"}),a.jsx(Ga,{value:"nfe",className:"flex-1 min-w-[100px]",children:"NF-e"}),a.jsx(Ga,{value:"compras",className:"flex-1 min-w-[130px]",children:"NF-e Entrada"})]}),a.jsxs("div",{className:"hidden sm:flex bg-surface-2/60 border border-border/70 rounded-xl px-3 py-3 flex flex-wrap items-center gap-3",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2 min-w-[220px]",children:[a.jsx(lt,{className:"text-xs text-text-secondary",children:"Buscar"}),a.jsx(At,{value:h,onChange:D=>m(D.target.value),placeholder:"Chave, nmero, cliente...",className:"w-[200px] sm:w-60 h-8 text-xs"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(lt,{className:"text-xs text-text-secondary",children:"Status"}),a.jsxs(ea,{value:v,onValueChange:y,children:[a.jsx(Jn,{className:"w-[150px] h-8 rounded-full text-xs",children:a.jsx(ra,{placeholder:"Selecionar status"})}),a.jsxs(Qn,{className:"rounded-xl text-xs",children:[a.jsx(Qe,{value:"all",children:"Todos"}),a.jsx(Qe,{value:"pendente",children:"Pendente"}),a.jsx(Qe,{value:"processando",children:"Em andamento"}),a.jsx(Qe,{value:"autorizada",children:"Autorizada"}),a.jsx(Qe,{value:"rejeitada",children:"Rejeitada"}),a.jsx(Qe,{value:"cancelada",children:"Cancelada"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(lt,{className:"text-xs text-text-secondary",children:"Perodo"}),a.jsxs("div",{className:"inline-flex items-center gap-2",children:[a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:S?new Date(S+"T00:00:00").toLocaleDateString("pt-BR"):"Incio"})})}),a.jsx(Ho,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:S?new Date(S+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const K=D.getFullYear(),he=b(D.getMonth()+1),Xe=b(D.getDate());P(`${K}-${he}-${Xe}`)}})})]}),a.jsx("span",{className:"text-text-secondary text-xs",children:"at"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:M?new Date(M+"T00:00:00").toLocaleDateString("pt-BR"):"Fim"})})}),a.jsx(Ho,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:M?new Date(M+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const K=D.getFullYear(),he=b(D.getMonth()+1),Xe=b(D.getDate());O(`${K}-${he}-${Xe}`)}})})]})]})]}),a.jsxs("div",{className:"hidden sm:inline-flex items-center gap-2 text-xs ml-auto",children:[a.jsx(Ks,{checked:I,onCheckedChange:T,className:"rounded-full border-warning data-[state=checked]:bg-warning"}),a.jsx("span",{children:"Somente pendentes/rejeitadas"})]})]}),a.jsxs("div",{className:"sm:hidden mt-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx(At,{value:h,onChange:D=>m(D.target.value),placeholder:"Chave, nmero, cliente...",className:"h-9 text-xs"})}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",onClick:()=>te(D=>!D),children:a.jsx(wN,{className:"w-4 h-4"})})]}),Te&&a.jsxs("div",{className:"mt-2 bg-surface-2/60 border border-border/70 rounded-xl px-3 py-3 flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(lt,{className:"text-xs text-text-secondary",children:"Status"}),a.jsxs(ea,{value:v,onValueChange:y,children:[a.jsx(Jn,{className:"h-8 flex-1 rounded-full text-xs",children:a.jsx(ra,{placeholder:"Selecionar status"})}),a.jsxs(Qn,{className:"rounded-xl text-xs",children:[a.jsx(Qe,{value:"all",children:"Todos"}),a.jsx(Qe,{value:"pendente",children:"Pendente"}),a.jsx(Qe,{value:"processando",children:"Em andamento"}),a.jsx(Qe,{value:"autorizada",children:"Autorizada"}),a.jsx(Qe,{value:"rejeitada",children:"Rejeitada"}),a.jsx(Qe,{value:"cancelada",children:"Cancelada"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(lt,{className:"text-xs text-text-secondary",children:"Perodo"}),a.jsxs("div",{className:"inline-flex items-center gap-2",children:[a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:S?new Date(S+"T00:00:00").toLocaleDateString("pt-BR"):"Incio"})})}),a.jsx(Ho,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:S?new Date(S+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const K=D.getFullYear(),he=b(D.getMonth()+1),Xe=b(D.getDate());P(`${K}-${he}-${Xe}`)}})})]}),a.jsx("span",{className:"text-text-secondary text-xs",children:"at"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:M?new Date(M+"T00:00:00").toLocaleDateString("pt-BR"):"Fim"})})}),a.jsx(Ho,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:M?new Date(M+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const K=D.getFullYear(),he=b(D.getMonth()+1),Xe=b(D.getDate());O(`${K}-${he}-${Xe}`)}})})]})]})]})]})]})]}),Fe.length>0&&a.jsx("div",{className:"mb-4 p-3 rounded-md border border-warning/40 bg-warning/10 text-warning",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm",children:"Pendncias fiscais da empresa"}),a.jsxs("p",{className:"text-xs",children:["Preencha: ",Fe.join(", "),"."]})]}),a.jsx(Z,{size:"sm",className:"bg-warning text-black hover:bg-warning/90",onClick:()=>n("/configuracao-fiscal"),children:"Corrigir agora"})]})}),a.jsxs(vo,{value:"nfce",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap sm:flex-nowrap whitespace-normal sm:whitespace-nowrap relative z-10",children:[a.jsxs("div",{className:"hidden sm:flex ml-auto items-center gap-2 text-xs text-text-secondary",children:[a.jsxs("span",{children:["Selecionadas: ",a.jsx("strong",{className:"text-text-primary",children:Y.length})]}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>me([]),disabled:Y.length===0,children:"Limpar"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>me(Array.from(new Set((is||[]).map(D=>D.id)))),disabled:(is||[]).length===0,children:"Selecionar filtrados"})]}),a.jsxs("div",{className:"flex sm:hidden items-center gap-2 w-full justify-start",children:[a.jsx(Z,{size:"sm",variant:"outline",className:"flex-1",disabled:Y.length===0&&!k,onClick:()=>(async()=>{const D=k||Y[0],K=s.find(he=>he.id===D);if(K){if(K.nf_pdf_url){window.open(K.nf_pdf_url,"_blank");return}try{l(!0);const{empresa:he}=await dg({comandaId:K.id,codigoEmpresa:t}),Xe=tl(he);let Ue=null,Et=null,Dt=K.xml_chave||null,Mt=!1;if(K.xml_protocolo)try{const jt=await rv({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:{SearchKey:K.xml_protocolo,searchkey:K.xml_protocolo}});console.log("[FiscalHub][NFC-e visualizar->consulta] resposta completa:",jt);const Ve=String(jt?.status||jt?.Status||jt?.cStat||"").toLowerCase();Mt=!!(jt?.autorizada||jt?.Autorizada||jt?.sucesso||jt?.Sucesso||Ve==="100"),Ue=jt?.pdf_url||jt?.PdfUrl||null,Et=jt?.xml_url||jt?.XmlUrl||null,Dt=jt?.chave||jt?.Chave||Dt}catch(jt){console.warn("[FiscalHub][NFC-e visualizar] consulta por SearchKey falhou, tentando PDF/XML direto",jt)}if(!Ue&&!Et){const jt={numero:K.nf_numero,Numero:K.nf_numero,serie:K.nf_serie,Serie:K.nf_serie};try{const Ve=await nv({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:jt});Ue=Ve?.pdf_url||Ve?.PdfUrl||Ue,Dt=Ve?.chave||Ve?.Chave||Dt}catch{}try{const Ve=await av({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:jt});Et=Ve?.xml_url||Ve?.XmlUrl||Et,Dt=Dt||Ve?.chave||Ve?.Chave||Dt}catch{}Mt=!!(Ue||Et||Mt)}(Ue||Et||Mt||Dt)&&await Q.from("comandas").update({nf_pdf_url:Ue||K.nf_pdf_url,nf_xml_url:Et||K.nf_xml_url,xml_chave:Dt||K.xml_chave,nf_status:Mt?"autorizada":K.nf_status||null}).eq("id",K.id).eq("codigo_empresa",t),Ue?window.open(Ue,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"}),await Mn()}catch(he){r({title:"Falha ao visualizar",description:he.message,variant:"destructive"})}finally{l(!1)}}})(),children:"Visualizar"}),a.jsxs(Z,{size:"sm",className:"flex-1",disabled:!Ge,onClick:()=>{if(!Vr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}Ut(!0)},children:["Emitir (",Vr.length||0,")"]}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",className:"px-2",disabled:zr&&!F&&!V,children:"Mais"})}),a.jsxs(Qu,{align:"end",children:[a.jsxs(vs,{disabled:!ge,onClick:ia,children:["Consultar (",Ir.length||0,")"]}),a.jsx(vs,{disabled:!nt,onClick:ja,children:a.jsxs("span",{className:"text-destructive",children:["Cancelar (",re.length||0,")"]})}),a.jsx(vs,{onClick:()=>$a("selected"),children:"Exportar CSV"}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfce",scope:"selected",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfce",scope:"selected",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(vs,{disabled:(is||[]).length===0,onClick:()=>se({tipo:"nfce",scope:"filtered",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(vs,{disabled:(is||[]).length===0,onClick:()=>se({tipo:"nfce",scope:"filtered",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",disabled:!je,onClick:()=>(async()=>{const D=k||Y[0],K=s.find(he=>he.id===D);if(K){if(K.nf_pdf_url){window.open(K.nf_pdf_url,"_blank");return}try{l(!0);const{empresa:he}=await dg({comandaId:K.id,codigoEmpresa:t}),Xe=tl(he);let Ue=null,Et=null,Dt=K.xml_chave||null,Mt=!1;if(K.xml_protocolo)try{const jt=await rv({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:{SearchKey:K.xml_protocolo,searchkey:K.xml_protocolo}});console.log("[FiscalHub][NFC-e visualizar->consulta] resposta completa:",jt);const Ve=String(jt?.status||jt?.Status||jt?.cStat||"").toLowerCase();Mt=!!(jt?.autorizada||jt?.Autorizada||jt?.sucesso||jt?.Sucesso||Ve==="100"),Ue=jt?.pdf_url||jt?.PdfUrl||null,Et=jt?.xml_url||jt?.XmlUrl||null,Dt=jt?.chave||jt?.Chave||Dt}catch(jt){console.warn("[FiscalHub][NFC-e visualizar] consulta por SearchKey falhou, tentando PDF/XML direto",jt)}if(!Ue&&!Et){const jt={numero:K.nf_numero,Numero:K.nf_numero,serie:K.nf_serie,Serie:K.nf_serie};try{const Ve=await nv({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:jt});Ue=Ve?.pdf_url||Ve?.PdfUrl||Ue,Dt=Ve?.chave||Ve?.Chave||Dt}catch{}try{const Ve=await av({baseUrl:Xe.baseUrl,cnpj:Xe.cnpj,dados:jt});Et=Ve?.xml_url||Ve?.XmlUrl||Et,Dt=Dt||Ve?.chave||Ve?.Chave||Dt}catch{}Mt=!!(Ue||Et||Mt)}(Ue||Et||Mt||Dt)&&await Q.from("comandas").update({nf_pdf_url:Ue||K.nf_pdf_url,nf_xml_url:Et||K.nf_xml_url,xml_chave:Dt||K.xml_chave,nf_status:Mt?"autorizada":K.nf_status||null}).eq("id",K.id).eq("codigo_empresa",t),Ue?window.open(Ue,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"}),await Mn()}catch(he){r({title:"Falha ao visualizar",description:he.message,variant:"destructive"})}finally{l(!1)}}})(),children:"Visualizar"}),a.jsxs(Z,{size:"sm",disabled:!Ge,onClick:()=>{if(!Vr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}Ut(!0)},children:["Emitir (",Vr.length||0,")"]}),a.jsxs(Z,{size:"sm",variant:"outline",disabled:!ge,onClick:ia,children:["Consultar (",Ir.length||0,")"]}),a.jsxs(Z,{size:"sm",variant:"destructive",disabled:!nt,onClick:ja,children:["Cancelar (",re.length||0,")"]}),a.jsx(Z,{size:"sm",variant:"outline",disabled:Y.length===0&&!k,onClick:()=>$a("selected"),children:"Exportar CSV"}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",disabled:zr,children:"Aes"})}),a.jsxs(Qu,{align:"end",children:[a.jsx(vs,{disabled:Y.length===0&&!k,onClick:()=>$a("selected"),children:"Exportar CSV"}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfce",scope:"selected",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfce",scope:"selected",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(vs,{disabled:(is||[]).length===0,onClick:()=>se({tipo:"nfce",scope:"filtered",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(vs,{disabled:(is||[]).length===0,onClick:()=>se({tipo:"nfce",scope:"filtered",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]})]}),a.jsxs("div",{className:"sm:hidden space-y-2 -mx-2",children:[(!Nn||Nn.length===0)&&a.jsx("div",{className:"px-3 py-4 text-center text-text-muted border border-border rounded-md bg-surface",children:i?"Carregando...":"Nada por aqui"}),Nn.map(D=>{const K=D.nf_status||"pendente",he=K==="autorizada"?"bg-emerald-500/5 border-emerald-500/40":K==="cancelada"?"bg-red-500/5 border-red-500/40":K==="rejeitada"?"bg-orange-500/5 border-orange-500/40":K==="processando"||K==="em_andamento"?"bg-sky-500/5 border-sky-500/40":K==="pendente"?"bg-amber-500/5 border-amber-500/40":"bg-surface border-border/70";return a.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs flex flex-col gap-1 border ${he}`,onClick:()=>ae(D.id,!ee(D.id)),children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{onClick:Xe=>{Xe.stopPropagation(),ae(D.id,!ee(D.id))},className:"pt-1",children:a.jsx(Ks,{checked:ee(D.id),onCheckedChange:Xe=>ae(D.id,!!Xe)})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"font-medium text-sm truncate",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${js(K)}`,children:K})]}),a.jsxs("div",{className:"text-xs text-text-secondary flex items-center justify-between gap-2 mt-0.5",children:[a.jsx("span",{children:mb(D.aberto_em)}),a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",Zs(D.total||D.total_com_desconto)]})]}),a.jsxs("div",{className:"mt-1 text-xs text-text-secondary truncate",title:D.clientesStr||"",children:[a.jsx("span",{className:"text-text-muted",children:"Cliente(s): "}),a.jsx("span",{className:"text-text-primary",children:D.clientesStr||""})]}),a.jsxs("div",{className:"mt-0.5 text-xs text-text-secondary flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"truncate",title:D.finalizadorasStr||"",children:[a.jsx("span",{className:"text-text-muted",children:"Pagamento: "}),a.jsx("span",{className:"text-text-primary",children:D.finalizadorasStr||""})]}),a.jsxs("span",{className:"whitespace-nowrap text-text-primary text-[11px]",children:[D.nf_numero??"","/",D.nf_serie??""]})]}),a.jsxs("div",{className:"mt-0.5 text-[11px] text-text-secondary",title:D.xml_chave||"",children:[a.jsx("span",{className:"text-text-muted block mb-0.5",children:"Chave:"}),a.jsx("span",{className:"text-text-primary text-[10px] truncate block",children:D.xml_chave||""})]})]})]}),(D.nf_pdf_url||D.nf_xml_url)&&a.jsx("div",{className:"mt-2 border-t border-border/60 pt-2 text-[11px]",children:a.jsxs("div",{className:"flex gap-2",children:[D.nf_pdf_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.nf_pdf_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Abrir DANFE"})}),D.nf_xml_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.nf_xml_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Baixar XML"})})]})})]},D.id)})]}),a.jsx("div",{className:"hidden sm:block bg-surface rounded border border-border overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"w-8 px-3 py-2",children:a.jsx(Ks,{checked:Pr,onCheckedChange:D=>pn(!!D)})}),a.jsxs("th",{className:"text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{L(ue==="aberto_em"&&U==="asc"?"desc":"asc"),_e("aberto_em")},children:["Abertura ",ue==="aberto_em"?U==="asc"?"":"":""]}),a.jsxs("th",{className:"text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{L(ue==="nf_status"&&U==="asc"?"desc":"asc"),_e("nf_status")},children:["Status ",ue==="nf_status"?U==="asc"?"":"":""]}),a.jsxs("th",{className:"hidden text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{L(ue==="mesa"&&U==="asc"?"desc":"asc"),_e("mesa")},children:["Mesa ",ue==="mesa"?U==="asc"?"":"":""]}),a.jsx("th",{className:"text-left px-3 py-2",children:"Clientes"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Finalizadoras"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Nmero/Srie"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Chave"}),a.jsxs("th",{className:"text-right px-3 py-2 cursor-pointer select-none",onClick:()=>{L(ue==="total"&&U==="asc"?"desc":"asc"),_e("total")},children:["Total ",ue==="total"?U==="asc"?"":"":""]})]})}),a.jsxs("tbody",{children:[(!Nn||Nn.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"px-3 py-4 text-center text-text-muted",children:i?"Carregando...":"Nada por aqui"})}),Nn.map(D=>{const K=D.nf_status||"pendente";return a.jsxs(Ce.Fragment,{children:[a.jsxs("tr",{className:`border-t border-border/60 transition-colors ${k===D.id?"bg-surface-2 ring-2 ring-[#FF7A1A]/60 rounded-md":"hover:bg-surface-2/50"}`,onClick:()=>vr(D.id),children:[a.jsx("td",{className:"px-3 py-2",onClick:he=>he.stopPropagation(),children:a.jsx(Ks,{checked:ee(D.id),onCheckedChange:he=>ae(D.id,!!he)})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:mb(D.aberto_em)}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${js(K)}`,children:K})}),a.jsx("td",{className:"hidden px-3 py-2 whitespace-nowrap",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.clientesStr||"",children:D.clientesStr||""}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.finalizadorasStr||"",children:D.finalizadorasStr||""}),a.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[D.nf_numero??"","/",D.nf_serie??""]}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[220px] truncate",title:D.xml_chave||"",children:D.xml_chave?`${String(D.xml_chave).slice(0,8)}...${String(D.xml_chave).slice(-4)}`:""}),a.jsxs("td",{className:"px-3 py-2 text-right whitespace-nowrap",children:["R$ ",Zs(D.total||D.total_com_desconto)]})]}),Wt(D.id)&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"px-3 py-3 bg-surface-2/40 border-t border-border",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Mesa: "}),a.jsx("span",{className:"text-text-primary",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Clientes: "}),a.jsx("span",{className:"text-text-primary",children:D.clientesStr||""})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Finalizadoras: "}),a.jsx("span",{className:"text-text-primary",children:D.finalizadorasStr||""})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Nmero/Srie: "}),a.jsxs("span",{className:"text-text-primary",children:[D.nf_numero??"","/",D.nf_serie??""]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-secondary",children:"Chave: "}),a.jsx("span",{className:"text-text-primary",title:D.xml_chave||"",children:D.xml_chave||""})]}),a.jsxs("div",{className:"text-text-secondary mt-1",children:["Total: ",a.jsxs("span",{className:"text-text-primary",children:["R$ ",Zs(D.total||D.total_com_desconto)]})]})]}),a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"flex gap-2",children:[D.nf_pdf_url&&a.jsx("a",{className:"inline-flex",href:D.nf_pdf_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",children:"Abrir DANFE"})}),D.nf_xml_url&&a.jsx("a",{className:"inline-flex",href:D.nf_xml_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",children:"Baixar XML"})})]})})]})})})]},D.id)})]})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[a.jsxs("div",{className:"sm:hidden text-[11px] text-text-secondary",children:["Pg. ",G," de ",an]}),a.jsxs("div",{className:"hidden sm:block text-xs text-text-secondary",children:["Pgina ",G," de ",an,"  ",jn.length," registros"]}),a.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Itens por pgina"}),a.jsxs("select",{className:"h-7 rounded-md bg-surface border border-border text-xs px-2",value:X,onChange:D=>{de(1),W(Number(D.target.value)||50)},children:[a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]})]}),a.jsx(Z,{size:"sm",variant:"outline",disabled:G<=1,onClick:()=>de(D=>Math.max(1,D-1)),children:"Anterior"}),a.jsx(Z,{size:"sm",variant:"outline",disabled:G>=an,onClick:()=>de(D=>Math.min(an,D+1)),children:"Prxima"})]})]})]}),a.jsxs(vo,{value:"nfe",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap whitespace-nowrap relative z-10",children:[a.jsxs("div",{className:"hidden sm:flex ml-auto items-center gap-2 text-xs text-text-secondary",children:[a.jsxs("span",{children:["Selecionadas: ",a.jsx("strong",{className:"text-text-primary",children:Y.length})]}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>me([]),disabled:Y.length===0,children:"Limpar"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>{const D=Nr||[];me(Array.from(new Set(D.map(K=>K.id))))},disabled:(Nr||[]).length===0,children:"Selecionar filtrados"})]}),a.jsxs("div",{className:"flex sm:hidden items-center gap-2 w-full justify-start",children:[a.jsx(Z,{size:"sm",variant:"outline",className:"flex-1",disabled:!Bs,onClick:()=>(async()=>{try{const D=c||[],K=k||Y&&Y[0],he=D.find(Ve=>Ve.id===K);if(!he){r({title:"NF-e no encontrada",variant:"warning"});return}if(he.pdf_url){window.open(he.pdf_url,"_blank");return}if(!Pe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:Xe,cnpj:Ue}=tl(Pe),Et=he.xml_chave?{chave:he.xml_chave,chave_nota:he.xml_chave}:{numero:he.numero,serie:he.serie};l(!0);let Dt=null,Mt=null,jt=he.xml_chave||null;try{const Ve=await i_({baseUrl:Xe,cnpj:Ue,dados:Et});Dt=Ve?.url_pdf||Ve?.pdf_url||null,Mt=Ve?.url_xml||Ve?.xml_url||null,jt=Ve?.chave||Ve?.Chave||jt}catch{}if(!Dt)try{const Ve=await l_({baseUrl:Xe,cnpj:Ue,dados:Et});Dt=Ve?.url_pdf||Ve?.pdf_url||null,jt=Ve?.chave||Ve?.Chave||jt}catch{}if(!Mt)try{const Ve=await c_({baseUrl:Xe,cnpj:Ue,dados:Et});Mt=Ve?.url_xml||Ve?.xml_url||null,jt=jt||Ve?.chave||Ve?.Chave||jt}catch{}(Dt||Mt||jt)&&await Q.from("notas_fiscais").update({pdf_url:Dt||he.pdf_url,xml_url:Mt||he.xml_url,xml_chave:jt||he.xml_chave,status:Dt||Mt?"autorizada":he.status}).eq("id",he.id).eq("codigo_empresa",t),await ha(),Dt?window.open(Dt,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"})}catch(D){r({title:"Falha ao visualizar NF-e",description:D?.message||String(D),variant:"destructive"})}finally{l(!1)}})(),children:"Visualizar"}),a.jsx(Z,{size:"sm",className:"flex-1",disabled:!Ln||Je,onClick:async()=>{mr(!0);try{await St()}finally{mr(!1)}},children:Je?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(ll,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Emitir NF-e"}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",className:"px-2",disabled:zr,children:"Mais"})}),a.jsxs(Qu,{align:"end",children:[a.jsx(vs,{disabled:!On,onClick:vt,children:"Consultar"}),a.jsx(vs,{disabled:!ma,onClick:dt,children:a.jsx("span",{className:"text-destructive",children:"Cancelar"})}),a.jsx(vs,{disabled:!0,className:"opacity-60 cursor-not-allowed",children:"Nova NF-e (em desenvolvimento)"}),a.jsx(vs,{disabled:Y.length===0&&!k,onClick:()=>le("selected"),children:"Exportar NF-e (CSV)"}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfe",scope:"selected",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfe",scope:"selected",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(vs,{disabled:(Nr||[]).length===0,onClick:()=>se({tipo:"nfe",scope:"filtered",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(vs,{disabled:(Nr||[]).length===0,onClick:()=>se({tipo:"nfe",scope:"filtered",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",disabled:!Bs,onClick:()=>(async()=>{try{const D=c||[],K=k||Y&&Y[0],he=D.find(Ve=>Ve.id===K);if(!he){r({title:"NF-e no encontrada",variant:"warning"});return}if(he.pdf_url){window.open(he.pdf_url,"_blank");return}if(!Pe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:Xe,cnpj:Ue}=tl(Pe),Et=he.xml_chave?{chave:he.xml_chave,chave_nota:he.xml_chave}:{numero:he.numero,serie:he.serie};l(!0);let Dt=null,Mt=null,jt=he.xml_chave||null;try{const Ve=await i_({baseUrl:Xe,cnpj:Ue,dados:Et});Dt=Ve?.url_pdf||Ve?.pdf_url||null,Mt=Ve?.url_xml||Ve?.xml_url||null,jt=Ve?.chave||Ve?.Chave||jt}catch{}if(!Dt)try{const Ve=await l_({baseUrl:Xe,cnpj:Ue,dados:Et});Dt=Ve?.url_pdf||Ve?.pdf_url||null,jt=Ve?.chave||Ve?.Chave||jt}catch{}if(!Mt)try{const Ve=await c_({baseUrl:Xe,cnpj:Ue,dados:Et});Mt=Ve?.url_xml||Ve?.xml_url||null,jt=jt||Ve?.chave||Ve?.Chave||jt}catch{}(Dt||Mt||jt)&&await Q.from("notas_fiscais").update({pdf_url:Dt||he.pdf_url,xml_url:Mt||he.xml_url,xml_chave:jt||he.xml_chave,status:Dt||Mt?"autorizada":he.status}).eq("id",he.id).eq("codigo_empresa",t),await ha(),Dt?window.open(Dt,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"})}catch(D){r({title:"Falha ao visualizar NF-e",description:D?.message||String(D),variant:"destructive"})}finally{l(!1)}})(),children:"Visualizar"}),a.jsx(Z,{size:"sm",disabled:!Ln||Je,onClick:async()=>{mr(!0);try{await St()}finally{mr(!1)}},children:Je?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(ll,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Emitir NF-e"}),a.jsx(Z,{size:"sm",variant:"outline",disabled:!On,onClick:vt,children:"Consultar"}),a.jsx(Z,{size:"sm",variant:"destructive",disabled:!ma,onClick:dt,children:"Cancelar"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",onClick:async()=>{$(null),me([]),await gr()&&(ta(""),Tn(!0))},children:"Nova NF-e"})}),a.jsxs(Lf,{children:[a.jsx($f,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",disabled:zr,children:"Aes"})}),a.jsxs(Qu,{align:"end",children:[a.jsx(vs,{disabled:Y.length===0&&!k,onClick:()=>le("selected"),children:"Exportar CSV"}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfe",scope:"selected",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(vs,{disabled:Y.length===0&&!k,onClick:()=>se({tipo:"nfe",scope:"selected",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(vs,{disabled:(Nr||[]).length===0,onClick:()=>se({tipo:"nfe",scope:"filtered",includePdf:!1}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(vs,{disabled:(Nr||[]).length===0,onClick:()=>se({tipo:"nfe",scope:"filtered",includePdf:!0}),children:[a.jsx(ys,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]})]}),a.jsxs("div",{className:"sm:hidden space-y-2 -mx-2",children:[(!Sn||Sn.length===0)&&a.jsx("div",{className:"px-3 py-4 text-center text-text-muted border border-border rounded-md bg-surface",children:u?"Carregando...":"Nada por aqui"}),Sn.map(D=>{const K=String(D.status||"rascunho").toLowerCase(),he=K==="emitida"?"autorizada":K,Xe=he==="autorizada"?"bg-emerald-500/5 border-emerald-500/40":he==="cancelada"?"bg-red-500/5 border-red-500/40":he==="rejeitada"?"bg-orange-500/5 border-orange-500/40":he==="processando"||he==="em_andamento"?"bg-sky-500/5 border-sky-500/40":he==="pendente"||he==="rascunho"?"bg-amber-500/5 border-amber-500/40":"bg-surface border-border/70",Ue=D.data_emissao||D.criado_em||D.created_at||null;return a.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs flex flex-col gap-1 border ${Xe}`,onClick:()=>ae(D.id,!ee(D.id)),children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{onClick:Et=>{Et.stopPropagation(),ae(D.id,!ee(D.id))},className:"pt-1",children:a.jsx(Ks,{checked:ee(D.id),onCheckedChange:Et=>ae(D.id,!!Et)})}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"font-medium text-sm truncate",children:["NF-e ",D.numero??"","/",D.serie??""]}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${js(he)}`,children:he})]}),a.jsxs("div",{className:"text-xs text-text-secondary flex items-center justify-between gap-2 mt-0.5",children:[a.jsx("span",{children:Ue?mb(Ue):""}),a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",Zs(D.valor_total||0)]})]}),a.jsxs("div",{className:"mt-1 text-xs text-text-secondary truncate",title:D.destinatario?.nome||"",children:[a.jsx("span",{className:"text-text-muted",children:"Destinatrio: "}),a.jsx("span",{className:"text-text-primary",children:D.destinatario?.nome||""})]}),a.jsxs("div",{className:"mt-0.5 text-[11px] text-text-secondary",title:D.xml_chave||"",children:[a.jsx("span",{className:"text-text-muted block mb-0.5",children:"Chave:"}),a.jsx("span",{className:"text-text-primary text-[10px] truncate block",children:D.xml_chave||""})]})]}),K==="rascunho"&&a.jsxs("div",{className:"flex flex-col items-end gap-1 ml-1",children:[!1,a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-6 h-6 rounded hover:bg-surface-2 text-text-secondary hover:text-destructive",onClick:Et=>{Et.stopPropagation(),us(D.id)},title:"Excluir rascunho",children:a.jsx(Sc,{className:"w-3 h-3"})})]})]})})]}),(D.pdf_url||D.xml_url)&&a.jsx("div",{className:"mt-2 border-t border-border/60 pt-2 text-[11px]",children:a.jsxs("div",{className:"flex gap-2",children:[D.pdf_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.pdf_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Abrir DANFE"})}),D.xml_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.xml_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Baixar XML"})})]})})]},D.id)})]}),a.jsx("div",{className:"hidden sm:block bg-surface rounded border border-border overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"w-8 px-3 py-2",children:a.jsx(Ks,{checked:!1,onCheckedChange:()=>{}})}),a.jsx("th",{className:"text-left px-3 py-2",children:"Data"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Status"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Destinatrio"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Nmero/Srie"}),a.jsx("th",{className:"text-right px-3 py-2",children:"Valor"})]})}),a.jsxs("tbody",{children:[(!Sn||Sn.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-text-muted",children:u?"Carregando...":"Nada por aqui"})}),Sn.map(D=>{const K=String(D.status||"rascunho").toLowerCase(),he=js(K==="emitida"?"autorizada":K),Xe=D.data_emissao||D.criado_em||D.created_at||null;return a.jsx(Ce.Fragment,{children:a.jsxs("tr",{className:`border-t border-border/60 transition-colors ${k===D.id?"bg-surface-2 ring-2 ring-[#FF7A1A]/60 rounded-md":"hover:bg-surface-2/50"}`,onClick:()=>{$(D.id),me(Ue=>!Ue||Ue.length===0?[D.id]:(Ue.length===1&&Ue[0]===D.id,Ue))},children:[a.jsx("td",{className:"px-3 py-2",onClick:Ue=>Ue.stopPropagation(),children:a.jsx(Ks,{checked:ee(D.id),onCheckedChange:Ue=>ae(D.id,!!Ue)})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:Xe?mb(Xe):""}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${he}`,children:K}),(()=>{const Ue=String(D.ambiente||tl(Pe||{}).ambiente||"homologacao"),Et=Ue==="producao"?"bg-emerald-500/15 text-emerald-600 border border-emerald-600/30":"bg-amber-500/15 text-amber-700 border border-amber-600/30",Dt=Ue==="producao"?"Produo":"Homologao";return a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] ${Et}`,children:Dt})})(),K==="rascunho"&&a.jsxs(a.Fragment,{children:[!1,a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-surface-2 text-text-secondary hover:text-destructive",onClick:Ue=>{Ue.stopPropagation(),us(D.id)},title:"Excluir rascunho",children:a.jsx(Sc,{className:"w-3 h-3"})})]})]})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.destinatario?.nome||"",children:D.destinatario?.nome||""}),a.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[D.numero??"","/",D.serie??"",D.xml_chave&&a.jsxs("div",{className:"text-[10px] text-text-secondary truncate max-w-[220px] flex items-center gap-1",children:[a.jsx("span",{className:"truncate",children:`${String(D.xml_chave).slice(0,8)}...${String(D.xml_chave).slice(-4)}`}),a.jsx("button",{type:"button",className:"p-0.5 hover:text-text-primary",onClick:Ue=>{Ue.stopPropagation(),navigator.clipboard.writeText(D.xml_chave||""),r({title:"Chave copiada"})},title:"Copiar chave",children:a.jsx(Q4,{className:"w-3 h-3"})})]})]}),a.jsxs("td",{className:"px-3 py-2 text-right whitespace-nowrap",children:["R$ ",Zs(D.valor_total||0)]})]})},D.id)})]})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[a.jsxs("div",{className:"sm:hidden text-[11px] text-text-secondary",children:["Pg. ",G," de ",hn]}),a.jsxs("div",{className:"hidden sm:block text-xs text-text-secondary",children:["Pgina ",G," de ",hn,"  ",(Nr||[]).length," registros"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Itens por pgina"}),a.jsxs("select",{className:"h-7 rounded-md bg-surface border border-border text-xs px-2",value:X,onChange:D=>{de(1),W(Number(D.target.value)||50)},children:[a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]})]}),a.jsx(Z,{size:"sm",variant:"outline",disabled:G<=1,onClick:()=>de(D=>Math.max(1,D-1)),children:"Anterior"}),a.jsx(Z,{size:"sm",variant:"outline",disabled:G>=hn,onClick:()=>de(D=>Math.min(hn,D+1)),children:"Prxima"})]})]})]}),a.jsx(vo,{value:"compras",children:a.jsx(moe,{})})]}),a.jsx(zn,{open:gt,onOpenChange:Ut,children:a.jsxs(qn,{className:"sm:max-w-[520px]",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Confirmar emisso de NFC-e"}),a.jsx(la,{children:"As seguintes comandas sero enviadas para emisso agora. Revise rapidamente antes de confirmar."})]}),a.jsxs("div",{className:"max-h-[320px] overflow-y-auto mt-2 border border-border/60 rounded-md divide-y divide-border/40 text-xs",children:[Vr.map(D=>{const K=s.find(Xe=>Xe.id===D)||{},he=K.mesaNumero?`Mesa ${K.mesaNumero}`:"Balco";return a.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-2 bg-surface/40",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx("div",{className:"font-medium text-text-primary",children:he}),a.jsx("div",{className:"text-text-secondary truncate max-w-[260px]",children:K.clientesStr||"Cliente Consumidor"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-[11px] text-text-secondary",children:"Total"}),a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["R$ ",Zs(K.total||K.total_com_desconto)]})]})]},D)}),!Vr.length&&a.jsx("div",{className:"px-3 py-2 text-text-secondary",children:"Nenhuma NFC-e elegvel selecionada."})]}),a.jsxs("div",{className:"flex justify-between items-center mt-3 text-[11px] text-text-secondary",children:[a.jsxs("span",{children:[Vr.length," NFC-e sero emitidas agora."]}),Y.length>Vr.length&&a.jsxs("span",{children:[Y.length-Vr.length," seleo(es) sero ignoradas por no estarem pendentes/rejeitadas."]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",size:"sm",disabled:ot,onClick:()=>Ut(!1),children:"Cancelar"}),a.jsx(Z,{size:"sm",className:"bg-[#FF7A1A] hover:bg-[#ff8f3b] text-black",disabled:ot,onClick:async()=>{ar(!0);try{await na(),Ut(!1)}finally{ar(!1)}},children:ot?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(ll,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Confirmar emisso"})]})]})}),a.jsx(zn,{open:Pn,onOpenChange:Ct,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Novo CFOP"}),a.jsx(la,{children:"Cadastrar um cdigo CFOP para esta empresa."})]}),a.jsxs("div",{className:"space-y-3 mt-2",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"Cdigo CFOP"}),a.jsx(At,{value:lr.codigo,onChange:D=>Ye(K=>({...K,codigo:D.target.value})),placeholder:"Ex.: 5102"})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Descrio"}),a.jsx(At,{value:lr.descricao,onChange:D=>Ye(K=>({...K,descricao:D.target.value})),placeholder:"Ex.: Venda de mercadoria adquirida de terceiros"})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>Ct(!1),children:"Cancelar"}),a.jsx(Z,{onClick:async()=>{const D=(lr.codigo||"").trim(),K=(lr.descricao||"").trim();if(!D||!K){r({title:"Informe cdigo e descrio do CFOP",variant:"warning"});return}if(!t){r({title:"Empresa no encontrada para salvar CFOP",variant:"destructive"});return}try{const{data:he,error:Xe}=await Q.from("cfops").insert({codigo_empresa:t,codigo:D,descricao:K,tipo_nota:Ae.tipo_nota||"saida"}).select().single();if(Xe)throw Xe;Zt(Ue=>[...Ue,he]),et(Ue=>({...Ue,cfop_padrao:D,natOp:K||Ue.natOp||""})),Ct(!1)}catch(he){r({title:"Falha ao salvar CFOP",description:he.message,variant:"destructive"})}},children:"Salvar"})]})]})}),a.jsx(zn,{open:ua,onOpenChange:sa,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-[760px] max-h-[80vh] flex flex-col",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Selecionar Comanda"}),a.jsx(la,{children:"Escolha a comanda de origem para criar o rascunho de NF-e."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto mt-2 space-y-2",children:(()=>{const D=(J||"").trim().toLowerCase(),he=(Array.isArray(jn)?jn:[]).filter(Ue=>D?`${Ue.mesaNumero?`mesa ${Ue.mesaNumero}`:"balcao"} ${Ue.clientesStr||""}`.toLowerCase().includes(D):!0),Xe=new Set((c||[]).filter(Ue=>Ue.origem==="comanda"&&Ue.comanda_id).map(Ue=>Ue.comanda_id));return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[a.jsx("div",{className:"flex-1 min-w-[180px] flex items-center gap-2",children:a.jsx(At,{className:"h-8 text-xs",placeholder:"Filtrar por cliente ou mesa",value:J,onChange:Ue=>Oe(Ue.target.value)})}),a.jsxs("div",{className:"text-xs text-text-secondary whitespace-nowrap",children:[he.length," comandas filtradas"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[he.slice(0,100).map(Ue=>{const Et=Xe.has(Ue.id);return a.jsxs("label",{className:"grid grid-cols-12 items-center px-3 py-2 hover:bg-surface-2 cursor-pointer gap-2",children:[a.jsx("div",{className:"col-span-1 flex items-center justify-center",children:a.jsx(Ks,{checked:wa===Ue.id,onCheckedChange:Dt=>{Va(Mt=>Dt?Ue.id:Mt===Ue.id?null:Mt)}})}),a.jsx("div",{className:"col-span-3 text-sm",children:mb(Ue.aberto_em)}),a.jsx("div",{className:"col-span-4 text-sm truncate",title:Ue.clientesStr||"",children:Ue.clientesStr||""}),a.jsxs("div",{className:"col-span-2 flex flex-col text-xs text-text-secondary",children:[a.jsx("span",{children:Ue.mesaNumero?`Mesa ${Ue.mesaNumero}`:"Balco"}),Et&&a.jsx("span",{className:"text-[10px] text-amber-500",children:"J possui NF-e vinculada"})]}),a.jsxs("div",{className:"col-span-2 text-right text-sm",children:["R$ ",Zs(Ue.total||Ue.total_com_desconto)]})]},Ue.id)}),he.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhuma comanda encontrada"})]})]})})()}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3 pt-2 border-t border-border/60",children:[a.jsx(Z,{variant:"outline",onClick:()=>sa(!1),children:"Cancelar"}),a.jsx(Z,{onClick:async()=>{if(!wa){r({title:"Selecione uma comanda",variant:"warning"});return}await _t(wa)&&(ta(""),await Cr(wa),sa(!1))},children:"Continuar"})]})]})}),a.jsx(zn,{open:!!Un,onOpenChange:D=>{D||(Ya(null),po(""))},children:a.jsxs(qn,{className:"max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Cancelar NF-e"}),a.jsx(la,{children:"Informe o motivo do cancelamento. Essa ao ser enviada para a API fiscal e a nota ser marcada como cancelada."})]}),a.jsxs("div",{className:"space-y-2 mt-2",children:[a.jsx(lt,{htmlFor:"motivo-cancel-nfe",children:"Motivo do cancelamento"}),a.jsx(At,{id:"motivo-cancel-nfe",value:$s,onChange:D=>po(D.target.value),placeholder:"Ex.: Nota emitida em duplicidade"})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>{Ya(null),po("")},children:"Cancelar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!Un){Ya(null);return}await xt(Un)},children:"Confirmar cancelamento"})]})]})}),a.jsx(zn,{open:!!xl,onOpenChange:D=>{D||(Yi(null),R(""))},children:a.jsxs(qn,{className:"max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Cancelar NFC-e"}),a.jsx(la,{children:"Informe o motivo do cancelamento."})]}),a.jsxs("div",{className:"space-y-2 mt-2",children:[a.jsx(lt,{htmlFor:"motivo-nfce",children:"Motivo"}),a.jsx(At,{id:"motivo-nfce",value:vl,onChange:D=>R(D.target.value),placeholder:"Ex.: Cliente desistiu da compra"})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>{Yi(null),R("")},children:"Voltar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!xl){Yi(null);return}const D=(vl||"").trim();if(!D){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}await ai(xl,D),Yi(null),R("")},children:"Confirmar cancelamento"})]})]})}),a.jsx(zn,{open:qt,onOpenChange:$t,children:a.jsxs(qn,{className:"max-w-[880px]",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Pr-Emisso NFC-e"}),a.jsx(la,{children:"Revise os dados e pendncias antes de emitir."})]}),De?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Gerando prvia"}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Pendncias"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>sr(D=>!D),children:ut?"Ocultar JSON":"Ver JSON"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>n("/configuracao-fiscal"),children:"Corrigir Empresa"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>zo(!0),children:"Selecionar Cliente"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>{k&&no(k)},children:"Recarregar Prvia"})]})]}),!Me||Me.length===0?a.jsx("div",{className:"text-sm text-emerald-500",children:"Nenhuma pendncia encontrada."}):a.jsx("ul",{className:"list-disc pl-5 text-sm",children:Me.map((D,K)=>a.jsx("li",{children:D},K))})]}),ut&&a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"JSON (EnviarNfce)"}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto",children:Rt?JSON.stringify(Rt,null,2):""})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>$t(!1),children:"Fechar"}),a.jsx(Z,{disabled:!0,children:"Emitir (desabilitado)"})]})]})}),a.jsx(zn,{open:wi,onOpenChange:zo,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Selecionar destinatrio"}),a.jsx(la,{children:"Busque pelo cdigo, nome ou documento e escolha a parte."})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[a.jsx("div",{className:"flex-1 min-w-[200px]",children:a.jsx(At,{placeholder:"Buscar por cdigo, nome ou documento",value:ji,onChange:D=>ec(D.target.value)})}),a.jsxs("span",{className:"text-xs text-text-secondary",children:[fr.length," itens"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[fr.map(D=>a.jsxs("div",{className:"grid grid-cols-12 items-center px-3 py-2 hover:bg-surface-2 cursor-pointer",onClick:()=>dn(D),children:[a.jsx("div",{className:"col-span-2 text-xs font-medium",children:String(D.codigo||D.codigo_cliente||D.codigo_fornecedor||D.code||"")}),a.jsx("div",{className:"col-span-6 text-sm truncate",title:D.nome||D.razao_social||"",children:D.nome||D.razao_social||"Sem nome"}),a.jsxs("div",{className:"col-span-4 text-xs text-text-secondary text-right",children:[(D.cnpj||D.cpf||"").toString()," ",D.cidade?` ${D.cidade}/${D.uf||""}`:""]})]},D.id)),fr.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhum registro encontrado"})]}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsx(Z,{variant:"outline",onClick:()=>zo(!1),children:"Fechar"})})]})}),a.jsx(zn,{open:rn,onOpenChange:un,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Selecionar produto"}),a.jsx(la,{children:"Busque pelo nome ou cdigo para preencher o item."})]}),a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(At,{placeholder:"Buscar produto por nome ou cdigo",value:dr,onChange:D=>tn(D.target.value)}),a.jsxs("span",{className:"text-xs text-text-secondary",children:[vn.length," itens"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[vn.map(D=>a.jsx("div",{className:"flex items-center justify-between px-3 py-2 hover:bg-surface-2 cursor-pointer",onClick:()=>{Dn!=null&&_n(Dn,D),un(!1)},children:a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"text-sm",children:[D.code&&a.jsxs("span",{className:"text-text-secondary mr-1",children:["[",D.code,"]"]}),a.jsx("span",{children:D.name})]}),a.jsxs("div",{className:"text-[11px] text-text-secondary",children:["R$ ",Zs(D.price??D.salePrice??0)]})]})},D.id)),vn.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhum produto encontrado"})]}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsx(Z,{variant:"outline",onClick:()=>un(!1),children:"Fechar"})})]})}),a.jsx(zn,{open:!!Oa,onOpenChange:D=>{D||us(null)},children:a.jsxs(qn,{className:"max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Remover rascunho"}),a.jsx(la,{children:"Essa ao remove definitivamente o rascunho de NF-e selecionado. Os dados no podero ser recuperados."})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>us(null),children:"Cancelar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!Oa||!t){us(null);return}try{await Q.from("notas_fiscais").delete().eq("id",Oa).eq("codigo_empresa",t),await ha(),r({title:"Rascunho removido"})}catch(D){r({title:"Falha ao remover rascunho",description:D.message,variant:"destructive"})}finally{us(null)}},children:"Remover rascunho"})]})]})}),a.jsx(zn,{open:nn,onOpenChange:Tn,children:a.jsxs(qn,{className:"w-[960px] max-w-[96vw] h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Criar NF-e (manual)"}),a.jsx(la,{children:"Vamos montar do zero."})]}),a.jsxs(Sd,{value:Kr,onValueChange:oe,className:"flex-1 overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[a.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[a.jsx("div",{className:"w-full sm:hidden",children:a.jsxs(ea,{value:Kr,onValueChange:oe,children:[a.jsx(Jn,{className:"h-9 text-xs",children:a.jsx(ra,{placeholder:"Selecionar etapa"})}),a.jsxs(Qn,{className:"text-xs",children:[a.jsx(Qe,{value:"ident",children:"Identificao"}),a.jsx(Qe,{value:"produtos",children:"Produtos"}),a.jsx(Qe,{value:"pagamentos",children:"Pagamentos"}),a.jsx(Qe,{value:"totais",children:"Totais & Impostos"}),a.jsx(Qe,{value:"transporte",children:"Transporte"}),a.jsx(Qe,{value:"resumo",children:"Resumo & Emisso"})]})]})}),a.jsxs(jc,{className:"hidden sm:inline-flex",children:[a.jsx(Ga,{value:"ident",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!ir.identOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Identificao"})]})}),a.jsx(Ga,{value:"produtos",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!ir.produtosOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Produtos"})]})}),a.jsx(Ga,{value:"pagamentos",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!ir.pagamentosOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Pagamentos"})]})}),a.jsx(Ga,{value:"totais",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!ir.totaisOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Totais & Impostos"})]})}),a.jsx(Ga,{value:"transporte",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!ir.transpOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Transporte"})]})}),a.jsx(Ga,{value:"resumo",children:"Resumo & Emisso"})]})]}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>{Va(null),sa(!0)},children:"Selecionar comanda"})]}),a.jsx(vo,{value:"ident",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Identificao da Nota"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 items-end",children:[a.jsxs("div",{className:"md:col-span-1 max-w-[210px]",children:[a.jsx(lt,{className:Za(Ae.modelo)?"text-red-400":"",children:"Tipo de Documento"}),a.jsxs(ea,{value:Ae.modelo,onValueChange:D=>et(K=>({...K,modelo:D})),children:[a.jsx(Jn,{className:`h-8 text-xs ${Za(Ae.modelo)?"border-red-500 text-red-400":""}`,children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"55",children:"55 - NF-e"}),a.jsx(Qe,{value:"65",children:"65 - NFC-e"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[190px]",children:[a.jsx(lt,{className:Za(Ae.tipo_nota)?"text-red-400":"",children:"Tipo de Operao"}),a.jsxs(ea,{value:Ae.tipo_nota,onValueChange:D=>et(K=>({...K,tipo_nota:D})),children:[a.jsx(Jn,{className:`h-8 text-xs ${Za(Ae.tipo_nota)?"border-red-500 text-red-400":""}`,children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"saida",children:"Sada"}),a.jsx(Qe,{value:"entrada",children:"Entrada"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[210px]",children:[a.jsx(lt,{className:Za(Ae.finNFe)?"text-red-400":"",children:"Finalidade"}),a.jsxs(ea,{value:Ae.finNFe,onValueChange:D=>et(K=>({...K,finNFe:D})),children:[a.jsx(Jn,{className:`h-8 text-xs ${Za(Ae.finNFe)?"border-red-500 text-red-400":""}`,children:a.jsx(ra,{placeholder:"Normal"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"1",children:"1 - Normal"}),a.jsx(Qe,{value:"2",children:"2 - Complementar"}),a.jsx(Qe,{value:"3",children:"3 - Ajuste"}),a.jsx(Qe,{value:"4",children:"4 - Devoluo"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 col-span-2 hidden sm:block",children:[a.jsx(lt,{className:Za(Ae.natOp)?"text-red-400":"",children:"Natureza da Operao"}),a.jsx(At,{className:`h-8 text-xs ${Za(Ae.natOp)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:Ae.natOp,onChange:D=>{const K=D.target.value;et(he=>({...he,natOp:K}))},placeholder:"Ex.: Venda de mercadoria"})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(lt,{className:Ae.cfop_padrao?"":"text-red-400",children:"CFOP"}),a.jsxs(ea,{value:Ae.cfop_padrao||"",onValueChange:D=>{if(D==="__novo_cfop__"){Ye({codigo:"",descricao:""}),Ct(!0);return}et(K=>{const Xe=(br||[]).find(Ue=>String(Ue.codigo)===String(D))?.descricao||"";return{...K,cfop_padrao:D,natOp:Xe||K.natOp||""}})},children:[a.jsx(Jn,{className:`h-8 text-xs ${Ae.cfop_padrao?"":"border-red-500 text-red-400"}`,children:a.jsx("span",{className:"truncate",children:Ae.cfop_padrao||"Selecione"})}),a.jsxs(Qn,{className:"max-h-72",children:[(br||[]).map(D=>a.jsxs(Qe,{value:D.codigo,children:[D.codigo," - ",D.descricao]},D.id||D.codigo)),a.jsx(Qe,{value:"__novo_cfop__",children:"+ Cadastrar novo CFOP"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(lt,{className:Za(Ae.data_emissao)?"text-red-400":"",children:"Data de Emisso"}),a.jsx(MV,{label:"Selecione",value:Ae.data_emissao,onChange:D=>et(K=>({...K,data_emissao:D}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(lt,{children:"Data Sada/Entrada"}),a.jsx(MV,{label:"Selecione",value:Ae.data_saida,onChange:D=>et(K=>({...K,data_saida:D}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[120px]",children:[a.jsx(lt,{className:Za(Ae.serie)?"text-red-400":"",children:"Srie"}),a.jsx(At,{className:`h-8 text-xs ${Za(Ae.serie)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:Ae.serie,onChange:D=>et(K=>({...K,serie:D.target.value}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[140px]",children:[a.jsx(lt,{children:"Nmero"}),a.jsx(At,{className:"h-8 text-xs",value:Ae.nNF,onChange:D=>et(K=>({...K,nNF:D.target.value})),placeholder:"automtico"})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(lt,{className:Za(Ae.idDest)?"text-red-400":"",children:"Destino da Operao"}),a.jsxs(ea,{value:Ae.idDest||"auto",onValueChange:D=>et(K=>({...K,idDest:D==="auto"?"":D})),children:[a.jsx(Jn,{className:`h-8 text-xs ${Za(Ae.idDest)?"border-red-500 text-red-400":""}`,children:a.jsx(ra,{placeholder:"Automtico"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"auto",children:"Automtico"}),a.jsx(Qe,{value:"1",children:"1 - Interna (mesmo estado)"}),a.jsx(Qe,{value:"2",children:"2 - Interestadual"}),a.jsx(Qe,{value:"3",children:"3 - Exterior"})]})]})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(lt,{className:Za(Ae.indFinal)?"text-red-400":"",children:"Consumidor Final"}),a.jsxs(ea,{value:Ae.indFinal??"",onValueChange:D=>et(K=>({...K,indFinal:D})),children:[a.jsx(Jn,{className:`h-8 text-xs ${Za(Ae.indFinal)?"border-red-500 text-red-400":""}`,children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"1",children:"Sim"}),a.jsx(Qe,{value:"0",children:"No"})]})]})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(lt,{className:Za(Ae.indPres)?"text-red-400":"",children:"Presena do Comprador"}),a.jsxs(ea,{value:Ae.indPres??"",onValueChange:D=>et(K=>({...K,indPres:D})),children:[a.jsx(Jn,{className:`h-8 text-xs ${Za(Ae.indPres)?"border-red-500 text-red-400":""}`,children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"1",children:"1 - Operao presencial"}),a.jsx(Qe,{value:"2",children:"2 - No presencial, internet"}),a.jsx(Qe,{value:"4",children:"4 - Entrega em domiclio"}),a.jsx(Qe,{value:"9",children:"9 - No se aplica"})]})]})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Emitente (Empresa)"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"CNPJ"}),a.jsx("div",{className:"text-text-primary",children:Pe?.cnpj||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"Inscrio Estadual"}),a.jsx("div",{className:"text-text-primary",children:Pe?.inscricao_estadual||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"Regime Tributrio"}),a.jsx("div",{className:"text-text-primary",children:Pe?.regime_tributario||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Razo Social"}),a.jsx("div",{className:"text-text-primary",children:Pe?.razao_social||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Nome Fantasia"}),a.jsx("div",{className:"text-text-primary",children:Pe?.nome_fantasia||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Endereo"}),a.jsx("div",{className:"text-text-primary",children:Pe?`${Pe.logradouro||Pe.endereco||""} ${Pe.numero||""} ${Pe.bairro||""} - ${Pe.cidade||""}/${Pe.uf||""}  CEP ${Pe.cep||""}`.trim():""})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Destinatrio"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx(At,{className:"h-8 text-xs w-full",placeholder:"Nome, cdigo, CPF ou CNPJ",value:ji,onChange:D=>ec(D.target.value)})}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-8 w-8 flex-shrink-0",onClick:()=>zo(!0),children:a.jsx(Yo,{className:"w-4 h-4"})})]})]}),(ji||"").trim().length>0&&fr.length>0&&a.jsx("div",{className:"border border-border rounded-md mb-3 max-h-40 overflow-y-auto text-xs",children:fr.slice(0,8).map(D=>a.jsxs("div",{className:"flex items-center justify-between px-2 py-1 hover:bg-surface-2 cursor-pointer",onClick:()=>dn(D),children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium truncate max-w-[220px]",children:D.nome||D.razao_social||"Sem nome"}),a.jsx("span",{className:"text-text-secondary truncate max-w-[220px]",children:(D.cnpj||D.cpf||"").toString()})]}),a.jsx("span",{className:"text-[10px] text-text-secondary ml-2",children:D.is_fornecedor?"Fornecedor":"Cliente"})]},D.id))}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"Tipo de Pessoa"}),a.jsxs(ea,{value:Ae.tipo_pessoa,onValueChange:D=>et(K=>({...K,tipo_pessoa:D})),children:[a.jsx(Jn,{children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"PF",children:"Pessoa Fsica"}),a.jsx(Qe,{value:"PJ",children:"Pessoa Jurdica"})]})]})]}),a.jsxs("div",{className:"col-span-2 md:col-span-1",children:[a.jsx(lt,{className:Za(Ae.cpf_cnpj)?"text-red-400":"",children:Ae.tipo_pessoa==="PF"?"CPF":"CNPJ"}),a.jsx(At,{className:Za(Ae.cpf_cnpj)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.cpf_cnpj,onChange:D=>et(K=>({...K,cpf_cnpj:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.nome)?"text-red-400":"",children:"Nome/Razo Social"}),a.jsx(At,{className:Za(Ae.nome)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.nome,onChange:D=>et(K=>({...K,nome:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.indIEDest)?"text-red-400":"",children:"Indicador de IE"}),a.jsxs(ea,{value:Ae.indIEDest||"9",onValueChange:D=>et(K=>({...K,indIEDest:D,ie_isento:D==="2",inscricao_estadual:D==="2"?"ISENTO":K.inscricao_estadual})),children:[a.jsx(Jn,{className:Za(Ae.indIEDest)?"border-red-500 text-red-400":"",children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"1",children:"Contribuinte"}),a.jsx(Qe,{value:"2",children:"Isento"}),a.jsx(Qe,{value:"9",children:"No Contribuinte"})]})]})]}),a.jsxs("div",{className:"col-span-2 md:col-span-1",children:[a.jsx(lt,{children:"Inscrio Estadual"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(At,{value:Ae.ie_isento?"ISENTO":Ae.inscricao_estadual||"",onChange:D=>et(K=>({...K,inscricao_estadual:D.target.value,ie_isento:String(D.target.value||"").toUpperCase()==="ISENTO"}))}),a.jsx(Z,{type:"button",size:"sm",variant:Ae.ie_isento?"default":"outline",onClick:()=>et(D=>({...D,ie_isento:!0,inscricao_estadual:"ISENTO",indIEDest:"2"})),children:"ISENTO"})]})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.cep)?"text-red-400":"",children:"CEP"}),a.jsx(At,{className:Za(Ae.cep)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.cep,onChange:D=>et(K=>({...K,cep:D.target.value})),onBlur:()=>Dr(Ae.cep)})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(lt,{className:Za(Ae.logradouro)?"text-red-400":"",children:"Logradouro"}),a.jsx(At,{className:Za(Ae.logradouro)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.logradouro,onChange:D=>et(K=>({...K,logradouro:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.numero)?"text-red-400":"",children:"Nmero"}),a.jsx(At,{className:Za(Ae.numero)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.numero,onChange:D=>et(K=>({...K,numero:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.bairro)?"text-red-400":"",children:"Bairro"}),a.jsx(At,{className:Za(Ae.bairro)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.bairro,onChange:D=>et(K=>({...K,bairro:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.cidade)?"text-red-400":"",children:"Cidade"}),a.jsx(At,{className:Za(Ae.cidade)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.cidade,onChange:D=>et(K=>({...K,cidade:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.uf)?"text-red-400":"",children:"UF"}),a.jsx(At,{className:Za(Ae.uf)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Ae.uf,onChange:D=>et(K=>({...K,uf:(D.target.value||"").toUpperCase().slice(0,2)}))})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.codigo_municipio_ibge)?"text-red-400":"",children:"Cdigo IBGE"}),a.jsx(At,{className:`h-8 text-xs ${Za(Ae.codigo_municipio_ibge)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:Ae.codigo_municipio_ibge,onChange:D=>et(K=>({...K,codigo_municipio_ibge:D.target.value})),placeholder:"Ex.: 3550308"})]})]})]})]})}),a.jsx(vo,{value:"produtos",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",onClick:()=>{et(D=>{const K={descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:D.cfop_padrao||"5102",unidade:"UN",quantidade:"1",preco_unitario:"0,00",desconto_valor:"0,00",desconto_percent:"",acrescimos_valor:"0,00",frete_valor:"0,00",seguro_valor:"0,00",obs:"",impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""}}};return{...D,itens:[...D.itens,K]}})},children:"Adicionar item"})}),a.jsx("div",{className:"border border-border rounded-md overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 py-2",children:"Produto"}),a.jsx("th",{className:"text-center px-2 py-2 w-[80px]",children:"Qtd"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"V. Unit"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"Desconto"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"Total"}),a.jsx("th",{className:"text-center px-2 py-2 w-[180px]",children:"Aes"})]})}),a.jsxs("tbody",{children:[Ae.itens.map((D,K)=>{const he=Ee(D.preco_unitario)||0,Xe=Ee(D.quantidade)||1,Ue=he*Xe,Et=Ee(D.desconto_percent)||0,Dt=Ee(D.desconto_valor)||0,Mt=Et?Ue*Et/100:Dt,jt=Math.max(0,Ue-Mt+(Ee(D.acrescimos_valor)||0));return a.jsxs(Ce.Fragment,{children:[a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsxs("td",{className:"px-2 py-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(At,{className:"h-7 text-xs flex-1",value:D.descricao,onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens];return Yt[K]={...Yt[K],descricao:Ve.target.value},{...Bt,itens:Yt}}),placeholder:"Descrio"}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7 flex-shrink-0",title:"Buscar produto",onClick:()=>{fa(K),un(!0)},children:a.jsx(Yo,{className:"w-3.5 h-3.5"})})]}),a.jsxs("div",{className:"text-[10px] text-text-secondary",children:[D.codigo||"","  UN ",String(D.unidade||"UN")]})]}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[80px] mx-auto",children:a.jsx(At,{className:"h-7 text-right text-xs",value:D.quantidade,onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens];return Yt[K]={...Yt[K],quantidade:Ve.target.value},{...Bt,itens:Yt}})})})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[110px] mx-auto",children:a.jsx(At,{className:"h-7 text-right text-xs",value:D.preco_unitario,onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur=hr(Ve.target.value||"");return Yt[K]={...Yt[K],preco_unitario:Ur},{...Bt,itens:Yt}}),onKeyDown:Ve=>{Ve.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ve.key)&&(/^[0-9]$/.test(Ve.key)||Ve.preventDefault())},onBeforeInput:Ve=>{const Bt=Ve.data??"";Bt&&/\D/.test(Bt)&&Ve.preventDefault()}})})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[110px] mx-auto",children:a.jsx(At,{className:"h-7 text-right text-xs",value:D.desconto_valor,onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur=hr(Ve.target.value||"");return Yt[K]={...Yt[K],desconto_valor:Ur,desconto_percent:""},{...Bt,itens:Yt}}),onKeyDown:Ve=>{Ve.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ve.key)&&(/^[0-9]$/.test(Ve.key)||Ve.preventDefault())},onBeforeInput:Ve=>{const Bt=Ve.data??"";Bt&&/\D/.test(Bt)&&Ve.preventDefault()}})})}),a.jsxs("td",{className:"px-2 py-1 text-right",children:["R$ ",Zs(jt)]}),a.jsx("td",{className:"px-2 py-1 text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(()=>{const Ve=D.impostos||{},Bt=Ve.icms||{},Yt=Ve.pis||{},Ur=Ve.cofins||{};return Ve.origem&&(Bt.cst||Bt.csosn)&&Yt.aliquota!==void 0&&String(Yt.aliquota).trim()!==""&&Ur.aliquota!==void 0&&String(Ur.aliquota).trim()!==""?null:a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"})})(),a.jsx(Z,{size:"sm",variant:"outline",className:"h-7",onClick:()=>Tl(Xi===K?null:K),children:Xi===K?"Ocultar":"Detalhes"}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-7",onClick:()=>{et(Ve=>{const Bt=[...Ve.itens];return Bt.splice(K,1),{...Ve,itens:Bt}})},children:"Remover"})]})})]}),Xi===K&&a.jsx("tr",{className:"border-t border-border/60 bg-surface-2/40",children:a.jsx("td",{colSpan:6,className:"px-2 py-2",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"NCM"}),a.jsx(At,{className:"h-7 text-xs",value:D.ncm||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens];return Yt[K]={...Yt[K],ncm:Ve.target.value},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"CFOP"}),a.jsx(At,{className:"h-7 text-xs",value:D.cfop||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens];return Yt[K]={...Yt[K],cfop:Ve.target.value},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(D.impostos?.icms?.cst)&&Za(D.impostos?.icms?.csosn)?"text-red-400":"",children:"CST/CSOSN"}),a.jsx(At,{className:`h-7 text-xs ${Za(D.impostos?.icms?.cst)&&Za(D.impostos?.icms?.csosn)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.icms?.cst||D.impostos?.icms?.csosn||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur={...Yt[K].impostos||{},icms:{...Yt[K].impostos?.icms||{},cst:Ve.target.value,csosn:Ve.target.value}};return Yt[K]={...Yt[K],impostos:Ur},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(D.impostos?.origem)?"text-red-400":"",children:"Origem"}),a.jsx(At,{className:`h-7 text-xs ${Za(D.impostos?.origem)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.origem||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur={...Yt[K].impostos||{},origem:Ve.target.value};return Yt[K]={...Yt[K],impostos:Ur},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"ICMS %"}),a.jsx(At,{className:"h-7 text-xs",value:D.impostos?.icms?.aliquota||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur={...Yt[K].impostos?.icms||{},aliquota:Ve.target.value};return Yt[K]={...Yt[K],impostos:{...Yt[K].impostos||{},icms:Ur}},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"ICMS Base"}),a.jsx(At,{className:"h-7 text-xs",value:D.impostos?.icms?.base||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur={...Yt[K].impostos?.icms||{},base:Ve.target.value};return Yt[K]={...Yt[K],impostos:{...Yt[K].impostos||{},icms:Ur}},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(D.impostos?.pis?.aliquota)?"text-red-400":"",children:"PIS %"}),a.jsx(At,{className:`h-7 text-xs ${Za(D.impostos?.pis?.aliquota)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.pis?.aliquota||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur={...Yt[K].impostos?.pis||{},aliquota:Ve.target.value};return Yt[K]={...Yt[K],impostos:{...Yt[K].impostos||{},pis:Ur}},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{className:Za(D.impostos?.cofins?.aliquota)?"text-red-400":"",children:"COFINS %"}),a.jsx(At,{className:`h-7 text-xs ${Za(D.impostos?.cofins?.aliquota)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.cofins?.aliquota||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur={...Yt[K].impostos?.cofins||{},aliquota:Ve.target.value};return Yt[K]={...Yt[K],impostos:{...Yt[K].impostos||{},cofins:Ur}},{...Bt,itens:Yt}})})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"IPI %"}),a.jsx(At,{className:"h-7 text-xs",value:D.impostos?.ipi?.aliquota||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens],Ur={...Yt[K].impostos?.ipi||{},aliquota:Ve.target.value};return Yt[K]={...Yt[K],impostos:{...Yt[K].impostos||{},ipi:Ur}},{...Bt,itens:Yt}})})]}),a.jsxs("div",{className:"md:col-span-4",children:[a.jsx(lt,{children:"Observao do item"}),a.jsx(At,{className:"h-7 text-xs",value:D.obs||"",onChange:Ve=>et(Bt=>{const Yt=[...Bt.itens];return Yt[K]={...Yt[K],obs:Ve.target.value},{...Bt,itens:Yt}})})]})]})})})]},K)}),Ae.itens.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"px-2 py-3 text-center text-text-secondary",children:'Nenhum item. Use "Adicionar item" para inserir.'})})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"Desconto Geral"}),a.jsx(At,{className:"h-8 text-xs text-right",value:Ae.totais.desconto_geral,onChange:D=>et(K=>({...K,totais:{...K.totais,desconto_geral:hr(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const K=D.data??"";K&&/\D/.test(K)&&D.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Frete"}),a.jsx(At,{className:"h-8 text-xs text-right",value:Ae.totais.frete,onChange:D=>et(K=>({...K,totais:{...K.totais,frete:hr(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const K=D.data??"";K&&/\D/.test(K)&&D.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Outras Despesas"}),a.jsx(At,{className:"h-8 text-xs text-right",value:Ae.totais.outras_despesas,onChange:D=>et(K=>({...K,totais:{...K.totais,outras_despesas:hr(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const K=D.data??"";K&&/\D/.test(K)&&D.preventDefault()}})]}),a.jsx("div",{className:"text-right self-end",children:(()=>{const D=Ae.itens||[];let K=0;D.forEach(Dt=>{const Mt=Ee(Dt.preco_unitario)||0,jt=Ee(Dt.quantidade)||1,Ve=Mt*jt,Bt=Ee(Dt.desconto_percent)||0,Yt=Ee(Dt.desconto_valor)||0,Ur=Bt?Ve*Bt/100:Yt,jr=Math.max(0,Ve-Ur+(Ee(Dt.acrescimos_valor)||0));K+=jr});const he=Ee(Ae.totais.desconto_geral)||0,Xe=Ee(Ae.totais.frete)||0,Ue=Ee(Ae.totais.outras_despesas)||0,Et=K-he+Xe+Ue;return a.jsxs("div",{className:"text-sm",children:[a.jsx("div",{className:"text-text-secondary",children:"Total dos Produtos"}),a.jsxs("div",{className:"text-xl font-semibold",children:["R$ ",Zs(K)]}),a.jsx("div",{className:"text-text-secondary mt-1",children:"Total da Nota"}),a.jsxs("div",{className:"text-xl font-semibold",children:["R$ ",Zs(Et)]})]})})()})]})]})}),a.jsx(vo,{value:"pagamentos",children:(()=>{const D=Ae.itens||[];let K=0;D.forEach((Ur,jr)=>{const mn=Ee(Ur.preco_unitario)||0,en=Ee(Ur.quantidade)||1,Yr=mn*en,gn=Ee(Ur.desconto_percent)||0,Yn=Ee(Ur.desconto_valor)||0,Hn=gn?Yr*gn/100:Yn,ns=Ee(Ur.acrescimos_valor)||0,Do=Math.max(0,Yr-Hn+ns);K+=Do});const he=Ee(Ae.totais.desconto_geral)||0,Xe=Ee(Ae.totais.frete)||0,Ue=Ee(Ae.totais.outras_despesas)||0,Et=K-he+Xe+Ue,Dt=Ae.pagamentos||[],Mt=Dt.reduce((Ur,jr)=>Ur+(Ee(jr.valor)||0),0),jt=(Mt||0)-(Et||0),Ve=()=>{et(Ur=>{const jr=Array.isArray(Ur.pagamentos)?[...Ur.pagamentos]:[],mn=Et||0;return jr.push({finalizadora_id:"",tipo:"Dinheiro",valor:hr(mn.toFixed(2)),bandeira:"",autorizacao:"",parcelas:"",troco:""}),{...Ur,pagamentos:jr}})},Bt=Ur=>{et(jr=>{const mn=Array.isArray(jr.pagamentos)?[...jr.pagamentos]:[];return mn.splice(Ur,1),{...jr,pagamentos:mn}})},Yt=(Ur,jr)=>{et(mn=>{const en=Array.isArray(mn.pagamentos)?[...mn.pagamentos]:[],Yr=hr(jr||"");return en[Ur]={...en[Ur]||{},valor:Yr},{...mn,pagamentos:en}})};return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Formas de pagamento"}),a.jsx(Z,{size:"sm",onClick:Ve,children:"Adicionar pagamento"})]}),a.jsx("div",{className:"border border-border rounded-md overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 py-2",children:"Forma"}),a.jsx("th",{className:"text-left px-2 py-2 w-[180px]",children:"Bandeira / Autorizao"}),a.jsx("th",{className:"text-right px-2 py-2 w-[140px]",children:"Valor"}),a.jsx("th",{className:"text-center px-2 py-2 w-[80px]",children:"Aes"})]})}),a.jsxs("tbody",{children:[Dt.map((Ur,jr)=>{const mn=(Hs||[]).find(en=>String(en.id)===String(Ur.finalizadora_id));return a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsxs("td",{className:"px-2 py-1",children:[a.jsxs("select",{className:"h-7 text-xs bg-surface border border-border rounded-md px-1 w-full",value:Ur.finalizadora_id||"",onChange:en=>et(Yr=>{const gn=Array.isArray(Yr.pagamentos)?[...Yr.pagamentos]:[],Yn=en.target.value||"",Hn=(Hs||[]).find(ns=>String(ns.id)===String(Yn));return gn[jr]={...gn[jr]||{},finalizadora_id:Yn,tipo:Hn?.nome||gn[jr]?.tipo||""},{...Yr,pagamentos:gn}}),children:[a.jsx("option",{value:"",children:"Selecione"}),(Hs||[]).map(en=>a.jsxs("option",{value:en.id,children:[en.codigo_interno?`[${en.codigo_interno}] `:"",en.nome]},en.id))]}),a.jsx("div",{className:"text-[10px] text-text-secondary truncate",children:Ur.tipo||mn?.nome||""})]}),a.jsx("td",{className:"px-2 py-1",children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx(At,{className:"h-7 text-xs",placeholder:"Bandeira (Visa, Master...)",value:Ur.bandeira||"",onChange:en=>et(Yr=>{const gn=Array.isArray(Yr.pagamentos)?[...Yr.pagamentos]:[];return gn[jr]={...gn[jr]||{},bandeira:en.target.value},{...Yr,pagamentos:gn}})}),a.jsx(At,{className:"h-7 text-xs",placeholder:"N autorizao (opcional)",value:Ur.autorizacao||"",onChange:en=>et(Yr=>{const gn=Array.isArray(Yr.pagamentos)?[...Yr.pagamentos]:[];return gn[jr]={...gn[jr]||{},autorizacao:en.target.value},{...Yr,pagamentos:gn}})})]})}),a.jsx("td",{className:"px-2 py-1 text-right",children:a.jsx(At,{className:"h-7 text-right text-xs",value:Ur.valor||"0,00",onChange:en=>Yt(jr,en.target.value),onKeyDown:en=>{en.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(en.key)&&(/^[0-9]$/.test(en.key)||en.preventDefault())},onBeforeInput:en=>{const Yr=en.data??"";Yr&&/\D/.test(Yr)&&en.preventDefault()}})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>Bt(jr),children:a.jsx(Sc,{className:"w-3.5 h-3.5"})})})]},jr)}),Dt.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"px-2 py-3 text-center text-text-secondary text-xs",children:'Nenhum pagamento. Use "Adicionar pagamento".'})})]})]})}),a.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-3 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Total da Nota:"})," ",a.jsxs("span",{className:"font-semibold",children:["R$ ",Zs(Et)]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Total Pago:"})," ",a.jsxs("span",{className:"font-semibold",children:["R$ ",Zs(Mt)]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Diferena (Pago - Nota)"}),a.jsxs("div",{className:Math.abs(jt)<.009?"font-semibold text-emerald-500":"font-semibold text-amber-500",children:["R$ ",Zs(jt)]})]})]})]})})()}),a.jsx(vo,{value:"transporte",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Transporte"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[a.jsxs("div",{children:[a.jsx(lt,{className:Za(Ae.transporte?.tipo_frete)?"text-red-400":"",children:"Modalidade do Frete"}),a.jsxs(ea,{value:Ae.transporte?.tipo_frete||"9",onValueChange:D=>et(K=>({...K,transporte:{...K.transporte||{},tipo_frete:D}})),children:[a.jsx(Jn,{className:`h-8 text-xs ${Za(Ae.transporte?.tipo_frete)?"border-red-500 text-red-400":""}`,children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"0",children:"Por conta do Emitente"}),a.jsx(Qe,{value:"1",children:"Por conta do Destinatrio"}),a.jsx(Qe,{value:"9",children:"Sem Frete"})]})]})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx(lt,{children:"Transportadora (se houver)"}),a.jsx(At,{className:"h-8 text-xs",value:Ae.transporte?.transportadora||"",onChange:D=>et(K=>({...K,transporte:{...K.transporte||{},transportadora:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Placa do Veculo"}),a.jsx(At,{className:"h-8 text-xs",value:Ae.transporte?.placa||"",onChange:D=>et(K=>({...K,transporte:{...K.transporte||{},placa:(D.target.value||"").toUpperCase()}})),placeholder:"ABC1D23"})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"UF da Placa"}),a.jsx(At,{className:"h-8 text-xs",value:Ae.transporte?.uf_placa||"",onChange:D=>et(K=>({...K,transporte:{...K.transporte||{},uf_placa:(D.target.value||"").toUpperCase().slice(0,2)}})),placeholder:"UF"})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Qtd. de Volumes"}),a.jsx(At,{className:"h-8 text-xs",value:Ae.transporte?.volumes||"",onChange:D=>et(K=>({...K,transporte:{...K.transporte||{},volumes:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Peso Bruto (kg)"}),a.jsx(At,{className:"h-8 text-xs",value:Ae.transporte?.peso_bruto||"",onChange:D=>et(K=>({...K,transporte:{...K.transporte||{},peso_bruto:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Peso Lquido (kg)"}),a.jsx(At,{className:"h-8 text-xs",value:Ae.transporte?.peso_liquido||"",onChange:D=>et(K=>({...K,transporte:{...K.transporte||{},peso_liquido:D.target.value}}))})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Informaes Adicionais"}),a.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"Observaes Fiscais"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:Ae.adicionais?.info_fisco||"",onChange:D=>et(K=>({...K,adicionais:{...K.adicionais||{},info_fisco:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Informaes Complementares"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:Ae.adicionais?.obs_gerais||"",onChange:D=>et(K=>({...K,adicionais:{...K.adicionais||{},obs_gerais:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Observaes Legais"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:Ae.adicionais?.obs_legais||"",onChange:D=>et(K=>({...K,adicionais:{...K.adicionais||{},obs_legais:D.target.value}}))})]})]})]})]})}),a.jsx(vo,{value:"totais",children:(()=>{const D=Ae.itens||[];let K=0,he=0,Xe=0,Ue=0,Et=0,Dt=0,Mt=0,jt=0,Ve=0,Bt=0;D.forEach(Yn=>{const Hn=Ee(Yn.preco_unitario)||0,ns=Ee(Yn.quantidade)||1,Do=Hn*ns,Ta=Ee(Yn.desconto_percent)||0,Kn=Ee(Yn.desconto_valor)||0,ao=Ta?Do*Ta/100:Kn,Ms=Ee(Yn.acrescimos_valor)||0,bs=Math.max(0,Do-ao+Ms);K+=bs,he+=ao;const Xn=Ee(Yn.impostos?.icms?.base)||bs,pa=Ee(Yn.impostos?.icms?.aliquota)||0,ps=Xn*pa/100;Xe+=Xn,Ue+=ps;const qs=Ee(Yn.impostos?.pis?.aliquota)||0,Ji=Ee(Yn.impostos?.cofins?.aliquota)||0,kc=Ee(Yn.impostos?.ipi?.aliquota)||0;Et+=bs*qs/100,Dt+=bs*Ji/100,Mt+=bs*kc/100,jt+=Ee(Yn.frete_valor)||0,Ve+=Ee(Yn.seguro_valor)||0,Bt+=Ms});const Yt=Ee(Ae.totais.desconto_geral)||0,Ur=Ee(Ae.totais.frete)||0,jr=Ee(Ae.totais.outras_despesas)||0,mn=jt+Ur,en=Ve,Yr=Bt+jr,gn=K-Yt+mn+en+Yr;return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Total dos Produtos"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",Zs(K)]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Total de Descontos"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",Zs(he+Yt)]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Valor Total da Nota"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",Zs(gn)]})]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface space-y-3",children:[a.jsx("div",{className:"text-sm font-medium mb-1",children:"ICMS / PIS / COFINS / IPI"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 text-xs",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Base de Clculo ICMS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(Xe)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do ICMS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(Ue)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do PIS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(Et)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do COFINS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(Dt)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do IPI"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(Mt)]})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface space-y-2 text-xs",children:[a.jsx("div",{className:"text-sm font-medium mb-1",children:"Outros Valores"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Frete"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(mn)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Seguro"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(en)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Outras Despesas"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(Yr)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Desconto Geral"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",Zs(Yt)]})]})]})]})]})})()}),a.jsx(vo,{value:"resumo",children:(()=>{const D=Ae.itens||[];let K=0;D.forEach(ba=>{const Qa=Ee(ba.preco_unitario)||0,so=Ee(ba.quantidade)||1,_i=Qa*so,nd=Ee(ba.desconto_percent)||0,ad=Ee(ba.desconto_valor)||0,Rl=nd?_i*nd/100:ad,Iu=Ee(ba.acrescimos_valor)||0,Ou=Math.max(0,_i-Rl+Iu);K+=Ou});const he=Ee(Ae.totais?.desconto_geral)||0,Xe=Ee(Ae.totais?.frete)||0,Ue=Ee(Ae.totais?.outras_despesas)||0,Et=K-he+Xe+Ue,Dt=(Ae.pagamentos||[]).reduce((ba,Qa)=>ba+(Ee(Qa.valor)||0),0),Mt=Dt-Et,jt=String(Ae.modelo)==="65",Ve=String(Ae.modelo)==="55",Bt=!!(Ae.modelo&&Ae.serie&&Ae.natOp&&Ae.data_emissao&&Ae.tipo_nota&&Ae.idDest&&(Ae.indFinal??"")!==""&&(Ae.indPres??"")!==""&&Ae.finNFe&&Ae.cfop_padrao),Yt=Pe?.cidade_ibge||Pe?.codigo_municipio_ibge||Pe?.codigo_ibge_municipio||Pe?.ibge||Pe?.cod_municipio||"",Ur=!!(Pe&&Pe.cnpj&&Pe.razao_social&&Pe.regime_tributario&&Pe.inscricao_estadual&&Pe.logradouro&&(Pe.numero||Pe.nro)&&Pe.bairro&&Pe.cidade&&Pe.uf&&Pe.cep&&Yt),jr=!!(Ae?.nome||Ae?.cpf_cnpj),mn=Ve,en=!!(Ae?.cpf_cnpj&&Ae?.nome&&Ae?.indIEDest&&Ae?.logradouro&&Ae?.numero&&Ae?.bairro&&Ae?.cidade&&Ae?.uf&&Ae?.cep),Yr=mn||jr?en:!0,gn=Array.isArray(D)&&D.length>0,Yn=gn&&D.every(ba=>(ba.codigo||ba.descricao)&&ba.ncm&&ba.cfop&&ba.unidade&&Ee(ba.quantidade)>0&&(ba.preco_unitario||ba.preco_unitario==="0,00")),Hn=gn&&D.every(ba=>{const Qa=ba.impostos||{},so=Qa.icms||{},_i=Qa.pis||{},nd=Qa.cofins||{},ad=!!(Qa.origem!==void 0&&Qa.origem!==""&&(so.cst||so.csosn)),Rl=_i.aliquota!==void 0&&String(_i.aliquota).trim()!=="",Iu=nd.aliquota!==void 0&&String(nd.aliquota).trim()!=="";return ad&&Rl&&Iu}),ns=(()=>{let ba=0;return D.forEach(Qa=>{const so=(Ee(Qa.preco_unitario)||0)*(Ee(Qa.quantidade)||1)-(Ee(Qa.desconto_percent)?(Ee(Qa.preco_unitario)||0)*(Ee(Qa.quantidade)||1)*(Ee(Qa.desconto_percent)||0)/100:Ee(Qa.desconto_valor)||0)+(Ee(Qa.acrescimos_valor)||0),_i=Ee(Qa.impostos?.icms?.base);ba+=isFinite(_i)&&_i>0?_i:so}),ba})(),Do=D.reduce((ba,Qa)=>ba+(Ee(Qa.impostos?.icms?.base)||(Ee(Qa.preco_unitario)||0)*(Ee(Qa.quantidade)||1))*(Ee(Qa.impostos?.icms?.aliquota)||0)/100,0),Ta=D.reduce((ba,Qa)=>ba+(Ee(Qa.preco_unitario)||0)*(Ee(Qa.quantidade)||1)*(Ee(Qa.impostos?.pis?.aliquota)||0)/100,0),Kn=D.reduce((ba,Qa)=>ba+(Ee(Qa.preco_unitario)||0)*(Ee(Qa.quantidade)||1)*(Ee(Qa.impostos?.cofins?.aliquota)||0)/100,0),ao=D.reduce((ba,Qa)=>ba+(Ee(Qa.preco_unitario)||0)*(Ee(Qa.quantidade)||1)*(Ee(Qa.impostos?.ipi?.aliquota)||0)/100,0),Ms=Do+Ta+Kn+ao,bs=[Et,ns,Do,Ta,Kn,ao,Xe,he,Ue,Ms].every(ba=>ba!=null&&!Number.isNaN(ba)),Xn=!!(Ae.transporte&&Ae.transporte.tipo_frete),pa=Dt+.009>=Et,qs=!(jt&&(Ae.pagamentos||[]).some(ba=>{const Qa=(Hs||[]).find(_i=>String(_i.id)===String(ba.finalizadora_id)),so=String(ba.tipo||Qa?.nome||"").toLowerCase();return so.includes("cart")||so.includes("crdit")||so.includes("credit")||so.includes("db")||so.includes("deb")}))||(Ae.pagamentos||[]).every(ba=>{const Qa=(Hs||[]).find(nd=>String(nd.id)===String(ba.finalizadora_id)),so=String(ba.tipo||Qa?.nome||"").toLowerCase();return!(so.includes("cart")||so.includes("crdit")||so.includes("credit")||so.includes("db")||so.includes("deb"))||!!(ba.bandeira&&ba.bandeira.trim())}),Ji=jt?(Ae.pagamentos||[]).length>0&&pa&&qs:!0,kc=Bt&&Ur&&gn&&Yn&&Hn&&bs&&Xn&&Yr&&Ji,Ml=({ok:ba,label:Qa,extra:so})=>a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border/60 last:border-b-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[ba?a.jsx(yb,{className:"w-4 h-4 text-emerald-500"}):a.jsx(Jf,{className:"w-4 h-4 text-amber-500"}),a.jsx("div",{className:"text-sm",children:Qa})]}),so?a.jsx("div",{className:"text-xs text-text-secondary",children:so}):null]});return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface",children:[a.jsx("div",{className:"text-sm font-medium px-3 py-2",children:"Checklist"}),a.jsxs("div",{children:[a.jsx(Ml,{ok:Bt,label:"Identificao"}),a.jsx(Ml,{ok:Ur,label:"Emitente"}),a.jsx(Ml,{ok:Yr,label:"Destinatrio",extra:jt&&!jr?"Opcional na NFC-e":Ae?.nome||""}),a.jsx(Ml,{ok:gn,label:"Itens",extra:`${D.length} item(ns)`}),a.jsx(Ml,{ok:Yn,label:"Produtos completos"}),a.jsx(Ml,{ok:Hn,label:"Impostos por item"}),a.jsx(Ml,{ok:bs,label:"Totais"}),a.jsx(Ml,{ok:Xn,label:"Transporte"}),a.jsx(Ml,{ok:Ji,label:"Pagamento",extra:jt?`Pago R$ ${Zs(Dt)}  Nota R$ ${Zs(Et)}`:void 0})]})]}),a.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-3",children:[a.jsxs("div",{className:"text-sm text-text-secondary",children:[a.jsxs("div",{children:["Total da Nota: ",a.jsxs("span",{className:"text-text-primary font-semibold",children:["R$ ",Zs(Et)]})]}),a.jsxs("div",{children:["Total Pago: ",a.jsxs("span",{className:"text-text-primary font-semibold",children:["R$ ",Zs(Dt)]})]}),a.jsxs("div",{children:["Diferena: ",a.jsxs("span",{className:Math.abs(Mt)<.009?"text-emerald-500 font-semibold":"text-amber-500 font-semibold",children:["R$ ",Zs(Mt)]})]})]}),a.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:async()=>{const ba=[];Bt||ba.push("Preencha os dados de identificao da nota"),Ur||ba.push("Complete os dados da empresa (CNPJ, endereo, inscrio, regime)"),Yr||ba.push(Ve?"Informe os dados do destinatrio":"Revise os dados do destinatrio preenchidos"),gn||ba.push("Adicione pelo menos um item na nota"),Yn||ba.push("Revise os campos obrigatrios dos itens (produto, NCM, CFOP, unidade, quantidade, preo)"),Hn||ba.push("Preencha os impostos de todos os itens (origem, ICMS, PIS e COFINS)"),bs||ba.push("Verifique os totais da nota"),Xn||ba.push("Informe a modalidade do frete em Transporte"),Ji||ba.push("Revise a forma de pagamento e o valor pago"),ba.length?r({title:"Ainda faltam dados para emitir",description:ba.join("  "),variant:"warning"}):r({title:"Tudo certo",description:"A nota est pronta para emitir",variant:"success"})},children:"Validar Nota"}),a.jsx(Z,{size:"sm",disabled:!kc||xn,onClick:async()=>{on(!0);try{await er()}finally{on(!1)}},children:xn?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(ll,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Emitir Nota"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:ft,children:"Salvar Rascunho"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>Tn(!1),children:"Cancelar Emisso"})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3 text-xs text-text-secondary",children:[a.jsx("div",{className:"mb-1 font-medium text-text-primary",children:"Ps-Emisso"}),a.jsx("div",{children:"Aps a emisso, exibiremos o status SEFAZ, chave de acesso, links do XML e DANFE, e opes de envio por e-mail ou WhatsApp."})]})]})})()})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{onClick:ft,disabled:Br,children:Br?"Salvando...":"Salvar rascunho"}),a.jsx(Z,{variant:"outline",onClick:()=>Tn(!1),children:"Fechar"})]}),!1]})}),a.jsx(zn,{open:As,onOpenChange:rc,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-[800px] max-h-[85vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"XML gerado"}),a.jsx(la,{children:"Faa o download ou salve no Supabase."})]}),a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Prvia do XML"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>RV(`nfe-manual-${Date.now()}.xml`,Gn),children:"Baixar XML"}),a.jsx(Z,{size:"sm",onClick:async()=>{try{Wn(!0);const D=`nfe/${t}/manual-${Date.now()}.xml`,K=new Blob([Gn],{type:"text/xml;charset=utf-8"}),{error:he}=await Q.storage.from("fiscal").upload(D,K,{contentType:"text/xml"});if(he)throw he;r({title:"XML salvo no Supabase"})}catch(D){r({title:"Falha ao salvar",description:D.message,variant:"destructive"})}finally{Wn(!1)}},disabled:Br,children:Br?"Salvando...":"Salvar no Supabase"})]})]}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto border border-border rounded p-2 bg-surface-2",children:Gn})]})}),a.jsx(zn,{open:Ze,onOpenChange:Ot,children:a.jsxs(qn,{className:"w-[95vw] sm:max-w-[680px] md:max-w-[860px] lg:max-w-[900px] max-h-[85vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Emisso NF-e (XML offline)"}),a.jsx(la,{children:"Preencha os campos abaixo e gere o XML da NF-e. Transmisso para SEFAZ ficar para a prxima etapa."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{children:"Natureza da Operao (natOp)"}),a.jsx(At,{value:Gt.natOp,onChange:D=>Ht(K=>({...K,natOp:D.target.value})),placeholder:"VENDA"})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Srie"}),a.jsx(At,{value:Gt.serie,onChange:D=>Ht(K=>({...K,serie:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Nmero (nNF)"}),a.jsx(At,{value:Gt.nNF,onChange:D=>Ht(K=>({...K,nNF:D.target.value})),placeholder:"(opcional)"})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Destino da Operao (idDest)"}),a.jsxs(ea,{value:Gt.idDest||"auto",onValueChange:D=>Ht(K=>({...K,idDest:D})),children:[a.jsx(Jn,{children:a.jsx(ra,{placeholder:"Automtico"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"auto",children:"Automtico"}),a.jsx(Qe,{value:"1",children:"Interna (mesmo estado)"}),a.jsx(Qe,{value:"2",children:"Interestadual"}),a.jsx(Qe,{value:"3",children:"Exterior"})]})]})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Consumidor Final (indFinal)"}),a.jsxs(ea,{value:Gt.indFinal,onValueChange:D=>Ht(K=>({...K,indFinal:D})),children:[a.jsx(Jn,{children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"1",children:"Sim"}),a.jsx(Qe,{value:"0",children:"No"})]})]})]}),a.jsxs("div",{children:[a.jsx(lt,{children:"Presena do Comprador (indPres)"}),a.jsxs(ea,{value:Gt.indPres,onValueChange:D=>Ht(K=>({...K,indPres:D})),children:[a.jsx(Jn,{children:a.jsx(ra,{})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"1",children:"Operao presencial"}),a.jsx(Qe,{value:"2",children:"No presencial, internet"}),a.jsx(Qe,{value:"4",children:"Entrega em domiclio"}),a.jsx(Qe,{value:"9",children:"No se aplica"})]})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>Ot(!1),children:"Fechar"}),a.jsx(Z,{onClick:Ra,disabled:mt,children:mt?"Gerando...":"Gerar XML"})]}),bt&&a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Prvia do XML Gerado"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>RV(`nfe-${ne||"doc"}.xml`,bt),children:"Baixar XML"}),a.jsx(Z,{size:"sm",onClick:fs,disabled:Fr,children:Fr?"Salvando...":"Salvar no Supabase"})]})]}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto border border-border rounded p-2 bg-surface-2",children:bt})]})]})})]})}function RV(e,t){try{const r=new Blob([t],{type:"text/xml;charset=utf-8"}),n=URL.createObjectURL(r),s=document.createElement("a");s.href=n,s.download=e,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(n)}catch{}}const alt=(e,t,r)=>e.split(/(\*\*.*?\*\*)/g).map((s,o)=>{if(s.startsWith("**")&&s.endsWith("**")){const i=s.slice(2,-2);return a.jsx("strong",{className:`font-black ${t?r?"text-white":"text-[#000000]":"text-white"}`,style:{fontWeight:900,textShadow:t?r?"0 0 1px rgba(0,0,0,0.25)":"0 0 1px rgba(0,0,0,0.3)":"0 0 1px rgba(255,255,255,0.5)"},children:i},o)}return s}),Roe=({message:e})=>{const t=e.from==="isis",r=t&&e?.color==="green",n=t&&e?.color==="system",[s,o]=p.useState(!1),{selections:i}=p5(),{clientIdentified:l,userInitial:c}=p.useMemo(()=>{const u=i?.contato?.nome||i?.cliente?.nome||"",f=String(u).trim(),h=f?f[0]:"",m=h&&/[A-Za-z---]/.test(h)?h.toUpperCase():"U";return{clientIdentified:!!u,userInitial:m}},[i?.contato?.nome,i?.cliente?.nome]),d=async u=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(u);else{const f=document.createElement("textarea");f.value=u,f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.opacity="0",document.body.appendChild(f),f.focus(),f.select(),document.execCommand("copy"),document.body.removeChild(f)}o(!0),setTimeout(()=>o(!1),1800)}catch{}};return a.jsx(Mr.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:[.22,1,.36,1]},className:`flex ${t?"justify-start":"justify-end"} mb-4 md:mb-6`,children:a.jsxs("div",{className:`flex items-end gap-2 md:gap-3 max-w-[90%] md:max-w-[85%] lg:max-w-[75%] ${!t&&"flex-row-reverse"}`,children:[t?a.jsx(cl,{size:"sm",variant:"message",className:"md:w-14 md:h-14"}):l?a.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center flex-shrink-0 bg-brand/10 text-brand ring-2 ring-brand/60",children:a.jsx("span",{className:"font-extrabold text-base md:text-lg leading-none select-none",children:c})}):a.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center flex-shrink-0 bg-surface border border-white/10 text-text-muted",children:a.jsx(Tf,{className:"w-5 h-5 md:w-6 md:h-6"})}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("div",{className:`relative px-3 py-2.5 md:px-5 md:py-3.5 backdrop-blur-sm transition-all duration-300 ${t?r?"bg-emerald-600/90 border border-emerald-400 text-white rounded-2xl rounded-bl-sm shadow-lg shadow-emerald-600/30":n?"bg-surface/70 border border-white/10 text-text-muted rounded-2xl rounded-bl-sm":"bg-brand border border-brand text-[#0A0A0A] rounded-2xl rounded-bl-sm shadow-lg shadow-brand/20":"bg-surface/70 border border-white/10 text-text-primary rounded-2xl rounded-br-sm"}`,children:[a.jsx("p",{className:"text-[15px] md:text-[15px] font-bold leading-relaxed whitespace-pre-wrap tracking-wide relative",children:alt(e.text,t,r)}),e.copyable&&a.jsx("button",{type:"button",onClick:()=>d(e.copyText||(typeof e.text=="string"?e.text:"")),className:`absolute right-2 bottom-2 p-1.5 md:p-2 rounded-full border shadow-sm transition ${t?"bg-white/80 border-white/40 text-[#0A0A0A] hover:bg-white":"bg-white/10 border-white/10 text-text-primary hover:bg-white/20"}`,"aria-label":"Copiar texto",children:s?a.jsx(Lm,{className:"w-4 h-4"}):a.jsx(Q4,{className:"w-4 h-4"})})]}),a.jsx("p",{className:`text-[10px] md:text-[10px] text-text-muted px-2 ${t?"text-left":"text-right"}`,children:or(e.timestamp,"HH:mm")})]})]})})};function slt(){const[e,t]=p.useState([]),[r,n]=p.useState(""),[s,o]=p.useState(!1),[i,l]=p.useState(""),[c,d]=p.useState(!0),u=p.useRef(null),{company:f,userProfile:h,user:m}=fo();p.useEffect(()=>{const b={id:Date.now()+Math.random(),from:"isis",text:"Ol! Eu sou a verso Premium da sis, integrada  OpenAI. Em que posso ajudar? ",timestamp:new Date};t([b])},[]),p.useEffect(()=>{const b=setTimeout(()=>{u.current?.scrollIntoView({behavior:"smooth",block:"end"})},100);return()=>clearTimeout(b)},[e,s]);const x=b=>{t(w=>[...w,{id:Date.now()+Math.random(),timestamp:new Date,...b}])},g=b=>{const w=String(b||"").toLowerCase();return w?w.includes("agend")||w.includes("agenda")?w.includes("hoje")?"Consultando os agendamentos de hoje...":w.includes("amanh")?"Consultando os agendamentos de amanh...":"Consultando seus agendamentos...":w.includes("cliente")?"Buscando informaes de clientes...":w.includes("caixa")||w.includes("faturamento")||w.includes("financeiro")||w.includes("venda")||w.includes("pagamento")?"Analisando movimentaes da sua arena...":w.includes("quadra")||w.includes("reserva")?"Verificando horrios e quadras disponveis...":"...":"..."},v=async(b,w)=>{try{const j=f?.codigoEmpresa||f?.codigo_empresa||null,_=h?.id||m?.id||null,C=h?.nome||m?.email||null,A=h?.cargo||null,S=new Date,P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),0,0,0,0),M=new Date(P);M.setDate(M.getDate()+1);const O=P.toISOString(),I=M.toISOString(),T=Array.isArray(w)?w.map(F=>({role:F.from==="isis"?"assistant":"user",content:F.text})):[],{data:k,error:$}=await Q.functions.invoke("chat-proxy",{body:{message:b,empresaCodigo:j,usuarioId:_,usuarioNome:C,usuarioCargo:A,data_inicio:O,data_fim:I,history:T}});if($)throw $;const q=typeof k?.reply=="string"&&k.reply.trim().length>0?k.reply:"Certo! (resposta provisria)";let z=Array.isArray(k?.replies)?k.replies.filter(F=>typeof F=="string"&&F.trim().length>0):[];if(z.length===0&&(z=[q]),console.log("[sis][response]",{replies:z,raw:k}),k)try{console.log("[sis][response raw JSON]",JSON.stringify(k,null,2))}catch{}for(let F=0;F<z.length;F++){const V=z[F];x({from:"isis",text:V}),F<z.length-1&&await new Promise(ue=>setTimeout(ue,600))}o(!1),l("")}catch{x({from:"isis",text:"No momento, estou operando em modo de demonstrao. Em breve estarei 100% conectada  OpenAI aqui na aba Premium! "}),o(!1),l("")}},y=async b=>{b.preventDefault();const w=r.trim();if(!w)return;const j=[...e];console.log("[sis][question]",{message:w}),x({from:"user",text:w}),n(""),o(!0),l(g(w)),await v(w,j)};return a.jsxs("div",{className:"flex h-full w-full relative",children:[a.jsxs("div",{className:"flex-1 flex flex-col pointer-events-none",children:[a.jsxs("div",{className:"flex-1 overflow-y-auto px-3 md:px-6 py-4 md:py-6",children:[e.map(b=>a.jsx(Roe,{message:b},b.id)),s&&a.jsx(Mr.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start mb-4",children:a.jsx("div",{className:"px-4 py-2 rounded-2xl bg-brand border border-brand text-[#0A0A0A] flex items-center gap-2 animate-pulse",children:i&&i!=="..."?a.jsxs(a.Fragment,{children:[a.jsx("span",{role:"img","aria-label":"pensando",children:""}),a.jsx("span",{children:i})]}):a.jsx("span",{className:"font-semibold tracking-widest",children:"..."})})}),a.jsx("div",{ref:u})]}),a.jsx("div",{className:"sticky bottom-0 px-3 md:px-6 pb-3 md:pb-6 pt-3 md:pt-4 bg-gradient-to-t from-background via-background to-transparent",children:a.jsxs("form",{onSubmit:y,className:"flex items-center gap-2 bg-surface/70 border border-white/10 rounded-xl px-3 py-2.5",children:[a.jsx(vG,{className:"w-5 h-5 text-text-muted"}),a.jsx("input",{value:r,onChange:b=>n(b.target.value),placeholder:"Escreva aqui",className:"flex-1 bg-transparent outline-none text-sm"}),a.jsxs("button",{type:"submit",disabled:!r.trim(),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-semibold transition ${r.trim()?"bg-brand text-bg":"bg-surface/40 text-text-muted cursor-not-allowed"}`,children:[a.jsx(Z4,{className:"w-4 h-4"}),"Enviar"]})]})})]}),c&&a.jsx("div",{className:"absolute inset-0 z-10 backdrop-blur-lg bg-black/60 flex items-center justify-center pointer-events-auto rounded-lg overflow-hidden",children:a.jsx(Mr.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},transition:{duration:.5,ease:[.22,1,.36,1]},className:"rounded-2xl border border-white/30 bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 shadow-2xl max-w-sm w-full text-center mx-4 overflow-hidden",children:a.jsxs("div",{className:"px-8 py-10",children:[a.jsx(Mr.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.2,duration:.4},className:"flex items-center justify-center mb-8",children:a.jsx("div",{className:"w-24 h-24 rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_20px_rgba(168,85,247,0.5)] overflow-hidden",children:a.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-background flex items-center justify-center",children:a.jsx(cl,{size:"lg"})})})}),a.jsxs(Mr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},children:[a.jsx("div",{className:"text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 via-violet-300 to-emerald-300 mb-4",children:"sis"}),a.jsx("p",{className:"text-sm text-gray-300 mb-6 leading-relaxed",children:"Em breve sua assistente IA vai estar pronta para revolucionar a gesto da sua arena. "}),a.jsxs("div",{className:"space-y-3 text-left",children:[a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-emerald-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Gerencie agendamentos com inteligncia artificial"})]}),a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-violet-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Otimize sua agenda e maximize ocupao"})]}),a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-fuchsia-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Insights inteligentes sobre sua arena"})]})]})]})]})})})]})}function olt(){const{company:e}=fo(),{clearIsisAlerts:t}=sj(),r=e?.codigo_empresa||e?.codigoEmpresa||null,[n,s]=p.useState(!0),[o,i]=p.useState(null),[l,c]=p.useState(!1),[d,u]=p.useState(null),[f,h]=p.useState(""),[m,x]=p.useState(""),[g,v]=p.useState(!1),[y,b]=p.useState(!1),[w,j]=p.useState(!1),[_,C]=p.useState(""),[A,S]=p.useState(""),[P,M]=p.useState(""),[O,I]=p.useState(!1),[T,k]=p.useState({agendamentosIsisTotal:0,agendamentosIsisHoje:0,agendamentosIsis7d:0,agendamentosTotal7d:0,cancelamentosIsis7d:0,perDay7d:[],topQuadras30d:[],ultimasInteracoes:[]}),[$,q]=p.useState({}),z=X=>{if(!X)return"";const W=X instanceof Date?X:new Date(X);if(isNaN(W.getTime()))return"";const Y=W.getFullYear(),me=String(W.getMonth()+1).padStart(2,"0"),ee=String(W.getDate()).padStart(2,"0");return`${Y}-${me}-${ee}`},F=X=>{if(!X)return null;const W=/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/.exec(String(X));if(!W)return null;const Y=parseInt(W[1],10),me=parseInt(W[2],10)-1,ee=parseInt(W[3],10),ae=new Date(Y,me,ee,0,0,0,0);return isNaN(ae.getTime())?null:ae},V=X=>{try{if(!X)return"";const W=X instanceof Date?X:new Date(X);return isNaN(W.getTime())?"":W.toLocaleDateString("pt-BR")}catch{return""}};p.useEffect(()=>{try{t?.()}catch{}},[t]),p.useEffect(()=>{if(!r||f||m)return;const X=new Date,W=new Date;W.setDate(W.getDate()-6);const Y=z(W),me=z(X);try{console.log("[IsisAnalytics] Init default range (auto-fill):",{startYmd:Y,endYmd:me})}catch{}h(Y),x(me)},[r]),p.useEffect(()=>{!g||!e?.id||(async()=>{try{b(!0);const{data:X,error:W}=await Q.from("agenda_settings").select("isis_cancel_min_hours_before, isis_subdomain, isis_display_name").eq("empresa_id",e.id).single();if(W&&W.code!=="PGRST116")throw W;if(X)C(X.isis_cancel_min_hours_before??""),S(X.isis_subdomain||""),M(X.isis_display_name||"");else{const Y=(e.nome_fantasia||"").toLowerCase().replace(/[^a-z0-9]+/g,"");S(Y),M(e.nome_fantasia||"")}}catch(X){console.error("[IsisSettings] Erro ao carregar:",X)}finally{b(!1)}})()},[g,e?.id,e?.nome_fantasia]);const ue=async()=>{if(e?.id)try{j(!0);const X=_===""?null:parseInt(_,10);if(X!==null&&(isNaN(X)||X<0)){alert("Horas de cancelamento deve ser um nmero >= 0"),j(!1);return}const W=(A||"").toLowerCase().replace(/[^a-z0-9]+/g,"");if(!W){alert("Subdomnio no pode estar vazio"),j(!1);return}const Y=(P||"").trim();if(!Y){alert("Nome de exibio no pode estar vazio"),j(!1);return}const{error:me}=await Q.from("agenda_settings").upsert({empresa_id:e.id,isis_cancel_min_hours_before:X,isis_subdomain:W,isis_display_name:Y},{onConflict:"empresa_id"});if(me)throw me;S(W),M(Y),I(!1),v(!1)}catch(X){console.error("[IsisSettings] Erro ao salvar:",X),alert("Erro ao salvar configuraes: "+(X?.message||"desconhecido"))}finally{j(!1)}},_e={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.1,delayChildren:.15}}},U={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}},L=({icon:X,title:W,value:Y,color:me="brand"})=>a.jsxs(Mr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5",style:{color:`var(--${me})`},children:a.jsx(X,{className:"h-5 w-5"})})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider mb-2",children:W}),a.jsx("p",{className:"text-3xl font-bold text-text-primary tabular-nums tracking-tight",children:Y})]})]}),G=p.useMemo(()=>(T.perDay7d||[]).map(X=>({name:new Date(X.date).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"}),total:X.total,isis:X.isis})),[T.perDay7d]);p.useEffect(()=>{let X=!0;return(async()=>{try{s(!0),i(null);const W=tt=>{const ut=new Date(tt);return ut.setHours(0,0,0,0),ut},Y=tt=>{const ut=new Date(tt);return ut.setHours(23,59,59,999),ut},me=W(new Date),ee=Y(new Date),ae=new Date;ae.setDate(ae.getDate()-6);const le=W(ae),Te=ee,te=new Date;te.setDate(te.getDate()-29);const ie=W(te);console.log("[IsisAnalytics] codigoEmpresa:",r,"company obj:",e);const{count:xt,error:vt}=await Q.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("created_by_isis",!0);if(vt)throw vt;console.log("[IsisAnalytics] HOJE intervalo criado_em:",me.toISOString(),"->",ee.toISOString());let St=(await Q.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",me.toISOString()).lte("criado_em",ee.toISOString()))?.count??null;if(St==null){const{data:tt}=await Q.from("agendamentos").select("id").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",me.toISOString()).lte("criado_em",ee.toISOString());St=(tt||[]).length}console.log("[IsisAnalytics] agIsisHoje (count resolved):",St),console.log("[IsisAnalytics] 7d intervalo criado_em:",le.toISOString(),"->",Te.toISOString());const{data:ft}=await Q.from("agendamentos").select("id, criado_em").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",le.toISOString()).lte("criado_em",Te.toISOString());console.log("[IsisAnalytics] agIsis7dRows length:",(ft||[]).length);const{data:_t}=await Q.from("agendamentos").select("id, inicio").eq("codigo_empresa",r).gte("inicio",le.toISOString()).lte("inicio",Te.toISOString());let be=(await Q.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("canceled_by","isis").gte("canceled_at",le.toISOString()).lte("canceled_at",Te.toISOString()))?.count??null;if(be==null){const{data:tt}=await Q.from("agendamentos").select("id").eq("codigo_empresa",r).eq("canceled_by","isis").gte("canceled_at",le.toISOString()).lte("canceled_at",Te.toISOString());be=(tt||[]).length}console.log("[IsisAnalytics] cancelamentosIsis7d (count resolved - canceled_by=isis):",be);const Nt=Array.isArray(ft)?ft.length:0,Wt=Array.isArray(_t)?_t.length:0,_r=tt=>{const ut=new Date(tt);return ut.setHours(0,0,0,0),ut.toISOString().slice(0,10)},yr={};for(let tt=0;tt<7;tt++){const ut=new Date(le);ut.setDate(le.getDate()+tt),yr[_r(ut)]={date:new Date(ut),isis:0,total:0}}(_t||[]).forEach(tt=>{const ut=_r(tt.inicio);yr[ut]&&(yr[ut].total+=1)}),(ft||[]).forEach(tt=>{const ut=tt.inicio||tt.criado_em,sr=_r(ut);yr[sr]&&(yr[sr].isis+=1)});const ve=Object.values(yr),{data:at}=await Q.from("agendamentos").select("quadra_id").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("inicio",ie.toISOString()).lte("inicio",ee.toISOString()),qt=new Map;(at||[]).forEach(tt=>{tt?.quadra_id&&qt.set(tt.quadra_id,(qt.get(tt.quadra_id)||0)+1)});const $t=Array.from(qt.keys());let De={};if($t.length>0){const{data:tt}=await Q.from("quadras").select("id, nome").in("id",$t);(tt||[]).forEach(ut=>{De[ut.id]=ut.nome})}const wt=Array.from(qt.entries()).map(([tt,ut])=>({id:tt,nome:De[tt]||"Quadra",count:ut})).sort((tt,ut)=>ut.count-tt.count).slice(0,5),{data:Rt}=await Q.from("agendamentos").select("modalidade").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("inicio",ie.toISOString()).lte("inicio",ee.toISOString()),Rr=new Map;(Rt||[]).forEach(tt=>{const ut=(tt?.modalidade||"").trim();ut&&Rr.set(ut,(Rr.get(ut)||0)+1)});const Me=Array.from(Rr.entries()).map(([tt,ut])=>({nome:tt,count:ut})).sort((tt,ut)=>ut.count-tt.count).slice(0,5);if(!X)return;k(tt=>({...tt,agendamentosIsisTotal:xt||0,agendamentosIsisHoje:St||0,agendamentosIsis7d:Nt,agendamentosTotal7d:Wt,cancelamentosIsis7d:be||0,perDay7d:ve,topQuadras30d:wt,topModalidades30d:Me})),s(!1)}catch(W){if(!X)return;i(W?.message||"Erro ao carregar mtricas"),s(!1)}})(),()=>{X=!1}},[r,e?.nome_fantasia,e?.razao_social]),p.useEffect(()=>{let X=!0;return(async()=>{if(r)try{c(!0),u(null);const W=yr=>{const ve=new Date(yr);return ve.setHours(0,0,0,0),ve},Y=yr=>{const ve=new Date(yr);return ve.setHours(23,59,59,999),ve},ee=z(new Date),ae=new Date;ae.setDate(ae.getDate()-6);const le=z(ae),Te=f||le,te=m||ee;let ie=Q.from("agendamentos").select("id, codigo, inicio, fim, criado_em, status, cliente_id, clientes, quadra_id").eq("codigo_empresa",r).eq("created_by_isis",!0).order("criado_em",{ascending:!1}).order("inicio",{ascending:!1});const xt=!!(Te||te),vt=Te?W(F(Te)).toISOString():null,dt=te?Y(F(te)).toISOString():null;if(vt||dt){const yr=[],ve=[];vt&&ve.push(`criado_em.gte.${vt}`),dt&&ve.push(`criado_em.lte.${dt}`),ve.length>0&&yr.push(`and(${ve.join(",")})`);const at=["criado_em.is.null"];vt&&at.push(`inicio.gte.${vt}`),dt&&at.push(`inicio.lte.${dt}`),yr.push(`and(${at.join(",")})`),ie=ie.or(yr.join(","))}ie=ie.limit(xt?200:10);try{console.log("[IsisAnalytics] Fetch lastAgs with range (effective):",{effStart:Te,effEnd:te,hasAnyFilter:xt,limit:xt?200:10})}catch{}const{data:St,error:ft}=await ie;if(ft){try{console.error("[IsisAnalytics] lastAgs query error:",ft)}catch{}throw ft}try{console.log("[IsisAnalytics] lastAgs length:",(St||[]).length)}catch{}const _t=Array.from(new Set((St||[]).map(yr=>yr.cliente_id).filter(Boolean)));let gr={};if(_t.length>0){const{data:yr}=await Q.from("clientes").select("id, nome").in("id",_t);(yr||[]).forEach(ve=>{gr[ve.id]=ve.nome})}const be=Array.from(new Set((St||[]).map(yr=>yr.quadra_id).filter(Boolean)));let Nt={};if(be.length>0){const{data:yr}=await Q.from("quadras").select("id, nome").in("id",be);(yr||[]).forEach(ve=>{Nt[ve.id]=ve.nome})}const Wt=(St||[]).map(yr=>yr.id);let _r={};if(Wt.length>0){const{data:yr}=await Q.from("agendamento_participantes").select("agendamento_id, nome, status_pagamento, valor_cota").in("agendamento_id",Wt).order("agendamento_id",{ascending:!0});(yr||[]).forEach(ve=>{_r[ve.agendamento_id]||(_r[ve.agendamento_id]=[]),_r[ve.agendamento_id].push(ve)})}if(!X)return;q({}),k(yr=>({...yr,ultimasInteracoes:(St||[]).map(ve=>({...ve,cliente_nome:gr[ve.cliente_id]||null,participantes:_r[ve.id]||[],quadra_nome:Nt[ve.quadra_id]||null}))})),c(!1)}catch(W){if(!X)return;u(W?.message||"Erro ao carregar agendamentos"),c(!1)}})(),()=>{X=!1}},[r,f,m]);const de=p.useMemo(()=>e?.nome_fantasia||e?.razao_social||"sua arena",[e]);return a.jsxs(Mr.div,{variants:_e,initial:"hidden",animate:"visible",className:"space-y-4",children:[a.jsxs(Mr.div,{variants:U,className:"bg-surface/70 backdrop-blur-sm relative p-4 md:p-6 rounded-xl border border-white/10 overflow-hidden shadow-1",children:[a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.03] mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsx("div",{className:"rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)] flex-shrink-0",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-10 h-10 sm:w-12 sm:h-12 grid place-items-center",children:a.jsx(cl,{size:"xs",className:"w-10 h-10 sm:w-12 sm:h-12"})})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("h1",{className:"text-xl sm:text-2xl font-black text-text-primary tracking-tight flex items-center gap-2 flex-wrap",children:[a.jsx(C_,{className:"h-5 w-5 sm:h-6 sm:w-6 text-brand flex-shrink-0"}),a.jsx("span",{className:"truncate",children:"Anlises da sis"})]}),a.jsxs("p",{className:"text-xs sm:text-sm text-text-secondary mt-1 line-clamp-2",children:["Como a sis est ajudando ",de," a converter conversas em reservas."]})]})]}),a.jsx("button",{type:"button",onClick:()=>v(!0),className:"inline-flex items-center justify-center w-10 h-10 sm:w-11 sm:h-11 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-text-secondary hover:text-text-primary flex-shrink-0 self-end sm:self-auto",title:"Configuraes da sis",children:a.jsx(Xc,{className:"h-5 w-5"})})]})]}),n?a.jsxs(Mr.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-20 gap-4",children:[a.jsx("div",{className:"relative",children:a.jsx("div",{className:"rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_20px_rgba(168,85,247,0.4)] animate-pulse",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-20 h-20 grid place-items-center",children:a.jsx(cl,{size:"sm",className:"w-20 h-20"})})})}),a.jsxs("div",{className:"flex items-center gap-2 text-text-muted",children:[a.jsx(ll,{className:"h-5 w-5 animate-spin"}),a.jsx("span",{className:"text-sm font-medium",children:"Carregando anlises da sis..."})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4 w-full max-w-md",children:[a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"})]})]}):o?a.jsx("div",{className:"text-danger text-sm",children:o}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(L,{icon:zC,title:"Agendamentos feitos (hoje)",value:T.agendamentosIsisHoje,color:"success"}),a.jsx(L,{icon:$m,title:"Agendamentos feitos (7 dias)",value:T.agendamentosIsis7d,color:"info"}),a.jsx(L,{icon:Dg,title:"Cancelamentos",value:T.cancelamentosIsis7d,color:"danger"})]}),a.jsxs(Mr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("h2",{className:"text-base font-bold text-text-primary flex items-center",children:[a.jsx($m,{className:"mr-2 h-5 w-5 text-brand"}),"Distribuio  ltimos 7 dias"]})}),a.jsx("div",{className:"px-1 pb-2",children:a.jsx(Hb,{width:"100%",height:220,children:a.jsxs(Uee,{data:G,margin:{top:8,right:12,left:0,bottom:0},children:[a.jsx(BS,{strokeDasharray:"3 3",stroke:"var(--border)",opacity:.5}),a.jsx(jp,{dataKey:"name",tick:{fontSize:11,fill:"var(--text-muted)"},tickLine:!1,axisLine:{stroke:"var(--border)"}}),a.jsx(_p,{allowDecimals:!1,tick:{fontSize:11,fill:"var(--text-muted)"},tickLine:!1,axisLine:{stroke:"var(--border)"},width:28}),a.jsx(Lc,{cursor:{stroke:"var(--border)",strokeDasharray:"3 3"},contentStyle:{background:"rgba(10,10,10,0.85)",borderColor:"var(--border)",color:"var(--text-primary)",borderRadius:"8px"},formatter:X=>[X,"sis (feitos)"]}),a.jsx(_y,{type:"monotone",dataKey:"isis",name:"sis (feitos)",stroke:"var(--brand)",strokeWidth:2.2,dot:{r:3,strokeWidth:1.5,stroke:"var(--brand)",fill:"var(--background)"},activeDot:{r:5}})]})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs(Mr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h2",{className:"text-base font-bold text-text-primary",children:"Top quadras  ltimos 30 dias (sis)"})}),T.topQuadras30d.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum agendamento nos ltimos 30 dias."}):a.jsx("ul",{className:"divide-y divide-border",children:T.topQuadras30d.map(X=>a.jsxs("li",{className:"py-2 text-sm flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:X.nome}),a.jsx("span",{className:"text-text-muted",children:X.count})]},X.id))})]}),a.jsxs(Mr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h2",{className:"text-base font-bold text-text-primary",children:"Top modalidades  ltimos 30 dias (sis)"})}),!T.topModalidades30d||T.topModalidades30d.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados recentes."}):a.jsx("ul",{className:"divide-y divide-border",children:T.topModalidades30d.map((X,W)=>a.jsxs("li",{className:"py-2 text-sm flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:X.nome}),a.jsx("span",{className:"text-text-muted",children:X.count})]},`${X.nome}-${W}`))})]})]})]}),!n&&a.jsxs(Mr.div,{variants:U,className:"fx-card",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{className:"text-sm sm:text-base font-bold text-text-primary",children:"ltimos agendamentos criados pela sis"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary",title:"Data incio (criado em)",children:[a.jsx(ko,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{children:f?V(F(f)):"Incio"})]})}),a.jsx(Ho,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(f)||void 0,onSelect:X=>h(X?z(X):""),locale:Da,initialFocus:!0})})]}),a.jsx("span",{className:"text-xs text-text-secondary select-none",children:"at"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary",title:"Data fim (criado em)",children:[a.jsx(ko,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{children:m?V(F(m)):"Fim"})]})}),a.jsx(Ho,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(m)||void 0,onSelect:X=>x(X?z(X):""),locale:Da,initialFocus:!0})})]})]}),null]})]}),a.jsxs("div",{className:"sm:hidden mb-3 rounded-lg border border-white/10 bg-white/5 p-2",children:[a.jsxs("div",{className:"grid [grid-template-columns:1fr_auto_1fr] gap-2 mb-2",children:[a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"w-full h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary justify-between",title:"Data incio (criado em)",children:[a.jsx(ko,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{className:"truncate",children:f?V(F(f)):"Incio"})]})}),a.jsx(Ho,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(f)||void 0,onSelect:X=>h(X?z(X):""),locale:Da,initialFocus:!0})})]}),a.jsx("div",{className:"flex items-center justify-center text-xs text-text-secondary select-none",children:"at"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"w-full h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary justify-between",title:"Data fim (criado em)",children:[a.jsx(ko,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{className:"truncate",children:m?V(F(m)):"Fim"})]})}),a.jsx(Ho,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(m)||void 0,onSelect:X=>x(X?z(X):""),locale:Da,initialFocus:!0})})]})]}),null]}),l?a.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm py-6",children:[a.jsx(ll,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Carregando agendamentos..."})]}):d?a.jsx("div",{className:"text-danger text-sm",children:d}):T.ultimasInteracoes.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum agendamento recente."}):a.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:a.jsx("div",{className:"inline-block min-w-full align-middle",children:a.jsx("div",{className:"overflow-hidden",children:a.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-text-secondary border-b border-white/10",children:[a.jsx("th",{className:"w-8 py-2 pl-4 sm:pl-0"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Cdigo"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Cliente"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden sm:table-cell",children:"Quadra"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Data"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden md:table-cell",children:"Horrio"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Status"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden lg:table-cell",children:"Participantes"}),a.jsx("th",{className:"text-left py-2 pr-4 sm:pr-2 whitespace-nowrap hidden xl:table-cell",children:"Criado em"})]})}),a.jsx("tbody",{children:T.ultimasInteracoes.map(X=>{const W=X.inicio?new Date(X.inicio):null,Y=X.fim?new Date(X.fim):null,me=W?W.toLocaleDateString():"-",ee=W&&Y?`${W.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${Y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:"-",ae=Array.isArray(X.participantes)?X.participantes.length:Array.isArray(X.clientes)?X.clientes.length:0,le=!!$[X.id],Te=()=>q(vt=>({...vt,[X.id]:!vt[X.id]})),te=String(X.status||"").toLowerCase(),xt={scheduled:{label:"Agendado",cls:"bg-info/15 text-info border border-info/20"},confirmed:{label:"Confirmado",cls:"bg-success/15 text-success border border-success/20"},in_progress:{label:"Em andamento",cls:"bg-brand/15 text-brand border border-brand/20"},finished:{label:"Finalizado",cls:"bg-success/15 text-success border border-success/20"},canceled:{label:"Cancelado",cls:"bg-danger/15 text-danger border border-danger/20"},no_show:{label:"No-show",cls:"bg-warning/15 text-warning border border-warning/20"}}[te]||{label:X.status||"",cls:"bg-white/10 text-text-secondary border border-white/15"};return a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:`border-b border-white/10 align-top ${le?"bg-white/[0.03]":"hover:bg-white/[0.02]"} transition-colors`,children:[a.jsx("td",{className:"py-2 pl-4 sm:pl-0",children:a.jsx("button",{type:"button","aria-label":le?"Recolher":"Expandir",onClick:vt=>{vt.stopPropagation(),Te()},className:`inline-flex items-center justify-center w-6 h-6 rounded-md border border-white/10 hover:bg-white/5 transition-colors ${le?"rotate-180":""}`,children:a.jsx(gx,{className:"w-3 h-3 sm:w-4 sm:h-4 text-text-secondary"})})}),a.jsxs("td",{className:"py-2 pr-2 font-semibold text-text-primary whitespace-nowrap",children:["#",X.codigo]}),a.jsx("td",{className:"py-2 pr-2 max-w-[120px] truncate",children:X.cliente_nome||Array.isArray(X.clientes)&&X.clientes[0]||""}),a.jsx("td",{className:"py-2 pr-2 hidden sm:table-cell max-w-[100px] truncate",children:X.quadra_nome||""}),a.jsx("td",{className:"py-2 pr-2 whitespace-nowrap",children:me}),a.jsx("td",{className:"py-2 pr-2 hidden md:table-cell whitespace-nowrap text-xs",children:ee}),a.jsx("td",{className:"py-2 pr-2",children:a.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-[11px] font-bold tracking-wide whitespace-nowrap ${xt.cls}`,children:xt.label})}),a.jsx("td",{className:"py-2 pr-2 hidden lg:table-cell",children:a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-white/10 text-text-primary text-xs font-semibold",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand/70"}),ae]})}),a.jsx("td",{className:"py-2 pr-4 sm:pr-2 hidden xl:table-cell text-xs whitespace-nowrap",children:X.criado_em?new Date(X.criado_em).toLocaleString():"-"})]},X.id),le&&a.jsx("tr",{children:a.jsxs("td",{colSpan:9,className:"p-3 sm:p-4 bg-white/[0.035] border-b border-white/10",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Criado em"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:X.criado_em?new Date(X.criado_em).toLocaleString():"-"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Incio"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:X.inicio?new Date(X.inicio).toLocaleString():"-"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Trmino"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:X.fim?new Date(X.fim).toLocaleString():"-"})]})]}),a.jsxs("div",{className:"sm:hidden mb-3 grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted",children:"Quadra"}),a.jsx("div",{className:"font-medium text-text-primary text-xs truncate",children:X.quadra_nome||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted",children:"Horrio"}),a.jsx("div",{className:"font-medium text-text-primary text-xs",children:ee})]})]}),a.jsxs("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted mb-2",children:["Participantes (",ae,")"]}),Array.isArray(X.participantes)&&X.participantes.length>0?a.jsx("ul",{className:"grid grid-cols-1 gap-1.5",children:X.participantes.map((vt,dt)=>a.jsxs("li",{className:"flex items-center justify-between py-1.5 px-2 sm:px-3 rounded-md border border-white/10 bg-white/5 gap-2",children:[a.jsx("span",{className:"text-text-primary font-medium text-xs sm:text-sm truncate flex-1",children:vt.nome}),a.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-[11px] font-bold tracking-wide whitespace-nowrap flex-shrink-0 ${vt.status_pagamento==="Pago"?"bg-success/15 text-success border border-success/20":"bg-warning/15 text-warning border border-warning/20"}`,children:vt.status_pagamento})]},dt))}):a.jsx("div",{className:"text-text-muted text-xs sm:text-sm",children:"Sem participantes cadastrados"})]})})]})})})]})})})})]}),g&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:()=>v(!1),children:a.jsxs(Mr.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-surface border border-white/10 rounded-xl shadow-2xl w-full max-w-lg p-6 space-y-4",onClick:X=>X.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-xl font-bold text-text-primary flex items-center gap-2",children:[a.jsx(Xc,{className:"h-5 w-5 text-brand"})," Configuraes da sis"]}),a.jsx("button",{type:"button",onClick:()=>v(!1),className:"inline-flex items-center justify-center w-8 h-8 rounded-lg hover:bg-white/10 transition-colors text-text-secondary hover:text-text-primary",children:a.jsx(Dg,{className:"h-5 w-5"})})]}),y?a.jsxs("div",{className:"flex items-center gap-2 text-text-muted py-8 justify-center",children:[a.jsx(ll,{className:"h-5 w-5 animate-spin"})," Carregando..."]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Cancelamento (horas antes)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Tempo mnimo (em horas) antes do agendamento para permitir cancelamento via sis."}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"number",min:"0",step:"1",value:_,onChange:X=>C(X.target.value),placeholder:"Ex: 2",className:"w-24 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary text-center placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("span",{className:"text-sm text-text-muted",children:"horas"})]}),a.jsx("p",{className:"text-xs text-text-muted italic",children:"Deixe vazio para permitir cancelamento a qualquer momento."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Nome de exibio"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Nome que aparecer no header da pgina de agendamento da sis."}),a.jsx("input",{type:"text",value:P,onChange:X=>M(X.target.value),placeholder:"Arena Palace",className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("p",{className:"text-xs text-text-muted italic",children:"Este  o nome que seus clientes vero ao acessar a sis."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Link de agendamento"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Personalize o subdomnio do link de agendamento da sis."}),O?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:A,onChange:X=>S(X.target.value.toLowerCase().replace(/[^a-z0-9]+/g,"")),placeholder:"arenapalace",autoFocus:!0,className:"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("span",{className:"text-sm text-text-muted",children:".f7arena.com"})]}):a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 border border-white/10 rounded-lg group hover:border-white/20 transition-all cursor-pointer",onClick:()=>I(!0),children:[a.jsxs("span",{className:"flex-1 text-text-primary font-mono",children:[A||"arenapalace",".f7arena.com"]}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-md hover:bg-white/10 transition-colors text-text-muted group-hover:text-text-primary",title:"Editar subdomnio",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),a.jsx("path",{d:"m15 5 4 4"})]})})]})]}),a.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{v(!1),I(!1)},disabled:w,className:"flex-1 px-4 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors text-text-secondary hover:text-text-primary font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),a.jsx("button",{type:"button",onClick:ue,disabled:w,className:"flex-1 px-4 py-2 rounded-lg bg-brand hover:bg-brand/90 transition-colors text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w?a.jsxs(a.Fragment,{children:[a.jsx(ll,{className:"h-4 w-4 animate-spin"})," Salvando..."]}):"Salvar"})]})]})]})})]})}function ilt({open:e,onOpenChange:t,codigoEmpresa:r,onSuccess:n}){const{toast:s}=Xs(),[o,i]=p.useState("upload"),[l,c]=p.useState(null),[d,u]=p.useState(null),[f,h]=p.useState(!1),[m,x]=p.useState({success:!1,comandaId:null,error:null}),g=async j=>{const _=j.target.files?.[0];if(_){if(!_.name.endsWith(".xml")){s({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}c(_);try{const C=await _.text(),A=gC(C);if(!A.success){s({title:"Erro ao ler XML",description:A.error||"XML invlido",variant:"destructive"});return}if(!A.produtos||A.produtos.length===0){s({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}if(A.nfe?.tipo!=="Sada"){s({title:"Tipo de nota incorreto",description:"Este XML  de entrada. Use a importao em Produtos para notas de entrada.",variant:"warning"});return}u(A),i("preview")}catch(C){console.error("[XMLSalesImport] Erro ao processar arquivo:",C),s({title:"Erro ao processar XML",description:C.message,variant:"destructive"})}}},v=async()=>{i("processing"),h(!0);try{const j=await mf({searchTerm:"",limit:1e4,codigoEmpresa:r}),_=d.nfe?.dataEmissao?new Date(d.nfe.dataEmissao):new Date,C=d.nfe?.chaveAcesso||"",{data:A,error:S}=await Q.from("comandas").insert({codigo_empresa:r,mesa_id:null,status:"closed",aberto_em:_.toISOString(),fechado_em:_.toISOString(),observacao:`Importado de XML - NF-e ${d.nfe?.numero||""}${C?`
Chave: ${C}`:""}`,origem:"xml",xml_chave:C||null}).select().single();if(S)throw S;const P=[],M=[];for(const I of d.produtos){const T=xC(I,j);if(T){P.push({comanda_id:A.id,produto_id:T.id,descricao:I.nome,quantidade:I.quantidade,preco_unitario:I.valorUnitario,desconto:I.desconto||0,codigo_empresa:r});const k=Math.max(0,(T.stock||T.estoque||0)-I.quantidade);await Q.from("produtos").update({estoque:k}).eq("id",T.id).eq("codigo_empresa",r)}else M.push(I.nome)}if(P.length>0){const{error:I}=await Q.from("comanda_itens").insert(P);if(I)throw I}const O=d.pagamentos||[];if(O.length>0){const{data:I}=await Q.from("finalizadoras").select("id, codigo_sefaz, nome").eq("codigo_empresa",r).eq("ativo",!0),T=new Map((I||[]).map(q=>[q.codigo_sefaz,q])),k=O.map(q=>{const z=T.get(q.codigoSefaz);return{comanda_id:A.id,finalizadora_id:z?.id||null,metodo:q.descricao.toLowerCase(),valor:q.valor,status:"Pago",recebido_em:_.toISOString(),codigo_empresa:r,origem:"xml",xml_chave:C||null}}),{error:$}=await Q.from("pagamentos").insert(k);if($)throw $}else{const I=d.produtos.reduce((k,$)=>k+($.valorTotal||0),0),{error:T}=await Q.from("pagamentos").insert({comanda_id:A.id,finalizadora_id:null,metodo:"outros",valor:I,status:"Pago",recebido_em:_.toISOString(),codigo_empresa:r,origem:"xml",xml_chave:C||null});if(T)throw T}console.log("[XMLSalesImport] Venda importada com sucesso. Comanda ID:",A.id),M.length>0?s({title:"Venda importada com avisos",description:`${P.length} produto(s) registrado(s), ${M.length} no encontrado(s).`,variant:"warning",duration:5e3}):s({title:"Venda importada com sucesso!",description:`${P.length} produto(s) registrado(s). Total: R$ ${w.toFixed(2)}`,variant:"success"}),x({success:!0,comandaId:A.id,error:null,produtosNaoEncontrados:M,totalItens:P.length,totalVenda:w,dataEmissao:_.toISOString().slice(0,10)}),i("done"),n&&n(_.toISOString().slice(0,10))}catch(j){console.error("[XMLSalesImport] Erro ao importar:",j),x({success:!1,comandaId:null,error:j.message}),i("done"),s({title:"Erro ao importar XML",description:j.message,variant:"destructive"})}finally{h(!1)}},y=()=>{i("upload"),c(null),u(null),x({success:!1,comandaId:null,error:null}),t(!1)},b=()=>{i("upload"),c(null),u(null)},w=d?.produtos?.reduce((j,_)=>j+(_.valorTotal||0),0)||0;return a.jsx(zn,{open:e,onOpenChange:t,children:a.jsxs(qn,{className:"max-w-3xl max-h-[90vh] flex flex-col overflow-hidden",children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-2xl font-bold",children:"Importar XML de Venda (NF-e)"}),a.jsxs(la,{children:[o==="upload"&&"Selecione o arquivo XML da nota fiscal de sada",o==="preview"&&"Revise os dados da venda que ser importada",o==="processing"&&"Processando venda...",o==="done"&&"Importao finalizada"]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-1",children:[o==="upload"&&a.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:a.jsxs("div",{className:"w-full max-w-md",children:[a.jsxs("label",{htmlFor:"xml-sales-upload",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-border rounded-lg cursor-pointer bg-surface hover:bg-surface-2 transition-colors",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(tD,{className:"w-12 h-12 mb-4 text-text-muted"}),a.jsx("p",{className:"mb-2 text-sm text-text-primary font-semibold",children:"Clique para selecionar ou arraste o arquivo"}),a.jsx("p",{className:"text-xs text-text-muted",children:"XML de NF-e de Sada (Venda)"})]}),a.jsx("input",{id:"xml-sales-upload",type:"file",accept:".xml",className:"hidden",onChange:g})]}),l&&a.jsxs("div",{className:"mt-4 p-3 bg-surface-2 rounded-lg flex items-center gap-2",children:[a.jsx(ol,{className:"w-5 h-5 text-success"}),a.jsx("span",{className:"text-sm text-text-primary",children:l.name})]})]})}),o==="preview"&&a.jsxs("div",{className:"space-y-4",children:[d?.nfe&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Informaes da NF-e"}),d.fornecedor&&a.jsxs("div",{className:"mb-3 pb-3 border-b border-border",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary mb-1",children:d.fornecedor.razaoSocial||d.fornecedor.nomeFantasia||"Fornecedor"}),a.jsxs("div",{className:"text-xs text-text-muted",children:[d.fornecedor.cnpj&&`CNPJ: ${d.fornecedor.cnpj}`,d.fornecedor.endereco?.cidade&&d.fornecedor.endereco?.uf&&`  ${d.fornecedor.endereco.cidade}/${d.fornecedor.endereco.uf}`]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",a.jsx("span",{className:"font-mono",children:d.nfe.numero})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",a.jsx("span",{className:"font-mono",children:d.nfe.serie})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Tipo:"})," ",a.jsx("span",{className:"text-warning font-semibold",children:d.nfe.tipo})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Data:"})," ",a.jsx("span",{children:new Date(d.nfe.dataEmissao).toLocaleDateString("pt-BR")})]})]}),d.nfe.naturezaOperacao&&a.jsxs("div",{className:"mb-2 text-sm",children:[a.jsx("span",{className:"text-text-muted",children:"Natureza:"})," ",a.jsx("span",{className:"font-medium",children:d.nfe.naturezaOperacao})]}),d.nfe.totalNota!==void 0&&a.jsxs("div",{className:"mb-3 text-sm",children:[a.jsx("span",{className:"text-text-muted",children:"Total da Nota:"})," ",a.jsxs("span",{className:"font-mono font-semibold text-lg text-success",children:["R$ ",d.nfe.totalNota.toFixed(2)]})]}),d.nfe.chaveAcesso&&a.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[a.jsx("span",{className:"text-text-muted text-xs",children:"Chave de Acesso:"}),a.jsx("p",{className:"font-mono text-xs break-all",children:d.nfe.chaveAcesso})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("h3",{className:"font-semibold mb-3",children:["Produtos da Venda (",d.produtos.length,")"]}),a.jsx("div",{className:"space-y-2",children:d.produtos.map((j,_)=>a.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface flex items-start gap-3",children:[a.jsx(X1,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:j.nome}),a.jsxs("p",{className:"text-xs text-text-muted",children:[j.codigo&&`Cdigo: ${j.codigo}  `,"Qtd: ",j.quantidade," ",j.unidade]})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsxs("p",{className:"text-sm font-semibold",children:["R$ ",j.valorTotal.toFixed(2)]}),a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit: R$ ",j.valorUnitario.toFixed(2)]})]})]})})]},_))})]}),d.pagamentos&&d.pagamentos.length>0&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("h3",{className:"font-semibold mb-3",children:["Formas de Pagamento (",d.pagamentos.length,")"]}),a.jsx("div",{className:"space-y-2",children:d.pagamentos.map((j,_)=>a.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm",children:j.descricao}),a.jsxs("p",{className:"text-xs text-text-muted",children:["Cdigo SEFAZ: ",j.codigoSefaz]})]}),a.jsxs("p",{className:"text-sm font-semibold",children:["R$ ",j.valor.toFixed(2)]})]},_))})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(kd,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-sm mb-1",children:"Ateno: Venda Externa"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Esta venda ser registrada no histrico como uma venda externa (importada de XML). O estoque dos produtos ser subtrado automaticamente."})]})]})}),a.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[a.jsx("span",{children:"Total da Venda:"}),a.jsxs("span",{className:"text-success",children:["R$ ",w.toFixed(2)]})]})]}),o==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(ll,{className:"w-12 h-12 animate-spin text-warning mb-4"}),a.jsx("p",{className:"text-lg font-semibold",children:"Processando venda..."}),a.jsx("p",{className:"text-sm text-text-muted",children:"Criando comanda e atualizando estoque"})]}),o==="done"&&a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"bg-surface-2 rounded-lg p-6 border border-border text-center",children:m.success?a.jsxs(a.Fragment,{children:[a.jsx(Oi,{className:"w-16 h-16 text-success mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Venda Importada com Sucesso!"}),a.jsx("p",{className:"text-sm text-text-muted mb-4",children:"A venda foi registrada no histrico"}),m.produtosNaoEncontrados&&m.produtosNaoEncontrados.length>0&&a.jsxs("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-3 text-left",children:[a.jsx("p",{className:"text-sm font-semibold mb-2",children:" Produtos no encontrados:"}),a.jsx("ul",{className:"text-xs text-text-muted space-y-1",children:m.produtosNaoEncontrados.map((j,_)=>a.jsxs("li",{children:[" ",j]},_))})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(kd,{className:"w-16 h-16 text-danger mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Erro na Importao"}),a.jsx("p",{className:"text-sm text-text-muted",children:m.error||"Ocorreu um erro ao importar a venda"})]})})})]}),a.jsxs(Ua,{children:[o==="upload"&&a.jsx(Z,{variant:"outline",onClick:y,children:"Cancelar"}),o==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:b,children:"Voltar"}),a.jsx(Z,{onClick:v,children:"Confirmar Importao"})]}),o==="done"&&a.jsx(Z,{onClick:y,children:"Fechar"})]})]})})}const llt={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},hb={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};function clt(e,t=300){const[r,n]=p.useState(e);return p.useEffect(()=>{const s=setTimeout(()=>n(e),t);return()=>clearTimeout(s)},[e,t]),r}function u_({value:e,onChange:t}){const[r,n]=p.useState(!1),s=p.useRef(null),o=p.useRef(null),i=p.useRef(null),[l,c]=p.useState({top:0,left:0,width:0,center:!1,mode:"fixed"});p.useEffect(()=>{function g(b){const w=b.target,j=s.current&&s.current.contains(w),_=i.current&&i.current.contains(w);!j&&!_&&n(!1)}function v(b){b.key==="Escape"&&n(!1)}function y(){r&&d()}return window.addEventListener("mousedown",g),window.addEventListener("keydown",v),window.addEventListener("scroll",y,!0),window.addEventListener("resize",y),()=>{window.removeEventListener("mousedown",g),window.removeEventListener("keydown",v),window.removeEventListener("scroll",y,!0),window.removeEventListener("resize",y)}},[r]),p.useEffect(()=>{if(r){const g=requestAnimationFrame(()=>{d();const v=requestAnimationFrame(()=>d());return()=>cancelAnimationFrame(v)});return()=>cancelAnimationFrame(g)}},[r]),p.useEffect(()=>{if(r&&l.mode==="overlay"){const g=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=g}}},[r,l.mode]);const d=()=>{try{const g=o.current;if(!g)return;const v=g.getBoundingClientRect(),y=window.innerWidth,b=window.innerHeight,w=8,j=Math.max(v.width,280),_=Math.min(y-w*2,360),C=Math.min(j,_);let A=320;if(i.current)try{A=i.current.getBoundingClientRect().height||A}catch{}if(y<=640){c({top:0,left:0,width:Math.min(y-w*2,360),center:!0,mode:"overlay"});return}const S=s.current,P=S?S.getBoundingClientRect():v,M=v.bottom-P.top+6,O=Math.max(v.width,280);c({top:M,left:0,width:O,center:!1,mode:"anchor"})}catch{}},u=g=>{try{const[v,y,b]=String(g||"").split("-").map(Number);return!v||!y||!b?null:new Date(v,y-1,b)}catch{return null}},f=g=>{const v=y=>String(y).padStart(2,"0");return`${g.getFullYear()}-${v(g.getMonth()+1)}-${v(g.getDate())}`},h=g=>{const v=y=>String(y).padStart(2,"0");return`${v(g.getDate())}/${v(g.getMonth()+1)}/${g.getFullYear()}`},m=u(e),x=m?h(m):"";return a.jsxs("div",{className:"relative",ref:s,children:[a.jsx("button",{type:"button",className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-warning/10 focus:outline-none",onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(g=>!g),setTimeout(d,0)},"aria-label":"Abrir calendrio",children:a.jsx(Oue,{className:"h-4 w-4 text-warning"})}),typeof window<"u"&&window.innerWidth<=640?a.jsx("button",{type:"button",ref:o,onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(!0),setTimeout(d,0)},className:"pl-9 pr-3 h-10 w-full text-left bg-surface text-text-primary border border-warning/40 rounded-md",children:x||"Selecionar data"}):a.jsx(At,{type:"text",readOnly:!0,ref:o,inputMode:"none",onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(g=>!g),setTimeout(d,0)},className:"pl-9 pr-3 w-full bg-surface text-text-primary border border-warning/40 focus-visible:ring-warning focus-visible:border-warning",value:x}),r&&(l.mode==="overlay"?a.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",onClick:g=>{g.target===g.currentTarget&&n(!1)},children:a.jsx("div",{ref:i,className:"bg-black text-white border border-warning/40 rounded-md shadow-xl p-2 w-[92vw] max-w-[360px]",children:a.jsx(ei,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})})}):l.mode==="anchor"?a.jsx("div",{ref:i,className:"absolute z-[999] bg-black text-white border border-warning/40 rounded-md shadow-xl p-2 left-0",style:{top:`${l.top}px`,minWidth:`${l.width}px`,maxWidth:"92vw"},children:a.jsx(ei,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}):a.jsx("div",{ref:i,className:"fixed z-[999] bg-black text-white border border-warning/40 rounded-md shadow-xl p-2",style:{top:`${l.top}px`,left:`${l.left}px`,width:`${l.width}px`,maxWidth:"92vw"},children:a.jsx(ei,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}))]})}function dlt(){const{toast:e}=Xs(),t=Ol(),{userProfile:r}=fo(),[n]=qC(),s=n.get("mesa"),[o,i]=p.useState(!1),[l,c]=p.useState([]),[d,u]=p.useState(()=>s?"":new Date().toISOString().slice(0,10)),[f,h]=p.useState(()=>s?"":new Date().toISOString().slice(0,10)),[m,x]=p.useState(()=>s?"all":"closed"),[g,v]=p.useState(""),y=clt(g,350),[b,w]=p.useState("all"),[j,_]=p.useState("comandas"),[C,A]=p.useState(!1),[S,P]=p.useState(""),[M,O]=p.useState(null),[I,T]=p.useState({loading:!1,itens:[],pagamentos:[]}),[k,$]=p.useState(null),[q,z]=p.useState({open:!1,loading:!1,resumo:null,periodo:{from:null,to:null},movs:[]}),[F,V]=p.useState(!1),[ue,_e]=p.useState(!1),[U,L]=p.useState(null),[G,de]=p.useState([]),X=async Me=>{try{_e(!0);const tt=Nt();if(!tt)throw new Error("Empresa no detectada");const{payload:ut,missing:sr}=await dg({comandaId:Me,codigoEmpresa:tt});L(ut),de(sr||[]),V(!0)}catch(tt){e({title:"Falha ao gerar prvia",description:tt?.message||"Tente novamente",variant:"destructive"})}finally{_e(!1)}},[W,Y]=p.useState(!1),[me,ee]=p.useState(!1),[ae,le]=p.useState(!1),Te=async()=>{try{e({title:"Gerando CSV...",description:"Aguarde enquanto preparamos o arquivo",variant:"default"});const Me=await zz({status:m,from:d||void 0,to:f||void 0,search:y||"",limit:1e4,offset:0});if(!Me||Me.length===0){e({title:"Nenhum dado para exportar",variant:"warning"});return}const tt=Me.map(Le=>Le.id),ut=await JS(tt,r?.codigo_empresa),sr=await Bh(r?.codigo_empresa),Sr=new Map(sr.map(Le=>[Le.id,Le.numero])),xr=await c3(tt),Wr=await d3(tt),qr=Me.map(Le=>{const Ze=Le.mesa_id?`Mesa ${Sr.get(Le.mesa_id)||"?"}`:"Balco",Ot=xr[Le.id]||"Sem cliente",mt=Wr[Le.id],Qt=Array.isArray(mt)?mt.join(", "):mt||"No informado",bt=Le.fechado_em?"Fechada":"Aberta";return{Tipo:Le.tipo==="balcao"?"Balco":"Mesa","Mesa/Local":Ze,"Cliente(s)":Ot,Status:bt,Abertura:new Date(Le.aberto_em).toLocaleString("pt-BR"),Fechamento:Le.fechado_em?new Date(Le.fechado_em).toLocaleString("pt-BR"):"-","Total (R$)":Number(ut[Le.id]||0).toFixed(2),"Forma(s) Pagamento":Qt,Observaes:Le.observacao||"-"}}),Tr=Object.keys(qr[0]),sn=[Tr.join(";"),...qr.map(Le=>Tr.map(Ze=>{const Ot=Le[Ze]||"";return`"${String(Ot).replace(/"/g,'""')}"`}).join(";"))].join(`
`),Cn=new Blob(["\uFEFF"+sn],{type:"text/csv;charset=utf-8;"}),ze=document.createElement("a"),Fe=URL.createObjectURL(Cn);ze.setAttribute("href",Fe),ze.setAttribute("download",`historico_comandas_${new Date().toISOString().slice(0,10)}.csv`),ze.style.visibility="hidden",document.body.appendChild(ze),ze.click(),document.body.removeChild(ze),e({title:"CSV exportado!",description:`${qr.length} comandas exportadas`,variant:"success"})}catch(Me){console.error("Erro ao exportar CSV:",Me),e({title:"Erro ao exportar",description:Me.message,variant:"destructive"})}},te=async()=>{try{if(e({title:"Gerando CSV...",description:"Aguarde enquanto preparamos o arquivo",variant:"default"}),!l||l.length===0){e({title:"Nenhum dado para exportar",variant:"warning"});return}const Me=l.map(Wr=>{const qr=Wr.status==="open"?"Aberto":Wr.status==="closed"?"Fechado":Wr.status;return{"Data Abertura":Wr.aberto_em?new Date(Wr.aberto_em).toLocaleString("pt-BR"):"-","Data Fechamento":Wr.fechado_em?new Date(Wr.fechado_em).toLocaleString("pt-BR"):"-",Status:qr,"Saldo Inicial (R$)":Number(Wr.saldo_inicial||0).toFixed(2),"Saldo Final (R$)":Number(Wr.saldo_final||0).toFixed(2),"Valor Contado (R$)":Wr.valor_final_dinheiro?Number(Wr.valor_final_dinheiro).toFixed(2):"-","Diferena (R$)":Wr.diferenca_dinheiro?Number(Wr.diferenca_dinheiro).toFixed(2):"-"}}),tt=Object.keys(Me[0]),ut=[tt.join(";"),...Me.map(Wr=>tt.map(qr=>{const Tr=Wr[qr]||"";return`"${String(Tr).replace(/"/g,'""')}"`}).join(";"))].join(`
`),sr=new Blob(["\uFEFF"+ut],{type:"text/csv;charset=utf-8;"}),Sr=document.createElement("a"),xr=URL.createObjectURL(sr);Sr.setAttribute("href",xr),Sr.setAttribute("download",`fechamentos_caixa_${new Date().toISOString().slice(0,10)}.csv`),Sr.style.visibility="hidden",document.body.appendChild(Sr),Sr.click(),document.body.removeChild(Sr),e({title:"CSV exportado!",description:`${Me.length} fechamentos exportados`,variant:"success"})}catch(Me){console.error("Erro ao exportar CSV:",Me),e({title:"Erro ao exportar",description:Me.message,variant:"destructive"})}},ie=100,[xt,vt]=p.useState(0),[dt,St]=p.useState(!1),ft=p.useRef(!1),_t=p.useRef(0),gr=p.useRef(0),be=p.useRef(!1),Nt=()=>{try{const Me=localStorage.getItem("auth:userProfile");return Me&&JSON.parse(Me)?.codigo_empresa||null}catch{return null}},Wt=p.useMemo(()=>`hist:comandas:${Nt()||"na"}:${d}:${f}:${m}:${b}:${(y||"").trim()}`,[d,f,m,b,y]),_r=async({append:Me=!1,skipCacheWrite:tt=!1}={})=>{try{i(!0);const ut=Nt();if(!ut){i(!1);return}const sr=setTimeout(()=>i(!1),1e4);if(j==="comandas"){const Sr=!!(y&&y.trim()),xr=Sr?1e3:ie,Wr=Sr?0:xt;console.log("[HistoricoComandasPage] Carregando com:",{status:m,from:d,to:f,search:y,mesaId:s,searching:Sr,effLimit:xr});const qr=await zz({status:m,from:d,to:f,search:s||y,limit:xr,offset:Wr});console.log("[HistoricoComandasPage] Resultado:",qr?.length||0,"comandas");const Tr=(qr||[]).map(Ot=>Ot.id);let sn={};if(Tr.length>0)try{sn=await JS(Tr,ut)}catch{sn={}}let Cn=[];try{Cn=await Bh(ut)}catch{Cn=[]}const ze=new Map((Cn||[]).map(Ot=>[Ot.id,Ot.numero]));let Fe={},Le={};try{Fe=await c3(Tr)}catch{Fe={}}try{Le=await d3(Tr)}catch{Le={}}const Ze=(qr||[]).map(Ot=>{const mt=Fe[Ot.id],Qt=Le[Ot.id];return{...Ot,statusDerived:Ot.status==="cancelled"?"cancelled":Ot.fechado_em?"closed":Ot.status||"open",total:Number(sn[Ot.id]||0),mesaNumero:ze.get(Ot.mesa_id),clientesStr:Array.isArray(mt)?mt.join(", "):mt||"",finalizadorasStr:Array.isArray(Qt)?Qt.join(", "):Qt||""}});if(St(Sr?!1:(qr||[]).length===ie),c(Me?Ot=>[...Ot,...Ze]:Ze),!tt)try{localStorage.setItem(Wt,JSON.stringify({ts:Date.now(),rows:Ze}))}catch{}}else{const Sr=await lne({from:d,to:f,limit:100,offset:0,codigoEmpresa:ut});c(Sr||[])}clearTimeout(sr)}catch(ut){e({title:"Falha ao carregar histrico",description:ut?.message||"Tente novamente",variant:"destructive"})}finally{i(!1),_t.current=Date.now()}};p.useEffect(()=>{s&&(async()=>{try{const ut=(await Bh(r?.codigo_empresa)||[]).find(sr=>sr.id===s);ut&&P(`Mesa ${ut.numero}`)}catch{}})()},[s,r?.codigo_empresa]),p.useEffect(()=>{if(ft.current=!0,j==="comandas")try{const Me=localStorage.getItem(Wt);if(Me){const tt=JSON.parse(Me);tt&&Array.isArray(tt.rows)&&Date.now()-Number(tt.ts||0)<12e4&&c(tt.rows)}}catch{}return()=>{ft.current=!1}},[Wt,j]),p.useEffect(()=>{j==="comandas"&&(vt(0),St(!1)),_r({append:!1})},[m,y,d,f,j]),p.useEffect(()=>{if(!o&&j==="comandas"&&l.length===0){const Me=setTimeout(()=>{ft.current&&_r({append:!1,skipCacheWrite:!1})},1500);return()=>clearTimeout(Me)}},[l.length,o,j]),p.useEffect(()=>{const Me=()=>{document.visibilityState==="visible"&&Date.now()-(_t.current||0)>3e4&&_r({append:!1})},tt=()=>{Date.now()-(_t.current||0)>3e4&&_r({append:!1})};return window.addEventListener("visibilitychange",Me),window.addEventListener("focus",tt),()=>{window.removeEventListener("visibilitychange",Me),window.removeEventListener("focus",tt)}},[Wt,j]);const yr=async Me=>{O(Me),T({loading:!0,itens:[],pagamentos:[]});const tt=Nt();be.current=!0;const ut=++gr.current,sr=setTimeout(()=>{gr.current===ut&&be.current&&T(Sr=>({...Sr,loading:!1}))},1e4);if(!tt){clearTimeout(sr),gr.current===ut&&be.current&&T({loading:!1,itens:[],pagamentos:[]});return}try{const Sr=(l||[]).find(xr=>xr.id===Me)||null;if(Sr){const xr=Sr.mesa_id==null?"Balco":Sr.mesaNumero!=null?`Mesa ${Sr.mesaNumero}`:"Comanda";$({mesaLabel:xr,clientesStr:Sr.clientesStr||"",aberto_em:Sr.aberto_em||null,fechado_em:Sr.fechado_em||null,tipo:Sr.mesa_id==null?"balcao":"comanda",status:Sr.statusDerived||Sr.status||"open",diferenca_pagamento:typeof Sr.diferenca_pagamento=="number"?Sr.diferenca_pagamento:0})}else $(null)}catch{$(null)}try{const Sr=async()=>{const[Wr,qr]=await Promise.all([ii({comandaId:Me,codigoEmpresa:tt}),one({comandaId:Me,codigoEmpresa:tt})]);let Tr=[];try{Tr=await rl({comandaId:Me,codigoEmpresa:tt})}catch{}console.log("[openDetail] clientesVinc:",Tr);const sn=new Map((Tr||[]).map(Fe=>{const Le=Fe?.cliente_id??Fe?.clientes?.id??null,Ze=Fe?.clientes?.nome??Fe?.nome??Fe?.nome_livre??"";return console.log(`[openDetail] Mapeando cliente: cid=${Le}, nome=${Ze}`),Le?[String(Le),Ze]:null}).filter(Boolean));console.log("[openDetail] nomeById map:",Array.from(sn.entries()));const Cn=[...Array.from(sn.values()),...(Tr||[]).filter(Fe=>!Fe?.cliente_id&&(Fe?.nome_livre||Fe?.nome)).map(Fe=>Fe?.nome_livre||Fe?.nome||"Consumidor")];console.log("[openDetail] clientesDisponiveis:",Cn),console.log("[openDetail] pagamentos:",qr);const ze=(qr||[]).map((Fe,Le)=>{let Ze="";return Fe?.cliente_id?(Ze=sn.get(String(Fe.cliente_id))||"",!Ze&&Cn.length>0&&(Ze=Cn[Le%Cn.length])):Cn.length>0&&(Ze=Cn[Le%Cn.length]),console.log(`[openDetail] Pagamento ${Le}: cliente_id=${Fe?.cliente_id}, clienteNome=${Ze}`),{...Fe,cliente_nome:Ze,finalizadora_nome:Fe?.finalizadoras?.nome||Fe?.metodo||""}});return{itens:Wr||[],pagamentos:ze}};let xr=await Sr();xr.itens.length===0&&xr.pagamentos.length===0&&(await new Promise(Wr=>setTimeout(Wr,700)),xr=await Sr()),gr.current===ut&&be.current&&T({loading:!1,itens:xr.itens,pagamentos:xr.pagamentos})}catch(Sr){gr.current===ut&&be.current&&T({loading:!1,itens:[],pagamentos:[]}),e({title:"Falha ao carregar detalhes",description:Sr?.message||"Tente novamente",variant:"destructive"})}finally{clearTimeout(sr),gr.current===ut&&be.current&&T(Sr=>({...Sr,loading:!1}))}},ve=p.useMemo(()=>({sum:l.reduce((tt,ut)=>tt+Number(ut.total||0),0)}),[l]),at=Me=>(Me||"").toString().toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,""),qt=p.useMemo(()=>{const Me=(y||"").trim(),tt=at(Me),sr=l.filter(Sr=>{const xr=Sr.mesa_id==null;return!(b==="balcao"&&!xr||b==="comanda"&&xr)}).filter(Sr=>{const xr=Sr.statusDerived||(Sr.status==="cancelled"?"cancelled":Sr.fechado_em?"closed":Sr.status||"open");return m==="closed"?xr==="closed":m==="open"?xr==="open":m==="awaiting-payment"?xr==="awaiting-payment":m==="cancelled"?xr==="cancelled":!0});return tt?sr.filter(Sr=>{const xr=Sr.mesaNumero!=null?String(Sr.mesaNumero):"",Wr=Sr.mesa_id==null?"balcao":`mesa ${xr}`;return[xr,Wr,Sr.clientesStr||"",Sr.finalizadorasStr||"",Sr.mesa_id==null?"balcao":"comanda",Sr.statusDerived||Sr.status||""].map(at).join(" | ").includes(tt)}):sr},[l,y,b,m]),$t=Me=>Me==="open"?"Aberta":Me==="awaiting-payment"?"Pagamento":Me==="closed"?"Fechada":Me==="cancelled"?"Cancelada":Me||"",De=Me=>{if(!Me)return"";try{return new Date(Me).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}},wt=Me=>{const tt=String(Me||"").toLowerCase();return tt==="open"?"Aberto":tt==="closed"?"Fechado":""},Rt=Me=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Me||0)),Rr=Me=>Me==="open"?"text-info bg-info/10 border-info/30":Me==="awaiting-payment"?"text-warning bg-warning/10 border-warning/30":Me==="closed"?"text-success bg-success/10 border-success/30":Me==="cancelled"?"text-red-400 bg-red-500/10 border-red-500/30":"text-text-secondary bg-transparent border-border/50";return a.jsxs(Mr.div,{variants:llt,initial:"hidden",animate:"visible",className:"min-h-screen flex flex-col",children:[a.jsxs(Mr.div,{variants:hb,className:"mb-6 gap-3 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[a.jsx(Sd,{value:"historico",onValueChange:Me=>{Me==="mesas"&&t("/vendas"),Me==="balcao"&&t("/balcao"),Me==="historico"&&t("/historico")},children:a.jsxs(jc,{className:"grid w-full sm:w-auto grid-cols-3 sm:inline-flex",children:[a.jsx(Ga,{value:"mesas",children:"Mesas"}),a.jsx(Ga,{value:"balcao",children:"Balco"}),a.jsx(Ga,{value:"historico",children:"Histrico"})]})}),a.jsxs("div",{className:"w-full flex items-center gap-2 sm:gap-3",children:[a.jsxs("div",{className:"flex sm:hidden items-center gap-2 w-full",children:[a.jsxs(ea,{value:j,onValueChange:_,children:[a.jsx(Jn,{className:"w-[160px] text-sm",children:a.jsx(ra,{placeholder:"Selecionar"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"comandas",children:"Comandas"}),a.jsx(Qe,{value:"fechamentos",children:"Fechamentos"})]})]}),a.jsxs("div",{className:"ml-auto text-xs text-text-secondary whitespace-nowrap",children:["Total: ",a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",ve.sum.toFixed(2)]})]}),j==="comandas"&&a.jsx(Z,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 sm:hidden",onClick:()=>ee(!0),title:"Aes",children:a.jsx(ys,{className:"h-4 w-4"})}),j==="fechamentos"&&a.jsx(Z,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 sm:hidden",onClick:te,title:"Exportar",children:a.jsx(ys,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"hidden sm:flex items-center gap-2 sm:gap-3 ml-auto",children:a.jsx(Sd,{value:j,onValueChange:_,className:"w-full sm:w-auto",children:a.jsxs(jc,{className:"w-full grid grid-cols-2 sm:w-auto sm:inline-flex text-sm",children:[a.jsx(Ga,{value:"comandas",className:"text-sm",children:"Comandas"}),a.jsx(Ga,{value:"fechamentos",className:"text-sm",children:"Fechamentos"})]})})})]}),a.jsxs("div",{className:"hidden sm:flex w-full sm:w-auto items-center gap-2 sm:gap-3",children:[j==="comandas"&&a.jsxs(a.Fragment,{children:[a.jsxs(Z,{variant:"secondary",size:"sm",className:"hidden sm:inline-flex",onClick:()=>Y(!0),children:[a.jsx(ol,{className:"mr-2 h-4 w-4"}),"Importar XML"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"hidden sm:inline-flex",onClick:Te,children:[a.jsx(ys,{className:"mr-1 h-3 w-3"}),"Exportar"]}),a.jsx("button",{className:"hidden sm:inline-block text-xs text-text-muted hover:text-text-primary transition-colors",onClick:()=>{if(ae){const Me=new Date().toISOString().slice(0,10);u(Me),h(Me),le(!1)}else u(""),h(""),le(!0);vt(0)},title:ae?"Voltar ao filtro de hoje":"Mostrar todas as comandas",children:ae?"":""}),a.jsxs("div",{className:"text-sm text-text-secondary whitespace-nowrap ml-auto",children:["Total: ",a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",ve.sum.toFixed(2)]})]})]}),j==="fechamentos"&&a.jsxs(Z,{variant:"outline",size:"sm",className:"hidden sm:inline-flex",onClick:te,children:[a.jsx(ys,{className:"mr-1 h-3 w-3"}),"Exportar"]})]})]}),a.jsx(zn,{open:me,onOpenChange:ee,children:a.jsxs(qn,{className:"sm:hidden w-[92vw] max-w-[360px] p-2",onOpenAutoFocus:Me=>Me.preventDefault(),onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{className:"text-base",children:"Aes"}),a.jsx(la,{children:"Escolha uma ao para Comandas"})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs(Z,{variant:"secondary",onClick:()=>{ee(!1),Y(!0)},children:[a.jsx(ol,{className:"mr-2 h-4 w-4"})," Importar XML"]}),a.jsxs(Z,{variant:"outline",onClick:()=>{ee(!1),Te()},children:[a.jsx(ys,{className:"mr-2 h-4 w-4"})," Exportar CSV"]})]})]})}),j==="comandas"&&a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:["Carregadas ",l.length," ",l.length===1?"comanda":"comandas"]}),dt&&a.jsx(Z,{size:"sm",variant:"outline",disabled:o,onClick:async()=>{const Me=xt+ie;vt(Me),await _r({append:!0})},children:"Carregar mais"})]}),j==="comandas"&&a.jsxs("div",{className:"sm:hidden bg-surface rounded-lg border border-border p-3 mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Buscar...",className:"pl-9 h-9 text-sm",value:g,onChange:Me=>v(Me.target.value)})]}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-9",onClick:()=>A(Me=>!Me),children:C?"Ocultar":"Filtros"})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-secondary truncate",children:[d||"","  ",f||""]})]}),j==="comandas"&&a.jsx(Mr.div,{variants:hb,className:`bg-surface rounded-lg border border-border p-4 mb-4 ${C?"":"hidden"} sm:block`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Perodo Inicial"}),a.jsx(u_,{value:d,onChange:u})]}),a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Perodo Final"}),a.jsx(u_,{value:f,onChange:h})]}),a.jsxs("div",{className:"md:col-span-2 hidden sm:block",children:[a.jsxs(lt,{className:"mb-1 block",children:["Busca ",S&&a.jsxs("span",{className:"text-xs text-warning ml-1",children:["(",S,")"]})]}),a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(At,{placeholder:"Mesa, status (fechada/aberta) ou cliente",className:"pl-9 pr-12",value:g,onChange:Me=>v(Me.target.value)}),s&&a.jsx(Z,{size:"sm",variant:"ghost",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 text-xs",onClick:()=>{t("/historico")},children:" Limpar"})]})]}),a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Status"}),a.jsxs(ea,{value:m,onValueChange:x,children:[a.jsx(Jn,{className:"w-full text-xs",children:a.jsx(ra,{placeholder:"Selecionar status"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"closed",children:"Fechadas"}),a.jsx(Qe,{value:"open",children:"Abertas"}),a.jsx(Qe,{value:"awaiting-payment",children:"Pagamento"}),a.jsx(Qe,{value:"cancelled",children:"Canceladas"})]})]})]}),a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Tipo"}),a.jsxs(ea,{value:b,onValueChange:w,children:[a.jsx(Jn,{className:"w-full text-xs",children:a.jsx(ra,{placeholder:"Selecionar tipo"})}),a.jsxs(Qn,{children:[a.jsx(Qe,{value:"all",children:"Todos"}),a.jsx(Qe,{value:"comanda",children:"Comandas"}),a.jsx(Qe,{value:"balcao",children:"Balco"})]})]})]})]})}),j==="comandas"&&a.jsxs(Mr.div,{variants:hb,className:"bg-surface rounded-lg border border-border p-0 overflow-hidden",children:[a.jsx("div",{className:"hidden sm:block overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-4 py-3 whitespace-nowrap",children:"Local"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Clientes"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Finalizadora"}),a.jsx("th",{className:"text-left px-4 py-3 whitespace-nowrap",children:"Abertura"}),a.jsx("th",{className:"text-right px-4 py-3 whitespace-nowrap",children:"Diferena"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Total"}),a.jsx("th",{className:"text-right px-4 py-3 whitespace-nowrap",children:"Fiscal"})]})}),a.jsxs("tbody",{children:[qt.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-text-muted",children:"Nenhuma comanda encontrada no perodo."})}),qt.map(Me=>a.jsxs("tr",{className:"border-t border-border/70 hover:bg-warning/10 cursor-pointer transition-all duration-150 hover:translate-x-[1px]",onClick:()=>yr(Me.id),children:[a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:Me.mesa_id==null?"Balco":Me.mesaNumero!=null?`Mesa ${Me.mesaNumero}`:""}),a.jsx("td",{className:"px-4 py-2 break-words",title:Me.clientesStr||"",children:Me.clientesStr||""}),a.jsx("td",{className:"px-4 py-2",children:a.jsx("span",{className:Er("inline-flex items-center text-[11px] font-medium px-2 py-0.5 rounded-full border",Rr(Me.statusDerived||Me.status)),children:$t(Me.statusDerived||Me.status)})}),a.jsx("td",{className:"px-4 py-2 break-words",title:Me.finalizadorasStr||"",children:Me.finalizadorasStr||""}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:De(Me.aberto_em)}),a.jsx("td",{className:"px-4 py-2 text-right whitespace-nowrap",children:(()=>{const tt=typeof Me.diferenca_pagamento=="number"?Me.diferenca_pagamento:0;if(Math.abs(tt)<.005)return a.jsx("span",{className:"text-xs text-text-muted",children:"R$ 0,00"});const ut=tt>0?"text-emerald-500":"text-amber-500",sr=tt>0?"+":"-";return a.jsx("span",{className:`text-xs font-semibold ${ut}`,children:`${sr} R$ ${Math.abs(tt).toFixed(2)}`})})()}),a.jsx("td",{className:"px-4 py-2 text-right font-semibold whitespace-nowrap",children:Rt(Me.total)}),a.jsx("td",{className:"px-4 py-2 text-right whitespace-nowrap",children:Me.fechado_em&&(!Me.nf_status||Me.nf_status==="rejeitada")&&a.jsx(Z,{size:"sm",variant:"outline",onClick:tt=>{tt.stopPropagation(),X(Me.id)},children:"Pr-Emisso"})})]},Me.id))]})]})}),a.jsxs("div",{className:"sm:hidden divide-y divide-border",children:[qt.length===0&&a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Nenhuma comanda encontrada no perodo."}),qt.map(Me=>a.jsxs("button",{className:"w-full text-left p-3 active:bg-warning/10",onClick:()=>yr(Me.id),children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:Me.mesa_id==null?"Balco":Me.mesaNumero!=null?`Mesa ${Me.mesaNumero}`:"Comanda"}),a.jsx("div",{className:"font-semibold truncate max-w-[220px]",children:Me.clientesStr||"Sem cliente"})]}),a.jsx("div",{children:a.jsx("div",{className:Er("inline-flex items-center text-[10px] font-medium px-2 py-0.5 rounded-full border",Rr(Me.statusDerived||Me.status)),children:$t(Me.statusDerived||Me.status)})})]}),a.jsx("div",{className:"mt-1 text-xs text-text-secondary truncate",children:Me.finalizadorasStr||""}),a.jsxs("div",{className:"mt-2 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0 text-[11px] text-text-muted truncate pr-2",children:[De(Me.aberto_em),Me.fechado_em?`  ${De(Me.fechado_em)}`:""]}),a.jsxs("div",{className:"flex-shrink-0 text-right min-w-[84px]",children:[a.jsx("div",{className:"text-[11px]",children:(()=>{const tt=typeof Me.diferenca_pagamento=="number"?Me.diferenca_pagamento:0;if(Math.abs(tt)<.005)return a.jsx("span",{className:"text-text-muted",children:"Dif.: R$ 0,00"});const ut=tt>0?"text-emerald-500":"text-amber-500",sr=tt>0?"+":"-";return a.jsx("span",{className:ut,children:`Dif.: ${sr} R$ ${Math.abs(tt).toFixed(2)}`})})()}),a.jsx("div",{className:"font-mono font-semibold whitespace-nowrap",children:Rt(Me.total)})]})]}),Me.fechado_em&&(!Me.nf_status||Me.nf_status==="rejeitada")&&a.jsx("div",{className:"mt-2 flex justify-end",children:a.jsx(Z,{size:"sm",variant:"outline",onClick:tt=>{tt.preventDefault(),tt.stopPropagation(),X(Me.id)},children:"Pr-Emisso"})})]},Me.id))]})]}),a.jsx(zn,{open:F,onOpenChange:V,children:a.jsxs(qn,{className:"max-w-[800px]",children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Pr-Emisso NFC-e"}),a.jsx(la,{children:"Revise os dados e pendncias antes de emitir."})]}),ue?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Gerando prvia"}):a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"JSON (EnviarNfce)"}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto",children:U?JSON.stringify(U,null,2):""})]}),a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Pendncias"}),!G||G.length===0?a.jsx("div",{className:"text-sm text-emerald-500",children:"Nenhuma pendncia encontrada."}):a.jsx("ul",{className:"list-disc pl-5 text-sm",children:G.map((Me,tt)=>a.jsx("li",{children:Me},tt))})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>V(!1),children:"Fechar"}),a.jsx(Z,{disabled:!0,children:"Emitir (desabilitado)"})]})]})}),j==="fechamentos"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"sm:hidden bg-surface rounded-lg border border-border p-3 mb-3",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Filtros"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>A(Me=>!Me),children:C?"Ocultar filtros":"Mostrar filtros"})]})}),a.jsx(Mr.div,{variants:hb,className:`bg-surface rounded-lg border border-border p-4 mb-4 ${C?"":"hidden"} sm:block`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Perodo Inicial"}),a.jsx(u_,{value:d,onChange:u})]}),a.jsxs("div",{children:[a.jsx(lt,{className:"mb-1 block",children:"Perodo Final"}),a.jsx(u_,{value:f,onChange:h})]})]})}),a.jsxs(Mr.div,{variants:hb,className:"bg-surface rounded-lg border border-border p-4 overflow-hidden",children:[a.jsxs("div",{className:"sm:hidden space-y-2",children:[o&&(!l||l.length===0)&&a.jsxs("div",{className:"px-2 py-3 text-center text-text-muted",children:[a.jsx(ll,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando fechamentos"]}),(!l||l.length===0)&&!o&&a.jsx("div",{className:"px-2 py-3 text-center text-text-muted",children:"Nenhum fechamento encontrado no perodo."}),(l||[]).map(Me=>a.jsxs("button",{onClick:async()=>{try{z({open:!0,loading:!0,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}});const tt=Nt(),[ut,sr]=await Promise.all([QS({caixaSessaoId:Me.id,codigoEmpresa:tt}).catch(()=>null),$g({caixaSessaoId:Me.id,codigoEmpresa:tt}).catch(()=>[])]);let Sr=ut?.movimentos||null;if(!Sr&&Array.isArray(sr)){const Wr={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const qr of sr){const Tr=String(qr?.tipo||"").toLowerCase(),sn=Number(qr?.valor||0);Tr==="suprimento"?Wr.suprimentos+=sn:Tr==="sangria"?Wr.sangrias+=sn:Tr==="ajuste"?Wr.ajustes+=sn:Tr==="troco"&&(Wr.troco+=sn)}Sr=Wr}const xr=ut?{totalDescontos:Number(ut.total_descontos||0),totalVendasLiquidas:Number(ut.total_liquido||0),totalEntradas:Number(ut.total_entradas||0),totalPorFinalizadora:ut.por_finalizadora||{}}:null;z({open:!0,loading:!1,resumo:xr,periodo:{from:ut?.periodo_de||Me.aberto_em,to:ut?.periodo_ate||Me.fechado_em},movs:sr||[],movimentosAgg:Sr,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}})}catch{z({open:!0,loading:!1,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}})}},className:"w-full text-left p-3 rounded-lg border border-border hover:bg-surface-2 transition",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:[De(Me.aberto_em),a.jsx("span",{className:"mx-1",children:""}),De(Me.fechado_em)]}),a.jsx("div",{className:"text-[11px] px-2 py-0.5 rounded-full border bg-success/10 text-success border-success/30",children:wt(Me.status)})]}),a.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:"bg-surface-2 rounded p-2 border border-border",children:[a.jsx("div",{className:"text-[10px] text-text-secondary",children:"Saldo Inicial"}),a.jsx("div",{className:"font-semibold",children:Me?.saldo_inicial!=null?Rt(Me.saldo_inicial):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded p-2 border border-border",children:[a.jsx("div",{className:"text-[10px] text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("div",{className:"font-semibold",children:Me?.valor_final_dinheiro!=null?Rt(Me.valor_final_dinheiro):""})]})]})]},Me.id))]}),a.jsx("div",{className:"hidden sm:block overflow-x-auto max-h-[60vh] overflow-y-auto pr-2 sm:pr-3",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-4 py-3",children:"Abertura"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Fechamento"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Saldo Inicial"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Saldo Final (contado)"})]})}),a.jsxs("tbody",{children:[o&&(!l||l.length===0)&&a.jsx("tr",{children:a.jsxs("td",{colSpan:5,className:"px-4 py-6 text-center text-text-muted",children:[a.jsx(ll,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando fechamentos"]})}),(!l||l.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-text-muted",children:"Nenhum fechamento encontrado no perodo."})}),(l||[]).map(Me=>a.jsxs("tr",{className:"border-t border-border/70 hover:bg-success/10 cursor-pointer transition-all duration-150 hover:translate-x-[1px]",onClick:async()=>{try{z({open:!0,loading:!0,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}});const tt=async()=>{const Sr=Nt(),[xr,Wr]=await Promise.all([QS({caixaSessaoId:Me.id,codigoEmpresa:Sr}).catch(()=>null),$g({caixaSessaoId:Me.id,codigoEmpresa:Sr}).catch(()=>[])]);return{snap:xr,movs:Wr}};let{snap:ut,movs:sr}=await tt();if(ut||(await new Promise(Sr=>setTimeout(Sr,700)),{snap:ut,movs:sr}=await tt()),ut){const Sr={totalDescontos:Number(ut.total_descontos||0),totalVendasLiquidas:Number(ut.total_liquido||0),totalEntradas:Number(ut.total_entradas||0),totalPorFinalizadora:ut.por_finalizadora||{}};let xr=ut.movimentos||null;if(!xr&&Array.isArray(sr)){const Wr={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const qr of sr){const Tr=String(qr?.tipo||"").toLowerCase(),sn=Number(qr?.valor||0);Tr==="suprimento"?Wr.suprimentos+=sn:Tr==="sangria"?Wr.sangrias+=sn:Tr==="ajuste"?Wr.ajustes+=sn:Tr==="troco"&&(Wr.troco+=sn)}xr=Wr}z({open:!0,loading:!1,resumo:Sr,periodo:{from:ut.periodo_de||Me.aberto_em,to:ut.periodo_ate||Me.fechado_em},movs:sr||[],movimentosAgg:xr,saldos:{inicial:typeof ut.saldo_inicial<"u"?Number(ut.saldo_inicial):Me?.saldo_inicial??null,final:typeof ut.valor_final_dinheiro<"u"?Number(ut.valor_final_dinheiro):Me?.valor_final_dinheiro??null}})}else{const Sr=Nt(),xr=await hu({from:Me.aberto_em,to:Me.fechado_em||new Date().toISOString(),codigoEmpresa:Sr});let Wr=null;if(Array.isArray(sr)){const qr={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const Tr of sr){const sn=String(Tr?.tipo||"").toLowerCase(),Cn=Number(Tr?.valor||0);sn==="suprimento"?qr.suprimentos+=Cn:sn==="sangria"?qr.sangrias+=Cn:sn==="ajuste"?qr.ajustes+=Cn:sn==="troco"&&(qr.troco+=Cn)}Wr=qr}z({open:!0,loading:!1,resumo:xr||null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:sr||[],movimentosAgg:Wr,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.valor_final_dinheiro??null}})}}catch{z({open:!0,loading:!1,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.valor_final_dinheiro??null}})}},children:[a.jsx("td",{className:"px-4 py-2",children:De(Me.aberto_em)}),a.jsx("td",{className:"px-4 py-2",children:De(Me.fechado_em)}),a.jsx("td",{className:"px-4 py-2",children:wt(Me.status)}),a.jsx("td",{className:"px-4 py-2 text-right",children:Me?.saldo_inicial!=null?Rt(Me.saldo_inicial):""}),a.jsx("td",{className:"px-4 py-2 text-right",children:Me?.valor_final_dinheiro!=null?Rt(Me.valor_final_dinheiro):""})]},Me.id))]})]})})]})]}),j==="comandas"&&a.jsx(zn,{open:!!M,onOpenChange:Me=>{Me?be.current=!0:(be.current=!1,O(null),T({loading:!1,itens:[],pagamentos:[]}),$(null))},children:a.jsxs(qn,{className:"sm:max-w-4xl w-[92vw] max-h-[90vh] overflow-hidden flex flex-col animate-none",onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsxs($n,{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("span",{children:k?a.jsxs("span",{children:[k.mesaLabel,k.clientesStr?a.jsxs("span",{className:"text-text-secondary",children:["  ",k.clientesStr]}):null]}):a.jsxs(a.Fragment,{children:["Comanda #",M||""]})}),k&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("span",{className:Er("text-xs px-2 py-0.5 rounded-full border",Rr(k.status)),children:k.status==="closed"?"Fechada":k.status==="open"?"Aberta":"Cancelada"}),a.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-info/10 text-info border-info/30",children:k.tipo==="balcao"?"Balco":k.tipo==="comanda"?"Mesa":"Importada"})]})]}),a.jsx(la,{className:"space-y-1",children:k?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[k.aberto_em?a.jsxs(a.Fragment,{children:["Abertura: ",De(k.aberto_em)]}):"",k.fechado_em&&a.jsxs(a.Fragment,{children:[" ",""," ","Fechamento: ",De(k.fechado_em),(()=>{const Me=new Date(k.aberto_em),ut=new Date(k.fechado_em)-Me,sr=Math.floor(ut/6e4),Sr=Math.floor(sr/60),xr=sr%60;return sr>0?a.jsxs("span",{className:"text-text-muted",children:[" (",Sr>0?`${Sr}h `:"",xr,"min)"]}):null})()]})]}),k.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:k.observacao.includes("Importado de XML")?a.jsxs("span",{className:"text-warning",children:[" ",k.observacao.split(`
`)[0]]}):a.jsxs("span",{children:["Obs: ",k.observacao]})})]}):a.jsx(a.Fragment,{children:"Itens e pagamentos registrados."})})]}),I.loading?a.jsxs("div",{className:"p-6 text-center text-text-muted",children:[a.jsx(ll,{className:"mr-2 inline h-4 w-4 animate-spin"})," Carregando..."]}):a.jsxs("div",{className:"space-y-4 overflow-y-auto flex-1 px-1",children:[(()=>{const Me=I.itens.reduce((Wr,qr)=>Wr+Number(qr.quantidade||0)*Number(qr.preco_unitario||0),0),tt=I.itens.reduce((Wr,qr)=>Wr+Number(qr.desconto||0),0),ut=Me-tt,sr=I.pagamentos.reduce((Wr,qr)=>Wr+Number(qr.valor||0),0),Sr=typeof k?.diferenca_pagamento=="number"?k.diferenca_pagamento:null,xr=Sr??sr-ut;return a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Resumo Financeiro"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Subtotal"}),a.jsxs("span",{className:"font-mono font-semibold",children:["R$ ",Me.toFixed(2)]})]}),tt>0&&a.jsxs("div",{className:"flex items-center gap-2 text-warning",children:[a.jsx("span",{children:"Desconto"}),a.jsxs("span",{className:"font-mono font-semibold",children:["-R$ ",tt.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex justify-between font-semibold pt-2 border-t border-border",children:[a.jsx("span",{children:"Total:"}),a.jsxs("span",{className:"font-mono text-lg",children:["R$ ",ut.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2 text-success",children:[a.jsx("span",{children:"Pagamentos"}),a.jsxs("span",{className:"font-mono",children:["R$ ",sr.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-secondary",children:"Diferena"}),a.jsx("span",{className:Er("font-semibold",Math.abs(xr)<.005?"text-text-muted":xr>0?"text-emerald-500":"text-amber-500"),children:Math.abs(xr)<.005?"R$ 0,00":`${xr>0?"+":"-"} R$ ${Math.abs(xr).toFixed(2)}`})]})]})]})]})})(),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"border rounded-md p-3",children:[a.jsxs("div",{className:"font-semibold mb-2",children:["Itens (",I.itens.length,")"]}),I.itens.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem itens."}):a.jsx("ul",{className:"text-sm space-y-2 max-h-64 overflow-auto thin-scroll",children:I.itens.map(Me=>{const tt=Number(Me.quantidade||0)*Number(Me.preco_unitario||0),ut=Number(Me.desconto||0),sr=tt-ut;return a.jsx("li",{className:"border-b border-border/50 pb-2 last:border-0",children:a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("span",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:Me.descricao}),a.jsxs("div",{className:"text-xs text-text-muted",children:[Me.quantidade," x R$ ",Number(Me.preco_unitario||0).toFixed(2),ut>0&&a.jsxs("span",{className:"text-warning",children:[" (desc: R$ ",ut.toFixed(2),")"]})]})]}),a.jsxs("span",{className:"font-mono font-semibold whitespace-nowrap",children:["R$ ",sr.toFixed(2)]})]})},Me.id)})})]}),a.jsxs("div",{className:"border rounded-md p-3",children:[a.jsxs("div",{className:"font-semibold mb-2",children:["Pagamentos (",I.pagamentos.length,")"]}),I.pagamentos.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros."}):a.jsx("ul",{className:"text-sm space-y-2 max-h-64 overflow-auto thin-scroll",children:I.pagamentos.map(Me=>a.jsxs("li",{className:"flex justify-between gap-2 border-b border-border/50 pb-2 last:border-0",children:[a.jsxs("span",{className:"pr-2 break-words flex-1",children:[Me.cliente_nome?a.jsx("div",{className:"font-medium",children:Me.cliente_nome}):a.jsx("div",{className:"text-text-muted",children:"Sem cliente"}),a.jsx("div",{className:"text-xs text-text-secondary",children:Me.finalizadora_nome||"Outros"})]}),a.jsxs("span",{className:"font-mono font-semibold whitespace-nowrap",children:["R$ ",Number(Me.valor||0).toFixed(2)]})]},Me.id))})]})]})]}),a.jsx(Ua,{children:a.jsx(Z,{size:"sm",variant:"secondary",onClick:()=>{O(null)},children:"Fechar"})})]})}),j==="fechamentos"&&a.jsx(zn,{open:q.open,onOpenChange:Me=>{Me||z({open:!1,loading:!1,resumo:null,periodo:{from:null,to:null}})},children:a.jsxs(qn,{className:"sm:max-w-2xl w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden overflow-x-hidden",onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx($n,{children:"Fechamento do Perodo"}),a.jsxs(la,{children:[q.periodo.from?De(q.periodo.from):""," ","at"," ",q.periodo.to?De(q.periodo.to):""]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto pr-1",children:q.loading?a.jsxs("div",{className:"p-3 sm:p-4 text-text-muted",children:[a.jsx(ll,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando resumo"]}):a.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Inicial"}),a.jsx("p",{className:"text-xl font-bold",children:Rt(q?.saldos?.inicial??0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Entradas (pagamentos)"}),a.jsx("p",{className:"text-xl font-bold text-success",children:Rt(q.resumo?.totalEntradas||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border col-span-2 sm:col-span-1",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("p",{className:"text-xl font-bold",children:q?.saldos?.final!=null?Rt(q.saldos.final):""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Descontos"}),a.jsx("p",{className:"text-xl font-bold text-warning",children:Rt(q.resumo?.totalDescontos||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Lquido"}),a.jsx("p",{className:"text-xl font-bold",children:Rt(q.resumo?.totalVendasLiquidas||0)})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Por Finalizadora"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:q.resumo?.totalPorFinalizadora&&Object.keys(q.resumo.totalPorFinalizadora).length>0?Object.entries(q.resumo.totalPorFinalizadora).map(([Me,tt])=>a.jsxs("div",{className:"flex items-center justify-between bg-surface-2 rounded-md p-2 border border-border",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:String(Me)}),a.jsx("span",{className:"text-sm font-semibold",children:Rt(tt)})]},Me)):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados de finalizadoras"})})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Resumo de Movimentaes"}),q.movimentosAgg?a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Suprimentos"}),a.jsx("p",{className:"text-lg font-bold text-success",children:Rt(q.movimentosAgg?.suprimentos||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Sangrias"}),a.jsx("p",{className:"text-lg font-bold text-danger",children:Rt(q.movimentosAgg?.sangrias||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Ajustes"}),a.jsx("p",{className:"text-lg font-bold",children:Rt(q.movimentosAgg?.ajustes||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Troco"}),a.jsx("p",{className:"text-lg font-bold",children:Rt(q.movimentosAgg?.troco||0)})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem movimentaes agregadas nesta sesso."})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Movimentaes"}),!q.movs||q.movs.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma movimentao registrada"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"sm:hidden divide-y divide-border rounded-md border border-border overflow-hidden",children:q.movs.map((Me,tt)=>a.jsxs("li",{className:"px-3 py-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:De(Me.criado_em)}),a.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:Rt(Me.valor||0)})]}),a.jsxs("div",{className:"mt-0.5 flex items-center gap-2 text-xs",children:[a.jsx("span",{className:"px-1.5 py-0.5 rounded bg-surface-2 border border-border text-text-secondary whitespace-nowrap",children:String(Me.tipo||"").toUpperCase()}),a.jsx("span",{className:"text-xs text-text-primary whitespace-normal break-words flex-1",children:Me.observacao||""})]})]},tt))}),a.jsx("div",{className:"hidden sm:block rounded-md border border-border overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-3 py-2",children:"Data"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Tipo"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Obs"}),a.jsx("th",{className:"text-right px-3 py-2",children:"Valor"})]})}),a.jsx("tbody",{children:q.movs.map((Me,tt)=>a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:De(Me.criado_em)}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:String(Me.tipo||"").toUpperCase()}),a.jsx("td",{className:"px-3 py-2 whitespace-normal break-words",children:Me.observacao||""}),a.jsx("td",{className:"px-3 py-2 text-right font-semibold whitespace-nowrap",children:Rt(Me.valor||0)})]},tt))})]})})]})]})]})})]})}),a.jsx(ilt,{open:W,onOpenChange:Y,codigoEmpresa:r?.codigo_empresa,onSuccess:async Me=>{Y(!1),Me&&(u(Me),h(Me)),await new Promise(tt=>setTimeout(tt,500)),vt(0),await _r({append:!1})}})]})}function ult(){const{userProfile:e}=fo(),[t]=qC(),r=t.get("comanda"),[n,s]=p.useState(!0),[o,i]=p.useState(null),[l,c]=p.useState([]),[d,u]=p.useState([]),[f,h]=p.useState([]),[m,x]=p.useState(null),[g,v]=p.useState(""),[y,b]=p.useState("");p.useEffect(()=>{(async()=>{try{if(!r||!e?.codigo_empresa)return;try{const{data:T,error:k}=await Q.from("empresas").select("nome_fantasia, nome").eq("codigo_empresa",e.codigo_empresa).single();if(k&&console.warn("[PrintComandaPage] Erro ao buscar empresa:",k.message),T){const $=T.nome_fantasia||T.nome||"";console.log("[PrintComandaPage] Empresa carregada:",T,"-> nome exibido:",$),b($)}else console.warn("[PrintComandaPage] Empresa no encontrada para codigo_empresa:",e.codigo_empresa)}catch(T){console.warn("[PrintComandaPage] Exceo ao carregar empresa:",T)}const{data:A}=await Q.from("comandas").select("mesa_id, observacoes").eq("id",r).eq("codigo_empresa",e.codigo_empresa).single();if(A?.mesa_id){const{data:T}=await Q.from("mesas").select("numero").eq("id",A.mesa_id).eq("codigo_empresa",e.codigo_empresa).single();x(T)}v(A?.observacoes||"");const[S,P,M]=await Promise.all([ii({comandaId:r,codigoEmpresa:e.codigo_empresa}),rl({comandaId:r,codigoEmpresa:e.codigo_empresa}),one({comandaId:r,codigoEmpresa:e.codigo_empresa})]);c(S||[]),u(P||[]),h(M||[]);const O=(S||[]).reduce((T,k)=>T+Number(k.quantidade||0)*Number(k.preco_unitario||0),0),I=(M||[]).reduce((T,k)=>T+Number(k.valor||0),0);i({id:r,totalItens:O,totalPagamentos:I,diferenca:I-O})}catch(A){console.error("Erro ao carregar comanda:",A)}finally{s(!1)}})()},[r,e?.codigo_empresa]);const w=()=>{window.print()},j=()=>{window.history.back()};if(n)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand mx-auto mb-4"}),a.jsx("p",{className:"text-text-muted",children:"Carregando comanda..."})]})});if(!o)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-text-muted mb-4",children:"Comanda no encontrada"}),a.jsxs(Z,{onClick:j,variant:"outline",children:[a.jsx(Rb,{className:"mr-2 h-4 w-4"}),"Voltar"]})]})});const _=(d||[]).map(C=>C?.nome||C?.nome_livre||"").filter(Boolean).join(", ")||"Sem cliente";return o.totalItens,o.totalPagamentos,a.jsxs("div",{className:"w-screen h-screen bg-gray-100 flex flex-col print:bg-white print:p-0",children:[a.jsxs("div",{className:"flex gap-2 p-4 bg-white border-b border-gray-200 print:hidden",children:[a.jsxs(Z,{onClick:j,size:"sm",className:"bg-black text-white hover:bg-black/80 border border-black shadow-sm",children:[a.jsx(Rb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(Z,{onClick:w,size:"sm",className:"ml-auto",children:[a.jsx(_G,{className:"mr-2 h-4 w-4"}),"Imprimir"]})]}),a.jsx("div",{className:"flex-1 overflow-auto flex items-start justify-center p-4 print:p-0 print:overflow-visible print:flex-none",children:a.jsxs("div",{className:"w-80 border border-black p-6 bg-white print:border-0 print:p-0 print:w-full",children:[a.jsxs("div",{className:"text-center mb-4 border-b border-black pb-3",children:[a.jsx("p",{className:"text-xs font-semibold text-black mb-2",children:y||" "}),a.jsx("h1",{className:"text-xl font-bold text-black",children:"COMANDA"}),m&&a.jsxs("p",{className:"text-xs text-black mt-1",children:["Mesa ",m.numero]}),a.jsx("p",{className:"text-xs text-black mt-1",children:new Date().toLocaleString("pt-BR")})]}),a.jsxs("div",{className:"mb-6 pb-4 border-b border-black",children:[a.jsx("p",{className:"text-sm font-semibold text-black",children:"CLIENTE:"}),a.jsx("p",{className:"text-sm text-black",children:_})]}),a.jsx("div",{className:"mb-6 pb-4 border-b border-black",children:a.jsx("div",{className:"space-y-2",children:l.map((C,A)=>{const S=Number(C.quantidade||0)*Number(C.preco_unitario||0);return a.jsxs("div",{className:"flex justify-between text-sm text-black",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{children:C.descricao||"Item"}),a.jsxs("span",{className:"ml-2 text-xs",children:["x",C.quantidade]})]}),a.jsxs("span",{className:"font-semibold",children:["R$ ",S.toFixed(2)]})]},A)})})}),g&&a.jsxs("div",{className:"mb-4 pb-3",children:[a.jsx("p",{className:"text-xs font-semibold text-black mb-1",children:"OBS:"}),a.jsx("p",{className:"text-xs text-black border-b border-black pb-3",children:g})]}),a.jsx("div",{className:"text-center pt-4",children:a.jsxs("p",{className:"text-lg font-bold text-black mt-2",children:["TOTAL: R$ ",o.totalItens.toFixed(2)]})}),a.jsxs("div",{className:"text-center mt-8 pt-4 border-t border-black text-xs text-black",children:[a.jsx("p",{children:"Obrigado pela preferncia!"}),a.jsx("p",{className:"mt-2",children:"Fluxo7Arena"})]})]})}),a.jsx("style",{children:`
        @media print {
          body {
            margin: 0;
            padding: 0;
            background: white;
          }
          .print\\:hidden {
            display: none !important;
          }
          .print\\:border-0 {
            border: none !important;
          }
          .print\\:p-0 {
            padding: 0 !important;
          }
        }
      `})]})}const flt="18810778",ov={hidden:{opacity:0,x:20},visible:{opacity:1,x:0,transition:{duration:.3}},exit:{opacity:0,x:-20,transition:{duration:.2}}};function mlt(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,18)}function hlt(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").substring(0,15)}async function plt(){try{const{data:e,error:t}=await Q.from("empresas").select("codigo_empresa").order("codigo_empresa",{ascending:!1}).limit(100);if(t)return console.warn("Erro ao buscar cdigos:",t),"1";let r=0;return e&&e.length>0&&e.forEach(n=>{const s=parseInt(n.codigo_empresa);!isNaN(s)&&s>r&&(r=s)}),(r+1).toString()}catch(e){return console.warn("Erro ao gerar cdigo:",e),"1"}}function glt(){const{toast:e}=Xs(),t=Ol(),[r,n]=p.useState(1),[s,o]=p.useState(!1),[i,l]=p.useState(!1),[c,d]=p.useState(""),[u,f]=p.useState({email:"",nomeUsuario:"",cargo:"",razaoSocial:"",nomeFantasia:"",cnpj:"",emailEmpresa:"",telefone:"",endereco:"",quadras:[],mesas:[],categorias:[]}),[h,m]=p.useState(null),x=z=>{z.preventDefault(),c===flt?(l(!0),n(2),e({title:"Acesso liberado",description:"Bem-vindo ao formulrio de criao de empresa."})):(e({title:"Senha incorreta",description:"Tente novamente.",variant:"destructive"}),d(""))},g=()=>!0,v=()=>u.razaoSocial.trim()?u.nomeFantasia.trim()?!0:(e({title:"Nome Fantasia obrigatrio",variant:"destructive"}),!1):(e({title:"Razo Social obrigatria",variant:"destructive"}),!1),y=()=>{r===2&&!g()||r===3&&!v()||n(r+1)},b=()=>{n(r-1)},w=()=>{const z=u.quadras.length+1;f({...u,quadras:[...u.quadras,{nome:`Quadra ${z}`}]})},j=z=>{f({...u,quadras:u.quadras.filter((F,V)=>V!==z)})},_=()=>{const z=u.mesas.length+1;f({...u,mesas:[...u.mesas,{numero:z,nome:`Mesa ${z}`}]})},C=z=>{f({...u,mesas:u.mesas.filter((F,V)=>V!==z)})},A=()=>{const z=prompt("Digite o nome da categoria:");z&&z.trim()&&f({...u,categorias:[...u.categorias,{nome:z.trim(),descricao:""}]})},S=z=>{f({...u,categorias:u.categorias.filter((F,V)=>V!==z)})},P=async()=>{try{o(!0);try{const U={user:{email:u.email?.trim()||null,nome:u.nomeUsuario?.trim()||null,cargo:u.cargo?.trim()||"admin"},empresa:{razao_social:u.razaoSocial?.trim()||null,nome_fantasia:u.nomeFantasia?.trim()||null,cnpj:u.cnpj?u.cnpj.replace(/\D/g,""):null,email:u.emailEmpresa?.trim()||null,telefone:u.telefone?.trim()||null,endereco:u.endereco?.trim()||null},quadras:u.quadras||[],mesas:u.mesas||[],categorias:u.categorias||[]},{data:L,error:G}=await Q.rpc("create_company_full",{payload:U});if(!G&&L&&L.codigo_empresa){m({success:!0,codigoEmpresa:L.codigo_empresa,email:u.email,nomeEmpresa:u.nomeFantasia,numQuadras:(u.quadras||[]).length,numMesas:(u.mesas||[]).length,numCategorias:(u.categorias||[]).length}),n(6),e({title:" Empresa criada com sucesso!",description:`Cdigo: ${L.codigo_empresa}`});return}else G&&console.warn("RPC create_company_full indisponvel/erro. Usando fluxo local.",G?.message||G)}catch(U){console.warn("Falha ao tentar RPC create_company_full. Usando fluxo local.",U?.message||U)}let z=null;u.email.trim()&&(console.log("Email fornecido:",u.email),console.log("Nota: O vnculo com o usurio ser criado no primeiro login"),z=null);const F=await plt();console.log("Cdigo da empresa gerado:",F);const{data:V,error:ue}=await Q.from("empresas").insert({codigo_empresa:F,nome:u.nomeFantasia,razao_social:u.razaoSocial,nome_fantasia:u.nomeFantasia,cnpj:u.cnpj?u.cnpj.replace(/\D/g,""):null,email:u.emailEmpresa||null,telefone:u.telefone||null,endereco:u.endereco||null}).select().single();if(ue)throw new Error("Erro ao criar empresa: "+ue.message);const{error:_e}=await Q.from("empresa_counters").insert({empresa_id:V.id,next_cliente_codigo:1,next_agendamento_codigo:1});if(_e&&console.warn("Erro ao criar contador:",_e),u.email.trim()||u.nomeUsuario.trim())try{const U="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(de){const X=Math.random()*16|0;return(de==="x"?X:X&3|8).toString(16)}),{error:L}=await Q.from("usuarios").insert({id:U,email:u.email||null,nome:u.nomeUsuario||null,papel:u.cargo||"admin",codigo_empresa:F});L&&console.warn("Aviso ao criar usurio:",L.message);const{error:G}=await Q.from("colaboradores").insert({id:U,nome:u.nomeUsuario||"Administrador",cargo:u.cargo||"admin",ativo:!0,codigo_empresa:F});G&&console.warn("Aviso ao criar colaborador:",G.message),u.email&&(console.log(" APS O PRIMEIRO LOGIN, execute este SQL no Supabase:"),console.log(`
-- Atualizar ID do colaborador com o ID real do auth.users
UPDATE public.colaboradores 
SET id = (SELECT id FROM auth.users WHERE email = '${u.email}')
WHERE codigo_empresa = '${F}' AND id = '${U}';

-- Atualizar ID do usurio
UPDATE public.usuarios 
SET id = (SELECT id FROM auth.users WHERE email = '${u.email}')
WHERE codigo_empresa = '${F}' AND id = '${U}';
            `))}catch(U){console.warn("Erro ao criar registros de usurio:",U)}try{await Q.from("agenda_settings").insert({empresa_id:V.id,auto_confirm_enabled:!1,auto_start_enabled:!0,auto_finish_enabled:!0})}catch(U){console.warn("Aviso: no foi possvel criar agenda_settings agora (provvel RLS). Ser configurado aps o primeiro login.",U?.message||U)}if(u.quadras.length>0){const U=u.quadras.map(L=>({nome:L.nome,codigo_empresa:F}));await Q.from("quadras").insert(U)}if(u.mesas.length>0){const U=u.mesas.map(L=>({numero:L.numero,nome:L.nome,codigo_empresa:F,status:"available"}));await Q.from("mesas").insert(U)}if(u.categorias.length>0){const U=u.categorias.map(L=>({nome:L.nome,descricao:L.descricao||null,codigo_empresa:F,ativa:!0}));await Q.from("produto_categorias").insert(U)}m({success:!0,codigoEmpresa:F,email:u.email,nomeEmpresa:u.nomeFantasia,numQuadras:u.quadras.length,numMesas:u.mesas.length,numCategorias:u.categorias.length}),n(6),e({title:" Empresa criada com sucesso!",description:`Cdigo: ${F}`})}catch(z){console.error("Erro ao criar empresa:",z),e({title:"Erro ao criar empresa",description:z.message,variant:"destructive"})}finally{o(!1)}},M=()=>{if(r===1||r===6)return null;const z=(r-1)/4*100;return a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-text-muted",children:["Etapa ",r-1," de 4"]}),a.jsxs("span",{className:"text-sm text-text-muted",children:[Math.round(z),"%"]})]}),a.jsx("div",{className:"h-2 bg-surface-2 rounded-full overflow-hidden",children:a.jsx(Mr.div,{className:"h-full bg-brand",initial:{width:0},animate:{width:`${z}%`},transition:{duration:.3}})})]})},O=()=>a.jsxs(Mr.div,{variants:ov,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-md mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(u0,{className:"w-8 h-8 text-brand"})}),a.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"rea Restrita"}),a.jsx("p",{className:"text-text-muted",children:"Digite a senha para acessar"})]}),a.jsxs("form",{onSubmit:x,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"senha",children:"Senha de Acesso"}),a.jsx(At,{id:"senha",type:"password",value:c,onChange:z=>d(z.target.value),placeholder:"Digite a senha",className:"text-center text-lg tracking-widest",autoFocus:!0})]}),a.jsxs(Z,{type:"submit",className:"w-full",children:["Acessar",a.jsx(d2,{className:"ml-2 h-4 w-4"})]})]})]},"step1"),I=()=>a.jsxs(Mr.div,{variants:ov,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(Tf,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Primeiro Usurio"}),a.jsx("p",{className:"text-text-muted",children:"Informaes do administrador da empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"email",children:"Email cadastrado no Supabase Auth"}),a.jsx(At,{id:"email",type:"email",value:u.email,onChange:z=>f({...u,email:z.target.value}),placeholder:"usuario@email.com"}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Este email j deve estar cadastrado no Supabase Auth"})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"nomeUsuario",children:"Nome Completo"}),a.jsx(At,{id:"nomeUsuario",type:"text",value:u.nomeUsuario,onChange:z=>f({...u,nomeUsuario:z.target.value}),placeholder:"Joo Silva"})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"cargo",children:"Cargo na Empresa"}),a.jsx(At,{id:"cargo",type:"text",value:u.cargo,onChange:z=>f({...u,cargo:z.target.value}),placeholder:"Ex: Proprietrio, Gerente, Administrador, Scio, etc."}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Digite o cargo que voc ocupa na empresa"})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>t("/"),className:"flex-1",children:"Cancelar"}),a.jsxs(Z,{type:"button",onClick:y,className:"flex-1",children:["Prximo",a.jsx(d2,{className:"ml-2 h-4 w-4"})]})]})]})]},"step2"),T=()=>a.jsxs(Mr.div,{variants:ov,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(bN,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Dados da Empresa"}),a.jsx("p",{className:"text-text-muted",children:"Informaes cadastrais da empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(lt,{htmlFor:"razaoSocial",children:"Razo Social *"}),a.jsx(At,{id:"razaoSocial",type:"text",value:u.razaoSocial,onChange:z=>f({...u,razaoSocial:z.target.value}),placeholder:"Empresa LTDA"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(lt,{htmlFor:"nomeFantasia",children:"Nome Fantasia *"}),a.jsx(At,{id:"nomeFantasia",type:"text",value:u.nomeFantasia,onChange:z=>f({...u,nomeFantasia:z.target.value}),placeholder:"Minha Empresa"}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Como a empresa aparecer no sistema"})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"cnpj",children:"CNPJ"}),a.jsx(At,{id:"cnpj",type:"text",value:u.cnpj,onChange:z=>f({...u,cnpj:mlt(z.target.value)}),placeholder:"00.000.000/0000-00"})]}),a.jsxs("div",{children:[a.jsx(lt,{htmlFor:"telefone",children:"Telefone"}),a.jsx(At,{id:"telefone",type:"tel",value:u.telefone,onChange:z=>f({...u,telefone:hlt(z.target.value)}),placeholder:"(11) 99999-9999"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(lt,{htmlFor:"emailEmpresa",children:"Email da Empresa"}),a.jsx(At,{id:"emailEmpresa",type:"email",value:u.emailEmpresa,onChange:z=>f({...u,emailEmpresa:z.target.value}),placeholder:"contato@empresa.com"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(lt,{htmlFor:"endereco",children:"Endereo Completo (opcional)"}),a.jsx(At,{id:"endereco",type:"text",value:u.endereco,onChange:z=>f({...u,endereco:z.target.value}),placeholder:"Rua X, 123, Bairro, Cidade - UF"})]})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(Z,{type:"button",variant:"outline",onClick:b,className:"flex-1",children:[a.jsx(Rb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(Z,{type:"button",onClick:y,className:"flex-1",children:["Prximo",a.jsx(d2,{className:"ml-2 h-4 w-4"})]})]})]})]},"step3"),k=()=>a.jsxs(Mr.div,{variants:ov,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(Xc,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Configurao Inicial"}),a.jsx("p",{className:"text-text-muted",children:"Adicione dados iniciais ou pule esta etapa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Uue,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Quadras Esportivas"})]}),a.jsxs(Z,{type:"button",onClick:w,size:"sm",className:"gap-2",children:[a.jsx(to,{className:"w-4 h-4"}),"Adicionar Quadra"]})]}),u.quadras.length>0?a.jsx("div",{className:"space-y-2",children:u.quadras.map((z,F)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:z.nome}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",onClick:()=>j(F),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(Yc,{className:"w-4 h-4"})})]},F))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma quadra adicionada"})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(vc,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Mesas da Loja"})]}),a.jsxs(Z,{type:"button",onClick:_,size:"sm",className:"gap-2",children:[a.jsx(to,{className:"w-4 h-4"}),"Adicionar Mesa"]})]}),u.mesas.length>0?a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:u.mesas.map((z,F)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:z.nome}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(F),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(Yc,{className:"w-4 h-4"})})]},F))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma mesa adicionada"})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(ju,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Categorias de Produtos"})]}),a.jsxs(Z,{type:"button",onClick:A,size:"sm",className:"gap-2",children:[a.jsx(to,{className:"w-4 h-4"}),"Adicionar Categoria"]})]}),u.categorias.length>0?a.jsx("div",{className:"space-y-2",children:u.categorias.map((z,F)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:z.nome}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(F),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(Yc,{className:"w-4 h-4"})})]},F))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma categoria adicionada"})]}),a.jsx("div",{className:"bg-info/10 border border-info/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(kd,{className:"w-5 h-5 text-info mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Configuraes Opcionais"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Voc pode adicionar quadras, mesas e categorias agora ou configurar depois no sistema."})]})]})}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(Z,{type:"button",variant:"outline",onClick:b,className:"flex-1",children:[a.jsx(Rb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(Z,{type:"button",onClick:y,className:"flex-1",children:["Prximo",a.jsx(d2,{className:"ml-2 h-4 w-4"})]})]})]})]},"step4"),$=()=>a.jsxs(Mr.div,{variants:ov,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(Oi,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Reviso Final"}),a.jsx("p",{className:"text-text-muted",children:"Confira os dados antes de criar a empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(Tf,{className:"w-5 h-5"}),"Primeiro Usurio"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.email})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Nome:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.nomeUsuario})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Cargo:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.cargo})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(bN,{className:"w-5 h-5"}),"Empresa"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Razo Social:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.razaoSocial})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Nome Fantasia:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.nomeFantasia})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"CNPJ:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.cnpj})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.emailEmpresa})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Telefone:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.telefone})]}),u.endereco&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Endereo:"}),a.jsx("span",{className:"text-text-primary font-medium text-right",children:u.endereco})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(Xc,{className:"w-5 h-5"}),"Configuraes Iniciais"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Quadras:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.quadras.length})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Mesas:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.mesas.length})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Categorias de Produtos:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.categorias.length})]})]})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(kd,{className:"w-5 h-5 text-warning mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Ateno"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Esta ao criar a empresa no banco de dados. Certifique-se de que todos os dados esto corretos."})]})]})}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(Z,{type:"button",variant:"outline",onClick:b,className:"flex-1",disabled:s,children:[a.jsx(Rb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsx(Z,{type:"button",onClick:P,className:"flex-1 bg-emerald-600 hover:bg-emerald-500",disabled:s,children:s?a.jsxs(a.Fragment,{children:[a.jsx(ll,{className:"mr-2 h-4 w-4 animate-spin"}),"Criando..."]}):a.jsx(a.Fragment,{children:" Criar Empresa"})})]})]})]},"step5"),q=()=>a.jsxs(Mr.div,{variants:ov,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-success/10 rounded-full mb-6",children:a.jsx(Oi,{className:"w-12 h-12 text-success"})}),a.jsx("h2",{className:"text-3xl font-bold text-text-primary mb-2",children:" Empresa Criada!"}),a.jsx("p",{className:"text-text-muted",children:"Tudo pronto para comear a usar o sistema"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-brand/10 border border-brand/30 rounded-lg p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-text-muted mb-2",children:"Cdigo da Empresa"}),a.jsx("p",{className:"text-3xl font-bold text-brand font-mono",children:h?.codigoEmpresa})]})}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Dados de Acesso"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:h?.email})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Senha:"}),a.jsx("span",{className:"text-text-primary font-medium",children:"(a que voc definiu no Supabase)"})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Dados Criados"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Empresa"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Configuraes"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numQuadras}),a.jsx("div",{className:"text-xs text-text-muted",children:"Quadras"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numMesas}),a.jsx("div",{className:"text-xs text-text-muted",children:"Mesas"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numCategorias}),a.jsx("div",{className:"text-xs text-text-muted",children:"Categorias"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Pronto para Uso"})]})]})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(kd,{className:"w-5 h-5 text-warning mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:" IMPORTANTE: Execute o SQL Antes de Fazer Login"}),a.jsxs("div",{className:"space-y-2 text-xs text-text-muted",children:[a.jsx("p",{className:"font-semibold text-text-primary",children:"Para vincular seu usurio  empresa, siga estes passos:"}),a.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[a.jsxs("li",{children:["Abra o ",a.jsx("strong",{children:"Console do Navegador"})," (pressione F12)"]}),a.jsxs("li",{children:["Procure pela mensagem ",a.jsx("strong",{children:'" APS O PRIMEIRO LOGIN, execute este SQL"'})]}),a.jsx("li",{children:"Copie o comando SQL que aparece no console"}),a.jsxs("li",{children:["Acesse o ",a.jsx("strong",{children:"Supabase  SQL Editor"})]}),a.jsx("li",{children:"Cole e execute o SQL"}),a.jsx("li",{children:"Agora sim, faa login normalmente"})]}),a.jsx("p",{className:"mt-2 text-warning font-medium",children:' Se no executar o SQL, voc ver o erro "Empresa no vinculada"'})]})]})]})}),a.jsx("div",{className:"pt-4",children:a.jsx(Z,{type:"button",onClick:()=>t("/"),className:"w-full bg-brand hover:bg-brand/90",children:"Ir para Login"})})]})]},"step6");return a.jsx(a.Fragment,{children:a.jsx("div",{className:"min-h-screen bg-background text-text-primary p-8",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[M(),a.jsxs(Nge,{mode:"wait",children:[r===1&&O(),r===2&&I(),r===3&&T(),r===4&&k(),r===5&&$(),r===6&&q()]})]})})})}const xlt=()=>a.jsx(Mr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex justify-start mb-6",children:a.jsxs("div",{className:"flex items-end gap-3 max-w-[85%] md:max-w-[75%]",children:[a.jsx(cl,{size:"md",variant:"message"}),a.jsx("div",{className:"px-4 py-3 bg-brand border border-brand backdrop-blur-sm rounded-2xl rounded-bl-sm shadow-lg shadow-brand/20",children:a.jsx("div",{className:"flex gap-1.5",children:[0,1,2].map(e=>a.jsx(Mr.div,{className:"w-2.5 h-2.5 md:w-2 md:h-2 bg-[#0A0A0A] rounded-full",animate:{y:[0,-6,0],opacity:[.4,1,.4]},transition:{duration:.8,repeat:1/0,delay:e*.2,ease:"easeInOut"}},e))})})]})}),vlt=({buttons:e,onSelect:t,disabled:r=!1,hideText:n=!1,hidden:s=!1})=>a.jsx(Mr.div,{initial:{opacity:0,y:10,gridTemplateRows:"1fr"},animate:{opacity:s?0:1,y:s?-8:0,gridTemplateRows:s?"0fr":"1fr"},transition:{duration:.6,ease:[.16,1,.3,1]},className:`grid ml-12 md:ml-[68px] overflow-hidden transition-all duration-500 ${s?"mb-0 md:mb-0 pointer-events-none":"mb-2 md:mb-3"}`,children:a.jsx("div",{className:"flex flex-wrap gap-2 md:gap-2.5",children:e.map((o,i)=>a.jsx(Mr.button,{initial:{opacity:0,scale:.92,y:4,filter:"blur(2px)"},animate:{opacity:s||n?0:1,scale:s?.96:1,y:s?-8:0,filter:s?"blur(3.5px)":"blur(0px)"},transition:{duration:s?.4:.45,delay:s?i*.03:.2+i*.05,ease:[.16,1,.3,1]},whileHover:{scale:r?1:1.02,y:r?0:-2},whileTap:{scale:r?1:.98},onClick:()=>!r&&t(o),disabled:r,className:`
              group relative px-5 py-3.5 md:px-6 md:py-4 rounded-xl font-semibold text-[15px] md:text-[15px]
              transition-all duration-300 ease-out
              ${r?"bg-surface/30 text-text-muted cursor-not-allowed border border-white/5":"bg-surface/70 backdrop-blur-sm text-text-primary border border-white/10 hover:border-brand/70 hover:bg-brand/10 hover:text-brand hover:shadow-lg hover:shadow-brand/20 shadow-md"}
              ${n?"opacity-0 pointer-events-none":""}
            `,children:a.jsxs("div",{className:"flex flex-col gap-0.5 md:gap-1 relative z-10",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[o.icon&&!n&&a.jsx("span",{className:`text-base md:text-lg transition-transform duration-300 ${!r&&"group-hover:scale-110"}`,children:o.icon}),!n&&a.jsx("span",{className:"font-semibold",children:o.label})]}),o.subtitle&&!n&&a.jsx("span",{className:"text-[12px] md:text-xs opacity-70 pl-6 md:pl-7 font-normal",children:o.subtitle})]})},o.value||i))})}),ylt=({children:e,onButtonClick:t,hideButtonTexts:r=!1})=>{const{messages:n,isTyping:s,chatEndRef:o}=p5(),[i,l]=p.useState(0),[c,d]=p.useState(void 0);return p.useEffect(()=>{const u=f=>{const h=!!f?.detail?.expanded,m=typeof window<"u"&&window.innerWidth<768,x=m?280:320,g=140,v=m?8:20,y=Math.max(0,x-g+v);l(h?y:0),d(h&&m?0:void 0)};try{window.addEventListener("isis-participantes-expand",u)}catch{}return()=>{try{window.removeEventListener("isis-participantes-expand",u)}catch{}}},[]),a.jsxs("div",{className:"flex flex-col min-h-full",children:[a.jsxs("div",{className:"flex-1 px-3 md:px-6 py-4 md:py-8",style:{paddingBottom:i,paddingTop:c},children:[n.map(u=>a.jsxs(Mr.div,{layout:"position",transition:{duration:.35,ease:[.16,1,.3,1]},children:[a.jsx(Roe,{message:u}),u.type==="buttons"&&u.buttons&&a.jsx("div",{className:`overflow-hidden transition-all duration-500 ${u.buttonsHidden?"max-h-0 mb-0 md:mb-0":"max-h-[480px]"}`,children:a.jsx(vlt,{buttons:u.buttons,onSelect:f=>(t||u.onButtonClick)?.(f,u.id),disabled:u.disabled,hideText:r,hidden:!!u.buttonsHidden})})]},u.id)),s&&a.jsx(xlt,{}),a.jsx("div",{ref:o})]}),a.jsx("div",{className:"sticky bottom-0 px-3 md:px-6 pb-3 md:pb-6 pt-3 md:pt-4 bg-gradient-to-t from-background via-background to-transparent",children:e})]})},blt=({onSubmit:e,onMudarData:t,onMudarQuadra:r,hasMultipleQuadras:n=!1,disabled:s=!1,horariosDisponiveis:o=[],esportes:i=[]})=>{const[l,c]=p.useState(""),[d,u]=p.useState(""),[f,h]=p.useState(""),m=o.map((g,v)=>{let y=o[v].fim,b=0,w=v+1;for(;w<o.length&&o[w].inicio===y;)b++,y=o[w].fim,w++;const j=b>=1;return{value:g.inicio,label:g.inicio,available:j}}),x=(()=>{if(!l)return[];const g=o.findIndex(w=>w.inicio===l);if(g===-1)return[];const v=[];let y=o[g].fim,b=0;for(let w=g+1;w<o.length;w++){const j=o[w];if(j.inicio!==y)break;b++,b>=1&&v.push({value:j.fim,label:j.fim,available:!0}),y=j.fim}return v})();return p.useEffect(()=>{l&&d&&f&&!s&&e({inicio:l,fim:d,esporte:f})},[l,d,f]),p.useEffect(()=>{l&&u("")},[l]),a.jsxs(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-sm md:text-xs",children:[a.jsx(xu,{className:"w-4 h-4"}),a.jsx("span",{className:"font-medium",children:"Horrio desejado"})]}),a.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"horario-inicio",className:"text-xs text-text-muted mb-1 block",children:"Incio"}),a.jsxs(ea,{value:l,onValueChange:c,disabled:s,children:[a.jsx(Jn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsx(Qn,{className:"max-h-[300px] z-[60]",children:m.filter(g=>g.available).map(g=>a.jsx(Qe,{value:g.value,children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx(xu,{className:"w-4 h-4 opacity-80"}),g.label]})},g.value))})]})]}),a.jsx("div",{className:"text-text-muted font-bold text-lg pt-5",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"horario-fim",className:"text-xs text-text-muted mb-1 block",children:"Trmino"}),a.jsxs(ea,{value:d,onValueChange:u,disabled:!l||s,children:[a.jsx(Jn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(ra,{placeholder:"Selecione"})}),a.jsx(Qn,{className:"max-h-[300px] z-[60]",children:x.filter(g=>g.available).map(g=>a.jsx(Qe,{value:g.value,children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx(xu,{className:"w-4 h-4 opacity-80"}),g.label]})},g.value))})]})]})]}),a.jsxs("div",{className:"flex items-end gap-2 md:gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"esporte",className:"text-xs text-text-muted mb-1 block",children:"Esporte"}),a.jsxs(ea,{value:f,onValueChange:h,disabled:s,children:[a.jsx(Jn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(ra,{placeholder:"Selecione o esporte"})}),a.jsx(Qn,{className:"max-h-[300px] z-[60]",children:i.map(g=>a.jsx(Qe,{value:g,children:g},g))})]})]}),t&&a.jsxs(Mr.button,{type:"button",onClick:t,disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
              px-4 py-2.5 rounded-xl font-medium text-sm
              transition-all duration-300 shrink-0
              flex items-center gap-2
              ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/70 backdrop-blur-sm border border-white/10 text-text-primary hover:bg-surface/90 hover:border-white/20"}
            `,children:[a.jsx(ko,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden md:inline",children:"Mudar Data"}),a.jsx("span",{className:"md:hidden",children:"data"})]}),n&&r&&a.jsxs(Mr.button,{type:"button",onClick:r,disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
              px-4 py-2.5 rounded-xl font-medium text-sm
              transition-all duration-300 shrink-0
              flex items-center gap-2
              ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/70 backdrop-blur-sm border border-white/10 text-text-primary hover:bg-surface/90 hover:border-white/20"}
            `,children:[a.jsx(Nd,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden md:inline",children:"Mudar Quadra"}),a.jsx("span",{className:"md:hidden",children:"Quadra"})]})]})]})},wlt=({onSubmit:e,tipo:t,onTrocarTipo:r,disabled:n=!1,mostrarBotaoTrocar:s=!0})=>{const[o,i]=p.useState(""),[l,c]=p.useState(!1),[d,u]=p.useState(!1);p.useEffect(()=>{i("")},[t]);const f=w=>{if(w){const j=or(w,"dd/MM/yyyy",{locale:Da});i(j),u(!1)}},h=w=>{const j=w.replace(/\D/g,"");return j.length<=2?`(${j}`:j.length<=7?`(${j.slice(0,2)}) ${j.slice(2)}`:j.length===10?`(${j.slice(0,2)}) ${j.slice(2,6)}-${j.slice(6)}`:j.length===11?`(${j.slice(0,2)}) ${j.slice(2,7)}-${j.slice(7)}`:`(${j.slice(0,2)}) ${j.slice(2,7)}-${j.slice(7,11)}`},m=w=>{const j=w.replace(/\D/g,"");return j.length<=2?j:j.length<=4?`${j.slice(0,2)}/${j.slice(2)}`:j.length<=8?`${j.slice(0,2)}/${j.slice(2,4)}/${j.slice(4)}`:`${j.slice(0,2)}/${j.slice(2,4)}/${j.slice(4,8)}`},x=w=>{const j=w.target.value;if(t==="telefone"){const _=h(j);i(_)}else if(t==="data_custom"){const _=m(j);i(_)}else i(j)},g=w=>{if(w.preventDefault(),!(!o.trim()||n))if(t==="telefone"){const j=o.replace(/\D/g,"");j.length===11&&(e(j),i(""))}else t==="data_custom"?o.trim()&&(e(o.trim()),i("")):o.includes("@")&&o.includes(".")&&(e(o.trim()),i(""))},v=w=>{w.key==="Enter"&&(w.preventDefault(),g(w))},y=w=>{if(w.length!==10)return{valida:!1,erro:"Data incompleta"};const j=/^(\d{2})\/(\d{2})\/(\d{4})$/,_=w.match(j);if(!_)return{valida:!1,erro:"Formato invlido"};const[,C,A,S]=_,P=new Date(parseInt(S),parseInt(A)-1,parseInt(C));if(isNaN(P.getTime())||P.getDate()!==parseInt(C)||P.getMonth()!==parseInt(A)-1||P.getFullYear()!==parseInt(S))return{valida:!1,erro:"Data invlida"};const M=new Date;return M.setHours(0,0,0,0),P.setHours(0,0,0,0),P<M?{valida:!1,erro:"Data no passado"}:{valida:!0,erro:null}},b=()=>t==="telefone"?o.replace(/\D/g,"").length===11:t==="data_custom"?y(o).valida:o.includes("@")&&o.includes(".");return a.jsxs(Mr.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},onSubmit:g,className:"flex flex-col gap-3 max-w-md mx-auto",children:[a.jsx("div",{className:"relative",children:a.jsxs("div",{className:`
          flex items-center gap-2 px-3 py-2.5 rounded-xl
          bg-surface/70 backdrop-blur-sm
          border-2 transition-all duration-300
          ${l?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
        `,children:[t!=="data_custom"&&a.jsx("div",{className:`
              shrink-0 transition-colors duration-300
              ${l?"text-brand":"text-text-muted"}
            `,children:t==="telefone"?a.jsx(Ow,{className:"w-4 h-4"}):a.jsx(f0,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex-1 relative flex items-center",children:[a.jsx("input",{type:t==="data_custom"?"text":t==="telefone"?"tel":"email",value:o,onChange:x,onKeyDown:v,onFocus:()=>c(!0),onBlur:()=>c(!1),placeholder:t==="telefone"?"(00) 00000-0000":t==="data_custom"?"DD/MM/AAAA":"email@exemplo.com",disabled:n,className:`
                w-full bg-transparent text-text-primary placeholder:text-text-muted
                outline-none text-[17px] md:text-base font-medium
                ${t==="data_custom"?"pr-12":""}
                ${n?"opacity-50 cursor-not-allowed":""}
              `}),t==="data_custom"&&a.jsxs(Qo,{open:d,onOpenChange:u,children:[a.jsx(Zo,{asChild:!0,children:a.jsx(Mr.button,{type:"button",whileHover:{scale:1.1},whileTap:{scale:.9},disabled:n,className:`
                      absolute right-1 w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300
                      bg-brand/10 text-brand hover:bg-brand hover:text-white
                      border border-brand/20 hover:border-brand/40
                      shadow-md hover:shadow-lg hover:shadow-brand/30
                      ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                    `,children:a.jsx(ko,{className:"w-5 h-5"})})}),a.jsx(Ho,{className:"w-auto p-0",align:"end",children:a.jsx(ei,{mode:"single",selected:o?(()=>{try{const[w,j,_]=o.split("/");return new Date(parseInt(_),parseInt(j)-1,parseInt(w))}catch{return}})():void 0,onSelect:f,disabled:w=>{const j=new Date;return j.setHours(0,0,0,0),w<j},initialFocus:!0})})]})]}),a.jsx(Mr.button,{type:"submit",whileHover:{scale:b()?1.1:1},whileTap:{scale:b()?.9:1},disabled:!b()||n,className:`
              shrink-0 w-9 h-9 rounded-full flex items-center justify-center transition-all duration-300
              ${b()?"bg-brand text-bg shadow-md hover:shadow-lg hover:shadow-brand/30":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
            `,children:a.jsx(Z4,{className:"w-4 h-4"})})]})}),t==="telefone"&&o&&a.jsx("div",{className:"text-xs text-center",children:(()=>{const w=o.replace(/\D/g,""),j=w.length===11,_=w.length>0&&!j;return j?a.jsx("span",{className:"text-green-400 flex items-center justify-center gap-1",children:" Telefone vlido"}):_?a.jsxs("span",{className:"text-yellow-400 flex items-center justify-center gap-1",children:[" Digite todos os dgitos (",w.length,"/11)"]}):null})()}),t==="data_custom"&&o&&a.jsx("div",{className:"text-xs text-center",children:(()=>{const w=y(o);return w.valida?a.jsx("span",{className:"text-green-400 flex items-center justify-center gap-1",children:" Data vlida"}):o.length>0?a.jsxs("span",{className:"text-red-400 flex items-center justify-center gap-1",children:[" ",w.erro]}):null})()}),s&&t!=="data_custom"&&a.jsx("button",{type:"button",onClick:r,className:"text-sm text-brand/80 hover:text-brand hover:underline self-center py-1 px-3 rounded-lg hover:bg-brand/5 transition-all",children:t==="telefone"?a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(f0,{className:"w-4 h-4"}),"Prefiro usar e-mail"]}):a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(Ow,{className:"w-4 h-4"}),"Prefiro usar telefone"]})})]})},jlt=({onSubmit:e,disabled:t=!1,valorInicial:r=null,tipoInicial:n="telefone",onCorrigirTelefone:s,onCorrigirEmail:o})=>{const[i,l]=p.useState(""),[c,d]=p.useState(n==="telefone"&&r||""),[u,f]=p.useState(n==="email"&&r||""),[h,m]=p.useState(null),x=b=>{const w=b.replace(/\D/g,"");return w.length<=2?`(${w}`:w.length<=7?`(${w.slice(0,2)}) ${w.slice(2)}`:w.length<=11?`(${w.slice(0,2)}) ${w.slice(2,7)}-${w.slice(7,11)}`:`(${w.slice(0,2)}) ${w.slice(2,7)}-${w.slice(7,11)}`},g=b=>{const w=x(b.target.value);d(w)},v=b=>{if(b.preventDefault(),!i.trim())return;const w=c.replace(/\D/g,"").length>=10,j=u.trim().includes("@")&&u.trim().includes(".");if(!w&&!j)return;const _={nome:i.trim(),telefone:w?c.replace(/\D/g,""):null,email:j?u.trim():null};e(_)},y=()=>{if(!i.trim())return!1;const b=c.replace(/\D/g,"").length>=10,w=u.trim().includes("@")&&u.trim().includes(".");return b||w};return a.jsxs(Mr.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},onSubmit:v,className:"flex flex-col gap-3",children:[a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="nome"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(Tf,{className:`w-5 h-5 transition-colors ${h==="nome"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"text",value:i,onChange:b=>l(b.target.value),onFocus:()=>m("nome"),onBlur:()=>m(null),placeholder:"Seu nome completo",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="telefone"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(Ow,{className:`w-5 h-5 transition-colors ${h==="telefone"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"tel",value:c,onChange:g,onFocus:()=>m("telefone"),onBlur:()=>m(null),placeholder:"(00) 00000-0000",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="email"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(f0,{className:`w-5 h-5 transition-colors ${h==="email"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"email",value:u,onChange:b=>f(b.target.value),onFocus:()=>m("email"),onBlur:()=>m(null),placeholder:"email@exemplo.com (opcional)",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),(s||o)&&a.jsx("div",{className:"-mt-1 mb-1",children:n==="email"&&o?a.jsx("button",{type:"button",onClick:o,className:"text-xs text-brand/80 hover:text-brand underline underline-offset-4 px-1 py-0.5 rounded-md hover:bg-brand/5",children:"Informei o e-mail errado"}):s&&a.jsx("button",{type:"button",onClick:s,className:"text-xs text-brand/80 hover:text-brand underline underline-offset-4 px-1 py-0.5 rounded-md hover:bg-brand/5",children:"Informei o telefone errado"})}),a.jsxs(Mr.button,{type:"submit",whileHover:{scale:y()?1.02:1},whileTap:{scale:y()?.98:1},disabled:!y()||t,className:`
          flex items-center justify-center gap-2 py-3 px-6 rounded-2xl
          font-semibold text-base transition-all duration-300
          ${y()?"bg-brand text-bg shadow-lg shadow-brand/20 hover:shadow-xl hover:shadow-brand/30":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
        `,children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})}),"Continuar"]}),a.jsx("p",{className:"text-xs text-text-muted text-center",children:"Preencha pelo menos telefone ou e-mail"})]})},_lt=({participantesAtuais:e=[],onAdicionar:t,onRemover:r,onFinalizar:n,disabled:s=!1,onAdicionarLote:o,selfName:i,onFixedRolesDetected:l,initialModalidade:c="",modalidadeOptions:d=[]})=>{const[u,f]=p.useState(""),[h,m]=p.useState(!1),[x,g]=p.useState(!1),v=p.useRef(null),[y,b]=p.useState(!1),[w,j]=p.useState(""),[_,C]=p.useState(!1),[A,S]=p.useState([]),[P,M]=p.useState([]),[O,I]=p.useState({}),[T,k]=p.useState(!1),[$,q]=p.useState(!1),[z,F]=p.useState(null),[V,ue]=p.useState(!1),_e=p.useRef(null),U=p.useRef(null),[L,G]=p.useState(c||"");p.useEffect(()=>{G(c||"")},[c]),p.useEffect(()=>{const ve=()=>{g(window.innerWidth<768)};return ve(),window.addEventListener("resize",ve),()=>window.removeEventListener("resize",ve)},[]),p.useEffect(()=>{if(y){const ve=document.body.style.overflow;return document.body.style.overflow="hidden",S([]),M([]),I({}),k(!1),q(!1),F(null),()=>{document.body.style.overflow=ve}}},[y]),p.useEffect(()=>{if(y&&te&&(!A||A.length===0)){const ve=X(te);S([te]),I({[ve]:!0}),F(ve),q(!0),k(!0)}},[y]);const de=ve=>ve.normalize("NFD").replace(/[\u0300-\u036f]/g,""),X=ve=>de(String(ve||"").trim().toLowerCase()).replace(/\s+/g," "),W=ve=>String(ve||"").replace(/^\s*[*-]+/g,"").replace(/^\s*\d+\s*[\-\)\.]\s*/g,"").replace(/^[\W_]+|[\W_]+$/g,"").replace(//g,"").replace(/@[\S]+/g,"").replace(/\(\s*[mf]\s*\)/gi,"").replace(/\(\s*[mf][^)]*\)?/gi,"").replace(/\s{2,}/g," ").trim(),Y=ve=>/^(espera|lista\s+de\s+espera)\b/i.test(de(String(ve||"").trim().toLowerCase())),me=ve=>/^(jogador|jogadores|goleiro|goleiros|convocado|convocados|jogadore?s)\b/i.test(de(String(ve||"").trim().toLowerCase())),ee=ve=>{const at=de(String(ve||"")).trim().toLowerCase();return/^(jogador|jogadores|goleiro|goleiros|convocado|convocados|levantador|levantadores)\b/.test(at)||/^(lista\s+de\s+espera|convidad\w*)\b/.test(at)},ae=ve=>{const at=String(ve||"").split(/\r?\n/);let qt=!1,$t=!1;const De=[];for(const Rr of at){const Me=String(Rr||"").trim();if(!Me)continue;if(Y(Me)){qt=!0;continue}if(qt)continue;if(me(Me)){$t=!0;continue}if(!$t)continue;const tt=W(Me),ut=/[A-Za-z---]/.test(tt);tt&&tt.length>=2&&tt.length<=60&&ut&&!/[0-9@]/.test(tt)&&De.push(tt.split(/\s+/).map(Sr=>Sr&&Sr[0].toUpperCase()+Sr.slice(1).toLowerCase()).join(" "))}const wt=new Set,Rt=[];for(const Rr of De){const Me=X(Rr);!Me||wt.has(Me)||(wt.add(Me),Rt.push(Rr))}return Rt},le=ve=>/^(reservas?)\b/i.test(de(String(ve||"").trim().toLowerCase())),Te=ve=>{const at=String(ve||"").split(/\r?\n/),qt=[];let $t=!1,De=!1;for(const wt of at){const Rt=String(wt||"").trim();if(!Rt)continue;if(Y(Rt)){$t=!0,De=!1;continue}if(me(Rt)||le(Rt)){$t=!1,De=!0;continue}if($t||!De)continue;const Rr=W(Rt),Me=/[A-Za-z---]/.test(Rr);if(!(Rr&&Rr.length>=2&&Rr.length<=60&&Me&&!/[0-9@]/.test(Rr)))continue;const ut=Rr.split(/\s+/).map(sr=>sr&&sr[0].toUpperCase()+sr.slice(1).toLowerCase()).join(" ");ee(ut)||qt.push(ut)}return qt};new Set((e||[]).map(ve=>X(ve.nome)));const te=i?String(i).trim():e&&e[0]&&e[0].nome?String(e[0].nome).trim():null,ie=te?X(te):null,xt=ve=>de(String(ve||"").toLowerCase()).split(/\s+/).map(at=>at.trim()).filter(at=>at.length>=3),vt=ve=>{if(!te)return!1;const at=String(ve||"").trim();if(!at)return!1;if(X(at)===ie)return!0;const qt=xt(te),$t=xt(at);return qt.length===0||$t.length===0?!1:$t.some(De=>qt.includes(De))},dt=ve=>{const at=new Set;if(!ve)return at;const qt=String(ve).split(/\r?\n/);let $t=!1;for(let De of qt){const wt=de(String(De||"")).toLowerCase().trim();if(!$t){/^\s*[*\-]?\s*((lista\s+de\s+)?espera|convidad\w*)\b[\s:]*$/i.test(wt)&&($t=!0);continue}if(/^\s*\*\s*\w+|^\s*(convocad|jogad|levanta|goleir)\w*/i.test(de(De))){$t=!1;continue}const Rt=String(De).replace(/^\s*[*\-]+\s*/g,"").replace(/^\s*\d+\)?\s*/g,"").replace(/^[\W_]+/,"").trim(),Rr=/[A-Za-z---]/.test(Rt);Rt&&Rr&&!/[0-9@]/.test(Rt)&&Rt.length>=2&&Rt.length<=60&&at.add(X(Rt))}return at},St=ve=>{const at=String(ve||"").split(/\r?\n/),qt={levantadores:[],goleiros:[]};let $t=null;for(let De of at){const wt=de(String(De||"")).toLowerCase().trim();if(/^\s*[*\-]?\s*levanta(dor|dores|dor(es)?)\b/i.test(wt)){$t="levantadores";continue}if(/^\s*[*\-]?\s*goleir(o|os|a|as)\b/i.test(wt)){$t="goleiros";continue}if($t){if(/(^|\s)jogador(e|es)\b/.test(wt)){$t=null;continue}if(/^\s*[*\-]?\s*(convocad|lista\s+de\s+(espera|reserva)|convidad)\b/i.test(wt)){$t=null;continue}if(/^\s*[*_]{1,3}\s*[a-z-]+/i.test(wt)){$t=null;continue}if(/^\s*[*\-]?\s*(levanta|goleir)\b/i.test(wt)){$t=null;continue}}if(!$t)continue;const Rt=String(De).replace(/^\s*[*\-]+\s*/g,"").replace(/^\s*\d+\)?\s*/g,"").replace(/^[\W_]+/,"").trim(),Rr=/[A-Za-z---]/.test(Rt);if(!(Rt&&Rr&&!/[0-9@]/.test(Rt)&&Rt.length>=2&&Rt.length<=60))continue;const tt=Rt.toLowerCase().split(/\s+/).map(sr=>sr&&sr[0].toUpperCase()+sr.slice(1)).join(" "),ut=X(tt);$t==="levantadores"?qt.levantadores.some(sr=>X(sr)===ut)||qt.levantadores.push(tt):$t==="goleiros"&&(qt.goleiros.some(sr=>X(sr)===ut)||qt.goleiros.push(tt))}return qt},ft=ve=>{ve.preventDefault(),!(!u.trim()||s)&&(t(u.trim()),f(""),setTimeout(()=>{v.current?.focus()},100))},_t=ve=>{ve.key==="Enter"&&!x&&(ve.preventDefault(),ve.shiftKey?n&&n(L):ft(ve))},gr=async()=>{if(w.trim()){C(!0),S([]),M([]),I({});try{try{console.group("[Isis Import] start"),console.debug("[Isis Import] input.length=%s preview=%o",w.length,w.slice(0,180))}catch{}const{data:ve,error:at}=await Q.functions.invoke("parse-participants",{body:{text:w,locale:"pt-BR"}});if(at)throw at;if(ve&&typeof ve.source=="string"){console.log("[Isis Import] source=",ve.source);try{console.debug("[Isis Import] edge.meta keys=%o",Object.keys(ve||{}))}catch{}}const qt=dt(w);try{console.debug("[Isis Import] waitlist.count=%s sample=%o",qt.size,Array.from(qt).slice(0,8))}catch{}const $t=Array.isArray(ve?.roles?.levantadores)?ve.roles.levantadores:[],De=Array.isArray(ve?.roles?.goleiros)?ve.roles.goleiros:[],wt=$t.length||De.length?{levantadores:$t,goleiros:De}:St(w);try{console.debug("[Isis Import] roles.edge lev=%s gol=%s",$t.length,De.length)}catch{}try{$t.length||De.length||console.debug("[Isis Import] roles.local lev=%s gol=%s",wt.levantadores.length,wt.goleiros.length)}catch{}const Rt=Array.isArray(ve?.extracted)?ve.extracted:[];let Rr=Rt.filter(Cn=>!qt.has(X(Cn)));Rr=Rr.filter(Cn=>!ee(Cn));try{console.debug("[Isis Import] extracted.raw=%s filtered=%s sample=%o",Rt.length,Rr.length,Rr.slice(0,10))}catch{}try{if(Rr.length<6&&/(goleir|jogador)/i.test(de(w))){const ze=ae(w);try{console.debug("[Isis Import] local.mainOnly=%s sample=%o",ze.length,ze.slice(0,10))}catch{}const Fe=[...Rr],Le=new Set(Fe.map(X));for(const Ze of ze){const Ot=X(Ze);!Ot||Le.has(Ot)||qt.has(Ot)||(Le.add(Ot),Fe.push(Ze))}Rr=Fe.filter(Ze=>!ee(Ze));try{console.debug("[Isis Import] boosted.count=%s",Rr.length)}catch{}}}catch{}const Me=Rr.some(Cn=>vt(Cn)),tt=Array.isArray(ve?.invalid)?ve.invalid:[],ut=[],sr=new Set;for(const Cn of Rr){const ze=W(Cn);if(!ze)continue;const Fe=X(ze);if(!Fe||sr.has(Fe))continue;sr.add(Fe);const Le=ze.split(/\s+/).map(Ze=>Ze&&Ze[0].toUpperCase()+Ze.slice(1).toLowerCase()).join(" ");ut.push(Le)}try{console.debug("[Isis Import] uniques.count=%s sample=%o",ut.length,ut.slice(0,12))}catch{}try{console.debug("[Isis Import] invalid.count=%s sample=%o",tt.length,tt.slice(0,6))}catch{}try{console.debug("[Isis Import] detectedSelf=%s self=%o",Me,te)}catch{}const Sr=ae(w),xr=new Map(Sr.map((Cn,ze)=>[X(Cn),ze])),Wr=Te(w);let qr=Wr&&Wr.length?Wr.slice(0,200):(()=>{const Cn=ut.map((ze,Fe)=>({n:ze,i:Fe}));return Cn.sort((ze,Fe)=>{const Le=xr.has(X(ze.n))?xr.get(X(ze.n)):Number.MAX_SAFE_INTEGER,Ze=xr.has(X(Fe.n))?xr.get(X(Fe.n)):Number.MAX_SAFE_INTEGER;return Le!==Ze?Le-Ze:ze.i-Fe.i}),Cn.map(ze=>ze.n).slice(0,50)})(),Tr=qr.findIndex(Cn=>vt(Cn));if(Tr>=0){const Cn=qr[Tr];F(X(Cn)),qr=[Cn,...qr.filter((ze,Fe)=>Fe!==Tr)]}else if(te){const Cn=X(te);F(Cn),q(!0),qr=[te,...qr]}else F(null);S(qr),M(tt);const sn={};te&&(sn[X(te)]=!0),ut.slice(0,50).forEach(Cn=>{sn[X(Cn)]=!0}),I(sn),k(!0),q(Me||!!te);try{typeof l=="function"?l(wt):window.dispatchEvent(new CustomEvent("isis:fixed-roles",{detail:wt}))}catch{}try{console.debug("[Isis Import] final.suggested.count=%s sample=%o",qr.length,qr.slice(0,12))}catch{}try{console.groupEnd?.()}catch{}}catch(ve){try{console.error("[Isis Import] error=%o",ve)}catch{}const at=dt(w),qt=St(w),$t=w.split(/[\n,;]+/).map(tt=>tt.trim()).filter(Boolean),De=$t.some(tt=>{const ut=tt.replace(/^[\W_]+|[\W_]+$/g,"");return vt(ut)}),wt=[],Rt=new Set;for(const tt of $t){const ut=tt.replace(/^[\W_]+|[\W_]+$/g,""),sr=X(ut),Sr=/[A-Za-z---]/.test(ut);if(!(ut.length>=2&&ut.length<=60&&Sr&&!/[0-9@]/.test(ut))||!sr||at.has(sr)||Rt.has(sr))continue;Rt.add(sr);const Wr=ut.toLowerCase().split(/\s+/).map(qr=>qr&&qr[0].toUpperCase()+qr.slice(1)).join(" ");wt.push(Wr)}let Rr=wt.slice(0,50);if(te){const tt=X(te);F(tt),q(!0),Rr=[te,...Rr]}S(Rr);const Me={};te&&(Me[X(te)]=!0),wt.slice(0,50).forEach(tt=>{Me[X(tt)]=!0}),I(Me),k(!0),q(De||!!te);try{typeof l=="function"?l(qt):window.dispatchEvent(new CustomEvent("isis:fixed-roles",{detail:qt}))}catch{}}finally{C(!1)}}},be=ve=>{const at=X(ve);I(qt=>({...qt,[at]:!qt[at]}))},Nt=()=>{const ve={...O};A.forEach(at=>{ve[X(at)]=!0}),I(ve)},Wt=()=>{const ve={...O};A.forEach(at=>{ve[X(at)]=!1}),I(ve)},_r=()=>{const ve=A.filter(at=>{const qt=X(at);return z&&qt===z?!1:O[qt]});ve.length!==0&&(typeof o=="function"?o(ve):ve.forEach(at=>t(at)),b(!1),j(""),S([]),M([]),I({}))},yr=()=>{j(""),S([]),M([]),I({}),k(!1),q(!1),F(null)};return a.jsxs(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"flex flex-col gap-3 w-full",children:[a.jsxs("div",{ref:U,className:"flex items-center justify-end gap-2 scroll-mt-24 md:scroll-mt-28",children:[a.jsx("button",{type:"button",disabled:s,onClick:()=>b(!0),className:`px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/80 hover:bg-surface/60 border border-white/10 text-text-primary"}`,children:"Importar lista"}),a.jsx("div",{className:"relative",children:a.jsxs(ea,{value:L,onValueChange:G,disabled:s,children:[a.jsx(Jn,{className:"min-w-[160px] bg-surface/70 backdrop-blur-sm border-white/10 text-sm",children:a.jsx(ra,{placeholder:"Modalidade"})}),a.jsxs(Qn,{className:"max-h-[300px] z-[70]",children:[(Array.isArray(d)?d:[]).map(ve=>a.jsx(Qe,{value:String(ve),children:String(ve)},String(ve))),(!d||d.length===0)&&a.jsx(Qe,{value:"",children:"Selecionar modalidade"})]})]})}),a.jsx("button",{type:"button",onClick:()=>{ue(ve=>{const at=!ve;try{window.dispatchEvent(new CustomEvent("isis-participantes-expand",{detail:{expanded:at}}))}catch{}return at}),setTimeout(()=>{try{U.current?.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},50)},className:`p-2 rounded-lg border transition-all ${V?"bg-white/10 border-brand/40 text-brand shadow-sm":"hover:bg-white/10 border-white/10"}`,"aria-label":V?"Recolher lista":"Expandir lista","aria-pressed":V,children:V?a.jsx(gx,{className:"w-4 h-4"}):a.jsx(Tue,{className:"w-4 h-4"})})]}),e.length>0&&a.jsx("div",{ref:_e,className:`flex flex-col gap-1.5 ${V?"max-h-[360px] md:max-h-[320px]":"max-h-[140px]"} overflow-y-auto px-1 transition-all`,children:e.map((ve,at)=>a.jsxs(Mr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm ${ve.principal?"bg-brand/10 border border-brand/30":"bg-surface/50 border border-white/10"}`,children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold ${ve.principal?"bg-brand/20 text-brand":"bg-white/10 text-text-primary"}`,children:at+1})}),a.jsx("span",{className:"text-base shrink-0",children:ve.principal?"":""}),a.jsxs("span",{className:`flex-1 font-medium truncate ${ve.principal?"text-brand":"text-text-primary"}`,children:[ve.nome,ve.principal&&a.jsx("span",{className:"ml-1.5 text-xs opacity-70",children:"(voc)"})]}),!ve.principal&&r&&a.jsx(Mr.button,{type:"button",onClick:()=>r(at),whileHover:{scale:1.1},whileTap:{scale:.9},className:"shrink-0 p-1 rounded-full hover:bg-red-500/20 text-red-400 hover:text-red-300 transition-colors",title:"Remover participante",children:a.jsx(Yc,{className:"w-4 h-4"})})]},at))}),a.jsxs("form",{onSubmit:ft,className:"flex flex-col gap-2",children:[a.jsxs("div",{className:`
          flex items-center gap-2 px-3 py-2.5 rounded-xl
          bg-surface/70 backdrop-blur-sm
          border-2 transition-all duration-300
          ${h?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
        `,children:[a.jsx(ife,{className:`w-4 h-4 shrink-0 transition-colors ${h?"text-brand":"text-text-muted"}`}),a.jsx("input",{ref:v,type:"text",value:u,onChange:ve=>f(ve.target.value),onKeyDown:_t,onFocus:()=>m(!0),onBlur:()=>m(!1),placeholder:x?"Nome":"Nome do participante",disabled:s,autoComplete:"off",className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-base font-medium min-w-0"}),a.jsx(Mr.button,{type:"submit",whileHover:{scale:u.trim()?1.05:1},whileTap:{scale:u.trim()?.95:1},disabled:!u.trim()||s,className:`
              px-3 py-1.5 rounded-lg transition-all duration-300 text-sm font-semibold shrink-0
              ${u.trim()?"bg-brand text-bg shadow-md":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
            `,children:"Adicionar"})]}),a.jsx(Mr.button,{type:"button",onClick:()=>n&&n(L),disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
            w-full px-6 py-3.5 rounded-xl font-bold text-base
            transition-all duration-300
            ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-brand text-bg shadow-lg hover:shadow-xl hover:shadow-brand/30"}
          `,children:a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsx(Lm,{className:"w-5 h-5"}),"Confirmar Participantes (",e.length,")"]})}),!x&&a.jsxs("p",{className:"text-xs text-text-muted text-center mt-1",children:[" ",a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface rounded text-[10px]",children:"Enter"})," adiciona  ",a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface rounded text-[10px]",children:"Shift+Enter"})," confirma"]})]}),y&&typeof document<"u"&&Xm.createPortal(a.jsxs("div",{className:"fixed inset-0 z-[9999] overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black/75 backdrop-blur-sm",onClick:()=>!_&&b(!1)}),a.jsx("div",{className:"min-h-screen flex items-start justify-center pt-24 md:pt-16 pb-8 px-3",children:a.jsxs("div",{className:"relative w-[96vw] max-w-5xl bg-gradient-to-br from-surface via-background to-surface border border-white/10 rounded-3xl shadow-2xl flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"sticky top-0 z-10 px-5 py-4 border-b border-white/10 bg-surface/70 backdrop-blur flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(cl,{size:"sm",variant:"header"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-base md:text-lg font-extrabold text-text-primary leading-tight",children:A.length>0?"Sugestes encontradas":"Importar participantes"}),a.jsx("p",{className:"text-[11px] md:text-xs text-text-muted",children:A.length>0?`Selecione os nomes para adicionar (${A.length})`:"Cole sua lista e processe com IA"})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("button",{type:"button",disabled:_,onClick:()=>b(!1),className:"p-2 rounded-lg hover:bg-white/10",children:a.jsx(Yc,{className:"w-5 h-5"})})})]}),a.jsx("div",{className:"flex-1 max-h-[70vh] overflow-y-auto p-4 md:p-5",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-full",children:[a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("label",{className:"text-xs text-text-muted mb-2",children:"Sua lista"}),a.jsx("textarea",{value:w,onChange:ve=>j(ve.target.value),disabled:_,placeholder:`Exemplo:
1) Joo Silva
2) Maria Clara
3) Pedro Henrique

Dica: nomes sob os cabealhos 'Lista de espera', 'Lista de reserva' ou 'Convidados' sero ignorados.

Cole sua lista (um por linha ou separados por vrgula) e clique em Processar com sis`,className:"w-full min-h-[320px] max-h-[320px] resize-none overflow-y-auto bg-surface border border-white/10 rounded-xl p-3 outline-none text-sm focus:ring-2 focus:ring-brand/40"}),a.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[a.jsx("button",{type:"button",onClick:yr,disabled:_&&!w.trim(),className:"px-4 py-2 rounded-xl font-semibold bg-surface border border-white/10 text-text-primary hover:bg-white/10 disabled:opacity-60",children:"Apagar"}),a.jsx("button",{type:"button",onClick:gr,disabled:_||!w.trim(),className:"px-5 py-2.5 rounded-xl font-semibold shadow-lg transition bg-gradient-to-r from-brand to-emerald-500 text-white hover:shadow-emerald-500/30 disabled:opacity-60 disabled:cursor-not-allowed",children:_?"Processando":"Processar com sis"})]})]}),a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[a.jsx("span",{children:"Sugeridos"}),a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/10",children:A.length})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:Nt,disabled:_,className:"px-2 py-1 text-xs rounded-lg bg-surface hover:bg-white/10 disabled:opacity-50",children:"Selecionar todos"}),a.jsx("button",{type:"button",onClick:Wt,disabled:_,className:"px-2 py-1 text-xs rounded-lg bg-surface hover:bg-white/10 disabled:opacity-50",children:"Limpar"})]})]}),a.jsx("div",{className:"min-h-[320px] max-h-[320px] overflow-y-auto border border-white/10 rounded-xl bg-surface",children:_?a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative w-5 h-5",children:[a.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-brand to-emerald-500 opacity-30"}),a.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-transparent [border-image:linear-gradient(to_right,var(--tw-gradient-from),var(--tw-gradient-to))_1] animate-spin"})]}),a.jsx("span",{className:"text-xs font-semibold text-text-primary",children:"Processando com IA"})]}),a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-white/10 text-text-muted",children:"Premium"})]}),a.jsx("div",{className:"space-y-2",children:Array.from({length:10}).map((ve,at)=>a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-white/[0.03] overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0 w-full",children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold bg-white/10 text-text-muted",children:at+1})}),a.jsx("div",{className:"relative h-3 w-full max-w-[220px] rounded bg-white/10 overflow-hidden",children:a.jsx("div",{className:"absolute inset-0 -translate-x-full animate-[shimmer_1.2s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})})]}),a.jsx("div",{className:"h-4 w-4 rounded bg-white/10"})]},at))}),a.jsx("style",{children:"@keyframes shimmer{100%{transform:translateX(100%);}}"})]}):a.jsx("ul",{className:"divide-y divide-white/5",children:A.map((ve,at)=>{const qt=X(ve),$t=T&&$&&z&&qt===z;return a.jsxs("li",{className:`flex items-center justify-between px-3 py-2 ${$t?"bg-white/5":""}`,children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold ${$t?"bg-emerald-600/25 text-emerald-400":"bg-white/10 text-text-primary"}`,children:at+1})}),a.jsx("span",{className:"text-sm truncate pr-1",children:ve}),$t&&a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-emerald-600/20 text-emerald-400 border border-emerald-500/30 shrink-0",children:"Voc"})]}),a.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:$t?!0:!!O[qt],onChange:()=>!$t&&be(ve),disabled:$t})]},`${qt}-${at}`)})})}),T&&A.length===0&&w.trim()&&!_&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum nome novo encontrado."}),P.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-text-muted flex items-center gap-2",children:[a.jsx("span",{children:"Ignorados"}),a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/10",children:P.length})]}),a.jsx("div",{className:"mt-3 flex items-center justify-end",children:a.jsx("button",{type:"button",onClick:_r,disabled:_||A.filter(ve=>O[X(ve)]).length===0,className:`px-5 py-2.5 rounded-xl font-semibold ${_||A.filter(ve=>O[X(ve)]).length===0?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-emerald-600 text-white shadow-lg hover:shadow-emerald-600/30 transition"}`,children:(()=>`Adicionar selecionados (${A.reduce((at,qt)=>{const $t=X(qt);return T&&$&&z&&$t===z?at+1:at+(O[$t]?1:0)},0)})`)()})})]})]})})]})})]}),document.body)]})},Nlt=({onSubmit:e,disabled:t=!1})=>{const[r,n]=p.useState(0),[s,o]=p.useState(0),[i,l]=p.useState(""),[c,d]=p.useState(!1),u=g=>{g.preventDefault(),!(r===0||t)&&e({rating:r,comentario:i.trim()||null,timestamp:new Date().toISOString()})},f=g=>{t||n(g)},h=g=>{t||o(g)},m=()=>{t||o(0)},x=s||r;return a.jsx(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"w-full mb-8 md:mb-4",children:a.jsx("div",{className:"bg-background/98 backdrop-blur-3xl border-2 border-white/50 rounded-3xl p-6 md:p-8 shadow-2xl relative z-50",children:a.jsxs("form",{onSubmit:u,className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(g=>a.jsx(Mr.button,{type:"button",onClick:()=>f(g),onMouseEnter:()=>h(g),onMouseLeave:m,disabled:t,whileHover:{scale:t?1:1.2},whileTap:{scale:t?1:.9},className:`
                    p-2 transition-all duration-200 rounded-full
                    ${t?"cursor-not-allowed":"cursor-pointer hover:bg-brand/10"}
                  `,children:a.jsx(rfe,{className:`w-8 h-8 md:w-10 md:h-10 transition-all duration-200 ${g<=x?"fill-yellow-400 text-yellow-400 drop-shadow-lg":"text-text-muted hover:text-yellow-300"}`})},g))}),r>0&&a.jsx(Mr.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center",children:a.jsxs("p",{className:"text-base font-semibold text-text-primary",children:[r===1&&" Muito ruim",r===2&&" Ruim",r===3&&" Regular",r===4&&" Bom",r===5&&" Excelente"]})})]}),r>0&&a.jsx("div",{className:"w-full h-px bg-white/10 my-2"}),r>0&&a.jsxs(Mr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3,delay:.2},className:"flex flex-col gap-4",children:[a.jsxs("label",{className:"text-base font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Jue,{className:"w-5 h-5 text-brand"}),"Comentrio (opcional)"]}),a.jsx("div",{className:`
                flex items-start gap-2 px-4 py-3 rounded-xl
                bg-background/60 backdrop-blur-sm
                border-2 transition-all duration-300
                ${c?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
              `,children:a.jsx("textarea",{value:i,onChange:g=>l(g.target.value),onFocus:()=>d(!0),onBlur:()=>d(!1),placeholder:"Conte-nos mais sobre sua experincia...",disabled:t,rows:3,maxLength:500,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-base resize-none min-w-0"})}),a.jsxs("div",{className:"text-sm text-text-muted text-right",children:[i.length,"/500"]})]}),r>0&&a.jsx(Mr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},className:"mt-2 mb-4",children:a.jsxs(Mr.button,{type:"submit",disabled:t,whileHover:{scale:t?1:1.02},whileTap:{scale:t?1:.98},className:`
                w-full px-6 py-4 rounded-2xl font-bold text-lg
                transition-all duration-300 flex items-center justify-center gap-3
                shadow-xl border-2
                ${t?"bg-surface text-text-muted cursor-not-allowed border-white/10":"bg-gradient-to-r from-brand to-brand/90 text-white shadow-brand/30 hover:shadow-2xl hover:shadow-brand/40 border-brand/20 hover:from-brand/90 hover:to-brand"}
              `,children:[a.jsx(Z4,{className:"w-6 h-6"}),"Enviar Avaliao"]})})]})})})},Slt=({message:e="Carregando..."})=>{const t=[" sis IA iniciando..."," Processando dados em tempo real..."," IA analisando disponibilidade..."," sis aprendendo suas preferncias..."," Assistente virtual ativando..."," IA otimizando seu agendamento..."," sis calculando melhores opes..."," Sincronizando com IA..."," Inteligncia artificial carregando..."," sis processando informaes..."],r=t[Math.floor(Math.random()*t.length)];return a.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background via-surface/30 to-background",children:a.jsx(Mr.div,{className:"absolute inset-0 opacity-20",animate:{background:["radial-gradient(circle at 20% 50%, #FF6600 0%, transparent 50%)","radial-gradient(circle at 80% 50%, #FFAA33 0%, transparent 50%)","radial-gradient(circle at 50% 20%, #FF6600 0%, transparent 50%)","radial-gradient(circle at 20% 50%, #FF6600 0%, transparent 50%)"]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}})}),a.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(6)].map((n,s)=>a.jsx(Mr.div,{className:"absolute w-2 h-2 rounded-full",style:{background:s%2===0?"#FF6600":"#FFAA33",left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{y:[-20,-100,-20],opacity:[0,1,0],scale:[.5,1,.5]},transition:{duration:3+Math.random()*2,repeat:1/0,delay:Math.random()*2,ease:"easeInOut"}},s))}),a.jsxs(Mr.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,ease:[.22,1,.36,1]},className:"relative z-10 text-center",children:[a.jsxs("div",{className:"mb-8 flex flex-col items-center gap-6",children:[a.jsxs(Mr.div,{className:"relative",animate:{rotateY:[0,360]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:[a.jsx(Mr.div,{className:"absolute inset-0 rounded-2xl blur-xl opacity-60",style:{background:"#FFAA33"},animate:{scale:[1,1.2,1],opacity:[.4,.8,.4]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),a.jsx(Mr.div,{className:"relative w-20 h-20 md:w-24 md:h-24 rounded-2xl flex items-center justify-center",style:{background:"#FFAA33"},whileHover:{scale:1.05},children:a.jsx(Nd,{className:"w-12 h-12 md:w-14 md:h-14 text-white",strokeWidth:2})})]}),a.jsxs(Mr.div,{className:"flex items-baseline gap-1",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.3},children:[a.jsx(Mr.span,{className:"font-extrabold text-4xl md:text-5xl",style:{color:"#FF6600"},animate:{textShadow:["0 0 10px rgba(255, 102, 0, 0.5)","0 0 20px rgba(255, 102, 0, 0.8)","0 0 10px rgba(255, 102, 0, 0.5)"]},transition:{duration:2,repeat:1/0},children:"Fluxo"}),a.jsx(Mr.span,{className:"font-extrabold text-4xl md:text-5xl",style:{color:"#FFAA33"},animate:{textShadow:["0 0 10px rgba(255, 170, 51, 0.5)","0 0 20px rgba(255, 170, 51, 0.8)","0 0 10px rgba(255, 170, 51, 0.5)"]},transition:{duration:2,repeat:1/0,delay:.1},children:"7"}),a.jsx(Mr.span,{className:"font-medium text-4xl md:text-5xl ml-2",style:{color:"#B0B0B0"},initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.6},children:"Arena"})]})]}),a.jsx("div",{className:"w-64 md:w-80 mx-auto mb-6",children:a.jsx("div",{className:"h-1 bg-surface/30 rounded-full overflow-hidden",children:a.jsx(Mr.div,{className:"h-full rounded-full",style:{background:"linear-gradient(90deg, #FFAA33, #FFD700, #FFAA33)"},animate:{x:[-100,300]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},initial:{x:-100}})})}),a.jsxs(Mr.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.8},className:"space-y-3",children:[a.jsx(Mr.p,{className:"text-base md:text-lg font-medium text-text-primary px-4",animate:{opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0},children:r}),a.jsx("div",{className:"flex justify-center gap-1",children:[0,1,2].map(n=>a.jsx(Mr.div,{className:"w-2 h-2 rounded-full",style:{background:"#FFAA33"},animate:{scale:[.8,1.2,.8],opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0,delay:n*.2}},n))})]})]})]})},Clt={greeting:["Ol! Eu sou a Isis  Vou te ajudar a agendar sua quadra! Qual voc prefere?","Oi! Sou a Isis!  Vamos agendar? Me diz, qual quadra voc quer?","E a! Isis aqui! Bora marcar sua partida? Qual quadra te interessa?","Ol!  Prazer, sou a Isis! Qual quadra voc quer reservar?","Opa! Isis na rea! Vamos agendar sua quadra? Qual delas?","Seja bem-vindo! Sou a Isis e vou facilitar sua reserva! Qual quadra?"],afterQuadra:["Boa escolha! {quadra}  tima!  Para qual dia?","Perfeito! {quadra}  top! Qual dia voc quer?","{quadra} confirmada!  Me diz, que dia?","Show! {quadra}  sucesso aqui! Qual o dia?","Anotado! {quadra}  Agora me fala o dia:","Excelente! {quadra}  uma das melhores! Para quando?"],afterData:["Beleza! {data} anotado!  Qual horrio voc prefere?","timo! {data} t disponvel! Que horas?","{data}  logo ali!  Me diz o horrio:","Confirmado {data}! Qual horrio te atende melhor?","Perfeito! {data}  Agora escolhe o horrio:","Show! {data} t livre! Qual o melhor horrio pra voc?"],afterHorario:["{horario}  seu!  Qual modalidade?","Reservado {horario}!  Vai ser qual modalidade?","Fechou {horario}! Qual esporte?","{horario} confirmado! Me diz a modalidade:","Show! {horario}  E a modalidade ...?","Perfeito! {horario} garantido! Qual modalidade?"],afterModalidade:["{modalidade}! Massa!  Quantas pessoas vo jogar?","Vai ser {modalidade}! Legal! Quantos jogadores?","{modalidade}  bom demais!  Quantas pessoas?","Top! {modalidade}  Me diz quantas pessoas:","{modalidade} confirmado! Quantos vo jogar?","timo! {modalidade}  show! Quantos participantes?"],askNames:["Agora preciso dos nomes! Digite cada um (um por linha):","Beleza! Me manda os nomes dos participantes:","Show! Lista os nomes pra mim:","timo! Quais so os nomes?","Perfeito! Me passa os nomes de todo mundo:","Legal! Agora os nomes dos jogadores:"],askContact:["ltimos dados! Qual seu nome completo?","Agora preciso do seu nome e telefone:","Quase l! Me passa seu nome e WhatsApp:","Beleza! Seus dados para contato:","Falta pouco! Nome completo e telefone:","ltima etapa! Qual seu nome e telefone?"],reviewData:["timo! Vamos conferir tudo antes de confirmar:","Perfeito! Revisa comigo os dados:","Show! Confirma se t tudo certo:","Beleza! D uma olhada se est correto:","Legal! Vamos revisar juntos:","Massa! Confere os detalhes aqui:"],confirmation:[" Tudo certo! Agendamento #{codigo} confirmado!"," Pronto! Seu agendamento #{codigo} est garantido!"," Feito! Cdigo #{codigo} confirmado!"," Sucesso! Agendamento #{codigo} t na agenda!"," Confirmado! #{codigo}  seu!"," Show! Agendamento #{codigo} marcado!"],thankYou:["Obrigada por agendar conosco! At logo! ","Valeu! Te vejo no jogo! ","Brigada! Bom jogo! ","Obrigada! At a partida! ","Valeu pela preferncia! At breve! ","Obrigada! Qualquer coisa,  s voltar aqui! "],loading:["Deixa eu verificar...","S um momento...","Aguarda um pouquinho...","Consultando aqui...","Verificando pra voc..."],error:["Ops! Algo deu errado. Vamos tentar de novo?","Eita! Tive um problema aqui. Podemos recomear?","Putz! Deu erro. Tenta novamente?","Opa! Algo no funcionou. Vamos de novo?","Caramba! Erro aqui. Pode tentar novamente?"],noAvailability:["Puts... esse horrio j foi reservado.  Escolhe outro?","Eita! Esse j est ocupado. Que tal outro horrio?","Opa! Esse horrio acabou de ser reservado. Tem outro?","Poxa! Algum reservou esse agora mesmo. Outro horrio?","Xiii! Esse j foi. Bora escolher outro?"]},iv=(e,t={})=>{const r=Clt[e];if(!r||r.length===0)return console.warn(`[Isis] Nenhuma variao encontrada para step: ${e}`),"Ol! Como posso ajudar?";const n=Math.floor(Math.random()*r.length);let s=r[n];return Object.keys(t).forEach(o=>{const i=new RegExp(`\\{${o}\\}`,"g");s=s.replace(i,t[o])}),s},FV=e=>{try{const t=JSON.parse(localStorage.getItem("isis-feedbacks")||"[]");return t.push(e),localStorage.setItem("isis-feedbacks",JSON.stringify(t)),console.log("[ISIS Feedback] Salvo localmente como fallback:",e.id),e}catch(t){return console.error("[ISIS Feedback] Erro ao salvar localmente:",t),e}},Plt=async e=>{const t={id:Date.now()+Math.random().toString(36).substr(2,9),timestamp:new Date().toISOString(),estrelas:e?.rating??null,nome_cliente:e?.cliente_nome??null,empresa:e?.empresa_nome??null,projeto:"fluxo7arena",comentario:e?.comentario??null};try{const r={id:String(e?.sessionId||e?.session_id||t.id),cod_cliente:e?.cliente_codigo??e?.cliente_id??e?.cod_cliente??null,nome_cliente:e?.cliente_nome||null,empresa:e?.empresa_nome||null,projeto:"fluxo7arena",nota:e?.rating??null,comentario:e?.comentario||null,conversa:Array.isArray(e?.conversaArray)?e.conversaArray:e?.conversa&&typeof e.conversa=="object"?e.conversa:null,timestamp:t.timestamp},{error:n}=await NO.from("isis").upsert(r,{onConflict:"id"});return n?(console.error("[Supabase ISIS] Erro ao inserir feedback:",n),FV({...t,projeto:"fluxo7arena"})):(console.log("[Supabase ISIS] Feedback inserido com sucesso:",r.id),t)}catch(r){return console.error("[Supabase ISIS] Exceo ao inserir feedback, salvando localmente:",r),FV(t)}},Alt=()=>{const{nomeFantasia:e}=jde(),t=Ce.useMemo(()=>{try{if(typeof window>"u")return null;const ze=window.location.host||"",Fe="f7arena.com";if(!ze.endsWith(Fe))return null;const Le=ze.slice(0,-Fe.length).replace(/\.$/,"");if(!Le)return null;const Ze=Le.toLowerCase();return Ze==="www"?null:Ze}catch{return null}},[]),r=e||t;Ol();const[n,s]=p.useState(null),{currentStep:o,selections:i,addIsisMessage:l,addIsisMessageWithButtons:c,addUserMessage:d,disableAllButtons:u,removeMessageById:f,hideButtonsInMessage:h,updateSelection:m,updateContact:x,nextStep:g,setIsLoading:v,setIsTyping:y,chatEndRef:b,sessionId:w,messages:j}=p5(),[_,C]=p.useState(null),[A,S]=p.useState([]),[P,M]=p.useState([]),[O,I]=p.useState(!0),[T,k]=p.useState("telefone"),[$,q]=p.useState(!1),[z,F]=p.useState(null),[V,ue]=p.useState(null),[_e,U]=p.useState(!1),[L,G]=p.useState(null),[de,X]=p.useState(null);if(typeof window<"u"&&new URLSearchParams(window.location.search||"").get("crash")==="1")throw new Error("Isis forced crash test");const W=ze=>ze?ze.replace(/([A-Z])/g," $1").replace(/([0-9]+)/g," $1").trim().split(/[\s_-]+/).filter(Boolean).map(Le=>Le.charAt(0).toUpperCase()+Le.slice(1).toLowerCase()).join(" "):"",Y=Ce.useMemo(()=>_?_.isis_display_name?_.isis_display_name:r?W(r):_.nome_fantasia?_.nome_fantasia:_.razao_social?_.razao_social:"Arena":"",[_,r]),me=Ce.useMemo(()=>_?.logo_url?`${_.logo_url}?v=${Date.now()}`:_?.logo_url||"",[_?.logo_url]);p.useEffect(()=>{(async()=>{if(!r){I(!1);return}try{const Le=decodeURIComponent(r).toLowerCase().replace(/[\s\-_]+/g,"").trim();let Ze=null,Ot=null;try{const{data:bt,error:zt}=await Q.rpc("get_empresa_public_by_isis_subdomain",{p_subdomain:Le});!zt&&bt&&bt.length>0&&(Ze=bt[0],Ot=bt[0]?.isis_display_name||null)}catch{}try{if(!Ze){const{data:bt}=await Q.from("agenda_settings").select("empresa_id, isis_subdomain, isis_display_name, empresas(codigo_empresa, nome_fantasia, razao_social, nome, logo_url, telefone, id)").eq("isis_subdomain",Le).single();bt?.empresas&&(Ze=bt.empresas,Ot=bt.isis_display_name)}}catch{}if(!Ze){let bt=null;try{const{data:zt,error:ne}=await Q.rpc("get_empresa_public_by_slug",{p_slug:Le});!ne&&zt&&zt.length>0&&(bt=zt[0])}catch{}Ze=bt||null}if(!Ze){const{data:bt,error:zt}=await Q.from("empresas").select("codigo_empresa, nome_fantasia, razao_social, nome, logo_url, id");if(!zt&&Array.isArray(bt)){const ne=bt.find(He=>[He?.nome_fantasia||"",He?.razao_social||"",He?.nome||""].some(Ht=>Ht.toLowerCase().replace(/[\s\-_]+/g,"").trim()===Le));ne&&(Ze=ne)}}const mt=Ze?.id||Ze?.codigo_empresa;if(Ze&&!Ot&&mt)try{let bt=null,zt=null;if(Ze.id){const ne=await Q.from("agenda_settings").select("isis_subdomain, empresa_id").eq("empresa_id",Ze.id).single();bt=ne.data,zt=ne.error}else if(Ze.codigo_empresa){const{data:ne}=await Q.from("empresas").select("id").eq("codigo_empresa",Ze.codigo_empresa).single();if(ne?.id){const He=await Q.from("agenda_settings").select("isis_subdomain, empresa_id").eq("empresa_id",ne.id).single();bt=He.data,zt=He.error}}if(bt?.isis_subdomain){console.error("[Isis] Acesso bloqueado. Use o subdomnio configurado."),s(null),I(!1);return}}catch{}if(!Ze){console.error("[Isis] Empresa no encontrada"),s(null),I(!1);return}if(!Ot&&Ze.id)try{const{data:bt}=await Q.from("agenda_settings").select("isis_display_name").eq("empresa_id",Ze.id).single();bt?.isis_display_name&&(Ot=bt.isis_display_name)}catch{}const Qt={...Ze,isis_display_name:Ot};C(Qt),s(Ze.codigo_empresa),I(!1)}catch(Fe){console.error("[Isis] Erro ao buscar empresa:",Fe),s(null),I(!1)}})()},[r]),p.useEffect(()=>{const ze=Fe=>{try{Fe.preventDefault()}catch{}G(Fe)};return window.addEventListener("beforeinstallprompt",ze),()=>window.removeEventListener("beforeinstallprompt",ze)},[]),p.useEffect(()=>{try{if(!(new URLSearchParams(window.location.search||"").get("install")==="1"))return;const Le=window.__installPrompt||L,Ze=()=>{const Ot=[" Como instalar o app:",""," Chrome (Android/PC):","  1) Toque nos 3 pontinhos () do navegador",'  2) Escolha "Instalar app" ou "Adicionar  tela inicial"','  3) Confirme em "Instalar"',""," Safari (iPhone/iPad):","  1) Toque no boto Compartilhar (quadrado com seta )",'  2) Selecione "Adicionar  Tela de Incio"','  3) Toque em "Adicionar"'].join(`
`);l(Ot,400),setTimeout(()=>{l("Beleza! O que voc gostaria de fazer agora?",600),setTimeout(()=>{try{ft()}catch{}},800)},700)};(async()=>{try{Le?.prompt&&(Le===L&&G(null),Le===window.__installPrompt&&(window.__installPrompt=null),await Le.prompt(),await Le.userChoice)}catch{}Ze()})()}catch{}},[L]),p.useEffect(()=>{!n||O||!i.cliente&&!_e&&(U(!0),setTimeout(()=>{ae()},2500))},[n,O,i.cliente,_e]),p.useEffect(()=>{(async()=>{if(n)try{console.log("[useEffect] Definindo empresa atual para RLS:",n),await Q.rpc("set_current_empresa",{empresa_codigo:String(n)}),await gr()}catch(Fe){console.error("[useEffect] Erro ao definir empresa para RLS:",Fe),await gr()}})()},[n]);const ee=()=>{const Fe=new Date().getHours();return Fe>=5&&Fe<12?"Bom dia":Fe>=12&&Fe<18?"Boa tarde":"Boa noite"},ae=()=>{console.log("[DEBUG] iniciarIdentificacao INICIOU:",{loadingEmpresa:O,empresa:_?.nome_fantasia,timestamp:new Date().toISOString()}),k("telefone"),q(!1);const ze=ee(),Fe=[`**${ze}!** Tudo bem? 

Sou a **sis**, assistente virtual da **${Y}** e estou aqui para tornar seu **agendamento** super fcil!

Para comear, qual seu **telefone** ou **e-mail**?`,`Hey! **${ze}!**  **sis** na rea!

Sou a assistente virtual da **${Y}** e vim facilitar sua vida.

Bora **agendar**? Me passa seu **telefone** ou **e-mail**:`,`**${ze}!** Prazer em te atender! 

Sou a **sis** da **${Y}**, sua assistente virtual para **agendamentos**.

Para comear, preciso do seu **telefone** ou **e-mail**:`,`Opa! **${ze}!**  **sis** aqui, sua assistente virtual da **${Y}**!

Vamos **marcar seu horrio**?  rapidinho!

Me informa seu **telefone** ou **e-mail**:`,`**${ze}!** Seja bem-vindo! 

Eu sou a **sis**, sua assistente virtual aqui na **${Y}**.

Vou te ajudar a **agendar seu horrio** rapidinho!

Informe seu **telefone** ou **e-mail**:`],Le=Math.floor(Math.random()*Fe.length);console.log("[DEBUG] Mostrando indicador de digitao primeiro:",{loadingEmpresa:O,timestamp:new Date().toISOString()}),y(!0),setTimeout(()=>{console.log("[DEBUG] Fazendo scroll inicial para mostrar indicador de digitao"),b.current?.scrollIntoView({behavior:"smooth",block:"end"})},300),setTimeout(()=>{console.log("[DEBUG] Enviando mensagem da Isis aps indicador de digitao"),y(!1),l(Fe[Le],0),setTimeout(()=>{console.log("[DEBUG] Fazendo scroll aps mensagem aparecer"),b.current?.scrollIntoView({behavior:"smooth",block:"end"})},100)},3500),setTimeout(()=>{console.log("[DEBUG] Mostrando input"),q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"end"})},200)},3500+600),g("identificacao")},le=async ze=>{try{console.log("[DEBUG] Buscando cliente com valor:",ze),console.log("[DEBUG] Cdigo empresa:",n);const Fe=ze.replace(/\D/g,"");if(Fe.length>=10){console.log("[DEBUG] Buscando telefone:",Fe);const{data:Ot,error:mt}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, celular1, codigo").eq("codigo_empresa",n).eq("status","active");if(mt)throw mt;console.log("[DEBUG] Total de clientes ativos:",Ot?.length);const Qt=Ot?.find(bt=>{const zt=(bt.telefone||"").replace(/\D/g,""),ne=(bt.whatsapp||"").replace(/\D/g,""),He=(bt.celular1||"").replace(/\D/g,"");return zt.includes(Fe)||ne.includes(Fe)||He.includes(Fe)});return console.log("[DEBUG] Cliente encontrado:",Qt),Qt||null}const{data:Le,error:Ze}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, codigo").eq("codigo_empresa",n).eq("status","active").ilike("email",`%${ze}%`);if(Ze)throw Ze;return Le?.[0]||null}catch(Fe){return console.error("Erro ao buscar cliente:",Fe),null}},Te=ze=>{const Fe=ze.trim().split(" ").filter(Le=>Le);return Fe.length===1?Fe[0]:Fe.length>=2?`${Fe[0]} ${Fe[1]}`:Fe[0]},te=async ze=>{if(!ze){l("Por favor, informe a data desejada.",400);return}const Fe=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,Le=ze.match(Fe);if(!Le){l("**Formato invlido!** Por favor, use o formato DD/MM/AAAA (exemplo: 15/12/2024)",400);return}const[,Ze,Ot,mt]=Le,Qt=new Date(parseInt(mt),parseInt(Ot)-1,parseInt(Ze));if(isNaN(Qt.getTime())||Qt.getDate()!==parseInt(Ze)||Qt.getMonth()!==parseInt(Ot)-1||Qt.getFullYear()!==parseInt(mt)){l("**Data invlida!** Verifique se o dia, ms e ano esto corretos.",400);return}const bt=new Date;if(bt.setHours(0,0,0,0),Qt.setHours(0,0,0,0),Qt<bt){l("**Data no passado!** Por favor, escolha uma data de hoje em diante.",400);return}d(ze);const zt=or(Qt,"dd/MM/yyyy",{locale:Da}),ne=or(Qt,"EEEE",{locale:Da});v(!0);const He=await _r(i.quadra.id,Qt);if(v(!1),He.fechada){if(He.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${zt}** (${ne}). 

**Motivo:** ${He.observacao}`,800);else if(He.motivo==="dia_semana"){const cr=or(Qt,"EEEE",{locale:Da});l(`**Ops!** A quadra no funciona ${cr==="domingo"||cr==="sbado"?"aos":"s"} **${cr}s**. 

Escolha outro dia da semana!`,800)}setTimeout(()=>{l("Digite **outra data** no formato DD/MM/AAAA:",1200),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200)},400)},1200);return}m("data",Qt),q(!1),k("telefone"),l(`**Perfeito!** Data escolhida: **${zt}** (${ne}) `,600);const Gt=He.slots;if(Gt.length===0){l("Ops! No encontrei **horrios disponveis** para esse dia.  Que tal tentar outra data?",800),setTimeout(()=>{perguntarData()},1200);return}const Ht=yr(Gt);let Fr="";Ht.length===1?Fr=`Tenho **horrios livres** das **${Ht[0].inicio}** s **${Ht[0].fim}**! `:Fr=`Tenho **horrios livres** ${Ht.map((nn,Tn)=>Tn===Ht.length-1?`e das **${nn.inicio}** s **${nn.fim}**`:Tn===0?`das **${nn.inicio}** s **${nn.fim}**`:`das **${nn.inicio}** s **${nn.fim}**`).join(", ")}! `,l(Fr,1e3),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",1200),g("horario"),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},1600)},ie=async ze=>{if(T==="data_custom")return await te(ze);if(!ze){l("Por favor, informe seu telefone ou e-mail.",400);return}const Fe=T==="telefone"?`(${ze.slice(0,2)}) ${ze.slice(2,7)}-${ze.slice(7)}`:ze;d(Fe);const Le=await le(ze);if(Le){m("cliente",Le),q(!1);const Ze=Te(Le.nome),Ot=[`**${Ze}!** `,`Opa, **${Ze}!** `,`E a, **${Ze}!** `,`**${Ze}!** Que bom te ver! `,`Fala, **${Ze}!** `,`**${Ze}!** Tudo bem? `,`Hey, **${Ze}!** `],mt=Math.floor(Math.random()*Ot.length);l(Ot[mt],600);let Qt="telefone";try{Qt=i?.identificacao_tipo||T||"telefone",X(Qt==="email"?"email":"telefone")}catch{}const bt=Qt==="email"?"email":"telefone";setTimeout(()=>{ft(bt)},600)}else m("identificacao_valor",Fe),m("identificacao_tipo",T),q(!1),l("No encontrei seu cadastro. Sem problemas! Vamos fazer rapidinho. ",800),l("Preciso de algumas informaes:",1400),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600)},1400+800),g("cadastro")},xt=async ze=>{let Fe=`Nome: ${ze.nome}`;if(ze.telefone){const Le=`(${ze.telefone.slice(0,2)}) ${ze.telefone.slice(2,7)}-${ze.telefone.slice(7)}`;Fe+=`
Telefone: ${Le}`}ze.email&&(Fe+=`
E-mail: ${ze.email}`),d(Fe),q(!1),await vt(ze.nome,ze.email,ze.telefone)},vt=async(ze,Fe,Le)=>{try{v(!0);try{if(Le){const bt=String(Le||"").replace(/\D/g,""),{data:zt,error:ne}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, celular1, codigo").eq("codigo_empresa",n).eq("status","active");if(!ne&&Array.isArray(zt)){const He=zt.find(Gt=>{const Ht=(Gt.telefone||"").replace(/\D/g,""),Fr=(Gt.whatsapp||"").replace(/\D/g,""),cr=(Gt.celular1||"").replace(/\D/g,"");return Ht===bt||Fr===bt||cr===bt});if(He){v(!1),m("cliente_sugerido",He),c(`Encontrei um cadastro existente para este telefone: **${Te(He.nome)}**.  voc?`,[{label:" Sim, sou eu",value:"confirm_cliente_existente"},{label:" No, quero corrigir",value:"corrigir_cadastro"}],200),q(!1),g("confirmar_cliente_existente");return}}}if(Fe){const bt=String(Fe||"").trim().toLowerCase(),{data:zt,error:ne}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, codigo").eq("codigo_empresa",n).eq("status","active").ilike("email",bt);if(!ne&&Array.isArray(zt)&&zt.length>0){const He=zt.find(Gt=>String(Gt.email||"").trim().toLowerCase()===bt)||null;if(He){v(!1),m("cliente_sugerido",He),c(`Este e-mail j possui cadastro: **${Te(He.nome)}**.  voc?`,[{label:" Sim, sou eu",value:"confirm_cliente_existente"},{label:" No, quero corrigir",value:"corrigir_cadastro"}],200),q(!1),g("confirmar_cliente_existente");return}}}}catch{}l(iv("loading"));const{data:Ze}=await Q.from("empresa_counters").select("next_cliente_codigo").eq("empresa_id",_?.id).single(),Ot=Ze?.next_cliente_codigo||1,{data:mt,error:Qt}=await Q.from("clientes").insert({codigo_empresa:n,codigo:Ot,nome:ze,email:Fe||null,telefone:Le,whatsapp:Le,status:"active"}).select("id, nome, email, telefone, whatsapp, codigo").single();if(Qt){if(Qt.code==="23505"&&Qt.message.includes("uq_clientes_empresa_codigo")){console.log("[Isis] Cdigo duplicado, tentando prximo cdigo...");const{data:bt,error:zt}=await Q.from("clientes").insert({codigo_empresa:n,codigo:Ot+1,nome:ze,email:Fe||null,telefone:Le,whatsapp:Le,status:"active"}).select("id, nome, email, telefone, whatsapp, codigo").single();if(zt)throw zt;await Q.from("empresa_counters").update({next_cliente_codigo:Ot+2}).eq("empresa_id",_?.id),v(!1),q(!1),m("cliente",bt),l(`Pronto, ${ze}! Cadastro realizado com sucesso! `,800),setTimeout(()=>{_t()},1400);return}throw Qt}await Q.from("empresa_counters").update({next_cliente_codigo:Ot+1}).eq("empresa_id",_?.id),v(!1),q(!1),m("cliente",mt),l(`Pronto, ${ze}! Cadastro realizado com sucesso! `,800),setTimeout(()=>{_t()},1400)}catch(Ze){console.error("Erro ao criar cliente:",Ze),v(!1),l("Ops! Erro ao criar cadastro. Tente novamente.",400)}},dt=()=>{const ze=new Date,Fe=Ss(ze,1),Le=[{label:`Hoje (${or(ze,"dd/MM")})`,value:or(ze,"yyyy-MM-dd"),icon:"",date:ze},{label:`Amanh (${or(Fe,"dd/MM")})`,value:or(Fe,"yyyy-MM-dd"),icon:"",date:Fe},{label:"Outro dia...",value:"custom",icon:""}];Array.isArray(A)&&A.length>1&&Le.push({label:"Mudar quadra",value:"mudar_quadra",icon:""}),Le.push({label:" Menu",value:"menu",action:"menu"}),c("Para qual dia voc gostaria de agendar?",Le,600),g("data")},St=()=>{d(" Mudar Data"),q(!1),setTimeout(()=>{dt()},400)},ft=(ze=null)=>{const Fe=["O que voc gostaria de fazer hoje?","Como posso te ajudar?","Qual  o plano para hoje?","O que vamos fazer?","Em que posso te auxiliar?","Qual sua necessidade hoje?","Como posso ser til?"],Le=Fe[Math.floor(Math.random()*Fe.length)];let Ze=[{label:"Fazer Agendamento",value:"novo_agendamento",icon:""},{label:"Editar Agendamento",value:"buscar_agendamento",icon:""},{label:"Finalizar Atendimento",value:"finalizar_atendimento",icon:""}];const Ot=ze||de;Ot==="telefone"?Ze=[Ze[0],Ze[1],{label:"Informei o telefone errado",value:"corrigir_telefone",icon:""},Ze[2]]:Ot==="email"&&(Ze=[Ze[0],Ze[1],{label:"Informei o e-mail errado",value:"corrigir_email",icon:""},Ze[2]]),c(Le,Ze,600),de&&setTimeout(()=>X(null),0)},_t=async()=>{let ze=A,Fe=_;if(!ze||ze.length===0){const Le=await gr(!1);if(ze=Le.quadras,Fe=Le.empresa,!ze||ze.length===0){console.error("[iniciarAgendamento] Quadras ainda no disponveis aps carregar!"),l("Ops! No consegui carregar as quadras. Tente novamente.",600);return}}if(!Fe){console.error("[iniciarAgendamento] Empresa no disponvel!"),l("Ops! No consegui carregar os dados da empresa. Tente novamente.",600);return}setTimeout(()=>{be(ze,Fe,!0)},800)},gr=async(ze=!0)=>{try{ze&&I(!0);const Fe=Date.now(),Le=3500,{data:Ze,error:Ot}=await Q.from("empresas").select("*").eq("codigo_empresa",n).single();if(Ot)throw Ot;if(!Ze)return D_({title:"Empresa no encontrada",description:"Verifique o cdigo e tente novamente",variant:"destructive"}),{empresa:null,quadras:[]};C(ne=>({...Ze,isis_display_name:ne?.isis_display_name||Ze.isis_display_name})),m("empresa",Ze);const{data:mt,error:Qt}=await Q.from("quadras").select("id, nome, modalidades, hora_inicio, hora_fim, valor, codigo_empresa, status, descricao").eq("codigo_empresa",String(n)).eq("status","Ativa").order("nome",{ascending:!0});if(Qt)throw console.error("[loadEmpresa] Erro ao buscar quadras:",Qt),Qt;if(!mt||mt.length===0){console.warn("[loadEmpresa] Nenhuma quadra encontrada devido a RLS. Criando quadra temporria.");const ne=[{id:"temp-quadra-1004",nome:"Quadra Principal",modalidades:["Futebol","Futsal"],hora_inicio:"07:00:00",hora_fim:"22:00:00",valor:30,codigo_empresa:String(n),status:"Ativa",descricao:"Quadra temporria (problema de permisso)"}];return S(ne),{empresa:Ze,quadras:ne}}S(mt||[]);const bt=Date.now()-Fe,zt=Math.max(0,Le-bt);return zt>0&&await new Promise(ne=>setTimeout(ne,zt)),{empresa:Ze,quadras:mt||[]}}catch(Fe){console.error("[Isis] Erro ao carregar empresa:",Fe);const Le=Date.now()-startTime,Ze=Math.max(0,minLoadingTime-Le);return Ze>0&&await new Promise(Ot=>setTimeout(Ot,Ze)),D_({title:"Erro ao carregar",description:"No foi possvel carregar os dados da empresa",variant:"destructive"}),{empresa:null,quadras:[]}}finally{ze&&I(!1)}},be=(ze,Fe,Le=!1)=>{if(ee(),ze.length===1){const mt=ze[0];if(Le){const Qt=[`Perfeito! Agora vamos **agendar** seu horrio na **${mt.nome}!** `,`timo! Vou te ajudar a **marcar sua partida** na **${mt.nome}!** `,`Show! Bora **agendar** a **${mt.nome}?** `,`Perfeito! Vamos **marcar sua reserva** na **${mt.nome}!** `],bt=Math.floor(Math.random()*Qt.length),zt=Qt[bt];l(zt)}m("quadra",mt),setTimeout(()=>{const Qt=new Date,bt=Ss(Qt,1),zt=[{label:`Hoje (${or(Qt,"dd/MM")})`,value:or(Qt,"yyyy-MM-dd"),icon:"",date:Qt},{label:`Amanh (${or(bt,"dd/MM")})`,value:or(bt,"yyyy-MM-dd"),icon:"",date:bt},{label:"Outro dia...",value:"custom",icon:""},{label:" Menu",value:"menu",action:"menu"}];c("Para qual dia voc gostaria de agendar?",zt,800),g("data")},1200);return}let Ze;if(Le){const mt=["Qual quadra voc quer reservar? ","Qual quadra te interessa? ","Me diz, qual quadra? ","Qual quadra voc prefere? ","Bora escolher a quadra? Qual delas? "],Qt=Math.floor(Math.random()*mt.length);Ze=mt[Qt]}else return;const Ot=ze.map(mt=>({label:mt.nome,subtitle:mt.descricao||null,value:mt.id,icon:"",quadra:mt}));Ot.push({label:" Menu",value:"menu",action:"menu"}),c(Ze,Ot),g("quadra")},Nt=async ze=>{if(ze.action==="menu"){d(" Menu");try{ue(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{q(!1)}catch{}g("identificacao"),setTimeout(()=>{ft()},400);return}const Fe=ze.quadra;if(!Fe){console.error("[handleQuadraSelection] Quadra no encontrada no boto:",ze);return}if(d(Fe.nome),m("quadra",Fe),o==="review"){q(!1),F("horario"),v(!0);const Qt=await _r(Fe.id,i.data,V?.id);if(v(!1),Qt.fechada){const zt=or(i.data,"dd/MM/yyyy",{locale:Da}),ne=or(i.data,"EEEE",{locale:Da});if(Qt.motivo==="data_especifica")l(`**Ops!** A **${Fe.nome}** estar **fechada** no dia **${zt}** (${ne}). 

**Motivo:** ${Qt.observacao}`,800);else if(Qt.motivo==="dia_semana"){const He=or(i.data,"EEEE",{locale:Da}),Gt=He==="domingo"||He==="sbado"?"aos":"s";l(`**Ops!** A **${Fe.nome}** no funciona ${Gt} **${He}s**. `,800)}setTimeout(()=>{l("Escolha **outra quadra** ou **mude a data**:",1200),setTimeout(()=>{dt()},400)},1600);return}const bt=Qt.slots;if(bt&&bt.length>0){const zt=yr(bt);let ne="";zt.length===1?ne=`Tenho **horrios livres** das **${zt[0].inicio}** s **${zt[0].fim}**! `:ne=`Tenho **horrios livres** ${zt.map((Gt,Ht)=>Ht===zt.length-1?`e das **${Gt.inicio}** s **${Gt.fim}**`:Ht===0?`das **${Gt.inicio}** s **${Gt.fim}**`:`das **${Gt.inicio}** s **${Gt.fim}**`).join(", ")}! `,console.log("[handleQuadraSelection] Mostrando horrios disponveis e input de horrio"),l(ne,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{console.log("[handleQuadraSelection] Ativando showInput=true"),q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else console.log("[handleQuadraSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para essa quadra nesse dia. "),setTimeout(()=>{l("Que tal tentar **outra data**? ",800),setTimeout(()=>{dt()},400)},1200);return}console.log("[handleQuadraSelection] Fluxo normal (no edio)");const Le=iv("afterQuadra",{quadra:Fe.nome});l(Le,600);const Ze=new Date,Ot=Ss(Ze,1),mt=[{label:`Hoje (${or(Ze,"dd/MM")})`,value:or(Ze,"yyyy-MM-dd"),icon:"",date:Ze},{label:`Amanh (${or(Ot,"dd/MM")})`,value:or(Ot,"yyyy-MM-dd"),icon:"",date:Ot},{label:"Outro dia...",value:"custom",icon:""},{label:" Menu",value:"menu",action:"menu"}];c("Para qual dia voc gostaria de agendar?",mt,1e3),g("data")},Wt=async ze=>{if(console.log("[handleDataSelection] Iniciando...",{button:ze,currentStep:o}),ze.action==="menu"){d(" Menu");try{ue(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{q(!1)}catch{}g("identificacao"),setTimeout(()=>{ft()},400);return}if(ze.value==="custom"){d(" Outro dia..."),l("**Perfeito!** Me informe a **data desejada** no formato DD/MM/AAAA:",600),k("data_custom"),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},800);return}const Fe=ze.date;if(!Fe){console.error("[handleDataSelection] Data no encontrada no boto:",ze);return}if(d(ze.label),m("data",Fe),!!i?.editing_agendamento||!!V){console.log("[handleDataSelection] Modo edio detectado - recarregando horrios"),console.log("[handleDataSelection] Quadra ID:",i.quadra?.id),console.log("[handleDataSelection] Nova Data:",Fe),q(!1),F("horario"),v(!0);const bt=await _r(i.quadra.id,Fe,V?.id);if(console.log("[handleDataSelection] Resultado:",bt),v(!1),bt.fechada){const ne=or(Fe,"dd/MM/yyyy",{locale:Da}),He=or(Fe,"EEEE",{locale:Da});if(bt.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${ne}** (${He}). 

**Motivo:** ${bt.observacao}`,800);else if(bt.motivo==="dia_semana"){const Gt=or(Fe,"EEEE",{locale:Da});l(`**Ops!** A quadra no funciona ${Gt==="domingo"||Gt==="sbado"?"aos":"s"} **${Gt}s**. `,800)}setTimeout(()=>{l("Escolha **outra data**:",1200),setTimeout(()=>{dt()},400)},1600);return}const zt=bt.slots;if(zt&&zt.length>0){const ne=yr(zt);let He="";ne.length===1?He=`Tenho **horrios livres** das **${ne[0].inicio}** s **${ne[0].fim}**! `:He=`Tenho **horrios livres** ${ne.map((Ht,Fr)=>Fr===ne.length-1?`e das **${Ht.inicio}** s **${Ht.fim}**`:Fr===0?`das **${Ht.inicio}** s **${Ht.fim}**`:`das **${Ht.inicio}** s **${Ht.fim}**`).join(", ")}! `,console.log("[handleDataSelection] Mostrando horrios disponveis e input"),l(He,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{console.log("[handleDataSelection] Ativando showInput=true"),q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else console.log("[handleDataSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para essa quadra nesse dia.  Tente outra data.");return}console.log("[handleDataSelection] Fluxo normal (no edio)"),v(!0);const Ze=await _r(i.quadra.id,Fe);if(console.log("[handleDataSelection] Resultado (fluxo normal):",Ze),v(!1),Ze.fechada){const bt=or(Fe,"dd/MM/yyyy",{locale:Da}),zt=or(Fe,"EEEE",{locale:Da});if(Ze.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${bt}** (${zt}). 

**Motivo:** ${Ze.observacao}`,800);else if(Ze.motivo==="dia_semana"){const ne=or(Fe,"EEEE",{locale:Da});l(`**Ops!** A quadra no funciona ${ne==="domingo"||ne==="sbado"?"aos":"s"} **${ne}s**. 

Escolha outro dia da semana!`,800)}setTimeout(()=>{l("Que tal tentar **outra data**? ",1200),setTimeout(()=>{dt()},400)},1600);return}const Ot=Ze.slots;if(Ot.length===0){console.log("[handleDataSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para esse dia.  Que tal tentar outro dia?"),setTimeout(()=>{l("Escolha **outra data**:",800),setTimeout(()=>{dt()},400)},1200);return}const mt=yr(Ot);let Qt="";mt.length===1?Qt=`Tenho **horrios livres** das **${mt[0].inicio}** s **${mt[0].fim}**! `:Qt=`Tenho **horrios livres** ${mt.map((zt,ne)=>ne===mt.length-1?`e das **${zt.inicio}** s **${zt.fim}**`:ne===0?`das **${zt.inicio}** s **${zt.fim}**`:`das **${zt.inicio}** s **${zt.fim}**`).join(", ")}! `,l(Qt,800),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",1e3),g("horario"),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},1e3)},1e3+600)},1400)},_r=async(ze,Fe,Le=null)=>{try{console.log("[loadHorariosDisponiveis] quadraId:",ze),console.log("[loadHorariosDisponiveis] data:",Fe);const Ze=A.find(ta=>ta.id===ze);if(!Ze)return console.error("[loadHorariosDisponiveis] Quadra no encontrada:",ze),[];console.log("[loadHorariosDisponiveis] Quadra encontrada:",Ze.nome),console.log("[loadHorariosDisponiveis] Horrio funcionamento:",Ze.hora_inicio,"-",Ze.hora_fim);const Ot=or(Fe,"yyyy-MM-dd"),mt=Fe.getDay();console.log("[loadHorariosDisponiveis] Verificando funcionamento para:",Ot,"dia da semana:",mt);const{data:Qt,error:bt}=await Q.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",n).eq("quadra_id",ze).or(`and(tipo.eq.data_fechamento,data_fechamento.eq.${Ot}),and(tipo.eq.dia_semana,dia_semana.eq.${mt})`);if(bt)console.error("[loadHorariosDisponiveis] Erro ao buscar configuraes de funcionamento:",bt);else{console.log("[loadHorariosDisponiveis] Configuraes encontradas:",Qt?.length||0);const ta=Qt?.find(ke=>ke.tipo==="data_fechamento"&&ke.data_fechamento===Ot);if(ta&&!ta.funciona)return console.log("[loadHorariosDisponiveis] Quadra fechada em data especfica:",ta.observacao),{slots:[],fechada:!0,motivo:"data_especifica",observacao:ta.observacao||"Fechamento especial"};const Aa=Qt?.find(ke=>ke.tipo==="dia_semana"&&ke.dia_semana===mt);if(Aa&&!Aa.funciona)return console.log("[loadHorariosDisponiveis] Quadra no funciona neste dia da semana"),{slots:[],fechada:!0,motivo:"dia_semana",observacao:`Quadra fechada s ${["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"][mt]}s`};console.log("[loadHorariosDisponiveis] Quadra funciona normalmente na data selecionada")}const zt=Po(Fe),ne=Ss(zt,1);let He=Q.from("agendamentos").select("inicio, fim, status").eq("codigo_empresa",n).eq("quadra_id",ze).gte("inicio",zt.toISOString()).lt("inicio",ne.toISOString()).neq("status","canceled");Le&&(He=He.neq("id",Le),console.log("[loadHorariosDisponiveis] Excluindo agendamento sendo editado:",Le));const{data:Gt,error:Ht}=await He;if(Ht)throw Ht;console.log("[loadHorariosDisponiveis] Agendamentos encontrados:",Gt?.length||0);const Fr=parseInt(Ze.hora_inicio?.split(":")[0]||"6");let cr=parseInt(Ze.hora_fim?.split(":")[0]||"24");cr===0&&(cr=24);const nn=new Date,Tn=Po(Fe).getTime()===Po(nn).getTime(),Gn=[];for(let ta=Fr;ta<cr;ta++)for(let Aa of[0,30]){const ke=A2(P2(Fe,ta),Aa),Ae=d8(ke,30);if(Tn&&ke<nn)continue;Gt?.some(br=>{const Zt=new Date(br.inicio),Pn=new Date(br.fim),Ct=Math.floor(ke.getTime()/6e4),lr=Math.floor(Ae.getTime()/6e4),Ye=Math.floor(Zt.getTime()/6e4),Tt=Math.floor(Pn.getTime()/6e4);return lr===Ye||Ct===Tt?!1:Ct<Tt&&lr>Ye})||Gn.push({inicio:or(ke,"HH:mm"),fim:or(Ae,"HH:mm"),inicioDate:ke,fimDate:Ae})}return console.log("[loadHorariosDisponiveis] Total de slots disponveis:",Gn.length),M(Gn),{slots:Gn,fechada:!1,motivo:null,observacao:null}}catch(Ze){return console.error("[loadHorariosDisponiveis] Erro ao carregar horrios:",Ze),M([]),{slots:[],fechada:!1,motivo:"erro",observacao:"Erro ao carregar horrios"}}},yr=ze=>{if(ze.length===0)return[];const Fe=[];let Le={inicio:ze[0].inicio,fim:ze[0].fim};for(let Ot=1;Ot<ze.length;Ot++)ze[Ot].inicio===Le.fim?Le.fim=ze[Ot].fim:(Fe.push(Le),Le={inicio:ze[Ot].inicio,fim:ze[Ot].fim});Fe.push(Le);const Ze=Ot=>{const[mt,Qt]=Ot.split(":").map(Number);return mt===0&&Qt===0?24*60:mt*60+Qt};return Fe.filter(Ot=>Ze(Ot.fim)-Ze(Ot.inicio)>=60)},ve=({inicio:ze,fim:Fe,esporte:Le})=>{const[Ze,Ot]=ze.split(":").map(Number),[mt,Qt]=Fe.split(":").map(Number),bt=i.data,zt=A2(P2(bt,Ze),Ot),ne=mt===0&&Qt===0?A2(P2(Ss(bt,1),0),0):A2(P2(bt,mt),Qt),He={inicio:ze,fim:Fe,inicioDate:zt,fimDate:ne};if(d(`${He.inicio} - ${He.fim}  ${Le}`),console.log("[handleHorarioSubmit] Atualizando horrio:",He),console.log("[handleHorarioSubmit] Atualizando esporte:",Le),m("horario",He),m("esporte",Le),q(!1),o==="review"||z==="horario"){setTimeout(()=>{F(null),g("review"),Rt(He,Le)},600);return}const Gt=i.participantes||[];if(!(Array.isArray(Gt)&&Gt.length>0)){const cr=[{nome:i.cliente.nome,cliente_id:i.cliente.id,principal:!0}];m("participantes",cr)}const Fr=Te(i.cliente.nome);l(`Perfeito! ${Fr}, voc j est na lista! `,800),l('Quer adicionar mais pessoas? Digite o nome e clique em "Adicionar" para cada um, ou finalize quando quiser.',1400),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600)},1400+600),g("participantes")},at=async()=>{const ze=i?.quadra?.id,Fe=i?.data,Le=i?.horario;if(!ze||!Fe||!Le?.inicioDate||!Le?.fimDate)return{ok:!0,conflito:!1};const Ze=await _r(ze,Fe,null);if(Ze?.fechada)return{ok:!0,conflito:!0,motivo:"fechada",detalhe:Ze};const Ot=Array.isArray(Ze?.slots)?Ze.slots:[],mt=Le.inicioDate,Qt=Le.fimDate,bt=(ne,He)=>{const Gt=ne.getTime(),Ht=He.getTime();return Ot.some(Fr=>Fr?.inicioDate?.getTime?.()===Gt&&Fr?.fimDate?.getTime?.()===Ht)};let zt=new Date(mt);for(;zt.getTime()<Qt.getTime();){const ne=d8(zt,30);if(!bt(zt,ne))return{ok:!0,conflito:!0,motivo:"conflito"};zt=ne}return{ok:!0,conflito:!1}},qt=ze=>{if(!ze||!ze.trim())return;const Fe=i.participantes||[],Le={nome:ze.trim(),cliente_id:null,principal:!1},Ze=[...Fe,Le];m("participantes",Ze)},$t=ze=>{if(!Array.isArray(ze)||ze.length===0)return;const Fe=ne=>String(ne||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g," "),Le=i.cliente,Ze=Le?.nome?String(Le.nome).trim():null,Ot=Ze?Fe(Ze):null,mt=i.participantes||[],Qt=mt.length>0?mt:Ze&&Le?[{nome:Ze,cliente_id:Le.id,principal:!0}]:[],bt=[];if(!!i?.editing_agendamento){let ne=Qt.find(He=>He.principal)||(Ze&&Le?{nome:Ze,cliente_id:Le.id,principal:!0}:null);ne&&bt.push({...ne,principal:!0}),ze.forEach(He=>{const Gt=String(He||"").trim();if(!Gt)return;const Ht=Fe(Gt);Ot&&Ht===Ot||bt.push({nome:Gt,cliente_id:null,principal:!1})})}else Qt.forEach(ne=>{const He=Fe(ne.nome),Gt=Ot&&He===Ot;bt.push({...ne,principal:Gt})}),ze.forEach(ne=>{const He=String(ne||"").trim();if(!He)return;const Gt=Fe(He);Ot&&Gt===Ot||bt.push({nome:He,cliente_id:null,principal:!1})});bt.length===0&&Ze&&Le&&bt.push({nome:Ze,cliente_id:Le.id,principal:!0}),m("participantes",bt)},De=ze=>{const Fe=i.participantes||[];if(ze===0)return;const Le=Fe.filter((Ze,Ot)=>Ot!==ze);m("participantes",Le)},wt=ze=>{const Fe=i.participantes||[];if(Fe.length===0){l("Voc precisa ter pelo menos 1 participante!",400);return}try{const Ze=(ze||"").trim();Ze&&Ze!==i.esporte&&m("esporte",Ze)}catch{}q(!1);const Le=Fe.length;if(Le===1)d(" Apenas eu por enquanto");else{const Ze=Fe.filter(Ot=>!Ot.principal).map(Ot=>Ot.nome).join(", ");d(` Eu + ${Ze} (${Le} pessoas)`)}setTimeout(()=>{F(null);try{const Ze=(ze||"").trim();Rt(null,Ze||null)}catch{Rt()}},600)},Rt=(ze=null,Fe=null,Le=!1,Ze=null,Ot=null,mt=null,Qt=null)=>{const bt=ze||i.horario,zt=Fe||i.esporte,ne=Ze||i.quadra,He=Ot||i.data,Gt=mt||i.participantes||[],Ht=!!(Qt||i?.editing_agendamento||V);if(console.log("[mostrarResumo] Selections atuais:",i),console.log("[mostrarResumo] Horrio usado:",bt),console.log("[mostrarResumo] Esporte usado:",zt),console.log("[mostrarResumo] Quadra atual:",ne),console.log("[mostrarResumo] Data atual:",He),console.log("[mostrarResumo] Modo edio inicial:",Le),!He||!bt||!ne){console.error("[mostrarResumo] Dados obrigatrios faltando:",{dataFinal:He,horarioFinal:bt,quadraFinal:ne});return}if(!Le){const Je=iv("reviewData");l(Je,400)}const Fr=Gt.map((Je,mr)=>{const ot=mr===0?"":"",ar=mr===0?" (voc)":"";return`${ot} ${Je.nome}${ar}`}).join(`
`),cr=or(He,"dd/MM/yyyy",{locale:Da}),nn=or(He,"EEEE",{locale:Da}),[Tn,Gn]=bt.inicio.split(":").map(Number),[ta,Aa]=bt.fim.split(":").map(Number);let ke=ta*60+Aa-(Tn*60+Gn);ta===0&&Aa===0&&(ke=24*60-(Tn*60+Gn));const Ae=Math.floor(ke/60),et=ke%60,br=et>0?`${Ae}h ${et}min`:`${Ae}h`,Zt=ne.valor||0,Pn=ke/30,Ct=Math.round(Zt*Pn*100)/100,lr=Ct/Gt.length;console.log("[mostrarResumo] Clculo do valor:"),console.log("- Valor por meia hora:",Zt),console.log("- Slots de 30min:",Pn),console.log("- Durao em minutos:",ke),console.log("- Valor total:",Ct),console.log("- Participantes:",Gt.length),console.log("- Valor dividido:",lr);const Ye=i?.empresa?.endereco&&String(i.empresa.endereco).trim().length>0?String(i.empresa.endereco).trim():null,Tt=Ye?`
 **Endereo**
${Ye}
`:"",Xt=Je=>{if(!Je)return"N/A";const mr=String(Je).replace(/\D/g,"");return mr.length===11?`(${mr.slice(0,2)}) ${mr.slice(2,7)}-${mr.slice(7)}`:mr.length===10?`(${mr.slice(0,2)}) ${mr.slice(2,6)}-${mr.slice(6)}`:Je},Br=i.cliente.telefone||i.cliente.whatsapp||null,Wn=Xt(Br),xn=` **RESUMO DO AGENDAMENTO**

 **Quadra**
${ne.nome}${Tt}
 **Data**
${cr} (${nn})

 **Horrio**
${bt.inicio} s ${bt.fim}
 Durao: **${br}**

 **Modalidade**
${zt}

 **Participantes** (${Gt.length})
${Fr}

 **Valor Total**
R$ **${Ct.toFixed(2).replace(".",",")}**
 **Valor Dividido**
R$ **${lr.toFixed(2).replace(".",",")}** por pessoa

 **Responsvel**
${i.cliente.nome}
 ${Wn}`,on=Le?200:1e3,ua=xn.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:xn,copyable:!0,copyText:ua},on);const sa=[{label:Ht?"Salvar Alteraes":"Confirmar Agendamento",value:Ht?"confirm":"criar agendamento",icon:""}],wa=[];A.length>1&&wa.push({label:"Editar Quadra",value:"edit_quadra",icon:""}),wa.push({label:"Editar Data",value:"edit_data",icon:""}),wa.push({label:"Editar Horrio e Esporte",value:"edit_horario",icon:""}),wa.push({label:"Editar Participantes",value:"edit_participantes",icon:""}),(Le||Ht&&!i?.editing_agendamento)&&wa.push({label:"Gerar Times",value:"gerar_times",icon:""}),Ht&&wa.push({label:"Cancelar Agendamento",value:"cancelar_agendamento",icon:""});const J=[...sa,...wa];J.push({label:" Menu",value:"menu",action:"menu"}),c("Est tudo correto?",J,Le?400:1600),g("review")},Rr=(ze,Fe=!1)=>{l(Fe?" **Perfeito!** Suas **alteraes** foram **salvas com sucesso!**":" **Pronto!** Seu **agendamento** foi **confirmado com sucesso!**",600,"green");const Ze=i.participantes||[],Ot=Ze.map(Zt=>` ${Zt.nome}`).join(`
`),mt=or(i.data,"dd/MM/yyyy",{locale:Da}),Qt=or(i.data,"EEEE",{locale:Da}),[bt,zt]=i.horario.inicio.split(":").map(Number),[ne,He]=i.horario.fim.split(":").map(Number);let Gt=ne*60+He-(bt*60+zt);ne===0&&He===0&&(Gt=24*60-(bt*60+zt));const Ht=Math.floor(Gt/60),Fr=Gt%60,cr=Fr>0?`${Ht}h ${Fr}min`:`${Ht}h`,nn=i.quadra.valor||0,Tn=Gt/30,Gn=Math.round(nn*Tn*100)/100,ta=Ze.length>0?Gn/Ze.length:0,Aa=i?.empresa?.endereco&&String(i.empresa.endereco).trim().length>0?String(i.empresa.endereco).trim():null,ke=Aa?`
 **Endereo**
${Aa}
`:"",Ae=` **AGENDAMENTO CONFIRMADO**

 **Cdigo:** #${ze.codigo}

 **Local**
${i.quadra.nome}${ke}

 **Quando**
${mt} (${Qt})
 ${i.horario.inicio} s ${i.horario.fim} **(${cr})**

 **Modalidade**
${i.esporte}

 **Participantes** (${Ze.length})
${Ot}

 **Valor Total:** R$ **${Gn.toFixed(2).replace(".",",")}**
 **Valor Dividido:** R$ **${ta.toFixed(2).replace(".",",")}** por pessoa

 **Responsvel:** ${i.cliente.nome}`,et=Ae.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:Ae,copyable:!0,copyText:et},1200),c("O que voc gostaria de fazer?",[{label:"Gerar Times",value:"gerar_times",icon:""},{label:"Editar Agendamento",value:"editar_agendamento",icon:""},{label:"Cancelar Agendamento",value:"cancelar_agendamento",icon:""},{label:"Finalizar Atendimento",value:"finalizar",icon:""}],1800)},Me=async()=>{try{y(!0)}catch{}try{const ze=(i.participantes||[]).map(Ye=>String(Ye?.nome||"").trim()).filter(Boolean);if(!ze||ze.length===0){l("No h participantes suficientes para formar times.");return}const Fe=String(i?.esporte||i?.quadra?.tipo||"").toLowerCase();let Le=0,Ze="unknown";try{console.log("[Teams] Start generation modalidade=%o",Fe)}catch{}try{const{data:Ye}=await Q.functions.invoke("infer-team-size",{body:{modalidade:Fe,quadra:i?.quadra||null,totalPlayers:(i.participantes||[]).length}});try{console.log("[Teams] Edge infer-team-size response=%o",Ye)}catch{}Ye&&Number(Ye.teamSize)>0&&(Le=Number(Ye.teamSize),Ze="edge")}catch{}if(!Le)if(/(praia|areia)/i.test(Fe)){Le=5,Ze="fallback:beach";try{console.log("[Teams] Fallback matched: praia/areia -> teamSize=5")}catch{}}else if(/(v[o]lei|voleibol)/i.test(Fe)){Le=6,Ze="fallback:volley";try{console.log("[Teams] Fallback matched: volei/voleibol -> teamSize=6")}catch{}}else if(/(hand|handebol)/i.test(Fe)){Le=7,Ze="fallback:hand";try{console.log("[Teams] Fallback matched: handebol -> teamSize=7")}catch{}}else if(/(futsal|society)/i.test(Fe)){Le=5,Ze="fallback:futsal";try{console.log("[Teams] Fallback matched: futsal/society -> teamSize=5")}catch{}}else if(/(futebol|campo)/i.test(Fe)){Le=11,Ze="fallback:campo";try{console.log("[Teams] Fallback matched: futebol/campo -> teamSize=11")}catch{}}else{Le=5,Ze="fallback:default";try{console.log("[Teams] Fallback matched: default -> teamSize=5")}catch{}}{const Ye=String(Fe||"").toLowerCase(),Tt=/(v[o]lei|voleibol)/.test(Ye),Xt=/(praia|areia)/.test(Ye),Br=Le;Tt&&(Le=Xt?5:6),Tt&&(Ze=Xt?"forced:beach":"forced:volley");try{console.log("[Teams] Normalization: isVolley=%s isBeach=%s before=%s after=%s source=%s",Tt,Xt,Br,Le,Ze)}catch{}}const Ot=Ye=>String(Ye||"").trim().toLowerCase(),mt=Array.isArray(i?.fixos)?i.fixos:[],Qt=Array.isArray(i?.goleiros)?i.goleiros:[],bt=Array.isArray(i?.levantadores)?i.levantadores:[],zt=new Set([...mt,...Qt,...bt].map(Ot).filter(Boolean)),ne=Ye=>zt.has(Ot(Ye)),He=(()=>{const Ye={},Tt=i?.fixoRoles;if(Tt&&typeof Tt=="object")for(const Xt of Object.keys(Tt))Ye[Xt]=Tt[Xt];return Qt.forEach(Xt=>{Ye[Ot(Xt)]="Goleiro"}),bt.forEach(Xt=>{Ye[Ot(Xt)]="Levantador"}),Ye})(),Gt=Ye=>ne(Ye)?` (${He[Ot(Ye)]||"Fixo"})`:"",Ht=ze.filter(ne),cr=ze.filter(Ye=>!ne(Ye)).slice();for(let Ye=cr.length-1;Ye>0;Ye--){const Tt=Math.floor(Math.random()*(Ye+1));[cr[Ye],cr[Tt]]=[cr[Tt],cr[Ye]]}Le<2&&(Le=2);const nn=Ye=>Ye.map((Tt,Xt)=>`${Xt+1}) ${Tt}${Gt(Tt)}`).join(`
`)||"",Tn=ze.length;let Gn=0;if(Tn>=2*Le){Gn=Math.max(2,Math.floor(Tn/Le));try{console.log("[Teams] Brute rule: canMakeTwoBase=true -> teamCount=%s teamSize=%s",Gn,Le)}catch{}}else{const Ye=Le;Le>5&&(Le=5),Gn=Math.ceil(Tn/Le);try{console.log("[Teams] Brute rule: canMakeTwoBase=false -> forceSize %s->%s, teamCount=%s",Ye,Le,Gn)}catch{}}let ke=` **Times gerados (${Fe?Fe[0].toUpperCase()+Fe.slice(1):"modalidade"})**`;const Ae=["","","","","",""],et=(Fe||"").toLowerCase(),br=/(fut|society|sal[a]o)/.test(et),Zt=/(v[o]lei|volei|voleibol)/.test(et);try{console.log("[Teams] teamSize=%s totalPlayers=%s teamCount=%s isVolleyLike=%s isSoccerLike=%s source=%s",Le,Tn,Gn,Zt,br,Ze)}catch{}if(Gn>=2){const Ye=Array.from({length:Gn},()=>[]);if(br&&Qt.length>0)for(let on=0;on<Gn;on++){const ua=Qt[on%Qt.length],sa=Ye[on].some(wa=>Qt.includes(wa));Ye[on].length<Le&&!sa&&!Ye[on].includes(ua)&&Ye[on].push(ua)}if(Zt&&bt.length>0)for(let on=0;on<Gn;on++){const ua=bt[on%bt.length],sa=Ye[on].some(wa=>bt.includes(wa));Ye[on].length<Le&&!sa&&!Ye[on].includes(ua)&&Ye[on].push(ua)}const Tt=Ht.filter(on=>!Qt.includes(on)&&!bt.includes(on));if(Tt.length>0){let on=0;for(const ua of Tt){let sa=0;for(;sa<Gn&&Ye[on].length>=Le;)on=(on+1)%Gn,sa++;Ye[on].length<Le&&Ye[on].push(ua),on=(on+1)%Gn}}for(const on of cr){let ua=0,sa=1/0;for(let wa=0;wa<Ye.length;wa++)Ye[wa].length<sa&&Ye[wa].length<Le&&(sa=Ye[wa].length,ua=wa);Ye[ua].length<Le&&Ye[ua].push(on)}for(let on=0;on<Ye.length;on++)for(;Ye[on].length<Le;)if(br&&Qt.length>0){if(Ye[on].some(wa=>Qt.includes(wa)))break;const sa=Qt.find(wa=>!Ye[on].includes(wa));if(sa)Ye[on].push(sa);else break}else if(Zt&&bt.length>0){if(Ye[on].some(wa=>bt.includes(wa)))break;const sa=bt.find(wa=>!Ye[on].includes(wa));if(sa)Ye[on].push(sa);else break}else break;const Xt=Gn*Le,Br=Tn>Xt?[...Ht,...cr].slice(Xt):[];br&&Qt.length>0?Br.some(ua=>Qt.includes(ua))||Br.unshift(Qt[0]):Zt&&bt.length>0&&(Br.some(ua=>bt.includes(ua))||Br.unshift(bt[0]));try{const on=Ye.map(ua=>ua.length);console.log("[Teams] Final distribution teamSize=%s teams=%o reservas=%o",Le,on,Br)}catch{}const Wn=[];for(;Br.length>=Le;)Wn.push(Br.splice(0,Le));Ye.concat(Wn).forEach((on,ua)=>{const sa=Ae[ua%Ae.length];ke+=`

**${sa} Time ${ua+1} (${on.length})**:
${nn(on)}`}),Br.length&&(ke+=`

** Reservas (${Br.length})**:
${nn(Br)}`)}else{const Ye=[...Ht,...cr];if(Ye.length===0){l("No h participantes suficientes para formar times.");return}if(Ye.length===1)ke+=`

 Ainda no h jogadores suficientes para formar 2 times. Adicione mais participantes.`,ke+=`

** Time 1 (1)**:
1) ${Ye[0]}${Gt(Ye[0])}`;else{const Tt=Math.min(Le,Math.ceil(Ye.length/2)),Xt=Math.min(Le,Ye.length-Tt),Br=Ye.slice(0,Tt),Wn=Ye.slice(Tt,Tt+Xt);ke+=`

 Jogadores insuficientes para 2 equipes completas de ${Le}. Montei 2 times balanceados de ${Br.length} e ${Wn.length}.`,ke+=`

** Time 1 (${Br.length})**:
${nn(Br)}`,ke+=`

** Time 2 (${Wn.length})**:
${nn(Wn)}`}}const Pn=ke.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:ke,copyable:!0,copyText:Pn},600);const lr=[...!0?[{label:"Gerar novamente",value:"gerar_times_again",icon:""}]:[],{label:"Concluir",value:"aceitar_times",icon:""}];c("Tudo certo com os times?",lr,1400)}catch{l("No foi possvel gerar times agora. Tente novamente.")}},tt=async ze=>{if(ze.action==="menu"){d(" Menu");try{ue(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{q(!1)}catch{}g("identificacao"),setTimeout(()=>{ft()},400);return}if(ze.quadra){await Nt(ze);return}if(ze.date){await Wt(ze);return}if(ze.agendamento){const Fe=or(new Date(ze.agendamento.inicio),"dd/MM/yyyy",{locale:Da}),Le=or(new Date(ze.agendamento.inicio),"HH:mm"),Ze=or(new Date(ze.agendamento.fim),"HH:mm");d(`${Fe}  ${Le}-${Ze}`),await sr(ze.agendamento);return}switch(ze.value){case"novo_agendamento":{d(" Fazer Agendamento");try{ue(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{q(!1)}catch{}await _t();break}case"buscar_agendamento":{d(" Editar Agendamento"),l("Vou buscar seus agendamentos...",600),ut();break}case"finalizar_atendimento":{d(" Finalizar Atendimento");try{resetConversation()}catch{}l("Atendimento finalizado. Se precisar,  s me chamar de novo! ",400);break}case"corrigir_telefone":{d(" Informei o telefone errado"),m("cliente",null),m("identificacao_valor",null),k("telefone"),q(!0),g("identificacao");break}case"corrigir_email":{d(" Informei o e-mail errado"),m("cliente",null),m("identificacao_valor",null),k("email"),q(!0),g("identificacao");break}case"continuar_fluxo":{ft();break}case"gerar_times":case"gerar_times_again":{d(ze.value==="gerar_times_again"?" Gerar novamente":" Gerar Times"),await Me();break}case"aceitar_times":{d(" Concluir"),l("Beleza! O que voc gostaria de fazer agora?",400),setTimeout(()=>{ft()},800);break}case"confirm":const Fe=!!i?.editing_agendamento||!!V;d(Fe?" Salvar Alteraes":" Confirmar Agendamento"),Fe?await qr():await Tr();break;case"criar agendamento":d(" Confirmar Agendamento"),await Tr();break;case"edit_quadra":d(" Editar Quadra");const Ze=A.map(cr=>({label:cr.nome,value:cr.id,icon:"",subtitle:cr.descricao||cr.tipo||null,quadra:cr}));c("Qual quadra voc quer?",Ze,600);break;case"edit_data":d(" Editar Data");const Ot=new Date,mt=Ss(Ot,1),Qt=[{label:`Hoje (${or(Ot,"dd/MM")})`,value:or(Ot,"yyyy-MM-dd"),icon:"",date:Ot},{label:`Amanh (${or(mt,"dd/MM")})`,value:or(mt,"yyyy-MM-dd"),icon:"",date:mt},{label:"Outro dia...",value:"custom",icon:""}];c("Para qual dia?",Qt,600),g("data");break;case"edit_horario":d(" Editar Horrio e Esporte"),q(!1),F("horario"),v(!0);const bt=await _r(i.quadra.id,i.data,V?.id);if(v(!1),bt.fechada){const cr=or(i.data,"dd/MM/yyyy",{locale:Da}),nn=or(i.data,"EEEE",{locale:Da});if(bt.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${cr}** (${nn}). 

**Motivo:** ${bt.observacao}`,800);else if(bt.motivo==="dia_semana"){const Tn=or(i.data,"EEEE",{locale:Da});l(`**Ops!** A quadra no funciona ${Tn==="domingo"||Tn==="sbado"?"aos":"s"} **${Tn}s**. `,800)}setTimeout(()=>{l("No  possvel editar o horrio. Escolha **outra data** ou **quadra**:",1200),setTimeout(()=>{dt()},400)},1600);return}const zt=bt.slots;if(zt&&zt.length>0){const cr=yr(zt);let nn="";cr.length===1?nn=`Tenho **horrios livres** das **${cr[0].inicio}** s **${cr[0].fim}**! `:nn=`Tenho **horrios livres** ${cr.map((Gn,ta)=>ta===cr.length-1?`e das **${Gn.inicio}** s **${Gn.fim}**`:ta===0?`das **${Gn.inicio}** s **${Gn.fim}**`:`das **${Gn.inicio}** s **${Gn.fim}**`).join(", ")}! `,l(nn,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else l("Ops! No encontrei **horrios disponveis**. ");break;case"edit_participantes":d(" Editar Participantes"),q(!1),F("participantes"),l("Edite a lista de participantes:",600),setTimeout(()=>{q(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200)},800);break;case"finalizar":d(" Finalizar Atendimento");const ne=["Pronto! Seu agendamento est confirmado! ","Perfeito! Agendamento realizado com sucesso! ","Tudo certo! Seu horrio est garantido! ","Sucesso! Agendamento confirmado! "],He=ne[Math.floor(Math.random()*ne.length)];l(He,800),setTimeout(()=>{xr()},1400);break;case"cancelar_agendamento":d(" Cancelar Agendamento");const Gt=[{label:"Sim, cancelar",value:"confirmar_cancelamento",icon:""},{label:"No, voltar",value:"voltar_cancelamento",icon:""}],Ht=["Tem certeza que deseja cancelar este agendamento?","Confirma o cancelamento do agendamento?","Realmente quer cancelar? Esta ao no pode ser desfeita.","Deseja mesmo cancelar este agendamento?"],Fr=Ht[Math.floor(Math.random()*Ht.length)];c(Fr,Gt,600);break;case"confirmar_cancelamento":await Sr();break;case"voltar_cancelamento":d(" Voltar"),l("Ok! Voltando ao resumo do agendamento.",400),setTimeout(()=>{Rt(null,null,!0,null,null,null,V)},800);break;case"editar_agendamento":d(" Editar Agendamento"),l("Claro! O que voc gostaria de alterar?",600),setTimeout(()=>{Rt(null,null,!0)},800);break;case"novo_agendamento":d(" Fazer Agendamento"),_t();break;case"buscar_agendamento":d(" Editar Agendamento"),l("Vou buscar seus agendamentos...",600),ut();break;case"finalizar_atendimento":d(" Finalizar Atendimento"),xr();break;default:console.warn("[Isis] Ao no reconhecida:",ze.value)}},ut=async()=>{try{console.log("[buscarAgendamentosCliente] Iniciando busca de agendamentos...");const{data:ze,error:Fe}=await Q.from("agendamentos").select(`
          id,
          codigo,
          inicio,
          fim,
          modalidade,
          status,
          valor_total,
          quadras!inner(nome, descricao, valor)
        `).eq("codigo_empresa",n).eq("cliente_id",i.cliente.id).in("status",["scheduled","confirmed"]).gte("inicio",new Date().toISOString()).order("inicio",{ascending:!0});if(Fe)throw Fe;if(!ze||ze.length===0){l("No encontrei agendamentos futuros para voc. ",800),l("Que tal fazer um novo agendamento? ",1400),setTimeout(()=>{_t()},2e3);return}if(ze.length===1){const Le=ze[0],Ze=or(new Date(Le.inicio),"dd/MM/yyyy",{locale:Da}),Ot=or(new Date(Le.inicio),"HH:mm"),mt=or(new Date(Le.fim),"HH:mm");l(`Encontrei seu agendamento para ${Ze} das ${Ot} s ${mt} - ${Le.modalidade}! `,800),setTimeout(()=>{sr(Le)},1200)}else{l(`Encontrei ${ze.length} agendamentos futuros! Qual voc quer editar?`,800);const Le=ze.map(Ze=>{const Ot=new Date(Ze.inicio),mt=or(Ot,"dd/MM/yyyy",{locale:Da}),Qt=or(Ot,"EEEE",{locale:Da}),bt=or(Ot,"HH:mm"),zt=or(new Date(Ze.fim),"HH:mm"),ne=(new Date(Ze.fim)-Ot)/(1e3*60),He=Math.floor(ne/60),Gt=ne%60;let Ht="";He>0?Ht=Gt>0?`${He}h${Gt}m`:`${He}h`:Ht=`${Gt}m`;const Fr=Number(Ze.quadras?.valor??0),cr=ne/30,Tn=(Math.round(Fr*cr*100)/100).toFixed(2).replace(".",","),Gn=new Date,ta=new Date(Gn);ta.setDate(Gn.getDate()+1);let Aa="";return Ot.toDateString()===Gn.toDateString()?Aa="Hoje":Ot.toDateString()===ta.toDateString()?Aa="Amanh":Aa=`${Qt.charAt(0).toUpperCase()+Qt.slice(1)}, ${mt}`,{label:`${Aa}  ${bt}-${zt}`,value:`editar_agendamento_${Ze.id}`,icon:"",subtitle:`${Ze.quadras?.nome||"Quadra"}  ${Ze.modalidade||""}  ${Ht}`,agendamento:Ze}});setTimeout(()=>{c("Escolha o agendamento:",Le,600)},1200)}}catch(ze){console.error("[Isis] Erro ao buscar agendamentos:",ze),l("Ops! Tive um problema ao buscar seus agendamentos. ",800),l("Que tal tentar fazer um novo agendamento?",1400),setTimeout(()=>{_t()},2e3)}},sr=async ze=>{try{console.log("[carregarAgendamentoParaEdicao] Iniciando carregamento do agendamento:",ze.id),console.debug("[carregarAgendamentoParaEdicao] Iniciando JOIN: agendamentos  quadras, agendamento_participantes");const{data:Fe,error:Le}=await Q.from("agendamentos").select(`
          *,
          quadras(id, nome, descricao, modalidades, valor),
          agendamento_participantes(nome, cliente_id, ordem, is_representante)
        `).eq("id",ze.id).single();if(console.debug("[carregarAgendamentoParaEdicao] Resultado JOIN:",{hasError:!!Le,error:Le?.message,code:Le?.code,participantes_len:Array.isArray(Fe?.agendamento_participantes)?Fe.agendamento_participantes.length:null}),Le)throw console.error("[Isis] Erro ao buscar agendamento:",Le),new Error(`Agendamento no encontrado ou inacessvel: ${Le.message}`);if(!Fe)throw new Error("Agendamento no encontrado");const Ze=new Date(Fe.inicio),Ot=or(Ze,"HH:mm"),mt=or(new Date(Fe.fim),"HH:mm");let Qt=Fe.quadras||null;if(!Qt)try{const{data:Ht}=await Q.from("quadras").select("id, nome, descricao, modalidades, valor").eq("id",Fe.quadra_id).single();Qt=Ht||null}catch{}m("quadra",Qt),m("data",Ze),m("horario",{inicio:Ot,fim:mt,inicioDate:new Date(Fe.inicio),fimDate:new Date(Fe.fim)}),m("esporte",Fe.modalidade);const bt=Fe.cliente_id||i.cliente?.id||null;let zt=Fe.agendamento_participantes||[];if(!zt||zt.length===0)try{console.debug("[carregarAgendamentoParaEdicao] JOIN sem participantes. Fazendo SELECT direto em agendamento_participantes...");const{data:Ht,error:Fr}=await Q.from("agendamento_participantes").select("nome, cliente_id, codigo_empresa, ordem, is_representante").eq("agendamento_id",ze.id).order("ordem",{ascending:!0});console.debug("[carregarAgendamentoParaEdicao] SELECT direto participantes:",{hasError:!!Fr,error:Fr?.message,code:Fr?.code,count:Array.isArray(Ht)?Ht.length:null}),Array.isArray(Ht)&&Ht.length>0&&(zt=Ht.map(cr=>({nome:cr.nome,cliente_id:cr.cliente_id,ordem:cr.ordem,is_representante:cr.is_representante})))}catch(Ht){console.debug("[carregarAgendamentoParaEdicao] Falha no SELECT direto participantes:",Ht?.message||Ht)}const ne=[...zt].sort((Ht,Fr)=>{const cr=Number(Ht?.ordem??0),nn=Number(Fr?.ordem??0);return Number.isFinite(cr)&&Number.isFinite(nn)&&cr!==nn?cr-nn:0}),He=(()=>{const Ht=ne.findIndex(Fr=>!!Fr?.is_representante);if(Ht>=0)return Ht;if(bt){const Fr=ne.findIndex(cr=>cr?.cliente_id===bt);if(Fr>=0)return Fr}return 0})(),Gt=ne.map((Ht,Fr)=>({nome:Ht.nome,cliente_id:Ht.cliente_id,principal:Fr===He}));m("participantes",Gt);try{m("editing_agendamento",!0)}catch{}try{const Ht=Fe?.meta_roles||null;if(Ht&&typeof Ht=="object"){const Fr=Array.isArray(Ht.levantadores)?Ht.levantadores:[],cr=Array.isArray(Ht.goleiros)?Ht.goleiros:[],nn=Array.isArray(Ht.fixos)?Ht.fixos:Array.from(new Set([...Fr,...cr])),Tn=Ht.fixoRoles&&typeof Ht.fixoRoles=="object"?Ht.fixoRoles:{};m("levantadores",Fr),m("goleiros",cr),m("fixos",nn),m("fixoRoles",Tn)}else{const Fr=`f7a:fixos:${Fe.id}`,cr=JSON.parse(localStorage.getItem(Fr)||"null");if(cr&&typeof cr=="object"){const nn=Array.isArray(cr.levantadores)?cr.levantadores:[],Tn=Array.isArray(cr.goleiros)?cr.goleiros:[],Gn=Array.isArray(cr.fixos)?cr.fixos:Array.from(new Set([...nn,...Tn])),ta=cr.fixoRoles&&typeof cr.fixoRoles=="object"?cr.fixoRoles:{};m("levantadores",nn),m("goleiros",Tn),m("fixos",Gn),m("fixoRoles",ta)}}}catch{}ue(Fe),l("Perfeito! Aqui esto os detalhes do seu agendamento:",600),setTimeout(()=>{const Ht={inicio:Ot,fim:mt,inicioDate:new Date(Fe.inicio),fimDate:new Date(Fe.fim)};Qt?(Rt(Ht,Fe.modalidade,!0,Qt,Ze,Gt,Fe),g("review")):(l("No consegui carregar os dados da quadra deste agendamento. Vamos escolher a quadra novamente?",800),setTimeout(()=>{const Fr=A.map(cr=>({label:cr.nome,value:cr.id,icon:"",subtitle:cr.descricao||cr.tipo||null,quadra:cr}));c("Qual quadra voc quer?",Fr,600)},1200))},1400)}catch(Fe){console.error("[Isis] Erro ao carregar agendamento:",Fe),Fe.message.includes("no encontrado")?(l("Ops! Este agendamento no foi encontrado ou pode ter sido cancelado. ",800),l("Vou buscar seus agendamentos atualizados...",1400),setTimeout(()=>{ut()},2e3)):(l("Ops! Tive um problema ao carregar o agendamento. ",800),l("Que tal tentar fazer um novo agendamento?",1400),setTimeout(()=>{_t()},2e3))}},Sr=async()=>{if(!V){console.error("[Isis] Nenhum agendamento para cancelar");return}try{console.groupCollapsed("[Isis][Cancel] start"),console.log("[Isis][Cancel] agendamentoCriado:",{id:V?.id,inicio:V?.inicio,fim:V?.fim,status:V?.status,codigo_empresa:V?.codigo_empresa,empresa_id:V?.empresa_id,cliente_id:V?.cliente_id}),console.log("[Isis][Cancel] empresa:",{id:_?.id,codigo_empresa:_?.codigo_empresa,nome_fantasia:_?.nome_fantasia,razao_social:_?.razao_social,isis_display_name:_?.isis_display_name,isis_cancel_min_hours_before:_?.isis_cancel_min_hours_before,telefone:_?.telefone}),console.groupEnd(),v(!0);let Fe=_?.isis_cancel_min_hours_before;if(Fe==null)try{const bt=(()=>{try{return decodeURIComponent(r||"")}catch{return String(r||"")}})(),zt=String(bt).toLowerCase().replace(/[\s\-_]+/g,"").trim();console.log("[Isis][Cancel] minHours missing. Trying RPC fallback with slug:",{slugRaw:bt,slugNorm:zt});try{const{data:ne,error:He}=await Q.rpc("get_empresa_public_by_isis_subdomain",{p_subdomain:zt});if(console.log("[Isis][Cancel] rpc:get_empresa_public_by_isis_subdomain:",{hasError:!!He,error:He?.message,code:He?.code,len:Array.isArray(ne)?ne.length:null}),!He&&Array.isArray(ne)&&ne[0]){const Gt=ne[0]?.isis_cancel_min_hours_before;Gt!=null&&(Fe=Gt)}}catch(ne){console.log("[Isis][Cancel] rpc subdomain threw:",ne?.message||ne)}if(Fe==null)try{const{data:ne,error:He}=await Q.rpc("get_empresa_public_by_slug",{p_slug:zt});if(console.log("[Isis][Cancel] rpc:get_empresa_public_by_slug:",{hasError:!!He,error:He?.message,code:He?.code,len:Array.isArray(ne)?ne.length:null}),!He&&Array.isArray(ne)&&ne[0]){const Gt=ne[0]?.isis_cancel_min_hours_before;Gt!=null&&(Fe=Gt)}}catch(ne){console.log("[Isis][Cancel] rpc slug threw:",ne?.message||ne)}}catch(bt){console.log("[Isis][Cancel] fallback unexpected error:",bt?.message||bt)}if(console.log("[Isis][Cancel] minHours(raw):",Fe,"type:",typeof Fe),Fe!=null){const bt=new Date(V.inicio),zt=new Date,ne=bt-zt,He=ne/(1e3*60*60);if(console.log("[Isis][Cancel] timing:",{agendamentoInicio:bt?.toISOString?.()||String(bt),agora:zt?.toISOString?.()||String(zt),diffMs:ne,diffHours:He}),He<Fe){console.warn("[Isis][Cancel] BLOCKED by minHours rule:",{diffHours:He,minHours:Fe}),v(!1);const Gt=_?.telefone||"a arena",Ht=_?.isis_display_name||_?.nome_fantasia||_?.razao_social||"a arena",Fr=[` Ops! S  possvel cancelar com ${Fe} hora${Fe>1?"s":""} de antecedncia. Este agendamento est muito prximo.`,` Desculpe! O cancelamento s pode ser feito com ${Fe} hora${Fe>1?"s":""} de antecedncia. Seu agendamento j est prximo demais.`],nn=`${Fr[Math.floor(Math.random()*Fr.length)]}

 Para mais informaes ou cancelamento de ltima hora, entre em contato diretamente com a ${Ht}: ${Gt}`;l(nn,600),setTimeout(()=>{l("O que voc gostaria de fazer agora?",800),setTimeout(()=>{ft()},1200)},1200);return}}const Le={status:"canceled",canceled_by:"isis",canceled_at:new Date().toISOString()};console.log("[Isis][Cancel] proceeding to cancel. update payload:",Le);const{data:Ze,error:Ot}=await Q.from("agendamentos").update(Le).eq("id",V.id);if(console.log("[Isis][Cancel] supabase update result:",{hasError:!!Ot,error:Ot?.message,code:Ot?.code,data:Ze}),Ot)throw Ot;v(!1);const mt=[" Agendamento cancelado com sucesso!"," Pronto! Seu agendamento foi cancelado."," Cancelamento realizado! Agendamento removido."," Feito! O agendamento foi cancelado com sucesso."],Qt=mt[Math.floor(Math.random()*mt.length)];l(Qt,600),ue(null),setTimeout(()=>{l("O que voc gostaria de fazer agora?",800),setTimeout(()=>{ft()},1200)},1200)}catch(ze){console.error("[Isis] Erro ao cancelar agendamento:",ze),v(!1);const Fe=iv("error");l(Fe)}},xr=()=>{u();const ze=["Antes de finalizar, que tal me dar uma avaliao? ","Para finalizar, gostaria que avaliasse nosso atendimento! ","Quase pronto! Me ajuda com uma avaliao rpida? ","ltima etapa! Como foi nosso atendimento hoje? ","Para encerrar, que nota voc daria para nosso atendimento? ","Ei, que tal me contar como foi a experincia? ","Curiosa para saber: como voc avalia nosso atendimento? ","Rapidinho aqui: o que achou do nosso servio? ","Me conta a, como foi para voc hoje? ","Sua opinio  super importante! Como foi tudo? ","Sua avaliao nos ajuda a melhorar! Como foi? ","Para continuarmos evoluindo, como voc nos avalia? ","Queremos sempre melhorar! Que nota voc daria? ","Seu feedback  ouro para ns! Como foi o atendimento? ","Ajude-nos a ser ainda melhores! Qual sua avaliao? ","Espero ter te ajudado bem! Como voc me avalia? ","Fiz um bom trabalho hoje? Me conta sua opinio! ","Consegui resolver tudo certinho? Que tal uma avaliao? ","Antes de voc ir, me diz como foi nossa conversa? ","Sua experincia foi boa? Adoraria saber! ","Obrigada pela confiana! Como foi para voc? ","Foi um prazer te atender! Que nota voc daria? ","Agradeo pela pacincia! Como avalia nosso servio? ","Muito obrigada! Me conta como foi tudo? ","Pode ser sincero(a)! Como foi o atendimento? ","Sem papas na lngua: que nota voc daria? ","Honestamente, como voc nos avalia? ","Sua opinio real  importante! Como foi? ","Para finalizar o atendimento, preciso da sua avaliao! ","Processo quase concludo! Falta s sua avaliao! ","ltima etapa do nosso protocolo: sua opinio! ","Para encerrar com chave de ouro: como nos avalia? "],Fe=ze[Math.floor(Math.random()*ze.length)];l(Fe,800),setTimeout(()=>{q(!0),g("avaliacao"),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1200)},Wr=async ze=>{try{const Fe=Array.isArray(j)?[...j]:[],Le=`${ze.rating} estrela${ze.rating>1?"s":""}`,Ze=ze.comentario?` ${Le}
 "${ze.comentario}"`:` ${Le}`;d(Ze),q(!1),v(!0);const Ot=Fe.map(He=>({ts:He.timestamp instanceof Date?He.timestamp.toISOString():new Date(He.timestamp||Date.now()).toISOString(),from:He.from==="isis"?"assistant":"user",text:String(He.text??"")}));let mt=-1;for(let He=Ot.length-1;He>=0;He--)if(Ot[He].from==="assistant"){mt=He;break}const Qt=mt>=0?Ot.slice(0,mt+1):Ot;await Plt({rating:Number(ze.rating),comentario:ze.comentario||null,cliente_codigo:i?.cliente?.codigo??null,cliente_nome:i?.cliente?.nome||i?.cliente?.name||null,empresa_nome:_?.nome_fantasia||_?.razao_social||"Desconhecida",sessionId:w,conversaArray:Qt}),v(!1);const bt=new Date().getHours();let zt;bt>=5&&bt<12?zt="Tenha um timo dia! ":bt>=12&&bt<18?zt="Tenha uma tima tarde! ":bt>=18&&bt<22?zt="Tenha uma tima noite! ":zt="Tenha uma boa noite! ";let ne;if(ze.rating>=4){const He=[` **Muito obrigada pela avaliao!** A **${Y}** agradece imensamente! Foi um prazer te atender! ${zt}`,` **Que bom que gostou!** A **${Y}** fica muito feliz! Volte sempre! ${zt}`,` **Perfeito!** A **${Y}** agradece de corao! Espero ter ajudado! ${zt}`,` **Adorei seu feedback!** A **${Y}** est muito grata! Nos vemos em breve! ${zt}`,` **Excelente!** A **${Y}** agradece pela confiana! At a prxima! ${zt}`,` **Uau, que nota incrvel!** A **${Y}** est nas nuvens! Obrigada! ${zt}`,` **Voc  demais!** A **${Y}** adora clientes como voc! ${zt}`,` **Top demais!** A **${Y}** se sente campe com seu feedback! ${zt}`,` **Que alegria!** A **${Y}** fica radiante com sua avaliao! ${zt}`,` **Sensacional!** A **${Y}** est celebrando sua nota! ${zt}`,` **Amei sua avaliao!** Fico feliz em saber que te atendi bem! A **${Y}** agradece! ${zt}`,` **Que feedback maravilhoso!** Me deixou super feliz! A **${Y}**  grata! ${zt}`,` **Seu carinho me emociona!** A **${Y}** tem sorte de ter voc! ${zt}`,` **Voc iluminou meu dia!** A **${Y}** agradece de todo corao! ${zt}`,` **Nota mxima!** A **${Y}** te espera sempre de braos abertos! ${zt}`,` **Cliente 5 estrelas!** A **${Y}** adora te ter aqui! Volte logo! ${zt}`,` **Voc  especial!** A **${Y}** sempre ter um lugar especial para voc! ${zt}`,` **Show de avaliao!** A **${Y}** te aguarda para a prxima apresentao! ${zt}`];ne=He[Math.floor(Math.random()*He.length)]}else if(ze.rating===3){const He=[` **Obrigada pelo feedback!** A **${Y}** vai melhorar ainda mais! ${zt}`,` **Agradecemos sua avaliao!** A **${Y}** est trabalhando para evoluir! ${zt}`,` **Obrigada!** A **${Y}** valoriza seu retorno! Foi um prazer te atender! ${zt}`,` **Toda avaliao nos faz crescer!** A **${Y}** agradece sua sinceridade! ${zt}`,` **Feedback valioso!** A **${Y}** usa cada retorno para evoluir! ${zt}`,` **Obrigada pela nota!** A **${Y}** est sempre buscando melhorar! ${zt}`,` **Seu retorno  importante!** A **${Y}** vai usar para aprimorar nosso servio! ${zt}`,` **Agradecemos a oportunidade!** A **${Y}** espera te surpreender na prxima! ${zt}`,` **Obrigada pela dica!** A **${Y}** vai trabalhar para te conquistar! ${zt}`,` **Toda crtica construtiva  bem-vinda!** A **${Y}** agradece! ${zt}`];ne=He[Math.floor(Math.random()*He.length)]}else{const He=[` **Obrigada pela sinceridade.** A **${Y}** vai trabalhar para melhorar! ${zt}`,` **Agradecemos seu feedback.** A **${Y}** est comprometida em evoluir! ${zt}`,` **Obrigada por compartilhar.** A **${Y}** vai usar seu retorno para melhorar! ${zt}`,` **Lamentamos no ter atendido suas expectativas.** A **${Y}** vai se esforar mais! ${zt}`,` **Sentimos muito pela experincia.** A **${Y}** levar isso muito a srio! ${zt}`,` **Assumimos a responsabilidade.** A **${Y}** vai fazer melhor da prxima vez! ${zt}`,` **Sua insatisfao nos preocupa.** A **${Y}** vai revisar todos os processos! ${zt}`,` **Obrigada pelo alerta!** A **${Y}** espera uma nova chance de te impressionar! ${zt}`,` **Vamos melhorar!** A **${Y}** promete que da prxima vez ser diferente! ${zt}`,` **Seu feedback  nosso combustvel!** A **${Y}** vai usar para crescer! ${zt}`,` **J estamos trabalhando nas melhorias!** A **${Y}** agradece sua pacincia! ${zt}`,` **Sua honestidade  valiosa!** A **${Y}** prefere a verdade para evoluir! ${zt}`,` **Crticas nos fazem crescer!** A **${Y}** agradece sua coragem de falar! ${zt}`];ne=He[Math.floor(Math.random()*He.length)]}l(ne,600),setTimeout(()=>{l("Atendimento finalizado.",0,"system")},1200)}catch(Fe){console.error("[Isis] Erro ao enviar avaliao:",Fe),v(!1);const Le=new Date().getHours();let Ze;Le>=5&&Le<12?Ze="Tenha um timo dia! ":Le>=12&&Le<18?Ze="Tenha uma tima tarde! ":Le>=18&&Le<22?Ze="Tenha uma tima noite! ":Ze="Tenha uma boa noite! ";const Ot=[`Ops! Tive um problema ao salvar sua avaliao, mas a **${Y}** agradece muito seu feedback! ${Ze}`,` No consegui salvar sua avaliao, mas a **${Y}** agradece imensamente! ${Ze}`,` Deu uma travadinha aqui, mas sua opinio j ficou guardada no meu corao! A **${Y}** agradece! ${Ze}`,` Ops, falhei na tecnologia, mas no falhei em te ouvir! A **${Y}** valoriza seu feedback! ${Ze}`,` Parece que o sistema deu soluo, mas sua avaliao foi ouvida! A **${Y}** agradece! ${Ze}`,` A internet no colaborou, mas sua opinio chegou at mim! A **${Y}**  grata! ${Ze}`,` Problema tcnico aqui, mas o importante  que voc compartilhou! A **${Y}** agradece! ${Ze}`,` O sistema travou, mas sua avaliao no passou despercebida! A **${Y}** valoriza! ${Ze}`],mt=Ot[Math.floor(Math.random()*Ot.length)];l(mt,600),setTimeout(()=>{l("Atendimento finalizado.",0,"system")},1200)}},qr=async()=>{if(!V){console.error("[Isis] Nenhum agendamento para atualizar");return}try{v(!0);const ze=i.cliente,Fe=i.participantes||[],{data:Le}=await Q.from("clientes").select("id").eq("codigo_empresa",n).eq("is_consumidor_final",!0).single(),Ze=Fe.find(et=>et.principal),Ot=Fe.filter(et=>!et.principal),mt=Ze?[Ze,...Ot]:Fe,Qt=mt.map(et=>et.nome),bt=Ze?.cliente_id||ze?.id||null,[zt,ne]=i.horario.inicio.split(":").map(Number),[He,Gt]=i.horario.fim.split(":").map(Number);let Ht=He*60+Gt-(zt*60+ne);He===0&&Gt===0&&(Ht=24*60-(zt*60+ne));const Fr=i.quadra.valor||0,cr=Ht/30,nn=Math.round(Fr*cr*100)/100,Tn={levantadores:Array.isArray(i.levantadores)?i.levantadores:[],goleiros:Array.isArray(i.goleiros)?i.goleiros:[],fixos:Array.isArray(i.fixos)?i.fixos:[],fixoRoles:i.fixoRoles&&typeof i.fixoRoles=="object"?i.fixoRoles:{}},{data:Gn,error:ta}=await Q.from("agendamentos").update({quadra_id:i.quadra.id,cliente_id:bt,clientes:Qt,inicio:i.horario.inicioDate.toISOString(),fim:i.horario.fimDate.toISOString(),modalidade:i.esporte,valor_total:nn,meta_roles:Tn}).eq("id",V.id).select().single();if(ta)throw ta;const{error:Aa}=await Q.from("agendamento_participantes").delete().eq("agendamento_id",V.id);if(Aa)throw Aa;const ke=mt.map((et,br)=>({agendamento_id:Gn.id,codigo_empresa:n,cliente_id:et.cliente_id||(et.principal?ze.id:Le?.id||null),nome:et.nome,valor_cota:0,status_pagamento:"Pendente",ordem:br+1,is_representante:br===0})),{error:Ae}=await Q.from("agendamento_participantes").insert(ke);if(Ae)throw Ae;v(!1),ue(Gn);try{const et=`f7a:fixos:${Gn.id}`,br={levantadores:i.levantadores||[],goleiros:i.goleiros||[],fixos:i.fixos||[],fixoRoles:i.fixoRoles||{}};localStorage.setItem(et,JSON.stringify(br))}catch{}Rr(Gn,!0),g("confirmation")}catch(ze){console.error("[Isis] Erro ao atualizar agendamento:",ze),v(!1);const Fe=iv("error");l(Fe)}},Tr=async()=>{try{v(!0);const ze=await at();if(!ze?.ok)throw new Error("No foi possvel validar disponibilidade do horrio");if(ze?.conflito){v(!1),q(!1);try{m("horario",null)}catch{}try{m("esporte",null)}catch{}try{F(null)}catch{}ze?.motivo==="fechada"?l(`**Ops!** Parece que este dia ficou **indisponvel** agora. 

Vamos escolher outra data?`,800):l(`**Ops!** Algum acabou de reservar esse horrio antes de voc. 

Vamos escolher outra data?`,800),setTimeout(()=>{dt()},900);return}const Fe=i.cliente,Le=i.participantes||[],{data:Ze}=await Q.from("clientes").select("id").eq("codigo_empresa",n).eq("is_consumidor_final",!0).single(),Ot=Le.find(Ct=>Ct.principal),mt=Le.filter(Ct=>!Ct.principal),Qt=Ot?[Ot,...mt]:Le,bt=Qt.map(Ct=>Ct.nome),zt=Ot?.cliente_id||Fe?.id||null,[ne,He]=i.horario.inicio.split(":").map(Number),[Gt,Ht]=i.horario.fim.split(":").map(Number);let Fr=Gt*60+Ht-(ne*60+He);Gt===0&&Ht===0&&(Fr=24*60-(ne*60+He));const cr=i.quadra.valor||0,nn=Fr/30,Tn=Math.round(cr*nn*100)/100,Gn={levantadores:Array.isArray(i.levantadores)?i.levantadores:[],goleiros:Array.isArray(i.goleiros)?i.goleiros:[],fixos:Array.isArray(i.fixos)?i.fixos:[],fixoRoles:i.fixoRoles&&typeof i.fixoRoles=="object"?i.fixoRoles:{}};let ta=null;try{const Ct=String(w||"").trim();/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(Ct)&&(ta=Ct)}catch{}const{data:Aa}=await Q.from("agendamentos").select("codigo").eq("codigo_empresa",n).order("codigo",{ascending:!1}).limit(1).single();let ke=Aa?Aa.codigo+1:1;console.log("[criarAgendamento] ltimo cdigo usado:",Aa?.codigo),console.log("[criarAgendamento] Prximo cdigo inicial:",ke);let Ae,et=0;const br=10;for(;!Ae&&et<br;){et++,console.log("[criarAgendamento] Tentativa",et,"com cdigo:",ke);const Ct={codigo:ke,codigo_empresa:n,quadra_id:i.quadra.id,cliente_id:zt,clientes:bt,inicio:i.horario.inicioDate.toISOString(),fim:i.horario.fimDate.toISOString(),modalidade:i.esporte,status:"scheduled",valor_total:Tn,meta_roles:Gn,created_by_isis:!0};if(ta)try{const{data:Tt}=await Q.from("isis_chat_sessions").select("id").eq("id",ta).single();Tt?.id&&(Ct.isis_session_id=ta)}catch{}const{data:lr,error:Ye}=await Q.from("agendamentos").insert(Ct).select("id, codigo").single();if(Ye)if(Ye.code==="23505")console.log("[criarAgendamento] Cdigo",ke,"j existe, tentando prximo..."),ke++;else throw Ye;else Ae=lr,console.log("[criarAgendamento] Agendamento criado com cdigo:",Ae.codigo)}if(!Ae)throw new Error("No foi possvel gerar um cdigo nico aps "+br+" tentativas");try{const{data:Ct}=await Q.from("empresas").select("id").eq("codigo_empresa",n).single();Ct&&(await Q.from("empresa_counters").update({next_agendamento_codigo:Ae.codigo+1}).eq("empresa_id",Ct.id),console.log("[criarAgendamento] Counter atualizado para:",Ae.codigo+1))}catch(Ct){console.warn("[criarAgendamento] Erro ao atualizar counter:",Ct)}const Zt=Qt.map((Ct,lr)=>({codigo_empresa:n,agendamento_id:Ae.id,cliente_id:Ct.cliente_id||(Ct.principal?Fe.id:Ze?.id||null),nome:Ct.nome,valor_cota:0,status_pagamento:"Pendente",ordem:lr+1,is_representante:lr===0})),{error:Pn}=await Q.from("agendamento_participantes").insert(Zt);if(Pn)throw Pn;v(!1),ue(Ae);try{const Ct=`f7a:fixos:${Ae.id}`,lr={levantadores:i.levantadores||[],goleiros:i.goleiros||[],fixos:i.fixos||[],fixoRoles:i.fixoRoles||{}};localStorage.setItem(Ct,JSON.stringify(lr))}catch{}Rr(Ae),g("confirmation")}catch(ze){console.error("[Isis] Erro ao criar agendamento:",ze),v(!1);const Fe=iv("error");l(Fe),D_({title:"Erro ao criar agendamento",description:ze.message||"Tente novamente",variant:"destructive"})}},sn=(ze,Fe)=>{if(u(),Fe)try{h(Fe)}catch{}switch(o){case"quadra":Nt(ze);break;case"data":{if((ze?.value||"").toString()==="mudar_quadra"){try{q(!1);const Ze=(A||[]).map(Ot=>({label:Ot.nome,value:Ot.id,icon:"",subtitle:Ot.descricao||Ot.tipo||null,quadra:Ot}));Ze.length>0&&(c("Qual quadra voc quer?",Ze,400),g("quadra"))}catch{}break}Wt(ze)}break;case"identificacao":tt(ze);break;case"review":tt(ze);break;case"confirmation":tt(ze);break;case"confirmar_cliente_existente":{const Le=(ze?.value||"").toString();if(Le==="confirm_cliente_existente"){const Ze=i?.cliente_sugerido||null;if(Ze){m("cliente",Ze),m("cliente_sugerido",null);const Ot=Te(Ze.nome||"");l(`Perfeito, **${Ot}**! `,300),q(!1),setTimeout(()=>{try{ft()}catch{}},700)}else q(!0),g("identificacao")}else Le==="corrigir_cadastro"&&(l("Sem problemas! Vamos corrigir seus dados. ",300),q(!0),g("cadastro"));break}default:console.warn("[Isis] Nenhum handler para step:",o)}},Cn=()=>$?o==="participantes"||o==="review"&&$&&z==="participantes"?a.jsx(_lt,{participantesAtuais:i.participantes||[],onAdicionar:qt,onRemover:De,onFinalizar:wt,onAdicionarLote:$t,selfName:i.cliente?.nome,initialModalidade:i.esporte||"",modalidadeOptions:Array.isArray(i.quadra?.modalidades)&&i.quadra.modalidades.length>0?i.quadra.modalidades:i.esporte?[i.esporte]:[],onFixedRolesDetected:ze=>{try{const Fe=Array.isArray(ze?.levantadores)?ze.levantadores:[],Le=Array.isArray(ze?.goleiros)?ze.goleiros:[],Ze=Qt=>String(Qt||"").trim().toLowerCase(),Ot=Array.from(new Set([...Fe,...Le])),mt={};Fe.forEach(Qt=>{mt[Ze(Qt)]="Levantador"}),Le.forEach(Qt=>{mt[Ze(Qt)]="Goleiro"}),m("levantadores",Fe),m("goleiros",Le),m("fixos",Ot),m("fixoRoles",mt),V?.id&&(async()=>{try{const Qt={levantadores:Fe,goleiros:Le,fixos:Ot,fixoRoles:mt};await Q.from("agendamentos").update({meta_roles:Qt}).eq("id",V.id)}catch(Qt){console.debug("[Isis] Falha ao persistir meta_roles imediatos:",Qt?.message||Qt)}})()}catch{}}}):o==="identificacao"||T==="data_custom"?a.jsx(wlt,{tipo:T,onSubmit:ie,onTrocarTipo:()=>{k(T==="telefone"?"email":"telefone")}}):o==="cadastro"?a.jsx(jlt,{onSubmit:xt,valorInicial:i.identificacao_valor,tipoInicial:i.identificacao_tipo||"telefone",onCorrigirTelefone:()=>{try{l("Sem problemas! Informe seu telefone novamente:",400)}catch{}m("cliente",null),m("identificacao_valor",null),k("telefone"),g("identificacao"),q(!0)},onCorrigirEmail:()=>{try{l("Sem problemas! Informe seu e-mail novamente:",400)}catch{}m("cliente",null),m("identificacao_valor",null),k("email"),g("identificacao"),q(!0)}}):o==="horario"||o==="review"&&$&&z==="horario"?a.jsx(blt,{onSubmit:ve,onMudarData:St,onMudarQuadra:()=>{try{q(!1),F("horario"),g("review");const ze=(A||[]).map(Fe=>({label:Fe.nome,value:Fe.id,icon:"",subtitle:Fe.descricao||Fe.tipo||null,quadra:Fe}));ze.length>0&&c("Qual quadra voc quer?",ze,600)}catch{}},hasMultipleQuadras:(A||[]).length>1,horariosDisponiveis:P,esportes:i.quadra?.modalidades||[]}):o==="avaliacao"?a.jsx(Nlt,{onSubmit:Wr}):null:null;return r?O?a.jsx(Slt,{message:"Preparando sua experincia..."}):_?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(Mr.header,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5},className:"bg-surface/70 backdrop-blur-xl border-b border-white/10 sticky top-0 z-20 shadow-lg",children:a.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-3 md:py-4 flex items-center justify-between gap-3 md:gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[a.jsxs("div",{className:"relative group",children:[a.jsx("div",{className:"transition-all duration-300 group-hover:scale-105",children:a.jsx(cl,{size:"md",variant:"header",className:"md:w-20 md:h-20"})}),a.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 md:w-4 md:h-4 bg-success rounded-full border-2 border-surface"})]}),a.jsxs("div",{className:"flex flex-col gap-0.5 md:gap-1",children:[a.jsx("h1",{className:"font-bold text-text-primary text-lg md:text-2xl tracking-tight leading-none",children:"sis"}),a.jsxs("div",{className:"relative group w-fit",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 blur-md opacity-60 group-hover:opacity-100 animate-pulse rounded-md"}),a.jsxs("div",{className:"relative px-2 py-0.5 md:px-2.5 md:py-1 bg-gradient-to-r from-cyan-500/20 via-purple-500/20 to-pink-500/20 backdrop-blur-sm border border-cyan-500/50 rounded-md flex items-center gap-1 md:gap-1.5 shadow-lg",children:[a.jsxs("svg",{className:"w-2.5 h-2.5 md:w-3 md:h-3 text-cyan-400",fill:"currentColor",viewBox:"0 0 20 20",children:[a.jsx("path",{d:"M13 7H7v6h6V7z"}),a.jsx("path",{fillRule:"evenodd",d:"M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z",clipRule:"evenodd"})]}),a.jsx("span",{className:"text-[9px] md:text-[10px] font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"chat"}),a.jsxs("div",{className:"hidden md:flex gap-0.5",children:[a.jsx("span",{className:"w-1 h-1 bg-cyan-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),a.jsx("span",{className:"w-1 h-1 bg-purple-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),a.jsx("span",{className:"w-1 h-1 bg-pink-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]})]})]})]}),a.jsx("div",{className:"flex flex-1 justify-end md:justify-center",children:a.jsxs("div",{className:"group relative",children:[a.jsx("div",{className:"hidden md:block absolute inset-0 bg-gradient-to-r from-brand/20 via-brand/10 to-brand/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),a.jsxs("div",{className:"relative flex items-center gap-2.5 md:gap-3 px-4 py-2 md:px-5 md:py-2.5 bg-gradient-to-r from-surface via-surface-2 to-surface backdrop-blur-sm rounded-lg md:rounded-xl border border-brand/20 shadow-md md:shadow-lg",children:[a.jsxs("div",{className:"relative w-9 h-9 md:w-10 md:h-10 shrink-0 overflow-hidden rounded-lg border border-white/10 bg-surface-2/60 grid place-items-center shadow-[0_0_0_3px_RGBA(0,0,0,0.2)] group-hover:border-white/20 transition-colors duration-300",children:[me?a.jsx("img",{src:me,alt:"Logo da empresa",className:"w-full h-full object-cover",onError:ze=>{ze.target.style.display="none",ze.target.nextSibling.style.display="block"}}):null,a.jsx(bN,{className:`w-5 h-5 md:w-6 md:h-6 opacity-80 ${me?"hidden":"block"}`,strokeWidth:2})]}),a.jsx("h2",{className:"text-sm md:text-base font-bold text-text-primary tracking-wide truncate max-w-[140px] md:max-w-none",children:Y})]})]})}),a.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-brand rounded-xl flex items-center justify-center flex-shrink-0",children:a.jsx(Nd,{className:"w-7 h-7 text-primary-foreground"})}),a.jsxs("div",{className:"hidden lg:flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})]})}),a.jsx("div",{className:"container mx-auto max-w-5xl pb-6 md:pb-6 mb-12 md:mb-0",children:a.jsx(ylt,{onButtonClick:sn,hideButtonTexts:o==="avaliacao",children:Cn()})}),a.jsx(Mr.footer,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.3},className:"md:hidden fixed bottom-0 left-0 right-0 bg-surface/90 backdrop-blur-xl border-t border-white/10 z-20 shadow-lg",children:a.jsx("div",{className:"flex items-center justify-center py-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-6 h-6 bg-brand rounded-lg flex items-center justify-center",children:a.jsx(Nd,{className:"w-4 h-4 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-sm",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-sm",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-sm",style:{color:"#B0B0B0"},children:" Arena"})]})]})})})]}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-2xl",children:[a.jsx(Mr.div,{className:"mb-8 flex justify-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},children:a.jsxs("div",{className:"relative",children:[a.jsx(cl,{size:"xl",variant:"header"}),a.jsx(Mr.div,{className:"absolute inset-0 rounded-full border-4 border-brand/30",animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0}})]})}),a.jsxs(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"space-y-6",children:[a.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-text-primary mb-4",children:[ee(),"! Tentando Agendar? "]}),a.jsxs("div",{className:"bg-surface/70 backdrop-blur-sm border border-white/10 rounded-2xl p-8 shadow-xl",children:[a.jsxs("p",{className:"text-xl text-text-primary mb-6 leading-relaxed",children:["Entre em contato com o dono da quadra e solicite o ",a.jsx("strong",{children:"link de agendamento"}),"."]}),a.jsxs("div",{className:"bg-surface-2/50 border border-white/5 rounded-xl p-6 mb-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-text-primary mb-3 flex items-center gap-2",children:[a.jsx(vG,{className:"w-5 h-5 text-brand"}),"Formato do Link"]}),a.jsxs("div",{className:"bg-background/60 border border-white/10 rounded-lg p-4 font-mono text-base md:text-lg",children:[a.jsx("span",{className:"text-brand font-bold",children:"nomedaempresa"}),a.jsx("span",{className:"text-text-muted",children:".f7arena.com"})]}),a.jsx("p",{className:"mt-2 text-xs text-text-muted",children:"(sem traos)"})]})]})]}),a.jsx(Mr.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},className:"mt-12 flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(Nd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})})]})}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-2xl",children:[a.jsx(Mr.div,{className:"mb-8 flex justify-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},children:a.jsxs("div",{className:"relative",children:[a.jsx(cl,{size:"xl",variant:"header"}),a.jsx(Mr.div,{className:"absolute inset-0 rounded-full border-4 border-brand/30",animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0}})]})}),a.jsxs(Mr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"space-y-6",children:[a.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-text-primary mb-4",children:[ee(),"! Tentando Agendar?"]}),a.jsx("div",{className:"bg-surface/70 backdrop-blur-sm border border-white/10 rounded-2xl p-8 shadow-xl",children:a.jsx("p",{className:"text-xl text-text-primary mb-4 leading-relaxed",children:"Entre em contato com o dono da quadra e solicite o link de agendamento."})})]}),a.jsx(Mr.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},className:"mt-12 flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(Nd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})})]})})};function LV(){return a.jsx(Foe,{children:a.jsx(QY,{children:a.jsx(Elt,{children:a.jsx(Alt,{})})})})}function Elt({children:e}){const{selections:t}=p5(),[r,n]=Ce.useState({name:"",phone:"",source:"init"});return Ce.useEffect(()=>{const s=()=>{try{const c=t?.empresa||null;if(c){const d=c.isis_display_name||c.nome_fantasia||c.razao_social||c.nome||"",u=c.telefone||"";if(d||u)return{name:d,phone:u}}}catch{}return null},o=()=>{try{const c=window.location.host||"",d=window.location.pathname||"",u="f7arena.com";if(c.endsWith(u)){const h=c.slice(0,-u.length).replace(/\.$/,"").toLowerCase();if(h&&h!=="www")return h}const f=d.match(/\/agendar\/([^\/?#]+)/i);if(f&&f[1])return decodeURIComponent(f[1])}catch{}return null},i=s();if(i){try{console.info("[IsisError][Meta] Using context data",{name:!!i.name,phone:!!i.phone})}catch{}n({name:i.name,phone:i.phone,source:"context"});return}const l=o();if(!l){try{console.warn("[IsisError][Meta] No slug inferred from URL")}catch{}n(c=>c.name||c.phone?c:{name:"",phone:"",source:"none"});return}(async()=>{try{try{console.info("[IsisError][Meta] Start fetch by slug",{slug:l})}catch{}const c=String(l||"").toLowerCase().replace(/[\s\-_]+/g,"").trim();let d="",u="",f="";try{const{data:g,error:v}=await Q.rpc("get_empresa_public_by_slug",{p_slug:c});if(!v&&Array.isArray(g)&&g.length>0){const y=g[0]||{};d=y.isis_display_name||y.nome_fantasia||y.razao_social||y.nome||"",y.telefone&&(u=y.telefone,f="rpc.telefone");try{console.info("[IsisError][Meta] RPC result",{hasName:!!d,phoneSource:f,hasPhone:!!u})}catch{}}}catch{}if(!d||!u)try{const{data:g}=await Q.from("agenda_settings").select("isis_display_name, empresas(nome_fantasia, razao_social, nome, telefone)").eq("isis_subdomain",c).single(),v=g?.empresas||{};d=d||g?.isis_display_name||v?.nome_fantasia||v?.razao_social||v?.nome||"",!u&&v?.telefone&&(u=v.telefone,f="settings.telefone");try{console.info("[IsisError][Meta] Settings result",{hasName:!!d,phoneSource:f,hasPhone:!!u})}catch{}}catch{}const m=d||(g=>{try{return String(g||"").replace(/[\s_\-]+/g," ").trim().split(" ").filter(Boolean).map(y=>y.charAt(0).toUpperCase()+y.slice(1).toLowerCase()).join(" ")}catch{return g}})(l),x=u||"";try{console.info("[IsisError][Meta] Final",{finalName:m,hasPhone:!!x,phoneSource:f||"none"})}catch{}n({name:m,phone:x,source:f||"computed"})}catch(c){try{console.error("[IsisError][Meta] Exception during meta fetch",c)}catch{}n({name:l,phone:"",source:"error"})}})()},[t?.empresa]),a.jsx(Foe,{companyName:r.name,companyPhone:r.phone,children:e})}class Foe extends Ce.Component{constructor(t){super(t),this.state={hasError:!1,companyName:"",companyPhone:""}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,r){try{console.error("[Isis] Uncaught error:",t,r)}catch{}(!this.props.companyName||!this.props.companyPhone)&&(async()=>{try{const n=()=>{try{const d=typeof window<"u"&&window.location.host||"",u=typeof window<"u"&&window.location.pathname||"",f="f7arena.com";if(d&&d.endsWith(f)){const m=d.slice(0,-f.length).replace(/\.$/,"").toLowerCase();if(m&&m!=="www")return m}const h=u.match(/\/agendar\/([^\/?#]+)/i);if(h&&h[1])return decodeURIComponent(h[1])}catch{}return null},s=d=>{try{return String(d||"").replace(/[\s_\-]+/g," ").trim().split(" ").filter(Boolean).map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" ")}catch{return d}},o=n();if(!o)return;const i=String(o).toLowerCase().replace(/[\s\-_]+/g,"").trim();let l="",c="";try{const{data:d,error:u}=await Q.rpc("get_empresa_public_by_slug",{p_slug:i});if(!u&&Array.isArray(d)&&d.length>0){const f=d[0]||{};l=f.isis_display_name||f.nome_fantasia||f.razao_social||f.nome||"",f.telefone&&(c=f.telefone);try{console.info("[IsisError][Outer] RPC",{hasName:!!l,hasPhone:!!c})}catch{}}}catch{}if(!l||!c)try{const{data:d}=await Q.from("agenda_settings").select("isis_display_name, empresas(nome_fantasia, razao_social, nome, telefone)").eq("isis_subdomain",i).single(),u=d?.empresas||{};l=l||d?.isis_display_name||u?.nome_fantasia||u?.razao_social||u?.nome||"",!c&&u?.telefone&&(c=u.telefone);try{console.info("[IsisError][Outer] Settings",{hasName:!!l,hasPhone:!!c})}catch{}}catch{}this.setState({companyName:l||s(o),companyPhone:c||""})}catch(n){try{console.error("[IsisError][Outer] meta fetch failed",n)}catch{}}})()}render(){if(this.state.hasError){try{console.info("[IsisError][Render] Props",{companyName:this.props.companyName,companyPhone:this.props.companyPhone})}catch{}const t=()=>{try{const i=typeof window<"u"&&window.location.host||"",l=typeof window<"u"&&window.location.pathname||"",c="f7arena.com";if(i&&i.endsWith(c)){const u=i.slice(0,-c.length).replace(/\.$/,"").toLowerCase();if(u&&u!=="www")return u}const d=l.match(/\/agendar\/([^\/?#]+)/i);if(d&&d[1])return decodeURIComponent(d[1])}catch{}return null},r=i=>{try{const l=String(i||"").replace(/\D/g,"");return l.length>=11?`(${l.slice(0,2)}) ${l.slice(2,7)}-${l.slice(7,11)}`:l.length>=10?`(${l.slice(0,2)}) ${l.slice(2,6)}-${l.slice(6,10)}`:i||""}catch{return i||""}},n=t(),s=this.props.companyName||this.state.companyName||n||"a arena",o=r(this.props.companyPhone||this.state.companyPhone||"");return a.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background text-text-primary p-6",children:a.jsxs("div",{className:"w-full max-w-xl mx-auto rounded-3xl border border-white/10 bg-surface/80 backdrop-blur-md shadow-2xl p-8 text-center",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx(cl,{size:"xl"})}),a.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight mb-3",children:" Ops, ocorreu um erro!"}),a.jsxs("p",{className:"text-base md:text-lg opacity-90 leading-relaxed mb-3",children:["Pode ser um ",a.jsx("span",{className:"font-semibold",children:"problema no seu dispositivo"})," ou na sua ",a.jsx("span",{className:"font-semibold",children:"conexo de rede"}),"."]}),a.jsxs("p",{className:"text-base md:text-lg opacity-90 leading-relaxed mb-6",children:[a.jsx("span",{className:"font-semibold",children:"Tente novamente"}),", experimente ",a.jsx("span",{className:"font-semibold",children:"outro navegador"})," ou ",a.jsx("span",{className:"font-semibold",children:"outra rede"}),"."]}),a.jsxs("p",{className:"text-base md:text-lg leading-relaxed mb-6",children:["Se persistir, ",a.jsx("span",{className:"font-semibold",children:"entre em contato"})," com ",a.jsx("span",{className:"font-semibold",children:s}),o?a.jsxs(a.Fragment,{children:[" ","pelo nmero ",a.jsx("span",{className:"font-semibold font-mono",children:o}),"."]}):"."]}),a.jsx("div",{className:"flex items-center justify-center gap-3",children:a.jsx("button",{onClick:()=>{try{window.location.reload()}catch{}},className:"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-brand text-bg font-semibold shadow-lg shadow-brand/20 hover:shadow-xl hover:shadow-brand/30 transition-all",children:" Recarregar pgina"})})]})})}return this.props.children}}const Loe=!1,klt="",Ilt="Estamos em manuteno no momento. Voltaremos em breve.",$V="f740028922";function BV(e){try{return or(e,"EEE, d 'de' MMM 's' HH:mm",{locale:Da})}catch{return""}}function qV(){const e=Mi(),t=Ol(),r=!!Loe||typeof window<"u"&&localStorage.getItem("maintenance:active")==="true",[n,s]=p.useState(""),[o,i]=p.useState("");p.useEffect(()=>{try{s(localStorage.getItem("maintenance:end")||""),i(localStorage.getItem("maintenance:message")||"");const f=h=>{h.key==="maintenance:end"&&s(h.newValue||""),h.key==="maintenance:message"&&i(h.newValue||"")};return window.addEventListener("storage",f),()=>window.removeEventListener("storage",f)}catch{}},[]);const l=n||klt||{}.VITE_MAINTENANCE_END||"",c=o&&o.trim()?o:Ilt,d=p.useMemo(()=>{if(!l)return null;const f=new Date(l);return isNaN(f.getTime())?null:f},[l]),u=p.useMemo(()=>c?.trim()?c:d?`Estamos em manuteno e voltaremos at ${BV(d)}.`:"Estamos em manuteno no momento. Voltaremos em breve.",[c,d]);return p.useEffect(()=>{try{window.f7MaintenanceBypass=f=>{const h=String(f||"")===$V;if(h){try{localStorage.setItem("maintenance:bypass","1")}catch{}try{sessionStorage.setItem("maintenance:bypass","1")}catch{}try{document.cookie="fx_maint_bypass=1; path=/; max-age=2592000"}catch{}try{sessionStorage.removeItem("auth:returnUrl")}catch{}t("/login",{replace:!0})}else console.warn("[Maintenance] Senha invlida.");return h},window.f7MaintenanceReset=()=>{try{localStorage.removeItem("maintenance:bypass")}catch{}console.info("[Maintenance] Bypass removido.")}}catch{}},[t]),p.useEffect(()=>{const h=String(e.pathname||"").split("/").filter(Boolean),m=h[h.length-1]||"",x=new URLSearchParams(e.search||""),v=x.get("senha")||x.get("pwd")||x.get("code")||""||m;if(v&&v===$V){try{localStorage.setItem("maintenance:bypass","1")}catch{}try{sessionStorage.setItem("maintenance:bypass","1")}catch{}try{document.cookie="fx_maint_bypass=1; path=/; max-age=2592000"}catch{}try{sessionStorage.removeItem("auth:returnUrl")}catch{}t("/login",{replace:!0})}},[e,t]),a.jsxs("div",{className:"min-h-screen relative overflow-hidden bg-gradient-to-b from-[#0f1324] via-[#0b0f1c] to-[#070a14] text-white",children:[a.jsx("div",{className:"pointer-events-none absolute -top-40 left-1/2 -translate-x-1/2 w-[90rem] h-[90rem] rounded-full opacity-30 blur-3xl",style:{background:"radial-gradient(50% 50% at 50% 50%, rgba(76,110,245,0.45) 0%, rgba(76,110,245,0.18) 40%, rgba(0,0,0,0) 70%)"}}),a.jsxs("div",{className:"relative z-10 mx-auto max-w-4xl px-6 py-16 md:py-24",children:[a.jsxs("div",{className:"mx-auto max-w-3xl rounded-3xl border border-white/10 bg-white/[0.02] backdrop-blur-xl shadow-[0_0_60px_-10px_rgba(76,110,245,0.5)] p-6 md:p-10",children:[a.jsx("div",{className:"text-center mb-8",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"w-16 h-16 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(Nd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-5xl font-extrabold",children:[a.jsx("span",{style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{style:{color:"#FFAA33"},children:"7"})]}),a.jsx("p",{className:"text-2xl font-semibold",style:{color:"#B0B0B0"},children:"Arena"})]})]})}),a.jsxs("div",{className:"flex items-center justify-center gap-3 text-red-400 mb-4",children:[a.jsx(X4,{className:"w-6 h-6"}),a.jsx("span",{className:"font-semibold tracking-wide",children:"Modo de Manuteno"})]}),a.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-8",children:[a.jsx("div",{className:"shrink-0",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute -inset-4 bg-brand/20 blur-2xl rounded-full"}),a.jsx("div",{className:"relative rounded-2xl p-1 bg-gradient-to-b from-brand/40 to-transparent",children:a.jsx(cl,{size:"xl",variant:"header"})})]})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h1",{className:"text-2xl md:text-3xl font-bold leading-tight",children:"Oi! Eu sou a Isis "}),a.jsx("p",{className:"text-white/80 mt-3 text-base md:text-lg leading-relaxed",children:u}),a.jsxs("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-white/80",children:[d&&a.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2",children:[a.jsx(xu,{className:"w-4 h-4 text-brand"}),a.jsxs("span",{children:["Previso de retorno: ",a.jsx("strong",{className:"text-white/90",children:BV(d)})]})]}),a.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2",children:[a.jsx(ko,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Vamos cuidar de tudo para voc jogar melhor "})]})]})]})]})]}),a.jsx("p",{className:"mt-6 text-center text-white/50 text-sm",children:r?"Modo de manuteno ativo":"Modo de manuteno inativo"})]})]})}function Olt(){const[e,t]=p.useState(!0),[r,n]=p.useState(!1),s=()=>{t(d=>!d)},o=Mi(),i=Ol(),l=o.pathname==="/agenda",c=o.pathname==="/isis/analytics";return p.useEffect(()=>{const d=u=>{const f=String(u.target?.tagName||"").toLowerCase();if(!(["input","textarea","select"].includes(f)||u.target?.isContentEditable)&&!u.repeat){if(String(u.key).toLowerCase()==="b"){u.preventDefault();const h=String(o?.pathname||"").toLowerCase();console.log("[Global Hotkey B] Current path:",h),h.includes("balcao")?(console.log("[Global Hotkey B] Navigating to /vendas"),i("/vendas")):(console.log("[Global Hotkey B] Navigating to /balcao"),i("/balcao"));return}if(String(u.key).toLowerCase()==="h"){u.preventDefault(),i("/historico");return}}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[o,i]),p.useEffect(()=>{try{typeof window<"u"&&window.innerWidth<768&&c&&t(!1)}catch{}},[c]),a.jsx(Rje,{children:a.jsx(Eje,{children:a.jsx(Fje,{children:a.jsxs("div",{className:"relative flex h-screen bg-background text-text-primary",children:[a.jsxs(J0,{children:[a.jsx("title",{children:"F7 Arena"}),a.jsx("meta",{name:"description",content:"Software para gesto de quadras esportivas."})]}),a.jsx(Oge,{isVisible:e,setIsVisible:t,sidebarPinned:r}),e&&a.jsx("button",{type:"button",onClick:()=>t(!1),className:"md:hidden fixed inset-0 z-30 bg-black/40","aria-label":"Fechar menu lateral"}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsx(kje,{onToggleSidebar:s,sidebarVisible:e,sidebarPinned:r}),a.jsx("main",{className:Er("flex-1 overflow-x-hidden overflow-y-auto bg-background",l?"p-0 md:p-8":"p-8"),children:a.jsxs(S_,{children:[a.jsx(eo,{path:"/",element:a.jsx(NUe,{})}),a.jsx(eo,{path:"/agenda",element:a.jsx(AZe,{sidebarVisible:e})}),a.jsx(eo,{path:"/isis",element:a.jsx(QY,{children:a.jsx(slt,{})})}),a.jsx(eo,{path:"/isis/analytics",element:a.jsx(olt,{})}),a.jsx(eo,{path:"/vendas",element:a.jsx(pst,{})}),a.jsx(eo,{path:"/balcao",element:a.jsx(gst,{})}),a.jsx(eo,{path:"/produtos",element:a.jsx(zst,{})}),a.jsx(eo,{path:"/compras",element:a.jsx(moe,{})}),a.jsx(eo,{path:"/clientes",element:a.jsx(Xst,{})}),a.jsx(eo,{path:"/equipe",element:a.jsx(eot,{})}),a.jsx(eo,{path:"/financeiro",element:a.jsx(Bot,{})}),a.jsx(eo,{path:"/caixa",element:a.jsx(dG,{to:"/financeiro?tab=caixa",replace:!0})}),a.jsx(eo,{path:"/quadras",element:a.jsx(Uot,{})}),a.jsx(eo,{path:"/empresas",element:a.jsx(Jot,{})}),a.jsx(eo,{path:"/finalizadoras",element:a.jsx(Zot,{})}),a.jsx(eo,{path:"/configuracao-fiscal",element:a.jsx(Git,{})}),a.jsx(eo,{path:"/fiscal",element:a.jsx(nlt,{})}),a.jsx(eo,{path:"/test-page",element:a.jsx(eit,{})}),a.jsx(eo,{path:"/historico",element:a.jsx(dlt,{})}),a.jsx(eo,{path:"/suporte",element:a.jsx(rot,{})})]})})]})]})})})})}function Tlt(){Mi();const[e,t]=p.useState(!1),[r,n]=p.useState(!1),s=String({}.VITE_MAINTENANCE_MODE||"").toLowerCase()==="true",o=Ce.useMemo(()=>{try{if(typeof window>"u")return null;const c=window.location.host||"",d="f7arena.com";if(!c.endsWith(d))return null;const u=c.slice(0,-d.length).replace(/\.$/,"").toLowerCase();return!u||u==="www"?null:u}catch{return null}},[]);p.useEffect(()=>{try{const c=()=>{const u=localStorage.getItem("maintenance:active")==="true",f=localStorage.getItem("maintenance:end");return u&&f&&new Date>new Date(f)?(localStorage.removeItem("maintenance:active"),!1):u};t(localStorage.getItem("maintenance:bypass")==="1"),n(c());const d=u=>{if(!u||!u.key){n(c()),t(localStorage.getItem("maintenance:bypass")==="1");return}u.key==="maintenance:bypass"&&t(u.newValue==="1"),(u.key==="maintenance:active"||u.key==="maintenance:end")&&n(c())};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)}catch{}},[]);const i=!!Loe||s||r,l=(()=>{try{const c=localStorage.getItem("maintenance:bypass")==="1",d=(()=>{try{return sessionStorage.getItem("maintenance:bypass")==="1"}catch{return!1}})(),u=(()=>{try{return document.cookie.split(";").some(f=>f.trim()==="fx_maint_bypass=1")}catch{return!1}})();return c||d||u}catch{return!1}})();return i&&!l?a.jsxs(S_,{children:[a.jsx(eo,{path:"/maintenance",element:a.jsx(qV,{})}),a.jsx(eo,{path:"*",element:a.jsx(dG,{to:"/maintenance",replace:!0})})]}):o?a.jsx(S_,{children:a.jsx(eo,{path:"/*",element:a.jsx(LV,{})})}):a.jsxs(S_,{children:[a.jsx(eo,{path:"/reset-password",element:a.jsx(nit,{})}),a.jsx(eo,{path:"/40028922",element:a.jsx(glt,{})}),a.jsx(eo,{path:"/agendar/:nomeFantasia",element:a.jsx(LV,{})}),a.jsx(eo,{path:"/maintenance",element:a.jsx(qV,{})}),a.jsx(eo,{path:"/backenddeploy",element:a.jsx(tit,{})}),a.jsx(eo,{path:"/print-comanda",element:a.jsx(y8,{children:a.jsx(ult,{})})}),a.jsx(eo,{path:"/*",element:a.jsx(y8,{children:a.jsx(Olt,{})})})]})}var CF="ToastProvider",[PF,Dlt,Mlt]=cP("Toast"),[$oe,Nct]=Cu("Toast",[Mlt]),[Rlt,HP]=$oe(CF),Boe=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=e,[l,c]=p.useState(null),[d,u]=p.useState(0),f=p.useRef(!1),h=p.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${CF}\`. Expected non-empty \`string\`.`),a.jsx(PF.Provider,{scope:t,children:a.jsx(Rlt,{scope:t,label:r,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:d,viewport:l,onViewportChange:c,onToastAdd:p.useCallback(()=>u(m=>m+1),[]),onToastRemove:p.useCallback(()=>u(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:f,isClosePausedRef:h,children:i})})};Boe.displayName=CF;var qoe="ToastViewport",Flt=["F8"],W3="toast.viewportPause",H3="toast.viewportResume",zoe=p.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Flt,label:s="Notifications ({hotkey})",...o}=e,i=HP(qoe,r),l=Dlt(r),c=p.useRef(null),d=p.useRef(null),u=p.useRef(null),f=p.useRef(null),h=Ds(t,f,i.onViewportChange),m=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),x=i.toastCount>0;p.useEffect(()=>{const v=y=>{n.length!==0&&n.every(w=>y[w]||y.code===w)&&f.current?.focus()};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[n]),p.useEffect(()=>{const v=c.current,y=f.current;if(x&&v&&y){const b=()=>{if(!i.isClosePausedRef.current){const C=new CustomEvent(W3);y.dispatchEvent(C),i.isClosePausedRef.current=!0}},w=()=>{if(i.isClosePausedRef.current){const C=new CustomEvent(H3);y.dispatchEvent(C),i.isClosePausedRef.current=!1}},j=C=>{!v.contains(C.relatedTarget)&&w()},_=()=>{v.contains(document.activeElement)||w()};return v.addEventListener("focusin",b),v.addEventListener("focusout",j),v.addEventListener("pointermove",b),v.addEventListener("pointerleave",_),window.addEventListener("blur",b),window.addEventListener("focus",w),()=>{v.removeEventListener("focusin",b),v.removeEventListener("focusout",j),v.removeEventListener("pointermove",b),v.removeEventListener("pointerleave",_),window.removeEventListener("blur",b),window.removeEventListener("focus",w)}}},[x,i.isClosePausedRef]);const g=p.useCallback(({tabbingDirection:v})=>{const b=l().map(w=>{const j=w.ref.current,_=[j,...Ylt(j)];return v==="forwards"?_:_.reverse()});return(v==="forwards"?b.reverse():b).flat()},[l]);return p.useEffect(()=>{const v=f.current;if(v){const y=b=>{const w=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!w){const _=document.activeElement,C=b.shiftKey;if(b.target===v&&C){d.current?.focus();return}const P=g({tabbingDirection:C?"backwards":"forwards"}),M=P.findIndex(O=>O===_);zk(P.slice(M+1))?b.preventDefault():C?d.current?.focus():u.current?.focus()}};return v.addEventListener("keydown",y),()=>v.removeEventListener("keydown",y)}},[l,g]),a.jsxs(Vge,{ref:c,role:"region","aria-label":s.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:x?void 0:"none"},children:[x&&a.jsx(G3,{ref:d,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"forwards"});zk(v)}}),a.jsx(PF.Slot,{scope:r,children:a.jsx(Xa.ol,{tabIndex:-1,...o,ref:h})}),x&&a.jsx(G3,{ref:u,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"backwards"});zk(v)}})]})});zoe.displayName=qoe;var Uoe="ToastFocusProxy",G3=p.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=e,o=HP(Uoe,r);return a.jsx(gR,{tabIndex:0,...s,ref:t,style:{position:"fixed"},onFocus:i=>{const l=i.relatedTarget;!o.viewport?.contains(l)&&n()}})});G3.displayName=Uoe;var Mj="Toast",Llt="toast.swipeStart",$lt="toast.swipeMove",Blt="toast.swipeCancel",qlt="toast.swipeEnd",Voe=p.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:o,...i}=e,[l,c]=Um({prop:n,defaultProp:s??!0,onChange:o,caller:Mj});return a.jsx(qd,{present:r||l,children:a.jsx(Vlt,{open:l,...i,ref:t,onClose:()=>c(!1),onPause:Zc(e.onPause),onResume:Zc(e.onResume),onSwipeStart:aa(e.onSwipeStart,d=>{d.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:aa(e.onSwipeMove,d=>{const{x:u,y:f}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","move"),d.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${f}px`)}),onSwipeCancel:aa(e.onSwipeCancel,d=>{d.currentTarget.setAttribute("data-swipe","cancel"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:aa(e.onSwipeEnd,d=>{const{x:u,y:f}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","end"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${f}px`),c(!1)})})})});Voe.displayName=Mj;var[zlt,Ult]=$oe(Mj,{onClose(){}}),Vlt=p.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:l,onPause:c,onResume:d,onSwipeStart:u,onSwipeMove:f,onSwipeCancel:h,onSwipeEnd:m,...x}=e,g=HP(Mj,r),[v,y]=p.useState(null),b=Ds(t,k=>y(k)),w=p.useRef(null),j=p.useRef(null),_=s||g.duration,C=p.useRef(0),A=p.useRef(_),S=p.useRef(0),{onToastAdd:P,onToastRemove:M}=g,O=Zc(()=>{v?.contains(document.activeElement)&&g.viewport?.focus(),i()}),I=p.useCallback(k=>{!k||k===1/0||(window.clearTimeout(S.current),C.current=new Date().getTime(),S.current=window.setTimeout(O,k))},[O]);p.useEffect(()=>{const k=g.viewport;if(k){const $=()=>{I(A.current),d?.()},q=()=>{const z=new Date().getTime()-C.current;A.current=A.current-z,window.clearTimeout(S.current),c?.()};return k.addEventListener(W3,q),k.addEventListener(H3,$),()=>{k.removeEventListener(W3,q),k.removeEventListener(H3,$)}}},[g.viewport,_,c,d,I]),p.useEffect(()=>{o&&!g.isClosePausedRef.current&&I(_)},[o,_,g.isClosePausedRef,I]),p.useEffect(()=>(P(),()=>M()),[P,M]);const T=p.useMemo(()=>v?Joe(v):null,[v]);return g.viewport?a.jsxs(a.Fragment,{children:[T&&a.jsx(Wlt,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:T}),a.jsx(zlt,{scope:r,onClose:O,children:Xm.createPortal(a.jsx(PF.ItemSlot,{scope:r,children:a.jsx(Uge,{asChild:!0,onEscapeKeyDown:aa(l,()=>{g.isFocusedToastEscapeKeyDownRef.current||O(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:a.jsx(Xa.li,{tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":g.swipeDirection,...x,ref:b,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:aa(e.onKeyDown,k=>{k.key==="Escape"&&(l?.(k.nativeEvent),k.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,O()))}),onPointerDown:aa(e.onPointerDown,k=>{k.button===0&&(w.current={x:k.clientX,y:k.clientY})}),onPointerMove:aa(e.onPointerMove,k=>{if(!w.current)return;const $=k.clientX-w.current.x,q=k.clientY-w.current.y,z=!!j.current,F=["left","right"].includes(g.swipeDirection),V=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,ue=F?V(0,$):0,_e=F?0:V(0,q),U=k.pointerType==="touch"?10:2,L={x:ue,y:_e},G={originalEvent:k,delta:L};z?(j.current=L,f_($lt,f,G,{discrete:!1})):zV(L,g.swipeDirection,U)?(j.current=L,f_(Llt,u,G,{discrete:!1}),k.target.setPointerCapture(k.pointerId)):(Math.abs($)>U||Math.abs(q)>U)&&(w.current=null)}),onPointerUp:aa(e.onPointerUp,k=>{const $=j.current,q=k.target;if(q.hasPointerCapture(k.pointerId)&&q.releasePointerCapture(k.pointerId),j.current=null,w.current=null,$){const z=k.currentTarget,F={originalEvent:k,delta:$};zV($,g.swipeDirection,g.swipeThreshold)?f_(qlt,m,F,{discrete:!0}):f_(Blt,h,F,{discrete:!0}),z.addEventListener("click",V=>V.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),Wlt=e=>{const{__scopeToast:t,children:r,...n}=e,s=HP(Mj,t),[o,i]=p.useState(!1),[l,c]=p.useState(!1);return Klt(()=>i(!0)),p.useEffect(()=>{const d=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(d)},[]),l?null:a.jsx(iy,{asChild:!0,children:a.jsx(gR,{...n,children:o&&a.jsxs(a.Fragment,{children:[s.label," ",r]})})})},Hlt="ToastTitle",Woe=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(Xa.div,{...n,ref:t})});Woe.displayName=Hlt;var Glt="ToastDescription",Hoe=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(Xa.div,{...n,ref:t})});Hoe.displayName=Glt;var Goe="ToastAction",Koe=p.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?a.jsx(Yoe,{altText:r,asChild:!0,children:a.jsx(AF,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${Goe}\`. Expected non-empty \`string\`.`),null)});Koe.displayName=Goe;var Xoe="ToastClose",AF=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,s=Ult(Xoe,r);return a.jsx(Yoe,{asChild:!0,children:a.jsx(Xa.button,{type:"button",...n,ref:t,onClick:aa(e.onClick,s.onClose)})})});AF.displayName=Xoe;var Yoe=p.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...s}=e;return a.jsx(Xa.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:t})});function Joe(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),Xlt(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",o=n.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const i=n.dataset.radixToastAnnounceAlt;i&&t.push(i)}else t.push(...Joe(n))}}),t}function f_(e,t,r,{discrete:n}){const s=r.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?SD(s,o):s.dispatchEvent(o)}var zV=(e,t,r=0)=>{const n=Math.abs(e.x),s=Math.abs(e.y),o=n>s;return t==="left"||t==="right"?o&&n>r:!o&&s>r};function Klt(e=()=>{}){const t=Zc(e);Il(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function Xlt(e){return e.nodeType===e.ELEMENT_NODE}function Ylt(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function zk(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Jlt=Boe,Qoe=zoe,Zoe=Voe,eie=Woe,tie=Hoe,rie=Koe,nie=AF;const Qlt=Jlt,aie=Ce.forwardRef(({className:e,...t},r)=>a.jsx(Qoe,{ref:r,className:Er("fixed z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));aie.displayName=Qoe.displayName;const Zlt=ND("group relative pointer-events-auto flex w-full items-start justify-between gap-4 overflow-hidden rounded-lg border p-4 pr-8 shadow-xl transition-all data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-warning text-black border-warning",destructive:"bg-danger text-white border-danger",success:"bg-success text-white border-success",info:"bg-info text-black border-info",warning:"bg-warning text-black border-warning"}},defaultVariants:{variant:"default"}}),sie=Ce.forwardRef(({className:e,variant:t,...r},n)=>a.jsx(Zoe,{ref:n,className:Er(Zlt({variant:t}),e),...r}));sie.displayName=Zoe.displayName;const ect=Ce.forwardRef(({className:e,...t},r)=>a.jsx(rie,{ref:r,className:Er("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));ect.displayName=rie.displayName;const oie=Ce.forwardRef(({className:e,...t},r)=>a.jsx(nie,{ref:r,className:Er("absolute right-2 top-2 rounded-md p-1 text-white/80 transition-opacity hover:text-white focus:outline-none focus:ring-2 focus:ring-white/50 group-[.default]:text-black/70 group-[.default]:hover:text-black",e),...t,children:a.jsx(Yc,{className:"h-4 w-4"})}));oie.displayName=nie.displayName;const iie=Ce.forwardRef(({className:e,...t},r)=>a.jsx(eie,{ref:r,className:Er("text-sm font-semibold",e),...t}));iie.displayName=eie.displayName;const lie=Ce.forwardRef(({className:e,...t},r)=>a.jsx(tie,{ref:r,className:Er("text-sm",e),...t}));lie.displayName=tie.displayName;function tct(){const{toasts:e}=Xs();return a.jsxs(Qlt,{children:[e.map(({id:t,title:r,description:n,action:s,dismiss:o,...i})=>a.jsxs(sie,{...i,children:[a.jsxs("div",{className:"grid gap-1",children:[r&&a.jsx(iie,{children:r}),n&&a.jsx(lie,{children:n})]}),s,a.jsx(oie,{onClick:o})]},t)),a.jsx(aie,{})]})}function rct(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(e=>{setInterval(()=>{e.update()},6e4),e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&window.confirm("Nova verso disponvel! Deseja atualizar agora?")&&(t.postMessage({type:"SKIP_WAITING"}),window.location.reload())})})}).catch(e=>{console.error("[SW] Erro ao registrar Service Worker:",e)}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()})})}rct();window.screen?.orientation?.lock&&window.screen.orientation.lock("portrait").catch(e=>{console.log("[Orientation] Lock no suportado ou j bloqueado:",e.message)});window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),window.__installPrompt=e},{passive:!1});window.addEventListener("appinstalled",()=>{window.__installPrompt=null});Uk.createRoot(document.getElementById("root")).render(a.jsx(Hde,{children:a.jsxs(kwe,{children:[a.jsx(Tlt,{}),a.jsx(tct,{})]})}));export{fje as _,Jl as c,Ls as g};
