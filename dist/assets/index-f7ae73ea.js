var Nie=Object.defineProperty;var Sie=(e,t,r)=>t in e?Nie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var fo=(e,t,r)=>(Sie(e,typeof t!="symbol"?t+"":t,r),r);function Cie(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var Gl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Us(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Aie(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var VV={exports:{}},jC={},WV={exports:{}},Is={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W1=Symbol.for("react.element"),Pie=Symbol.for("react.portal"),Eie=Symbol.for("react.fragment"),kie=Symbol.for("react.strict_mode"),Iie=Symbol.for("react.profiler"),Oie=Symbol.for("react.provider"),Tie=Symbol.for("react.context"),Die=Symbol.for("react.forward_ref"),Mie=Symbol.for("react.suspense"),Rie=Symbol.for("react.memo"),Fie=Symbol.for("react.lazy"),BF=Symbol.iterator;function Lie(e){return e===null||typeof e!="object"?null:(e=BF&&e[BF]||e["@@iterator"],typeof e=="function"?e:null)}var HV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},GV=Object.assign,KV={};function J0(e,t,r){this.props=e,this.context=t,this.refs=KV,this.updater=r||HV}J0.prototype.isReactComponent={};J0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};J0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function XV(){}XV.prototype=J0.prototype;function K3(e,t,r){this.props=e,this.context=t,this.refs=KV,this.updater=r||HV}var X3=K3.prototype=new XV;X3.constructor=K3;GV(X3,J0.prototype);X3.isPureReactComponent=!0;var qF=Array.isArray,YV=Object.prototype.hasOwnProperty,Y3={current:null},JV={key:!0,ref:!0,__self:!0,__source:!0};function QV(e,t,r){var n,s={},o=null,i=null;if(t!=null)for(n in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(o=""+t.key),t)YV.call(t,n)&&!JV.hasOwnProperty(n)&&(s[n]=t[n]);var l=arguments.length-2;if(l===1)s.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps,l)s[n]===void 0&&(s[n]=l[n]);return{$$typeof:W1,type:e,key:o,ref:i,props:s,_owner:Y3.current}}function $ie(e,t){return{$$typeof:W1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function J3(e){return typeof e=="object"&&e!==null&&e.$$typeof===W1}function Bie(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var zF=/\/+/g;function nP(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Bie(""+e.key):t.toString(36)}function m2(e,t,r,n,s){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case W1:case Pie:i=!0}}if(i)return i=e,s=s(i),e=n===""?"."+nP(i,0):n,qF(s)?(r="",e!=null&&(r=e.replace(zF,"$&/")+"/"),m2(s,t,r,"",function(d){return d})):s!=null&&(J3(s)&&(s=$ie(s,r+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(zF,"$&/")+"/")+e)),t.push(s)),1;if(i=0,n=n===""?".":n+":",qF(e))for(var l=0;l<e.length;l++){o=e[l];var c=n+nP(o,l);i+=m2(o,t,r,c,s)}else if(c=Lie(e),typeof c=="function")for(e=c.call(e),l=0;!(o=e.next()).done;)o=o.value,c=n+nP(o,l++),i+=m2(o,t,r,c,s);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function Hj(e,t,r){if(e==null)return e;var n=[],s=0;return m2(e,n,"","",function(o){return t.call(r,o,s++)}),n}function qie(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var jc={current:null},h2={transition:null},zie={ReactCurrentDispatcher:jc,ReactCurrentBatchConfig:h2,ReactCurrentOwner:Y3};function ZV(){throw Error("act(...) is not supported in production builds of React.")}Is.Children={map:Hj,forEach:function(e,t,r){Hj(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Hj(e,function(){t++}),t},toArray:function(e){return Hj(e,function(t){return t})||[]},only:function(e){if(!J3(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Is.Component=J0;Is.Fragment=Eie;Is.Profiler=Iie;Is.PureComponent=K3;Is.StrictMode=kie;Is.Suspense=Mie;Is.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zie;Is.act=ZV;Is.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=GV({},e.props),s=e.key,o=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,i=Y3.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)YV.call(t,c)&&!JV.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];n.children=l}return{$$typeof:W1,type:e.type,key:s,ref:o,props:n,_owner:i}};Is.createContext=function(e){return e={$$typeof:Tie,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Oie,_context:e},e.Consumer=e};Is.createElement=QV;Is.createFactory=function(e){var t=QV.bind(null,e);return t.type=e,t};Is.createRef=function(){return{current:null}};Is.forwardRef=function(e){return{$$typeof:Die,render:e}};Is.isValidElement=J3;Is.lazy=function(e){return{$$typeof:Fie,_payload:{_status:-1,_result:e},_init:qie}};Is.memo=function(e,t){return{$$typeof:Rie,type:e,compare:t===void 0?null:t}};Is.startTransition=function(e){var t=h2.transition;h2.transition={};try{e()}finally{h2.transition=t}};Is.unstable_act=ZV;Is.useCallback=function(e,t){return jc.current.useCallback(e,t)};Is.useContext=function(e){return jc.current.useContext(e)};Is.useDebugValue=function(){};Is.useDeferredValue=function(e){return jc.current.useDeferredValue(e)};Is.useEffect=function(e,t){return jc.current.useEffect(e,t)};Is.useId=function(){return jc.current.useId()};Is.useImperativeHandle=function(e,t,r){return jc.current.useImperativeHandle(e,t,r)};Is.useInsertionEffect=function(e,t){return jc.current.useInsertionEffect(e,t)};Is.useLayoutEffect=function(e,t){return jc.current.useLayoutEffect(e,t)};Is.useMemo=function(e,t){return jc.current.useMemo(e,t)};Is.useReducer=function(e,t,r){return jc.current.useReducer(e,t,r)};Is.useRef=function(e){return jc.current.useRef(e)};Is.useState=function(e){return jc.current.useState(e)};Is.useSyncExternalStore=function(e,t,r){return jc.current.useSyncExternalStore(e,t,r)};Is.useTransition=function(){return jc.current.useTransition()};Is.version="18.3.1";WV.exports=Is;var p=WV.exports;const Ce=Us(p),Q3=Cie({__proto__:null,default:Ce},[p]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uie=p,Vie=Symbol.for("react.element"),Wie=Symbol.for("react.fragment"),Hie=Object.prototype.hasOwnProperty,Gie=Uie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kie={key:!0,ref:!0,__self:!0,__source:!0};function eW(e,t,r){var n,s={},o=null,i=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)Hie.call(t,n)&&!Kie.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:Vie,type:e,key:o,ref:i,props:s,_owner:Gie.current}}jC.Fragment=Wie;jC.jsx=eW;jC.jsxs=eW;VV.exports=jC;var a=VV.exports,Uk={},tW={exports:{}},Fd={},rW={exports:{}},nW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(F,V){var me=F.length;F.push(V);e:for(;0<me;){var be=me-1>>>1,U=F[be];if(0<s(U,V))F[be]=V,F[me]=U,me=be;else break e}}function r(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var V=F[0],me=F.pop();if(me!==V){F[0]=me;e:for(var be=0,U=F.length,L=U>>>1;be<L;){var H=2*(be+1)-1,ie=F[H],Y=H+1,W=F[Y];if(0>s(ie,me))Y<U&&0>s(W,ie)?(F[be]=W,F[Y]=me,be=Y):(F[be]=ie,F[H]=me,be=H);else if(Y<U&&0>s(W,me))F[be]=W,F[Y]=me,be=Y;else break e}}return V}function s(F,V){var me=F.sortIndex-V.sortIndex;return me!==0?me:F.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();e.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,f=null,h=3,m=!1,x=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(F){for(var V=r(d);V!==null;){if(V.callback===null)n(d);else if(V.startTime<=F)n(d),V.sortIndex=V.expirationTime,t(c,V);else break;V=r(d)}}function j(F){if(g=!1,w(F),!x)if(r(c)!==null)x=!0,B(_);else{var V=r(d);V!==null&&z(j,V.startTime-F)}}function _(F,V){x=!1,g&&(g=!1,y(S),S=-1),m=!0;var me=h;try{for(w(V),f=r(c);f!==null&&(!(f.expirationTime>V)||F&&!O());){var be=f.callback;if(typeof be=="function"){f.callback=null,h=f.priorityLevel;var U=be(f.expirationTime<=V);V=e.unstable_now(),typeof U=="function"?f.callback=U:f===r(c)&&n(c),w(V)}else n(c);f=r(c)}if(f!==null)var L=!0;else{var H=r(d);H!==null&&z(j,H.startTime-V),L=!1}return L}finally{f=null,h=me,m=!1}}var C=!1,E=null,S=-1,A=5,M=-1;function O(){return!(e.unstable_now()-M<A)}function I(){if(E!==null){var F=e.unstable_now();M=F;var V=!0;try{V=E(!0,F)}finally{V?T():(C=!1,E=null)}}else C=!1}var T;if(typeof b=="function")T=function(){b(I)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,q=k.port2;k.port1.onmessage=I,T=function(){q.postMessage(null)}}else T=function(){v(I,0)};function B(F){E=F,C||(C=!0,T())}function z(F,V){S=v(function(){F(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){x||m||(x=!0,B(_))},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(F){switch(h){case 1:case 2:case 3:var V=3;break;default:V=h}var me=h;h=V;try{return F()}finally{h=me}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,V){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var me=h;h=F;try{return V()}finally{h=me}},e.unstable_scheduleCallback=function(F,V,me){var be=e.unstable_now();switch(typeof me=="object"&&me!==null?(me=me.delay,me=typeof me=="number"&&0<me?be+me:be):me=be,F){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=me+U,F={id:u++,callback:V,priorityLevel:F,startTime:me,expirationTime:U,sortIndex:-1},me>be?(F.sortIndex=me,t(d,F),r(c)===null&&F===r(d)&&(g?(y(S),S=-1):g=!0,z(j,me-be))):(F.sortIndex=U,t(c,F),x||m||(x=!0,B(_))),F},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(F){var V=h;return function(){var me=h;h=V;try{return F.apply(this,arguments)}finally{h=me}}}})(nW);rW.exports=nW;var Xie=rW.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yie=p,Md=Xie;function Rn(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var aW=new Set,hw={};function ux(e,t){r0(e,t),r0(e+"Capture",t)}function r0(e,t){for(hw[e]=t,e=0;e<t.length;e++)aW.add(t[e])}var Tm=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vk=Object.prototype.hasOwnProperty,Jie=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,UF={},VF={};function Qie(e){return Vk.call(VF,e)?!0:Vk.call(UF,e)?!1:Jie.test(e)?VF[e]=!0:(UF[e]=!0,!1)}function Zie(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function ele(e,t,r,n){if(t===null||typeof t>"u"||Zie(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function _c(e,t,r,n,s,o,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=i}var El={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){El[e]=new _c(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];El[t]=new _c(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){El[e]=new _c(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){El[e]=new _c(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){El[e]=new _c(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){El[e]=new _c(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){El[e]=new _c(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){El[e]=new _c(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){El[e]=new _c(e,5,!1,e.toLowerCase(),null,!1,!1)});var Z3=/[\-:]([a-z])/g;function e4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Z3,e4);El[t]=new _c(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Z3,e4);El[t]=new _c(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Z3,e4);El[t]=new _c(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){El[e]=new _c(e,1,!1,e.toLowerCase(),null,!1,!1)});El.xlinkHref=new _c("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){El[e]=new _c(e,1,!1,e.toLowerCase(),null,!0,!0)});function t4(e,t,r,n){var s=El.hasOwnProperty(t)?El[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(ele(t,r,s,n)&&(r=null),n||s===null?Qie(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Gm=Yie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gj=Symbol.for("react.element"),uv=Symbol.for("react.portal"),fv=Symbol.for("react.fragment"),r4=Symbol.for("react.strict_mode"),Wk=Symbol.for("react.profiler"),sW=Symbol.for("react.provider"),oW=Symbol.for("react.context"),n4=Symbol.for("react.forward_ref"),Hk=Symbol.for("react.suspense"),Gk=Symbol.for("react.suspense_list"),a4=Symbol.for("react.memo"),yh=Symbol.for("react.lazy"),iW=Symbol.for("react.offscreen"),WF=Symbol.iterator;function Ry(e){return e===null||typeof e!="object"?null:(e=WF&&e[WF]||e["@@iterator"],typeof e=="function"?e:null)}var ni=Object.assign,aP;function gb(e){if(aP===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);aP=t&&t[1]||""}return`
`+aP+e}var sP=!1;function oP(e,t){if(!e||sP)return"";sP=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),o=n.stack.split(`
`),i=s.length-1,l=o.length-1;1<=i&&0<=l&&s[i]!==o[l];)l--;for(;1<=i&&0<=l;i--,l--)if(s[i]!==o[l]){if(i!==1||l!==1)do if(i--,l--,0>l||s[i]!==o[l]){var c=`
`+s[i].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=i&&0<=l);break}}}finally{sP=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?gb(e):""}function tle(e){switch(e.tag){case 5:return gb(e.type);case 16:return gb("Lazy");case 13:return gb("Suspense");case 19:return gb("SuspenseList");case 0:case 2:case 15:return e=oP(e.type,!1),e;case 11:return e=oP(e.type.render,!1),e;case 1:return e=oP(e.type,!0),e;default:return""}}function Kk(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case fv:return"Fragment";case uv:return"Portal";case Wk:return"Profiler";case r4:return"StrictMode";case Hk:return"Suspense";case Gk:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case oW:return(e.displayName||"Context")+".Consumer";case sW:return(e._context.displayName||"Context")+".Provider";case n4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case a4:return t=e.displayName||null,t!==null?t:Kk(e.type)||"Memo";case yh:t=e._payload,e=e._init;try{return Kk(e(t))}catch{}}return null}function rle(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Kk(t);case 8:return t===r4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function up(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function lW(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function nle(e){var t=lW(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(i){n=""+i,o.call(this,i)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Kj(e){e._valueTracker||(e._valueTracker=nle(e))}function cW(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=lW(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function H2(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Xk(e,t){var r=t.checked;return ni({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function HF(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=up(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function dW(e,t){t=t.checked,t!=null&&t4(e,"checked",t,!1)}function Yk(e,t){dW(e,t);var r=up(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Jk(e,t.type,r):t.hasOwnProperty("defaultValue")&&Jk(e,t.type,up(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function GF(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Jk(e,t,r){(t!=="number"||H2(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var xb=Array.isArray;function Mv(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+up(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function Qk(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Rn(91));return ni({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function KF(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Rn(92));if(xb(r)){if(1<r.length)throw Error(Rn(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:up(r)}}function uW(e,t){var r=up(t.value),n=up(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function XF(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function fW(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zk(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?fW(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Xj,mW=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Xj=Xj||document.createElement("div"),Xj.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Xj.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function pw(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ale=["Webkit","ms","Moz","O"];Object.keys(Pb).forEach(function(e){ale.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Pb[t]=Pb[e]})});function hW(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Pb.hasOwnProperty(e)&&Pb[e]?(""+t).trim():t+"px"}function pW(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=hW(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var sle=ni({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eI(e,t){if(t){if(sle[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Rn(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Rn(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Rn(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Rn(62))}}function tI(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rI=null;function s4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var nI=null,Rv=null,Fv=null;function YF(e){if(e=K1(e)){if(typeof nI!="function")throw Error(Rn(280));var t=e.stateNode;t&&(t=AC(t),nI(e.stateNode,e.type,t))}}function gW(e){Rv?Fv?Fv.push(e):Fv=[e]:Rv=e}function xW(){if(Rv){var e=Rv,t=Fv;if(Fv=Rv=null,YF(e),t)for(e=0;e<t.length;e++)YF(t[e])}}function vW(e,t){return e(t)}function yW(){}var iP=!1;function bW(e,t,r){if(iP)return e(t,r);iP=!0;try{return vW(e,t,r)}finally{iP=!1,(Rv!==null||Fv!==null)&&(yW(),xW())}}function gw(e,t){var r=e.stateNode;if(r===null)return null;var n=AC(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Rn(231,t,typeof r));return r}var aI=!1;if(Tm)try{var Fy={};Object.defineProperty(Fy,"passive",{get:function(){aI=!0}}),window.addEventListener("test",Fy,Fy),window.removeEventListener("test",Fy,Fy)}catch{aI=!1}function ole(e,t,r,n,s,o,i,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(u){this.onError(u)}}var Eb=!1,G2=null,K2=!1,sI=null,ile={onError:function(e){Eb=!0,G2=e}};function lle(e,t,r,n,s,o,i,l,c){Eb=!1,G2=null,ole.apply(ile,arguments)}function cle(e,t,r,n,s,o,i,l,c){if(lle.apply(this,arguments),Eb){if(Eb){var d=G2;Eb=!1,G2=null}else throw Error(Rn(198));K2||(K2=!0,sI=d)}}function fx(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function wW(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function JF(e){if(fx(e)!==e)throw Error(Rn(188))}function dle(e){var t=e.alternate;if(!t){if(t=fx(e),t===null)throw Error(Rn(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var o=s.alternate;if(o===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===r)return JF(s),e;if(o===n)return JF(s),t;o=o.sibling}throw Error(Rn(188))}if(r.return!==n.return)r=s,n=o;else{for(var i=!1,l=s.child;l;){if(l===r){i=!0,r=s,n=o;break}if(l===n){i=!0,n=s,r=o;break}l=l.sibling}if(!i){for(l=o.child;l;){if(l===r){i=!0,r=o,n=s;break}if(l===n){i=!0,n=o,r=s;break}l=l.sibling}if(!i)throw Error(Rn(189))}}if(r.alternate!==n)throw Error(Rn(190))}if(r.tag!==3)throw Error(Rn(188));return r.stateNode.current===r?e:t}function jW(e){return e=dle(e),e!==null?_W(e):null}function _W(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=_W(e);if(t!==null)return t;e=e.sibling}return null}var NW=Md.unstable_scheduleCallback,QF=Md.unstable_cancelCallback,ule=Md.unstable_shouldYield,fle=Md.unstable_requestPaint,vi=Md.unstable_now,mle=Md.unstable_getCurrentPriorityLevel,o4=Md.unstable_ImmediatePriority,SW=Md.unstable_UserBlockingPriority,X2=Md.unstable_NormalPriority,hle=Md.unstable_LowPriority,CW=Md.unstable_IdlePriority,_C=null,Lf=null;function ple(e){if(Lf&&typeof Lf.onCommitFiberRoot=="function")try{Lf.onCommitFiberRoot(_C,e,void 0,(e.current.flags&128)===128)}catch{}}var Zu=Math.clz32?Math.clz32:vle,gle=Math.log,xle=Math.LN2;function vle(e){return e>>>=0,e===0?32:31-(gle(e)/xle|0)|0}var Yj=64,Jj=4194304;function vb(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Y2(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,o=e.pingedLanes,i=r&268435455;if(i!==0){var l=i&~s;l!==0?n=vb(l):(o&=i,o!==0&&(n=vb(o)))}else i=r&~s,i!==0?n=vb(i):o!==0&&(n=vb(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,o=t&-t,s>=o||s===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Zu(t),s=1<<r,n|=e[r],t&=~s;return n}function yle(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ble(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,o=e.pendingLanes;0<o;){var i=31-Zu(o),l=1<<i,c=s[i];c===-1?(!(l&r)||l&n)&&(s[i]=yle(l,t)):c<=t&&(e.expiredLanes|=l),o&=~l}}function oI(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function AW(){var e=Yj;return Yj<<=1,!(Yj&4194240)&&(Yj=64),e}function lP(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function H1(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Zu(t),e[t]=r}function wle(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-Zu(r),o=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~o}}function i4(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Zu(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var ho=0;function PW(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var EW,l4,kW,IW,OW,iI=!1,Qj=[],zh=null,Uh=null,Vh=null,xw=new Map,vw=new Map,Nh=[],jle="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ZF(e,t){switch(e){case"focusin":case"focusout":zh=null;break;case"dragenter":case"dragleave":Uh=null;break;case"mouseover":case"mouseout":Vh=null;break;case"pointerover":case"pointerout":xw.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":vw.delete(t.pointerId)}}function Ly(e,t,r,n,s,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[s]},t!==null&&(t=K1(t),t!==null&&l4(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function _le(e,t,r,n,s){switch(t){case"focusin":return zh=Ly(zh,e,t,r,n,s),!0;case"dragenter":return Uh=Ly(Uh,e,t,r,n,s),!0;case"mouseover":return Vh=Ly(Vh,e,t,r,n,s),!0;case"pointerover":var o=s.pointerId;return xw.set(o,Ly(xw.get(o)||null,e,t,r,n,s)),!0;case"gotpointercapture":return o=s.pointerId,vw.set(o,Ly(vw.get(o)||null,e,t,r,n,s)),!0}return!1}function TW(e){var t=fg(e.target);if(t!==null){var r=fx(t);if(r!==null){if(t=r.tag,t===13){if(t=wW(r),t!==null){e.blockedOn=t,OW(e.priority,function(){kW(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function p2(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=lI(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);rI=n,r.target.dispatchEvent(n),rI=null}else return t=K1(r),t!==null&&l4(t),e.blockedOn=r,!1;t.shift()}return!0}function eL(e,t,r){p2(e)&&r.delete(t)}function Nle(){iI=!1,zh!==null&&p2(zh)&&(zh=null),Uh!==null&&p2(Uh)&&(Uh=null),Vh!==null&&p2(Vh)&&(Vh=null),xw.forEach(eL),vw.forEach(eL)}function $y(e,t){e.blockedOn===t&&(e.blockedOn=null,iI||(iI=!0,Md.unstable_scheduleCallback(Md.unstable_NormalPriority,Nle)))}function yw(e){function t(s){return $y(s,e)}if(0<Qj.length){$y(Qj[0],e);for(var r=1;r<Qj.length;r++){var n=Qj[r];n.blockedOn===e&&(n.blockedOn=null)}}for(zh!==null&&$y(zh,e),Uh!==null&&$y(Uh,e),Vh!==null&&$y(Vh,e),xw.forEach(t),vw.forEach(t),r=0;r<Nh.length;r++)n=Nh[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Nh.length&&(r=Nh[0],r.blockedOn===null);)TW(r),r.blockedOn===null&&Nh.shift()}var Lv=Gm.ReactCurrentBatchConfig,J2=!0;function Sle(e,t,r,n){var s=ho,o=Lv.transition;Lv.transition=null;try{ho=1,c4(e,t,r,n)}finally{ho=s,Lv.transition=o}}function Cle(e,t,r,n){var s=ho,o=Lv.transition;Lv.transition=null;try{ho=4,c4(e,t,r,n)}finally{ho=s,Lv.transition=o}}function c4(e,t,r,n){if(J2){var s=lI(e,t,r,n);if(s===null)vP(e,t,n,Q2,r),ZF(e,n);else if(_le(s,e,t,r,n))n.stopPropagation();else if(ZF(e,n),t&4&&-1<jle.indexOf(e)){for(;s!==null;){var o=K1(s);if(o!==null&&EW(o),o=lI(e,t,r,n),o===null&&vP(e,t,n,Q2,r),o===s)break;s=o}s!==null&&n.stopPropagation()}else vP(e,t,n,null,r)}}var Q2=null;function lI(e,t,r,n){if(Q2=null,e=s4(n),e=fg(e),e!==null)if(t=fx(e),t===null)e=null;else if(r=t.tag,r===13){if(e=wW(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Q2=e,null}function DW(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mle()){case o4:return 1;case SW:return 4;case X2:case hle:return 16;case CW:return 536870912;default:return 16}default:return 16}}var Ih=null,d4=null,g2=null;function MW(){if(g2)return g2;var e,t=d4,r=t.length,n,s="value"in Ih?Ih.value:Ih.textContent,o=s.length;for(e=0;e<r&&t[e]===s[e];e++);var i=r-e;for(n=1;n<=i&&t[r-n]===s[o-n];n++);return g2=s.slice(e,1<n?1-n:void 0)}function x2(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Zj(){return!0}function tL(){return!1}function Ld(e){function t(r,n,s,o,i){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(r=e[l],this[l]=r?r(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Zj:tL,this.isPropagationStopped=tL,this}return ni(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Zj)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Zj)},persist:function(){},isPersistent:Zj}),t}var Q0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},u4=Ld(Q0),G1=ni({},Q0,{view:0,detail:0}),Ale=Ld(G1),cP,dP,By,NC=ni({},G1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:f4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==By&&(By&&e.type==="mousemove"?(cP=e.screenX-By.screenX,dP=e.screenY-By.screenY):dP=cP=0,By=e),cP)},movementY:function(e){return"movementY"in e?e.movementY:dP}}),rL=Ld(NC),Ple=ni({},NC,{dataTransfer:0}),Ele=Ld(Ple),kle=ni({},G1,{relatedTarget:0}),uP=Ld(kle),Ile=ni({},Q0,{animationName:0,elapsedTime:0,pseudoElement:0}),Ole=Ld(Ile),Tle=ni({},Q0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Dle=Ld(Tle),Mle=ni({},Q0,{data:0}),nL=Ld(Mle),Rle={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fle={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lle={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $le(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Lle[e])?!!t[e]:!1}function f4(){return $le}var Ble=ni({},G1,{key:function(e){if(e.key){var t=Rle[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=x2(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Fle[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:f4,charCode:function(e){return e.type==="keypress"?x2(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?x2(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),qle=Ld(Ble),zle=ni({},NC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),aL=Ld(zle),Ule=ni({},G1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:f4}),Vle=Ld(Ule),Wle=ni({},Q0,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hle=Ld(Wle),Gle=ni({},NC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Kle=Ld(Gle),Xle=[9,13,27,32],m4=Tm&&"CompositionEvent"in window,kb=null;Tm&&"documentMode"in document&&(kb=document.documentMode);var Yle=Tm&&"TextEvent"in window&&!kb,RW=Tm&&(!m4||kb&&8<kb&&11>=kb),sL=String.fromCharCode(32),oL=!1;function FW(e,t){switch(e){case"keyup":return Xle.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function LW(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var mv=!1;function Jle(e,t){switch(e){case"compositionend":return LW(t);case"keypress":return t.which!==32?null:(oL=!0,sL);case"textInput":return e=t.data,e===sL&&oL?null:e;default:return null}}function Qle(e,t){if(mv)return e==="compositionend"||!m4&&FW(e,t)?(e=MW(),g2=d4=Ih=null,mv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return RW&&t.locale!=="ko"?null:t.data;default:return null}}var Zle={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iL(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Zle[e.type]:t==="textarea"}function $W(e,t,r,n){gW(n),t=Z2(t,"onChange"),0<t.length&&(r=new u4("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Ib=null,bw=null;function ece(e){YW(e,0)}function SC(e){var t=gv(e);if(cW(t))return e}function tce(e,t){if(e==="change")return t}var BW=!1;if(Tm){var fP;if(Tm){var mP="oninput"in document;if(!mP){var lL=document.createElement("div");lL.setAttribute("oninput","return;"),mP=typeof lL.oninput=="function"}fP=mP}else fP=!1;BW=fP&&(!document.documentMode||9<document.documentMode)}function cL(){Ib&&(Ib.detachEvent("onpropertychange",qW),bw=Ib=null)}function qW(e){if(e.propertyName==="value"&&SC(bw)){var t=[];$W(t,bw,e,s4(e)),bW(ece,t)}}function rce(e,t,r){e==="focusin"?(cL(),Ib=t,bw=r,Ib.attachEvent("onpropertychange",qW)):e==="focusout"&&cL()}function nce(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return SC(bw)}function ace(e,t){if(e==="click")return SC(t)}function sce(e,t){if(e==="input"||e==="change")return SC(t)}function oce(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var af=typeof Object.is=="function"?Object.is:oce;function ww(e,t){if(af(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!Vk.call(t,s)||!af(e[s],t[s]))return!1}return!0}function dL(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function uL(e,t){var r=dL(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=dL(r)}}function zW(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?zW(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function UW(){for(var e=window,t=H2();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=H2(e.document)}return t}function h4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function ice(e){var t=UW(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&zW(r.ownerDocument.documentElement,r)){if(n!==null&&h4(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,o=Math.min(n.start,s);n=n.end===void 0?o:Math.min(n.end,s),!e.extend&&o>n&&(s=n,n=o,o=s),s=uL(r,o);var i=uL(r,n);s&&i&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var lce=Tm&&"documentMode"in document&&11>=document.documentMode,hv=null,cI=null,Ob=null,dI=!1;function fL(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;dI||hv==null||hv!==H2(n)||(n=hv,"selectionStart"in n&&h4(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Ob&&ww(Ob,n)||(Ob=n,n=Z2(cI,"onSelect"),0<n.length&&(t=new u4("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=hv)))}function e_(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var pv={animationend:e_("Animation","AnimationEnd"),animationiteration:e_("Animation","AnimationIteration"),animationstart:e_("Animation","AnimationStart"),transitionend:e_("Transition","TransitionEnd")},hP={},VW={};Tm&&(VW=document.createElement("div").style,"AnimationEvent"in window||(delete pv.animationend.animation,delete pv.animationiteration.animation,delete pv.animationstart.animation),"TransitionEvent"in window||delete pv.transitionend.transition);function CC(e){if(hP[e])return hP[e];if(!pv[e])return e;var t=pv[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in VW)return hP[e]=t[r];return e}var WW=CC("animationend"),HW=CC("animationiteration"),GW=CC("animationstart"),KW=CC("transitionend"),XW=new Map,mL="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Np(e,t){XW.set(e,t),ux(t,[e])}for(var pP=0;pP<mL.length;pP++){var gP=mL[pP],cce=gP.toLowerCase(),dce=gP[0].toUpperCase()+gP.slice(1);Np(cce,"on"+dce)}Np(WW,"onAnimationEnd");Np(HW,"onAnimationIteration");Np(GW,"onAnimationStart");Np("dblclick","onDoubleClick");Np("focusin","onFocus");Np("focusout","onBlur");Np(KW,"onTransitionEnd");r0("onMouseEnter",["mouseout","mouseover"]);r0("onMouseLeave",["mouseout","mouseover"]);r0("onPointerEnter",["pointerout","pointerover"]);r0("onPointerLeave",["pointerout","pointerover"]);ux("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ux("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ux("onBeforeInput",["compositionend","keypress","textInput","paste"]);ux("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ux("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ux("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uce=new Set("cancel close invalid load scroll toggle".split(" ").concat(yb));function hL(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,cle(n,t,void 0,e),e.currentTarget=null}function YW(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var i=n.length-1;0<=i;i--){var l=n[i],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==o&&s.isPropagationStopped())break e;hL(s,l,d),o=c}else for(i=0;i<n.length;i++){if(l=n[i],c=l.instance,d=l.currentTarget,l=l.listener,c!==o&&s.isPropagationStopped())break e;hL(s,l,d),o=c}}}if(K2)throw e=sI,K2=!1,sI=null,e}function Fo(e,t){var r=t[pI];r===void 0&&(r=t[pI]=new Set);var n=e+"__bubble";r.has(n)||(JW(t,e,2,!1),r.add(n))}function xP(e,t,r){var n=0;t&&(n|=4),JW(r,e,n,t)}var t_="_reactListening"+Math.random().toString(36).slice(2);function jw(e){if(!e[t_]){e[t_]=!0,aW.forEach(function(r){r!=="selectionchange"&&(uce.has(r)||xP(r,!1,e),xP(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[t_]||(t[t_]=!0,xP("selectionchange",!1,t))}}function JW(e,t,r,n){switch(DW(t)){case 1:var s=Sle;break;case 4:s=Cle;break;default:s=c4}r=s.bind(null,t,r,e),s=void 0,!aI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function vP(e,t,r,n,s){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var l=n.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(i===4)for(i=n.return;i!==null;){var c=i.tag;if((c===3||c===4)&&(c=i.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;i=i.return}for(;l!==null;){if(i=fg(l),i===null)return;if(c=i.tag,c===5||c===6){n=o=i;continue e}l=l.parentNode}}n=n.return}bW(function(){var d=o,u=s4(r),f=[];e:{var h=XW.get(e);if(h!==void 0){var m=u4,x=e;switch(e){case"keypress":if(x2(r)===0)break e;case"keydown":case"keyup":m=qle;break;case"focusin":x="focus",m=uP;break;case"focusout":x="blur",m=uP;break;case"beforeblur":case"afterblur":m=uP;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=rL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Ele;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Vle;break;case WW:case HW:case GW:m=Ole;break;case KW:m=Hle;break;case"scroll":m=Ale;break;case"wheel":m=Kle;break;case"copy":case"cut":case"paste":m=Dle;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=aL}var g=(t&4)!==0,v=!g&&e==="scroll",y=g?h!==null?h+"Capture":null:h;g=[];for(var b=d,w;b!==null;){w=b;var j=w.stateNode;if(w.tag===5&&j!==null&&(w=j,y!==null&&(j=gw(b,y),j!=null&&g.push(_w(b,j,w)))),v)break;b=b.return}0<g.length&&(h=new m(h,x,null,r,u),f.push({event:h,listeners:g}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",h&&r!==rI&&(x=r.relatedTarget||r.fromElement)&&(fg(x)||x[Dm]))break e;if((m||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,m?(x=r.relatedTarget||r.toElement,m=d,x=x?fg(x):null,x!==null&&(v=fx(x),x!==v||x.tag!==5&&x.tag!==6)&&(x=null)):(m=null,x=d),m!==x)){if(g=rL,j="onMouseLeave",y="onMouseEnter",b="mouse",(e==="pointerout"||e==="pointerover")&&(g=aL,j="onPointerLeave",y="onPointerEnter",b="pointer"),v=m==null?h:gv(m),w=x==null?h:gv(x),h=new g(j,b+"leave",m,r,u),h.target=v,h.relatedTarget=w,j=null,fg(u)===d&&(g=new g(y,b+"enter",x,r,u),g.target=w,g.relatedTarget=v,j=g),v=j,m&&x)t:{for(g=m,y=x,b=0,w=g;w;w=kx(w))b++;for(w=0,j=y;j;j=kx(j))w++;for(;0<b-w;)g=kx(g),b--;for(;0<w-b;)y=kx(y),w--;for(;b--;){if(g===y||y!==null&&g===y.alternate)break t;g=kx(g),y=kx(y)}g=null}else g=null;m!==null&&pL(f,h,m,g,!1),x!==null&&v!==null&&pL(f,v,x,g,!0)}}e:{if(h=d?gv(d):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var _=tce;else if(iL(h))if(BW)_=sce;else{_=nce;var C=rce}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(_=ace);if(_&&(_=_(e,d))){$W(f,_,r,u);break e}C&&C(e,h,d),e==="focusout"&&(C=h._wrapperState)&&C.controlled&&h.type==="number"&&Jk(h,"number",h.value)}switch(C=d?gv(d):window,e){case"focusin":(iL(C)||C.contentEditable==="true")&&(hv=C,cI=d,Ob=null);break;case"focusout":Ob=cI=hv=null;break;case"mousedown":dI=!0;break;case"contextmenu":case"mouseup":case"dragend":dI=!1,fL(f,r,u);break;case"selectionchange":if(lce)break;case"keydown":case"keyup":fL(f,r,u)}var E;if(m4)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else mv?FW(e,r)&&(S="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(S="onCompositionStart");S&&(RW&&r.locale!=="ko"&&(mv||S!=="onCompositionStart"?S==="onCompositionEnd"&&mv&&(E=MW()):(Ih=u,d4="value"in Ih?Ih.value:Ih.textContent,mv=!0)),C=Z2(d,S),0<C.length&&(S=new nL(S,e,null,r,u),f.push({event:S,listeners:C}),E?S.data=E:(E=LW(r),E!==null&&(S.data=E)))),(E=Yle?Jle(e,r):Qle(e,r))&&(d=Z2(d,"onBeforeInput"),0<d.length&&(u=new nL("onBeforeInput","beforeinput",null,r,u),f.push({event:u,listeners:d}),u.data=E))}YW(f,t)})}function _w(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Z2(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=gw(e,r),o!=null&&n.unshift(_w(e,o,s)),o=gw(e,t),o!=null&&n.push(_w(e,o,s))),e=e.return}return n}function kx(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pL(e,t,r,n,s){for(var o=t._reactName,i=[];r!==null&&r!==n;){var l=r,c=l.alternate,d=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&d!==null&&(l=d,s?(c=gw(r,o),c!=null&&i.unshift(_w(r,c,l))):s||(c=gw(r,o),c!=null&&i.push(_w(r,c,l)))),r=r.return}i.length!==0&&e.push({event:t,listeners:i})}var fce=/\r\n?/g,mce=/\u0000|\uFFFD/g;function gL(e){return(typeof e=="string"?e:""+e).replace(fce,`
`).replace(mce,"")}function r_(e,t,r){if(t=gL(t),gL(e)!==t&&r)throw Error(Rn(425))}function eN(){}var uI=null,fI=null;function mI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var hI=typeof setTimeout=="function"?setTimeout:void 0,hce=typeof clearTimeout=="function"?clearTimeout:void 0,xL=typeof Promise=="function"?Promise:void 0,pce=typeof queueMicrotask=="function"?queueMicrotask:typeof xL<"u"?function(e){return xL.resolve(null).then(e).catch(gce)}:hI;function gce(e){setTimeout(function(){throw e})}function yP(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),yw(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);yw(t)}function Wh(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function vL(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Z0=Math.random().toString(36).slice(2),Sf="__reactFiber$"+Z0,Nw="__reactProps$"+Z0,Dm="__reactContainer$"+Z0,pI="__reactEvents$"+Z0,xce="__reactListeners$"+Z0,vce="__reactHandles$"+Z0;function fg(e){var t=e[Sf];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Dm]||r[Sf]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=vL(e);e!==null;){if(r=e[Sf])return r;e=vL(e)}return t}e=r,r=e.parentNode}return null}function K1(e){return e=e[Sf]||e[Dm],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function gv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Rn(33))}function AC(e){return e[Nw]||null}var gI=[],xv=-1;function Sp(e){return{current:e}}function qo(e){0>xv||(e.current=gI[xv],gI[xv]=null,xv--)}function ko(e,t){xv++,gI[xv]=e.current,e.current=t}var fp={},Xl=Sp(fp),zc=Sp(!1),Ug=fp;function n0(e,t){var r=e.type.contextTypes;if(!r)return fp;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in r)s[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Uc(e){return e=e.childContextTypes,e!=null}function tN(){qo(zc),qo(Xl)}function yL(e,t,r){if(Xl.current!==fp)throw Error(Rn(168));ko(Xl,t),ko(zc,r)}function QW(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(Rn(108,rle(e)||"Unknown",s));return ni({},r,n)}function rN(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||fp,Ug=Xl.current,ko(Xl,e),ko(zc,zc.current),!0}function bL(e,t,r){var n=e.stateNode;if(!n)throw Error(Rn(169));r?(e=QW(e,t,Ug),n.__reactInternalMemoizedMergedChildContext=e,qo(zc),qo(Xl),ko(Xl,e)):qo(zc),ko(zc,r)}var xm=null,PC=!1,bP=!1;function ZW(e){xm===null?xm=[e]:xm.push(e)}function yce(e){PC=!0,ZW(e)}function Cp(){if(!bP&&xm!==null){bP=!0;var e=0,t=ho;try{var r=xm;for(ho=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}xm=null,PC=!1}catch(s){throw xm!==null&&(xm=xm.slice(e+1)),NW(o4,Cp),s}finally{ho=t,bP=!1}}return null}var vv=[],yv=0,nN=null,aN=0,Zd=[],eu=0,Vg=null,wm=1,jm="";function Yp(e,t){vv[yv++]=aN,vv[yv++]=nN,nN=e,aN=t}function eH(e,t,r){Zd[eu++]=wm,Zd[eu++]=jm,Zd[eu++]=Vg,Vg=e;var n=wm;e=jm;var s=32-Zu(n)-1;n&=~(1<<s),r+=1;var o=32-Zu(t)+s;if(30<o){var i=s-s%5;o=(n&(1<<i)-1).toString(32),n>>=i,s-=i,wm=1<<32-Zu(t)+s|r<<s|n,jm=o+e}else wm=1<<o|r<<s|n,jm=e}function p4(e){e.return!==null&&(Yp(e,1),eH(e,1,0))}function g4(e){for(;e===nN;)nN=vv[--yv],vv[yv]=null,aN=vv[--yv],vv[yv]=null;for(;e===Vg;)Vg=Zd[--eu],Zd[eu]=null,jm=Zd[--eu],Zd[eu]=null,wm=Zd[--eu],Zd[eu]=null}var Ad=null,wd=null,Ho=!1,Hu=null;function tH(e,t){var r=cu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function wL(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ad=e,wd=Wh(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ad=e,wd=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Vg!==null?{id:wm,overflow:jm}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=cu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Ad=e,wd=null,!0):!1;default:return!1}}function xI(e){return(e.mode&1)!==0&&(e.flags&128)===0}function vI(e){if(Ho){var t=wd;if(t){var r=t;if(!wL(e,t)){if(xI(e))throw Error(Rn(418));t=Wh(r.nextSibling);var n=Ad;t&&wL(e,t)?tH(n,r):(e.flags=e.flags&-4097|2,Ho=!1,Ad=e)}}else{if(xI(e))throw Error(Rn(418));e.flags=e.flags&-4097|2,Ho=!1,Ad=e}}}function jL(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ad=e}function n_(e){if(e!==Ad)return!1;if(!Ho)return jL(e),Ho=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!mI(e.type,e.memoizedProps)),t&&(t=wd)){if(xI(e))throw rH(),Error(Rn(418));for(;t;)tH(e,t),t=Wh(t.nextSibling)}if(jL(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Rn(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){wd=Wh(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}wd=null}}else wd=Ad?Wh(e.stateNode.nextSibling):null;return!0}function rH(){for(var e=wd;e;)e=Wh(e.nextSibling)}function a0(){wd=Ad=null,Ho=!1}function x4(e){Hu===null?Hu=[e]:Hu.push(e)}var bce=Gm.ReactCurrentBatchConfig;function qy(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Rn(309));var n=r.stateNode}if(!n)throw Error(Rn(147,e));var s=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(i){var l=s.refs;i===null?delete l[o]:l[o]=i},t._stringRef=o,t)}if(typeof e!="string")throw Error(Rn(284));if(!r._owner)throw Error(Rn(290,e))}return e}function a_(e,t){throw e=Object.prototype.toString.call(t),Error(Rn(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _L(e){var t=e._init;return t(e._payload)}function nH(e){function t(y,b){if(e){var w=y.deletions;w===null?(y.deletions=[b],y.flags|=16):w.push(b)}}function r(y,b){if(!e)return null;for(;b!==null;)t(y,b),b=b.sibling;return null}function n(y,b){for(y=new Map;b!==null;)b.key!==null?y.set(b.key,b):y.set(b.index,b),b=b.sibling;return y}function s(y,b){return y=Xh(y,b),y.index=0,y.sibling=null,y}function o(y,b,w){return y.index=w,e?(w=y.alternate,w!==null?(w=w.index,w<b?(y.flags|=2,b):w):(y.flags|=2,b)):(y.flags|=1048576,b)}function i(y){return e&&y.alternate===null&&(y.flags|=2),y}function l(y,b,w,j){return b===null||b.tag!==6?(b=AP(w,y.mode,j),b.return=y,b):(b=s(b,w),b.return=y,b)}function c(y,b,w,j){var _=w.type;return _===fv?u(y,b,w.props.children,j,w.key):b!==null&&(b.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===yh&&_L(_)===b.type)?(j=s(b,w.props),j.ref=qy(y,b,w),j.return=y,j):(j=N2(w.type,w.key,w.props,null,y.mode,j),j.ref=qy(y,b,w),j.return=y,j)}function d(y,b,w,j){return b===null||b.tag!==4||b.stateNode.containerInfo!==w.containerInfo||b.stateNode.implementation!==w.implementation?(b=PP(w,y.mode,j),b.return=y,b):(b=s(b,w.children||[]),b.return=y,b)}function u(y,b,w,j,_){return b===null||b.tag!==7?(b=Eg(w,y.mode,j,_),b.return=y,b):(b=s(b,w),b.return=y,b)}function f(y,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return b=AP(""+b,y.mode,w),b.return=y,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Gj:return w=N2(b.type,b.key,b.props,null,y.mode,w),w.ref=qy(y,null,b),w.return=y,w;case uv:return b=PP(b,y.mode,w),b.return=y,b;case yh:var j=b._init;return f(y,j(b._payload),w)}if(xb(b)||Ry(b))return b=Eg(b,y.mode,w,null),b.return=y,b;a_(y,b)}return null}function h(y,b,w,j){var _=b!==null?b.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return _!==null?null:l(y,b,""+w,j);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Gj:return w.key===_?c(y,b,w,j):null;case uv:return w.key===_?d(y,b,w,j):null;case yh:return _=w._init,h(y,b,_(w._payload),j)}if(xb(w)||Ry(w))return _!==null?null:u(y,b,w,j,null);a_(y,w)}return null}function m(y,b,w,j,_){if(typeof j=="string"&&j!==""||typeof j=="number")return y=y.get(w)||null,l(b,y,""+j,_);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Gj:return y=y.get(j.key===null?w:j.key)||null,c(b,y,j,_);case uv:return y=y.get(j.key===null?w:j.key)||null,d(b,y,j,_);case yh:var C=j._init;return m(y,b,w,C(j._payload),_)}if(xb(j)||Ry(j))return y=y.get(w)||null,u(b,y,j,_,null);a_(b,j)}return null}function x(y,b,w,j){for(var _=null,C=null,E=b,S=b=0,A=null;E!==null&&S<w.length;S++){E.index>S?(A=E,E=null):A=E.sibling;var M=h(y,E,w[S],j);if(M===null){E===null&&(E=A);break}e&&E&&M.alternate===null&&t(y,E),b=o(M,b,S),C===null?_=M:C.sibling=M,C=M,E=A}if(S===w.length)return r(y,E),Ho&&Yp(y,S),_;if(E===null){for(;S<w.length;S++)E=f(y,w[S],j),E!==null&&(b=o(E,b,S),C===null?_=E:C.sibling=E,C=E);return Ho&&Yp(y,S),_}for(E=n(y,E);S<w.length;S++)A=m(E,y,S,w[S],j),A!==null&&(e&&A.alternate!==null&&E.delete(A.key===null?S:A.key),b=o(A,b,S),C===null?_=A:C.sibling=A,C=A);return e&&E.forEach(function(O){return t(y,O)}),Ho&&Yp(y,S),_}function g(y,b,w,j){var _=Ry(w);if(typeof _!="function")throw Error(Rn(150));if(w=_.call(w),w==null)throw Error(Rn(151));for(var C=_=null,E=b,S=b=0,A=null,M=w.next();E!==null&&!M.done;S++,M=w.next()){E.index>S?(A=E,E=null):A=E.sibling;var O=h(y,E,M.value,j);if(O===null){E===null&&(E=A);break}e&&E&&O.alternate===null&&t(y,E),b=o(O,b,S),C===null?_=O:C.sibling=O,C=O,E=A}if(M.done)return r(y,E),Ho&&Yp(y,S),_;if(E===null){for(;!M.done;S++,M=w.next())M=f(y,M.value,j),M!==null&&(b=o(M,b,S),C===null?_=M:C.sibling=M,C=M);return Ho&&Yp(y,S),_}for(E=n(y,E);!M.done;S++,M=w.next())M=m(E,y,S,M.value,j),M!==null&&(e&&M.alternate!==null&&E.delete(M.key===null?S:M.key),b=o(M,b,S),C===null?_=M:C.sibling=M,C=M);return e&&E.forEach(function(I){return t(y,I)}),Ho&&Yp(y,S),_}function v(y,b,w,j){if(typeof w=="object"&&w!==null&&w.type===fv&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Gj:e:{for(var _=w.key,C=b;C!==null;){if(C.key===_){if(_=w.type,_===fv){if(C.tag===7){r(y,C.sibling),b=s(C,w.props.children),b.return=y,y=b;break e}}else if(C.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===yh&&_L(_)===C.type){r(y,C.sibling),b=s(C,w.props),b.ref=qy(y,C,w),b.return=y,y=b;break e}r(y,C);break}else t(y,C);C=C.sibling}w.type===fv?(b=Eg(w.props.children,y.mode,j,w.key),b.return=y,y=b):(j=N2(w.type,w.key,w.props,null,y.mode,j),j.ref=qy(y,b,w),j.return=y,y=j)}return i(y);case uv:e:{for(C=w.key;b!==null;){if(b.key===C)if(b.tag===4&&b.stateNode.containerInfo===w.containerInfo&&b.stateNode.implementation===w.implementation){r(y,b.sibling),b=s(b,w.children||[]),b.return=y,y=b;break e}else{r(y,b);break}else t(y,b);b=b.sibling}b=PP(w,y.mode,j),b.return=y,y=b}return i(y);case yh:return C=w._init,v(y,b,C(w._payload),j)}if(xb(w))return x(y,b,w,j);if(Ry(w))return g(y,b,w,j);a_(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,b!==null&&b.tag===6?(r(y,b.sibling),b=s(b,w),b.return=y,y=b):(r(y,b),b=AP(w,y.mode,j),b.return=y,y=b),i(y)):r(y,b)}return v}var s0=nH(!0),aH=nH(!1),sN=Sp(null),oN=null,bv=null,v4=null;function y4(){v4=bv=oN=null}function b4(e){var t=sN.current;qo(sN),e._currentValue=t}function yI(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function $v(e,t){oN=e,v4=bv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&($c=!0),e.firstContext=null)}function vu(e){var t=e._currentValue;if(v4!==e)if(e={context:e,memoizedValue:t,next:null},bv===null){if(oN===null)throw Error(Rn(308));bv=e,oN.dependencies={lanes:0,firstContext:e}}else bv=bv.next=e;return t}var mg=null;function w4(e){mg===null?mg=[e]:mg.push(e)}function sH(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,w4(t)):(r.next=s.next,s.next=r),t.interleaved=r,Mm(e,n)}function Mm(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var bh=!1;function j4(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oH(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Pm(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Hh(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ks&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,Mm(e,r)}return s=n.interleaved,s===null?(t.next=t,w4(n)):(t.next=s.next,s.next=t),n.interleaved=t,Mm(e,r)}function v2(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,i4(e,r)}}function NL(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var i={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?s=o=i:o=o.next=i,r=r.next}while(r!==null);o===null?s=o=t:o=o.next=t}else s=o=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function iN(e,t,r,n){var s=e.updateQueue;bh=!1;var o=s.firstBaseUpdate,i=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,i===null?o=d:i.next=d,i=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==i&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(o!==null){var f=s.baseState;i=0,u=d=c=null,l=o;do{var h=l.lane,m=l.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:m,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var x=e,g=l;switch(h=t,m=r,g.tag){case 1:if(x=g.payload,typeof x=="function"){f=x.call(m,f,h);break e}f=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,h=typeof x=="function"?x.call(m,f,h):x,h==null)break e;f=ni({},f,h);break e;case 2:bh=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,h=s.effects,h===null?s.effects=[l]:h.push(l))}else m={eventTime:m,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=m,c=f):u=u.next=m,i|=h;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;h=l,l=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(u===null&&(c=f),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,t=s.shared.interleaved,t!==null){s=t;do i|=s.lane,s=s.next;while(s!==t)}else o===null&&(s.shared.lanes=0);Hg|=i,e.lanes=i,e.memoizedState=f}}function SL(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(Rn(191,s));s.call(n)}}}var X1={},$f=Sp(X1),Sw=Sp(X1),Cw=Sp(X1);function hg(e){if(e===X1)throw Error(Rn(174));return e}function _4(e,t){switch(ko(Cw,t),ko(Sw,e),ko($f,X1),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Zk(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Zk(t,e)}qo($f),ko($f,t)}function o0(){qo($f),qo(Sw),qo(Cw)}function iH(e){hg(Cw.current);var t=hg($f.current),r=Zk(t,e.type);t!==r&&(ko(Sw,e),ko($f,r))}function N4(e){Sw.current===e&&(qo($f),qo(Sw))}var Xo=Sp(0);function lN(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var wP=[];function S4(){for(var e=0;e<wP.length;e++)wP[e]._workInProgressVersionPrimary=null;wP.length=0}var y2=Gm.ReactCurrentDispatcher,jP=Gm.ReactCurrentBatchConfig,Wg=0,ti=null,Ui=null,ol=null,cN=!1,Tb=!1,Aw=0,wce=0;function Rl(){throw Error(Rn(321))}function C4(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!af(e[r],t[r]))return!1;return!0}function A4(e,t,r,n,s,o){if(Wg=o,ti=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,y2.current=e===null||e.memoizedState===null?Sce:Cce,e=r(n,s),Tb){o=0;do{if(Tb=!1,Aw=0,25<=o)throw Error(Rn(301));o+=1,ol=Ui=null,t.updateQueue=null,y2.current=Ace,e=r(n,s)}while(Tb)}if(y2.current=dN,t=Ui!==null&&Ui.next!==null,Wg=0,ol=Ui=ti=null,cN=!1,t)throw Error(Rn(300));return e}function P4(){var e=Aw!==0;return Aw=0,e}function _f(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ol===null?ti.memoizedState=ol=e:ol=ol.next=e,ol}function yu(){if(Ui===null){var e=ti.alternate;e=e!==null?e.memoizedState:null}else e=Ui.next;var t=ol===null?ti.memoizedState:ol.next;if(t!==null)ol=t,Ui=e;else{if(e===null)throw Error(Rn(310));Ui=e,e={memoizedState:Ui.memoizedState,baseState:Ui.baseState,baseQueue:Ui.baseQueue,queue:Ui.queue,next:null},ol===null?ti.memoizedState=ol=e:ol=ol.next=e}return ol}function Pw(e,t){return typeof t=="function"?t(e):t}function _P(e){var t=yu(),r=t.queue;if(r===null)throw Error(Rn(311));r.lastRenderedReducer=e;var n=Ui,s=n.baseQueue,o=r.pending;if(o!==null){if(s!==null){var i=s.next;s.next=o.next,o.next=i}n.baseQueue=s=o,r.pending=null}if(s!==null){o=s.next,n=n.baseState;var l=i=null,c=null,d=o;do{var u=d.lane;if((Wg&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var f={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,i=n):c=c.next=f,ti.lanes|=u,Hg|=u}d=d.next}while(d!==null&&d!==o);c===null?i=n:c.next=l,af(n,t.memoizedState)||($c=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=c,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do o=s.lane,ti.lanes|=o,Hg|=o,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function NP(e){var t=yu(),r=t.queue;if(r===null)throw Error(Rn(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,o=t.memoizedState;if(s!==null){r.pending=null;var i=s=s.next;do o=e(o,i.action),i=i.next;while(i!==s);af(o,t.memoizedState)||($c=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function lH(){}function cH(e,t){var r=ti,n=yu(),s=t(),o=!af(n.memoizedState,s);if(o&&(n.memoizedState=s,$c=!0),n=n.queue,E4(fH.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||ol!==null&&ol.memoizedState.tag&1){if(r.flags|=2048,Ew(9,uH.bind(null,r,n,s,t),void 0,null),ul===null)throw Error(Rn(349));Wg&30||dH(r,t,s)}return s}function dH(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=ti.updateQueue,t===null?(t={lastEffect:null,stores:null},ti.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function uH(e,t,r,n){t.value=r,t.getSnapshot=n,mH(t)&&hH(e)}function fH(e,t,r){return r(function(){mH(t)&&hH(e)})}function mH(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!af(e,r)}catch{return!0}}function hH(e){var t=Mm(e,1);t!==null&&ef(t,e,1,-1)}function CL(e){var t=_f();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Pw,lastRenderedState:e},t.queue=e,e=e.dispatch=Nce.bind(null,ti,e),[t.memoizedState,e]}function Ew(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=ti.updateQueue,t===null?(t={lastEffect:null,stores:null},ti.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function pH(){return yu().memoizedState}function b2(e,t,r,n){var s=_f();ti.flags|=e,s.memoizedState=Ew(1|t,r,void 0,n===void 0?null:n)}function EC(e,t,r,n){var s=yu();n=n===void 0?null:n;var o=void 0;if(Ui!==null){var i=Ui.memoizedState;if(o=i.destroy,n!==null&&C4(n,i.deps)){s.memoizedState=Ew(t,r,o,n);return}}ti.flags|=e,s.memoizedState=Ew(1|t,r,o,n)}function AL(e,t){return b2(8390656,8,e,t)}function E4(e,t){return EC(2048,8,e,t)}function gH(e,t){return EC(4,2,e,t)}function xH(e,t){return EC(4,4,e,t)}function vH(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function yH(e,t,r){return r=r!=null?r.concat([e]):null,EC(4,4,vH.bind(null,t,e),r)}function k4(){}function bH(e,t){var r=yu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&C4(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function wH(e,t){var r=yu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&C4(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function jH(e,t,r){return Wg&21?(af(r,t)||(r=AW(),ti.lanes|=r,Hg|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,$c=!0),e.memoizedState=r)}function jce(e,t){var r=ho;ho=r!==0&&4>r?r:4,e(!0);var n=jP.transition;jP.transition={};try{e(!1),t()}finally{ho=r,jP.transition=n}}function _H(){return yu().memoizedState}function _ce(e,t,r){var n=Kh(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},NH(e))SH(t,r);else if(r=sH(e,t,r,n),r!==null){var s=yc();ef(r,e,n,s),CH(r,t,n)}}function Nce(e,t,r){var n=Kh(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(NH(e))SH(t,s);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var i=t.lastRenderedState,l=o(i,r);if(s.hasEagerState=!0,s.eagerState=l,af(l,i)){var c=t.interleaved;c===null?(s.next=s,w4(t)):(s.next=c.next,c.next=s),t.interleaved=s;return}}catch{}finally{}r=sH(e,t,s,n),r!==null&&(s=yc(),ef(r,e,n,s),CH(r,t,n))}}function NH(e){var t=e.alternate;return e===ti||t!==null&&t===ti}function SH(e,t){Tb=cN=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function CH(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,i4(e,r)}}var dN={readContext:vu,useCallback:Rl,useContext:Rl,useEffect:Rl,useImperativeHandle:Rl,useInsertionEffect:Rl,useLayoutEffect:Rl,useMemo:Rl,useReducer:Rl,useRef:Rl,useState:Rl,useDebugValue:Rl,useDeferredValue:Rl,useTransition:Rl,useMutableSource:Rl,useSyncExternalStore:Rl,useId:Rl,unstable_isNewReconciler:!1},Sce={readContext:vu,useCallback:function(e,t){return _f().memoizedState=[e,t===void 0?null:t],e},useContext:vu,useEffect:AL,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,b2(4194308,4,vH.bind(null,t,e),r)},useLayoutEffect:function(e,t){return b2(4194308,4,e,t)},useInsertionEffect:function(e,t){return b2(4,2,e,t)},useMemo:function(e,t){var r=_f();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=_f();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=_ce.bind(null,ti,e),[n.memoizedState,e]},useRef:function(e){var t=_f();return e={current:e},t.memoizedState=e},useState:CL,useDebugValue:k4,useDeferredValue:function(e){return _f().memoizedState=e},useTransition:function(){var e=CL(!1),t=e[0];return e=jce.bind(null,e[1]),_f().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=ti,s=_f();if(Ho){if(r===void 0)throw Error(Rn(407));r=r()}else{if(r=t(),ul===null)throw Error(Rn(349));Wg&30||dH(n,t,r)}s.memoizedState=r;var o={value:r,getSnapshot:t};return s.queue=o,AL(fH.bind(null,n,o,e),[e]),n.flags|=2048,Ew(9,uH.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=_f(),t=ul.identifierPrefix;if(Ho){var r=jm,n=wm;r=(n&~(1<<32-Zu(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=Aw++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=wce++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Cce={readContext:vu,useCallback:bH,useContext:vu,useEffect:E4,useImperativeHandle:yH,useInsertionEffect:gH,useLayoutEffect:xH,useMemo:wH,useReducer:_P,useRef:pH,useState:function(){return _P(Pw)},useDebugValue:k4,useDeferredValue:function(e){var t=yu();return jH(t,Ui.memoizedState,e)},useTransition:function(){var e=_P(Pw)[0],t=yu().memoizedState;return[e,t]},useMutableSource:lH,useSyncExternalStore:cH,useId:_H,unstable_isNewReconciler:!1},Ace={readContext:vu,useCallback:bH,useContext:vu,useEffect:E4,useImperativeHandle:yH,useInsertionEffect:gH,useLayoutEffect:xH,useMemo:wH,useReducer:NP,useRef:pH,useState:function(){return NP(Pw)},useDebugValue:k4,useDeferredValue:function(e){var t=yu();return Ui===null?t.memoizedState=e:jH(t,Ui.memoizedState,e)},useTransition:function(){var e=NP(Pw)[0],t=yu().memoizedState;return[e,t]},useMutableSource:lH,useSyncExternalStore:cH,useId:_H,unstable_isNewReconciler:!1};function qu(e,t){if(e&&e.defaultProps){t=ni({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function bI(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:ni({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var kC={isMounted:function(e){return(e=e._reactInternals)?fx(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=yc(),s=Kh(e),o=Pm(n,s);o.payload=t,r!=null&&(o.callback=r),t=Hh(e,o,s),t!==null&&(ef(t,e,s,n),v2(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=yc(),s=Kh(e),o=Pm(n,s);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=Hh(e,o,s),t!==null&&(ef(t,e,s,n),v2(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=yc(),n=Kh(e),s=Pm(r,n);s.tag=2,t!=null&&(s.callback=t),t=Hh(e,s,n),t!==null&&(ef(t,e,n,r),v2(t,e,n))}};function PL(e,t,r,n,s,o,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,i):t.prototype&&t.prototype.isPureReactComponent?!ww(r,n)||!ww(s,o):!0}function AH(e,t,r){var n=!1,s=fp,o=t.contextType;return typeof o=="object"&&o!==null?o=vu(o):(s=Uc(t)?Ug:Xl.current,n=t.contextTypes,o=(n=n!=null)?n0(e,s):fp),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=kC,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=o),t}function EL(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&kC.enqueueReplaceState(t,t.state,null)}function wI(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},j4(e);var o=t.contextType;typeof o=="object"&&o!==null?s.context=vu(o):(o=Uc(t)?Ug:Xl.current,s.context=n0(e,o)),s.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(bI(e,t,o,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&kC.enqueueReplaceState(s,s.state,null),iN(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function i0(e,t){try{var r="",n=t;do r+=tle(n),n=n.return;while(n);var s=r}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:s,digest:null}}function SP(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function jI(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Pce=typeof WeakMap=="function"?WeakMap:Map;function PH(e,t,r){r=Pm(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){fN||(fN=!0,OI=n),jI(e,t)},r}function EH(e,t,r){r=Pm(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){jI(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){jI(e,t),typeof n!="function"&&(Gh===null?Gh=new Set([this]):Gh.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),r}function kL(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Pce;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=zce.bind(null,e,t,r),t.then(e,e))}function IL(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function OL(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Pm(-1,1),t.tag=2,Hh(r,t,1))),r.lanes|=1),e)}var Ece=Gm.ReactCurrentOwner,$c=!1;function uc(e,t,r,n){t.child=e===null?aH(t,null,r,n):s0(t,e.child,r,n)}function TL(e,t,r,n,s){r=r.render;var o=t.ref;return $v(t,s),n=A4(e,t,r,n,o,s),r=P4(),e!==null&&!$c?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Rm(e,t,s)):(Ho&&r&&p4(t),t.flags|=1,uc(e,t,n,s),t.child)}function DL(e,t,r,n,s){if(e===null){var o=r.type;return typeof o=="function"&&!L4(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,kH(e,t,o,n,s)):(e=N2(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&s)){var i=o.memoizedProps;if(r=r.compare,r=r!==null?r:ww,r(i,n)&&e.ref===t.ref)return Rm(e,t,s)}return t.flags|=1,e=Xh(o,n),e.ref=t.ref,e.return=t,t.child=e}function kH(e,t,r,n,s){if(e!==null){var o=e.memoizedProps;if(ww(o,n)&&e.ref===t.ref)if($c=!1,t.pendingProps=n=o,(e.lanes&s)!==0)e.flags&131072&&($c=!0);else return t.lanes=e.lanes,Rm(e,t,s)}return _I(e,t,r,n,s)}function IH(e,t,r){var n=t.pendingProps,s=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ko(jv,gd),gd|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ko(jv,gd),gd|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,ko(jv,gd),gd|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,ko(jv,gd),gd|=n;return uc(e,t,s,r),t.child}function OH(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function _I(e,t,r,n,s){var o=Uc(r)?Ug:Xl.current;return o=n0(t,o),$v(t,s),r=A4(e,t,r,n,o,s),n=P4(),e!==null&&!$c?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Rm(e,t,s)):(Ho&&n&&p4(t),t.flags|=1,uc(e,t,r,s),t.child)}function ML(e,t,r,n,s){if(Uc(r)){var o=!0;rN(t)}else o=!1;if($v(t,s),t.stateNode===null)w2(e,t),AH(t,r,n),wI(t,r,n,s),n=!0;else if(e===null){var i=t.stateNode,l=t.memoizedProps;i.props=l;var c=i.context,d=r.contextType;typeof d=="object"&&d!==null?d=vu(d):(d=Uc(r)?Ug:Xl.current,d=n0(t,d));var u=r.getDerivedStateFromProps,f=typeof u=="function"||typeof i.getSnapshotBeforeUpdate=="function";f||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==n||c!==d)&&EL(t,i,n,d),bh=!1;var h=t.memoizedState;i.state=h,iN(t,n,i,s),c=t.memoizedState,l!==n||h!==c||zc.current||bh?(typeof u=="function"&&(bI(t,r,u,n),c=t.memoizedState),(l=bh||PL(t,r,l,n,h,c,d))?(f||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),i.props=n,i.state=c,i.context=d,n=l):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{i=t.stateNode,oH(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:qu(t.type,l),i.props=d,f=t.pendingProps,h=i.context,c=r.contextType,typeof c=="object"&&c!==null?c=vu(c):(c=Uc(r)?Ug:Xl.current,c=n0(t,c));var m=r.getDerivedStateFromProps;(u=typeof m=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==f||h!==c)&&EL(t,i,n,c),bh=!1,h=t.memoizedState,i.state=h,iN(t,n,i,s);var x=t.memoizedState;l!==f||h!==x||zc.current||bh?(typeof m=="function"&&(bI(t,r,m,n),x=t.memoizedState),(d=bh||PL(t,r,d,n,h,x,c)||!1)?(u||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,x,c),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,x,c)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=x),i.props=n,i.state=x,i.context=c,n=d):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return NI(e,t,r,n,o,s)}function NI(e,t,r,n,s,o){OH(e,t);var i=(t.flags&128)!==0;if(!n&&!i)return s&&bL(t,r,!1),Rm(e,t,o);n=t.stateNode,Ece.current=t;var l=i&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&i?(t.child=s0(t,e.child,null,o),t.child=s0(t,null,l,o)):uc(e,t,l,o),t.memoizedState=n.state,s&&bL(t,r,!0),t.child}function TH(e){var t=e.stateNode;t.pendingContext?yL(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yL(e,t.context,!1),_4(e,t.containerInfo)}function RL(e,t,r,n,s){return a0(),x4(s),t.flags|=256,uc(e,t,r,n),t.child}var SI={dehydrated:null,treeContext:null,retryLane:0};function CI(e){return{baseLanes:e,cachePool:null,transitions:null}}function DH(e,t,r){var n=t.pendingProps,s=Xo.current,o=!1,i=(t.flags&128)!==0,l;if((l=i)||(l=e!==null&&e.memoizedState===null?!1:(s&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),ko(Xo,s&1),e===null)return vI(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=n.children,e=n.fallback,o?(n=t.mode,o=t.child,i={mode:"hidden",children:i},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=TC(i,n,0,null),e=Eg(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=CI(r),t.memoizedState=SI,e):I4(t,i));if(s=e.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return kce(e,t,i,n,l,s,r);if(o){o=n.fallback,i=t.mode,s=e.child,l=s.sibling;var c={mode:"hidden",children:n.children};return!(i&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=Xh(s,c),n.subtreeFlags=s.subtreeFlags&14680064),l!==null?o=Xh(l,o):(o=Eg(o,i,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,i=e.child.memoizedState,i=i===null?CI(r):{baseLanes:i.baseLanes|r,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~r,t.memoizedState=SI,n}return o=e.child,e=o.sibling,n=Xh(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function I4(e,t){return t=TC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function s_(e,t,r,n){return n!==null&&x4(n),s0(t,e.child,null,r),e=I4(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function kce(e,t,r,n,s,o,i){if(r)return t.flags&256?(t.flags&=-257,n=SP(Error(Rn(422))),s_(e,t,i,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,s=t.mode,n=TC({mode:"visible",children:n.children},s,0,null),o=Eg(o,s,i,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&s0(t,e.child,null,i),t.child.memoizedState=CI(i),t.memoizedState=SI,o);if(!(t.mode&1))return s_(e,t,i,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var l=n.dgst;return n=l,o=Error(Rn(419)),n=SP(o,n,void 0),s_(e,t,i,n)}if(l=(i&e.childLanes)!==0,$c||l){if(n=ul,n!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|i)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,Mm(e,s),ef(n,e,s,-1))}return F4(),n=SP(Error(Rn(421))),s_(e,t,i,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=Uce.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,wd=Wh(s.nextSibling),Ad=t,Ho=!0,Hu=null,e!==null&&(Zd[eu++]=wm,Zd[eu++]=jm,Zd[eu++]=Vg,wm=e.id,jm=e.overflow,Vg=t),t=I4(t,n.children),t.flags|=4096,t)}function FL(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),yI(e.return,t,r)}function CP(e,t,r,n,s){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=s)}function MH(e,t,r){var n=t.pendingProps,s=n.revealOrder,o=n.tail;if(uc(e,t,n.children,r),n=Xo.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&FL(e,r,t);else if(e.tag===19)FL(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ko(Xo,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&lN(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),CP(t,!1,s,r,o);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&lN(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}CP(t,!0,r,null,o);break;case"together":CP(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function w2(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Rm(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Hg|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Rn(153));if(t.child!==null){for(e=t.child,r=Xh(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Xh(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Ice(e,t,r){switch(t.tag){case 3:TH(t),a0();break;case 5:iH(t);break;case 1:Uc(t.type)&&rN(t);break;case 4:_4(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;ko(sN,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(ko(Xo,Xo.current&1),t.flags|=128,null):r&t.child.childLanes?DH(e,t,r):(ko(Xo,Xo.current&1),e=Rm(e,t,r),e!==null?e.sibling:null);ko(Xo,Xo.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return MH(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ko(Xo,Xo.current),n)break;return null;case 22:case 23:return t.lanes=0,IH(e,t,r)}return Rm(e,t,r)}var RH,AI,FH,LH;RH=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};AI=function(){};FH=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,hg($f.current);var o=null;switch(r){case"input":s=Xk(e,s),n=Xk(e,n),o=[];break;case"select":s=ni({},s,{value:void 0}),n=ni({},n,{value:void 0}),o=[];break;case"textarea":s=Qk(e,s),n=Qk(e,n),o=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=eN)}eI(r,n);var i;r=null;for(d in s)if(!n.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(i in l)l.hasOwnProperty(i)&&(r||(r={}),r[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(hw.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in n){var c=n[d];if(l=s?.[d],n.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(r||(r={}),r[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(r||(r={}),r[i]=c[i])}else r||(o||(o=[]),o.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(hw.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Fo("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}r&&(o=o||[]).push("style",r);var d=o;(t.updateQueue=d)&&(t.flags|=4)}};LH=function(e,t,r,n){r!==n&&(t.flags|=4)};function zy(e,t){if(!Ho)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Fl(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Oce(e,t,r){var n=t.pendingProps;switch(g4(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fl(t),null;case 1:return Uc(t.type)&&tN(),Fl(t),null;case 3:return n=t.stateNode,o0(),qo(zc),qo(Xl),S4(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(n_(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Hu!==null&&(MI(Hu),Hu=null))),AI(e,t),Fl(t),null;case 5:N4(t);var s=hg(Cw.current);if(r=t.type,e!==null&&t.stateNode!=null)FH(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Rn(166));return Fl(t),null}if(e=hg($f.current),n_(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[Sf]=t,n[Nw]=o,e=(t.mode&1)!==0,r){case"dialog":Fo("cancel",n),Fo("close",n);break;case"iframe":case"object":case"embed":Fo("load",n);break;case"video":case"audio":for(s=0;s<yb.length;s++)Fo(yb[s],n);break;case"source":Fo("error",n);break;case"img":case"image":case"link":Fo("error",n),Fo("load",n);break;case"details":Fo("toggle",n);break;case"input":HF(n,o),Fo("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Fo("invalid",n);break;case"textarea":KF(n,o),Fo("invalid",n)}eI(r,o),s=null;for(var i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="children"?typeof l=="string"?n.textContent!==l&&(o.suppressHydrationWarning!==!0&&r_(n.textContent,l,e),s=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&r_(n.textContent,l,e),s=["children",""+l]):hw.hasOwnProperty(i)&&l!=null&&i==="onScroll"&&Fo("scroll",n)}switch(r){case"input":Kj(n),GF(n,o,!0);break;case"textarea":Kj(n),XF(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=eN)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=fW(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=i.createElement(r,{is:n.is}):(e=i.createElement(r),r==="select"&&(i=e,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):e=i.createElementNS(e,r),e[Sf]=t,e[Nw]=n,RH(e,t,!1,!1),t.stateNode=e;e:{switch(i=tI(r,n),r){case"dialog":Fo("cancel",e),Fo("close",e),s=n;break;case"iframe":case"object":case"embed":Fo("load",e),s=n;break;case"video":case"audio":for(s=0;s<yb.length;s++)Fo(yb[s],e);s=n;break;case"source":Fo("error",e),s=n;break;case"img":case"image":case"link":Fo("error",e),Fo("load",e),s=n;break;case"details":Fo("toggle",e),s=n;break;case"input":HF(e,n),s=Xk(e,n),Fo("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=ni({},n,{value:void 0}),Fo("invalid",e);break;case"textarea":KF(e,n),s=Qk(e,n),Fo("invalid",e);break;default:s=n}eI(r,s),l=s;for(o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="style"?pW(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&mW(e,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&pw(e,c):typeof c=="number"&&pw(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(hw.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Fo("scroll",e):c!=null&&t4(e,o,c,i))}switch(r){case"input":Kj(e),GF(e,n,!1);break;case"textarea":Kj(e),XF(e);break;case"option":n.value!=null&&e.setAttribute("value",""+up(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?Mv(e,!!n.multiple,o,!1):n.defaultValue!=null&&Mv(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=eN)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Fl(t),null;case 6:if(e&&t.stateNode!=null)LH(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Rn(166));if(r=hg(Cw.current),hg($f.current),n_(t)){if(n=t.stateNode,r=t.memoizedProps,n[Sf]=t,(o=n.nodeValue!==r)&&(e=Ad,e!==null))switch(e.tag){case 3:r_(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&r_(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Sf]=t,t.stateNode=n}return Fl(t),null;case 13:if(qo(Xo),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ho&&wd!==null&&t.mode&1&&!(t.flags&128))rH(),a0(),t.flags|=98560,o=!1;else if(o=n_(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(Rn(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Rn(317));o[Sf]=t}else a0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Fl(t),o=!1}else Hu!==null&&(MI(Hu),Hu=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Xo.current&1?Gi===0&&(Gi=3):F4())),t.updateQueue!==null&&(t.flags|=4),Fl(t),null);case 4:return o0(),AI(e,t),e===null&&jw(t.stateNode.containerInfo),Fl(t),null;case 10:return b4(t.type._context),Fl(t),null;case 17:return Uc(t.type)&&tN(),Fl(t),null;case 19:if(qo(Xo),o=t.memoizedState,o===null)return Fl(t),null;if(n=(t.flags&128)!==0,i=o.rendering,i===null)if(n)zy(o,!1);else{if(Gi!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=lN(e),i!==null){for(t.flags|=128,zy(o,!1),n=i.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,e=i.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ko(Xo,Xo.current&1|2),t.child}e=e.sibling}o.tail!==null&&vi()>l0&&(t.flags|=128,n=!0,zy(o,!1),t.lanes=4194304)}else{if(!n)if(e=lN(i),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),zy(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!Ho)return Fl(t),null}else 2*vi()-o.renderingStartTime>l0&&r!==1073741824&&(t.flags|=128,n=!0,zy(o,!1),t.lanes=4194304);o.isBackwards?(i.sibling=t.child,t.child=i):(r=o.last,r!==null?r.sibling=i:t.child=i,o.last=i)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=vi(),t.sibling=null,r=Xo.current,ko(Xo,n?r&1|2:r&1),t):(Fl(t),null);case 22:case 23:return R4(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?gd&1073741824&&(Fl(t),t.subtreeFlags&6&&(t.flags|=8192)):Fl(t),null;case 24:return null;case 25:return null}throw Error(Rn(156,t.tag))}function Tce(e,t){switch(g4(t),t.tag){case 1:return Uc(t.type)&&tN(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return o0(),qo(zc),qo(Xl),S4(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return N4(t),null;case 13:if(qo(Xo),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Rn(340));a0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return qo(Xo),null;case 4:return o0(),null;case 10:return b4(t.type._context),null;case 22:case 23:return R4(),null;case 24:return null;default:return null}}var o_=!1,Wl=!1,Dce=typeof WeakSet=="function"?WeakSet:Set,ja=null;function wv(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ui(e,t,n)}else r.current=null}function PI(e,t,r){try{r()}catch(n){ui(e,t,n)}}var LL=!1;function Mce(e,t){if(uI=J2,e=UW(),h4(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var i=0,l=-1,c=-1,d=0,u=0,f=e,h=null;t:for(;;){for(var m;f!==r||s!==0&&f.nodeType!==3||(l=i+s),f!==o||n!==0&&f.nodeType!==3||(c=i+n),f.nodeType===3&&(i+=f.nodeValue.length),(m=f.firstChild)!==null;)h=f,f=m;for(;;){if(f===e)break t;if(h===r&&++d===s&&(l=i),h===o&&++u===n&&(c=i),(m=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=m}r=l===-1||c===-1?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(fI={focusedElem:e,selectionRange:r},J2=!1,ja=t;ja!==null;)if(t=ja,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ja=e;else for(;ja!==null;){t=ja;try{var x=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,v=x.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:qu(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Rn(163))}}catch(j){ui(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,ja=e;break}ja=t.return}return x=LL,LL=!1,x}function Db(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var o=s.destroy;s.destroy=void 0,o!==void 0&&PI(t,r,o)}s=s.next}while(s!==n)}}function IC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function EI(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function $H(e){var t=e.alternate;t!==null&&(e.alternate=null,$H(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Sf],delete t[Nw],delete t[pI],delete t[xce],delete t[vce])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function BH(e){return e.tag===5||e.tag===3||e.tag===4}function $L(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||BH(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function kI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=eN));else if(n!==4&&(e=e.child,e!==null))for(kI(e,t,r),e=e.sibling;e!==null;)kI(e,t,r),e=e.sibling}function II(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(II(e,t,r),e=e.sibling;e!==null;)II(e,t,r),e=e.sibling}var Sl=null,zu=!1;function sh(e,t,r){for(r=r.child;r!==null;)qH(e,t,r),r=r.sibling}function qH(e,t,r){if(Lf&&typeof Lf.onCommitFiberUnmount=="function")try{Lf.onCommitFiberUnmount(_C,r)}catch{}switch(r.tag){case 5:Wl||wv(r,t);case 6:var n=Sl,s=zu;Sl=null,sh(e,t,r),Sl=n,zu=s,Sl!==null&&(zu?(e=Sl,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Sl.removeChild(r.stateNode));break;case 18:Sl!==null&&(zu?(e=Sl,r=r.stateNode,e.nodeType===8?yP(e.parentNode,r):e.nodeType===1&&yP(e,r),yw(e)):yP(Sl,r.stateNode));break;case 4:n=Sl,s=zu,Sl=r.stateNode.containerInfo,zu=!0,sh(e,t,r),Sl=n,zu=s;break;case 0:case 11:case 14:case 15:if(!Wl&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var o=s,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&PI(r,t,i),s=s.next}while(s!==n)}sh(e,t,r);break;case 1:if(!Wl&&(wv(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(l){ui(r,t,l)}sh(e,t,r);break;case 21:sh(e,t,r);break;case 22:r.mode&1?(Wl=(n=Wl)||r.memoizedState!==null,sh(e,t,r),Wl=n):sh(e,t,r);break;default:sh(e,t,r)}}function BL(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Dce),t.forEach(function(n){var s=Vce.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function Du(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var o=e,i=t,l=i;e:for(;l!==null;){switch(l.tag){case 5:Sl=l.stateNode,zu=!1;break e;case 3:Sl=l.stateNode.containerInfo,zu=!0;break e;case 4:Sl=l.stateNode.containerInfo,zu=!0;break e}l=l.return}if(Sl===null)throw Error(Rn(160));qH(o,i,s),Sl=null,zu=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){ui(s,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)zH(t,e),t=t.sibling}function zH(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Du(t,e),bf(e),n&4){try{Db(3,e,e.return),IC(3,e)}catch(g){ui(e,e.return,g)}try{Db(5,e,e.return)}catch(g){ui(e,e.return,g)}}break;case 1:Du(t,e),bf(e),n&512&&r!==null&&wv(r,r.return);break;case 5:if(Du(t,e),bf(e),n&512&&r!==null&&wv(r,r.return),e.flags&32){var s=e.stateNode;try{pw(s,"")}catch(g){ui(e,e.return,g)}}if(n&4&&(s=e.stateNode,s!=null)){var o=e.memoizedProps,i=r!==null?r.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&dW(s,o),tI(l,i);var d=tI(l,o);for(i=0;i<c.length;i+=2){var u=c[i],f=c[i+1];u==="style"?pW(s,f):u==="dangerouslySetInnerHTML"?mW(s,f):u==="children"?pw(s,f):t4(s,u,f,d)}switch(l){case"input":Yk(s,o);break;case"textarea":uW(s,o);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var m=o.value;m!=null?Mv(s,!!o.multiple,m,!1):h!==!!o.multiple&&(o.defaultValue!=null?Mv(s,!!o.multiple,o.defaultValue,!0):Mv(s,!!o.multiple,o.multiple?[]:"",!1))}s[Nw]=o}catch(g){ui(e,e.return,g)}}break;case 6:if(Du(t,e),bf(e),n&4){if(e.stateNode===null)throw Error(Rn(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(g){ui(e,e.return,g)}}break;case 3:if(Du(t,e),bf(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{yw(t.containerInfo)}catch(g){ui(e,e.return,g)}break;case 4:Du(t,e),bf(e);break;case 13:Du(t,e),bf(e),s=e.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(D4=vi())),n&4&&BL(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(Wl=(d=Wl)||u,Du(t,e),Wl=d):Du(t,e),bf(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(ja=e,u=e.child;u!==null;){for(f=ja=u;ja!==null;){switch(h=ja,m=h.child,h.tag){case 0:case 11:case 14:case 15:Db(4,h,h.return);break;case 1:wv(h,h.return);var x=h.stateNode;if(typeof x.componentWillUnmount=="function"){n=h,r=h.return;try{t=n,x.props=t.memoizedProps,x.state=t.memoizedState,x.componentWillUnmount()}catch(g){ui(n,r,g)}}break;case 5:wv(h,h.return);break;case 22:if(h.memoizedState!==null){zL(f);continue}}m!==null?(m.return=h,ja=m):zL(f)}u=u.sibling}e:for(u=null,f=e;;){if(f.tag===5){if(u===null){u=f;try{s=f.stateNode,d?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=f.stateNode,c=f.memoizedProps.style,i=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=hW("display",i))}catch(g){ui(e,e.return,g)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(g){ui(e,e.return,g)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Du(t,e),bf(e),n&4&&BL(e);break;case 21:break;default:Du(t,e),bf(e)}}function bf(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(BH(r)){var n=r;break e}r=r.return}throw Error(Rn(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(pw(s,""),n.flags&=-33);var o=$L(e);II(e,o,s);break;case 3:case 4:var i=n.stateNode.containerInfo,l=$L(e);kI(e,l,i);break;default:throw Error(Rn(161))}}catch(c){ui(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Rce(e,t,r){ja=e,UH(e)}function UH(e,t,r){for(var n=(e.mode&1)!==0;ja!==null;){var s=ja,o=s.child;if(s.tag===22&&n){var i=s.memoizedState!==null||o_;if(!i){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Wl;l=o_;var d=Wl;if(o_=i,(Wl=c)&&!d)for(ja=s;ja!==null;)i=ja,c=i.child,i.tag===22&&i.memoizedState!==null?UL(s):c!==null?(c.return=i,ja=c):UL(s);for(;o!==null;)ja=o,UH(o),o=o.sibling;ja=s,o_=l,Wl=d}qL(e)}else s.subtreeFlags&8772&&o!==null?(o.return=s,ja=o):qL(e)}}function qL(e){for(;ja!==null;){var t=ja;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Wl||IC(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Wl)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:qu(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&SL(t,o,n);break;case 3:var i=t.updateQueue;if(i!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}SL(t,i,r)}break;case 5:var l=t.stateNode;if(r===null&&t.flags&4){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&yw(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Rn(163))}Wl||t.flags&512&&EI(t)}catch(h){ui(t,t.return,h)}}if(t===e){ja=null;break}if(r=t.sibling,r!==null){r.return=t.return,ja=r;break}ja=t.return}}function zL(e){for(;ja!==null;){var t=ja;if(t===e){ja=null;break}var r=t.sibling;if(r!==null){r.return=t.return,ja=r;break}ja=t.return}}function UL(e){for(;ja!==null;){var t=ja;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{IC(4,t)}catch(c){ui(t,r,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(c){ui(t,s,c)}}var o=t.return;try{EI(t)}catch(c){ui(t,o,c)}break;case 5:var i=t.return;try{EI(t)}catch(c){ui(t,i,c)}}}catch(c){ui(t,t.return,c)}if(t===e){ja=null;break}var l=t.sibling;if(l!==null){l.return=t.return,ja=l;break}ja=t.return}}var Fce=Math.ceil,uN=Gm.ReactCurrentDispatcher,O4=Gm.ReactCurrentOwner,hu=Gm.ReactCurrentBatchConfig,Ks=0,ul=null,Ti=null,Pl=0,gd=0,jv=Sp(0),Gi=0,kw=null,Hg=0,OC=0,T4=0,Mb=null,Mc=null,D4=0,l0=1/0,hm=null,fN=!1,OI=null,Gh=null,i_=!1,Oh=null,mN=0,Rb=0,TI=null,j2=-1,_2=0;function yc(){return Ks&6?vi():j2!==-1?j2:j2=vi()}function Kh(e){return e.mode&1?Ks&2&&Pl!==0?Pl&-Pl:bce.transition!==null?(_2===0&&(_2=AW()),_2):(e=ho,e!==0||(e=window.event,e=e===void 0?16:DW(e.type)),e):1}function ef(e,t,r,n){if(50<Rb)throw Rb=0,TI=null,Error(Rn(185));H1(e,r,n),(!(Ks&2)||e!==ul)&&(e===ul&&(!(Ks&2)&&(OC|=r),Gi===4&&Sh(e,Pl)),Vc(e,n),r===1&&Ks===0&&!(t.mode&1)&&(l0=vi()+500,PC&&Cp()))}function Vc(e,t){var r=e.callbackNode;ble(e,t);var n=Y2(e,e===ul?Pl:0);if(n===0)r!==null&&QF(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&QF(r),t===1)e.tag===0?yce(VL.bind(null,e)):ZW(VL.bind(null,e)),pce(function(){!(Ks&6)&&Cp()}),r=null;else{switch(PW(n)){case 1:r=o4;break;case 4:r=SW;break;case 16:r=X2;break;case 536870912:r=CW;break;default:r=X2}r=JH(r,VH.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function VH(e,t){if(j2=-1,_2=0,Ks&6)throw Error(Rn(327));var r=e.callbackNode;if(Bv()&&e.callbackNode!==r)return null;var n=Y2(e,e===ul?Pl:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=hN(e,n);else{t=n;var s=Ks;Ks|=2;var o=HH();(ul!==e||Pl!==t)&&(hm=null,l0=vi()+500,Pg(e,t));do try{Bce();break}catch(l){WH(e,l)}while(1);y4(),uN.current=o,Ks=s,Ti!==null?t=0:(ul=null,Pl=0,t=Gi)}if(t!==0){if(t===2&&(s=oI(e),s!==0&&(n=s,t=DI(e,s))),t===1)throw r=kw,Pg(e,0),Sh(e,n),Vc(e,vi()),r;if(t===6)Sh(e,n);else{if(s=e.current.alternate,!(n&30)&&!Lce(s)&&(t=hN(e,n),t===2&&(o=oI(e),o!==0&&(n=o,t=DI(e,o))),t===1))throw r=kw,Pg(e,0),Sh(e,n),Vc(e,vi()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(Rn(345));case 2:Jp(e,Mc,hm);break;case 3:if(Sh(e,n),(n&130023424)===n&&(t=D4+500-vi(),10<t)){if(Y2(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){yc(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=hI(Jp.bind(null,e,Mc,hm),t);break}Jp(e,Mc,hm);break;case 4:if(Sh(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var i=31-Zu(n);o=1<<i,i=t[i],i>s&&(s=i),n&=~o}if(n=s,n=vi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Fce(n/1960))-n,10<n){e.timeoutHandle=hI(Jp.bind(null,e,Mc,hm),n);break}Jp(e,Mc,hm);break;case 5:Jp(e,Mc,hm);break;default:throw Error(Rn(329))}}}return Vc(e,vi()),e.callbackNode===r?VH.bind(null,e):null}function DI(e,t){var r=Mb;return e.current.memoizedState.isDehydrated&&(Pg(e,t).flags|=256),e=hN(e,t),e!==2&&(t=Mc,Mc=r,t!==null&&MI(t)),e}function MI(e){Mc===null?Mc=e:Mc.push.apply(Mc,e)}function Lce(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],o=s.getSnapshot;s=s.value;try{if(!af(o(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Sh(e,t){for(t&=~T4,t&=~OC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Zu(t),n=1<<r;e[r]=-1,t&=~n}}function VL(e){if(Ks&6)throw Error(Rn(327));Bv();var t=Y2(e,0);if(!(t&1))return Vc(e,vi()),null;var r=hN(e,t);if(e.tag!==0&&r===2){var n=oI(e);n!==0&&(t=n,r=DI(e,n))}if(r===1)throw r=kw,Pg(e,0),Sh(e,t),Vc(e,vi()),r;if(r===6)throw Error(Rn(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Jp(e,Mc,hm),Vc(e,vi()),null}function M4(e,t){var r=Ks;Ks|=1;try{return e(t)}finally{Ks=r,Ks===0&&(l0=vi()+500,PC&&Cp())}}function Gg(e){Oh!==null&&Oh.tag===0&&!(Ks&6)&&Bv();var t=Ks;Ks|=1;var r=hu.transition,n=ho;try{if(hu.transition=null,ho=1,e)return e()}finally{ho=n,hu.transition=r,Ks=t,!(Ks&6)&&Cp()}}function R4(){gd=jv.current,qo(jv)}function Pg(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,hce(r)),Ti!==null)for(r=Ti.return;r!==null;){var n=r;switch(g4(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&tN();break;case 3:o0(),qo(zc),qo(Xl),S4();break;case 5:N4(n);break;case 4:o0();break;case 13:qo(Xo);break;case 19:qo(Xo);break;case 10:b4(n.type._context);break;case 22:case 23:R4()}r=r.return}if(ul=e,Ti=e=Xh(e.current,null),Pl=gd=t,Gi=0,kw=null,T4=OC=Hg=0,Mc=Mb=null,mg!==null){for(t=0;t<mg.length;t++)if(r=mg[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,o=r.pending;if(o!==null){var i=o.next;o.next=s,n.next=i}r.pending=n}mg=null}return e}function WH(e,t){do{var r=Ti;try{if(y4(),y2.current=dN,cN){for(var n=ti.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}cN=!1}if(Wg=0,ol=Ui=ti=null,Tb=!1,Aw=0,O4.current=null,r===null||r.return===null){Gi=1,kw=t,Ti=null;break}e:{var o=e,i=r.return,l=r,c=t;if(t=Pl,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=IL(i);if(m!==null){m.flags&=-257,OL(m,i,l,o,t),m.mode&1&&kL(o,d,t),t=m,c=d;var x=t.updateQueue;if(x===null){var g=new Set;g.add(c),t.updateQueue=g}else x.add(c);break e}else{if(!(t&1)){kL(o,d,t),F4();break e}c=Error(Rn(426))}}else if(Ho&&l.mode&1){var v=IL(i);if(v!==null){!(v.flags&65536)&&(v.flags|=256),OL(v,i,l,o,t),x4(i0(c,l));break e}}o=c=i0(c,l),Gi!==4&&(Gi=2),Mb===null?Mb=[o]:Mb.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var y=PH(o,c,t);NL(o,y);break e;case 1:l=c;var b=o.type,w=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Gh===null||!Gh.has(w)))){o.flags|=65536,t&=-t,o.lanes|=t;var j=EH(o,l,t);NL(o,j);break e}}o=o.return}while(o!==null)}KH(r)}catch(_){t=_,Ti===r&&r!==null&&(Ti=r=r.return);continue}break}while(1)}function HH(){var e=uN.current;return uN.current=dN,e===null?dN:e}function F4(){(Gi===0||Gi===3||Gi===2)&&(Gi=4),ul===null||!(Hg&268435455)&&!(OC&268435455)||Sh(ul,Pl)}function hN(e,t){var r=Ks;Ks|=2;var n=HH();(ul!==e||Pl!==t)&&(hm=null,Pg(e,t));do try{$ce();break}catch(s){WH(e,s)}while(1);if(y4(),Ks=r,uN.current=n,Ti!==null)throw Error(Rn(261));return ul=null,Pl=0,Gi}function $ce(){for(;Ti!==null;)GH(Ti)}function Bce(){for(;Ti!==null&&!ule();)GH(Ti)}function GH(e){var t=YH(e.alternate,e,gd);e.memoizedProps=e.pendingProps,t===null?KH(e):Ti=t,O4.current=null}function KH(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Tce(r,t),r!==null){r.flags&=32767,Ti=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Gi=6,Ti=null;return}}else if(r=Oce(r,t,gd),r!==null){Ti=r;return}if(t=t.sibling,t!==null){Ti=t;return}Ti=t=e}while(t!==null);Gi===0&&(Gi=5)}function Jp(e,t,r){var n=ho,s=hu.transition;try{hu.transition=null,ho=1,qce(e,t,r,n)}finally{hu.transition=s,ho=n}return null}function qce(e,t,r,n){do Bv();while(Oh!==null);if(Ks&6)throw Error(Rn(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Rn(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(wle(e,o),e===ul&&(Ti=ul=null,Pl=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||i_||(i_=!0,JH(X2,function(){return Bv(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=hu.transition,hu.transition=null;var i=ho;ho=1;var l=Ks;Ks|=4,O4.current=null,Mce(e,r),zH(r,e),ice(fI),J2=!!uI,fI=uI=null,e.current=r,Rce(r),fle(),Ks=l,ho=i,hu.transition=o}else e.current=r;if(i_&&(i_=!1,Oh=e,mN=s),o=e.pendingLanes,o===0&&(Gh=null),ple(r.stateNode),Vc(e,vi()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(fN)throw fN=!1,e=OI,OI=null,e;return mN&1&&e.tag!==0&&Bv(),o=e.pendingLanes,o&1?e===TI?Rb++:(Rb=0,TI=e):Rb=0,Cp(),null}function Bv(){if(Oh!==null){var e=PW(mN),t=hu.transition,r=ho;try{if(hu.transition=null,ho=16>e?16:e,Oh===null)var n=!1;else{if(e=Oh,Oh=null,mN=0,Ks&6)throw Error(Rn(331));var s=Ks;for(Ks|=4,ja=e.current;ja!==null;){var o=ja,i=o.child;if(ja.flags&16){var l=o.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ja=d;ja!==null;){var u=ja;switch(u.tag){case 0:case 11:case 15:Db(8,u,o)}var f=u.child;if(f!==null)f.return=u,ja=f;else for(;ja!==null;){u=ja;var h=u.sibling,m=u.return;if($H(u),u===d){ja=null;break}if(h!==null){h.return=m,ja=h;break}ja=m}}}var x=o.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}ja=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,ja=i;else e:for(;ja!==null;){if(o=ja,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Db(9,o,o.return)}var y=o.sibling;if(y!==null){y.return=o.return,ja=y;break e}ja=o.return}}var b=e.current;for(ja=b;ja!==null;){i=ja;var w=i.child;if(i.subtreeFlags&2064&&w!==null)w.return=i,ja=w;else e:for(i=b;ja!==null;){if(l=ja,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:IC(9,l)}}catch(_){ui(l,l.return,_)}if(l===i){ja=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,ja=j;break e}ja=l.return}}if(Ks=s,Cp(),Lf&&typeof Lf.onPostCommitFiberRoot=="function")try{Lf.onPostCommitFiberRoot(_C,e)}catch{}n=!0}return n}finally{ho=r,hu.transition=t}}return!1}function WL(e,t,r){t=i0(r,t),t=PH(e,t,1),e=Hh(e,t,1),t=yc(),e!==null&&(H1(e,1,t),Vc(e,t))}function ui(e,t,r){if(e.tag===3)WL(e,e,r);else for(;t!==null;){if(t.tag===3){WL(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Gh===null||!Gh.has(n))){e=i0(r,e),e=EH(t,e,1),t=Hh(t,e,1),e=yc(),t!==null&&(H1(t,1,e),Vc(t,e));break}}t=t.return}}function zce(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=yc(),e.pingedLanes|=e.suspendedLanes&r,ul===e&&(Pl&r)===r&&(Gi===4||Gi===3&&(Pl&130023424)===Pl&&500>vi()-D4?Pg(e,0):T4|=r),Vc(e,t)}function XH(e,t){t===0&&(e.mode&1?(t=Jj,Jj<<=1,!(Jj&130023424)&&(Jj=4194304)):t=1);var r=yc();e=Mm(e,t),e!==null&&(H1(e,t,r),Vc(e,r))}function Uce(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),XH(e,r)}function Vce(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Rn(314))}n!==null&&n.delete(t),XH(e,r)}var YH;YH=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||zc.current)$c=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return $c=!1,Ice(e,t,r);$c=!!(e.flags&131072)}else $c=!1,Ho&&t.flags&1048576&&eH(t,aN,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;w2(e,t),e=t.pendingProps;var s=n0(t,Xl.current);$v(t,r),s=A4(null,t,n,e,s,r);var o=P4();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Uc(n)?(o=!0,rN(t)):o=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,j4(t),s.updater=kC,t.stateNode=s,s._reactInternals=t,wI(t,n,e,r),t=NI(null,t,n,!0,o,r)):(t.tag=0,Ho&&o&&p4(t),uc(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(w2(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=Hce(n),e=qu(n,e),s){case 0:t=_I(null,t,n,e,r);break e;case 1:t=ML(null,t,n,e,r);break e;case 11:t=TL(null,t,n,e,r);break e;case 14:t=DL(null,t,n,qu(n.type,e),r);break e}throw Error(Rn(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:qu(n,s),_I(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:qu(n,s),ML(e,t,n,s,r);case 3:e:{if(TH(t),e===null)throw Error(Rn(387));n=t.pendingProps,o=t.memoizedState,s=o.element,oH(e,t),iN(t,n,null,r);var i=t.memoizedState;if(n=i.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){s=i0(Error(Rn(423)),t),t=RL(e,t,n,r,s);break e}else if(n!==s){s=i0(Error(Rn(424)),t),t=RL(e,t,n,r,s);break e}else for(wd=Wh(t.stateNode.containerInfo.firstChild),Ad=t,Ho=!0,Hu=null,r=aH(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(a0(),n===s){t=Rm(e,t,r);break e}uc(e,t,n,r)}t=t.child}return t;case 5:return iH(t),e===null&&vI(t),n=t.type,s=t.pendingProps,o=e!==null?e.memoizedProps:null,i=s.children,mI(n,s)?i=null:o!==null&&mI(n,o)&&(t.flags|=32),OH(e,t),uc(e,t,i,r),t.child;case 6:return e===null&&vI(t),null;case 13:return DH(e,t,r);case 4:return _4(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=s0(t,null,n,r):uc(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:qu(n,s),TL(e,t,n,s,r);case 7:return uc(e,t,t.pendingProps,r),t.child;case 8:return uc(e,t,t.pendingProps.children,r),t.child;case 12:return uc(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,o=t.memoizedProps,i=s.value,ko(sN,n._currentValue),n._currentValue=i,o!==null)if(af(o.value,i)){if(o.children===s.children&&!zc.current){t=Rm(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){i=o.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=Pm(-1,r&-r),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),yI(o.return,r,t),l.lanes|=r;break}c=c.next}}else if(o.tag===10)i=o.type===t.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(Rn(341));i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),yI(i,r,t),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===t){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}uc(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,$v(t,r),s=vu(s),n=n(s),t.flags|=1,uc(e,t,n,r),t.child;case 14:return n=t.type,s=qu(n,t.pendingProps),s=qu(n.type,s),DL(e,t,n,s,r);case 15:return kH(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:qu(n,s),w2(e,t),t.tag=1,Uc(n)?(e=!0,rN(t)):e=!1,$v(t,r),AH(t,n,s),wI(t,n,s,r),NI(null,t,n,!0,e,r);case 19:return MH(e,t,r);case 22:return IH(e,t,r)}throw Error(Rn(156,t.tag))};function JH(e,t){return NW(e,t)}function Wce(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cu(e,t,r,n){return new Wce(e,t,r,n)}function L4(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Hce(e){if(typeof e=="function")return L4(e)?1:0;if(e!=null){if(e=e.$$typeof,e===n4)return 11;if(e===a4)return 14}return 2}function Xh(e,t){var r=e.alternate;return r===null?(r=cu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function N2(e,t,r,n,s,o){var i=2;if(n=e,typeof e=="function")L4(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case fv:return Eg(r.children,s,o,t);case r4:i=8,s|=8;break;case Wk:return e=cu(12,r,t,s|2),e.elementType=Wk,e.lanes=o,e;case Hk:return e=cu(13,r,t,s),e.elementType=Hk,e.lanes=o,e;case Gk:return e=cu(19,r,t,s),e.elementType=Gk,e.lanes=o,e;case iW:return TC(r,s,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case sW:i=10;break e;case oW:i=9;break e;case n4:i=11;break e;case a4:i=14;break e;case yh:i=16,n=null;break e}throw Error(Rn(130,e==null?e:typeof e,""))}return t=cu(i,r,t,s),t.elementType=e,t.type=n,t.lanes=o,t}function Eg(e,t,r,n){return e=cu(7,e,n,t),e.lanes=r,e}function TC(e,t,r,n){return e=cu(22,e,n,t),e.elementType=iW,e.lanes=r,e.stateNode={isHidden:!1},e}function AP(e,t,r){return e=cu(6,e,null,t),e.lanes=r,e}function PP(e,t,r){return t=cu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Gce(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lP(0),this.expirationTimes=lP(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lP(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function $4(e,t,r,n,s,o,i,l,c){return e=new Gce(e,t,r,l,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=cu(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},j4(o),e}function Kce(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:uv,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function QH(e){if(!e)return fp;e=e._reactInternals;e:{if(fx(e)!==e||e.tag!==1)throw Error(Rn(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Uc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Rn(171))}if(e.tag===1){var r=e.type;if(Uc(r))return QW(e,r,t)}return t}function ZH(e,t,r,n,s,o,i,l,c){return e=$4(r,n,!0,e,s,o,i,l,c),e.context=QH(null),r=e.current,n=yc(),s=Kh(r),o=Pm(n,s),o.callback=t??null,Hh(r,o,s),e.current.lanes=s,H1(e,s,n),Vc(e,n),e}function DC(e,t,r,n){var s=t.current,o=yc(),i=Kh(s);return r=QH(r),t.context===null?t.context=r:t.pendingContext=r,t=Pm(o,i),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Hh(s,t,i),e!==null&&(ef(e,s,i,o),v2(e,s,i)),i}function pN(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function HL(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function B4(e,t){HL(e,t),(e=e.alternate)&&HL(e,t)}function Xce(){return null}var eG=typeof reportError=="function"?reportError:function(e){console.error(e)};function q4(e){this._internalRoot=e}MC.prototype.render=q4.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Rn(409));DC(e,t,null,null)};MC.prototype.unmount=q4.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Gg(function(){DC(null,e,null,null)}),t[Dm]=null}};function MC(e){this._internalRoot=e}MC.prototype.unstable_scheduleHydration=function(e){if(e){var t=IW();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Nh.length&&t!==0&&t<Nh[r].priority;r++);Nh.splice(r,0,e),r===0&&TW(e)}};function z4(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function RC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function GL(){}function Yce(e,t,r,n,s){if(s){if(typeof n=="function"){var o=n;n=function(){var d=pN(i);o.call(d)}}var i=ZH(t,n,e,0,null,!1,!1,"",GL);return e._reactRootContainer=i,e[Dm]=i.current,jw(e.nodeType===8?e.parentNode:e),Gg(),i}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var l=n;n=function(){var d=pN(c);l.call(d)}}var c=$4(e,0,!1,null,null,!1,!1,"",GL);return e._reactRootContainer=c,e[Dm]=c.current,jw(e.nodeType===8?e.parentNode:e),Gg(function(){DC(t,c,r,n)}),c}function FC(e,t,r,n,s){var o=r._reactRootContainer;if(o){var i=o;if(typeof s=="function"){var l=s;s=function(){var c=pN(i);l.call(c)}}DC(t,i,e,s)}else i=Yce(r,t,e,s,n);return pN(i)}EW=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=vb(t.pendingLanes);r!==0&&(i4(t,r|1),Vc(t,vi()),!(Ks&6)&&(l0=vi()+500,Cp()))}break;case 13:Gg(function(){var n=Mm(e,1);if(n!==null){var s=yc();ef(n,e,1,s)}}),B4(e,1)}};l4=function(e){if(e.tag===13){var t=Mm(e,134217728);if(t!==null){var r=yc();ef(t,e,134217728,r)}B4(e,134217728)}};kW=function(e){if(e.tag===13){var t=Kh(e),r=Mm(e,t);if(r!==null){var n=yc();ef(r,e,t,n)}B4(e,t)}};IW=function(){return ho};OW=function(e,t){var r=ho;try{return ho=e,t()}finally{ho=r}};nI=function(e,t,r){switch(t){case"input":if(Yk(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=AC(n);if(!s)throw Error(Rn(90));cW(n),Yk(n,s)}}}break;case"textarea":uW(e,r);break;case"select":t=r.value,t!=null&&Mv(e,!!r.multiple,t,!1)}};vW=M4;yW=Gg;var Jce={usingClientEntryPoint:!1,Events:[K1,gv,AC,gW,xW,M4]},Uy={findFiberByHostInstance:fg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Qce={bundleType:Uy.bundleType,version:Uy.version,rendererPackageName:Uy.rendererPackageName,rendererConfig:Uy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Gm.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=jW(e),e===null?null:e.stateNode},findFiberByHostInstance:Uy.findFiberByHostInstance||Xce,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var l_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!l_.isDisabled&&l_.supportsFiber)try{_C=l_.inject(Qce),Lf=l_}catch{}}Fd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jce;Fd.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!z4(t))throw Error(Rn(200));return Kce(e,t,null,r)};Fd.createRoot=function(e,t){if(!z4(e))throw Error(Rn(299));var r=!1,n="",s=eG;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=$4(e,1,!1,null,null,r,!1,n,s),e[Dm]=t.current,jw(e.nodeType===8?e.parentNode:e),new q4(t)};Fd.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Rn(188)):(e=Object.keys(e).join(","),Error(Rn(268,e)));return e=jW(t),e=e===null?null:e.stateNode,e};Fd.flushSync=function(e){return Gg(e)};Fd.hydrate=function(e,t,r){if(!RC(t))throw Error(Rn(200));return FC(null,e,t,!0,r)};Fd.hydrateRoot=function(e,t,r){if(!z4(e))throw Error(Rn(405));var n=r!=null&&r.hydratedSources||null,s=!1,o="",i=eG;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(i=r.onRecoverableError)),t=ZH(t,null,e,1,r??null,s,!1,o,i),e[Dm]=t.current,jw(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new MC(t)};Fd.render=function(e,t,r){if(!RC(t))throw Error(Rn(200));return FC(null,e,t,!1,r)};Fd.unmountComponentAtNode=function(e){if(!RC(e))throw Error(Rn(40));return e._reactRootContainer?(Gg(function(){FC(null,null,e,!1,function(){e._reactRootContainer=null,e[Dm]=null})}),!0):!1};Fd.unstable_batchedUpdates=M4;Fd.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!RC(r))throw Error(Rn(200));if(e==null||e._reactInternals===void 0)throw Error(Rn(38));return FC(e,t,r,!1,n)};Fd.version="18.3.1-next-f1338f8080-20240426";function tG(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tG)}catch(e){console.error(e)}}tG(),tW.exports=Fd;var Km=tW.exports;const U4=Us(Km);var KL=Km;Uk.createRoot=KL.createRoot,Uk.hydrateRoot=KL.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Iw(){return Iw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Iw.apply(this,arguments)}var Th;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Th||(Th={}));const XL="popstate";function Zce(e){e===void 0&&(e={});function t(n,s){let{pathname:o,search:i,hash:l}=n.location;return RI("",{pathname:o,search:i,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:gN(s)}return tde(t,r,null,e)}function ri(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function rG(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function ede(){return Math.random().toString(36).substr(2,8)}function YL(e,t){return{usr:e.state,key:e.key,idx:t}}function RI(e,t,r,n){return r===void 0&&(r=null),Iw({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?ey(t):t,{state:r,key:t&&t.key||n||ede()})}function gN(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function ey(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function tde(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:o=!1}=n,i=s.history,l=Th.Pop,c=null,d=u();d==null&&(d=0,i.replaceState(Iw({},i.state,{idx:d}),""));function u(){return(i.state||{idx:null}).idx}function f(){l=Th.Pop;let v=u(),y=v==null?null:v-d;d=v,c&&c({action:l,location:g.location,delta:y})}function h(v,y){l=Th.Push;let b=RI(g.location,v,y);r&&r(b,v),d=u()+1;let w=YL(b,d),j=g.createHref(b);try{i.pushState(w,"",j)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;s.location.assign(j)}o&&c&&c({action:l,location:g.location,delta:1})}function m(v,y){l=Th.Replace;let b=RI(g.location,v,y);r&&r(b,v),d=u();let w=YL(b,d),j=g.createHref(b);i.replaceState(w,"",j),o&&c&&c({action:l,location:g.location,delta:0})}function x(v){let y=s.location.origin!=="null"?s.location.origin:s.location.href,b=typeof v=="string"?v:gN(v);return b=b.replace(/ $/,"%20"),ri(y,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,y)}let g={get action(){return l},get location(){return e(s,i)},listen(v){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(XL,f),c=v,()=>{s.removeEventListener(XL,f),c=null}},createHref(v){return t(s,v)},createURL:x,encodeLocation(v){let y=x(v);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:h,replace:m,go(v){return i.go(v)}};return g}var JL;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(JL||(JL={}));function rde(e,t,r){return r===void 0&&(r="/"),nde(e,t,r,!1)}function nde(e,t,r,n){let s=typeof t=="string"?ey(t):t,o=c0(s.pathname||"/",r);if(o==null)return null;let i=nG(e);ade(i);let l=null;for(let c=0;l==null&&c<i.length;++c){let d=pde(o);l=mde(i[c],d,n)}return l}function nG(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(o,i,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};c.relativePath.startsWith("/")&&(ri(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let d=Yh([n,c.relativePath]),u=r.concat(c);o.children&&o.children.length>0&&(ri(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),nG(o.children,t,u,d)),!(o.path==null&&!o.index)&&t.push({path:d,score:ude(d,o.index),routesMeta:u})};return e.forEach((o,i)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))s(o,i);else for(let c of aG(o.path))s(o,i,c)}),t}function aG(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return s?[o,""]:[o];let i=aG(n.join("/")),l=[];return l.push(...i.map(c=>c===""?o:[o,c].join("/"))),s&&l.push(...i),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function ade(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:fde(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const sde=/^:[\w-]+$/,ode=3,ide=2,lde=1,cde=10,dde=-2,QL=e=>e==="*";function ude(e,t){let r=e.split("/"),n=r.length;return r.some(QL)&&(n+=dde),t&&(n+=ide),r.filter(s=>!QL(s)).reduce((s,o)=>s+(sde.test(o)?ode:o===""?lde:cde),n)}function fde(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function mde(e,t,r){r===void 0&&(r=!1);let{routesMeta:n}=e,s={},o="/",i=[];for(let l=0;l<n.length;++l){let c=n[l],d=l===n.length-1,u=o==="/"?t:t.slice(o.length)||"/",f=xN({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),h=c.route;if(!f&&d&&r&&!n[n.length-1].route.index&&(f=xN({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!f)return null;Object.assign(s,f.params),i.push({params:s,pathname:Yh([o,f.pathname]),pathnameBase:yde(Yh([o,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(o=Yh([o,f.pathnameBase]))}return i}function xN(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=hde(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let o=s[0],i=o.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:n.reduce((d,u,f)=>{let{paramName:h,isOptional:m}=u;if(h==="*"){let g=l[f]||"";i=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[f];return m&&!x?d[h]=void 0:d[h]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:i,pattern:e}}function hde(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),rG(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function pde(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return rG(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function c0(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function gde(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?ey(e):e;return{pathname:r?r.startsWith("/")?r:xde(r,t):t,search:bde(n),hash:wde(s)}}function xde(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function EP(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function vde(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function V4(e,t){let r=vde(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function W4(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=ey(e):(s=Iw({},e),ri(!s.pathname||!s.pathname.includes("?"),EP("?","pathname","search",s)),ri(!s.pathname||!s.pathname.includes("#"),EP("#","pathname","hash",s)),ri(!s.search||!s.search.includes("#"),EP("#","search","hash",s)));let o=e===""||s.pathname==="",i=o?"/":s.pathname,l;if(i==null)l=r;else{let f=t.length-1;if(!n&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),f-=1;s.pathname=h.join("/")}l=f>=0?t[f]:"/"}let c=gde(s,l),d=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const Yh=e=>e.join("/").replace(/\/\/+/g,"/"),yde=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),bde=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,wde=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function jde(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const sG=["post","put","patch","delete"];new Set(sG);const _de=["get",...sG];new Set(_de);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ow(){return Ow=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ow.apply(this,arguments)}const LC=p.createContext(null),oG=p.createContext(null),Xm=p.createContext(null),$C=p.createContext(null),Ym=p.createContext({outlet:null,matches:[],isDataRoute:!1}),iG=p.createContext(null);function Nde(e,t){let{relative:r}=t===void 0?{}:t;ty()||ri(!1);let{basename:n,navigator:s}=p.useContext(Xm),{hash:o,pathname:i,search:l}=BC(e,{relative:r}),c=i;return n!=="/"&&(c=i==="/"?n:Yh([n,i])),s.createHref({pathname:c,search:l,hash:o})}function ty(){return p.useContext($C)!=null}function _i(){return ty()||ri(!1),p.useContext($C).location}function lG(e){p.useContext(Xm).static||p.useLayoutEffect(e)}function Il(){let{isDataRoute:e}=p.useContext(Ym);return e?Lde():Sde()}function Sde(){ty()||ri(!1);let e=p.useContext(LC),{basename:t,future:r,navigator:n}=p.useContext(Xm),{matches:s}=p.useContext(Ym),{pathname:o}=_i(),i=JSON.stringify(V4(s,r.v7_relativeSplatPath)),l=p.useRef(!1);return lG(()=>{l.current=!0}),p.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){n.go(d);return}let f=W4(d,JSON.parse(i),o,u.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Yh([t,f.pathname])),(u.replace?n.replace:n.push)(f,u.state,u)},[t,n,i,o,e])}function Cde(){let{matches:e}=p.useContext(Ym),t=e[e.length-1];return t?t.params:{}}function BC(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=p.useContext(Xm),{matches:s}=p.useContext(Ym),{pathname:o}=_i(),i=JSON.stringify(V4(s,n.v7_relativeSplatPath));return p.useMemo(()=>W4(e,JSON.parse(i),o,r==="path"),[e,i,o,r])}function Ade(e,t){return Pde(e,t)}function Pde(e,t,r,n){ty()||ri(!1);let{navigator:s}=p.useContext(Xm),{matches:o}=p.useContext(Ym),i=o[o.length-1],l=i?i.params:{};i&&i.pathname;let c=i?i.pathnameBase:"/";i&&i.route;let d=_i(),u;if(t){var f;let v=typeof t=="string"?ey(t):t;c==="/"||(f=v.pathname)!=null&&f.startsWith(c)||ri(!1),u=v}else u=d;let h=u.pathname||"/",m=h;if(c!=="/"){let v=c.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let x=rde(e,{pathname:m}),g=Tde(x&&x.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:Yh([c,s.encodeLocation?s.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:Yh([c,s.encodeLocation?s.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,r,n);return t&&g?p.createElement($C.Provider,{value:{location:Ow({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Th.Pop}},g):g}function Ede(){let e=Fde(),t=jde(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},o=null;return p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},t),r?p.createElement("pre",{style:s},r):null,o)}const kde=p.createElement(Ede,null);class Ide extends p.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?p.createElement(Ym.Provider,{value:this.props.routeContext},p.createElement(iG.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ode(e){let{routeContext:t,match:r,children:n}=e,s=p.useContext(LC);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),p.createElement(Ym.Provider,{value:t},n)}function Tde(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,l=(s=r)==null?void 0:s.errors;if(l!=null){let u=i.findIndex(f=>f.route.id&&l?.[f.route.id]!==void 0);u>=0||ri(!1),i=i.slice(0,Math.min(i.length,u+1))}let c=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let u=0;u<i.length;u++){let f=i[u];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(d=u),f.route.id){let{loaderData:h,errors:m}=r,x=f.route.loader&&h[f.route.id]===void 0&&(!m||m[f.route.id]===void 0);if(f.route.lazy||x){c=!0,d>=0?i=i.slice(0,d+1):i=[i[0]];break}}}return i.reduceRight((u,f,h)=>{let m,x=!1,g=null,v=null;r&&(m=l&&f.route.id?l[f.route.id]:void 0,g=f.route.errorElement||kde,c&&(d<0&&h===0?($de("route-fallback",!1),x=!0,v=null):d===h&&(x=!0,v=f.route.hydrateFallbackElement||null)));let y=t.concat(i.slice(0,h+1)),b=()=>{let w;return m?w=g:x?w=v:f.route.Component?w=p.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=u,p.createElement(Ode,{match:f,routeContext:{outlet:u,matches:y,isDataRoute:r!=null},children:w})};return r&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?p.createElement(Ide,{location:r.location,revalidation:r.revalidation,component:g,error:m,children:b(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):b()},null)}var cG=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(cG||{}),vN=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(vN||{});function Dde(e){let t=p.useContext(LC);return t||ri(!1),t}function Mde(e){let t=p.useContext(oG);return t||ri(!1),t}function Rde(e){let t=p.useContext(Ym);return t||ri(!1),t}function dG(e){let t=Rde(),r=t.matches[t.matches.length-1];return r.route.id||ri(!1),r.route.id}function Fde(){var e;let t=p.useContext(iG),r=Mde(vN.UseRouteError),n=dG(vN.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Lde(){let{router:e}=Dde(cG.UseNavigateStable),t=dG(vN.UseNavigateStable),r=p.useRef(!1);return lG(()=>{r.current=!0}),p.useCallback(function(s,o){o===void 0&&(o={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,Ow({fromRouteId:t},o)))},[e,t])}const ZL={};function $de(e,t,r){!t&&!ZL[e]&&(ZL[e]=!0)}function Bde(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function uG(e){let{to:t,replace:r,state:n,relative:s}=e;ty()||ri(!1);let{future:o,static:i}=p.useContext(Xm),{matches:l}=p.useContext(Ym),{pathname:c}=_i(),d=Il(),u=W4(t,V4(l,o.v7_relativeSplatPath),c,s==="path"),f=JSON.stringify(u);return p.useEffect(()=>d(JSON.parse(f),{replace:r,state:n,relative:s}),[d,f,s,r,n]),null}function Js(e){ri(!1)}function qde(e){let{basename:t="/",children:r=null,location:n,navigationType:s=Th.Pop,navigator:o,static:i=!1,future:l}=e;ty()&&ri(!1);let c=t.replace(/^\/*/,"/"),d=p.useMemo(()=>({basename:c,navigator:o,static:i,future:Ow({v7_relativeSplatPath:!1},l)}),[c,l,o,i]);typeof n=="string"&&(n=ey(n));let{pathname:u="/",search:f="",hash:h="",state:m=null,key:x="default"}=n,g=p.useMemo(()=>{let v=c0(u,c);return v==null?null:{location:{pathname:v,search:f,hash:h,state:m,key:x},navigationType:s}},[c,u,f,h,m,x,s]);return g==null?null:p.createElement(Xm.Provider,{value:d},p.createElement($C.Provider,{children:r,value:g}))}function S2(e){let{children:t,location:r}=e;return Ade(FI(t),r)}new Promise(()=>{});function FI(e,t){t===void 0&&(t=[]);let r=[];return p.Children.forEach(e,(n,s)=>{if(!p.isValidElement(n))return;let o=[...t,s];if(n.type===p.Fragment){r.push.apply(r,FI(n.props.children,o));return}n.type!==Js&&ri(!1),!n.props.index||!n.props.children||ri(!1);let i={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=FI(n.props.children,o)),r.push(i)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yN(){return yN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yN.apply(this,arguments)}function fG(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function zde(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Ude(e,t){return e.button===0&&(!t||t==="_self")&&!zde(e)}function LI(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(s=>[r,s]):[[r,n]])},[]))}function Vde(e,t){let r=LI(e);return t&&t.forEach((n,s)=>{r.has(s)||t.getAll(s).forEach(o=>{r.append(s,o)})}),r}const Wde=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Hde=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Gde="6";try{window.__reactRouterVersion=Gde}catch{}const Kde=p.createContext({isTransitioning:!1}),Xde="startTransition",e$=Q3[Xde];function Yde(e){let{basename:t,children:r,future:n,window:s}=e,o=p.useRef();o.current==null&&(o.current=Zce({window:s,v5Compat:!0}));let i=o.current,[l,c]=p.useState({action:i.action,location:i.location}),{v7_startTransition:d}=n||{},u=p.useCallback(f=>{d&&e$?e$(()=>c(f)):c(f)},[c,d]);return p.useLayoutEffect(()=>i.listen(u),[i,u]),p.useEffect(()=>Bde(n),[n]),p.createElement(qde,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:i,future:n})}const Jde=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Qde=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,H4=p.forwardRef(function(t,r){let{onClick:n,relative:s,reloadDocument:o,replace:i,state:l,target:c,to:d,preventScrollReset:u,viewTransition:f}=t,h=fG(t,Wde),{basename:m}=p.useContext(Xm),x,g=!1;if(typeof d=="string"&&Qde.test(d)&&(x=d,Jde))try{let w=new URL(window.location.href),j=d.startsWith("//")?new URL(w.protocol+d):new URL(d),_=c0(j.pathname,m);j.origin===w.origin&&_!=null?d=_+j.search+j.hash:g=!0}catch{}let v=Nde(d,{relative:s}),y=eue(d,{replace:i,state:l,target:c,preventScrollReset:u,relative:s,viewTransition:f});function b(w){n&&n(w),w.defaultPrevented||y(w)}return p.createElement("a",yN({},h,{href:x||v,onClick:g||o?n:b,ref:r,target:c}))}),mm=p.forwardRef(function(t,r){let{"aria-current":n="page",caseSensitive:s=!1,className:o="",end:i=!1,style:l,to:c,viewTransition:d,children:u}=t,f=fG(t,Hde),h=BC(c,{relative:f.relative}),m=_i(),x=p.useContext(oG),{navigator:g,basename:v}=p.useContext(Xm),y=x!=null&&tue(h)&&d===!0,b=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,w=m.pathname,j=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;s||(w=w.toLowerCase(),j=j?j.toLowerCase():null,b=b.toLowerCase()),j&&v&&(j=c0(j,v)||j);const _=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let C=w===b||!i&&w.startsWith(b)&&w.charAt(_)==="/",E=j!=null&&(j===b||!i&&j.startsWith(b)&&j.charAt(b.length)==="/"),S={isActive:C,isPending:E,isTransitioning:y},A=C?n:void 0,M;typeof o=="function"?M=o(S):M=[o,C?"active":null,E?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let O=typeof l=="function"?l(S):l;return p.createElement(H4,yN({},f,{"aria-current":A,className:M,ref:r,style:O,to:c,viewTransition:d}),typeof u=="function"?u(S):u)});var $I;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})($I||($I={}));var t$;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(t$||(t$={}));function Zde(e){let t=p.useContext(LC);return t||ri(!1),t}function eue(e,t){let{target:r,replace:n,state:s,preventScrollReset:o,relative:i,viewTransition:l}=t===void 0?{}:t,c=Il(),d=_i(),u=BC(e,{relative:i});return p.useCallback(f=>{if(Ude(f,r)){f.preventDefault();let h=n!==void 0?n:gN(d)===gN(u);c(e,{replace:h,state:s,preventScrollReset:o,relative:i,viewTransition:l})}},[d,c,u,n,s,r,e,o,i,l])}function qC(e){let t=p.useRef(LI(e)),r=p.useRef(!1),n=_i(),s=p.useMemo(()=>Vde(n.search,r.current?null:t.current),[n.search]),o=Il(),i=p.useCallback((l,c)=>{const d=LI(typeof l=="function"?l(s):l);r.current=!0,o("?"+d,c)},[o,s]);return[s,i]}function tue(e,t){t===void 0&&(t={});let r=p.useContext(Kde);r==null&&ri(!1);let{basename:n}=Zde($I.useViewTransitionState),s=BC(e,{relative:t.relative});if(!r.isTransitioning)return!1;let o=c0(r.currentLocation.pathname,n)||r.currentLocation.pathname,i=c0(r.nextLocation.pathname,n)||r.nextLocation.pathname;return xN(s.pathname,i)!=null||xN(s.pathname,o)!=null}function mG(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=mG(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function us(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=mG(e))&&(n&&(n+=" "),n+=t);return n}function rue(){for(var e=0,t,r,n="";e<arguments.length;)(t=arguments[e++])&&(r=hG(t))&&(n&&(n+=" "),n+=r);return n}function hG(e){if(typeof e=="string")return e;for(var t,r="",n=0;n<e.length;n++)e[n]&&(t=hG(e[n]))&&(r&&(r+=" "),r+=t);return r}var G4="-";function nue(e){var t=sue(e),r=e.conflictingClassGroups,n=e.conflictingClassGroupModifiers,s=n===void 0?{}:n;function o(l){var c=l.split(G4);return c[0]===""&&c.length!==1&&c.shift(),pG(c,t)||aue(l)}function i(l,c){var d=r[l]||[];return c&&s[l]?[].concat(d,s[l]):d}return{getClassGroupId:o,getConflictingClassGroupIds:i}}function pG(e,t){if(e.length===0)return t.classGroupId;var r=e[0],n=t.nextPart.get(r),s=n?pG(e.slice(1),n):void 0;if(s)return s;if(t.validators.length!==0){var o=e.join(G4);return t.validators.find(function(i){var l=i.validator;return l(o)})?.classGroupId}}var r$=/^\[(.+)\]$/;function aue(e){if(r$.test(e)){var t=r$.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}}function sue(e){var t=e.theme,r=e.prefix,n={nextPart:new Map,validators:[]},s=iue(Object.entries(e.classGroups),r);return s.forEach(function(o){var i=o[0],l=o[1];BI(l,n,i,t)}),n}function BI(e,t,r,n){e.forEach(function(s){if(typeof s=="string"){var o=s===""?t:n$(t,s);o.classGroupId=r;return}if(typeof s=="function"){if(oue(s)){BI(s(n),t,r,n);return}t.validators.push({validator:s,classGroupId:r});return}Object.entries(s).forEach(function(i){var l=i[0],c=i[1];BI(c,n$(t,l),r,n)})})}function n$(e,t){var r=e;return t.split(G4).forEach(function(n){r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r}function oue(e){return e.isThemeGetter}function iue(e,t){return t?e.map(function(r){var n=r[0],s=r[1],o=s.map(function(i){return typeof i=="string"?t+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(function(l){var c=l[0],d=l[1];return[t+c,d]})):i});return[n,o]}):e}function lue(e){if(e<1)return{get:function(){},set:function(){}};var t=0,r=new Map,n=new Map;function s(o,i){r.set(o,i),t++,t>e&&(t=0,n=r,r=new Map)}return{get:function(i){var l=r.get(i);if(l!==void 0)return l;if((l=n.get(i))!==void 0)return s(i,l),l},set:function(i,l){r.has(i)?r.set(i,l):s(i,l)}}}var gG="!";function cue(e){var t=e.separator||":",r=t.length===1,n=t[0],s=t.length;return function(i){for(var l=[],c=0,d=0,u,f=0;f<i.length;f++){var h=i[f];if(c===0){if(h===n&&(r||i.slice(f,f+s)===t)){l.push(i.slice(d,f)),d=f+s;continue}if(h==="/"){u=f;continue}}h==="["?c++:h==="]"&&c--}var m=l.length===0?i:i.substring(d),x=m.startsWith(gG),g=x?m.substring(1):m,v=u&&u>d?u-d:void 0;return{modifiers:l,hasImportantModifier:x,baseClassName:g,maybePostfixModifierPosition:v}}}function due(e){if(e.length<=1)return e;var t=[],r=[];return e.forEach(function(n){var s=n[0]==="[";s?(t.push.apply(t,r.sort().concat([n])),r=[]):r.push(n)}),t.push.apply(t,r.sort()),t}function uue(e){return{cache:lue(e.cacheSize),splitModifiers:cue(e),...nue(e)}}var fue=/\s+/;function mue(e,t){var r=t.splitModifiers,n=t.getClassGroupId,s=t.getConflictingClassGroupIds,o=new Set;return e.trim().split(fue).map(function(i){var l=r(i),c=l.modifiers,d=l.hasImportantModifier,u=l.baseClassName,f=l.maybePostfixModifierPosition,h=n(f?u.substring(0,f):u),m=!!f;if(!h){if(!f)return{isTailwindClass:!1,originalClassName:i};if(h=n(u),!h)return{isTailwindClass:!1,originalClassName:i};m=!1}var x=due(c).join(":"),g=d?x+gG:x;return{isTailwindClass:!0,modifierId:g,classGroupId:h,originalClassName:i,hasPostfixModifier:m}}).reverse().filter(function(i){if(!i.isTailwindClass)return!0;var l=i.modifierId,c=i.classGroupId,d=i.hasPostfixModifier,u=l+c;return o.has(u)?!1:(o.add(u),s(c,d).forEach(function(f){return o.add(l+f)}),!0)}).reverse().map(function(i){return i.originalClassName}).join(" ")}function hue(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,s,o,i=l;function l(d){var u=t[0],f=t.slice(1),h=f.reduce(function(m,x){return x(m)},u());return n=uue(h),s=n.cache.get,o=n.cache.set,i=c,c(d)}function c(d){var u=s(d);if(u)return u;var f=mue(d,n);return o(d,f),f}return function(){return i(rue.apply(null,arguments))}}function Ro(e){var t=function(n){return n[e]||[]};return t.isThemeGetter=!0,t}var xG=/^\[(?:([a-z-]+):)?(.+)\]$/i,pue=/^\d+\/\d+$/,gue=new Set(["px","full","screen"]),xue=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,vue=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,yue=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function Mu(e){return pg(e)||gue.has(e)||pue.test(e)||qI(e)}function qI(e){return mx(e,"length",Sue)}function bue(e){return mx(e,"size",vG)}function wue(e){return mx(e,"position",vG)}function jue(e){return mx(e,"url",Cue)}function c_(e){return mx(e,"number",pg)}function pg(e){return!Number.isNaN(Number(e))}function _ue(e){return e.endsWith("%")&&pg(e.slice(0,-1))}function Vy(e){return a$(e)||mx(e,"number",a$)}function Ds(e){return xG.test(e)}function Wy(){return!0}function oh(e){return xue.test(e)}function Nue(e){return mx(e,"",Aue)}function mx(e,t,r){var n=xG.exec(e);return n?n[1]?n[1]===t:r(n[2]):!1}function Sue(e){return vue.test(e)}function vG(){return!1}function Cue(e){return e.startsWith("url(")}function a$(e){return Number.isInteger(Number(e))}function Aue(e){return yue.test(e)}function Pue(){var e=Ro("colors"),t=Ro("spacing"),r=Ro("blur"),n=Ro("brightness"),s=Ro("borderColor"),o=Ro("borderRadius"),i=Ro("borderSpacing"),l=Ro("borderWidth"),c=Ro("contrast"),d=Ro("grayscale"),u=Ro("hueRotate"),f=Ro("invert"),h=Ro("gap"),m=Ro("gradientColorStops"),x=Ro("gradientColorStopPositions"),g=Ro("inset"),v=Ro("margin"),y=Ro("opacity"),b=Ro("padding"),w=Ro("saturate"),j=Ro("scale"),_=Ro("sepia"),C=Ro("skew"),E=Ro("space"),S=Ro("translate"),A=function(){return["auto","contain","none"]},M=function(){return["auto","hidden","clip","visible","scroll"]},O=function(){return["auto",Ds,t]},I=function(){return[Ds,t]},T=function(){return["",Mu]},k=function(){return["auto",pg,Ds]},q=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},B=function(){return["solid","dashed","dotted","double","none"]},z=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},F=function(){return["start","end","center","between","around","evenly","stretch"]},V=function(){return["","0",Ds]},me=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},be=function(){return[pg,c_]},U=function(){return[pg,Ds]};return{cacheSize:500,theme:{colors:[Wy],spacing:[Mu],blur:["none","",oh,Ds],brightness:be(),borderColor:[e],borderRadius:["none","","full",oh,Ds],borderSpacing:I(),borderWidth:T(),contrast:be(),grayscale:V(),hueRotate:U(),invert:V(),gap:I(),gradientColorStops:[e],gradientColorStopPositions:[_ue,qI],inset:O(),margin:O(),opacity:be(),padding:I(),saturate:be(),scale:be(),sepia:V(),skew:U(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",Ds]}],container:["container"],columns:[{columns:[oh]}],"break-after":[{"break-after":me()}],"break-before":[{"break-before":me()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat(q(),[Ds])}],overflow:[{overflow:M()}],"overflow-x":[{"overflow-x":M()}],"overflow-y":[{"overflow-y":M()}],overscroll:[{overscroll:A()}],"overscroll-x":[{"overscroll-x":A()}],"overscroll-y":[{"overscroll-y":A()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Vy]}],basis:[{basis:O()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ds]}],grow:[{grow:V()}],shrink:[{shrink:V()}],order:[{order:["first","last","none",Vy]}],"grid-cols":[{"grid-cols":[Wy]}],"col-start-end":[{col:["auto",{span:["full",Vy]},Ds]}],"col-start":[{"col-start":k()}],"col-end":[{"col-end":k()}],"grid-rows":[{"grid-rows":[Wy]}],"row-start-end":[{row:["auto",{span:[Vy]},Ds]}],"row-start":[{"row-start":k()}],"row-end":[{"row-end":k()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ds]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ds]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal"].concat(F())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(F(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(F(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[E]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[E]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",Ds,t]}],"min-w":[{"min-w":["min","max","fit",Ds,Mu]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[oh]},oh,Ds]}],h:[{h:[Ds,t,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",Ds,Mu]}],"max-h":[{"max-h":[Ds,t,"min","max","fit"]}],"font-size":[{text:["base",oh,qI]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",c_]}],"font-family":[{font:[Wy]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ds]}],"line-clamp":[{"line-clamp":["none",pg,c_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ds,Mu]}],"list-image":[{"list-image":["none",Ds]}],"list-style-type":[{list:["none","disc","decimal",Ds]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(B(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",Mu]}],"underline-offset":[{"underline-offset":["auto",Ds,Mu]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ds]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ds]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat(q(),[wue])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",bue]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},jue]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[].concat(B(),["hidden"])}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:B()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:[""].concat(B())}],"outline-offset":[{"outline-offset":[Ds,Mu]}],"outline-w":[{outline:[Mu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:T()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Mu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",oh,Nue]}],"shadow-color":[{shadow:[Wy]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":z()}],"bg-blend":[{"bg-blend":z()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",oh,Ds]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[f]}],saturate:[{saturate:[w]}],sepia:[{sepia:[_]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[_]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ds]}],duration:[{duration:U()}],ease:[{ease:["linear","in","out","in-out",Ds]}],delay:[{delay:U()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ds]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[j]}],"scale-x":[{"scale-x":[j]}],"scale-y":[{"scale-y":[j]}],rotate:[{rotate:[Vy,Ds]}],"translate-x":[{"translate-x":[S]}],"translate-y":[{"translate-y":[S]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ds]}],accent:[{accent:["auto",e]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ds]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ds]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Mu,c_]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}var Eue=hue(Pue);function Pr(...e){return Eue(us(e))}const s$=["#3B82F6","#22C55E","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#F43F5E","#10B981","#A855F7","#EAB308"];function kue(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return Math.abs(t)}function wh(e){if(!e)return"#94A3B8";const t=kue(String(e))%s$.length;return s$[t]}var Iue={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Oue=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),bn=(e,t)=>{const r=p.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:i,children:l,...c},d)=>p.createElement("svg",{ref:d,...Iue,width:s,height:s,stroke:n,strokeWidth:i?Number(o)*24/Number(s):o,className:`lucide lucide-${Oue(e)}`,...c},[...t.map(([u,f])=>p.createElement(u,f)),...(Array.isArray(l)?l:[l])||[]]));return r.displayName=`${e}`,r},Pd=bn("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Kf=bn("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Tue=bn("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]),Fb=bn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),d_=bn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),K4=bn("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),X4=bn("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),Y4=bn("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),C2=bn("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Lb=bn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),yG=bn("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),Due=bn("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),bN=bn("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),Mue=bn("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),zC=bn("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),Rue=bn("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),J4=bn("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),A2=bn("CalendarX",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"10",x2:"14",y1:"14",y2:"18",key:"1g3qc0"}],["line",{x1:"14",x2:"10",y1:"14",y2:"18",key:"1az83m"}]]),Io=bn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),bb=bn("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Di=bn("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Fm=bn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),hx=bn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),zI=bn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Kg=bn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Fue=bn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Lue=bn("Chrome",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["line",{x1:"21.17",x2:"12",y1:"8",y2:"8",key:"a0cw5f"}],["line",{x1:"3.95",x2:"8.54",y1:"6.06",y2:"14",key:"1kftof"}],["line",{x1:"10.88",x2:"15.46",y1:"21.94",y2:"14",key:"1ymyh8"}]]),$ue=bn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Bue=bn("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]),pu=bn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Q4=bn("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Dh=bn("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Wi=bn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),ws=bn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),kg=bn("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Xg=bn("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ix=bn("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),il=bn("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),wN=bn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),que=bn("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),zue=bn("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Uue=bn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Vue=bn("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),Wue=bn("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),Hue=bn("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Gue=bn("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),bG=bn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Kue=bn("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",key:"1kog09"}]]),Xue=bn("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),Yue=bn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),wG=bn("LifeBuoy",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.93 4.93 4.24 4.24",key:"1ymg45"}],["path",{d:"m14.83 9.17 4.24-4.24",key:"1cb5xl"}],["path",{d:"m14.83 14.83 4.24 4.24",key:"q42g0n"}],["path",{d:"m9.17 14.83-4.24 4.24",key:"bqpfvv"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]),jG=bn("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),Jue=bn("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),cl=bn("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),d0=bn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Que=bn("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Zue=bn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),u0=bn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),o$=bn("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),efe=bn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),kP=bn("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),tfe=bn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),i$=bn("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),_v=bn("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),rfe=bn("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),l$=bn("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),bu=bn("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),fc=bn("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),nfe=bn("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Tw=bn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),_G=bn("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),so=bn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),NG=bn("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),Ig=bn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),c$=bn("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),afe=bn("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Yo=bn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Z4=bn("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Wc=bn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),d$=bn("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),u$=bn("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),sfe=bn("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),qv=bn("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),Y1=bn("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),f$=bn("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),IP=bn("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),UI=bn("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),ofe=bn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),eD=bn("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]),u_=bn("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),bc=bn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ife=bn("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Lm=bn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),jd=bn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),lfe=bn("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]),SG=bn("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),tD=bn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),cfe=bn("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),dfe=bn("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),ufe=bn("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),CG=bn("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),kf=bn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),mc=bn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),AG=bn("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]),Og=bn("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Hc=bn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),dl=({size:e="md",variant:t="header",className:r=""})=>{const n={xs:"w-8 h-8",sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20",xl:"w-24 h-24"},s={header:"/isis-profile.png",message:"/isis-profile-baloon.png"},o=s[t]||s.header,i=e==="lg"?"scale-125":e==="md"?"scale-110":"scale-100";return a.jsx("div",{className:`${n[e]||n.md} rounded-full overflow-hidden flex-shrink-0 ring-2 ring-brand ring-offset-0 ${r}`,children:a.jsx("img",{src:o,alt:"Assistente Virtual",className:`w-full h-full object-cover ${i}`,onError:l=>{l.target.style.display="none",l.target.parentElement.innerHTML=`
            <div class="w-full h-full bg-brand flex items-center justify-center">
              <span class="text-bg font-bold text-lg">A</span>
            </div>
          `}})})},PG=p.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),UC=p.createContext({}),VC=p.createContext(null),WC=typeof document<"u",rD=WC?p.useLayoutEffect:p.useEffect,EG=p.createContext({strict:!1}),nD=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),ffe="framerAppearId",kG="data-"+nD(ffe);function mfe(e,t,r,n){const{visualElement:s}=p.useContext(UC),o=p.useContext(EG),i=p.useContext(VC),l=p.useContext(PG).reducedMotion,c=p.useRef();n=n||o.renderer,!c.current&&n&&(c.current=n(e,{visualState:t,parent:s,props:r,presenceContext:i,blockInitialAnimation:i?i.initial===!1:!1,reducedMotionConfig:l}));const d=c.current;p.useInsertionEffect(()=>{d&&d.update(r,i)});const u=p.useRef(!!(r[kG]&&!window.HandoffComplete));return rD(()=>{d&&(d.render(),u.current&&d.animationState&&d.animationState.animateChanges())}),p.useEffect(()=>{d&&(d.updateFeatures(),!u.current&&d.animationState&&d.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),d}function Nv(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function hfe(e,t,r){return p.useCallback(n=>{n&&e.mount&&e.mount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):Nv(r)&&(r.current=n))},[t])}function Dw(e){return typeof e=="string"||Array.isArray(e)}function HC(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const aD=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],sD=["initial",...aD];function GC(e){return HC(e.animate)||sD.some(t=>Dw(e[t]))}function IG(e){return!!(GC(e)||e.variants)}function pfe(e,t){if(GC(e)){const{initial:r,animate:n}=e;return{initial:r===!1||Dw(r)?r:void 0,animate:Dw(n)?n:void 0}}return e.inherit!==!1?t:{}}function gfe(e){const{initial:t,animate:r}=pfe(e,p.useContext(UC));return p.useMemo(()=>({initial:t,animate:r}),[m$(t),m$(r)])}function m$(e){return Array.isArray(e)?e.join(" "):e}const h$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Mw={};for(const e in h$)Mw[e]={isEnabled:t=>h$[e].some(r=>!!t[r])};function xfe(e){for(const t in e)Mw[t]={...Mw[t],...e[t]}}const oD=p.createContext({}),OG=p.createContext({}),vfe=Symbol.for("motionComponentSymbol");function yfe({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:n,Component:s}){e&&xfe(e);function o(l,c){let d;const u={...p.useContext(PG),...l,layoutId:bfe(l)},{isStatic:f}=u,h=gfe(l),m=n(l,f);if(!f&&WC){h.visualElement=mfe(s,m,u,t);const x=p.useContext(OG),g=p.useContext(EG).strict;h.visualElement&&(d=h.visualElement.loadFeatures(u,g,e,x))}return p.createElement(UC.Provider,{value:h},d&&h.visualElement?p.createElement(d,{visualElement:h.visualElement,...u}):null,r(s,l,hfe(m,h.visualElement,c),m,f,h.visualElement))}const i=p.forwardRef(o);return i[vfe]=s,i}function bfe({layoutId:e}){const t=p.useContext(oD).id;return t&&e!==void 0?t+"-"+e:e}function wfe(e){function t(n,s={}){return yfe(e(n,s))}if(typeof Proxy>"u")return t;const r=new Map;return new Proxy(t,{get:(n,s)=>(r.has(s)||r.set(s,t(s)),r.get(s))})}const jfe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function iD(e){return typeof e!="string"||e.includes("-")?!1:!!(jfe.indexOf(e)>-1||/[A-Z]/.test(e))}const jN={};function _fe(e){Object.assign(jN,e)}const J1=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],px=new Set(J1);function TG(e,{layout:t,layoutId:r}){return px.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!jN[e]||e==="opacity")}const Kc=e=>!!(e&&e.getVelocity),Nfe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Sfe=J1.length;function Cfe(e,{enableHardwareAcceleration:t=!0,allowTransformNone:r=!0},n,s){let o="";for(let i=0;i<Sfe;i++){const l=J1[i];if(e[l]!==void 0){const c=Nfe[l]||l;o+=`${c}(${e[l]}) `}}return t&&!e.z&&(o+="translateZ(0)"),o=o.trim(),s?o=s(e,n?"":o):r&&n&&(o="none"),o}const DG=e=>t=>typeof t=="string"&&t.startsWith(e),MG=DG("--"),VI=DG("var(--"),Afe=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,Pfe=(e,t)=>t&&typeof e=="number"?t.transform(e):e,mp=(e,t,r)=>Math.min(Math.max(r,e),t),gx={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},$b={...gx,transform:e=>mp(0,1,e)},f_={...gx,default:1},Bb=e=>Math.round(e*1e5)/1e5,KC=/(-)?([\d]*\.?[\d])+/g,RG=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Efe=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Q1(e){return typeof e=="string"}const Z1=e=>({test:t=>Q1(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),hh=Z1("deg"),Bf=Z1("%"),ts=Z1("px"),kfe=Z1("vh"),Ife=Z1("vw"),p$={...Bf,parse:e=>Bf.parse(e)/100,transform:e=>Bf.transform(e*100)},g$={...gx,transform:Math.round},FG={borderWidth:ts,borderTopWidth:ts,borderRightWidth:ts,borderBottomWidth:ts,borderLeftWidth:ts,borderRadius:ts,radius:ts,borderTopLeftRadius:ts,borderTopRightRadius:ts,borderBottomRightRadius:ts,borderBottomLeftRadius:ts,width:ts,maxWidth:ts,height:ts,maxHeight:ts,size:ts,top:ts,right:ts,bottom:ts,left:ts,padding:ts,paddingTop:ts,paddingRight:ts,paddingBottom:ts,paddingLeft:ts,margin:ts,marginTop:ts,marginRight:ts,marginBottom:ts,marginLeft:ts,rotate:hh,rotateX:hh,rotateY:hh,rotateZ:hh,scale:f_,scaleX:f_,scaleY:f_,scaleZ:f_,skew:hh,skewX:hh,skewY:hh,distance:ts,translateX:ts,translateY:ts,translateZ:ts,x:ts,y:ts,z:ts,perspective:ts,transformPerspective:ts,opacity:$b,originX:p$,originY:p$,originZ:ts,zIndex:g$,fillOpacity:$b,strokeOpacity:$b,numOctaves:g$};function lD(e,t,r,n){const{style:s,vars:o,transform:i,transformOrigin:l}=e;let c=!1,d=!1,u=!0;for(const f in t){const h=t[f];if(MG(f)){o[f]=h;continue}const m=FG[f],x=Pfe(h,m);if(px.has(f)){if(c=!0,i[f]=x,!u)continue;h!==(m.default||0)&&(u=!1)}else f.startsWith("origin")?(d=!0,l[f]=x):s[f]=x}if(t.transform||(c||n?s.transform=Cfe(e.transform,r,u,n):s.transform&&(s.transform="none")),d){const{originX:f="50%",originY:h="50%",originZ:m=0}=l;s.transformOrigin=`${f} ${h} ${m}`}}const cD=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function LG(e,t,r){for(const n in t)!Kc(t[n])&&!TG(n,r)&&(e[n]=t[n])}function Ofe({transformTemplate:e},t,r){return p.useMemo(()=>{const n=cD();return lD(n,t,{enableHardwareAcceleration:!r},e),Object.assign({},n.vars,n.style)},[t])}function Tfe(e,t,r){const n=e.style||{},s={};return LG(s,n,e),Object.assign(s,Ofe(e,t,r)),e.transformValues?e.transformValues(s):s}function Dfe(e,t,r){const n={},s=Tfe(e,t,r);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const Mfe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function _N(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Mfe.has(e)}let $G=e=>!_N(e);function Rfe(e){e&&($G=t=>t.startsWith("on")?!_N(t):e(t))}try{Rfe(require("@emotion/is-prop-valid").default)}catch{}function Ffe(e,t,r){const n={};for(const s in e)s==="values"&&typeof e.values=="object"||($G(s)||r===!0&&_N(s)||!t&&!_N(s)||e.draggable&&s.startsWith("onDrag"))&&(n[s]=e[s]);return n}function x$(e,t,r){return typeof e=="string"?e:ts.transform(t+r*e)}function Lfe(e,t,r){const n=x$(t,e.x,e.width),s=x$(r,e.y,e.height);return`${n} ${s}`}const $fe={offset:"stroke-dashoffset",array:"stroke-dasharray"},Bfe={offset:"strokeDashoffset",array:"strokeDasharray"};function qfe(e,t,r=1,n=0,s=!0){e.pathLength=1;const o=s?$fe:Bfe;e[o.offset]=ts.transform(-n);const i=ts.transform(t),l=ts.transform(r);e[o.array]=`${i} ${l}`}function dD(e,{attrX:t,attrY:r,attrScale:n,originX:s,originY:o,pathLength:i,pathSpacing:l=1,pathOffset:c=0,...d},u,f,h){if(lD(e,d,u,h),f){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:m,style:x,dimensions:g}=e;m.transform&&(g&&(x.transform=m.transform),delete m.transform),g&&(s!==void 0||o!==void 0||x.transform)&&(x.transformOrigin=Lfe(g,s!==void 0?s:.5,o!==void 0?o:.5)),t!==void 0&&(m.x=t),r!==void 0&&(m.y=r),n!==void 0&&(m.scale=n),i!==void 0&&qfe(m,i,l,c,!1)}const BG=()=>({...cD(),attrs:{}}),uD=e=>typeof e=="string"&&e.toLowerCase()==="svg";function zfe(e,t,r,n){const s=p.useMemo(()=>{const o=BG();return dD(o,t,{enableHardwareAcceleration:!1},uD(n),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};LG(o,e.style,e),s.style={...o,...s.style}}return s}function Ufe(e=!1){return(r,n,s,{latestValues:o},i)=>{const c=(iD(r)?zfe:Dfe)(n,o,i,r),u={...Ffe(n,typeof r=="string",e),...c,ref:s},{children:f}=n,h=p.useMemo(()=>Kc(f)?f.get():f,[f]);return p.createElement(r,{...u,children:h})}}function qG(e,{style:t,vars:r},n,s){Object.assign(e.style,t,s&&s.getProjectionStyles(n));for(const o in r)e.style.setProperty(o,r[o])}const zG=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function UG(e,t,r,n){qG(e,t,void 0,n);for(const s in t.attrs)e.setAttribute(zG.has(s)?s:nD(s),t.attrs[s])}function fD(e,t){const{style:r}=e,n={};for(const s in r)(Kc(r[s])||t.style&&Kc(t.style[s])||TG(s,e))&&(n[s]=r[s]);return n}function VG(e,t){const r=fD(e,t);for(const n in e)if(Kc(e[n])||Kc(t[n])){const s=J1.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=e[n]}return r}function mD(e,t,r,n={},s={}){return typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,s)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(r!==void 0?r:e.custom,n,s)),t}function WG(e){const t=p.useRef(null);return t.current===null&&(t.current=e()),t.current}const NN=e=>Array.isArray(e),Vfe=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),Wfe=e=>NN(e)?e[e.length-1]||0:e;function P2(e){const t=Kc(e)?e.get():e;return Vfe(t)?t.toValue():t}function Hfe({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:r},n,s,o){const i={latestValues:Gfe(n,s,o,e),renderState:t()};return r&&(i.mount=l=>r(n,l,i)),i}const HG=e=>(t,r)=>{const n=p.useContext(UC),s=p.useContext(VC),o=()=>Hfe(e,t,n,s);return r?o():WG(o)};function Gfe(e,t,r,n){const s={},o=n(e,{});for(const h in o)s[h]=P2(o[h]);let{initial:i,animate:l}=e;const c=GC(e),d=IG(e);t&&d&&!c&&e.inherit!==!1&&(i===void 0&&(i=t.initial),l===void 0&&(l=t.animate));let u=r?r.initial===!1:!1;u=u||i===!1;const f=u?l:i;return f&&typeof f!="boolean"&&!HC(f)&&(Array.isArray(f)?f:[f]).forEach(m=>{const x=mD(e,m);if(!x)return;const{transitionEnd:g,transition:v,...y}=x;for(const b in y){let w=y[b];if(Array.isArray(w)){const j=u?w.length-1:0;w=w[j]}w!==null&&(s[b]=w)}for(const b in g)s[b]=g[b]}),s}const mi=e=>e;class v${constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const r=this.order.indexOf(t);r!==-1&&(this.order.splice(r,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function Kfe(e){let t=new v$,r=new v$,n=0,s=!1,o=!1;const i=new WeakSet,l={schedule:(c,d=!1,u=!1)=>{const f=u&&s,h=f?t:r;return d&&i.add(c),h.add(c)&&f&&s&&(n=t.order.length),c},cancel:c=>{r.remove(c),i.delete(c)},process:c=>{if(s){o=!0;return}if(s=!0,[t,r]=[r,t],r.clear(),n=t.order.length,n)for(let d=0;d<n;d++){const u=t.order[d];u(c),i.has(u)&&(l.schedule(u),e())}s=!1,o&&(o=!1,l.process(c))}};return l}const m_=["prepare","read","update","preRender","render","postRender"],Xfe=40;function Yfe(e,t){let r=!1,n=!0;const s={delta:0,timestamp:0,isProcessing:!1},o=m_.reduce((f,h)=>(f[h]=Kfe(()=>r=!0),f),{}),i=f=>o[f].process(s),l=()=>{const f=performance.now();r=!1,s.delta=n?1e3/60:Math.max(Math.min(f-s.timestamp,Xfe),1),s.timestamp=f,s.isProcessing=!0,m_.forEach(i),s.isProcessing=!1,r&&t&&(n=!1,e(l))},c=()=>{r=!0,n=!0,s.isProcessing||e(l)};return{schedule:m_.reduce((f,h)=>{const m=o[h];return f[h]=(x,g=!1,v=!1)=>(r||c(),m.schedule(x,g,v)),f},{}),cancel:f=>m_.forEach(h=>o[h].cancel(f)),state:s,steps:o}}const{schedule:Oo,cancel:$m,state:zl,steps:OP}=Yfe(typeof requestAnimationFrame<"u"?requestAnimationFrame:mi,!0),Jfe={useVisualState:HG({scrapeMotionValuesFromProps:VG,createRenderState:BG,onMount:(e,t,{renderState:r,latestValues:n})=>{Oo.read(()=>{try{r.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}}),Oo.render(()=>{dD(r,n,{enableHardwareAcceleration:!1},uD(t.tagName),e.transformTemplate),UG(t,r)})}})},Qfe={useVisualState:HG({scrapeMotionValuesFromProps:fD,createRenderState:cD})};function Zfe(e,{forwardMotionProps:t=!1},r,n){return{...iD(e)?Jfe:Qfe,preloadedFeatures:r,useRender:Ufe(t),createVisualElement:n,Component:e}}function _m(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}const GG=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function XC(e,t="page"){return{point:{x:e[t+"X"],y:e[t+"Y"]}}}const eme=e=>t=>GG(t)&&e(t,XC(t));function Em(e,t,r,n){return _m(e,t,eme(r),n)}const tme=(e,t)=>r=>t(e(r)),Jh=(...e)=>e.reduce(tme);function KG(e){let t=null;return()=>{const r=()=>{t=null};return t===null?(t=e,r):!1}}const y$=KG("dragHorizontal"),b$=KG("dragVertical");function XG(e){let t=!1;if(e==="y")t=b$();else if(e==="x")t=y$();else{const r=y$(),n=b$();r&&n?t=()=>{r(),n()}:(r&&r(),n&&n())}return t}function YG(){const e=XG(!0);return e?(e(),!1):!0}class Ap{constructor(t){this.isMounted=!1,this.node=t}update(){}}function w$(e,t){const r="pointer"+(t?"enter":"leave"),n="onHover"+(t?"Start":"End"),s=(o,i)=>{if(o.pointerType==="touch"||YG())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t),l[n]&&Oo.update(()=>l[n](o,i))};return Em(e.current,r,s,{passive:!e.getProps()[n]})}class rme extends Ap{mount(){this.unmount=Jh(w$(this.node,!0),w$(this.node,!1))}unmount(){}}class nme extends Ap{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Jh(_m(this.node.current,"focus",()=>this.onFocus()),_m(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const JG=(e,t)=>t?e===t?!0:JG(e,t.parentElement):!1;function TP(e,t){if(!t)return;const r=new PointerEvent("pointer"+e);t(r,XC(r))}class ame extends Ap{constructor(){super(...arguments),this.removeStartListeners=mi,this.removeEndListeners=mi,this.removeAccessibleListeners=mi,this.startPointerPress=(t,r)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),o=Em(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:u,globalTapTarget:f}=this.node.getProps();Oo.update(()=>{!f&&!JG(this.node.current,l.target)?u&&u(l,c):d&&d(l,c)})},{passive:!(n.onTap||n.onPointerUp)}),i=Em(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=Jh(o,i),this.startPress(t,r)},this.startAccessiblePress=()=>{const t=o=>{if(o.key!=="Enter"||this.isPressing)return;const i=l=>{l.key!=="Enter"||!this.checkPressEnd()||TP("up",(c,d)=>{const{onTap:u}=this.node.getProps();u&&Oo.update(()=>u(c,d))})};this.removeEndListeners(),this.removeEndListeners=_m(this.node.current,"keyup",i),TP("down",(l,c)=>{this.startPress(l,c)})},r=_m(this.node.current,"keydown",t),n=()=>{this.isPressing&&TP("cancel",(o,i)=>this.cancelPress(o,i))},s=_m(this.node.current,"blur",n);this.removeAccessibleListeners=Jh(r,s)}}startPress(t,r){this.isPressing=!0;const{onTapStart:n,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&Oo.update(()=>n(t,r))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!YG()}cancelPress(t,r){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&Oo.update(()=>n(t,r))}mount(){const t=this.node.getProps(),r=Em(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),n=_m(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Jh(r,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const WI=new WeakMap,DP=new WeakMap,sme=e=>{const t=WI.get(e.target);t&&t(e)},ome=e=>{e.forEach(sme)};function ime({root:e,...t}){const r=e||document;DP.has(r)||DP.set(r,{});const n=DP.get(r),s=JSON.stringify(t);return n[s]||(n[s]=new IntersectionObserver(ome,{root:e,...t})),n[s]}function lme(e,t,r){const n=ime(t);return WI.set(e,r),n.observe(e),()=>{WI.delete(e),n.unobserve(e)}}const cme={some:0,all:1};class dme extends Ap{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:s="some",once:o}=t,i={root:r?r.current:void 0,rootMargin:n,threshold:typeof s=="number"?s:cme[s]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:f}=this.node.getProps(),h=d?u:f;h&&h(c)};return lme(this.node.current,i,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(ume(t,r))&&this.startObserver()}unmount(){}}function ume({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const fme={inView:{Feature:dme},tap:{Feature:ame},focus:{Feature:nme},hover:{Feature:rme}};function QG(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function mme(e){const t={};return e.values.forEach((r,n)=>t[n]=r.get()),t}function hme(e){const t={};return e.values.forEach((r,n)=>t[n]=r.getVelocity()),t}function YC(e,t,r){const n=e.getProps();return mD(n,t,r!==void 0?r:n.custom,mme(e),hme(e))}let pme=mi,hD=mi;const Qh=e=>e*1e3,km=e=>e/1e3,gme={current:!1},ZG=e=>Array.isArray(e)&&typeof e[0]=="number";function eK(e){return!!(!e||typeof e=="string"&&tK[e]||ZG(e)||Array.isArray(e)&&e.every(eK))}const wb=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,tK={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:wb([0,.65,.55,1]),circOut:wb([.55,0,1,.45]),backIn:wb([.31,.01,.66,-.59]),backOut:wb([.33,1.53,.69,.99])};function rK(e){if(e)return ZG(e)?wb(e):Array.isArray(e)?e.map(rK):tK[e]}function xme(e,t,r,{delay:n=0,duration:s,repeat:o=0,repeatType:i="loop",ease:l,times:c}={}){const d={[t]:r};c&&(d.offset=c);const u=rK(l);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:n,duration:s,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:o+1,direction:i==="reverse"?"alternate":"normal"})}function vme(e,{repeat:t,repeatType:r="loop"}){const n=t&&r!=="loop"&&t%2===1?0:e.length-1;return e[n]}const nK=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,yme=1e-7,bme=12;function wme(e,t,r,n,s){let o,i,l=0;do i=t+(r-t)/2,o=nK(i,n,s)-e,o>0?r=i:t=i;while(Math.abs(o)>yme&&++l<bme);return i}function ej(e,t,r,n){if(e===t&&r===n)return mi;const s=o=>wme(o,0,1,e,r);return o=>o===0||o===1?o:nK(s(o),t,n)}const jme=ej(.42,0,1,1),_me=ej(0,0,.58,1),aK=ej(.42,0,.58,1),Nme=e=>Array.isArray(e)&&typeof e[0]!="number",sK=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,oK=e=>t=>1-e(1-t),pD=e=>1-Math.sin(Math.acos(e)),iK=oK(pD),Sme=sK(pD),lK=ej(.33,1.53,.69,.99),gD=oK(lK),Cme=sK(gD),Ame=e=>(e*=2)<1?.5*gD(e):.5*(2-Math.pow(2,-10*(e-1))),Pme={linear:mi,easeIn:jme,easeInOut:aK,easeOut:_me,circIn:pD,circInOut:Sme,circOut:iK,backIn:gD,backInOut:Cme,backOut:lK,anticipate:Ame},j$=e=>{if(Array.isArray(e)){hD(e.length===4);const[t,r,n,s]=e;return ej(t,r,n,s)}else if(typeof e=="string")return Pme[e];return e},xD=(e,t)=>r=>!!(Q1(r)&&Efe.test(r)&&r.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(r,t)),cK=(e,t,r)=>n=>{if(!Q1(n))return n;const[s,o,i,l]=n.match(KC);return{[e]:parseFloat(s),[t]:parseFloat(o),[r]:parseFloat(i),alpha:l!==void 0?parseFloat(l):1}},Eme=e=>mp(0,255,e),MP={...gx,transform:e=>Math.round(Eme(e))},gg={test:xD("rgb","red"),parse:cK("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+MP.transform(e)+", "+MP.transform(t)+", "+MP.transform(r)+", "+Bb($b.transform(n))+")"};function kme(e){let t="",r="",n="",s="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),s=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),s=e.substring(4,5),t+=t,r+=r,n+=n,s+=s),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}}const HI={test:xD("#"),parse:kme,transform:gg.transform},Sv={test:xD("hsl","hue"),parse:cK("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Bf.transform(Bb(t))+", "+Bf.transform(Bb(r))+", "+Bb($b.transform(n))+")"},cc={test:e=>gg.test(e)||HI.test(e)||Sv.test(e),parse:e=>gg.test(e)?gg.parse(e):Sv.test(e)?Sv.parse(e):HI.parse(e),transform:e=>Q1(e)?e:e.hasOwnProperty("red")?gg.transform(e):Sv.transform(e)},Jo=(e,t,r)=>-r*e+r*t+e;function RP(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Ime({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let s=0,o=0,i=0;if(!t)s=o=i=r;else{const l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;s=RP(c,l,e+1/3),o=RP(c,l,e),i=RP(c,l,e-1/3)}return{red:Math.round(s*255),green:Math.round(o*255),blue:Math.round(i*255),alpha:n}}const FP=(e,t,r)=>{const n=e*e;return Math.sqrt(Math.max(0,r*(t*t-n)+n))},Ome=[HI,gg,Sv],Tme=e=>Ome.find(t=>t.test(e));function _$(e){const t=Tme(e);let r=t.parse(e);return t===Sv&&(r=Ime(r)),r}const dK=(e,t)=>{const r=_$(e),n=_$(t),s={...r};return o=>(s.red=FP(r.red,n.red,o),s.green=FP(r.green,n.green,o),s.blue=FP(r.blue,n.blue,o),s.alpha=Jo(r.alpha,n.alpha,o),gg.transform(s))};function Dme(e){var t,r;return isNaN(e)&&Q1(e)&&(((t=e.match(KC))===null||t===void 0?void 0:t.length)||0)+(((r=e.match(RG))===null||r===void 0?void 0:r.length)||0)>0}const uK={regex:Afe,countKey:"Vars",token:"${v}",parse:mi},fK={regex:RG,countKey:"Colors",token:"${c}",parse:cc.parse},mK={regex:KC,countKey:"Numbers",token:"${n}",parse:gx.parse};function LP(e,{regex:t,countKey:r,token:n,parse:s}){const o=e.tokenised.match(t);o&&(e["num"+r]=o.length,e.tokenised=e.tokenised.replace(t,n),e.values.push(...o.map(s)))}function SN(e){const t=e.toString(),r={value:t,tokenised:t,values:[],numVars:0,numColors:0,numNumbers:0};return r.value.includes("var(--")&&LP(r,uK),LP(r,fK),LP(r,mK),r}function hK(e){return SN(e).values}function pK(e){const{values:t,numColors:r,numVars:n,tokenised:s}=SN(e),o=t.length;return i=>{let l=s;for(let c=0;c<o;c++)c<n?l=l.replace(uK.token,i[c]):c<n+r?l=l.replace(fK.token,cc.transform(i[c])):l=l.replace(mK.token,Bb(i[c]));return l}}const Mme=e=>typeof e=="number"?0:e;function Rme(e){const t=hK(e);return pK(e)(t.map(Mme))}const hp={test:Dme,parse:hK,createTransformer:pK,getAnimatableNone:Rme},gK=(e,t)=>r=>`${r>0?t:e}`;function xK(e,t){return typeof e=="number"?r=>Jo(e,t,r):cc.test(e)?dK(e,t):e.startsWith("var(")?gK(e,t):yK(e,t)}const vK=(e,t)=>{const r=[...e],n=r.length,s=e.map((o,i)=>xK(o,t[i]));return o=>{for(let i=0;i<n;i++)r[i]=s[i](o);return r}},Fme=(e,t)=>{const r={...e,...t},n={};for(const s in r)e[s]!==void 0&&t[s]!==void 0&&(n[s]=xK(e[s],t[s]));return s=>{for(const o in n)r[o]=n[o](s);return r}},yK=(e,t)=>{const r=hp.createTransformer(t),n=SN(e),s=SN(t);return n.numVars===s.numVars&&n.numColors===s.numColors&&n.numNumbers>=s.numNumbers?Jh(vK(n.values,s.values),r):gK(e,t)},Rw=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n},N$=(e,t)=>r=>Jo(e,t,r);function Lme(e){return typeof e=="number"?N$:typeof e=="string"?cc.test(e)?dK:yK:Array.isArray(e)?vK:typeof e=="object"?Fme:N$}function $me(e,t,r){const n=[],s=r||Lme(e[0]),o=e.length-1;for(let i=0;i<o;i++){let l=s(e[i],e[i+1]);if(t){const c=Array.isArray(t)?t[i]||mi:t;l=Jh(c,l)}n.push(l)}return n}function bK(e,t,{clamp:r=!0,ease:n,mixer:s}={}){const o=e.length;if(hD(o===t.length),o===1)return()=>t[0];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=$me(t,n,s),l=i.length,c=d=>{let u=0;if(l>1)for(;u<e.length-2&&!(d<e[u+1]);u++);const f=Rw(e[u],e[u+1],d);return i[u](f)};return r?d=>c(mp(e[0],e[o-1],d)):c}function Bme(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const s=Rw(0,t,n);e.push(Jo(r,1,s))}}function qme(e){const t=[0];return Bme(t,e.length-1),t}function zme(e,t){return e.map(r=>r*t)}function Ume(e,t){return e.map(()=>t||aK).splice(0,e.length-1)}function CN({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const s=Nme(n)?n.map(j$):j$(n),o={done:!1,value:t[0]},i=zme(r&&r.length===t.length?r:qme(t),e),l=bK(i,t,{ease:Array.isArray(s)?s:Ume(t,s)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}function wK(e,t){return t?e*(1e3/t):0}const Vme=5;function jK(e,t,r){const n=Math.max(t-Vme,0);return wK(r-e(n),t-n)}const $P=.001,Wme=.01,S$=10,Hme=.05,Gme=1;function Kme({duration:e=800,bounce:t=.25,velocity:r=0,mass:n=1}){let s,o;pme(e<=Qh(S$));let i=1-t;i=mp(Hme,Gme,i),e=mp(Wme,S$,km(e)),i<1?(s=d=>{const u=d*i,f=u*e,h=u-r,m=GI(d,i),x=Math.exp(-f);return $P-h/m*x},o=d=>{const f=d*i*e,h=f*r+r,m=Math.pow(i,2)*Math.pow(d,2)*e,x=Math.exp(-f),g=GI(Math.pow(d,2),i);return(-s(d)+$P>0?-1:1)*((h-m)*x)/g}):(s=d=>{const u=Math.exp(-d*e),f=(d-r)*e+1;return-$P+u*f},o=d=>{const u=Math.exp(-d*e),f=(r-d)*(e*e);return u*f});const l=5/e,c=Yme(s,o,l);if(e=Qh(e),isNaN(c))return{stiffness:100,damping:10,duration:e};{const d=Math.pow(c,2)*n;return{stiffness:d,damping:i*2*Math.sqrt(n*d),duration:e}}}const Xme=12;function Yme(e,t,r){let n=r;for(let s=1;s<Xme;s++)n=n-e(n)/t(n);return n}function GI(e,t){return e*Math.sqrt(1-t*t)}const Jme=["duration","bounce"],Qme=["stiffness","damping","mass"];function C$(e,t){return t.some(r=>e[r]!==void 0)}function Zme(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!C$(e,Qme)&&C$(e,Jme)){const r=Kme(e);t={...t,...r,mass:1},t.isResolvedFromDuration=!0}return t}function _K({keyframes:e,restDelta:t,restSpeed:r,...n}){const s=e[0],o=e[e.length-1],i={done:!1,value:s},{stiffness:l,damping:c,mass:d,duration:u,velocity:f,isResolvedFromDuration:h}=Zme({...n,velocity:-km(n.velocity||0)}),m=f||0,x=c/(2*Math.sqrt(l*d)),g=o-s,v=km(Math.sqrt(l/d)),y=Math.abs(g)<5;r||(r=y?.01:2),t||(t=y?.005:.5);let b;if(x<1){const w=GI(v,x);b=j=>{const _=Math.exp(-x*v*j);return o-_*((m+x*v*g)/w*Math.sin(w*j)+g*Math.cos(w*j))}}else if(x===1)b=w=>o-Math.exp(-v*w)*(g+(m+v*g)*w);else{const w=v*Math.sqrt(x*x-1);b=j=>{const _=Math.exp(-x*v*j),C=Math.min(w*j,300);return o-_*((m+x*v*g)*Math.sinh(C)+w*g*Math.cosh(C))/w}}return{calculatedDuration:h&&u||null,next:w=>{const j=b(w);if(h)i.done=w>=u;else{let _=m;w!==0&&(x<1?_=jK(b,w,j):_=0);const C=Math.abs(_)<=r,E=Math.abs(o-j)<=t;i.done=C&&E}return i.value=i.done?o:j,i}}}function A$({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:s=10,bounceStiffness:o=500,modifyTarget:i,min:l,max:c,restDelta:d=.5,restSpeed:u}){const f=e[0],h={done:!1,value:f},m=S=>l!==void 0&&S<l||c!==void 0&&S>c,x=S=>l===void 0?c:c===void 0||Math.abs(l-S)<Math.abs(c-S)?l:c;let g=r*t;const v=f+g,y=i===void 0?v:i(v);y!==v&&(g=y-f);const b=S=>-g*Math.exp(-S/n),w=S=>y+b(S),j=S=>{const A=b(S),M=w(S);h.done=Math.abs(A)<=d,h.value=h.done?y:M};let _,C;const E=S=>{m(h.value)&&(_=S,C=_K({keyframes:[h.value,x(h.value)],velocity:jK(w,S,h.value),damping:s,stiffness:o,restDelta:d,restSpeed:u}))};return E(0),{calculatedDuration:null,next:S=>{let A=!1;return!C&&_===void 0&&(A=!0,j(S),E(S)),_!==void 0&&S>_?C.next(S-_):(!A&&j(S),h)}}}const ehe=e=>{const t=({timestamp:r})=>e(r);return{start:()=>Oo.update(t,!0),stop:()=>$m(t),now:()=>zl.isProcessing?zl.timestamp:performance.now()}},P$=2e4;function E$(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<P$;)t+=r,n=e.next(t);return t>=P$?1/0:t}const the={decay:A$,inertia:A$,tween:CN,keyframes:CN,spring:_K};function AN({autoplay:e=!0,delay:t=0,driver:r=ehe,keyframes:n,type:s="keyframes",repeat:o=0,repeatDelay:i=0,repeatType:l="loop",onPlay:c,onStop:d,onComplete:u,onUpdate:f,...h}){let m=1,x=!1,g,v;const y=()=>{v=new Promise(be=>{g=be})};y();let b;const w=the[s]||CN;let j;w!==CN&&typeof n[0]!="number"&&(j=bK([0,100],n,{clamp:!1}),n=[0,100]);const _=w({...h,keyframes:n});let C;l==="mirror"&&(C=w({...h,keyframes:[...n].reverse(),velocity:-(h.velocity||0)}));let E="idle",S=null,A=null,M=null;_.calculatedDuration===null&&o&&(_.calculatedDuration=E$(_));const{calculatedDuration:O}=_;let I=1/0,T=1/0;O!==null&&(I=O+i,T=I*(o+1)-i);let k=0;const q=be=>{if(A===null)return;m>0&&(A=Math.min(A,be)),m<0&&(A=Math.min(be-T/m,A)),S!==null?k=S:k=Math.round(be-A)*m;const U=k-t*(m>=0?1:-1),L=m>=0?U<0:U>T;k=Math.max(U,0),E==="finished"&&S===null&&(k=T);let H=k,ie=_;if(o){const pe=Math.min(k,T)/I;let G=Math.floor(pe),te=pe%1;!te&&pe>=1&&(te=1),te===1&&G--,G=Math.min(G,o+1),!!(G%2)&&(l==="reverse"?(te=1-te,i&&(te-=i/I)):l==="mirror"&&(ie=C)),H=mp(0,1,te)*I}const Y=L?{done:!1,value:n[0]}:ie.next(H);j&&(Y.value=j(Y.value));let{done:W}=Y;!L&&O!==null&&(W=m>=0?k>=T:k<=0);const se=S===null&&(E==="finished"||E==="running"&&W);return f&&f(Y.value),se&&F(),Y},B=()=>{b&&b.stop(),b=void 0},z=()=>{E="idle",B(),g(),y(),A=M=null},F=()=>{E="finished",u&&u(),B(),g()},V=()=>{if(x)return;b||(b=r(q));const be=b.now();c&&c(),S!==null?A=be-S:(!A||E==="finished")&&(A=be),E==="finished"&&y(),M=A,S=null,E="running",b.start()};e&&V();const me={then(be,U){return v.then(be,U)},get time(){return km(k)},set time(be){be=Qh(be),k=be,S!==null||!b||m===0?S=be:A=b.now()-be/m},get duration(){const be=_.calculatedDuration===null?E$(_):_.calculatedDuration;return km(be)},get speed(){return m},set speed(be){be===m||!b||(m=be,me.time=km(k))},get state(){return E},play:V,pause:()=>{E="paused",S=k},stop:()=>{x=!0,E!=="idle"&&(E="idle",d&&d(),z())},cancel:()=>{M!==null&&q(M),z()},complete:()=>{E="finished"},sample:be=>(A=0,q(be))};return me}function rhe(e){let t;return()=>(t===void 0&&(t=e()),t)}const nhe=rhe(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),ahe=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),h_=10,she=2e4,ohe=(e,t)=>t.type==="spring"||e==="backgroundColor"||!eK(t.ease);function ihe(e,t,{onUpdate:r,onComplete:n,...s}){if(!(nhe()&&ahe.has(t)&&!s.repeatDelay&&s.repeatType!=="mirror"&&s.damping!==0&&s.type!=="inertia"))return!1;let i=!1,l,c,d=!1;const u=()=>{c=new Promise(w=>{l=w})};u();let{keyframes:f,duration:h=300,ease:m,times:x}=s;if(ohe(t,s)){const w=AN({...s,repeat:0,delay:0});let j={done:!1,value:f[0]};const _=[];let C=0;for(;!j.done&&C<she;)j=w.sample(C),_.push(j.value),C+=h_;x=void 0,f=_,h=C-h_,m="linear"}const g=xme(e.owner.current,t,f,{...s,duration:h,ease:m,times:x}),v=()=>{d=!1,g.cancel()},y=()=>{d=!0,Oo.update(v),l(),u()};return g.onfinish=()=>{d||(e.set(vme(f,s)),n&&n(),y())},{then(w,j){return c.then(w,j)},attachTimeline(w){return g.timeline=w,g.onfinish=null,mi},get time(){return km(g.currentTime||0)},set time(w){g.currentTime=Qh(w)},get speed(){return g.playbackRate},set speed(w){g.playbackRate=w},get duration(){return km(h)},play:()=>{i||(g.play(),$m(v))},pause:()=>g.pause(),stop:()=>{if(i=!0,g.playState==="idle")return;const{currentTime:w}=g;if(w){const j=AN({...s,autoplay:!1});e.setWithVelocity(j.sample(w-h_).value,j.sample(w).value,h_)}y()},complete:()=>{d||g.finish()},cancel:y}}function lhe({keyframes:e,delay:t,onUpdate:r,onComplete:n}){const s=()=>(r&&r(e[e.length-1]),n&&n(),{time:0,speed:1,duration:0,play:mi,pause:mi,stop:mi,then:o=>(o(),Promise.resolve()),cancel:mi,complete:mi});return t?AN({keyframes:[0,1],duration:0,delay:t,onComplete:s}):s()}const che={type:"spring",stiffness:500,damping:25,restSpeed:10},dhe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),uhe={type:"keyframes",duration:.8},fhe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},mhe=(e,{keyframes:t})=>t.length>2?uhe:px.has(e)?e.startsWith("scale")?dhe(t[1]):che:fhe,KI=(e,t)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(hp.test(t)||t==="0")&&!t.startsWith("url(")),hhe=new Set(["brightness","contrast","saturate","opacity"]);function phe(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(KC)||[];if(!n)return e;const s=r.replace(n,"");let o=hhe.has(t)?1:0;return n!==r&&(o*=100),t+"("+o+s+")"}const ghe=/([a-z-]*)\(.*?\)/g,XI={...hp,getAnimatableNone:e=>{const t=e.match(ghe);return t?t.map(phe).join(" "):e}},xhe={...FG,color:cc,backgroundColor:cc,outlineColor:cc,fill:cc,stroke:cc,borderColor:cc,borderTopColor:cc,borderRightColor:cc,borderBottomColor:cc,borderLeftColor:cc,filter:XI,WebkitFilter:XI},vD=e=>xhe[e];function NK(e,t){let r=vD(e);return r!==XI&&(r=hp),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const SK=e=>/^0[^.\s]+$/.test(e);function vhe(e){if(typeof e=="number")return e===0;if(e!==null)return e==="none"||e==="0"||SK(e)}function yhe(e,t,r,n){const s=KI(t,r);let o;Array.isArray(r)?o=[...r]:o=[null,r];const i=n.from!==void 0?n.from:e.get();let l;const c=[];for(let d=0;d<o.length;d++)o[d]===null&&(o[d]=d===0?i:o[d-1]),vhe(o[d])&&c.push(d),typeof o[d]=="string"&&o[d]!=="none"&&o[d]!=="0"&&(l=o[d]);if(s&&c.length&&l)for(let d=0;d<c.length;d++){const u=c[d];o[u]=NK(t,l)}return o}function bhe({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:s,repeat:o,repeatType:i,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}function yD(e,t){return e[t]||e.default||e}const whe={skipAnimations:!1},bD=(e,t,r,n={})=>s=>{const o=yD(n,e)||{},i=o.delay||n.delay||0;let{elapsed:l=0}=n;l=l-Qh(i);const c=yhe(t,e,r,o),d=c[0],u=c[c.length-1],f=KI(e,d),h=KI(e,u);let m={keyframes:c,velocity:t.getVelocity(),ease:"easeOut",...o,delay:-l,onUpdate:x=>{t.set(x),o.onUpdate&&o.onUpdate(x)},onComplete:()=>{s(),o.onComplete&&o.onComplete()}};if(bhe(o)||(m={...m,...mhe(e,m)}),m.duration&&(m.duration=Qh(m.duration)),m.repeatDelay&&(m.repeatDelay=Qh(m.repeatDelay)),!f||!h||gme.current||o.type===!1||whe.skipAnimations)return lhe(m);if(!n.isHandoff&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const x=ihe(t,e,m);if(x)return x}return AN(m)};function PN(e){return!!(Kc(e)&&e.add)}const CK=e=>/^\-?\d*\.?\d+$/.test(e);function wD(e,t){e.indexOf(t)===-1&&e.push(t)}function jD(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class _D{constructor(){this.subscriptions=[]}add(t){return wD(this.subscriptions,t),()=>jD(this.subscriptions,t)}notify(t,r,n){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](t,r,n);else for(let o=0;o<s;o++){const i=this.subscriptions[o];i&&i(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const jhe=e=>!isNaN(parseFloat(e));class _he{constructor(t,r={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(n,s=!0)=>{this.prev=this.current,this.current=n;const{delta:o,timestamp:i}=zl;this.lastUpdated!==i&&(this.timeDelta=o,this.lastUpdated=i,Oo.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>Oo.postRender(this.velocityCheck),this.velocityCheck=({timestamp:n})=>{n!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=jhe(this.current),this.owner=r.owner}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new _D);const n=this.events[t].add(r);return t==="change"?()=>{n(),Oo.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,r,n){this.set(r),this.prev=t,this.timeDelta=n}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?wK(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function f0(e,t){return new _he(e,t)}const AK=e=>t=>t.test(e),Nhe={test:e=>e==="auto",parse:e=>e},PK=[gx,ts,Bf,hh,Ife,kfe,Nhe],Hy=e=>PK.find(AK(e)),She=[...PK,cc,hp],Che=e=>She.find(AK(e));function Ahe(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,f0(r))}function Phe(e,t){const r=YC(e,t);let{transitionEnd:n={},transition:s={},...o}=r?e.makeTargetAnimatable(r,!1):{};o={...o,...n};for(const i in o){const l=Wfe(o[i]);Ahe(e,i,l)}}function Ehe(e,t,r){var n,s;const o=Object.keys(t).filter(l=>!e.hasValue(l)),i=o.length;if(i)for(let l=0;l<i;l++){const c=o[l],d=t[c];let u=null;Array.isArray(d)&&(u=d[0]),u===null&&(u=(s=(n=r[c])!==null&&n!==void 0?n:e.readValue(c))!==null&&s!==void 0?s:t[c]),u!=null&&(typeof u=="string"&&(CK(u)||SK(u))?u=parseFloat(u):!Che(u)&&hp.test(d)&&(u=NK(c,d)),e.addValue(c,f0(u,{owner:e})),r[c]===void 0&&(r[c]=u),u!==null&&e.setBaseTarget(c,u))}}function khe(e,t){return t?(t[e]||t.default||t).from:void 0}function Ihe(e,t,r){const n={};for(const s in e){const o=khe(s,t);if(o!==void 0)n[s]=o;else{const i=r.getValue(s);i&&(n[s]=i.get())}}return n}function Ohe({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function The(e,t){const r=e.get();if(Array.isArray(t)){for(let n=0;n<t.length;n++)if(t[n]!==r)return!0}else return r!==t}function EK(e,t,{delay:r=0,transitionOverride:n,type:s}={}){let{transition:o=e.getDefaultTransition(),transitionEnd:i,...l}=e.makeTargetAnimatable(t);const c=e.getValue("willChange");n&&(o=n);const d=[],u=s&&e.animationState&&e.animationState.getState()[s];for(const f in l){const h=e.getValue(f),m=l[f];if(!h||m===void 0||u&&Ohe(u,f))continue;const x={delay:r,elapsed:0,...yD(o||{},f)};if(window.HandoffAppearAnimations){const y=e.getProps()[kG];if(y){const b=window.HandoffAppearAnimations(y,f,h,Oo);b!==null&&(x.elapsed=b,x.isHandoff=!0)}}let g=!x.isHandoff&&!The(h,m);if(x.type==="spring"&&(h.getVelocity()||x.velocity)&&(g=!1),h.animation&&(g=!1),g)continue;h.start(bD(f,h,m,e.shouldReduceMotion&&px.has(f)?{type:!1}:x));const v=h.animation;PN(c)&&(c.add(f),v.then(()=>c.remove(f))),d.push(v)}return i&&Promise.all(d).then(()=>{i&&Phe(e,i)}),d}function YI(e,t,r={}){const n=YC(e,t,r.custom);let{transition:s=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(s=r.transitionOverride);const o=n?()=>Promise.all(EK(e,n,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:f}=s;return Dhe(e,t,d+c,u,f,r)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,d]=l==="beforeChildren"?[o,i]:[i,o];return c().then(()=>d())}else return Promise.all([o(),i(r.delay)])}function Dhe(e,t,r=0,n=0,s=1,o){const i=[],l=(e.variantChildren.size-1)*n,c=s===1?(d=0)=>d*n:(d=0)=>l-d*n;return Array.from(e.variantChildren).sort(Mhe).forEach((d,u)=>{d.notify("AnimationStart",t),i.push(YI(d,t,{...o,delay:r+c(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(i)}function Mhe(e,t){return e.sortNodePosition(t)}function Rhe(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const s=t.map(o=>YI(e,o,r));n=Promise.all(s)}else if(typeof t=="string")n=YI(e,t,r);else{const s=typeof t=="function"?YC(e,t,r.custom):t;n=Promise.all(EK(e,s,r))}return n.then(()=>e.notify("AnimationComplete",t))}const Fhe=[...aD].reverse(),Lhe=aD.length;function $he(e){return t=>Promise.all(t.map(({animation:r,options:n})=>Rhe(e,r,n)))}function Bhe(e){let t=$he(e);const r=zhe();let n=!0;const s=(c,d)=>{const u=YC(e,d);if(u){const{transition:f,transitionEnd:h,...m}=u;c={...c,...m,...h}}return c};function o(c){t=c(e)}function i(c,d){const u=e.getProps(),f=e.getVariantContext(!0)||{},h=[],m=new Set;let x={},g=1/0;for(let y=0;y<Lhe;y++){const b=Fhe[y],w=r[b],j=u[b]!==void 0?u[b]:f[b],_=Dw(j),C=b===d?w.isActive:null;C===!1&&(g=y);let E=j===f[b]&&j!==u[b]&&_;if(E&&n&&e.manuallyAnimateOnMount&&(E=!1),w.protectedKeys={...x},!w.isActive&&C===null||!j&&!w.prevProp||HC(j)||typeof j=="boolean")continue;let A=qhe(w.prevProp,j)||b===d&&w.isActive&&!E&&_||y>g&&_,M=!1;const O=Array.isArray(j)?j:[j];let I=O.reduce(s,{});C===!1&&(I={});const{prevResolvedValues:T={}}=w,k={...T,...I},q=B=>{A=!0,m.has(B)&&(M=!0,m.delete(B)),w.needsAnimating[B]=!0};for(const B in k){const z=I[B],F=T[B];if(x.hasOwnProperty(B))continue;let V=!1;NN(z)&&NN(F)?V=!QG(z,F):V=z!==F,V?z!==void 0?q(B):m.add(B):z!==void 0&&m.has(B)?q(B):w.protectedKeys[B]=!0}w.prevProp=j,w.prevResolvedValues=I,w.isActive&&(x={...x,...I}),n&&e.blockInitialAnimation&&(A=!1),A&&(!E||M)&&h.push(...O.map(B=>({animation:B,options:{type:b,...c}})))}if(m.size){const y={};m.forEach(b=>{const w=e.getBaseTarget(b);w!==void 0&&(y[b]=w)}),h.push({animation:y})}let v=!!h.length;return n&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(v=!1),n=!1,v?t(h):Promise.resolve()}function l(c,d,u){var f;if(r[c].isActive===d)return Promise.resolve();(f=e.variantChildren)===null||f===void 0||f.forEach(m=>{var x;return(x=m.animationState)===null||x===void 0?void 0:x.setActive(c,d)}),r[c].isActive=d;const h=i(u,c);for(const m in r)r[m].protectedKeys={};return h}return{animateChanges:i,setActive:l,setAnimateFunction:o,getState:()=>r}}function qhe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!QG(t,e):!1}function qp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function zhe(){return{animate:qp(!0),whileInView:qp(),whileHover:qp(),whileTap:qp(),whileDrag:qp(),whileFocus:qp(),exit:qp()}}class Uhe extends Ap{constructor(t){super(t),t.animationState||(t.animationState=Bhe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),HC(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){}}let Vhe=0;class Whe extends Ap{constructor(){super(...arguments),this.id=Vhe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r,custom:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const o=this.node.animationState.setActive("exit",!t,{custom:n??this.node.getProps().custom});r&&!t&&o.then(()=>r(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const Hhe={animation:{Feature:Uhe},exit:{Feature:Whe}},k$=(e,t)=>Math.abs(e-t);function Ghe(e,t){const r=k$(e.x,t.x),n=k$(e.y,t.y);return Math.sqrt(r**2+n**2)}class kK{constructor(t,r,{transformPagePoint:n,contextWindow:s,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=qP(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,m=Ghe(f.offset,{x:0,y:0})>=3;if(!h&&!m)return;const{point:x}=f,{timestamp:g}=zl;this.history.push({...x,timestamp:g});const{onStart:v,onMove:y}=this.handlers;h||(v&&v(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,f)},this.handlePointerMove=(f,h)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=BP(h,this.transformPagePoint),Oo.update(this.updatePoint,!0)},this.handlePointerUp=(f,h)=>{this.end();const{onEnd:m,onSessionEnd:x,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=qP(f.type==="pointercancel"?this.lastMoveEventInfo:BP(h,this.transformPagePoint),this.history);this.startEvent&&m&&m(f,v),x&&x(f,v)},!GG(t))return;this.dragSnapToOrigin=o,this.handlers=r,this.transformPagePoint=n,this.contextWindow=s||window;const i=XC(t),l=BP(i,this.transformPagePoint),{point:c}=l,{timestamp:d}=zl;this.history=[{...c,timestamp:d}];const{onSessionStart:u}=r;u&&u(t,qP(l,this.history)),this.removeListeners=Jh(Em(this.contextWindow,"pointermove",this.handlePointerMove),Em(this.contextWindow,"pointerup",this.handlePointerUp),Em(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),$m(this.updatePoint)}}function BP(e,t){return t?{point:t(e.point)}:e}function I$(e,t){return{x:e.x-t.x,y:e.y-t.y}}function qP({point:e},t){return{point:e,delta:I$(e,IK(t)),offset:I$(e,Khe(t)),velocity:Xhe(t,.1)}}function Khe(e){return e[0]}function IK(e){return e[e.length-1]}function Xhe(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const s=IK(e);for(;r>=0&&(n=e[r],!(s.timestamp-n.timestamp>Qh(t)));)r--;if(!n)return{x:0,y:0};const o=km(s.timestamp-n.timestamp);if(o===0)return{x:0,y:0};const i={x:(s.x-n.x)/o,y:(s.y-n.y)/o};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function Rd(e){return e.max-e.min}function JI(e,t=0,r=.01){return Math.abs(e-t)<=r}function O$(e,t,r,n=.5){e.origin=n,e.originPoint=Jo(t.min,t.max,e.origin),e.scale=Rd(r)/Rd(t),(JI(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=Jo(r.min,r.max,e.origin)-e.originPoint,(JI(e.translate)||isNaN(e.translate))&&(e.translate=0)}function qb(e,t,r,n){O$(e.x,t.x,r.x,n?n.originX:void 0),O$(e.y,t.y,r.y,n?n.originY:void 0)}function T$(e,t,r){e.min=r.min+t.min,e.max=e.min+Rd(t)}function Yhe(e,t,r){T$(e.x,t.x,r.x),T$(e.y,t.y,r.y)}function D$(e,t,r){e.min=t.min-r.min,e.max=e.min+Rd(t)}function zb(e,t,r){D$(e.x,t.x,r.x),D$(e.y,t.y,r.y)}function Jhe(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?Jo(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?Jo(r,e,n.max):Math.min(e,r)),e}function M$(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Qhe(e,{top:t,left:r,bottom:n,right:s}){return{x:M$(e.x,r,s),y:M$(e.y,t,n)}}function R$(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function Zhe(e,t){return{x:R$(e.x,t.x),y:R$(e.y,t.y)}}function epe(e,t){let r=.5;const n=Rd(e),s=Rd(t);return s>n?r=Rw(t.min,t.max-n,e.min):n>s&&(r=Rw(e.min,e.max-s,t.min)),mp(0,1,r)}function tpe(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const QI=.35;function rpe(e=QI){return e===!1?e=0:e===!0&&(e=QI),{x:F$(e,"left","right"),y:F$(e,"top","bottom")}}function F$(e,t,r){return{min:L$(e,t),max:L$(e,r)}}function L$(e,t){return typeof e=="number"?e:e[t]||0}const $$=()=>({translate:0,scale:1,origin:0,originPoint:0}),Cv=()=>({x:$$(),y:$$()}),B$=()=>({min:0,max:0}),Ei=()=>({x:B$(),y:B$()});function Jd(e){return[e("x"),e("y")]}function OK({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function npe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function ape(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function zP(e){return e===void 0||e===1}function ZI({scale:e,scaleX:t,scaleY:r}){return!zP(e)||!zP(t)||!zP(r)}function Qp(e){return ZI(e)||TK(e)||e.z||e.rotate||e.rotateX||e.rotateY}function TK(e){return q$(e.x)||q$(e.y)}function q$(e){return e&&e!=="0%"}function EN(e,t,r){const n=e-r,s=t*n;return r+s}function z$(e,t,r,n,s){return s!==void 0&&(e=EN(e,s,n)),EN(e,r,n)+t}function eO(e,t=0,r=1,n,s){e.min=z$(e.min,t,r,n,s),e.max=z$(e.max,t,r,n,s)}function DK(e,{x:t,y:r}){eO(e.x,t.translate,t.scale,t.originPoint),eO(e.y,r.translate,r.scale,r.originPoint)}function spe(e,t,r,n=!1){const s=r.length;if(!s)return;t.x=t.y=1;let o,i;for(let l=0;l<s;l++){o=r[l],i=o.projectionDelta;const c=o.instance;c&&c.style&&c.style.display==="contents"||(n&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Av(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,DK(e,i)),n&&Qp(o.latestValues)&&Av(e,o.latestValues))}t.x=U$(t.x),t.y=U$(t.y)}function U$(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function jh(e,t){e.min=e.min+t,e.max=e.max+t}function V$(e,t,[r,n,s]){const o=t[s]!==void 0?t[s]:.5,i=Jo(e.min,e.max,o);eO(e,t[r],t[n],i,t.scale)}const ope=["x","scaleX","originX"],ipe=["y","scaleY","originY"];function Av(e,t){V$(e.x,t,ope),V$(e.y,t,ipe)}function MK(e,t){return OK(ape(e.getBoundingClientRect(),t))}function lpe(e,t,r){const n=MK(e,r),{scroll:s}=t;return s&&(jh(n.x,s.offset.x),jh(n.y,s.offset.y)),n}const RK=({current:e})=>e?e.ownerDocument.defaultView:null,cpe=new WeakMap;class dpe{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ei(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const s=u=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(XC(u,"page").point)},o=(u,f)=>{const{drag:h,dragPropagation:m,onDragStart:x}=this.getProps();if(h&&!m&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=XG(h),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Jd(v=>{let y=this.getAxisMotionValue(v).get()||0;if(Bf.test(y)){const{projection:b}=this.visualElement;if(b&&b.layout){const w=b.layout.layoutBox[v];w&&(y=Rd(w)*(parseFloat(y)/100))}}this.originPoint[v]=y}),x&&Oo.update(()=>x(u,f),!1,!0);const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},i=(u,f)=>{const{dragPropagation:h,dragDirectionLock:m,onDirectionLock:x,onDrag:g}=this.getProps();if(!h&&!this.openGlobalLock)return;const{offset:v}=f;if(m&&this.currentDirection===null){this.currentDirection=upe(v),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",f.point,v),this.updateAxis("y",f.point,v),this.visualElement.render(),g&&g(u,f)},l=(u,f)=>this.stop(u,f),c=()=>Jd(u=>{var f;return this.getAnimationState(u)==="paused"&&((f=this.getAxisMotionValue(u).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new kK(t,{onSessionStart:s,onStart:o,onMove:i,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:RK(this.visualElement)})}stop(t,r){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:s}=r;this.startAnimation(s);const{onDragEnd:o}=this.getProps();o&&Oo.update(()=>o(t,r))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:s}=this.getProps();if(!n||!p_(t,s,this.currentDirection))return;const o=this.getAxisMotionValue(t);let i=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(i=Jhe(i,this.constraints[t],this.elastic[t])),o.set(i)}resolveConstraints(){var t;const{dragConstraints:r,dragElastic:n}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;r&&Nv(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&s?this.constraints=Qhe(s.layoutBox,r):this.constraints=!1,this.elastic=rpe(n),o!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Jd(i=>{this.getAxisMotionValue(i)&&(this.constraints[i]=tpe(s.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Nv(t))return!1;const n=t.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const o=lpe(n,s.root,this.visualElement.getTransformPagePoint());let i=Zhe(s.layout.layoutBox,o);if(r){const l=r(npe(i));this.hasMutatedConstraints=!!l,l&&(i=OK(l))}return i}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:s,dragTransition:o,dragSnapToOrigin:i,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Jd(u=>{if(!p_(u,r,this.currentDirection))return;let f=c&&c[u]||{};i&&(f={min:0,max:0});const h=s?200:1e6,m=s?40:1e7,x={type:"inertia",velocity:n?t[u]:0,bounceStiffness:h,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...f};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return n.start(bD(t,n,0,r))}stopAnimation(){Jd(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Jd(t=>{var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(t){const r="_drag"+t.toUpperCase(),n=this.visualElement.getProps(),s=n[r];return s||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Jd(r=>{const{drag:n}=this.getProps();if(!p_(r,n,this.currentDirection))return;const{projection:s}=this.visualElement,o=this.getAxisMotionValue(r);if(s&&s.layout){const{min:i,max:l}=s.layout.layoutBox[r];o.set(t[r]-Jo(i,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!Nv(r)||!n||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};Jd(i=>{const l=this.getAxisMotionValue(i);if(l){const c=l.get();s[i]=epe({min:c,max:c},this.constraints[i])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Jd(i=>{if(!p_(i,t,null))return;const l=this.getAxisMotionValue(i),{min:c,max:d}=this.constraints[i];l.set(Jo(c,d,s[i]))})}addListeners(){if(!this.visualElement.current)return;cpe.set(this.visualElement,this);const t=this.visualElement.current,r=Em(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();Nv(c)&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,o=s.addEventListener("measure",n);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),n();const i=_m(window,"resize",()=>this.scalePositionWithinConstraints()),l=s.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Jd(u=>{const f=this.getAxisMotionValue(u);f&&(this.originPoint[u]+=c[u].translate,f.set(f.get()+c[u].translate))}),this.visualElement.render())});return()=>{i(),r(),o(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:s=!1,dragConstraints:o=!1,dragElastic:i=QI,dragMomentum:l=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:s,dragConstraints:o,dragElastic:i,dragMomentum:l}}}function p_(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function upe(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class fpe extends Ap{constructor(t){super(t),this.removeGroupControls=mi,this.removeListeners=mi,this.controls=new dpe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||mi}unmount(){this.removeGroupControls(),this.removeListeners()}}const W$=e=>(t,r)=>{e&&Oo.update(()=>e(t,r))};class mpe extends Ap{constructor(){super(...arguments),this.removePointerDownListener=mi}onPointerDown(t){this.session=new kK(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:RK(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:s}=this.node.getProps();return{onSessionStart:W$(t),onStart:W$(r),onMove:n,onEnd:(o,i)=>{delete this.session,s&&Oo.update(()=>s(o,i))}}}mount(){this.removePointerDownListener=Em(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function hpe(){const e=p.useContext(VC);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:n}=e,s=p.useId();return p.useEffect(()=>n(s),[]),!t&&r?[!1,()=>r&&r(s)]:[!0]}const E2={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function H$(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Gy={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(ts.test(e))e=parseFloat(e);else return e;const r=H$(e,t.target.x),n=H$(e,t.target.y);return`${r}% ${n}%`}},ppe={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,s=hp.parse(e);if(s.length>5)return n;const o=hp.createTransformer(e),i=typeof s[0]!="number"?1:0,l=r.x.scale*t.x,c=r.y.scale*t.y;s[0+i]/=l,s[1+i]/=c;const d=Jo(l,c,.5);return typeof s[2+i]=="number"&&(s[2+i]/=d),typeof s[3+i]=="number"&&(s[3+i]/=d),o(s)}};class gpe extends Ce.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:s}=this.props,{projection:o}=t;_fe(xpe),o&&(r.group&&r.group.add(o),n&&n.register&&s&&n.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),E2.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:s,isPresent:o}=this.props,i=n.projection;return i&&(i.isPresent=o,s||t.layoutDependency!==r||r===void 0?i.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?i.promote():i.relegate()||Oo.postRender(()=>{const l=i.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),queueMicrotask(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:s}=t;s&&(s.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(s),n&&n.deregister&&n.deregister(s))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function FK(e){const[t,r]=hpe(),n=p.useContext(oD);return Ce.createElement(gpe,{...e,layoutGroup:n,switchLayoutGroup:p.useContext(OG),isPresent:t,safeToRemove:r})}const xpe={borderRadius:{...Gy,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Gy,borderTopRightRadius:Gy,borderBottomLeftRadius:Gy,borderBottomRightRadius:Gy,boxShadow:ppe},LK=["TopLeft","TopRight","BottomLeft","BottomRight"],vpe=LK.length,G$=e=>typeof e=="string"?parseFloat(e):e,K$=e=>typeof e=="number"||ts.test(e);function ype(e,t,r,n,s,o){s?(e.opacity=Jo(0,r.opacity!==void 0?r.opacity:1,bpe(n)),e.opacityExit=Jo(t.opacity!==void 0?t.opacity:1,0,wpe(n))):o&&(e.opacity=Jo(t.opacity!==void 0?t.opacity:1,r.opacity!==void 0?r.opacity:1,n));for(let i=0;i<vpe;i++){const l=`border${LK[i]}Radius`;let c=X$(t,l),d=X$(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||K$(c)===K$(d)?(e[l]=Math.max(Jo(G$(c),G$(d),n),0),(Bf.test(d)||Bf.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||r.rotate)&&(e.rotate=Jo(t.rotate||0,r.rotate||0,n))}function X$(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const bpe=$K(0,.5,iK),wpe=$K(.5,.95,mi);function $K(e,t,r){return n=>n<e?0:n>t?1:r(Rw(e,t,n))}function Y$(e,t){e.min=t.min,e.max=t.max}function Vd(e,t){Y$(e.x,t.x),Y$(e.y,t.y)}function J$(e,t,r,n,s){return e-=t,e=EN(e,1/r,n),s!==void 0&&(e=EN(e,1/s,n)),e}function jpe(e,t=0,r=1,n=.5,s,o=e,i=e){if(Bf.test(t)&&(t=parseFloat(t),t=Jo(i.min,i.max,t/100)-i.min),typeof t!="number")return;let l=Jo(o.min,o.max,n);e===o&&(l-=t),e.min=J$(e.min,t,r,l,s),e.max=J$(e.max,t,r,l,s)}function Q$(e,t,[r,n,s],o,i){jpe(e,t[r],t[n],t[s],t.scale,o,i)}const _pe=["x","scaleX","originX"],Npe=["y","scaleY","originY"];function Z$(e,t,r,n){Q$(e.x,t,_pe,r?r.x:void 0,n?n.x:void 0),Q$(e.y,t,Npe,r?r.y:void 0,n?n.y:void 0)}function e6(e){return e.translate===0&&e.scale===1}function BK(e){return e6(e.x)&&e6(e.y)}function Spe(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function qK(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function t6(e){return Rd(e.x)/Rd(e.y)}class Cpe{constructor(){this.members=[]}add(t){wD(this.members,t),t.scheduleRender()}remove(t){if(jD(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(s=>t===s);if(r===0)return!1;let n;for(let s=r;s>=0;s--){const o=this.members[s];if(o.isPresent!==!1){n=o;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:s}=t.options;s===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function r6(e,t,r){let n="";const s=e.x.translate/t.x,o=e.y.translate/t.y;if((s||o)&&(n=`translate3d(${s}px, ${o}px, 0) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{rotate:c,rotateX:d,rotateY:u}=r;c&&(n+=`rotate(${c}deg) `),d&&(n+=`rotateX(${d}deg) `),u&&(n+=`rotateY(${u}deg) `)}const i=e.x.scale*t.x,l=e.y.scale*t.y;return(i!==1||l!==1)&&(n+=`scale(${i}, ${l})`),n||"none"}const Ape=(e,t)=>e.depth-t.depth;class Ppe{constructor(){this.children=[],this.isDirty=!1}add(t){wD(this.children,t),this.isDirty=!0}remove(t){jD(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Ape),this.isDirty=!1,this.children.forEach(t)}}function Epe(e,t){const r=performance.now(),n=({timestamp:s})=>{const o=s-r;o>=t&&($m(n),e(o-t))};return Oo.read(n,!0),()=>$m(n)}function kpe(e){window.MotionDebug&&window.MotionDebug.record(e)}function Ipe(e){return e instanceof SVGElement&&e.tagName!=="svg"}function Ope(e,t,r){const n=Kc(e)?e:f0(e);return n.start(bD("",n,t,r)),n.animation}const n6=["","X","Y","Z"],Tpe={visibility:"hidden"},a6=1e3;let Dpe=0;const Zp={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function zK({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:s}){return class{constructor(i={},l=t?.()){this.id=Dpe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Zp.totalNodes=Zp.resolvedTargetDeltas=Zp.recalculatedProjection=0,this.nodes.forEach(Fpe),this.nodes.forEach(zpe),this.nodes.forEach(Upe),this.nodes.forEach(Lpe),kpe(Zp)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Ppe)}addEventListener(i,l){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new _D),this.eventHandlers.get(i).add(l)}notifyListeners(i,...l){const c=this.eventHandlers.get(i);c&&c.notify(...l)}hasListeners(i){return this.eventHandlers.has(i)}mount(i,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Ipe(i),this.instance=i;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const h=()=>this.root.updateBlockedByResize=!1;e(i,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=Epe(h,250),E2.hasAnimatedSinceResize&&(E2.hasAnimatedSinceResize=!1,this.nodes.forEach(o6))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:h,hasRelativeTargetChanged:m,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||u.getDefaultTransition()||Kpe,{onLayoutAnimationStart:v,onLayoutAnimationComplete:y}=u.getProps(),b=!this.targetLayout||!qK(this.targetLayout,x)||m,w=!h&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||h&&(b||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,w);const j={...yD(g,"layout"),onPlay:v,onComplete:y};(u.shouldReduceMotion||this.options.layoutRoot)&&(j.delay=0,j.type=!1),this.startAnimation(j)}else h||o6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,$m(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Vpe),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const f=this.path[u];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(s6);return}this.isUpdating||this.nodes.forEach(Bpe),this.isUpdating=!1,this.nodes.forEach(qpe),this.nodes.forEach(Mpe),this.nodes.forEach(Rpe),this.clearAllSnapshots();const l=performance.now();zl.delta=mp(0,1e3/60,l-zl.timestamp),zl.timestamp=l,zl.isProcessing=!0,OP.update.process(zl),OP.preRender.process(zl),OP.render.process(zl),zl.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach($pe),this.sharedNodes.forEach(Wpe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Oo.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Oo.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ei(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let l=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(l=!1),l&&(this.scroll={animationId:this.root.animationId,phase:i,isRoot:n(this.instance),offset:r(this.instance)})}resetTransform(){if(!s)return;const i=this.isLayoutDirty||this.shouldResetTransform,l=this.projectionDelta&&!BK(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;i&&(l||Qp(this.latestValues)||u)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return i&&(c=this.removeTransform(c)),Xpe(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:i}=this.options;if(!i)return Ei();const l=i.measureViewportBox(),{scroll:c}=this.root;return c&&(jh(l.x,c.offset.x),jh(l.y,c.offset.y)),l}removeElementScroll(i){const l=Ei();Vd(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:f}=d;if(d!==this.root&&u&&f.layoutScroll){if(u.isRoot){Vd(l,i);const{scroll:h}=this.root;h&&(jh(l.x,-h.offset.x),jh(l.y,-h.offset.y))}jh(l.x,u.offset.x),jh(l.y,u.offset.y)}}return l}applyTransform(i,l=!1){const c=Ei();Vd(c,i);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Av(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Qp(u.latestValues)&&Av(c,u.latestValues)}return Qp(this.latestValues)&&Av(c,this.latestValues),c}removeTransform(i){const l=Ei();Vd(l,i);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!Qp(d.latestValues))continue;ZI(d.latestValues)&&d.updateSnapshot();const u=Ei(),f=d.measurePageBox();Vd(u,f),Z$(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return Qp(this.latestValues)&&Z$(l,this.latestValues),l}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==zl.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(i||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:f,layoutId:h}=this.options;if(!(!this.layout||!(f||h))){if(this.resolvedRelativeTargetAt=zl.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ei(),this.relativeTargetOrigin=Ei(),zb(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),Vd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ei(),this.targetWithTransforms=Ei()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Yhe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Vd(this.target,this.layout.layoutBox),DK(this.target,this.targetDelta)):Vd(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ei(),this.relativeTargetOrigin=Ei(),zb(this.relativeTargetOrigin,this.target,m.target),Vd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Zp.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||ZI(this.parent.latestValues)||TK(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var i;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((i=this.parent)===null||i===void 0)&&i.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===zl.timestamp&&(d=!1),d)return;const{layout:u,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||f))return;Vd(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,m=this.treeScale.y;spe(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox);const{target:x}=l;if(!x){this.projectionTransform&&(this.projectionDelta=Cv(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Cv(),this.projectionDeltaWithTransform=Cv());const g=this.projectionTransform;qb(this.projectionDelta,this.layoutCorrected,x,this.latestValues),this.projectionTransform=r6(this.projectionDelta,this.treeScale),(this.projectionTransform!==g||this.treeScale.x!==h||this.treeScale.y!==m)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x)),Zp.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),i){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(i,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},f=Cv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=Ei(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,g=m!==x,v=this.getStack(),y=!v||v.members.length<=1,b=!!(g&&!y&&this.options.crossfade===!0&&!this.path.some(Gpe));this.animationProgress=0;let w;this.mixTargetDelta=j=>{const _=j/1e3;i6(f.x,i.x,_),i6(f.y,i.y,_),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(zb(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Hpe(this.relativeTarget,this.relativeTargetOrigin,h,_),w&&Spe(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=Ei()),Vd(w,this.relativeTarget)),g&&(this.animationValues=u,ype(u,d,this.latestValues,_,b,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&($m(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Oo.update(()=>{E2.hasAnimatedSinceResize=!0,this.currentAnimation=Ope(0,a6,{...i,onUpdate:l=>{this.mixTargetDelta(l),i.onUpdate&&i.onUpdate(l)},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(a6),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=i;if(!(!l||!c||!d)){if(this!==i&&this.layout&&d&&UK(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Ei();const f=Rd(this.layout.layoutBox.x);c.x.min=i.target.x.min,c.x.max=c.x.min+f;const h=Rd(this.layout.layoutBox.y);c.y.min=i.target.y.min,c.y.max=c.y.min+h}Vd(l,c),Av(l,u),qb(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(i,l){this.sharedNodes.has(i)||this.sharedNodes.set(i,new Cpe),this.sharedNodes.get(i).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){var i;const{layoutId:l}=this.options;return l?((i=this.getStack())===null||i===void 0?void 0:i.lead)||this:this}getPrevLead(){var i;const{layoutId:l}=this.options;return l?(i=this.getStack())===null||i===void 0?void 0:i.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),i&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetRotation(){const{visualElement:i}=this.options;if(!i)return;let l=!1;const{latestValues:c}=i;if((c.rotate||c.rotateX||c.rotateY||c.rotateZ)&&(l=!0),!l)return;const d={};for(let u=0;u<n6.length;u++){const f="rotate"+n6[u];c[f]&&(d[f]=c[f],i.setStaticValue(f,0))}i.render();for(const u in d)i.setStaticValue(u,d[u]);i.scheduleRender()}getProjectionStyles(i){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Tpe;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=P2(i?.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const g={};return this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=P2(i?.pointerEvents)||""),this.hasProjected&&!Qp(this.latestValues)&&(g.transform=u?u({},""):"none",this.hasProjected=!1),g}const h=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=r6(this.projectionDeltaWithTransform,this.treeScale,h),u&&(d.transform=u(h,d.transform));const{x:m,y:x}=this.projectionDelta;d.transformOrigin=`${m.origin*100}% ${x.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(l=h.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:d.opacity=f===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const g in jN){if(h[g]===void 0)continue;const{correct:v,applyTo:y}=jN[g],b=d.transform==="none"?h[g]:v(h[g],f);if(y){const w=y.length;for(let j=0;j<w;j++)d[y[j]]=b}else d[g]=b}return this.options.layoutId&&(d.pointerEvents=f===this?P2(i?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>{var l;return(l=i.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(s6),this.root.sharedNodes.clear()}}}function Mpe(e){e.updateLayout()}function Rpe(e){var t;const r=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:s}=e.layout,{animationType:o}=e.options,i=r.source!==e.layout.source;o==="size"?Jd(f=>{const h=i?r.measuredBox[f]:r.layoutBox[f],m=Rd(h);h.min=n[f].min,h.max=h.min+m}):UK(o,r.layoutBox,n)&&Jd(f=>{const h=i?r.measuredBox[f]:r.layoutBox[f],m=Rd(n[f]);h.max=h.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+m)});const l=Cv();qb(l,n,r.layoutBox);const c=Cv();i?qb(c,e.applyTransform(s,!0),r.measuredBox):qb(c,n,r.layoutBox);const d=!BK(l);let u=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:h,layout:m}=f;if(h&&m){const x=Ei();zb(x,r.layoutBox,h.layoutBox);const g=Ei();zb(g,n,m.layoutBox),qK(x,g)||(u=!0),f.options.layoutRoot&&(e.relativeTarget=g,e.relativeTargetOrigin=x,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:r,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Fpe(e){Zp.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Lpe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function $pe(e){e.clearSnapshot()}function s6(e){e.clearMeasurements()}function Bpe(e){e.isLayoutDirty=!1}function qpe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function o6(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function zpe(e){e.resolveTargetDelta()}function Upe(e){e.calcProjection()}function Vpe(e){e.resetRotation()}function Wpe(e){e.removeLeadSnapshot()}function i6(e,t,r){e.translate=Jo(t.translate,0,r),e.scale=Jo(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function l6(e,t,r,n){e.min=Jo(t.min,r.min,n),e.max=Jo(t.max,r.max,n)}function Hpe(e,t,r,n){l6(e.x,t.x,r.x,n),l6(e.y,t.y,r.y,n)}function Gpe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Kpe={duration:.45,ease:[.4,0,.1,1]},c6=e=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(e),d6=c6("applewebkit/")&&!c6("chrome/")?Math.round:mi;function u6(e){e.min=d6(e.min),e.max=d6(e.max)}function Xpe(e){u6(e.x),u6(e.y)}function UK(e,t,r){return e==="position"||e==="preserve-aspect"&&!JI(t6(t),t6(r),.2)}const Ype=zK({attachResizeListener:(e,t)=>_m(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),UP={current:void 0},VK=zK({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!UP.current){const e=new Ype({});e.mount(window),e.setOptions({layoutScroll:!0}),UP.current=e}return UP.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Jpe={pan:{Feature:mpe},drag:{Feature:fpe,ProjectionNode:VK,MeasureLayout:FK}},Qpe=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Zpe(e){const t=Qpe.exec(e);if(!t)return[,];const[,r,n]=t;return[r,n]}function tO(e,t,r=1){const[n,s]=Zpe(e);if(!n)return;const o=window.getComputedStyle(t).getPropertyValue(n);if(o){const i=o.trim();return CK(i)?parseFloat(i):i}else return VI(s)?tO(s,t,r+1):s}function ege(e,{...t},r){const n=e.current;if(!(n instanceof Element))return{target:t,transitionEnd:r};r&&(r={...r}),e.values.forEach(s=>{const o=s.get();if(!VI(o))return;const i=tO(o,n);i&&s.set(i)});for(const s in t){const o=t[s];if(!VI(o))continue;const i=tO(o,n);i&&(t[s]=i,r||(r={}),r[s]===void 0&&(r[s]=o))}return{target:t,transitionEnd:r}}const tge=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),WK=e=>tge.has(e),rge=e=>Object.keys(e).some(WK),f6=e=>e===gx||e===ts,m6=(e,t)=>parseFloat(e.split(", ")[t]),h6=(e,t)=>(r,{transform:n})=>{if(n==="none"||!n)return 0;const s=n.match(/^matrix3d\((.+)\)$/);if(s)return m6(s[1],t);{const o=n.match(/^matrix\((.+)\)$/);return o?m6(o[1],e):0}},nge=new Set(["x","y","z"]),age=J1.filter(e=>!nge.has(e));function sge(e){const t=[];return age.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t.length&&e.render(),t}const m0={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:h6(4,13),y:h6(5,14)};m0.translateX=m0.x;m0.translateY=m0.y;const oge=(e,t,r)=>{const n=t.measureViewportBox(),s=t.current,o=getComputedStyle(s),{display:i}=o,l={};i==="none"&&t.setStaticValue("display",e.display||"block"),r.forEach(d=>{l[d]=m0[d](n,o)}),t.render();const c=t.measureViewportBox();return r.forEach(d=>{const u=t.getValue(d);u&&u.jump(l[d]),e[d]=m0[d](c,o)}),e},ige=(e,t,r={},n={})=>{t={...t},n={...n};const s=Object.keys(t).filter(WK);let o=[],i=!1;const l=[];if(s.forEach(c=>{const d=e.getValue(c);if(!e.hasValue(c))return;let u=r[c],f=Hy(u);const h=t[c];let m;if(NN(h)){const x=h.length,g=h[0]===null?1:0;u=h[g],f=Hy(u);for(let v=g;v<x&&h[v]!==null;v++)m?hD(Hy(h[v])===m):m=Hy(h[v])}else m=Hy(h);if(f!==m)if(f6(f)&&f6(m)){const x=d.get();typeof x=="string"&&d.set(parseFloat(x)),typeof h=="string"?t[c]=parseFloat(h):Array.isArray(h)&&m===ts&&(t[c]=h.map(parseFloat))}else f?.transform&&m?.transform&&(u===0||h===0)?u===0?d.set(m.transform(u)):t[c]=f.transform(h):(i||(o=sge(e),i=!0),l.push(c),n[c]=n[c]!==void 0?n[c]:t[c],d.jump(h))}),l.length){const c=l.indexOf("height")>=0?window.pageYOffset:null,d=oge(t,e,l);return o.length&&o.forEach(([u,f])=>{e.getValue(u).set(f)}),e.render(),WC&&c!==null&&window.scrollTo({top:c}),{target:d,transitionEnd:n}}else return{target:t,transitionEnd:n}};function lge(e,t,r,n){return rge(t)?ige(e,t,r,n):{target:t,transitionEnd:n}}const cge=(e,t,r,n)=>{const s=ege(e,t,n);return t=s.target,n=s.transitionEnd,lge(e,t,r,n)},rO={current:null},HK={current:!1};function dge(){if(HK.current=!0,!!WC)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>rO.current=e.matches;e.addListener(t),t()}else rO.current=!1}function uge(e,t,r){const{willChange:n}=t;for(const s in t){const o=t[s],i=r[s];if(Kc(o))e.addValue(s,o),PN(n)&&n.add(s);else if(Kc(i))e.addValue(s,f0(o,{owner:e})),PN(n)&&n.remove(s);else if(i!==o)if(e.hasValue(s)){const l=e.getValue(s);!l.hasAnimated&&l.set(o)}else{const l=e.getStaticValue(s);e.addValue(s,f0(l!==void 0?l:o,{owner:e}))}}for(const s in r)t[s]===void 0&&e.removeValue(s);return t}const p6=new WeakMap,GK=Object.keys(Mw),fge=GK.length,g6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],mge=sD.length;class hge{constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:s,visualState:o},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Oo.render(this.render,!1,!0);const{latestValues:l,renderState:c}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=r.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=s,this.options=i,this.isControllingVariants=GC(r),this.isVariantNode=IG(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:d,...u}=this.scrapeMotionValuesFromProps(r,{});for(const f in u){const h=u[f];l[f]!==void 0&&Kc(h)&&(h.set(l[f],!1),PN(d)&&d.add(f))}}scrapeMotionValuesFromProps(t,r){return{}}mount(t){this.current=t,p6.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),HK.current||dge(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:rO.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){p6.delete(this.current),this.projection&&this.projection.unmount(),$m(this.notifyUpdate),$m(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,r){const n=px.has(t),s=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&Oo.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),o=r.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{s(),o()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...r},n,s,o){let i,l;for(let c=0;c<fge;c++){const d=GK[c],{isEnabled:u,Feature:f,ProjectionNode:h,MeasureLayout:m}=Mw[d];h&&(i=h),u(r)&&(!this.features[d]&&f&&(this.features[d]=new f(this)),m&&(l=m))}if((this.type==="html"||this.type==="svg")&&!this.projection&&i){this.projection=new i(this.latestValues,this.parent&&this.parent.projection);const{layoutId:c,layout:d,drag:u,dragConstraints:f,layoutScroll:h,layoutRoot:m}=r;this.projection.setOptions({layoutId:c,layout:d,alwaysMeasureLayout:!!u||f&&Nv(f),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof d=="string"?d:"both",initialPromotionConfig:o,layoutScroll:h,layoutRoot:m})}return l}updateFeatures(){for(const t in this.features){const r=this.features[t];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ei()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}makeTargetAnimatable(t,r=!0){return this.makeTargetAnimatableFromInstance(t,this.props,r)}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<g6.length;n++){const s=g6[n];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const o=t["on"+s];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=uge(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const n=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(n.initial=this.props.initial),n}const r={};for(let n=0;n<mge;n++){const s=sD[n],o=this.props[s];(Dw(o)||o===!1)&&(r[s]=o)}return r}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){r!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,r)),this.values.set(t,r),this.latestValues[t]=r.get()}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=f0(r,{owner:this}),this.addValue(t,n)),n}readValue(t){var r;return this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(r=this.getBaseTargetFromProps(this.props,t))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,t,this.options)}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var r;const{initial:n}=this.props,s=typeof n=="string"||typeof n=="object"?(r=mD(this.props,n))===null||r===void 0?void 0:r[t]:void 0;if(n&&s!==void 0)return s;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!Kc(o)?o:this.initialValues[t]!==void 0&&s===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new _D),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}}class KK extends hge{sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}makeTargetAnimatableFromInstance({transition:t,transitionEnd:r,...n},{transformValues:s},o){let i=Ihe(n,t||{},this);if(s&&(r&&(r=s(r)),n&&(n=s(n)),i&&(i=s(i))),o){Ehe(this,n,i);const l=cge(this,n,i,r);r=l.transitionEnd,n=l.target}return{transition:t,transitionEnd:r,...n}}}function pge(e){return window.getComputedStyle(e)}class gge extends KK{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,r){if(px.has(r)){const n=vD(r);return n&&n.default||0}else{const n=pge(t),s=(MG(r)?n.getPropertyValue(r):n[r])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:r}){return MK(t,r)}build(t,r,n,s){lD(t,r,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,r){return fD(t,r)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Kc(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}renderInstance(t,r,n,s){qG(t,r,n,s)}}class xge extends KK{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(px.has(r)){const n=vD(r);return n&&n.default||0}return r=zG.has(r)?r:nD(r),t.getAttribute(r)}measureInstanceViewportBox(){return Ei()}scrapeMotionValuesFromProps(t,r){return VG(t,r)}build(t,r,n,s){dD(t,r,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,r,n,s){UG(t,r,n,s)}mount(t){this.isSVGTag=uD(t.tagName),super.mount(t)}}const vge=(e,t)=>iD(e)?new xge(t,{enableHardwareAcceleration:!1}):new gge(t,{enableHardwareAcceleration:!0}),yge={layout:{ProjectionNode:VK,MeasureLayout:FK}},bge={...Hhe,...fme,...Jpe,...yge},Fr=wfe((e,t)=>Zfe(e,t,bge,vge));function XK(){const e=p.useRef(!1);return rD(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function wge(){const e=XK(),[t,r]=p.useState(0),n=p.useCallback(()=>{e.current&&r(t+1)},[t]);return[p.useCallback(()=>Oo.postRender(n),[n]),t]}class jge extends p.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=r.offsetHeight||0,n.width=r.offsetWidth||0,n.top=r.offsetTop,n.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function _ge({children:e,isPresent:t}){const r=p.useId(),n=p.useRef(null),s=p.useRef({width:0,height:0,top:0,left:0});return p.useInsertionEffect(()=>{const{width:o,height:i,top:l,left:c}=s.current;if(t||!n.current||!o||!i)return;n.current.dataset.motionPopId=r;const d=document.createElement("style");return document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${i}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[t]),p.createElement(jge,{isPresent:t,childRef:n,sizeRef:s},p.cloneElement(e,{ref:n}))}const VP=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:s,presenceAffectsLayout:o,mode:i})=>{const l=WG(Nge),c=p.useId(),d=p.useMemo(()=>({id:c,initial:t,isPresent:r,custom:s,onExitComplete:u=>{l.set(u,!0);for(const f of l.values())if(!f)return;n&&n()},register:u=>(l.set(u,!1),()=>l.delete(u))}),o?void 0:[r]);return p.useMemo(()=>{l.forEach((u,f)=>l.set(f,!1))},[r]),p.useEffect(()=>{!r&&!l.size&&n&&n()},[r]),i==="popLayout"&&(e=p.createElement(_ge,{isPresent:r},e)),p.createElement(VC.Provider,{value:d},e)};function Nge(){return new Map}function Sge(e){return p.useEffect(()=>()=>e(),[])}const eg=e=>e.key||"";function Cge(e,t){e.forEach(r=>{const n=eg(r);t.set(n,r)})}function Age(e){const t=[];return p.Children.forEach(e,r=>{p.isValidElement(r)&&t.push(r)}),t}const Pge=({children:e,custom:t,initial:r=!0,onExitComplete:n,exitBeforeEnter:s,presenceAffectsLayout:o=!0,mode:i="sync"})=>{const l=p.useContext(oD).forceRender||wge()[0],c=XK(),d=Age(e);let u=d;const f=p.useRef(new Map).current,h=p.useRef(u),m=p.useRef(new Map).current,x=p.useRef(!0);if(rD(()=>{x.current=!1,Cge(d,m),h.current=u}),Sge(()=>{x.current=!0,m.clear(),f.clear()}),x.current)return p.createElement(p.Fragment,null,u.map(b=>p.createElement(VP,{key:eg(b),isPresent:!0,initial:r?void 0:!1,presenceAffectsLayout:o,mode:i},b)));u=[...u];const g=h.current.map(eg),v=d.map(eg),y=g.length;for(let b=0;b<y;b++){const w=g[b];v.indexOf(w)===-1&&!f.has(w)&&f.set(w,void 0)}return i==="wait"&&f.size&&(u=[]),f.forEach((b,w)=>{if(v.indexOf(w)!==-1)return;const j=m.get(w);if(!j)return;const _=g.indexOf(w);let C=b;if(!C){const E=()=>{f.delete(w);const S=Array.from(m.keys()).filter(A=>!v.includes(A));if(S.forEach(A=>m.delete(A)),h.current=d.filter(A=>{const M=eg(A);return M===w||S.includes(M)}),!f.size){if(c.current===!1)return;l(),n&&n()}};C=p.createElement(VP,{key:eg(j),isPresent:!1,onExitComplete:E,custom:t,presenceAffectsLayout:o,mode:i},j),f.set(w,C)}u.splice(_,0,C)}),u=u.map(b=>{const w=b.key;return f.has(w)?b:p.createElement(VP,{key:eg(b),isPresent:!0,presenceAffectsLayout:o,mode:i},b)}),p.createElement(p.Fragment,null,f.size?u:u.map(b=>p.cloneElement(b)))};function x6(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function JC(...e){return t=>{let r=!1;const n=e.map(s=>{const o=x6(s,t);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let s=0;s<n.length;s++){const o=n[s];typeof o=="function"?o():x6(e[s],null)}}}}function $s(...e){return p.useCallback(JC(...e),e)}function pp(e){const t=kge(e),r=p.forwardRef((n,s)=>{const{children:o,...i}=n,l=p.Children.toArray(o),c=l.find(Oge);if(c){const d=c.props.children,u=l.map(f=>f===c?p.Children.count(d)>1?p.Children.only(null):p.isValidElement(d)?d.props.children:null:f);return a.jsx(t,{...i,ref:s,children:p.isValidElement(d)?p.cloneElement(d,void 0,u):null})}return a.jsx(t,{...i,ref:s,children:o})});return r.displayName=`${e}.Slot`,r}var Ege=pp("Slot");function kge(e){const t=p.forwardRef((r,n)=>{const{children:s,...o}=r;if(p.isValidElement(s)){const i=Dge(s),l=Tge(o,s.props);return s.type!==p.Fragment&&(l.ref=n?JC(n,i):i),p.cloneElement(s,l)}return p.Children.count(s)>1?p.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var YK=Symbol("radix.slottable");function Ige(e){const t=({children:r})=>a.jsx(a.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=YK,t}function Oge(e){return p.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===YK}function Tge(e,t){const r={...t};for(const n in t){const s=e[n],o=t[n];/^on[A-Z]/.test(n)?s&&o?r[n]=(...l)=>{const c=o(...l);return s(...l),c}:s&&(r[n]=s):n==="style"?r[n]={...s,...o}:n==="className"&&(r[n]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}function Dge(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}const v6=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,y6=us,ND=(e,t)=>r=>{var n;if(t?.variants==null)return y6(e,r?.class,r?.className);const{variants:s,defaultVariants:o}=t,i=Object.keys(s).map(d=>{const u=r?.[d],f=o?.[d];if(u===null)return null;const h=v6(u)||v6(f);return s[d][h]}),l=r&&Object.entries(r).reduce((d,u)=>{let[f,h]=u;return h===void 0||(d[f]=h),d},{}),c=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((d,u)=>{let{class:f,className:h,...m}=u;return Object.entries(m).every(x=>{let[g,v]=x;return Array.isArray(v)?v.includes({...o,...l}[g]):{...o,...l}[g]===v})?[...d,f,h]:d},[]);return y6(e,i,c,r?.class,r?.className)},Fw=ND("inline-flex items-center justify-center rounded-sm text-sm font-bold tracking-wide transition-all duration-200 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background active:scale-[0.98] disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-brand text-primary-foreground hover:bg-brand/90 shadow-lg shadow-brand/15",destructive:"bg-danger text-white hover:bg-danger/90 shadow-lg shadow-danger/15",outline:"border border-border bg-transparent hover:bg-accent hover:text-accent-foreground",secondary:"bg-surface-2 text-secondary-foreground hover:bg-surface-2/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-brand underline-offset-4 hover:underline",success:"bg-success text-white hover:bg-success/90 shadow-lg shadow-success/15"},size:{default:"h-10 px-5 py-2 gap-2",sm:"h-9 rounded-sm px-3 gap-1.5",lg:"h-12 rounded-md px-8 gap-2.5 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Z=Ce.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...s},o)=>{const i=n?Ege:"button";return a.jsx(i,{className:Pr(Fw({variant:t,size:r,className:e})),ref:o,...s})});Z.displayName="Button";const g_=[{to:"/",icon:Yue,label:"Painel Principal"},{to:"/agenda",icon:Io,label:"Agenda"},{to:"/vendas",icon:Y1,label:"Loja"},{to:"/financeiro",icon:AG,label:"Financeiro"},{to:"/fiscal",icon:Y4,label:"Central Fiscal"}],k2={hidden:{opacity:0,x:-20},visible:e=>({opacity:1,x:0,transition:{delay:e*.05+.3,duration:.3,ease:"easeOut"}})},Mge=({to:e,icon:t,label:r,index:n,onNavigate:s})=>{const o="flex items-center h-[52px] px-4 rounded-sm bg-brand text-primary-foreground font-bold shadow-lg shadow-brand/10 border-l-4 border-brand w-full",i="flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 border-transparent w-full";return a.jsx(Fr.li,{custom:n,variants:k2,initial:"hidden",animate:"visible",whileHover:{x:4},transition:{type:"spring",stiffness:300,damping:15},children:a.jsxs(mm,{to:e,onClick:s,className:({isActive:l})=>e==="/isis"&&l?"flex items-center h-[52px] px-4 rounded-sm font-bold text-white shadow-lg shadow-emerald-500/10 border-l-4 border-transparent bg-gradient-to-r from-fuchsia-600 via-violet-600 to-emerald-600 ring-1 ring-white/10":l?o:i,children:[e==="/isis"?a.jsx("span",{className:"mr-4 flex-shrink-0 inline-flex items-center justify-center rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)]",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(dl,{size:"sm"})})}):a.jsx(t,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base flex items-center gap-2",children:r})]})})};function Rge({onNavigate:e,isVisible:t,setIsVisible:r,sidebarPinned:n}){const s=Il(),o=_i(),i=["/produtos","/compras","/clientes","/equipe","/quadras","/empresas","/finalizadoras"],l=p.useMemo(()=>i.includes(o.pathname),[o.pathname]),[c,d]=p.useState(l),u=p.useRef(null);p.useRef(null);const f=p.useRef(0),h=p.useRef(0),m=()=>{window.innerWidth<768&&r(!1)};return p.useEffect(()=>{const x=y=>{window.innerWidth>=768||(f.current=y.touches[0].clientX,h.current=y.touches[0].clientY)},g=y=>{if(window.innerWidth>=768)return;const b=y.touches[0].clientX,w=y.touches[0].clientY,j=b-f.current,_=Math.abs(w-h.current);f.current<50&&j>50&&_<50&&r(!0)},v=()=>{f.current=0,h.current=0};return window.addEventListener("touchstart",x,{passive:!0}),window.addEventListener("touchmove",g,{passive:!0}),window.addEventListener("touchend",v,{passive:!0}),()=>{window.removeEventListener("touchstart",x),window.removeEventListener("touchmove",g),window.removeEventListener("touchend",v)}},[t]),a.jsx(a.Fragment,{children:a.jsxs(Fr.aside,{ref:u,initial:!1,animate:{width:n||t?280:0},className:`h-screen bg-surface flex flex-col border-r border-border shadow-xl shadow-black/20 overflow-hidden\r
                   fixed inset-y-0 left-0 z-40 md:static md:flex-shrink-0`,children:[a.jsxs(Fr.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},className:"flex items-center px-6 pt-8 pb-6 h-[120px] flex-shrink-0",children:[a.jsx("div",{className:"w-14 h-14 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(jd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]}),a.jsx("nav",{className:"flex-1 overflow-y-auto px-6 py-2 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent hover:scrollbar-thumb-border-hover",children:a.jsxs("ul",{className:"space-y-3",children:[g_.map((x,g)=>a.jsx(Mge,{...x,index:g,onNavigate:m},x.to)),a.jsxs(Fr.li,{custom:g_.length,variants:k2,initial:"hidden",animate:"visible",children:[a.jsxs("button",{type:"button",onClick:()=>d(x=>!x),className:`w-full flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 ${l?"bg-brand text-primary-foreground font-bold border-brand":"border-transparent"}`,children:[a.jsx(zue,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base flex-1 text-left",children:"Cadastros"}),a.jsx(hx,{className:`h-4 w-4 transition-transform ${c?"rotate-180":""}`})]}),c&&a.jsxs("ul",{className:"mt-2 ml-8 space-y-2",children:[a.jsx("li",{children:a.jsxs(mm,{to:"/clientes",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(mc,{className:"h-4 w-4 mr-3"})," Clientes & Fornecedores"]})}),a.jsx("li",{children:a.jsxs(mm,{to:"/finalizadoras",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(Dh,{className:"h-4 w-4 mr-3"})," Finalizadoras"]})}),a.jsx("li",{children:a.jsxs(mm,{to:"/produtos",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(bu,{className:"h-4 w-4 mr-3"})," Produtos"]})}),a.jsx("li",{children:a.jsxs(mm,{to:"/equipe",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(dfe,{className:"h-4 w-4 mr-3"})," Equipe"]})}),a.jsx("li",{children:a.jsxs(mm,{to:"/quadras",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(Xue,{className:"h-4 w-4 mr-3"})," Quadras"]})}),a.jsx("li",{children:a.jsxs(mm,{to:"/empresas",onClick:m,className:({isActive:x})=>x?"flex items-center h-[40px] px-3 rounded-sm bg-brand/20 text-text-primary font-medium text-sm":"flex items-center h-[40px] px-3 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-colors text-sm",children:[a.jsx(bN,{className:"h-4 w-4 mr-3"})," Empresa"]})})]})]}),a.jsx(Fr.li,{custom:g_.length+1,variants:k2,initial:"hidden",animate:"visible",className:"pt-4 border-t border-border/50 mt-4",children:a.jsxs(mm,{to:"/suporte",onClick:m,className:({isActive:x})=>x?"flex items-center h-[52px] px-4 rounded-sm bg-brand text-primary-foreground font-bold shadow-lg shadow-brand/10 border-l-4 border-brand":"flex items-center h-[52px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border-l-4 border-transparent",children:[a.jsx(wG,{className:"h-5 w-5 mr-4 flex-shrink-0"}),a.jsx("span",{className:"text-base",children:"Suporte"})]})}),a.jsx(Fr.li,{custom:g_.length+2,variants:k2,initial:"hidden",animate:"visible",children:a.jsxs(mm,{to:"/isis",onClick:m,className:({isActive:x})=>x?"flex items-center h-[56px] px-4 rounded-sm font-extrabold text-text-primary bg-surface-2/80 border border-white/20 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.06)]":"flex items-center h-[56px] px-4 rounded-sm text-text-secondary hover:bg-surface-2 hover:text-text-primary transition-all duration-200 border border-white/15",children:[a.jsx("span",{className:"mr-4 flex-shrink-0 inline-flex items-center justify-center rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)]",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(dl,{size:"sm"})})}),a.jsx("span",{className:"text-lg font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 via-violet-300 to-emerald-300",children:"sis"}),a.jsx("button",{type:"button",title:"Dashboard analtica da sis",onClick:x=>{x.preventDefault(),x.stopPropagation(),s("/isis/analytics")},className:"ml-auto inline-flex items-center justify-center p-2.5 rounded-full text-text-secondary hover:text-text-primary hover:bg-white/10 transition-all border border-white/10 hover:border-white/20 cursor-pointer shadow-sm hover:shadow",children:a.jsx(Wc,{className:"h-5 w-5"})})]})})]})})]})})}function aa(e,t,{checkForDefaultPrevented:r=!0}={}){return function(s){if(e?.(s),r===!1||!s.defaultPrevented)return t?.(s)}}function Fge(e,t){const r=p.createContext(t),n=o=>{const{children:i,...l}=o,c=p.useMemo(()=>l,Object.values(l));return a.jsx(r.Provider,{value:c,children:i})};n.displayName=e+"Provider";function s(o){const i=p.useContext(r);if(i)return i;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return[n,s]}function Nu(e,t=[]){let r=[];function n(o,i){const l=p.createContext(i),c=r.length;r=[...r,i];const d=f=>{const{scope:h,children:m,...x}=f,g=h?.[e]?.[c]||l,v=p.useMemo(()=>x,Object.values(x));return a.jsx(g.Provider,{value:v,children:m})};d.displayName=o+"Provider";function u(f,h){const m=h?.[e]?.[c]||l,x=p.useContext(m);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${o}\``)}return[d,u]}const s=()=>{const o=r.map(i=>p.createContext(i));return function(l){const c=l?.[e]||o;return p.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return s.scopeName=e,[n,Lge(s,...t)]}function Lge(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((l,{useScope:c,scopeName:d})=>{const f=c(o)[`__scope${d}`];return{...l,...f}},{});return p.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}var $ge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Qa=$ge.reduce((e,t)=>{const r=pp(`Primitive.${t}`),n=p.forwardRef((s,o)=>{const{asChild:i,...l}=s,c=i?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function SD(e,t){e&&Km.flushSync(()=>e.dispatchEvent(t))}function Xc(e){const t=p.useRef(e);return p.useEffect(()=>{t.current=e}),p.useMemo(()=>(...r)=>t.current?.(...r),[])}function Bge(e,t=globalThis?.document){const r=Xc(e);p.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var qge="DismissableLayer",nO="dismissableLayer.update",zge="dismissableLayer.pointerDownOutside",Uge="dismissableLayer.focusOutside",b6,JK=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ry=p.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:i,onDismiss:l,...c}=e,d=p.useContext(JK),[u,f]=p.useState(null),h=u?.ownerDocument??globalThis?.document,[,m]=p.useState({}),x=$s(t,E=>f(E)),g=Array.from(d.layers),[v]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),y=g.indexOf(v),b=u?g.indexOf(u):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,j=b>=y,_=Wge(E=>{const S=E.target,A=[...d.branches].some(M=>M.contains(S));!j||A||(s?.(E),i?.(E),E.defaultPrevented||l?.())},h),C=Hge(E=>{const S=E.target;[...d.branches].some(M=>M.contains(S))||(o?.(E),i?.(E),E.defaultPrevented||l?.())},h);return Bge(E=>{b===d.layers.size-1&&(n?.(E),!E.defaultPrevented&&l&&(E.preventDefault(),l()))},h),p.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(b6=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),w6(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=b6)}},[u,h,r,d]),p.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),w6())},[u,d]),p.useEffect(()=>{const E=()=>m({});return document.addEventListener(nO,E),()=>document.removeEventListener(nO,E)},[]),a.jsx(Qa.div,{...c,ref:x,style:{pointerEvents:w?j?"auto":"none":void 0,...e.style},onFocusCapture:aa(e.onFocusCapture,C.onFocusCapture),onBlurCapture:aa(e.onBlurCapture,C.onBlurCapture),onPointerDownCapture:aa(e.onPointerDownCapture,_.onPointerDownCapture)})});ry.displayName=qge;var Vge="DismissableLayerBranch",QK=p.forwardRef((e,t)=>{const r=p.useContext(JK),n=p.useRef(null),s=$s(t,n);return p.useEffect(()=>{const o=n.current;if(o)return r.branches.add(o),()=>{r.branches.delete(o)}},[r.branches]),a.jsx(Qa.div,{...e,ref:s})});QK.displayName=Vge;function Wge(e,t=globalThis?.document){const r=Xc(e),n=p.useRef(!1),s=p.useRef(()=>{});return p.useEffect(()=>{const o=l=>{if(l.target&&!n.current){let c=function(){ZK(zge,r,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=c,t.addEventListener("click",s.current,{once:!0})):c()}else t.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",o),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function Hge(e,t=globalThis?.document){const r=Xc(e),n=p.useRef(!1);return p.useEffect(()=>{const s=o=>{o.target&&!n.current&&ZK(Uge,r,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function w6(){const e=new CustomEvent(nO);document.dispatchEvent(e)}function ZK(e,t,r,{discrete:n}){const s=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?SD(s,o):s.dispatchEvent(o)}var Gge=ry,Kge=QK,WP=0;function QC(){p.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??j6()),document.body.insertAdjacentElement("beforeend",e[1]??j6()),WP++,()=>{WP===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),WP--}},[])}function j6(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var HP="focusScope.autoFocusOnMount",GP="focusScope.autoFocusOnUnmount",_6={bubbles:!1,cancelable:!0},Xge="FocusScope",tj=p.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=e,[l,c]=p.useState(null),d=Xc(s),u=Xc(o),f=p.useRef(null),h=$s(t,g=>c(g)),m=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(n){let g=function(w){if(m.paused||!l)return;const j=w.target;l.contains(j)?f.current=j:ph(f.current,{select:!0})},v=function(w){if(m.paused||!l)return;const j=w.relatedTarget;j!==null&&(l.contains(j)||ph(f.current,{select:!0}))},y=function(w){if(document.activeElement===document.body)for(const _ of w)_.removedNodes.length>0&&ph(l)};document.addEventListener("focusin",g),document.addEventListener("focusout",v);const b=new MutationObserver(y);return l&&b.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",v),b.disconnect()}}},[n,l,m.paused]),p.useEffect(()=>{if(l){S6.add(m);const g=document.activeElement;if(!l.contains(g)){const y=new CustomEvent(HP,_6);l.addEventListener(HP,d),l.dispatchEvent(y),y.defaultPrevented||(Yge(txe(eX(l)),{select:!0}),document.activeElement===g&&ph(l))}return()=>{l.removeEventListener(HP,d),setTimeout(()=>{const y=new CustomEvent(GP,_6);l.addEventListener(GP,u),l.dispatchEvent(y),y.defaultPrevented||ph(g??document.body,{select:!0}),l.removeEventListener(GP,u),S6.remove(m)},0)}}},[l,d,u,m]);const x=p.useCallback(g=>{if(!r&&!n||m.paused)return;const v=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,y=document.activeElement;if(v&&y){const b=g.currentTarget,[w,j]=Jge(b);w&&j?!g.shiftKey&&y===j?(g.preventDefault(),r&&ph(w,{select:!0})):g.shiftKey&&y===w&&(g.preventDefault(),r&&ph(j,{select:!0})):y===b&&g.preventDefault()}},[r,n,m.paused]);return a.jsx(Qa.div,{tabIndex:-1,...i,ref:h,onKeyDown:x})});tj.displayName=Xge;function Yge(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(ph(n,{select:t}),document.activeElement!==r)return}function Jge(e){const t=eX(e),r=N6(t,e),n=N6(t.reverse(),e);return[r,n]}function eX(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function N6(e,t){for(const r of e)if(!Qge(r,{upTo:t}))return r}function Qge(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Zge(e){return e instanceof HTMLInputElement&&"select"in e}function ph(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&Zge(e)&&t&&e.select()}}var S6=exe();function exe(){let e=[];return{add(t){const r=e[0];t!==r&&r?.pause(),e=C6(e,t),e.unshift(t)},remove(t){e=C6(e,t),e[0]?.resume()}}}function C6(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function txe(e){return e.filter(t=>t.tagName!=="A")}var kl=globalThis?.document?p.useLayoutEffect:()=>{},rxe=Q3[" useId ".trim().toString()]||(()=>{}),nxe=0;function tf(e){const[t,r]=p.useState(rxe());return kl(()=>{e||r(n=>n??String(nxe++))},[e]),e||(t?`radix-${t}`:"")}const axe=["top","right","bottom","left"],gp=Math.min,vd=Math.max,kN=Math.round,x_=Math.floor,qf=e=>({x:e,y:e}),sxe={left:"right",right:"left",bottom:"top",top:"bottom"},oxe={start:"end",end:"start"};function aO(e,t,r){return vd(e,gp(t,r))}function Bm(e,t){return typeof e=="function"?e(t):e}function qm(e){return e.split("-")[0]}function ny(e){return e.split("-")[1]}function CD(e){return e==="x"?"y":"x"}function AD(e){return e==="y"?"height":"width"}const ixe=new Set(["top","bottom"]);function If(e){return ixe.has(qm(e))?"y":"x"}function PD(e){return CD(If(e))}function lxe(e,t,r){r===void 0&&(r=!1);const n=ny(e),s=PD(e),o=AD(s);let i=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(i=IN(i)),[i,IN(i)]}function cxe(e){const t=IN(e);return[sO(e),t,sO(t)]}function sO(e){return e.replace(/start|end/g,t=>oxe[t])}const A6=["left","right"],P6=["right","left"],dxe=["top","bottom"],uxe=["bottom","top"];function fxe(e,t,r){switch(e){case"top":case"bottom":return r?t?P6:A6:t?A6:P6;case"left":case"right":return t?dxe:uxe;default:return[]}}function mxe(e,t,r,n){const s=ny(e);let o=fxe(qm(e),r==="start",n);return s&&(o=o.map(i=>i+"-"+s),t&&(o=o.concat(o.map(sO)))),o}function IN(e){return e.replace(/left|right|bottom|top/g,t=>sxe[t])}function hxe(e){return{top:0,right:0,bottom:0,left:0,...e}}function tX(e){return typeof e!="number"?hxe(e):{top:e,right:e,bottom:e,left:e}}function ON(e){const{x:t,y:r,width:n,height:s}=e;return{width:n,height:s,top:r,left:t,right:t+n,bottom:r+s,x:t,y:r}}function E6(e,t,r){let{reference:n,floating:s}=e;const o=If(t),i=PD(t),l=AD(i),c=qm(t),d=o==="y",u=n.x+n.width/2-s.width/2,f=n.y+n.height/2-s.height/2,h=n[l]/2-s[l]/2;let m;switch(c){case"top":m={x:u,y:n.y-s.height};break;case"bottom":m={x:u,y:n.y+n.height};break;case"right":m={x:n.x+n.width,y:f};break;case"left":m={x:n.x-s.width,y:f};break;default:m={x:n.x,y:n.y}}switch(ny(t)){case"start":m[i]-=h*(r&&d?-1:1);break;case"end":m[i]+=h*(r&&d?-1:1);break}return m}const pxe=async(e,t,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:o=[],platform:i}=r,l=o.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(t));let d=await i.getElementRects({reference:e,floating:t,strategy:s}),{x:u,y:f}=E6(d,n,c),h=n,m={},x=0;for(let g=0;g<l.length;g++){const{name:v,fn:y}=l[g],{x:b,y:w,data:j,reset:_}=await y({x:u,y:f,initialPlacement:n,placement:h,strategy:s,middlewareData:m,rects:d,platform:i,elements:{reference:e,floating:t}});u=b??u,f=w??f,m={...m,[v]:{...m[v],...j}},_&&x<=50&&(x++,typeof _=="object"&&(_.placement&&(h=_.placement),_.rects&&(d=_.rects===!0?await i.getElementRects({reference:e,floating:t,strategy:s}):_.rects),{x:u,y:f}=E6(d,h,c)),g=-1)}return{x:u,y:f,placement:h,strategy:s,middlewareData:m}};async function Lw(e,t){var r;t===void 0&&(t={});const{x:n,y:s,platform:o,rects:i,elements:l,strategy:c}=e,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:h=!1,padding:m=0}=Bm(t,e),x=tX(m),v=l[h?f==="floating"?"reference":"floating":f],y=ON(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(v)))==null||r?v:v.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(l.floating)),boundary:d,rootBoundary:u,strategy:c})),b=f==="floating"?{x:n,y:s,width:i.floating.width,height:i.floating.height}:i.reference,w=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l.floating)),j=await(o.isElement==null?void 0:o.isElement(w))?await(o.getScale==null?void 0:o.getScale(w))||{x:1,y:1}:{x:1,y:1},_=ON(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:b,offsetParent:w,strategy:c}):b);return{top:(y.top-_.top+x.top)/j.y,bottom:(_.bottom-y.bottom+x.bottom)/j.y,left:(y.left-_.left+x.left)/j.x,right:(_.right-y.right+x.right)/j.x}}const gxe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:s,rects:o,platform:i,elements:l,middlewareData:c}=t,{element:d,padding:u=0}=Bm(e,t)||{};if(d==null)return{};const f=tX(u),h={x:r,y:n},m=PD(s),x=AD(m),g=await i.getDimensions(d),v=m==="y",y=v?"top":"left",b=v?"bottom":"right",w=v?"clientHeight":"clientWidth",j=o.reference[x]+o.reference[m]-h[m]-o.floating[x],_=h[m]-o.reference[m],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(d));let E=C?C[w]:0;(!E||!await(i.isElement==null?void 0:i.isElement(C)))&&(E=l.floating[w]||o.floating[x]);const S=j/2-_/2,A=E/2-g[x]/2-1,M=gp(f[y],A),O=gp(f[b],A),I=M,T=E-g[x]-O,k=E/2-g[x]/2+S,q=aO(I,k,T),B=!c.arrow&&ny(s)!=null&&k!==q&&o.reference[x]/2-(k<I?M:O)-g[x]/2<0,z=B?k<I?k-I:k-T:0;return{[m]:h[m]+z,data:{[m]:q,centerOffset:k-q-z,...B&&{alignmentOffset:z}},reset:B}}}),xxe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:s,middlewareData:o,rects:i,initialPlacement:l,platform:c,elements:d}=t,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:h,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:g=!0,...v}=Bm(e,t);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const y=qm(s),b=If(l),w=qm(l)===l,j=await(c.isRTL==null?void 0:c.isRTL(d.floating)),_=h||(w||!g?[IN(l)]:cxe(l)),C=x!=="none";!h&&C&&_.push(...mxe(l,g,x,j));const E=[l,..._],S=await Lw(t,v),A=[];let M=((n=o.flip)==null?void 0:n.overflows)||[];if(u&&A.push(S[y]),f){const k=lxe(s,i,j);A.push(S[k[0]],S[k[1]])}if(M=[...M,{placement:s,overflows:A}],!A.every(k=>k<=0)){var O,I;const k=(((O=o.flip)==null?void 0:O.index)||0)+1,q=E[k];if(q&&(!(f==="alignment"?b!==If(q):!1)||M.every(F=>If(F.placement)===b?F.overflows[0]>0:!0)))return{data:{index:k,overflows:M},reset:{placement:q}};let B=(I=M.filter(z=>z.overflows[0]<=0).sort((z,F)=>z.overflows[1]-F.overflows[1])[0])==null?void 0:I.placement;if(!B)switch(m){case"bestFit":{var T;const z=(T=M.filter(F=>{if(C){const V=If(F.placement);return V===b||V==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(V=>V>0).reduce((V,me)=>V+me,0)]).sort((F,V)=>F[1]-V[1])[0])==null?void 0:T[0];z&&(B=z);break}case"initialPlacement":B=l;break}if(s!==B)return{reset:{placement:B}}}return{}}}};function k6(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function I6(e){return axe.some(t=>e[t]>=0)}const vxe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...s}=Bm(e,t);switch(n){case"referenceHidden":{const o=await Lw(t,{...s,elementContext:"reference"}),i=k6(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:I6(i)}}}case"escaped":{const o=await Lw(t,{...s,altBoundary:!0}),i=k6(o,r.floating);return{data:{escapedOffsets:i,escaped:I6(i)}}}default:return{}}}}},rX=new Set(["left","top"]);async function yxe(e,t){const{placement:r,platform:n,elements:s}=e,o=await(n.isRTL==null?void 0:n.isRTL(s.floating)),i=qm(r),l=ny(r),c=If(r)==="y",d=rX.has(i)?-1:1,u=o&&c?-1:1,f=Bm(t,e);let{mainAxis:h,crossAxis:m,alignmentAxis:x}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return l&&typeof x=="number"&&(m=l==="end"?x*-1:x),c?{x:m*u,y:h*d}:{x:h*d,y:m*u}}const bxe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:s,y:o,placement:i,middlewareData:l}=t,c=await yxe(t,e);return i===((r=l.offset)==null?void 0:r.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:s+c.x,y:o+c.y,data:{...c,placement:i}}}}},wxe=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:s}=t,{mainAxis:o=!0,crossAxis:i=!1,limiter:l={fn:v=>{let{x:y,y:b}=v;return{x:y,y:b}}},...c}=Bm(e,t),d={x:r,y:n},u=await Lw(t,c),f=If(qm(s)),h=CD(f);let m=d[h],x=d[f];if(o){const v=h==="y"?"top":"left",y=h==="y"?"bottom":"right",b=m+u[v],w=m-u[y];m=aO(b,m,w)}if(i){const v=f==="y"?"top":"left",y=f==="y"?"bottom":"right",b=x+u[v],w=x-u[y];x=aO(b,x,w)}const g=l.fn({...t,[h]:m,[f]:x});return{...g,data:{x:g.x-r,y:g.y-n,enabled:{[h]:o,[f]:i}}}}}},jxe=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:s,rects:o,middlewareData:i}=t,{offset:l=0,mainAxis:c=!0,crossAxis:d=!0}=Bm(e,t),u={x:r,y:n},f=If(s),h=CD(f);let m=u[h],x=u[f];const g=Bm(l,t),v=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(c){const w=h==="y"?"height":"width",j=o.reference[h]-o.floating[w]+v.mainAxis,_=o.reference[h]+o.reference[w]-v.mainAxis;m<j?m=j:m>_&&(m=_)}if(d){var y,b;const w=h==="y"?"width":"height",j=rX.has(qm(s)),_=o.reference[f]-o.floating[w]+(j&&((y=i.offset)==null?void 0:y[f])||0)+(j?0:v.crossAxis),C=o.reference[f]+o.reference[w]+(j?0:((b=i.offset)==null?void 0:b[f])||0)-(j?v.crossAxis:0);x<_?x=_:x>C&&(x=C)}return{[h]:m,[f]:x}}}},_xe=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:s,rects:o,platform:i,elements:l}=t,{apply:c=()=>{},...d}=Bm(e,t),u=await Lw(t,d),f=qm(s),h=ny(s),m=If(s)==="y",{width:x,height:g}=o.floating;let v,y;f==="top"||f==="bottom"?(v=f,y=h===(await(i.isRTL==null?void 0:i.isRTL(l.floating))?"start":"end")?"left":"right"):(y=f,v=h==="end"?"top":"bottom");const b=g-u.top-u.bottom,w=x-u.left-u.right,j=gp(g-u[v],b),_=gp(x-u[y],w),C=!t.middlewareData.shift;let E=j,S=_;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(S=w),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(E=b),C&&!h){const M=vd(u.left,0),O=vd(u.right,0),I=vd(u.top,0),T=vd(u.bottom,0);m?S=x-2*(M!==0||O!==0?M+O:vd(u.left,u.right)):E=g-2*(I!==0||T!==0?I+T:vd(u.top,u.bottom))}await c({...t,availableWidth:S,availableHeight:E});const A=await i.getDimensions(l.floating);return x!==A.width||g!==A.height?{reset:{rects:!0}}:{}}}};function ZC(){return typeof window<"u"}function ay(e){return nX(e)?(e.nodeName||"").toLowerCase():"#document"}function Ed(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Qf(e){var t;return(t=(nX(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function nX(e){return ZC()?e instanceof Node||e instanceof Ed(e).Node:!1}function sf(e){return ZC()?e instanceof Element||e instanceof Ed(e).Element:!1}function Xf(e){return ZC()?e instanceof HTMLElement||e instanceof Ed(e).HTMLElement:!1}function O6(e){return!ZC()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Ed(e).ShadowRoot}const Nxe=new Set(["inline","contents"]);function rj(e){const{overflow:t,overflowX:r,overflowY:n,display:s}=of(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!Nxe.has(s)}const Sxe=new Set(["table","td","th"]);function Cxe(e){return Sxe.has(ay(e))}const Axe=[":popover-open",":modal"];function e5(e){return Axe.some(t=>{try{return e.matches(t)}catch{return!1}})}const Pxe=["transform","translate","scale","rotate","perspective"],Exe=["transform","translate","scale","rotate","perspective","filter"],kxe=["paint","layout","strict","content"];function ED(e){const t=kD(),r=sf(e)?of(e):e;return Pxe.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||Exe.some(n=>(r.willChange||"").includes(n))||kxe.some(n=>(r.contain||"").includes(n))}function Ixe(e){let t=xp(e);for(;Xf(t)&&!h0(t);){if(ED(t))return t;if(e5(t))return null;t=xp(t)}return null}function kD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Oxe=new Set(["html","body","#document"]);function h0(e){return Oxe.has(ay(e))}function of(e){return Ed(e).getComputedStyle(e)}function t5(e){return sf(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function xp(e){if(ay(e)==="html")return e;const t=e.assignedSlot||e.parentNode||O6(e)&&e.host||Qf(e);return O6(t)?t.host:t}function aX(e){const t=xp(e);return h0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Xf(t)&&rj(t)?t:aX(t)}function $w(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const s=aX(e),o=s===((n=e.ownerDocument)==null?void 0:n.body),i=Ed(s);if(o){const l=oO(i);return t.concat(i,i.visualViewport||[],rj(s)?s:[],l&&r?$w(l):[])}return t.concat(s,$w(s,[],r))}function oO(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function sX(e){const t=of(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const s=Xf(e),o=s?e.offsetWidth:r,i=s?e.offsetHeight:n,l=kN(r)!==o||kN(n)!==i;return l&&(r=o,n=i),{width:r,height:n,$:l}}function ID(e){return sf(e)?e:e.contextElement}function zv(e){const t=ID(e);if(!Xf(t))return qf(1);const r=t.getBoundingClientRect(),{width:n,height:s,$:o}=sX(t);let i=(o?kN(r.width):r.width)/n,l=(o?kN(r.height):r.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!l||!Number.isFinite(l))&&(l=1),{x:i,y:l}}const Txe=qf(0);function oX(e){const t=Ed(e);return!kD()||!t.visualViewport?Txe:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Dxe(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Ed(e)?!1:t}function Yg(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const s=e.getBoundingClientRect(),o=ID(e);let i=qf(1);t&&(n?sf(n)&&(i=zv(n)):i=zv(e));const l=Dxe(o,r,n)?oX(o):qf(0);let c=(s.left+l.x)/i.x,d=(s.top+l.y)/i.y,u=s.width/i.x,f=s.height/i.y;if(o){const h=Ed(o),m=n&&sf(n)?Ed(n):n;let x=h,g=oO(x);for(;g&&n&&m!==x;){const v=zv(g),y=g.getBoundingClientRect(),b=of(g),w=y.left+(g.clientLeft+parseFloat(b.paddingLeft))*v.x,j=y.top+(g.clientTop+parseFloat(b.paddingTop))*v.y;c*=v.x,d*=v.y,u*=v.x,f*=v.y,c+=w,d+=j,x=Ed(g),g=oO(x)}}return ON({width:u,height:f,x:c,y:d})}function OD(e,t){const r=t5(e).scrollLeft;return t?t.left+r:Yg(Qf(e)).left+r}function iX(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-(r?0:OD(e,n)),o=n.top+t.scrollTop;return{x:s,y:o}}function Mxe(e){let{elements:t,rect:r,offsetParent:n,strategy:s}=e;const o=s==="fixed",i=Qf(n),l=t?e5(t.floating):!1;if(n===i||l&&o)return r;let c={scrollLeft:0,scrollTop:0},d=qf(1);const u=qf(0),f=Xf(n);if((f||!f&&!o)&&((ay(n)!=="body"||rj(i))&&(c=t5(n)),Xf(n))){const m=Yg(n);d=zv(n),u.x=m.x+n.clientLeft,u.y=m.y+n.clientTop}const h=i&&!f&&!o?iX(i,c,!0):qf(0);return{width:r.width*d.x,height:r.height*d.y,x:r.x*d.x-c.scrollLeft*d.x+u.x+h.x,y:r.y*d.y-c.scrollTop*d.y+u.y+h.y}}function Rxe(e){return Array.from(e.getClientRects())}function Fxe(e){const t=Qf(e),r=t5(e),n=e.ownerDocument.body,s=vd(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),o=vd(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+OD(e);const l=-r.scrollTop;return of(n).direction==="rtl"&&(i+=vd(t.clientWidth,n.clientWidth)-s),{width:s,height:o,x:i,y:l}}function Lxe(e,t){const r=Ed(e),n=Qf(e),s=r.visualViewport;let o=n.clientWidth,i=n.clientHeight,l=0,c=0;if(s){o=s.width,i=s.height;const d=kD();(!d||d&&t==="fixed")&&(l=s.offsetLeft,c=s.offsetTop)}return{width:o,height:i,x:l,y:c}}const $xe=new Set(["absolute","fixed"]);function Bxe(e,t){const r=Yg(e,!0,t==="fixed"),n=r.top+e.clientTop,s=r.left+e.clientLeft,o=Xf(e)?zv(e):qf(1),i=e.clientWidth*o.x,l=e.clientHeight*o.y,c=s*o.x,d=n*o.y;return{width:i,height:l,x:c,y:d}}function T6(e,t,r){let n;if(t==="viewport")n=Lxe(e,r);else if(t==="document")n=Fxe(Qf(e));else if(sf(t))n=Bxe(t,r);else{const s=oX(e);n={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return ON(n)}function lX(e,t){const r=xp(e);return r===t||!sf(r)||h0(r)?!1:of(r).position==="fixed"||lX(r,t)}function qxe(e,t){const r=t.get(e);if(r)return r;let n=$w(e,[],!1).filter(l=>sf(l)&&ay(l)!=="body"),s=null;const o=of(e).position==="fixed";let i=o?xp(e):e;for(;sf(i)&&!h0(i);){const l=of(i),c=ED(i);!c&&l.position==="fixed"&&(s=null),(o?!c&&!s:!c&&l.position==="static"&&!!s&&$xe.has(s.position)||rj(i)&&!c&&lX(e,i))?n=n.filter(u=>u!==i):s=l,i=xp(i)}return t.set(e,n),n}function zxe(e){let{element:t,boundary:r,rootBoundary:n,strategy:s}=e;const i=[...r==="clippingAncestors"?e5(t)?[]:qxe(t,this._c):[].concat(r),n],l=i[0],c=i.reduce((d,u)=>{const f=T6(t,u,s);return d.top=vd(f.top,d.top),d.right=gp(f.right,d.right),d.bottom=gp(f.bottom,d.bottom),d.left=vd(f.left,d.left),d},T6(t,l,s));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Uxe(e){const{width:t,height:r}=sX(e);return{width:t,height:r}}function Vxe(e,t,r){const n=Xf(t),s=Qf(t),o=r==="fixed",i=Yg(e,!0,o,t);let l={scrollLeft:0,scrollTop:0};const c=qf(0);function d(){c.x=OD(s)}if(n||!n&&!o)if((ay(t)!=="body"||rj(s))&&(l=t5(t)),n){const m=Yg(t,!0,o,t);c.x=m.x+t.clientLeft,c.y=m.y+t.clientTop}else s&&d();o&&!n&&s&&d();const u=s&&!n&&!o?iX(s,l):qf(0),f=i.left+l.scrollLeft-c.x-u.x,h=i.top+l.scrollTop-c.y-u.y;return{x:f,y:h,width:i.width,height:i.height}}function KP(e){return of(e).position==="static"}function D6(e,t){if(!Xf(e)||of(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Qf(e)===r&&(r=r.ownerDocument.body),r}function cX(e,t){const r=Ed(e);if(e5(e))return r;if(!Xf(e)){let s=xp(e);for(;s&&!h0(s);){if(sf(s)&&!KP(s))return s;s=xp(s)}return r}let n=D6(e,t);for(;n&&Cxe(n)&&KP(n);)n=D6(n,t);return n&&h0(n)&&KP(n)&&!ED(n)?r:n||Ixe(e)||r}const Wxe=async function(e){const t=this.getOffsetParent||cX,r=this.getDimensions,n=await r(e.floating);return{reference:Vxe(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Hxe(e){return of(e).direction==="rtl"}const Gxe={convertOffsetParentRelativeRectToViewportRelativeRect:Mxe,getDocumentElement:Qf,getClippingRect:zxe,getOffsetParent:cX,getElementRects:Wxe,getClientRects:Rxe,getDimensions:Uxe,getScale:zv,isElement:sf,isRTL:Hxe};function dX(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Kxe(e,t){let r=null,n;const s=Qf(e);function o(){var l;clearTimeout(n),(l=r)==null||l.disconnect(),r=null}function i(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),o();const d=e.getBoundingClientRect(),{left:u,top:f,width:h,height:m}=d;if(l||t(),!h||!m)return;const x=x_(f),g=x_(s.clientWidth-(u+h)),v=x_(s.clientHeight-(f+m)),y=x_(u),w={rootMargin:-x+"px "+-g+"px "+-v+"px "+-y+"px",threshold:vd(0,gp(1,c))||1};let j=!0;function _(C){const E=C[0].intersectionRatio;if(E!==c){if(!j)return i();E?i(!1,E):n=setTimeout(()=>{i(!1,1e-7)},1e3)}E===1&&!dX(d,e.getBoundingClientRect())&&i(),j=!1}try{r=new IntersectionObserver(_,{...w,root:s.ownerDocument})}catch{r=new IntersectionObserver(_,w)}r.observe(e)}return i(!0),o}function Xxe(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=n,d=ID(e),u=s||o?[...d?$w(d):[],...$w(t)]:[];u.forEach(y=>{s&&y.addEventListener("scroll",r,{passive:!0}),o&&y.addEventListener("resize",r)});const f=d&&l?Kxe(d,r):null;let h=-1,m=null;i&&(m=new ResizeObserver(y=>{let[b]=y;b&&b.target===d&&m&&(m.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var w;(w=m)==null||w.observe(t)})),r()}),d&&!c&&m.observe(d),m.observe(t));let x,g=c?Yg(e):null;c&&v();function v(){const y=Yg(e);g&&!dX(g,y)&&r(),g=y,x=requestAnimationFrame(v)}return r(),()=>{var y;u.forEach(b=>{s&&b.removeEventListener("scroll",r),o&&b.removeEventListener("resize",r)}),f?.(),(y=m)==null||y.disconnect(),m=null,c&&cancelAnimationFrame(x)}}const Yxe=bxe,Jxe=wxe,Qxe=xxe,Zxe=_xe,eve=vxe,M6=gxe,tve=jxe,rve=(e,t,r)=>{const n=new Map,s={platform:Gxe,...r},o={...s.platform,_c:n};return pxe(e,t,{...s,platform:o})};var nve=typeof document<"u",ave=function(){},I2=nve?p.useLayoutEffect:ave;function TN(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,s;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!TN(e[n],t[n]))return!1;return!0}if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,s[n]))return!1;for(n=r;n--!==0;){const o=s[n];if(!(o==="_owner"&&e.$$typeof)&&!TN(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function uX(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function R6(e,t){const r=uX(e);return Math.round(t*r)/r}function XP(e){const t=p.useRef(e);return I2(()=>{t.current=e}),t}function sve(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:i}={},transform:l=!0,whileElementsMounted:c,open:d}=e,[u,f]=p.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[h,m]=p.useState(n);TN(h,n)||m(n);const[x,g]=p.useState(null),[v,y]=p.useState(null),b=p.useCallback(F=>{F!==C.current&&(C.current=F,g(F))},[]),w=p.useCallback(F=>{F!==E.current&&(E.current=F,y(F))},[]),j=o||x,_=i||v,C=p.useRef(null),E=p.useRef(null),S=p.useRef(u),A=c!=null,M=XP(c),O=XP(s),I=XP(d),T=p.useCallback(()=>{if(!C.current||!E.current)return;const F={placement:t,strategy:r,middleware:h};O.current&&(F.platform=O.current),rve(C.current,E.current,F).then(V=>{const me={...V,isPositioned:I.current!==!1};k.current&&!TN(S.current,me)&&(S.current=me,Km.flushSync(()=>{f(me)}))})},[h,t,r,O,I]);I2(()=>{d===!1&&S.current.isPositioned&&(S.current.isPositioned=!1,f(F=>({...F,isPositioned:!1})))},[d]);const k=p.useRef(!1);I2(()=>(k.current=!0,()=>{k.current=!1}),[]),I2(()=>{if(j&&(C.current=j),_&&(E.current=_),j&&_){if(M.current)return M.current(j,_,T);T()}},[j,_,T,M,A]);const q=p.useMemo(()=>({reference:C,floating:E,setReference:b,setFloating:w}),[b,w]),B=p.useMemo(()=>({reference:j,floating:_}),[j,_]),z=p.useMemo(()=>{const F={position:r,left:0,top:0};if(!B.floating)return F;const V=R6(B.floating,u.x),me=R6(B.floating,u.y);return l?{...F,transform:"translate("+V+"px, "+me+"px)",...uX(B.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:V,top:me}},[r,l,B.floating,u.x,u.y]);return p.useMemo(()=>({...u,update:T,refs:q,elements:B,floatingStyles:z}),[u,T,q,B,z])}const ove=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:s}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?M6({element:n.current,padding:s}).fn(r):{}:n?M6({element:n,padding:s}).fn(r):{}}}},ive=(e,t)=>({...Yxe(e),options:[e,t]}),lve=(e,t)=>({...Jxe(e),options:[e,t]}),cve=(e,t)=>({...tve(e),options:[e,t]}),dve=(e,t)=>({...Qxe(e),options:[e,t]}),uve=(e,t)=>({...Zxe(e),options:[e,t]}),fve=(e,t)=>({...eve(e),options:[e,t]}),mve=(e,t)=>({...ove(e),options:[e,t]});var hve="Arrow",fX=p.forwardRef((e,t)=>{const{children:r,width:n=10,height:s=5,...o}=e;return a.jsx(Qa.svg,{...o,ref:t,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:a.jsx("polygon",{points:"0,0 30,0 15,10"})})});fX.displayName=hve;var pve=fX;function mX(e){const[t,r]=p.useState(void 0);return kl(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,l;if("borderBoxSize"in o){const c=o.borderBoxSize,d=Array.isArray(c)?c[0]:c;i=d.inlineSize,l=d.blockSize}else i=e.offsetWidth,l=e.offsetHeight;r({width:i,height:l})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var TD="Popper",[hX,sy]=Nu(TD),[gve,pX]=hX(TD),gX=e=>{const{__scopePopper:t,children:r}=e,[n,s]=p.useState(null);return a.jsx(gve,{scope:t,anchor:n,onAnchorChange:s,children:r})};gX.displayName=TD;var xX="PopperAnchor",vX=p.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...s}=e,o=pX(xX,r),i=p.useRef(null),l=$s(t,i),c=p.useRef(null);return p.useEffect(()=>{const d=c.current;c.current=n?.current||i.current,d!==c.current&&o.onAnchorChange(c.current)}),n?null:a.jsx(Qa.div,{...s,ref:l})});vX.displayName=xX;var DD="PopperContent",[xve,vve]=hX(DD),yX=p.forwardRef((e,t)=>{const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:o="center",alignOffset:i=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:d=[],collisionPadding:u=0,sticky:f="partial",hideWhenDetached:h=!1,updatePositionStrategy:m="optimized",onPlaced:x,...g}=e,v=pX(DD,r),[y,b]=p.useState(null),w=$s(t,W=>b(W)),[j,_]=p.useState(null),C=mX(j),E=C?.width??0,S=C?.height??0,A=n+(o!=="center"?"-"+o:""),M=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},O=Array.isArray(d)?d:[d],I=O.length>0,T={padding:M,boundary:O.filter(bve),altBoundary:I},{refs:k,floatingStyles:q,placement:B,isPositioned:z,middlewareData:F}=sve({strategy:"fixed",placement:A,whileElementsMounted:(...W)=>Xxe(...W,{animationFrame:m==="always"}),elements:{reference:v.anchor},middleware:[ive({mainAxis:s+S,alignmentAxis:i}),c&&lve({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?cve():void 0,...T}),c&&dve({...T}),uve({...T,apply:({elements:W,rects:se,availableWidth:pe,availableHeight:G})=>{const{width:te,height:oe}=se.reference,De=W.floating.style;De.setProperty("--radix-popper-available-width",`${pe}px`),De.setProperty("--radix-popper-available-height",`${G}px`),De.setProperty("--radix-popper-anchor-width",`${te}px`),De.setProperty("--radix-popper-anchor-height",`${oe}px`)}}),j&&mve({element:j,padding:l}),wve({arrowWidth:E,arrowHeight:S}),h&&fve({strategy:"referenceHidden",...T})]}),[V,me]=jX(B),be=Xc(x);kl(()=>{z&&be?.()},[z,be]);const U=F.arrow?.x,L=F.arrow?.y,H=F.arrow?.centerOffset!==0,[ie,Y]=p.useState();return kl(()=>{y&&Y(window.getComputedStyle(y).zIndex)},[y]),a.jsx("div",{ref:k.setFloating,"data-radix-popper-content-wrapper":"",style:{...q,transform:z?q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ie,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:a.jsx(xve,{scope:r,placedSide:V,onArrowChange:_,arrowX:U,arrowY:L,shouldHideArrow:H,children:a.jsx(Qa.div,{"data-side":V,"data-align":me,...g,ref:w,style:{...g.style,animation:z?void 0:"none"}})})})});yX.displayName=DD;var bX="PopperArrow",yve={top:"bottom",right:"left",bottom:"top",left:"right"},wX=p.forwardRef(function(t,r){const{__scopePopper:n,...s}=t,o=vve(bX,n),i=yve[o.placedSide];return a.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:a.jsx(pve,{...s,ref:r,style:{...s.style,display:"block"}})})});wX.displayName=bX;function bve(e){return e!==null}var wve=e=>({name:"transformOrigin",options:e,fn(t){const{placement:r,rects:n,middlewareData:s}=t,i=s.arrow?.centerOffset!==0,l=i?0:e.arrowWidth,c=i?0:e.arrowHeight,[d,u]=jX(r),f={start:"0%",center:"50%",end:"100%"}[u],h=(s.arrow?.x??0)+l/2,m=(s.arrow?.y??0)+c/2;let x="",g="";return d==="bottom"?(x=i?f:`${h}px`,g=`${-c}px`):d==="top"?(x=i?f:`${h}px`,g=`${n.floating.height+c}px`):d==="right"?(x=`${-c}px`,g=i?f:`${m}px`):d==="left"&&(x=`${n.floating.width+c}px`,g=i?f:`${m}px`),{data:{x,y:g}}}});function jX(e){const[t,r="center"]=e.split("-");return[t,r]}var MD=gX,r5=vX,RD=yX,FD=wX,jve="Portal",oy=p.forwardRef((e,t)=>{const{container:r,...n}=e,[s,o]=p.useState(!1);kl(()=>o(!0),[]);const i=r||s&&globalThis?.document?.body;return i?U4.createPortal(a.jsx(Qa.div,{...n,ref:t}),i):null});oy.displayName=jve;function _ve(e,t){return p.useReducer((r,n)=>t[r][n]??r,e)}var $d=e=>{const{present:t,children:r}=e,n=Nve(t),s=typeof r=="function"?r({present:n.isPresent}):p.Children.only(r),o=$s(n.ref,Sve(s));return typeof r=="function"||n.isPresent?p.cloneElement(s,{ref:o}):null};$d.displayName="Presence";function Nve(e){const[t,r]=p.useState(),n=p.useRef(null),s=p.useRef(e),o=p.useRef("none"),i=e?"mounted":"unmounted",[l,c]=_ve(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const d=v_(n.current);o.current=l==="mounted"?d:"none"},[l]),kl(()=>{const d=n.current,u=s.current;if(u!==e){const h=o.current,m=v_(d);e?c("MOUNT"):m==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&h!==m?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,c]),kl(()=>{if(t){let d;const u=t.ownerDocument.defaultView??window,f=m=>{const g=v_(n.current).includes(CSS.escape(m.animationName));if(m.target===t&&g&&(c("ANIMATION_END"),!s.current)){const v=t.style.animationFillMode;t.style.animationFillMode="forwards",d=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=v)})}},h=m=>{m.target===t&&(o.current=v_(n.current))};return t.addEventListener("animationstart",h),t.addEventListener("animationcancel",f),t.addEventListener("animationend",f),()=>{u.clearTimeout(d),t.removeEventListener("animationstart",h),t.removeEventListener("animationcancel",f),t.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:p.useCallback(d=>{n.current=d?getComputedStyle(d):null,r(d)},[])}}function v_(e){return e?.animationName||"none"}function Sve(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Cve=Q3[" useInsertionEffect ".trim().toString()]||kl;function zm({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[s,o,i]=Ave({defaultProp:t,onChange:r}),l=e!==void 0,c=l?e:s;{const u=p.useRef(e!==void 0);p.useEffect(()=>{const f=u.current;f!==l&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,n])}const d=p.useCallback(u=>{if(l){const f=Pve(u)?u(e):u;f!==e&&i.current?.(f)}else o(u)},[l,e,o,i]);return[c,d]}function Ave({defaultProp:e,onChange:t}){const[r,n]=p.useState(e),s=p.useRef(r),o=p.useRef(t);return Cve(()=>{o.current=t},[t]),p.useEffect(()=>{s.current!==r&&(o.current?.(r),s.current=r)},[r,s]),[r,n,o]}function Pve(e){return typeof e=="function"}var Eve=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Ox=new WeakMap,y_=new WeakMap,b_={},YP=0,_X=function(e){return e&&(e.host||_X(e.parentNode))},kve=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=_X(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Ive=function(e,t,r,n){var s=kve(t,Array.isArray(e)?e:[e]);b_[r]||(b_[r]=new WeakMap);var o=b_[r],i=[],l=new Set,c=new Set(s),d=function(f){!f||l.has(f)||(l.add(f),d(f.parentNode))};s.forEach(d);var u=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(h){if(l.has(h))u(h);else try{var m=h.getAttribute(n),x=m!==null&&m!=="false",g=(Ox.get(h)||0)+1,v=(o.get(h)||0)+1;Ox.set(h,g),o.set(h,v),i.push(h),g===1&&x&&y_.set(h,!0),v===1&&h.setAttribute(r,"true"),x||h.setAttribute(n,"true")}catch(y){console.error("aria-hidden: cannot operate on ",h,y)}})};return u(t),l.clear(),YP++,function(){i.forEach(function(f){var h=Ox.get(f)-1,m=o.get(f)-1;Ox.set(f,h),o.set(f,m),h||(y_.has(f)||f.removeAttribute(n),y_.delete(f)),m||f.removeAttribute(r)}),YP--,YP||(Ox=new WeakMap,Ox=new WeakMap,y_=new WeakMap,b_={})}},n5=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),s=t||Eve(e);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live], script"))),Ive(n,s,r,"aria-hidden")):function(){return null}},Cf=function(){return Cf=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Cf.apply(this,arguments)};function NX(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Ove(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}var O2="right-scroll-bar-position",T2="width-before-scroll-bar",Tve="with-scroll-bars-hidden",Dve="--removed-body-scroll-bar-size";function JP(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Mve(e,t){var r=p.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var s=r.value;s!==n&&(r.value=n,r.callback(n,s))}}}})[0];return r.callback=t,r.facade}var Rve=typeof window<"u"?p.useLayoutEffect:p.useEffect,F6=new WeakMap;function Fve(e,t){var r=Mve(t||null,function(n){return e.forEach(function(s){return JP(s,n)})});return Rve(function(){var n=F6.get(r);if(n){var s=new Set(n),o=new Set(e),i=r.current;s.forEach(function(l){o.has(l)||JP(l,null)}),o.forEach(function(l){s.has(l)||JP(l,i)})}F6.set(r,e)},[e]),r}function Lve(e){return e}function $ve(e,t){t===void 0&&(t=Lve);var r=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(o){var i=t(o,n);return r.push(i),function(){r=r.filter(function(l){return l!==i})}},assignSyncMedium:function(o){for(n=!0;r.length;){var i=r;r=[],i.forEach(o)}r={push:function(l){return o(l)},filter:function(){return r}}},assignMedium:function(o){n=!0;var i=[];if(r.length){var l=r;r=[],l.forEach(o),i=r}var c=function(){var u=i;i=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),r={push:function(u){i.push(u),d()},filter:function(u){return i=i.filter(u),r}}}};return s}function Bve(e){e===void 0&&(e={});var t=$ve(null);return t.options=Cf({async:!0,ssr:!1},e),t}var SX=function(e){var t=e.sideCar,r=NX(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return p.createElement(n,Cf({},r))};SX.isSideCarExport=!0;function qve(e,t){return e.useMedium(t),SX}var CX=Bve(),QP=function(){},a5=p.forwardRef(function(e,t){var r=p.useRef(null),n=p.useState({onScrollCapture:QP,onWheelCapture:QP,onTouchMoveCapture:QP}),s=n[0],o=n[1],i=e.forwardProps,l=e.children,c=e.className,d=e.removeScrollBar,u=e.enabled,f=e.shards,h=e.sideCar,m=e.noRelative,x=e.noIsolation,g=e.inert,v=e.allowPinchZoom,y=e.as,b=y===void 0?"div":y,w=e.gapMode,j=NX(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=h,C=Fve([r,t]),E=Cf(Cf({},j),s);return p.createElement(p.Fragment,null,u&&p.createElement(_,{sideCar:CX,removeScrollBar:d,shards:f,noRelative:m,noIsolation:x,inert:g,setCallbacks:o,allowPinchZoom:!!v,lockRef:r,gapMode:w}),i?p.cloneElement(p.Children.only(l),Cf(Cf({},E),{ref:C})):p.createElement(b,Cf({},E,{className:c,ref:C}),l))});a5.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};a5.classNames={fullWidth:T2,zeroRight:O2};var L6,zve=function(){if(L6)return L6;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Uve(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=zve();return t&&e.setAttribute("nonce",t),e}function Vve(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Wve(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Hve=function(){var e=0,t=null;return{add:function(r){e==0&&(t=Uve())&&(Vve(t,r),Wve(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Gve=function(){var e=Hve();return function(t,r){p.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},AX=function(){var e=Gve(),t=function(r){var n=r.styles,s=r.dynamic;return e(n,s),null};return t},Kve={left:0,top:0,right:0,gap:0},ZP=function(e){return parseInt(e||"",10)||0},Xve=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[ZP(r),ZP(n),ZP(s)]},Yve=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Kve;var t=Xve(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},Jve=AX(),Uv="data-scroll-locked",Qve=function(e,t,r,n){var s=e.left,o=e.top,i=e.right,l=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(Tve,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(l,"px ").concat(n,`;
  }
  body[`).concat(Uv,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(l,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(O2,` {
    right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(T2,` {
    margin-right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(O2," .").concat(O2,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(T2," .").concat(T2,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Uv,`] {
    `).concat(Dve,": ").concat(l,`px;
  }
`)},$6=function(){var e=parseInt(document.body.getAttribute(Uv)||"0",10);return isFinite(e)?e:0},Zve=function(){p.useEffect(function(){return document.body.setAttribute(Uv,($6()+1).toString()),function(){var e=$6()-1;e<=0?document.body.removeAttribute(Uv):document.body.setAttribute(Uv,e.toString())}},[])},e0e=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,s=n===void 0?"margin":n;Zve();var o=p.useMemo(function(){return Yve(s)},[s]);return p.createElement(Jve,{styles:Qve(o,!t,s,r?"":"!important")})},iO=!1;if(typeof window<"u")try{var w_=Object.defineProperty({},"passive",{get:function(){return iO=!0,!0}});window.addEventListener("test",w_,w_),window.removeEventListener("test",w_,w_)}catch{iO=!1}var Tx=iO?{passive:!1}:!1,t0e=function(e){return e.tagName==="TEXTAREA"},PX=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!t0e(e)&&r[t]==="visible")},r0e=function(e){return PX(e,"overflowY")},n0e=function(e){return PX(e,"overflowX")},B6=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=EX(e,n);if(s){var o=kX(e,n),i=o[1],l=o[2];if(i>l)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},a0e=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},s0e=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},EX=function(e,t){return e==="v"?r0e(t):n0e(t)},kX=function(e,t){return e==="v"?a0e(t):s0e(t)},o0e=function(e,t){return e==="h"&&t==="rtl"?-1:1},i0e=function(e,t,r,n,s){var o=o0e(e,window.getComputedStyle(t).direction),i=o*n,l=r.target,c=t.contains(l),d=!1,u=i>0,f=0,h=0;do{if(!l)break;var m=kX(e,l),x=m[0],g=m[1],v=m[2],y=g-v-o*x;(x||y)&&EX(e,l)&&(f+=y,h+=x);var b=l.parentNode;l=b&&b.nodeType===Node.DOCUMENT_FRAGMENT_NODE?b.host:b}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return(u&&(s&&Math.abs(f)<1||!s&&i>f)||!u&&(s&&Math.abs(h)<1||!s&&-i>h))&&(d=!0),d},j_=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},q6=function(e){return[e.deltaX,e.deltaY]},z6=function(e){return e&&"current"in e?e.current:e},l0e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},c0e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},d0e=0,Dx=[];function u0e(e){var t=p.useRef([]),r=p.useRef([0,0]),n=p.useRef(),s=p.useState(d0e++)[0],o=p.useState(AX)[0],i=p.useRef(e);p.useEffect(function(){i.current=e},[e]),p.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var g=Ove([e.lockRef.current],(e.shards||[]).map(z6),!0).filter(Boolean);return g.forEach(function(v){return v.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),g.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var l=p.useCallback(function(g,v){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!i.current.allowPinchZoom;var y=j_(g),b=r.current,w="deltaX"in g?g.deltaX:b[0]-y[0],j="deltaY"in g?g.deltaY:b[1]-y[1],_,C=g.target,E=Math.abs(w)>Math.abs(j)?"h":"v";if("touches"in g&&E==="h"&&C.type==="range")return!1;var S=B6(E,C);if(!S)return!0;if(S?_=E:(_=E==="v"?"h":"v",S=B6(E,C)),!S)return!1;if(!n.current&&"changedTouches"in g&&(w||j)&&(n.current=_),!_)return!0;var A=n.current||_;return i0e(A,v,g,A==="h"?w:j,!0)},[]),c=p.useCallback(function(g){var v=g;if(!(!Dx.length||Dx[Dx.length-1]!==o)){var y="deltaY"in v?q6(v):j_(v),b=t.current.filter(function(_){return _.name===v.type&&(_.target===v.target||v.target===_.shadowParent)&&l0e(_.delta,y)})[0];if(b&&b.should){v.cancelable&&v.preventDefault();return}if(!b){var w=(i.current.shards||[]).map(z6).filter(Boolean).filter(function(_){return _.contains(v.target)}),j=w.length>0?l(v,w[0]):!i.current.noIsolation;j&&v.cancelable&&v.preventDefault()}}},[]),d=p.useCallback(function(g,v,y,b){var w={name:g,delta:v,target:y,should:b,shadowParent:f0e(y)};t.current.push(w),setTimeout(function(){t.current=t.current.filter(function(j){return j!==w})},1)},[]),u=p.useCallback(function(g){r.current=j_(g),n.current=void 0},[]),f=p.useCallback(function(g){d(g.type,q6(g),g.target,l(g,e.lockRef.current))},[]),h=p.useCallback(function(g){d(g.type,j_(g),g.target,l(g,e.lockRef.current))},[]);p.useEffect(function(){return Dx.push(o),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:h}),document.addEventListener("wheel",c,Tx),document.addEventListener("touchmove",c,Tx),document.addEventListener("touchstart",u,Tx),function(){Dx=Dx.filter(function(g){return g!==o}),document.removeEventListener("wheel",c,Tx),document.removeEventListener("touchmove",c,Tx),document.removeEventListener("touchstart",u,Tx)}},[]);var m=e.removeScrollBar,x=e.inert;return p.createElement(p.Fragment,null,x?p.createElement(o,{styles:c0e(s)}):null,m?p.createElement(e0e,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function f0e(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const m0e=qve(CX,u0e);var IX=p.forwardRef(function(e,t){return p.createElement(a5,Cf({},e,{ref:t,sideCar:m0e}))});IX.classNames=a5.classNames;const s5=IX;var o5="Popover",[OX,uct]=Nu(o5,[sy]),nj=sy(),[h0e,Pp]=OX(o5),TX=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:i=!1}=e,l=nj(t),c=p.useRef(null),[d,u]=p.useState(!1),[f,h]=zm({prop:n,defaultProp:s??!1,onChange:o,caller:o5});return a.jsx(MD,{...l,children:a.jsx(h0e,{scope:t,contentId:tf(),triggerRef:c,open:f,onOpenChange:h,onOpenToggle:p.useCallback(()=>h(m=>!m),[h]),hasCustomAnchor:d,onCustomAnchorAdd:p.useCallback(()=>u(!0),[]),onCustomAnchorRemove:p.useCallback(()=>u(!1),[]),modal:i,children:r})})};TX.displayName=o5;var DX="PopoverAnchor",p0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Pp(DX,r),o=nj(r),{onCustomAnchorAdd:i,onCustomAnchorRemove:l}=s;return p.useEffect(()=>(i(),()=>l()),[i,l]),a.jsx(r5,{...o,...n,ref:t})});p0e.displayName=DX;var MX="PopoverTrigger",RX=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Pp(MX,r),o=nj(r),i=$s(t,s.triggerRef),l=a.jsx(Qa.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":qX(s.open),...n,ref:i,onClick:aa(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?l:a.jsx(r5,{asChild:!0,...o,children:l})});RX.displayName=MX;var LD="PopoverPortal",[g0e,x0e]=OX(LD,{forceMount:void 0}),FX=e=>{const{__scopePopover:t,forceMount:r,children:n,container:s}=e,o=Pp(LD,t);return a.jsx(g0e,{scope:t,forceMount:r,children:a.jsx($d,{present:r||o.open,children:a.jsx(oy,{asChild:!0,container:s,children:n})})})};FX.displayName=LD;var p0="PopoverContent",LX=p.forwardRef((e,t)=>{const r=x0e(p0,e.__scopePopover),{forceMount:n=r.forceMount,...s}=e,o=Pp(p0,e.__scopePopover);return a.jsx($d,{present:n||o.open,children:o.modal?a.jsx(y0e,{...s,ref:t}):a.jsx(b0e,{...s,ref:t})})});LX.displayName=p0;var v0e=pp("PopoverContent.RemoveScroll"),y0e=p.forwardRef((e,t)=>{const r=Pp(p0,e.__scopePopover),n=p.useRef(null),s=$s(t,n),o=p.useRef(!1);return p.useEffect(()=>{const i=n.current;if(i)return n5(i)},[]),a.jsx(s5,{as:v0e,allowPinchZoom:!0,children:a.jsx($X,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:aa(e.onCloseAutoFocus,i=>{i.preventDefault(),o.current||r.triggerRef.current?.focus()}),onPointerDownOutside:aa(e.onPointerDownOutside,i=>{const l=i.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;o.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:aa(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),b0e=p.forwardRef((e,t)=>{const r=Pp(p0,e.__scopePopover),n=p.useRef(!1),s=p.useRef(!1);return a.jsx($X,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{e.onCloseAutoFocus?.(o),o.defaultPrevented||(n.current||r.triggerRef.current?.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{e.onInteractOutside?.(o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;r.triggerRef.current?.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),$X=p.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...f}=e,h=Pp(p0,r),m=nj(r);return QC(),a.jsx(tj,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:a.jsx(ry,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:a.jsx(RD,{"data-state":qX(h.open),role:"dialog",id:h.contentId,...m,...f,ref:t,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),BX="PopoverClose",w0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Pp(BX,r);return a.jsx(Qa.button,{type:"button",...n,ref:t,onClick:aa(e.onClick,()=>s.onOpenChange(!1))})});w0e.displayName=BX;var j0e="PopoverArrow",_0e=p.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=nj(r);return a.jsx(FD,{...s,...n,ref:t})});_0e.displayName=j0e;function qX(e){return e?"open":"closed"}var N0e=TX,S0e=RX,C0e=FX,zX=LX;const Qo=N0e,Zo=S0e,Go=Ce.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},s)=>a.jsx(C0e,{container:document.body,children:a.jsx(zX,{ref:s,align:t,sideOffset:r,className:Pr("z-[9999] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Go.displayName=zX.displayName;var i5="Dialog",[UX,VX]=Nu(i5),[A0e,ff]=UX(i5),WX=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:i=!0}=e,l=p.useRef(null),c=p.useRef(null),[d,u]=zm({prop:n,defaultProp:s??!1,onChange:o,caller:i5});return a.jsx(A0e,{scope:t,triggerRef:l,contentRef:c,contentId:tf(),titleId:tf(),descriptionId:tf(),open:d,onOpenChange:u,onOpenToggle:p.useCallback(()=>u(f=>!f),[u]),modal:i,children:r})};WX.displayName=i5;var HX="DialogTrigger",GX=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=ff(HX,r),o=$s(t,s.triggerRef);return a.jsx(Qa.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":qD(s.open),...n,ref:o,onClick:aa(e.onClick,s.onOpenToggle)})});GX.displayName=HX;var $D="DialogPortal",[P0e,KX]=UX($D,{forceMount:void 0}),XX=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:s}=e,o=ff($D,t);return a.jsx(P0e,{scope:t,forceMount:r,children:p.Children.map(n,i=>a.jsx($d,{present:r||o.open,children:a.jsx(oy,{asChild:!0,container:s,children:i})}))})};XX.displayName=$D;var DN="DialogOverlay",YX=p.forwardRef((e,t)=>{const r=KX(DN,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=ff(DN,e.__scopeDialog);return o.modal?a.jsx($d,{present:n||o.open,children:a.jsx(k0e,{...s,ref:t})}):null});YX.displayName=DN;var E0e=pp("DialogOverlay.RemoveScroll"),k0e=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=ff(DN,r);return a.jsx(s5,{as:E0e,allowPinchZoom:!0,shards:[s.contentRef],children:a.jsx(Qa.div,{"data-state":qD(s.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),Jg="DialogContent",JX=p.forwardRef((e,t)=>{const r=KX(Jg,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=ff(Jg,e.__scopeDialog);return a.jsx($d,{present:n||o.open,children:o.modal?a.jsx(I0e,{...s,ref:t}):a.jsx(O0e,{...s,ref:t})})});JX.displayName=Jg;var I0e=p.forwardRef((e,t)=>{const r=ff(Jg,e.__scopeDialog),n=p.useRef(null),s=$s(t,r.contentRef,n);return p.useEffect(()=>{const o=n.current;if(o)return n5(o)},[]),a.jsx(QX,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:aa(e.onCloseAutoFocus,o=>{o.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:aa(e.onPointerDownOutside,o=>{const i=o.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&o.preventDefault()}),onFocusOutside:aa(e.onFocusOutside,o=>o.preventDefault())})}),O0e=p.forwardRef((e,t)=>{const r=ff(Jg,e.__scopeDialog),n=p.useRef(!1),s=p.useRef(!1);return a.jsx(QX,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{e.onCloseAutoFocus?.(o),o.defaultPrevented||(n.current||r.triggerRef.current?.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{e.onInteractOutside?.(o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;r.triggerRef.current?.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),QX=p.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=e,l=ff(Jg,r),c=p.useRef(null),d=$s(t,c);return QC(),a.jsxs(a.Fragment,{children:[a.jsx(tj,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:a.jsx(ry,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":qD(l.open),...i,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),a.jsxs(a.Fragment,{children:[a.jsx(D0e,{titleId:l.titleId}),a.jsx(R0e,{contentRef:c,descriptionId:l.descriptionId})]})]})}),BD="DialogTitle",ZX=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=ff(BD,r);return a.jsx(Qa.h2,{id:s.titleId,...n,ref:t})});ZX.displayName=BD;var eY="DialogDescription",tY=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=ff(eY,r);return a.jsx(Qa.p,{id:s.descriptionId,...n,ref:t})});tY.displayName=eY;var rY="DialogClose",nY=p.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=ff(rY,r);return a.jsx(Qa.button,{type:"button",...n,ref:t,onClick:aa(e.onClick,()=>s.onOpenChange(!1))})});nY.displayName=rY;function qD(e){return e?"open":"closed"}var aY="DialogTitleWarning",[T0e,sY]=Fge(aY,{contentName:Jg,titleName:BD,docsSlug:"dialog"}),D0e=({titleId:e})=>{const t=sY(aY),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return p.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},M0e="DialogDescriptionWarning",R0e=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${sY(M0e).contentName}}.`;return p.useEffect(()=>{const s=e.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},oY=WX,F0e=GX,iY=XX,zD=YX,UD=JX,VD=ZX,WD=tY,l5=nY;const Un=oY,L0e=iY,Zh=l5,lY=Ce.forwardRef(({className:e,disableAnimations:t,...r},n)=>{const s=typeof window<"u"&&(window.matchMedia?.("(pointer: coarse)")?.matches||window.innerWidth<768),o=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,i=(t??!1)||s||o;return a.jsx(zD,{ref:n,className:Pr("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm",i?"data-[state=open]:animate-none data-[state=closed]:animate-none":"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r})});lY.displayName=zD.displayName;const zn=Ce.forwardRef(({className:e,children:t,overlayClassName:r,disableAnimations:n,alignTop:s,...o},i)=>{const l=typeof window<"u"&&(window.matchMedia?.("(pointer: coarse)")?.matches||window.innerWidth<768),c=typeof window<"u"&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,d=(n??!1)||l||c;return a.jsxs(L0e,{children:[a.jsx(lY,{disableAnimations:d,className:r}),a.jsxs(UD,{ref:i,className:Pr("fixed z-50 grid w-full max-w-lg gap-4 border border-border bg-surface p-6 pr-14 shadow-lg duration-200 sm:rounded-lg",s?"left-1/2 top-[10%] -translate-x-1/2":"left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",d?"data-[state=open]:animate-none data-[state=closed]:animate-none":"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...o,children:[t,a.jsxs(l5,{className:"absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-md border border-border bg-surface/90 opacity-80 shadow-sm ring-offset-background transition-all hover:opacity-100 hover:bg-surface focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(Hc,{className:"h-5 w-5"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]})});zn.displayName=UD.displayName;const Bn=({className:e,...t})=>a.jsx("div",{className:Pr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Bn.displayName="DialogHeader";const Ga=({className:e,...t})=>a.jsx("div",{className:Pr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Ga.displayName="DialogFooter";const Ln=Ce.forwardRef(({className:e,...t},r)=>a.jsx(VD,{ref:r,className:Pr("text-lg font-semibold leading-none tracking-tight",e),...t}));Ln.displayName=VD.displayName;const ma=Ce.forwardRef(({className:e,...t},r)=>a.jsx(WD,{ref:r,className:Pr("text-sm text-text-secondary",e),...t}));ma.displayName=WD.displayName;const $0e=1;let eE=0;function B0e(){return eE=(eE+1)%Number.MAX_VALUE,eE.toString()}const dc={state:{toasts:[]},listeners:[],getState:()=>dc.state,setState:e=>{typeof e=="function"?dc.state=e(dc.state):dc.state={...dc.state,...e},dc.listeners.forEach(t=>t(dc.state))},subscribe:e=>(dc.listeners.push(e),()=>{dc.listeners=dc.listeners.filter(t=>t!==e)})},D2=({...e})=>{const t=B0e(),r=s=>dc.setState(o=>({...o,toasts:o.toasts.map(i=>i.id===t?{...i,...s}:i)})),n=()=>dc.setState(s=>({...s,toasts:s.toasts.filter(o=>o.id!==t)}));return dc.setState(s=>({...s,toasts:[{...e,id:t,dismiss:n},...s.toasts].slice(0,$0e)})),{id:t,dismiss:n,update:r}};function Zs(){const[e,t]=p.useState(dc.getState());return p.useEffect(()=>dc.subscribe(n=>{t(n)}),[]),p.useEffect(()=>{const r=[];return e.toasts.forEach(n=>{if(n.duration===1/0)return;const s=setTimeout(()=>{n.dismiss()},n.duration||5e3);r.push(s)}),()=>{r.forEach(n=>clearTimeout(n))}},[e.toasts]),{toast:D2,toasts:e.toasts}}const q0e="main",z0e={dev:{supabaseUrl:"https://xlbgopcindcsteymtwjp.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsYmdvcGNpbmRjc3RleW10d2pwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MDAwMTQsImV4cCI6MjA4MDI3NjAxNH0.0ydvsFW8j5ZKCyHalAlFWHjjK8QbcDC6mZQzVJ0lSnA"},main:{supabaseUrl:"https://dlfryxtyxqoacuunswuc.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY"}},U0e=Object.freeze(Object.defineProperty({__proto__:null,ACTIVE_TARGET:q0e,TARGETS:z0e},Symbol.toStringTag,{value:"Module"})),V0e=void 0,W0e=void 0,H0e=Object.freeze(Object.defineProperty({__proto__:null,ACTIVE_TARGET:V0e,TARGETS:W0e},Symbol.toStringTag,{value:"Module"})),G0e="modulepreload",K0e=function(e){return"/"+e},U6={},zf=function(t,r,n){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=K0e(o),o in U6)return;U6[o]=!0;const i=o.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!n)for(let u=s.length-1;u>=0;u--){const f=s[u];if(f.href===o&&(!i||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":G0e,i||(d.as="script",d.crossOrigin=""),d.href=o,document.head.appendChild(d),i)return new Promise((u,f)=>{d.addEventListener("load",u),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})},X0e=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>zf(()=>Promise.resolve().then(()=>iy),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)};class HD extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class V6 extends HD{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class W6 extends HD{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class H6 extends HD{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var lO;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(lO||(lO={}));var Y0e=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class J0e{constructor(t,{headers:r={},customFetch:n,region:s=lO.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=X0e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Y0e(this,arguments,void 0,function*(r,n={}){var s;try{const{headers:o,method:i,body:l,signal:c}=n;let d={},{region:u}=n;u||(u=this.region);const f=new URL(`${this.url}/${r}`);u&&u!=="any"&&(d["x-region"]=u,f.searchParams.set("forceFunctionRegion",u));let h;l&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",h=l):typeof l=="string"?(d["Content-Type"]="text/plain",h=l):typeof FormData<"u"&&l instanceof FormData?h=l:(d["Content-Type"]="application/json",h=JSON.stringify(l)));const m=yield this.fetch(f.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),o),body:h,signal:c}).catch(y=>{throw y.name==="AbortError"?y:new V6(y)}),x=m.headers.get("x-relay-error");if(x&&x==="true")throw new W6(m);if(!m.ok)throw new H6(m);let g=((s=m.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),v;return g==="application/json"?v=yield m.json():g==="application/octet-stream"?v=yield m.blob():g==="text/event-stream"?v=m:g==="multipart/form-data"?v=yield m.formData():v=yield m.text(),{data:v,error:null,response:m}}catch(o){return o instanceof Error&&o.name==="AbortError"?{data:null,error:new V6(o)}:{data:null,error:o,response:o instanceof H6||o instanceof W6?o.context:void 0}}})}}var Rc={},GD={},c5={},aj={},d5={},u5={},Q0e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},g0=Q0e();const Z0e=g0.fetch,cY=g0.fetch.bind(g0),dY=g0.Headers,eye=g0.Request,tye=g0.Response,iy=Object.freeze(Object.defineProperty({__proto__:null,Headers:dY,Request:eye,Response:tye,default:cY,fetch:Z0e},Symbol.toStringTag,{value:"Module"})),rye=Aie(iy);var f5={};Object.defineProperty(f5,"__esModule",{value:!0});let nye=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};f5.default=nye;var uY=Gl&&Gl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(u5,"__esModule",{value:!0});const aye=uY(rye),sye=uY(f5);let oye=class{constructor(t){var r,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(r=t.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=aye.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,r){return this.headers=new Headers(this.headers),this.headers.set(t,r),this}then(t,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,l,c,d;let u=null,f=null,h=null,m=o.status,x=o.statusText;if(o.ok){if(this.method!=="HEAD"){const b=await o.text();b===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((i=this.headers.get("Accept"))===null||i===void 0)&&i.includes("application/vnd.pgrst.plan+text"))?f=b:f=JSON.parse(b))}const v=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),y=(c=o.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");v&&y&&y.length>1&&(h=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(u={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,m=406,x="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const v=await o.text();try{u=JSON.parse(v),Array.isArray(u)&&o.status===404&&(f=[],u=null,m=200,x="OK")}catch{o.status===404&&v===""?(m=204,x="No Content"):u={message:v}}if(u&&this.isMaybeSingle&&(!((d=u?.details)===null||d===void 0)&&d.includes("0 rows"))&&(u=null,m=200,x="OK"),u&&this.shouldThrowOnError)throw new sye.default(u)}return{error:u,data:f,count:h,status:m,statusText:x}});return this.shouldThrowOnError||(s=s.catch(o=>{var i,l,c;return{error:{message:`${(i=o?.name)!==null&&i!==void 0?i:"FetchError"}: ${o?.message}`,details:`${(l=o?.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=o?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(t,r)}returns(){return this}overrideTypes(){return this}};u5.default=oye;var iye=Gl&&Gl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(d5,"__esModule",{value:!0});const lye=iye(u5);let cye=class extends lye.default{select(t){let r=!1;const n=(t??"*").split("").map(s=>/\s/.test(s)&&!r?"":(s==='"'&&(r=!r),s)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:r=!0,nullsFirst:n,foreignTable:s,referencedTable:o=s}={}){const i=o?`${o}.order`:"order",l=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${l?`${l},`:""}${t}.${r?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:r,referencedTable:n=r}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,r,{foreignTable:n,referencedTable:s=n}={}){const o=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(o,`${t}`),this.url.searchParams.set(i,`${r-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:r=!1,settings:n=!1,buffers:s=!1,wal:o=!1,format:i="text"}={}){var l;const c=[t?"analyze":null,r?"verbose":null,n?"settings":null,s?"buffers":null,o?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${d}"; options=${c};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};d5.default=cye;var dye=Gl&&Gl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(aj,"__esModule",{value:!0});const uye=dye(d5);let fye=class extends uye.default{eq(t,r){return this.url.searchParams.append(t,`eq.${r}`),this}neq(t,r){return this.url.searchParams.append(t,`neq.${r}`),this}gt(t,r){return this.url.searchParams.append(t,`gt.${r}`),this}gte(t,r){return this.url.searchParams.append(t,`gte.${r}`),this}lt(t,r){return this.url.searchParams.append(t,`lt.${r}`),this}lte(t,r){return this.url.searchParams.append(t,`lte.${r}`),this}like(t,r){return this.url.searchParams.append(t,`like.${r}`),this}likeAllOf(t,r){return this.url.searchParams.append(t,`like(all).{${r.join(",")}}`),this}likeAnyOf(t,r){return this.url.searchParams.append(t,`like(any).{${r.join(",")}}`),this}ilike(t,r){return this.url.searchParams.append(t,`ilike.${r}`),this}ilikeAllOf(t,r){return this.url.searchParams.append(t,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(t,r){return this.url.searchParams.append(t,`ilike(any).{${r.join(",")}}`),this}is(t,r){return this.url.searchParams.append(t,`is.${r}`),this}in(t,r){const n=Array.from(new Set(r)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cs.{${r.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(r)}`),this}containedBy(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cd.{${r.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(r)}`),this}rangeGt(t,r){return this.url.searchParams.append(t,`sr.${r}`),this}rangeGte(t,r){return this.url.searchParams.append(t,`nxl.${r}`),this}rangeLt(t,r){return this.url.searchParams.append(t,`sl.${r}`),this}rangeLte(t,r){return this.url.searchParams.append(t,`nxr.${r}`),this}rangeAdjacent(t,r){return this.url.searchParams.append(t,`adj.${r}`),this}overlaps(t,r){return typeof r=="string"?this.url.searchParams.append(t,`ov.${r}`):this.url.searchParams.append(t,`ov.{${r.join(",")}}`),this}textSearch(t,r,{config:n,type:s}={}){let o="";s==="plain"?o="pl":s==="phrase"?o="ph":s==="websearch"&&(o="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${o}fts${i}.${r}`),this}match(t){return Object.entries(t).forEach(([r,n])=>{this.url.searchParams.append(r,`eq.${n}`)}),this}not(t,r,n){return this.url.searchParams.append(t,`not.${r}.${n}`),this}or(t,{foreignTable:r,referencedTable:n=r}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,r,n){return this.url.searchParams.append(t,`${r}.${n}`),this}};aj.default=fye;var mye=Gl&&Gl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(c5,"__esModule",{value:!0});const Ky=mye(aj);let hye=class{constructor(t,{headers:r={},schema:n,fetch:s}){this.url=t,this.headers=new Headers(r),this.schema=n,this.fetch=s}select(t,r){const{head:n=!1,count:s}=r??{},o=n?"HEAD":"GET";let i=!1;const l=(t??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join("");return this.url.searchParams.set("select",l),s&&this.headers.append("Prefer",`count=${s}`),new Ky.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:r,defaultToNull:n=!0}={}){var s;const o="POST";if(r&&this.headers.append("Prefer",`count=${r}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(i.length>0){const l=[...new Set(i)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ky.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(t,{onConflict:r,ignoreDuplicates:n=!1,count:s,defaultToNull:o=!0}={}){var i;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),r!==void 0&&this.url.searchParams.set("on_conflict",r),s&&this.headers.append("Prefer",`count=${s}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ky.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:r}={}){var n;const s="PATCH";return r&&this.headers.append("Prefer",`count=${r}`),new Ky.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var r;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Ky.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}};c5.default=hye;var fY=Gl&&Gl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(GD,"__esModule",{value:!0});const pye=fY(c5),gye=fY(aj);let xye=class mY{constructor(t,{headers:r={},schema:n,fetch:s}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=s}from(t){const r=new URL(`${this.url}/${t}`);return new pye.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new mY(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:s=!1,count:o}={}){var i;let l;const c=new URL(`${this.url}/rpc/${t}`);let d;n||s?(l=n?"HEAD":"GET",Object.entries(r).filter(([f,h])=>h!==void 0).map(([f,h])=>[f,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([f,h])=>{c.searchParams.append(f,h)})):(l="POST",d=r);const u=new Headers(this.headers);return o&&u.set("Prefer",`count=${o}`),new gye.default({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};GD.default=xye;var ly=Gl&&Gl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Rc,"__esModule",{value:!0});Rc.PostgrestError=Rc.PostgrestBuilder=Rc.PostgrestTransformBuilder=Rc.PostgrestFilterBuilder=Rc.PostgrestQueryBuilder=Rc.PostgrestClient=void 0;const hY=ly(GD);Rc.PostgrestClient=hY.default;const pY=ly(c5);Rc.PostgrestQueryBuilder=pY.default;const gY=ly(aj);Rc.PostgrestFilterBuilder=gY.default;const xY=ly(d5);Rc.PostgrestTransformBuilder=xY.default;const vY=ly(u5);Rc.PostgrestBuilder=vY.default;const yY=ly(f5);Rc.PostgrestError=yY.default;var vye=Rc.default={PostgrestClient:hY.default,PostgrestQueryBuilder:pY.default,PostgrestFilterBuilder:gY.default,PostgrestTransformBuilder:xY.default,PostgrestBuilder:vY.default,PostgrestError:yY.default};const{PostgrestClient:yye,PostgrestQueryBuilder:xct,PostgrestFilterBuilder:vct,PostgrestTransformBuilder:yct,PostgrestBuilder:bct,PostgrestError:wct}=vye;class bye{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const wye="2.75.0",jye=`realtime-js/${wye}`,_ye="1.0.0",cO=1e4,Nye=1e3,Sye=100;var Ub;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Ub||(Ub={}));var zi;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(zi||(zi={}));var Uu;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Uu||(Uu={}));var dO;(function(e){e.websocket="websocket"})(dO||(dO={}));var cg;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(cg||(cg={}));class Cye{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,r,n)}_decodeBroadcast(t,r,n){const s=r.getUint8(1),o=r.getUint8(2);let i=this.HEADER_LENGTH+2;const l=n.decode(t.slice(i,i+s));i=i+s;const c=n.decode(t.slice(i,i+o));i=i+o;const d=JSON.parse(n.decode(t.slice(i,t.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class bY{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Co;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Co||(Co={}));const G6=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((o,i)=>(o[i]=Aye(i,e,t,s),o),{}):{}},Aye=(e,t,r,n)=>{const s=t.find(l=>l.name===e),o=s?.type,i=r[e];return o&&!n.includes(o)?wY(o,i):uO(i)},wY=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return Iye(t,r)}switch(e){case Co.bool:return Pye(t);case Co.float4:case Co.float8:case Co.int2:case Co.int4:case Co.int8:case Co.numeric:case Co.oid:return Eye(t);case Co.json:case Co.jsonb:return kye(t);case Co.timestamp:return Oye(t);case Co.abstime:case Co.date:case Co.daterange:case Co.int4range:case Co.int8range:case Co.money:case Co.reltime:case Co.text:case Co.time:case Co.timestamptz:case Co.timetz:case Co.tsrange:case Co.tstzrange:return uO(t);default:return uO(t)}},uO=e=>e,Pye=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Eye=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},kye=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Iye=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let o;const i=e.slice(1,r);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(l=>wY(t,l))}return e},Oye=e=>typeof e=="string"?e.replace(" ","T"):e,jY=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class tE{constructor(t,r,n={},s=cO){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var K6;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(K6||(K6={}));class Vb{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Vb.syncState(this.state,s,o,i),this.pendingDiffs.forEach(c=>{this.state=Vb.syncDiff(this.state,c,o,i)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Vb.syncDiff(this.state,s,o,i),l())}),this.onJoin((s,o,i)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:i})}),this.onLeave((s,o,i)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const o=this.cloneDeep(t),i=this.transformState(r),l={},c={};return this.map(o,(d,u)=>{i[d]||(c[d]=u)}),this.map(i,(d,u)=>{const f=o[d];if(f){const h=u.map(v=>v.presence_ref),m=f.map(v=>v.presence_ref),x=u.filter(v=>m.indexOf(v.presence_ref)<0),g=f.filter(v=>h.indexOf(v.presence_ref)<0);x.length>0&&(l[d]=x),g.length>0&&(c[d]=g)}else l[d]=u}),this.syncDiff(o,{joins:l,leaves:c},n,s)}static syncDiff(t,r,n,s){const{joins:o,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const f=t[l].map(m=>m.presence_ref),h=u.filter(m=>f.indexOf(m.presence_ref)<0);t[l].unshift(...h)}n(l,u,c)}),this.map(i,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(f=>f.presence_ref);d=d.filter(f=>u.indexOf(f.presence_ref)<0),t[l]=d,s(l,d,c),d.length===0&&delete t[l]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var X6;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(X6||(X6={}));var Wb;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Wb||(Wb={}));var pm;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(pm||(pm={}));class KD{constructor(t,r={config:{}},n){var s,o;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=zi.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new tE(this,Uu.join,this.params,this.timeout),this.rejoinTimer=new bY(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=zi.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=zi.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=zi.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=zi.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=zi.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Uu.reply,{},(i,l)=>{this._trigger(this._replyEventName(l),i)}),this.presence=new Vb(this),this.broadcastEndpointURL=jY(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,o;if(this.socket.isConnected()||this.socket.connect(),this.state==zi.closed){const{config:{broadcast:i,presence:l,private:c}}=this.params,d=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[Wb.PRESENCE]&&this.bindings[Wb.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,f={},h={broadcast:i,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(m=>t?.(pm.CHANNEL_ERROR,m)),this._onClose(()=>t?.(pm.CLOSED)),this.updateJoinPayload(Object.assign({config:h},f)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:m})=>{var x;if(this.socket.setAuth(),m===void 0){t?.(pm.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,v=(x=g?.length)!==null&&x!==void 0?x:0,y=[];for(let b=0;b<v;b++){const w=g[b],{filter:{event:j,schema:_,table:C,filter:E}}=w,S=m&&m[b];if(S&&S.event===j&&S.schema===_&&S.table===C&&S.filter===E)y.push(Object.assign(Object.assign({},w),{id:S.id}));else{this.unsubscribe(),this.state=zi.errored,t?.(pm.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,t&&t(pm.SUBSCRIBED);return}}).receive("error",m=>{this.state=zi.errored,t?.(pm.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{t?.(pm.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===zi.joined&&t===Wb.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){const{event:o,payload:i}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,l,c;const d=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(i=this.params)===null||i===void 0?void 0:i.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&o("ok"),d.receive("ok",()=>o("ok")),d.receive("error",()=>o("error")),d.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=zi.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Uu.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new tE(this,Uu.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=zi.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),i=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(o),i}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new tE(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Sye){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,o;const i=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Uu;if(n&&[l,c,d,u].indexOf(i)>=0&&n!==this._joinRef())return;let h=this._onMessage(i,r,n);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(m=>{var x,g,v;return((x=m.filter)===null||x===void 0?void 0:x.event)==="*"||((v=(g=m.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(m=>m.callback(h,n)):(o=this.bindings[i])===null||o===void 0||o.filter(m=>{var x,g,v,y,b,w;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in m){const j=m.id,_=(x=m.filter)===null||x===void 0?void 0:x.event;return j&&((g=r.ids)===null||g===void 0?void 0:g.includes(j))&&(_==="*"||_?.toLocaleLowerCase()===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const j=(b=(y=m?.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return j==="*"||j===((w=r?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===i}).map(m=>{if(typeof h=="object"&&"ids"in h){const x=h.data,{schema:g,table:v,commit_timestamp:y,type:b,errors:w}=x;h=Object.assign(Object.assign({},{schema:g,table:v,commit_timestamp:y,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(x))}m.callback(h,n)})}_isClosed(){return this.state===zi.closed}_isJoined(){return this.state===zi.joined}_isJoining(){return this.state===zi.joining}_isLeaving(){return this.state===zi.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),o={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&KD.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Uu.close,{},t)}_onError(t){this._on(Uu.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=zi.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=G6(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=G6(t.columns,t.old_record)),r}}const rE=()=>{},__={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Tye=[1e3,2e3,5e3,1e4],Dye=1e4,Mye=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Rye{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=cO,this.transport=null,this.heartbeatIntervalMs=__.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=rE,this.ref=0,this.reconnectTimer=null,this.logger=rE,this.conn=null,this.sendBuffer=[],this.serializer=new Cye,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let o;return s?o=s:typeof fetch>"u"?o=(...i)=>zf(()=>Promise.resolve().then(()=>iy),void 0).then(({default:l})=>l(...i)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...i)=>o(...i)},!(!((n=r?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${dO.websocket}`,this.httpEndpoint=jY(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=bye.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:_ye}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ub.connecting:return cg.Connecting;case Ub.open:return cg.Open;case Ub.closing:return cg.Closing;default:return cg.Closed}}isConnected(){return this.connectionState()===cg.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new KD(`realtime:${t}`,r,this);return this.channels.push(o),o}}push(t){const{topic:r,event:n,payload:s,ref:o}=t,i=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${r} ${n} (${o})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Nye,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},__.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:o,ref:i}=r,l=i?`(${i})`:"",c=o.status||"";this.log("receive",`${c} ${n} ${s} ${l}`.trim(),o),this.channels.filter(d=>d._isMember(n)).forEach(d=>d._trigger(s,o,i)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Uu.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([Mye],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const s={access_token:r,version:jye};r&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(Uu.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new bY(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},__.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,o,i,l,c,d,u;if(this.transport=(r=t?.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t?.timeout)!==null&&n!==void 0?n:cO,this.heartbeatIntervalMs=(s=t?.heartbeatIntervalMs)!==null&&s!==void 0?s:__.HEARTBEAT_INTERVAL,this.worker=(o=t?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(i=t?.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(l=t?.heartbeatCallback)!==null&&l!==void 0?l:rE,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t?.reconnectAfterMs)!==null&&c!==void 0?c:f=>Tye[f-1]||Dye,this.encode=(d=t?.encode)!==null&&d!==void 0?d:(f,h)=>h(JSON.stringify(f)),this.decode=(u=t?.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class XD extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Oi(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Fye extends XD{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class fO extends XD{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}var Lye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const _Y=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>zf(()=>Promise.resolve().then(()=>iy),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},$ye=()=>Lye(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield zf(()=>Promise.resolve().then(()=>iy),void 0)).Response:Response}),mO=e=>{if(Array.isArray(e))return e.map(r=>mO(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[s]=mO(n)}),t},Bye=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var xx=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const nE=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),qye=(e,t,r)=>xx(void 0,void 0,void 0,function*(){const n=yield $ye();e instanceof n&&!r?.noResolveJson?e.json().then(s=>{const o=e.status||500,i=s?.statusCode||o+"";t(new Fye(nE(s),o,i))}).catch(s=>{t(new fO(nE(s),s))}):t(new fO(nE(e),e))}),zye=(e,t,r,n)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"||!n?s:(Bye(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t?.headers),s.body=JSON.stringify(n)):s.body=n,t?.duplex&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r))};function sj(e,t,r,n,s,o){return xx(this,void 0,void 0,function*(){return new Promise((i,l)=>{e(r,zye(t,n,s,o)).then(c=>{if(!c.ok)throw c;return n?.noResolveJson?c:c.json()}).then(c=>i(c)).catch(c=>qye(c,l,n))})})}function MN(e,t,r,n){return xx(this,void 0,void 0,function*(){return sj(e,"GET",t,r,n)})}function Nf(e,t,r,n,s){return xx(this,void 0,void 0,function*(){return sj(e,"POST",t,n,s,r)})}function hO(e,t,r,n,s){return xx(this,void 0,void 0,function*(){return sj(e,"PUT",t,n,s,r)})}function Uye(e,t,r,n){return xx(this,void 0,void 0,function*(){return sj(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function NY(e,t,r,n,s){return xx(this,void 0,void 0,function*(){return sj(e,"DELETE",t,n,s,r)})}var Vye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Wye{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return Vye(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Oi(t))return{data:null,error:t};throw t}})}}var Hye=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Gye{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}asStream(){return new Wye(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.execute().then(t,r)}execute(){return Hye(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Oi(t))return{data:null,error:t};throw t}})}}var kc=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Kye={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Y6={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Xye{constructor(t,r={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=_Y(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,s){return kc(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},Y6),s);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const c=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c))):(o=n,l["cache-control"]=`max-age=${i.cacheControl}`,l["content-type"]=i.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(l=Object.assign(Object.assign({},l),s.headers));const d=this._removeEmptyFolders(r),u=this._getFinalPath(d),f=yield(t=="PUT"?hO:Nf)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:l},i?.duplex?{duplex:i.duplex}:{}));return{data:{path:d,id:f.Id,fullPath:f.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Oi(o))return{data:null,error:o};throw o}})}upload(t,r,n){return kc(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,s){return kc(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),i=this._getFinalPath(o),l=new URL(this.url+`/object/upload/sign/${i}`);l.searchParams.set("token",r);try{let c;const d=Object.assign({upsert:Y6.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const f=yield hO(this.fetch,l.toString(),c,{headers:u});return{data:{path:o,fullPath:f.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Oi(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,r){return kc(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const s=Object.assign({},this.headers);r?.upsert&&(s["x-upsert"]="true");const o=yield Nf(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),i=new URL(this.url+o.url),l=i.searchParams.get("token");if(!l)throw new XD("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:l},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Oi(n))return{data:null,error:n};throw n}})}update(t,r,n){return kc(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return kc(this,void 0,void 0,function*(){try{return{data:yield Nf(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Oi(s))return{data:null,error:s};throw s}})}copy(t,r,n){return kc(this,void 0,void 0,function*(){try{return{data:{path:(yield Nf(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Oi(s))return{data:null,error:s};throw s}})}createSignedUrl(t,r,n){return kc(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),o=yield Nf(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Oi(s))return{data:null,error:s};throw s}})}createSignedUrls(t,r,n){return kc(this,void 0,void 0,function*(){try{const s=yield Nf(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Oi(s))return{data:null,error:s};throw s}})}download(t,r){const s=typeof r?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(r?.transform||{}),i=o?`?${o}`:"",l=this._getFinalPath(t),c=()=>MN(this.fetch,`${this.url}/${s}/${l}${i}`,{headers:this.headers,noResolveJson:!0});return new Gye(c,this.shouldThrowOnError)}info(t){return kc(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield MN(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:mO(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Oi(n))return{data:null,error:n};throw n}})}exists(t){return kc(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield Uye(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Oi(n)&&n instanceof fO){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),s=[],o=r?.download?`download=${r.download===!0?"":r.download}`:"";o!==""&&s.push(o);const l=typeof r?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(r?.transform||{});c!==""&&s.push(c);let d=s.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${d}`)}}}remove(t){return kc(this,void 0,void 0,function*(){try{return{data:yield NY(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oi(r))return{data:null,error:r};throw r}})}list(t,r,n){return kc(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Kye),r),{prefix:t||""});return{data:yield Nf(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Oi(s))return{data:null,error:s};throw s}})}listV2(t,r){return kc(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield Nf(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Oi(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const Yye="2.75.0",Jye={"X-Client-Info":`storage-js/${Yye}`};var Mx=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Qye{constructor(t,r={},n,s){this.shouldThrowOnError=!1;const o=new URL(t);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Jye),r),this.fetch=_Y(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Mx(this,void 0,void 0,function*(){try{return{data:yield MN(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Oi(t))return{data:null,error:t};throw t}})}getBucket(t){return Mx(this,void 0,void 0,function*(){try{return{data:yield MN(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oi(r))return{data:null,error:r};throw r}})}createBucket(t){return Mx(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield Nf(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Oi(s))return{data:null,error:s};throw s}})}updateBucket(t,r){return Mx(this,void 0,void 0,function*(){try{return{data:yield hO(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Oi(n))return{data:null,error:n};throw n}})}emptyBucket(t){return Mx(this,void 0,void 0,function*(){try{return{data:yield Nf(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oi(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Mx(this,void 0,void 0,function*(){try{return{data:yield NY(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Oi(r))return{data:null,error:r};throw r}})}}class Zye extends Qye{constructor(t,r={},n,s){super(t,r,n,s)}from(t){return new Xye(this.url,this.headers,t,this.fetch)}}const ebe="2.75.0";let jb="";typeof Deno<"u"?jb="deno":typeof document<"u"?jb="web":typeof navigator<"u"&&navigator.product==="ReactNative"?jb="react-native":jb="node";const tbe={"X-Client-Info":`supabase-js-${jb}/${ebe}`},rbe={headers:tbe},nbe={schema:"public"},abe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},sbe={};var obe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const ibe=e=>{let t;return e?t=e:typeof fetch>"u"?t=cY:t=fetch,(...r)=>t(...r)},lbe=()=>typeof Headers>"u"?dY:Headers,cbe=(e,t,r)=>{const n=ibe(r),s=lbe();return(o,i)=>obe(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:e;let d=new s(i?.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(o,Object.assign(Object.assign({},i),{headers:d}))})};var dbe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};function ube(e){return e.endsWith("/")?e:e+"/"}function fbe(e,t){var r,n;const{db:s,auth:o,realtime:i,global:l}=e,{db:c,auth:d,realtime:u,global:f}=t,h={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},d),o),realtime:Object.assign(Object.assign({},u),i),storage:{},global:Object.assign(Object.assign(Object.assign({},f),l),{headers:Object.assign(Object.assign({},(r=f?.headers)!==null&&r!==void 0?r:{}),(n=l?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>dbe(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}function mbe(e){const t=e?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ube(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const SY="2.75.0",iv=30*1e3,pO=3,aE=pO*iv,hbe="http://localhost:9999",pbe="supabase.auth.token",gbe={"X-Client-Info":`gotrue-js/${SY}`},gO="X-Supabase-Api-Version",CY={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},xbe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vbe=10*60*1e3;class Bw extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Ha(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class ybe extends Bw{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function bbe(e){return Ha(e)&&e.name==="AuthApiError"}class dg extends Bw{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Ep extends Bw{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class gh extends Ep{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function wbe(e){return Ha(e)&&e.name==="AuthSessionMissingError"}class Rx extends Ep{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class N_ extends Ep{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class S_ extends Ep{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function jbe(e){return Ha(e)&&e.name==="AuthImplicitGrantRedirectError"}class J6 extends Ep{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class xO extends Ep{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function sE(e){return Ha(e)&&e.name==="AuthRetryableFetchError"}class Q6 extends Ep{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class vO extends Ep{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const RN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Z6=` 	
\r=`.split(""),_be=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Z6.length;t+=1)e[Z6[t].charCodeAt(0)]=-2;for(let t=0;t<RN.length;t+=1)e[RN[t].charCodeAt(0)]=t;return e})();function e8(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(RN[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(RN[n]),t.queuedBits-=6}}function AY(e,t,r){const n=_be[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function t8(e){const t=[],r=i=>{t.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=i=>{Cbe(i,n,r)};for(let i=0;i<e.length;i+=1)AY(e.charCodeAt(i),s,o);return t.join("")}function Nbe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function Sbe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}Nbe(n,t)}}function Cbe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Vv(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)AY(e.charCodeAt(s),r,n);return new Uint8Array(t)}function Abe(e){const t=[];return Sbe(e,r=>t.push(r)),new Uint8Array(t)}function xg(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>e8(s,r,n)),e8(null,r,n),t.join("")}function Pbe(e){return Math.round(Date.now()/1e3)+e}function Ebe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const fd=()=>typeof window<"u"&&typeof document<"u",zp={tested:!1,writable:!1},PY=()=>{if(!fd())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(zp.tested)return zp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),zp.tested=!0,zp.writable=!0}catch{zp.tested=!0,zp.writable=!1}return zp.writable};function kbe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,o)=>{t[o]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const EY=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>zf(()=>Promise.resolve().then(()=>iy),void 0).then(({default:n})=>n(...r)):t=fetch,(...r)=>t(...r)},Ibe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",lv=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Up=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ih=async(e,t)=>{await e.removeItem(t)};class m5{constructor(){this.promise=new m5.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}m5.promiseConstructor=Promise;function oE(e){const t=e.split(".");if(t.length!==3)throw new vO("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!xbe.test(t[n]))throw new vO("JWT not in base64url format");return{header:JSON.parse(t8(t[0])),payload:JSON.parse(t8(t[1])),signature:Vv(t[2]),raw:{header:t[0],payload:t[1]}}}async function Obe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Tbe(e,t){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await e(o);if(!t(o,null,i)){n(i);return}}catch(i){if(!t(o,i)){s(i);return}}})()})}function Dbe(e){return("0"+e.toString(16)).substr(-2)}function Mbe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let o=0;o<56;o++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,Dbe).join("")}async function Rbe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function Fbe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await Rbe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Fx(e,t,r=!1){const n=Mbe();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await lv(e,`${t}-code-verifier`,s);const o=await Fbe(n);return[o,n===o?"plain":"s256"]}const Lbe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $be(e){const t=e.headers.get(gO);if(!t||!t.match(Lbe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Bbe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function qbe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const zbe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Lx(e){if(!zbe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function iE(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function r8(e){return JSON.parse(JSON.stringify(e))}var Ube=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};const tg=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Vbe=[502,503,504];async function n8(e){var t;if(!Ibe(e))throw new xO(tg(e),0);if(Vbe.includes(e.status))throw new xO(tg(e),e.status);let r;try{r=await e.json()}catch(o){throw new dg(tg(o),o)}let n;const s=$be(e);if(s&&s.getTime()>=CY["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Q6(tg(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new gh}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new Q6(tg(r),e.status,r.weak_password.reasons);throw new ybe(tg(r),e.status||500,n)}const Wbe=(e,t,r,n)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function hs(e,t,r,n){var s;const o=Object.assign({},n?.headers);o[gO]||(o[gO]=CY["2024-01-01"].name),n?.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const i=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await Hbe(e,t,r+l,{headers:o,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(c):{data:Object.assign({},c),error:null}}async function Hbe(e,t,r,n,s,o){const i=Wbe(t,n,s,o);let l;try{l=await e(r,Object.assign({},i))}catch(c){throw console.error(c),new xO(tg(c),0)}if(l.ok||await n8(l),n?.noResolveJson)return l;try{return await l.json()}catch(c){await n8(c)}}function Lu(e){var t;let r=null;Xbe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=Pbe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function a8(e){const t=Lu(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Ch(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Gbe(e){return{data:e,error:null}}function Kbe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o}=e,i=Ube(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o},c=Object.assign({},i);return{data:{properties:l,user:c},error:null}}function s8(e){return e}function Xbe(e){return e.access_token&&e.refresh_token&&e.expires_in}const lE=["global","local","others"];var Ybe=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};class Jbe{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=EY(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=lE[0]){if(lE.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${lE.join(", ")}`);try{return await hs(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ha(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await hs(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Ch})}catch(n){if(Ha(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=Ybe(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await hs(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Kbe,redirectTo:r?.redirectTo})}catch(r){if(Ha(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await hs(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ch})}catch(r){if(Ha(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await hs(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:s8});if(u.error)throw u.error;const f=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(x=>{const g=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(x.split(";")[1].split("=")[1]);d[`${v}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(Ha(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){Lx(t);try{return await hs(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ch})}catch(r){if(Ha(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Lx(t);try{return await hs(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Ch})}catch(n){if(Ha(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){Lx(t);try{return await hs(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Ch})}catch(n){if(Ha(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Lx(t.userId);try{const{data:r,error:n}=await hs(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Lx(t.userId),Lx(t.id);try{return{data:await hs(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await hs(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:s8});if(u.error)throw u.error;const f=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(x=>{const g=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(x.split(";")[1].split("=")[1]);d[`${v}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(Ha(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(t){try{return await hs(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await hs(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await hs(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await hs(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}}}function o8(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const $x={debug:!!(globalThis&&PY()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class kY extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Qbe extends kY{}async function Zbe(e,t,r){$x.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),$x.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){$x.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{$x.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw $x.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Qbe(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if($x.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function ewe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function IY(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function twe(e){return parseInt(e,16)}function rwe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function nwe(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:o=new Date,nonce:i,notBefore:l,requestId:c,resources:d,scheme:u,uri:f,version:h}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const m=IY(e.address),x=u?`${u}://${n}`:n,g=e.statement?`${e.statement}
`:"",v=`${x} wants you to sign in with your Ethereum account:
${m}

${g}`;let y=`URI: ${f}
Version: ${h}
Chain ID: ${r}${i?`
Nonce: ${i}`:""}
Issued At: ${o.toISOString()}`;if(s&&(y+=`
Expiration Time: ${s.toISOString()}`),l&&(y+=`
Not Before: ${l.toISOString()}`),c&&(y+=`
Request ID: ${c}`),d){let b=`
Resources:`;for(const w of d){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);b+=`
- ${w}`}y+=b}return`${v}
${y}`}class Ii extends Error{constructor({message:t,code:r,cause:n,name:s}){var o;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(o=s??(n instanceof Error?n.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=r}}class FN extends Ii{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function awe({error:e,options:t}){var r,n,s;const{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ii({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Ii({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=o.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Ii({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ii({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Ii({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Ii({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return o.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new Ii({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Ii({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const i=window.location.hostname;if(TY(i)){if(o.rp.id!==i)return new Ii({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ii({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new Ii({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Ii({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ii({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function swe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ii({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Ii({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(TY(n)){if(r.rpId!==n)return new Ii({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ii({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Ii({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ii({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}var OY=globalThis&&globalThis.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};class owe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const iwe=new owe;function lwe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=OY(e,["challenge","user","excludeCredentials"]),o=Vv(t).buffer,i=Object.assign(Object.assign({},r),{id:Vv(r.id).buffer}),l=Object.assign(Object.assign({},s),{challenge:o,user:i});if(n&&n.length>0){l.excludeCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const d=n[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:Vv(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function cwe(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=OY(e,["challenge","allowCredentials"]),s=Vv(t).buffer,o=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){o.allowCredentials=new Array(r.length);for(let i=0;i<r.length;i++){const l=r[i];o.allowCredentials[i]=Object.assign(Object.assign({},l),{id:Vv(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return o}function dwe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:xg(new Uint8Array(e.response.attestationObject)),clientDataJSON:xg(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function uwe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:xg(new Uint8Array(s.authenticatorData)),clientDataJSON:xg(new Uint8Array(s.clientDataJSON)),signature:xg(new Uint8Array(s.signature)),userHandle:s.userHandle?xg(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function TY(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function i8(){var e,t;return!!(fd()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function fwe(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new FN("Browser returned unexpected credential type",t)}:{data:null,error:new FN("Empty credential response",t)}}catch(t){return{data:null,error:awe({error:t,options:e})}}}async function mwe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new FN("Browser returned unexpected credential type",t)}:{data:null,error:new FN("Empty credential response",t)}}catch(t){return{data:null,error:swe({error:t,options:e})}}}const hwe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},pwe={userVerification:"preferred",hints:["security-key"]};function LN(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const o in s){const i=s[o];if(i!==void 0)if(Array.isArray(i))n[o]=i;else if(r(i))n[o]=i;else if(t(i)){const l=n[o];t(l)?n[o]=LN(l,i):n[o]=LN(i)}else n[o]=i}return n}function gwe(e,t){return LN(hwe,e,t||{})}function xwe(e,t){return LN(pwe,e,t||{})}class vwe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},o){try{const{data:i,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!i)return{data:null,error:l};const c=s??iwe.createNewAbortSignal();if(i.webauthn.type==="create"){const{user:d}=i.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${n}`),d.displayName||(d.displayName=d.name)}switch(i.webauthn.type){case"create":{const d=gwe(i.webauthn.credential_options.publicKey,o?.create),{data:u,error:f}=await fwe({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}case"request":{const d=xwe(i.webauthn.credential_options.publicKey,o?.request),{data:u,error:f}=await mwe(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}}}catch(i){return Ha(i)?{data:null,error:i}:{data:null,error:new dg("Unexpected error in challenge",i)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}},o){if(!r)return{data:null,error:new Bw("rpId is required for WebAuthn authentication")};try{if(!i8())return{data:null,error:new dg("Browser does not support WebAuthn",null)};const{data:i,error:l}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:o});if(!i)return{data:null,error:l};const{webauthn:c}=i;return this._verify({factorId:t,challengeId:i.challengeId,webauthn:{type:c.type,rpId:r,rpOrigins:n,credential_response:c.credential_response}})}catch(i){return Ha(i)?{data:null,error:i}:{data:null,error:new dg("Unexpected error in authenticate",i)}}}async _register({friendlyName:t,rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s},o){if(!r)return{data:null,error:new Bw("rpId is required for WebAuthn registration")};try{if(!i8())return{data:null,error:new dg("Browser does not support WebAuthn",null)};const{data:i,error:l}=await this._enroll({friendlyName:t});if(!i)return await this.client.mfa.listFactors().then(u=>{var f;return(f=u.data)===null||f===void 0?void 0:f.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===t&&h.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:o});return c?this._verify({factorId:i.id,challengeId:c.challengeId,webauthn:{rpId:r,rpOrigins:n,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(i){return Ha(i)?{data:null,error:i}:{data:null,error:new dg("Unexpected error in register",i)}}}}ewe();const ywe={url:hbe,storageKey:pbe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:gbe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function l8(e,t,r){return await r()}const Bx={};class qw{get jwks(){var t,r;return(r=(t=Bx[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){Bx[this.storageKey]=Object.assign(Object.assign({},Bx[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=Bx[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Bx[this.storageKey]=Object.assign(Object.assign({},Bx[this.storageKey]),{cachedAt:t})}constructor(t){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=qw.nextInstanceID,qw.nextInstanceID+=1,this.instanceID>0&&fd()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},ywe),t);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Jbe({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=EY(s.fetch),this.lock=s.lock||l8,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:fd()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Zbe:this.lock=l8,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new vwe(this)},this.persistSession?(s.storage?this.storage=s.storage:PY()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=o8(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=o8(this.memoryStorage)),fd()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${SY}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const r=kbe(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),fd()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(r,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),jbe(o)){const c=(t=o.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",l),await this._saveSession(i),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Ha(r)?{error:r}:{error:new dg("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const o=await hs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Lu}),{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(Ha(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(t){var r,n,s;try{let o;if("email"in t){const{email:u,password:f,options:h}=t;let m=null,x=null;this.flowType==="pkce"&&([m,x]=await Fx(this.storage,this.storageKey)),o=await hs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:f,data:(r=h?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:m,code_challenge_method:x},xform:Lu})}else if("phone"in t){const{phone:u,password:f,options:h}=t;o=await hs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:f,data:(n=h?.data)!==null&&n!==void 0?n:{},channel:(s=h?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Lu})}else throw new N_("You must provide either an email or phone number and a password");const{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(Ha(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(t){try{let r;if("email"in t){const{email:o,password:i,options:l}=t;r=await hs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:a8})}else if("phone"in t){const{phone:o,password:i,options:l}=t;r=await hs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:a8})}else throw new N_("You must provide either an email or phone number and a password");const{data:n,error:s}=r;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Rx}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(Ha(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(t){var r,n,s,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,o,i,l,c,d,u,f,h;let m,x;if("message"in t)m=t.message,x=t.signature;else{const{chain:g,wallet:v,statement:y,options:b}=t;let w;if(fd())if(typeof v=="object")w=v;else{const A=window;if("ethereum"in A&&typeof A.ethereum=="object"&&"request"in A.ethereum&&typeof A.ethereum.request=="function")w=A.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=v}const j=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href),_=await w.request({method:"eth_requestAccounts"}).then(A=>A).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!_||_.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=IY(_[0]);let E=(n=b?.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!E){const A=await w.request({method:"eth_chainId"});E=twe(A)}const S={domain:j.host,address:C,statement:y,uri:j.href,version:"1",chainId:E,nonce:(s=b?.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(i=(o=b?.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(l=b?.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=b?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=b?.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=b?.signInWithEthereum)===null||u===void 0?void 0:u.resources};m=nwe(S),x=await w.request({method:"personal_sign",params:[rwe(m),C]})}try{const{data:g,error:v}=await hs(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:x},!((f=t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=t.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Lu});if(v)throw v;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new Rx}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:v})}catch(g){if(Ha(g))return{data:{user:null,session:null},error:g};throw g}}async signInWithSolana(t){var r,n,s,o,i,l,c,d,u,f,h,m;let x,g;if("message"in t)x=t.message,g=t.signature;else{const{chain:v,wallet:y,statement:b,options:w}=t;let j;if(fd())if(typeof y=="object")j=y;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))j=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=y}const _=new URL((r=w?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in j&&j.signIn){const C=await j.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),b?{statement:b}:null));let E;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")E=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)E=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in E&&"signature"in E&&(typeof E.signedMessage=="string"||E.signedMessage instanceof Uint8Array)&&E.signature instanceof Uint8Array)x=typeof E.signedMessage=="string"?E.signedMessage:new TextDecoder().decode(E.signedMessage),g=E.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in j)||typeof j.signMessage!="function"||!("publicKey"in j)||typeof j!="object"||!j.publicKey||!("toBase58"in j.publicKey)||typeof j.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${_.host} wants you to sign in with your Solana account:`,j.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(s=(n=w?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=w?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((i=w?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((d=w?.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(E=>`- ${E}`)]:[]].join(`
`);const C=await j.signMessage(new TextEncoder().encode(x),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=C}}try{const{data:v,error:y}=await hs(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:xg(g)},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Lu});if(y)throw y;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Rx}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:y})}catch(v){if(Ha(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(t){const r=await Up(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:o,error:i}=await hs(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Lu});if(await ih(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new Rx}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:i})}catch(o){if(Ha(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:o,nonce:i}=t,l=await hs(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:Lu}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Rx}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(r){if(Ha(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(t){var r,n,s,o,i;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Fx(this.storage,this.storageKey));const{error:f}=await hs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await hs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(i=c?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:d?.message_id},error:u}}throw new N_("You must provide either an email or phone number.")}catch(l){if(Ha(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var r,n;try{let s,o;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:l}=await hs(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:Lu});if(l)throw l;if(!i)throw new Error("An error occurred on token verification.");const c=i.session,d=i.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(s){if(Ha(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(t){var r,n,s;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await Fx(this.storage,this.storageKey)),await hs(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:Gbe})}catch(o){if(Ha(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new gh;const{error:s}=await hs(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:s}})}catch(t){if(Ha(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:o}=t,{error:i}=await hs(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in t){const{phone:n,type:s,options:o}=t,{data:i,error:l}=await hs(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:l}}throw new N_("You must provide either an email or phone number and a type")}catch(r){if(Ha(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Up(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<aE:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const i=await Up(this.userStorage,this.storageKey+"-user");i?.user?t.user=i.user:t.user=iE()}if(this.storage.isServer&&t.user){let i=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!i&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{session:null},error:o}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await hs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ch}):await this._useSession(async r=>{var n,s,o;const{data:i,error:l}=r;if(l)throw l;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new gh}:await hs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Ch})})}catch(r){if(Ha(r))return wbe(r)&&(await this._removeSession(),await ih(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new gh;const i=s.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await Fx(this.storage,this.storageKey));const{data:d,error:u}=await hs(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:i.access_token,xform:Ch});if(u)throw u;return i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(Ha(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new gh;const r=Date.now()/1e3;let n=r,s=!0,o=null;const{payload:i}=oE(t.access_token);if(i.exp&&(n=i.exp,s=n<=r),s){const{data:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};o=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;o={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(r){if(Ha(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:i,error:l}=r;if(l)throw l;t=(n=i.session)!==null&&n!==void 0?n:void 0}if(!t?.refresh_token)throw new gh;const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{user:null,session:null},error:o}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Ha(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(t,r){try{if(!fd())throw new S_("No browser detected.");if(t.error||t.error_description||t.error_code)throw new S_(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new J6("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new S_("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new J6("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(t.code);if(w)throw w;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:i,expires_in:l,expires_at:c,token_type:d}=t;if(!o||!l||!i||!d)throw new S_("No session defined in URL");const u=Math.round(Date.now()/1e3),f=parseInt(l);let h=u+f;c&&(h=parseInt(c));const m=h-u;m*1e3<=iv&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${f}s`);const x=h-f;u-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,h,u):u-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,h,u);const{data:g,error:v}=await this._getUser(o);if(v)throw v;const y={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:f,expires_at:h,refresh_token:i,token_type:d,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:t.type},error:null}}catch(n){if(Ha(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Up(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{error:o};const i=(n=s.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:l}=await this.admin.signOut(i,t);if(l&&!(bbe(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await ih(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const r=Ebe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:o},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Fx(this.storage,this.storageKey,!0));try{return await hs(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(o){if(Ha(o))return{data:null,error:o};throw o}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async o=>{var i,l,c,d,u;const{data:f,error:h}=o;if(h)throw h;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await hs(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(d=f.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return fd()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:t.provider,url:n?.url},error:null}}catch(n){if(Ha(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:o}}=r;if(s)throw s;const{options:i,provider:l,token:c,access_token:d,nonce:u}=t,f=await hs(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=o?.access_token)!==null&&n!==void 0?n:void 0,body:{provider:l,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:Lu}),{data:h,error:m}=f;return m?{data:{user:null,session:null},error:m}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new Rx}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),{data:h,error:m})}catch(s){if(Ha(s))return{data:{user:null,session:null},error:s};throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)throw i;return await hs(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Tbe(async s=>(s>0&&await Obe(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await hs(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Lu})),(s,o)=>{const i=200*Math.pow(2,s);return o&&sE(o)&&Date.now()+i-n<iv})}catch(n){if(this._debug(r,"error",n),Ha(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),fd()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Up(this.storage,this.storageKey);if(s&&this.userStorage){let i=await Up(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:s.user},await lv(this.userStorage,this.storageKey+"-user",i)),s.user=(t=i?.user)!==null&&t!==void 0?t:iE()}else if(s&&!s.user&&!s.user){const i=await Up(this.storage,this.storageKey+"-user");i&&i?.user?(s.user=i.user,await ih(this.storage,this.storageKey+"-user"),await lv(this.storage,this.storageKey,s)):s.user=iE()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<aE;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${aE}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),sE(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:l}=await this._getUser(s.access_token);!l&&i?.user?(s.user=i.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new gh;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new m5;const{data:o,error:i}=await this._refreshAccessToken(t);if(i)throw i;if(!o.session)throw new gh;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const l={data:o.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(o){if(this._debug(s,"error",o),Ha(o)){const i={data:null,error:o};return sE(o)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,r)}catch(c){o.push(c)}});if(await Promise.all(i),o.length>0){for(let l=0;l<o.length;l+=1)console.error(o[l]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await lv(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const o=r8(s);await lv(this.storage,this.storageKey,o)}else{const s=r8(r);await lv(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await ih(this.storage,this.storageKey),await ih(this.storage,this.storageKey+"-code-verifier"),await ih(this.storage,this.storageKey+"-user"),this.userStorage&&await ih(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&fd()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),iv);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/iv);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${iv}ms, refresh threshold is ${pO} ticks`),s<=pO&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof kY)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fd()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,i]=await Fx(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});s.push(l.toString())}if(n?.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;return o?{data:null,error:o}:await hs(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)return{data:null,error:i};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:d}=await hs(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&c.type==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{data:null,error:o};const i=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?dwe(t.webauthn.credential_response):uwe(t.webauthn.credential_response)})}:{code:t.code}),{data:l,error:c}=await hs(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:i,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:c})})}catch(r){if(Ha(r))return{data:null,error:r};throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return{data:null,error:o};const i=await hs(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});if(i.error)return i;const{data:l}=i;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:lwe(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:cwe(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(Ha(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const o of(t=r?.factors)!==null&&t!==void 0?t:[])s.all.push(o),o.status==="verified"&&s[o.factor_type].push(o);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var r,n;const{data:{session:s},error:o}=t;if(o)return{data:null,error:o};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=oE(s.access_token);let l=null;i.aal&&(l=i.aal);let c=l;((n=(r=s.user.factors)===null||r===void 0?void 0:r.filter(f=>f.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=i.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(l=>l.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(l=>l.kid===t),n&&this.jwks_cached_at+vbe>s)return n;const{data:o,error:i}=await hs(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(l=>l.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:m,error:x}=await this.getSession();if(x||!m.session)return{data:null,error:x};n=m.session.access_token}const{header:s,payload:o,signature:i,raw:{header:l,payload:c}}=oE(n);r?.allowExpired||Bbe(o.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!d){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:o,header:s,signature:i},error:null}}const u=qbe(s.alg),f=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,f,i,Abe(`${l}.${c}`)))throw new vO("Invalid JWT signature");return{data:{claims:o,header:s,signature:i},error:null}}catch(n){if(Ha(n))return{data:null,error:n};throw n}}}qw.nextInstanceID=0;const bwe=qw;class wwe extends bwe{constructor(t){super(t)}}var jwe=globalThis&&globalThis.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(f){i(f)}}function c(u){try{d(n.throw(u))}catch(f){i(f)}}function d(u){u.done?o(u.value):s(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class _we{constructor(t,r,n){var s,o,i;this.supabaseUrl=t,this.supabaseKey=r;const l=mbe(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:nbe,realtime:sbe,auth:Object.assign(Object.assign({},abe),{storageKey:c}),global:rbe},u=fbe(n??{},d);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=u.global.headers)!==null&&o!==void 0?o:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=u.auth)!==null&&i!==void 0?i:{},this.headers,u.global.fetch),this.fetch=cbe(r,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new yye(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Zye(this.storageUrl.href,this.headers,this.fetch,n?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new J0e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return jwe(this,void 0,void 0,function*(){var t,r;if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,storageKey:i,flowType:l,lock:c,debug:d},u,f){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new wwe({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,flowType:l,lock:c,debug:d,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Rye(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Nwe=(e,t,r)=>new _we(e,t,r);function Swe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}Swe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Cwe="https://dlfryxtyxqoacuunswuc.supabase.co",Awe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY";function YD(){try{if(typeof window<"u"&&window.__SUPABASE_URL)return window.__SUPABASE_URL}catch{}return Cwe}function DY(){try{if(typeof window<"u"&&window.__SUPABASE_KEY)return window.__SUPABASE_KEY}catch{}return Awe}function Pwe(){try{return(new URL(YD()).host||"").split(".")[0]||""}catch{return""}}function Ewe(){const e=Pwe();return e?`sb-${e}-auth-token`:"sb-auth-token"}async function kwe(){try{const e=localStorage.getItem("custom-auth-token");if(e&&e.trim())return e.trim()}catch{}try{if(typeof ep<"u"&&ep?.auth?.getSession){const e=new Promise((s,o)=>setTimeout(()=>o(new Error("getSession timeout")),1e3)),t=ep.auth.getSession(),{data:r}=await Promise.race([t,e]),n=r?.session?.access_token;if(n)return console.debug("[Supabase Wrapper] Token obtido via getSession"),n}}catch(e){console.debug("[Supabase Wrapper] getSession falhou ou timeout:",e.message)}try{const e=Ewe(),t=localStorage.getItem(e);if(t){const r=JSON.parse(t);if(r?.access_token)return console.debug("[Supabase Wrapper] Token obtido via localStorage"),r.access_token;if(r?.currentSession?.access_token)return console.debug("[Supabase Wrapper] Token obtido via localStorage (currentSession)"),r.currentSession.access_token}}catch(e){console.warn("[Supabase Wrapper] Erro ao ler localStorage:",e)}return console.warn("[Supabase Wrapper]  Nenhum token encontrado - usando anon key"),null}const Iwe=e=>{const t=new URLSearchParams;return Object.entries(e).forEach(([r,n])=>{n!=null&&(Array.isArray(n)?n.forEach(s=>t.append(r,String(s))):t.append(r,String(n)))}),t.toString()},MY=async(e,t={})=>{const{method:r="GET",body:n,headers:s={},params:o={},signal:i,timeoutMs:l=2e4}=t,c=Iwe(o),u=`${YD()}/rest/v1/${e}${c?`?${c}`:""}`,h={apikey:DY(),"Content-Type":"application/json",Prefer:"return=representation",...s};try{const _=await kwe();_&&(h.Authorization=`Bearer ${_}`)}catch(_){console.warn("[Supabase Wrapper] Erro ao obter token de sesso:",_)}const m={method:r,headers:h};n&&(m.body=JSON.stringify(n)),i&&(m.signal=i);const x=new AbortController,g=setTimeout(()=>{console.warn(`[Supabase Wrapper]  Timeout (${l}ms) para ${e}`);try{x.abort("timeout")}catch{}},Math.max(5e3,l)),v=(()=>{if(!i)return x.signal;try{i.addEventListener("abort",()=>{try{x.abort("upstream-abort")}catch{}})}catch{}return x.signal})();m.signal=v;const y=Date.now();let b;try{b=await fetch(u,m)}finally{clearTimeout(g)}if(!b.ok){let _="";try{_=await b.text()}catch{}const C=Date.now()-y;let E=!1;try{const S=JSON.parse(_);E=b.status===401&&(S?.code==="PGRST303"||/jwt expired/i.test(S?.message||""))}catch{}if(E){try{window.dispatchEvent(new CustomEvent("auth:jwt-expired"))}catch{}try{localStorage.removeItem("custom-auth-token"),Object.keys(localStorage).filter(S=>S.startsWith("sb-")).forEach(S=>localStorage.removeItem(S)),Object.keys(sessionStorage).filter(S=>S.startsWith("sb-")).forEach(S=>sessionStorage.removeItem(S)),sessionStorage.setItem("auth:forceLogout","1"),window.location.replace("/")}catch{}}throw new Error(`[Supabase Wrapper] HTTP ${b.status} (${C}ms) - ${_||"unknown error"}`)}const w=Date.now()-y;let j;try{j=await b.json()}catch(_){throw console.error(`[Supabase Wrapper] Erro ao parsear JSON de ${e}:`,_),new Error(`[Supabase Wrapper] JSON parse error: ${_.message}`)}return w>3e3?console.warn(`[Supabase Wrapper]  fetch ${e} LENTO (${w}ms)`):console.debug(`[Supabase Wrapper] fetch ${e} OK (${w}ms)`),{data:j,error:null}};class Owe{constructor(t){this.table=t,this.params={},this.multiFilters={},this.selectColumns="*",this.signal=null}select(t="*"){return this.selectColumns=t,this.params.select=t,this}eq(t,r){return this._addFilter(t,`eq.${r}`),this}neq(t,r){return this.params[t]=`neq.${r}`,this}gt(t,r){return this.params[t]=`gt.${r}`,this}gte(t,r){return this._addFilter(t,`gte.${r}`),this}lt(t,r){return this.params[t]=`lt.${r}`,this}lte(t,r){return this._addFilter(t,`lte.${r}`),this}like(t,r){return this.params[t]=`like.${r}`,this}ilike(t,r){return this.params[t]=`ilike.${r}`,this}is(t,r){return this.params[t]=`is.${r}`,this}in(t,r){return this.params[t]=`in.(${r.join(",")})`,this}not(t,r,n){return this.params[t]=`not.${r}.${n}`,this}or(t){return this.params.or=`(${t})`,this}contains(t,r){return this.params[t]=`cs.{${r}}`,this}containedBy(t,r){return this.params[t]=`cd.{${r}}`,this}filter(t,r,n){return this._addFilter(t,`${r}.${n}`),this}order(t,r={}){const n=r.ascending===!1?"desc":"asc";return this.params.order=`${t}.${n}`,this}limit(t){return this.params.limit=t,this}range(t,r){return this.params.offset=t,this.params.limit=r-t+1,this}single(){return this.params.limit=1,this.isSingle=!0,this}maybeSingle(){return this.params.limit=1,this.isMaybeSingle=!0,this}abortSignal(t){return this.signal=t,this}_addFilter(t,r){this.multiFilters[t]||(this.multiFilters[t]=[]),this.multiFilters[t].push(r)}async then(t,r){try{const n={...this.params};Object.entries(this.multiFilters).forEach(([o,i])=>{i.length===1?n[o]=i[0]:i.length>1&&(n[o]=i)});const s=await MY(this.table,{method:"GET",params:n,signal:this.signal});this.isSingle&&s.data&&(s.data=s.data[0]||null),this.isMaybeSingle&&s.data&&(s.data=s.data[0]||null),t(s)}catch(n){r(n)}}}class Twe extends Owe{insert(t){return this.method="POST",this.body=Array.isArray(t)?t:[t],this}update(t){return this.method="PATCH",this.body=t,this}upsert(t,r={}){this.method="POST",this.body=Array.isArray(t)?t:[t];const n=r.ignoreDuplicates?"resolution=ignore-duplicates":"resolution=merge-duplicates",s=r.returning==="minimal"?"return=minimal":"return=representation";return this.headers={...this.headers||{},Prefer:`${n},${s}`},r.onConflict&&(this.params.on_conflict=r.onConflict),this}delete(){return this.method="DELETE",this}async then(t,r){try{const n={...this.params};Object.entries(this.multiFilters).forEach(([o,i])=>{i.length===1?n[o]=i[0]:i.length>1&&(n[o]=i)});const s=await MY(this.table,{method:this.method||"GET",body:this.body,params:n,signal:this.signal,headers:this.headers||{}});this.isSingle&&s.data&&(s.data=s.data[0]||null),this.isMaybeSingle&&s.data&&(s.data=s.data[0]||null),t(s)}catch(n){r(n)}}}const ep={from(e){return new Twe(e)},auth:null,supabaseUrl:YD(),supabaseKey:DY()};typeof window<"u"&&ep.from("empresas").select("id").limit(1).then(({data:e,error:t})=>{t&&console.error("[Supabase Wrapper]  ERRO:",t)}).catch(e=>{console.error("[Supabase Wrapper]  EXCEPTION:",e)});const c8="main";let Wv,Hb;try{const e=Object.assign({"./backendTargets.js":U0e,"./backendTargets.local.js":H0e}),t=e["./backendTargets.js"]||null,r=e["./backendTargets.local.js"]||null;t?.TARGETS&&(Hb=t.TARGETS),t?.ACTIVE_TARGET&&(Wv=t.ACTIVE_TARGET),r?.TARGETS&&(Hb=r.TARGETS),r?.ACTIVE_TARGET&&(Wv=r.ACTIVE_TARGET)}catch{}let du=Hb&&Wv&&Hb[Wv]?Hb[Wv]:null,JD=Wv;!du&&c8&&(JD=c8);let Fc=du&&du.supabaseUrl&&du.supabaseUrl.trim()?du.supabaseUrl:"",Lc=du&&du.supabaseAnonKey&&du.supabaseAnonKey.trim()?du.supabaseAnonKey:"";if(!Fc||!Lc){const e=(JD||"dev").toLowerCase(),t=e==="main"?{}.VITE_SUPABASE_URL_MAIN:{}.VITE_SUPABASE_URL_DEV,r=e==="main"?{}.VITE_SUPABASE_ANON_KEY_MAIN:{}.VITE_SUPABASE_ANON_KEY_DEV;Fc=Fc&&Fc.trim()?Fc:t,Lc=Lc&&Lc.trim()?Lc:r}(!Fc||!Lc)&&(Fc=Fc||"https://dlfryxtyxqoacuunswuc.supabase.co",Lc=Lc||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY");try{try{const e=JD||"dev";console.log(`[Target] Branch ativa: ${e}`);try{typeof window<"u"&&(window.__ACTIVE_TARGET=e)}catch{}const t=!!du&&!!(du.supabaseUrl||"").trim()&&!!(du.supabaseAnonKey||"").trim(),r=!t&&(!!{}.VITE_SUPABASE_URL_DEV||!!{}.VITE_SUPABASE_URL_MAIN);console.info(`[Supabase] Backend target mode: ${t?"static config":r?"per-target env":"generic env"}`)}catch{}}catch{}if(!Fc||!Lc)throw console.error("[Supabase]  ERRO CRTICO: Variveis de ambiente ausentes!"),new Error("Supabase: Variveis de ambiente no configuradas!");const yO=Fc,bO=Lc,$u=Nwe(Fc,Lc,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:typeof window<"u"?window.localStorage:void 0},global:{headers:{"X-Client-Info":"fluxo7arena-web",apikey:Lc}}});try{typeof window<"u"&&ep&&(ep.auth=$u.auth)}catch{}const Q={from:e=>ep.from(e),auth:$u.auth,storage:$u.storage,functions:$u.functions,rpc:(...e)=>$u.rpc(...e),realtime:$u.realtime,channel:(...e)=>$u.channel(...e),removeChannel:(...e)=>$u.removeChannel(...e),removeAllChannels:()=>$u.removeAllChannels(),getChannels:()=>$u.getChannels(),supabaseUrl:Fc,supabaseKey:Lc};if(typeof window<"u"){window.__supabase=Q,window.__supabase_original=$u,window.__supabase_wrapper=ep;try{window.__SUPABASE_URL=Fc}catch{}try{window.__SUPABASE_KEY=Lc}catch{}}try{if(typeof window<"u"){const e=()=>{try{const t=localStorage.getItem("custom-auth-token");if(t&&t.trim()){Q.realtime.setAuth(t.trim());return}let r="";try{r=(new URL(Fc).host||"").split(".")[0]||""}catch{}const n=r?`sb-${r}-auth-token`:"sb-auth-token",s=localStorage.getItem(n);if(s){const o=JSON.parse(s),i=o?.access_token||o?.currentSession?.access_token;i&&Q.realtime.setAuth(i)}}catch{}};e();try{window.addEventListener("storage",t=>{try{const r=t?.key||"";(r==="custom-auth-token"||r.startsWith("sb-"))&&e()}catch{}})}catch{}}}catch{}const RY=p.createContext({}),lo=()=>{const e=p.useContext(RY);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Dwe=({children:e})=>{const[t,r]=p.useState(null),[n,s]=p.useState(null),[o,i]=p.useState(null),[l,c]=p.useState(!0),[d,u]=p.useState(!1),f=p.useRef(null),h=p.useRef(!1),m=(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}})();p.useEffect(()=>{if((()=>{try{return sessionStorage.getItem("auth:forceLogout")==="1"}catch{return!1}})()){try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company")}catch{}r(null),s(null),i(null),u(!0),c(!1);try{sessionStorage.removeItem("auth:forceLogout")}catch{}try{Q.auth.signOut({scope:"global"}).catch(()=>{})}catch{}return}try{const S=localStorage.getItem("auth:userProfile"),A=localStorage.getItem("auth:company");S&&s(JSON.parse(S)),A&&i(JSON.parse(A)),(S||A)&&u(!0)}catch(S){console.warn("AuthContext: falha ao hidratar cache local:",S)}(async()=>{try{if(m)try{const M=localStorage.getItem("custom-auth-token");if(M&&M.trim()){const I=JSON.parse(atob(M.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")))?.sub||null;if(I){r({id:I}),u(!0),await x(I),f.current=I,c(!1);return}}}catch{}const{data:{session:S},error:A}=await Q.auth.getSession();A&&console.error("supabase.auth.getSession error:",A),S?.user?(r(S.user),u(!0),await x(S.user.id),f.current=S.user.id):u(!0)}catch(S){console.error("getSession exception:",S)}finally{c(!1)}})();const{data:C}=Q.auth.onAuthStateChange(async(S,A)=>{console.log("[AuthContext] onAuthStateChange",{event:S,userId:A?.user?.id||null});try{if(S==="SIGNED_OUT"){try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company")}catch{}r(null),s(null),i(null),f.current=null,h.current=!1,c(!1),u(!0);return}if(m){u(!0),c(!1);return}const M=A?.user||null;r(M),u(!0),M?.id&&(await x(M.id),f.current=M.id,c(!1))}catch(M){console.error("onAuthStateChange handler error:",M),c(!1),u(!0)}}),E=setTimeout(()=>{c(S=>S&&!1),u(S=>S||!0)},12e3);return()=>{clearTimeout(E),C.subscription.unsubscribe()}},[]),p.useEffect(()=>{(async()=>{try{if(!d||!t)return;const _=!n,C=!!n&&!o&&!!n.codigo_empresa;(_||C)&&(await x(t.id),f.current=t.id)}catch{}})()},[d,t?.id,!!n,n?.codigo_empresa,!!o]),p.useEffect(()=>{const j=()=>{try{const E=localStorage.getItem("auth:userProfile"),S=localStorage.getItem("auth:company");if(E){const A=JSON.parse(E);(!n||!n.codigo_empresa)&&s(A)}if(S){const A=JSON.parse(S);(!o||!o.codigo_empresa)&&i(A)}}catch{}},_=()=>{j(),t?.id&&x(t.id).catch(()=>{})},C=()=>{document.visibilityState==="visible"&&_()};return window.addEventListener("focus",_),document.addEventListener("visibilitychange",C),()=>{window.removeEventListener("focus",_),document.removeEventListener("visibilitychange",C)}},[t?.id]);const x=async j=>{if(h.current){console.log("[AuthDebug] loadUserProfile:skip (already running)");return}h.current=!0;try{const _=[300,800,1600,3e3],C=A=>new Promise(M=>setTimeout(M,A)),E=async(A,M)=>{let O;try{const I=new Promise(k=>{O=setTimeout(()=>k({__timeout:!0}),M)});return await Promise.race([A,I])}finally{clearTimeout(O)}},S=1200;for(let A=0;A<=_.length;A++){console.log("[AuthDebug] loadUserProfile:start",{userId:j,attempt:A});try{console.log("[AuthDebug] querying colaboradores",{userId:j});const M=Q.from("colaboradores").select("*").eq("id",j).single(),O=await E(M,S);if(O&&O.__timeout){console.warn("[AuthDebug] colaboradores:timeout, using usuarios fallback (inline)");try{console.log("[AuthDebug] fallback-inline: querying usuarios by id");const{data:k,error:q}=await Q.from("usuarios").select("*").eq("id",j).maybeSingle();if(!q&&k){let B=null;if(k.codigo_empresa){console.log("[AuthDebug] fallback-inline: querying empresas by codigo",{codigo_empresa:k.codigo_empresa});const{data:F,error:V}=await Q.from("empresas").select("*").eq("codigo_empresa",k.codigo_empresa).single();V?console.warn("[AuthDebug] fallback-inline: empresa error",{status:V.status,code:V.code,message:V.message}):(B=F,console.log("[AuthDebug] fallback-inline: empresa loaded"))}const z={id:j,nome:k.nome||null,cargo:k.papel||"user",codigo_empresa:k.codigo_empresa||null,_source:"usuarios"};s(z);try{localStorage.setItem("auth:userProfile",JSON.stringify(z))}catch{}if(B){i(B);try{localStorage.setItem("auth:company",JSON.stringify(B))}catch{}console.log("[AuthDebug] fallback-inline: set company from usuarios path")}else console.warn("[AuthDebug] fallback-inline: no company resolved; preserving previous company");return}q&&console.warn("[AuthDebug] fallback-inline: usuarios error",{status:q.status,code:q.code,message:q.message})}catch(k){console.warn("[AuthDebug] fallback-inline: unexpected error",k?.message||k)}if(A<_.length){await C(_[A]);continue}return}const{data:I,error:T}=O||{};if(console.log("[AuthDebug] colaboradores:success",{hasProfile:!!I,codigo_empresa:I?.codigo_empresa||null}),T){if(console.warn("[AuthDebug] colaboradores:error",{code:T.code,status:T.status,message:T.message}),T.code==="42P17"){if(A<_.length){await C(_[A]);continue}console.warn("RLS recursion (42P17) persistente ao carregar perfil. Prosseguindo sem alterar cache.");return}if([401,403].includes(Number(T.status))&&(console.warn("[AuthDebug] Erro de autorizao detectado, tentando fallback"),A<_.length)){await C(_[A]);continue}if(T.code==="PGRST116"){try{console.log("[AuthDebug] fallback: querying usuarios by id");const{data:q,error:B}=await Q.from("usuarios").select("*").eq("id",j).maybeSingle();if(!B&&q){let z=null;if(q.codigo_empresa){console.log("[AuthDebug] fallback: querying empresas by codigo",{codigo_empresa:q.codigo_empresa});const{data:V,error:me}=await Q.from("empresas").select("*").eq("codigo_empresa",q.codigo_empresa).single();me?console.warn("[AuthDebug] fallback: empresa error",{status:me.status,code:me.code,message:me.message}):(z=V,console.log("[AuthDebug] fallback: empresa loaded"))}const F={id:j,nome:q.nome||null,cargo:q.papel||"user",codigo_empresa:q.codigo_empresa||null,_source:"usuarios"};s(F);try{localStorage.setItem("auth:userProfile",JSON.stringify(F))}catch{}if(z){i(z);try{localStorage.setItem("auth:company",JSON.stringify(z))}catch{}console.log("[AuthDebug] fallback: set company from usuarios path")}else console.warn("[AuthDebug] fallback: no company resolved; preserving previous company");return}B&&console.warn("[AuthDebug] fallback: usuarios error",{status:B.status,code:B.code,message:B.message})}catch{}console.warn("AuthContext: perfil no encontrado (PGRST116) e fallback falhou; mantendo cache atual.");return}if([401,403,406].includes(Number(T.status))&&A<_.length){await C(_[A]);continue}throw T}if(!I){if(A<_.length){await C(_[A]);continue}return}s(I);try{localStorage.setItem("auth:userProfile",JSON.stringify(I))}catch{}if(I?.codigo_empresa){console.log("[AuthDebug] company: querying empresas by codigo from colaboradores",{codigo_empresa:I.codigo_empresa});const{data:k,error:q}=await Q.from("empresas").select("*").eq("codigo_empresa",I.codigo_empresa).single();if(q){if([401,403,406].includes(Number(q.status))&&A<_.length){await C(_[A]);continue}console.warn("[AuthDebug] company: load error; preserving previous company",{status:q.status,code:q.code,message:q.message});return}else{i(k);try{localStorage.setItem("auth:company",JSON.stringify(k))}catch{}console.log("[AuthDebug] company: set from colaboradores path")}}else console.warn("[AuthDebug] company: no codigo_empresa available on profile; preserving previous company");return}catch(M){if(console.error("[AuthDebug] loadUserProfile:unexpected error",{message:M?.message,code:M?.code,status:M?.status}),A<_.length){await C(_[A]);continue}console.error("Error loading user profile:",M);return}}}finally{h.current=!1}},w={user:t,userProfile:n,company:o,loading:l,authReady:d,signUp:async(j,_,C,E=null)=>{try{const{data:S,error:A}=await Q.auth.signUp({email:j,password:_});if(A)throw A;if(S?.user&&E){const{data:M,error:O}=await Q.from("empresas").select("id, codigo_empresa").eq("codigo_empresa",E).single();if(O)throw new Error("Cdigo de empresa invlido. Verifique o cdigo informado.");const{error:I}=await Q.from("colaboradores").insert({id:S.user.id,codigo_empresa:M.codigo_empresa,nome:C,cargo:"user",ativo:!0});if(I)throw I}return{data:S,error:null}}catch(S){let A="No foi possvel cadastrar. Verifique os dados e tente novamente.";const M=(S?.message||"").toLowerCase();return M.includes("user already registered")||M.includes("already registered")||M.includes("user already exists")?A="Email j cadastrado. Tente entrar ou redefinir a senha.":M.includes("password")&&M.includes("length")&&(A="Senha muito curta. Use ao menos 6 caracteres."),{data:null,error:new Error(A)}}},signIn:async(j,_)=>{try{if(m){const S=yO,A=bO,M=await fetch(`${S}/rest/v1/rpc/auth_login_dev`,{method:"POST",headers:{"Content-Type":"application/json",apikey:A,Authorization:`Bearer ${A}`},body:JSON.stringify({p_email:j,p_password:_})});if(!M.ok){const k=await M.text().catch(()=>"");let q="No foi possvel entrar. Tente novamente.";return M.status===401&&(q="Email ou senha invlidos."),M.status===423&&(q="Usurio bloqueado temporariamente."),{data:null,error:new Error(q+(k?` (${k})`:""))}}const I=(await M.json())?.access_token||"",T=(()=>{try{return JSON.parse(atob(I.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))).sub}catch{return null}})();try{localStorage.setItem("custom-auth-token",I)}catch{}return T&&(r({id:T}),u(!0),await x(T),f.current=T),{data:{user:T?{id:T}:null},error:null}}const{data:C,error:E}=await Q.auth.signInWithPassword({email:j,password:_});if(E){let S="No foi possvel entrar. Tente novamente.";const A=(E.message||"").toLowerCase(),M=E.status;return A.includes("invalid login")||A.includes("invalid credentials")||M===400?S="Email ou senha invlidos.":A.includes("email not confirmed")||A.includes("not confirmed")?S="Email no confirmado. Verifique sua caixa de entrada.":M===429?S="Muitas tentativas. Aguarde alguns minutos e tente novamente.":M>=500&&(S="Servio indisponvel no momento. Tente novamente mais tarde."),{data:null,error:new Error(S)}}return C.user&&await Q.from("colaboradores").select("id").eq("id",C.user.id).single(),{data:C,error:null}}catch(C){return{data:null,error:C}}},signOut:async()=>{try{localStorage.removeItem("custom-auth-token")}catch{}try{const j=Q.auth.signOut({scope:"global"}),_=new Promise(C=>setTimeout(C,700));await Promise.race([j,_])}catch(j){console.warn("[AuthContext] signOut(): error during signOut",j?.message||j)}f.current=null,r(null),s(null),i(null),c(!1),u(!0);try{localStorage.removeItem("auth:userProfile"),localStorage.removeItem("auth:company"),localStorage.removeItem("clientes:list"),localStorage.removeItem("quadras:list"),localStorage.removeItem("agenda:courts"),localStorage.removeItem("agenda:selectedCourts"),localStorage.removeItem("agenda:viewFilter"),Object.keys(localStorage).filter(j=>j.startsWith("agenda:bookings:")).forEach(j=>localStorage.removeItem(j)),Object.keys(localStorage).filter(j=>j.startsWith("sb-")).forEach(j=>localStorage.removeItem(j)),Object.keys(sessionStorage).filter(j=>j.startsWith("sb-")).forEach(j=>sessionStorage.removeItem(j))}catch{}try{sessionStorage.setItem("auth:forceLogout","1")}catch{}try{window.location.replace("/")}catch{}return{error:null}},reloadCompany:async()=>{try{const j=n&&n.codigo_empresa?n.codigo_empresa:null;if(!j)return;const{data:_,error:C}=await Q.from("empresas").select("*").eq("codigo_empresa",j).single();if(!C&&_){i(_);try{localStorage.setItem("auth:company",JSON.stringify(_))}catch{}}}catch{}}};return a.jsx(RY.Provider,{value:w,children:e})};function Ms(e){"@babel/helpers - typeof";return Ms=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ms(e)}function hi(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Da(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function cs(e){Da(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||Ms(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Es(e,t){Da(2,arguments);var r=cs(e),n=hi(t);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function lf(e,t){Da(2,arguments);var r=cs(e),n=hi(t);if(isNaN(n))return new Date(NaN);if(!n)return r;var s=r.getDate(),o=new Date(r.getTime());o.setMonth(r.getMonth()+n+1,0);var i=o.getDate();return s>=i?o:(r.setFullYear(o.getFullYear(),o.getMonth(),s),r)}function FY(e,t){Da(2,arguments);var r=cs(e).getTime(),n=hi(t);return new Date(r+n)}var Mwe={};function kp(){return Mwe}function wu(e,t){var r,n,s,o,i,l,c,d;Da(1,arguments);var u=kp(),f=hi((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=cs(e),m=h.getDay(),x=(m<f?7:0)+m-f;return h.setDate(h.getDate()-x),h.setHours(0,0,0,0),h}function Qg(e){return Da(1,arguments),wu(e,{weekStartsOn:1})}function Rwe(e){Da(1,arguments);var t=cs(e),r=t.getFullYear(),n=new Date(0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);var s=Qg(n),o=new Date(0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);var i=Qg(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=i.getTime()?r:r-1}function Fwe(e){Da(1,arguments);var t=Rwe(e),r=new Date(0);r.setFullYear(t,0,4),r.setHours(0,0,0,0);var n=Qg(r);return n}function zw(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Po(e){Da(1,arguments);var t=cs(e);return t.setHours(0,0,0,0),t}var Lwe=864e5;function Of(e,t){Da(2,arguments);var r=Po(e),n=Po(t),s=r.getTime()-zw(r),o=n.getTime()-zw(n);return Math.round((s-o)/Lwe)}var $we=6e4;function d8(e,t){Da(2,arguments);var r=hi(t);return FY(e,r*$we)}function wO(e,t){Da(2,arguments);var r=hi(t),n=r*7;return Es(e,n)}function Bwe(e,t){Da(2,arguments);var r=hi(t);return lf(e,r*12)}function qwe(e){Da(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(Ms(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var r;return t.forEach(function(n){var s=cs(n);(r===void 0||r<s||isNaN(Number(s)))&&(r=s)}),r||new Date(NaN)}function zwe(e){Da(1,arguments);var t;if(e&&typeof e.forEach=="function")t=e;else if(Ms(e)==="object"&&e!==null)t=Array.prototype.slice.call(e);else return new Date(NaN);var r;return t.forEach(function(n){var s=cs(n);(r===void 0||r>s||isNaN(s.getDate()))&&(r=s)}),r||new Date(NaN)}var LY=6e4,$Y=36e5;function Kl(e,t){Da(2,arguments);var r=Po(e),n=Po(t);return r.getTime()===n.getTime()}function QD(e){return Da(1,arguments),e instanceof Date||Ms(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Uwe(e){if(Da(1,arguments),!QD(e)&&typeof e!="number")return!1;var t=cs(e);return!isNaN(Number(t))}function Uw(e,t){Da(2,arguments);var r=cs(e),n=cs(t),s=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return s*12+o}var Vwe=6048e5;function Wwe(e,t,r){Da(2,arguments);var n=wu(e,r),s=wu(t,r),o=n.getTime()-zw(n),i=s.getTime()-zw(s);return Math.round((o-i)/Vwe)}function u8(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function Hwe(e,t){Da(2,arguments);var r=cs(e),n=cs(t),s=u8(r,n),o=Math.abs(Of(r,n));r.setDate(r.getDate()-s*o);var i=+(u8(r,n)===-s),l=s*(o-i);return l===0?0:l}function M2(e){Da(1,arguments);var t=cs(e);return t.setHours(23,59,59,999),t}function h5(e){Da(1,arguments);var t=cs(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function wc(e){Da(1,arguments);var t=cs(e);return t.setDate(1),t.setHours(0,0,0,0),t}function Gwe(e){Da(1,arguments);var t=cs(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function ZD(e,t){var r,n,s,o,i,l,c,d;Da(1,arguments);var u=kp(),f=hi((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=cs(e),m=h.getDay(),x=(m<f?-7:0)+6-(m-f);return h.setDate(h.getDate()+x),h.setHours(23,59,59,999),h}function BY(e){return Da(1,arguments),ZD(e,{weekStartsOn:1})}function Kwe(e,t){Da(2,arguments);var r=hi(t);return FY(e,-r)}var Xwe=864e5;function Ywe(e){Da(1,arguments);var t=cs(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=t.getTime(),s=r-n;return Math.floor(s/Xwe)+1}function $N(e){Da(1,arguments);var t=1,r=cs(e),n=r.getUTCDay(),s=(n<t?7:0)+n-t;return r.setUTCDate(r.getUTCDate()-s),r.setUTCHours(0,0,0,0),r}function qY(e){Da(1,arguments);var t=cs(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var s=$N(n),o=new Date(0);o.setUTCFullYear(r,0,4),o.setUTCHours(0,0,0,0);var i=$N(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=i.getTime()?r:r-1}function Jwe(e){Da(1,arguments);var t=qY(e),r=new Date(0);r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0);var n=$N(r);return n}var Qwe=6048e5;function Zwe(e){Da(1,arguments);var t=cs(e),r=$N(t).getTime()-Jwe(t).getTime();return Math.round(r/Qwe)+1}function BN(e,t){var r,n,s,o,i,l,c,d;Da(1,arguments);var u=kp(),f=hi((r=(n=(s=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=cs(e),m=h.getUTCDay(),x=(m<f?7:0)+m-f;return h.setUTCDate(h.getUTCDate()-x),h.setUTCHours(0,0,0,0),h}function zY(e,t){var r,n,s,o,i,l,c,d;Da(1,arguments);var u=cs(e),f=u.getUTCFullYear(),h=kp(),m=hi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setUTCFullYear(f+1,0,m),x.setUTCHours(0,0,0,0);var g=BN(x,t),v=new Date(0);v.setUTCFullYear(f,0,m),v.setUTCHours(0,0,0,0);var y=BN(v,t);return u.getTime()>=g.getTime()?f+1:u.getTime()>=y.getTime()?f:f-1}function e1e(e,t){var r,n,s,o,i,l,c,d;Da(1,arguments);var u=kp(),f=hi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:u.firstWeekContainsDate)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=zY(e,t),m=new Date(0);m.setUTCFullYear(h,0,f),m.setUTCHours(0,0,0,0);var x=BN(m,t);return x}var t1e=6048e5;function r1e(e,t){Da(1,arguments);var r=cs(e),n=BN(r,t).getTime()-e1e(r,t).getTime();return Math.round(n/t1e)+1}function mo(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var n1e={y:function(t,r){var n=t.getUTCFullYear(),s=n>0?n:1-n;return mo(r==="yy"?s%100:s,r.length)},M:function(t,r){var n=t.getUTCMonth();return r==="M"?String(n+1):mo(n+1,2)},d:function(t,r){return mo(t.getUTCDate(),r.length)},a:function(t,r){var n=t.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(t,r){return mo(t.getUTCHours()%12||12,r.length)},H:function(t,r){return mo(t.getUTCHours(),r.length)},m:function(t,r){return mo(t.getUTCMinutes(),r.length)},s:function(t,r){return mo(t.getUTCSeconds(),r.length)},S:function(t,r){var n=r.length,s=t.getUTCMilliseconds(),o=Math.floor(s*Math.pow(10,n-3));return mo(o,r.length)}};const lh=n1e;var qx={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},a1e={G:function(t,r,n){var s=t.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){var s=t.getUTCFullYear(),o=s>0?s:1-s;return n.ordinalNumber(o,{unit:"year"})}return lh.y(t,r)},Y:function(t,r,n,s){var o=zY(t,s),i=o>0?o:1-o;if(r==="YY"){var l=i%100;return mo(l,2)}return r==="Yo"?n.ordinalNumber(i,{unit:"year"}):mo(i,r.length)},R:function(t,r){var n=qY(t);return mo(n,r.length)},u:function(t,r){var n=t.getUTCFullYear();return mo(n,r.length)},Q:function(t,r,n){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"Q":return String(s);case"QQ":return mo(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,r,n){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"q":return String(s);case"qq":return mo(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,r,n){var s=t.getUTCMonth();switch(r){case"M":case"MM":return lh.M(t,r);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(t,r,n){var s=t.getUTCMonth();switch(r){case"L":return String(s+1);case"LL":return mo(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(t,r,n,s){var o=r1e(t,s);return r==="wo"?n.ordinalNumber(o,{unit:"week"}):mo(o,r.length)},I:function(t,r,n){var s=Zwe(t);return r==="Io"?n.ordinalNumber(s,{unit:"week"}):mo(s,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):lh.d(t,r)},D:function(t,r,n){var s=Ywe(t);return r==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):mo(s,r.length)},E:function(t,r,n){var s=t.getUTCDay();switch(r){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(t,r,n,s){var o=t.getUTCDay(),i=(o-s.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return mo(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});case"eeee":default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(t,r,n,s){var o=t.getUTCDay(),i=(o-s.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return mo(i,r.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});case"cccc":default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(t,r,n){var s=t.getUTCDay(),o=s===0?7:s;switch(r){case"i":return String(o);case"ii":return mo(o,r.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(t,r,n){var s=t.getUTCHours(),o=s/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(t,r,n){var s=t.getUTCHours(),o;switch(s===12?o=qx.noon:s===0?o=qx.midnight:o=s/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(t,r,n){var s=t.getUTCHours(),o;switch(s>=17?o=qx.evening:s>=12?o=qx.afternoon:s>=4?o=qx.morning:o=qx.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){var s=t.getUTCHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return lh.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):lh.H(t,r)},K:function(t,r,n){var s=t.getUTCHours()%12;return r==="Ko"?n.ordinalNumber(s,{unit:"hour"}):mo(s,r.length)},k:function(t,r,n){var s=t.getUTCHours();return s===0&&(s=24),r==="ko"?n.ordinalNumber(s,{unit:"hour"}):mo(s,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):lh.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):lh.s(t,r)},S:function(t,r){return lh.S(t,r)},X:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();if(i===0)return"Z";switch(r){case"X":return m8(i);case"XXXX":case"XX":return rg(i);case"XXXXX":case"XXX":default:return rg(i,":")}},x:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"x":return m8(i);case"xxxx":case"xx":return rg(i);case"xxxxx":case"xxx":default:return rg(i,":")}},O:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+f8(i,":");case"OOOO":default:return"GMT"+rg(i,":")}},z:function(t,r,n,s){var o=s._originalDate||t,i=o.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+f8(i,":");case"zzzz":default:return"GMT"+rg(i,":")}},t:function(t,r,n,s){var o=s._originalDate||t,i=Math.floor(o.getTime()/1e3);return mo(i,r.length)},T:function(t,r,n,s){var o=s._originalDate||t,i=o.getTime();return mo(i,r.length)}};function f8(e,t){var r=e>0?"-":"+",n=Math.abs(e),s=Math.floor(n/60),o=n%60;if(o===0)return r+String(s);var i=t||"";return r+String(s)+i+mo(o,2)}function m8(e,t){if(e%60===0){var r=e>0?"-":"+";return r+mo(Math.abs(e)/60,2)}return rg(e,t)}function rg(e,t){var r=t||"",n=e>0?"-":"+",s=Math.abs(e),o=mo(Math.floor(s/60),2),i=mo(s%60,2);return n+o+r+i}const s1e=a1e;var h8=function(t,r){switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},UY=function(t,r){switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},o1e=function(t,r){var n=t.match(/(P+)(p+)?/)||[],s=n[1],o=n[2];if(!o)return h8(t,r);var i;switch(s){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;case"PPPP":default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",h8(s,r)).replace("{{time}}",UY(o,r))},i1e={p:UY,P:o1e};const l1e=i1e;var c1e=["D","DD"],d1e=["YY","YYYY"];function u1e(e){return c1e.indexOf(e)!==-1}function f1e(e){return d1e.indexOf(e)!==-1}function p8(e,t,r){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var m1e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},h1e=function(t,r,n){var s,o=m1e[t];return typeof o=="string"?s=o:r===1?s=o.one:s=o.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};const p1e=h1e;function Hv(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth,n=e.formats[r]||e.formats[e.defaultWidth];return n}}var g1e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},x1e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},v1e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},y1e={date:Hv({formats:g1e,defaultWidth:"full"}),time:Hv({formats:x1e,defaultWidth:"full"}),dateTime:Hv({formats:v1e,defaultWidth:"full"})};const b1e=y1e;var w1e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},j1e=function(t,r,n,s){return w1e[t]};const _1e=j1e;function Af(e){return function(t,r){var n=r!=null&&r.context?String(r.context):"standalone",s;if(n==="formatting"&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):o;s=e.formattingValues[i]||e.formattingValues[o]}else{var l=e.defaultWidth,c=r!=null&&r.width?String(r.width):e.defaultWidth;s=e.values[c]||e.values[l]}var d=e.argumentCallback?e.argumentCallback(t):t;return s[d]}}var N1e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},S1e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},C1e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},A1e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},P1e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},E1e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},k1e=function(t,r){var n=Number(t),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},I1e={ordinalNumber:k1e,era:Af({values:N1e,defaultWidth:"wide"}),quarter:Af({values:S1e,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:Af({values:C1e,defaultWidth:"wide"}),day:Af({values:A1e,defaultWidth:"wide"}),dayPeriod:Af({values:P1e,defaultWidth:"wide",formattingValues:E1e,defaultFormattingWidth:"wide"})};const O1e=I1e;function Pf(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(s);if(!o)return null;var i=o[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?D1e(l,function(f){return f.test(i)}):T1e(l,function(f){return f.test(i)}),d;d=e.valueCallback?e.valueCallback(c):c,d=r.valueCallback?r.valueCallback(d):d;var u=t.slice(i.length);return{value:d,rest:u}}}function T1e(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r}function D1e(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r}function VY(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.match(e.matchPattern);if(!n)return null;var s=n[0],o=t.match(e.parsePattern);if(!o)return null;var i=e.valueCallback?e.valueCallback(o[0]):o[0];i=r.valueCallback?r.valueCallback(i):i;var l=t.slice(s.length);return{value:i,rest:l}}}var M1e=/^(\d+)(th|st|nd|rd)?/i,R1e=/\d+/i,F1e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},L1e={any:[/^b/i,/^(a|c)/i]},$1e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},B1e={any:[/1/i,/2/i,/3/i,/4/i]},q1e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},z1e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},U1e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},V1e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},W1e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},H1e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},G1e={ordinalNumber:VY({matchPattern:M1e,parsePattern:R1e,valueCallback:function(t){return parseInt(t,10)}}),era:Pf({matchPatterns:F1e,defaultMatchWidth:"wide",parsePatterns:L1e,defaultParseWidth:"any"}),quarter:Pf({matchPatterns:$1e,defaultMatchWidth:"wide",parsePatterns:B1e,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Pf({matchPatterns:q1e,defaultMatchWidth:"wide",parsePatterns:z1e,defaultParseWidth:"any"}),day:Pf({matchPatterns:U1e,defaultMatchWidth:"wide",parsePatterns:V1e,defaultParseWidth:"any"}),dayPeriod:Pf({matchPatterns:W1e,defaultMatchWidth:"any",parsePatterns:H1e,defaultParseWidth:"any"})};const K1e=G1e;var X1e={code:"en-US",formatDistance:p1e,formatLong:b1e,formatRelative:_1e,localize:O1e,match:K1e,options:{weekStartsOn:0,firstWeekContainsDate:1}};const WY=X1e;var Y1e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,J1e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Q1e=/^'([^]*?)'?$/,Z1e=/''/g,eje=/[a-zA-Z]/;function dr(e,t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w,j;Da(2,arguments);var _=String(t),C=kp(),E=(n=(s=r?.locale)!==null&&s!==void 0?s:C.locale)!==null&&n!==void 0?n:WY,S=hi((o=(i=(l=(c=r?.firstWeekContainsDate)!==null&&c!==void 0?c:r==null||(d=r.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&l!==void 0?l:C.firstWeekContainsDate)!==null&&i!==void 0?i:(f=C.locale)===null||f===void 0||(h=f.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var A=hi((m=(x=(g=(v=r?.weekStartsOn)!==null&&v!==void 0?v:r==null||(y=r.locale)===null||y===void 0||(b=y.options)===null||b===void 0?void 0:b.weekStartsOn)!==null&&g!==void 0?g:C.weekStartsOn)!==null&&x!==void 0?x:(w=C.locale)===null||w===void 0||(j=w.options)===null||j===void 0?void 0:j.weekStartsOn)!==null&&m!==void 0?m:0);if(!(A>=0&&A<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!E.localize)throw new RangeError("locale must contain localize property");if(!E.formatLong)throw new RangeError("locale must contain formatLong property");var M=cs(e);if(!Uwe(M))throw new RangeError("Invalid time value");var O=zw(M),I=Kwe(M,O),T={firstWeekContainsDate:S,weekStartsOn:A,locale:E,_originalDate:M},k=_.match(J1e).map(function(q){var B=q[0];if(B==="p"||B==="P"){var z=l1e[B];return z(q,E.formatLong)}return q}).join("").match(Y1e).map(function(q){if(q==="''")return"'";var B=q[0];if(B==="'")return tje(q);var z=s1e[B];if(z)return!(r!=null&&r.useAdditionalWeekYearTokens)&&f1e(q)&&p8(q,t,String(e)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&u1e(q)&&p8(q,t,String(e)),z(I,q,E.localize,T);if(B.match(eje))throw new RangeError("Format string contains an unescaped latin alphabet character `"+B+"`");return q}).join("");return k}function tje(e){var t=e.match(Q1e);return t?t[1].replace(Z1e,"'"):e}function rje(e){Da(1,arguments);var t=cs(e),r=t.getFullYear(),n=t.getMonth(),s=new Date(0);return s.setFullYear(r,n+1,0),s.setHours(0,0,0,0),s.getDate()}function Wd(e){Da(1,arguments);var t=cs(e),r=t.getHours();return r}var nje=6048e5;function aje(e){Da(1,arguments);var t=cs(e),r=Qg(t).getTime()-Fwe(t).getTime();return Math.round(r/nje)+1}function Hd(e){Da(1,arguments);var t=cs(e),r=t.getMinutes();return r}function sje(e){Da(1,arguments);var t=cs(e),r=t.getTime();return r}function oje(e){return Da(1,arguments),Math.floor(sje(e)/1e3)}function ije(e,t){var r,n,s,o,i,l,c,d;Da(1,arguments);var u=cs(e),f=u.getFullYear(),h=kp(),m=hi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(m>=1&&m<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setFullYear(f+1,0,m),x.setHours(0,0,0,0);var g=wu(x,t),v=new Date(0);v.setFullYear(f,0,m),v.setHours(0,0,0,0);var y=wu(v,t);return u.getTime()>=g.getTime()?f+1:u.getTime()>=y.getTime()?f:f-1}function lje(e,t){var r,n,s,o,i,l,c,d;Da(1,arguments);var u=kp(),f=hi((r=(n=(s=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(i=t.locale)===null||i===void 0||(l=i.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:u.firstWeekContainsDate)!==null&&n!==void 0?n:(c=u.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=ije(e,t),m=new Date(0);m.setFullYear(h,0,f),m.setHours(0,0,0,0);var x=wu(m,t);return x}var cje=6048e5;function dje(e,t){Da(1,arguments);var r=cs(e),n=wu(r,t).getTime()-lje(r,t).getTime();return Math.round(n/cje)+1}function uje(e){Da(1,arguments);var t=cs(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function fje(e,t){return Da(1,arguments),Wwe(uje(e),wc(e),t)+1}function jO(e,t){Da(2,arguments);var r=cs(e),n=cs(t);return r.getTime()>n.getTime()}function HY(e,t){Da(2,arguments);var r=cs(e),n=cs(t);return r.getTime()<n.getTime()}function g8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function mje(e,t){if(e){if(typeof e=="string")return g8(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g8(e,t):void 0}}function _O(e,t){return _O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},_O(e,t)}function hje(e,t){if(Ms(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ms(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pje(e){var t=hje(e,"string");return Ms(t)=="symbol"?t:t+""}function gje(e,t,r){return(t=pje(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eM(e,t){Da(2,arguments);var r=cs(e),n=cs(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function xje(e,t){Da(2,arguments);var r=cs(e),n=cs(t);return r.getFullYear()===n.getFullYear()}function Gv(e,t){Da(2,arguments);var r=hi(t);return Es(e,-r)}function x8(e,t){var r;Da(1,arguments);var n=hi((r=t?.additionalDigits)!==null&&r!==void 0?r:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var s=wje(e),o;if(s.date){var i=jje(s.date,n);o=_je(i.restDateString,i.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var l=o.getTime(),c=0,d;if(s.time&&(c=Nje(s.time),isNaN(c)))return new Date(NaN);if(s.timezone){if(d=Sje(s.timezone),isNaN(d))return new Date(NaN)}else{var u=new Date(l+c),f=new Date(0);return f.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),f.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),f}return new Date(l+c+d)}var C_={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},vje=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,yje=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,bje=/^([+-])(\d{2})(?::?(\d{2}))?$/;function wje(e){var t={},r=e.split(C_.dateTimeDelimiter),n;if(r.length>2)return t;if(/:/.test(r[0])?n=r[0]:(t.date=r[0],n=r[1],C_.timeZoneDelimiter.test(t.date)&&(t.date=e.split(C_.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){var s=C_.timezone.exec(n);s?(t.time=n.replace(s[1],""),t.timezone=s[1]):t.time=n}return t}function jje(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};var s=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?s:o*100,restDateString:e.slice((n[1]||n[2]).length)}}function _je(e,t){if(t===null)return new Date(NaN);var r=e.match(vje);if(!r)return new Date(NaN);var n=!!r[4],s=Xy(r[1]),o=Xy(r[2])-1,i=Xy(r[3]),l=Xy(r[4]),c=Xy(r[5])-1;if(n)return kje(t,l,c)?Cje(t,l,c):new Date(NaN);var d=new Date(0);return!Pje(t,o,i)||!Eje(t,s)?new Date(NaN):(d.setUTCFullYear(t,o,Math.max(s,i)),d)}function Xy(e){return e?parseInt(e):1}function Nje(e){var t=e.match(yje);if(!t)return NaN;var r=cE(t[1]),n=cE(t[2]),s=cE(t[3]);return Ije(r,n,s)?r*$Y+n*LY+s*1e3:NaN}function cE(e){return e&&parseFloat(e.replace(",","."))||0}function Sje(e){if(e==="Z")return 0;var t=e.match(bje);if(!t)return 0;var r=t[1]==="+"?-1:1,n=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return Oje(n,s)?r*(n*$Y+s*LY):NaN}function Cje(e,t,r){var n=new Date(0);n.setUTCFullYear(e,0,4);var s=n.getUTCDay()||7,o=(t-1)*7+r+1-s;return n.setUTCDate(n.getUTCDate()+o),n}var Aje=[31,null,31,30,31,30,31,31,30,31,30,31];function GY(e){return e%400===0||e%4===0&&e%100!==0}function Pje(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(Aje[t]||(GY(e)?29:28))}function Eje(e,t){return t>=1&&t<=(GY(e)?366:365)}function kje(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function Ije(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function Oje(e,t){return t>=0&&t<=59}function dE(e,t){Da(2,arguments);var r=cs(e),n=hi(t),s=r.getFullYear(),o=r.getDate(),i=new Date(0);i.setFullYear(s,n,15),i.setHours(0,0,0,0);var l=rje(i);return r.setMonth(n,Math.min(o,l)),r}function A_(e,t){Da(2,arguments);var r=cs(e),n=hi(t);return r.setHours(n),r}function P_(e,t){Da(2,arguments);var r=cs(e),n=hi(t);return r.setMinutes(n),r}function v8(e,t){Da(2,arguments);var r=cs(e),n=hi(t);return isNaN(r.getTime())?new Date(NaN):(r.setFullYear(n),r)}const KY=p.createContext(),Tje=({children:e})=>{const{userProfile:t}=lo(),r=_i(),[n,s]=p.useState([]),[o,i]=p.useState(!1),[l,c]=p.useState(!1),[d,u]=p.useState(!1),f=p.useRef(r.pathname),h=p.useRef(!1),m=p.useRef(null),[x,g]=p.useState(null),v=p.useRef([]),y=p.useRef(null),b=p.useRef(!1);p.useEffect(()=>{v.current=n},[n]);const w=p.useCallback(()=>`alerts:persisted:isis:${t?.codigo_empresa||"na"}`,[t?.codigo_empresa]),j=p.useCallback(()=>{try{const O=localStorage.getItem(w()),I=O?JSON.parse(O):[];return Array.isArray(I)?I.filter(T=>T&&T.tipo==="isis-event"&&T.id):[]}catch{return[]}},[w]),_=p.useCallback(O=>{try{localStorage.setItem(w(),JSON.stringify(O||[]))}catch{}},[w]),C=p.useCallback(O=>{if(!O)return;s(k=>Array.isArray(k)?k.filter(q=>q?.id!==O):[]);const T=j().filter(k=>k?.id!==O);_(T)},[j,_]),E=p.useCallback(()=>document.querySelectorAll('[role="dialog"]').length>0,[]),S=p.useCallback(async()=>{if(t?.codigo_empresa)try{u(!0);const O=t.codigo_empresa,I=new Date,T=Po(I).toISOString(),k=M2(I).toISOString(),q=[],{data:B}=await Q.from("produtos").select("nome, estoque, estoque_minimo, status").eq("codigo_empresa",O).not("estoque_minimo","is",null),z=(B||[]).filter(G=>{const te=Number(G.estoque||0),oe=Number(G.estoque_minimo||0);return te<=oe&&oe>0});z.length>0&&q.push({tipo:"estoque",icone:"Package",cor:"danger",mensagem:`${z.length} produto${z.length>1?"s":""} com estoque baixo`,link:"/produtos"});const{data:F}=await Q.from("agendamento_participantes").select("id, agendamento_id").eq("codigo_empresa",O).eq("status_pagamento","Pendente");if(F&&F.length>0){const G=[...new Set(F.map(re=>re.agendamento_id))],{data:te}=await Q.from("agendamentos").select("id, inicio, status").in("id",G).not("status","in","(canceled,absent)").order("inicio",{ascending:!0}),oe=new Set((te||[]).map(re=>re.id)),De=F.filter(re=>oe.has(re.agendamento_id));if(De.length>0){const re=te?.[0],ae=dr(re?new Date(re.inicio):I,"yyyy-MM-dd");q.push({tipo:"pagamento",icone:"DollarSign",cor:"warning",mensagem:`${De.length} pagamento${De.length>1?"s":""} pendente${De.length>1?"s":""} em agendamentos`,link:`/agenda?date=${ae}`})}}const V=new Date;V.setHours(V.getHours()-3);const{data:me}=await Q.from("comandas").select("id, aberto_em, status").eq("codigo_empresa",O).eq("status","open").is("fechado_em",null).lte("aberto_em",V.toISOString());me&&me.length>0&&q.push({tipo:"comanda",icone:"Clock",cor:"warning",mensagem:`${me.length} comanda${me.length>1?"s":""} aberta${me.length>1?"s":""} h mais de 3 horas`,link:"/vendas"});const be=new Date;be.setHours(be.getHours()-12);const{data:U}=await Q.from("caixa_sessoes").select("id, aberto_em").eq("codigo_empresa",O).eq("status","open").lte("aberto_em",be.toISOString()).limit(1);U&&U.length>0&&q.push({tipo:"caixa",icone:"ShoppingCart",cor:"danger",mensagem:"Caixa aberto h mais de 12 horas",link:"/vendas"});const{data:L}=await Q.from("mesas").select("id, nome, numero").eq("codigo_empresa",O).eq("status","awaiting-payment");if(L&&L.length>0){const G=L.map(oe=>oe.id),{data:te}=await Q.from("comandas").select("id, mesa_id").eq("codigo_empresa",O).in("mesa_id",G).eq("status","open");if(te&&te.length>0){const oe=te.map(ut=>ut.id),{data:De}=await Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",oe),re={};(De||[]).forEach(ut=>{const pt=(Number(ut.quantidade)||0)*(Number(ut.preco_unitario)||0),ft=Number(ut.desconto)||0,bt=pt-ft;re[ut.comanda_id]=(re[ut.comanda_id]||0)+bt});const ae=Object.values(re).filter(ut=>ut>100).length;ae>0&&q.push({tipo:"mesa",icone:"Store",cor:"info",mensagem:`${ae} mesa${ae>1?"s":""} com saldo alto aguardando pagamento`,link:"/vendas"})}}const{data:H}=await Q.from("clientes").select("id, nome, aniversario").eq("codigo_empresa",O).eq("status","Ativo").not("aniversario","is",null),ie=dr(I,"MM-dd"),Y=(H||[]).filter(G=>G.aniversario?dr(new Date(G.aniversario),"MM-dd")===ie:!1);Y.length>0&&q.push({tipo:"aniversario",icone:"Users",cor:"success",mensagem:` ${Y.length} aniversariante${Y.length>1?"s":""} hoje!`,link:"/clientes"});const W=[];for(let G=1;G<=7;G++){const te=new Date(I);te.setDate(te.getDate()+G),W.push(dr(te,"MM-dd"))}const se=(H||[]).filter(G=>{if(!G.aniversario)return!1;const te=dr(new Date(G.aniversario),"MM-dd");return W.includes(te)});se.length>0&&q.push({tipo:"aniversario-semana",icone:"CalendarPlus",cor:"purple",mensagem:` ${se.length} aniversariante${se.length>1?"s":""} esta semana`,link:"/clientes"});const pe=j();s([...pe,...q]);try{if(!h.current&&!b.current&&q.length>0&&typeof document<"u"&&document.visibilityState==="visible"&&!E()){const te=(()=>{try{return typeof window<"u"&&window.innerWidth<768}catch{return!1}})(),oe=(()=>{try{return!!document.querySelector('button[aria-label="Fechar menu lateral"]')}catch{return!1}})();if(te&&oe){try{y.current&&clearInterval(y.current)}catch{}y.current=setInterval(()=>{try{if(h.current){clearInterval(y.current),y.current=null;return}if(!!!document.querySelector('button[aria-label="Fechar menu lateral"]')&&!E()){c(!0),h.current=!0;try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{c(!1)},3500),clearInterval(y.current),y.current=null}}catch{}},250)}else setTimeout(()=>{if(!h.current){if(E()){h.current=!0;return}c(!0),h.current=!0;try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{c(!1)},3500)}},350)}}catch{}}catch(O){console.error("[AlertsContext] Erro ao carregar alertas:",O)}finally{u(!1)}},[t?.codigo_empresa]);p.useEffect(()=>{if(o){h.current=!0,b.current=!0,c(!1);try{y.current&&(clearInterval(y.current),y.current=null)}catch{}}else c(!1)},[o]),p.useEffect(()=>()=>{try{m.current&&clearTimeout(m.current)}catch{}try{y.current&&clearInterval(y.current)}catch{}},[]);const A=p.useCallback(()=>{try{m.current&&clearTimeout(m.current)}catch{}c(!1),g(null)},[]),M=p.useCallback(()=>{s(O=>Array.isArray(O)?O.filter(I=>I?.tipo!=="isis-event"):[]);try{_([])}catch{}try{A()}catch{}},[_,A]);return p.useEffect(()=>{if(!t?.codigo_empresa)return;const O=t.codigo_empresa,I=Q.channel(`isis-events:${O}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamentos",filter:`codigo_empresa=eq.${O}`},T=>{try{const{eventType:k,new:q,old:B}=T||{};if(!(q||B))return;const F=q?.created_by_isis===!0||B?.created_by_isis===!0,V=q?.canceled_by==="isis"||B?.canceled_by==="isis";if(!F&&!V||E())return;const me=q?.inicio||B?.inicio;let be="";try{if(me){const ie=new Date(me);be=`/agenda?date=${`${ie.getFullYear()}-${String(ie.getMonth()+1).padStart(2,"0")}-${String(ie.getDate()).padStart(2,"0")}`}`}}catch{}let U="";if(k==="INSERT"){if(!F)return;U="sis criou um agendamento"}else if(k==="UPDATE")if(B?.status!=="canceled"&&q?.status==="canceled"&&q?.canceled_by==="isis")U="sis cancelou um agendamento";else return;else if(k==="DELETE")if(B?.canceled_by==="isis")U="sis cancelou um agendamento";else return;else return;const L=`isis-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,H={id:L,tipo:"isis-event",icone:"AlertTriangle",cor:"warning",mensagem:U,link:"/isis/analytics",createdAt:new Date().toISOString()};s(ie=>[H,...Array.isArray(ie)?ie:[]]);try{const ie=j(),Y=[H,...ie.filter(W=>W.id!==L)];_(Y)}catch{}g({id:L,message:U,link:be}),c(!0);try{m.current&&clearTimeout(m.current)}catch{}m.current=setTimeout(()=>{A()},5e3);try{s(ie=>Array.isArray(ie)?ie:[])}catch{}}catch(k){console.warn("[AlertsContext] erro ao processar evento isis:",k)}}).subscribe();return()=>{try{Q.removeChannel(I)}catch{}}},[t?.codigo_empresa,E,A]),p.useEffect(()=>{if(t?.codigo_empresa){S();const O=setInterval(()=>{S()},5*60*1e3);return()=>clearInterval(O)}},[t?.codigo_empresa,S]),p.useEffect(()=>{if(!t?.codigo_empresa)return;const O=()=>{if(document.visibilityState==="visible"){if(E())return;S()}},I=()=>{E()||S()};return document.addEventListener("visibilitychange",O),window.addEventListener("focus",I),()=>{document.removeEventListener("visibilitychange",O),window.removeEventListener("focus",I)}},[t?.codigo_empresa,S,E]),p.useEffect(()=>{if(t?.codigo_empresa){if(f.current===r.pathname)return;if(f.current=r.pathname,E()){console.log("[AlertsContext] Mudana de rota detectada, mas h modais abertos - ignorando recarga");return}console.log("[AlertsContext] Mudana de rota detectada - recarregando alertas"),S()}},[r.pathname,t?.codigo_empresa,S,E]),a.jsx(KY.Provider,{value:{alerts:n,setAlerts:s,showModal:o,setShowModal:i,showBalloon:l,setShowBalloon:c,eventBalloon:x,setEventBalloon:g,closeBalloon:A,dismissAlert:C,clearIsisAlerts:M,loading:d,loadAlerts:S},children:e})},oj=()=>{const e=p.useContext(KY);if(!e)throw new Error("useAlerts must be used within AlertsProvider");return e};function Dje({onToggleSidebar:e,sidebarVisible:t,sidebarPinned:r}){const{toast:n}=Zs(),{signOut:s,userProfile:o,company:i,user:l}=lo(),{alerts:c,setAlerts:d,showModal:u,setShowModal:f,showBalloon:h,setShowBalloon:m,eventBalloon:x,closeBalloon:g,dismissAlert:v}=oj(),y=Il(),b=o?.nome||"Usurio",w=Ce.useMemo(()=>{const V=b.trim().split(/\s+/);return V.length>=2?`${V[0]} ${V[1]}`:b},[b]),j=o?.cargo||o?.papel||"";let _="";try{const V=localStorage.getItem("auth:company");if(V){const me=JSON.parse(V);_=me?.nome_fantasia||me?.razao_social||me?.nome||me?.codigoEmpresa||"";var C=me?.logo_url||""}}catch{}const E=i?.nome_fantasia||i?.razao_social||i?.nome||i?.codigoEmpresa||_||"Empresa no vinculada",S=i?.logo_url||(typeof C<"u"?C:""),A=Ce.useMemo(()=>i?.logo_url?`${i.logo_url}?v=${Date.now()}`:S||"",[i?.logo_url]),M=Ce.useMemo(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}},[]),O=V=>({Package:bu,DollarSign:Wi,CalendarCheck:zC,Clock:pu,ShoppingCart:Y1,Store:eD,Users:mc,CalendarPlus:J4,AlertTriangle:Kf,Info:bG})[V]||Kf,I=V=>({danger:"text-danger",warning:"text-warning",info:"text-info",success:"text-success",purple:"text-purple"})[V]||"text-warning",T=({alert:V,onClick:me})=>{const be=O(V.icone),U=I(V.cor),L=V?.tipo==="isis-event";return a.jsxs("li",{className:"flex items-center gap-2 p-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group",onClick:me,children:[L?a.jsx("span",{className:"rounded-full overflow-hidden bg-background w-5 h-5 flex items-center justify-center flex-shrink-0 shadow-[0_0_0_2px_rgba(0,0,0,0.25)]",children:a.jsx(dl,{size:"xs",className:"w-5 h-5"})}):a.jsx(be,{className:`w-4 h-4 flex-shrink-0 ${U}`}),a.jsx("span",{className:"text-text-secondary group-hover:text-text-primary transition-colors flex-1",children:V.mensagem}),V.link&&a.jsx(K4,{className:"w-3 h-3 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity"})]})},k=async()=>{console.log("[Header] Logout button clicked",{at:new Date().toISOString(),userBefore:!!l});const{error:V}=await s();console.log("[Header] Logout completed",{error:V,userAfter:!!l}),n(V?{title:"Erro ao sair",description:"Ocorreu um erro ao fazer logout. Tente novamente.",variant:"destructive"}:{title:"Logout realizado",description:"Voc foi desconectado com sucesso.",variant:"default"})};new Date().toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"});const q=_i(),B=Ce.useMemo(()=>{try{const V=String(q?.pathname||"");if(V==="/"||V.startsWith("/dashboard"))return"";const be=[{key:"/agenda",label:"Agenda"},{key:"/isis",label:"sis"},{key:"/clientes",label:"Clientes & Fornecedores"},{key:"/produtos",label:"Produtos"},{key:"/vendas",label:"Vendas"},{key:"/financeiro",label:"Financeiro"},{key:"/balcao",label:"Balco"},{key:"/cadastros",label:"Cadastros"},{key:"/quadras",label:"Quadras"},{key:"/equipe",label:"Equipe"},{key:"/finalizadoras",label:"Finalizadoras"},{key:"/empresas",label:"Empresas"},{key:"/configuracoes",label:"Configuraes"},{key:"/login",label:"Login"}].find(U=>V.startsWith(U.key));if(be)return be.label;if(typeof document<"u"){const U=String(document.title||"");return(U.includes(" - ")?U.split(" - ")[0]:U)||""}}catch{}return""},[q?.pathname]),z=Ce.useMemo(()=>String(q?.pathname||"").startsWith("/isis"),[q?.pathname]),F=Ce.useMemo(()=>{const V=i?.nome_fantasia||i?.nome||i?.razao_social||i?.codigoEmpresa||_||"";return String(V).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"").trim()},[i?.nome_fantasia,i?.nome,i?.razao_social,i?.codigoEmpresa,_]);return Ce.useMemo(()=>F?`https://${F}.f7arena.com`:"",[F]),a.jsxs(Fr.header,{animate:{opacity:1,y:0},transition:{duration:.6,ease:[.22,1,.36,1]},className:"relative bg-surface/80 backdrop-blur-sm text-text-primary h-14 md:h-[72px] flex-shrink-0 flex items-center justify-between px-3 md:px-8 border-b border-border shadow-[0_1px_0_RGBA(255,255,255,0.04)]",children:[a.jsxs("div",{className:"flex items-center gap-2 md:gap-4 min-w-0 flex-1",children:[a.jsx(Z,{variant:"ghost",size:"icon",onClick:e,"aria-label":t?"Ocultar barra lateral":"Mostrar barra lateral",className:"h-10 w-10 md:h-12 md:w-12 hover:bg-surface-2/60 transition-colors",children:a.jsx(efe,{className:`w-6 h-6 md:w-7 md:h-7 transition-colors ${t?"text-brand":"text-text-primary"}`})}),a.jsxs("div",{className:"group mx-auto md:mx-0 pl-2 pr-3 md:pl-3 md:pr-5 py-1 md:py-1.5 border border-white/10 bg-gradient-to-b from-surface-2/60 to-surface/60 text-text-primary flex items-center gap-2 md:gap-4 shadow-sm hover:border-white/20 transition-colors overflow-hidden max-w-[60vw] md:max-w-[30vw] lg:max-w-[24vw]",title:E,children:[a.jsx("div",{className:"relative w-9 h-9 md:w-11 md:h-11 shrink-0 overflow-hidden border border-white/10 bg-surface-2/60 grid place-items-center shadow-[0_0_0_3px_RGBA(0,0,0,0.2)]",children:A?a.jsx("img",{src:A,alt:"Logo",className:"w-full h-full object-cover"}):a.jsx(Mue,{className:"w-6 h-6 opacity-80"})}),a.jsx("span",{className:"tracking-tight truncate text-base leading-8 md:text-base md:leading-[44px] text-text-primary font-semibold flex-1 min-w-0 text-center md:text-left",children:E}),M&&a.jsx("span",{className:"ml-2 hidden md:inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-extrabold uppercase tracking-wider bg-red-600 text-white shadow animate-pulse",children:"Dev"})]})]}),z?a.jsx("div",{className:"pointer-events-none absolute z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:block",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)] w-8 h-8",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-full h-full",children:a.jsx(dl,{size:"xs",className:"w-8 h-8"})})}),a.jsx("h1",{className:"text-lg md:text-xl font-bold tracking-tight text-text-primary",children:"sis"})]})}):B?a.jsx("div",{className:"pointer-events-none absolute z-10 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:block",children:a.jsx("h1",{className:"text-lg md:text-xl font-bold tracking-tight text-text-primary",children:B})}):null,a.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[!z&&a.jsxs(Z,{variant:"ghost",onClick:()=>y("/isis"),className:"hidden md:inline-flex items-center gap-2 px-2.5 py-1.5 rounded-full border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-all duration-200 hover:-translate-y-px hover:shadow-[0_4px_16px_rgba(0,0,0,0.25)]",children:[a.jsx("span",{className:"inline-flex items-center justify-center rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400",children:a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(dl,{size:"xs"})})}),a.jsx("span",{className:"text-sm font-semibold text-text-primary",children:"sis"})]}),a.jsxs(Qo,{open:u?!1:h,onOpenChange:m,children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"ghost",size:"icon",onClick:()=>{m(!1),f(!0)},className:"relative text-text-secondary hover:text-text-primary transition-colors duration-200",children:[a.jsx(Lb,{className:"h-5 w-5"}),c.length>0&&a.jsx("span",{className:"absolute -top-1 -right-1 bg-danger text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:c.length})]})}),a.jsxs(Go,{align:"end",sideOffset:8,className:"w-80 p-0 overflow-hidden bg-background border-white/10",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Lb,{className:"h-4 w-4 text-brand"}),a.jsx("span",{className:"text-sm font-semibold",children:x?"Notificao":"Alertas"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[!x&&a.jsx(Z,{size:"sm",variant:"ghost",onClick:()=>{m(!1),f(!0)},children:"Ver todos"}),a.jsx(Z,{size:"icon",variant:"ghost",onClick:()=>{x?g():m(!1)},"aria-label":"Fechar",children:a.jsx(Hc,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"p-2",children:x?a.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md bg-surface-2",children:[a.jsx("span",{className:"rounded-full overflow-hidden bg-background",children:a.jsx(dl,{size:"xs"})}),a.jsx("span",{className:"text-sm text-text-secondary flex-1",children:x.message}),a.jsx(Z,{size:"sm",variant:"ghost",className:"shrink-0",onClick:()=>{y("/isis/analytics");try{x?.id&&v(x.id)}catch{}g()},children:"Ver"})]}):c.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-6",children:"Nenhum alerta no momento"}):a.jsx("ul",{className:"space-y-1 text-sm",children:c.slice(0,3).map((V,me)=>a.jsx(T,{alert:V,onClick:()=>{if(V.link&&y(V.link),V?.tipo==="isis-event"&&V?.id)try{v(V.id)}catch{}m(!1)}},me))})})]})]}),a.jsx(Z,{variant:"ghost",size:"icon",onClick:k,className:"text-text-secondary hover:text-brand hover:bg-brand/10 transition-colors duration-200 shrink-0",children:a.jsx(Zue,{className:"h-5 w-5"})}),a.jsx("div",{className:"hidden md:block w-px h-8 bg-border mx-1 md:mx-2"}),a.jsxs("div",{className:"hidden md:flex group pl-2 pr-3 md:pl-4 md:pr-4 py-1.5 rounded-full border border-white/10 bg-gradient-to-b from-surface-2/60 to-surface/60 text-text-primary items-center gap-2 md:gap-3 shadow-sm hover:border-white/20 transition-colors",title:`${w}  ${j}`,children:[a.jsx("span",{className:"text-xs md:text-sm font-semibold truncate max-w-[120px] md:max-w-[180px]",children:w}),a.jsx("span",{className:"text-[10px] md:text-[11px] px-1.5 md:px-2 py-0.5 rounded-full bg-brand/15 text-brand font-medium tracking-wide",children:j})]})]}),a.jsx(Un,{open:u,onOpenChange:f,children:a.jsxs(zn,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(Bn,{children:a.jsxs(Ln,{className:"flex items-center gap-2",children:[a.jsx(Lb,{className:"h-5 w-5 text-brand"}),"Todos os Alertas (",c.length,")"]})}),a.jsx("div",{className:"mt-4",children:c.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-8",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:c.map((V,me)=>a.jsx(T,{alert:V,onClick:()=>{if(V.link&&(y(V.link),f(!1)),V?.tipo==="isis-event"&&V?.id)try{v(V.id)}catch{}}},me))})})]})})]})}const It=Ce.forwardRef(({className:e,type:t,...r},n)=>a.jsx("input",{type:t,className:Pr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...r}));It.displayName="Input";var Mje="Label",XY=p.forwardRef((e,t)=>a.jsx(Qa.label,{...e,ref:t,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));XY.displayName=Mje;var YY=XY;const Rje=ND("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ct=Ce.forwardRef(({className:e,...t},r)=>a.jsx(YY,{ref:r,className:Pr(Rje(),e),...t}));ct.displayName=YY.displayName;const Fje=e=>{const t={"Invalid login credentials":"Email ou senha incorretos","Email not confirmed":"Email no confirmado","User not found":"Usurio no encontrado","Invalid email":"Email invlido","Password should be at least 6 characters":"A senha deve ter pelo menos 6 caracteres","Unable to validate email address: invalid format":"Formato de email invlido","Email rate limit exceeded":"Muitas tentativas. Aguarde alguns minutos","Network request failed":"Erro de conexo. Verifique sua internet","Failed to fetch":"Erro de conexo. Verifique sua internet"};if(t[e])return t[e];for(const[r,n]of Object.entries(t))if(e.includes(r))return n;return"Erro ao fazer login. Verifique suas credenciais e tente novamente."},Lje=()=>{const[e,t]=p.useState(!1),[r,n]=p.useState(!1),[s,o]=p.useState(""),[i,l]=p.useState({email:"",password:""}),{signIn:c,user:d,authReady:u}=lo(),{toast:f}=Zs();p.useEffect(()=>{if(u&&d)try{const v=sessionStorage.getItem("auth:returnUrl");sessionStorage.removeItem("auth:returnUrl");const y=v||"/";console.log("[LoginPage] Redirecionando para:",y),window.location.replace(y)}catch{}},[u,!!d]);const h=v=>{l({...i,[v.target.name]:v.target.value}),s&&o("")},m=async v=>{v.preventDefault(),n(!0),o("");try{const y=await c(i.email,i.password);if(y.error)throw y.error;f({title:"Login realizado!",description:"Bem-vindo de volta!",variant:"default"});try{const b=sessionStorage.getItem("auth:returnUrl");sessionStorage.removeItem("auth:returnUrl");const w=b||"/";console.log("[LoginPage] Redirecionando aps login para:",w),window.location.replace(w)}catch{}}catch(y){const b=y.message||"Ocorreu um erro. Tente novamente.",w=Fje(b);o(w),f({title:"Erro",description:w,variant:"destructive"})}finally{n(!1)}},x={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}},g=(()=>{try{return typeof window<"u"&&String(window.__ACTIVE_TARGET||"").toLowerCase()==="dev"}catch{return!1}})();return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 sm:p-6 relative",children:[g&&a.jsx("div",{className:"pointer-events-none select-none absolute top-4 right-4 z-20",children:a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-extrabold uppercase tracking-wider bg-red-600 text-white shadow animate-pulse",children:"Dev"})}),a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.02] mix-blend-overlay"}),a.jsxs(Fr.div,{variants:x,initial:"hidden",animate:"visible",className:"relative z-10 w-full max-w-md pb-20 sm:pb-0",children:[a.jsxs("div",{className:"fx-card",children:[a.jsx("div",{className:"text-center mb-6",children:a.jsxs("div",{className:"flex items-center justify-center mb-4",children:[a.jsx("div",{className:"w-16 h-16 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(jd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-5xl font-extrabold",children:[a.jsx("span",{style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{style:{color:"#FFAA33"},children:"7"})]}),a.jsx("p",{className:"text-2xl font-semibold",style:{color:"#B0B0B0"},children:"Arena"})]})]})}),a.jsxs("form",{onSubmit:m,className:"space-y-5 sm:space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs(ct,{htmlFor:"email",className:"text-text-primary flex items-center gap-2 text-sm sm:text-base",children:[a.jsx(u0,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Email"]}),a.jsx(It,{id:"email",name:"email",type:"email",placeholder:"seu@email.com",value:i.email,onChange:h,required:!0,className:"placeholder:text-[#B0B0B0] h-12 sm:h-10 text-base sm:text-sm"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(ct,{htmlFor:"password",className:"text-text-primary flex items-center gap-2 text-sm sm:text-base",children:[a.jsx(d0,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Senha"]}),a.jsxs("div",{className:"relative",children:[a.jsx(It,{id:"password",name:"password",type:e?"text":"password",placeholder:"Sua senha",value:i.password,onChange:h,required:!0,className:"pr-10 placeholder:text-[#B0B0B0] h-12 sm:h-10 text-base sm:text-sm"}),a.jsx("button",{type:"button",onClick:()=>t(!e),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors",children:e?a.jsx(kg,{className:"w-5 h-5 sm:w-4 sm:h-4"}):a.jsx(Xg,{className:"w-5 h-5 sm:w-4 sm:h-4"})})]})]}),s&&a.jsx(Fr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-lg bg-destructive/10 border border-destructive/30 text-destructive text-sm",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:""}),a.jsx("span",{className:"flex-1",children:s})]})}),a.jsx(Z,{type:"submit",className:"w-full h-12 sm:h-10 text-base sm:text-sm",disabled:r,children:r?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin"}),"Entrando..."]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Que,{className:"w-4 h-4"}),"Entrar"]})})]})]}),a.jsx("p",{className:"mt-4 text-center text-xs text-text-muted opacity-70",children:" 2026 Fluxo7 Arena  Todos os direitos reservados."})]})]})})},y8=({children:e})=>{const{user:t,authReady:r}=lo(),n=_i();return p.useEffect(()=>{if(r&&!t&&n.pathname!=="/login")try{sessionStorage.setItem("auth:returnUrl",n.pathname+n.search),console.log("[ProtectedRoute] Salvando rota de retorno:",n.pathname+n.search)}catch(s){console.warn("[ProtectedRoute] Erro ao salvar rota de retorno:",s)}},[r,t,n.pathname,n.search]),r?t?e:a.jsx(Lje,{}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 border-4 border-brand border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-text-primary font-medium",children:"Carregando..."})]})})},$je=p.createContext(),Bje=({children:e})=>{const[t,r]=p.useState({payment:{open:!1,data:null},editParticipant:{open:!1,data:null}}),[n,s]=p.useState(new Set),o=p.useCallback((f,h=null)=>{console.log(" [MODALS] Abrindo modal:",f,h),r(m=>({...m,[f]:{open:!0,data:h}}))},[]),i=p.useCallback(f=>{if(n.has(f)){console.log(` [ModalsContext] Modal "${f}" est protegido, ignorando fechamento`);return}r(h=>({...h,[f]:{open:!1,data:{}}}))},[n]),l=p.useCallback(f=>t[f]?.open||!1,[t]),c=p.useCallback(f=>t[f]?.data||{},[t]),d=p.useCallback(f=>{console.log(` [ModalsContext] Protegendo modal "${f}"`),s(h=>new Set([...h,f]))},[]),u=p.useCallback(f=>{console.log(` [ModalsContext] Desprotegendo modal "${f}"`),s(h=>{const m=new Set(h);return m.delete(f),m})},[]);return a.jsx($je.Provider,{value:{openModal:o,closeModal:i,isModalOpen:l,getModalData:c,protectModal:d,unprotectModal:u},children:e})},JY=p.createContext(),qN=()=>{const e=p.useContext(JY);if(!e)throw new Error("useAgenda must be used within AgendaProvider");return e},qje=({children:e})=>{const[t,r]=p.useState(!1),[n,s]=p.useState(!1),[o,i]=p.useState(!1),[l,c]=p.useState({participantId:null,participantName:""}),[d,u]=p.useState(null),[f,h]=p.useState([]),[m,x]=p.useState(""),[g,v]=p.useState([]),[y,b]=p.useState(null),[w,j]=p.useState([]),_=p.useRef({isProtected:!1,protectedUntil:0}),C=p.useRef(Date.now()),E=p.useRef(null),S=_i(),A=p.useCallback((B=2e3)=>{const z=Date.now()+B;if(z>_.current.protectedUntil)_.current.isProtected=!0,_.current.protectedUntil=z;else return;setTimeout(()=>{Date.now()>=_.current.protectedUntil&&(_.current.isProtected=!1)},B)},[]),M=p.useCallback(()=>{_.current.isProtected=!1,_.current.protectedUntil=0},[]),O=p.useCallback(()=>{r(!0)},[]),I=p.useCallback((B={})=>{const z=B===!0||B&&B.force===!0,F=Date.now();if(z)return r(!1),!0;if(_.current.isProtected&&F<_.current.protectedUntil){const me=_.current.protectedUntil-F;try{localStorage.getItem("debug:agenda")==="1"&&console.log(` [PaymentModal] Fechamento bloqueado por proteo (${me}ms restantes)`)}catch{}return!1}if(Date.now()-C.current<500){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Fechamento bloqueado por mudana de visibilidade recente")}catch{}return!1}try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Fechando modal (no protegido)")}catch{}return r(!1),!0},[]),T=p.useCallback((B,z)=>{c({participantId:B,participantName:z}),s(!0),A(3e3)},[A]),k=p.useCallback(()=>{s(!1),c({participantId:null,participantName:""})},[]);p.useEffect(()=>{if(!(S?.pathname||"").startsWith("/agenda"))return()=>{};const F=()=>{const me=Date.now(),be=document.hidden;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] visibilitychange:",{hidden:be,timestamp:new Date().toISOString(),isPaymentModalOpen:t})}catch{}if(C.current=me,!be&&t){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] Aba restaurada com modal aberto - protegendo por 3s")}catch{}const U=Date.now()+3e3;_.current.isProtected=!0,_.current.protectedUntil=U}},V=()=>{const me=Date.now();try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] window focus:",{timestamp:new Date().toISOString(),isPaymentModalOpen:t})}catch{}if(C.current=me,t){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [AgendaContext] Janela ganhou foco com modal aberto - protegendo por 3s")}catch{}const be=Date.now()+3e3;_.current.isProtected=!0,_.current.protectedUntil=be}};return document.addEventListener("visibilitychange",F),window.addEventListener("focus",V),()=>{document.removeEventListener("visibilitychange",F),window.removeEventListener("focus",V)}},[t,S?.pathname]);const q={isPaymentModalOpen:t,isEditParticipantModalOpen:n,isAddBookingModalOpen:o,openPaymentModal:O,closePaymentModal:I,openEditParticipantModal:T,closeEditParticipantModal:k,setIsAddBookingModalOpen:i,editParticipantData:l,editingBooking:d,setEditingBooking:u,participantsForm:f,setParticipantsForm:h,paymentTotal:m,setPaymentTotal:x,payMethods:g,setPayMethods:v,bookingForm:y,setBookingForm:b,localCustomers:w,setLocalCustomers:j,protectPaymentModal:A,unprotectPaymentModal:M,onParticipantReplacedRef:E,get lastVisibilityChangeTime(){return C.current},get isModalProtected(){const B=Date.now();return _.current.isProtected&&B<_.current.protectedUntil}};return a.jsx(JY.Provider,{value:q,children:e})},zje="https://guildthlqkfubbqoybys.supabase.co",b8="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",Uje=()=>({apikey:b8,Authorization:`Bearer ${b8}`,"Content-Type":"application/json","X-Client-Info":"fluxo7-isis-web"}),E_=async(e,{method:t="GET",body:r,headers:n}={})=>{const s=`${zje}${e}`,o=await fetch(s,{method:t,headers:{...Uje(),...n||{}},body:r?JSON.stringify(r):void 0}),i=await o.text().catch(()=>""),l=i&&JSON.parse(i)||null;return o.ok?{data:l,error:null}:{data:null,error:{status:o.status,message:l?.message||i||`HTTP ${o.status}`,details:l?.details??null,hint:l?.hint??null,code:l?.code??null}}};class Vje{constructor(t){this.table=t,this._select="*",this._filters=[],this._order=null}select(t){return this._select=t||"*",this}eq(t,r){return this._filters.push([t,"eq",r]),this}is(t,r){return this._filters.push([t,"is",r]),this}order(t,{ascending:r}={}){return this._order={column:t,ascending:r!==!1},this}async insert(t){return E_(`/rest/v1/${this.table}`,{method:"POST",body:t})}async upsert(t,{onConflict:r}={}){const n=new URLSearchParams;r&&n.set("on_conflict",r);const s=n.toString();return E_(`/rest/v1/${this.table}${s?`?${s}`:""}`,{method:"POST",body:t,headers:{Prefer:"resolution=merge-duplicates,return=minimal"}})}async update(t){const r=new URLSearchParams;r.set("select",this._select);for(const[n,s,o]of this._filters)s==="is"&&o===null?r.set(n,"is.null"):r.set(n,`${s}.${o}`);return this._order?.column&&r.set("order",`${this._order.column}.${this._order.ascending?"asc":"desc"}`),E_(`/rest/v1/${this.table}?${r.toString()}`,{method:"PATCH",body:t,headers:{Prefer:"return=minimal"}})}async then(t,r){const n=new URLSearchParams;n.set("select",this._select);for(const[o,i,l]of this._filters)i==="is"&&l===null?n.set(o,"is.null"):n.set(o,`${i}.${l}`);this._order?.column&&n.set("order",`${this._order.column}.${this._order.ascending?"asc":"desc"}`);const s=await E_(`/rest/v1/${this.table}?${n.toString()}`,{method:"GET"});return Promise.resolve(s).then(t,r)}}const NO={from(e){return new Vje(e)}},QY=p.createContext(),p5=()=>{const e=p.useContext(QY);if(!e)throw new Error("useIsis deve ser usado dentro de IsisProvider");return e},ZY=({children:e})=>{const[t,r]=p.useState("greeting"),[n,s]=p.useState([]),o=p.useRef((()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const te=[...Array(36)].map(()=>"x");return te[8]=te[13]=te[18]=te[23]="-",te[14]="4",te.map((oe,De)=>{if(oe!=="x")return oe;const re=Math.random()*16|0;return(De===19?re&3|8:re).toString(16)}).join("")}catch{return"00000000-0000-4000-8000-000000000000"}})()),[i,l]=p.useState(o.current),[c,d]=p.useState({empresa:null,quadra:null,data:null,horario:null,modalidade:null,quantidade:null,nomes:[],contato:{nome:"",telefone:""}}),[u,f]=p.useState(!1),[h,m]=p.useState(!1),x=p.useRef(null),v=[["VITE_KEY_CHAT_ISIS",{}.VITE_KEY_CHAT_ISIS],["VITE-KEY-CHAT-ISIS",{VITE_JSONBIN_BIN_ID:"690605e5ae596e708f3c7bc5",VITE_JSONBIN_ISIS_BIN_ID:"6939b808ae596e708f90b843",VITE_JSONBIN_API_KEY:"$/XmOGvx8./SZzV3qMzQ5i.6FjBjS4toNbeaEFzX2D8QPUddyM6VR2",VITE_SUPABASE_URL:"https://dlfryxtyxqoacuunswuc.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY",VITE_SUPABASE_URL_ISIS:"https://guildthlqkfubbqoybys.supabase.co",VITE_SUPABASE_ANON_KEY_ISIS:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}["VITE-KEY-CHAT-ISIS"]],["KEY_CHAT_ISIS",{}.KEY_CHAT_ISIS],["KEY-CHAT-ISIS",{VITE_JSONBIN_BIN_ID:"690605e5ae596e708f3c7bc5",VITE_JSONBIN_ISIS_BIN_ID:"6939b808ae596e708f90b843",VITE_JSONBIN_API_KEY:"$/XmOGvx8./SZzV3qMzQ5i.6FjBjS4toNbeaEFzX2D8QPUddyM6VR2",VITE_SUPABASE_URL:"https://dlfryxtyxqoacuunswuc.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsZnJ5eHR5eHFvYWN1dW5zd3VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4ODg0MzcsImV4cCI6MjA3MTQ2NDQzN30.AizQBbCE1p_xfAQ9T0Eha1anGzcFETcc__8AV4iaQTY",VITE_SUPABASE_URL_ISIS:"https://guildthlqkfubbqoybys.supabase.co",VITE_SUPABASE_ANON_KEY_ISIS:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1aWxkdGhscWtmdWJicW95YnlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3NTY2NjksImV4cCI6MjA4MTMzMjY2OX0.9--rqgkuDVLiwhU93RLV1YwEYVW6aRe9Qf5Mh80aVCg",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}["KEY-CHAT-ISIS"]]].find(([te,oe])=>!!oe),y=v?.[1],b=v?.[0]||"none",w={}.VITE_JSONBIN_COLLECTION_ID||null,j="6939b808ae596e708f90b843",_="https://api.jsonbin.io/v3/b",C={}.VITE_ISIS_EDGE_SYNC==="1",[E,S]=p.useState(C?j:null);if(C&&typeof window<"u")try{console.info("[Isis][JSONBin] keySource=%s binId=%s",b,j||window.localStorage.getItem("ISIS_JSONBIN_BIN_ID")||"none")}catch{}const A=p.useCallback(async te=>{if(!C)return{ok:!1,data:null};if(!y){try{console.debug("[Isis][Edge] skipped (no JSONBIN key) mode=%s",te?.mode)}catch{}return{ok:!1,data:null}}try{const{data:oe,error:De}=await Q.functions.invoke("isis-chat",{body:te});if(De){try{console.debug("[Isis][Edge] %s error=%o",te?.mode,De)}catch{}return{ok:!1,data:null}}try{console.debug("[Isis][Edge] %s ok resp=%o",te?.mode,oe)}catch{}return{ok:!0,data:oe}}catch(oe){try{console.debug("[Isis][Edge] invoke exception:",oe)}catch{}return{ok:!1,data:null}}},[y,C]),M=p.useCallback(async te=>{if(!y)return null;const oe={"X-Master-Key":y,"X-Access-Key":y,"Content-Type":"application/json"};w&&(oe["X-Collection-Id"]=w);const De=await fetch(`${_}`,{method:"POST",headers:oe,body:JSON.stringify(te||{projects:[{name:"F7 Arena"}],chat_sessions:[]})});if(!De.ok)return null;const re=await De.json().catch(()=>null),ae=re?.metadata?.id||re?.id||null;if(ae){S(ae);try{window?.localStorage?.setItem("ISIS_JSONBIN_BIN_ID",ae)}catch{}}return ae},[y]),O=p.useCallback(async()=>{if(!y||!E)return null;try{console.debug("[Isis][JSONBin] loadBin: GET %s/%s",_,E)}catch{}const te={"X-Master-Key":y,"X-Access-Key":y,"X-Bin-Meta":"false","Content-Type":"application/json"};w&&(te["X-Collection-Id"]=w);const oe=await fetch(`${_}/${E}`,{method:"GET",headers:te});try{console.debug("[Isis][JSONBin] loadBin: status=%s",oe?.status)}catch{}if(oe.status===401||oe.status===404){try{console.error("[Isis][JSONBin] GET unauthorized or not found. keySource=%s binId=%s status=%s",b,E,oe.status)}catch{}return await M()?{projects:[{name:"F7 Arena"}],chat_sessions:[]}:null}if(!oe.ok)return null;try{return await oe.json()}catch{return null}},[y,E,M]),I=p.useCallback(async te=>{if(!y||!E&&!await M(te))return!1;const oe=E||(typeof window<"u"?window.localStorage.getItem("ISIS_JSONBIN_BIN_ID"):null);try{console.debug("[Isis][JSONBin] saveBin: PUT %s/%s",_,oe)}catch{}const De={"X-Master-Key":y,"X-Access-Key":y,"Content-Type":"application/json"};w&&(De["X-Collection-Id"]=w);const re=await fetch(`${_}/${oe}`,{method:"PUT",headers:De,body:JSON.stringify(te)});try{console.debug("[Isis][JSONBin] saveBin: status=%s",re?.status)}catch{}if(re.status===401||re.status===404){try{console.error("[Isis][JSONBin] PUT unauthorized or not found. keySource=%s binId=%s status=%s",b,oe,re.status)}catch{}return!!await M(te)}return re.ok},[y,E,M]),T=te=>!te||typeof te!="object"?{projects:[{name:"F7 Arena"}],chat_sessions:[]}:(Array.isArray(te.chat_sessions)||(te.chat_sessions=[]),te),k=(te,oe)=>(Array.isArray(te?.chat_sessions)?te.chat_sessions:[]).findIndex(re=>(re?.project||"").toString()===(oe.project||"").toString()&&(re?.company?.code||"").toString()===(oe.companyCode||"").toString()&&(re?.client_code||"").toString()===(oe.clientCode||"").toString()),q=p.useCallback(async()=>{if(i)return i;try{try{console.info("[Isis][Chat] ensureSession: start")}catch{}const te=c?.empresa||null,oe=te?{code:te.codigo_empresa||te.codigoEmpresa,name:te.nome_fantasia||te.nome}:null,De=c?.cliente||null;let re=await O();re=T(re),Array.isArray(re.projects)||(re.projects=[{name:"F7 Arena"}]);const ae={project:"F7 Arena",companyCode:oe?.code||null,clientCode:De?.id?String(De.id):null};try{console.debug("[Isis][Chat] ensureSession: criteria=%o",ae)}catch{}if(ae.companyCode&&ae.clientCode){const ut=k(re,ae);try{console.debug("[Isis][Chat] ensureSession: existingIndex=%s",ut)}catch{}ut===-1&&re.chat_sessions.push({client_code:ae.clientCode,client_name:De?.nome||De?.name||"",company:oe,project:ae.project,conversation:[]})}await I(re);try{console.info("[Isis][Chat] ensureSession: sessionId=%s",i)}catch{}return i}catch(te){try{console.error("[Isis][Chat] ensureSession: failed",te)}catch{}return null}},[i,c?.empresa,c?.cliente,O,I]),B=p.useCallback(async te=>{if(te)try{const oe=c?.empresa||null,De=oe?{code:oe.codigo_empresa||oe.codigoEmpresa,name:oe.nome_fantasia||oe.nome}:null,re=c?.cliente||null;let ae=await O();if(!ae)return;ae=T(ae);const ut={project:"F7 Arena",companyCode:De?.code||null,clientCode:re?.id?String(re.id):null};try{console.debug("[Isis][Chat] tryUpdateSessionMeta: criteria=%o",ut)}catch{}if(!ut.companyCode&&!ut.clientCode)return;let pt=k(ae,ut);if(pt===-1){ae.chat_sessions.push({client_code:ut.clientCode,client_name:re?.nome||re?.name||"",company:De,project:ut.project,conversation:[]}),pt=ae.chat_sessions.length-1;try{console.debug("[Isis][Chat] tryUpdateSessionMeta: created index=%s",pt)}catch{}}else{re?.id&&!ae.chat_sessions[pt].client_code&&(ae.chat_sessions[pt].client_code=String(re.id)),re?.nome&&!ae.chat_sessions[pt].client_name&&(ae.chat_sessions[pt].client_name=re.nome),De&&!ae.chat_sessions[pt].company&&(ae.chat_sessions[pt].company=De);try{console.debug("[Isis][Chat] tryUpdateSessionMeta: updated index=%s",pt)}catch{}}await I(ae),De?.name&&re?.id&&await A({mode:"set_meta",cod_cliente:re?.id?String(re.id):"",nome_cliente:re?.nome||re?.name||"",empresa:De.name,software:"F7 Arena"})}catch{}},[c?.empresa,c?.cliente,O,I,A]),z=p.useCallback(async te=>{try{try{console.info("[Isis][Chat] persistMessage: incoming=%o",{sessionId:i,from:te.from,text:te.text})}catch{}const oe=c?.empresa||null,De=oe?{code:oe.codigo_empresa||oe.codigoEmpresa,name:oe.nome_fantasia||oe.nome}:null,re=c?.cliente||null;try{const ae=te.from==="isis"?"assistant":"user",ut=De?.name||oe?.nome_fantasia||oe?.nome||oe?.razao_social||"Desconhecida";let pt=[];try{const{data:Dt,error:Bt}=await NO.from("isis").select("conversa").eq("id",i);if(Bt)try{console.error("[Isis][Chat] supabase-isis select conversa error:",{sessionId:i,status:Bt?.status,message:Bt?.message,code:Bt?.code})}catch{}!Bt&&Array.isArray(Dt)&&Dt[0]?.conversa&&(pt=Array.isArray(Dt[0].conversa)?Dt[0].conversa:[])}catch{}const ft=[...Array.isArray(pt)?pt:[],{ts:new Date().toISOString(),from:ae,text:String(te.text??"")}],bt={id:String(i),cod_cliente:re?.id?String(re.id):null,nome_cliente:re?.nome||re?.name||null,empresa:ut,projeto:"fluxo7arena",conversa:ft,timestamp:new Date().toISOString()},{error:Lt}=await NO.from("isis").upsert(bt,{onConflict:"id"});if(Lt)try{console.error("[Isis][Chat] supabase-isis upsert error:",{sessionId:i,status:Lt?.status,message:Lt?.message,code:Lt?.code})}catch{}else try{console.info("[Isis][Chat] supabase-isis upsert ok:",{sessionId:i,conversaLen:Array.isArray(ft)?ft.length:null,hasCliente:!!re?.id,empresa:ut})}catch{}}catch(ae){try{console.error("[Isis][Chat] supabase-isis exception:",ae)}catch{}}if(C&&await A({mode:"append_message",cod_cliente:re?.id?String(re.id):"_unknown",nome_cliente:re?.nome||re?.name||"",empresa:De?.name||"",software:"F7 Arena",session_id:i,message:{from:te.from==="isis"?"assistant":"user",text:String(te.text??"")}}),C)try{const ae=await q();if(!ae)return;const ut=te.from==="isis"?"assistant":"user",pt={ts:new Date().toISOString(),from:ut,text:String(te.text??"")};let ft=await O();if(!ft)return;ft=T(ft);const bt=c?.empresa||null,Lt=bt?{code:bt.codigo_empresa||bt.codigoEmpresa,name:bt.nome_fantasia||bt.nome}:null,Dt=c?.cliente||null,Bt={project:"F7 Arena",companyCode:Lt?.code||null,clientCode:Dt?.id?String(Dt.id):null};let ge=k(ft,Bt);ge===-1?ft.chat_sessions.push({client_code:Bt.clientCode,client_name:Dt?.nome||Dt?.name||"",company:Lt,project:Bt.project,conversation:[pt]}):(Array.isArray(ft.chat_sessions[ge].conversation)||(ft.chat_sessions[ge].conversation=[]),ft.chat_sessions[ge].conversation.push(pt)),await I(ft),B(ae)}catch{}}catch{}},[q,B,O,I,A,c?.empresa,c?.cliente,i]),F=p.useCallback(te=>{s(oe=>[...oe,{id:Date.now()+Math.random(),timestamp:new Date,...te}]),setTimeout(()=>{x.current?.scrollIntoView({behavior:"smooth"})},100);try{z(te)}catch{}},[z]),V=p.useCallback((te,oe=2e3,De=null)=>{m(!0),setTimeout(()=>{m(!1);const re=te&&typeof te=="object"&&te.text?te:{text:te};F({from:"isis",text:re.text,type:"text",color:re.color??De,copyable:!!re.copyable,copyText:re.copyText})},oe)},[F]),me=p.useCallback((te,oe,De=2e3)=>{m(!0),setTimeout(()=>{m(!1),s(re=>re.map(ae=>ae.type==="buttons"&&ae.buttons&&ae.buttons.length>0?{...ae,disabled:!0}:ae)),F({from:"isis",text:te,type:"buttons",buttons:oe,disabled:!1})},De)},[F]),be=p.useCallback(()=>{s(te=>te.map(oe=>oe.type==="buttons"&&oe.buttons&&oe.buttons.length>0&&!oe.disabled?{...oe,disabled:!0}:oe))},[]),U=p.useCallback(te=>{s(oe=>oe.filter(De=>De.id!==te))},[]),L=p.useCallback(te=>{s(oe=>oe.map(De=>De.id===te&&De.type==="buttons"?{...De,buttonsHidden:!0,disabled:!0}:De))},[]),H=p.useCallback(te=>{F({from:"user",text:te,type:"text"})},[F]),ie=p.useCallback((te,oe)=>{if(d(De=>({...De,[te]:oe})),(te==="cliente"||te==="empresa")&&i)try{B(i)}catch{}},[]),Y=p.useCallback((te,oe)=>{d(De=>({...De,contato:{...De.contato,[te]:oe}}))},[]),W=p.useCallback(te=>{r(te)},[]),se=p.useCallback(()=>{const te=["greeting","quadra","data","horario","modalidade","quantidade","nomes","contato","review","confirmation","avaliacao"],oe=te.indexOf(t);oe>0&&r(te[oe-1])},[t]),pe=p.useCallback(()=>{r("greeting"),s([]),d({empresa:null,quadra:null,data:null,horario:null,modalidade:null,quantidade:null,nomes:[],contato:{nome:"",telefone:""}}),f(!1),m(!1),l(null)},[]),G={currentStep:t,messages:n,selections:c,sessionId:i,isLoading:u,isTyping:h,chatEndRef:x,addMessage:F,addIsisMessage:V,addIsisMessageWithButtons:me,addUserMessage:H,disableAllButtons:be,removeMessageById:U,hideButtonsInMessage:L,updateSelection:ie,updateContact:Y,nextStep:W,previousStep:se,resetConversation:pe,setIsLoading:f,setIsTyping:m};return a.jsx(QY.Provider,{value:G,children:e})};var Wje=Array.isArray,Yc=Wje,Hje=typeof Gl=="object"&&Gl&&Gl.Object===Object&&Gl,eJ=Hje,Gje=eJ,Kje=typeof self=="object"&&self&&self.Object===Object&&self,Xje=Gje||Kje||Function("return this")(),Zf=Xje,Yje=Zf,Jje=Yje.Symbol,ij=Jje,w8=ij,tJ=Object.prototype,Qje=tJ.hasOwnProperty,Zje=tJ.toString,Yy=w8?w8.toStringTag:void 0;function e_e(e){var t=Qje.call(e,Yy),r=e[Yy];try{e[Yy]=void 0;var n=!0}catch{}var s=Zje.call(e);return n&&(t?e[Yy]=r:delete e[Yy]),s}var t_e=e_e,r_e=Object.prototype,n_e=r_e.toString;function a_e(e){return n_e.call(e)}var s_e=a_e,j8=ij,o_e=t_e,i_e=s_e,l_e="[object Null]",c_e="[object Undefined]",_8=j8?j8.toStringTag:void 0;function d_e(e){return e==null?e===void 0?c_e:l_e:_8&&_8 in Object(e)?o_e(e):i_e(e)}var Jm=d_e;function u_e(e){return e!=null&&typeof e=="object"}var Qm=u_e,f_e=Jm,m_e=Qm,h_e="[object Symbol]";function p_e(e){return typeof e=="symbol"||m_e(e)&&f_e(e)==h_e}var cy=p_e,g_e=Yc,x_e=cy,v_e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,y_e=/^\w*$/;function b_e(e,t){if(g_e(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||x_e(e)?!0:y_e.test(e)||!v_e.test(e)||t!=null&&e in Object(t)}var tM=b_e;function w_e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ip=w_e;const dy=Us(Ip);var j_e=Jm,__e=Ip,N_e="[object AsyncFunction]",S_e="[object Function]",C_e="[object GeneratorFunction]",A_e="[object Proxy]";function P_e(e){if(!__e(e))return!1;var t=j_e(e);return t==S_e||t==C_e||t==N_e||t==A_e}var rM=P_e;const Ja=Us(rM);var E_e=Zf,k_e=E_e["__core-js_shared__"],I_e=k_e,uE=I_e,N8=function(){var e=/[^.]+$/.exec(uE&&uE.keys&&uE.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function O_e(e){return!!N8&&N8 in e}var T_e=O_e,D_e=Function.prototype,M_e=D_e.toString;function R_e(e){if(e!=null){try{return M_e.call(e)}catch{}try{return e+""}catch{}}return""}var rJ=R_e,F_e=rM,L_e=T_e,$_e=Ip,B_e=rJ,q_e=/[\\^$.*+?()[\]{}|]/g,z_e=/^\[object .+?Constructor\]$/,U_e=Function.prototype,V_e=Object.prototype,W_e=U_e.toString,H_e=V_e.hasOwnProperty,G_e=RegExp("^"+W_e.call(H_e).replace(q_e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function K_e(e){if(!$_e(e)||L_e(e))return!1;var t=F_e(e)?G_e:z_e;return t.test(B_e(e))}var X_e=K_e;function Y_e(e,t){return e?.[t]}var J_e=Y_e,Q_e=X_e,Z_e=J_e;function e2e(e,t){var r=Z_e(e,t);return Q_e(r)?r:void 0}var vx=e2e,t2e=vx,r2e=t2e(Object,"create"),g5=r2e,S8=g5;function n2e(){this.__data__=S8?S8(null):{},this.size=0}var a2e=n2e;function s2e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var o2e=s2e,i2e=g5,l2e="__lodash_hash_undefined__",c2e=Object.prototype,d2e=c2e.hasOwnProperty;function u2e(e){var t=this.__data__;if(i2e){var r=t[e];return r===l2e?void 0:r}return d2e.call(t,e)?t[e]:void 0}var f2e=u2e,m2e=g5,h2e=Object.prototype,p2e=h2e.hasOwnProperty;function g2e(e){var t=this.__data__;return m2e?t[e]!==void 0:p2e.call(t,e)}var x2e=g2e,v2e=g5,y2e="__lodash_hash_undefined__";function b2e(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=v2e&&t===void 0?y2e:t,this}var w2e=b2e,j2e=a2e,_2e=o2e,N2e=f2e,S2e=x2e,C2e=w2e;function uy(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}uy.prototype.clear=j2e;uy.prototype.delete=_2e;uy.prototype.get=N2e;uy.prototype.has=S2e;uy.prototype.set=C2e;var A2e=uy;function P2e(){this.__data__=[],this.size=0}var E2e=P2e;function k2e(e,t){return e===t||e!==e&&t!==t}var nM=k2e,I2e=nM;function O2e(e,t){for(var r=e.length;r--;)if(I2e(e[r][0],t))return r;return-1}var x5=O2e,T2e=x5,D2e=Array.prototype,M2e=D2e.splice;function R2e(e){var t=this.__data__,r=T2e(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():M2e.call(t,r,1),--this.size,!0}var F2e=R2e,L2e=x5;function $2e(e){var t=this.__data__,r=L2e(t,e);return r<0?void 0:t[r][1]}var B2e=$2e,q2e=x5;function z2e(e){return q2e(this.__data__,e)>-1}var U2e=z2e,V2e=x5;function W2e(e,t){var r=this.__data__,n=V2e(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var H2e=W2e,G2e=E2e,K2e=F2e,X2e=B2e,Y2e=U2e,J2e=H2e;function fy(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}fy.prototype.clear=G2e;fy.prototype.delete=K2e;fy.prototype.get=X2e;fy.prototype.has=Y2e;fy.prototype.set=J2e;var v5=fy,Q2e=vx,Z2e=Zf,eNe=Q2e(Z2e,"Map"),aM=eNe,C8=A2e,tNe=v5,rNe=aM;function nNe(){this.size=0,this.__data__={hash:new C8,map:new(rNe||tNe),string:new C8}}var aNe=nNe;function sNe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var oNe=sNe,iNe=oNe;function lNe(e,t){var r=e.__data__;return iNe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var y5=lNe,cNe=y5;function dNe(e){var t=cNe(this,e).delete(e);return this.size-=t?1:0,t}var uNe=dNe,fNe=y5;function mNe(e){return fNe(this,e).get(e)}var hNe=mNe,pNe=y5;function gNe(e){return pNe(this,e).has(e)}var xNe=gNe,vNe=y5;function yNe(e,t){var r=vNe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var bNe=yNe,wNe=aNe,jNe=uNe,_Ne=hNe,NNe=xNe,SNe=bNe;function my(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}my.prototype.clear=wNe;my.prototype.delete=jNe;my.prototype.get=_Ne;my.prototype.has=NNe;my.prototype.set=SNe;var sM=my,nJ=sM,CNe="Expected a function";function oM(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(CNe);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],o=r.cache;if(o.has(s))return o.get(s);var i=e.apply(this,n);return r.cache=o.set(s,i)||o,i};return r.cache=new(oM.Cache||nJ),r}oM.Cache=nJ;var aJ=oM;const ANe=Us(aJ);var PNe=aJ,ENe=500;function kNe(e){var t=PNe(e,function(n){return r.size===ENe&&r.clear(),n}),r=t.cache;return t}var INe=kNe,ONe=INe,TNe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,DNe=/\\(\\)?/g,MNe=ONe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(TNe,function(r,n,s,o){t.push(s?o.replace(DNe,"$1"):n||r)}),t}),RNe=MNe;function FNe(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var iM=FNe,A8=ij,LNe=iM,$Ne=Yc,BNe=cy,qNe=1/0,P8=A8?A8.prototype:void 0,E8=P8?P8.toString:void 0;function sJ(e){if(typeof e=="string")return e;if($Ne(e))return LNe(e,sJ)+"";if(BNe(e))return E8?E8.call(e):"";var t=e+"";return t=="0"&&1/e==-qNe?"-0":t}var zNe=sJ,UNe=zNe;function VNe(e){return e==null?"":UNe(e)}var oJ=VNe,WNe=Yc,HNe=tM,GNe=RNe,KNe=oJ;function XNe(e,t){return WNe(e)?e:HNe(e,t)?[e]:GNe(KNe(e))}var iJ=XNe,YNe=cy,JNe=1/0;function QNe(e){if(typeof e=="string"||YNe(e))return e;var t=e+"";return t=="0"&&1/e==-JNe?"-0":t}var b5=QNe,ZNe=iJ,eSe=b5;function tSe(e,t){t=ZNe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[eSe(t[r++])];return r&&r==n?e:void 0}var lM=tSe,rSe=lM;function nSe(e,t,r){var n=e==null?void 0:rSe(e,t);return n===void 0?r:n}var lJ=nSe;const kd=Us(lJ);function aSe(e){return e==null}var sSe=aSe;const ls=Us(sSe);var oSe=Jm,iSe=Yc,lSe=Qm,cSe="[object String]";function dSe(e){return typeof e=="string"||!iSe(e)&&lSe(e)&&oSe(e)==cSe}var uSe=dSe;const Zg=Us(uSe);var cJ={exports:{}},po={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cM=Symbol.for("react.element"),dM=Symbol.for("react.portal"),w5=Symbol.for("react.fragment"),j5=Symbol.for("react.strict_mode"),_5=Symbol.for("react.profiler"),N5=Symbol.for("react.provider"),S5=Symbol.for("react.context"),fSe=Symbol.for("react.server_context"),C5=Symbol.for("react.forward_ref"),A5=Symbol.for("react.suspense"),P5=Symbol.for("react.suspense_list"),E5=Symbol.for("react.memo"),k5=Symbol.for("react.lazy"),mSe=Symbol.for("react.offscreen"),dJ;dJ=Symbol.for("react.module.reference");function Su(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case cM:switch(e=e.type,e){case w5:case _5:case j5:case A5:case P5:return e;default:switch(e=e&&e.$$typeof,e){case fSe:case S5:case C5:case k5:case E5:case N5:return e;default:return t}}case dM:return t}}}po.ContextConsumer=S5;po.ContextProvider=N5;po.Element=cM;po.ForwardRef=C5;po.Fragment=w5;po.Lazy=k5;po.Memo=E5;po.Portal=dM;po.Profiler=_5;po.StrictMode=j5;po.Suspense=A5;po.SuspenseList=P5;po.isAsyncMode=function(){return!1};po.isConcurrentMode=function(){return!1};po.isContextConsumer=function(e){return Su(e)===S5};po.isContextProvider=function(e){return Su(e)===N5};po.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===cM};po.isForwardRef=function(e){return Su(e)===C5};po.isFragment=function(e){return Su(e)===w5};po.isLazy=function(e){return Su(e)===k5};po.isMemo=function(e){return Su(e)===E5};po.isPortal=function(e){return Su(e)===dM};po.isProfiler=function(e){return Su(e)===_5};po.isStrictMode=function(e){return Su(e)===j5};po.isSuspense=function(e){return Su(e)===A5};po.isSuspenseList=function(e){return Su(e)===P5};po.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===w5||e===_5||e===j5||e===A5||e===P5||e===mSe||typeof e=="object"&&e!==null&&(e.$$typeof===k5||e.$$typeof===E5||e.$$typeof===N5||e.$$typeof===S5||e.$$typeof===C5||e.$$typeof===dJ||e.getModuleId!==void 0)};po.typeOf=Su;cJ.exports=po;var hSe=cJ.exports,pSe=Jm,gSe=Qm,xSe="[object Number]";function vSe(e){return typeof e=="number"||gSe(e)&&pSe(e)==xSe}var uJ=vSe;const ySe=Us(uJ);var bSe=uJ;function wSe(e){return bSe(e)&&e!=+e}var jSe=wSe;const hy=Us(jSe);var hc=function(t){return t===0?0:t>0?1:-1},vg=function(t){return Zg(t)&&t.indexOf("%")===t.length-1},Mn=function(t){return ySe(t)&&!hy(t)},_Se=function(t){return ls(t)},Ki=function(t){return Mn(t)||Zg(t)},NSe=0,yx=function(t){var r=++NSe;return"".concat(t||"").concat(r)},pc=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Mn(t)&&!Zg(t))return n;var o;if(vg(t)){var i=t.indexOf("%");o=r*parseFloat(t.slice(0,i))/100}else o=+t;return hy(o)&&(o=n),s&&o>r&&(o=r),o},Ah=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},SSe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},s=0;s<r;s++)if(!n[t[s]])n[t[s]]=!0;else return!0;return!1},Hi=function(t,r){return Mn(t)&&Mn(r)?function(n){return t+n*(r-t)}:function(){return r}};function zN(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):kd(n,t))===r})}var CSe=function(t,r){return Mn(t)&&Mn(r)?t-r:Zg(t)&&Zg(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Kv(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function SO(e){"@babel/helpers - typeof";return SO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},SO(e)}var ASe=["viewBox","children"],PSe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],k8=["points","pathLength"],fE={svg:ASe,polygon:k8,polyline:k8},uM=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],UN=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(p.isValidElement(t)&&(n=t.props),!dy(n))return null;var s={};return Object.keys(n).forEach(function(o){uM.includes(o)&&(s[o]=r||function(i){return n[o](n,i)})}),s},ESe=function(t,r,n){return function(s){return t(r,n,s),null}},ex=function(t,r,n){if(!dy(t)||SO(t)!=="object")return null;var s=null;return Object.keys(t).forEach(function(o){var i=t[o];uM.includes(o)&&typeof i=="function"&&(s||(s={}),s[o]=ESe(i,r,n))}),s},kSe=["children"],ISe=["children"];function I8(e,t){if(e==null)return{};var r=OSe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function OSe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function CO(e){"@babel/helpers - typeof";return CO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},CO(e)}var O8={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Im=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},T8=null,mE=null,fM=function e(t){if(t===T8&&Array.isArray(mE))return mE;var r=[];return p.Children.forEach(t,function(n){ls(n)||(hSe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),mE=r,T8=t,r};function Id(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(s){return Im(s)}):n=[Im(t)],fM(e).forEach(function(s){var o=kd(s,"type.displayName")||kd(s,"type.name");n.indexOf(o)!==-1&&r.push(s)}),r}function xd(e,t){var r=Id(e,t);return r&&r[0]}var D8=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,s=r.height;return!(!Mn(n)||n<=0||!Mn(s)||s<=0)},TSe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],DSe=function(t){return t&&t.type&&Zg(t.type)&&TSe.indexOf(t.type)>=0},fJ=function(t){return t&&CO(t)==="object"&&"clipDot"in t},MSe=function(t,r,n,s){var o,i=(o=fE?.[s])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!Ja(t)&&(s&&i.includes(r)||PSe.includes(r))||n&&uM.includes(r)},Ra=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var s=t;if(p.isValidElement(t)&&(s=t.props),!dy(s))return null;var o={};return Object.keys(s).forEach(function(i){var l;MSe((l=s)===null||l===void 0?void 0:l[i],i,r,n)&&(o[i]=s[i])}),o},AO=function e(t,r){if(t===r)return!0;var n=p.Children.count(t);if(n!==p.Children.count(r))return!1;if(n===0)return!0;if(n===1)return M8(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var s=0;s<n;s++){var o=t[s],i=r[s];if(Array.isArray(o)||Array.isArray(i)){if(!e(o,i))return!1}else if(!M8(o,i))return!1}return!0},M8=function(t,r){if(ls(t)&&ls(r))return!0;if(!ls(t)&&!ls(r)){var n=t.props||{},s=n.children,o=I8(n,kSe),i=r.props||{},l=i.children,c=I8(i,ISe);return s&&l?Kv(o,c)&&AO(s,l):!s&&!l?Kv(o,c):!1}return!1},R8=function(t,r){var n=[],s={};return fM(t).forEach(function(o,i){if(DSe(o))n.push(o);else if(o){var l=Im(o.type),c=r[l]||{},d=c.handler,u=c.once;if(d&&(!u||!s[l])){var f=d(o,l,i);n.push(f),s[l]=!0}}}),n},RSe=function(t){var r=t&&t.type;return r&&O8[r]?O8[r]:null},FSe=function(t,r){return fM(r).indexOf(t)},LSe=["children","width","height","viewBox","className","style","title","desc"];function PO(){return PO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PO.apply(this,arguments)}function $Se(e,t){if(e==null)return{};var r=BSe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function BSe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function EO(e){var t=e.children,r=e.width,n=e.height,s=e.viewBox,o=e.className,i=e.style,l=e.title,c=e.desc,d=$Se(e,LSe),u=s||{width:r,height:n,x:0,y:0},f=us("recharts-surface",o);return Ce.createElement("svg",PO({},Ra(d,!0,"svg"),{className:f,width:r,height:n,style:i,viewBox:"".concat(u.x," ").concat(u.y," ").concat(u.width," ").concat(u.height)}),Ce.createElement("title",null,l),Ce.createElement("desc",null,c),t)}var qSe=["children","className"];function kO(){return kO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kO.apply(this,arguments)}function zSe(e,t){if(e==null)return{};var r=USe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function USe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var ks=Ce.forwardRef(function(e,t){var r=e.children,n=e.className,s=zSe(e,qSe),o=us("recharts-layer",n);return Ce.createElement("g",kO({className:o},Ra(s,!0),{ref:t}),r)}),rf=function(t,r){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o]};function VSe(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),r=r>s?s:r,r<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(s);++n<s;)o[n]=e[n+t];return o}var WSe=VSe,HSe=WSe;function GSe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:HSe(e,t,r)}var KSe=GSe,XSe="\\ud800-\\udfff",YSe="\\u0300-\\u036f",JSe="\\ufe20-\\ufe2f",QSe="\\u20d0-\\u20ff",ZSe=YSe+JSe+QSe,eCe="\\ufe0e\\ufe0f",tCe="\\u200d",rCe=RegExp("["+tCe+XSe+ZSe+eCe+"]");function nCe(e){return rCe.test(e)}var mJ=nCe;function aCe(e){return e.split("")}var sCe=aCe,hJ="\\ud800-\\udfff",oCe="\\u0300-\\u036f",iCe="\\ufe20-\\ufe2f",lCe="\\u20d0-\\u20ff",cCe=oCe+iCe+lCe,dCe="\\ufe0e\\ufe0f",uCe="["+hJ+"]",IO="["+cCe+"]",OO="\\ud83c[\\udffb-\\udfff]",fCe="(?:"+IO+"|"+OO+")",pJ="[^"+hJ+"]",gJ="(?:\\ud83c[\\udde6-\\uddff]){2}",xJ="[\\ud800-\\udbff][\\udc00-\\udfff]",mCe="\\u200d",vJ=fCe+"?",yJ="["+dCe+"]?",hCe="(?:"+mCe+"(?:"+[pJ,gJ,xJ].join("|")+")"+yJ+vJ+")*",pCe=yJ+vJ+hCe,gCe="(?:"+[pJ+IO+"?",IO,gJ,xJ,uCe].join("|")+")",xCe=RegExp(OO+"(?="+OO+")|"+gCe+pCe,"g");function vCe(e){return e.match(xCe)||[]}var yCe=vCe,bCe=sCe,wCe=mJ,jCe=yCe;function _Ce(e){return wCe(e)?jCe(e):bCe(e)}var NCe=_Ce,SCe=KSe,CCe=mJ,ACe=NCe,PCe=oJ;function ECe(e){return function(t){t=PCe(t);var r=CCe(t)?ACe(t):void 0,n=r?r[0]:t.charAt(0),s=r?SCe(r,1).join(""):t.slice(1);return n[e]()+s}}var kCe=ECe,ICe=kCe,OCe=ICe("toUpperCase"),TCe=OCe;const I5=Us(TCe);function Eo(e){return function(){return e}}const bJ=Math.cos,VN=Math.sin,mf=Math.sqrt,WN=Math.PI,O5=2*WN,TO=Math.PI,DO=2*TO,ng=1e-6,DCe=DO-ng;function wJ(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function MCe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return wJ;const r=10**t;return function(n){this._+=n[0];for(let s=1,o=n.length;s<o;++s)this._+=Math.round(arguments[s]*r)/r+n[s]}}class RCe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?wJ:MCe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,s){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+s}`}bezierCurveTo(t,r,n,s,o,i){this._append`C${+t},${+r},${+n},${+s},${this._x1=+o},${this._y1=+i}`}arcTo(t,r,n,s,o){if(t=+t,r=+r,n=+n,s=+s,o=+o,o<0)throw new Error(`negative radius: ${o}`);let i=this._x1,l=this._y1,c=n-t,d=s-r,u=i-t,f=l-r,h=u*u+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>ng)if(!(Math.abs(f*c-d*u)>ng)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let m=n-i,x=s-l,g=c*c+d*d,v=m*m+x*x,y=Math.sqrt(g),b=Math.sqrt(h),w=o*Math.tan((TO-Math.acos((g+h-v)/(2*y*b)))/2),j=w/b,_=w/y;Math.abs(j-1)>ng&&this._append`L${t+j*u},${r+j*f}`,this._append`A${o},${o},0,0,${+(f*m>u*x)},${this._x1=t+_*c},${this._y1=r+_*d}`}}arc(t,r,n,s,o,i){if(t=+t,r=+r,n=+n,i=!!i,n<0)throw new Error(`negative radius: ${n}`);let l=n*Math.cos(s),c=n*Math.sin(s),d=t+l,u=r+c,f=1^i,h=i?s-o:o-s;this._x1===null?this._append`M${d},${u}`:(Math.abs(this._x1-d)>ng||Math.abs(this._y1-u)>ng)&&this._append`L${d},${u}`,n&&(h<0&&(h=h%DO+DO),h>DCe?this._append`A${n},${n},0,1,${f},${t-l},${r-c}A${n},${n},0,1,${f},${this._x1=d},${this._y1=u}`:h>ng&&this._append`A${n},${n},0,${+(h>=TO)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+s}h${-n}Z`}toString(){return this._}}function mM(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new RCe(t)}function hM(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function jJ(e){this._context=e}jJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function T5(e){return new jJ(e)}function _J(e){return e[0]}function NJ(e){return e[1]}function SJ(e,t){var r=Eo(!0),n=null,s=T5,o=null,i=mM(l);e=typeof e=="function"?e:e===void 0?_J:Eo(e),t=typeof t=="function"?t:t===void 0?NJ:Eo(t);function l(c){var d,u=(c=hM(c)).length,f,h=!1,m;for(n==null&&(o=s(m=i())),d=0;d<=u;++d)!(d<u&&r(f=c[d],d,c))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(f,d,c),+t(f,d,c));if(m)return o=null,m+""||null}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:Eo(+c),l):e},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:Eo(+c),l):t},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:Eo(!!c),l):r},l.curve=function(c){return arguments.length?(s=c,n!=null&&(o=s(n)),l):s},l.context=function(c){return arguments.length?(c==null?n=o=null:o=s(n=c),l):n},l}function k_(e,t,r){var n=null,s=Eo(!0),o=null,i=T5,l=null,c=mM(d);e=typeof e=="function"?e:e===void 0?_J:Eo(+e),t=typeof t=="function"?t:Eo(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?NJ:Eo(+r);function d(f){var h,m,x,g=(f=hM(f)).length,v,y=!1,b,w=new Array(g),j=new Array(g);for(o==null&&(l=i(b=c())),h=0;h<=g;++h){if(!(h<g&&s(v=f[h],h,f))===y)if(y=!y)m=h,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),x=h-1;x>=m;--x)l.point(w[x],j[x]);l.lineEnd(),l.areaEnd()}y&&(w[h]=+e(v,h,f),j[h]=+t(v,h,f),l.point(n?+n(v,h,f):w[h],r?+r(v,h,f):j[h]))}if(b)return l=null,b+""||null}function u(){return SJ().defined(s).curve(i).context(o)}return d.x=function(f){return arguments.length?(e=typeof f=="function"?f:Eo(+f),n=null,d):e},d.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Eo(+f),d):e},d.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Eo(+f),d):n},d.y=function(f){return arguments.length?(t=typeof f=="function"?f:Eo(+f),r=null,d):t},d.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Eo(+f),d):t},d.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Eo(+f),d):r},d.lineX0=d.lineY0=function(){return u().x(e).y(t)},d.lineY1=function(){return u().x(e).y(r)},d.lineX1=function(){return u().x(n).y(t)},d.defined=function(f){return arguments.length?(s=typeof f=="function"?f:Eo(!!f),d):s},d.curve=function(f){return arguments.length?(i=f,o!=null&&(l=i(o)),d):i},d.context=function(f){return arguments.length?(f==null?o=l=null:l=i(o=f),d):o},d}class CJ{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function FCe(e){return new CJ(e,!0)}function LCe(e){return new CJ(e,!1)}const pM={draw(e,t){const r=mf(t/WN);e.moveTo(r,0),e.arc(0,0,r,0,O5)}},$Ce={draw(e,t){const r=mf(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},AJ=mf(1/3),BCe=AJ*2,qCe={draw(e,t){const r=mf(t/BCe),n=r*AJ;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},zCe={draw(e,t){const r=mf(t),n=-r/2;e.rect(n,n,r,r)}},UCe=.8908130915292852,PJ=VN(WN/10)/VN(7*WN/10),VCe=VN(O5/10)*PJ,WCe=-bJ(O5/10)*PJ,HCe={draw(e,t){const r=mf(t*UCe),n=VCe*r,s=WCe*r;e.moveTo(0,-r),e.lineTo(n,s);for(let o=1;o<5;++o){const i=O5*o/5,l=bJ(i),c=VN(i);e.lineTo(c*r,-l*r),e.lineTo(l*n-c*s,c*n+l*s)}e.closePath()}},hE=mf(3),GCe={draw(e,t){const r=-mf(t/(hE*3));e.moveTo(0,r*2),e.lineTo(-hE*r,-r),e.lineTo(hE*r,-r),e.closePath()}},Gd=-.5,Kd=mf(3)/2,MO=1/mf(12),KCe=(MO/2+1)*3,XCe={draw(e,t){const r=mf(t/KCe),n=r/2,s=r*MO,o=n,i=r*MO+r,l=-o,c=i;e.moveTo(n,s),e.lineTo(o,i),e.lineTo(l,c),e.lineTo(Gd*n-Kd*s,Kd*n+Gd*s),e.lineTo(Gd*o-Kd*i,Kd*o+Gd*i),e.lineTo(Gd*l-Kd*c,Kd*l+Gd*c),e.lineTo(Gd*n+Kd*s,Gd*s-Kd*n),e.lineTo(Gd*o+Kd*i,Gd*i-Kd*o),e.lineTo(Gd*l+Kd*c,Gd*c-Kd*l),e.closePath()}};function YCe(e,t){let r=null,n=mM(s);e=typeof e=="function"?e:Eo(e||pM),t=typeof t=="function"?t:Eo(t===void 0?64:+t);function s(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return s.type=function(o){return arguments.length?(e=typeof o=="function"?o:Eo(o),s):e},s.size=function(o){return arguments.length?(t=typeof o=="function"?o:Eo(+o),s):t},s.context=function(o){return arguments.length?(r=o??null,s):r},s}function HN(){}function GN(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function EJ(e){this._context=e}EJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:GN(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:GN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function JCe(e){return new EJ(e)}function kJ(e){this._context=e}kJ.prototype={areaStart:HN,areaEnd:HN,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:GN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function QCe(e){return new kJ(e)}function IJ(e){this._context=e}IJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:GN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function ZCe(e){return new IJ(e)}function OJ(e){this._context=e}OJ.prototype={areaStart:HN,areaEnd:HN,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function e5e(e){return new OJ(e)}function F8(e){return e<0?-1:1}function L8(e,t,r){var n=e._x1-e._x0,s=t-e._x1,o=(e._y1-e._y0)/(n||s<0&&-0),i=(r-e._y1)/(s||n<0&&-0),l=(o*s+i*n)/(n+s);return(F8(o)+F8(i))*Math.min(Math.abs(o),Math.abs(i),.5*Math.abs(l))||0}function $8(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function pE(e,t,r){var n=e._x0,s=e._y0,o=e._x1,i=e._y1,l=(o-n)/3;e._context.bezierCurveTo(n+l,s+l*t,o-l,i-l*r,o,i)}function KN(e){this._context=e}KN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:pE(this,this._t0,$8(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,pE(this,$8(this,r=L8(this,e,t)),r);break;default:pE(this,this._t0,r=L8(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function TJ(e){this._context=new DJ(e)}(TJ.prototype=Object.create(KN.prototype)).point=function(e,t){KN.prototype.point.call(this,t,e)};function DJ(e){this._context=e}DJ.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,s,o){this._context.bezierCurveTo(t,e,n,r,o,s)}};function t5e(e){return new KN(e)}function r5e(e){return new TJ(e)}function MJ(e){this._context=e}MJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=B8(e),s=B8(t),o=0,i=1;i<r;++o,++i)this._context.bezierCurveTo(n[0][o],s[0][o],n[1][o],s[1][o],e[i],t[i]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function B8(e){var t,r=e.length-1,n,s=new Array(r),o=new Array(r),i=new Array(r);for(s[0]=0,o[0]=2,i[0]=e[0]+2*e[1],t=1;t<r-1;++t)s[t]=1,o[t]=4,i[t]=4*e[t]+2*e[t+1];for(s[r-1]=2,o[r-1]=7,i[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=s[t]/o[t-1],o[t]-=n,i[t]-=n*i[t-1];for(s[r-1]=i[r-1]/o[r-1],t=r-2;t>=0;--t)s[t]=(i[t]-s[t+1])/o[t];for(o[r-1]=(e[r]+s[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-s[t+1];return[s,o]}function n5e(e){return new MJ(e)}function D5(e,t){this._context=e,this._t=t}D5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function a5e(e){return new D5(e,.5)}function s5e(e){return new D5(e,0)}function o5e(e){return new D5(e,1)}function x0(e,t){if((i=e.length)>1)for(var r=1,n,s,o=e[t[0]],i,l=o.length;r<i;++r)for(s=o,o=e[t[r]],n=0;n<l;++n)o[n][1]+=o[n][0]=isNaN(s[n][1])?s[n][0]:s[n][1]}function RO(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function i5e(e,t){return e[t]}function l5e(e){const t=[];return t.key=e,t}function c5e(){var e=Eo([]),t=RO,r=x0,n=i5e;function s(o){var i=Array.from(e.apply(this,arguments),l5e),l,c=i.length,d=-1,u;for(const f of o)for(l=0,++d;l<c;++l)(i[l][d]=[0,+n(f,i[l].key,d,o)]).data=f;for(l=0,u=hM(t(i));l<c;++l)i[u[l]].index=l;return r(i,u),i}return s.keys=function(o){return arguments.length?(e=typeof o=="function"?o:Eo(Array.from(o)),s):e},s.value=function(o){return arguments.length?(n=typeof o=="function"?o:Eo(+o),s):n},s.order=function(o){return arguments.length?(t=o==null?RO:typeof o=="function"?o:Eo(Array.from(o)),s):t},s.offset=function(o){return arguments.length?(r=o??x0,s):r},s}function d5e(e,t){if((n=e.length)>0){for(var r,n,s=0,o=e[0].length,i;s<o;++s){for(i=r=0;r<n;++r)i+=e[r][s][1]||0;if(i)for(r=0;r<n;++r)e[r][s][1]/=i}x0(e,t)}}function u5e(e,t){if((s=e.length)>0){for(var r=0,n=e[t[0]],s,o=n.length;r<o;++r){for(var i=0,l=0;i<s;++i)l+=e[i][r][1]||0;n[r][1]+=n[r][0]=-l/2}x0(e,t)}}function f5e(e,t){if(!(!((i=e.length)>0)||!((o=(s=e[t[0]]).length)>0))){for(var r=0,n=1,s,o,i;n<o;++n){for(var l=0,c=0,d=0;l<i;++l){for(var u=e[t[l]],f=u[n][1]||0,h=u[n-1][1]||0,m=(f-h)/2,x=0;x<l;++x){var g=e[t[x]],v=g[n][1]||0,y=g[n-1][1]||0;m+=v-y}c+=f,d+=m*f}s[n-1][1]+=s[n-1][0]=r,c&&(r-=d/c)}s[n-1][1]+=s[n-1][0]=r,x0(e,t)}}function Vw(e){"@babel/helpers - typeof";return Vw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vw(e)}var m5e=["type","size","sizeType"];function FO(){return FO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},FO.apply(this,arguments)}function q8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function z8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q8(Object(r),!0).forEach(function(n){h5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h5e(e,t,r){return t=p5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p5e(e){var t=g5e(e,"string");return Vw(t)=="symbol"?t:t+""}function g5e(e,t){if(Vw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Vw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function x5e(e,t){if(e==null)return{};var r=v5e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function v5e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var RJ={symbolCircle:pM,symbolCross:$Ce,symbolDiamond:qCe,symbolSquare:zCe,symbolStar:HCe,symbolTriangle:GCe,symbolWye:XCe},y5e=Math.PI/180,b5e=function(t){var r="symbol".concat(I5(t));return RJ[r]||pM},w5e=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var s=18*y5e;return 1.25*t*t*(Math.tan(s)-Math.tan(s*2)*Math.pow(Math.tan(s),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},j5e=function(t,r){RJ["symbol".concat(I5(t))]=r},gM=function(t){var r=t.type,n=r===void 0?"circle":r,s=t.size,o=s===void 0?64:s,i=t.sizeType,l=i===void 0?"area":i,c=x5e(t,m5e),d=z8(z8({},c),{},{type:n,size:o,sizeType:l}),u=function(){var v=b5e(n),y=YCe().type(v).size(w5e(o,l,n));return y()},f=d.className,h=d.cx,m=d.cy,x=Ra(d,!0);return h===+h&&m===+m&&o===+o?Ce.createElement("path",FO({},x,{className:us("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(m,")"),d:u()})):null};gM.registerSymbol=j5e;function v0(e){"@babel/helpers - typeof";return v0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v0(e)}function LO(){return LO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},LO.apply(this,arguments)}function U8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function _5e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U8(Object(r),!0).forEach(function(n){Ww(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U8(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function N5e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,LJ(n.key),n)}}function S5e(e,t,r){return t&&V8(e.prototype,t),r&&V8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function C5e(e,t,r){return t=XN(t),A5e(e,FJ()?Reflect.construct(t,r||[],XN(e).constructor):t.apply(e,r))}function A5e(e,t){if(t&&(v0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return P5e(e)}function P5e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function FJ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(FJ=function(){return!!e})()}function XN(e){return XN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},XN(e)}function E5e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$O(e,t)}function $O(e,t){return $O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},$O(e,t)}function Ww(e,t,r){return t=LJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function LJ(e){var t=k5e(e,"string");return v0(t)=="symbol"?t:t+""}function k5e(e,t){if(v0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(v0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Xd=32,xM=function(e){function t(){return N5e(this,t),C5e(this,t,arguments)}return E5e(t,e),S5e(t,[{key:"renderIcon",value:function(n){var s=this.props.inactiveColor,o=Xd/2,i=Xd/6,l=Xd/3,c=n.inactive?s:n.color;if(n.type==="plainline")return Ce.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Xd,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ce.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(o,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(o,`
            H`).concat(Xd,"M").concat(2*l,",").concat(o,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ce.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(Xd/8,"h").concat(Xd,"v").concat(Xd*3/4,"h").concat(-Xd,"z"),className:"recharts-legend-icon"});if(Ce.isValidElement(n.legendIcon)){var d=_5e({},n);return delete d.legendIcon,Ce.cloneElement(n.legendIcon,d)}return Ce.createElement(gM,{fill:c,cx:o,cy:o,size:Xd,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,s=this.props,o=s.payload,i=s.iconSize,l=s.layout,c=s.formatter,d=s.inactiveColor,u={x:0,y:0,width:Xd,height:Xd},f={display:l==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(m,x){var g=m.formatter||c,v=us(Ww(Ww({"recharts-legend-item":!0},"legend-item-".concat(x),!0),"inactive",m.inactive));if(m.type==="none")return null;var y=Ja(m.value)?null:m.value;rf(!Ja(m.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var b=m.inactive?d:m.color;return Ce.createElement("li",LO({className:v,style:f,key:"legend-item-".concat(x)},ex(n.props,m,x)),Ce.createElement(EO,{width:i,height:i,viewBox:u,style:h},n.renderIcon(m)),Ce.createElement("span",{className:"recharts-legend-item-text",style:{color:b}},g?g(y,m,x):y))})}},{key:"render",value:function(){var n=this.props,s=n.payload,o=n.layout,i=n.align;if(!s||!s.length)return null;var l={padding:0,margin:0,textAlign:o==="horizontal"?i:"left"};return Ce.createElement("ul",{className:"recharts-default-legend",style:l},this.renderItems())}}])}(p.PureComponent);Ww(xM,"displayName","Legend");Ww(xM,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var I5e=v5;function O5e(){this.__data__=new I5e,this.size=0}var T5e=O5e;function D5e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var M5e=D5e;function R5e(e){return this.__data__.get(e)}var F5e=R5e;function L5e(e){return this.__data__.has(e)}var $5e=L5e,B5e=v5,q5e=aM,z5e=sM,U5e=200;function V5e(e,t){var r=this.__data__;if(r instanceof B5e){var n=r.__data__;if(!q5e||n.length<U5e-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new z5e(n)}return r.set(e,t),this.size=r.size,this}var W5e=V5e,H5e=v5,G5e=T5e,K5e=M5e,X5e=F5e,Y5e=$5e,J5e=W5e;function py(e){var t=this.__data__=new H5e(e);this.size=t.size}py.prototype.clear=G5e;py.prototype.delete=K5e;py.prototype.get=X5e;py.prototype.has=Y5e;py.prototype.set=J5e;var $J=py,Q5e="__lodash_hash_undefined__";function Z5e(e){return this.__data__.set(e,Q5e),this}var eAe=Z5e;function tAe(e){return this.__data__.has(e)}var rAe=tAe,nAe=sM,aAe=eAe,sAe=rAe;function YN(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new nAe;++t<r;)this.add(e[t])}YN.prototype.add=YN.prototype.push=aAe;YN.prototype.has=sAe;var BJ=YN;function oAe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var qJ=oAe;function iAe(e,t){return e.has(t)}var zJ=iAe,lAe=BJ,cAe=qJ,dAe=zJ,uAe=1,fAe=2;function mAe(e,t,r,n,s,o){var i=r&uAe,l=e.length,c=t.length;if(l!=c&&!(i&&c>l))return!1;var d=o.get(e),u=o.get(t);if(d&&u)return d==t&&u==e;var f=-1,h=!0,m=r&fAe?new lAe:void 0;for(o.set(e,t),o.set(t,e);++f<l;){var x=e[f],g=t[f];if(n)var v=i?n(g,x,f,t,e,o):n(x,g,f,e,t,o);if(v!==void 0){if(v)continue;h=!1;break}if(m){if(!cAe(t,function(y,b){if(!dAe(m,b)&&(x===y||s(x,y,r,n,o)))return m.push(b)})){h=!1;break}}else if(!(x===g||s(x,g,r,n,o))){h=!1;break}}return o.delete(e),o.delete(t),h}var UJ=mAe,hAe=Zf,pAe=hAe.Uint8Array,gAe=pAe;function xAe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,s){r[++t]=[s,n]}),r}var vAe=xAe;function yAe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var vM=yAe,W8=ij,H8=gAe,bAe=nM,wAe=UJ,jAe=vAe,_Ae=vM,NAe=1,SAe=2,CAe="[object Boolean]",AAe="[object Date]",PAe="[object Error]",EAe="[object Map]",kAe="[object Number]",IAe="[object RegExp]",OAe="[object Set]",TAe="[object String]",DAe="[object Symbol]",MAe="[object ArrayBuffer]",RAe="[object DataView]",G8=W8?W8.prototype:void 0,gE=G8?G8.valueOf:void 0;function FAe(e,t,r,n,s,o,i){switch(r){case RAe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case MAe:return!(e.byteLength!=t.byteLength||!o(new H8(e),new H8(t)));case CAe:case AAe:case kAe:return bAe(+e,+t);case PAe:return e.name==t.name&&e.message==t.message;case IAe:case TAe:return e==t+"";case EAe:var l=jAe;case OAe:var c=n&NAe;if(l||(l=_Ae),e.size!=t.size&&!c)return!1;var d=i.get(e);if(d)return d==t;n|=SAe,i.set(e,t);var u=wAe(l(e),l(t),n,s,o,i);return i.delete(e),u;case DAe:if(gE)return gE.call(e)==gE.call(t)}return!1}var LAe=FAe;function $Ae(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var VJ=$Ae,BAe=VJ,qAe=Yc;function zAe(e,t,r){var n=t(e);return qAe(e)?n:BAe(n,r(e))}var UAe=zAe;function VAe(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[s++]=i)}return o}var WAe=VAe;function HAe(){return[]}var GAe=HAe,KAe=WAe,XAe=GAe,YAe=Object.prototype,JAe=YAe.propertyIsEnumerable,K8=Object.getOwnPropertySymbols,QAe=K8?function(e){return e==null?[]:(e=Object(e),KAe(K8(e),function(t){return JAe.call(e,t)}))}:XAe,ZAe=QAe;function ePe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var tPe=ePe,rPe=Jm,nPe=Qm,aPe="[object Arguments]";function sPe(e){return nPe(e)&&rPe(e)==aPe}var oPe=sPe,X8=oPe,iPe=Qm,WJ=Object.prototype,lPe=WJ.hasOwnProperty,cPe=WJ.propertyIsEnumerable,dPe=X8(function(){return arguments}())?X8:function(e){return iPe(e)&&lPe.call(e,"callee")&&!cPe.call(e,"callee")},yM=dPe,JN={exports:{}};function uPe(){return!1}var fPe=uPe;JN.exports;(function(e,t){var r=Zf,n=fPe,s=t&&!t.nodeType&&t,o=s&&!0&&e&&!e.nodeType&&e,i=o&&o.exports===s,l=i?r.Buffer:void 0,c=l?l.isBuffer:void 0,d=c||n;e.exports=d})(JN,JN.exports);var HJ=JN.exports,mPe=9007199254740991,hPe=/^(?:0|[1-9]\d*)$/;function pPe(e,t){var r=typeof e;return t=t??mPe,!!t&&(r=="number"||r!="symbol"&&hPe.test(e))&&e>-1&&e%1==0&&e<t}var bM=pPe,gPe=9007199254740991;function xPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=gPe}var wM=xPe,vPe=Jm,yPe=wM,bPe=Qm,wPe="[object Arguments]",jPe="[object Array]",_Pe="[object Boolean]",NPe="[object Date]",SPe="[object Error]",CPe="[object Function]",APe="[object Map]",PPe="[object Number]",EPe="[object Object]",kPe="[object RegExp]",IPe="[object Set]",OPe="[object String]",TPe="[object WeakMap]",DPe="[object ArrayBuffer]",MPe="[object DataView]",RPe="[object Float32Array]",FPe="[object Float64Array]",LPe="[object Int8Array]",$Pe="[object Int16Array]",BPe="[object Int32Array]",qPe="[object Uint8Array]",zPe="[object Uint8ClampedArray]",UPe="[object Uint16Array]",VPe="[object Uint32Array]",Lo={};Lo[RPe]=Lo[FPe]=Lo[LPe]=Lo[$Pe]=Lo[BPe]=Lo[qPe]=Lo[zPe]=Lo[UPe]=Lo[VPe]=!0;Lo[wPe]=Lo[jPe]=Lo[DPe]=Lo[_Pe]=Lo[MPe]=Lo[NPe]=Lo[SPe]=Lo[CPe]=Lo[APe]=Lo[PPe]=Lo[EPe]=Lo[kPe]=Lo[IPe]=Lo[OPe]=Lo[TPe]=!1;function WPe(e){return bPe(e)&&yPe(e.length)&&!!Lo[vPe(e)]}var HPe=WPe;function GPe(e){return function(t){return e(t)}}var GJ=GPe,QN={exports:{}};QN.exports;(function(e,t){var r=eJ,n=t&&!t.nodeType&&t,s=n&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===n,i=o&&r.process,l=function(){try{var c=s&&s.require&&s.require("util").types;return c||i&&i.binding&&i.binding("util")}catch{}}();e.exports=l})(QN,QN.exports);var KPe=QN.exports,XPe=HPe,YPe=GJ,Y8=KPe,J8=Y8&&Y8.isTypedArray,JPe=J8?YPe(J8):XPe,KJ=JPe,QPe=tPe,ZPe=yM,eEe=Yc,tEe=HJ,rEe=bM,nEe=KJ,aEe=Object.prototype,sEe=aEe.hasOwnProperty;function oEe(e,t){var r=eEe(e),n=!r&&ZPe(e),s=!r&&!n&&tEe(e),o=!r&&!n&&!s&&nEe(e),i=r||n||s||o,l=i?QPe(e.length,String):[],c=l.length;for(var d in e)(t||sEe.call(e,d))&&!(i&&(d=="length"||s&&(d=="offset"||d=="parent")||o&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||rEe(d,c)))&&l.push(d);return l}var iEe=oEe,lEe=Object.prototype;function cEe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||lEe;return e===r}var dEe=cEe;function uEe(e,t){return function(r){return e(t(r))}}var XJ=uEe,fEe=XJ,mEe=fEe(Object.keys,Object),hEe=mEe,pEe=dEe,gEe=hEe,xEe=Object.prototype,vEe=xEe.hasOwnProperty;function yEe(e){if(!pEe(e))return gEe(e);var t=[];for(var r in Object(e))vEe.call(e,r)&&r!="constructor"&&t.push(r);return t}var bEe=yEe,wEe=rM,jEe=wM;function _Ee(e){return e!=null&&jEe(e.length)&&!wEe(e)}var lj=_Ee,NEe=iEe,SEe=bEe,CEe=lj;function AEe(e){return CEe(e)?NEe(e):SEe(e)}var M5=AEe,PEe=UAe,EEe=ZAe,kEe=M5;function IEe(e){return PEe(e,kEe,EEe)}var OEe=IEe,Q8=OEe,TEe=1,DEe=Object.prototype,MEe=DEe.hasOwnProperty;function REe(e,t,r,n,s,o){var i=r&TEe,l=Q8(e),c=l.length,d=Q8(t),u=d.length;if(c!=u&&!i)return!1;for(var f=c;f--;){var h=l[f];if(!(i?h in t:MEe.call(t,h)))return!1}var m=o.get(e),x=o.get(t);if(m&&x)return m==t&&x==e;var g=!0;o.set(e,t),o.set(t,e);for(var v=i;++f<c;){h=l[f];var y=e[h],b=t[h];if(n)var w=i?n(b,y,h,t,e,o):n(y,b,h,e,t,o);if(!(w===void 0?y===b||s(y,b,r,n,o):w)){g=!1;break}v||(v=h=="constructor")}if(g&&!v){var j=e.constructor,_=t.constructor;j!=_&&"constructor"in e&&"constructor"in t&&!(typeof j=="function"&&j instanceof j&&typeof _=="function"&&_ instanceof _)&&(g=!1)}return o.delete(e),o.delete(t),g}var FEe=REe,LEe=vx,$Ee=Zf,BEe=LEe($Ee,"DataView"),qEe=BEe,zEe=vx,UEe=Zf,VEe=zEe(UEe,"Promise"),WEe=VEe,HEe=vx,GEe=Zf,KEe=HEe(GEe,"Set"),YJ=KEe,XEe=vx,YEe=Zf,JEe=XEe(YEe,"WeakMap"),QEe=JEe,BO=qEe,qO=aM,zO=WEe,UO=YJ,VO=QEe,JJ=Jm,gy=rJ,Z8="[object Map]",ZEe="[object Object]",eB="[object Promise]",tB="[object Set]",rB="[object WeakMap]",nB="[object DataView]",eke=gy(BO),tke=gy(qO),rke=gy(zO),nke=gy(UO),ake=gy(VO),ag=JJ;(BO&&ag(new BO(new ArrayBuffer(1)))!=nB||qO&&ag(new qO)!=Z8||zO&&ag(zO.resolve())!=eB||UO&&ag(new UO)!=tB||VO&&ag(new VO)!=rB)&&(ag=function(e){var t=JJ(e),r=t==ZEe?e.constructor:void 0,n=r?gy(r):"";if(n)switch(n){case eke:return nB;case tke:return Z8;case rke:return eB;case nke:return tB;case ake:return rB}return t});var ske=ag,xE=$J,oke=UJ,ike=LAe,lke=FEe,aB=ske,sB=Yc,oB=HJ,cke=KJ,dke=1,iB="[object Arguments]",lB="[object Array]",I_="[object Object]",uke=Object.prototype,cB=uke.hasOwnProperty;function fke(e,t,r,n,s,o){var i=sB(e),l=sB(t),c=i?lB:aB(e),d=l?lB:aB(t);c=c==iB?I_:c,d=d==iB?I_:d;var u=c==I_,f=d==I_,h=c==d;if(h&&oB(e)){if(!oB(t))return!1;i=!0,u=!1}if(h&&!u)return o||(o=new xE),i||cke(e)?oke(e,t,r,n,s,o):ike(e,t,c,r,n,s,o);if(!(r&dke)){var m=u&&cB.call(e,"__wrapped__"),x=f&&cB.call(t,"__wrapped__");if(m||x){var g=m?e.value():e,v=x?t.value():t;return o||(o=new xE),s(g,v,r,n,o)}}return h?(o||(o=new xE),lke(e,t,r,n,s,o)):!1}var mke=fke,hke=mke,dB=Qm;function QJ(e,t,r,n,s){return e===t?!0:e==null||t==null||!dB(e)&&!dB(t)?e!==e&&t!==t:hke(e,t,r,n,QJ,s)}var jM=QJ,pke=$J,gke=jM,xke=1,vke=2;function yke(e,t,r,n){var s=r.length,o=s,i=!n;if(e==null)return!o;for(e=Object(e);s--;){var l=r[s];if(i&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++s<o;){l=r[s];var c=l[0],d=e[c],u=l[1];if(i&&l[2]){if(d===void 0&&!(c in e))return!1}else{var f=new pke;if(n)var h=n(d,u,c,e,t,f);if(!(h===void 0?gke(u,d,xke|vke,n,f):h))return!1}}return!0}var bke=yke,wke=Ip;function jke(e){return e===e&&!wke(e)}var ZJ=jke,_ke=ZJ,Nke=M5;function Ske(e){for(var t=Nke(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,_ke(s)]}return t}var Cke=Ske;function Ake(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var eQ=Ake,Pke=bke,Eke=Cke,kke=eQ;function Ike(e){var t=Eke(e);return t.length==1&&t[0][2]?kke(t[0][0],t[0][1]):function(r){return r===e||Pke(r,e,t)}}var Oke=Ike;function Tke(e,t){return e!=null&&t in Object(e)}var Dke=Tke,Mke=iJ,Rke=yM,Fke=Yc,Lke=bM,$ke=wM,Bke=b5;function qke(e,t,r){t=Mke(t,e);for(var n=-1,s=t.length,o=!1;++n<s;){var i=Bke(t[n]);if(!(o=e!=null&&r(e,i)))break;e=e[i]}return o||++n!=s?o:(s=e==null?0:e.length,!!s&&$ke(s)&&Lke(i,s)&&(Fke(e)||Rke(e)))}var zke=qke,Uke=Dke,Vke=zke;function Wke(e,t){return e!=null&&Vke(e,t,Uke)}var Hke=Wke,Gke=jM,Kke=lJ,Xke=Hke,Yke=tM,Jke=ZJ,Qke=eQ,Zke=b5,eIe=1,tIe=2;function rIe(e,t){return Yke(e)&&Jke(t)?Qke(Zke(e),t):function(r){var n=Kke(r,e);return n===void 0&&n===t?Xke(r,e):Gke(t,n,eIe|tIe)}}var nIe=rIe;function aIe(e){return e}var xy=aIe;function sIe(e){return function(t){return t?.[e]}}var oIe=sIe,iIe=lM;function lIe(e){return function(t){return iIe(t,e)}}var cIe=lIe,dIe=oIe,uIe=cIe,fIe=tM,mIe=b5;function hIe(e){return fIe(e)?dIe(mIe(e)):uIe(e)}var pIe=hIe,gIe=Oke,xIe=nIe,vIe=xy,yIe=Yc,bIe=pIe;function wIe(e){return typeof e=="function"?e:e==null?vIe:typeof e=="object"?yIe(e)?xIe(e[0],e[1]):gIe(e):bIe(e)}var em=wIe;function jIe(e,t,r,n){for(var s=e.length,o=r+(n?1:-1);n?o--:++o<s;)if(t(e[o],o,e))return o;return-1}var tQ=jIe;function _Ie(e){return e!==e}var NIe=_Ie;function SIe(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}var CIe=SIe,AIe=tQ,PIe=NIe,EIe=CIe;function kIe(e,t,r){return t===t?EIe(e,t,r):AIe(e,PIe,r)}var IIe=kIe,OIe=IIe;function TIe(e,t){var r=e==null?0:e.length;return!!r&&OIe(e,t,0)>-1}var DIe=TIe;function MIe(e,t,r){for(var n=-1,s=e==null?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}var RIe=MIe;function FIe(){}var LIe=FIe,vE=YJ,$Ie=LIe,BIe=vM,qIe=1/0,zIe=vE&&1/BIe(new vE([,-0]))[1]==qIe?function(e){return new vE(e)}:$Ie,UIe=zIe,VIe=BJ,WIe=DIe,HIe=RIe,GIe=zJ,KIe=UIe,XIe=vM,YIe=200;function JIe(e,t,r){var n=-1,s=WIe,o=e.length,i=!0,l=[],c=l;if(r)i=!1,s=HIe;else if(o>=YIe){var d=t?null:KIe(e);if(d)return XIe(d);i=!1,s=GIe,c=new VIe}else c=t?[]:l;e:for(;++n<o;){var u=e[n],f=t?t(u):u;if(u=r||u!==0?u:0,i&&f===f){for(var h=c.length;h--;)if(c[h]===f)continue e;t&&c.push(f),l.push(u)}else s(c,f,r)||(c!==l&&c.push(f),l.push(u))}return l}var QIe=JIe,ZIe=em,eOe=QIe;function tOe(e,t){return e&&e.length?eOe(e,ZIe(t)):[]}var rOe=tOe;const uB=Us(rOe);function rQ(e,t,r){return t===!0?uB(e,r):Ja(t)?uB(e,t):e}function y0(e){"@babel/helpers - typeof";return y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y0(e)}var nOe=["ref"];function fB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function om(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fB(Object(r),!0).forEach(function(n){R5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,aQ(n.key),n)}}function sOe(e,t,r){return t&&mB(e.prototype,t),r&&mB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function oOe(e,t,r){return t=ZN(t),iOe(e,nQ()?Reflect.construct(t,r||[],ZN(e).constructor):t.apply(e,r))}function iOe(e,t){if(t&&(y0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lOe(e)}function lOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nQ=function(){return!!e})()}function ZN(e){return ZN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ZN(e)}function cOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WO(e,t)}function WO(e,t){return WO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},WO(e,t)}function R5(e,t,r){return t=aQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aQ(e){var t=dOe(e,"string");return y0(t)=="symbol"?t:t+""}function dOe(e,t){if(y0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(y0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uOe(e,t){if(e==null)return{};var r=fOe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fOe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function mOe(e){return e.value}function hOe(e,t){if(Ce.isValidElement(e))return Ce.cloneElement(e,t);if(typeof e=="function")return Ce.createElement(e,t);t.ref;var r=uOe(t,nOe);return Ce.createElement(xM,r)}var hB=1,Tg=function(e){function t(){var r;aOe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=oOe(this,t,[].concat(s)),R5(r,"lastBoundingBox",{width:-1,height:-1}),r}return cOe(t,e),sOe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,s=this.getBBox();s?(Math.abs(s.width-this.lastBoundingBox.width)>hB||Math.abs(s.height-this.lastBoundingBox.height)>hB)&&(this.lastBoundingBox.width=s.width,this.lastBoundingBox.height=s.height,n&&n(s)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?om({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var s=this.props,o=s.layout,i=s.align,l=s.verticalAlign,c=s.margin,d=s.chartWidth,u=s.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(i==="center"&&o==="vertical"){var m=this.getBBoxSnapshot();f={left:((d||0)-m.width)/2}}else f=i==="right"?{right:c&&c.right||0}:{left:c&&c.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(l==="middle"){var x=this.getBBoxSnapshot();h={top:((u||0)-x.height)/2}}else h=l==="bottom"?{bottom:c&&c.bottom||0}:{top:c&&c.top||0};return om(om({},f),h)}},{key:"render",value:function(){var n=this,s=this.props,o=s.content,i=s.width,l=s.height,c=s.wrapperStyle,d=s.payloadUniqBy,u=s.payload,f=om(om({position:"absolute",width:i||"auto",height:l||"auto"},this.getDefaultPosition(c)),c);return Ce.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(m){n.wrapperNode=m}},hOe(o,om(om({},this.props),{},{payload:rQ(u,d,mOe)})))}}],[{key:"getWithHeight",value:function(n,s){var o=om(om({},this.defaultProps),n.props),i=o.layout;return i==="vertical"&&Mn(n.props.height)?{height:n.props.height}:i==="horizontal"?{width:n.props.width||s}:null}}])}(p.PureComponent);R5(Tg,"displayName","Legend");R5(Tg,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var pB=ij,pOe=yM,gOe=Yc,gB=pB?pB.isConcatSpreadable:void 0;function xOe(e){return gOe(e)||pOe(e)||!!(gB&&e&&e[gB])}var vOe=xOe,yOe=VJ,bOe=vOe;function sQ(e,t,r,n,s){var o=-1,i=e.length;for(r||(r=bOe),s||(s=[]);++o<i;){var l=e[o];t>0&&r(l)?t>1?sQ(l,t-1,r,n,s):yOe(s,l):n||(s[s.length]=l)}return s}var oQ=sQ;function wOe(e){return function(t,r,n){for(var s=-1,o=Object(t),i=n(t),l=i.length;l--;){var c=i[e?l:++s];if(r(o[c],c,o)===!1)break}return t}}var jOe=wOe,_Oe=jOe,NOe=_Oe(),SOe=NOe,COe=SOe,AOe=M5;function POe(e,t){return e&&COe(e,t,AOe)}var iQ=POe,EOe=lj;function kOe(e,t){return function(r,n){if(r==null)return r;if(!EOe(r))return e(r,n);for(var s=r.length,o=t?s:-1,i=Object(r);(t?o--:++o<s)&&n(i[o],o,i)!==!1;);return r}}var IOe=kOe,OOe=iQ,TOe=IOe,DOe=TOe(OOe),_M=DOe,MOe=_M,ROe=lj;function FOe(e,t){var r=-1,n=ROe(e)?Array(e.length):[];return MOe(e,function(s,o,i){n[++r]=t(s,o,i)}),n}var lQ=FOe;function LOe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var $Oe=LOe,xB=cy;function BOe(e,t){if(e!==t){var r=e!==void 0,n=e===null,s=e===e,o=xB(e),i=t!==void 0,l=t===null,c=t===t,d=xB(t);if(!l&&!d&&!o&&e>t||o&&i&&c&&!l&&!d||n&&i&&c||!r&&c||!s)return 1;if(!n&&!o&&!d&&e<t||d&&r&&s&&!n&&!o||l&&r&&s||!i&&s||!c)return-1}return 0}var qOe=BOe,zOe=qOe;function UOe(e,t,r){for(var n=-1,s=e.criteria,o=t.criteria,i=s.length,l=r.length;++n<i;){var c=zOe(s[n],o[n]);if(c){if(n>=l)return c;var d=r[n];return c*(d=="desc"?-1:1)}}return e.index-t.index}var VOe=UOe,yE=iM,WOe=lM,HOe=em,GOe=lQ,KOe=$Oe,XOe=GJ,YOe=VOe,JOe=xy,QOe=Yc;function ZOe(e,t,r){t.length?t=yE(t,function(o){return QOe(o)?function(i){return WOe(i,o.length===1?o[0]:o)}:o}):t=[JOe];var n=-1;t=yE(t,XOe(HOe));var s=GOe(e,function(o,i,l){var c=yE(t,function(d){return d(o)});return{criteria:c,index:++n,value:o}});return KOe(s,function(o,i){return YOe(o,i,r)})}var eTe=ZOe;function tTe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var rTe=tTe,nTe=rTe,vB=Math.max;function aTe(e,t,r){return t=vB(t===void 0?e.length-1:t,0),function(){for(var n=arguments,s=-1,o=vB(n.length-t,0),i=Array(o);++s<o;)i[s]=n[t+s];s=-1;for(var l=Array(t+1);++s<t;)l[s]=n[s];return l[t]=r(i),nTe(e,this,l)}}var sTe=aTe;function oTe(e){return function(){return e}}var iTe=oTe,lTe=vx,cTe=function(){try{var e=lTe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),cQ=cTe,dTe=iTe,yB=cQ,uTe=xy,fTe=yB?function(e,t){return yB(e,"toString",{configurable:!0,enumerable:!1,value:dTe(t),writable:!0})}:uTe,mTe=fTe,hTe=800,pTe=16,gTe=Date.now;function xTe(e){var t=0,r=0;return function(){var n=gTe(),s=pTe-(n-r);if(r=n,s>0){if(++t>=hTe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var vTe=xTe,yTe=mTe,bTe=vTe,wTe=bTe(yTe),jTe=wTe,_Te=xy,NTe=sTe,STe=jTe;function CTe(e,t){return STe(NTe(e,t,_Te),e+"")}var ATe=CTe,PTe=nM,ETe=lj,kTe=bM,ITe=Ip;function OTe(e,t,r){if(!ITe(r))return!1;var n=typeof t;return(n=="number"?ETe(r)&&kTe(t,r.length):n=="string"&&t in r)?PTe(r[t],e):!1}var F5=OTe,TTe=oQ,DTe=eTe,MTe=ATe,bB=F5,RTe=MTe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&bB(e,t[0],t[1])?t=[]:r>2&&bB(t[0],t[1],t[2])&&(t=[t[0]]),DTe(e,TTe(t,1),[])}),FTe=RTe;const NM=Us(FTe);function Hw(e){"@babel/helpers - typeof";return Hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hw(e)}function HO(){return HO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HO.apply(this,arguments)}function LTe(e,t){return zTe(e)||qTe(e,t)||BTe(e,t)||$Te()}function $Te(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BTe(e,t){if(e){if(typeof e=="string")return wB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wB(e,t)}}function wB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qTe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function zTe(e){if(Array.isArray(e))return e}function jB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function bE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jB(Object(r),!0).forEach(function(n){UTe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UTe(e,t,r){return t=VTe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VTe(e){var t=WTe(e,"string");return Hw(t)=="symbol"?t:t+""}function WTe(e,t){if(Hw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Hw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HTe(e){return Array.isArray(e)&&Ki(e[0])&&Ki(e[1])?e.join(" ~ "):e}var GTe=function(t){var r=t.separator,n=r===void 0?" : ":r,s=t.contentStyle,o=s===void 0?{}:s,i=t.itemStyle,l=i===void 0?{}:i,c=t.labelStyle,d=c===void 0?{}:c,u=t.payload,f=t.formatter,h=t.itemSorter,m=t.wrapperClassName,x=t.labelClassName,g=t.label,v=t.labelFormatter,y=t.accessibilityLayer,b=y===void 0?!1:y,w=function(){if(u&&u.length){var I={padding:0,margin:0},T=(h?NM(u,h):u).map(function(k,q){if(k.type==="none")return null;var B=bE({display:"block",paddingTop:4,paddingBottom:4,color:k.color||"#000"},l),z=k.formatter||f||HTe,F=k.value,V=k.name,me=F,be=V;if(z&&me!=null&&be!=null){var U=z(F,V,k,q,u);if(Array.isArray(U)){var L=LTe(U,2);me=L[0],be=L[1]}else me=U}return Ce.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(q),style:B},Ki(be)?Ce.createElement("span",{className:"recharts-tooltip-item-name"},be):null,Ki(be)?Ce.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ce.createElement("span",{className:"recharts-tooltip-item-value"},me),Ce.createElement("span",{className:"recharts-tooltip-item-unit"},k.unit||""))});return Ce.createElement("ul",{className:"recharts-tooltip-item-list",style:I},T)}return null},j=bE({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),_=bE({margin:0},d),C=!ls(g),E=C?g:"",S=us("recharts-default-tooltip",m),A=us("recharts-tooltip-label",x);C&&v&&u!==void 0&&u!==null&&(E=v(g,u));var M=b?{role:"status","aria-live":"assertive"}:{};return Ce.createElement("div",HO({className:S,style:j},M),Ce.createElement("p",{className:A,style:_},Ce.isValidElement(E)?E:"".concat(E)),w())};function Gw(e){"@babel/helpers - typeof";return Gw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gw(e)}function O_(e,t,r){return t=KTe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KTe(e){var t=XTe(e,"string");return Gw(t)=="symbol"?t:t+""}function XTe(e,t){if(Gw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Gw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Jy="recharts-tooltip-wrapper",YTe={visibility:"hidden"};function JTe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return us(Jy,O_(O_(O_(O_({},"".concat(Jy,"-right"),Mn(r)&&t&&Mn(t.x)&&r>=t.x),"".concat(Jy,"-left"),Mn(r)&&t&&Mn(t.x)&&r<t.x),"".concat(Jy,"-bottom"),Mn(n)&&t&&Mn(t.y)&&n>=t.y),"".concat(Jy,"-top"),Mn(n)&&t&&Mn(t.y)&&n<t.y))}function _B(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,s=e.offsetTopLeft,o=e.position,i=e.reverseDirection,l=e.tooltipDimension,c=e.viewBox,d=e.viewBoxDimension;if(o&&Mn(o[n]))return o[n];var u=r[n]-l-s,f=r[n]+s;if(t[n])return i[n]?u:f;if(i[n]){var h=u,m=c[n];return h<m?Math.max(f,c[n]):Math.max(u,c[n])}var x=f+l,g=c[n]+d;return x>g?Math.max(u,c[n]):Math.max(f,c[n])}function QTe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function ZTe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,s=e.position,o=e.reverseDirection,i=e.tooltipBox,l=e.useTranslate3d,c=e.viewBox,d,u,f;return i.height>0&&i.width>0&&r?(u=_B({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:i.width,viewBox:c,viewBoxDimension:c.width}),f=_B({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:i.height,viewBox:c,viewBoxDimension:c.height}),d=QTe({translateX:u,translateY:f,useTranslate3d:l})):d=YTe,{cssProperties:d,cssClasses:JTe({translateX:u,translateY:f,coordinate:r})}}function b0(e){"@babel/helpers - typeof";return b0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b0(e)}function NB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function SB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NB(Object(r),!0).forEach(function(n){KO(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function e3e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function CB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,uQ(n.key),n)}}function t3e(e,t,r){return t&&CB(e.prototype,t),r&&CB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r3e(e,t,r){return t=eS(t),n3e(e,dQ()?Reflect.construct(t,r||[],eS(e).constructor):t.apply(e,r))}function n3e(e,t){if(t&&(b0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return a3e(e)}function a3e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dQ=function(){return!!e})()}function eS(e){return eS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},eS(e)}function s3e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GO(e,t)}function GO(e,t){return GO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},GO(e,t)}function KO(e,t,r){return t=uQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uQ(e){var t=o3e(e,"string");return b0(t)=="symbol"?t:t+""}function o3e(e,t){if(b0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(b0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AB=1,i3e=function(e){function t(){var r;e3e(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=r3e(this,t,[].concat(s)),KO(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),KO(r,"handleKeyDown",function(i){if(i.key==="Escape"){var l,c,d,u;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(l=(c=r.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&l!==void 0?l:0,y:(d=(u=r.props.coordinate)===null||u===void 0?void 0:u.y)!==null&&d!==void 0?d:0}})}}),r}return s3e(t,e),t3e(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>AB||Math.abs(n.height-this.state.lastBoundingBox.height)>AB)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,s;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,s=this.props,o=s.active,i=s.allowEscapeViewBox,l=s.animationDuration,c=s.animationEasing,d=s.children,u=s.coordinate,f=s.hasPayload,h=s.isAnimationActive,m=s.offset,x=s.position,g=s.reverseDirection,v=s.useTranslate3d,y=s.viewBox,b=s.wrapperStyle,w=ZTe({allowEscapeViewBox:i,coordinate:u,offsetTopLeft:m,position:x,reverseDirection:g,tooltipBox:this.state.lastBoundingBox,useTranslate3d:v,viewBox:y}),j=w.cssClasses,_=w.cssProperties,C=SB(SB({transition:h&&o?"transform ".concat(l,"ms ").concat(c):void 0},_),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&f?"visible":"hidden",position:"absolute",top:0,left:0},b);return Ce.createElement("div",{tabIndex:-1,className:j,style:C,ref:function(S){n.wrapperNode=S}},d)}}])}(p.PureComponent),l3e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},nf={isSsr:l3e(),get:function(t){return nf[t]},set:function(t,r){if(typeof t=="string")nf[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(s){nf[s]=t[s]})}}};function w0(e){"@babel/helpers - typeof";return w0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w0(e)}function PB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function EB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PB(Object(r),!0).forEach(function(n){SM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c3e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mQ(n.key),n)}}function d3e(e,t,r){return t&&kB(e.prototype,t),r&&kB(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u3e(e,t,r){return t=tS(t),f3e(e,fQ()?Reflect.construct(t,r||[],tS(e).constructor):t.apply(e,r))}function f3e(e,t){if(t&&(w0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m3e(e)}function m3e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fQ=function(){return!!e})()}function tS(e){return tS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tS(e)}function h3e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&XO(e,t)}function XO(e,t){return XO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},XO(e,t)}function SM(e,t,r){return t=mQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mQ(e){var t=p3e(e,"string");return w0(t)=="symbol"?t:t+""}function p3e(e,t){if(w0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(w0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function g3e(e){return e.dataKey}function x3e(e,t){return Ce.isValidElement(e)?Ce.cloneElement(e,t):typeof e=="function"?Ce.createElement(e,t):Ce.createElement(GTe,t)}var Dc=function(e){function t(){return c3e(this,t),u3e(this,t,arguments)}return h3e(t,e),d3e(t,[{key:"render",value:function(){var n=this,s=this.props,o=s.active,i=s.allowEscapeViewBox,l=s.animationDuration,c=s.animationEasing,d=s.content,u=s.coordinate,f=s.filterNull,h=s.isAnimationActive,m=s.offset,x=s.payload,g=s.payloadUniqBy,v=s.position,y=s.reverseDirection,b=s.useTranslate3d,w=s.viewBox,j=s.wrapperStyle,_=x??[];f&&_.length&&(_=rQ(x.filter(function(E){return E.value!=null&&(E.hide!==!0||n.props.includeHidden)}),g,g3e));var C=_.length>0;return Ce.createElement(i3e,{allowEscapeViewBox:i,animationDuration:l,animationEasing:c,isAnimationActive:h,active:o,coordinate:u,hasPayload:C,offset:m,position:v,reverseDirection:y,useTranslate3d:b,viewBox:w,wrapperStyle:j},x3e(d,EB(EB({},this.props),{},{payload:_})))}}])}(p.PureComponent);SM(Dc,"displayName","Tooltip");SM(Dc,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!nf.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var v3e=Zf,y3e=function(){return v3e.Date.now()},b3e=y3e,w3e=/\s/;function j3e(e){for(var t=e.length;t--&&w3e.test(e.charAt(t)););return t}var _3e=j3e,N3e=_3e,S3e=/^\s+/;function C3e(e){return e&&e.slice(0,N3e(e)+1).replace(S3e,"")}var A3e=C3e,P3e=A3e,IB=Ip,E3e=cy,OB=0/0,k3e=/^[-+]0x[0-9a-f]+$/i,I3e=/^0b[01]+$/i,O3e=/^0o[0-7]+$/i,T3e=parseInt;function D3e(e){if(typeof e=="number")return e;if(E3e(e))return OB;if(IB(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=IB(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=P3e(e);var r=I3e.test(e);return r||O3e.test(e)?T3e(e.slice(2),r?2:8):k3e.test(e)?OB:+e}var hQ=D3e,M3e=Ip,wE=b3e,TB=hQ,R3e="Expected a function",F3e=Math.max,L3e=Math.min;function $3e(e,t,r){var n,s,o,i,l,c,d=0,u=!1,f=!1,h=!0;if(typeof e!="function")throw new TypeError(R3e);t=TB(t)||0,M3e(r)&&(u=!!r.leading,f="maxWait"in r,o=f?F3e(TB(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h);function m(C){var E=n,S=s;return n=s=void 0,d=C,i=e.apply(S,E),i}function x(C){return d=C,l=setTimeout(y,t),u?m(C):i}function g(C){var E=C-c,S=C-d,A=t-E;return f?L3e(A,o-S):A}function v(C){var E=C-c,S=C-d;return c===void 0||E>=t||E<0||f&&S>=o}function y(){var C=wE();if(v(C))return b(C);l=setTimeout(y,g(C))}function b(C){return l=void 0,h&&n?m(C):(n=s=void 0,i)}function w(){l!==void 0&&clearTimeout(l),d=0,n=c=s=l=void 0}function j(){return l===void 0?i:b(wE())}function _(){var C=wE(),E=v(C);if(n=arguments,s=this,c=C,E){if(l===void 0)return x(c);if(f)return clearTimeout(l),l=setTimeout(y,t),m(c)}return l===void 0&&(l=setTimeout(y,t)),i}return _.cancel=w,_.flush=j,_}var B3e=$3e,q3e=B3e,z3e=Ip,U3e="Expected a function";function V3e(e,t,r){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(U3e);return z3e(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),q3e(e,t,{leading:n,maxWait:t,trailing:s})}var W3e=V3e;const pQ=Us(W3e);function Kw(e){"@babel/helpers - typeof";return Kw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kw(e)}function DB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function T_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DB(Object(r),!0).forEach(function(n){H3e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function H3e(e,t,r){return t=G3e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G3e(e){var t=K3e(e,"string");return Kw(t)=="symbol"?t:t+""}function K3e(e,t){if(Kw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Kw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function X3e(e,t){return Z3e(e)||Q3e(e,t)||J3e(e,t)||Y3e()}function Y3e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function J3e(e,t){if(e){if(typeof e=="string")return MB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return MB(e,t)}}function MB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q3e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function Z3e(e){if(Array.isArray(e))return e}var Gb=p.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,s=n===void 0?{width:-1,height:-1}:n,o=e.width,i=o===void 0?"100%":o,l=e.height,c=l===void 0?"100%":l,d=e.minWidth,u=d===void 0?0:d,f=e.minHeight,h=e.maxHeight,m=e.children,x=e.debounce,g=x===void 0?0:x,v=e.id,y=e.className,b=e.onResize,w=e.style,j=w===void 0?{}:w,_=p.useRef(null),C=p.useRef();C.current=b,p.useImperativeHandle(t,function(){return Object.defineProperty(_.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),_.current},configurable:!0})});var E=p.useState({containerWidth:s.width,containerHeight:s.height}),S=X3e(E,2),A=S[0],M=S[1],O=p.useCallback(function(T,k){M(function(q){var B=Math.round(T),z=Math.round(k);return q.containerWidth===B&&q.containerHeight===z?q:{containerWidth:B,containerHeight:z}})},[]);p.useEffect(function(){var T=function(V){var me,be=V[0].contentRect,U=be.width,L=be.height;O(U,L),(me=C.current)===null||me===void 0||me.call(C,U,L)};g>0&&(T=pQ(T,g,{trailing:!0,leading:!1}));var k=new ResizeObserver(T),q=_.current.getBoundingClientRect(),B=q.width,z=q.height;return O(B,z),k.observe(_.current),function(){k.disconnect()}},[O,g]);var I=p.useMemo(function(){var T=A.containerWidth,k=A.containerHeight;if(T<0||k<0)return null;rf(vg(i)||vg(c),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,i,c),rf(!r||r>0,"The aspect(%s) must be greater than zero.",r);var q=vg(i)?T:i,B=vg(c)?k:c;r&&r>0&&(q?B=q/r:B&&(q=B*r),h&&B>h&&(B=h)),rf(q>0||B>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,q,B,i,c,u,f,r);var z=!Array.isArray(m)&&Im(m.type).endsWith("Chart");return Ce.Children.map(m,function(F){return Ce.isValidElement(F)?p.cloneElement(F,T_({width:q,height:B},z?{style:T_({height:"100%",width:"100%",maxHeight:B,maxWidth:q},F.props.style)}:{})):F})},[r,m,c,h,f,u,A,i]);return Ce.createElement("div",{id:v?"".concat(v):void 0,className:us("recharts-responsive-container",y),style:T_(T_({},j),{},{width:i,height:c,minWidth:u,minHeight:f,maxHeight:h}),ref:_},I)}),Xw=function(t){return null};Xw.displayName="Cell";function Yw(e){"@babel/helpers - typeof";return Yw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yw(e)}function RB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function YO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RB(Object(r),!0).forEach(function(n){e4e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RB(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function e4e(e,t,r){return t=t4e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t4e(e){var t=r4e(e,"string");return Yw(t)=="symbol"?t:t+""}function r4e(e,t){if(Yw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Yw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var zx={widthCache:{},cacheCount:0},n4e=2e3,a4e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},FB="recharts_measurement_span";function s4e(e){var t=YO({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var Kb=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||nf.isSsr)return{width:0,height:0};var n=s4e(r),s=JSON.stringify({text:t,copyStyle:n});if(zx.widthCache[s])return zx.widthCache[s];try{var o=document.getElementById(FB);o||(o=document.createElement("span"),o.setAttribute("id",FB),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var i=YO(YO({},a4e),n);Object.assign(o.style,i),o.textContent="".concat(t);var l=o.getBoundingClientRect(),c={width:l.width,height:l.height};return zx.widthCache[s]=c,++zx.cacheCount>n4e&&(zx.cacheCount=0,zx.widthCache={}),c}catch{return{width:0,height:0}}},o4e=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Jw(e){"@babel/helpers - typeof";return Jw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jw(e)}function rS(e,t){return d4e(e)||c4e(e,t)||l4e(e,t)||i4e()}function i4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l4e(e,t){if(e){if(typeof e=="string")return LB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LB(e,t)}}function LB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function d4e(e){if(Array.isArray(e))return e}function u4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m4e(n.key),n)}}function f4e(e,t,r){return t&&$B(e.prototype,t),r&&$B(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function m4e(e){var t=h4e(e,"string");return Jw(t)=="symbol"?t:t+""}function h4e(e,t){if(Jw(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Jw(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var BB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,qB=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,p4e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,g4e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,gQ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},x4e=Object.keys(gQ),Pv="NaN";function v4e(e,t){return e*gQ[t]}var D_=function(){function e(t,r){u4e(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!p4e.test(r)&&(this.num=NaN,this.unit=""),x4e.includes(r)&&(this.num=v4e(t,r),this.unit="px")}return f4e(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,s=(n=g4e.exec(r))!==null&&n!==void 0?n:[],o=rS(s,3),i=o[1],l=o[2];return new e(parseFloat(i),l??"")}}])}();function xQ(e){if(e.includes(Pv))return Pv;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=BB.exec(t))!==null&&r!==void 0?r:[],s=rS(n,4),o=s[1],i=s[2],l=s[3],c=D_.parse(o??""),d=D_.parse(l??""),u=i==="*"?c.multiply(d):c.divide(d);if(u.isNaN())return Pv;t=t.replace(BB,u.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=qB.exec(t))!==null&&f!==void 0?f:[],m=rS(h,4),x=m[1],g=m[2],v=m[3],y=D_.parse(x??""),b=D_.parse(v??""),w=g==="+"?y.add(b):y.subtract(b);if(w.isNaN())return Pv;t=t.replace(qB,w.toString())}return t}var zB=/\(([^()]*)\)/;function y4e(e){for(var t=e;t.includes("(");){var r=zB.exec(t),n=rS(r,2),s=n[1];t=t.replace(zB,xQ(s))}return t}function b4e(e){var t=e.replace(/\s+/g,"");return t=y4e(t),t=xQ(t),t}function w4e(e){try{return b4e(e)}catch{return Pv}}function jE(e){var t=w4e(e.slice(5,-1));return t===Pv?"":t}var j4e=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],_4e=["dx","dy","angle","className","breakAll"];function JO(){return JO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JO.apply(this,arguments)}function UB(e,t){if(e==null)return{};var r=N4e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function N4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function VB(e,t){return P4e(e)||A4e(e,t)||C4e(e,t)||S4e()}function S4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C4e(e,t){if(e){if(typeof e=="string")return WB(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WB(e,t)}}function WB(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function P4e(e){if(Array.isArray(e))return e}var vQ=/[ \f\n\r\t\v\u2028\u2029]+/,yQ=function(t){var r=t.children,n=t.breakAll,s=t.style;try{var o=[];ls(r)||(n?o=r.toString().split(""):o=r.toString().split(vQ));var i=o.map(function(c){return{word:c,width:Kb(c,s).width}}),l=n?0:Kb("",s).width;return{wordsWithComputedWidth:i,spaceWidth:l}}catch{return null}},E4e=function(t,r,n,s,o){var i=t.maxLines,l=t.children,c=t.style,d=t.breakAll,u=Mn(i),f=l,h=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return q.reduce(function(B,z){var F=z.word,V=z.width,me=B[B.length-1];if(me&&(s==null||o||me.width+V+n<Number(s)))me.words.push(F),me.width+=V+n;else{var be={words:[F],width:V};B.push(be)}return B},[])},m=h(r),x=function(q){return q.reduce(function(B,z){return B.width>z.width?B:z})};if(!u)return m;for(var g="",v=function(q){var B=f.slice(0,q),z=yQ({breakAll:d,style:c,children:B+g}).wordsWithComputedWidth,F=h(z),V=F.length>i||x(F).width>Number(s);return[V,F]},y=0,b=f.length-1,w=0,j;y<=b&&w<=f.length-1;){var _=Math.floor((y+b)/2),C=_-1,E=v(C),S=VB(E,2),A=S[0],M=S[1],O=v(_),I=VB(O,1),T=I[0];if(!A&&!T&&(y=_+1),A&&T&&(b=_-1),!A&&T){j=M;break}w++}return j||m},HB=function(t){var r=ls(t)?[]:t.toString().split(vQ);return[{words:r}]},k4e=function(t){var r=t.width,n=t.scaleToFit,s=t.children,o=t.style,i=t.breakAll,l=t.maxLines;if((r||n)&&!nf.isSsr){var c,d,u=yQ({breakAll:i,children:s,style:o});if(u){var f=u.wordsWithComputedWidth,h=u.spaceWidth;c=f,d=h}else return HB(s);return E4e({breakAll:i,children:s,maxLines:l,style:o},c,d,r,n)}return HB(s)},GB="#808080",tx=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,i=t.lineHeight,l=i===void 0?"1em":i,c=t.capHeight,d=c===void 0?"0.71em":c,u=t.scaleToFit,f=u===void 0?!1:u,h=t.textAnchor,m=h===void 0?"start":h,x=t.verticalAnchor,g=x===void 0?"end":x,v=t.fill,y=v===void 0?GB:v,b=UB(t,j4e),w=p.useMemo(function(){return k4e({breakAll:b.breakAll,children:b.children,maxLines:b.maxLines,scaleToFit:f,style:b.style,width:b.width})},[b.breakAll,b.children,b.maxLines,f,b.style,b.width]),j=b.dx,_=b.dy,C=b.angle,E=b.className,S=b.breakAll,A=UB(b,_4e);if(!Ki(n)||!Ki(o))return null;var M=n+(Mn(j)?j:0),O=o+(Mn(_)?_:0),I;switch(g){case"start":I=jE("calc(".concat(d,")"));break;case"middle":I=jE("calc(".concat((w.length-1)/2," * -").concat(l," + (").concat(d," / 2))"));break;default:I=jE("calc(".concat(w.length-1," * -").concat(l,")"));break}var T=[];if(f){var k=w[0].width,q=b.width;T.push("scale(".concat((Mn(q)?q/k:1)/k,")"))}return C&&T.push("rotate(".concat(C,", ").concat(M,", ").concat(O,")")),T.length&&(A.transform=T.join(" ")),Ce.createElement("text",JO({},Ra(A,!0),{x:M,y:O,className:us("recharts-text",E),textAnchor:m,fill:y.includes("url")?GB:y}),w.map(function(B,z){var F=B.words.join(S?"":" ");return Ce.createElement("tspan",{x:M,dy:z===0?I:l,key:"".concat(F,"-").concat(z)},F)}))};function tp(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function I4e(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function CM(e){let t,r,n;e.length!==2?(t=tp,r=(l,c)=>tp(e(l),c),n=(l,c)=>e(l)-c):(t=e===tp||e===I4e?e:O4e,r=e,n=e);function s(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;r(l[f],c)<0?d=f+1:u=f}while(d<u)}return d}function o(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;r(l[f],c)<=0?d=f+1:u=f}while(d<u)}return d}function i(l,c,d=0,u=l.length){const f=s(l,c,d,u-1);return f>d&&n(l[f-1],c)>-n(l[f],c)?f-1:f}return{left:s,center:i,right:o}}function O4e(){return 0}function bQ(e){return e===null?NaN:+e}function*T4e(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}const D4e=CM(tp),M4e=D4e.right;CM(bQ).center;const cj=M4e;class KB extends Map{constructor(t,r=L4e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,s]of t)this.set(n,s)}get(t){return super.get(XB(this,t))}has(t){return super.has(XB(this,t))}set(t,r){return super.set(R4e(this,t),r)}delete(t){return super.delete(F4e(this,t))}}function XB({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function R4e({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function F4e({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function L4e(e){return e!==null&&typeof e=="object"?e.valueOf():e}function $4e(e=tp){if(e===tp)return wQ;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function wQ(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const B4e=Math.sqrt(50),q4e=Math.sqrt(10),z4e=Math.sqrt(2);function nS(e,t,r){const n=(t-e)/Math.max(0,r),s=Math.floor(Math.log10(n)),o=n/Math.pow(10,s),i=o>=B4e?10:o>=q4e?5:o>=z4e?2:1;let l,c,d;return s<0?(d=Math.pow(10,-s)/i,l=Math.round(e*d),c=Math.round(t*d),l/d<e&&++l,c/d>t&&--c,d=-d):(d=Math.pow(10,s)*i,l=Math.round(e/d),c=Math.round(t/d),l*d<e&&++l,c*d>t&&--c),c<l&&.5<=r&&r<2?nS(e,t,r*2):[l,c,d]}function QO(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[s,o,i]=n?nS(t,e,r):nS(e,t,r);if(!(o>=s))return[];const l=o-s+1,c=new Array(l);if(n)if(i<0)for(let d=0;d<l;++d)c[d]=(o-d)/-i;else for(let d=0;d<l;++d)c[d]=(o-d)*i;else if(i<0)for(let d=0;d<l;++d)c[d]=(s+d)/-i;else for(let d=0;d<l;++d)c[d]=(s+d)*i;return c}function ZO(e,t,r){return t=+t,e=+e,r=+r,nS(e,t,r)[2]}function eT(e,t,r){t=+t,e=+e,r=+r;const n=t<e,s=n?ZO(t,e,r):ZO(e,t,r);return(n?-1:1)*(s<0?1/-s:s)}function YB(e,t){let r;if(t===void 0)for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let s of e)(s=t(s,++n,e))!=null&&(r<s||r===void 0&&s>=s)&&(r=s)}return r}function JB(e,t){let r;if(t===void 0)for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let s of e)(s=t(s,++n,e))!=null&&(r>s||r===void 0&&s>=s)&&(r=s)}return r}function jQ(e,t,r=0,n=1/0,s){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(s=s===void 0?wQ:$4e(s);n>r;){if(n-r>600){const c=n-r+1,d=t-r+1,u=Math.log(c),f=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*f*(c-f)/c)*(d-c/2<0?-1:1),m=Math.max(r,Math.floor(t-d*f/c+h)),x=Math.min(n,Math.floor(t+(c-d)*f/c+h));jQ(e,t,m,x,s)}const o=e[t];let i=r,l=n;for(Qy(e,r,t),s(e[n],o)>0&&Qy(e,r,n);i<l;){for(Qy(e,i,l),++i,--l;s(e[i],o)<0;)++i;for(;s(e[l],o)>0;)--l}s(e[r],o)===0?Qy(e,r,l):(++l,Qy(e,l,n)),l<=t&&(r=l+1),t<=l&&(n=l-1)}return e}function Qy(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function U4e(e,t,r){if(e=Float64Array.from(T4e(e,r)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return JB(e);if(t>=1)return YB(e);var n,s=(n-1)*t,o=Math.floor(s),i=YB(jQ(e,o).subarray(0,o+1)),l=JB(e.subarray(o+1));return i+(l-i)*(s-o)}}function V4e(e,t,r=bQ){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,s=(n-1)*t,o=Math.floor(s),i=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return i+(l-i)*(s-o)}}function W4e(e,t,r){e=+e,t=+t,r=(s=arguments.length)<2?(t=e,e=0,1):s<3?1:+r;for(var n=-1,s=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(s);++n<s;)o[n]=e+n*r;return o}function Cu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Zm(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const tT=Symbol("implicit");function AM(){var e=new KB,t=[],r=[],n=tT;function s(o){let i=e.get(o);if(i===void 0){if(n!==tT)return n;e.set(o,i=t.push(o)-1)}return r[i%r.length]}return s.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new KB;for(const i of o)e.has(i)||e.set(i,t.push(i)-1);return s},s.range=function(o){return arguments.length?(r=Array.from(o),s):r.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return AM(t,r).unknown(n)},Cu.apply(s,arguments),s}function Qw(){var e=AM().unknown(void 0),t=e.domain,r=e.range,n=0,s=1,o,i,l=!1,c=0,d=0,u=.5;delete e.unknown;function f(){var h=t().length,m=s<n,x=m?s:n,g=m?n:s;o=(g-x)/Math.max(1,h-c+d*2),l&&(o=Math.floor(o)),x+=(g-x-o*(h-c))*u,i=o*(1-c),l&&(x=Math.round(x),i=Math.round(i));var v=W4e(h).map(function(y){return x+o*y});return r(m?v.reverse():v)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,s]=h,n=+n,s=+s,f()):[n,s]},e.rangeRound=function(h){return[n,s]=h,n=+n,s=+s,l=!0,f()},e.bandwidth=function(){return i},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,f()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,d=+h),f()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),f()):c},e.paddingOuter=function(h){return arguments.length?(d=+h,f()):d},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),f()):u},e.copy=function(){return Qw(t(),[n,s]).round(l).paddingInner(c).paddingOuter(d).align(u)},Cu.apply(f(),arguments)}function _Q(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return _Q(t())},e}function Xb(){return _Q(Qw.apply(null,arguments).paddingInner(1))}function PM(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function NQ(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function dj(){}var Zw=.7,aS=1/Zw,Xv="\\s*([+-]?\\d+)\\s*",e1="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Uf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",H4e=/^#([0-9a-f]{3,8})$/,G4e=new RegExp(`^rgb\\(${Xv},${Xv},${Xv}\\)$`),K4e=new RegExp(`^rgb\\(${Uf},${Uf},${Uf}\\)$`),X4e=new RegExp(`^rgba\\(${Xv},${Xv},${Xv},${e1}\\)$`),Y4e=new RegExp(`^rgba\\(${Uf},${Uf},${Uf},${e1}\\)$`),J4e=new RegExp(`^hsl\\(${e1},${Uf},${Uf}\\)$`),Q4e=new RegExp(`^hsla\\(${e1},${Uf},${Uf},${e1}\\)$`),QB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};PM(dj,t1,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ZB,formatHex:ZB,formatHex8:Z4e,formatHsl:eDe,formatRgb:eq,toString:eq});function ZB(){return this.rgb().formatHex()}function Z4e(){return this.rgb().formatHex8()}function eDe(){return SQ(this).formatHsl()}function eq(){return this.rgb().formatRgb()}function t1(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=H4e.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?tq(t):r===3?new Bc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?M_(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?M_(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=G4e.exec(e))?new Bc(t[1],t[2],t[3],1):(t=K4e.exec(e))?new Bc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=X4e.exec(e))?M_(t[1],t[2],t[3],t[4]):(t=Y4e.exec(e))?M_(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=J4e.exec(e))?aq(t[1],t[2]/100,t[3]/100,1):(t=Q4e.exec(e))?aq(t[1],t[2]/100,t[3]/100,t[4]):QB.hasOwnProperty(e)?tq(QB[e]):e==="transparent"?new Bc(NaN,NaN,NaN,0):null}function tq(e){return new Bc(e>>16&255,e>>8&255,e&255,1)}function M_(e,t,r,n){return n<=0&&(e=t=r=NaN),new Bc(e,t,r,n)}function tDe(e){return e instanceof dj||(e=t1(e)),e?(e=e.rgb(),new Bc(e.r,e.g,e.b,e.opacity)):new Bc}function rT(e,t,r,n){return arguments.length===1?tDe(e):new Bc(e,t,r,n??1)}function Bc(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}PM(Bc,rT,NQ(dj,{brighter(e){return e=e==null?aS:Math.pow(aS,e),new Bc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Zw:Math.pow(Zw,e),new Bc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Bc(Dg(this.r),Dg(this.g),Dg(this.b),sS(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rq,formatHex:rq,formatHex8:rDe,formatRgb:nq,toString:nq}));function rq(){return`#${yg(this.r)}${yg(this.g)}${yg(this.b)}`}function rDe(){return`#${yg(this.r)}${yg(this.g)}${yg(this.b)}${yg((isNaN(this.opacity)?1:this.opacity)*255)}`}function nq(){const e=sS(this.opacity);return`${e===1?"rgb(":"rgba("}${Dg(this.r)}, ${Dg(this.g)}, ${Dg(this.b)}${e===1?")":`, ${e})`}`}function sS(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Dg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function yg(e){return e=Dg(e),(e<16?"0":"")+e.toString(16)}function aq(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Xu(e,t,r,n)}function SQ(e){if(e instanceof Xu)return new Xu(e.h,e.s,e.l,e.opacity);if(e instanceof dj||(e=t1(e)),!e)return new Xu;if(e instanceof Xu)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,s=Math.min(t,r,n),o=Math.max(t,r,n),i=NaN,l=o-s,c=(o+s)/2;return l?(t===o?i=(r-n)/l+(r<n)*6:r===o?i=(n-t)/l+2:i=(t-r)/l+4,l/=c<.5?o+s:2-o-s,i*=60):l=c>0&&c<1?0:i,new Xu(i,l,c,e.opacity)}function nDe(e,t,r,n){return arguments.length===1?SQ(e):new Xu(e,t,r,n??1)}function Xu(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}PM(Xu,nDe,NQ(dj,{brighter(e){return e=e==null?aS:Math.pow(aS,e),new Xu(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Zw:Math.pow(Zw,e),new Xu(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,s=2*r-n;return new Bc(_E(e>=240?e-240:e+120,s,n),_E(e,s,n),_E(e<120?e+240:e-120,s,n),this.opacity)},clamp(){return new Xu(sq(this.h),R_(this.s),R_(this.l),sS(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=sS(this.opacity);return`${e===1?"hsl(":"hsla("}${sq(this.h)}, ${R_(this.s)*100}%, ${R_(this.l)*100}%${e===1?")":`, ${e})`}`}}));function sq(e){return e=(e||0)%360,e<0?e+360:e}function R_(e){return Math.max(0,Math.min(1,e||0))}function _E(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const EM=e=>()=>e;function aDe(e,t){return function(r){return e+r*t}}function sDe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function oDe(e){return(e=+e)==1?CQ:function(t,r){return r-t?sDe(t,r,e):EM(isNaN(t)?r:t)}}function CQ(e,t){var r=t-e;return r?aDe(e,r):EM(isNaN(e)?t:e)}const oq=function e(t){var r=oDe(t);function n(s,o){var i=r((s=rT(s)).r,(o=rT(o)).r),l=r(s.g,o.g),c=r(s.b,o.b),d=CQ(s.opacity,o.opacity);return function(u){return s.r=i(u),s.g=l(u),s.b=c(u),s.opacity=d(u),s+""}}return n.gamma=e,n}(1);function iDe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),s;return function(o){for(s=0;s<r;++s)n[s]=e[s]*(1-o)+t[s]*o;return n}}function lDe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function cDe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,s=new Array(n),o=new Array(r),i;for(i=0;i<n;++i)s[i]=vy(e[i],t[i]);for(;i<r;++i)o[i]=t[i];return function(l){for(i=0;i<n;++i)o[i]=s[i](l);return o}}function dDe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function oS(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function uDe(e,t){var r={},n={},s;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in e?r[s]=vy(e[s],t[s]):n[s]=t[s];return function(o){for(s in r)n[s]=r[s](o);return n}}var nT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,NE=new RegExp(nT.source,"g");function fDe(e){return function(){return e}}function mDe(e){return function(t){return e(t)+""}}function hDe(e,t){var r=nT.lastIndex=NE.lastIndex=0,n,s,o,i=-1,l=[],c=[];for(e=e+"",t=t+"";(n=nT.exec(e))&&(s=NE.exec(t));)(o=s.index)>r&&(o=t.slice(r,o),l[i]?l[i]+=o:l[++i]=o),(n=n[0])===(s=s[0])?l[i]?l[i]+=s:l[++i]=s:(l[++i]=null,c.push({i,x:oS(n,s)})),r=NE.lastIndex;return r<t.length&&(o=t.slice(r),l[i]?l[i]+=o:l[++i]=o),l.length<2?c[0]?mDe(c[0].x):fDe(t):(t=c.length,function(d){for(var u=0,f;u<t;++u)l[(f=c[u]).i]=f.x(d);return l.join("")})}function vy(e,t){var r=typeof t,n;return t==null||r==="boolean"?EM(t):(r==="number"?oS:r==="string"?(n=t1(t))?(t=n,oq):hDe:t instanceof t1?oq:t instanceof Date?dDe:lDe(t)?iDe:Array.isArray(t)?cDe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?uDe:oS)(e,t)}function kM(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function pDe(e,t){t===void 0&&(t=e,e=vy);for(var r=0,n=t.length-1,s=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(s,s=t[++r]);return function(i){var l=Math.max(0,Math.min(n-1,Math.floor(i*=n)));return o[l](i-l)}}function gDe(e){return function(){return e}}function iS(e){return+e}var iq=[0,1];function gc(e){return e}function aT(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:gDe(isNaN(t)?NaN:.5)}function xDe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function vDe(e,t,r){var n=e[0],s=e[1],o=t[0],i=t[1];return s<n?(n=aT(s,n),o=r(i,o)):(n=aT(n,s),o=r(o,i)),function(l){return o(n(l))}}function yDe(e,t,r){var n=Math.min(e.length,t.length)-1,s=new Array(n),o=new Array(n),i=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<n;)s[i]=aT(e[i],e[i+1]),o[i]=r(t[i],t[i+1]);return function(l){var c=cj(e,l,1,n)-1;return o[c](s[c](l))}}function uj(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function L5(){var e=iq,t=iq,r=vy,n,s,o,i=gc,l,c,d;function u(){var h=Math.min(e.length,t.length);return i!==gc&&(i=xDe(e[0],e[h-1])),l=h>2?yDe:vDe,c=d=null,f}function f(h){return h==null||isNaN(h=+h)?o:(c||(c=l(e.map(n),t,r)))(n(i(h)))}return f.invert=function(h){return i(s((d||(d=l(t,e.map(n),oS)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,iS),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=kM,u()},f.clamp=function(h){return arguments.length?(i=h?!0:gc,u()):i!==gc},f.interpolate=function(h){return arguments.length?(r=h,u()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,m){return n=h,s=m,u()}}function IM(){return L5()(gc,gc)}function bDe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function lS(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function j0(e){return e=lS(Math.abs(e)),e?e[1]:NaN}function wDe(e,t){return function(r,n){for(var s=r.length,o=[],i=0,l=e[0],c=0;s>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),o.push(r.substring(s-=l,s+l)),!((c+=l+1)>n));)l=e[i=(i+1)%e.length];return o.reverse().join(t)}}function jDe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var _De=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function r1(e){if(!(t=_De.exec(e)))throw new Error("invalid format: "+e);var t;return new OM({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}r1.prototype=OM.prototype;function OM(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}OM.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function NDe(e){e:for(var t=e.length,r=1,n=-1,s;r<t;++r)switch(e[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(s+1):e}var AQ;function SDe(e,t){var r=lS(e,t);if(!r)return e+"";var n=r[0],s=r[1],o=s-(AQ=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,i=n.length;return o===i?n:o>i?n+new Array(o-i+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+lS(e,Math.max(0,t+o-1))[0]}function lq(e,t){var r=lS(e,t);if(!r)return e+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const cq={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:bDe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>lq(e*100,t),r:lq,s:SDe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function dq(e){return e}var uq=Array.prototype.map,fq=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function CDe(e){var t=e.grouping===void 0||e.thousands===void 0?dq:wDe(uq.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",s=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?dq:jDe(uq.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function d(f){f=r1(f);var h=f.fill,m=f.align,x=f.sign,g=f.symbol,v=f.zero,y=f.width,b=f.comma,w=f.precision,j=f.trim,_=f.type;_==="n"?(b=!0,_="g"):cq[_]||(w===void 0&&(w=12),j=!0,_="g"),(v||h==="0"&&m==="=")&&(v=!0,h="0",m="=");var C=g==="$"?r:g==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",E=g==="$"?n:/[%p]/.test(_)?i:"",S=cq[_],A=/[defgprs%]/.test(_);w=w===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function M(O){var I=C,T=E,k,q,B;if(_==="c")T=S(O)+T,O="";else{O=+O;var z=O<0||1/O<0;if(O=isNaN(O)?c:S(Math.abs(O),w),j&&(O=NDe(O)),z&&+O==0&&x!=="+"&&(z=!1),I=(z?x==="("?x:l:x==="-"||x==="("?"":x)+I,T=(_==="s"?fq[8+AQ/3]:"")+T+(z&&x==="("?")":""),A){for(k=-1,q=O.length;++k<q;)if(B=O.charCodeAt(k),48>B||B>57){T=(B===46?s+O.slice(k+1):O.slice(k))+T,O=O.slice(0,k);break}}}b&&!v&&(O=t(O,1/0));var F=I.length+O.length+T.length,V=F<y?new Array(y-F+1).join(h):"";switch(b&&v&&(O=t(V+O,V.length?y-T.length:1/0),V=""),m){case"<":O=I+O+T+V;break;case"=":O=I+V+O+T;break;case"^":O=V.slice(0,F=V.length>>1)+I+O+T+V.slice(F);break;default:O=V+I+O+T;break}return o(O)}return M.toString=function(){return f+""},M}function u(f,h){var m=d((f=r1(f),f.type="f",f)),x=Math.max(-8,Math.min(8,Math.floor(j0(h)/3)))*3,g=Math.pow(10,-x),v=fq[8+x/3];return function(y){return m(g*y)+v}}return{format:d,formatPrefix:u}}var F_,TM,PQ;ADe({thousands:",",grouping:[3],currency:["$",""]});function ADe(e){return F_=CDe(e),TM=F_.format,PQ=F_.formatPrefix,F_}function PDe(e){return Math.max(0,-j0(Math.abs(e)))}function EDe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(j0(t)/3)))*3-j0(Math.abs(e)))}function kDe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,j0(t)-j0(e))+1}function EQ(e,t,r,n){var s=eT(e,t,r),o;switch(n=r1(n??",f"),n.type){case"s":{var i=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=EDe(s,i))&&(n.precision=o),PQ(n,i)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=kDe(s,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=PDe(s))&&(n.precision=o-(n.type==="%")*2);break}}return TM(n)}function Op(e){var t=e.domain;return e.ticks=function(r){var n=t();return QO(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var s=t();return EQ(s[0],s[s.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),s=0,o=n.length-1,i=n[s],l=n[o],c,d,u=10;for(l<i&&(d=i,i=l,l=d,d=s,s=o,o=d);u-- >0;){if(d=ZO(i,l,r),d===c)return n[s]=i,n[o]=l,t(n);if(d>0)i=Math.floor(i/d)*d,l=Math.ceil(l/d)*d;else if(d<0)i=Math.ceil(i*d)/d,l=Math.floor(l*d)/d;else break;c=d}return e},e}function cS(){var e=IM();return e.copy=function(){return uj(e,cS())},Cu.apply(e,arguments),Op(e)}function kQ(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,iS),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return kQ(e).unknown(t)},e=arguments.length?Array.from(e,iS):[0,1],Op(r)}function IQ(e,t){e=e.slice();var r=0,n=e.length-1,s=e[r],o=e[n],i;return o<s&&(i=r,r=n,n=i,i=s,s=o,o=i),e[r]=t.floor(s),e[n]=t.ceil(o),e}function mq(e){return Math.log(e)}function hq(e){return Math.exp(e)}function IDe(e){return-Math.log(-e)}function ODe(e){return-Math.exp(-e)}function TDe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function DDe(e){return e===10?TDe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function MDe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function pq(e){return(t,r)=>-e(-t,r)}function DM(e){const t=e(mq,hq),r=t.domain;let n=10,s,o;function i(){return s=MDe(n),o=DDe(n),r()[0]<0?(s=pq(s),o=pq(o),e(IDe,ODe)):e(mq,hq),t}return t.base=function(l){return arguments.length?(n=+l,i()):n},t.domain=function(l){return arguments.length?(r(l),i()):r()},t.ticks=l=>{const c=r();let d=c[0],u=c[c.length-1];const f=u<d;f&&([d,u]=[u,d]);let h=s(d),m=s(u),x,g;const v=l==null?10:+l;let y=[];if(!(n%1)&&m-h<v){if(h=Math.floor(h),m=Math.ceil(m),d>0){for(;h<=m;++h)for(x=1;x<n;++x)if(g=h<0?x/o(-h):x*o(h),!(g<d)){if(g>u)break;y.push(g)}}else for(;h<=m;++h)for(x=n-1;x>=1;--x)if(g=h>0?x/o(-h):x*o(h),!(g<d)){if(g>u)break;y.push(g)}y.length*2<v&&(y=QO(d,u,v))}else y=QO(h,m,Math.min(m-h,v)).map(o);return f?y.reverse():y},t.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=n===10?"s":","),typeof c!="function"&&(!(n%1)&&(c=r1(c)).precision==null&&(c.trim=!0),c=TM(c)),l===1/0)return c;const d=Math.max(1,n*l/t.ticks().length);return u=>{let f=u/o(Math.round(s(u)));return f*n<n-.5&&(f*=n),f<=d?c(u):""}},t.nice=()=>r(IQ(r(),{floor:l=>o(Math.floor(s(l))),ceil:l=>o(Math.ceil(s(l)))})),t}function OQ(){const e=DM(L5()).domain([1,10]);return e.copy=()=>uj(e,OQ()).base(e.base()),Cu.apply(e,arguments),e}function gq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function xq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function MM(e){var t=1,r=e(gq(t),xq(t));return r.constant=function(n){return arguments.length?e(gq(t=+n),xq(t)):t},Op(r)}function TQ(){var e=MM(L5());return e.copy=function(){return uj(e,TQ()).constant(e.constant())},Cu.apply(e,arguments)}function vq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function RDe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function FDe(e){return e<0?-e*e:e*e}function RM(e){var t=e(gc,gc),r=1;function n(){return r===1?e(gc,gc):r===.5?e(RDe,FDe):e(vq(r),vq(1/r))}return t.exponent=function(s){return arguments.length?(r=+s,n()):r},Op(t)}function FM(){var e=RM(L5());return e.copy=function(){return uj(e,FM()).exponent(e.exponent())},Cu.apply(e,arguments),e}function LDe(){return FM.apply(null,arguments).exponent(.5)}function yq(e){return Math.sign(e)*e*e}function $De(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function DQ(){var e=IM(),t=[0,1],r=!1,n;function s(o){var i=$De(e(o));return isNaN(i)?n:r?Math.round(i):i}return s.invert=function(o){return e.invert(yq(o))},s.domain=function(o){return arguments.length?(e.domain(o),s):e.domain()},s.range=function(o){return arguments.length?(e.range((t=Array.from(o,iS)).map(yq)),s):t.slice()},s.rangeRound=function(o){return s.range(o).round(!0)},s.round=function(o){return arguments.length?(r=!!o,s):r},s.clamp=function(o){return arguments.length?(e.clamp(o),s):e.clamp()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return DQ(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Cu.apply(s,arguments),Op(s)}function MQ(){var e=[],t=[],r=[],n;function s(){var i=0,l=Math.max(1,t.length);for(r=new Array(l-1);++i<l;)r[i-1]=V4e(e,i/l);return o}function o(i){return i==null||isNaN(i=+i)?n:t[cj(r,i)]}return o.invertExtent=function(i){var l=t.indexOf(i);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(i){if(!arguments.length)return e.slice();e=[];for(let l of i)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(tp),s()},o.range=function(i){return arguments.length?(t=Array.from(i),s()):t.slice()},o.unknown=function(i){return arguments.length?(n=i,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return MQ().domain(e).range(t).unknown(n)},Cu.apply(o,arguments)}function RQ(){var e=0,t=1,r=1,n=[.5],s=[0,1],o;function i(c){return c!=null&&c<=c?s[cj(n,c,0,r)]:o}function l(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return i}return i.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,l()):[e,t]},i.range=function(c){return arguments.length?(r=(s=Array.from(c)).length-1,l()):s.slice()},i.invertExtent=function(c){var d=s.indexOf(c);return d<0?[NaN,NaN]:d<1?[e,n[0]]:d>=r?[n[r-1],t]:[n[d-1],n[d]]},i.unknown=function(c){return arguments.length&&(o=c),i},i.thresholds=function(){return n.slice()},i.copy=function(){return RQ().domain([e,t]).range(s).unknown(o)},Cu.apply(Op(i),arguments)}function FQ(){var e=[.5],t=[0,1],r,n=1;function s(o){return o!=null&&o<=o?t[cj(e,o,0,n)]:r}return s.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),s):e.slice()},s.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),s):t.slice()},s.invertExtent=function(o){var i=t.indexOf(o);return[e[i-1],e[i]]},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return FQ().domain(e).range(t).unknown(r)},Cu.apply(s,arguments)}const SE=new Date,CE=new Date;function Xi(e,t,r,n){function s(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return s.floor=o=>(e(o=new Date(+o)),o),s.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),s.round=o=>{const i=s(o),l=s.ceil(o);return o-i<l-o?i:l},s.offset=(o,i)=>(t(o=new Date(+o),i==null?1:Math.floor(i)),o),s.range=(o,i,l)=>{const c=[];if(o=s.ceil(o),l=l==null?1:Math.floor(l),!(o<i)||!(l>0))return c;let d;do c.push(d=new Date(+o)),t(o,l),e(o);while(d<o&&o<i);return c},s.filter=o=>Xi(i=>{if(i>=i)for(;e(i),!o(i);)i.setTime(i-1)},(i,l)=>{if(i>=i)if(l<0)for(;++l<=0;)for(;t(i,-1),!o(i););else for(;--l>=0;)for(;t(i,1),!o(i););}),r&&(s.count=(o,i)=>(SE.setTime(+o),CE.setTime(+i),e(SE),e(CE),Math.floor(r(SE,CE))),s.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?s.filter(n?i=>n(i)%o===0:i=>s.count(0,i)%o===0):s)),s}const dS=Xi(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);dS.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Xi(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):dS);dS.range;const Nm=1e3,uu=Nm*60,Sm=uu*60,Um=Sm*24,LM=Um*7,bq=Um*30,AE=Um*365,bg=Xi(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Nm)},(e,t)=>(t-e)/Nm,e=>e.getUTCSeconds());bg.range;const $M=Xi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Nm)},(e,t)=>{e.setTime(+e+t*uu)},(e,t)=>(t-e)/uu,e=>e.getMinutes());$M.range;const BM=Xi(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*uu)},(e,t)=>(t-e)/uu,e=>e.getUTCMinutes());BM.range;const qM=Xi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Nm-e.getMinutes()*uu)},(e,t)=>{e.setTime(+e+t*Sm)},(e,t)=>(t-e)/Sm,e=>e.getHours());qM.range;const zM=Xi(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Sm)},(e,t)=>(t-e)/Sm,e=>e.getUTCHours());zM.range;const fj=Xi(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*uu)/Um,e=>e.getDate()-1);fj.range;const $5=Xi(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Um,e=>e.getUTCDate()-1);$5.range;const LQ=Xi(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Um,e=>Math.floor(e/Um));LQ.range;function bx(e){return Xi(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*uu)/LM)}const B5=bx(0),uS=bx(1),BDe=bx(2),qDe=bx(3),_0=bx(4),zDe=bx(5),UDe=bx(6);B5.range;uS.range;BDe.range;qDe.range;_0.range;zDe.range;UDe.range;function wx(e){return Xi(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/LM)}const q5=wx(0),fS=wx(1),VDe=wx(2),WDe=wx(3),N0=wx(4),HDe=wx(5),GDe=wx(6);q5.range;fS.range;VDe.range;WDe.range;N0.range;HDe.range;GDe.range;const UM=Xi(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());UM.range;const VM=Xi(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());VM.range;const Vm=Xi(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Vm.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Xi(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Vm.range;const Wm=Xi(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Wm.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Xi(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Wm.range;function $Q(e,t,r,n,s,o){const i=[[bg,1,Nm],[bg,5,5*Nm],[bg,15,15*Nm],[bg,30,30*Nm],[o,1,uu],[o,5,5*uu],[o,15,15*uu],[o,30,30*uu],[s,1,Sm],[s,3,3*Sm],[s,6,6*Sm],[s,12,12*Sm],[n,1,Um],[n,2,2*Um],[r,1,LM],[t,1,bq],[t,3,3*bq],[e,1,AE]];function l(d,u,f){const h=u<d;h&&([d,u]=[u,d]);const m=f&&typeof f.range=="function"?f:c(d,u,f),x=m?m.range(d,+u+1):[];return h?x.reverse():x}function c(d,u,f){const h=Math.abs(u-d)/f,m=CM(([,,v])=>v).right(i,h);if(m===i.length)return e.every(eT(d/AE,u/AE,f));if(m===0)return dS.every(Math.max(eT(d,u,f),1));const[x,g]=i[h/i[m-1][2]<i[m][2]/h?m-1:m];return x.every(g)}return[l,c]}const[KDe,XDe]=$Q(Wm,VM,q5,LQ,zM,BM),[YDe,JDe]=$Q(Vm,UM,B5,fj,qM,$M);function PE(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function EE(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Zy(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function QDe(e){var t=e.dateTime,r=e.date,n=e.time,s=e.periods,o=e.days,i=e.shortDays,l=e.months,c=e.shortMonths,d=eb(s),u=tb(s),f=eb(o),h=tb(o),m=eb(i),x=tb(i),g=eb(l),v=tb(l),y=eb(c),b=tb(c),w={a:z,A:F,b:V,B:me,c:null,d:Cq,e:Cq,f:wMe,g:IMe,G:TMe,H:vMe,I:yMe,j:bMe,L:BQ,m:jMe,M:_Me,p:be,q:U,Q:Eq,s:kq,S:NMe,u:SMe,U:CMe,V:AMe,w:PMe,W:EMe,x:null,X:null,y:kMe,Y:OMe,Z:DMe,"%":Pq},j={a:L,A:H,b:ie,B:Y,c:null,d:Aq,e:Aq,f:LMe,g:KMe,G:YMe,H:MMe,I:RMe,j:FMe,L:zQ,m:$Me,M:BMe,p:W,q:se,Q:Eq,s:kq,S:qMe,u:zMe,U:UMe,V:VMe,w:WMe,W:HMe,x:null,X:null,y:GMe,Y:XMe,Z:JMe,"%":Pq},_={a:M,A:O,b:I,B:T,c:k,d:Nq,e:Nq,f:hMe,g:_q,G:jq,H:Sq,I:Sq,j:dMe,L:mMe,m:cMe,M:uMe,p:A,q:lMe,Q:gMe,s:xMe,S:fMe,u:nMe,U:aMe,V:sMe,w:rMe,W:oMe,x:q,X:B,y:_q,Y:jq,Z:iMe,"%":pMe};w.x=C(r,w),w.X=C(n,w),w.c=C(t,w),j.x=C(r,j),j.X=C(n,j),j.c=C(t,j);function C(pe,G){return function(te){var oe=[],De=-1,re=0,ae=pe.length,ut,pt,ft;for(te instanceof Date||(te=new Date(+te));++De<ae;)pe.charCodeAt(De)===37&&(oe.push(pe.slice(re,De)),(pt=wq[ut=pe.charAt(++De)])!=null?ut=pe.charAt(++De):pt=ut==="e"?" ":"0",(ft=G[ut])&&(ut=ft(te,pt)),oe.push(ut),re=De+1);return oe.push(pe.slice(re,De)),oe.join("")}}function E(pe,G){return function(te){var oe=Zy(1900,void 0,1),De=S(oe,pe,te+="",0),re,ae;if(De!=te.length)return null;if("Q"in oe)return new Date(oe.Q);if("s"in oe)return new Date(oe.s*1e3+("L"in oe?oe.L:0));if(G&&!("Z"in oe)&&(oe.Z=0),"p"in oe&&(oe.H=oe.H%12+oe.p*12),oe.m===void 0&&(oe.m="q"in oe?oe.q:0),"V"in oe){if(oe.V<1||oe.V>53)return null;"w"in oe||(oe.w=1),"Z"in oe?(re=EE(Zy(oe.y,0,1)),ae=re.getUTCDay(),re=ae>4||ae===0?fS.ceil(re):fS(re),re=$5.offset(re,(oe.V-1)*7),oe.y=re.getUTCFullYear(),oe.m=re.getUTCMonth(),oe.d=re.getUTCDate()+(oe.w+6)%7):(re=PE(Zy(oe.y,0,1)),ae=re.getDay(),re=ae>4||ae===0?uS.ceil(re):uS(re),re=fj.offset(re,(oe.V-1)*7),oe.y=re.getFullYear(),oe.m=re.getMonth(),oe.d=re.getDate()+(oe.w+6)%7)}else("W"in oe||"U"in oe)&&("w"in oe||(oe.w="u"in oe?oe.u%7:"W"in oe?1:0),ae="Z"in oe?EE(Zy(oe.y,0,1)).getUTCDay():PE(Zy(oe.y,0,1)).getDay(),oe.m=0,oe.d="W"in oe?(oe.w+6)%7+oe.W*7-(ae+5)%7:oe.w+oe.U*7-(ae+6)%7);return"Z"in oe?(oe.H+=oe.Z/100|0,oe.M+=oe.Z%100,EE(oe)):PE(oe)}}function S(pe,G,te,oe){for(var De=0,re=G.length,ae=te.length,ut,pt;De<re;){if(oe>=ae)return-1;if(ut=G.charCodeAt(De++),ut===37){if(ut=G.charAt(De++),pt=_[ut in wq?G.charAt(De++):ut],!pt||(oe=pt(pe,te,oe))<0)return-1}else if(ut!=te.charCodeAt(oe++))return-1}return oe}function A(pe,G,te){var oe=d.exec(G.slice(te));return oe?(pe.p=u.get(oe[0].toLowerCase()),te+oe[0].length):-1}function M(pe,G,te){var oe=m.exec(G.slice(te));return oe?(pe.w=x.get(oe[0].toLowerCase()),te+oe[0].length):-1}function O(pe,G,te){var oe=f.exec(G.slice(te));return oe?(pe.w=h.get(oe[0].toLowerCase()),te+oe[0].length):-1}function I(pe,G,te){var oe=y.exec(G.slice(te));return oe?(pe.m=b.get(oe[0].toLowerCase()),te+oe[0].length):-1}function T(pe,G,te){var oe=g.exec(G.slice(te));return oe?(pe.m=v.get(oe[0].toLowerCase()),te+oe[0].length):-1}function k(pe,G,te){return S(pe,t,G,te)}function q(pe,G,te){return S(pe,r,G,te)}function B(pe,G,te){return S(pe,n,G,te)}function z(pe){return i[pe.getDay()]}function F(pe){return o[pe.getDay()]}function V(pe){return c[pe.getMonth()]}function me(pe){return l[pe.getMonth()]}function be(pe){return s[+(pe.getHours()>=12)]}function U(pe){return 1+~~(pe.getMonth()/3)}function L(pe){return i[pe.getUTCDay()]}function H(pe){return o[pe.getUTCDay()]}function ie(pe){return c[pe.getUTCMonth()]}function Y(pe){return l[pe.getUTCMonth()]}function W(pe){return s[+(pe.getUTCHours()>=12)]}function se(pe){return 1+~~(pe.getUTCMonth()/3)}return{format:function(pe){var G=C(pe+="",w);return G.toString=function(){return pe},G},parse:function(pe){var G=E(pe+="",!1);return G.toString=function(){return pe},G},utcFormat:function(pe){var G=C(pe+="",j);return G.toString=function(){return pe},G},utcParse:function(pe){var G=E(pe+="",!0);return G.toString=function(){return pe},G}}}var wq={"-":"",_:" ",0:"0"},hl=/^\s*\d+/,ZDe=/^%/,eMe=/[\\^$*+?|[\]().{}]/g;function eo(e,t,r){var n=e<0?"-":"",s=(n?-e:e)+"",o=s.length;return n+(o<r?new Array(r-o+1).join(t)+s:s)}function tMe(e){return e.replace(eMe,"\\$&")}function eb(e){return new RegExp("^(?:"+e.map(tMe).join("|")+")","i")}function tb(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function rMe(e,t,r){var n=hl.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function nMe(e,t,r){var n=hl.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function aMe(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function sMe(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function oMe(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function jq(e,t,r){var n=hl.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function _q(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function iMe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function lMe(e,t,r){var n=hl.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function cMe(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function Nq(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function dMe(e,t,r){var n=hl.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Sq(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function uMe(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function fMe(e,t,r){var n=hl.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function mMe(e,t,r){var n=hl.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function hMe(e,t,r){var n=hl.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function pMe(e,t,r){var n=ZDe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function gMe(e,t,r){var n=hl.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function xMe(e,t,r){var n=hl.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Cq(e,t){return eo(e.getDate(),t,2)}function vMe(e,t){return eo(e.getHours(),t,2)}function yMe(e,t){return eo(e.getHours()%12||12,t,2)}function bMe(e,t){return eo(1+fj.count(Vm(e),e),t,3)}function BQ(e,t){return eo(e.getMilliseconds(),t,3)}function wMe(e,t){return BQ(e,t)+"000"}function jMe(e,t){return eo(e.getMonth()+1,t,2)}function _Me(e,t){return eo(e.getMinutes(),t,2)}function NMe(e,t){return eo(e.getSeconds(),t,2)}function SMe(e){var t=e.getDay();return t===0?7:t}function CMe(e,t){return eo(B5.count(Vm(e)-1,e),t,2)}function qQ(e){var t=e.getDay();return t>=4||t===0?_0(e):_0.ceil(e)}function AMe(e,t){return e=qQ(e),eo(_0.count(Vm(e),e)+(Vm(e).getDay()===4),t,2)}function PMe(e){return e.getDay()}function EMe(e,t){return eo(uS.count(Vm(e)-1,e),t,2)}function kMe(e,t){return eo(e.getFullYear()%100,t,2)}function IMe(e,t){return e=qQ(e),eo(e.getFullYear()%100,t,2)}function OMe(e,t){return eo(e.getFullYear()%1e4,t,4)}function TMe(e,t){var r=e.getDay();return e=r>=4||r===0?_0(e):_0.ceil(e),eo(e.getFullYear()%1e4,t,4)}function DMe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+eo(t/60|0,"0",2)+eo(t%60,"0",2)}function Aq(e,t){return eo(e.getUTCDate(),t,2)}function MMe(e,t){return eo(e.getUTCHours(),t,2)}function RMe(e,t){return eo(e.getUTCHours()%12||12,t,2)}function FMe(e,t){return eo(1+$5.count(Wm(e),e),t,3)}function zQ(e,t){return eo(e.getUTCMilliseconds(),t,3)}function LMe(e,t){return zQ(e,t)+"000"}function $Me(e,t){return eo(e.getUTCMonth()+1,t,2)}function BMe(e,t){return eo(e.getUTCMinutes(),t,2)}function qMe(e,t){return eo(e.getUTCSeconds(),t,2)}function zMe(e){var t=e.getUTCDay();return t===0?7:t}function UMe(e,t){return eo(q5.count(Wm(e)-1,e),t,2)}function UQ(e){var t=e.getUTCDay();return t>=4||t===0?N0(e):N0.ceil(e)}function VMe(e,t){return e=UQ(e),eo(N0.count(Wm(e),e)+(Wm(e).getUTCDay()===4),t,2)}function WMe(e){return e.getUTCDay()}function HMe(e,t){return eo(fS.count(Wm(e)-1,e),t,2)}function GMe(e,t){return eo(e.getUTCFullYear()%100,t,2)}function KMe(e,t){return e=UQ(e),eo(e.getUTCFullYear()%100,t,2)}function XMe(e,t){return eo(e.getUTCFullYear()%1e4,t,4)}function YMe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?N0(e):N0.ceil(e),eo(e.getUTCFullYear()%1e4,t,4)}function JMe(){return"+0000"}function Pq(){return"%"}function Eq(e){return+e}function kq(e){return Math.floor(+e/1e3)}var Ux,VQ,WQ;QMe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function QMe(e){return Ux=QDe(e),VQ=Ux.format,Ux.parse,WQ=Ux.utcFormat,Ux.utcParse,Ux}function ZMe(e){return new Date(e)}function eRe(e){return e instanceof Date?+e:+new Date(+e)}function WM(e,t,r,n,s,o,i,l,c,d){var u=IM(),f=u.invert,h=u.domain,m=d(".%L"),x=d(":%S"),g=d("%I:%M"),v=d("%I %p"),y=d("%a %d"),b=d("%b %d"),w=d("%B"),j=d("%Y");function _(C){return(c(C)<C?m:l(C)<C?x:i(C)<C?g:o(C)<C?v:n(C)<C?s(C)<C?y:b:r(C)<C?w:j)(C)}return u.invert=function(C){return new Date(f(C))},u.domain=function(C){return arguments.length?h(Array.from(C,eRe)):h().map(ZMe)},u.ticks=function(C){var E=h();return e(E[0],E[E.length-1],C??10)},u.tickFormat=function(C,E){return E==null?_:d(E)},u.nice=function(C){var E=h();return(!C||typeof C.range!="function")&&(C=t(E[0],E[E.length-1],C??10)),C?h(IQ(E,C)):u},u.copy=function(){return uj(u,WM(e,t,r,n,s,o,i,l,c,d))},u}function tRe(){return Cu.apply(WM(YDe,JDe,Vm,UM,B5,fj,qM,$M,bg,VQ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function rRe(){return Cu.apply(WM(KDe,XDe,Wm,VM,q5,$5,zM,BM,bg,WQ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function z5(){var e=0,t=1,r,n,s,o,i=gc,l=!1,c;function d(f){return f==null||isNaN(f=+f)?c:i(s===0?.5:(f=(o(f)-r)*s,l?Math.max(0,Math.min(1,f)):f))}d.domain=function(f){return arguments.length?([e,t]=f,r=o(e=+e),n=o(t=+t),s=r===n?0:1/(n-r),d):[e,t]},d.clamp=function(f){return arguments.length?(l=!!f,d):l},d.interpolator=function(f){return arguments.length?(i=f,d):i};function u(f){return function(h){var m,x;return arguments.length?([m,x]=h,i=f(m,x),d):[i(0),i(1)]}}return d.range=u(vy),d.rangeRound=u(kM),d.unknown=function(f){return arguments.length?(c=f,d):c},function(f){return o=f,r=f(e),n=f(t),s=r===n?0:1/(n-r),d}}function Tp(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function HQ(){var e=Op(z5()(gc));return e.copy=function(){return Tp(e,HQ())},Zm.apply(e,arguments)}function GQ(){var e=DM(z5()).domain([1,10]);return e.copy=function(){return Tp(e,GQ()).base(e.base())},Zm.apply(e,arguments)}function KQ(){var e=MM(z5());return e.copy=function(){return Tp(e,KQ()).constant(e.constant())},Zm.apply(e,arguments)}function HM(){var e=RM(z5());return e.copy=function(){return Tp(e,HM()).exponent(e.exponent())},Zm.apply(e,arguments)}function nRe(){return HM.apply(null,arguments).exponent(.5)}function XQ(){var e=[],t=gc;function r(n){if(n!=null&&!isNaN(n=+n))return t((cj(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let s of n)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(tp),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,s)=>t(s/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(s,o)=>U4e(e,o/n))},r.copy=function(){return XQ(t).domain(e)},Zm.apply(r,arguments)}function U5(){var e=0,t=.5,r=1,n=1,s,o,i,l,c,d=gc,u,f=!1,h;function m(g){return isNaN(g=+g)?h:(g=.5+((g=+u(g))-o)*(n*g<n*o?l:c),d(f?Math.max(0,Math.min(1,g)):g))}m.domain=function(g){return arguments.length?([e,t,r]=g,s=u(e=+e),o=u(t=+t),i=u(r=+r),l=s===o?0:.5/(o-s),c=o===i?0:.5/(i-o),n=o<s?-1:1,m):[e,t,r]},m.clamp=function(g){return arguments.length?(f=!!g,m):f},m.interpolator=function(g){return arguments.length?(d=g,m):d};function x(g){return function(v){var y,b,w;return arguments.length?([y,b,w]=v,d=pDe(g,[y,b,w]),m):[d(0),d(.5),d(1)]}}return m.range=x(vy),m.rangeRound=x(kM),m.unknown=function(g){return arguments.length?(h=g,m):h},function(g){return u=g,s=g(e),o=g(t),i=g(r),l=s===o?0:.5/(o-s),c=o===i?0:.5/(i-o),n=o<s?-1:1,m}}function YQ(){var e=Op(U5()(gc));return e.copy=function(){return Tp(e,YQ())},Zm.apply(e,arguments)}function JQ(){var e=DM(U5()).domain([.1,1,10]);return e.copy=function(){return Tp(e,JQ()).base(e.base())},Zm.apply(e,arguments)}function QQ(){var e=MM(U5());return e.copy=function(){return Tp(e,QQ()).constant(e.constant())},Zm.apply(e,arguments)}function GM(){var e=RM(U5());return e.copy=function(){return Tp(e,GM()).exponent(e.exponent())},Zm.apply(e,arguments)}function aRe(){return GM.apply(null,arguments).exponent(.5)}const Iq=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Qw,scaleDiverging:YQ,scaleDivergingLog:JQ,scaleDivergingPow:GM,scaleDivergingSqrt:aRe,scaleDivergingSymlog:QQ,scaleIdentity:kQ,scaleImplicit:tT,scaleLinear:cS,scaleLog:OQ,scaleOrdinal:AM,scalePoint:Xb,scalePow:FM,scaleQuantile:MQ,scaleQuantize:RQ,scaleRadial:DQ,scaleSequential:HQ,scaleSequentialLog:GQ,scaleSequentialPow:HM,scaleSequentialQuantile:XQ,scaleSequentialSqrt:nRe,scaleSequentialSymlog:KQ,scaleSqrt:LDe,scaleSymlog:TQ,scaleThreshold:FQ,scaleTime:tRe,scaleUtc:rRe,tickFormat:EQ},Symbol.toStringTag,{value:"Module"}));var sRe=cy;function oRe(e,t,r){for(var n=-1,s=e.length;++n<s;){var o=e[n],i=t(o);if(i!=null&&(l===void 0?i===i&&!sRe(i):r(i,l)))var l=i,c=o}return c}var V5=oRe;function iRe(e,t){return e>t}var ZQ=iRe,lRe=V5,cRe=ZQ,dRe=xy;function uRe(e){return e&&e.length?lRe(e,dRe,cRe):void 0}var fRe=uRe;const Mh=Us(fRe);function mRe(e,t){return e<t}var eZ=mRe,hRe=V5,pRe=eZ,gRe=xy;function xRe(e){return e&&e.length?hRe(e,gRe,pRe):void 0}var vRe=xRe;const W5=Us(vRe);var yRe=iM,bRe=em,wRe=lQ,jRe=Yc;function _Re(e,t){var r=jRe(e)?yRe:wRe;return r(e,bRe(t))}var NRe=_Re,SRe=oQ,CRe=NRe;function ARe(e,t){return SRe(CRe(e,t),1)}var PRe=ARe;const ERe=Us(PRe);var kRe=jM;function IRe(e,t){return kRe(e,t)}var ORe=IRe;const rx=Us(ORe);var yy=1e9,TRe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},XM,Ko=!0,ju="[DecimalError] ",Mg=ju+"Invalid argument: ",KM=ju+"Exponent out of range: ",by=Math.floor,sg=Math.pow,DRe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,bd,sl=1e7,$o=7,tZ=9007199254740991,mS=by(tZ/$o),_a={};_a.absoluteValue=_a.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};_a.comparedTo=_a.cmp=function(e){var t,r,n,s,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,s=e.d.length,t=0,r=n<s?n:s;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===s?0:n>s^o.s<0?1:-1};_a.decimalPlaces=_a.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*$o;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};_a.dividedBy=_a.div=function(e){return Om(this,new this.constructor(e))};_a.dividedToIntegerBy=_a.idiv=function(e){var t=this,r=t.constructor;return _o(Om(t,new r(e),0,1),r.precision)};_a.equals=_a.eq=function(e){return!this.cmp(e)};_a.exponent=function(){return Mi(this)};_a.greaterThan=_a.gt=function(e){return this.cmp(e)>0};_a.greaterThanOrEqualTo=_a.gte=function(e){return this.cmp(e)>=0};_a.isInteger=_a.isint=function(){return this.e>this.d.length-2};_a.isNegative=_a.isneg=function(){return this.s<0};_a.isPositive=_a.ispos=function(){return this.s>0};_a.isZero=function(){return this.s===0};_a.lessThan=_a.lt=function(e){return this.cmp(e)<0};_a.lessThanOrEqualTo=_a.lte=function(e){return this.cmp(e)<1};_a.logarithm=_a.log=function(e){var t,r=this,n=r.constructor,s=n.precision,o=s+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(bd))throw Error(ju+"NaN");if(r.s<1)throw Error(ju+(r.s?"NaN":"-Infinity"));return r.eq(bd)?new n(0):(Ko=!1,t=Om(n1(r,o),n1(e,o),o),Ko=!0,_o(t,s))};_a.minus=_a.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?aZ(t,e):rZ(t,(e.s=-e.s,e))};_a.modulo=_a.mod=function(e){var t,r=this,n=r.constructor,s=n.precision;if(e=new n(e),!e.s)throw Error(ju+"NaN");return r.s?(Ko=!1,t=Om(r,e,0,1).times(e),Ko=!0,r.minus(t)):_o(new n(r),s)};_a.naturalExponential=_a.exp=function(){return nZ(this)};_a.naturalLogarithm=_a.ln=function(){return n1(this)};_a.negated=_a.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};_a.plus=_a.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?rZ(t,e):aZ(t,(e.s=-e.s,e))};_a.precision=_a.sd=function(e){var t,r,n,s=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Mg+e);if(t=Mi(s)+1,n=s.d.length-1,r=n*$o+1,n=s.d[n],n){for(;n%10==0;n/=10)r--;for(n=s.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};_a.squareRoot=_a.sqrt=function(){var e,t,r,n,s,o,i,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(ju+"NaN")}for(e=Mi(l),Ko=!1,s=Math.sqrt(+l),s==0||s==1/0?(t=Tf(l.d),(t.length+e)%2==0&&(t+="0"),s=Math.sqrt(t),e=by((e+1)/2)-(e<0||e%2),s==1/0?t="5e"+e:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new c(t)):n=new c(s.toString()),r=c.precision,s=i=r+3;;)if(o=n,n=o.plus(Om(l,o,i+2)).times(.5),Tf(o.d).slice(0,i)===(t=Tf(n.d)).slice(0,i)){if(t=t.slice(i-3,i+1),s==i&&t=="4999"){if(_o(o,r+1,0),o.times(o).eq(l)){n=o;break}}else if(t!="9999")break;i+=4}return Ko=!0,_o(n,r)};_a.times=_a.mul=function(e){var t,r,n,s,o,i,l,c,d,u=this,f=u.constructor,h=u.d,m=(e=new f(e)).d;if(!u.s||!e.s)return new f(0);for(e.s*=u.s,r=u.e+e.e,c=h.length,d=m.length,c<d&&(o=h,h=m,m=o,i=c,c=d,d=i),o=[],i=c+d,n=i;n--;)o.push(0);for(n=d;--n>=0;){for(t=0,s=c+n;s>n;)l=o[s]+m[n]*h[s-n-1]+t,o[s--]=l%sl|0,t=l/sl|0;o[s]=(o[s]+t)%sl|0}for(;!o[--i];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,Ko?_o(e,f.precision):e};_a.toDecimalPlaces=_a.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Yf(e,0,yy),t===void 0?t=n.rounding:Yf(t,0,8),_o(r,e+Mi(r)+1,t))};_a.toExponential=function(e,t){var r,n=this,s=n.constructor;return e===void 0?r=nx(n,!0):(Yf(e,0,yy),t===void 0?t=s.rounding:Yf(t,0,8),n=_o(new s(n),e+1,t),r=nx(n,!0,e+1)),r};_a.toFixed=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?nx(s):(Yf(e,0,yy),t===void 0?t=o.rounding:Yf(t,0,8),n=_o(new o(s),e+Mi(s)+1,t),r=nx(n.abs(),!1,e+Mi(n)+1),s.isneg()&&!s.isZero()?"-"+r:r)};_a.toInteger=_a.toint=function(){var e=this,t=e.constructor;return _o(new t(e),Mi(e)+1,t.rounding)};_a.toNumber=function(){return+this};_a.toPower=_a.pow=function(e){var t,r,n,s,o,i,l=this,c=l.constructor,d=12,u=+(e=new c(e));if(!e.s)return new c(bd);if(l=new c(l),!l.s){if(e.s<1)throw Error(ju+"Infinity");return l}if(l.eq(bd))return l;if(n=c.precision,e.eq(bd))return _o(l,n);if(t=e.e,r=e.d.length-1,i=t>=r,o=l.s,i){if((r=u<0?-u:u)<=tZ){for(s=new c(bd),t=Math.ceil(n/$o+4),Ko=!1;r%2&&(s=s.times(l),Tq(s.d,t)),r=by(r/2),r!==0;)l=l.times(l),Tq(l.d,t);return Ko=!0,e.s<0?new c(bd).div(s):_o(s,n)}}else if(o<0)throw Error(ju+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,l.s=1,Ko=!1,s=e.times(n1(l,n+d)),Ko=!0,s=nZ(s),s.s=o,s};_a.toPrecision=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?(r=Mi(s),n=nx(s,r<=o.toExpNeg||r>=o.toExpPos)):(Yf(e,1,yy),t===void 0?t=o.rounding:Yf(t,0,8),s=_o(new o(s),e,t),r=Mi(s),n=nx(s,e<=r||r<=o.toExpNeg,e)),n};_a.toSignificantDigits=_a.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Yf(e,1,yy),t===void 0?t=n.rounding:Yf(t,0,8)),_o(new n(r),e,t)};_a.toString=_a.valueOf=_a.val=_a.toJSON=_a[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Mi(e),r=e.constructor;return nx(e,t<=r.toExpNeg||t>=r.toExpPos)};function rZ(e,t){var r,n,s,o,i,l,c,d,u=e.constructor,f=u.precision;if(!e.s||!t.s)return t.s||(t=new u(e)),Ko?_o(t,f):t;if(c=e.d,d=t.d,i=e.e,s=t.e,c=c.slice(),o=i-s,o){for(o<0?(n=c,o=-o,l=d.length):(n=d,s=i,l=c.length),i=Math.ceil(f/$o),l=i>l?i+1:l+1,o>l&&(o=l,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(l=c.length,o=d.length,l-o<0&&(o=l,n=d,d=c,c=n),r=0;o;)r=(c[--o]=c[o]+d[o]+r)/sl|0,c[o]%=sl;for(r&&(c.unshift(r),++s),l=c.length;c[--l]==0;)c.pop();return t.d=c,t.e=s,Ko?_o(t,f):t}function Yf(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Mg+e)}function Tf(e){var t,r,n,s=e.length-1,o="",i=e[0];if(s>0){for(o+=i,t=1;t<s;t++)n=e[t]+"",r=$o-n.length,r&&(o+=_h(r)),o+=n;i=e[t],n=i+"",r=$o-n.length,r&&(o+=_h(r))}else if(i===0)return"0";for(;i%10===0;)i/=10;return o+i}var Om=function(){function e(n,s){var o,i=0,l=n.length;for(n=n.slice();l--;)o=n[l]*s+i,n[l]=o%sl|0,i=o/sl|0;return i&&n.unshift(i),n}function t(n,s,o,i){var l,c;if(o!=i)c=o>i?1:-1;else for(l=c=0;l<o;l++)if(n[l]!=s[l]){c=n[l]>s[l]?1:-1;break}return c}function r(n,s,o){for(var i=0;o--;)n[o]-=i,i=n[o]<s[o]?1:0,n[o]=i*sl+n[o]-s[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,s,o,i){var l,c,d,u,f,h,m,x,g,v,y,b,w,j,_,C,E,S,A=n.constructor,M=n.s==s.s?1:-1,O=n.d,I=s.d;if(!n.s)return new A(n);if(!s.s)throw Error(ju+"Division by zero");for(c=n.e-s.e,E=I.length,_=O.length,m=new A(M),x=m.d=[],d=0;I[d]==(O[d]||0);)++d;if(I[d]>(O[d]||0)&&--c,o==null?b=o=A.precision:i?b=o+(Mi(n)-Mi(s))+1:b=o,b<0)return new A(0);if(b=b/$o+2|0,d=0,E==1)for(u=0,I=I[0],b++;(d<_||u)&&b--;d++)w=u*sl+(O[d]||0),x[d]=w/I|0,u=w%I|0;else{for(u=sl/(I[0]+1)|0,u>1&&(I=e(I,u),O=e(O,u),E=I.length,_=O.length),j=E,g=O.slice(0,E),v=g.length;v<E;)g[v++]=0;S=I.slice(),S.unshift(0),C=I[0],I[1]>=sl/2&&++C;do u=0,l=t(I,g,E,v),l<0?(y=g[0],E!=v&&(y=y*sl+(g[1]||0)),u=y/C|0,u>1?(u>=sl&&(u=sl-1),f=e(I,u),h=f.length,v=g.length,l=t(f,g,h,v),l==1&&(u--,r(f,E<h?S:I,h))):(u==0&&(l=u=1),f=I.slice()),h=f.length,h<v&&f.unshift(0),r(g,f,v),l==-1&&(v=g.length,l=t(I,g,E,v),l<1&&(u++,r(g,E<v?S:I,v))),v=g.length):l===0&&(u++,g=[0]),x[d++]=u,l&&g[0]?g[v++]=O[j]||0:(g=[O[j]],v=1);while((j++<_||g[0]!==void 0)&&b--)}return x[0]||x.shift(),m.e=c,_o(m,i?o+Mi(m)+1:o)}}();function nZ(e,t){var r,n,s,o,i,l,c=0,d=0,u=e.constructor,f=u.precision;if(Mi(e)>16)throw Error(KM+Mi(e));if(!e.s)return new u(bd);for(t==null?(Ko=!1,l=f):l=t,i=new u(.03125);e.abs().gte(.1);)e=e.times(i),d+=5;for(n=Math.log(sg(2,d))/Math.LN10*2+5|0,l+=n,r=s=o=new u(bd),u.precision=l;;){if(s=_o(s.times(e),l),r=r.times(++c),i=o.plus(Om(s,r,l)),Tf(i.d).slice(0,l)===Tf(o.d).slice(0,l)){for(;d--;)o=_o(o.times(o),l);return u.precision=f,t==null?(Ko=!0,_o(o,f)):o}o=i}}function Mi(e){for(var t=e.e*$o,r=e.d[0];r>=10;r/=10)t++;return t}function kE(e,t,r){if(t>e.LN10.sd())throw Ko=!0,r&&(e.precision=r),Error(ju+"LN10 precision limit exceeded");return _o(new e(e.LN10),t)}function _h(e){for(var t="";e--;)t+="0";return t}function n1(e,t){var r,n,s,o,i,l,c,d,u,f=1,h=10,m=e,x=m.d,g=m.constructor,v=g.precision;if(m.s<1)throw Error(ju+(m.s?"NaN":"-Infinity"));if(m.eq(bd))return new g(0);if(t==null?(Ko=!1,d=v):d=t,m.eq(10))return t==null&&(Ko=!0),kE(g,d);if(d+=h,g.precision=d,r=Tf(x),n=r.charAt(0),o=Mi(m),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)m=m.times(e),r=Tf(m.d),n=r.charAt(0),f++;o=Mi(m),n>1?(m=new g("0."+r),o++):m=new g(n+"."+r.slice(1))}else return c=kE(g,d+2,v).times(o+""),m=n1(new g(n+"."+r.slice(1)),d-h).plus(c),g.precision=v,t==null?(Ko=!0,_o(m,v)):m;for(l=i=m=Om(m.minus(bd),m.plus(bd),d),u=_o(m.times(m),d),s=3;;){if(i=_o(i.times(u),d),c=l.plus(Om(i,new g(s),d)),Tf(c.d).slice(0,d)===Tf(l.d).slice(0,d))return l=l.times(2),o!==0&&(l=l.plus(kE(g,d+2,v).times(o+""))),l=Om(l,new g(f),d),g.precision=v,t==null?(Ko=!0,_o(l,v)):l;l=c,s+=2}}function Oq(e,t){var r,n,s;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(s=t.length;t.charCodeAt(s-1)===48;)--s;if(t=t.slice(n,s),t){if(s-=n,r=r-n-1,e.e=by(r/$o),e.d=[],n=(r+1)%$o,r<0&&(n+=$o),n<s){for(n&&e.d.push(+t.slice(0,n)),s-=$o;n<s;)e.d.push(+t.slice(n,n+=$o));t=t.slice(n),n=$o-t.length}else n-=s;for(;n--;)t+="0";if(e.d.push(+t),Ko&&(e.e>mS||e.e<-mS))throw Error(KM+r)}else e.s=0,e.e=0,e.d=[0];return e}function _o(e,t,r){var n,s,o,i,l,c,d,u,f=e.d;for(i=1,o=f[0];o>=10;o/=10)i++;if(n=t-i,n<0)n+=$o,s=t,d=f[u=0];else{if(u=Math.ceil((n+1)/$o),o=f.length,u>=o)return e;for(d=o=f[u],i=1;o>=10;o/=10)i++;n%=$o,s=n-$o+i}if(r!==void 0&&(o=sg(10,i-s-1),l=d/o%10|0,c=t<0||f[u+1]!==void 0||d%o,c=r<4?(l||c)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||c||r==6&&(n>0?s>0?d/sg(10,i-s):0:f[u-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return c?(o=Mi(e),f.length=1,t=t-o-1,f[0]=sg(10,($o-t%$o)%$o),e.e=by(-t/$o)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=u,o=1,u--):(f.length=u+1,o=sg(10,$o-n),f[u]=s>0?(d/sg(10,i-s)%sg(10,s)|0)*o:0),c)for(;;)if(u==0){(f[0]+=o)==sl&&(f[0]=1,++e.e);break}else{if(f[u]+=o,f[u]!=sl)break;f[u--]=0,o=1}for(n=f.length;f[--n]===0;)f.pop();if(Ko&&(e.e>mS||e.e<-mS))throw Error(KM+Mi(e));return e}function aZ(e,t){var r,n,s,o,i,l,c,d,u,f,h=e.constructor,m=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),Ko?_o(t,m):t;if(c=e.d,f=t.d,n=t.e,d=e.e,c=c.slice(),i=d-n,i){for(u=i<0,u?(r=c,i=-i,l=f.length):(r=f,n=d,l=c.length),s=Math.max(Math.ceil(m/$o),l)+2,i>s&&(i=s,r.length=1),r.reverse(),s=i;s--;)r.push(0);r.reverse()}else{for(s=c.length,l=f.length,u=s<l,u&&(l=s),s=0;s<l;s++)if(c[s]!=f[s]){u=c[s]<f[s];break}i=0}for(u&&(r=c,c=f,f=r,t.s=-t.s),l=c.length,s=f.length-l;s>0;--s)c[l++]=0;for(s=f.length;s>i;){if(c[--s]<f[s]){for(o=s;o&&c[--o]===0;)c[o]=sl-1;--c[o],c[s]+=sl}c[s]-=f[s]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(t.d=c,t.e=n,Ko?_o(t,m):t):new h(0)}function nx(e,t,r){var n,s=Mi(e),o=Tf(e.d),i=o.length;return t?(r&&(n=r-i)>0?o=o.charAt(0)+"."+o.slice(1)+_h(n):i>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(s<0?"e":"e+")+s):s<0?(o="0."+_h(-s-1)+o,r&&(n=r-i)>0&&(o+=_h(n))):s>=i?(o+=_h(s+1-i),r&&(n=r-s-1)>0&&(o=o+"."+_h(n))):((n=s+1)<i&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-i)>0&&(s+1===i&&(o+="."),o+=_h(n))),e.s<0?"-"+o:o}function Tq(e,t){if(e.length>t)return e.length=t,!0}function sZ(e){var t,r,n;function s(o){var i=this;if(!(i instanceof s))return new s(o);if(i.constructor=s,o instanceof s){i.s=o.s,i.e=o.e,i.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(Mg+o);if(o>0)i.s=1;else if(o<0)o=-o,i.s=-1;else{i.s=0,i.e=0,i.d=[0];return}if(o===~~o&&o<1e7){i.e=0,i.d=[o];return}return Oq(i,o.toString())}else if(typeof o!="string")throw Error(Mg+o);if(o.charCodeAt(0)===45?(o=o.slice(1),i.s=-1):i.s=1,DRe.test(o))Oq(i,o);else throw Error(Mg+o)}if(s.prototype=_a,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=sZ,s.config=s.set=MRe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return s.config(e),s}function MRe(e){if(!e||typeof e!="object")throw Error(ju+"Object expected");var t,r,n,s=["precision",1,yy,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<s.length;t+=3)if((n=e[r=s[t]])!==void 0)if(by(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(Mg+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Mg+r+": "+n);return this}var XM=sZ(TRe);bd=new XM(1);const vo=XM;function RRe(e){return BRe(e)||$Re(e)||LRe(e)||FRe()}function FRe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LRe(e,t){if(e){if(typeof e=="string")return sT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sT(e,t)}}function $Re(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function BRe(e){if(Array.isArray(e))return sT(e)}function sT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var qRe=function(t){return t},oZ={"@@functional/placeholder":!0},iZ=function(t){return t===oZ},Dq=function(t){return function r(){return arguments.length===0||arguments.length===1&&iZ(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},zRe=function e(t,r){return t===1?r:Dq(function(){for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];var i=s.filter(function(l){return l!==oZ}).length;return i>=t?r.apply(void 0,s):e(t-i,Dq(function(){for(var l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];var u=s.map(function(f){return iZ(f)?c.shift():f});return r.apply(void 0,RRe(u).concat(c))}))})},H5=function(t){return zRe(t.length,t)},oT=function(t,r){for(var n=[],s=t;s<r;++s)n[s-t]=s;return n},URe=H5(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),VRe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return qRe;var s=r.reverse(),o=s[0],i=s.slice(1);return function(){return i.reduce(function(l,c){return c(l)},o.apply(void 0,arguments))}},iT=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},lZ=function(t){var r=null,n=null;return function(){for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return r&&o.every(function(l,c){return l===r[c]})||(r=o,n=t.apply(void 0,o)),n}};function WRe(e){var t;return e===0?t=1:t=Math.floor(new vo(e).abs().log(10).toNumber())+1,t}function HRe(e,t,r){for(var n=new vo(e),s=0,o=[];n.lt(t)&&s<1e5;)o.push(n.toNumber()),n=n.add(r),s++;return o}var GRe=H5(function(e,t,r){var n=+e,s=+t;return n+r*(s-n)}),KRe=H5(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),XRe=H5(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const G5={rangeStep:HRe,getDigitCount:WRe,interpolateNumber:GRe,uninterpolateNumber:KRe,uninterpolateTruncation:XRe};function lT(e){return QRe(e)||JRe(e)||cZ(e)||YRe()}function YRe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JRe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function QRe(e){if(Array.isArray(e))return cT(e)}function a1(e,t){return tFe(e)||eFe(e,t)||cZ(e,t)||ZRe()}function ZRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cZ(e,t){if(e){if(typeof e=="string")return cT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cT(e,t)}}function cT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function eFe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,s=!1,o=void 0;try{for(var i=e[Symbol.iterator](),l;!(n=(l=i.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(c){s=!0,o=c}finally{try{!n&&i.return!=null&&i.return()}finally{if(s)throw o}}return r}}function tFe(e){if(Array.isArray(e))return e}function dZ(e){var t=a1(e,2),r=t[0],n=t[1],s=r,o=n;return r>n&&(s=n,o=r),[s,o]}function uZ(e,t,r){if(e.lte(0))return new vo(0);var n=G5.getDigitCount(e.toNumber()),s=new vo(10).pow(n),o=e.div(s),i=n!==1?.05:.1,l=new vo(Math.ceil(o.div(i).toNumber())).add(r).mul(i),c=l.mul(s);return t?c:new vo(Math.ceil(c))}function rFe(e,t,r){var n=1,s=new vo(e);if(!s.isint()&&r){var o=Math.abs(e);o<1?(n=new vo(10).pow(G5.getDigitCount(e)-1),s=new vo(Math.floor(s.div(n).toNumber())).mul(n)):o>1&&(s=new vo(Math.floor(e)))}else e===0?s=new vo(Math.floor((t-1)/2)):r||(s=new vo(Math.floor(e)));var i=Math.floor((t-1)/2),l=VRe(URe(function(c){return s.add(new vo(c-i).mul(n)).toNumber()}),oT);return l(0,t)}function fZ(e,t,r,n){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new vo(0),tickMin:new vo(0),tickMax:new vo(0)};var o=uZ(new vo(t).sub(e).div(r-1),n,s),i;e<=0&&t>=0?i=new vo(0):(i=new vo(e).add(t).div(2),i=i.sub(new vo(i).mod(o)));var l=Math.ceil(i.sub(e).div(o).toNumber()),c=Math.ceil(new vo(t).sub(i).div(o).toNumber()),d=l+c+1;return d>r?fZ(e,t,r,n,s+1):(d<r&&(c=t>0?c+(r-d):c,l=t>0?l:l+(r-d)),{step:o,tickMin:i.sub(new vo(l).mul(o)),tickMax:i.add(new vo(c).mul(o))})}function nFe(e){var t=a1(e,2),r=t[0],n=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=Math.max(s,2),l=dZ([r,n]),c=a1(l,2),d=c[0],u=c[1];if(d===-1/0||u===1/0){var f=u===1/0?[d].concat(lT(oT(0,s-1).map(function(){return 1/0}))):[].concat(lT(oT(0,s-1).map(function(){return-1/0})),[u]);return r>n?iT(f):f}if(d===u)return rFe(d,s,o);var h=fZ(d,u,i,o),m=h.step,x=h.tickMin,g=h.tickMax,v=G5.rangeStep(x,g.add(new vo(.1).mul(m)),m);return r>n?iT(v):v}function aFe(e,t){var r=a1(e,2),n=r[0],s=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=dZ([n,s]),l=a1(i,2),c=l[0],d=l[1];if(c===-1/0||d===1/0)return[n,s];if(c===d)return[c];var u=Math.max(t,2),f=uZ(new vo(d).sub(c).div(u-1),o,0),h=[].concat(lT(G5.rangeStep(new vo(c),new vo(d).sub(new vo(.99).mul(f)),f)),[d]);return n>s?iT(h):h}var sFe=lZ(nFe),oFe=lZ(aFe),iFe=!0,IE="Invariant failed";function vp(e,t){if(!e){if(iFe)throw new Error(IE);var r=typeof t=="function"?t():t,n=r?"".concat(IE,": ").concat(r):IE;throw new Error(n)}}var lFe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function S0(e){"@babel/helpers - typeof";return S0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S0(e)}function hS(){return hS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hS.apply(this,arguments)}function cFe(e,t){return mFe(e)||fFe(e,t)||uFe(e,t)||dFe()}function dFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uFe(e,t){if(e){if(typeof e=="string")return Mq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mq(e,t)}}function Mq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function mFe(e){if(Array.isArray(e))return e}function hFe(e,t){if(e==null)return{};var r=pFe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function pFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function gFe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pZ(n.key),n)}}function xFe(e,t,r){return t&&Rq(e.prototype,t),r&&Rq(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function vFe(e,t,r){return t=pS(t),yFe(e,mZ()?Reflect.construct(t,r||[],pS(e).constructor):t.apply(e,r))}function yFe(e,t){if(t&&(S0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bFe(e)}function bFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mZ=function(){return!!e})()}function pS(e){return pS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pS(e)}function wFe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dT(e,t)}function dT(e,t){return dT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},dT(e,t)}function hZ(e,t,r){return t=pZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pZ(e){var t=jFe(e,"string");return S0(t)=="symbol"?t:t+""}function jFe(e,t){if(S0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(S0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var mj=function(e){function t(){return gFe(this,t),vFe(this,t,arguments)}return wFe(t,e),xFe(t,[{key:"render",value:function(){var n=this.props,s=n.offset,o=n.layout,i=n.width,l=n.dataKey,c=n.data,d=n.dataPointFormatter,u=n.xAxis,f=n.yAxis,h=hFe(n,lFe),m=Ra(h,!1);this.props.direction==="x"&&u.type!=="number"&&vp(!1);var x=c.map(function(g){var v=d(g,l),y=v.x,b=v.y,w=v.value,j=v.errorVal;if(!j)return null;var _=[],C,E;if(Array.isArray(j)){var S=cFe(j,2);C=S[0],E=S[1]}else C=E=j;if(o==="vertical"){var A=u.scale,M=b+s,O=M+i,I=M-i,T=A(w-C),k=A(w+E);_.push({x1:k,y1:O,x2:k,y2:I}),_.push({x1:T,y1:M,x2:k,y2:M}),_.push({x1:T,y1:O,x2:T,y2:I})}else if(o==="horizontal"){var q=f.scale,B=y+s,z=B-i,F=B+i,V=q(w-C),me=q(w+E);_.push({x1:z,y1:me,x2:F,y2:me}),_.push({x1:B,y1:V,x2:B,y2:me}),_.push({x1:z,y1:V,x2:F,y2:V})}return Ce.createElement(ks,hS({className:"recharts-errorBar",key:"bar-".concat(_.map(function(be){return"".concat(be.x1,"-").concat(be.x2,"-").concat(be.y1,"-").concat(be.y2)}))},m),_.map(function(be){return Ce.createElement("line",hS({},be,{key:"line-".concat(be.x1,"-").concat(be.x2,"-").concat(be.y1,"-").concat(be.y2)}))}))});return Ce.createElement(ks,{className:"recharts-errorBars"},x)}}])}(Ce.Component);hZ(mj,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});hZ(mj,"displayName","ErrorBar");function s1(e){"@babel/helpers - typeof";return s1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s1(e)}function Fq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Vp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fq(Object(r),!0).forEach(function(n){_Fe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _Fe(e,t,r){return t=NFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NFe(e){var t=SFe(e,"string");return s1(t)=="symbol"?t:t+""}function SFe(e,t){if(s1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(s1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gZ=function(t){var r=t.children,n=t.formattedGraphicalItems,s=t.legendWidth,o=t.legendContent,i=xd(r,Tg);if(!i)return null;var l=Tg.defaultProps,c=l!==void 0?Vp(Vp({},l),i.props):{},d;return i.props&&i.props.payload?d=i.props&&i.props.payload:o==="children"?d=(n||[]).reduce(function(u,f){var h=f.item,m=f.props,x=m.sectors||m.data||[];return u.concat(x.map(function(g){return{type:i.props.iconType||h.props.legendType,value:g.name,color:g.fill,payload:g}}))},[]):d=(n||[]).map(function(u){var f=u.item,h=f.type.defaultProps,m=h!==void 0?Vp(Vp({},h),f.props):{},x=m.dataKey,g=m.name,v=m.legendType,y=m.hide;return{inactive:y,dataKey:x,type:c.iconType||v||"square",color:YM(f),value:g||x,payload:m}}),Vp(Vp(Vp({},c),Tg.getWithHeight(i,s)),{},{payload:d,item:i})};function o1(e){"@babel/helpers - typeof";return o1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o1(e)}function Lq(e){return EFe(e)||PFe(e)||AFe(e)||CFe()}function CFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AFe(e,t){if(e){if(typeof e=="string")return uT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uT(e,t)}}function PFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function EFe(e){if(Array.isArray(e))return uT(e)}function uT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function fi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$q(Object(r),!0).forEach(function(n){Yv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$q(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yv(e,t,r){return t=kFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kFe(e){var t=IFe(e,"string");return o1(t)=="symbol"?t:t+""}function IFe(e,t){if(o1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(o1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ji(e,t,r){return ls(e)||ls(t)?r:Ki(t)?kd(e,t,r):Ja(t)?t(e):r}function Yb(e,t,r,n){var s=ERe(e,function(l){return ji(l,t)});if(r==="number"){var o=s.filter(function(l){return Mn(l)||parseFloat(l)});return o.length?[W5(o),Mh(o)]:[1/0,-1/0]}var i=n?s.filter(function(l){return!ls(l)}):s;return i.map(function(l){return Ki(l)||l instanceof Date?l:""})}var OFe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,i=-1,l=(r=n?.length)!==null&&r!==void 0?r:0;if(l<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var c=o.range,d=0;d<l;d++){var u=d>0?s[d-1].coordinate:s[l-1].coordinate,f=s[d].coordinate,h=d>=l-1?s[0].coordinate:s[d+1].coordinate,m=void 0;if(hc(f-u)!==hc(h-f)){var x=[];if(hc(h-f)===hc(c[1]-c[0])){m=h;var g=f+c[1]-c[0];x[0]=Math.min(g,(g+u)/2),x[1]=Math.max(g,(g+u)/2)}else{m=u;var v=h+c[1]-c[0];x[0]=Math.min(f,(v+f)/2),x[1]=Math.max(f,(v+f)/2)}var y=[Math.min(f,(m+f)/2),Math.max(f,(m+f)/2)];if(t>y[0]&&t<=y[1]||t>=x[0]&&t<=x[1]){i=s[d].index;break}}else{var b=Math.min(u,h),w=Math.max(u,h);if(t>(b+f)/2&&t<=(w+f)/2){i=s[d].index;break}}}else for(var j=0;j<l;j++)if(j===0&&t<=(n[j].coordinate+n[j+1].coordinate)/2||j>0&&j<l-1&&t>(n[j].coordinate+n[j-1].coordinate)/2&&t<=(n[j].coordinate+n[j+1].coordinate)/2||j===l-1&&t>(n[j].coordinate+n[j-1].coordinate)/2){i=n[j].index;break}return i},YM=function(t){var r,n=t,s=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?fi(fi({},t.type.defaultProps),t.props):t.props,i=o.stroke,l=o.fill,c;switch(s){case"Line":c=i;break;case"Area":case"Radar":c=i&&i!=="none"?i:l;break;default:c=l;break}return c},TFe=function(t){var r=t.barSize,n=t.totalSize,s=t.stackGroups,o=s===void 0?{}:s;if(!o)return{};for(var i={},l=Object.keys(o),c=0,d=l.length;c<d;c++)for(var u=o[l[c]].stackGroups,f=Object.keys(u),h=0,m=f.length;h<m;h++){var x=u[f[h]],g=x.items,v=x.cateAxisId,y=g.filter(function(E){return Im(E.type).indexOf("Bar")>=0});if(y&&y.length){var b=y[0].type.defaultProps,w=b!==void 0?fi(fi({},b),y[0].props):y[0].props,j=w.barSize,_=w[v];i[_]||(i[_]=[]);var C=ls(j)?r:j;i[_].push({item:y[0],stackList:y.slice(1),barSize:ls(C)?void 0:pc(C,n,0)})}}return i},DFe=function(t){var r=t.barGap,n=t.barCategoryGap,s=t.bandSize,o=t.sizeList,i=o===void 0?[]:o,l=t.maxBarSize,c=i.length;if(c<1)return null;var d=pc(r,s,0,!0),u,f=[];if(i[0].barSize===+i[0].barSize){var h=!1,m=s/c,x=i.reduce(function(j,_){return j+_.barSize||0},0);x+=(c-1)*d,x>=s&&(x-=(c-1)*d,d=0),x>=s&&m>0&&(h=!0,m*=.9,x=c*m);var g=(s-x)/2>>0,v={offset:g-d,size:0};u=i.reduce(function(j,_){var C={item:_.item,position:{offset:v.offset+v.size+d,size:h?m:_.barSize}},E=[].concat(Lq(j),[C]);return v=E[E.length-1].position,_.stackList&&_.stackList.length&&_.stackList.forEach(function(S){E.push({item:S,position:v})}),E},f)}else{var y=pc(n,s,0,!0);s-2*y-(c-1)*d<=0&&(d=0);var b=(s-2*y-(c-1)*d)/c;b>1&&(b>>=0);var w=l===+l?Math.min(b,l):b;u=i.reduce(function(j,_,C){var E=[].concat(Lq(j),[{item:_.item,position:{offset:y+(b+d)*C+(b-w)/2,size:w}}]);return _.stackList&&_.stackList.length&&_.stackList.forEach(function(S){E.push({item:S,position:E[E.length-1].position})}),E},f)}return u},MFe=function(t,r,n,s){var o=n.children,i=n.width,l=n.margin,c=i-(l.left||0)-(l.right||0),d=gZ({children:o,legendWidth:c});if(d){var u=s||{},f=u.width,h=u.height,m=d.align,x=d.verticalAlign,g=d.layout;if((g==="vertical"||g==="horizontal"&&x==="middle")&&m!=="center"&&Mn(t[m]))return fi(fi({},t),{},Yv({},m,t[m]+(f||0)));if((g==="horizontal"||g==="vertical"&&m==="center")&&x!=="middle"&&Mn(t[x]))return fi(fi({},t),{},Yv({},x,t[x]+(h||0)))}return t},RFe=function(t,r,n){return ls(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},xZ=function(t,r,n,s,o){var i=r.props.children,l=Id(i,mj).filter(function(d){return RFe(s,o,d.props.direction)});if(l&&l.length){var c=l.map(function(d){return d.props.dataKey});return t.reduce(function(d,u){var f=ji(u,n);if(ls(f))return d;var h=Array.isArray(f)?[W5(f),Mh(f)]:[f,f],m=c.reduce(function(x,g){var v=ji(u,g,0),y=h[0]-Math.abs(Array.isArray(v)?v[0]:v),b=h[1]+Math.abs(Array.isArray(v)?v[1]:v);return[Math.min(y,x[0]),Math.max(b,x[1])]},[1/0,-1/0]);return[Math.min(m[0],d[0]),Math.max(m[1],d[1])]},[1/0,-1/0])}return null},FFe=function(t,r,n,s,o){var i=r.map(function(l){return xZ(t,l,n,o,s)}).filter(function(l){return!ls(l)});return i&&i.length?i.reduce(function(l,c){return[Math.min(l[0],c[0]),Math.max(l[1],c[1])]},[1/0,-1/0]):null},vZ=function(t,r,n,s,o){var i=r.map(function(c){var d=c.props.dataKey;return n==="number"&&d&&xZ(t,c,d,s)||Yb(t,d,n,o)});if(n==="number")return i.reduce(function(c,d){return[Math.min(c[0],d[0]),Math.max(c[1],d[1])]},[1/0,-1/0]);var l={};return i.reduce(function(c,d){for(var u=0,f=d.length;u<f;u++)l[d[u]]||(l[d[u]]=!0,c.push(d[u]));return c},[])},yZ=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},bZ=function(t,r,n,s){if(s)return t.map(function(c){return c.coordinate});var o,i,l=t.map(function(c){return c.coordinate===r&&(o=!0),c.coordinate===n&&(i=!0),c.coordinate});return o||l.push(r),i||l.push(n),l},Cm=function(t,r,n){if(!t)return null;var s=t.scale,o=t.duplicateDomain,i=t.type,l=t.range,c=t.realScaleType==="scaleBand"?s.bandwidth()/2:2,d=(r||n)&&i==="category"&&s.bandwidth?s.bandwidth()/c:0;if(d=t.axisType==="angleAxis"&&l?.length>=2?hc(l[0]-l[1])*2*d:d,r&&(t.ticks||t.niceTicks)){var u=(t.ticks||t.niceTicks).map(function(f){var h=o?o.indexOf(f):f;return{coordinate:s(h)+d,value:f,offset:d}});return u.filter(function(f){return!hy(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:s(f)+d,value:f,index:h,offset:d}}):s.ticks&&!n?s.ticks(t.tickCount).map(function(f){return{coordinate:s(f)+d,value:f,offset:d}}):s.domain().map(function(f,h){return{coordinate:s(f)+d,value:o?o[f]:f,index:h,offset:d}})},OE=new WeakMap,L_=function(t,r){if(typeof r!="function")return t;OE.has(t)||OE.set(t,new WeakMap);var n=OE.get(t);if(n.has(r))return n.get(r);var s=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,s),s},wZ=function(t,r,n){var s=t.scale,o=t.type,i=t.layout,l=t.axisType;if(s==="auto")return i==="radial"&&l==="radiusAxis"?{scale:Qw(),realScaleType:"band"}:i==="radial"&&l==="angleAxis"?{scale:cS(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Xb(),realScaleType:"point"}:o==="category"?{scale:Qw(),realScaleType:"band"}:{scale:cS(),realScaleType:"linear"};if(Zg(s)){var c="scale".concat(I5(s));return{scale:(Iq[c]||Xb)(),realScaleType:Iq[c]?c:"point"}}return Ja(s)?{scale:s}:{scale:Xb(),realScaleType:"point"}},Bq=1e-4,jZ=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,s=t.range(),o=Math.min(s[0],s[1])-Bq,i=Math.max(s[0],s[1])+Bq,l=t(r[0]),c=t(r[n-1]);(l<o||l>i||c<o||c>i)&&t.domain([r[0],r[n-1]])}},LFe=function(t,r){if(!t)return null;for(var n=0,s=t.length;n<s;n++)if(t[n].item===r)return t[n].position;return null},$Fe=function(t,r){if(!r||r.length!==2||!Mn(r[0])||!Mn(r[1]))return t;var n=Math.min(r[0],r[1]),s=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!Mn(t[0])||t[0]<n)&&(o[0]=n),(!Mn(t[1])||t[1]>s)&&(o[1]=s),o[0]>s&&(o[0]=s),o[1]<n&&(o[1]=n),o},BFe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,i=0,l=0;l<r;++l){var c=hy(t[l][n][1])?t[l][n][0]:t[l][n][1];c>=0?(t[l][n][0]=o,t[l][n][1]=o+c,o=t[l][n][1]):(t[l][n][0]=i,t[l][n][1]=i+c,i=t[l][n][1])}},qFe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,i=0;i<r;++i){var l=hy(t[i][n][1])?t[i][n][0]:t[i][n][1];l>=0?(t[i][n][0]=o,t[i][n][1]=o+l,o=t[i][n][1]):(t[i][n][0]=0,t[i][n][1]=0)}},zFe={sign:BFe,expand:d5e,none:x0,silhouette:u5e,wiggle:f5e,positive:qFe},UFe=function(t,r,n){var s=r.map(function(l){return l.props.dataKey}),o=zFe[n],i=c5e().keys(s).value(function(l,c){return+ji(l,c,0)}).order(RO).offset(o);return i(t)},VFe=function(t,r,n,s,o,i){if(!t)return null;var l=i?r.reverse():r,c={},d=l.reduce(function(f,h){var m,x=(m=h.type)!==null&&m!==void 0&&m.defaultProps?fi(fi({},h.type.defaultProps),h.props):h.props,g=x.stackId,v=x.hide;if(v)return f;var y=x[n],b=f[y]||{hasStack:!1,stackGroups:{}};if(Ki(g)){var w=b.stackGroups[g]||{numericAxisId:n,cateAxisId:s,items:[]};w.items.push(h),b.hasStack=!0,b.stackGroups[g]=w}else b.stackGroups[yx("_stackId_")]={numericAxisId:n,cateAxisId:s,items:[h]};return fi(fi({},f),{},Yv({},y,b))},c),u={};return Object.keys(d).reduce(function(f,h){var m=d[h];if(m.hasStack){var x={};m.stackGroups=Object.keys(m.stackGroups).reduce(function(g,v){var y=m.stackGroups[v];return fi(fi({},g),{},Yv({},v,{numericAxisId:n,cateAxisId:s,items:y.items,stackedData:UFe(t,y.items,o)}))},x)}return fi(fi({},f),{},Yv({},h,m))},u)},_Z=function(t,r){var n=r.realScaleType,s=r.type,o=r.tickCount,i=r.originalDomain,l=r.allowDecimals,c=n||r.scale;if(c!=="auto"&&c!=="linear")return null;if(o&&s==="number"&&i&&(i[0]==="auto"||i[1]==="auto")){var d=t.domain();if(!d.length)return null;var u=sFe(d,o,l);return t.domain([W5(u),Mh(u)]),{niceTicks:u}}if(o&&s==="number"){var f=t.domain(),h=oFe(f,o,l);return{niceTicks:h}}return null};function gS(e){var t=e.axis,r=e.ticks,n=e.bandSize,s=e.entry,o=e.index,i=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!ls(s[t.dataKey])){var l=zN(r,"value",s[t.dataKey]);if(l)return l.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var c=ji(s,ls(i)?t.dataKey:i);return ls(c)?null:t.scale(c)}var qq=function(t){var r=t.axis,n=t.ticks,s=t.offset,o=t.bandSize,i=t.entry,l=t.index;if(r.type==="category")return n[l]?n[l].coordinate+s:null;var c=ji(i,r.dataKey,r.domain[l]);return ls(c)?null:r.scale(c)-o/2+s},WFe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var s=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return s<=0&&o>=0?0:o<0?o:s}return n[0]},HFe=function(t,r){var n,s=(n=t.type)!==null&&n!==void 0&&n.defaultProps?fi(fi({},t.type.defaultProps),t.props):t.props,o=s.stackId;if(Ki(o)){var i=r[o];if(i){var l=i.items.indexOf(t);return l>=0?i.stackedData[l]:null}}return null},GFe=function(t){return t.reduce(function(r,n){return[W5(n.concat([r[0]]).filter(Mn)),Mh(n.concat([r[1]]).filter(Mn))]},[1/0,-1/0])},NZ=function(t,r,n){return Object.keys(t).reduce(function(s,o){var i=t[o],l=i.stackedData,c=l.reduce(function(d,u){var f=GFe(u.slice(r,n+1));return[Math.min(d[0],f[0]),Math.max(d[1],f[1])]},[1/0,-1/0]);return[Math.min(c[0],s[0]),Math.max(c[1],s[1])]},[1/0,-1/0]).map(function(s){return s===1/0||s===-1/0?0:s})},zq=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Uq=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,fT=function(t,r,n){if(Ja(t))return t(r,n);if(!Array.isArray(t))return r;var s=[];if(Mn(t[0]))s[0]=n?t[0]:Math.min(t[0],r[0]);else if(zq.test(t[0])){var o=+zq.exec(t[0])[1];s[0]=r[0]-o}else Ja(t[0])?s[0]=t[0](r[0]):s[0]=r[0];if(Mn(t[1]))s[1]=n?t[1]:Math.max(t[1],r[1]);else if(Uq.test(t[1])){var i=+Uq.exec(t[1])[1];s[1]=r[1]+i}else Ja(t[1])?s[1]=t[1](r[1]):s[1]=r[1];return s},xS=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var s=t.scale.bandwidth();if(!n||s>0)return s}if(t&&r&&r.length>=2){for(var o=NM(r,function(f){return f.coordinate}),i=1/0,l=1,c=o.length;l<c;l++){var d=o[l],u=o[l-1];i=Math.min((d.coordinate||0)-(u.coordinate||0),i)}return i===1/0?0:i}return n?void 0:0},Vq=function(t,r,n){return!t||!t.length||rx(t,kd(n,"type.defaultProps.domain"))?r:t},SZ=function(t,r){var n=t.type.defaultProps?fi(fi({},t.type.defaultProps),t.props):t.props,s=n.dataKey,o=n.name,i=n.unit,l=n.formatter,c=n.tooltipType,d=n.chartType,u=n.hide;return fi(fi({},Ra(t,!1)),{},{dataKey:s,unit:i,formatter:l,name:o||s,color:YM(t),value:ji(r,s),type:c,payload:r,chartType:d,hide:u})};function i1(e){"@babel/helpers - typeof";return i1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i1(e)}function Wq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function gm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wq(Object(r),!0).forEach(function(n){CZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CZ(e,t,r){return t=KFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KFe(e){var t=XFe(e,"string");return i1(t)=="symbol"?t:t+""}function XFe(e,t){if(i1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(i1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function YFe(e,t){return eLe(e)||ZFe(e,t)||QFe(e,t)||JFe()}function JFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QFe(e,t){if(e){if(typeof e=="string")return Hq(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hq(e,t)}}function Hq(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ZFe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function eLe(e){if(Array.isArray(e))return e}var vS=Math.PI/180,tLe=function(t){return t*180/Math.PI},To=function(t,r,n,s){return{x:t+Math.cos(-vS*s)*n,y:r+Math.sin(-vS*s)*n}},AZ=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},rLe=function(t,r,n,s,o){var i=t.width,l=t.height,c=t.startAngle,d=t.endAngle,u=pc(t.cx,i,i/2),f=pc(t.cy,l,l/2),h=AZ(i,l,n),m=pc(t.innerRadius,h,0),x=pc(t.outerRadius,h,h*.8),g=Object.keys(r);return g.reduce(function(v,y){var b=r[y],w=b.domain,j=b.reversed,_;if(ls(b.range))s==="angleAxis"?_=[c,d]:s==="radiusAxis"&&(_=[m,x]),j&&(_=[_[1],_[0]]);else{_=b.range;var C=_,E=YFe(C,2);c=E[0],d=E[1]}var S=wZ(b,o),A=S.realScaleType,M=S.scale;M.domain(w).range(_),jZ(M);var O=_Z(M,gm(gm({},b),{},{realScaleType:A})),I=gm(gm(gm({},b),O),{},{range:_,radius:x,realScaleType:A,scale:M,cx:u,cy:f,innerRadius:m,outerRadius:x,startAngle:c,endAngle:d});return gm(gm({},v),{},CZ({},y,I))},{})},nLe=function(t,r){var n=t.x,s=t.y,o=r.x,i=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(s-i,2))},aLe=function(t,r){var n=t.x,s=t.y,o=r.cx,i=r.cy,l=nLe({x:n,y:s},{x:o,y:i});if(l<=0)return{radius:l};var c=(n-o)/l,d=Math.acos(c);return s>i&&(d=2*Math.PI-d),{radius:l,angle:tLe(d),angleInRadian:d}},sLe=function(t){var r=t.startAngle,n=t.endAngle,s=Math.floor(r/360),o=Math.floor(n/360),i=Math.min(s,o);return{startAngle:r-i*360,endAngle:n-i*360}},oLe=function(t,r){var n=r.startAngle,s=r.endAngle,o=Math.floor(n/360),i=Math.floor(s/360),l=Math.min(o,i);return t+l*360},Gq=function(t,r){var n=t.x,s=t.y,o=aLe({x:n,y:s},r),i=o.radius,l=o.angle,c=r.innerRadius,d=r.outerRadius;if(i<c||i>d)return!1;if(i===0)return!0;var u=sLe(r),f=u.startAngle,h=u.endAngle,m=l,x;if(f<=h){for(;m>h;)m-=360;for(;m<f;)m+=360;x=m>=f&&m<=h}else{for(;m>f;)m-=360;for(;m<h;)m+=360;x=m>=h&&m<=f}return x?gm(gm({},r),{},{radius:i,angle:oLe(m,r)}):null},PZ=function(t){return!p.isValidElement(t)&&!Ja(t)&&typeof t!="boolean"?t.className:""};function l1(e){"@babel/helpers - typeof";return l1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l1(e)}var iLe=["offset"];function lLe(e){return fLe(e)||uLe(e)||dLe(e)||cLe()}function cLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dLe(e,t){if(e){if(typeof e=="string")return mT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mT(e,t)}}function uLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function fLe(e){if(Array.isArray(e))return mT(e)}function mT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mLe(e,t){if(e==null)return{};var r=hLe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function hLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Kq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function qi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kq(Object(r),!0).forEach(function(n){pLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pLe(e,t,r){return t=gLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gLe(e){var t=xLe(e,"string");return l1(t)=="symbol"?t:t+""}function xLe(e,t){if(l1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(l1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function c1(){return c1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c1.apply(this,arguments)}var vLe=function(t){var r=t.value,n=t.formatter,s=ls(t.children)?r:t.children;return Ja(n)?n(s):s},yLe=function(t,r){var n=hc(r-t),s=Math.min(Math.abs(r-t),360);return n*s},bLe=function(t,r,n){var s=t.position,o=t.viewBox,i=t.offset,l=t.className,c=o,d=c.cx,u=c.cy,f=c.innerRadius,h=c.outerRadius,m=c.startAngle,x=c.endAngle,g=c.clockWise,v=(f+h)/2,y=yLe(m,x),b=y>=0?1:-1,w,j;s==="insideStart"?(w=m+b*i,j=g):s==="insideEnd"?(w=x-b*i,j=!g):s==="end"&&(w=x+b*i,j=g),j=y<=0?j:!j;var _=To(d,u,v,w),C=To(d,u,v,w+(j?1:-1)*359),E="M".concat(_.x,",").concat(_.y,`
    A`).concat(v,",").concat(v,",0,1,").concat(j?0:1,`,
    `).concat(C.x,",").concat(C.y),S=ls(t.id)?yx("recharts-radial-line-"):t.id;return Ce.createElement("text",c1({},n,{dominantBaseline:"central",className:us("recharts-radial-bar-label",l)}),Ce.createElement("defs",null,Ce.createElement("path",{id:S,d:E})),Ce.createElement("textPath",{xlinkHref:"#".concat(S)},r))},wLe=function(t){var r=t.viewBox,n=t.offset,s=t.position,o=r,i=o.cx,l=o.cy,c=o.innerRadius,d=o.outerRadius,u=o.startAngle,f=o.endAngle,h=(u+f)/2;if(s==="outside"){var m=To(i,l,d+n,h),x=m.x,g=m.y;return{x,y:g,textAnchor:x>=i?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:i,y:l,textAnchor:"middle",verticalAnchor:"end"};var v=(c+d)/2,y=To(i,l,v,h),b=y.x,w=y.y;return{x:b,y:w,textAnchor:"middle",verticalAnchor:"middle"}},jLe=function(t){var r=t.viewBox,n=t.parentViewBox,s=t.offset,o=t.position,i=r,l=i.x,c=i.y,d=i.width,u=i.height,f=u>=0?1:-1,h=f*s,m=f>0?"end":"start",x=f>0?"start":"end",g=d>=0?1:-1,v=g*s,y=g>0?"end":"start",b=g>0?"start":"end";if(o==="top"){var w={x:l+d/2,y:c-f*s,textAnchor:"middle",verticalAnchor:m};return qi(qi({},w),n?{height:Math.max(c-n.y,0),width:d}:{})}if(o==="bottom"){var j={x:l+d/2,y:c+u+h,textAnchor:"middle",verticalAnchor:x};return qi(qi({},j),n?{height:Math.max(n.y+n.height-(c+u),0),width:d}:{})}if(o==="left"){var _={x:l-v,y:c+u/2,textAnchor:y,verticalAnchor:"middle"};return qi(qi({},_),n?{width:Math.max(_.x-n.x,0),height:u}:{})}if(o==="right"){var C={x:l+d+v,y:c+u/2,textAnchor:b,verticalAnchor:"middle"};return qi(qi({},C),n?{width:Math.max(n.x+n.width-C.x,0),height:u}:{})}var E=n?{width:d,height:u}:{};return o==="insideLeft"?qi({x:l+v,y:c+u/2,textAnchor:b,verticalAnchor:"middle"},E):o==="insideRight"?qi({x:l+d-v,y:c+u/2,textAnchor:y,verticalAnchor:"middle"},E):o==="insideTop"?qi({x:l+d/2,y:c+h,textAnchor:"middle",verticalAnchor:x},E):o==="insideBottom"?qi({x:l+d/2,y:c+u-h,textAnchor:"middle",verticalAnchor:m},E):o==="insideTopLeft"?qi({x:l+v,y:c+h,textAnchor:b,verticalAnchor:x},E):o==="insideTopRight"?qi({x:l+d-v,y:c+h,textAnchor:y,verticalAnchor:x},E):o==="insideBottomLeft"?qi({x:l+v,y:c+u-h,textAnchor:b,verticalAnchor:m},E):o==="insideBottomRight"?qi({x:l+d-v,y:c+u-h,textAnchor:y,verticalAnchor:m},E):dy(o)&&(Mn(o.x)||vg(o.x))&&(Mn(o.y)||vg(o.y))?qi({x:l+pc(o.x,d),y:c+pc(o.y,u),textAnchor:"end",verticalAnchor:"end"},E):qi({x:l+d/2,y:c+u/2,textAnchor:"middle",verticalAnchor:"middle"},E)},_Le=function(t){return"cx"in t&&Mn(t.cx)};function ll(e){var t=e.offset,r=t===void 0?5:t,n=mLe(e,iLe),s=qi({offset:r},n),o=s.viewBox,i=s.position,l=s.value,c=s.children,d=s.content,u=s.className,f=u===void 0?"":u,h=s.textBreakAll;if(!o||ls(l)&&ls(c)&&!p.isValidElement(d)&&!Ja(d))return null;if(p.isValidElement(d))return p.cloneElement(d,s);var m;if(Ja(d)){if(m=p.createElement(d,s),p.isValidElement(m))return m}else m=vLe(s);var x=_Le(o),g=Ra(s,!0);if(x&&(i==="insideStart"||i==="insideEnd"||i==="end"))return bLe(s,m,g);var v=x?wLe(s):jLe(s);return Ce.createElement(tx,c1({className:us("recharts-label",f)},g,v,{breakAll:h}),m)}ll.displayName="Label";var EZ=function(t){var r=t.cx,n=t.cy,s=t.angle,o=t.startAngle,i=t.endAngle,l=t.r,c=t.radius,d=t.innerRadius,u=t.outerRadius,f=t.x,h=t.y,m=t.top,x=t.left,g=t.width,v=t.height,y=t.clockWise,b=t.labelViewBox;if(b)return b;if(Mn(g)&&Mn(v)){if(Mn(f)&&Mn(h))return{x:f,y:h,width:g,height:v};if(Mn(m)&&Mn(x))return{x:m,y:x,width:g,height:v}}return Mn(f)&&Mn(h)?{x:f,y:h,width:0,height:0}:Mn(r)&&Mn(n)?{cx:r,cy:n,startAngle:o||s||0,endAngle:i||s||0,innerRadius:d||0,outerRadius:u||c||l||0,clockWise:y}:t.viewBox?t.viewBox:{}},NLe=function(t,r){return t?t===!0?Ce.createElement(ll,{key:"label-implicit",viewBox:r}):Ki(t)?Ce.createElement(ll,{key:"label-implicit",viewBox:r,value:t}):p.isValidElement(t)?t.type===ll?p.cloneElement(t,{key:"label-implicit",viewBox:r}):Ce.createElement(ll,{key:"label-implicit",content:t,viewBox:r}):Ja(t)?Ce.createElement(ll,{key:"label-implicit",content:t,viewBox:r}):dy(t)?Ce.createElement(ll,c1({viewBox:r},t,{key:"label-implicit"})):null:null},SLe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var s=t.children,o=EZ(t),i=Id(s,ll).map(function(c,d){return p.cloneElement(c,{viewBox:r||o,key:"label-".concat(d)})});if(!n)return i;var l=NLe(t.label,r||o);return[l].concat(lLe(i))};ll.parseViewBox=EZ;ll.renderCallByParent=SLe;function CLe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var ALe=CLe;const PLe=Us(ALe);function d1(e){"@babel/helpers - typeof";return d1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d1(e)}var ELe=["valueAccessor"],kLe=["data","dataKey","clockWise","id","textBreakAll"];function ILe(e){return MLe(e)||DLe(e)||TLe(e)||OLe()}function OLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TLe(e,t){if(e){if(typeof e=="string")return hT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hT(e,t)}}function DLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function MLe(e){if(Array.isArray(e))return hT(e)}function hT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function yS(){return yS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yS.apply(this,arguments)}function Xq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Yq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xq(Object(r),!0).forEach(function(n){RLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RLe(e,t,r){return t=FLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FLe(e){var t=LLe(e,"string");return d1(t)=="symbol"?t:t+""}function LLe(e,t){if(d1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(d1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jq(e,t){if(e==null)return{};var r=$Le(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function $Le(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var BLe=function(t){return Array.isArray(t.value)?PLe(t.value):t.value};function Vf(e){var t=e.valueAccessor,r=t===void 0?BLe:t,n=Jq(e,ELe),s=n.data,o=n.dataKey,i=n.clockWise,l=n.id,c=n.textBreakAll,d=Jq(n,kLe);return!s||!s.length?null:Ce.createElement(ks,{className:"recharts-label-list"},s.map(function(u,f){var h=ls(o)?r(u,f):ji(u&&u.payload,o),m=ls(l)?{}:{id:"".concat(l,"-").concat(f)};return Ce.createElement(ll,yS({},Ra(u,!0),d,m,{parentViewBox:u.parentViewBox,value:h,textBreakAll:c,viewBox:ll.parseViewBox(ls(i)?u:Yq(Yq({},u),{},{clockWise:i})),key:"label-".concat(f),index:f}))}))}Vf.displayName="LabelList";function qLe(e,t){return e?e===!0?Ce.createElement(Vf,{key:"labelList-implicit",data:t}):Ce.isValidElement(e)||Ja(e)?Ce.createElement(Vf,{key:"labelList-implicit",data:t,content:e}):dy(e)?Ce.createElement(Vf,yS({data:t},e,{key:"labelList-implicit"})):null:null}function zLe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,s=Id(n,Vf).map(function(i,l){return p.cloneElement(i,{data:t,key:"labelList-".concat(l)})});if(!r)return s;var o=qLe(e.label,t);return[o].concat(ILe(s))}Vf.renderCallByParent=zLe;function u1(e){"@babel/helpers - typeof";return u1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u1(e)}function pT(){return pT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pT.apply(this,arguments)}function Qq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Zq(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qq(Object(r),!0).forEach(function(n){ULe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ULe(e,t,r){return t=VLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VLe(e){var t=WLe(e,"string");return u1(t)=="symbol"?t:t+""}function WLe(e,t){if(u1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(u1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var HLe=function(t,r){var n=hc(r-t),s=Math.min(Math.abs(r-t),359.999);return n*s},$_=function(t){var r=t.cx,n=t.cy,s=t.radius,o=t.angle,i=t.sign,l=t.isExternal,c=t.cornerRadius,d=t.cornerIsExternal,u=c*(l?1:-1)+s,f=Math.asin(c/u)/vS,h=d?o:o+i*f,m=To(r,n,u,h),x=To(r,n,s,h),g=d?o-i*f:o,v=To(r,n,u*Math.cos(f*vS),g);return{center:m,circleTangency:x,lineTangency:v,theta:f}},kZ=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,i=t.startAngle,l=t.endAngle,c=HLe(i,l),d=i+c,u=To(r,n,o,i),f=To(r,n,o,d),h="M ".concat(u.x,",").concat(u.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(c)>180),",").concat(+(i>d),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(s>0){var m=To(r,n,s,i),x=To(r,n,s,d);h+="L ".concat(x.x,",").concat(x.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(c)>180),",").concat(+(i<=d),`,
            `).concat(m.x,",").concat(m.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},GLe=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,i=t.cornerRadius,l=t.forceCornerRadius,c=t.cornerIsExternal,d=t.startAngle,u=t.endAngle,f=hc(u-d),h=$_({cx:r,cy:n,radius:o,angle:d,sign:f,cornerRadius:i,cornerIsExternal:c}),m=h.circleTangency,x=h.lineTangency,g=h.theta,v=$_({cx:r,cy:n,radius:o,angle:u,sign:-f,cornerRadius:i,cornerIsExternal:c}),y=v.circleTangency,b=v.lineTangency,w=v.theta,j=c?Math.abs(d-u):Math.abs(d-u)-g-w;if(j<0)return l?"M ".concat(x.x,",").concat(x.y,`
        a`).concat(i,",").concat(i,",0,0,1,").concat(i*2,`,0
        a`).concat(i,",").concat(i,",0,0,1,").concat(-i*2,`,0
      `):kZ({cx:r,cy:n,innerRadius:s,outerRadius:o,startAngle:d,endAngle:u});var _="M ".concat(x.x,",").concat(x.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(m.x,",").concat(m.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(j>180),",").concat(+(f<0),",").concat(y.x,",").concat(y.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(b.x,",").concat(b.y,`
  `);if(s>0){var C=$_({cx:r,cy:n,radius:s,angle:d,sign:f,isExternal:!0,cornerRadius:i,cornerIsExternal:c}),E=C.circleTangency,S=C.lineTangency,A=C.theta,M=$_({cx:r,cy:n,radius:s,angle:u,sign:-f,isExternal:!0,cornerRadius:i,cornerIsExternal:c}),O=M.circleTangency,I=M.lineTangency,T=M.theta,k=c?Math.abs(d-u):Math.abs(d-u)-A-T;if(k<0&&i===0)return"".concat(_,"L").concat(r,",").concat(n,"Z");_+="L".concat(I.x,",").concat(I.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(O.x,",").concat(O.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(k>180),",").concat(+(f>0),",").concat(E.x,",").concat(E.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(f<0),",").concat(S.x,",").concat(S.y,"Z")}else _+="L".concat(r,",").concat(n,"Z");return _},KLe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},JM=function(t){var r=Zq(Zq({},KLe),t),n=r.cx,s=r.cy,o=r.innerRadius,i=r.outerRadius,l=r.cornerRadius,c=r.forceCornerRadius,d=r.cornerIsExternal,u=r.startAngle,f=r.endAngle,h=r.className;if(i<o||u===f)return null;var m=us("recharts-sector",h),x=i-o,g=pc(l,x,0,!0),v;return g>0&&Math.abs(u-f)<360?v=GLe({cx:n,cy:s,innerRadius:o,outerRadius:i,cornerRadius:Math.min(g,x/2),forceCornerRadius:c,cornerIsExternal:d,startAngle:u,endAngle:f}):v=kZ({cx:n,cy:s,innerRadius:o,outerRadius:i,startAngle:u,endAngle:f}),Ce.createElement("path",pT({},Ra(r,!0),{className:m,d:v,role:"img"}))};function f1(e){"@babel/helpers - typeof";return f1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f1(e)}function gT(){return gT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gT.apply(this,arguments)}function e7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function t7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e7(Object(r),!0).forEach(function(n){XLe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XLe(e,t,r){return t=YLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YLe(e){var t=JLe(e,"string");return f1(t)=="symbol"?t:t+""}function JLe(e,t){if(f1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(f1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var r7={curveBasisClosed:QCe,curveBasisOpen:ZCe,curveBasis:JCe,curveBumpX:FCe,curveBumpY:LCe,curveLinearClosed:e5e,curveLinear:T5,curveMonotoneX:t5e,curveMonotoneY:r5e,curveNatural:n5e,curveStep:a5e,curveStepAfter:o5e,curveStepBefore:s5e},B_=function(t){return t.x===+t.x&&t.y===+t.y},rb=function(t){return t.x},nb=function(t){return t.y},QLe=function(t,r){if(Ja(t))return t;var n="curve".concat(I5(t));return(n==="curveMonotone"||n==="curveBump")&&r?r7["".concat(n).concat(r==="vertical"?"Y":"X")]:r7[n]||T5},ZLe=function(t){var r=t.type,n=r===void 0?"linear":r,s=t.points,o=s===void 0?[]:s,i=t.baseLine,l=t.layout,c=t.connectNulls,d=c===void 0?!1:c,u=QLe(n,l),f=d?o.filter(function(g){return B_(g)}):o,h;if(Array.isArray(i)){var m=d?i.filter(function(g){return B_(g)}):i,x=f.map(function(g,v){return t7(t7({},g),{},{base:m[v]})});return l==="vertical"?h=k_().y(nb).x1(rb).x0(function(g){return g.base.x}):h=k_().x(rb).y1(nb).y0(function(g){return g.base.y}),h.defined(B_).curve(u),h(x)}return l==="vertical"&&Mn(i)?h=k_().y(nb).x1(rb).x0(i):Mn(i)?h=k_().x(rb).y1(nb).y0(i):h=SJ().x(rb).y(nb),h.defined(B_).curve(u),h(f)},Rg=function(t){var r=t.className,n=t.points,s=t.path,o=t.pathRef;if((!n||!n.length)&&!s)return null;var i=n&&n.length?ZLe(t):s;return p.createElement("path",gT({},Ra(t,!1),UN(t),{className:us("recharts-curve",r),d:i,ref:o}))},IZ={exports:{}},e$e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",t$e=e$e,r$e=t$e;function OZ(){}function TZ(){}TZ.resetWarningCache=OZ;var n$e=function(){function e(n,s,o,i,l,c){if(c!==r$e){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:TZ,resetWarningCache:OZ};return r.PropTypes=r,r};IZ.exports=n$e();var a$e=IZ.exports;const za=Us(a$e);var s$e=Object.getOwnPropertyNames,o$e=Object.getOwnPropertySymbols,i$e=Object.prototype.hasOwnProperty;function n7(e,t){return function(n,s,o){return e(n,s,o)&&t(n,s,o)}}function q_(e){return function(r,n,s){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,s);var o=s.cache,i=o.get(r),l=o.get(n);if(i&&l)return i===n&&l===r;o.set(r,n),o.set(n,r);var c=e(r,n,s);return o.delete(r),o.delete(n),c}}function a7(e){return s$e(e).concat(o$e(e))}var l$e=Object.hasOwn||function(e,t){return i$e.call(e,t)};function jx(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var c$e="__v",d$e="__o",u$e="_owner",s7=Object.getOwnPropertyDescriptor,o7=Object.keys;function f$e(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function m$e(e,t){return jx(e.getTime(),t.getTime())}function h$e(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function p$e(e,t){return e===t}function i7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.entries(),i,l,c=0;(i=o.next())&&!i.done;){for(var d=t.entries(),u=!1,f=0;(l=d.next())&&!l.done;){if(s[f]){f++;continue}var h=i.value,m=l.value;if(r.equals(h[0],m[0],c,f,e,t,r)&&r.equals(h[1],m[1],h[0],m[0],e,t,r)){u=s[f]=!0;break}f++}if(!u)return!1;c++}return!0}var g$e=jx;function x$e(e,t,r){var n=o7(e),s=n.length;if(o7(t).length!==s)return!1;for(;s-- >0;)if(!DZ(e,t,r,n[s]))return!1;return!0}function ab(e,t,r){var n=a7(e),s=n.length;if(a7(t).length!==s)return!1;for(var o,i,l;s-- >0;)if(o=n[s],!DZ(e,t,r,o)||(i=s7(e,o),l=s7(t,o),(i||l)&&(!i||!l||i.configurable!==l.configurable||i.enumerable!==l.enumerable||i.writable!==l.writable)))return!1;return!0}function v$e(e,t){return jx(e.valueOf(),t.valueOf())}function y$e(e,t){return e.source===t.source&&e.flags===t.flags}function l7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.values(),i,l;(i=o.next())&&!i.done;){for(var c=t.values(),d=!1,u=0;(l=c.next())&&!l.done;){if(!s[u]&&r.equals(i.value,l.value,i.value,l.value,e,t,r)){d=s[u]=!0;break}u++}if(!d)return!1}return!0}function b$e(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function w$e(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function DZ(e,t,r,n){return(n===u$e||n===d$e||n===c$e)&&(e.$$typeof||t.$$typeof)?!0:l$e(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var j$e="[object Arguments]",_$e="[object Boolean]",N$e="[object Date]",S$e="[object Error]",C$e="[object Map]",A$e="[object Number]",P$e="[object Object]",E$e="[object RegExp]",k$e="[object Set]",I$e="[object String]",O$e="[object URL]",T$e=Array.isArray,c7=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,d7=Object.assign,D$e=Object.prototype.toString.call.bind(Object.prototype.toString);function M$e(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,s=e.areFunctionsEqual,o=e.areMapsEqual,i=e.areNumbersEqual,l=e.areObjectsEqual,c=e.arePrimitiveWrappersEqual,d=e.areRegExpsEqual,u=e.areSetsEqual,f=e.areTypedArraysEqual,h=e.areUrlsEqual;return function(x,g,v){if(x===g)return!0;if(x==null||g==null)return!1;var y=typeof x;if(y!==typeof g)return!1;if(y!=="object")return y==="number"?i(x,g,v):y==="function"?s(x,g,v):!1;var b=x.constructor;if(b!==g.constructor)return!1;if(b===Object)return l(x,g,v);if(T$e(x))return t(x,g,v);if(c7!=null&&c7(x))return f(x,g,v);if(b===Date)return r(x,g,v);if(b===RegExp)return d(x,g,v);if(b===Map)return o(x,g,v);if(b===Set)return u(x,g,v);var w=D$e(x);return w===N$e?r(x,g,v):w===E$e?d(x,g,v):w===C$e?o(x,g,v):w===k$e?u(x,g,v):w===P$e?typeof x.then!="function"&&typeof g.then!="function"&&l(x,g,v):w===O$e?h(x,g,v):w===S$e?n(x,g,v):w===j$e?l(x,g,v):w===_$e||w===A$e||w===I$e?c(x,g,v):!1}}function R$e(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,s={areArraysEqual:n?ab:f$e,areDatesEqual:m$e,areErrorsEqual:h$e,areFunctionsEqual:p$e,areMapsEqual:n?n7(i7,ab):i7,areNumbersEqual:g$e,areObjectsEqual:n?ab:x$e,arePrimitiveWrappersEqual:v$e,areRegExpsEqual:y$e,areSetsEqual:n?n7(l7,ab):l7,areTypedArraysEqual:n?ab:b$e,areUrlsEqual:w$e};if(r&&(s=d7({},s,r(s))),t){var o=q_(s.areArraysEqual),i=q_(s.areMapsEqual),l=q_(s.areObjectsEqual),c=q_(s.areSetsEqual);s=d7({},s,{areArraysEqual:o,areMapsEqual:i,areObjectsEqual:l,areSetsEqual:c})}return s}function F$e(e){return function(t,r,n,s,o,i,l){return e(t,r,l)}}function L$e(e){var t=e.circular,r=e.comparator,n=e.createState,s=e.equals,o=e.strict;if(n)return function(c,d){var u=n(),f=u.cache,h=f===void 0?t?new WeakMap:void 0:f,m=u.meta;return r(c,d,{cache:h,equals:s,meta:m,strict:o})};if(t)return function(c,d){return r(c,d,{cache:new WeakMap,equals:s,meta:void 0,strict:o})};var i={cache:void 0,equals:s,meta:void 0,strict:o};return function(c,d){return r(c,d,i)}}var $$e=Dp();Dp({strict:!0});Dp({circular:!0});Dp({circular:!0,strict:!0});Dp({createInternalComparator:function(){return jx}});Dp({strict:!0,createInternalComparator:function(){return jx}});Dp({circular:!0,createInternalComparator:function(){return jx}});Dp({circular:!0,createInternalComparator:function(){return jx},strict:!0});function Dp(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,s=e.createState,o=e.strict,i=o===void 0?!1:o,l=R$e(e),c=M$e(l),d=n?n(c):F$e(c);return L$e({circular:r,comparator:c,createState:s,equals:d,strict:i})}function B$e(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function u7(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function s(o){r<0&&(r=o),o-r>t?(e(o),r=-1):B$e(s)};requestAnimationFrame(n)}function xT(e){"@babel/helpers - typeof";return xT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xT(e)}function q$e(e){return W$e(e)||V$e(e)||U$e(e)||z$e()}function z$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U$e(e,t){if(e){if(typeof e=="string")return f7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f7(e,t)}}function f7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V$e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function W$e(e){if(Array.isArray(e))return e}function H$e(){var e={},t=function(){return null},r=!1,n=function s(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var i=o,l=q$e(i),c=l[0],d=l.slice(1);if(typeof c=="number"){u7(s.bind(null,d),c);return}s(c),u7(s.bind(null,d));return}xT(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function m1(e){"@babel/helpers - typeof";return m1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m1(e)}function m7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function h7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m7(Object(r),!0).forEach(function(n){MZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MZ(e,t,r){return t=G$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G$e(e){var t=K$e(e,"string");return m1(t)==="symbol"?t:String(t)}function K$e(e,t){if(m1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(m1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var X$e=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,s){return n.filter(function(o){return s.includes(o)})})},Y$e=function(t){return t},J$e=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Jb=function(t,r){return Object.keys(r).reduce(function(n,s){return h7(h7({},n),{},MZ({},s,t(s,r[s])))},{})},p7=function(t,r,n){return t.map(function(s){return"".concat(J$e(s)," ").concat(r,"ms ").concat(n)}).join(",")};function Q$e(e,t){return t6e(e)||e6e(e,t)||RZ(e,t)||Z$e()}function Z$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function t6e(e){if(Array.isArray(e))return e}function r6e(e){return s6e(e)||a6e(e)||RZ(e)||n6e()}function n6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RZ(e,t){if(e){if(typeof e=="string")return vT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vT(e,t)}}function a6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function s6e(e){if(Array.isArray(e))return vT(e)}function vT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var bS=1e-4,FZ=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},LZ=function(t,r){return t.map(function(n,s){return n*Math.pow(r,s)}).reduce(function(n,s){return n+s})},g7=function(t,r){return function(n){var s=FZ(t,r);return LZ(s,n)}},o6e=function(t,r){return function(n){var s=FZ(t,r),o=[].concat(r6e(s.map(function(i,l){return i*l}).slice(1)),[0]);return LZ(o,n)}},x7=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0],o=r[1],i=r[2],l=r[3];if(r.length===1)switch(r[0]){case"linear":s=0,o=0,i=1,l=1;break;case"ease":s=.25,o=.1,i=.25,l=1;break;case"ease-in":s=.42,o=0,i=1,l=1;break;case"ease-out":s=.42,o=0,i=.58,l=1;break;case"ease-in-out":s=0,o=0,i=.58,l=1;break;default:{var c=r[0].split("(");if(c[0]==="cubic-bezier"&&c[1].split(")")[0].split(",").length===4){var d=c[1].split(")")[0].split(",").map(function(v){return parseFloat(v)}),u=Q$e(d,4);s=u[0],o=u[1],i=u[2],l=u[3]}}}var f=g7(s,i),h=g7(o,l),m=o6e(s,i),x=function(y){return y>1?1:y<0?0:y},g=function(y){for(var b=y>1?1:y,w=b,j=0;j<8;++j){var _=f(w)-b,C=m(w);if(Math.abs(_-b)<bS||C<bS)return h(w);w=x(w-_/C)}return h(w)};return g.isStepper=!1,g},i6e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,s=t.damping,o=s===void 0?8:s,i=t.dt,l=i===void 0?17:i,c=function(u,f,h){var m=-(u-f)*n,x=h*o,g=h+(m-x)*l/1e3,v=h*l/1e3+u;return Math.abs(v-f)<bS&&Math.abs(g)<bS?[f,0]:[v,g]};return c.isStepper=!0,c.dt=l,c},l6e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0];if(typeof s=="string")switch(s){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return x7(s);case"spring":return i6e();default:if(s.split("(")[0]==="cubic-bezier")return x7(s)}return typeof s=="function"?s:null};function h1(e){"@babel/helpers - typeof";return h1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h1(e)}function v7(e){return u6e(e)||d6e(e)||$Z(e)||c6e()}function c6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function u6e(e){if(Array.isArray(e))return bT(e)}function y7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Nl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y7(Object(r),!0).forEach(function(n){yT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yT(e,t,r){return t=f6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f6e(e){var t=m6e(e,"string");return h1(t)==="symbol"?t:String(t)}function m6e(e,t){if(h1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(h1(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h6e(e,t){return x6e(e)||g6e(e,t)||$Z(e,t)||p6e()}function p6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $Z(e,t){if(e){if(typeof e=="string")return bT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bT(e,t)}}function bT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function x6e(e){if(Array.isArray(e))return e}var wS=function(t,r,n){return t+(r-t)*n},wT=function(t){var r=t.from,n=t.to;return r!==n},v6e=function e(t,r,n){var s=Jb(function(o,i){if(wT(i)){var l=t(i.from,i.to,i.velocity),c=h6e(l,2),d=c[0],u=c[1];return Nl(Nl({},i),{},{from:d,velocity:u})}return i},r);return n<1?Jb(function(o,i){return wT(i)?Nl(Nl({},i),{},{velocity:wS(i.velocity,s[o].velocity,n),from:wS(i.from,s[o].from,n)}):i},r):e(t,s,n-1)};const y6e=function(e,t,r,n,s){var o=X$e(e,t),i=o.reduce(function(v,y){return Nl(Nl({},v),{},yT({},y,[e[y],t[y]]))},{}),l=o.reduce(function(v,y){return Nl(Nl({},v),{},yT({},y,{from:e[y],velocity:0,to:t[y]}))},{}),c=-1,d,u,f=function(){return null},h=function(){return Jb(function(y,b){return b.from},l)},m=function(){return!Object.values(l).filter(wT).length},x=function(y){d||(d=y);var b=y-d,w=b/r.dt;l=v6e(r,l,w),s(Nl(Nl(Nl({},e),t),h())),d=y,m()||(c=requestAnimationFrame(f))},g=function(y){u||(u=y);var b=(y-u)/n,w=Jb(function(_,C){return wS.apply(void 0,v7(C).concat([r(b)]))},i);if(s(Nl(Nl(Nl({},e),t),w)),b<1)c=requestAnimationFrame(f);else{var j=Jb(function(_,C){return wS.apply(void 0,v7(C).concat([r(1)]))},i);s(Nl(Nl(Nl({},e),t),j))}};return f=r.isStepper?x:g,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(c)}}};function C0(e){"@babel/helpers - typeof";return C0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C0(e)}var b6e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function w6e(e,t){if(e==null)return{};var r=j6e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function j6e(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function TE(e){return C6e(e)||S6e(e)||N6e(e)||_6e()}function _6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N6e(e,t){if(e){if(typeof e=="string")return jT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jT(e,t)}}function S6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function C6e(e){if(Array.isArray(e))return jT(e)}function jT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ru(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b7(Object(r),!0).forEach(function(n){_b(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _b(e,t,r){return t=BZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,BZ(n.key),n)}}function P6e(e,t,r){return t&&w7(e.prototype,t),r&&w7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function BZ(e){var t=E6e(e,"string");return C0(t)==="symbol"?t:String(t)}function E6e(e,t){if(C0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(C0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function k6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_T(e,t)}function _T(e,t){return _T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},_T(e,t)}function I6e(e){var t=O6e();return function(){var n=jS(e),s;if(t){var o=jS(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return NT(this,s)}}function NT(e,t){if(t&&(C0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ST(e)}function ST(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O6e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function jS(e){return jS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jS(e)}var K5=function(e){k6e(r,e);var t=I6e(r);function r(n,s){var o;A6e(this,r),o=t.call(this,n,s);var i=o.props,l=i.isActive,c=i.attributeName,d=i.from,u=i.to,f=i.steps,h=i.children,m=i.duration;if(o.handleStyleChange=o.handleStyleChange.bind(ST(o)),o.changeStyle=o.changeStyle.bind(ST(o)),!l||m<=0)return o.state={style:{}},typeof h=="function"&&(o.state={style:u}),NT(o);if(f&&f.length)o.state={style:f[0].style};else if(d){if(typeof h=="function")return o.state={style:d},NT(o);o.state={style:c?_b({},c,d):d}}else o.state={style:{}};return o}return P6e(r,[{key:"componentDidMount",value:function(){var s=this.props,o=s.isActive,i=s.canBegin;this.mounted=!0,!(!o||!i)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(s){var o=this.props,i=o.isActive,l=o.canBegin,c=o.attributeName,d=o.shouldReAnimate,u=o.to,f=o.from,h=this.state.style;if(l){if(!i){var m={style:c?_b({},c,u):u};this.state&&h&&(c&&h[c]!==u||!c&&h!==u)&&this.setState(m);return}if(!($$e(s.to,u)&&s.canBegin&&s.isActive)){var x=!s.canBegin||!s.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var g=x||d?f:s.to;if(this.state&&h){var v={style:c?_b({},c,g):g};(c&&h[c]!==g||!c&&h!==g)&&this.setState(v)}this.runAnimation(Ru(Ru({},this.props),{},{from:g,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var s=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),s&&s()}},{key:"handleStyleChange",value:function(s){this.changeStyle(s)}},{key:"changeStyle",value:function(s){this.mounted&&this.setState({style:s})}},{key:"runJSAnimation",value:function(s){var o=this,i=s.from,l=s.to,c=s.duration,d=s.easing,u=s.begin,f=s.onAnimationEnd,h=s.onAnimationStart,m=y6e(i,l,l6e(d),c,this.changeStyle),x=function(){o.stopJSAnimation=m()};this.manager.start([h,u,x,c,f])}},{key:"runStepAnimation",value:function(s){var o=this,i=s.steps,l=s.begin,c=s.onAnimationStart,d=i[0],u=d.style,f=d.duration,h=f===void 0?0:f,m=function(g,v,y){if(y===0)return g;var b=v.duration,w=v.easing,j=w===void 0?"ease":w,_=v.style,C=v.properties,E=v.onAnimationEnd,S=y>0?i[y-1]:v,A=C||Object.keys(_);if(typeof j=="function"||j==="spring")return[].concat(TE(g),[o.runJSAnimation.bind(o,{from:S.style,to:_,duration:b,easing:j}),b]);var M=p7(A,b,j),O=Ru(Ru(Ru({},S.style),_),{},{transition:M});return[].concat(TE(g),[O,b,E]).filter(Y$e)};return this.manager.start([c].concat(TE(i.reduce(m,[u,Math.max(h,l)])),[s.onAnimationEnd]))}},{key:"runAnimation",value:function(s){this.manager||(this.manager=H$e());var o=s.begin,i=s.duration,l=s.attributeName,c=s.to,d=s.easing,u=s.onAnimationStart,f=s.onAnimationEnd,h=s.steps,m=s.children,x=this.manager;if(this.unSubscribe=x.subscribe(this.handleStyleChange),typeof d=="function"||typeof m=="function"||d==="spring"){this.runJSAnimation(s);return}if(h.length>1){this.runStepAnimation(s);return}var g=l?_b({},l,c):c,v=p7(Object.keys(g),i,d);x.start([u,o,Ru(Ru({},g),{},{transition:v}),i,f])}},{key:"render",value:function(){var s=this.props,o=s.children;s.begin;var i=s.duration;s.attributeName,s.easing;var l=s.isActive;s.steps,s.from,s.to,s.canBegin,s.onAnimationEnd,s.shouldReAnimate,s.onAnimationReStart;var c=w6e(s,b6e),d=p.Children.count(o),u=this.state.style;if(typeof o=="function")return o(u);if(!l||d===0||i<=0)return o;var f=function(m){var x=m.props,g=x.style,v=g===void 0?{}:g,y=x.className,b=p.cloneElement(m,Ru(Ru({},c),{},{style:Ru(Ru({},v),u),className:y}));return b};return d===1?f(p.Children.only(o)):Ce.createElement("div",null,p.Children.map(o,function(h){return f(h)}))}}]),r}(p.PureComponent);K5.displayName="Animate";K5.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};K5.propTypes={from:za.oneOfType([za.object,za.string]),to:za.oneOfType([za.object,za.string]),attributeName:za.string,duration:za.number,begin:za.number,easing:za.oneOfType([za.string,za.func]),steps:za.arrayOf(za.shape({duration:za.number.isRequired,style:za.object.isRequired,easing:za.oneOfType([za.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),za.func]),properties:za.arrayOf("string"),onAnimationEnd:za.func})),children:za.oneOfType([za.node,za.func]),isActive:za.bool,canBegin:za.bool,onAnimationEnd:za.func,shouldReAnimate:za.bool,onAnimationStart:za.func,onAnimationReStart:za.func};const yp=K5;function Ka(){return Ka=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ka.apply(null,arguments)}function _S(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function qZ(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_O(e,t)}function p1(e){"@babel/helpers - typeof";return p1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p1(e)}function NS(){return NS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},NS.apply(this,arguments)}function T6e(e,t){return F6e(e)||R6e(e,t)||M6e(e,t)||D6e()}function D6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M6e(e,t){if(e){if(typeof e=="string")return j7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j7(e,t)}}function j7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function R6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function F6e(e){if(Array.isArray(e))return e}function _7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function N7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_7(Object(r),!0).forEach(function(n){L6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function L6e(e,t,r){return t=$6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $6e(e){var t=B6e(e,"string");return p1(t)=="symbol"?t:t+""}function B6e(e,t){if(p1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(p1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var S7=function(t,r,n,s,o){var i=Math.min(Math.abs(n)/2,Math.abs(s)/2),l=s>=0?1:-1,c=n>=0?1:-1,d=s>=0&&n>=0||s<0&&n<0?1:0,u;if(i>0&&o instanceof Array){for(var f=[0,0,0,0],h=0,m=4;h<m;h++)f[h]=o[h]>i?i:o[h];u="M".concat(t,",").concat(r+l*f[0]),f[0]>0&&(u+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(d,",").concat(t+c*f[0],",").concat(r)),u+="L ".concat(t+n-c*f[1],",").concat(r),f[1]>0&&(u+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(d,`,
        `).concat(t+n,",").concat(r+l*f[1])),u+="L ".concat(t+n,",").concat(r+s-l*f[2]),f[2]>0&&(u+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(d,`,
        `).concat(t+n-c*f[2],",").concat(r+s)),u+="L ".concat(t+c*f[3],",").concat(r+s),f[3]>0&&(u+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(d,`,
        `).concat(t,",").concat(r+s-l*f[3])),u+="Z"}else if(i>0&&o===+o&&o>0){var x=Math.min(i,o);u="M ".concat(t,",").concat(r+l*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+c*x,",").concat(r,`
            L `).concat(t+n-c*x,",").concat(r,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+n,",").concat(r+l*x,`
            L `).concat(t+n,",").concat(r+s-l*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t+n-c*x,",").concat(r+s,`
            L `).concat(t+c*x,",").concat(r+s,`
            A `).concat(x,",").concat(x,",0,0,").concat(d,",").concat(t,",").concat(r+s-l*x," Z")}else u="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(s," h ").concat(-n," Z");return u},q6e=function(t,r){if(!t||!r)return!1;var n=t.x,s=t.y,o=r.x,i=r.y,l=r.width,c=r.height;if(Math.abs(l)>0&&Math.abs(c)>0){var d=Math.min(o,o+l),u=Math.max(o,o+l),f=Math.min(i,i+c),h=Math.max(i,i+c);return n>=d&&n<=u&&s>=f&&s<=h}return!1},z6e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},QM=function(t){var r=N7(N7({},z6e),t),n=p.useRef(),s=p.useState(-1),o=T6e(s,2),i=o[0],l=o[1];p.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var j=n.current.getTotalLength();j&&l(j)}catch{}},[]);var c=r.x,d=r.y,u=r.width,f=r.height,h=r.radius,m=r.className,x=r.animationEasing,g=r.animationDuration,v=r.animationBegin,y=r.isAnimationActive,b=r.isUpdateAnimationActive;if(c!==+c||d!==+d||u!==+u||f!==+f||u===0||f===0)return null;var w=us("recharts-rectangle",m);return b?Ce.createElement(yp,{canBegin:i>0,from:{width:u,height:f,x:c,y:d},to:{width:u,height:f,x:c,y:d},duration:g,animationEasing:x,isActive:b},function(j){var _=j.width,C=j.height,E=j.x,S=j.y;return Ce.createElement(yp,{canBegin:i>0,from:"0px ".concat(i===-1?1:i,"px"),to:"".concat(i,"px 0px"),attributeName:"strokeDasharray",begin:v,duration:g,isActive:y,easing:x},Ce.createElement("path",NS({},Ra(r,!0),{className:w,d:S7(E,S,_,C,h),ref:n})))}):Ce.createElement("path",NS({},Ra(r,!0),{className:w,d:S7(c,d,u,f,h)}))},U6e=["points","className","baseLinePoints","connectNulls"];function Ev(){return Ev=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ev.apply(this,arguments)}function V6e(e,t){if(e==null)return{};var r=W6e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function W6e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function C7(e){return X6e(e)||K6e(e)||G6e(e)||H6e()}function H6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G6e(e,t){if(e){if(typeof e=="string")return CT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CT(e,t)}}function K6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function X6e(e){if(Array.isArray(e))return CT(e)}function CT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A7=function(t){return t&&t.x===+t.x&&t.y===+t.y},Y6e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){A7(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),A7(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},Qb=function(t,r){var n=Y6e(t);r&&(n=[n.reduce(function(o,i){return[].concat(C7(o),C7(i))},[])]);var s=n.map(function(o){return o.reduce(function(i,l,c){return"".concat(i).concat(c===0?"M":"L").concat(l.x,",").concat(l.y)},"")}).join("");return n.length===1?"".concat(s,"Z"):s},J6e=function(t,r,n){var s=Qb(t,n);return"".concat(s.slice(-1)==="Z"?s.slice(0,-1):s,"L").concat(Qb(r.reverse(),n).slice(1))},Q6e=function(t){var r=t.points,n=t.className,s=t.baseLinePoints,o=t.connectNulls,i=V6e(t,U6e);if(!r||!r.length)return null;var l=us("recharts-polygon",n);if(s&&s.length){var c=i.stroke&&i.stroke!=="none",d=J6e(r,s,o);return Ce.createElement("g",{className:l},Ce.createElement("path",Ev({},Ra(i,!0),{fill:d.slice(-1)==="Z"?i.fill:"none",stroke:"none",d})),c?Ce.createElement("path",Ev({},Ra(i,!0),{fill:"none",d:Qb(r,o)})):null,c?Ce.createElement("path",Ev({},Ra(i,!0),{fill:"none",d:Qb(s,o)})):null)}var u=Qb(r,o);return Ce.createElement("path",Ev({},Ra(i,!0),{fill:u.slice(-1)==="Z"?i.fill:"none",className:l,d:u}))};function AT(){return AT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AT.apply(this,arguments)}var hj=function(t){var r=t.cx,n=t.cy,s=t.r,o=t.className,i=us("recharts-dot",o);return r===+r&&n===+n&&s===+s?p.createElement("circle",AT({},Ra(t,!1),UN(t),{className:i,cx:r,cy:n,r:s})):null};function g1(e){"@babel/helpers - typeof";return g1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g1(e)}var Z6e=["x","y","top","left","width","height","className"];function PT(){return PT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PT.apply(this,arguments)}function P7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function e8e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P7(Object(r),!0).forEach(function(n){t8e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function t8e(e,t,r){return t=r8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r8e(e){var t=n8e(e,"string");return g1(t)=="symbol"?t:t+""}function n8e(e,t){if(g1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(g1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function a8e(e,t){if(e==null)return{};var r=s8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function s8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var o8e=function(t,r,n,s,o,i){return"M".concat(t,",").concat(o,"v").concat(s,"M").concat(i,",").concat(r,"h").concat(n)},i8e=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,i=t.top,l=i===void 0?0:i,c=t.left,d=c===void 0?0:c,u=t.width,f=u===void 0?0:u,h=t.height,m=h===void 0?0:h,x=t.className,g=a8e(t,Z6e),v=e8e({x:n,y:o,top:l,left:d,width:f,height:m},g);return!Mn(n)||!Mn(o)||!Mn(f)||!Mn(m)||!Mn(l)||!Mn(d)?null:Ce.createElement("path",PT({},Ra(v,!0),{className:us("recharts-cross",x),d:o8e(n,o,f,m,l,d)}))},l8e=V5,c8e=ZQ,d8e=em;function u8e(e,t){return e&&e.length?l8e(e,d8e(t),c8e):void 0}var f8e=u8e;const m8e=Us(f8e);var h8e=V5,p8e=em,g8e=eZ;function x8e(e,t){return e&&e.length?h8e(e,p8e(t),g8e):void 0}var v8e=x8e;const y8e=Us(v8e);var b8e=["cx","cy","angle","ticks","axisLine"],w8e=["ticks","tick","angle","tickFormatter","stroke"];function A0(e){"@babel/helpers - typeof";return A0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A0(e)}function Zb(){return Zb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Zb.apply(this,arguments)}function E7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Wp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E7(Object(r),!0).forEach(function(n){X5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k7(e,t){if(e==null)return{};var r=j8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function j8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UZ(n.key),n)}}function N8e(e,t,r){return t&&I7(e.prototype,t),r&&I7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function S8e(e,t,r){return t=SS(t),C8e(e,zZ()?Reflect.construct(t,r||[],SS(e).constructor):t.apply(e,r))}function C8e(e,t){if(t&&(A0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return A8e(e)}function A8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zZ=function(){return!!e})()}function SS(e){return SS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},SS(e)}function P8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ET(e,t)}function ET(e,t){return ET=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},ET(e,t)}function X5(e,t,r){return t=UZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UZ(e){var t=E8e(e,"string");return A0(t)=="symbol"?t:t+""}function E8e(e,t){if(A0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(A0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Y5=function(e){function t(){return _8e(this,t),S8e(this,t,arguments)}return P8e(t,e),N8e(t,[{key:"getTickValueCoord",value:function(n){var s=n.coordinate,o=this.props,i=o.angle,l=o.cx,c=o.cy;return To(l,c,s,i)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,s;switch(n){case"left":s="end";break;case"right":s="start";break;default:s="middle";break}return s}},{key:"getViewBox",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.angle,l=n.ticks,c=m8e(l,function(u){return u.coordinate||0}),d=y8e(l,function(u){return u.coordinate||0});return{cx:s,cy:o,startAngle:i,endAngle:i,innerRadius:d.coordinate||0,outerRadius:c.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.angle,l=n.ticks,c=n.axisLine,d=k7(n,b8e),u=l.reduce(function(x,g){return[Math.min(x[0],g.coordinate),Math.max(x[1],g.coordinate)]},[1/0,-1/0]),f=To(s,o,u[0],i),h=To(s,o,u[1],i),m=Wp(Wp(Wp({},Ra(d,!1)),{},{fill:"none"},Ra(c,!1)),{},{x1:f.x,y1:f.y,x2:h.x,y2:h.y});return Ce.createElement("line",Zb({className:"recharts-polar-radius-axis-line"},m))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,i=s.tick,l=s.angle,c=s.tickFormatter,d=s.stroke,u=k7(s,w8e),f=this.getTickTextAnchor(),h=Ra(u,!1),m=Ra(i,!1),x=o.map(function(g,v){var y=n.getTickValueCoord(g),b=Wp(Wp(Wp(Wp({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(y.x,", ").concat(y.y,")")},h),{},{stroke:"none",fill:d},m),{},{index:v},y),{},{payload:g});return Ce.createElement(ks,Zb({className:us("recharts-polar-radius-axis-tick",PZ(i)),key:"tick-".concat(g.coordinate)},ex(n.props,g,v)),t.renderTickItem(i,b,c?c(g.value,v):g.value))});return Ce.createElement(ks,{className:"recharts-polar-radius-axis-ticks"},x)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.axisLine,i=n.tick;return!s||!s.length?null:Ce.createElement(ks,{className:us("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),i&&this.renderTicks(),ll.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,s,o){var i;return Ce.isValidElement(n)?i=Ce.cloneElement(n,s):Ja(n)?i=n(s):i=Ce.createElement(tx,Zb({},s,{className:"recharts-polar-radius-axis-tick-value"}),o),i}}])}(p.PureComponent);X5(Y5,"displayName","PolarRadiusAxis");X5(Y5,"axisType","radiusAxis");X5(Y5,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function P0(e){"@babel/helpers - typeof";return P0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P0(e)}function ug(){return ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ug.apply(this,arguments)}function O7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Hp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O7(Object(r),!0).forEach(function(n){J5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WZ(n.key),n)}}function I8e(e,t,r){return t&&T7(e.prototype,t),r&&T7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function O8e(e,t,r){return t=CS(t),T8e(e,VZ()?Reflect.construct(t,r||[],CS(e).constructor):t.apply(e,r))}function T8e(e,t){if(t&&(P0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D8e(e)}function D8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function VZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(VZ=function(){return!!e})()}function CS(e){return CS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},CS(e)}function M8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kT(e,t)}function kT(e,t){return kT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},kT(e,t)}function J5(e,t,r){return t=WZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WZ(e){var t=R8e(e,"string");return P0(t)=="symbol"?t:t+""}function R8e(e,t){if(P0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(P0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var F8e=Math.PI/180,D7=1e-5,Q5=function(e){function t(){return k8e(this,t),O8e(this,t,arguments)}return M8e(t,e),I8e(t,[{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.cx,i=s.cy,l=s.radius,c=s.orientation,d=s.tickSize,u=d||8,f=To(o,i,l,n.coordinate),h=To(o,i,l+(c==="inner"?-1:1)*u,n.coordinate);return{x1:f.x,y1:f.y,x2:h.x,y2:h.y}}},{key:"getTickTextAnchor",value:function(n){var s=this.props.orientation,o=Math.cos(-n.coordinate*F8e),i;return o>D7?i=s==="outer"?"start":"end":o<-D7?i=s==="outer"?"end":"start":i="middle",i}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,i=n.radius,l=n.axisLine,c=n.axisLineType,d=Hp(Hp({},Ra(this.props,!1)),{},{fill:"none"},Ra(l,!1));if(c==="circle")return Ce.createElement(hj,ug({className:"recharts-polar-angle-axis-line"},d,{cx:s,cy:o,r:i}));var u=this.props.ticks,f=u.map(function(h){return To(s,o,i,h.coordinate)});return Ce.createElement(Q6e,ug({className:"recharts-polar-angle-axis-line"},d,{points:f}))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,i=s.tick,l=s.tickLine,c=s.tickFormatter,d=s.stroke,u=Ra(this.props,!1),f=Ra(i,!1),h=Hp(Hp({},u),{},{fill:"none"},Ra(l,!1)),m=o.map(function(x,g){var v=n.getTickLineCoord(x),y=n.getTickTextAnchor(x),b=Hp(Hp(Hp({textAnchor:y},u),{},{stroke:"none",fill:d},f),{},{index:g,payload:x,x:v.x2,y:v.y2});return Ce.createElement(ks,ug({className:us("recharts-polar-angle-axis-tick",PZ(i)),key:"tick-".concat(x.coordinate)},ex(n.props,x,g)),l&&Ce.createElement("line",ug({className:"recharts-polar-angle-axis-tick-line"},h,v)),i&&t.renderTickItem(i,b,c?c(x.value,g):x.value))});return Ce.createElement(ks,{className:"recharts-polar-angle-axis-ticks"},m)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.radius,i=n.axisLine;return o<=0||!s||!s.length?null:Ce.createElement(ks,{className:us("recharts-polar-angle-axis",this.props.className)},i&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,s,o){var i;return Ce.isValidElement(n)?i=Ce.cloneElement(n,s):Ja(n)?i=n(s):i=Ce.createElement(tx,ug({},s,{className:"recharts-polar-angle-axis-tick-value"}),o),i}}])}(p.PureComponent);J5(Q5,"displayName","PolarAngleAxis");J5(Q5,"axisType","angleAxis");J5(Q5,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var L8e=XJ,$8e=L8e(Object.getPrototypeOf,Object),B8e=$8e,q8e=Jm,z8e=B8e,U8e=Qm,V8e="[object Object]",W8e=Function.prototype,H8e=Object.prototype,HZ=W8e.toString,G8e=H8e.hasOwnProperty,K8e=HZ.call(Object);function X8e(e){if(!U8e(e)||q8e(e)!=V8e)return!1;var t=z8e(e);if(t===null)return!0;var r=G8e.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&HZ.call(r)==K8e}var Y8e=X8e;const J8e=Us(Y8e);var Q8e=Jm,Z8e=Qm,eBe="[object Boolean]";function tBe(e){return e===!0||e===!1||Z8e(e)&&Q8e(e)==eBe}var rBe=tBe;const nBe=Us(rBe);function x1(e){"@babel/helpers - typeof";return x1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x1(e)}function AS(){return AS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AS.apply(this,arguments)}function aBe(e,t){return lBe(e)||iBe(e,t)||oBe(e,t)||sBe()}function sBe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oBe(e,t){if(e){if(typeof e=="string")return M7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M7(e,t)}}function M7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function iBe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function lBe(e){if(Array.isArray(e))return e}function R7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function F7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?R7(Object(r),!0).forEach(function(n){cBe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cBe(e,t,r){return t=dBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dBe(e){var t=uBe(e,"string");return x1(t)=="symbol"?t:t+""}function uBe(e,t){if(x1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(x1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var L7=function(t,r,n,s,o){var i=n-s,l;return l="M ".concat(t,",").concat(r),l+="L ".concat(t+n,",").concat(r),l+="L ".concat(t+n-i/2,",").concat(r+o),l+="L ".concat(t+n-i/2-s,",").concat(r+o),l+="L ".concat(t,",").concat(r," Z"),l},fBe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},mBe=function(t){var r=F7(F7({},fBe),t),n=p.useRef(),s=p.useState(-1),o=aBe(s,2),i=o[0],l=o[1];p.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var w=n.current.getTotalLength();w&&l(w)}catch{}},[]);var c=r.x,d=r.y,u=r.upperWidth,f=r.lowerWidth,h=r.height,m=r.className,x=r.animationEasing,g=r.animationDuration,v=r.animationBegin,y=r.isUpdateAnimationActive;if(c!==+c||d!==+d||u!==+u||f!==+f||h!==+h||u===0&&f===0||h===0)return null;var b=us("recharts-trapezoid",m);return y?Ce.createElement(yp,{canBegin:i>0,from:{upperWidth:0,lowerWidth:0,height:h,x:c,y:d},to:{upperWidth:u,lowerWidth:f,height:h,x:c,y:d},duration:g,animationEasing:x,isActive:y},function(w){var j=w.upperWidth,_=w.lowerWidth,C=w.height,E=w.x,S=w.y;return Ce.createElement(yp,{canBegin:i>0,from:"0px ".concat(i===-1?1:i,"px"),to:"".concat(i,"px 0px"),attributeName:"strokeDasharray",begin:v,duration:g,easing:x},Ce.createElement("path",AS({},Ra(r,!0),{className:b,d:L7(E,S,j,_,C),ref:n})))}):Ce.createElement("g",null,Ce.createElement("path",AS({},Ra(r,!0),{className:b,d:L7(c,d,u,f,h)})))},hBe=["option","shapeType","propTransformer","activeClassName","isActive"];function v1(e){"@babel/helpers - typeof";return v1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v1(e)}function pBe(e,t){if(e==null)return{};var r=gBe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function gBe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function $7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function PS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$7(Object(r),!0).forEach(function(n){xBe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xBe(e,t,r){return t=vBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vBe(e){var t=yBe(e,"string");return v1(t)=="symbol"?t:t+""}function yBe(e,t){if(v1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(v1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bBe(e,t){return PS(PS({},t),e)}function wBe(e,t){return e==="symbols"}function B7(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ce.createElement(QM,r);case"trapezoid":return Ce.createElement(mBe,r);case"sector":return Ce.createElement(JM,r);case"symbols":if(wBe(t))return Ce.createElement(gM,r);break;default:return null}}function jBe(e){return p.isValidElement(e)?e.props:e}function GZ(e){var t=e.option,r=e.shapeType,n=e.propTransformer,s=n===void 0?bBe:n,o=e.activeClassName,i=o===void 0?"recharts-active-shape":o,l=e.isActive,c=pBe(e,hBe),d;if(p.isValidElement(t))d=p.cloneElement(t,PS(PS({},c),jBe(t)));else if(Ja(t))d=t(c);else if(J8e(t)&&!nBe(t)){var u=s(t,c);d=Ce.createElement(B7,{shapeType:r,elementProps:u})}else{var f=c;d=Ce.createElement(B7,{shapeType:r,elementProps:f})}return l?Ce.createElement(ks,{className:i},d):d}function Z5(e,t){return t!=null&&"trapezoids"in e.props}function eA(e,t){return t!=null&&"sectors"in e.props}function y1(e,t){return t!=null&&"points"in e.props}function _Be(e,t){var r,n,s=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return s&&o}function NBe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function SBe(e,t){var r=e.x===t.x,n=e.y===t.y,s=e.z===t.z;return r&&n&&s}function CBe(e,t){var r;return Z5(e,t)?r=_Be:eA(e,t)?r=NBe:y1(e,t)&&(r=SBe),r}function ABe(e,t){var r;return Z5(e,t)?r="trapezoids":eA(e,t)?r="sectors":y1(e,t)&&(r="points"),r}function PBe(e,t){if(Z5(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(eA(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return y1(e,t)?t.payload:{}}function EBe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,s=ABe(r,t),o=PBe(r,t),i=n.filter(function(c,d){var u=rx(o,c),f=r.props[s].filter(function(x){var g=CBe(r,t);return g(x,t)}),h=r.props[s].indexOf(f[f.length-1]),m=d===h;return u&&m}),l=n.indexOf(i[i.length-1]);return l}var R2;function E0(e){"@babel/helpers - typeof";return E0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E0(e)}function kv(){return kv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kv.apply(this,arguments)}function q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ao(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q7(Object(r),!0).forEach(function(n){iu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kBe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,XZ(n.key),n)}}function IBe(e,t,r){return t&&z7(e.prototype,t),r&&z7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function OBe(e,t,r){return t=ES(t),TBe(e,KZ()?Reflect.construct(t,r||[],ES(e).constructor):t.apply(e,r))}function TBe(e,t){if(t&&(E0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return DBe(e)}function DBe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(KZ=function(){return!!e})()}function ES(e){return ES=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ES(e)}function MBe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IT(e,t)}function IT(e,t){return IT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},IT(e,t)}function iu(e,t,r){return t=XZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XZ(e){var t=RBe(e,"string");return E0(t)=="symbol"?t:t+""}function RBe(e,t){if(E0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(E0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Jf=function(e){function t(r){var n;return kBe(this,t),n=OBe(this,t,[r]),iu(n,"pieRef",null),iu(n,"sectorRefs",[]),iu(n,"id",yx("recharts-pie-")),iu(n,"handleAnimationEnd",function(){var s=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Ja(s)&&s()}),iu(n,"handleAnimationStart",function(){var s=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Ja(s)&&s()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return MBe(t,e),IBe(t,[{key:"isActiveIndex",value:function(n){var s=this.props.activeIndex;return Array.isArray(s)?s.indexOf(n)!==-1:n===s}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.label,l=o.labelLine,c=o.dataKey,d=o.valueKey,u=Ra(this.props,!1),f=Ra(i,!1),h=Ra(l,!1),m=i&&i.offsetRadius||20,x=n.map(function(g,v){var y=(g.startAngle+g.endAngle)/2,b=To(g.cx,g.cy,g.outerRadius+m,y),w=Ao(Ao(Ao(Ao({},u),g),{},{stroke:"none"},f),{},{index:v,textAnchor:t.getTextAnchor(b.x,g.cx)},b),j=Ao(Ao(Ao(Ao({},u),g),{},{fill:"none",stroke:g.fill},h),{},{index:v,points:[To(g.cx,g.cy,g.outerRadius,y),b]}),_=c;return ls(c)&&ls(d)?_="value":ls(c)&&(_=d),Ce.createElement(ks,{key:"label-".concat(g.startAngle,"-").concat(g.endAngle,"-").concat(g.midAngle,"-").concat(v)},l&&t.renderLabelLineItem(l,j,"line"),t.renderLabelItem(i,w,ji(g,_)))});return Ce.createElement(ks,{className:"recharts-pie-labels"},x)}},{key:"renderSectorsStatically",value:function(n){var s=this,o=this.props,i=o.activeShape,l=o.blendStroke,c=o.inactiveShape;return n.map(function(d,u){if(d?.startAngle===0&&d?.endAngle===0&&n.length!==1)return null;var f=s.isActiveIndex(u),h=c&&s.hasActiveIndex()?c:null,m=f?i:h,x=Ao(Ao({},d),{},{stroke:l?d.fill:d.stroke,tabIndex:-1});return Ce.createElement(ks,kv({ref:function(v){v&&!s.sectorRefs.includes(v)&&s.sectorRefs.push(v)},tabIndex:-1,className:"recharts-pie-sector"},ex(s.props,d,u),{key:"sector-".concat(d?.startAngle,"-").concat(d?.endAngle,"-").concat(d.midAngle,"-").concat(u)}),Ce.createElement(GZ,kv({option:m,isActive:f,shapeType:"sector"},x)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,s=this.props,o=s.sectors,i=s.isAnimationActive,l=s.animationBegin,c=s.animationDuration,d=s.animationEasing,u=s.animationId,f=this.state,h=f.prevSectors,m=f.prevIsAnimationActive;return Ce.createElement(yp,{begin:l,duration:c,isActive:i,easing:d,from:{t:0},to:{t:1},key:"pie-".concat(u,"-").concat(m),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(x){var g=x.t,v=[],y=o&&o[0],b=y.startAngle;return o.forEach(function(w,j){var _=h&&h[j],C=j>0?kd(w,"paddingAngle",0):0;if(_){var E=Hi(_.endAngle-_.startAngle,w.endAngle-w.startAngle),S=Ao(Ao({},w),{},{startAngle:b+C,endAngle:b+E(g)+C});v.push(S),b=S.endAngle}else{var A=w.endAngle,M=w.startAngle,O=Hi(0,A-M),I=O(g),T=Ao(Ao({},w),{},{startAngle:b+C,endAngle:b+I+C});v.push(T),b=T.endAngle}}),Ce.createElement(ks,null,n.renderSectorsStatically(v))})}},{key:"attachKeyboardHandlers",value:function(n){var s=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var i=++s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[i].focus(),s.setState({sectorToFocus:i});break}case"ArrowRight":{var l=--s.state.sectorToFocus<0?s.sectorRefs.length-1:s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[l].focus(),s.setState({sectorToFocus:l});break}case"Escape":{s.sectorRefs[s.state.sectorToFocus].blur(),s.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,s=n.sectors,o=n.isAnimationActive,i=this.state.prevSectors;return o&&s&&s.length&&(!i||!rx(i,s))?this.renderSectorsWithAnimation():this.renderSectorsStatically(s)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,s=this.props,o=s.hide,i=s.sectors,l=s.className,c=s.label,d=s.cx,u=s.cy,f=s.innerRadius,h=s.outerRadius,m=s.isAnimationActive,x=this.state.isAnimationFinished;if(o||!i||!i.length||!Mn(d)||!Mn(u)||!Mn(f)||!Mn(h))return null;var g=us("recharts-pie",l);return Ce.createElement(ks,{tabIndex:this.props.rootTabIndex,className:g,ref:function(y){n.pieRef=y}},this.renderSectors(),c&&this.renderLabels(i),ll.renderCallByParent(this.props,null,!1),(!m||x)&&Vf.renderCallByParent(this.props,i,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return s.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:s.curSectors,isAnimationFinished:!0}:n.sectors!==s.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,s){return n>s?"start":n<s?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,s,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,s);if(Ja(n))return n(s);var i=us("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ce.createElement(Rg,kv({},s,{key:o,type:"linear",className:i}))}},{key:"renderLabelItem",value:function(n,s,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,s);var i=o;if(Ja(n)&&(i=n(s),Ce.isValidElement(i)))return i;var l=us("recharts-pie-label-text",typeof n!="boolean"&&!Ja(n)?n.className:"");return Ce.createElement(tx,kv({},s,{alignmentBaseline:"middle",className:l}),i)}}])}(p.PureComponent);R2=Jf;iu(Jf,"displayName","Pie");iu(Jf,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!nf.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});iu(Jf,"parseDeltaAngle",function(e,t){var r=hc(t-e),n=Math.min(Math.abs(t-e),360);return r*n});iu(Jf,"getRealPieData",function(e){var t=e.data,r=e.children,n=Ra(e,!1),s=Id(r,Xw);return t&&t.length?t.map(function(o,i){return Ao(Ao(Ao({payload:o},n),o),s&&s[i]&&s[i].props)}):s&&s.length?s.map(function(o){return Ao(Ao({},n),o.props)}):[]});iu(Jf,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,s=t.width,o=t.height,i=AZ(s,o),l=n+pc(e.cx,s,s/2),c=r+pc(e.cy,o,o/2),d=pc(e.innerRadius,i,0),u=pc(e.outerRadius,i,i*.8),f=e.maxRadius||Math.sqrt(s*s+o*o)/2;return{cx:l,cy:c,innerRadius:d,outerRadius:u,maxRadius:f}});iu(Jf,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Ao(Ao({},t.type.defaultProps),t.props):t.props,s=R2.getRealPieData(n);if(!s||!s.length)return null;var o=n.cornerRadius,i=n.startAngle,l=n.endAngle,c=n.paddingAngle,d=n.dataKey,u=n.nameKey,f=n.valueKey,h=n.tooltipType,m=Math.abs(n.minAngle),x=R2.parseCoordinateOfPie(n,r),g=R2.parseDeltaAngle(i,l),v=Math.abs(g),y=d;ls(d)&&ls(f)?(rf(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),y="value"):ls(d)&&(rf(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),y=f);var b=s.filter(function(S){return ji(S,y,0)!==0}).length,w=(v>=360?b:b-1)*c,j=v-b*m-w,_=s.reduce(function(S,A){var M=ji(A,y,0);return S+(Mn(M)?M:0)},0),C;if(_>0){var E;C=s.map(function(S,A){var M=ji(S,y,0),O=ji(S,u,A),I=(Mn(M)?M:0)/_,T;A?T=E.endAngle+hc(g)*c*(M!==0?1:0):T=i;var k=T+hc(g)*((M!==0?m:0)+I*j),q=(T+k)/2,B=(x.innerRadius+x.outerRadius)/2,z=[{name:O,value:M,payload:S,dataKey:y,type:h}],F=To(x.cx,x.cy,B,q);return E=Ao(Ao(Ao({percent:I,cornerRadius:o,name:O,tooltipPayload:z,midAngle:q,middleRadius:B,tooltipPosition:F},S),x),{},{value:ji(S,y),startAngle:T,endAngle:k,payload:S,paddingAngle:hc(g)*c}),E})}return Ao(Ao({},x),{},{sectors:C,data:s})});var FBe=Math.ceil,LBe=Math.max;function $Be(e,t,r,n){for(var s=-1,o=LBe(FBe((t-e)/(r||1)),0),i=Array(o);o--;)i[n?o:++s]=e,e+=r;return i}var BBe=$Be,qBe=hQ,U7=1/0,zBe=17976931348623157e292;function UBe(e){if(!e)return e===0?e:0;if(e=qBe(e),e===U7||e===-U7){var t=e<0?-1:1;return t*zBe}return e===e?e:0}var YZ=UBe,VBe=BBe,WBe=F5,DE=YZ;function HBe(e){return function(t,r,n){return n&&typeof n!="number"&&WBe(t,r,n)&&(r=n=void 0),t=DE(t),r===void 0?(r=t,t=0):r=DE(r),n=n===void 0?t<r?1:-1:DE(n),VBe(t,r,n,e)}}var GBe=HBe,KBe=GBe,XBe=KBe(),YBe=XBe;const kS=Us(YBe);function b1(e){"@babel/helpers - typeof";return b1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b1(e)}function V7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function W7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V7(Object(r),!0).forEach(function(n){JZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JZ(e,t,r){return t=JBe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JBe(e){var t=QBe(e,"string");return b1(t)=="symbol"?t:t+""}function QBe(e,t){if(b1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(b1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ZBe=["Webkit","Moz","O","ms"],eqe=function(t,r){if(!t)return null;var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),s=ZBe.reduce(function(o,i){return W7(W7({},o),{},JZ({},i+n,r))},{});return s[t]=r,s};function k0(e){"@babel/helpers - typeof";return k0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k0(e)}function IS(){return IS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},IS.apply(this,arguments)}function H7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ME(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H7(Object(r),!0).forEach(function(n){md(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tqe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ZZ(n.key),n)}}function rqe(e,t,r){return t&&G7(e.prototype,t),r&&G7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function nqe(e,t,r){return t=OS(t),aqe(e,QZ()?Reflect.construct(t,r||[],OS(e).constructor):t.apply(e,r))}function aqe(e,t){if(t&&(k0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sqe(e)}function sqe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function QZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(QZ=function(){return!!e})()}function OS(e){return OS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},OS(e)}function oqe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OT(e,t)}function OT(e,t){return OT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},OT(e,t)}function md(e,t,r){return t=ZZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZZ(e){var t=iqe(e,"string");return k0(t)=="symbol"?t:t+""}function iqe(e,t){if(k0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(k0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var lqe=function(t){var r=t.data,n=t.startIndex,s=t.endIndex,o=t.x,i=t.width,l=t.travellerWidth;if(!r||!r.length)return{};var c=r.length,d=Xb().domain(kS(0,c)).range([o,o+i-l]),u=d.domain().map(function(f){return d(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:d(n),endX:d(s),scale:d,scaleValues:u}},K7=function(t){return t.changedTouches&&!!t.changedTouches.length},I0=function(e){function t(r){var n;return tqe(this,t),n=nqe(this,t,[r]),md(n,"handleDrag",function(s){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(s):n.state.isSlideMoving&&n.handleSlideDrag(s)}),md(n,"handleTouchMove",function(s){s.changedTouches!=null&&s.changedTouches.length>0&&n.handleDrag(s.changedTouches[0])}),md(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var s=n.props,o=s.endIndex,i=s.onDragEnd,l=s.startIndex;i?.({endIndex:o,startIndex:l})}),n.detachDragEndListener()}),md(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),md(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),md(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),md(n,"handleSlideDragStart",function(s){var o=K7(s)?s.changedTouches[0]:s;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return oqe(t,e),rqe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var s=n.startX,o=n.endX,i=this.state.scaleValues,l=this.props,c=l.gap,d=l.data,u=d.length-1,f=Math.min(s,o),h=Math.max(s,o),m=t.getIndexInRange(i,f),x=t.getIndexInRange(i,h);return{startIndex:m-m%c,endIndex:x===u?u:x-x%c}}},{key:"getTextOfTick",value:function(n){var s=this.props,o=s.data,i=s.tickFormatter,l=s.dataKey,c=ji(o[n],l,n);return Ja(i)?i(c,n):c}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var s=this.state,o=s.slideMoveStartX,i=s.startX,l=s.endX,c=this.props,d=c.x,u=c.width,f=c.travellerWidth,h=c.startIndex,m=c.endIndex,x=c.onChange,g=n.pageX-o;g>0?g=Math.min(g,d+u-f-l,d+u-f-i):g<0&&(g=Math.max(g,d-i,d-l));var v=this.getIndex({startX:i+g,endX:l+g});(v.startIndex!==h||v.endIndex!==m)&&x&&x(v),this.setState({startX:i+g,endX:l+g,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,s){var o=K7(s)?s.changedTouches[0]:s;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var s=this.state,o=s.brushMoveStartX,i=s.movingTravellerId,l=s.endX,c=s.startX,d=this.state[i],u=this.props,f=u.x,h=u.width,m=u.travellerWidth,x=u.onChange,g=u.gap,v=u.data,y={startX:this.state.startX,endX:this.state.endX},b=n.pageX-o;b>0?b=Math.min(b,f+h-m-d):b<0&&(b=Math.max(b,f-d)),y[i]=d+b;var w=this.getIndex(y),j=w.startIndex,_=w.endIndex,C=function(){var S=v.length-1;return i==="startX"&&(l>c?j%g===0:_%g===0)||l<c&&_===S||i==="endX"&&(l>c?_%g===0:j%g===0)||l>c&&_===S};this.setState(md(md({},i,d+b),"brushMoveStartX",n.pageX),function(){x&&C()&&x(w)})}},{key:"handleTravellerMoveKeyboard",value:function(n,s){var o=this,i=this.state,l=i.scaleValues,c=i.startX,d=i.endX,u=this.state[s],f=l.indexOf(u);if(f!==-1){var h=f+n;if(!(h===-1||h>=l.length)){var m=l[h];s==="startX"&&m>=d||s==="endX"&&m<=c||this.setState(md({},s,m),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.fill,d=n.stroke;return Ce.createElement("rect",{stroke:d,fill:c,x:s,y:o,width:i,height:l})}},{key:"renderPanorama",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.data,d=n.children,u=n.padding,f=p.Children.only(d);return f?Ce.cloneElement(f,{x:s,y:o,width:i,height:l,margin:u,compact:!0,data:c}):null}},{key:"renderTravellerLayer",value:function(n,s){var o,i,l=this,c=this.props,d=c.y,u=c.travellerWidth,f=c.height,h=c.traveller,m=c.ariaLabel,x=c.data,g=c.startIndex,v=c.endIndex,y=Math.max(n,this.props.x),b=ME(ME({},Ra(this.props,!1)),{},{x:y,y:d,width:u,height:f}),w=m||"Min value: ".concat((o=x[g])===null||o===void 0?void 0:o.name,", Max value: ").concat((i=x[v])===null||i===void 0?void 0:i.name);return Ce.createElement(ks,{tabIndex:0,role:"slider","aria-label":w,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[s],onTouchStart:this.travellerDragStartHandlers[s],onKeyDown:function(_){["ArrowLeft","ArrowRight"].includes(_.key)&&(_.preventDefault(),_.stopPropagation(),l.handleTravellerMoveKeyboard(_.key==="ArrowRight"?1:-1,s))},onFocus:function(){l.setState({isTravellerFocused:!0})},onBlur:function(){l.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,b))}},{key:"renderSlide",value:function(n,s){var o=this.props,i=o.y,l=o.height,c=o.stroke,d=o.travellerWidth,u=Math.min(n,s)+d,f=Math.max(Math.abs(s-n)-d,0);return Ce.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:c,fillOpacity:.2,x:u,y:i,width:f,height:l})}},{key:"renderText",value:function(){var n=this.props,s=n.startIndex,o=n.endIndex,i=n.y,l=n.height,c=n.travellerWidth,d=n.stroke,u=this.state,f=u.startX,h=u.endX,m=5,x={pointerEvents:"none",fill:d};return Ce.createElement(ks,{className:"recharts-brush-texts"},Ce.createElement(tx,IS({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-m,y:i+l/2},x),this.getTextOfTick(s)),Ce.createElement(tx,IS({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+c+m,y:i+l/2},x),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,s=n.data,o=n.className,i=n.children,l=n.x,c=n.y,d=n.width,u=n.height,f=n.alwaysShowText,h=this.state,m=h.startX,x=h.endX,g=h.isTextActive,v=h.isSlideMoving,y=h.isTravellerMoving,b=h.isTravellerFocused;if(!s||!s.length||!Mn(l)||!Mn(c)||!Mn(d)||!Mn(u)||d<=0||u<=0)return null;var w=us("recharts-brush",o),j=Ce.Children.count(i)===1,_=eqe("userSelect","none");return Ce.createElement(ks,{className:w,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:_},this.renderBackground(),j&&this.renderPanorama(),this.renderSlide(m,x),this.renderTravellerLayer(m,"startX"),this.renderTravellerLayer(x,"endX"),(g||v||y||b||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var s=n.x,o=n.y,i=n.width,l=n.height,c=n.stroke,d=Math.floor(o+l/2)-1;return Ce.createElement(Ce.Fragment,null,Ce.createElement("rect",{x:s,y:o,width:i,height:l,fill:c,stroke:"none"}),Ce.createElement("line",{x1:s+1,y1:d,x2:s+i-1,y2:d,fill:"none",stroke:"#fff"}),Ce.createElement("line",{x1:s+1,y1:d+2,x2:s+i-1,y2:d+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,s){var o;return Ce.isValidElement(n)?o=Ce.cloneElement(n,s):Ja(n)?o=n(s):o=t.renderDefaultTraveller(s),o}},{key:"getDerivedStateFromProps",value:function(n,s){var o=n.data,i=n.width,l=n.x,c=n.travellerWidth,d=n.updateId,u=n.startIndex,f=n.endIndex;if(o!==s.prevData||d!==s.prevUpdateId)return ME({prevData:o,prevTravellerWidth:c,prevUpdateId:d,prevX:l,prevWidth:i},o&&o.length?lqe({data:o,width:i,x:l,travellerWidth:c,startIndex:u,endIndex:f}):{scale:null,scaleValues:null});if(s.scale&&(i!==s.prevWidth||l!==s.prevX||c!==s.prevTravellerWidth)){s.scale.range([l,l+i-c]);var h=s.scale.domain().map(function(m){return s.scale(m)});return{prevData:o,prevTravellerWidth:c,prevUpdateId:d,prevX:l,prevWidth:i,startX:s.scale(n.startIndex),endX:s.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,s){for(var o=n.length,i=0,l=o-1;l-i>1;){var c=Math.floor((i+l)/2);n[c]>s?l=c:i=c}return s>=n[l]?l:i}}])}(p.PureComponent);md(I0,"displayName","Brush");md(I0,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var cqe=_M;function dqe(e,t){var r;return cqe(e,function(n,s,o){return r=t(n,s,o),!r}),!!r}var uqe=dqe,fqe=qJ,mqe=em,hqe=uqe,pqe=Yc,gqe=F5;function xqe(e,t,r){var n=pqe(e)?fqe:hqe;return r&&gqe(e,t,r)&&(t=void 0),n(e,mqe(t))}var vqe=xqe;const yqe=Us(vqe);var Wf=function(t,r){var n=t.alwaysShow,s=t.ifOverflow;return n&&(s="extendDomain"),s===r},X7=cQ;function bqe(e,t,r){t=="__proto__"&&X7?X7(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var wqe=bqe,jqe=wqe,_qe=iQ,Nqe=em;function Sqe(e,t){var r={};return t=Nqe(t),_qe(e,function(n,s,o){jqe(r,s,t(n,s,o))}),r}var Cqe=Sqe;const Aqe=Us(Cqe);function Pqe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var Eqe=Pqe,kqe=_M;function Iqe(e,t){var r=!0;return kqe(e,function(n,s,o){return r=!!t(n,s,o),r}),r}var Oqe=Iqe,Tqe=Eqe,Dqe=Oqe,Mqe=em,Rqe=Yc,Fqe=F5;function Lqe(e,t,r){var n=Rqe(e)?Tqe:Dqe;return r&&Fqe(e,t,r)&&(t=void 0),n(e,Mqe(t))}var $qe=Lqe;const eee=Us($qe);var Bqe=["x","y"];function w1(e){"@babel/helpers - typeof";return w1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w1(e)}function TT(){return TT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TT.apply(this,arguments)}function Y7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function sb(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Y7(Object(r),!0).forEach(function(n){qqe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qqe(e,t,r){return t=zqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zqe(e){var t=Uqe(e,"string");return w1(t)=="symbol"?t:t+""}function Uqe(e,t){if(w1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(w1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Vqe(e,t){if(e==null)return{};var r=Wqe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Wqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Hqe(e,t){var r=e.x,n=e.y,s=Vqe(e,Bqe),o="".concat(r),i=parseInt(o,10),l="".concat(n),c=parseInt(l,10),d="".concat(t.height||s.height),u=parseInt(d,10),f="".concat(t.width||s.width),h=parseInt(f,10);return sb(sb(sb(sb(sb({},t),s),i?{x:i}:{}),c?{y:c}:{}),{},{height:u,width:h,name:t.name,radius:t.radius})}function J7(e){return Ce.createElement(GZ,TT({shapeType:"rectangle",propTransformer:Hqe,activeClassName:"recharts-active-bar"},e))}var Gqe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,s){if(typeof t=="number")return t;var o=Mn(n)||_Se(n);return o?t(n,s):(o||vp(!1),r)}},Kqe=["value","background"],tee;function O0(e){"@babel/helpers - typeof";return O0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O0(e)}function Xqe(e,t){if(e==null)return{};var r=Yqe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Yqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function TS(){return TS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TS.apply(this,arguments)}function Q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ki(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q7(Object(r),!0).forEach(function(n){Rh(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jqe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nee(n.key),n)}}function Qqe(e,t,r){return t&&Z7(e.prototype,t),r&&Z7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zqe(e,t,r){return t=DS(t),e7e(e,ree()?Reflect.construct(t,r||[],DS(e).constructor):t.apply(e,r))}function e7e(e,t){if(t&&(O0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return t7e(e)}function t7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ree(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ree=function(){return!!e})()}function DS(e){return DS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},DS(e)}function r7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DT(e,t)}function DT(e,t){return DT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},DT(e,t)}function Rh(e,t,r){return t=nee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nee(e){var t=n7e(e,"string");return O0(t)=="symbol"?t:t+""}function n7e(e,t){if(O0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(O0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _x=function(e){function t(){var r;Jqe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=Zqe(this,t,[].concat(s)),Rh(r,"state",{isAnimationFinished:!1}),Rh(r,"id",yx("recharts-bar-")),Rh(r,"handleAnimationEnd",function(){var i=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),i&&i()}),Rh(r,"handleAnimationStart",function(){var i=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),i&&i()}),r}return r7e(t,e),Qqe(t,[{key:"renderRectanglesStatically",value:function(n){var s=this,o=this.props,i=o.shape,l=o.dataKey,c=o.activeIndex,d=o.activeBar,u=Ra(this.props,!1);return n&&n.map(function(f,h){var m=h===c,x=m?d:i,g=ki(ki(ki({},u),f),{},{isActive:m,option:x,index:h,dataKey:l,onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd});return Ce.createElement(ks,TS({className:"recharts-bar-rectangle"},ex(s.props,f,h),{key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(h)}),Ce.createElement(J7,g))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,s=this.props,o=s.data,i=s.layout,l=s.isAnimationActive,c=s.animationBegin,d=s.animationDuration,u=s.animationEasing,f=s.animationId,h=this.state.prevData;return Ce.createElement(yp,{begin:c,duration:d,isActive:l,easing:u,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(m){var x=m.t,g=o.map(function(v,y){var b=h&&h[y];if(b){var w=Hi(b.x,v.x),j=Hi(b.y,v.y),_=Hi(b.width,v.width),C=Hi(b.height,v.height);return ki(ki({},v),{},{x:w(x),y:j(x),width:_(x),height:C(x)})}if(i==="horizontal"){var E=Hi(0,v.height),S=E(x);return ki(ki({},v),{},{y:v.y+v.height-S,height:S})}var A=Hi(0,v.width),M=A(x);return ki(ki({},v),{},{width:M})});return Ce.createElement(ks,null,n.renderRectanglesStatically(g))})}},{key:"renderRectangles",value:function(){var n=this.props,s=n.data,o=n.isAnimationActive,i=this.state.prevData;return o&&s&&s.length&&(!i||!rx(i,s))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(s)}},{key:"renderBackground",value:function(){var n=this,s=this.props,o=s.data,i=s.dataKey,l=s.activeIndex,c=Ra(this.props.background,!1);return o.map(function(d,u){d.value;var f=d.background,h=Xqe(d,Kqe);if(!f)return null;var m=ki(ki(ki(ki(ki({},h),{},{fill:"#eee"},f),c),ex(n.props,d,u)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:i,index:u,className:"recharts-bar-background-rectangle"});return Ce.createElement(J7,TS({key:"background-bar-".concat(u),option:n.props.background,isActive:u===l},m))})}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.data,l=o.xAxis,c=o.yAxis,d=o.layout,u=o.children,f=Id(u,mj);if(!f)return null;var h=d==="vertical"?i[0].height/2:i[0].width/2,m=function(v,y){var b=Array.isArray(v.value)?v.value[1]:v.value;return{x:v.x,y:v.y,value:b,errorVal:ji(v,y)}},x={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ce.createElement(ks,x,f.map(function(g){return Ce.cloneElement(g,{key:"error-bar-".concat(s,"-").concat(g.props.dataKey),data:i,xAxis:l,yAxis:c,layout:d,offset:h,dataPointFormatter:m})}))}},{key:"render",value:function(){var n=this.props,s=n.hide,o=n.data,i=n.className,l=n.xAxis,c=n.yAxis,d=n.left,u=n.top,f=n.width,h=n.height,m=n.isAnimationActive,x=n.background,g=n.id;if(s||!o||!o.length)return null;var v=this.state.isAnimationFinished,y=us("recharts-bar",i),b=l&&l.allowDataOverflow,w=c&&c.allowDataOverflow,j=b||w,_=ls(g)?this.id:g;return Ce.createElement(ks,{className:y},b||w?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(_)},Ce.createElement("rect",{x:b?d:d-f/2,y:w?u:u-h/2,width:b?f:f*2,height:w?h:h*2}))):null,Ce.createElement(ks,{className:"recharts-bar-rectangles",clipPath:j?"url(#clipPath-".concat(_,")"):null},x?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(j,_),(!m||v)&&Vf.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:s.curData}:n.data!==s.curData?{curData:n.data}:null}}])}(p.PureComponent);tee=_x;Rh(_x,"displayName","Bar");Rh(_x,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!nf.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Rh(_x,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,s=e.bandSize,o=e.xAxis,i=e.yAxis,l=e.xAxisTicks,c=e.yAxisTicks,d=e.stackedData,u=e.dataStartIndex,f=e.displayedData,h=e.offset,m=LFe(n,r);if(!m)return null;var x=t.layout,g=r.type.defaultProps,v=g!==void 0?ki(ki({},g),r.props):r.props,y=v.dataKey,b=v.children,w=v.minPointSize,j=x==="horizontal"?i:o,_=d?j.scale.domain():null,C=WFe({numericAxis:j}),E=Id(b,Xw),S=f.map(function(A,M){var O,I,T,k,q,B;d?O=$Fe(d[u+M],_):(O=ji(A,y),Array.isArray(O)||(O=[C,O]));var z=Gqe(w,tee.defaultProps.minPointSize)(O[1],M);if(x==="horizontal"){var F,V=[i.scale(O[0]),i.scale(O[1])],me=V[0],be=V[1];I=qq({axis:o,ticks:l,bandSize:s,offset:m.offset,entry:A,index:M}),T=(F=be??me)!==null&&F!==void 0?F:void 0,k=m.size;var U=me-be;if(q=Number.isNaN(U)?0:U,B={x:I,y:i.y,width:k,height:i.height},Math.abs(z)>0&&Math.abs(q)<Math.abs(z)){var L=hc(q||z)*(Math.abs(z)-Math.abs(q));T-=L,q+=L}}else{var H=[o.scale(O[0]),o.scale(O[1])],ie=H[0],Y=H[1];if(I=ie,T=qq({axis:i,ticks:c,bandSize:s,offset:m.offset,entry:A,index:M}),k=Y-ie,q=m.size,B={x:o.x,y:T,width:o.width,height:q},Math.abs(z)>0&&Math.abs(k)<Math.abs(z)){var W=hc(k||z)*(Math.abs(z)-Math.abs(k));k+=W}}return ki(ki(ki({},A),{},{x:I,y:T,width:k,height:q,value:d?O:O[1],payload:A,background:B},E&&E[M]&&E[M].props),{},{tooltipPayload:[SZ(r,A)],tooltipPosition:{x:I+k/2,y:T+q/2}})});return ki({data:S,layout:x},h)});function j1(e){"@babel/helpers - typeof";return j1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j1(e)}function a7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ez(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,aee(n.key),n)}}function s7e(e,t,r){return t&&ez(e.prototype,t),r&&ez(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Vu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tz(Object(r),!0).forEach(function(n){tA(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tA(e,t,r){return t=aee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aee(e){var t=o7e(e,"string");return j1(t)=="symbol"?t:t+""}function o7e(e,t){if(j1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(j1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ZM=function(t,r,n,s,o){var i=t.width,l=t.height,c=t.layout,d=t.children,u=Object.keys(r),f={left:n.left,leftMirror:n.left,right:i-n.right,rightMirror:i-n.right,top:n.top,topMirror:n.top,bottom:l-n.bottom,bottomMirror:l-n.bottom},h=!!xd(d,_x);return u.reduce(function(m,x){var g=r[x],v=g.orientation,y=g.domain,b=g.padding,w=b===void 0?{}:b,j=g.mirror,_=g.reversed,C="".concat(v).concat(j?"Mirror":""),E,S,A,M,O;if(g.type==="number"&&(g.padding==="gap"||g.padding==="no-gap")){var I=y[1]-y[0],T=1/0,k=g.categoricalDomain.sort(CSe);if(k.forEach(function(H,ie){ie>0&&(T=Math.min((H||0)-(k[ie-1]||0),T))}),Number.isFinite(T)){var q=T/I,B=g.layout==="vertical"?n.height:n.width;if(g.padding==="gap"&&(E=q*B/2),g.padding==="no-gap"){var z=pc(t.barCategoryGap,q*B),F=q*B/2;E=F-z-(F-z)/B*z}}}s==="xAxis"?S=[n.left+(w.left||0)+(E||0),n.left+n.width-(w.right||0)-(E||0)]:s==="yAxis"?S=c==="horizontal"?[n.top+n.height-(w.bottom||0),n.top+(w.top||0)]:[n.top+(w.top||0)+(E||0),n.top+n.height-(w.bottom||0)-(E||0)]:S=g.range,_&&(S=[S[1],S[0]]);var V=wZ(g,o,h),me=V.scale,be=V.realScaleType;me.domain(y).range(S),jZ(me);var U=_Z(me,Vu(Vu({},g),{},{realScaleType:be}));s==="xAxis"?(O=v==="top"&&!j||v==="bottom"&&j,A=n.left,M=f[C]-O*g.height):s==="yAxis"&&(O=v==="left"&&!j||v==="right"&&j,A=f[C]-O*g.width,M=n.top);var L=Vu(Vu(Vu({},g),U),{},{realScaleType:be,x:A,y:M,scale:me,width:s==="xAxis"?n.width:g.width,height:s==="yAxis"?n.height:g.height});return L.bandSize=xS(L,U),!g.hide&&s==="xAxis"?f[C]+=(O?-1:1)*L.height:g.hide||(f[C]+=(O?-1:1)*L.width),Vu(Vu({},m),{},tA({},x,L))},{})},see=function(t,r){var n=t.x,s=t.y,o=r.x,i=r.y;return{x:Math.min(n,o),y:Math.min(s,i),width:Math.abs(o-n),height:Math.abs(i-s)}},i7e=function(t){var r=t.x1,n=t.y1,s=t.x2,o=t.y2;return see({x:r,y:n},{x:s,y:o})},oee=function(){function e(t){a7e(this,e),this.scale=t}return s7e(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+i}case"end":{var l=this.bandwidth?this.bandwidth():0;return this.scale(r)+l}default:return this.scale(r)}if(s){var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+c}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),s=n[0],o=n[n.length-1];return s<=o?r>=s&&r<=o:r>=o&&r<=s}}],[{key:"create",value:function(r){return new e(r)}}])}();tA(oee,"EPS",1e-4);var eR=function(t){var r=Object.keys(t).reduce(function(n,s){return Vu(Vu({},n),{},tA({},s,oee.create(t[s])))},{});return Vu(Vu({},r),{},{apply:function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=o.bandAware,l=o.position;return Aqe(s,function(c,d){return r[d].apply(c,{bandAware:i,position:l})})},isInRange:function(s){return eee(s,function(o,i){return r[i].isInRange(o)})}})};function l7e(e){return(e%180+180)%180}var c7e=function(t){var r=t.width,n=t.height,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=l7e(s),i=o*Math.PI/180,l=Math.atan(n/r),c=i>l&&i<Math.PI-l?n/Math.sin(i):r/Math.cos(i);return Math.abs(c)},d7e=em,u7e=lj,f7e=M5;function m7e(e){return function(t,r,n){var s=Object(t);if(!u7e(t)){var o=d7e(r);t=f7e(t),r=function(l){return o(s[l],l,s)}}var i=e(t,r,n);return i>-1?s[o?t[i]:i]:void 0}}var h7e=m7e,p7e=YZ;function g7e(e){var t=p7e(e),r=t%1;return t===t?r?t-r:t:0}var x7e=g7e,v7e=tQ,y7e=em,b7e=x7e,w7e=Math.max;function j7e(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var s=r==null?0:b7e(r);return s<0&&(s=w7e(n+s,0)),v7e(e,y7e(t),s)}var _7e=j7e,N7e=h7e,S7e=_7e,C7e=N7e(S7e),A7e=C7e;const P7e=Us(A7e);var E7e=ANe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),tR=p.createContext(void 0),rR=p.createContext(void 0),iee=p.createContext(void 0),lee=p.createContext({}),cee=p.createContext(void 0),dee=p.createContext(0),uee=p.createContext(0),rz=function(t){var r=t.state,n=r.xAxisMap,s=r.yAxisMap,o=r.offset,i=t.clipPathId,l=t.children,c=t.width,d=t.height,u=E7e(o);return Ce.createElement(tR.Provider,{value:n},Ce.createElement(rR.Provider,{value:s},Ce.createElement(lee.Provider,{value:o},Ce.createElement(iee.Provider,{value:u},Ce.createElement(cee.Provider,{value:i},Ce.createElement(dee.Provider,{value:d},Ce.createElement(uee.Provider,{value:c},l)))))))},k7e=function(){return p.useContext(cee)},fee=function(t){var r=p.useContext(tR);r==null&&vp(!1);var n=r[t];return n==null&&vp(!1),n},I7e=function(){var t=p.useContext(tR);return Ah(t)},O7e=function(){var t=p.useContext(rR),r=P7e(t,function(n){return eee(n.domain,Number.isFinite)});return r||Ah(t)},mee=function(t){var r=p.useContext(rR);r==null&&vp(!1);var n=r[t];return n==null&&vp(!1),n},T7e=function(){var t=p.useContext(iee);return t},D7e=function(){return p.useContext(lee)},nR=function(){return p.useContext(uee)},aR=function(){return p.useContext(dee)};function T0(e){"@babel/helpers - typeof";return T0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T0(e)}function M7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pee(n.key),n)}}function R7e(e,t,r){return t&&nz(e.prototype,t),r&&nz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function F7e(e,t,r){return t=MS(t),L7e(e,hee()?Reflect.construct(t,r||[],MS(e).constructor):t.apply(e,r))}function L7e(e,t){if(t&&(T0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $7e(e)}function $7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hee=function(){return!!e})()}function MS(e){return MS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},MS(e)}function B7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MT(e,t)}function MT(e,t){return MT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},MT(e,t)}function az(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function sz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?az(Object(r),!0).forEach(function(n){sR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):az(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sR(e,t,r){return t=pee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pee(e){var t=q7e(e,"string");return T0(t)=="symbol"?t:t+""}function q7e(e,t){if(T0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(T0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function z7e(e,t){return H7e(e)||W7e(e,t)||V7e(e,t)||U7e()}function U7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V7e(e,t){if(e){if(typeof e=="string")return oz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oz(e,t)}}function oz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function W7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function H7e(e){if(Array.isArray(e))return e}function RT(){return RT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},RT.apply(this,arguments)}var G7e=function(t,r){var n;return Ce.isValidElement(t)?n=Ce.cloneElement(t,r):Ja(t)?n=t(r):n=Ce.createElement("line",RT({},r,{className:"recharts-reference-line-line"})),n},K7e=function(t,r,n,s,o,i,l,c,d){var u=o.x,f=o.y,h=o.width,m=o.height;if(n){var x=d.y,g=t.y.apply(x,{position:i});if(Wf(d,"discard")&&!t.y.isInRange(g))return null;var v=[{x:u+h,y:g},{x:u,y:g}];return c==="left"?v.reverse():v}if(r){var y=d.x,b=t.x.apply(y,{position:i});if(Wf(d,"discard")&&!t.x.isInRange(b))return null;var w=[{x:b,y:f+m},{x:b,y:f}];return l==="top"?w.reverse():w}if(s){var j=d.segment,_=j.map(function(C){return t.apply(C,{position:i})});return Wf(d,"discard")&&yqe(_,function(C){return!t.isInRange(C)})?null:_}return null};function X7e(e){var t=e.x,r=e.y,n=e.segment,s=e.xAxisId,o=e.yAxisId,i=e.shape,l=e.className,c=e.alwaysShow,d=k7e(),u=fee(s),f=mee(o),h=T7e();if(!d||!h)return null;rf(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var m=eR({x:u.scale,y:f.scale}),x=Ki(t),g=Ki(r),v=n&&n.length===2,y=K7e(m,x,g,v,h,e.position,u.orientation,f.orientation,e);if(!y)return null;var b=z7e(y,2),w=b[0],j=w.x,_=w.y,C=b[1],E=C.x,S=C.y,A=Wf(e,"hidden")?"url(#".concat(d,")"):void 0,M=sz(sz({clipPath:A},Ra(e,!0)),{},{x1:j,y1:_,x2:E,y2:S});return Ce.createElement(ks,{className:us("recharts-reference-line",l)},G7e(i,M),ll.renderCallByParent(e,i7e({x1:j,y1:_,x2:E,y2:S})))}var oR=function(e){function t(){return M7e(this,t),F7e(this,t,arguments)}return B7e(t,e),R7e(t,[{key:"render",value:function(){return Ce.createElement(X7e,this.props)}}])}(Ce.Component);sR(oR,"displayName","ReferenceLine");sR(oR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function FT(){return FT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},FT.apply(this,arguments)}function D0(e){"@babel/helpers - typeof";return D0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D0(e)}function iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function lz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iz(Object(r),!0).forEach(function(n){rA(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xee(n.key),n)}}function J7e(e,t,r){return t&&cz(e.prototype,t),r&&cz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Q7e(e,t,r){return t=RS(t),Z7e(e,gee()?Reflect.construct(t,r||[],RS(e).constructor):t.apply(e,r))}function Z7e(e,t){if(t&&(D0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eze(e)}function eze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gee=function(){return!!e})()}function RS(e){return RS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},RS(e)}function tze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LT(e,t)}function LT(e,t){return LT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},LT(e,t)}function rA(e,t,r){return t=xee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xee(e){var t=rze(e,"string");return D0(t)=="symbol"?t:t+""}function rze(e,t){if(D0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(D0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nze=function(t){var r=t.x,n=t.y,s=t.xAxis,o=t.yAxis,i=eR({x:s.scale,y:o.scale}),l=i.apply({x:r,y:n},{bandAware:!0});return Wf(t,"discard")&&!i.isInRange(l)?null:l},nA=function(e){function t(){return Y7e(this,t),Q7e(this,t,arguments)}return tze(t,e),J7e(t,[{key:"render",value:function(){var n=this.props,s=n.x,o=n.y,i=n.r,l=n.alwaysShow,c=n.clipPathId,d=Ki(s),u=Ki(o);if(rf(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!d||!u)return null;var f=nze(this.props);if(!f)return null;var h=f.x,m=f.y,x=this.props,g=x.shape,v=x.className,y=Wf(this.props,"hidden")?"url(#".concat(c,")"):void 0,b=lz(lz({clipPath:y},Ra(this.props,!0)),{},{cx:h,cy:m});return Ce.createElement(ks,{className:us("recharts-reference-dot",v)},t.renderDot(g,b),ll.renderCallByParent(this.props,{x:h-i,y:m-i,width:2*i,height:2*i}))}}])}(Ce.Component);rA(nA,"displayName","ReferenceDot");rA(nA,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});rA(nA,"renderDot",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Ja(e)?r=e(t):r=Ce.createElement(hj,FT({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function $T(){return $T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$T.apply(this,arguments)}function M0(e){"@babel/helpers - typeof";return M0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M0(e)}function dz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function uz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dz(Object(r),!0).forEach(function(n){aA(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yee(n.key),n)}}function sze(e,t,r){return t&&fz(e.prototype,t),r&&fz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function oze(e,t,r){return t=FS(t),ize(e,vee()?Reflect.construct(t,r||[],FS(e).constructor):t.apply(e,r))}function ize(e,t){if(t&&(M0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lze(e)}function lze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vee=function(){return!!e})()}function FS(e){return FS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},FS(e)}function cze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BT(e,t)}function BT(e,t){return BT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},BT(e,t)}function aA(e,t,r){return t=yee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yee(e){var t=dze(e,"string");return M0(t)=="symbol"?t:t+""}function dze(e,t){if(M0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(M0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uze=function(t,r,n,s,o){var i=o.x1,l=o.x2,c=o.y1,d=o.y2,u=o.xAxis,f=o.yAxis;if(!u||!f)return null;var h=eR({x:u.scale,y:f.scale}),m={x:t?h.x.apply(i,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(c,{position:"start"}):h.y.rangeMin},x={x:r?h.x.apply(l,{position:"end"}):h.x.rangeMax,y:s?h.y.apply(d,{position:"end"}):h.y.rangeMax};return Wf(o,"discard")&&(!h.isInRange(m)||!h.isInRange(x))?null:see(m,x)},sA=function(e){function t(){return aze(this,t),oze(this,t,arguments)}return cze(t,e),sze(t,[{key:"render",value:function(){var n=this.props,s=n.x1,o=n.x2,i=n.y1,l=n.y2,c=n.className,d=n.alwaysShow,u=n.clipPathId;rf(d===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Ki(s),h=Ki(o),m=Ki(i),x=Ki(l),g=this.props.shape;if(!f&&!h&&!m&&!x&&!g)return null;var v=uze(f,h,m,x,this.props);if(!v&&!g)return null;var y=Wf(this.props,"hidden")?"url(#".concat(u,")"):void 0;return Ce.createElement(ks,{className:us("recharts-reference-area",c)},t.renderRect(g,uz(uz({clipPath:y},Ra(this.props,!0)),v)),ll.renderCallByParent(this.props,v))}}])}(Ce.Component);aA(sA,"displayName","ReferenceArea");aA(sA,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});aA(sA,"renderRect",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Ja(e)?r=e(t):r=Ce.createElement(QM,$T({},t,{className:"recharts-reference-area-rect"})),r});function bee(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],s=0;s<e.length;s+=t)if(r===void 0||r(e[s])===!0)n.push(e[s]);else return;return n}function fze(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return c7e(n,r)}function mze(e,t,r){var n=r==="width",s=e.x,o=e.y,i=e.width,l=e.height;return t===1?{start:n?s:o,end:n?s+i:o+l}:{start:n?s+i:o+l,end:n?s:o}}function LS(e,t,r,n,s){if(e*t<e*n||e*t>e*s)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-s)<=0}function hze(e,t){return bee(e,t+1)}function pze(e,t,r,n,s){for(var o=(n||[]).slice(),i=t.start,l=t.end,c=0,d=1,u=i,f=function(){var x=n?.[c];if(x===void 0)return{v:bee(n,d)};var g=c,v,y=function(){return v===void 0&&(v=r(x,g)),v},b=x.coordinate,w=c===0||LS(e,b,y,u,l);w||(c=0,u=i,d+=1),w&&(u=b+e*(y()/2+s),c+=d)},h;d<=o.length;)if(h=f(),h)return h.v;return[]}function _1(e){"@babel/helpers - typeof";return _1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_1(e)}function mz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ul(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mz(Object(r),!0).forEach(function(n){gze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gze(e,t,r){return t=xze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xze(e){var t=vze(e,"string");return _1(t)=="symbol"?t:t+""}function vze(e,t){if(_1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(_1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yze(e,t,r,n,s){for(var o=(n||[]).slice(),i=o.length,l=t.start,c=t.end,d=function(h){var m=o[h],x,g=function(){return x===void 0&&(x=r(m,h)),x};if(h===i-1){var v=e*(m.coordinate+e*g()/2-c);o[h]=m=Ul(Ul({},m),{},{tickCoord:v>0?m.coordinate-v*e:m.coordinate})}else o[h]=m=Ul(Ul({},m),{},{tickCoord:m.coordinate});var y=LS(e,m.tickCoord,g,l,c);y&&(c=m.tickCoord-e*(g()/2+s),o[h]=Ul(Ul({},m),{},{isShow:!0}))},u=i-1;u>=0;u--)d(u);return o}function bze(e,t,r,n,s,o){var i=(n||[]).slice(),l=i.length,c=t.start,d=t.end;if(o){var u=n[l-1],f=r(u,l-1),h=e*(u.coordinate+e*f/2-d);i[l-1]=u=Ul(Ul({},u),{},{tickCoord:h>0?u.coordinate-h*e:u.coordinate});var m=LS(e,u.tickCoord,function(){return f},c,d);m&&(d=u.tickCoord-e*(f/2+s),i[l-1]=Ul(Ul({},u),{},{isShow:!0}))}for(var x=o?l-1:l,g=function(b){var w=i[b],j,_=function(){return j===void 0&&(j=r(w,b)),j};if(b===0){var C=e*(w.coordinate-e*_()/2-c);i[b]=w=Ul(Ul({},w),{},{tickCoord:C<0?w.coordinate-C*e:w.coordinate})}else i[b]=w=Ul(Ul({},w),{},{tickCoord:w.coordinate});var E=LS(e,w.tickCoord,_,c,d);E&&(c=w.tickCoord+e*(_()/2+s),i[b]=Ul(Ul({},w),{},{isShow:!0}))},v=0;v<x;v++)g(v);return i}function iR(e,t,r){var n=e.tick,s=e.ticks,o=e.viewBox,i=e.minTickGap,l=e.orientation,c=e.interval,d=e.tickFormatter,u=e.unit,f=e.angle;if(!s||!s.length||!n)return[];if(Mn(c)||nf.isSsr)return hze(s,typeof c=="number"&&Mn(c)?c:0);var h=[],m=l==="top"||l==="bottom"?"width":"height",x=u&&m==="width"?Kb(u,{fontSize:t,letterSpacing:r}):{width:0,height:0},g=function(w,j){var _=Ja(d)?d(w.value,j):w.value;return m==="width"?fze(Kb(_,{fontSize:t,letterSpacing:r}),x,f):Kb(_,{fontSize:t,letterSpacing:r})[m]},v=s.length>=2?hc(s[1].coordinate-s[0].coordinate):1,y=mze(o,v,m);return c==="equidistantPreserveStart"?pze(v,y,g,s,i):(c==="preserveStart"||c==="preserveStartEnd"?h=bze(v,y,g,s,i,c==="preserveStartEnd"):h=yze(v,y,g,s,i),h.filter(function(b){return b.isShow}))}var wze=["viewBox"],jze=["viewBox"],_ze=["ticks"];function R0(e){"@babel/helpers - typeof";return R0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R0(e)}function Iv(){return Iv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Iv.apply(this,arguments)}function hz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Bi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hz(Object(r),!0).forEach(function(n){lR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RE(e,t){if(e==null)return{};var r=Nze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Nze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Sze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jee(n.key),n)}}function Cze(e,t,r){return t&&pz(e.prototype,t),r&&pz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Aze(e,t,r){return t=$S(t),Pze(e,wee()?Reflect.construct(t,r||[],$S(e).constructor):t.apply(e,r))}function Pze(e,t){if(t&&(R0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Eze(e)}function Eze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wee=function(){return!!e})()}function $S(e){return $S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},$S(e)}function kze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qT(e,t)}function qT(e,t){return qT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},qT(e,t)}function lR(e,t,r){return t=jee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jee(e){var t=Ize(e,"string");return R0(t)=="symbol"?t:t+""}function Ize(e,t){if(R0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(R0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wy=function(e){function t(r){var n;return Sze(this,t),n=Aze(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return kze(t,e),Cze(t,[{key:"shouldComponentUpdate",value:function(n,s){var o=n.viewBox,i=RE(n,wze),l=this.props,c=l.viewBox,d=RE(l,jze);return!Kv(o,c)||!Kv(i,d)||!Kv(s,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var s=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];s&&this.setState({fontSize:window.getComputedStyle(s).fontSize,letterSpacing:window.getComputedStyle(s).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.x,i=s.y,l=s.width,c=s.height,d=s.orientation,u=s.tickSize,f=s.mirror,h=s.tickMargin,m,x,g,v,y,b,w=f?-1:1,j=n.tickSize||u,_=Mn(n.tickCoord)?n.tickCoord:n.coordinate;switch(d){case"top":m=x=n.coordinate,v=i+ +!f*c,g=v-w*j,b=g-w*h,y=_;break;case"left":g=v=n.coordinate,x=o+ +!f*l,m=x-w*j,y=m-w*h,b=_;break;case"right":g=v=n.coordinate,x=o+ +f*l,m=x+w*j,y=m+w*h,b=_;break;default:m=x=n.coordinate,v=i+ +f*c,g=v+w*j,b=g+w*h,y=_;break}return{line:{x1:m,y1:g,x2:x,y2:v},tick:{x:y,y:b}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,i;switch(s){case"left":i=o?"start":"end";break;case"right":i=o?"end":"start";break;default:i="middle";break}return i}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,i="end";switch(s){case"left":case"right":i="middle";break;case"top":i=o?"start":"end";break;default:i=o?"end":"start";break}return i}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.x,o=n.y,i=n.width,l=n.height,c=n.orientation,d=n.mirror,u=n.axisLine,f=Bi(Bi(Bi({},Ra(this.props,!1)),Ra(u,!1)),{},{fill:"none"});if(c==="top"||c==="bottom"){var h=+(c==="top"&&!d||c==="bottom"&&d);f=Bi(Bi({},f),{},{x1:s,y1:o+h*l,x2:s+i,y2:o+h*l})}else{var m=+(c==="left"&&!d||c==="right"&&d);f=Bi(Bi({},f),{},{x1:s+m*i,y1:o,x2:s+m*i,y2:o+l})}return Ce.createElement("line",Iv({},f,{className:us("recharts-cartesian-axis-line",kd(u,"className"))}))}},{key:"renderTicks",value:function(n,s,o){var i=this,l=this.props,c=l.tickLine,d=l.stroke,u=l.tick,f=l.tickFormatter,h=l.unit,m=iR(Bi(Bi({},this.props),{},{ticks:n}),s,o),x=this.getTickTextAnchor(),g=this.getTickVerticalAnchor(),v=Ra(this.props,!1),y=Ra(u,!1),b=Bi(Bi({},v),{},{fill:"none"},Ra(c,!1)),w=m.map(function(j,_){var C=i.getTickLineCoord(j),E=C.line,S=C.tick,A=Bi(Bi(Bi(Bi({textAnchor:x,verticalAnchor:g},v),{},{stroke:"none",fill:d},y),S),{},{index:_,payload:j,visibleTicksCount:m.length,tickFormatter:f});return Ce.createElement(ks,Iv({className:"recharts-cartesian-axis-tick",key:"tick-".concat(j.value,"-").concat(j.coordinate,"-").concat(j.tickCoord)},ex(i.props,j,_)),c&&Ce.createElement("line",Iv({},b,E,{className:us("recharts-cartesian-axis-tick-line",kd(c,"className"))})),u&&t.renderTickItem(u,A,"".concat(Ja(f)?f(j.value,_):j.value).concat(h||"")))});return Ce.createElement("g",{className:"recharts-cartesian-axis-ticks"},w)}},{key:"render",value:function(){var n=this,s=this.props,o=s.axisLine,i=s.width,l=s.height,c=s.ticksGenerator,d=s.className,u=s.hide;if(u)return null;var f=this.props,h=f.ticks,m=RE(f,_ze),x=h;return Ja(c)&&(x=h&&h.length>0?c(this.props):c(m)),i<=0||l<=0||!x||!x.length?null:Ce.createElement(ks,{className:us("recharts-cartesian-axis",d),ref:function(v){n.layerReference=v}},o&&this.renderAxisLine(),this.renderTicks(x,this.state.fontSize,this.state.letterSpacing),ll.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,s,o){var i,l=us(s.className,"recharts-cartesian-axis-tick-value");return Ce.isValidElement(n)?i=Ce.cloneElement(n,Bi(Bi({},s),{},{className:l})):Ja(n)?i=n(Bi(Bi({},s),{},{className:l})):i=Ce.createElement(tx,Iv({},s,{className:"recharts-cartesian-axis-tick-value"}),o),i}}])}(p.Component);lR(wy,"displayName","CartesianAxis");lR(wy,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Oze=["x1","y1","x2","y2","key"],Tze=["offset"];function ax(e){"@babel/helpers - typeof";return ax=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ax(e)}function gz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Hl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gz(Object(r),!0).forEach(function(n){Dze(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Dze(e,t,r){return t=Mze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mze(e){var t=Rze(e,"string");return ax(t)=="symbol"?t:t+""}function Rze(e,t){if(ax(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ax(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wg(){return wg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wg.apply(this,arguments)}function xz(e,t){if(e==null)return{};var r=Fze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Fze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Lze=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,s=t.x,o=t.y,i=t.width,l=t.height,c=t.ry;return Ce.createElement("rect",{x:s,y:o,ry:c,width:i,height:l,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function _ee(e,t){var r;if(Ce.isValidElement(e))r=Ce.cloneElement(e,t);else if(Ja(e))r=e(t);else{var n=t.x1,s=t.y1,o=t.x2,i=t.y2,l=t.key,c=xz(t,Oze),d=Ra(c,!1);d.offset;var u=xz(d,Tze);r=Ce.createElement("line",wg({},u,{x1:n,y1:s,x2:o,y2:i,fill:"none",key:l}))}return r}function $ze(e){var t=e.x,r=e.width,n=e.horizontal,s=n===void 0?!0:n,o=e.horizontalPoints;if(!s||!o||!o.length)return null;var i=o.map(function(l,c){var d=Hl(Hl({},e),{},{x1:t,y1:l,x2:t+r,y2:l,key:"line-".concat(c),index:c});return _ee(s,d)});return Ce.createElement("g",{className:"recharts-cartesian-grid-horizontal"},i)}function Bze(e){var t=e.y,r=e.height,n=e.vertical,s=n===void 0?!0:n,o=e.verticalPoints;if(!s||!o||!o.length)return null;var i=o.map(function(l,c){var d=Hl(Hl({},e),{},{x1:l,y1:t,x2:l,y2:t+r,key:"line-".concat(c),index:c});return _ee(s,d)});return Ce.createElement("g",{className:"recharts-cartesian-grid-vertical"},i)}function qze(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,s=e.y,o=e.width,i=e.height,l=e.horizontalPoints,c=e.horizontal,d=c===void 0?!0:c;if(!d||!t||!t.length)return null;var u=l.map(function(h){return Math.round(h+s-s)}).sort(function(h,m){return h-m});s!==u[0]&&u.unshift(0);var f=u.map(function(h,m){var x=!u[m+1],g=x?s+i-h:u[m+1]-h;if(g<=0)return null;var v=m%t.length;return Ce.createElement("rect",{key:"react-".concat(m),y:h,x:n,height:g,width:o,stroke:"none",fill:t[v],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function zze(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,s=e.fillOpacity,o=e.x,i=e.y,l=e.width,c=e.height,d=e.verticalPoints;if(!r||!n||!n.length)return null;var u=d.map(function(h){return Math.round(h+o-o)}).sort(function(h,m){return h-m});o!==u[0]&&u.unshift(0);var f=u.map(function(h,m){var x=!u[m+1],g=x?o+l-h:u[m+1]-h;if(g<=0)return null;var v=m%n.length;return Ce.createElement("rect",{key:"react-".concat(m),x:h,y:i,width:g,height:c,stroke:"none",fill:n[v],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var Uze=function(t,r){var n=t.xAxis,s=t.width,o=t.height,i=t.offset;return bZ(iR(Hl(Hl(Hl({},wy.defaultProps),n),{},{ticks:Cm(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),i.left,i.left+i.width,r)},Vze=function(t,r){var n=t.yAxis,s=t.width,o=t.height,i=t.offset;return bZ(iR(Hl(Hl(Hl({},wy.defaultProps),n),{},{ticks:Cm(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),i.top,i.top+i.height,r)},Vx={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function BS(e){var t,r,n,s,o,i,l=nR(),c=aR(),d=D7e(),u=Hl(Hl({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Vx.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:Vx.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:Vx.horizontal,horizontalFill:(s=e.horizontalFill)!==null&&s!==void 0?s:Vx.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:Vx.vertical,verticalFill:(i=e.verticalFill)!==null&&i!==void 0?i:Vx.verticalFill,x:Mn(e.x)?e.x:d.left,y:Mn(e.y)?e.y:d.top,width:Mn(e.width)?e.width:d.width,height:Mn(e.height)?e.height:d.height}),f=u.x,h=u.y,m=u.width,x=u.height,g=u.syncWithTicks,v=u.horizontalValues,y=u.verticalValues,b=I7e(),w=O7e();if(!Mn(m)||m<=0||!Mn(x)||x<=0||!Mn(f)||f!==+f||!Mn(h)||h!==+h)return null;var j=u.verticalCoordinatesGenerator||Uze,_=u.horizontalCoordinatesGenerator||Vze,C=u.horizontalPoints,E=u.verticalPoints;if((!C||!C.length)&&Ja(_)){var S=v&&v.length,A=_({yAxis:w?Hl(Hl({},w),{},{ticks:S?v:w.ticks}):void 0,width:l,height:c,offset:d},S?!0:g);rf(Array.isArray(A),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(ax(A),"]")),Array.isArray(A)&&(C=A)}if((!E||!E.length)&&Ja(j)){var M=y&&y.length,O=j({xAxis:b?Hl(Hl({},b),{},{ticks:M?y:b.ticks}):void 0,width:l,height:c,offset:d},M?!0:g);rf(Array.isArray(O),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(ax(O),"]")),Array.isArray(O)&&(E=O)}return Ce.createElement("g",{className:"recharts-cartesian-grid"},Ce.createElement(Lze,{fill:u.fill,fillOpacity:u.fillOpacity,x:u.x,y:u.y,width:u.width,height:u.height,ry:u.ry}),Ce.createElement($ze,wg({},u,{offset:d,horizontalPoints:C,xAxis:b,yAxis:w})),Ce.createElement(Bze,wg({},u,{offset:d,verticalPoints:E,xAxis:b,yAxis:w})),Ce.createElement(qze,wg({},u,{horizontalPoints:C})),Ce.createElement(zze,wg({},u,{verticalPoints:E})))}BS.displayName="CartesianGrid";var Wze=["type","layout","connectNulls","ref"],Hze=["key"];function F0(e){"@babel/helpers - typeof";return F0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F0(e)}function vz(e,t){if(e==null)return{};var r=Gze(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Gze(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function ew(){return ew=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ew.apply(this,arguments)}function yz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ud(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yz(Object(r),!0).forEach(function(n){Wu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wx(e){return Jze(e)||Yze(e)||Xze(e)||Kze()}function Kze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xze(e,t){if(e){if(typeof e=="string")return zT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zT(e,t)}}function Yze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Jze(e){if(Array.isArray(e))return zT(e)}function zT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Qze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,See(n.key),n)}}function Zze(e,t,r){return t&&bz(e.prototype,t),r&&bz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function e9e(e,t,r){return t=qS(t),t9e(e,Nee()?Reflect.construct(t,r||[],qS(e).constructor):t.apply(e,r))}function t9e(e,t){if(t&&(F0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return r9e(e)}function r9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Nee=function(){return!!e})()}function qS(e){return qS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qS(e)}function n9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UT(e,t)}function UT(e,t){return UT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},UT(e,t)}function Wu(e,t,r){return t=See(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function See(e){var t=a9e(e,"string");return F0(t)=="symbol"?t:t+""}function a9e(e,t){if(F0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(F0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var jy=function(e){function t(){var r;Qze(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=e9e(this,t,[].concat(s)),Wu(r,"state",{isAnimationFinished:!0,totalLength:0}),Wu(r,"generateSimpleStrokeDasharray",function(i,l){return"".concat(l,"px ").concat(i-l,"px")}),Wu(r,"getStrokeDasharray",function(i,l,c){var d=c.reduce(function(y,b){return y+b});if(!d)return r.generateSimpleStrokeDasharray(l,i);for(var u=Math.floor(i/d),f=i%d,h=l-i,m=[],x=0,g=0;x<c.length;g+=c[x],++x)if(g+c[x]>f){m=[].concat(Wx(c.slice(0,x)),[f-g]);break}var v=m.length%2===0?[0,h]:[h];return[].concat(Wx(t.repeat(c,u)),Wx(m),v).map(function(y){return"".concat(y,"px")}).join(", ")}),Wu(r,"id",yx("recharts-line-")),Wu(r,"pathRef",function(i){r.mainCurve=i}),Wu(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Wu(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return n9e(t,e),Zze(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.points,l=o.xAxis,c=o.yAxis,d=o.layout,u=o.children,f=Id(u,mj);if(!f)return null;var h=function(g,v){return{x:g.x,y:g.y,value:g.value,errorVal:ji(g.payload,v)}},m={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ce.createElement(ks,m,f.map(function(x){return Ce.cloneElement(x,{key:"bar-".concat(x.props.dataKey),data:i,xAxis:l,yAxis:c,layout:d,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,s,o){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.dot,d=l.points,u=l.dataKey,f=Ra(this.props,!1),h=Ra(c,!0),m=d.map(function(g,v){var y=ud(ud(ud({key:"dot-".concat(v),r:3},f),h),{},{index:v,cx:g.x,cy:g.y,value:g.value,dataKey:u,payload:g.payload,points:d});return t.renderDotItem(c,y)}),x={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ce.createElement(ks,ew({className:"recharts-line-dots",key:"dots"},x),m)}},{key:"renderCurveStatically",value:function(n,s,o,i){var l=this.props,c=l.type,d=l.layout,u=l.connectNulls;l.ref;var f=vz(l,Wze),h=ud(ud(ud({},Ra(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(o,")"):null,points:n},i),{},{type:c,layout:d,connectNulls:u});return Ce.createElement(Rg,ew({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,s){var o=this,i=this.props,l=i.points,c=i.strokeDasharray,d=i.isAnimationActive,u=i.animationBegin,f=i.animationDuration,h=i.animationEasing,m=i.animationId,x=i.animateNewValues,g=i.width,v=i.height,y=this.state,b=y.prevPoints,w=y.totalLength;return Ce.createElement(yp,{begin:u,duration:f,isActive:d,easing:h,from:{t:0},to:{t:1},key:"line-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(j){var _=j.t;if(b){var C=b.length/l.length,E=l.map(function(I,T){var k=Math.floor(T*C);if(b[k]){var q=b[k],B=Hi(q.x,I.x),z=Hi(q.y,I.y);return ud(ud({},I),{},{x:B(_),y:z(_)})}if(x){var F=Hi(g*2,I.x),V=Hi(v/2,I.y);return ud(ud({},I),{},{x:F(_),y:V(_)})}return ud(ud({},I),{},{x:I.x,y:I.y})});return o.renderCurveStatically(E,n,s)}var S=Hi(0,w),A=S(_),M;if(c){var O="".concat(c).split(/[,\s]+/gim).map(function(I){return parseFloat(I)});M=o.getStrokeDasharray(A,w,O)}else M=o.generateSimpleStrokeDasharray(w,A);return o.renderCurveStatically(l,n,s,{strokeDasharray:M})})}},{key:"renderCurve",value:function(n,s){var o=this.props,i=o.points,l=o.isAnimationActive,c=this.state,d=c.prevPoints,u=c.totalLength;return l&&i&&i.length&&(!d&&u>0||!rx(d,i))?this.renderCurveWithAnimation(n,s):this.renderCurveStatically(i,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,i=s.dot,l=s.points,c=s.className,d=s.xAxis,u=s.yAxis,f=s.top,h=s.left,m=s.width,x=s.height,g=s.isAnimationActive,v=s.id;if(o||!l||!l.length)return null;var y=this.state.isAnimationFinished,b=l.length===1,w=us("recharts-line",c),j=d&&d.allowDataOverflow,_=u&&u.allowDataOverflow,C=j||_,E=ls(v)?this.id:v,S=(n=Ra(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},A=S.r,M=A===void 0?3:A,O=S.strokeWidth,I=O===void 0?2:O,T=fJ(i)?i:{},k=T.clipDot,q=k===void 0?!0:k,B=M*2+I;return Ce.createElement(ks,{className:w},j||_?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(E)},Ce.createElement("rect",{x:j?h:h-m/2,y:_?f:f-x/2,width:j?m:m*2,height:_?x:x*2})),!q&&Ce.createElement("clipPath",{id:"clipPath-dots-".concat(E)},Ce.createElement("rect",{x:h-B/2,y:f-B/2,width:m+B,height:x+B}))):null,!b&&this.renderCurve(C,E),this.renderErrorBar(C,E),(b||i)&&this.renderDots(C,q,E),(!g||y)&&Vf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:s.curPoints}:n.points!==s.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,s){for(var o=n.length%2!==0?[].concat(Wx(n),[0]):n,i=[],l=0;l<s;++l)i=[].concat(Wx(i),Wx(o));return i}},{key:"renderDotItem",value:function(n,s){var o;if(Ce.isValidElement(n))o=Ce.cloneElement(n,s);else if(Ja(n))o=n(s);else{var i=s.key,l=vz(s,Hze),c=us("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ce.createElement(hj,ew({key:i},l,{className:c}))}return o}}])}(p.PureComponent);Wu(jy,"displayName","Line");Wu(jy,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!nf.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Wu(jy,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,s=e.xAxisTicks,o=e.yAxisTicks,i=e.dataKey,l=e.bandSize,c=e.displayedData,d=e.offset,u=t.layout,f=c.map(function(h,m){var x=ji(h,i);return u==="horizontal"?{x:gS({axis:r,ticks:s,bandSize:l,entry:h,index:m}),y:ls(x)?null:n.scale(x),value:x,payload:h}:{x:ls(x)?null:r.scale(x),y:gS({axis:n,ticks:o,bandSize:l,entry:h,index:m}),value:x,payload:h}});return ud({points:f,layout:u},d)});var s9e=["layout","type","stroke","connectNulls","isRange","ref"],o9e=["key"],Cee;function L0(e){"@babel/helpers - typeof";return L0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L0(e)}function Aee(e,t){if(e==null)return{};var r=i9e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function i9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function jg(){return jg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jg.apply(this,arguments)}function wz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function xh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wz(Object(r),!0).forEach(function(n){Df(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Eee(n.key),n)}}function c9e(e,t,r){return t&&jz(e.prototype,t),r&&jz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d9e(e,t,r){return t=zS(t),u9e(e,Pee()?Reflect.construct(t,r||[],zS(e).constructor):t.apply(e,r))}function u9e(e,t){if(t&&(L0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return f9e(e)}function f9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Pee=function(){return!!e})()}function zS(e){return zS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zS(e)}function m9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&VT(e,t)}function VT(e,t){return VT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},VT(e,t)}function Df(e,t,r){return t=Eee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Eee(e){var t=h9e(e,"string");return L0(t)=="symbol"?t:t+""}function h9e(e,t){if(L0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(L0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Mp=function(e){function t(){var r;l9e(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=d9e(this,t,[].concat(s)),Df(r,"state",{isAnimationFinished:!0}),Df(r,"id",yx("recharts-area-")),Df(r,"handleAnimationEnd",function(){var i=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),Ja(i)&&i()}),Df(r,"handleAnimationStart",function(){var i=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),Ja(i)&&i()}),r}return m9e(t,e),c9e(t,[{key:"renderDots",value:function(n,s,o){var i=this.props.isAnimationActive,l=this.state.isAnimationFinished;if(i&&!l)return null;var c=this.props,d=c.dot,u=c.points,f=c.dataKey,h=Ra(this.props,!1),m=Ra(d,!0),x=u.map(function(v,y){var b=xh(xh(xh({key:"dot-".concat(y),r:3},h),m),{},{index:y,cx:v.x,cy:v.y,dataKey:f,value:v.value,payload:v.payload,points:u});return t.renderDotItem(d,b)}),g={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ce.createElement(ks,jg({className:"recharts-area-dots"},g),x)}},{key:"renderHorizontalRect",value:function(n){var s=this.props,o=s.baseLine,i=s.points,l=s.strokeWidth,c=i[0].x,d=i[i.length-1].x,u=n*Math.abs(c-d),f=Mh(i.map(function(h){return h.y||0}));return Mn(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(Mh(o.map(function(h){return h.y||0})),f)),Mn(f)?Ce.createElement("rect",{x:c<d?c:c-u,y:0,width:u,height:Math.floor(f+(l?parseInt("".concat(l),10):1))}):null}},{key:"renderVerticalRect",value:function(n){var s=this.props,o=s.baseLine,i=s.points,l=s.strokeWidth,c=i[0].y,d=i[i.length-1].y,u=n*Math.abs(c-d),f=Mh(i.map(function(h){return h.x||0}));return Mn(o)&&typeof o=="number"?f=Math.max(o,f):o&&Array.isArray(o)&&o.length&&(f=Math.max(Mh(o.map(function(h){return h.x||0})),f)),Mn(f)?Ce.createElement("rect",{x:0,y:c<d?c:c-u,width:f+(l?parseInt("".concat(l),10):1),height:Math.floor(u)}):null}},{key:"renderClipRect",value:function(n){var s=this.props.layout;return s==="vertical"?this.renderVerticalRect(n):this.renderHorizontalRect(n)}},{key:"renderAreaStatically",value:function(n,s,o,i){var l=this.props,c=l.layout,d=l.type,u=l.stroke,f=l.connectNulls,h=l.isRange;l.ref;var m=Aee(l,s9e);return Ce.createElement(ks,{clipPath:o?"url(#clipPath-".concat(i,")"):null},Ce.createElement(Rg,jg({},Ra(m,!0),{points:n,connectNulls:f,type:d,baseLine:s,layout:c,stroke:"none",className:"recharts-area-area"})),u!=="none"&&Ce.createElement(Rg,jg({},Ra(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:n})),u!=="none"&&h&&Ce.createElement(Rg,jg({},Ra(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:f,fill:"none",points:s})))}},{key:"renderAreaWithAnimation",value:function(n,s){var o=this,i=this.props,l=i.points,c=i.baseLine,d=i.isAnimationActive,u=i.animationBegin,f=i.animationDuration,h=i.animationEasing,m=i.animationId,x=this.state,g=x.prevPoints,v=x.prevBaseLine;return Ce.createElement(yp,{begin:u,duration:f,isActive:d,easing:h,from:{t:0},to:{t:1},key:"area-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(y){var b=y.t;if(g){var w=g.length/l.length,j=l.map(function(S,A){var M=Math.floor(A*w);if(g[M]){var O=g[M],I=Hi(O.x,S.x),T=Hi(O.y,S.y);return xh(xh({},S),{},{x:I(b),y:T(b)})}return S}),_;if(Mn(c)&&typeof c=="number"){var C=Hi(v,c);_=C(b)}else if(ls(c)||hy(c)){var E=Hi(v,0);_=E(b)}else _=c.map(function(S,A){var M=Math.floor(A*w);if(v[M]){var O=v[M],I=Hi(O.x,S.x),T=Hi(O.y,S.y);return xh(xh({},S),{},{x:I(b),y:T(b)})}return S});return o.renderAreaStatically(j,_,n,s)}return Ce.createElement(ks,null,Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"animationClipPath-".concat(s)},o.renderClipRect(b))),Ce.createElement(ks,{clipPath:"url(#animationClipPath-".concat(s,")")},o.renderAreaStatically(l,c,n,s)))})}},{key:"renderArea",value:function(n,s){var o=this.props,i=o.points,l=o.baseLine,c=o.isAnimationActive,d=this.state,u=d.prevPoints,f=d.prevBaseLine,h=d.totalLength;return c&&i&&i.length&&(!u&&h>0||!rx(u,i)||!rx(f,l))?this.renderAreaWithAnimation(n,s):this.renderAreaStatically(i,l,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,i=s.dot,l=s.points,c=s.className,d=s.top,u=s.left,f=s.xAxis,h=s.yAxis,m=s.width,x=s.height,g=s.isAnimationActive,v=s.id;if(o||!l||!l.length)return null;var y=this.state.isAnimationFinished,b=l.length===1,w=us("recharts-area",c),j=f&&f.allowDataOverflow,_=h&&h.allowDataOverflow,C=j||_,E=ls(v)?this.id:v,S=(n=Ra(i,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},A=S.r,M=A===void 0?3:A,O=S.strokeWidth,I=O===void 0?2:O,T=fJ(i)?i:{},k=T.clipDot,q=k===void 0?!0:k,B=M*2+I;return Ce.createElement(ks,{className:w},j||_?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(E)},Ce.createElement("rect",{x:j?u:u-m/2,y:_?d:d-x/2,width:j?m:m*2,height:_?x:x*2})),!q&&Ce.createElement("clipPath",{id:"clipPath-dots-".concat(E)},Ce.createElement("rect",{x:u-B/2,y:d-B/2,width:m+B,height:x+B}))):null,b?null:this.renderArea(C,E),(i||b)&&this.renderDots(C,q,E),(!g||y)&&Vf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,curBaseLine:n.baseLine,prevPoints:s.curPoints,prevBaseLine:s.curBaseLine}:n.points!==s.curPoints||n.baseLine!==s.curBaseLine?{curPoints:n.points,curBaseLine:n.baseLine}:null}}])}(p.PureComponent);Cee=Mp;Df(Mp,"displayName","Area");Df(Mp,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!nf.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Df(Mp,"getBaseValue",function(e,t,r,n){var s=e.layout,o=e.baseValue,i=t.props.baseValue,l=i??o;if(Mn(l)&&typeof l=="number")return l;var c=s==="horizontal"?n:r,d=c.scale.domain();if(c.type==="number"){var u=Math.max(d[0],d[1]),f=Math.min(d[0],d[1]);return l==="dataMin"?f:l==="dataMax"||u<0?u:Math.max(Math.min(d[0],d[1]),0)}return l==="dataMin"?d[0]:l==="dataMax"?d[1]:d[0]});Df(Mp,"getComposedData",function(e){var t=e.props,r=e.item,n=e.xAxis,s=e.yAxis,o=e.xAxisTicks,i=e.yAxisTicks,l=e.bandSize,c=e.dataKey,d=e.stackedData,u=e.dataStartIndex,f=e.displayedData,h=e.offset,m=t.layout,x=d&&d.length,g=Cee.getBaseValue(t,r,n,s),v=m==="horizontal",y=!1,b=f.map(function(j,_){var C;x?C=d[u+_]:(C=ji(j,c),Array.isArray(C)?y=!0:C=[g,C]);var E=C[1]==null||x&&ji(j,c)==null;return v?{x:gS({axis:n,ticks:o,bandSize:l,entry:j,index:_}),y:E?null:s.scale(C[1]),value:C,payload:j}:{x:E?null:n.scale(C[1]),y:gS({axis:s,ticks:i,bandSize:l,entry:j,index:_}),value:C,payload:j}}),w;return x||y?w=b.map(function(j){var _=Array.isArray(j.value)?j.value[0]:null;return v?{x:j.x,y:_!=null&&j.y!=null?s.scale(_):null}:{x:_!=null?n.scale(_):null,y:j.y}}):w=v?s.scale(g):n.scale(g),xh({points:b,baseLine:w,layout:m,isRange:y},h)});Df(Mp,"renderDotItem",function(e,t){var r;if(Ce.isValidElement(e))r=Ce.cloneElement(e,t);else if(Ja(e))r=e(t);else{var n=us("recharts-area-dot",typeof e!="boolean"?e.className:""),s=t.key,o=Aee(t,o9e);r=Ce.createElement(hj,jg({},o,{key:s,className:n}))}return r});function $0(e){"@babel/helpers - typeof";return $0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$0(e)}function p9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Oee(n.key),n)}}function g9e(e,t,r){return t&&_z(e.prototype,t),r&&_z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function x9e(e,t,r){return t=US(t),v9e(e,kee()?Reflect.construct(t,r||[],US(e).constructor):t.apply(e,r))}function v9e(e,t){if(t&&($0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y9e(e)}function y9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kee=function(){return!!e})()}function US(e){return US=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},US(e)}function b9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WT(e,t)}function WT(e,t){return WT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},WT(e,t)}function Iee(e,t,r){return t=Oee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Oee(e){var t=w9e(e,"string");return $0(t)=="symbol"?t:t+""}function w9e(e,t){if($0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HT(){return HT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HT.apply(this,arguments)}function j9e(e){var t=e.xAxisId,r=nR(),n=aR(),s=fee(t);return s==null?null:p.createElement(wy,HT({},s,{className:us("recharts-".concat(s.axisType," ").concat(s.axisType),s.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(i){return Cm(i,!0)}}))}var bp=function(e){function t(){return p9e(this,t),x9e(this,t,arguments)}return b9e(t,e),g9e(t,[{key:"render",value:function(){return p.createElement(j9e,this.props)}}])}(p.Component);Iee(bp,"displayName","XAxis");Iee(bp,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function B0(e){"@babel/helpers - typeof";return B0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B0(e)}function _9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Mee(n.key),n)}}function N9e(e,t,r){return t&&Nz(e.prototype,t),r&&Nz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function S9e(e,t,r){return t=VS(t),C9e(e,Tee()?Reflect.construct(t,r||[],VS(e).constructor):t.apply(e,r))}function C9e(e,t){if(t&&(B0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return A9e(e)}function A9e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Tee=function(){return!!e})()}function VS(e){return VS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},VS(e)}function P9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GT(e,t)}function GT(e,t){return GT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},GT(e,t)}function Dee(e,t,r){return t=Mee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mee(e){var t=E9e(e,"string");return B0(t)=="symbol"?t:t+""}function E9e(e,t){if(B0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(B0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KT(){return KT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KT.apply(this,arguments)}var k9e=function(t){var r=t.yAxisId,n=nR(),s=aR(),o=mee(r);return o==null?null:p.createElement(wy,KT({},o,{className:us("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:s},ticksGenerator:function(l){return Cm(l,!0)}}))},wp=function(e){function t(){return _9e(this,t),S9e(this,t,arguments)}return P9e(t,e),N9e(t,[{key:"render",value:function(){return p.createElement(k9e,this.props)}}])}(p.Component);Dee(wp,"displayName","YAxis");Dee(wp,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function Sz(e){return D9e(e)||T9e(e)||O9e(e)||I9e()}function I9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function O9e(e,t){if(e){if(typeof e=="string")return XT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return XT(e,t)}}function T9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function D9e(e){if(Array.isArray(e))return XT(e)}function XT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var YT=function(t,r,n,s,o){var i=Id(t,oR),l=Id(t,nA),c=[].concat(Sz(i),Sz(l)),d=Id(t,sA),u="".concat(s,"Id"),f=s[0],h=r;if(c.length&&(h=c.reduce(function(g,v){if(v.props[u]===n&&Wf(v.props,"extendDomain")&&Mn(v.props[f])){var y=v.props[f];return[Math.min(g[0],y),Math.max(g[1],y)]}return g},h)),d.length){var m="".concat(f,"1"),x="".concat(f,"2");h=d.reduce(function(g,v){if(v.props[u]===n&&Wf(v.props,"extendDomain")&&Mn(v.props[m])&&Mn(v.props[x])){var y=v.props[m],b=v.props[x];return[Math.min(g[0],y,b),Math.max(g[1],y,b)]}return g},h)}return o&&o.length&&(h=o.reduce(function(g,v){return Mn(v)?[Math.min(g[0],v),Math.max(g[1],v)]:g},h)),h},Ree={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function s(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function o(c,d,u,f,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new s(u,f||c,h),x=r?r+d:d;return c._events[x]?c._events[x].fn?c._events[x]=[c._events[x],m]:c._events[x].push(m):(c._events[x]=m,c._eventsCount++),c}function i(c,d){--c._eventsCount===0?c._events=new n:delete c._events[d]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],u,f;if(this._eventsCount===0)return d;for(f in u=this._events)t.call(u,f)&&d.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},l.prototype.listeners=function(d){var u=r?r+d:d,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,m=f.length,x=new Array(m);h<m;h++)x[h]=f[h].fn;return x},l.prototype.listenerCount=function(d){var u=r?r+d:d,f=this._events[u];return f?f.fn?1:f.length:0},l.prototype.emit=function(d,u,f,h,m,x){var g=r?r+d:d;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,b,w;if(v.fn){switch(v.once&&this.removeListener(d,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,f),!0;case 4:return v.fn.call(v.context,u,f,h),!0;case 5:return v.fn.call(v.context,u,f,h,m),!0;case 6:return v.fn.call(v.context,u,f,h,m,x),!0}for(w=1,b=new Array(y-1);w<y;w++)b[w-1]=arguments[w];v.fn.apply(v.context,b)}else{var j=v.length,_;for(w=0;w<j;w++)switch(v[w].once&&this.removeListener(d,v[w].fn,void 0,!0),y){case 1:v[w].fn.call(v[w].context);break;case 2:v[w].fn.call(v[w].context,u);break;case 3:v[w].fn.call(v[w].context,u,f);break;case 4:v[w].fn.call(v[w].context,u,f,h);break;default:if(!b)for(_=1,b=new Array(y-1);_<y;_++)b[_-1]=arguments[_];v[w].fn.apply(v[w].context,b)}}return!0},l.prototype.on=function(d,u,f){return o(this,d,u,f,!1)},l.prototype.once=function(d,u,f){return o(this,d,u,f,!0)},l.prototype.removeListener=function(d,u,f,h){var m=r?r+d:d;if(!this._events[m])return this;if(!u)return i(this,m),this;var x=this._events[m];if(x.fn)x.fn===u&&(!h||x.once)&&(!f||x.context===f)&&i(this,m);else{for(var g=0,v=[],y=x.length;g<y;g++)(x[g].fn!==u||h&&!x[g].once||f&&x[g].context!==f)&&v.push(x[g]);v.length?this._events[m]=v.length===1?v[0]:v:i(this,m)}return this},l.prototype.removeAllListeners=function(d){var u;return d?(u=r?r+d:d,this._events[u]&&i(this,u)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l})(Ree);var M9e=Ree.exports;const R9e=Us(M9e);var FE=new R9e,LE="recharts.syncMouseEvents";function N1(e){"@babel/helpers - typeof";return N1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N1(e)}function F9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Fee(n.key),n)}}function L9e(e,t,r){return t&&Cz(e.prototype,t),r&&Cz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function $E(e,t,r){return t=Fee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fee(e){var t=$9e(e,"string");return N1(t)=="symbol"?t:t+""}function $9e(e,t){if(N1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(N1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var B9e=function(){function e(){F9e(this,e),$E(this,"activeIndex",0),$E(this,"coordinateList",[]),$E(this,"layout","horizontal")}return L9e(e,[{key:"setDetails",value:function(r){var n,s=r.coordinateList,o=s===void 0?null:s,i=r.container,l=i===void 0?null:i,c=r.layout,d=c===void 0?null:c,u=r.offset,f=u===void 0?null:u,h=r.mouseHandlerCallback,m=h===void 0?null:h;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=l??this.container,this.layout=d??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=m??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var s=this.container.getBoundingClientRect(),o=s.x,i=s.y,l=s.height,c=this.coordinateList[this.activeIndex].coordinate,d=((r=window)===null||r===void 0?void 0:r.scrollX)||0,u=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=o+c+d,h=i+this.offset.top+l/2+u;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function q9e(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],s=e?.[1];if(n&&s&&Mn(n)&&Mn(s))return!0}return!1}function z9e(e,t,r,n){var s=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-s:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-s,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function Lee(e){var t=e.cx,r=e.cy,n=e.radius,s=e.startAngle,o=e.endAngle,i=To(t,r,n,s),l=To(t,r,n,o);return{points:[i,l],cx:t,cy:r,radius:n,startAngle:s,endAngle:o}}function U9e(e,t,r){var n,s,o,i;if(e==="horizontal")n=t.x,o=n,s=r.top,i=r.top+r.height;else if(e==="vertical")s=t.y,i=s,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var l=t.cx,c=t.cy,d=t.innerRadius,u=t.outerRadius,f=t.angle,h=To(l,c,d,f),m=To(l,c,u,f);n=h.x,s=h.y,o=m.x,i=m.y}else return Lee(t);return[{x:n,y:s},{x:o,y:i}]}function S1(e){"@babel/helpers - typeof";return S1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S1(e)}function Az(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function z_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Az(Object(r),!0).forEach(function(n){V9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Az(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function V9e(e,t,r){return t=W9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W9e(e){var t=H9e(e,"string");return S1(t)=="symbol"?t:t+""}function H9e(e,t){if(S1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(S1(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function G9e(e){var t,r,n=e.element,s=e.tooltipEventType,o=e.isActive,i=e.activeCoordinate,l=e.activePayload,c=e.offset,d=e.activeTooltipIndex,u=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,m=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!m||!o||!i||h!=="ScatterChart"&&s!=="axis")return null;var x,g=Rg;if(h==="ScatterChart")x=i,g=i8e;else if(h==="BarChart")x=z9e(f,i,c,u),g=QM;else if(f==="radial"){var v=Lee(i),y=v.cx,b=v.cy,w=v.radius,j=v.startAngle,_=v.endAngle;x={cx:y,cy:b,startAngle:j,endAngle:_,innerRadius:w,outerRadius:w},g=JM}else x={points:U9e(f,i,c)},g=Rg;var C=z_(z_(z_(z_({stroke:"#ccc",pointerEvents:"none"},c),x),Ra(m,!1)),{},{payload:l,payloadIndex:d,className:us("recharts-tooltip-cursor",m.className)});return p.isValidElement(m)?p.cloneElement(m,C):p.createElement(g,C)}var K9e=["item"],X9e=["children","className","width","height","style","compact","title","desc"];function q0(e){"@babel/helpers - typeof";return q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q0(e)}function Ov(){return Ov=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ov.apply(this,arguments)}function Pz(e,t){return Q9e(e)||J9e(e,t)||Bee(e,t)||Y9e()}function Y9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function J9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function Q9e(e){if(Array.isArray(e))return e}function Ez(e,t){if(e==null)return{};var r=Z9e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Z9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function eUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kz(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qee(n.key),n)}}function tUe(e,t,r){return t&&kz(e.prototype,t),r&&kz(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function rUe(e,t,r){return t=WS(t),nUe(e,$ee()?Reflect.construct(t,r||[],WS(e).constructor):t.apply(e,r))}function nUe(e,t){if(t&&(q0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aUe(e)}function aUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($ee=function(){return!!e})()}function WS(e){return WS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},WS(e)}function sUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JT(e,t)}function JT(e,t){return JT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},JT(e,t)}function z0(e){return lUe(e)||iUe(e)||Bee(e)||oUe()}function oUe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bee(e,t){if(e){if(typeof e=="string")return QT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return QT(e,t)}}function iUe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lUe(e){if(Array.isArray(e))return QT(e)}function QT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Jr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Iz(Object(r),!0).forEach(function(n){Xa(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iz(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xa(e,t,r){return t=qee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qee(e){var t=cUe(e,"string");return q0(t)=="symbol"?t:t+""}function cUe(e,t){if(q0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(q0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var dUe={xAxis:["bottom","top"],yAxis:["left","right"]},uUe={width:"100%",height:"100%"},zee={x:0,y:0};function U_(e){return e}var fUe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},mUe=function(t,r,n,s){var o=r.find(function(u){return u&&u.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:s.y};if(t==="vertical")return{x:s.x,y:o.coordinate};if(t==="centric"){var i=o.coordinate,l=s.radius;return Jr(Jr(Jr({},s),To(s.cx,s.cy,l,i)),{},{angle:i,radius:l})}var c=o.coordinate,d=s.angle;return Jr(Jr(Jr({},s),To(s.cx,s.cy,c,d)),{},{angle:d,radius:c})}return zee},oA=function(t,r){var n=r.graphicalItems,s=r.dataStartIndex,o=r.dataEndIndex,i=(n??[]).reduce(function(l,c){var d=c.props.data;return d&&d.length?[].concat(z0(l),z0(d)):l},[]);return i.length>0?i:t&&t.length&&Mn(s)&&Mn(o)?t.slice(s,o+1):[]};function Uee(e){return e==="number"?[0,"auto"]:void 0}var ZT=function(t,r,n,s){var o=t.graphicalItems,i=t.tooltipAxis,l=oA(r,t);return n<0||!o||!o.length||n>=l.length?null:o.reduce(function(c,d){var u,f=(u=d.props.data)!==null&&u!==void 0?u:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(i.dataKey&&!i.allowDuplicatedCategory){var m=f===void 0?l:f;h=zN(m,i.dataKey,s)}else h=f&&f[n]||l[n];return h?[].concat(z0(c),[SZ(d,h)]):c},[])},Oz=function(t,r,n,s){var o=s||{x:t.chartX,y:t.chartY},i=fUe(o,n),l=t.orderedTooltipTicks,c=t.tooltipAxis,d=t.tooltipTicks,u=OFe(i,l,d,c);if(u>=0&&d){var f=d[u]&&d[u].value,h=ZT(t,r,u,f),m=mUe(n,l,u,o);return{activeTooltipIndex:u,activeLabel:f,activePayload:h,activeCoordinate:m}}return null},hUe=function(t,r){var n=r.axes,s=r.graphicalItems,o=r.axisType,i=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.layout,f=t.children,h=t.stackOffset,m=yZ(u,o);return n.reduce(function(x,g){var v,y=g.type.defaultProps!==void 0?Jr(Jr({},g.type.defaultProps),g.props):g.props,b=y.type,w=y.dataKey,j=y.allowDataOverflow,_=y.allowDuplicatedCategory,C=y.scale,E=y.ticks,S=y.includeHidden,A=y[i];if(x[A])return x;var M=oA(t.data,{graphicalItems:s.filter(function(U){var L,H=i in U.props?U.props[i]:(L=U.type.defaultProps)===null||L===void 0?void 0:L[i];return H===A}),dataStartIndex:c,dataEndIndex:d}),O=M.length,I,T,k;q9e(y.domain,j,b)&&(I=fT(y.domain,null,j),m&&(b==="number"||C!=="auto")&&(k=Yb(M,w,"category")));var q=Uee(b);if(!I||I.length===0){var B,z=(B=y.domain)!==null&&B!==void 0?B:q;if(w){if(I=Yb(M,w,b),b==="category"&&m){var F=SSe(I);_&&F?(T=I,I=kS(0,O)):_||(I=Vq(z,I,g).reduce(function(U,L){return U.indexOf(L)>=0?U:[].concat(z0(U),[L])},[]))}else if(b==="category")_?I=I.filter(function(U){return U!==""&&!ls(U)}):I=Vq(z,I,g).reduce(function(U,L){return U.indexOf(L)>=0||L===""||ls(L)?U:[].concat(z0(U),[L])},[]);else if(b==="number"){var V=FFe(M,s.filter(function(U){var L,H,ie=i in U.props?U.props[i]:(L=U.type.defaultProps)===null||L===void 0?void 0:L[i],Y="hide"in U.props?U.props.hide:(H=U.type.defaultProps)===null||H===void 0?void 0:H.hide;return ie===A&&(S||!Y)}),w,o,u);V&&(I=V)}m&&(b==="number"||C!=="auto")&&(k=Yb(M,w,"category"))}else m?I=kS(0,O):l&&l[A]&&l[A].hasStack&&b==="number"?I=h==="expand"?[0,1]:NZ(l[A].stackGroups,c,d):I=vZ(M,s.filter(function(U){var L=i in U.props?U.props[i]:U.type.defaultProps[i],H="hide"in U.props?U.props.hide:U.type.defaultProps.hide;return L===A&&(S||!H)}),b,u,!0);if(b==="number")I=YT(f,I,A,o,E),z&&(I=fT(z,I,j));else if(b==="category"&&z){var me=z,be=I.every(function(U){return me.indexOf(U)>=0});be&&(I=me)}}return Jr(Jr({},x),{},Xa({},A,Jr(Jr({},y),{},{axisType:o,domain:I,categoricalDomain:k,duplicateDomain:T,originalDomain:(v=y.domain)!==null&&v!==void 0?v:q,isCategorical:m,layout:u})))},{})},pUe=function(t,r){var n=r.graphicalItems,s=r.Axis,o=r.axisType,i=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.layout,f=t.children,h=oA(t.data,{graphicalItems:n,dataStartIndex:c,dataEndIndex:d}),m=h.length,x=yZ(u,o),g=-1;return n.reduce(function(v,y){var b=y.type.defaultProps!==void 0?Jr(Jr({},y.type.defaultProps),y.props):y.props,w=b[i],j=Uee("number");if(!v[w]){g++;var _;return x?_=kS(0,m):l&&l[w]&&l[w].hasStack?(_=NZ(l[w].stackGroups,c,d),_=YT(f,_,w,o)):(_=fT(j,vZ(h,n.filter(function(C){var E,S,A=i in C.props?C.props[i]:(E=C.type.defaultProps)===null||E===void 0?void 0:E[i],M="hide"in C.props?C.props.hide:(S=C.type.defaultProps)===null||S===void 0?void 0:S.hide;return A===w&&!M}),"number",u),s.defaultProps.allowDataOverflow),_=YT(f,_,w,o)),Jr(Jr({},v),{},Xa({},w,Jr(Jr({axisType:o},s.defaultProps),{},{hide:!0,orientation:kd(dUe,"".concat(o,".").concat(g%2),null),domain:_,originalDomain:j,isCategorical:x,layout:u})))}return v},{})},gUe=function(t,r){var n=r.axisType,s=n===void 0?"xAxis":n,o=r.AxisComp,i=r.graphicalItems,l=r.stackGroups,c=r.dataStartIndex,d=r.dataEndIndex,u=t.children,f="".concat(s,"Id"),h=Id(u,o),m={};return h&&h.length?m=hUe(t,{axes:h,graphicalItems:i,axisType:s,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:d}):i&&i.length&&(m=pUe(t,{Axis:o,graphicalItems:i,axisType:s,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:d})),m},xUe=function(t){var r=Ah(t),n=Cm(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:NM(n,function(s){return s.coordinate}),tooltipAxis:r,tooltipAxisBandSize:xS(r,n)}},Tz=function(t){var r=t.children,n=t.defaultShowTooltip,s=xd(r,I0),o=0,i=0;return t.data&&t.data.length!==0&&(i=t.data.length-1),s&&s.props&&(s.props.startIndex>=0&&(o=s.props.startIndex),s.props.endIndex>=0&&(i=s.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:i,activeTooltipIndex:-1,isTooltipActive:!!n}},vUe=function(t){return!t||!t.length?!1:t.some(function(r){var n=Im(r&&r.type);return n&&n.indexOf("Bar")>=0})},Dz=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},yUe=function(t,r){var n=t.props,s=t.graphicalItems,o=t.xAxisMap,i=o===void 0?{}:o,l=t.yAxisMap,c=l===void 0?{}:l,d=n.width,u=n.height,f=n.children,h=n.margin||{},m=xd(f,I0),x=xd(f,Tg),g=Object.keys(c).reduce(function(_,C){var E=c[C],S=E.orientation;return!E.mirror&&!E.hide?Jr(Jr({},_),{},Xa({},S,_[S]+E.width)):_},{left:h.left||0,right:h.right||0}),v=Object.keys(i).reduce(function(_,C){var E=i[C],S=E.orientation;return!E.mirror&&!E.hide?Jr(Jr({},_),{},Xa({},S,kd(_,"".concat(S))+E.height)):_},{top:h.top||0,bottom:h.bottom||0}),y=Jr(Jr({},v),g),b=y.bottom;m&&(y.bottom+=m.props.height||I0.defaultProps.height),x&&r&&(y=MFe(y,s,n,r));var w=d-y.left-y.right,j=u-y.top-y.bottom;return Jr(Jr({brushBottom:b},y),{},{width:Math.max(w,0),height:Math.max(j,0)})},bUe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},iA=function(t){var r=t.chartName,n=t.GraphicalChild,s=t.defaultTooltipEventType,o=s===void 0?"axis":s,i=t.validateTooltipEventTypes,l=i===void 0?["axis"]:i,c=t.axisComponents,d=t.legendContent,u=t.formatAxisMap,f=t.defaultProps,h=function(y,b){var w=b.graphicalItems,j=b.stackGroups,_=b.offset,C=b.updateId,E=b.dataStartIndex,S=b.dataEndIndex,A=y.barSize,M=y.layout,O=y.barGap,I=y.barCategoryGap,T=y.maxBarSize,k=Dz(M),q=k.numericAxisName,B=k.cateAxisName,z=vUe(w),F=[];return w.forEach(function(V,me){var be=oA(y.data,{graphicalItems:[V],dataStartIndex:E,dataEndIndex:S}),U=V.type.defaultProps!==void 0?Jr(Jr({},V.type.defaultProps),V.props):V.props,L=U.dataKey,H=U.maxBarSize,ie=U["".concat(q,"Id")],Y=U["".concat(B,"Id")],W={},se=c.reduce(function(Dt,Bt){var ge=b["".concat(Bt.axisType,"Map")],wt=U["".concat(Bt.axisType,"Id")];ge&&ge[wt]||Bt.axisType==="zAxis"||vp(!1);var Gt=ge[wt];return Jr(Jr({},Dt),{},Xa(Xa({},Bt.axisType,Gt),"".concat(Bt.axisType,"Ticks"),Cm(Gt)))},W),pe=se[B],G=se["".concat(B,"Ticks")],te=j&&j[ie]&&j[ie].hasStack&&HFe(V,j[ie].stackGroups),oe=Im(V.type).indexOf("Bar")>=0,De=xS(pe,G),re=[],ae=z&&TFe({barSize:A,stackGroups:j,totalSize:bUe(se,B)});if(oe){var ut,pt,ft=ls(H)?T:H,bt=(ut=(pt=xS(pe,G,!0))!==null&&pt!==void 0?pt:ft)!==null&&ut!==void 0?ut:0;re=DFe({barGap:O,barCategoryGap:I,bandSize:bt!==De?bt:De,sizeList:ae[Y],maxBarSize:ft}),bt!==De&&(re=re.map(function(Dt){return Jr(Jr({},Dt),{},{position:Jr(Jr({},Dt.position),{},{offset:Dt.position.offset-bt/2})})}))}var Lt=V&&V.type&&V.type.getComposedData;Lt&&F.push({props:Jr(Jr({},Lt(Jr(Jr({},se),{},{displayedData:be,props:y,dataKey:L,item:V,bandSize:De,barPosition:re,offset:_,stackedData:te,layout:M,dataStartIndex:E,dataEndIndex:S}))),{},Xa(Xa(Xa({key:V.key||"item-".concat(me)},q,se[q]),B,se[B]),"animationId",C)),childIndex:FSe(V,y.children),item:V})}),F},m=function(y,b){var w=y.props,j=y.dataStartIndex,_=y.dataEndIndex,C=y.updateId;if(!D8({props:w}))return null;var E=w.children,S=w.layout,A=w.stackOffset,M=w.data,O=w.reverseStackOrder,I=Dz(S),T=I.numericAxisName,k=I.cateAxisName,q=Id(E,n),B=VFe(M,q,"".concat(T,"Id"),"".concat(k,"Id"),A,O),z=c.reduce(function(U,L){var H="".concat(L.axisType,"Map");return Jr(Jr({},U),{},Xa({},H,gUe(w,Jr(Jr({},L),{},{graphicalItems:q,stackGroups:L.axisType===T&&B,dataStartIndex:j,dataEndIndex:_}))))},{}),F=yUe(Jr(Jr({},z),{},{props:w,graphicalItems:q}),b?.legendBBox);Object.keys(z).forEach(function(U){z[U]=u(w,z[U],F,U.replace("Map",""),r)});var V=z["".concat(k,"Map")],me=xUe(V),be=h(w,Jr(Jr({},z),{},{dataStartIndex:j,dataEndIndex:_,updateId:C,graphicalItems:q,stackGroups:B,offset:F}));return Jr(Jr({formattedGraphicalItems:be,graphicalItems:q,offset:F,stackGroups:B},me),z)},x=function(v){function y(b){var w,j,_;return eUe(this,y),_=rUe(this,y,[b]),Xa(_,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Xa(_,"accessibilityManager",new B9e),Xa(_,"handleLegendBBoxUpdate",function(C){if(C){var E=_.state,S=E.dataStartIndex,A=E.dataEndIndex,M=E.updateId;_.setState(Jr({legendBBox:C},m({props:_.props,dataStartIndex:S,dataEndIndex:A,updateId:M},Jr(Jr({},_.state),{},{legendBBox:C}))))}}),Xa(_,"handleReceiveSyncEvent",function(C,E,S){if(_.props.syncId===C){if(S===_.eventEmitterSymbol&&typeof _.props.syncMethod!="function")return;_.applySyncEvent(E)}}),Xa(_,"handleBrushChange",function(C){var E=C.startIndex,S=C.endIndex;if(E!==_.state.dataStartIndex||S!==_.state.dataEndIndex){var A=_.state.updateId;_.setState(function(){return Jr({dataStartIndex:E,dataEndIndex:S},m({props:_.props,dataStartIndex:E,dataEndIndex:S,updateId:A},_.state))}),_.triggerSyncEvent({dataStartIndex:E,dataEndIndex:S})}}),Xa(_,"handleMouseEnter",function(C){var E=_.getMouseInfo(C);if(E){var S=Jr(Jr({},E),{},{isTooltipActive:!0});_.setState(S),_.triggerSyncEvent(S);var A=_.props.onMouseEnter;Ja(A)&&A(S,C)}}),Xa(_,"triggeredAfterMouseMove",function(C){var E=_.getMouseInfo(C),S=E?Jr(Jr({},E),{},{isTooltipActive:!0}):{isTooltipActive:!1};_.setState(S),_.triggerSyncEvent(S);var A=_.props.onMouseMove;Ja(A)&&A(S,C)}),Xa(_,"handleItemMouseEnter",function(C){_.setState(function(){return{isTooltipActive:!0,activeItem:C,activePayload:C.tooltipPayload,activeCoordinate:C.tooltipPosition||{x:C.cx,y:C.cy}}})}),Xa(_,"handleItemMouseLeave",function(){_.setState(function(){return{isTooltipActive:!1}})}),Xa(_,"handleMouseMove",function(C){C.persist(),_.throttleTriggeredAfterMouseMove(C)}),Xa(_,"handleMouseLeave",function(C){_.throttleTriggeredAfterMouseMove.cancel();var E={isTooltipActive:!1};_.setState(E),_.triggerSyncEvent(E);var S=_.props.onMouseLeave;Ja(S)&&S(E,C)}),Xa(_,"handleOuterEvent",function(C){var E=RSe(C),S=kd(_.props,"".concat(E));if(E&&Ja(S)){var A,M;/.*touch.*/i.test(E)?M=_.getMouseInfo(C.changedTouches[0]):M=_.getMouseInfo(C),S((A=M)!==null&&A!==void 0?A:{},C)}}),Xa(_,"handleClick",function(C){var E=_.getMouseInfo(C);if(E){var S=Jr(Jr({},E),{},{isTooltipActive:!0});_.setState(S),_.triggerSyncEvent(S);var A=_.props.onClick;Ja(A)&&A(S,C)}}),Xa(_,"handleMouseDown",function(C){var E=_.props.onMouseDown;if(Ja(E)){var S=_.getMouseInfo(C);E(S,C)}}),Xa(_,"handleMouseUp",function(C){var E=_.props.onMouseUp;if(Ja(E)){var S=_.getMouseInfo(C);E(S,C)}}),Xa(_,"handleTouchMove",function(C){C.changedTouches!=null&&C.changedTouches.length>0&&_.throttleTriggeredAfterMouseMove(C.changedTouches[0])}),Xa(_,"handleTouchStart",function(C){C.changedTouches!=null&&C.changedTouches.length>0&&_.handleMouseDown(C.changedTouches[0])}),Xa(_,"handleTouchEnd",function(C){C.changedTouches!=null&&C.changedTouches.length>0&&_.handleMouseUp(C.changedTouches[0])}),Xa(_,"handleDoubleClick",function(C){var E=_.props.onDoubleClick;if(Ja(E)){var S=_.getMouseInfo(C);E(S,C)}}),Xa(_,"handleContextMenu",function(C){var E=_.props.onContextMenu;if(Ja(E)){var S=_.getMouseInfo(C);E(S,C)}}),Xa(_,"triggerSyncEvent",function(C){_.props.syncId!==void 0&&FE.emit(LE,_.props.syncId,C,_.eventEmitterSymbol)}),Xa(_,"applySyncEvent",function(C){var E=_.props,S=E.layout,A=E.syncMethod,M=_.state.updateId,O=C.dataStartIndex,I=C.dataEndIndex;if(C.dataStartIndex!==void 0||C.dataEndIndex!==void 0)_.setState(Jr({dataStartIndex:O,dataEndIndex:I},m({props:_.props,dataStartIndex:O,dataEndIndex:I,updateId:M},_.state)));else if(C.activeTooltipIndex!==void 0){var T=C.chartX,k=C.chartY,q=C.activeTooltipIndex,B=_.state,z=B.offset,F=B.tooltipTicks;if(!z)return;if(typeof A=="function")q=A(F,C);else if(A==="value"){q=-1;for(var V=0;V<F.length;V++)if(F[V].value===C.activeLabel){q=V;break}}var me=Jr(Jr({},z),{},{x:z.left,y:z.top}),be=Math.min(T,me.x+me.width),U=Math.min(k,me.y+me.height),L=F[q]&&F[q].value,H=ZT(_.state,_.props.data,q),ie=F[q]?{x:S==="horizontal"?F[q].coordinate:be,y:S==="horizontal"?U:F[q].coordinate}:zee;_.setState(Jr(Jr({},C),{},{activeLabel:L,activeCoordinate:ie,activePayload:H,activeTooltipIndex:q}))}else _.setState(C)}),Xa(_,"renderCursor",function(C){var E,S=_.state,A=S.isTooltipActive,M=S.activeCoordinate,O=S.activePayload,I=S.offset,T=S.activeTooltipIndex,k=S.tooltipAxisBandSize,q=_.getTooltipEventType(),B=(E=C.props.active)!==null&&E!==void 0?E:A,z=_.props.layout,F=C.key||"_recharts-cursor";return Ce.createElement(G9e,{key:F,activeCoordinate:M,activePayload:O,activeTooltipIndex:T,chartName:r,element:C,isActive:B,layout:z,offset:I,tooltipAxisBandSize:k,tooltipEventType:q})}),Xa(_,"renderPolarAxis",function(C,E,S){var A=kd(C,"type.axisType"),M=kd(_.state,"".concat(A,"Map")),O=C.type.defaultProps,I=O!==void 0?Jr(Jr({},O),C.props):C.props,T=M&&M[I["".concat(A,"Id")]];return p.cloneElement(C,Jr(Jr({},T),{},{className:us(A,T.className),key:C.key||"".concat(E,"-").concat(S),ticks:Cm(T,!0)}))}),Xa(_,"renderPolarGrid",function(C){var E=C.props,S=E.radialLines,A=E.polarAngles,M=E.polarRadius,O=_.state,I=O.radiusAxisMap,T=O.angleAxisMap,k=Ah(I),q=Ah(T),B=q.cx,z=q.cy,F=q.innerRadius,V=q.outerRadius;return p.cloneElement(C,{polarAngles:Array.isArray(A)?A:Cm(q,!0).map(function(me){return me.coordinate}),polarRadius:Array.isArray(M)?M:Cm(k,!0).map(function(me){return me.coordinate}),cx:B,cy:z,innerRadius:F,outerRadius:V,key:C.key||"polar-grid",radialLines:S})}),Xa(_,"renderLegend",function(){var C=_.state.formattedGraphicalItems,E=_.props,S=E.children,A=E.width,M=E.height,O=_.props.margin||{},I=A-(O.left||0)-(O.right||0),T=gZ({children:S,formattedGraphicalItems:C,legendWidth:I,legendContent:d});if(!T)return null;var k=T.item,q=Ez(T,K9e);return p.cloneElement(k,Jr(Jr({},q),{},{chartWidth:A,chartHeight:M,margin:O,onBBoxUpdate:_.handleLegendBBoxUpdate}))}),Xa(_,"renderTooltip",function(){var C,E=_.props,S=E.children,A=E.accessibilityLayer,M=xd(S,Dc);if(!M)return null;var O=_.state,I=O.isTooltipActive,T=O.activeCoordinate,k=O.activePayload,q=O.activeLabel,B=O.offset,z=(C=M.props.active)!==null&&C!==void 0?C:I;return p.cloneElement(M,{viewBox:Jr(Jr({},B),{},{x:B.left,y:B.top}),active:z,label:q,payload:z?k:[],coordinate:T,accessibilityLayer:A})}),Xa(_,"renderBrush",function(C){var E=_.props,S=E.margin,A=E.data,M=_.state,O=M.offset,I=M.dataStartIndex,T=M.dataEndIndex,k=M.updateId;return p.cloneElement(C,{key:C.key||"_recharts-brush",onChange:L_(_.handleBrushChange,C.props.onChange),data:A,x:Mn(C.props.x)?C.props.x:O.left,y:Mn(C.props.y)?C.props.y:O.top+O.height+O.brushBottom-(S.bottom||0),width:Mn(C.props.width)?C.props.width:O.width,startIndex:I,endIndex:T,updateId:"brush-".concat(k)})}),Xa(_,"renderReferenceElement",function(C,E,S){if(!C)return null;var A=_,M=A.clipPathId,O=_.state,I=O.xAxisMap,T=O.yAxisMap,k=O.offset,q=C.type.defaultProps||{},B=C.props,z=B.xAxisId,F=z===void 0?q.xAxisId:z,V=B.yAxisId,me=V===void 0?q.yAxisId:V;return p.cloneElement(C,{key:C.key||"".concat(E,"-").concat(S),xAxis:I[F],yAxis:T[me],viewBox:{x:k.left,y:k.top,width:k.width,height:k.height},clipPathId:M})}),Xa(_,"renderActivePoints",function(C){var E=C.item,S=C.activePoint,A=C.basePoint,M=C.childIndex,O=C.isRange,I=[],T=E.props.key,k=E.item.type.defaultProps!==void 0?Jr(Jr({},E.item.type.defaultProps),E.item.props):E.item.props,q=k.activeDot,B=k.dataKey,z=Jr(Jr({index:M,dataKey:B,cx:S.x,cy:S.y,r:4,fill:YM(E.item),strokeWidth:2,stroke:"#fff",payload:S.payload,value:S.value},Ra(q,!1)),UN(q));return I.push(y.renderActiveDot(q,z,"".concat(T,"-activePoint-").concat(M))),A?I.push(y.renderActiveDot(q,Jr(Jr({},z),{},{cx:A.x,cy:A.y}),"".concat(T,"-basePoint-").concat(M))):O&&I.push(null),I}),Xa(_,"renderGraphicChild",function(C,E,S){var A=_.filterFormatItem(C,E,S);if(!A)return null;var M=_.getTooltipEventType(),O=_.state,I=O.isTooltipActive,T=O.tooltipAxis,k=O.activeTooltipIndex,q=O.activeLabel,B=_.props.children,z=xd(B,Dc),F=A.props,V=F.points,me=F.isRange,be=F.baseLine,U=A.item.type.defaultProps!==void 0?Jr(Jr({},A.item.type.defaultProps),A.item.props):A.item.props,L=U.activeDot,H=U.hide,ie=U.activeBar,Y=U.activeShape,W=!!(!H&&I&&z&&(L||ie||Y)),se={};M!=="axis"&&z&&z.props.trigger==="click"?se={onClick:L_(_.handleItemMouseEnter,C.props.onClick)}:M!=="axis"&&(se={onMouseLeave:L_(_.handleItemMouseLeave,C.props.onMouseLeave),onMouseEnter:L_(_.handleItemMouseEnter,C.props.onMouseEnter)});var pe=p.cloneElement(C,Jr(Jr({},A.props),se));function G(Bt){return typeof T.dataKey=="function"?T.dataKey(Bt.payload):null}if(W)if(k>=0){var te,oe;if(T.dataKey&&!T.allowDuplicatedCategory){var De=typeof T.dataKey=="function"?G:"payload.".concat(T.dataKey.toString());te=zN(V,De,q),oe=me&&be&&zN(be,De,q)}else te=V?.[k],oe=me&&be&&be[k];if(Y||ie){var re=C.props.activeIndex!==void 0?C.props.activeIndex:k;return[p.cloneElement(C,Jr(Jr(Jr({},A.props),se),{},{activeIndex:re})),null,null]}if(!ls(te))return[pe].concat(z0(_.renderActivePoints({item:A,activePoint:te,basePoint:oe,childIndex:k,isRange:me})))}else{var ae,ut=(ae=_.getItemByXY(_.state.activeCoordinate))!==null&&ae!==void 0?ae:{graphicalItem:pe},pt=ut.graphicalItem,ft=pt.item,bt=ft===void 0?C:ft,Lt=pt.childIndex,Dt=Jr(Jr(Jr({},A.props),se),{},{activeIndex:Lt});return[p.cloneElement(bt,Dt),null,null]}return me?[pe,null,null]:[pe,null]}),Xa(_,"renderCustomized",function(C,E,S){return p.cloneElement(C,Jr(Jr({key:"recharts-customized-".concat(S)},_.props),_.state))}),Xa(_,"renderMap",{CartesianGrid:{handler:U_,once:!0},ReferenceArea:{handler:_.renderReferenceElement},ReferenceLine:{handler:U_},ReferenceDot:{handler:_.renderReferenceElement},XAxis:{handler:U_},YAxis:{handler:U_},Brush:{handler:_.renderBrush,once:!0},Bar:{handler:_.renderGraphicChild},Line:{handler:_.renderGraphicChild},Area:{handler:_.renderGraphicChild},Radar:{handler:_.renderGraphicChild},RadialBar:{handler:_.renderGraphicChild},Scatter:{handler:_.renderGraphicChild},Pie:{handler:_.renderGraphicChild},Funnel:{handler:_.renderGraphicChild},Tooltip:{handler:_.renderCursor,once:!0},PolarGrid:{handler:_.renderPolarGrid,once:!0},PolarAngleAxis:{handler:_.renderPolarAxis},PolarRadiusAxis:{handler:_.renderPolarAxis},Customized:{handler:_.renderCustomized}}),_.clipPathId="".concat((w=b.id)!==null&&w!==void 0?w:yx("recharts"),"-clip"),_.throttleTriggeredAfterMouseMove=pQ(_.triggeredAfterMouseMove,(j=b.throttleDelay)!==null&&j!==void 0?j:1e3/60),_.state={},_}return sUe(y,v),tUe(y,[{key:"componentDidMount",value:function(){var w,j;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(j=this.props.margin.top)!==null&&j!==void 0?j:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var w=this.props,j=w.children,_=w.data,C=w.height,E=w.layout,S=xd(j,Dc);if(S){var A=S.props.defaultIndex;if(!(typeof A!="number"||A<0||A>this.state.tooltipTicks.length-1)){var M=this.state.tooltipTicks[A]&&this.state.tooltipTicks[A].value,O=ZT(this.state,_,A,M),I=this.state.tooltipTicks[A].coordinate,T=(this.state.offset.top+C)/2,k=E==="horizontal",q=k?{x:I,y:T}:{y:I,x:T},B=this.state.formattedGraphicalItems.find(function(F){var V=F.item;return V.type.name==="Scatter"});B&&(q=Jr(Jr({},q),B.props.points[A].tooltipPosition),O=B.props.points[A].tooltipPayload);var z={activeTooltipIndex:A,isTooltipActive:!0,activeLabel:M,activePayload:O,activeCoordinate:q};this.setState(z),this.renderCursor(S),this.accessibilityManager.setIndex(A)}}}},{key:"getSnapshotBeforeUpdate",value:function(w,j){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==j.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==w.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==w.margin){var _,C;this.accessibilityManager.setDetails({offset:{left:(_=this.props.margin.left)!==null&&_!==void 0?_:0,top:(C=this.props.margin.top)!==null&&C!==void 0?C:0}})}return null}},{key:"componentDidUpdate",value:function(w){AO([xd(w.children,Dc)],[xd(this.props.children,Dc)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var w=xd(this.props.children,Dc);if(w&&typeof w.props.shared=="boolean"){var j=w.props.shared?"axis":"item";return l.indexOf(j)>=0?j:o}return o}},{key:"getMouseInfo",value:function(w){if(!this.container)return null;var j=this.container,_=j.getBoundingClientRect(),C=o4e(_),E={chartX:Math.round(w.pageX-C.left),chartY:Math.round(w.pageY-C.top)},S=_.width/j.offsetWidth||1,A=this.inRange(E.chartX,E.chartY,S);if(!A)return null;var M=this.state,O=M.xAxisMap,I=M.yAxisMap,T=this.getTooltipEventType(),k=Oz(this.state,this.props.data,this.props.layout,A);if(T!=="axis"&&O&&I){var q=Ah(O).scale,B=Ah(I).scale,z=q&&q.invert?q.invert(E.chartX):null,F=B&&B.invert?B.invert(E.chartY):null;return Jr(Jr({},E),{},{xValue:z,yValue:F},k)}return k?Jr(Jr({},E),k):null}},{key:"inRange",value:function(w,j){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,C=this.props.layout,E=w/_,S=j/_;if(C==="horizontal"||C==="vertical"){var A=this.state.offset,M=E>=A.left&&E<=A.left+A.width&&S>=A.top&&S<=A.top+A.height;return M?{x:E,y:S}:null}var O=this.state,I=O.angleAxisMap,T=O.radiusAxisMap;if(I&&T){var k=Ah(I);return Gq({x:E,y:S},k)}return null}},{key:"parseEventsOfWrapper",value:function(){var w=this.props.children,j=this.getTooltipEventType(),_=xd(w,Dc),C={};_&&j==="axis"&&(_.props.trigger==="click"?C={onClick:this.handleClick}:C={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var E=UN(this.props,this.handleOuterEvent);return Jr(Jr({},E),C)}},{key:"addListener",value:function(){FE.on(LE,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){FE.removeListener(LE,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(w,j,_){for(var C=this.state.formattedGraphicalItems,E=0,S=C.length;E<S;E++){var A=C[E];if(A.item===w||A.props.key===w.key||j===Im(A.item.type)&&_===A.childIndex)return A}return null}},{key:"renderClipPath",value:function(){var w=this.clipPathId,j=this.state.offset,_=j.left,C=j.top,E=j.height,S=j.width;return Ce.createElement("defs",null,Ce.createElement("clipPath",{id:w},Ce.createElement("rect",{x:_,y:C,height:E,width:S})))}},{key:"getXScales",value:function(){var w=this.state.xAxisMap;return w?Object.entries(w).reduce(function(j,_){var C=Pz(_,2),E=C[0],S=C[1];return Jr(Jr({},j),{},Xa({},E,S.scale))},{}):null}},{key:"getYScales",value:function(){var w=this.state.yAxisMap;return w?Object.entries(w).reduce(function(j,_){var C=Pz(_,2),E=C[0],S=C[1];return Jr(Jr({},j),{},Xa({},E,S.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(w){var j;return(j=this.state.xAxisMap)===null||j===void 0||(j=j[w])===null||j===void 0?void 0:j.scale}},{key:"getYScaleByAxisId",value:function(w){var j;return(j=this.state.yAxisMap)===null||j===void 0||(j=j[w])===null||j===void 0?void 0:j.scale}},{key:"getItemByXY",value:function(w){var j=this.state,_=j.formattedGraphicalItems,C=j.activeItem;if(_&&_.length)for(var E=0,S=_.length;E<S;E++){var A=_[E],M=A.props,O=A.item,I=O.type.defaultProps!==void 0?Jr(Jr({},O.type.defaultProps),O.props):O.props,T=Im(O.type);if(T==="Bar"){var k=(M.data||[]).find(function(F){return q6e(w,F)});if(k)return{graphicalItem:A,payload:k}}else if(T==="RadialBar"){var q=(M.data||[]).find(function(F){return Gq(w,F)});if(q)return{graphicalItem:A,payload:q}}else if(Z5(A,C)||eA(A,C)||y1(A,C)){var B=EBe({graphicalItem:A,activeTooltipItem:C,itemData:I.data}),z=I.activeIndex===void 0?B:I.activeIndex;return{graphicalItem:Jr(Jr({},A),{},{childIndex:z}),payload:y1(A,C)?I.data[B]:A.props.data[B]}}}return null}},{key:"render",value:function(){var w=this;if(!D8(this))return null;var j=this.props,_=j.children,C=j.className,E=j.width,S=j.height,A=j.style,M=j.compact,O=j.title,I=j.desc,T=Ez(j,X9e),k=Ra(T,!1);if(M)return Ce.createElement(rz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement(EO,Ov({},k,{width:E,height:S,title:O,desc:I}),this.renderClipPath(),R8(_,this.renderMap)));if(this.props.accessibilityLayer){var q,B;k.tabIndex=(q=this.props.tabIndex)!==null&&q!==void 0?q:0,k.role=(B=this.props.role)!==null&&B!==void 0?B:"application",k.onKeyDown=function(F){w.accessibilityManager.keyboardEvent(F)},k.onFocus=function(){w.accessibilityManager.focus()}}var z=this.parseEventsOfWrapper();return Ce.createElement(rz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement("div",Ov({className:us("recharts-wrapper",C),style:Jr({position:"relative",cursor:"default",width:E,height:S},A)},z,{ref:function(V){w.container=V}}),Ce.createElement(EO,Ov({},k,{width:E,height:S,title:O,desc:I,style:uUe}),this.renderClipPath(),R8(_,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(p.Component);Xa(x,"displayName",r),Xa(x,"defaultProps",Jr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),Xa(x,"getDerivedStateFromProps",function(v,y){var b=v.dataKey,w=v.data,j=v.children,_=v.width,C=v.height,E=v.layout,S=v.stackOffset,A=v.margin,M=y.dataStartIndex,O=y.dataEndIndex;if(y.updateId===void 0){var I=Tz(v);return Jr(Jr(Jr({},I),{},{updateId:0},m(Jr(Jr({props:v},I),{},{updateId:0}),y)),{},{prevDataKey:b,prevData:w,prevWidth:_,prevHeight:C,prevLayout:E,prevStackOffset:S,prevMargin:A,prevChildren:j})}if(b!==y.prevDataKey||w!==y.prevData||_!==y.prevWidth||C!==y.prevHeight||E!==y.prevLayout||S!==y.prevStackOffset||!Kv(A,y.prevMargin)){var T=Tz(v),k={chartX:y.chartX,chartY:y.chartY,isTooltipActive:y.isTooltipActive},q=Jr(Jr({},Oz(y,w,E)),{},{updateId:y.updateId+1}),B=Jr(Jr(Jr({},T),k),q);return Jr(Jr(Jr({},B),m(Jr({props:v},B),y)),{},{prevDataKey:b,prevData:w,prevWidth:_,prevHeight:C,prevLayout:E,prevStackOffset:S,prevMargin:A,prevChildren:j})}if(!AO(j,y.prevChildren)){var z,F,V,me,be=xd(j,I0),U=be&&(z=(F=be.props)===null||F===void 0?void 0:F.startIndex)!==null&&z!==void 0?z:M,L=be&&(V=(me=be.props)===null||me===void 0?void 0:me.endIndex)!==null&&V!==void 0?V:O,H=U!==M||L!==O,ie=!ls(w),Y=ie&&!H?y.updateId:y.updateId+1;return Jr(Jr({updateId:Y},m(Jr(Jr({props:v},y),{},{updateId:Y,dataStartIndex:U,dataEndIndex:L}),y)),{},{prevChildren:j,dataStartIndex:U,dataEndIndex:L})}return null}),Xa(x,"renderActiveDot",function(v,y,b){var w;return p.isValidElement(v)?w=p.cloneElement(v,y):Ja(v)?w=v(y):w=Ce.createElement(hj,y),Ce.createElement(ks,{className:"recharts-active-dot",key:b},w)});var g=p.forwardRef(function(y,b){return Ce.createElement(x,Ov({},y,{ref:b}))});return g.displayName=x.displayName,g},Vee=iA({chartName:"LineChart",GraphicalChild:jy,axisComponents:[{axisType:"xAxis",AxisComp:bp},{axisType:"yAxis",AxisComp:wp}],formatAxisMap:ZM}),wUe=iA({chartName:"BarChart",GraphicalChild:_x,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:bp},{axisType:"yAxis",AxisComp:wp}],formatAxisMap:ZM}),jUe=iA({chartName:"PieChart",GraphicalChild:Jf,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:Q5},{axisType:"radiusAxis",AxisComp:Y5}],formatAxisMap:rLe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}}),_Ue=iA({chartName:"AreaChart",GraphicalChild:Mp,axisComponents:[{axisType:"xAxis",AxisComp:bp},{axisType:"yAxis",AxisComp:wp}],formatAxisMap:ZM});const Mz=({icon:e,title:t,value:r,trend:n,trendValue:s,color:o,className:i,loading:l})=>{const c=n==="up"?K4:Tue,d=n==="up"?"text-success":"text-danger";return a.jsx(Fr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group flex flex-col justify-between ${i}`,children:a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10",style:{color:`var(--${o})`},children:a.jsx(e,{className:"h-5 w-5"})}),!l&&n&&s&&a.jsxs("div",{className:`flex items-center text-xs font-bold ${d}`,children:[a.jsx(c,{className:"w-3.5 h-3.5 mr-1"}),a.jsx("span",{children:s})]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider mb-2",children:t}),l?a.jsx("div",{className:"h-9 bg-white/5 rounded animate-pulse"}):a.jsx("p",{className:"text-3xl font-bold text-text-primary tabular-nums tracking-tight",children:r})]})]})})},NUe=({alerts:e,className:t})=>{const r=Il(),[n,s]=p.useState(!1),o=u=>({Package:bu,DollarSign:Wi,CalendarCheck:zC,Clock:pu,ShoppingCart:Y1,Store:eD,Users:mc,CalendarPlus:J4,AlertTriangle:Kf,Info:bG})[u]||Kf,i=u=>({danger:"text-danger",warning:"text-warning",info:"text-info",success:"text-success",purple:"text-purple"})[u]||"text-warning",l=e.length>2?e.slice(0,2):e,c=e.length>2,d=({alert:u,onClick:f})=>{const h=o(u.icone),m=i(u.cor);return a.jsxs("li",{className:"flex items-center gap-2 p-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group",onClick:f,children:[a.jsx(h,{className:`w-4 h-4 flex-shrink-0 ${m}`}),a.jsx("span",{className:"text-text-secondary group-hover:text-text-primary transition-colors flex-1",children:u.mensagem}),u.link&&a.jsx(K4,{className:"w-3 h-3 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity"})]})};return a.jsxs(a.Fragment,{children:[a.jsxs(Fr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card ${t||""}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h2",{className:"text-lg font-bold text-text-primary flex items-center",children:[a.jsx(Lb,{className:"mr-2 h-5 w-5 text-brand"})," Alertas do Dia"]}),c&&a.jsx(Z,{variant:"ghost",size:"sm",className:"text-xs text-brand hover:text-brand/80",onClick:()=>s(!0),children:"Ver todos"})]}),e.length===0?a.jsx("p",{className:"text-sm text-text-muted",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:l.map((u,f)=>a.jsx(d,{alert:u,onClick:()=>u.link&&r(u.link)},f))})]}),a.jsx(Un,{open:n,onOpenChange:s,children:a.jsxs(zn,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[a.jsx(Bn,{children:a.jsxs(Ln,{className:"flex items-center gap-2",children:[a.jsx(Lb,{className:"h-5 w-5 text-brand"}),"Todos os Alertas (",e.length,")"]})}),a.jsx("div",{className:"mt-4",children:e.length===0?a.jsx("p",{className:"text-sm text-text-muted text-center py-8",children:"Nenhum alerta no momento! "}):a.jsx("ul",{className:"space-y-2 text-sm",children:e.map((u,f)=>a.jsx(d,{alert:u,onClick:()=>{u.link&&(r(u.link),s(!1))}},f))})})]})})]})},SUe=({title:e,icon:t,data:r,color:n,className:s,loading:o})=>{const i=r.reduce((d,u)=>d+(u.receita||0),0),l=r.reduce((d,u)=>d+(u.despesa||0),0),c=i-l;return a.jsxs(Fr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group ${s||""}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10 mr-3",style:{color:`var(--${n})`},children:a.jsx(t,{className:"h-5 w-5"})}),a.jsx("h3",{className:"text-base font-bold text-text-primary flex-1",children:e}),a.jsx("div",{className:"text-xs font-semibold text-text-muted",children:"ltimos 14 dias"})]}),a.jsx("div",{className:"mb-2",children:a.jsx(Gb,{width:"100%",height:90,children:a.jsxs(_Ue,{data:r,margin:{top:4,right:0,left:0,bottom:0},children:[a.jsx(Dc,{cursor:{stroke:"var(--border)",strokeDasharray:"3 3"},contentStyle:{background:"rgba(10, 10, 10, 0.85)",borderColor:"var(--border)",color:"var(--text-primary)",borderRadius:"var(--radius-sm)"},formatter:(d,u)=>u==="saldo"?[`R$ ${d.toLocaleString("pt-BR")}`,"Saldo"]:d,labelFormatter:d=>d}),a.jsx(Mp,{type:"monotone",dataKey:"saldo",stroke:"var(--brand)",strokeWidth:2,fill:"var(--brand)",fillOpacity:.15})]})})}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Receita"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-success tabular-nums",children:["R$ ",i.toLocaleString("pt-BR")]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Despesa"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-danger tabular-nums",children:["R$ ",l.toLocaleString("pt-BR")]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary",children:"Saldo"}),o?a.jsx("div",{className:"h-5 w-20 bg-white/5 rounded animate-pulse mt-1"}):a.jsxs("p",{className:"font-bold text-text-primary tabular-nums",children:["R$ ",c.toLocaleString("pt-BR")]})]})]})]})},CUe=({title:e,icon:t,data:r,color:n,className:s,loading:o})=>a.jsxs(Fr.div,{variants:{hidden:{opacity:0,y:30,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}}},className:`fx-card group flex flex-col ${s||""}`,children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5 transition-colors duration-300 group-hover:border-brand/50 group-hover:bg-brand/10 mr-3",style:{color:`var(--${n})`},children:a.jsx(t,{className:"h-5 w-5"})}),a.jsx("h3",{className:"text-base font-bold text-text-primary",children:e})]}),a.jsx("div",{className:"space-y-3 mt-auto",children:o?Array.from({length:3}).map((i,l)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("div",{className:"h-4 w-24 bg-white/5 rounded animate-pulse"}),a.jsx("div",{className:"h-4 w-12 bg-white/5 rounded animate-pulse"})]},l)):r.map((i,l)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:i.name}),a.jsx("span",{className:"font-bold text-text-primary tabular-nums",children:i.value})]},l))})]}),AUe={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.1,delayChildren:.2}}},BE={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}};function PUe(){const{toast:e}=Zs(),{userProfile:t}=lo(),n=oj()?.alerts||[],s=Il(),[o,i]=p.useState(!0),[l,c]=p.useState(0),[d,u]=p.useState({finalizados:0,total:0}),[f,h]=p.useState(0),[m,x]=p.useState(0),[g,v]=p.useState(0),[y,b]=p.useState(0),[w,j]=p.useState(0),[_,C]=p.useState(0),[E,S]=p.useState([]);p.useEffect(()=>{(async()=>{if(!t?.codigo_empresa){console.log("[DashboardPage] Aguardando autenticao..."),i(!1);return}console.log("[DashboardPage] Iniciando carregamento de dados...");try{i(!0);const I=t.codigo_empresa,T=new Date,k=Po(T).toISOString(),q=M2(T).toISOString();console.log("[Dashboard] 1. Buscando pagamentos...");const{data:B}=await Q.from("pagamentos").select("valor, status").eq("codigo_empresa",I).gte("recebido_em",k).lte("recebido_em",q);console.log("[Dashboard]  Pagamentos carregados:",B?.length||0);const z=(B||[]).filter(ge=>!["Cancelado","Estornado"].includes(ge.status)).reduce((ge,wt)=>ge+Number(wt.valor||0),0);console.log("[Dashboard] 2. Buscando agendamentos de hoje...");const{data:F}=await Q.from("agendamentos").select("id").eq("codigo_empresa",I).gte("inicio",k).lte("inicio",q);console.log("[Dashboard]  Agendamentos de hoje:",F?.length||0);let V=0;if(F&&F.length>0){console.log("[Dashboard] 3. Buscando participantes pagos...");const ge=F.map(Gt=>Gt.id),{data:wt}=await Q.from("agendamento_participantes").select("valor_cota, status_pagamento, aplicar_taxa, finalizadora_id, finalizadoras!agp_finalizadora_id_fkey(taxa_percentual)").eq("codigo_empresa",I).in("agendamento_id",ge).eq("status_pagamento","Pago");console.log("[Dashboard]  Participantes pagos:",wt?.length||0),V=(wt||[]).reduce((Gt,Sr)=>{let wr=Number(Sr.valor_cota||0);if(Sr.aplicar_taxa===!0){const he=Number(Sr.finalizadoras?.taxa_percentual||0);he>0&&(wr=wr/(1+he/100))}return Gt+wr},0)}const me=z+V;c(me),console.log("[Dashboard] 4. Buscando agendamentos completos...");const{data:be}=await Q.from("agendamentos").select("id, status, inicio, fim").eq("codigo_empresa",I).gte("inicio",k).lte("inicio",q);console.log("[Dashboard]  Agendamentos completos:",be?.length||0);const U=(be||[]).filter(ge=>ge.status==="finished").length;u({finalizados:U,total:be?.length||0});const L=new Date().toISOString(),H=(be||[]).filter(ge=>ge.inicio>L&&!["canceled","finished"].includes(ge.status)).length;h(H);const ie=(be||[]).filter(ge=>ge.status==="in_progress").length;x(ie),console.log("[Dashboard] 5. Buscando quadras...");const{data:Y}=await Q.from("quadras").select("id").eq("codigo_empresa",I);console.log("[Dashboard]  Quadras:",Y?.length||0);const pe=(Y?.length||0)*17;let G=0;for(const ge of be||[])if(!["canceled","no_show"].includes(ge.status))if(ge.inicio&&ge.fim){const wt=new Date(ge.inicio),wr=(new Date(ge.fim)-wt)/(1e3*60*60);G+=wr}else G+=1;const te=pe>0?Math.round(G/pe*100):0;v(te),console.log("[Dashboard] 6. Buscando comandas abertas...");const{data:oe}=await Q.from("comandas").select("id").eq("codigo_empresa",I).eq("status","open");console.log("[Dashboard]  Comandas abertas:",oe?.length||0),b(oe?.length||0),console.log("[Dashboard] 7. Buscando mesas...");const{data:De}=await Q.from("mesas").select("id, status").eq("codigo_empresa",I);console.log("[Dashboard]  Mesas:",De?.length||0);const re=(De||[]).filter(ge=>["in-use","awaiting-payment"].includes(ge.status)).length;j(re),console.log("[Dashboard] 8. Buscando vendas da loja...");const{data:ae}=await Q.from("comandas").select("id").eq("codigo_empresa",I).eq("status","closed").gte("fechado_em",k).lte("fechado_em",q);console.log("[Dashboard]  Vendas da loja:",ae?.length||0),C(ae?.length||0),console.log("[Dashboard] 9. Buscando dados dos ltimos 14 dias...");const ut=new Date;ut.setDate(ut.getDate()-13);const pt=Po(ut).toISOString(),ft=M2(T).toISOString(),{data:bt}=await Q.from("pagamentos").select("valor, status, recebido_em").eq("codigo_empresa",I).gte("recebido_em",pt).lte("recebido_em",ft);console.log("[Dashboard]  Pagamentos 14 dias:",bt?.length||0);const{data:Lt}=await Q.from("agendamentos").select("id, inicio").eq("codigo_empresa",I).gte("inicio",pt).lte("inicio",ft);console.log("[Dashboard]  Agendamentos 14 dias:",Lt?.length||0);let Dt=[];if(Lt&&Lt.length>0){const ge=Lt.map(Gt=>Gt.id),{data:wt}=await Q.from("agendamento_participantes").select("valor_cota, agendamento_id").eq("codigo_empresa",I).in("agendamento_id",ge).eq("status_pagamento","Pago");Dt=wt||[],console.log("[Dashboard]  Participantes pagos 14 dias:",Dt.length)}const Bt=[];for(let ge=13;ge>=0;ge--){const wt=new Date;wt.setDate(wt.getDate()-ge);const Gt=Po(wt),Sr=M2(wt),wr=(bt||[]).filter(qt=>{const Re=new Date(qt.recebido_em);return Re>=Gt&&Re<=Sr&&!["Cancelado","Estornado"].includes(qt.status)}).reduce((qt,Re)=>qt+Number(Re.valor||0),0),he=(Lt||[]).filter(qt=>{const Re=new Date(qt.inicio);return Re>=Gt&&Re<=Sr}).map(qt=>qt.id),ot=Dt.filter(qt=>he.includes(qt.agendamento_id)).reduce((qt,Re)=>qt+Number(Re.valor_cota||0),0),Vt=wr+ot;Bt.push({name:ge===0?"Hoje":`${ge}d`,saldo:Math.round(Vt),receita:Math.round(Vt),despesa:0})}console.log("[Dashboard]  Dados de 14 dias carregados"),S(Bt)}catch(I){console.error("[DashboardPage]  Erro ao carregar dashboard:",I),e({title:"Erro ao carregar dashboard",description:I?.message||"Tente recarregar a pgina",variant:"destructive"})}finally{console.log("[DashboardPage]  Carregamento concludo"),i(!1)}})()},[t?.codigo_empresa]);const A=O=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(O||0)),M=[{name:"Comandas Abertas",value:y},{name:"Mesas Ocupadas",value:w},{name:"Vendas Hoje",value:_}];return a.jsx(a.Fragment,{children:a.jsxs(Fr.div,{variants:AUe,initial:"hidden",animate:"visible",className:"space-y-4",children:[a.jsxs(Fr.div,{variants:BE,className:"relative grid grid-cols-1 xl:grid-cols-12 gap-4 items-start",children:[a.jsx("div",{className:"xl:col-span-8",children:a.jsxs("div",{className:"bg-surface/70 backdrop-blur-sm relative p-4 rounded-xl border border-white/10 overflow-hidden shadow-1",children:[a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.03] mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 max-w-[720px]",children:[a.jsxs("h1",{className:"text-3xl font-black mb-2 text-text-primary tracking-tighter",children:["Bem-vindo de volta, ",a.jsxs("span",{className:"text-brand",children:[(t?.nome_exibicao||t?.nome||t?.email?.split("@")[0]||"Admin").split(" ")[0],"!"]})]}),a.jsx("p",{className:"text-text-secondary mb-3 max-w-[60ch] text-sm md:text-base font-normal",children:"Sua central de comando para uma gesto de sucesso. Monitore agendamentos, faturamento e clientes em um s lugar."}),a.jsxs("div",{className:"flex flex-wrap gap-2.5",children:[a.jsxs(Z,{onClick:()=>s("/agenda",{state:{openModal:!0}}),size:"default",children:[a.jsx(J4,{className:"mr-2 h-4 w-4"}),"+ Agendamento"]}),a.jsxs(Z,{onClick:()=>s("/clientes",{state:{openModal:!0}}),variant:"outline",size:"default",children:[a.jsx(mc,{className:"mr-2 h-4 w-4"}),"Adicionar Cliente"]})]})]})]})}),a.jsx("div",{className:"xl:col-span-4",children:a.jsxs("div",{className:"fx-card",children:[a.jsxs("h2",{className:"text-lg font-bold text-text-primary mb-3 flex items-center",children:[a.jsx(pu,{className:"mr-2 h-5 w-5 text-brand"})," Resumo do Dia"]}),a.jsxs("ul",{className:"space-y-2 text-sm",children:[a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Prximas Reservas"}),o?a.jsx("div",{className:"h-6 w-12 bg-white/5 rounded animate-pulse"}):a.jsx("span",{className:"font-bold text-text-primary tabular-nums",children:f})]}),a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Quadras em Uso"}),o?a.jsx("div",{className:"h-6 w-12 bg-white/5 rounded animate-pulse"}):a.jsx("span",{className:"font-bold text-success tabular-nums",children:m})]}),a.jsxs("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Taxa de Ocupao"}),o?a.jsx("div",{className:"h-6 w-16 bg-white/5 rounded animate-pulse"}):a.jsxs("span",{className:`font-bold tabular-nums ${g>=70?"text-success":g>=40?"text-warning":"text-danger"}`,children:[g,"%"]})]})]})]})})]}),a.jsxs(Fr.div,{variants:BE,className:"relative grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-12 gap-4 items-stretch",children:[a.jsx("div",{className:"xl:col-span-3",children:a.jsx(Mz,{icon:Wi,title:"Faturamento do Dia",value:A(l),color:"success",className:"h-full",loading:o})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(Mz,{icon:zC,title:"Agend. Finalizados",value:`${d.finalizados} de ${d.total}`,color:"info",className:"h-full",loading:o})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(NUe,{className:"h-full",alerts:n})}),a.jsx("div",{className:"xl:col-span-3",children:a.jsx(CUe,{icon:eD,title:"Informaes da Loja",data:M,color:"purple",className:"h-full",loading:o})})]}),a.jsx(Fr.div,{variants:BE,className:"grid grid-cols-1 gap-4",children:a.jsx(SUe,{icon:Lm,title:"Resumo Financeiro",data:E,color:"brand",loading:o})})]})})}var EUe={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 ms",other:"cerca de {{count}} meses"},xMonths:{one:"1 ms",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},kUe=function(t,r,n){var s,o=EUe[t];return typeof o=="string"?s=o:r===1?s=o.one:s=o.other.replace("{{count}}",String(r)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"em "+s:"h "+s:s};const IUe=kUe;var OUe={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},TUe={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},DUe={full:"{{date}} 's' {{time}}",long:"{{date}} 's' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},MUe={date:Hv({formats:OUe,defaultWidth:"full"}),time:Hv({formats:TUe,defaultWidth:"full"}),dateTime:Hv({formats:DUe,defaultWidth:"full"})};const RUe=MUe;var FUe={lastWeek:function(t){var r=t.getUTCDay(),n=r===0||r===6?"ltimo":"ltima";return"'"+n+"' eeee 's' p"},yesterday:"'ontem s' p",today:"'hoje s' p",tomorrow:"'amanh s' p",nextWeek:"eeee 's' p",other:"P"},LUe=function(t,r,n,s){var o=FUe[t];return typeof o=="function"?o(r):o};const $Ue=LUe;var BUe={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},qUe={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},zUe={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},UUe={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","tera","quarta","quinta","sexta","sbado"],wide:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"]},VUe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"}},WUe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},HUe=function(t,r){var n=Number(t);return r?.unit==="week"?n+"":n+""},GUe={ordinalNumber:HUe,era:Af({values:BUe,defaultWidth:"wide"}),quarter:Af({values:qUe,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:Af({values:zUe,defaultWidth:"wide"}),day:Af({values:UUe,defaultWidth:"wide"}),dayPeriod:Af({values:VUe,defaultWidth:"wide",formattingValues:WUe,defaultFormattingWidth:"wide"})};const KUe=GUe;var XUe=/^(\d+)[o]?/i,YUe=/\d+/i,JUe={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},QUe={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},ZUe={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},eVe={any:[/1/i,/2/i,/3/i,/4/i]},tVe={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|maro|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},rVe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},nVe={narrow:/^(dom|[23456]?|s[a]b)/i,short:/^(dom|[23456]?|s[a]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a]b)/i,wide:/^(domingo|(segunda|ter[c]a|quarta|quinta|sexta)([- ]feira)?|s[a]bado)/i},aVe={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a]b/i]},sVe={narrow:/^(a|p|mn|md|(da) (manh|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh|tarde|noite))/i},oVe={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},iVe={ordinalNumber:VY({matchPattern:XUe,parsePattern:YUe,valueCallback:function(t){return parseInt(t,10)}}),era:Pf({matchPatterns:JUe,defaultMatchWidth:"wide",parsePatterns:QUe,defaultParseWidth:"any"}),quarter:Pf({matchPatterns:ZUe,defaultMatchWidth:"wide",parsePatterns:eVe,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Pf({matchPatterns:tVe,defaultMatchWidth:"wide",parsePatterns:rVe,defaultParseWidth:"any"}),day:Pf({matchPatterns:nVe,defaultMatchWidth:"wide",parsePatterns:aVe,defaultParseWidth:"any"}),dayPeriod:Pf({matchPatterns:sVe,defaultMatchWidth:"any",parsePatterns:oVe,defaultParseWidth:"any"})};const lVe=iVe;var cVe={code:"pt-BR",formatDistance:IUe,formatLong:RUe,formatRelative:$Ue,localize:KUe,match:lVe,options:{weekStartsOn:0,firstWeekContainsDate:1}};const $a=cVe;var ns=function(){return ns=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},ns.apply(this,arguments)};function dVe(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Wee(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function pj(e){return e.mode==="multiple"}function gj(e){return e.mode==="range"}function lA(e){return e.mode==="single"}var uVe={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function fVe(e,t){return dr(e,"LLLL y",t)}function mVe(e,t){return dr(e,"d",t)}function hVe(e,t){return dr(e,"LLLL",t)}function pVe(e){return"".concat(e)}function gVe(e,t){return dr(e,"cccccc",t)}function xVe(e,t){return dr(e,"yyyy",t)}var vVe=Object.freeze({__proto__:null,formatCaption:fVe,formatDay:mVe,formatMonthCaption:hVe,formatWeekNumber:pVe,formatWeekdayName:gVe,formatYearCaption:xVe}),yVe=function(e,t,r){return dr(e,"do MMMM (EEEE)",r)},bVe=function(){return"Month: "},wVe=function(){return"Go to next month"},jVe=function(){return"Go to previous month"},_Ve=function(e,t){return dr(e,"cccc",t)},NVe=function(e){return"Week n. ".concat(e)},SVe=function(){return"Year: "},CVe=Object.freeze({__proto__:null,labelDay:yVe,labelMonthDropdown:bVe,labelNext:wVe,labelPrevious:jVe,labelWeekNumber:NVe,labelWeekday:_Ve,labelYearDropdown:SVe});function AVe(){var e="buttons",t=uVe,r=WY,n={},s={},o=1,i={},l=new Date;return{captionLayout:e,classNames:t,formatters:vVe,labels:CVe,locale:r,modifiersClassNames:n,modifiers:s,numberOfMonths:o,styles:i,today:l,mode:"default"}}function PVe(e){var t=e.fromYear,r=e.toYear,n=e.fromMonth,s=e.toMonth,o=e.fromDate,i=e.toDate;return n?o=wc(n):t&&(o=new Date(t,0,1)),s?i=h5(s):r&&(i=new Date(r,11,31)),{fromDate:o?Po(o):void 0,toDate:i?Po(i):void 0}}var Hee=p.createContext(void 0);function EVe(e){var t,r=e.initialProps,n=AVe(),s=PVe(r),o=s.fromDate,i=s.toDate,l=(t=r.captionLayout)!==null&&t!==void 0?t:n.captionLayout;l!=="buttons"&&(!o||!i)&&(l="buttons");var c;(lA(r)||pj(r)||gj(r))&&(c=r.onSelect);var d=ns(ns(ns({},n),r),{captionLayout:l,classNames:ns(ns({},n.classNames),r.classNames),components:ns({},r.components),formatters:ns(ns({},n.formatters),r.formatters),fromDate:o,labels:ns(ns({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:ns(ns({},n.modifiers),r.modifiers),modifiersClassNames:ns(ns({},n.modifiersClassNames),r.modifiersClassNames),onSelect:c,styles:ns(ns({},n.styles),r.styles),toDate:i});return a.jsx(Hee.Provider,{value:d,children:e.children})}function Do(){var e=p.useContext(Hee);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function Gee(e){var t=Do(),r=t.locale,n=t.classNames,s=t.styles,o=t.formatters.formatCaption;return a.jsx("div",{className:n.caption_label,style:s.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:r})})}function kVe(e){return a.jsx("svg",ns({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:a.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Kee(e){var t,r,n=e.onChange,s=e.value,o=e.children,i=e.caption,l=e.className,c=e.style,d=Do(),u=(r=(t=d.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:kVe;return a.jsxs("div",{className:l,style:c,children:[a.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),a.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:s,onChange:n,children:o}),a.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[i,a.jsx(u,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function IVe(e){var t,r=Do(),n=r.fromDate,s=r.toDate,o=r.styles,i=r.locale,l=r.formatters.formatMonthCaption,c=r.classNames,d=r.components,u=r.labels.labelMonthDropdown;if(!n)return a.jsx(a.Fragment,{});if(!s)return a.jsx(a.Fragment,{});var f=[];if(xje(n,s))for(var h=wc(n),m=n.getMonth();m<=s.getMonth();m++)f.push(dE(h,m));else for(var h=wc(new Date),m=0;m<=11;m++)f.push(dE(h,m));var x=function(v){var y=Number(v.target.value),b=dE(wc(e.displayMonth),y);e.onChange(b)},g=(t=d?.Dropdown)!==null&&t!==void 0?t:Kee;return a.jsx(g,{name:"months","aria-label":u(),className:c.dropdown_month,style:o.dropdown_month,onChange:x,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:f.map(function(v){return a.jsx("option",{value:v.getMonth(),children:l(v,{locale:i})},v.getMonth())})})}function OVe(e){var t,r=e.displayMonth,n=Do(),s=n.fromDate,o=n.toDate,i=n.locale,l=n.styles,c=n.classNames,d=n.components,u=n.formatters.formatYearCaption,f=n.labels.labelYearDropdown,h=[];if(!s)return a.jsx(a.Fragment,{});if(!o)return a.jsx(a.Fragment,{});for(var m=s.getFullYear(),x=o.getFullYear(),g=m;g<=x;g++)h.push(v8(Gwe(new Date),g));var v=function(b){var w=v8(wc(r),Number(b.target.value));e.onChange(w)},y=(t=d?.Dropdown)!==null&&t!==void 0?t:Kee;return a.jsx(y,{name:"years","aria-label":f(),className:c.dropdown_year,style:l.dropdown_year,onChange:v,value:r.getFullYear(),caption:u(r,{locale:i}),children:h.map(function(b){return a.jsx("option",{value:b.getFullYear(),children:u(b,{locale:i})},b.getFullYear())})})}function TVe(e,t){var r=p.useState(e),n=r[0],s=r[1],o=t===void 0?n:t;return[o,s]}function DVe(e){var t=e.month,r=e.defaultMonth,n=e.today,s=t||r||n||new Date,o=e.toDate,i=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(o&&Uw(o,s)<0){var d=-1*(c-1);s=lf(o,d)}return i&&Uw(s,i)<0&&(s=i),wc(s)}function MVe(){var e=Do(),t=DVe(e),r=TVe(t,e.month),n=r[0],s=r[1],o=function(i){var l;if(!e.disableNavigation){var c=wc(i);s(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[n,o]}function RVe(e,t){for(var r=t.reverseMonths,n=t.numberOfMonths,s=wc(e),o=wc(lf(s,n)),i=Uw(o,s),l=[],c=0;c<i;c++){var d=lf(s,c);l.push(d)}return r&&(l=l.reverse()),l}function FVe(e,t){if(!t.disableNavigation){var r=t.toDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=n?o:1,l=wc(e);if(!r)return lf(l,i);var c=Uw(r,e);if(!(c<o))return lf(l,i)}}function LVe(e,t){if(!t.disableNavigation){var r=t.fromDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=n?o:1,l=wc(e);if(!r)return lf(l,-i);var c=Uw(l,r);if(!(c<=0))return lf(l,-i)}}var Xee=p.createContext(void 0);function $Ve(e){var t=Do(),r=MVe(),n=r[0],s=r[1],o=RVe(n,t),i=FVe(n,t),l=LVe(n,t),c=function(f){return o.some(function(h){return eM(f,h)})},d=function(f,h){c(f)||(h&&HY(f,h)?s(lf(f,1+t.numberOfMonths*-1)):s(f))},u={currentMonth:n,displayMonths:o,goToMonth:s,goToDate:d,previousMonth:l,nextMonth:i,isDateDisplayed:c};return a.jsx(Xee.Provider,{value:u,children:e.children})}function xj(){var e=p.useContext(Xee);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function Rz(e){var t,r=Do(),n=r.classNames,s=r.styles,o=r.components,i=xj().goToMonth,l=function(u){i(lf(u,e.displayIndex?-e.displayIndex:0))},c=(t=o?.CaptionLabel)!==null&&t!==void 0?t:Gee,d=a.jsx(c,{id:e.id,displayMonth:e.displayMonth});return a.jsxs("div",{className:n.caption_dropdowns,style:s.caption_dropdowns,children:[a.jsx("div",{className:n.vhidden,children:d}),a.jsx(IVe,{onChange:l,displayMonth:e.displayMonth}),a.jsx(OVe,{onChange:l,displayMonth:e.displayMonth})]})}function BVe(e){return a.jsx("svg",ns({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:a.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function qVe(e){return a.jsx("svg",ns({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:a.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var HS=p.forwardRef(function(e,t){var r=Do(),n=r.classNames,s=r.styles,o=[n.button_reset,n.button];e.className&&o.push(e.className);var i=o.join(" "),l=ns(ns({},s.button_reset),s.button);return e.style&&Object.assign(l,e.style),a.jsx("button",ns({},e,{ref:t,type:"button",className:i,style:l}))});function zVe(e){var t,r,n=Do(),s=n.dir,o=n.locale,i=n.classNames,l=n.styles,c=n.labels,d=c.labelPrevious,u=c.labelNext,f=n.components;if(!e.nextMonth&&!e.previousMonth)return a.jsx(a.Fragment,{});var h=d(e.previousMonth,{locale:o}),m=[i.nav_button,i.nav_button_previous].join(" "),x=u(e.nextMonth,{locale:o}),g=[i.nav_button,i.nav_button_next].join(" "),v=(t=f?.IconRight)!==null&&t!==void 0?t:qVe,y=(r=f?.IconLeft)!==null&&r!==void 0?r:BVe;return a.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&a.jsx(HS,{name:"previous-month","aria-label":h,className:m,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:s==="rtl"?a.jsx(v,{className:i.nav_icon,style:l.nav_icon}):a.jsx(y,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&a.jsx(HS,{name:"next-month","aria-label":x,className:g,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:s==="rtl"?a.jsx(y,{className:i.nav_icon,style:l.nav_icon}):a.jsx(v,{className:i.nav_icon,style:l.nav_icon})})]})}function Fz(e){var t=Do().numberOfMonths,r=xj(),n=r.previousMonth,s=r.nextMonth,o=r.goToMonth,i=r.displayMonths,l=i.findIndex(function(x){return eM(e.displayMonth,x)}),c=l===0,d=l===i.length-1,u=t>1&&(c||!d),f=t>1&&(d||!c),h=function(){n&&o(n)},m=function(){s&&o(s)};return a.jsx(zVe,{displayMonth:e.displayMonth,hideNext:u,hidePrevious:f,nextMonth:s,previousMonth:n,onPreviousClick:h,onNextClick:m})}function UVe(e){var t,r=Do(),n=r.classNames,s=r.disableNavigation,o=r.styles,i=r.captionLayout,l=r.components,c=(t=l?.CaptionLabel)!==null&&t!==void 0?t:Gee,d;return s?d=a.jsx(c,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?d=a.jsx(Rz,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?d=a.jsxs(a.Fragment,{children:[a.jsx(Rz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),a.jsx(Fz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):d=a.jsxs(a.Fragment,{children:[a.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),a.jsx(Fz,{displayMonth:e.displayMonth,id:e.id})]}),a.jsx("div",{className:n.caption,style:o.caption,children:d})}function VVe(e){var t=Do(),r=t.footer,n=t.styles,s=t.classNames.tfoot;return r?a.jsx("tfoot",{className:s,style:n.tfoot,children:a.jsx("tr",{children:a.jsx("td",{colSpan:8,children:r})})}):a.jsx(a.Fragment,{})}function WVe(e,t,r){for(var n=r?Qg(new Date):wu(new Date,{locale:e,weekStartsOn:t}),s=[],o=0;o<7;o++){var i=Es(n,o);s.push(i)}return s}function HVe(){var e=Do(),t=e.classNames,r=e.styles,n=e.showWeekNumber,s=e.locale,o=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=WVe(s,o,i);return a.jsxs("tr",{style:r.head_row,className:t.head_row,children:[n&&a.jsx("td",{style:r.head_cell,className:t.head_cell}),d.map(function(u,f){return a.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":c(u,{locale:s}),children:l(u,{locale:s})},f)})]})}function GVe(){var e,t=Do(),r=t.classNames,n=t.styles,s=t.components,o=(e=s?.HeadRow)!==null&&e!==void 0?e:HVe;return a.jsx("thead",{style:n.head,className:r.head,children:a.jsx(o,{})})}function KVe(e){var t=Do(),r=t.locale,n=t.formatters.formatDay;return a.jsx(a.Fragment,{children:n(e.date,{locale:r})})}var cR=p.createContext(void 0);function XVe(e){if(!pj(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return a.jsx(cR.Provider,{value:t,children:e.children})}return a.jsx(YVe,{initialProps:e.initialProps,children:e.children})}function YVe(e){var t=e.initialProps,r=e.children,n=t.selected,s=t.min,o=t.max,i=function(d,u,f){var h,m;(h=t.onDayClick)===null||h===void 0||h.call(t,d,u,f);var x=!!(u.selected&&s&&n?.length===s);if(!x){var g=!!(!u.selected&&o&&n?.length===o);if(!g){var v=n?Wee([],n,!0):[];if(u.selected){var y=v.findIndex(function(b){return Kl(d,b)});v.splice(y,1)}else v.push(d);(m=t.onSelect)===null||m===void 0||m.call(t,v,d,u,f)}}},l={disabled:[]};n&&l.disabled.push(function(d){var u=o&&n.length>o-1,f=n.some(function(h){return Kl(h,d)});return!!(u&&!f)});var c={selected:n,onDayClick:i,modifiers:l};return a.jsx(cR.Provider,{value:c,children:r})}function dR(){var e=p.useContext(cR);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function JVe(e,t){var r=t||{},n=r.from,s=r.to;return n&&s?Kl(s,e)&&Kl(n,e)?void 0:Kl(s,e)?{from:s,to:void 0}:Kl(n,e)?void 0:jO(n,e)?{from:e,to:s}:{from:n,to:e}:s?jO(e,s)?{from:s,to:e}:{from:e,to:s}:n?HY(e,n)?{from:e,to:n}:{from:n,to:e}:{from:e,to:void 0}}var uR=p.createContext(void 0);function QVe(e){if(!gj(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return a.jsx(uR.Provider,{value:t,children:e.children})}return a.jsx(ZVe,{initialProps:e.initialProps,children:e.children})}function ZVe(e){var t=e.initialProps,r=e.children,n=t.selected,s=n||{},o=s.from,i=s.to,l=t.min,c=t.max,d=function(m,x,g){var v,y;(v=t.onDayClick)===null||v===void 0||v.call(t,m,x,g);var b=JVe(m,n);(y=t.onSelect)===null||y===void 0||y.call(t,b,m,x,g)},u={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(u.range_start=[o],i?(u.range_end=[i],Kl(o,i)||(u.range_middle=[{after:o,before:i}])):u.range_end=[o]):i&&(u.range_start=[i],u.range_end=[i]),l&&(o&&!i&&u.disabled.push({after:Gv(o,l-1),before:Es(o,l-1)}),o&&i&&u.disabled.push({after:o,before:Es(o,l-1)}),!o&&i&&u.disabled.push({after:Gv(i,l-1),before:Es(i,l-1)})),c){if(o&&!i&&(u.disabled.push({before:Es(o,-c+1)}),u.disabled.push({after:Es(o,c-1)})),o&&i){var f=Of(i,o)+1,h=c-f;u.disabled.push({before:Gv(o,h)}),u.disabled.push({after:Es(i,h)})}!o&&i&&(u.disabled.push({before:Es(i,-c+1)}),u.disabled.push({after:Es(i,c-1)}))}return a.jsx(uR.Provider,{value:{selected:n,onDayClick:d,modifiers:u},children:r})}function fR(){var e=p.useContext(uR);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function F2(e){return Array.isArray(e)?Wee([],e,!0):e!==void 0?[e]:[]}function eWe(e){var t={};return Object.entries(e).forEach(function(r){var n=r[0],s=r[1];t[n]=F2(s)}),t}var cf;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(cf||(cf={}));var tWe=cf.Selected,im=cf.Disabled,rWe=cf.Hidden,nWe=cf.Today,qE=cf.RangeEnd,zE=cf.RangeMiddle,UE=cf.RangeStart,aWe=cf.Outside;function sWe(e,t,r){var n,s=(n={},n[tWe]=F2(e.selected),n[im]=F2(e.disabled),n[rWe]=F2(e.hidden),n[nWe]=[e.today],n[qE]=[],n[zE]=[],n[UE]=[],n[aWe]=[],n);return e.fromDate&&s[im].push({before:e.fromDate}),e.toDate&&s[im].push({after:e.toDate}),pj(e)?s[im]=s[im].concat(t.modifiers[im]):gj(e)&&(s[im]=s[im].concat(r.modifiers[im]),s[UE]=r.modifiers[UE],s[zE]=r.modifiers[zE],s[qE]=r.modifiers[qE]),s}var Yee=p.createContext(void 0);function oWe(e){var t=Do(),r=dR(),n=fR(),s=sWe(t,r,n),o=eWe(t.modifiers),i=ns(ns({},s),o);return a.jsx(Yee.Provider,{value:i,children:e.children})}function Jee(){var e=p.useContext(Yee);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function iWe(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function lWe(e){return!!(e&&typeof e=="object"&&"from"in e)}function cWe(e){return!!(e&&typeof e=="object"&&"after"in e)}function dWe(e){return!!(e&&typeof e=="object"&&"before"in e)}function uWe(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function fWe(e,t){var r,n=t.from,s=t.to;if(n&&s){var o=Of(s,n)<0;o&&(r=[s,n],n=r[0],s=r[1]);var i=Of(e,n)>=0&&Of(s,e)>=0;return i}return s?Kl(s,e):n?Kl(n,e):!1}function mWe(e){return QD(e)}function hWe(e){return Array.isArray(e)&&e.every(QD)}function pWe(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(mWe(r))return Kl(e,r);if(hWe(r))return r.includes(e);if(lWe(r))return fWe(e,r);if(uWe(r))return r.dayOfWeek.includes(e.getDay());if(iWe(r)){var n=Of(r.before,e),s=Of(r.after,e),o=n>0,i=s<0,l=jO(r.before,r.after);return l?i&&o:o||i}return cWe(r)?Of(e,r.after)>0:dWe(r)?Of(r.before,e)>0:typeof r=="function"?r(e):!1})}function mR(e,t,r){var n=Object.keys(t).reduce(function(o,i){var l=t[i];return pWe(e,l)&&o.push(i),o},[]),s={};return n.forEach(function(o){return s[o]=!0}),r&&!eM(e,r)&&(s.outside=!0),s}function gWe(e,t){for(var r=wc(e[0]),n=h5(e[e.length-1]),s,o,i=r;i<=n;){var l=mR(i,t),c=!l.disabled&&!l.hidden;if(!c){i=Es(i,1);continue}if(l.selected)return i;l.today&&!o&&(o=i),s||(s=i),i=Es(i,1)}return o||s}var xWe=365;function Qee(e,t){var r=t.moveBy,n=t.direction,s=t.context,o=t.modifiers,i=t.retry,l=i===void 0?{count:0,lastFocused:e}:i,c=s.weekStartsOn,d=s.fromDate,u=s.toDate,f=s.locale,h={day:Es,week:wO,month:lf,year:Bwe,startOfWeek:function(v){return s.ISOWeek?Qg(v):wu(v,{locale:f,weekStartsOn:c})},endOfWeek:function(v){return s.ISOWeek?BY(v):ZD(v,{locale:f,weekStartsOn:c})}},m=h[r](e,n==="after"?1:-1);n==="before"&&d?m=qwe([d,m]):n==="after"&&u&&(m=zwe([u,m]));var x=!0;if(o){var g=mR(m,o);x=!g.disabled&&!g.hidden}return x?m:l.count>xWe?l.lastFocused:Qee(m,{moveBy:r,direction:n,context:s,modifiers:o,retry:ns(ns({},l),{count:l.count+1})})}var Zee=p.createContext(void 0);function vWe(e){var t=xj(),r=Jee(),n=p.useState(),s=n[0],o=n[1],i=p.useState(),l=i[0],c=i[1],d=gWe(t.displayMonths,r),u=s??(l&&t.isDateDisplayed(l))?l:d,f=function(){c(s),o(void 0)},h=function(v){o(v)},m=Do(),x=function(v,y){if(s){var b=Qee(s,{moveBy:v,direction:y,context:m,modifiers:r});Kl(s,b)||(t.goToDate(b,s),h(b))}},g={focusedDay:s,focusTarget:u,blur:f,focus:h,focusDayAfter:function(){return x("day","after")},focusDayBefore:function(){return x("day","before")},focusWeekAfter:function(){return x("week","after")},focusWeekBefore:function(){return x("week","before")},focusMonthBefore:function(){return x("month","before")},focusMonthAfter:function(){return x("month","after")},focusYearBefore:function(){return x("year","before")},focusYearAfter:function(){return x("year","after")},focusStartOfWeek:function(){return x("startOfWeek","before")},focusEndOfWeek:function(){return x("endOfWeek","after")}};return a.jsx(Zee.Provider,{value:g,children:e.children})}function hR(){var e=p.useContext(Zee);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function yWe(e,t){var r=Jee(),n=mR(e,r,t);return n}var pR=p.createContext(void 0);function bWe(e){if(!lA(e.initialProps)){var t={selected:void 0};return a.jsx(pR.Provider,{value:t,children:e.children})}return a.jsx(wWe,{initialProps:e.initialProps,children:e.children})}function wWe(e){var t=e.initialProps,r=e.children,n=function(o,i,l){var c,d,u;if((c=t.onDayClick)===null||c===void 0||c.call(t,o,i,l),i.selected&&!t.required){(d=t.onSelect)===null||d===void 0||d.call(t,void 0,o,i,l);return}(u=t.onSelect)===null||u===void 0||u.call(t,o,o,i,l)},s={selected:t.selected,onDayClick:n};return a.jsx(pR.Provider,{value:s,children:r})}function ete(){var e=p.useContext(pR);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function jWe(e,t){var r=Do(),n=ete(),s=dR(),o=fR(),i=hR(),l=i.focusDayAfter,c=i.focusDayBefore,d=i.focusWeekAfter,u=i.focusWeekBefore,f=i.blur,h=i.focus,m=i.focusMonthBefore,x=i.focusMonthAfter,g=i.focusYearBefore,v=i.focusYearAfter,y=i.focusStartOfWeek,b=i.focusEndOfWeek,w=function(z){var F,V,me,be;lA(r)?(F=n.onDayClick)===null||F===void 0||F.call(n,e,t,z):pj(r)?(V=s.onDayClick)===null||V===void 0||V.call(s,e,t,z):gj(r)?(me=o.onDayClick)===null||me===void 0||me.call(o,e,t,z):(be=r.onDayClick)===null||be===void 0||be.call(r,e,t,z)},j=function(z){var F;h(e),(F=r.onDayFocus)===null||F===void 0||F.call(r,e,t,z)},_=function(z){var F;f(),(F=r.onDayBlur)===null||F===void 0||F.call(r,e,t,z)},C=function(z){var F;(F=r.onDayMouseEnter)===null||F===void 0||F.call(r,e,t,z)},E=function(z){var F;(F=r.onDayMouseLeave)===null||F===void 0||F.call(r,e,t,z)},S=function(z){var F;(F=r.onDayPointerEnter)===null||F===void 0||F.call(r,e,t,z)},A=function(z){var F;(F=r.onDayPointerLeave)===null||F===void 0||F.call(r,e,t,z)},M=function(z){var F;(F=r.onDayTouchCancel)===null||F===void 0||F.call(r,e,t,z)},O=function(z){var F;(F=r.onDayTouchEnd)===null||F===void 0||F.call(r,e,t,z)},I=function(z){var F;(F=r.onDayTouchMove)===null||F===void 0||F.call(r,e,t,z)},T=function(z){var F;(F=r.onDayTouchStart)===null||F===void 0||F.call(r,e,t,z)},k=function(z){var F;(F=r.onDayKeyUp)===null||F===void 0||F.call(r,e,t,z)},q=function(z){var F;switch(z.key){case"ArrowLeft":z.preventDefault(),z.stopPropagation(),r.dir==="rtl"?l():c();break;case"ArrowRight":z.preventDefault(),z.stopPropagation(),r.dir==="rtl"?c():l();break;case"ArrowDown":z.preventDefault(),z.stopPropagation(),d();break;case"ArrowUp":z.preventDefault(),z.stopPropagation(),u();break;case"PageUp":z.preventDefault(),z.stopPropagation(),z.shiftKey?g():m();break;case"PageDown":z.preventDefault(),z.stopPropagation(),z.shiftKey?v():x();break;case"Home":z.preventDefault(),z.stopPropagation(),y();break;case"End":z.preventDefault(),z.stopPropagation(),b();break}(F=r.onDayKeyDown)===null||F===void 0||F.call(r,e,t,z)},B={onClick:w,onFocus:j,onBlur:_,onKeyDown:q,onKeyUp:k,onMouseEnter:C,onMouseLeave:E,onPointerEnter:S,onPointerLeave:A,onTouchCancel:M,onTouchEnd:O,onTouchMove:I,onTouchStart:T};return B}function _We(){var e=Do(),t=ete(),r=dR(),n=fR(),s=lA(e)?t.selected:pj(e)?r.selected:gj(e)?n.selected:void 0;return s}function NWe(e){return Object.values(cf).includes(e)}function SWe(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(n){var s=e.modifiersClassNames[n];if(s)r.push(s);else if(NWe(n)){var o=e.classNames["day_".concat(n)];o&&r.push(o)}}),r}function CWe(e,t){var r=ns({},e.styles.day);return Object.keys(t).forEach(function(n){var s;r=ns(ns({},r),(s=e.modifiersStyles)===null||s===void 0?void 0:s[n])}),r}function AWe(e,t,r){var n,s,o,i=Do(),l=hR(),c=yWe(e,t),d=jWe(e,c),u=_We(),f=!!(i.onDayClick||i.mode!=="default");p.useEffect(function(){var C;c.outside||l.focusedDay&&f&&Kl(l.focusedDay,e)&&((C=r.current)===null||C===void 0||C.focus())},[l.focusedDay,e,r,f,c.outside]);var h=SWe(i,c).join(" "),m=CWe(i,c),x=!!(c.outside&&!i.showOutsideDays||c.hidden),g=(o=(s=i.components)===null||s===void 0?void 0:s.DayContent)!==null&&o!==void 0?o:KVe,v=a.jsx(g,{date:e,displayMonth:t,activeModifiers:c}),y={style:m,className:h,children:v,role:"gridcell"},b=l.focusTarget&&Kl(l.focusTarget,e)&&!c.outside,w=l.focusedDay&&Kl(l.focusedDay,e),j=ns(ns(ns({},y),(n={disabled:c.disabled,role:"gridcell"},n["aria-selected"]=c.selected,n.tabIndex=w||b?0:-1,n)),d),_={isButton:f,isHidden:x,activeModifiers:c,selectedDays:u,buttonProps:j,divProps:y};return _}function PWe(e){var t=p.useRef(null),r=AWe(e.date,e.displayMonth,t);return r.isHidden?a.jsx("div",{role:"gridcell"}):r.isButton?a.jsx(HS,ns({name:"day",ref:t},r.buttonProps)):a.jsx("div",ns({},r.divProps))}function EWe(e){var t=e.number,r=e.dates,n=Do(),s=n.onWeekNumberClick,o=n.styles,i=n.classNames,l=n.locale,c=n.labels.labelWeekNumber,d=n.formatters.formatWeekNumber,u=d(Number(t),{locale:l});if(!s)return a.jsx("span",{className:i.weeknumber,style:o.weeknumber,children:u});var f=c(Number(t),{locale:l}),h=function(m){s(t,r,m)};return a.jsx(HS,{name:"week-number","aria-label":f,className:i.weeknumber,style:o.weeknumber,onClick:h,children:u})}function kWe(e){var t,r,n=Do(),s=n.styles,o=n.classNames,i=n.showWeekNumber,l=n.components,c=(t=l?.Day)!==null&&t!==void 0?t:PWe,d=(r=l?.WeekNumber)!==null&&r!==void 0?r:EWe,u;return i&&(u=a.jsx("td",{className:o.cell,style:s.cell,children:a.jsx(d,{number:e.weekNumber,dates:e.dates})})),a.jsxs("tr",{className:o.row,style:s.row,children:[u,e.dates.map(function(f){return a.jsx("td",{className:o.cell,style:s.cell,role:"presentation",children:a.jsx(c,{displayMonth:e.displayMonth,date:f})},oje(f))})]})}function Lz(e,t,r){for(var n=r?.ISOWeek?BY(t):ZD(t,r),s=r?.ISOWeek?Qg(e):wu(e,r),o=Of(n,s),i=[],l=0;l<=o;l++)i.push(Es(s,l));var c=i.reduce(function(d,u){var f=r?.ISOWeek?aje(u):dje(u,r),h=d.find(function(m){return m.weekNumber===f});return h?(h.dates.push(u),d):(d.push({weekNumber:f,dates:[u]}),d)},[]);return c}function IWe(e,t){var r=Lz(wc(e),h5(e),t);if(t?.useFixedWeeks){var n=fje(e,t);if(n<6){var s=r[r.length-1],o=s.dates[s.dates.length-1],i=wO(o,6-n),l=Lz(wO(o,1),i,t);r.push.apply(r,l)}}return r}function OWe(e){var t,r,n,s=Do(),o=s.locale,i=s.classNames,l=s.styles,c=s.hideHead,d=s.fixedWeeks,u=s.components,f=s.weekStartsOn,h=s.firstWeekContainsDate,m=s.ISOWeek,x=IWe(e.displayMonth,{useFixedWeeks:!!d,ISOWeek:m,locale:o,weekStartsOn:f,firstWeekContainsDate:h}),g=(t=u?.Head)!==null&&t!==void 0?t:GVe,v=(r=u?.Row)!==null&&r!==void 0?r:kWe,y=(n=u?.Footer)!==null&&n!==void 0?n:VVe;return a.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&a.jsx(g,{}),a.jsx("tbody",{className:i.tbody,style:l.tbody,children:x.map(function(b){return a.jsx(v,{displayMonth:e.displayMonth,dates:b.dates,weekNumber:b.weekNumber},b.weekNumber)})}),a.jsx(y,{displayMonth:e.displayMonth})]})}function TWe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var DWe=TWe()?p.useLayoutEffect:p.useEffect,VE=!1,MWe=0;function $z(){return"react-day-picker-".concat(++MWe)}function RWe(e){var t,r=e??(VE?$z():null),n=p.useState(r),s=n[0],o=n[1];return DWe(function(){s===null&&o($z())},[]),p.useEffect(function(){VE===!1&&(VE=!0)},[]),(t=e??s)!==null&&t!==void 0?t:void 0}function FWe(e){var t,r,n=Do(),s=n.dir,o=n.classNames,i=n.styles,l=n.components,c=xj().displayMonths,d=RWe(n.id?"".concat(n.id,"-").concat(e.displayIndex):void 0),u=n.id?"".concat(n.id,"-grid-").concat(e.displayIndex):void 0,f=[o.month],h=i.month,m=e.displayIndex===0,x=e.displayIndex===c.length-1,g=!m&&!x;s==="rtl"&&(t=[m,x],x=t[0],m=t[1]),m&&(f.push(o.caption_start),h=ns(ns({},h),i.caption_start)),x&&(f.push(o.caption_end),h=ns(ns({},h),i.caption_end)),g&&(f.push(o.caption_between),h=ns(ns({},h),i.caption_between));var v=(r=l?.Caption)!==null&&r!==void 0?r:UVe;return a.jsxs("div",{className:f.join(" "),style:h,children:[a.jsx(v,{id:d,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),a.jsx(OWe,{id:u,"aria-labelledby":d,displayMonth:e.displayMonth})]},e.displayIndex)}function LWe(e){var t=Do(),r=t.classNames,n=t.styles;return a.jsx("div",{className:r.months,style:n.months,children:e.children})}function $We(e){var t,r,n=e.initialProps,s=Do(),o=hR(),i=xj(),l=p.useState(!1),c=l[0],d=l[1];p.useEffect(function(){s.initialFocus&&o.focusTarget&&(c||(o.focus(o.focusTarget),d(!0)))},[s.initialFocus,c,o.focus,o.focusTarget,o]);var u=[s.classNames.root,s.className];s.numberOfMonths>1&&u.push(s.classNames.multiple_months),s.showWeekNumber&&u.push(s.classNames.with_weeknumber);var f=ns(ns({},s.styles.root),s.style),h=Object.keys(n).filter(function(x){return x.startsWith("data-")}).reduce(function(x,g){var v;return ns(ns({},x),(v={},v[g]=n[g],v))},{}),m=(r=(t=n.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:LWe;return a.jsx("div",ns({className:u.join(" "),style:f,dir:s.dir,id:s.id,nonce:n.nonce,title:n.title,lang:n.lang},h,{children:a.jsx(m,{children:i.displayMonths.map(function(x,g){return a.jsx(FWe,{displayIndex:g,displayMonth:x},g)})})}))}function BWe(e){var t=e.children,r=dVe(e,["children"]);return a.jsx(EVe,{initialProps:r,children:a.jsx($Ve,{children:a.jsx(bWe,{initialProps:r,children:a.jsx(XVe,{initialProps:r,children:a.jsx(QVe,{initialProps:r,children:a.jsx(oWe,{children:a.jsx(vWe,{children:t})})})})})})})}function e3(e){return a.jsx(BWe,ns({},e,{children:a.jsx($We,{initialProps:e})}))}function ei({className:e,classNames:t,showOutsideDays:r=!0,weekStartsOn:n=1,locale:s=$a,...o}){const i=["dom","seg","ter","qua","qui","sex","sb"];return a.jsx(e3,{showOutsideDays:r,weekStartsOn:n,locale:s,className:Pr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Pr(Fw({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Pr(Fw({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},formatters:{formatWeekdayName:(l,c)=>i[l.getDay()]},components:{IconLeft:({...l})=>a.jsx(zI,{className:"h-4 w-4"}),IconRight:({...l})=>a.jsx(Kg,{className:"h-4 w-4"})},...o})}ei.displayName="Calendar";var tte="AlertDialog",[qWe,jct]=Nu(tte,[VX]),eh=VX(),rte=e=>{const{__scopeAlertDialog:t,...r}=e,n=eh(t);return a.jsx(oY,{...n,...r,modal:!0})};rte.displayName=tte;var zWe="AlertDialogTrigger",nte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=eh(r);return a.jsx(F0e,{...s,...n,ref:t})});nte.displayName=zWe;var UWe="AlertDialogPortal",ate=e=>{const{__scopeAlertDialog:t,...r}=e,n=eh(t);return a.jsx(iY,{...n,...r})};ate.displayName=UWe;var VWe="AlertDialogOverlay",ste=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=eh(r);return a.jsx(zD,{...s,...n,ref:t})});ste.displayName=VWe;var Jv="AlertDialogContent",[WWe,HWe]=qWe(Jv),GWe=Ige("AlertDialogContent"),ote=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...s}=e,o=eh(r),i=p.useRef(null),l=$s(t,i),c=p.useRef(null);return a.jsx(T0e,{contentName:Jv,titleName:ite,docsSlug:"alert-dialog",children:a.jsx(WWe,{scope:r,cancelRef:c,children:a.jsxs(UD,{role:"alertdialog",...o,...s,ref:l,onOpenAutoFocus:aa(s.onOpenAutoFocus,d=>{d.preventDefault(),c.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[a.jsx(GWe,{children:n}),a.jsx(XWe,{contentRef:i})]})})})});ote.displayName=Jv;var ite="AlertDialogTitle",lte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=eh(r);return a.jsx(VD,{...s,...n,ref:t})});lte.displayName=ite;var cte="AlertDialogDescription",dte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=eh(r);return a.jsx(WD,{...s,...n,ref:t})});dte.displayName=cte;var KWe="AlertDialogAction",ute=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=eh(r);return a.jsx(l5,{...s,...n,ref:t})});ute.displayName=KWe;var fte="AlertDialogCancel",mte=p.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:s}=HWe(fte,r),o=eh(r),i=$s(t,s);return a.jsx(l5,{...o,...n,ref:i})});mte.displayName=fte;var XWe=({contentRef:e})=>{const t=`\`${Jv}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Jv}\` by passing a \`${cte}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Jv}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return p.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},YWe=rte,JWe=nte,QWe=ate,hte=ste,pte=ote,gte=ute,xte=mte,vte=lte,yte=dte;const Gu=YWe,_g=JWe,ZWe=QWe,bte=Ce.forwardRef(({className:e,...t},r)=>a.jsx(hte,{className:Pr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));bte.displayName=hte.displayName;const tu=Ce.forwardRef(({className:e,...t},r)=>a.jsxs(ZWe,{children:[a.jsx(bte,{}),a.jsx(pte,{ref:r,className:Pr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));tu.displayName=pte.displayName;const ru=({className:e,...t})=>a.jsx("div",{className:Pr("flex flex-col space-y-2 text-center sm:text-left",e),...t});ru.displayName="AlertDialogHeader";const nu=({className:e,...t})=>a.jsx("div",{className:Pr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});nu.displayName="AlertDialogFooter";const au=Ce.forwardRef(({className:e,...t},r)=>a.jsx(vte,{ref:r,className:Pr("text-lg font-semibold",e),...t}));au.displayName=vte.displayName;const su=Ce.forwardRef(({className:e,...t},r)=>a.jsx(yte,{ref:r,className:Pr("text-sm text-muted-foreground",e),...t}));su.displayName=yte.displayName;const Ku=Ce.forwardRef(({className:e,...t},r)=>a.jsx(gte,{ref:r,className:Pr(Fw(),e),...t}));Ku.displayName=gte.displayName;const ou=Ce.forwardRef(({className:e,...t},r)=>a.jsx(xte,{ref:r,className:Pr(Fw({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));ou.displayName=xte.displayName;function Bz(e,[t,r]){return Math.min(r,Math.max(t,e))}function cA(e){const t=e+"CollectionProvider",[r,n]=Nu(t),[s,o]=r(t,{collectionRef:{current:null},itemMap:new Map}),i=g=>{const{scope:v,children:y}=g,b=Ce.useRef(null),w=Ce.useRef(new Map).current;return a.jsx(s,{scope:v,itemMap:w,collectionRef:b,children:y})};i.displayName=t;const l=e+"CollectionSlot",c=pp(l),d=Ce.forwardRef((g,v)=>{const{scope:y,children:b}=g,w=o(l,y),j=$s(v,w.collectionRef);return a.jsx(c,{ref:j,children:b})});d.displayName=l;const u=e+"CollectionItemSlot",f="data-radix-collection-item",h=pp(u),m=Ce.forwardRef((g,v)=>{const{scope:y,children:b,...w}=g,j=Ce.useRef(null),_=$s(v,j),C=o(u,y);return Ce.useEffect(()=>(C.itemMap.set(j,{ref:j,...w}),()=>void C.itemMap.delete(j))),a.jsx(h,{[f]:"",ref:_,children:b})});m.displayName=u;function x(g){const v=o(e+"CollectionConsumer",g);return Ce.useCallback(()=>{const b=v.collectionRef.current;if(!b)return[];const w=Array.from(b.querySelectorAll(`[${f}]`));return Array.from(v.itemMap.values()).sort((C,E)=>w.indexOf(C.ref.current)-w.indexOf(E.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:i,Slot:d,ItemSlot:m},x,n]}var eHe=p.createContext(void 0);function dA(e){const t=p.useContext(eHe);return e||t||"ltr"}function wte(e){const t=p.useRef({value:e,previous:e});return p.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var jte=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),tHe="VisuallyHidden",gR=p.forwardRef((e,t)=>a.jsx(Qa.span,{...e,ref:t,style:{...jte,...e.style}}));gR.displayName=tHe;var rHe=[" ","Enter","ArrowUp","ArrowDown"],nHe=[" ","Enter"],sx="Select",[uA,fA,aHe]=cA(sx),[_y,_ct]=Nu(sx,[aHe,sy]),mA=sy(),[sHe,Rp]=_y(sx),[oHe,iHe]=_y(sx),_te=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:s,onOpenChange:o,value:i,defaultValue:l,onValueChange:c,dir:d,name:u,autoComplete:f,disabled:h,required:m,form:x}=e,g=mA(t),[v,y]=p.useState(null),[b,w]=p.useState(null),[j,_]=p.useState(!1),C=dA(d),[E,S]=zm({prop:n,defaultProp:s??!1,onChange:o,caller:sx}),[A,M]=zm({prop:i,defaultProp:l,onChange:c,caller:sx}),O=p.useRef(null),I=v?x||!!v.closest("form"):!0,[T,k]=p.useState(new Set),q=Array.from(T).map(B=>B.props.value).join(";");return a.jsx(MD,{...g,children:a.jsxs(sHe,{required:m,scope:t,trigger:v,onTriggerChange:y,valueNode:b,onValueNodeChange:w,valueNodeHasChildren:j,onValueNodeHasChildrenChange:_,contentId:tf(),value:A,onValueChange:M,open:E,onOpenChange:S,dir:C,triggerPointerDownPosRef:O,disabled:h,children:[a.jsx(uA.Provider,{scope:t,children:a.jsx(oHe,{scope:e.__scopeSelect,onNativeOptionAdd:p.useCallback(B=>{k(z=>new Set(z).add(B))},[]),onNativeOptionRemove:p.useCallback(B=>{k(z=>{const F=new Set(z);return F.delete(B),F})},[]),children:r})}),I?a.jsxs(Wte,{"aria-hidden":!0,required:m,tabIndex:-1,name:u,autoComplete:f,value:A,onChange:B=>M(B.target.value),disabled:h,form:x,children:[A===void 0?a.jsx("option",{value:""}):null,Array.from(T)]},q):null]})})};_te.displayName=sx;var Nte="SelectTrigger",Ste=p.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...s}=e,o=mA(r),i=Rp(Nte,r),l=i.disabled||n,c=$s(t,i.onTriggerChange),d=fA(r),u=p.useRef("touch"),[f,h,m]=Gte(g=>{const v=d().filter(w=>!w.disabled),y=v.find(w=>w.value===i.value),b=Kte(v,g,y);b!==void 0&&i.onValueChange(b.value)}),x=g=>{l||(i.onOpenChange(!0),m()),g&&(i.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return a.jsx(r5,{asChild:!0,...o,children:a.jsx(Qa.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":Hte(i.value)?"":void 0,...s,ref:c,onClick:aa(s.onClick,g=>{g.currentTarget.focus(),u.current!=="mouse"&&x(g)}),onPointerDown:aa(s.onPointerDown,g=>{u.current=g.pointerType;const v=g.target;v.hasPointerCapture(g.pointerId)&&v.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(x(g),g.preventDefault())}),onKeyDown:aa(s.onKeyDown,g=>{const v=f.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&h(g.key),!(v&&g.key===" ")&&rHe.includes(g.key)&&(x(),g.preventDefault())})})})});Ste.displayName=Nte;var Cte="SelectValue",Ate=p.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,children:o,placeholder:i="",...l}=e,c=Rp(Cte,r),{onValueNodeHasChildrenChange:d}=c,u=o!==void 0,f=$s(t,c.onValueNodeChange);return kl(()=>{d(u)},[d,u]),a.jsx(Qa.span,{...l,ref:f,style:{pointerEvents:"none"},children:Hte(c.value)?a.jsx(a.Fragment,{children:i}):o})});Ate.displayName=Cte;var lHe="SelectIcon",Pte=p.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...s}=e;return a.jsx(Qa.span,{"aria-hidden":!0,...s,ref:t,children:n||""})});Pte.displayName=lHe;var cHe="SelectPortal",Ete=e=>a.jsx(oy,{asChild:!0,...e});Ete.displayName=cHe;var ox="SelectContent",kte=p.forwardRef((e,t)=>{const r=Rp(ox,e.__scopeSelect),[n,s]=p.useState();if(kl(()=>{s(new DocumentFragment)},[]),!r.open){const o=n;return o?Km.createPortal(a.jsx(Ite,{scope:e.__scopeSelect,children:a.jsx(uA.Slot,{scope:e.__scopeSelect,children:a.jsx("div",{children:e.children})})}),o):null}return a.jsx(Ote,{...e,ref:t})});kte.displayName=ox;var Bu=10,[Ite,Fp]=_y(ox),dHe="SelectContentImpl",uHe=pp("SelectContent.RemoveScroll"),Ote=p.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:o,onPointerDownOutside:i,side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:h,collisionPadding:m,sticky:x,hideWhenDetached:g,avoidCollisions:v,...y}=e,b=Rp(ox,r),[w,j]=p.useState(null),[_,C]=p.useState(null),E=$s(t,W=>j(W)),[S,A]=p.useState(null),[M,O]=p.useState(null),I=fA(r),[T,k]=p.useState(!1),q=p.useRef(!1);p.useEffect(()=>{if(w)return n5(w)},[w]),QC();const B=p.useCallback(W=>{const[se,...pe]=I().map(oe=>oe.ref.current),[G]=pe.slice(-1),te=document.activeElement;for(const oe of W)if(oe===te||(oe?.scrollIntoView({block:"nearest"}),oe===se&&_&&(_.scrollTop=0),oe===G&&_&&(_.scrollTop=_.scrollHeight),oe?.focus(),document.activeElement!==te))return},[I,_]),z=p.useCallback(()=>B([S,w]),[B,S,w]);p.useEffect(()=>{T&&z()},[T,z]);const{onOpenChange:F,triggerPointerDownPosRef:V}=b;p.useEffect(()=>{if(w){let W={x:0,y:0};const se=G=>{W={x:Math.abs(Math.round(G.pageX)-(V.current?.x??0)),y:Math.abs(Math.round(G.pageY)-(V.current?.y??0))}},pe=G=>{W.x<=10&&W.y<=10?G.preventDefault():w.contains(G.target)||F(!1),document.removeEventListener("pointermove",se),V.current=null};return V.current!==null&&(document.addEventListener("pointermove",se),document.addEventListener("pointerup",pe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",se),document.removeEventListener("pointerup",pe,{capture:!0})}}},[w,F,V]),p.useEffect(()=>{const W=()=>F(!1);return window.addEventListener("blur",W),window.addEventListener("resize",W),()=>{window.removeEventListener("blur",W),window.removeEventListener("resize",W)}},[F]);const[me,be]=Gte(W=>{const se=I().filter(te=>!te.disabled),pe=se.find(te=>te.ref.current===document.activeElement),G=Kte(se,W,pe);G&&setTimeout(()=>G.ref.current.focus())}),U=p.useCallback((W,se,pe)=>{const G=!q.current&&!pe;(b.value!==void 0&&b.value===se||G)&&(A(W),G&&(q.current=!0))},[b.value]),L=p.useCallback(()=>w?.focus(),[w]),H=p.useCallback((W,se,pe)=>{const G=!q.current&&!pe;(b.value!==void 0&&b.value===se||G)&&O(W)},[b.value]),ie=n==="popper"?t3:Tte,Y=ie===t3?{side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:h,collisionPadding:m,sticky:x,hideWhenDetached:g,avoidCollisions:v}:{};return a.jsx(Ite,{scope:r,content:w,viewport:_,onViewportChange:C,itemRefCallback:U,selectedItem:S,onItemLeave:L,itemTextRefCallback:H,focusSelectedItem:z,selectedItemText:M,position:n,isPositioned:T,searchRef:me,children:a.jsx(s5,{as:uHe,allowPinchZoom:!0,children:a.jsx(tj,{asChild:!0,trapped:b.open,onMountAutoFocus:W=>{W.preventDefault()},onUnmountAutoFocus:aa(s,W=>{b.trigger?.focus({preventScroll:!0}),W.preventDefault()}),children:a.jsx(ry,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:W=>W.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:a.jsx(ie,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:W=>W.preventDefault(),...y,...Y,onPlaced:()=>k(!0),ref:E,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:aa(y.onKeyDown,W=>{const se=W.ctrlKey||W.altKey||W.metaKey;if(W.key==="Tab"&&W.preventDefault(),!se&&W.key.length===1&&be(W.key),["ArrowUp","ArrowDown","Home","End"].includes(W.key)){let G=I().filter(te=>!te.disabled).map(te=>te.ref.current);if(["ArrowUp","End"].includes(W.key)&&(G=G.slice().reverse()),["ArrowUp","ArrowDown"].includes(W.key)){const te=W.target,oe=G.indexOf(te);G=G.slice(oe+1)}setTimeout(()=>B(G)),W.preventDefault()}})})})})})})});Ote.displayName=dHe;var fHe="SelectItemAlignedPosition",Tte=p.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...s}=e,o=Rp(ox,r),i=Fp(ox,r),[l,c]=p.useState(null),[d,u]=p.useState(null),f=$s(t,E=>u(E)),h=fA(r),m=p.useRef(!1),x=p.useRef(!0),{viewport:g,selectedItem:v,selectedItemText:y,focusSelectedItem:b}=i,w=p.useCallback(()=>{if(o.trigger&&o.valueNode&&l&&d&&g&&v&&y){const E=o.trigger.getBoundingClientRect(),S=d.getBoundingClientRect(),A=o.valueNode.getBoundingClientRect(),M=y.getBoundingClientRect();if(o.dir!=="rtl"){const te=M.left-S.left,oe=A.left-te,De=E.left-oe,re=E.width+De,ae=Math.max(re,S.width),ut=window.innerWidth-Bu,pt=Bz(oe,[Bu,Math.max(Bu,ut-ae)]);l.style.minWidth=re+"px",l.style.left=pt+"px"}else{const te=S.right-M.right,oe=window.innerWidth-A.right-te,De=window.innerWidth-E.right-oe,re=E.width+De,ae=Math.max(re,S.width),ut=window.innerWidth-Bu,pt=Bz(oe,[Bu,Math.max(Bu,ut-ae)]);l.style.minWidth=re+"px",l.style.right=pt+"px"}const O=h(),I=window.innerHeight-Bu*2,T=g.scrollHeight,k=window.getComputedStyle(d),q=parseInt(k.borderTopWidth,10),B=parseInt(k.paddingTop,10),z=parseInt(k.borderBottomWidth,10),F=parseInt(k.paddingBottom,10),V=q+B+T+F+z,me=Math.min(v.offsetHeight*5,V),be=window.getComputedStyle(g),U=parseInt(be.paddingTop,10),L=parseInt(be.paddingBottom,10),H=E.top+E.height/2-Bu,ie=I-H,Y=v.offsetHeight/2,W=v.offsetTop+Y,se=q+B+W,pe=V-se;if(se<=H){const te=O.length>0&&v===O[O.length-1].ref.current;l.style.bottom="0px";const oe=d.clientHeight-g.offsetTop-g.offsetHeight,De=Math.max(ie,Y+(te?L:0)+oe+z),re=se+De;l.style.height=re+"px"}else{const te=O.length>0&&v===O[0].ref.current;l.style.top="0px";const De=Math.max(H,q+g.offsetTop+(te?U:0)+Y)+pe;l.style.height=De+"px",g.scrollTop=se-H+g.offsetTop}l.style.margin=`${Bu}px 0`,l.style.minHeight=me+"px",l.style.maxHeight=I+"px",n?.(),requestAnimationFrame(()=>m.current=!0)}},[h,o.trigger,o.valueNode,l,d,g,v,y,o.dir,n]);kl(()=>w(),[w]);const[j,_]=p.useState();kl(()=>{d&&_(window.getComputedStyle(d).zIndex)},[d]);const C=p.useCallback(E=>{E&&x.current===!0&&(w(),b?.(),x.current=!1)},[w,b]);return a.jsx(hHe,{scope:r,contentWrapper:l,shouldExpandOnScrollRef:m,onScrollButtonChange:C,children:a.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:j},children:a.jsx(Qa.div,{...s,ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});Tte.displayName=fHe;var mHe="SelectPopperPosition",t3=p.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:s=Bu,...o}=e,i=mA(r);return a.jsx(RD,{...i,...o,ref:t,align:n,collisionPadding:s,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});t3.displayName=mHe;var[hHe,xR]=_y(ox,{}),r3="SelectViewport",Dte=p.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...s}=e,o=Fp(r3,r),i=xR(r3,r),l=$s(t,o.onViewportChange),c=p.useRef(0);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),a.jsx(uA.Slot,{scope:r,children:a.jsx(Qa.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:aa(s.onScroll,d=>{const u=d.currentTarget,{contentWrapper:f,shouldExpandOnScrollRef:h}=i;if(h?.current&&f){const m=Math.abs(c.current-u.scrollTop);if(m>0){const x=window.innerHeight-Bu*2,g=parseFloat(f.style.minHeight),v=parseFloat(f.style.height),y=Math.max(g,v);if(y<x){const b=y+m,w=Math.min(x,b),j=b-w;f.style.height=w+"px",f.style.bottom==="0px"&&(u.scrollTop=j>0?j:0,f.style.justifyContent="flex-end")}}}c.current=u.scrollTop})})})]})});Dte.displayName=r3;var Mte="SelectGroup",[pHe,gHe]=_y(Mte),xHe=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=tf();return a.jsx(pHe,{scope:r,id:s,children:a.jsx(Qa.div,{role:"group","aria-labelledby":s,...n,ref:t})})});xHe.displayName=Mte;var Rte="SelectLabel",Fte=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=gHe(Rte,r);return a.jsx(Qa.div,{id:s.id,...n,ref:t})});Fte.displayName=Rte;var GS="SelectItem",[vHe,Lte]=_y(GS),$te=p.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:s=!1,textValue:o,...i}=e,l=Rp(GS,r),c=Fp(GS,r),d=l.value===n,[u,f]=p.useState(o??""),[h,m]=p.useState(!1),x=$s(t,b=>c.itemRefCallback?.(b,n,s)),g=tf(),v=p.useRef("touch"),y=()=>{s||(l.onValueChange(n),l.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return a.jsx(vHe,{scope:r,value:n,disabled:s,textId:g,isSelected:d,onItemTextChange:p.useCallback(b=>{f(w=>w||(b?.textContent??"").trim())},[]),children:a.jsx(uA.ItemSlot,{scope:r,value:n,disabled:s,textValue:u,children:a.jsx(Qa.div,{role:"option","aria-labelledby":g,"data-highlighted":h?"":void 0,"aria-selected":d&&h,"data-state":d?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...i,ref:x,onFocus:aa(i.onFocus,()=>m(!0)),onBlur:aa(i.onBlur,()=>m(!1)),onClick:aa(i.onClick,()=>{v.current!=="mouse"&&y()}),onPointerUp:aa(i.onPointerUp,()=>{v.current==="mouse"&&y()}),onPointerDown:aa(i.onPointerDown,b=>{v.current=b.pointerType}),onPointerMove:aa(i.onPointerMove,b=>{v.current=b.pointerType,s?c.onItemLeave?.():v.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:aa(i.onPointerLeave,b=>{b.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:aa(i.onKeyDown,b=>{c.searchRef?.current!==""&&b.key===" "||(nHe.includes(b.key)&&y(),b.key===" "&&b.preventDefault())})})})})});$te.displayName=GS;var Nb="SelectItemText",Bte=p.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,...o}=e,i=Rp(Nb,r),l=Fp(Nb,r),c=Lte(Nb,r),d=iHe(Nb,r),[u,f]=p.useState(null),h=$s(t,y=>f(y),c.onItemTextChange,y=>l.itemTextRefCallback?.(y,c.value,c.disabled)),m=u?.textContent,x=p.useMemo(()=>a.jsx("option",{value:c.value,disabled:c.disabled,children:m},c.value),[c.disabled,c.value,m]),{onNativeOptionAdd:g,onNativeOptionRemove:v}=d;return kl(()=>(g(x),()=>v(x)),[g,v,x]),a.jsxs(a.Fragment,{children:[a.jsx(Qa.span,{id:c.textId,...o,ref:h}),c.isSelected&&i.valueNode&&!i.valueNodeHasChildren?Km.createPortal(o.children,i.valueNode):null]})});Bte.displayName=Nb;var qte="SelectItemIndicator",zte=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return Lte(qte,r).isSelected?a.jsx(Qa.span,{"aria-hidden":!0,...n,ref:t}):null});zte.displayName=qte;var n3="SelectScrollUpButton",yHe=p.forwardRef((e,t)=>{const r=Fp(n3,e.__scopeSelect),n=xR(n3,e.__scopeSelect),[s,o]=p.useState(!1),i=$s(t,n.onScrollButtonChange);return kl(()=>{if(r.viewport&&r.isPositioned){let l=function(){const d=c.scrollTop>0;o(d)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),s?a.jsx(Ute,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop-c.offsetHeight)}}):null});yHe.displayName=n3;var a3="SelectScrollDownButton",bHe=p.forwardRef((e,t)=>{const r=Fp(a3,e.__scopeSelect),n=xR(a3,e.__scopeSelect),[s,o]=p.useState(!1),i=$s(t,n.onScrollButtonChange);return kl(()=>{if(r.viewport&&r.isPositioned){let l=function(){const d=c.scrollHeight-c.clientHeight,u=Math.ceil(c.scrollTop)<d;o(u)};const c=r.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),s?a.jsx(Ute,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=r;l&&c&&(l.scrollTop=l.scrollTop+c.offsetHeight)}}):null});bHe.displayName=a3;var Ute=p.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...s}=e,o=Fp("SelectScrollButton",r),i=p.useRef(null),l=fA(r),c=p.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return p.useEffect(()=>()=>c(),[c]),kl(()=>{l().find(u=>u.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),a.jsx(Qa.div,{"aria-hidden":!0,...s,ref:t,style:{flexShrink:0,...s.style},onPointerDown:aa(s.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(n,50))}),onPointerMove:aa(s.onPointerMove,()=>{o.onItemLeave?.(),i.current===null&&(i.current=window.setInterval(n,50))}),onPointerLeave:aa(s.onPointerLeave,()=>{c()})})}),wHe="SelectSeparator",Vte=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return a.jsx(Qa.div,{"aria-hidden":!0,...n,ref:t})});Vte.displayName=wHe;var s3="SelectArrow",jHe=p.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=mA(r),o=Rp(s3,r),i=Fp(s3,r);return o.open&&i.position==="popper"?a.jsx(FD,{...s,...n,ref:t}):null});jHe.displayName=s3;var _He="SelectBubbleInput",Wte=p.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const s=p.useRef(null),o=$s(n,s),i=wte(t);return p.useEffect(()=>{const l=s.current;if(!l)return;const c=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(i!==t&&u){const f=new Event("change",{bubbles:!0});u.call(l,t),l.dispatchEvent(f)}},[i,t]),a.jsx(Qa.select,{...r,style:{...jte,...r.style},ref:o,defaultValue:t})});Wte.displayName=_He;function Hte(e){return e===""||e===void 0}function Gte(e){const t=Xc(e),r=p.useRef(""),n=p.useRef(0),s=p.useCallback(i=>{const l=r.current+i;t(l),function c(d){r.current=d,window.clearTimeout(n.current),d!==""&&(n.current=window.setTimeout(()=>c(""),1e3))}(l)},[t]),o=p.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return p.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,s,o]}function Kte(e,t,r){const s=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let i=NHe(e,Math.max(o,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.textValue.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function NHe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var SHe=_te,Xte=Ste,CHe=Ate,AHe=Pte,PHe=Ete,Yte=kte,EHe=Dte,Jte=Fte,Qte=$te,kHe=Bte,IHe=zte,Zte=Vte;const Zn=SHe,ta=CHe,Yn=Ce.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Xte,{ref:n,className:Pr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground hover:bg-surface-2/30 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors duration-150",e),...r,children:[t,a.jsx(AHe,{asChild:!0,children:a.jsx(hx,{className:"h-4 w-4 opacity-50"})})]}));Yn.displayName=Xte.displayName;const Jn=Ce.forwardRef(({className:e,children:t,position:r="popper",...n},s)=>a.jsx(PHe,{children:a.jsx(Yte,{ref:s,className:Pr("relative z-50 min-w-[8rem] max-h-[340px] overflow-auto fx-scroll rounded-md border bg-popover text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:a.jsx(EHe,{className:Pr("p-1",r==="popper"&&"w-full min-w-[var(--radix-select-trigger-width)]"),children:t})})}));Jn.displayName=Yte.displayName;const OHe=Ce.forwardRef(({className:e,...t},r)=>a.jsx(Jte,{ref:r,className:Pr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));OHe.displayName=Jte.displayName;const nt=Ce.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Qte,{ref:n,className:Pr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none hover:bg-surface-2/50 focus:bg-surface-2/50 data-[state=checked]:bg-surface-2/50 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-colors",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(IHe,{children:a.jsx(Fm,{className:"h-4 w-4"})})}),a.jsx(kHe,{children:t})]}));nt.displayName=Qte.displayName;const THe=Ce.forwardRef(({className:e,...t},r)=>a.jsx(Zte,{ref:r,className:Pr("-mx-1 my-1 h-px bg-muted",e),...t}));THe.displayName=Zte.displayName;var hA="Checkbox",[DHe,Nct]=Nu(hA),[MHe,vR]=DHe(hA);function RHe(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:s,disabled:o,form:i,name:l,onCheckedChange:c,required:d,value:u="on",internal_do_not_use_render:f}=e,[h,m]=zm({prop:r,defaultProp:s??!1,onChange:c,caller:hA}),[x,g]=p.useState(null),[v,y]=p.useState(null),b=p.useRef(!1),w=x?!!i||!!x.closest("form"):!0,j={checked:h,disabled:o,setChecked:m,control:x,setControl:g,name:l,form:i,value:u,hasConsumerStoppedPropagationRef:b,required:d,defaultChecked:rp(s)?!1:s,isFormControl:w,bubbleInput:v,setBubbleInput:y};return a.jsx(MHe,{scope:t,...j,children:FHe(f)?f(j):n})}var ere="CheckboxTrigger",tre=p.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},s)=>{const{control:o,value:i,disabled:l,checked:c,required:d,setControl:u,setChecked:f,hasConsumerStoppedPropagationRef:h,isFormControl:m,bubbleInput:x}=vR(ere,e),g=$s(s,u),v=p.useRef(c);return p.useEffect(()=>{const y=o?.form;if(y){const b=()=>f(v.current);return y.addEventListener("reset",b),()=>y.removeEventListener("reset",b)}},[o,f]),a.jsx(Qa.button,{type:"button",role:"checkbox","aria-checked":rp(c)?"mixed":c,"aria-required":d,"data-state":ore(c),"data-disabled":l?"":void 0,disabled:l,value:i,...n,ref:g,onKeyDown:aa(t,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:aa(r,y=>{f(b=>rp(b)?!0:!b),x&&m&&(h.current=y.isPropagationStopped(),h.current||y.stopPropagation())})})});tre.displayName=ere;var yR=p.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:s,defaultChecked:o,required:i,disabled:l,value:c,onCheckedChange:d,form:u,...f}=e;return a.jsx(RHe,{__scopeCheckbox:r,checked:s,defaultChecked:o,disabled:l,required:i,onCheckedChange:d,name:n,form:u,value:c,internal_do_not_use_render:({isFormControl:h})=>a.jsxs(a.Fragment,{children:[a.jsx(tre,{...f,ref:t,__scopeCheckbox:r}),h&&a.jsx(sre,{__scopeCheckbox:r})]})})});yR.displayName=hA;var rre="CheckboxIndicator",nre=p.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...s}=e,o=vR(rre,r);return a.jsx($d,{present:n||rp(o.checked)||o.checked===!0,children:a.jsx(Qa.span,{"data-state":ore(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});nre.displayName=rre;var are="CheckboxBubbleInput",sre=p.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:s,checked:o,defaultChecked:i,required:l,disabled:c,name:d,value:u,form:f,bubbleInput:h,setBubbleInput:m}=vR(are,e),x=$s(r,m),g=wte(o),v=mX(n);p.useEffect(()=>{const b=h;if(!b)return;const w=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(w,"checked").set,C=!s.current;if(g!==o&&_){const E=new Event("click",{bubbles:C});b.indeterminate=rp(o),_.call(b,rp(o)?!1:o),b.dispatchEvent(E)}},[h,g,o,s]);const y=p.useRef(rp(o)?!1:o);return a.jsx(Qa.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??y.current,required:l,disabled:c,name:d,value:u,form:f,...t,tabIndex:-1,ref:x,style:{...t.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});sre.displayName=are;function FHe(e){return typeof e=="function"}function rp(e){return e==="indeterminate"}function ore(e){return rp(e)?"indeterminate":e?"checked":"unchecked"}const Qs=Ce.forwardRef(({className:e,...t},r)=>a.jsx(yR,{ref:r,className:Pr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:a.jsx(nre,{className:Pr("flex items-center justify-center text-current"),children:a.jsx(Fm,{className:"h-4 w-4"})})}));Qs.displayName=yR.displayName;var WE="rovingFocusGroup.onEntryFocus",LHe={bubbles:!1,cancelable:!0},vj="RovingFocusGroup",[o3,ire,$He]=cA(vj),[BHe,pA]=Nu(vj,[$He]),[qHe,zHe]=BHe(vj),lre=p.forwardRef((e,t)=>a.jsx(o3.Provider,{scope:e.__scopeRovingFocusGroup,children:a.jsx(o3.Slot,{scope:e.__scopeRovingFocusGroup,children:a.jsx(UHe,{...e,ref:t})})}));lre.displayName=vj;var UHe=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:s=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:u=!1,...f}=e,h=p.useRef(null),m=$s(t,h),x=dA(o),[g,v]=zm({prop:i,defaultProp:l??null,onChange:c,caller:vj}),[y,b]=p.useState(!1),w=Xc(d),j=ire(r),_=p.useRef(!1),[C,E]=p.useState(0);return p.useEffect(()=>{const S=h.current;if(S)return S.addEventListener(WE,w),()=>S.removeEventListener(WE,w)},[w]),a.jsx(qHe,{scope:r,orientation:n,dir:x,loop:s,currentTabStopId:g,onItemFocus:p.useCallback(S=>v(S),[v]),onItemShiftTab:p.useCallback(()=>b(!0),[]),onFocusableItemAdd:p.useCallback(()=>E(S=>S+1),[]),onFocusableItemRemove:p.useCallback(()=>E(S=>S-1),[]),children:a.jsx(Qa.div,{tabIndex:y||C===0?-1:0,"data-orientation":n,...f,ref:m,style:{outline:"none",...e.style},onMouseDown:aa(e.onMouseDown,()=>{_.current=!0}),onFocus:aa(e.onFocus,S=>{const A=!_.current;if(S.target===S.currentTarget&&A&&!y){const M=new CustomEvent(WE,LHe);if(S.currentTarget.dispatchEvent(M),!M.defaultPrevented){const O=j().filter(B=>B.focusable),I=O.find(B=>B.active),T=O.find(B=>B.id===g),q=[I,T,...O].filter(Boolean).map(B=>B.ref.current);ure(q,u)}}_.current=!1}),onBlur:aa(e.onBlur,()=>b(!1))})})}),cre="RovingFocusGroupItem",dre=p.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:s=!1,tabStopId:o,children:i,...l}=e,c=tf(),d=o||c,u=zHe(cre,r),f=u.currentTabStopId===d,h=ire(r),{onFocusableItemAdd:m,onFocusableItemRemove:x,currentTabStopId:g}=u;return p.useEffect(()=>{if(n)return m(),()=>x()},[n,m,x]),a.jsx(o3.ItemSlot,{scope:r,id:d,focusable:n,active:s,children:a.jsx(Qa.span,{tabIndex:f?0:-1,"data-orientation":u.orientation,...l,ref:t,onMouseDown:aa(e.onMouseDown,v=>{n?u.onItemFocus(d):v.preventDefault()}),onFocus:aa(e.onFocus,()=>u.onItemFocus(d)),onKeyDown:aa(e.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){u.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const y=HHe(v,u.orientation,u.dir);if(y!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let w=h().filter(j=>j.focusable).map(j=>j.ref.current);if(y==="last")w.reverse();else if(y==="prev"||y==="next"){y==="prev"&&w.reverse();const j=w.indexOf(v.currentTarget);w=u.loop?GHe(w,j+1):w.slice(j+1)}setTimeout(()=>ure(w))}}),children:typeof i=="function"?i({isCurrentTabStop:f,hasTabStop:g!=null}):i})})});dre.displayName=cre;var VHe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function WHe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function HHe(e,t,r){const n=WHe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return VHe[n]}function ure(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function GHe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var fre=lre,mre=dre,i3=["Enter"," "],KHe=["ArrowDown","PageUp","Home"],hre=["ArrowUp","PageDown","End"],XHe=[...KHe,...hre],YHe={ltr:[...i3,"ArrowRight"],rtl:[...i3,"ArrowLeft"]},JHe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},yj="Menu",[C1,QHe,ZHe]=cA(yj),[Nx,pre]=Nu(yj,[ZHe,sy,pA]),gA=sy(),gre=pA(),[eGe,Sx]=Nx(yj),[tGe,bj]=Nx(yj),xre=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:o,modal:i=!0}=e,l=gA(t),[c,d]=p.useState(null),u=p.useRef(!1),f=Xc(o),h=dA(s);return p.useEffect(()=>{const m=()=>{u.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>u.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),a.jsx(MD,{...l,children:a.jsx(eGe,{scope:t,open:r,onOpenChange:f,content:c,onContentChange:d,children:a.jsx(tGe,{scope:t,onClose:p.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:u,dir:h,modal:i,children:n})})})};xre.displayName=yj;var rGe="MenuAnchor",bR=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=gA(r);return a.jsx(r5,{...s,...n,ref:t})});bR.displayName=rGe;var wR="MenuPortal",[nGe,vre]=Nx(wR,{forceMount:void 0}),yre=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:s}=e,o=Sx(wR,t);return a.jsx(nGe,{scope:t,forceMount:r,children:a.jsx($d,{present:r||o.open,children:a.jsx(oy,{asChild:!0,container:s,children:n})})})};yre.displayName=wR;var gu="MenuContent",[aGe,jR]=Nx(gu),bre=p.forwardRef((e,t)=>{const r=vre(gu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Sx(gu,e.__scopeMenu),i=bj(gu,e.__scopeMenu);return a.jsx(C1.Provider,{scope:e.__scopeMenu,children:a.jsx($d,{present:n||o.open,children:a.jsx(C1.Slot,{scope:e.__scopeMenu,children:i.modal?a.jsx(sGe,{...s,ref:t}):a.jsx(oGe,{...s,ref:t})})})})}),sGe=p.forwardRef((e,t)=>{const r=Sx(gu,e.__scopeMenu),n=p.useRef(null),s=$s(t,n);return p.useEffect(()=>{const o=n.current;if(o)return n5(o)},[]),a.jsx(_R,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:aa(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),oGe=p.forwardRef((e,t)=>{const r=Sx(gu,e.__scopeMenu);return a.jsx(_R,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),iGe=pp("MenuContent.ScrollLock"),_R=p.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:h,onDismiss:m,disableOutsideScroll:x,...g}=e,v=Sx(gu,r),y=bj(gu,r),b=gA(r),w=gre(r),j=QHe(r),[_,C]=p.useState(null),E=p.useRef(null),S=$s(t,E,v.onContentChange),A=p.useRef(0),M=p.useRef(""),O=p.useRef(0),I=p.useRef(null),T=p.useRef("right"),k=p.useRef(0),q=x?s5:p.Fragment,B=x?{as:iGe,allowPinchZoom:!0}:void 0,z=V=>{const me=M.current+V,be=j().filter(W=>!W.disabled),U=document.activeElement,L=be.find(W=>W.ref.current===U)?.textValue,H=be.map(W=>W.textValue),ie=yGe(H,me,L),Y=be.find(W=>W.textValue===ie)?.ref.current;(function W(se){M.current=se,window.clearTimeout(A.current),se!==""&&(A.current=window.setTimeout(()=>W(""),1e3))})(me),Y&&setTimeout(()=>Y.focus())};p.useEffect(()=>()=>window.clearTimeout(A.current),[]),QC();const F=p.useCallback(V=>T.current===I.current?.side&&wGe(V,I.current?.area),[]);return a.jsx(aGe,{scope:r,searchRef:M,onItemEnter:p.useCallback(V=>{F(V)&&V.preventDefault()},[F]),onItemLeave:p.useCallback(V=>{F(V)||(E.current?.focus(),C(null))},[F]),onTriggerLeave:p.useCallback(V=>{F(V)&&V.preventDefault()},[F]),pointerGraceTimerRef:O,onPointerGraceIntentChange:p.useCallback(V=>{I.current=V},[]),children:a.jsx(q,{...B,children:a.jsx(tj,{asChild:!0,trapped:s,onMountAutoFocus:aa(o,V=>{V.preventDefault(),E.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:a.jsx(ry,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:h,onDismiss:m,children:a.jsx(fre,{asChild:!0,...w,dir:y.dir,orientation:"vertical",loop:n,currentTabStopId:_,onCurrentTabStopIdChange:C,onEntryFocus:aa(c,V=>{y.isUsingKeyboardRef.current||V.preventDefault()}),preventScrollOnEntryFocus:!0,children:a.jsx(RD,{role:"menu","aria-orientation":"vertical","data-state":Rre(v.open),"data-radix-menu-content":"",dir:y.dir,...b,...g,ref:S,style:{outline:"none",...g.style},onKeyDown:aa(g.onKeyDown,V=>{const be=V.target.closest("[data-radix-menu-content]")===V.currentTarget,U=V.ctrlKey||V.altKey||V.metaKey,L=V.key.length===1;be&&(V.key==="Tab"&&V.preventDefault(),!U&&L&&z(V.key));const H=E.current;if(V.target!==H||!XHe.includes(V.key))return;V.preventDefault();const Y=j().filter(W=>!W.disabled).map(W=>W.ref.current);hre.includes(V.key)&&Y.reverse(),xGe(Y)}),onBlur:aa(e.onBlur,V=>{V.currentTarget.contains(V.target)||(window.clearTimeout(A.current),M.current="")}),onPointerMove:aa(e.onPointerMove,A1(V=>{const me=V.target,be=k.current!==V.clientX;if(V.currentTarget.contains(me)&&be){const U=V.clientX>k.current?"right":"left";T.current=U,k.current=V.clientX}}))})})})})})})});bre.displayName=gu;var lGe="MenuGroup",NR=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Qa.div,{role:"group",...n,ref:t})});NR.displayName=lGe;var cGe="MenuLabel",wre=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Qa.div,{...n,ref:t})});wre.displayName=cGe;var KS="MenuItem",qz="menu.itemSelect",xA=p.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...s}=e,o=p.useRef(null),i=bj(KS,e.__scopeMenu),l=jR(KS,e.__scopeMenu),c=$s(t,o),d=p.useRef(!1),u=()=>{const f=o.current;if(!r&&f){const h=new CustomEvent(qz,{bubbles:!0,cancelable:!0});f.addEventListener(qz,m=>n?.(m),{once:!0}),SD(f,h),h.defaultPrevented?d.current=!1:i.onClose()}};return a.jsx(jre,{...s,ref:c,disabled:r,onClick:aa(e.onClick,u),onPointerDown:f=>{e.onPointerDown?.(f),d.current=!0},onPointerUp:aa(e.onPointerUp,f=>{d.current||f.currentTarget?.click()}),onKeyDown:aa(e.onKeyDown,f=>{const h=l.searchRef.current!=="";r||h&&f.key===" "||i3.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});xA.displayName=KS;var jre=p.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:s,...o}=e,i=jR(KS,r),l=gre(r),c=p.useRef(null),d=$s(t,c),[u,f]=p.useState(!1),[h,m]=p.useState("");return p.useEffect(()=>{const x=c.current;x&&m((x.textContent??"").trim())},[o.children]),a.jsx(C1.ItemSlot,{scope:r,disabled:n,textValue:s??h,children:a.jsx(mre,{asChild:!0,...l,focusable:!n,children:a.jsx(Qa.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:d,onPointerMove:aa(e.onPointerMove,A1(x=>{n?i.onItemLeave(x):(i.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:aa(e.onPointerLeave,A1(x=>i.onItemLeave(x))),onFocus:aa(e.onFocus,()=>f(!0)),onBlur:aa(e.onBlur,()=>f(!1))})})})}),dGe="MenuCheckboxItem",_re=p.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...s}=e;return a.jsx(Pre,{scope:e.__scopeMenu,checked:r,children:a.jsx(xA,{role:"menuitemcheckbox","aria-checked":XS(r)?"mixed":r,...s,ref:t,"data-state":CR(r),onSelect:aa(s.onSelect,()=>n?.(XS(r)?!0:!r),{checkForDefaultPrevented:!1})})})});_re.displayName=dGe;var Nre="MenuRadioGroup",[uGe,fGe]=Nx(Nre,{value:void 0,onValueChange:()=>{}}),Sre=p.forwardRef((e,t)=>{const{value:r,onValueChange:n,...s}=e,o=Xc(n);return a.jsx(uGe,{scope:e.__scopeMenu,value:r,onValueChange:o,children:a.jsx(NR,{...s,ref:t})})});Sre.displayName=Nre;var Cre="MenuRadioItem",Are=p.forwardRef((e,t)=>{const{value:r,...n}=e,s=fGe(Cre,e.__scopeMenu),o=r===s.value;return a.jsx(Pre,{scope:e.__scopeMenu,checked:o,children:a.jsx(xA,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":CR(o),onSelect:aa(n.onSelect,()=>s.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Are.displayName=Cre;var SR="MenuItemIndicator",[Pre,mGe]=Nx(SR,{checked:!1}),Ere=p.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...s}=e,o=mGe(SR,r);return a.jsx($d,{present:n||XS(o.checked)||o.checked===!0,children:a.jsx(Qa.span,{...s,ref:t,"data-state":CR(o.checked)})})});Ere.displayName=SR;var hGe="MenuSeparator",kre=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(Qa.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});kre.displayName=hGe;var pGe="MenuArrow",Ire=p.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=gA(r);return a.jsx(FD,{...s,...n,ref:t})});Ire.displayName=pGe;var gGe="MenuSub",[Sct,Ore]=Nx(gGe),Sb="MenuSubTrigger",Tre=p.forwardRef((e,t)=>{const r=Sx(Sb,e.__scopeMenu),n=bj(Sb,e.__scopeMenu),s=Ore(Sb,e.__scopeMenu),o=jR(Sb,e.__scopeMenu),i=p.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=o,d={__scopeMenu:e.__scopeMenu},u=p.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return p.useEffect(()=>u,[u]),p.useEffect(()=>{const f=l.current;return()=>{window.clearTimeout(f),c(null)}},[l,c]),a.jsx(bR,{asChild:!0,...d,children:a.jsx(jre,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":Rre(r.open),...e,ref:JC(t,s.onTriggerChange),onClick:f=>{e.onClick?.(f),!(e.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:aa(e.onPointerMove,A1(f=>{o.onItemEnter(f),!f.defaultPrevented&&!e.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:aa(e.onPointerLeave,A1(f=>{u();const h=r.content?.getBoundingClientRect();if(h){const m=r.content?.dataset.side,x=m==="right",g=x?-5:5,v=h[x?"left":"right"],y=h[x?"right":"left"];o.onPointerGraceIntentChange({area:[{x:f.clientX+g,y:f.clientY},{x:v,y:h.top},{x:y,y:h.top},{x:y,y:h.bottom},{x:v,y:h.bottom}],side:m}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(f),f.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:aa(e.onKeyDown,f=>{const h=o.searchRef.current!=="";e.disabled||h&&f.key===" "||YHe[n.dir].includes(f.key)&&(r.onOpenChange(!0),r.content?.focus(),f.preventDefault())})})})});Tre.displayName=Sb;var Dre="MenuSubContent",Mre=p.forwardRef((e,t)=>{const r=vre(gu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Sx(gu,e.__scopeMenu),i=bj(gu,e.__scopeMenu),l=Ore(Dre,e.__scopeMenu),c=p.useRef(null),d=$s(t,c);return a.jsx(C1.Provider,{scope:e.__scopeMenu,children:a.jsx($d,{present:n||o.open,children:a.jsx(C1.Slot,{scope:e.__scopeMenu,children:a.jsx(_R,{id:l.contentId,"aria-labelledby":l.triggerId,...s,ref:d,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{i.isUsingKeyboardRef.current&&c.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:aa(e.onFocusOutside,u=>{u.target!==l.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:aa(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:aa(e.onKeyDown,u=>{const f=u.currentTarget.contains(u.target),h=JHe[i.dir].includes(u.key);f&&h&&(o.onOpenChange(!1),l.trigger?.focus(),u.preventDefault())})})})})})});Mre.displayName=Dre;function Rre(e){return e?"open":"closed"}function XS(e){return e==="indeterminate"}function CR(e){return XS(e)?"indeterminate":e?"checked":"unchecked"}function xGe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function vGe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function yGe(e,t,r){const s=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let i=vGe(e,Math.max(o,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function bGe(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const l=t[o],c=t[i],d=l.x,u=l.y,f=c.x,h=c.y;u>n!=h>n&&r<(f-d)*(n-u)/(h-u)+d&&(s=!s)}return s}function wGe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return bGe(r,t)}function A1(e){return t=>t.pointerType==="mouse"?e(t):void 0}var jGe=xre,_Ge=bR,NGe=yre,SGe=bre,CGe=NR,AGe=wre,PGe=xA,EGe=_re,kGe=Sre,IGe=Are,OGe=Ere,TGe=kre,DGe=Ire,MGe=Tre,RGe=Mre,vA="DropdownMenu",[FGe,Cct]=Nu(vA,[pre]),Nc=pre(),[LGe,Fre]=FGe(vA),Lre=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:o,onOpenChange:i,modal:l=!0}=e,c=Nc(t),d=p.useRef(null),[u,f]=zm({prop:s,defaultProp:o??!1,onChange:i,caller:vA});return a.jsx(LGe,{scope:t,triggerId:tf(),triggerRef:d,contentId:tf(),open:u,onOpenChange:f,onOpenToggle:p.useCallback(()=>f(h=>!h),[f]),modal:l,children:a.jsx(jGe,{...c,open:u,onOpenChange:f,dir:n,modal:l,children:r})})};Lre.displayName=vA;var $re="DropdownMenuTrigger",Bre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...s}=e,o=Fre($re,r),i=Nc(r);return a.jsx(_Ge,{asChild:!0,...i,children:a.jsx(Qa.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:JC(t,o.triggerRef),onPointerDown:aa(e.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(o.onOpenToggle(),o.open||l.preventDefault())}),onKeyDown:aa(e.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&o.onOpenToggle(),l.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});Bre.displayName=$re;var $Ge="DropdownMenuPortal",qre=e=>{const{__scopeDropdownMenu:t,...r}=e,n=Nc(t);return a.jsx(NGe,{...n,...r})};qre.displayName=$Ge;var zre="DropdownMenuContent",Ure=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Fre(zre,r),o=Nc(r),i=p.useRef(!1);return a.jsx(SGe,{id:s.contentId,"aria-labelledby":s.triggerId,...o,...n,ref:t,onCloseAutoFocus:aa(e.onCloseAutoFocus,l=>{i.current||s.triggerRef.current?.focus(),i.current=!1,l.preventDefault()}),onInteractOutside:aa(e.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,u=c.button===2||d;(!s.modal||u)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ure.displayName=zre;var BGe="DropdownMenuGroup",qGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(CGe,{...s,...n,ref:t})});qGe.displayName=BGe;var zGe="DropdownMenuLabel",Vre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(AGe,{...s,...n,ref:t})});Vre.displayName=zGe;var UGe="DropdownMenuItem",Wre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(PGe,{...s,...n,ref:t})});Wre.displayName=UGe;var VGe="DropdownMenuCheckboxItem",Hre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(EGe,{...s,...n,ref:t})});Hre.displayName=VGe;var WGe="DropdownMenuRadioGroup",HGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(kGe,{...s,...n,ref:t})});HGe.displayName=WGe;var GGe="DropdownMenuRadioItem",Gre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(IGe,{...s,...n,ref:t})});Gre.displayName=GGe;var KGe="DropdownMenuItemIndicator",Kre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(OGe,{...s,...n,ref:t})});Kre.displayName=KGe;var XGe="DropdownMenuSeparator",Xre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(TGe,{...s,...n,ref:t})});Xre.displayName=XGe;var YGe="DropdownMenuArrow",JGe=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(DGe,{...s,...n,ref:t})});JGe.displayName=YGe;var QGe="DropdownMenuSubTrigger",Yre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(MGe,{...s,...n,ref:t})});Yre.displayName=QGe;var ZGe="DropdownMenuSubContent",Jre=p.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Nc(r);return a.jsx(RGe,{...s,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Jre.displayName=ZGe;var eKe=Lre,tKe=Bre,rKe=qre,Qre=Ure,Zre=Vre,ene=Wre,tne=Hre,rne=Gre,nne=Kre,ane=Xre,sne=Yre,one=Jre;const Mf=eKe,Rf=tKe,nKe=Ce.forwardRef(({className:e,inset:t,children:r,...n},s)=>a.jsxs(sne,{ref:s,className:Pr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...n,children:[r,a.jsx(Kg,{className:"ml-auto h-4 w-4"})]}));nKe.displayName=sne.displayName;const aKe=Ce.forwardRef(({className:e,...t},r)=>a.jsx(one,{ref:r,className:Pr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));aKe.displayName=one.displayName;const Yu=Ce.forwardRef(({className:e,sideOffset:t=4,...r},n)=>a.jsx(rKe,{children:a.jsx(Qre,{ref:n,sideOffset:t,className:Pr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Yu.displayName=Qre.displayName;const bs=Ce.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(ene,{ref:n,className:Pr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...r}));bs.displayName=ene.displayName;const sKe=Ce.forwardRef(({className:e,children:t,checked:r,...n},s)=>a.jsxs(tne,{ref:s,className:Pr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...n,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(nne,{children:a.jsx(Fm,{className:"h-4 w-4"})})}),t]}));sKe.displayName=tne.displayName;const oKe=Ce.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(rne,{ref:n,className:Pr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(nne,{children:a.jsx($ue,{className:"h-2 w-2 fill-current"})})}),t]}));oKe.displayName=rne.displayName;const l3=Ce.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(Zre,{ref:n,className:Pr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));l3.displayName=Zre.displayName;const L2=Ce.forwardRef(({className:e,...t},r)=>a.jsx(ane,{ref:r,className:Pr("-mx-1 my-1 h-px bg-muted",e),...t}));L2.displayName=ane.displayName;function Va(){try{const e=localStorage.getItem("auth:userProfile");if(e){const r=JSON.parse(e);if(r?.codigo_empresa)return r.codigo_empresa}const t=localStorage.getItem("auth:company");if(t){const r=JSON.parse(t);if(r?.codigo_empresa)return r.codigo_empresa;if(r?.codigo)return r.codigo}return typeof window<"u"&&window.__authProfile&&window.__authProfile.codigo_empresa?window.__authProfile.codigo_empresa:null}catch{return null}}async function Fh({somenteAtivas:e=!0,codigoEmpresa:t}={}){const r=t||Va();let n=Q.from("finalizadoras").select("*").order("codigo_interno",{ascending:!0,nullsFirst:!1}).order("nome",{ascending:!0});r&&(n=n.eq("codigo_empresa",r)),e&&(n=n.eq("ativo",!0));const{data:s,error:o}=await n;if(o)throw o;const i=s||[];return i.sort((l,c)=>{const d=parseInt(l?.codigo_interno)||0,u=parseInt(c?.codigo_interno)||0;if(d!==u)return d-u;const f=(l?.nome||"").toLowerCase(),h=(c?.nome||"").toLowerCase();return f.localeCompare(h)}),i}async function iKe(e,t){const r=t||Va(),n={codigo_interno:e?.codigo_interno||null,codigo_sefaz:e?.codigo_sefaz||null,nome:(e?.nome||"").trim(),tipo:e?.tipo||"outros",ativo:e?.ativo??!0,taxa_percentual:e?.taxa_percentual==null?null:Number(e.taxa_percentual)};if(!n.nome)throw new Error("Nome  obrigatrio");r&&(n.codigo_empresa=r);const{data:s,error:o}=await Q.from("finalizadoras").insert(n).select("*").single();if(o)throw o;return s}async function YS({caixaSessaoId:e,codigoEmpresa:t}={}){if(!e)throw new Error("caixaSessaoId  obrigatrio");const r=t||Va();let n=Q.from("caixa_sessoes").select("id, aberto_em, fechado_em, saldo_inicial, saldo_final").eq("id",e).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i=Array.isArray(s)?s[0]:s;if(!i)throw new Error("Sesso no encontrada");const l=i.aberto_em,c=i.fechado_em||new Date().toISOString(),d=await fu({from:l,to:c,codigoEmpresa:r});let u=0,f=0,h=0,m=0;try{let g=Q.from("caixa_movimentacoes").select("tipo, valor").eq("caixa_sessao_id",e);r&&(g=g.eq("codigo_empresa",r));const{data:v}=await g;for(const y of v||[]){const b=Number(y?.valor||0),w=String(y?.tipo||"").toLowerCase();w==="suprimento"?u+=b:w==="sangria"?f+=b:w==="ajuste"?h+=b:w==="troco"&&(m+=b)}}catch{}const x=u+h-f-m;return{...d,saldoInicial:Number(i.saldo_inicial||0),saldoFinal:i.saldo_final!=null?Number(i.saldo_final):null,movimentos:{suprimentos:u,sangrias:f,ajustes:h,troco:m,totalMovimentos:x}}}async function lKe(e,t,r){if(!e)throw new Error("ID invlido");const n=r||Va(),s={codigo_interno:t?.codigo_interno||null,codigo_sefaz:t?.codigo_sefaz||null,nome:(t?.nome||"").trim(),tipo:t?.tipo||"outros",ativo:t?.ativo??!0,taxa_percentual:t?.taxa_percentual==null?null:Number(t.taxa_percentual)};if(!s.nome)throw new Error("Nome  obrigatrio");let o=Q.from("finalizadoras").update(s).eq("id",e);n&&(o=o.eq("codigo_empresa",n));const{data:i,error:l}=await o.select("*").single();if(l)throw l;return i}async function cKe(e,t,r){if(!e)throw new Error("ID invlido");const n=r||Va();let s=Q.from("finalizadoras").update({ativo:!!t}).eq("id",e);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s.select("*").single();if(i)throw i;return o}async function AR({codigoEmpresa:e}={}){const t=e||Va();let r=Q.from("caixa_sessoes").select("id").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;if(!(Array.isArray(n)&&n.length>0)){const i=new Error(" necessrio abrir o caixa antes de criar comandas.");throw i.code="NO_OPEN_CASH_SESSION",i}return!0}async function c3(e=[],t){if(!Array.isArray(e)||e.length===0)return{};const r=t||Va(),n=async i=>{let l=Q.from("comanda_clientes").select(`comanda_id, cliente_id, nome_livre, clientes:clientes${i}(id, nome)`).in("comanda_id",e);return r&&(l=l.eq("codigo_empresa",r)),l};let s=[];try{const{data:i,error:l}=await n("!comanda_clientes_cliente_id_fkey");if(l)throw l;s=i||[]}catch{try{const{data:i,error:l}=await n("!fk_comanda_clientes_cliente");if(l)throw l;s=i||[]}catch{let i=Q.from("comanda_clientes").select("comanda_id, cliente_id, nome_livre").in("comanda_id",e);r&&(i=i.eq("codigo_empresa",r));const{data:l}=await i;s=l||[]}}const o={};for(const i of s){const l=i.comanda_id,c=i.clientes?.nome||i.nome_livre||"";o[l]||(o[l]=[]),c&&o[l].push(c)}for(const i of Object.keys(o))o[i]=Array.from(new Set(o[i])).join(", ");return o}async function d3(e=[],t){if(!Array.isArray(e)||e.length===0)return{};const r=t||Va();let n=Q.from("pagamentos").select("comanda_id, metodo, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").in("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i={};for(const c of s||[]){if(!((c.status||"Pago")!=="Cancelado"&&(c.status||"Pago")!=="Estornado"))continue;const u=c.comanda_id,f=c?.finalizadoras?.nome||c.metodo||"Outros";i[u]||(i[u]=[]),i[u].push(f)}const l={};for(const[c,d]of Object.entries(i))d.length===0?l[c]="":d.length===1?l[c]=d[0]:l[c]=`${d[0]} +${d.length-1}`;return l}async function dKe({comandaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("comandaId  obrigatrio");const r=t||Va();let n=Q.from("comanda_itens").select("produto_id, quantidade").eq("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i=new Map;for(const m of s||[]){const x=m.produto_id,g=Number(m.quantidade||0);i.set(x,(i.get(x)||0)+g)}if(i.size===0)return!0;const l=Array.from(i.keys());let c=Q.from("produtos").select("id, nome, estoque");c=c.in("id",l),r&&(c=c.eq("codigo_empresa",r));const{data:d,error:u}=await c;if(u)throw u;const f=new Map((d||[]).map(m=>[m.id,{nome:m.nome,estoque:Number(m.estoque||0)}])),h=[];for(const[m,x]of i.entries()){const g=f.get(m)||{nome:`Produto ${m}`,estoque:0};x>g.estoque&&h.push({id:m,name:g.nome,solicitado:x,estoque:g.estoque})}if(h.length>0){const m=h.map(g=>`${g.name}: solicitado ${g.solicitado}, estoque ${g.estoque}`).join("; "),x=new Error(`Estoque insuficiente para finalizar: ${m}`);throw x.code="INSUFFICIENT_STOCK_COMANDA",x.items=h,x}return!0}async function Tv({codigoEmpresa:e}={}){const t=e||Va();let r=Q.from("comandas").select("id,status,aberto_em").is("mesa_id",null).in("status",["open","awaiting-payment"]).order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n?.[0]||null}async function $2({codigoEmpresa:e}={}){const t=e||Va();console.log("[getOrCreateComandaBalcao] Iniciando com codigo_empresa:",t),await AR({codigoEmpresa:t});const r=await Tv({codigoEmpresa:t});if(r)return console.log("[getOrCreateComandaBalcao] Comanda existente encontrada:",r),r;const n={status:"open",mesa_id:null,aberto_em:new Date().toISOString()};console.log("[getOrCreateComandaBalcao] Criando nova comanda (codigo_empresa via DEFAULT):",n);const{data:s,error:o}=await Q.from("comandas").insert(n).select("id,status,aberto_em,tipo,codigo_empresa").single();if(o)throw console.error("[getOrCreateComandaBalcao] ERRO ao criar comanda:",o),o;return console.log("[getOrCreateComandaBalcao] Comanda criada com sucesso:",s),console.log("[getOrCreateComandaBalcao] Codigo da comanda criada:",s?.codigo_empresa,"vs esperado:",t),await new Promise(i=>setTimeout(i,100)),s}async function zz({status:e,from:t,to:r,search:n="",limit:s=50,offset:o=0,codigoEmpresa:i}={}){const l=i||Va();let c=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").order("fechado_em",{ascending:!1,nullsFirst:!1}).order("aberto_em",{ascending:!1}).range(o,o+s-1);l&&(c=c.eq("codigo_empresa",l)),e&&Array.isArray(e)&&e.length?c=c.in("status",e):typeof e=="string"&&e!=="all"&&(e==="closed"?c=c.or("status.eq.closed,fechado_em.not.is.null").neq("status","cancelled"):c=c.eq("status",e));const d=v=>{if(!v)return null;if(typeof v=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(v)){const[y,b,w]=v.split("-").map(Number);return new Date(y,b-1,w,0,0,0,0)}return new Date(v)},u=v=>{if(!v)return null;if(typeof v=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(v)){const[y,b,w]=v.split("-").map(Number);return new Date(y,b-1,w,23,59,59,999)}return new Date(v)},f=d(t),h=u(r);f&&(c=c.gte("aberto_em",f.toISOString())),h&&(c=c.lte("aberto_em",h.toISOString()));const m=(n||"").trim();if(m){const v=/^\d+$/.test(m);if(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(m)){const b=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").eq("id",m).eq("codigo_empresa",l),w=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, diferenca_pagamento").eq("mesa_id",m).eq("codigo_empresa",l),[j,_]=await Promise.all([b,w]),C=j.data||[],E=_.data||[],S=[...C,...E];return Array.from(new Map(S.map(M=>[M.id,M])).values()).sort((M,O)=>new Date(O.fechado_em||O.aberto_em)-new Date(M.fechado_em||M.aberto_em))}else v?c=c.or(`id.eq.${m},status.ilike.%${m}%`):c=c.or(`status.ilike.%${m}%`)}const{data:x,error:g}=await c;if(g)throw g;return x||[]}async function fu({from:e,to:t,codigoEmpresa:r}={}){const n="[listarResumoPeriodo]",s=r||Va();console.log(`${n} Iniciando consulta`),console.log(`${n} Perodo: ${e||"SEM from"} at ${t||"SEM to"}`),console.log(`${n} codigo_empresa: ${s}`);let o=[];try{let h=Q.from("comandas").select("id, fechado_em").eq("status","closed");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("fechado_em",new Date(e).toISOString())),t&&(h=h.lte("fechado_em",new Date(t).toISOString()));const{data:m,error:x}=await h;if(x)throw x;o=m||[]}catch{o=[]}const i=(o||[]).map(h=>h.id);let l=0,c=0;if(i.length>0)try{let h=Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",i);s&&(h=h.eq("codigo_empresa",s));const{data:m,error:x}=await h;if(x)throw x;for(const g of m||[]){const v=Number(g.quantidade||0)*Number(g.preco_unitario||0),y=Number(g.desconto||0);l+=v,c+=y}}catch{}const d=Math.max(0,l-c),u={};let f=0;try{let h=Q.from("pagamentos").select("metodo, valor, recebido_em, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("recebido_em",new Date(e).toISOString())),t&&(h=h.lte("recebido_em",new Date(t).toISOString())),console.log(`${n} Consultando pagamentos de comandas...`);const{data:m,error:x}=await h;if(x)throw console.error(`${n}  Erro ao buscar pagamentos:`,x),x;console.log(`${n} Total de pagamentos de comandas encontrados: ${(m||[]).length}`);for(const g of m||[]){if(!((g.status||"Pago")!=="Cancelado"&&(g.status||"Pago")!=="Estornado"))continue;const y=g.finalizadoras?.nome||g.metodo||"outros",b=Number(g.valor||0);u[y]=(u[y]||0)+b,f+=b}console.log(`${n}  Resumo comandas por finalizadora:`,u)}catch(h){console.error(`${n}  Exception ao processar pagamentos de comandas:`,h)}try{let h=Q.from("agendamentos").select("id, inicio");s&&(h=h.eq("codigo_empresa",s)),e&&(h=h.gte("inicio",new Date(e).toISOString())),t&&(h=h.lte("inicio",new Date(t).toISOString())),console.log(`${n} Consultando agendamentos no perodo...`);const{data:m,error:x}=await h;if(x)throw console.error(`${n}  Erro ao buscar agendamentos:`,x),x;if(console.log(`${n} Total de agendamentos encontrados: ${(m||[]).length}`),m&&m.length>0){const g=m.map(w=>w.id);let v=Q.from("agendamento_participantes").select("valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, finalizadoras!agp_finalizadora_id_fkey(nome, taxa_percentual)").in("agendamento_id",g).eq("status_pagamento","Pago");s&&(v=v.eq("codigo_empresa",s)),console.log(`${n} Consultando participantes pagos...`);const{data:y,error:b}=await v;if(b)throw console.error(`${n}  Erro ao buscar participantes:`,b),b;console.log(`${n} Total de participantes pagos encontrados: ${(y||[]).length}`);for(const w of y||[]){const j=w.finalizadoras?.nome||"Outros";let _=Number(w.valor_cota||0);if(w.aplicar_taxa===!0){const C=Number(w.finalizadoras?.taxa_percentual||0);C>0&&(_=_/(1+C/100),console.log(`${n}  Participante com taxa: valor_cota=${w.valor_cota}, taxa=${C}%, valor_real=${_.toFixed(2)}`))}u[j]=(u[j]||0)+_,f+=_}console.log(`${n}  Resumo agendamentos por finalizadora:`,u)}}catch(h){console.error(`${n}  Exception ao processar pagamentos de agendamentos:`,h)}return console.log(`${n}  RESUMO FINAL por finalizadora:`,u),console.log(`${n} Total de entradas: R$ ${f.toFixed(2)}`),{from:e?new Date(e).toISOString():null,to:t?new Date(t).toISOString():null,totalPorFinalizadora:u,totalEntradas:f,totalVendasBrutas:l,totalDescontos:c,totalVendasLiquidas:d}}async function P1({codigoEmpresa:e}={}){const t=e||Va();let r=null;try{let s=Q.from("caixa_sessoes").select("aberto_em").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(s=s.eq("codigo_empresa",t));const{data:o,error:i}=await s;if(i)throw i;r=o?.[0]?.aberto_em||null}catch{}if(!r)return null;const n=new Date().toISOString();return fu({from:r,to:n,codigoEmpresa:t})}async function ine({comandaId:e,codigoEmpresa:t}={}){const r=t||Va();let n=Q.from("pagamentos").select("*, finalizadoras!pagamentos_finalizadora_id_fkey(id, nome, codigo_sefaz, codigo_interno)").order("recebido_em",{ascending:!0});e&&(n=n.eq("comanda_id",e)),r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function tw({searchTerm:e="",limit:t=20,codigoEmpresa:r}={}){const n=r||Va();let s=Q.from("clientes").select("*").eq("status","active").eq("flag_cliente",!0).order("nome",{ascending:!0}).limit(t);n&&(s=s.eq("codigo_empresa",n));const o=(e||"").trim();o&&(/^\d+$/.test(o)?s=s.or(`codigo.eq.${o},nome.ilike.%${o}%,email.ilike.%${o}%,telefone.ilike.%${o}%`):s=s.or(`nome.ilike.%${o}%,email.ilike.%${o}%,telefone.ilike.%${o}%`));const{data:i,error:l}=await s;if(l)throw l;return i||[]}async function yd({codigoEmpresa:e}={}){const t="[listarComandasAbertas]",r=e||Va(),n=async()=>{const s=new Promise((c,d)=>setTimeout(()=>d(new Error("listarComandasAbertas timeout aps 30s")),3e4));let o=Q.from("comandas").select("id, mesa_id, status, aberto_em, fechado_em, observacoes, observacoes_atualizadas_em, desconto_tipo, desconto_valor, desconto_motivo, total_com_desconto").is("fechado_em",null).neq("status","cancelled").order("aberto_em",{ascending:!1}).limit(500);r&&(o=o.eq("codigo_empresa",r));const{data:i,error:l}=await Promise.race([o,s]);if(l)throw l;return i||[]};try{try{return await n()}catch(s){if(String(s?.message||"").includes("timeout"))return console.warn(`${t} timeout na primeira tentativa, retornando array vazio`),[];throw s}}catch(s){return console.error(`${t}  EXCEPTION:`,s?.message||s),[]}}async function uKe({mesaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("mesaId  obrigatrio");const r=t||Va();let n=Q.from("comandas").select("id,status,fechado_em").eq("mesa_id",e).is("fechado_em",null).in("status",["open","awaiting-payment"]);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;if(Array.isArray(s)&&s.length>0)throw new Error("No  possvel inativar: existe comanda aberta vinculada a esta mesa.");let i=Q.from("mesas").select("id, numero, status").eq("id",e).limit(1);r&&(i=i.eq("codigo_empresa",r));const{data:l,error:c}=await i;if(c)throw c;const d=l?.[0];if(d&&Number(d.numero)===0)throw new Error("A mesa especial do balco no pode ser inativada.");let u=Q.from("mesas").update({status:"inactive"}).eq("id",e);r&&(u=u.eq("codigo_empresa",r));const{error:f}=await u;if(f)throw f;return!0}async function fKe(e){const t=e||Va();let r=Q.from("mesas").select("id, numero, nome, status").order("numero",{ascending:!0}).limit(500);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n||[]}async function mKe({mesaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("mesaId  obrigatrio");const r=t||Va();let n=Q.from("mesas").update({status:"available"}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{error:s}=await n;if(s)throw s;return!0}async function JS(e=[],t){if(!e||e.length===0)return{};const r=t||Va();let n=Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario").in("comanda_id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;const i={};for(const l of s||[]){const c=l.comanda_id,d=Number(l.quantidade||0)*Number(l.preco_unitario||0);i[c]=(i[c]||0)+d}return i}async function Lh(e){const t="[listMesas]",r=e||Va(),n=async()=>{const s=new Promise((c,d)=>setTimeout(()=>d(new Error("listMesas timeout aps 30s")),3e4));let o=Q.from("mesas").select("id, numero, nome, status").neq("status","inactive").order("numero",{ascending:!0}).limit(200);r&&(o=o.eq("codigo_empresa",r));const{data:i,error:l}=await Promise.race([o,s]);if(l)throw l;return i||[]};try{try{return await n()}catch(s){if(String(s?.message||"").includes("timeout"))return console.warn(`${t} timeout na primeira tentativa, retornando array vazio`),[];throw s}}catch(s){return console.error(`${t}  EXCEPTION:`,s?.message||s),[]}}async function hKe({comandaId:e,status:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");let n=Q.from("pagamentos").select("*").eq("comanda_id",e);t&&(n=n.eq("status",t)),n=n.order("created_at",{ascending:!0});const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function Hx({comandaId:e,linhas:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");const n=r||Va();if(Array.isArray(t)){await Q.from("pagamentos").delete().eq("comanda_id",e).eq("status","Pendente");for(const s of t){const o=Number(s?.valor||0);if(o<=0)continue;const i=s?.metodo||s?.metodoNome||"outros";await PR({comandaId:e,finalizadoraId:s?.finalizadoraId||s?.methodId||null,metodo:i,valor:o,status:"Pendente",codigoEmpresa:n,clienteId:s?.clienteId||s?.clientId||null})}}}async function pKe({comandaId:e,codigoEmpresa:t}={}){if(!e)throw new Error("comandaId  obrigatrio");const r=t||Va();let n=Q.from("pagamentos").update({status:"Pago",recebido_em:new Date().toISOString()}).eq("comanda_id",e).eq("status","Pendente");r&&(n=n.eq("codigo_empresa",r));const{error:s}=await n;if(s)throw s;return!0}async function gKe({numero:e,nome:t,codigoEmpresa:r}={}){const n=r||Va();let s=e;if(!s){let i=Q.from("mesas").select("numero").order("numero",{ascending:!1}).limit(1);n&&(i=i.eq("codigo_empresa",n));const{data:l,error:c}=await i;if(c)throw c;s=(l?.[0]?.numero||0)+1}const o={numero:s,status:"available"};t&&typeof t=="string"&&t.trim()&&(o.nome=t.trim()),n&&(o.codigo_empresa=n);try{const{data:i,error:l}=await Q.from("mesas").insert(o).select("*").single();if(l)throw l;return i}catch(i){const l=String(i?.message||i||"");if(/column\s+\"?nome\"?\s+of\s+relation/i.test(l)||/column\s+\"?nome\"?\s+does not exist/i.test(l)){const c={numero:s,status:"available"};n&&(c.codigo_empresa=n);const{data:d,error:u}=await Q.from("mesas").insert(c).select("*").single();if(u)throw u;return d}throw i}}async function bm({saldoInicial:e=0,codigoEmpresa:t}={}){const r=t||Va();let n=Q.from("caixa_sessoes").select("id,status,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;if(s&&s.length>0){const d=s[0];try{const u=new Date(d.aberto_em),f=new Date;if(u.toDateString()!==f.toDateString()){try{const b=await yd({codigoEmpresa:r});if(Array.isArray(b)&&b.length>0)return console.warn("[ensureCaixaAberto] Sesso de dia anterior detectada, mas h comandas abertas. No fechar automaticamente."),d}catch{}const m=f.toISOString();let x=0,g=0;try{const b=await fu({from:d.aberto_em,to:m,codigoEmpresa:r});x=Number(b?.totalEntradas||0)}catch{}try{let b=Q.from("caixa_movimentacoes").select("tipo,valor").eq("caixa_sessao_id",d.id);r&&(b=b.eq("codigo_empresa",r));const{data:w}=await b;for(const j of w||[]){const _=Number(j?.valor||0),C=String(j?.tipo||"").toLowerCase();C==="suprimento"||C==="ajuste"?g+=_:(C==="sangria"||C==="troco")&&(g-=_)}}catch{}const v=Number(d?.saldo_inicial||0)+x+g;let y=Q.from("caixa_sessoes").update({status:"closed",saldo_final:v,fechado_em:m}).eq("id",d.id).eq("status","open");r&&(y=y.eq("codigo_empresa",r)),await y;try{const b=await YS({caixaSessaoId:d.id,codigoEmpresa:r}).catch(async()=>await fu({from:d.aberto_em,to:m,codigoEmpresa:r})),w={codigo_empresa:r||Va(),caixa_sessao_id:d.id,periodo_de:b?.from||d.aberto_em,periodo_ate:b?.to||m,total_bruto:Number(b?.totalVendasBrutas||0),total_descontos:Number(b?.totalDescontos||0),total_liquido:Number(b?.totalVendasLiquidas||0),total_entradas:Number(b?.totalEntradas||0),por_finalizadora:b?.totalPorFinalizadora||{}},j=w.por_finalizadora;await Q.from("caixa_resumos").insert({...w,por_finalizadora:j&&typeof j!="string"?JSON.stringify(j):j})}catch{}}else{try{if(d?.saldo_inicial==null&&e!=null){let m=Q.from("caixa_sessoes").update({saldo_inicial:Number(e)||0}).eq("id",d.id);return r&&(m=m.eq("codigo_empresa",r)),await m,{...d,saldo_inicial:Number(e)||0}}}catch{}return d}}catch{}return d}const i={status:"open",saldo_inicial:e};r&&(i.codigo_empresa=r);const{data:l,error:c}=await Q.from("caixa_sessoes").insert(i).select("id,status,aberto_em").single();if(c)throw c;return l}async function $h({codigoEmpresa:e}={}){const t=e||Va();let r=Q.from("caixa_sessoes").select("id,status,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;return n?.[0]||null}async function lne({saldoFinal:e=null,valorFinalDinheiro:t=null,codigoEmpresa:r}={}){console.log("[fecharCaixa] Iniciando fechamento:",{valorFinalDinheiro:t,saldoFinal:e,codigoEmpresa:r});const n=r||Va();try{console.log("[fecharCaixa]  Limpeza preventiva: ajustando apenas comandas cancelled/closed sem fechado_em...");const{data:y}=await Q.from("comandas").select("id, status, fechado_em").eq("codigo_empresa",n).is("fechado_em",null).in("status",["cancelled","closed"]);if(y&&y.length>0){console.log(`[fecharCaixa]  Encontradas ${y.length} comandas (cancelled/closed) sem fechado_em, ajustando...`);const b=new Date().toISOString();for(const w of y)try{await Q.from("comandas").update({fechado_em:b}).eq("id",w.id).eq("codigo_empresa",n),console.log(`[fecharCaixa]  Comanda ${w.id} (status: ${w.status}) ajustada com fechado_em`)}catch{}}else console.log("[fecharCaixa]  Nenhuma comanda cancelled/closed sem fechado_em encontrada")}catch(y){console.warn("[fecharCaixa]  Erro na limpeza preventiva:",y?.message)}try{let y=await yd({codigoEmpresa:n});if(y=y||[],console.log(`[fecharCaixa]  Comandas abertas encontradas: ${y.length}`,y.map(w=>({id:w.id,status:w.status,mesa:w.mesa_id}))),y&&y.length>0){const w=y.map(j=>`${j.id}${j.mesa_id?`@mesa:${j.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${y.length} comanda(s) aberta(s). Feche todas as comandas antes de encerrar o caixa.`)}let b=0;for(;b<12&&(y=await yd({codigoEmpresa:n}),!(!y||y.length===0));)await new Promise(w=>setTimeout(w,250)),b++;if(y&&y.length>0){const w=y.map(E=>E.id);let j=new Map,_=new Map;try{if(w.length>0){let E=Q.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",w);n&&(E=E.eq("codigo_empresa",n));const{data:S}=await E;j=new Map;for(const A of S||[]){const M=A.comanda_id,O=Number(A.quantidade||0);j.set(M,(j.get(M)||0)+O)}}}catch{}try{if(w.length>0){let E=Q.from("pagamentos").select("comanda_id, status").in("comanda_id",w);n&&(E=E.eq("codigo_empresa",n));const{data:S}=await E;_=new Map;for(const A of S||[]){const M=String(A?.status||"Pago");if(M==="Cancelado"||M==="Estornado")continue;const O=A.comanda_id;_.set(O,(_.get(O)||0)+1)}}}catch{}for(const E of y){const S=Number(j.get(E.id)||0)>0,A=Number(_.get(E.id)||0)>0;if(!S&&!A)try{await U0({comandaId:E.id,codigoEmpresa:n})}catch{}}let C=await yd({codigoEmpresa:n});if(C=C||[],C.length>0){const E=C.map(O=>O.id);let S=new Map,A=new Map;try{if(E.length>0){let O=Q.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",E);n&&(O=O.eq("codigo_empresa",n));const{data:I}=await O;S=new Map;for(const T of I||[]){const k=T.comanda_id,q=Number(T.quantidade||0);S.set(k,(S.get(k)||0)+q)}}}catch{}try{if(E.length>0){let O=Q.from("pagamentos").select("comanda_id, status").in("comanda_id",E);n&&(O=O.eq("codigo_empresa",n));const{data:I}=await O;A=new Map;for(const T of I||[]){const k=String(T?.status||"Pago");if(k==="Cancelado"||k==="Estornado")continue;const q=T.comanda_id;A.set(q,(A.get(q)||0)+1)}}}catch{}const M=C.filter(O=>Number(S.get(O.id)||0)>0||Number(A.get(O.id)||0)>0);if(M.length>0){const O=M.map(I=>`${I.id}${I.mesa_id?`@mesa:${I.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${M.length} comandas abertas. IDs: ${O}. Feche todas antes de encerrar o caixa.`)}}}}catch(y){if(y&&/Existem \d+ comandas/.test(y.message||""))throw y;const b=new Error("Falha ao validar comandas abertas. Tente novamente e verifique sua conexo.");throw b.code="CASH_CLOSE_VALIDATION_FAILED",b}let s=Q.from("caixa_sessoes").select("id,aberto_em,saldo_inicial").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s;if(i)throw i;const l=o?.[0]?.id||null,c=o?.[0]?.aberto_em||null,d=Number(o?.[0]?.saldo_inicial||0);if(!l)throw new Error("Nenhuma sesso de caixa aberta encontrada.");const u=new Date().toISOString();let f=0,h=0;try{const y=await fu({from:c,to:u,codigoEmpresa:n});f=Number(y?.totalEntradas||0)}catch{}try{let y=Q.from("caixa_movimentacoes").select("tipo, valor").eq("caixa_sessao_id",l);n&&(y=y.eq("codigo_empresa",n));const{data:b}=await y;for(const w of b||[]){const j=Number(w?.valor||0),_=String(w?.tipo||"").toLowerCase();_==="suprimento"||_==="ajuste"?h+=j:(_==="sangria"||_==="troco")&&(h-=j)}}catch{}const m=e!=null?Number(e):d+f+h;try{let y=await yd({codigoEmpresa:n});if(y=y||[],y.length>0){const b=y.map(C=>C.id);let w=new Map,j=new Map;try{if(b.length>0){let C=Q.from("comanda_itens").select("comanda_id, quantidade").in("comanda_id",b);n&&(C=C.eq("codigo_empresa",n));const{data:E}=await C;w=new Map;for(const S of E||[]){const A=S.comanda_id,M=Number(S.quantidade||0);w.set(A,(w.get(A)||0)+M)}}}catch{}try{if(b.length>0){let C=Q.from("pagamentos").select("comanda_id, status").in("comanda_id",b);n&&(C=C.eq("codigo_empresa",n));const{data:E}=await C;j=new Map;for(const S of E||[]){const A=String(S?.status||"Pago");if(A==="Cancelado"||A==="Estornado")continue;const M=S.comanda_id;j.set(M,(j.get(M)||0)+1)}}}catch{}for(const C of y){const E=Number(w.get(C.id)||0)>0,S=Number(j.get(C.id)||0)>0;if(!E&&!S)try{await U0({comandaId:C.id,codigoEmpresa:n})}catch{}}let _=await yd({codigoEmpresa:n});if(_=_||[],_.length>0){const C=_.map(E=>`${E.id}${E.mesa_id?`@mesa:${E.mesa_id}`:"@balcao"}`).join(", ");throw new Error(`Existem ${_.length} comandas abertas. IDs: ${C}. Feche todas antes de encerrar o caixa.`)}}}catch(y){if(!(y&&y.message)){const b=new Error("Falha ao validar comandas abertas no momento do fechamento. Tente novamente.");throw b.code="CASH_CLOSE_FINAL_CHECK_FAILED",b}throw y}let x=Q.from("caixa_sessoes").update({status:"closed",saldo_final:m,fechado_em:u}).eq("id",l).eq("status","open");n&&(x=x.eq("codigo_empresa",n));const{data:g,error:v}=await x.select("id,status,fechado_em,saldo_final").single();if(v){const y=String(v.message||"");if(y.toLowerCase().includes("row")||y.toLowerCase().includes("single")){let b=Q.from("caixa_sessoes").select("id,status,fechado_em,saldo_final").eq("id",l).limit(1);n&&(b=b.eq("codigo_empresa",n));const{data:w}=await b;if(w&&w[0])return w[0]}throw v}try{if(c&&u&&g?.status==="closed"){let y;try{y=await YS({caixaSessaoId:l,codigoEmpresa:n})}catch{y=await fu({from:c,to:u,codigoEmpresa:n})}const b={codigo_empresa:n||Va(),caixa_sessao_id:l,periodo_de:y?.from||c,periodo_ate:y?.to||u,total_bruto:Number(y?.totalVendasBrutas||0),total_descontos:Number(y?.totalDescontos||0),total_liquido:Number(y?.totalVendasLiquidas||0),total_entradas:Number(y?.totalEntradas||0),por_finalizadora:y?.totalPorFinalizadora||{}},w=t!=null?Number(t):null,j=w!=null?w-Number(m||0):null;console.log("[fecharCaixa] Valores para snapshot:",{contado:w,diferenca:j,efetivoSaldoFinal:m,valorFinalDinheiroOriginal:t});const C=await(async E=>{const S={...E},A=S.por_finalizadora;A&&typeof A!="string"&&(S.por_finalizadora=JSON.stringify(A));let M=!0,O=!0;try{const z=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),F=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");z==="no"&&(M=!1),F==="no"&&(O=!1)}catch{}if(!M||!O)try{let z=Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:F}=await z;if(!F){M=!0,O=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}if(!M&&!O)return await Q.from("caixa_resumos").insert(S);let I={...S};M&&w!=null&&(I.valor_final_dinheiro=w),O&&j!=null&&(I.diferenca_dinheiro=j),console.log("[fecharCaixa] Tentando inserir snapshot com:",{supportValor:M,supportDif:O,contado:w,diferenca:j,hasValorFinalDinheiro:"valor_final_dinheiro"in I});const T=await Q.from("caixa_resumos").insert(I);if(!T.error)return T;const k=`${T.error?.message||""} ${T.error?.details||""}`.toLowerCase(),q=T.error?.code;if(q==="42703"||q==="PGRST204"||k.includes("column")||k.includes("schema cache")){try{I.valor_final_dinheiro!==void 0&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),I.diferenca_dinheiro!==void 0&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}return await Q.from("caixa_resumos").insert(S)}return T})(b);if(C.error)throw console.error("[fecharCaixa] Erro ao inserir snapshot:",C.error),C.error;console.log("[fecharCaixa]  Snapshot inserido com sucesso");try{const{data:E}=await Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").eq("caixa_sessao_id",l).order("criado_em",{ascending:!1}).limit(1).single();console.log("[fecharCaixa] Verificao ps-insert:",E)}catch(E){console.warn("[fecharCaixa] Falha ao verificar snapshot:",E?.message)}}}catch(y){console.warn("[fecharCaixa] Falha ao gravar snapshot de fechamento:",y)}try{let y=Q.from("caixa_sessoes").select("id,aberto_em,saldo_inicial").eq("status","open");n&&(y=y.eq("codigo_empresa",n));const{data:b}=await y;if(Array.isArray(b)&&b.length>0)for(const w of b)try{const j=w?.aberto_em,_=Number(w?.saldo_inicial||0),C=new Date().toISOString();let E=0,S=0;try{const M=await fu({from:j,to:C,codigoEmpresa:n});E=Number(M?.totalEntradas||0)}catch{}try{let M=Q.from("caixa_movimentacoes").select("tipo,valor").eq("caixa_sessao_id",w.id);n&&(M=M.eq("codigo_empresa",n));const{data:O}=await M;for(const I of O||[]){const T=Number(I?.valor||0),k=String(I?.tipo||"").toLowerCase();k==="suprimento"||k==="ajuste"?S+=T:(k==="sangria"||k==="troco")&&(S-=T)}}catch{}const A=_+E+S;await Q.from("caixa_sessoes").update({status:"closed",saldo_final:A,fechado_em:C}).eq("id",w.id).eq("status","open").eq(n?"codigo_empresa":"id",n||w.id);try{const M=await YS({caixaSessaoId:w.id,codigoEmpresa:n}).catch(async()=>await fu({from:j,to:C,codigoEmpresa:n})),O={codigo_empresa:n||Va(),caixa_sessao_id:w.id,periodo_de:M?.from||j,periodo_ate:M?.to||C,total_bruto:Number(M?.totalVendasBrutas||0),total_descontos:Number(M?.totalDescontos||0),total_liquido:Number(M?.totalVendasLiquidas||0),total_entradas:Number(M?.totalEntradas||0),por_finalizadora:M?.totalPorFinalizadora||{}},I=O.por_finalizadora;await Q.from("caixa_resumos").insert({...O,por_finalizadora:I&&typeof I!="string"?JSON.stringify(I):I})}catch{}}catch(j){try{console.warn("[fecharCaixa] Saneamento: falhou ao fechar sesso remanescente",w?.id,j?.message||j)}catch{}}}catch{}return g}async function cne({from:e,to:t,limit:r=50,codigoEmpresa:n}={}){console.log("[listarFechamentosCaixa] Iniciando busca de fechamentos",{from:e,to:t,limit:r});const s=n||Va();let o=Q.from("caixa_sessoes").select("id, aberto_em, fechado_em, saldo_inicial, saldo_final, status").eq("status","closed").order("fechado_em",{ascending:!1}).limit(r);s&&(o=o.eq("codigo_empresa",s)),e&&(o=o.gte("fechado_em",`${e}T00:00:00`)),t&&(o=o.lte("fechado_em",`${t}T23:59:59`));const{data:i,error:l}=await o;if(l)throw l;const c=Array.isArray(i)?i:[];if(console.log("[listarFechamentosCaixa] Sesses fechadas encontradas:",c.length),c.length===0)return[];const d=c.map(m=>m.id);let u=[];try{let m=!0,x=!0;try{const j=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),_=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");j==="no"&&(m=!1),_==="no"&&(x=!1)}catch{}if(!m||!x)try{let j=Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:_}=await j;if(!_){m=!0,x=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}const g=["caixa_sessao_id"];m&&g.push("valor_final_dinheiro"),x&&g.push("diferenca_dinheiro");const v=g.join(", ");let y=Q.from("caixa_resumos").select(v).in("caixa_sessao_id",d).order("criado_em",{ascending:!1});s&&(y=y.eq("codigo_empresa",s));let{data:b,error:w}=await y;if(w){const j=w?.code,_=`${w?.message||""} ${w?.details||""}`.toLowerCase();if(j==="42703"||j==="PGRST204"||_.includes("column")||_.includes("schema cache")){try{m&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),x&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}let E=Q.from("caixa_resumos").select("caixa_sessao_id").in("caixa_sessao_id",d).order("criado_em",{ascending:!1});s&&(E=E.eq("codigo_empresa",s));const{data:S}=await E;u=S||[]}else throw w}else u=b||[]}catch(m){console.warn("[listarFechamentosCaixa] Erro ao buscar snapshots:",m?.message),u=[]}console.log("[listarFechamentosCaixa] Snapshots encontrados:",u.length,u);const f=new Map(u.map(m=>[m.caixa_sessao_id,m])),h=c.map(m=>{const x=f.get(m.id),g={...m,valor_final_dinheiro:x?.valor_final_dinheiro??null,diferenca_dinheiro:x?.diferenca_dinheiro??null};return x&&console.log(`[listarFechamentosCaixa] Sesso ${m.id} enriquecida com snapshot:`,{valor_final_dinheiro:x.valor_final_dinheiro,diferenca_dinheiro:x.diferenca_dinheiro}),g});return console.log("[listarFechamentosCaixa] Resultado final:",h.length,"sesses com dados enriquecidos"),h}async function QS({caixaSessaoId:e,codigoEmpresa:t}={}){if(!e)throw new Error("caixaSessaoId  obrigatrio");const r=t||Va();let n=null;try{let s=!0,o=!0;try{const f=localStorage.getItem("schema:caixa_resumos:valor_final_dinheiro"),h=localStorage.getItem("schema:caixa_resumos:diferenca_dinheiro");f==="no"&&(s=!1),h==="no"&&(o=!1)}catch{}if(!s||!o)try{let f=Q.from("caixa_resumos").select("valor_final_dinheiro, diferenca_dinheiro").limit(1);const{error:h}=await f;if(!h){s=!0,o=!0;try{localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","yes"),localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","yes")}catch{}}}catch{}const i=["caixa_sessao_id","periodo_de","periodo_ate","total_bruto","total_descontos","total_liquido","total_entradas","por_finalizadora"];s&&i.push("valor_final_dinheiro"),o&&i.push("diferenca_dinheiro");const l=i.join(", ");let c=Q.from("caixa_resumos").select(l).eq("caixa_sessao_id",e).order("criado_em",{ascending:!1}).limit(1);r&&(c=c.eq("codigo_empresa",r));let{data:d,error:u}=await c;if(u){const f=u?.code,h=`${u?.message||""} ${u?.details||""}`.toLowerCase();if(f==="42703"||f==="PGRST204"||h.includes("column")||h.includes("schema cache")){try{s&&localStorage.setItem("schema:caixa_resumos:valor_final_dinheiro","no"),o&&localStorage.setItem("schema:caixa_resumos:diferenca_dinheiro","no")}catch{}let x=Q.from("caixa_resumos").select("caixa_sessao_id, periodo_de, periodo_ate, total_bruto, total_descontos, total_liquido, total_entradas, por_finalizadora").eq("caixa_sessao_id",e).order("criado_em",{ascending:!1}).limit(1);r&&(x=x.eq("codigo_empresa",r));const{data:g}=await x;n=g?.[0]||null}else throw u}else n=d?.[0]||null}catch(s){try{console.warn("[getCaixaResumo] Snapshot select falhou, usando fallback dinmico:",s?.message||s)}catch{}}if(!n||typeof n.saldo_inicial>"u"||typeof n.saldo_final>"u"){const s=await YS({caixaSessaoId:e,codigoEmpresa:r});let o=null;try{let i=Q.from("caixa_sessoes").select("saldo_inicial, saldo_final").eq("id",e).limit(1);r&&(i=i.eq("codigo_empresa",r));const{data:l}=await i;o=l?.[0]||null}catch{}n={codigo_empresa:r,caixa_sessao_id:e,periodo_de:s?.from||null,periodo_ate:s?.to||null,total_bruto:Number(s?.totalVendasBrutas||0),total_descontos:Number(s?.totalDescontos||0),total_liquido:Number(s?.totalVendasLiquidas||0),total_entradas:Number(s?.totalEntradas||0),por_finalizadora:s?.totalPorFinalizadora||{},saldo_inicial:Number(o?.saldo_inicial??s?.saldoInicial??0),saldo_final:o?.saldo_final!=null?Number(o.saldo_final):null,movimentos:s?.movimentos||{suprimentos:0,sangrias:0,ajustes:0,troco:0,totalMovimentos:0}}}else if(typeof n.por_finalizadora=="string")try{n.por_finalizadora=JSON.parse(n.por_finalizadora)}catch{n.por_finalizadora={}}return n}async function u3({tipo:e,valor:t,observacao:r="",caixaSessaoId:n,codigoEmpresa:s}={}){const o=s||Va();if(!e||!["sangria","suprimento","troco","ajuste"].includes(e))throw new Error("Tipo invlido de movimentao");let i=n;if(!i){let u=Q.from("caixa_sessoes").select("id").eq("status","open").order("aberto_em",{ascending:!1}).limit(1);o&&(u=u.eq("codigo_empresa",o));const{data:f,error:h}=await u;if(h)throw h;i=f?.[0]?.id||null}if(!i)throw new Error("Sesso de caixa no encontrada para registrar movimentao");const l={codigo_empresa:o,caixa_sessao_id:i,tipo:e,valor:Math.max(0,Number(t)||0),observacao:(r||"").trim()||null},{data:c,error:d}=await Q.from("caixa_movimentacoes").insert(l).select("*").single();if(d)throw d;return c}async function Fg({caixaSessaoId:e,codigoEmpresa:t}={}){const r=t||Va();if(!e)throw new Error("caixaSessaoId  obrigatrio");let n=Q.from("caixa_movimentacoes").select("*").eq("caixa_sessao_id",e).order("criado_em",{ascending:!0});r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function xKe({mesaId:e,codigoEmpresa:t}={}){const r=t||Va();await AR({codigoEmpresa:r}),console.log(`[abrirComandaParaMesa] Iniciando para mesaId: ${e}, codigo_empresa: ${r}`);try{const n={status:"open",aberto_em:new Date().toISOString()};e&&(n.mesa_id=e),console.log("[abrirComandaParaMesa] Payload (codigo_empresa via DEFAULT):",n);const{data:s,error:o}=await Q.from("comandas").insert(n).select("*").single();if(o)throw console.error("[abrirComandaParaMesa] ERRO ao criar comanda:",o),o;return console.log("[abrirComandaParaMesa]  Comanda criada:",s),await new Promise(i=>setTimeout(i,100)),s}catch(n){throw console.error("[abrirComandaParaMesa] ERRO:",n),n}}async function vKe({mesaId:e,codigoEmpresa:t}){const r=t||Va();let n=Q.from("comandas").select("id,status,aberto_em,fechado_em").eq("mesa_id",e).is("fechado_em",null).in("status",["open","awaiting-payment"]).order("aberto_em",{ascending:!1}).limit(1);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s?.[0]||null}async function ci({comandaId:e,codigoEmpresa:t}){const r=t||Va();let n=Q.from("comanda_itens").select("*").eq("comanda_id",e).order("created_at",{ascending:!0});r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n;if(o)throw o;return s||[]}async function Ph({codigoEmpresa:e}){const t=e||Va();let r=Q.from("comandas").select("id").is("fechado_em",null);t&&(r=r.eq("codigo_empresa",t));const{data:n,error:s}=await r;if(s)throw s;if(console.log("[listarItensDeTodasComandasAbertas] Comandas abertas:",n?.length||0,"IDs:",n?.map(d=>d.id)),!n||n.length===0)return console.log("[listarItensDeTodasComandasAbertas] Nenhuma comanda aberta encontrada"),[];const o=n.map(d=>d.id);let i=Q.from("comanda_itens").select("produto_id, quantidade").in("comanda_id",o);t&&(i=i.eq("codigo_empresa",t));const{data:l,error:c}=await i;if(c)throw c;return console.log("[listarItensDeTodasComandasAbertas] Itens encontrados:",l?.length||0),l&&l.length>0&&console.log("[listarItensDeTodasComandasAbertas] Detalhes dos itens:",l),l||[]}const V_=new Map;async function yKe({mesaId:e,codigoEmpresa:t}={}){const r=`${e}:${t||Va()}`;if(V_.has(r))return console.log(`[getOrCreateComandaForMesa]  Operao j em andamento para mesa ${e}, aguardando...`),V_.get(r);const n=t||Va(),s=(async()=>{try{await AR({codigoEmpresa:n}),console.log(`[getOrCreateComandaForMesa]  Criando nova comanda para mesa ${e}`);const o=await vKe({mesaId:e,codigoEmpresa:n});if(o){console.log(`[getOrCreateComandaForMesa]  Comanda existente ${o.id} encontrada, verificando se est vazia...`);let l=!1,c=!1;try{l=(await ci({comandaId:o.id,codigoEmpresa:n})||[]).length>0}catch{}try{const{data:d}=await Q.from("pagamentos").select("id, status").eq("comanda_id",o.id).eq("codigo_empresa",n);c=(d||[]).filter(f=>{const h=String(f?.status||"Pago");return h!=="Cancelado"&&h!=="Estornado"}).length>0}catch{}if(!l&&!c){console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} est vazia, fechando automaticamente...`);try{await U0({comandaId:o.id,codigoEmpresa:n}),console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} fechada com sucesso`)}catch(d){console.warn(`[getOrCreateComandaForMesa]  Erro ao fechar comanda ${o.id}:`,d?.message)}}else console.log(`[getOrCreateComandaForMesa]  Comanda ${o.id} tem dados (itens: ${l}, pagamentos: ${c}), no ser fechada automaticamente`)}console.log(`[getOrCreateComandaForMesa]  Criando comanda zerada para mesa ${e}`);const i=await xKe({mesaId:e,codigoEmpresa:n});return console.log(`[getOrCreateComandaForMesa]  Comanda ${i.id} criada com sucesso`),i}finally{V_.delete(r),console.log(`[getOrCreateComandaForMesa]  Lock liberado para mesa ${e}`)}})();return V_.set(r,s),s}async function rw({comandaId:e,clienteIds:t=[],nomesLivres:r=[],codigoEmpresa:n,replace:s=!1}={}){const o=n||Va();if(!e)throw new Error("comandaId  obrigatrio");let i=[],l=[];try{i=Array.isArray(t)?t:t?[t]:[]}catch(m){console.warn("[adicionarClientesAComanda] Erro ao processar clienteIds:",m),i=[]}try{l=Array.isArray(r)?r:r?[r]:[]}catch(m){console.warn("[adicionarClientesAComanda] Erro ao processar nomesLivres:",m),l=[]}const c=i.map(m=>m&&typeof m=="object"?m.id||m.cliente_id||m.value:m).filter(Boolean),d=l.map(m=>m&&typeof m=="object"?m.nome||m.name||m.label:m).map(m=>String(m||"").trim()).filter(Boolean);if(console.log(`[adicionarClientesAComanda] Adicionando clientes  comanda ${e}:`,{clienteIds:c,nomesLivres:d,codigo:o,replace:s}),s){const{error:m}=await Q.from("comanda_clientes").delete().eq("comanda_id",e);m&&console.warn("[adicionarClientesAComanda] Erro ao limpar clientes existentes:",m)}const u=[];if(Array.isArray(c)){let m=[];if(!s)try{const{data:g}=await Q.from("comanda_clientes").select("cliente_id, nome_livre").eq("comanda_id",e);m=Array.isArray(g)?g:[]}catch{}const x=new Set((m||[]).map(g=>g.cliente_id).filter(Boolean));for(let g=0;g<c.length;g++){const v=c[g];v&&(!s&&x.has(v)||u.push({comanda_id:e,cliente_id:v}))}}if(Array.isArray(d))for(let m=0;m<d.length;m++){const g=(d[m]||"").trim();g&&u.push({comanda_id:e,nome_livre:g})}if(u.length===0)return console.log("[adicionarClientesAComanda] Nenhum cliente para adicionar"),!0;let f=[];Array.isArray(u)&&(f=u.map(m=>o?{...m,codigo_empresa:o}:m)),console.log("[adicionarClientesAComanda] Payload para insero:",f);const{error:h}=await Q.from("comanda_clientes").insert(f);if(h)throw console.error("[adicionarClientesAComanda] ERRO ao inserir clientes:",h),h;return console.log("[adicionarClientesAComanda] Clientes adicionados com sucesso"),!0}async function nl({comandaId:e,codigoEmpresa:t}={}){if(t||Va(),!e)throw new Error("comandaId  obrigatrio");try{const{data:r,error:n}=await Q.from("comanda_clientes").select("id, cliente_id, nome_livre, clientes:clientes!comanda_clientes_cliente_id_fkey(id, codigo, nome, email, telefone)").eq("comanda_id",e).order("created_at",{ascending:!0});if(n)throw n;return(r||[]).map(s=>({id:s.id,tipo:s.cliente_id?"cadastrado":"livre",nome:s.clientes?.nome||s.nome_livre,cliente_id:s.cliente_id}))}catch{try{const{data:n,error:s}=await Q.from("comanda_clientes").select("id, cliente_id, nome_livre, clientes:clientes!fk_comanda_clientes_cliente(id, nome, email, telefone)").eq("comanda_id",e).order("created_at",{ascending:!0});if(s)throw s;return(n||[]).map(o=>({id:o.id,tipo:o.cliente_id?"cadastrado":"livre",nome:o.clientes?.nome||o.nome_livre,cliente_id:o.cliente_id}))}catch{const{data:s,error:o}=await Q.from("comanda_clientes").select("id, cliente_id, nome_livre").eq("comanda_id",e).order("created_at",{ascending:!0});if(o)throw o;return(s||[]).map(i=>({id:i.id,tipo:i.cliente_id?"cadastrado":"livre",nome:i.nome_livre||"",cliente_id:i.cliente_id}))}}}async function f3({comandaId:e,produtoId:t,descricao:r,quantidade:n,precoUnitario:s,desconto:o=0,codigoEmpresa:i}){const l=i||Va();console.log(`[adicionarItem] Adicionando item  comanda ${e}:`,{produtoId:t,descricao:r,quantidade:n,precoUnitario:s,codigo:l});try{let f=Q.from("produtos").select("id, estoque, estoque_minimo, nome").eq("id",t).limit(1);l&&(f=f.eq("codigo_empresa",l));const{data:h,error:m}=await f;if(m)throw m;const x=Array.isArray(h)?h[0]:h;if(x){const g=Number(x.estoque??0),v=Number(x.estoque_minimo??0),y=Number(n??1);if(g<=0){const E=new Error(`Produto sem estoque: ${x.nome||""}`.trim());throw E.code="OUT_OF_STOCK",E}let b=Q.from("comanda_itens").select("quantidade").eq("comanda_id",e).eq("produto_id",t);l&&(b=b.eq("codigo_empresa",l));const{data:w,error:j}=await b;if(j)throw j;const _=Array.isArray(w)&&w.length?w.reduce((E,S)=>E+Number(S?.quantidade||0),0):0;if(_+y>g){const E=new Error(`Estoque insuficiente. Em comanda: ${_}, solicitado: +${y}, disponvel: ${g}`);throw E.code="INSUFFICIENT_STOCK",E}if(g<=v&&g>0)try{console.warn(`[adicionarItem] Aviso: estoque baixo para produto '${x.nome}' (estoque=${g}, minimo=${v})`)}catch{}}}catch(f){throw f}const c={comanda_id:e,produto_id:t,descricao:r,quantidade:n,preco_unitario:s,desconto:o};l&&(c.codigo_empresa=l);const{data:d,error:u}=await Q.from("comanda_itens").insert(c).select("*").single();if(u)throw u;return d}async function Qd({itemId:e,quantidade:t,codigoEmpresa:r}){const n=r||Va();let s=Q.from("comanda_itens").select("id, quantidade, produto_id, comanda_id").eq("id",e).limit(1);n&&(s=s.eq("codigo_empresa",n));const{data:o,error:i}=await s;if(i)throw i;const l=Array.isArray(o)?o[0]:o,c=Number(t||0);if(!l)throw new Error("Item no encontrado");const d=Number(l.quantidade||0);if(c-d>0){let x=Q.from("produtos").select("id, estoque, nome, estoque_minimo").eq("id",l.produto_id).limit(1);n&&(x=x.eq("codigo_empresa",n));const{data:g,error:v}=await x;if(v)throw v;const y=Array.isArray(g)?g[0]:g;if(y){const b=Number(y.estoque??0);let w=Q.from("comanda_itens").select("quantidade").eq("comanda_id",l.comanda_id).eq("produto_id",l.produto_id).neq("id",l.id);n&&(w=w.eq("codigo_empresa",n));const{data:j,error:_}=await w;if(_)throw _;const C=Array.isArray(j)&&j.length?j.reduce((M,O)=>M+Number(O?.quantidade||0),0):0;if(C+c>b){const M=new Error(`Estoque insuficiente. Em comanda (outros itens): ${C}, novo para este item: ${c}, disponvel: ${b}`);throw M.code="INSUFFICIENT_STOCK",M}const S=Number(y.estoque_minimo??0),A=b-(C+c);if(A<=S&&A>=0)try{console.warn(`[atualizarQuantidadeItem] Aviso: produto '${y.nome}' atingiu nvel de estoque baixo (restante=${A}, minimo=${S})`)}catch{}}}let f=Q.from("comanda_itens").update({quantidade:c}).eq("id",e);n&&(f=f.eq("codigo_empresa",n));const{data:h,error:m}=await f.select("*").single();if(m)throw m;return h}async function Dv({itemId:e,codigoEmpresa:t}){const r=t||Va();let n=Q.from("comanda_itens").delete().eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("id");if(o&&o.code!=="PGRST116")throw o;return Array.isArray(s)&&s.length>0}function bKe(e){if(!e)return!1;const t=e.code?String(e.code):"",r=[e.message,e.details,e.hint].filter(Boolean).join(" ").toLowerCase();return t==="22P02"||r.includes("invalid input value for enum")}async function PR({comandaId:e,finalizadoraId:t,metodo:r,valor:n,status:s="Pago",codigoEmpresa:o,clienteId:i=null}){const l=o||Va();if(!l)throw new Error("Empresa no identificada (codigo_empresa ausente).");const c=s&&["Pendente","Pago","Estornado","Cancelado"].includes(s)?s:"Pago",d=["dinheiro","credito","debito","pix","voucher","outros"],f=(m=>{if(!m)return"outros";const x=String(m).toLowerCase().trim(),v={"cartao credito":"credito","carto credito":"credito","cartao debito":"debito","carto debito":"debito","carto de credito":"credito","carto de dbito":"debito","cartao de credito":"credito","cartao de debito":"debito"}[x]||x;return d.includes(v)?v:"outros"})(r),h={comanda_id:e,finalizadora_id:t||null,metodo:f,valor:Math.max(0,Number(n)||0),status:c,recebido_em:new Date().toISOString(),codigo_empresa:l};i&&(h.cliente_id=i),console.log("[registrarPagamento] Iniciando registro de pagamento:",{comandaId:e,finalizadoraId:t,metodo:f,valor:h.valor,status:h.status,codigoEmpresa:l,payload:h});try{const{data:m,error:x}=await Q.from("pagamentos").insert(h).select().single();if(x){console.warn("[registrarPagamento] Primeira tentativa falhou:",{code:x.code,message:x.message});const g=`${x?.message||""} ${x?.details||""}`.toLowerCase();if(x?.code==="42703"||g.includes("column")&&g.includes("cliente_id")){const{cliente_id:y,...b}=h;try{localStorage.setItem("schema:pagamentos:cliente_id","no")}catch{}const{data:w,error:j}=await Q.from("pagamentos").insert(b).select().single();if(j)throw j;return console.log("[registrarPagamento] Pagamento registrado sem cliente_id:",w),w}if(bKe(x)){console.log("[registrarPagamento] Tentando abordagem alternativa sem status...");try{const y={...h};delete y.status;const{data:b,error:w}=await Q.from("pagamentos").insert(y).select().single();if(w)throw w;return console.log("[registrarPagamento] Pagamento registrado com sucesso (abordagem alternativa):",b),b}catch(y){throw console.error("[registrarPagamento] Falha na abordagem alternativa:",y),new Error(`Falha ao processar pagamento: ${y.message}`)}}throw x}return console.log("[registrarPagamento] Pagamento registrado com sucesso:",m),m}catch(m){throw console.error("[registrarPagamento] Erro ao registrar pagamento:",{error:{message:m.message,code:m.code,details:m.details,hint:m.hint},comandaId:e,finalizadoraId:t,valor:h.valor,status:h.status,codigoEmpresa:l}),m}}async function U0({comandaId:e,codigoEmpresa:t,diferencaPagamento:r}){const n=t||Va(),s="[fecharComandaEMesa]";try{console.group(s)}catch{}try{console.time?.(s)}catch{}try{console.log(`${s} Iniciando fechamento da comanda ${e}`),console.log(`${s} Obtendo dados da comanda...`);const{data:o,error:i}=await Q.from("comandas").select("id, mesa_id, status, fechado_em").eq("id",e).single();if(i||!o)throw console.error(`${s} Erro ao buscar comanda:`,i?.message||"Comanda no encontrada"),i||new Error("Comanda no encontrada");if(o.fechado_em)return console.log(`${s} Comanda ${e} j est fechada em ${o.fechado_em}`),!0;const l=new Date().toISOString();console.log(`${s} Atualizando comanda...`);const c={status:"closed",fechado_em:l};typeof r=="number"&&Number.isFinite(r)&&(c.diferenca_pagamento=r),console.log(`${s} Fechando comanda com status closed + fechado_em${c.diferenca_pagamento!=null?" + diferenca_pagamento":""}...`);let{error:d}=await Q.from("comandas").update(c).eq("id",e).eq("codigo_empresa",n);if(d&&d.code==="42703"){console.warn(`${s} Coluna diferenca_pagamento ausente no schema, tentando novamente sem ela...`);const u={status:"closed",fechado_em:l};({error:d}=await Q.from("comandas").update(u).eq("id",e).eq("codigo_empresa",n))}if(d)throw console.error(`${s} Erro ao fechar comanda:`,d),d;if(console.log(`${s} Comanda ${e} fechada com sucesso`),o.mesa_id){console.log(`${s} Atualizando status da mesa ${o.mesa_id} para disponvel...`);try{const{error:u}=await Q.from("mesas").update({status:"available"}).eq("id",o.mesa_id).select("id").single();u?console.error(`${s} Erro ao atualizar status da mesa:`,u):console.log(`${s} Mesa ${o.mesa_id} marcada como disponvel`)}catch(u){console.error(`${s} Exceo ao atualizar mesa:`,u)}}else console.log(`${s} Nenhuma mesa associada para liberar`);return console.log(`${s} Fechamento da comanda ${e} concludo com sucesso`),!0}catch(o){throw console.error(`${s} Erro fatal ao fechar comanda:`,o),o}finally{try{console.timeEnd?.(s)}catch{}try{console.groupEnd()}catch{}}}async function Uz({comandaId:e,codigoEmpresa:t}){const r=t||Va(),n="[cancelarComandaEMesa]";try{console.group(n)}catch{}try{console.time?.(n)}catch{}try{if(!e)throw new Error("comandaId obrigatrio");if(!r)throw new Error("codigo_empresa obrigatrio");console.log(`${n} Cancelando comanda ${e}`);const{data:s}=await Q.from("comandas").select("id, mesa_id").eq("id",e).single();try{await Q.from("comanda_itens").delete().eq("comanda_id",e).eq("codigo_empresa",r)}catch{}try{await Q.from("comanda_clientes").delete().eq("comanda_id",e).eq("codigo_empresa",r)}catch{}const o=new Date().toISOString(),{data:i,error:l}=await Q.from("comandas").update({status:"cancelled",fechado_em:o}).eq("id",e).eq("codigo_empresa",r).select();if(l)throw console.error(`${n} Erro ao atualizar comanda:`,l),l;if(!i||i.length===0)throw console.error(`${n}  UPDATE no afetou nenhuma linha! Comanda ${e} no foi encontrada ou RLS bloqueou`),new Error("Comanda no encontrada ou sem permisso para cancelar");if(console.log(`${n}  Comanda atualizada:`,i[0]),s?.mesa_id){console.log(`${n} Liberando mesa ${s.mesa_id}`);try{await Q.from("mesas").update({status:"available"}).eq("id",s.mesa_id)}catch(c){console.error(`${n} Erro ao liberar mesa:`,c)}}return console.log(`${n} Comanda ${e} cancelada com sucesso`),!0}catch(s){throw console.error(`${n} Falha:`,s),s}finally{try{console.timeEnd?.(n)}catch{}try{console.groupEnd?.(n)}catch{}}}async function wKe({itemId:e,desconto_tipo:t,desconto_valor:r,desconto_motivo:n,codigoEmpresa:s}={}){const o=s||Va();if(!e)throw new Error("itemId  obrigatrio");if(!["percentual","fixo"].includes(t))throw new Error('Tipo de desconto deve ser "percentual" ou "fixo"');if(r<0)throw new Error("Desconto no pode ser negativo");if(t==="percentual"&&r>100)throw new Error("Desconto percentual no pode ser maior que 100%");let i=Q.from("comanda_itens").update({desconto_tipo:t,desconto_valor:Number(r),desconto_motivo:n||null}).eq("id",e);o&&(i=i.eq("codigo_empresa",o));const{data:l,error:c}=await i.select("*").single();if(c)throw c;return l}async function jKe({comandaId:e,desconto_tipo:t,desconto_valor:r,desconto_motivo:n,codigoEmpresa:s}={}){const o=s||Va();if(!e)throw new Error("comandaId  obrigatrio");if(!["percentual","fixo"].includes(t))throw new Error('Tipo de desconto deve ser "percentual" ou "fixo"');if(r<0)throw new Error("Desconto no pode ser negativo");if(t==="percentual"&&r>100)throw new Error("Desconto percentual no pode ser maior que 100%");let i=Q.from("comandas").update({desconto_tipo:t,desconto_valor:Number(r),desconto_motivo:n||null}).eq("id",e);o&&(i=i.eq("codigo_empresa",o));const{data:l,error:c}=await i.select("*").single();if(c)throw c;return l}async function _Ke({itemId:e,codigoEmpresa:t}={}){const r=t||Va();if(!e)throw new Error("itemId  obrigatrio");let n=Q.from("comanda_itens").update({desconto_tipo:null,desconto_valor:0,desconto_motivo:null}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("*").single();if(o)throw o;return s}async function NKe({comandaId:e,codigoEmpresa:t}={}){const r=t||Va();if(!e)throw new Error("comandaId  obrigatrio");let n=Q.from("comandas").update({desconto_tipo:null,desconto_valor:0,desconto_motivo:null}).eq("id",e);r&&(n=n.eq("codigo_empresa",r));const{data:s,error:o}=await n.select("*").single();if(o)throw o;return s}async function SKe({comandaId:e,observacoes:t,codigoEmpresa:r}={}){if(!e)throw new Error("comandaId  obrigatrio");const{error:n}=await Q.from("comandas").update({observacoes:(t||"").trim()||null,observacoes_atualizadas_em:new Date().toISOString()}).eq("id",e);if(n)throw n;return{id:e}}var yA="Tabs",[CKe,Act]=Nu(yA,[pA]),dne=pA(),[AKe,ER]=CKe(yA),une=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:s,defaultValue:o,orientation:i="horizontal",dir:l,activationMode:c="automatic",...d}=e,u=dA(l),[f,h]=zm({prop:n,onChange:s,defaultProp:o??"",caller:yA});return a.jsx(AKe,{scope:r,baseId:tf(),value:f,onValueChange:h,orientation:i,dir:u,activationMode:c,children:a.jsx(Qa.div,{dir:u,"data-orientation":i,...d,ref:t})})});une.displayName=yA;var fne="TabsList",mne=p.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...s}=e,o=ER(fne,r),i=dne(r);return a.jsx(fre,{asChild:!0,...i,orientation:o.orientation,dir:o.dir,loop:n,children:a.jsx(Qa.div,{role:"tablist","aria-orientation":o.orientation,...s,ref:t})})});mne.displayName=fne;var hne="TabsTrigger",pne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:s=!1,...o}=e,i=ER(hne,r),l=dne(r),c=vne(i.baseId,n),d=yne(i.baseId,n),u=n===i.value;return a.jsx(mre,{asChild:!0,...l,focusable:!s,active:u,children:a.jsx(Qa.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":d,"data-state":u?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:c,...o,ref:t,onMouseDown:aa(e.onMouseDown,f=>{!s&&f.button===0&&f.ctrlKey===!1?i.onValueChange(n):f.preventDefault()}),onKeyDown:aa(e.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&i.onValueChange(n)}),onFocus:aa(e.onFocus,()=>{const f=i.activationMode!=="manual";!u&&!s&&f&&i.onValueChange(n)})})})});pne.displayName=hne;var gne="TabsContent",xne=p.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:s,children:o,...i}=e,l=ER(gne,r),c=vne(l.baseId,n),d=yne(l.baseId,n),u=n===l.value,f=p.useRef(u);return p.useEffect(()=>{const h=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(h)},[]),a.jsx($d,{present:s||u,children:({present:h})=>a.jsx(Qa.div,{"data-state":u?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!h,id:d,tabIndex:0,...i,ref:t,style:{...e.style,animationDuration:f.current?"0s":void 0},children:h&&o})})});xne.displayName=gne;function vne(e,t){return`${e}-trigger-${t}`}function yne(e,t){return`${e}-content-${t}`}var PKe=une,bne=mne,wne=pne,jne=xne;const _d=PKe,xc=Ce.forwardRef(({className:e,...t},r)=>a.jsx(bne,{ref:r,className:Pr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));xc.displayName=bne.displayName;const Ya=Ce.forwardRef(({className:e,...t},r)=>a.jsx(wne,{ref:r,className:Pr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Ya.displayName=wne.displayName;const yo=Ce.forwardRef(({className:e,...t},r)=>a.jsx(jne,{ref:r,className:Pr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));yo.displayName=jne.displayName;function _ne({open:e,onOpenChange:t,client:r,onSaved:n}){const{toast:s}=Zs(),{userProfile:o}=lo(),i=I=>({tipo_pessoa:I?.tipo_pessoa||"PF",tipo_cadastro:I?.tipo_cadastro||"cliente",nome:I?.nome||"",apelido:I?.apelido||"",cpf:I?.cpf||"",cnpj:I?.cnpj||"",rg:I?.rg||"",ie:I?.ie||"",email:I?.email||"",telefone:I?.telefone||"",fone2:I?.fone2||"",celular1:I?.celular1||"",celular2:I?.celular2||"",whatsapp:I?.whatsapp||"",cep:I?.cep||"",endereco:I?.endereco||"",numero:I?.numero||"",complemento:I?.complemento||"",bairro:I?.bairro||"",cidade:I?.cidade||"",uf:I?.uf||"",cidade_ibge:I?.cidade_ibge||"",limite_credito:I?.limite_credito??"",tipo_recebimento:I?.tipo_recebimento||"",regime_tributario:I?.regime_tributario||"",tipo_contribuinte:I?.tipo_contribuinte||"",aniversario:I?.aniversario?String(I.aniversario).slice(0,10):"",sexo:I?.sexo||"",estado_civil:I?.estado_civil||"",nome_mae:I?.nome_mae||"",nome_pai:I?.nome_pai||"",observacoes:I?.observacoes||"",status:I?.status||"active"}),[l,c]=p.useState(i(r)),[d,u]=p.useState("basicos"),[f,h]=p.useState(!1);p.useEffect(()=>{let I="cliente";r?.flag_cliente&&r?.flag_fornecedor?I="ambos":r?.flag_fornecedor&&(I="fornecedor"),c({tipo_pessoa:r?.tipo_pessoa||"PF",tipo_cadastro:I,nome:r?.nome||"",apelido:r?.apelido||"",cpf:r?.cpf||"",cnpj:r?.cnpj||"",rg:r?.rg||"",ie:r?.ie||"",email:r?.email||"",telefone:r?.telefone||"",fone2:r?.fone2||"",celular1:r?.celular1||"",celular2:r?.celular2||"",whatsapp:r?.whatsapp||"",cep:r?.cep||"",endereco:r?.endereco||"",numero:r?.numero||"",complemento:r?.complemento||"",bairro:r?.bairro||"",cidade:r?.cidade||"",uf:r?.uf||"",cidade_ibge:r?.cidade_ibge||"",limite_credito:r?.limite_credito??"",tipo_recebimento:r?.tipo_recebimento||"",regime_tributario:r?.regime_tributario||"",tipo_contribuinte:r?.tipo_contribuinte||"",aniversario:r?.aniversario?String(r.aniversario).slice(0,10):"",sexo:r?.sexo||"",estado_civil:r?.estado_civil||"",nome_mae:r?.nome_mae||"",nome_pai:r?.nome_pai||"",observacoes:r?.observacoes||"",status:r?.status||"active"})},[r]),p.useEffect(()=>{e?c(i(r||null)):r||c(i(null))},[e,!!r]);const m=I=>{const{id:T,value:k}=I.target;c(q=>({...q,[T]:k}))},x=async()=>{try{const I=y.digits(l.cnpj);if(!I||I.length!==14){s({title:"CNPJ invlido",description:"Informe 14 dgitos para buscar.",variant:"destructive"});return}const T=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${I}`);if(!T.ok){let ie="Falha ao consultar CNPJ";try{const Y=await T.json();Y?.message&&(ie=Y.message)}catch{}throw new Error(ie)}const k=await T.json();try{console.info("[clientes] BuscarCNPJ:payload",k)}catch{}const q=k.razao_social||k.nome||"",B=k.nome_fantasia||"",z=k.logradouro||"",F=String(k.numero||""),V=k.complemento||"",me=k.bairro||"",be=k.municipio||k.localidade||"",U=k.uf||"",L=y.digits(k.cep||"");let H="";try{if(be&&U){const ie=await fetch(`https://brasilapi.com.br/api/ibge/municipios/v1/${U}`);if(ie.ok){const Y=await ie.json(),W=G=>String(G||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim(),se=W(be),pe=(Y||[]).find(G=>W(G.nome)===se);(pe?.codigo_ibge||pe?.codigo)&&(H=String(pe.codigo_ibge||pe.codigo))}}}catch{}c(ie=>({...ie,nome:q,apelido:B||q,endereco:z,numero:F,complemento:V,bairro:me,cidade:be,uf:U,cep:L,cidade_ibge:H||ie.cidade_ibge}));try{console.info("[clientes] BuscarCNPJ:setForm",{razao:q,fantasia:B,logradouro:z,numero:F,complemento:V,bairro:me,cidade:be,uf:U,cep:L,codigoIBGE:H})}catch{}s({title:"CNPJ carregado",description:"Dados preenchidos."})}catch(I){s({title:"Falha ao buscar CNPJ",description:I.message||"Tente novamente.",variant:"destructive"})}},g=I=>I===""?null:I,v=I=>{if(I==null)return null;if(typeof I=="number")return I;const T=String(I).trim();if(!T)return null;const k=T.replace(/\s+/g,"").replace(/\.(?=\d{3}(?:\D|$))/g,"").replace(/,/g,"."),q=Number(k);return Number.isFinite(q)?q:null},y=p.useMemo(()=>({digits:I=>(I||"").replace(/\D+/g,"")}),[]),b=I=>y.digits(I).slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"),w=I=>y.digits(I).slice(0,14).replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2"),j=I=>y.digits(I).slice(0,8).replace(/(\d{5})(\d)/,"$1-$2"),_=I=>{const T=y.digits(I).slice(0,11);return T.length<=10?T.replace(/(\d{2})(\d{4})(\d{0,4})/,"($1) $2-$3").trim():T.replace(/(\d{2})(\d{5})(\d{0,4})/,"($1) $2-$3").trim()},C=I=>String(I||"").replace(/[^a-z]/gi,"").toUpperCase().slice(0,2),E=(I,T=6)=>y.digits(I).slice(0,T),S=I=>{const T=y.digits(I);return T?(Number(T)/100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},A=(I,T)=>{let k=T;I==="cpf"&&(k=b(T)),I==="cnpj"&&(k=w(T)),I==="cep"&&(k=j(T)),["telefone","fone2","celular1","celular2","whatsapp"].includes(I)&&(k=_(T)),I==="uf"&&(k=C(T)),I==="numero"&&(k=E(T,8)),I==="cidade_ibge"&&(k=E(T,7)),I==="limite_credito"&&(k=S(T)),c(q=>({...q,[I]:k}))},M=async()=>{const I=y.digits(l.cep);if(!I||I.length!==8){s({title:"CEP invlido",description:"Informe 8 dgitos.",variant:"destructive"});return}try{h(!0),c(q=>({...q,endereco:"Buscando...",bairro:"Buscando...",cidade:"Buscando...",uf:""}));const k=await(await fetch(`https://viacep.com.br/ws/${I}/json/`)).json();if(k.erro)throw new Error("CEP no encontrado");c(q=>({...q,endereco:k.logradouro||"",bairro:k.bairro||"",cidade:k.localidade||"",uf:k.uf||"",cidade_ibge:k.ibge||""})),s({title:"CEP encontrado!",description:"Endereo preenchido automaticamente.",variant:"success"})}catch(T){c(k=>({...k,endereco:"",bairro:"",cidade:"",uf:""})),s({title:"Falha ao buscar CEP",description:T.message||"Tente novamente.",variant:"destructive"})}finally{h(!1)}},O=async I=>{I?.preventDefault?.(),window.__protectPaymentModal&&window.__protectPaymentModal(5e3);try{if(!l.nome||l.nome.trim().length<2)throw new Error("Informe o nome/razo social do cliente.");const T={tipo_pessoa:g(l.tipo_pessoa),nome:l.nome,apelido:g(l.apelido),cpf:g(l.cpf),cnpj:g(l.cnpj),rg:g(l.rg),ie:g(l.ie),email:g(l.email),telefone:g(l.telefone),fone2:g(l.fone2),celular1:g(l.celular1),celular2:g(l.celular2),whatsapp:g(l.whatsapp),cep:g(l.cep),endereco:g(l.endereco),numero:g(l.numero),complemento:g(l.complemento),bairro:g(l.bairro),cidade:g(l.cidade),uf:g(l.uf),cidade_ibge:g(l.cidade_ibge),limite_credito:v(l.limite_credito),tipo_recebimento:g(l.tipo_recebimento),regime_tributario:g(l.regime_tributario),tipo_contribuinte:g(l.tipo_contribuinte),aniversario:g(l.aniversario),sexo:g(l.sexo),estado_civil:g(l.estado_civil),nome_mae:g(l.nome_mae),nome_pai:g(l.nome_pai),observacoes:g(l.observacoes),flag_cliente:l.tipo_cadastro==="cliente"||l.tipo_cadastro==="ambos",flag_fornecedor:l.tipo_cadastro==="fornecedor"||l.tipo_cadastro==="ambos",flag_funcionario:!1,flag_administradora:!1,flag_parceiro:!1,flag_ccf_spc:!1,status:l.status};let k,q=null;if(r?.id){const{data:B,error:z}=await Q.from("clientes").update(T).eq("id",r.id).select().single();k=z,q=B??null}else{const B=o?.codigo_empresa||null;if(!B)throw new Error("No foi possvel identificar a empresa do usurio (codigo_empresa). Tente recarregar a pgina ou entrar novamente.");const z={...T,codigo_empresa:B},{data:F,error:V}=await Q.from("clientes").insert(z).select().single();k=V,q=F??null}if(k)throw k;s({title:"Cliente salvo!",description:"As informaes do cliente foram atualizadas.",variant:"success"}),n?.(q),setTimeout(()=>{t?.(!1)},50)}catch(T){const k=(T?.message||"").toLowerCase(),q=T?.code||"";let B="Erro ao salvar cliente",z=T.message;q==="23505"||k.includes("duplicate key")&&k.includes("uq_clientes_empresa_codigo")?(B="Cdigo j cadastrado",z="J existe um cliente com este cdigo na sua empresa. Deixe o campo cdigo em branco para gerar automaticamente ou escolha outro nmero."):k.includes("column")&&k.includes("does not exist")&&(z="Seu banco pode no estar migrado para os novos campos. Atualize o schema conforme estrutura_bd."),s({title:B,description:z,variant:"destructive"})}};return a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto w-full",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:r?"Editar Cliente":"Novo Cliente"}),a.jsx(ma,{children:"Preencha os dados cadastrais do cliente."})]}),a.jsx("form",{onSubmit:O,className:"grid gap-4 sm:gap-6 py-2",children:a.jsxs(_d,{value:d,onValueChange:u,className:"w-full",children:[a.jsx("div",{className:"sm:hidden mb-4",children:a.jsxs(Zn,{value:d,onValueChange:u,children:[a.jsx(Yn,{className:"w-full",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"basicos",children:"Dados Bsicos"}),a.jsx(nt,{value:"endereco",children:"Endereo"}),a.jsx(nt,{value:"financeiro",children:"Financeiro"}),a.jsx(nt,{value:"adicionais",children:"Adicionais"})]})]})}),a.jsxs(xc,{className:"hidden sm:grid grid-cols-4 gap-2",children:[a.jsx(Ya,{value:"basicos",children:"Dados Bsicos"}),a.jsx(Ya,{value:"endereco",children:"Endereo"}),a.jsx(Ya,{value:"financeiro",children:"Financeiro"}),a.jsx(Ya,{value:"adicionais",children:"Adicionais"})]}),a.jsx(yo,{value:"basicos",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{children:"Tipo de Pessoa"}),a.jsxs(Zn,{value:l.tipo_pessoa,onValueChange:I=>c(T=>({...T,tipo_pessoa:I})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Pessoa"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"PF",children:"Fsica"}),a.jsx(nt,{value:"PJ",children:"Jurdica"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{children:"Tipo de Cadastro *"}),a.jsxs(Zn,{value:l.tipo_cadastro,onValueChange:I=>c(T=>({...T,tipo_cadastro:I})),required:!0,children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"cliente",children:"Cliente"}),a.jsx(nt,{value:"fornecedor",children:"Fornecedor"}),a.jsx(nt,{value:"ambos",children:"Cliente e Fornecedor"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(ct,{htmlFor:"nome",children:l.tipo_pessoa==="PJ"?"Razo Social":"Nome"}),a.jsx(It,{id:"nome",value:l.nome,onChange:m,required:!0})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(ct,{htmlFor:"apelido",children:l.tipo_pessoa==="PJ"?"Nome Fantasia":"Apelido"}),a.jsx(It,{id:"apelido",value:l.apelido,onChange:m})]}),l.tipo_pessoa==="PF"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"cpf",children:"CPF"}),a.jsx(It,{id:"cpf",value:l.cpf,onChange:I=>A("cpf",I.target.value),placeholder:"000.000.000-00"})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"rg",children:"RG"}),a.jsx(It,{id:"rg",value:l.rg,onChange:m})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"cnpj",children:"CNPJ"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(It,{id:"cnpj",value:l.cnpj,onChange:I=>A("cnpj",I.target.value),placeholder:"00.000.000/0000-00"}),a.jsx(Z,{type:"button",variant:"outline",onClick:x,children:"Buscar"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"ie",children:"Inscrio Estadual (IE)"}),a.jsx(It,{id:"ie",value:l.ie,onChange:m})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(ct,{htmlFor:"email",children:"Email"}),a.jsx(It,{id:"email",type:"email",value:l.email,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"telefone",children:"Telefone"}),a.jsx(It,{id:"telefone",value:l.telefone,onChange:I=>A("telefone",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"celular1",children:"Celular"}),a.jsx(It,{id:"celular1",value:l.celular1,onChange:I=>A("celular1",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"whatsapp",children:"WhatsApp"}),a.jsx(It,{id:"whatsapp",value:l.whatsapp,onChange:I=>A("whatsapp",I.target.value),placeholder:"(DDD) 9...."})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"fone2",children:"Fone 2"}),a.jsx(It,{id:"fone2",value:l.fone2,onChange:I=>A("fone2",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"celular2",children:"Celular 2"}),a.jsx(It,{id:"celular2",value:l.celular2,onChange:I=>A("celular2",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"aniversario",children:"Nascimento"}),a.jsx(It,{id:"aniversario",type:"date",value:l.aniversario||"",onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{children:"Status"}),a.jsxs(Zn,{value:l.status,onValueChange:I=>c(T=>({...T,status:I})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Status"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"active",children:"Ativo"}),a.jsx(nt,{value:"inactive",children:"Inativo"})]})]})]})]})}),a.jsx(yo,{value:"endereco",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"cep",children:"CEP"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(It,{id:"cep",value:l.cep,onChange:I=>A("cep",I.target.value),placeholder:"00000-000"}),a.jsx(Z,{type:"button",variant:"outline",onClick:M,disabled:f,children:f?"Buscando...":"Buscar"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[a.jsx(ct,{htmlFor:"endereco",children:"Endereo"}),a.jsx(It,{id:"endereco",value:l.endereco,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"numero",children:"Nmero"}),a.jsx(It,{id:"numero",value:l.numero,onChange:I=>A("numero",I.target.value)})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(ct,{htmlFor:"complemento",children:"Complemento"}),a.jsx(It,{id:"complemento",value:l.complemento,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(ct,{htmlFor:"bairro",children:"Bairro"}),a.jsx(It,{id:"bairro",value:l.bairro,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"cidade",children:"Cidade"}),a.jsx(It,{id:"cidade",value:l.cidade,onChange:m})]}),a.jsxs("div",{className:"col-span-6 sm:col-span-1",children:[a.jsx(ct,{htmlFor:"uf",children:"UF"}),a.jsx(It,{id:"uf",value:l.uf,onChange:I=>A("uf",I.target.value),placeholder:"UF"})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"cidade_ibge",children:"Cd. IBGE"}),a.jsx(It,{id:"cidade_ibge",value:l.cidade_ibge,onChange:I=>A("cidade_ibge",I.target.value)})]})]})}),a.jsx(yo,{value:"financeiro",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{htmlFor:"limite_credito",children:"Limite de Crdito"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary text-sm",children:"R$"}),a.jsx(It,{id:"limite_credito",value:l.limite_credito,onChange:I=>A("limite_credito",I.target.value),placeholder:"0,00",className:"pl-10"})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{children:"Tipo de Recebimento"}),a.jsxs(Zn,{value:l.tipo_recebimento||"",onValueChange:I=>c(T=>({...T,tipo_recebimento:I})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"avista",children:" vista"}),a.jsx(nt,{value:"aprazo",children:"A prazo"}),a.jsx(nt,{value:"misto",children:"Misto"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{children:"Regime Tributrio"}),a.jsxs(Zn,{value:l.regime_tributario||"",onValueChange:I=>c(T=>({...T,regime_tributario:I})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"simples",children:"Simples"}),a.jsx(nt,{value:"lucro_presumido",children:"Lucro Presumido"}),a.jsx(nt,{value:"lucro_real",children:"Lucro Real"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[a.jsx(ct,{children:"Tipo de Contribuinte"}),a.jsxs(Zn,{value:l.tipo_contribuinte||"",onValueChange:I=>c(T=>({...T,tipo_contribuinte:I})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"nao_contribuinte",children:"No Contribuinte"}),a.jsx(nt,{value:"contribuinte",children:"Contribuinte"}),a.jsx(nt,{value:"isento",children:"Isento"})]})]})]})]})}),a.jsx(yo,{value:"adicionais",className:"space-y-3 sm:space-y-4 mt-2",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3 sm:gap-4",children:[a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(ct,{htmlFor:"sexo",children:"Sexo"}),a.jsxs(Zn,{value:l.sexo||"",onValueChange:I=>c(T=>({...T,sexo:I})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"m",children:"Masculino"}),a.jsx(nt,{value:"f",children:"Feminino"}),a.jsx(nt,{value:"o",children:"Outro"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(ct,{htmlFor:"estado_civil",children:"Estado Civil"}),a.jsxs(Zn,{value:l.estado_civil||"",onValueChange:I=>c(T=>({...T,estado_civil:I})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"solteiro",children:"Solteiro(a)"}),a.jsx(nt,{value:"casado",children:"Casado(a)"}),a.jsx(nt,{value:"divorciado",children:"Divorciado(a)"}),a.jsx(nt,{value:"viuvo",children:"Vivo(a)"})]})]})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(ct,{htmlFor:"nome_mae",children:"Nome da Me"}),a.jsx(It,{id:"nome_mae",value:l.nome_mae,onChange:m})]}),a.jsxs("div",{className:"col-span-12 sm:col-span-4",children:[a.jsx(ct,{htmlFor:"nome_pai",children:"Nome do Pai"}),a.jsx(It,{id:"nome_pai",value:l.nome_pai,onChange:m})]}),a.jsxs("div",{className:"col-span-12",children:[a.jsx(ct,{htmlFor:"observacoes",children:"Observaes"}),a.jsx("textarea",{id:"observacoes",value:l.observacoes,onChange:m,rows:4,className:"w-full rounded-md border border-border bg-background p-2 text-sm"})]})]})})]})}),a.jsxs(Ga,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Cancelar"})}),a.jsx(Z,{type:"submit",onClick:O,className:"w-full sm:w-auto",children:"Salvar Cliente"})]})]})})}function EKe(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const r=document.implementation.createHTMLDocument(),n=r.createElement("base"),s=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(s),t&&(n.href=t),s.href=e,s.href}const kKe=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function np(e){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r]);return t}let Gx=null;function Nne(e={}){return Gx||(e.includeStyleProperties?(Gx=e.includeStyleProperties,Gx):(Gx=np(window.getComputedStyle(document.documentElement)),Gx))}function ZS(e,t){const n=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return n?parseFloat(n.replace("px","")):0}function IKe(e){const t=ZS(e,"border-left-width"),r=ZS(e,"border-right-width");return e.clientWidth+t+r}function OKe(e){const t=ZS(e,"border-top-width"),r=ZS(e,"border-bottom-width");return e.clientHeight+t+r}function Sne(e,t={}){const r=t.width||IKe(e),n=t.height||OKe(e);return{width:r,height:n}}function TKe(){let e,t;try{t=process}catch{}const r=t&&t.env?t.env.devicePixelRatio:null;return r&&(e=parseInt(r,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const cd=16384;function DKe(e){(e.width>cd||e.height>cd)&&(e.width>cd&&e.height>cd?e.width>e.height?(e.height*=cd/e.width,e.width=cd):(e.width*=cd/e.height,e.height=cd):e.width>cd?(e.height*=cd/e.width,e.width=cd):(e.width*=cd/e.height,e.height=cd))}function eC(e){return new Promise((t,r)=>{const n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=r,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function MKe(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function RKe(e,t,r){const n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),o=document.createElementNS(n,"foreignObject");return s.setAttribute("width",`${t}`),s.setAttribute("height",`${r}`),s.setAttribute("viewBox",`0 0 ${t} ${r}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),s.appendChild(o),o.appendChild(e),MKe(s)}const Gc=(e,t)=>{if(e instanceof t)return!0;const r=Object.getPrototypeOf(e);return r===null?!1:r.constructor.name===t.name||Gc(r,t)};function FKe(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function LKe(e,t){return Nne(t).map(r=>{const n=e.getPropertyValue(r),s=e.getPropertyPriority(r);return`${r}: ${n}${s?" !important":""};`}).join(" ")}function $Ke(e,t,r,n){const s=`.${e}:${t}`,o=r.cssText?FKe(r):LKe(r,n);return document.createTextNode(`${s}{${o}}`)}function Vz(e,t,r,n){const s=window.getComputedStyle(e,r),o=s.getPropertyValue("content");if(o===""||o==="none")return;const i=kKe();try{t.className=`${t.className} ${i}`}catch{return}const l=document.createElement("style");l.appendChild($Ke(i,r,s,n)),t.appendChild(l)}function BKe(e,t,r){Vz(e,t,":before",r),Vz(e,t,":after",r)}const Wz="application/font-woff",Hz="image/jpeg",qKe={woff:Wz,woff2:Wz,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Hz,jpeg:Hz,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function zKe(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function kR(e){const t=zKe(e).toLowerCase();return qKe[t]||""}function UKe(e){return e.split(/,/)[1]}function m3(e){return e.search(/^(data:)/)!==-1}function Cne(e,t){return`data:${t};base64,${e}`}async function Ane(e,t,r){const n=await fetch(e,t);if(n.status===404)throw new Error(`Resource "${n.url}" not found`);const s=await n.blob();return new Promise((o,i)=>{const l=new FileReader;l.onerror=i,l.onloadend=()=>{try{o(r({res:n,result:l.result}))}catch(c){i(c)}},l.readAsDataURL(s)})}const HE={};function VKe(e,t,r){let n=e.replace(/\?.*/,"");return r&&(n=e),/ttf|otf|eot|woff2?/i.test(n)&&(n=n.replace(/.*\//,"")),t?`[${t}]${n}`:n}async function IR(e,t,r){const n=VKe(e,t,r.includeQueryParams);if(HE[n]!=null)return HE[n];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let s;try{const o=await Ane(e,r.fetchRequestInit,({res:i,result:l})=>(t||(t=i.headers.get("Content-Type")||""),UKe(l)));s=Cne(o,t)}catch(o){s=r.imagePlaceholder||"";let i=`Failed to fetch resource: ${e}`;o&&(i=typeof o=="string"?o:o.message),i&&console.warn(i)}return HE[n]=s,s}async function WKe(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):eC(t)}async function HKe(e,t){if(e.currentSrc){const o=document.createElement("canvas"),i=o.getContext("2d");o.width=e.clientWidth,o.height=e.clientHeight,i?.drawImage(e,0,0,o.width,o.height);const l=o.toDataURL();return eC(l)}const r=e.poster,n=kR(r),s=await IR(r,n,t);return eC(s)}async function GKe(e,t){var r;try{if(!((r=e?.contentDocument)===null||r===void 0)&&r.body)return await bA(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function KKe(e,t){return Gc(e,HTMLCanvasElement)?WKe(e):Gc(e,HTMLVideoElement)?HKe(e,t):Gc(e,HTMLIFrameElement)?GKe(e,t):e.cloneNode(Pne(e))}const XKe=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",Pne=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function YKe(e,t,r){var n,s;if(Pne(t))return t;let o=[];return XKe(e)&&e.assignedNodes?o=np(e.assignedNodes()):Gc(e,HTMLIFrameElement)&&(!((n=e.contentDocument)===null||n===void 0)&&n.body)?o=np(e.contentDocument.body.childNodes):o=np(((s=e.shadowRoot)!==null&&s!==void 0?s:e).childNodes),o.length===0||Gc(e,HTMLVideoElement)||await o.reduce((i,l)=>i.then(()=>bA(l,r)).then(c=>{c&&t.appendChild(c)}),Promise.resolve()),t}function JKe(e,t,r){const n=t.style;if(!n)return;const s=window.getComputedStyle(e);s.cssText?(n.cssText=s.cssText,n.transformOrigin=s.transformOrigin):Nne(r).forEach(o=>{let i=s.getPropertyValue(o);o==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),Gc(e,HTMLIFrameElement)&&o==="display"&&i==="inline"&&(i="block"),o==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),n.setProperty(o,i,s.getPropertyPriority(o))})}function QKe(e,t){Gc(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),Gc(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function ZKe(e,t){if(Gc(e,HTMLSelectElement)){const r=t,n=Array.from(r.children).find(s=>e.value===s.getAttribute("value"));n&&n.setAttribute("selected","")}}function eXe(e,t,r){return Gc(t,Element)&&(JKe(e,t,r),BKe(e,t,r),QKe(e,t),ZKe(e,t)),t}async function tXe(e,t){const r=e.querySelectorAll?e.querySelectorAll("use"):[];if(r.length===0)return e;const n={};for(let o=0;o<r.length;o++){const l=r[o].getAttribute("xlink:href");if(l){const c=e.querySelector(l),d=document.querySelector(l);!c&&d&&!n[l]&&(n[l]=await bA(d,t,!0))}}const s=Object.values(n);if(s.length){const o="http://www.w3.org/1999/xhtml",i=document.createElementNS(o,"svg");i.setAttribute("xmlns",o),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden",i.style.display="none";const l=document.createElementNS(o,"defs");i.appendChild(l);for(let c=0;c<s.length;c++)l.appendChild(s[c]);e.appendChild(i)}return e}async function bA(e,t,r){return!r&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(n=>KKe(n,t)).then(n=>YKe(e,n,t)).then(n=>eXe(e,n,t)).then(n=>tXe(n,t))}const Ene=/url\((['"]?)([^'"]+?)\1\)/g,rXe=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,nXe=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function aXe(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function sXe(e){const t=[];return e.replace(Ene,(r,n,s)=>(t.push(s),r)),t.filter(r=>!m3(r))}async function oXe(e,t,r,n,s){try{const o=r?EKe(t,r):t,i=kR(t);let l;if(s){const c=await s(o);l=Cne(c,i)}else l=await IR(o,i,n);return e.replace(aXe(t),`$1${l}$3`)}catch{}return e}function iXe(e,{preferredFontFormat:t}){return t?e.replace(nXe,r=>{for(;;){const[n,,s]=rXe.exec(r)||[];if(!s)return"";if(s===t)return`src: ${n};`}}):e}function kne(e){return e.search(Ene)!==-1}async function Ine(e,t,r){if(!kne(e))return e;const n=iXe(e,r);return sXe(n).reduce((o,i)=>o.then(l=>oXe(l,i,t,r)),Promise.resolve(n))}async function Kx(e,t,r){var n;const s=(n=t.style)===null||n===void 0?void 0:n.getPropertyValue(e);if(s){const o=await Ine(s,null,r);return t.style.setProperty(e,o,t.style.getPropertyPriority(e)),!0}return!1}async function lXe(e,t){await Kx("background",e,t)||await Kx("background-image",e,t),await Kx("mask",e,t)||await Kx("-webkit-mask",e,t)||await Kx("mask-image",e,t)||await Kx("-webkit-mask-image",e,t)}async function cXe(e,t){const r=Gc(e,HTMLImageElement);if(!(r&&!m3(e.src))&&!(Gc(e,SVGImageElement)&&!m3(e.href.baseVal)))return;const n=r?e.src:e.href.baseVal,s=await IR(n,kR(n),t);await new Promise((o,i)=>{e.onload=o,e.onerror=t.onImageErrorHandler?(...c)=>{try{o(t.onImageErrorHandler(...c))}catch(d){i(d)}}:i;const l=e;l.decode&&(l.decode=o),l.loading==="lazy"&&(l.loading="eager"),r?(e.srcset="",e.src=s):e.href.baseVal=s})}async function dXe(e,t){const n=np(e.childNodes).map(s=>One(s,t));await Promise.all(n).then(()=>e)}async function One(e,t){Gc(e,Element)&&(await lXe(e,t),await cXe(e,t),await dXe(e,t))}function uXe(e,t){const{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);const n=t.style;return n!=null&&Object.keys(n).forEach(s=>{r[s]=n[s]}),e}const Gz={};async function Kz(e){let t=Gz[e];if(t!=null)return t;const n=await(await fetch(e)).text();return t={url:e,cssText:n},Gz[e]=t,t}async function Xz(e,t){let r=e.cssText;const n=/url\(["']?([^"')]+)["']?\)/g,o=(r.match(/url\([^)]+\)/g)||[]).map(async i=>{let l=i.replace(n,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),Ane(l,t.fetchRequestInit,({result:c})=>(r=r.replace(i,`url(${c})`),[i,c]))});return Promise.all(o).then(()=>r)}function Yz(e){if(e==null)return[];const t=[],r=/(\/\*[\s\S]*?\*\/)/gi;let n=e.replace(r,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=s.exec(n);if(c===null)break;t.push(c[0])}n=n.replace(s,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(i,"gi");for(;;){let c=o.exec(n);if(c===null){if(c=l.exec(n),c===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;t.push(c[0])}return t}async function fXe(e,t){const r=[],n=[];return e.forEach(s=>{if("cssRules"in s)try{np(s.cssRules||[]).forEach((o,i)=>{if(o.type===CSSRule.IMPORT_RULE){let l=i+1;const c=o.href,d=Kz(c).then(u=>Xz(u,t)).then(u=>Yz(u).forEach(f=>{try{s.insertRule(f,f.startsWith("@import")?l+=1:s.cssRules.length)}catch(h){console.error("Error inserting rule from remote css",{rule:f,error:h})}})).catch(u=>{console.error("Error loading remote css",u.toString())});n.push(d)}})}catch(o){const i=e.find(l=>l.href==null)||document.styleSheets[0];s.href!=null&&n.push(Kz(s.href).then(l=>Xz(l,t)).then(l=>Yz(l).forEach(c=>{i.insertRule(c,i.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",o)}}),Promise.all(n).then(()=>(e.forEach(s=>{if("cssRules"in s)try{np(s.cssRules||[]).forEach(o=>{r.push(o)})}catch(o){console.error(`Error while reading CSS rules from ${s.href}`,o)}}),r))}function mXe(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>kne(t.style.getPropertyValue("src")))}async function hXe(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const r=np(e.ownerDocument.styleSheets),n=await fXe(r,t);return mXe(n)}function Tne(e){return e.trim().replace(/["']/g,"")}function pXe(e){const t=new Set;function r(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(o=>{t.add(Tne(o))}),Array.from(n.children).forEach(o=>{o instanceof HTMLElement&&r(o)})}return r(e),t}async function gXe(e,t){const r=await hXe(e,t),n=pXe(e);return(await Promise.all(r.filter(o=>n.has(Tne(o.style.fontFamily))).map(o=>{const i=o.parentStyleSheet?o.parentStyleSheet.href:null;return Ine(o.cssText,i,t)}))).join(`
`)}async function xXe(e,t){const r=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await gXe(e,t);if(r){const n=document.createElement("style"),s=document.createTextNode(r);n.appendChild(s),e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)}}async function vXe(e,t={}){const{width:r,height:n}=Sne(e,t),s=await bA(e,t,!0);return await xXe(s,t),await One(s,t),uXe(s,t),await RKe(s,r,n)}async function yXe(e,t={}){const{width:r,height:n}=Sne(e,t),s=await vXe(e,t),o=await eC(s),i=document.createElement("canvas"),l=i.getContext("2d"),c=t.pixelRatio||TKe(),d=t.canvasWidth||r,u=t.canvasHeight||n;return i.width=d*c,i.height=u*c,t.skipAutoScale||DKe(i),i.style.width=`${d}`,i.style.height=`${u}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,i.width,i.height)),l.drawImage(o,0,0,i.width,i.height),i}async function bXe(e,t={}){return(await yXe(e,t)).toDataURL()}var df=Uint8Array,Nd=Uint16Array,OR=Int32Array,TR=new df([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),DR=new df([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Jz=new df([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dne=function(e,t){for(var r=new Nd(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var s=new OR(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)s[o]=o-r[n]<<5|n;return{b:r,r:s}},Mne=Dne(TR,2),wXe=Mne.b,h3=Mne.r;wXe[28]=258,h3[258]=28;var jXe=Dne(DR,0),Qz=jXe.r,p3=new Nd(32768);for(var Bo=0;Bo<32768;++Bo){var ch=(Bo&43690)>>1|(Bo&21845)<<1;ch=(ch&52428)>>2|(ch&13107)<<2,ch=(ch&61680)>>4|(ch&3855)<<4,p3[Bo]=((ch&65280)>>8|(ch&255)<<8)>>1}var nw=function(e,t,r){for(var n=e.length,s=0,o=new Nd(t);s<n;++s)e[s]&&++o[e[s]-1];var i=new Nd(t);for(s=1;s<t;++s)i[s]=i[s-1]+o[s-1]<<1;var l;if(r){l=new Nd(1<<t);var c=15-t;for(s=0;s<n;++s)if(e[s])for(var d=s<<4|e[s],u=t-e[s],f=i[e[s]-1]++<<u,h=f|(1<<u)-1;f<=h;++f)l[p3[f]>>c]=d}else for(l=new Nd(n),s=0;s<n;++s)e[s]&&(l[s]=p3[i[e[s]-1]++]>>15-e[s]);return l},ix=new df(288);for(var Bo=0;Bo<144;++Bo)ix[Bo]=8;for(var Bo=144;Bo<256;++Bo)ix[Bo]=9;for(var Bo=256;Bo<280;++Bo)ix[Bo]=7;for(var Bo=280;Bo<288;++Bo)ix[Bo]=8;var tC=new df(32);for(var Bo=0;Bo<32;++Bo)tC[Bo]=5;var _Xe=nw(ix,9,0),NXe=nw(tC,5,0),Rne=function(e){return(e+7)/8|0},SXe=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new df(e.subarray(t,r))},lm=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},ob=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},GE=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var s=r.length,o=r.slice();if(!s)return{t:Lne,l:0};if(s==1){var i=new df(r[0].s+1);return i[r[0].s]=1,{t:i,l:1}}r.sort(function(_,C){return _.f-C.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],d=0,u=1,f=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};u!=s-1;)l=r[r[d].f<r[f].f?d++:f++],c=r[d!=u&&r[d].f<r[f].f?d++:f++],r[u++]={s:-1,f:l.f+c.f,l,r:c};for(var h=o[0].s,n=1;n<s;++n)o[n].s>h&&(h=o[n].s);var m=new Nd(h+1),x=g3(r[u-1],m,0);if(x>t){var n=0,g=0,v=x-t,y=1<<v;for(o.sort(function(C,E){return m[E.s]-m[C.s]||C.f-E.f});n<s;++n){var b=o[n].s;if(m[b]>t)g+=y-(1<<x-m[b]),m[b]=t;else break}for(g>>=v;g>0;){var w=o[n].s;m[w]<t?g-=1<<t-m[w]++-1:++n}for(;n>=0&&g;--n){var j=o[n].s;m[j]==t&&(--m[j],++g)}x=t}return{t:new df(m),l:x}},g3=function(e,t,r){return e.s==-1?Math.max(g3(e.l,t,r+1),g3(e.r,t,r+1)):t[e.s]=r},Zz=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new Nd(++t),n=0,s=e[0],o=1,i=function(c){r[n++]=c},l=1;l<=t;++l)if(e[l]==s&&l!=t)++o;else{if(!s&&o>2){for(;o>138;o-=138)i(32754);o>2&&(i(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(i(s),--o;o>6;o-=6)i(8304);o>2&&(i(o-3<<5|8208),o=0)}for(;o--;)i(s);o=1,s=e[l]}return{c:r.subarray(0,n),n:t}},ib=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},Fne=function(e,t,r){var n=r.length,s=Rne(t+2);e[s]=n&255,e[s+1]=n>>8,e[s+2]=e[s]^255,e[s+3]=e[s+1]^255;for(var o=0;o<n;++o)e[s+o+4]=r[o];return(s+4+n)*8},e9=function(e,t,r,n,s,o,i,l,c,d,u){lm(t,u++,r),++s[256];for(var f=GE(s,15),h=f.t,m=f.l,x=GE(o,15),g=x.t,v=x.l,y=Zz(h),b=y.c,w=y.n,j=Zz(g),_=j.c,C=j.n,E=new Nd(19),S=0;S<b.length;++S)++E[b[S]&31];for(var S=0;S<_.length;++S)++E[_[S]&31];for(var A=GE(E,7),M=A.t,O=A.l,I=19;I>4&&!M[Jz[I-1]];--I);var T=d+5<<3,k=ib(s,ix)+ib(o,tC)+i,q=ib(s,h)+ib(o,g)+i+14+3*I+ib(E,M)+2*E[16]+3*E[17]+7*E[18];if(c>=0&&T<=k&&T<=q)return Fne(t,u,e.subarray(c,c+d));var B,z,F,V;if(lm(t,u,1+(q<k)),u+=2,q<k){B=nw(h,m,0),z=h,F=nw(g,v,0),V=g;var me=nw(M,O,0);lm(t,u,w-257),lm(t,u+5,C-1),lm(t,u+10,I-4),u+=14;for(var S=0;S<I;++S)lm(t,u+3*S,M[Jz[S]]);u+=3*I;for(var be=[b,_],U=0;U<2;++U)for(var L=be[U],S=0;S<L.length;++S){var H=L[S]&31;lm(t,u,me[H]),u+=M[H],H>15&&(lm(t,u,L[S]>>5&127),u+=L[S]>>12)}}else B=_Xe,z=ix,F=NXe,V=tC;for(var S=0;S<l;++S){var ie=n[S];if(ie>255){var H=ie>>18&31;ob(t,u,B[H+257]),u+=z[H+257],H>7&&(lm(t,u,ie>>23&31),u+=TR[H]);var Y=ie&31;ob(t,u,F[Y]),u+=V[Y],Y>3&&(ob(t,u,ie>>5&8191),u+=DR[Y])}else ob(t,u,B[ie]),u+=z[ie]}return ob(t,u,B[256]),u+z[256]},CXe=new OR([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Lne=new df(0),AXe=function(e,t,r,n,s,o){var i=o.z||e.length,l=new df(n+i+5*(1+Math.ceil(i/7e3))+s),c=l.subarray(n,l.length-s),d=o.l,u=(o.r||0)&7;if(t){u&&(c[0]=o.r>>3);for(var f=CXe[t-1],h=f>>13,m=f&8191,x=(1<<r)-1,g=o.p||new Nd(32768),v=o.h||new Nd(x+1),y=Math.ceil(r/3),b=2*y,w=function(re){return(e[re]^e[re+1]<<y^e[re+2]<<b)&x},j=new OR(25e3),_=new Nd(288),C=new Nd(32),E=0,S=0,A=o.i||0,M=0,O=o.w||0,I=0;A+2<i;++A){var T=w(A),k=A&32767,q=v[T];if(g[k]=q,v[T]=k,O<=A){var B=i-A;if((E>7e3||M>24576)&&(B>423||!d)){u=e9(e,c,0,j,_,C,S,M,I,A-I,u),M=E=S=0,I=A;for(var z=0;z<286;++z)_[z]=0;for(var z=0;z<30;++z)C[z]=0}var F=2,V=0,me=m,be=k-q&32767;if(B>2&&T==w(A-be))for(var U=Math.min(h,B)-1,L=Math.min(32767,A),H=Math.min(258,B);be<=L&&--me&&k!=q;){if(e[A+F]==e[A+F-be]){for(var ie=0;ie<H&&e[A+ie]==e[A+ie-be];++ie);if(ie>F){if(F=ie,V=be,ie>U)break;for(var Y=Math.min(be,ie-2),W=0,z=0;z<Y;++z){var se=A-be+z&32767,pe=g[se],G=se-pe&32767;G>W&&(W=G,q=se)}}}k=q,q=g[k],be+=k-q&32767}if(V){j[M++]=268435456|h3[F]<<18|Qz[V];var te=h3[F]&31,oe=Qz[V]&31;S+=TR[te]+DR[oe],++_[257+te],++C[oe],O=A+F,++E}else j[M++]=e[A],++_[e[A]]}}for(A=Math.max(A,O);A<i;++A)j[M++]=e[A],++_[e[A]];u=e9(e,c,d,j,_,C,S,M,I,A-I,u),d||(o.r=u&7|c[u/8|0]<<3,u-=7,o.h=v,o.p=g,o.i=A,o.w=O)}else{for(var A=o.w||0;A<i+d;A+=65535){var De=A+65535;De>=i&&(c[u/8|0]=d,De=i),u=Fne(c,u+1,e.subarray(A,De))}o.i=i}return SXe(l,0,n+Rne(u)+s)},$ne=function(){var e=1,t=0;return{p:function(r){for(var n=e,s=t,o=r.length|0,i=0;i!=o;){for(var l=Math.min(i+2655,o);i<l;++i)s+=n+=r[i];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}e=n,t=s},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},PXe=function(e,t,r,n,s){if(!s&&(s={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),i=new df(o.length+e.length);i.set(o),i.set(e,o.length),e=i,s.w=o.length}return AXe(e,t.level==null?6:t.level,t.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,s)},Bne=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},EXe=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var s=$ne();s.p(t.dictionary),Bne(e,2,s.d())}};function x3(e,t){t||(t={});var r=$ne();r.p(e);var n=PXe(e,t,t.dictionary?6:2,4);return EXe(n,t),Bne(n,n.length-4,r.d()),n}var kXe=typeof TextDecoder<"u"&&new TextDecoder,IXe=0;try{kXe.decode(Lne,{stream:!0}),IXe=1}catch{}function OXe(e){if(Array.isArray(e))return e}function TXe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,i,l=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw s}}return l}}function DXe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t9(e,t){return OXe(e)||TXe(e,t)||mje(e,t)||DXe()}function r9(e,t="utf8"){return new TextDecoder(t).decode(e)}const MXe=new TextEncoder;function RXe(e){return MXe.encode(e)}const FXe=1024*8,LXe=(()=>{const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),KE={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class MR{constructor(t=FXe,r={}){fo(this,"buffer");fo(this,"byteLength");fo(this,"byteOffset");fo(this,"length");fo(this,"offset");fo(this,"lastWrittenByte");fo(this,"littleEndian");fo(this,"_data");fo(this,"_mark");fo(this,"_marks");let n=!1;typeof t=="number"?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const s=r.offset?r.offset>>>0:0,o=t.byteLength-s;let i=s;(ArrayBuffer.isView(t)||t instanceof MR)&&(t.byteLength!==t.buffer.byteLength&&(i=t.byteOffset+s),t=t.buffer),n?this.lastWrittenByte=o:this.lastWrittenByte=0,this.buffer=t,this.length=o,this.byteLength=o,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,o),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const n=(this.offset+t)*2,s=new Uint8Array(n);s.set(new Uint8Array(this.buffer)),this.buffer=s.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,r){const n=KE[r].BYTES_PER_ELEMENT*t,s=this.byteOffset+this.offset,o=this.buffer.slice(s,s+n);if(this.littleEndian===LXe&&r!=="uint8"&&r!=="int8"){const l=new Uint8Array(this.buffer.slice(s,s+n));l.reverse();const c=new KE[r](l.buffer);return this.offset+=n,c.reverse(),c}const i=new KE[r](o);return this.offset+=n,i}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let n=0;n<t;n++)r+=this.readChar();return r}readUtf8(t=1){return r9(this.readBytes(t))}decodeText(t=1,r="utf8"){return r9(this.readBytes(t),r)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}writeUtf8(t){return this.writeBytes(RXe(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const $Xe=4,n9=0,a9=1,BXe=2;function Ny(e){let t=e.length;for(;--t>=0;)e[t]=0}const qXe=0,qne=1,zXe=2,UXe=3,VXe=258,RR=29,wj=256,E1=wj+1+RR,Qv=30,FR=19,zne=2*E1+1,Ng=15,XE=16,WXe=7,LR=256,Une=16,Vne=17,Wne=18,v3=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),B2=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),HXe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Hne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),GXe=512,vm=new Array((E1+2)*2);Ny(vm);const aw=new Array(Qv*2);Ny(aw);const k1=new Array(GXe);Ny(k1);const I1=new Array(VXe-UXe+1);Ny(I1);const $R=new Array(RR);Ny($R);const rC=new Array(Qv);Ny(rC);function YE(e,t,r,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let Gne,Kne,Xne;function JE(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const Yne=e=>e<256?k1[e]:k1[256+(e>>>7)],O1=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},qc=(e,t,r)=>{e.bi_valid>XE-r?(e.bi_buf|=t<<e.bi_valid&65535,O1(e,e.bi_buf),e.bi_buf=t>>XE-e.bi_valid,e.bi_valid+=r-XE):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Ef=(e,t,r)=>{qc(e,r[t*2],r[t*2+1])},Jne=(e,t)=>{let r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1},KXe=e=>{e.bi_valid===16?(O1(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},XXe=(e,t)=>{const r=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,i=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let d,u,f,h,m,x,g=0;for(h=0;h<=Ng;h++)e.bl_count[h]=0;for(r[e.heap[e.heap_max]*2+1]=0,d=e.heap_max+1;d<zne;d++)u=e.heap[d],h=r[r[u*2+1]*2+1]+1,h>c&&(h=c,g++),r[u*2+1]=h,!(u>n)&&(e.bl_count[h]++,m=0,u>=l&&(m=i[u-l]),x=r[u*2],e.opt_len+=x*(h+m),o&&(e.static_len+=x*(s[u*2+1]+m)));if(g!==0){do{for(h=c-1;e.bl_count[h]===0;)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(h=c;h!==0;h--)for(u=e.bl_count[h];u!==0;)f=e.heap[--d],!(f>n)&&(r[f*2+1]!==h&&(e.opt_len+=(h-r[f*2+1])*r[f*2],r[f*2+1]=h),u--)}},Qne=(e,t,r)=>{const n=new Array(Ng+1);let s=0,o,i;for(o=1;o<=Ng;o++)s=s+r[o-1]<<1,n[o]=s;for(i=0;i<=t;i++){let l=e[i*2+1];l!==0&&(e[i*2]=Jne(n[l]++,l))}},YXe=()=>{let e,t,r,n,s;const o=new Array(Ng+1);for(r=0,n=0;n<RR-1;n++)for($R[n]=r,e=0;e<1<<v3[n];e++)I1[r++]=n;for(I1[r-1]=n,s=0,n=0;n<16;n++)for(rC[n]=s,e=0;e<1<<B2[n];e++)k1[s++]=n;for(s>>=7;n<Qv;n++)for(rC[n]=s<<7,e=0;e<1<<B2[n]-7;e++)k1[256+s++]=n;for(t=0;t<=Ng;t++)o[t]=0;for(e=0;e<=143;)vm[e*2+1]=8,e++,o[8]++;for(;e<=255;)vm[e*2+1]=9,e++,o[9]++;for(;e<=279;)vm[e*2+1]=7,e++,o[7]++;for(;e<=287;)vm[e*2+1]=8,e++,o[8]++;for(Qne(vm,E1+1,o),e=0;e<Qv;e++)aw[e*2+1]=5,aw[e*2]=Jne(e,5);Gne=new YE(vm,v3,wj+1,E1,Ng),Kne=new YE(aw,B2,0,Qv,Ng),Xne=new YE(new Array(0),HXe,0,FR,WXe)},Zne=e=>{let t;for(t=0;t<E1;t++)e.dyn_ltree[t*2]=0;for(t=0;t<Qv;t++)e.dyn_dtree[t*2]=0;for(t=0;t<FR;t++)e.bl_tree[t*2]=0;e.dyn_ltree[LR*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},eae=e=>{e.bi_valid>8?O1(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},s9=(e,t,r,n)=>{const s=t*2,o=r*2;return e[s]<e[o]||e[s]===e[o]&&n[t]<=n[r]},QE=(e,t,r)=>{const n=e.heap[r];let s=r<<1;for(;s<=e.heap_len&&(s<e.heap_len&&s9(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!s9(t,n,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=n},o9=(e,t,r)=>{let n,s,o=0,i,l;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+o++]&255,n+=(e.pending_buf[e.sym_buf+o++]&255)<<8,s=e.pending_buf[e.sym_buf+o++],n===0?Ef(e,s,t):(i=I1[s],Ef(e,i+wj+1,t),l=v3[i],l!==0&&(s-=$R[i],qc(e,s,l)),n--,i=Yne(n),Ef(e,i,r),l=B2[i],l!==0&&(n-=rC[i],qc(e,n,l)));while(o<e.sym_next);Ef(e,LR,t)},y3=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.elems;let i,l,c=-1,d;for(e.heap_len=0,e.heap_max=zne,i=0;i<o;i++)r[i*2]!==0?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):r[i*2+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=c<2?++c:0,r[d*2]=1,e.depth[d]=0,e.opt_len--,s&&(e.static_len-=n[d*2+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)QE(e,r,i);d=o;do i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],QE(e,r,1),l=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=l,r[d*2]=r[i*2]+r[l*2],e.depth[d]=(e.depth[i]>=e.depth[l]?e.depth[i]:e.depth[l])+1,r[i*2+1]=r[l*2+1]=d,e.heap[1]=d++,QE(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],XXe(e,t),Qne(r,c,e.bl_count)},i9=(e,t,r)=>{let n,s=-1,o,i=t[0*2+1],l=0,c=7,d=4;for(i===0&&(c=138,d=3),t[(r+1)*2+1]=65535,n=0;n<=r;n++)o=i,i=t[(n+1)*2+1],!(++l<c&&o===i)&&(l<d?e.bl_tree[o*2]+=l:o!==0?(o!==s&&e.bl_tree[o*2]++,e.bl_tree[Une*2]++):l<=10?e.bl_tree[Vne*2]++:e.bl_tree[Wne*2]++,l=0,s=o,i===0?(c=138,d=3):o===i?(c=6,d=3):(c=7,d=4))},l9=(e,t,r)=>{let n,s=-1,o,i=t[0*2+1],l=0,c=7,d=4;for(i===0&&(c=138,d=3),n=0;n<=r;n++)if(o=i,i=t[(n+1)*2+1],!(++l<c&&o===i)){if(l<d)do Ef(e,o,e.bl_tree);while(--l!==0);else o!==0?(o!==s&&(Ef(e,o,e.bl_tree),l--),Ef(e,Une,e.bl_tree),qc(e,l-3,2)):l<=10?(Ef(e,Vne,e.bl_tree),qc(e,l-3,3)):(Ef(e,Wne,e.bl_tree),qc(e,l-11,7));l=0,s=o,i===0?(c=138,d=3):o===i?(c=6,d=3):(c=7,d=4)}},JXe=e=>{let t;for(i9(e,e.dyn_ltree,e.l_desc.max_code),i9(e,e.dyn_dtree,e.d_desc.max_code),y3(e,e.bl_desc),t=FR-1;t>=3&&e.bl_tree[Hne[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},QXe=(e,t,r,n)=>{let s;for(qc(e,t-257,5),qc(e,r-1,5),qc(e,n-4,4),s=0;s<n;s++)qc(e,e.bl_tree[Hne[s]*2+1],3);l9(e,e.dyn_ltree,t-1),l9(e,e.dyn_dtree,r-1)},ZXe=e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return n9;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return a9;for(r=32;r<wj;r++)if(e.dyn_ltree[r*2]!==0)return a9;return n9};let c9=!1;const eYe=e=>{c9||(YXe(),c9=!0),e.l_desc=new JE(e.dyn_ltree,Gne),e.d_desc=new JE(e.dyn_dtree,Kne),e.bl_desc=new JE(e.bl_tree,Xne),e.bi_buf=0,e.bi_valid=0,Zne(e)},tae=(e,t,r,n)=>{qc(e,(qXe<<1)+(n?1:0),3),eae(e),O1(e,r),O1(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},tYe=e=>{qc(e,qne<<1,3),Ef(e,LR,vm),KXe(e)},rYe=(e,t,r,n)=>{let s,o,i=0;e.level>0?(e.strm.data_type===BXe&&(e.strm.data_type=ZXe(e)),y3(e,e.l_desc),y3(e,e.d_desc),i=JXe(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=r+5,r+4<=s&&t!==-1?tae(e,t,r,n):e.strategy===$Xe||o===s?(qc(e,(qne<<1)+(n?1:0),3),o9(e,vm,aw)):(qc(e,(zXe<<1)+(n?1:0),3),QXe(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),o9(e,e.dyn_ltree,e.dyn_dtree)),Zne(e),n&&eae(e)},nYe=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(I1[r]+wj+1)*2]++,e.dyn_dtree[Yne(t)*2]++),e.sym_next===e.sym_end);var aYe=eYe,sYe=tae,oYe=rYe,iYe=nYe,lYe=tYe,cYe={_tr_init:aYe,_tr_stored_block:sYe,_tr_flush_block:oYe,_tr_tally:iYe,_tr_align:lYe};const dYe=(e,t,r,n)=>{let s=e&65535|0,o=e>>>16&65535|0,i=0;for(;r!==0;){i=r>2e3?2e3:r,r-=i;do s=s+t[n++]|0,o=o+s|0;while(--i);s%=65521,o%=65521}return s|o<<16|0};var T1=dYe;const uYe=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t},fYe=new Uint32Array(uYe()),mYe=(e,t,r,n)=>{const s=fYe,o=n+r;e^=-1;for(let i=n;i<o;i++)e=e>>>8^s[(e^t[i])&255];return e^-1};var al=mYe,V0={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},jj={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:hYe,_tr_stored_block:b3,_tr_flush_block:pYe,_tr_tally:ap,_tr_align:gYe}=cYe,{Z_NO_FLUSH:sp,Z_PARTIAL_FLUSH:xYe,Z_FULL_FLUSH:vYe,Z_FINISH:lu,Z_BLOCK:d9,Z_OK:Cl,Z_STREAM_END:u9,Z_STREAM_ERROR:Hf,Z_DATA_ERROR:yYe,Z_BUF_ERROR:ZE,Z_DEFAULT_COMPRESSION:bYe,Z_FILTERED:wYe,Z_HUFFMAN_ONLY:W_,Z_RLE:jYe,Z_FIXED:_Ye,Z_DEFAULT_STRATEGY:NYe,Z_UNKNOWN:SYe,Z_DEFLATED:wA}=jj,CYe=9,AYe=15,PYe=8,EYe=29,kYe=256,w3=kYe+1+EYe,IYe=30,OYe=19,TYe=2*w3+1,DYe=15,Ls=3,Bh=258,Gf=Bh+Ls+1,MYe=32,W0=42,BR=57,j3=69,_3=73,N3=91,S3=103,Sg=113,Cb=666,vc=1,Sy=2,lx=3,Cy=4,RYe=3,Cg=(e,t)=>(e.msg=V0[t],t),f9=e=>e*2-(e>4?9:0),Eh=e=>{let t=e.length;for(;--t>=0;)e[t]=0},FYe=e=>{let t,r,n,s=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=s?r-s:0;while(--t);t=s,n=t;do r=e.prev[--n],e.prev[n]=r>=s?r-s:0;while(--t)};let LYe=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,op=LYe;const hd=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Sd=(e,t)=>{pYe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,hd(e.strm)},no=(e,t)=>{e.pending_buf[e.pending++]=t},lb=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},C3=(e,t,r,n)=>{let s=e.avail_in;return s>n&&(s=n),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),r),e.state.wrap===1?e.adler=T1(e.adler,t,s,r):e.state.wrap===2&&(e.adler=al(e.adler,t,s,r)),e.next_in+=s,e.total_in+=s,s)},rae=(e,t)=>{let r=e.max_chain_length,n=e.strstart,s,o,i=e.prev_length,l=e.nice_match;const c=e.strstart>e.w_size-Gf?e.strstart-(e.w_size-Gf):0,d=e.window,u=e.w_mask,f=e.prev,h=e.strstart+Bh;let m=d[n+i-1],x=d[n+i];e.prev_length>=e.good_match&&(r>>=2),l>e.lookahead&&(l=e.lookahead);do if(s=t,!(d[s+i]!==x||d[s+i-1]!==m||d[s]!==d[n]||d[++s]!==d[n+1])){n+=2,s++;do;while(d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&n<h);if(o=Bh-(h-n),n=h-Bh,o>i){if(e.match_start=t,i=o,o>=l)break;m=d[n+i-1],x=d[n+i]}}while((t=f[t&u])>c&&--r!==0);return i<=e.lookahead?i:e.lookahead},H0=e=>{const t=e.w_size;let r,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Gf)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),FYe(e),n+=t),e.strm.avail_in===0)break;if(r=C3(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=Ls)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=op(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=op(e,e.ins_h,e.window[s+Ls-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<Ls)););}while(e.lookahead<Gf&&e.strm.avail_in!==0)},nae=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,s,o,i=0,l=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>o&&(n=o),n<r&&(n===0&&t!==lu||t===sp||n!==s+e.strm.avail_in)))break;i=t===lu&&n===s+e.strm.avail_in?1:0,b3(e,0,0,i),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,hd(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(C3(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(i===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?Cy:t!==sp&&t!==lu&&e.strm.avail_in===0&&e.strstart===e.block_start?Sy:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(C3(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,r=o>e.w_size?e.w_size:o,s=e.strstart-e.block_start,(s>=r||(s||t===lu)&&t!==sp&&e.strm.avail_in===0&&s<=o)&&(n=s>o?o:s,i=t===lu&&e.strm.avail_in===0&&n===s?1:0,b3(e,e.block_start,n,i),e.block_start+=n,hd(e.strm)),i?lx:vc)},ek=(e,t)=>{let r,n;for(;;){if(e.lookahead<Gf){if(H0(e),e.lookahead<Gf&&t===sp)return vc;if(e.lookahead===0)break}if(r=0,e.lookahead>=Ls&&(e.ins_h=op(e,e.ins_h,e.window[e.strstart+Ls-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Gf&&(e.match_length=rae(e,r)),e.match_length>=Ls)if(n=ap(e,e.strstart-e.match_start,e.match_length-Ls),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=Ls){e.match_length--;do e.strstart++,e.ins_h=op(e,e.ins_h,e.window[e.strstart+Ls-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=op(e,e.ins_h,e.window[e.strstart+1]);else n=ap(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Sd(e,!1),e.strm.avail_out===0))return vc}return e.insert=e.strstart<Ls-1?e.strstart:Ls-1,t===lu?(Sd(e,!0),e.strm.avail_out===0?lx:Cy):e.sym_next&&(Sd(e,!1),e.strm.avail_out===0)?vc:Sy},Xx=(e,t)=>{let r,n,s;for(;;){if(e.lookahead<Gf){if(H0(e),e.lookahead<Gf&&t===sp)return vc;if(e.lookahead===0)break}if(r=0,e.lookahead>=Ls&&(e.ins_h=op(e,e.ins_h,e.window[e.strstart+Ls-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=Ls-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Gf&&(e.match_length=rae(e,r),e.match_length<=5&&(e.strategy===wYe||e.match_length===Ls&&e.strstart-e.match_start>4096)&&(e.match_length=Ls-1)),e.prev_length>=Ls&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-Ls,n=ap(e,e.strstart-1-e.prev_match,e.prev_length-Ls),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=op(e,e.ins_h,e.window[e.strstart+Ls-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=Ls-1,e.strstart++,n&&(Sd(e,!1),e.strm.avail_out===0))return vc}else if(e.match_available){if(n=ap(e,0,e.window[e.strstart-1]),n&&Sd(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return vc}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=ap(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<Ls-1?e.strstart:Ls-1,t===lu?(Sd(e,!0),e.strm.avail_out===0?lx:Cy):e.sym_next&&(Sd(e,!1),e.strm.avail_out===0)?vc:Sy},$Ye=(e,t)=>{let r,n,s,o;const i=e.window;for(;;){if(e.lookahead<=Bh){if(H0(e),e.lookahead<=Bh&&t===sp)return vc;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=Ls&&e.strstart>0&&(s=e.strstart-1,n=i[s],n===i[++s]&&n===i[++s]&&n===i[++s])){o=e.strstart+Bh;do;while(n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&s<o);e.match_length=Bh-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=Ls?(r=ap(e,1,e.match_length-Ls),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=ap(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Sd(e,!1),e.strm.avail_out===0))return vc}return e.insert=0,t===lu?(Sd(e,!0),e.strm.avail_out===0?lx:Cy):e.sym_next&&(Sd(e,!1),e.strm.avail_out===0)?vc:Sy},BYe=(e,t)=>{let r;for(;;){if(e.lookahead===0&&(H0(e),e.lookahead===0)){if(t===sp)return vc;break}if(e.match_length=0,r=ap(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Sd(e,!1),e.strm.avail_out===0))return vc}return e.insert=0,t===lu?(Sd(e,!0),e.strm.avail_out===0?lx:Cy):e.sym_next&&(Sd(e,!1),e.strm.avail_out===0)?vc:Sy};function wf(e,t,r,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=s}const Ab=[new wf(0,0,0,0,nae),new wf(4,4,8,4,ek),new wf(4,5,16,8,ek),new wf(4,6,32,32,ek),new wf(4,4,16,16,Xx),new wf(8,16,32,32,Xx),new wf(8,16,128,128,Xx),new wf(8,32,128,256,Xx),new wf(32,128,258,1024,Xx),new wf(32,258,258,4096,Xx)],qYe=e=>{e.window_size=2*e.w_size,Eh(e.head),e.max_lazy_match=Ab[e.level].max_lazy,e.good_match=Ab[e.level].good_length,e.nice_match=Ab[e.level].nice_length,e.max_chain_length=Ab[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=Ls-1,e.match_available=0,e.ins_h=0};function zYe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=wA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(TYe*2),this.dyn_dtree=new Uint16Array((2*IYe+1)*2),this.bl_tree=new Uint16Array((2*OYe+1)*2),Eh(this.dyn_ltree),Eh(this.dyn_dtree),Eh(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(DYe+1),this.heap=new Uint16Array(2*w3+1),Eh(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*w3+1),Eh(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const _j=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==W0&&t.status!==BR&&t.status!==j3&&t.status!==_3&&t.status!==N3&&t.status!==S3&&t.status!==Sg&&t.status!==Cb?1:0},aae=e=>{if(_j(e))return Cg(e,Hf);e.total_in=e.total_out=0,e.data_type=SYe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?BR:t.wrap?W0:Sg,e.adler=t.wrap===2?0:1,t.last_flush=-2,hYe(t),Cl},sae=e=>{const t=aae(e);return t===Cl&&qYe(e.state),t},UYe=(e,t)=>_j(e)||e.state.wrap!==2?Hf:(e.state.gzhead=t,Cl),oae=(e,t,r,n,s,o)=>{if(!e)return Hf;let i=1;if(t===bYe&&(t=6),n<0?(i=0,n=-n):n>15&&(i=2,n-=16),s<1||s>CYe||r!==wA||n<8||n>15||t<0||t>9||o<0||o>_Ye||n===8&&i!==1)return Cg(e,Hf);n===8&&(n=9);const l=new zYe;return e.state=l,l.strm=e,l.status=W0,l.wrap=i,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+Ls-1)/Ls),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=t,l.strategy=o,l.method=r,sae(e)},VYe=(e,t)=>oae(e,t,wA,AYe,PYe,NYe),WYe=(e,t)=>{if(_j(e)||t>d9||t<0)return e?Cg(e,Hf):Hf;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===Cb&&t!==lu)return Cg(e,e.avail_out===0?ZE:Hf);const n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(hd(e),e.avail_out===0)return r.last_flush=-1,Cl}else if(e.avail_in===0&&f9(t)<=f9(n)&&t!==lu)return Cg(e,ZE);if(r.status===Cb&&e.avail_in!==0)return Cg(e,ZE);if(r.status===W0&&r.wrap===0&&(r.status=Sg),r.status===W0){let s=wA+(r.w_bits-8<<4)<<8,o=-1;if(r.strategy>=W_||r.level<2?o=0:r.level<6?o=1:r.level===6?o=2:o=3,s|=o<<6,r.strstart!==0&&(s|=MYe),s+=31-s%31,lb(r,s),r.strstart!==0&&(lb(r,e.adler>>>16),lb(r,e.adler&65535)),e.adler=1,r.status=Sg,hd(e),r.pending!==0)return r.last_flush=-1,Cl}if(r.status===BR){if(e.adler=0,no(r,31),no(r,139),no(r,8),r.gzhead)no(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),no(r,r.gzhead.time&255),no(r,r.gzhead.time>>8&255),no(r,r.gzhead.time>>16&255),no(r,r.gzhead.time>>24&255),no(r,r.level===9?2:r.strategy>=W_||r.level<2?4:0),no(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(no(r,r.gzhead.extra.length&255),no(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=al(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=j3;else if(no(r,0),no(r,0),no(r,0),no(r,0),no(r,0),no(r,r.level===9?2:r.strategy>=W_||r.level<2?4:0),no(r,RYe),r.status=Sg,hd(e),r.pending!==0)return r.last_flush=-1,Cl}if(r.status===j3){if(r.gzhead.extra){let s=r.pending,o=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let l=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+l),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>s&&(e.adler=al(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex+=l,hd(e),r.pending!==0)return r.last_flush=-1,Cl;s=0,o-=l}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>s&&(e.adler=al(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=_3}if(r.status===_3){if(r.gzhead.name){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=al(e.adler,r.pending_buf,r.pending-s,s)),hd(e),r.pending!==0)return r.last_flush=-1,Cl;s=0}r.gzindex<r.gzhead.name.length?o=r.gzhead.name.charCodeAt(r.gzindex++)&255:o=0,no(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=al(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex=0}r.status=N3}if(r.status===N3){if(r.gzhead.comment){let s=r.pending,o;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>s&&(e.adler=al(e.adler,r.pending_buf,r.pending-s,s)),hd(e),r.pending!==0)return r.last_flush=-1,Cl;s=0}r.gzindex<r.gzhead.comment.length?o=r.gzhead.comment.charCodeAt(r.gzindex++)&255:o=0,no(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=al(e.adler,r.pending_buf,r.pending-s,s))}r.status=S3}if(r.status===S3){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(hd(e),r.pending!==0))return r.last_flush=-1,Cl;no(r,e.adler&255),no(r,e.adler>>8&255),e.adler=0}if(r.status=Sg,hd(e),r.pending!==0)return r.last_flush=-1,Cl}if(e.avail_in!==0||r.lookahead!==0||t!==sp&&r.status!==Cb){let s=r.level===0?nae(r,t):r.strategy===W_?BYe(r,t):r.strategy===jYe?$Ye(r,t):Ab[r.level].func(r,t);if((s===lx||s===Cy)&&(r.status=Cb),s===vc||s===lx)return e.avail_out===0&&(r.last_flush=-1),Cl;if(s===Sy&&(t===xYe?gYe(r):t!==d9&&(b3(r,0,0,!1),t===vYe&&(Eh(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),hd(e),e.avail_out===0))return r.last_flush=-1,Cl}return t!==lu?Cl:r.wrap<=0?u9:(r.wrap===2?(no(r,e.adler&255),no(r,e.adler>>8&255),no(r,e.adler>>16&255),no(r,e.adler>>24&255),no(r,e.total_in&255),no(r,e.total_in>>8&255),no(r,e.total_in>>16&255),no(r,e.total_in>>24&255)):(lb(r,e.adler>>>16),lb(r,e.adler&65535)),hd(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Cl:u9)},HYe=e=>{if(_j(e))return Hf;const t=e.state.status;return e.state=null,t===Sg?Cg(e,yYe):Cl},GYe=(e,t)=>{let r=t.length;if(_j(e))return Hf;const n=e.state,s=n.wrap;if(s===2||s===1&&n.status!==W0||n.lookahead)return Hf;if(s===1&&(e.adler=T1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){s===0&&(Eh(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(t.subarray(r-n.w_size,r),0),t=c,r=n.w_size}const o=e.avail_in,i=e.next_in,l=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,H0(n);n.lookahead>=Ls;){let c=n.strstart,d=n.lookahead-(Ls-1);do n.ins_h=op(n,n.ins_h,n.window[c+Ls-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--d);n.strstart=c,n.lookahead=Ls-1,H0(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Ls-1,n.match_available=0,e.next_in=i,e.input=l,e.avail_in=o,n.wrap=s,Cl};var KYe=VYe,XYe=oae,YYe=sae,JYe=aae,QYe=UYe,ZYe=WYe,eJe=HYe,tJe=GYe,rJe="pako deflate (from Nodeca project)",sw={deflateInit:KYe,deflateInit2:XYe,deflateReset:YYe,deflateResetKeep:JYe,deflateSetHeader:QYe,deflate:ZYe,deflateEnd:eJe,deflateSetDictionary:tJe,deflateInfo:rJe};const nJe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var aJe=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const n in r)nJe(r,n)&&(e[n]=r[n])}}return e},sJe=e=>{let t=0;for(let n=0,s=e.length;n<s;n++)t+=e[n].length;const r=new Uint8Array(t);for(let n=0,s=0,o=e.length;n<o;n++){let i=e[n];r.set(i,s),s+=i.length}return r},jA={assign:aJe,flattenChunks:sJe};let iae=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{iae=!1}const D1=new Uint8Array(256);for(let e=0;e<256;e++)D1[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;D1[254]=D1[254]=1;var oJe=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,s,o,i=e.length,l=0;for(s=0;s<i;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<i&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(l),o=0,s=0;o<l;s++)r=e.charCodeAt(s),(r&64512)===55296&&s+1<i&&(n=e.charCodeAt(s+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),s++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|r&63):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|r&63):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|r&63);return t};const iJe=(e,t)=>{if(t<65534&&e.subarray&&iae)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var lJe=(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,s;const o=new Array(r*2);for(s=0,n=0;n<r;){let i=e[n++];if(i<128){o[s++]=i;continue}let l=D1[i];if(l>4){o[s++]=65533,n+=l-1;continue}for(i&=l===2?31:l===3?15:7;l>1&&n<r;)i=i<<6|e[n++]&63,l--;if(l>1){o[s++]=65533;continue}i<65536?o[s++]=i:(i-=65536,o[s++]=55296|i>>10&1023,o[s++]=56320|i&1023)}return iJe(o,s)},cJe=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+D1[e[r]]>t?r:t},M1={string2buf:oJe,buf2string:lJe,utf8border:cJe};function dJe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var lae=dJe;const cae=Object.prototype.toString,{Z_NO_FLUSH:uJe,Z_SYNC_FLUSH:fJe,Z_FULL_FLUSH:mJe,Z_FINISH:hJe,Z_OK:nC,Z_STREAM_END:pJe,Z_DEFAULT_COMPRESSION:gJe,Z_DEFAULT_STRATEGY:xJe,Z_DEFLATED:vJe}=jj;function qR(e){this.options=jA.assign({level:gJe,method:vJe,chunkSize:16384,windowBits:15,memLevel:8,strategy:xJe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lae,this.strm.avail_out=0;let r=sw.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==nC)throw new Error(V0[r]);if(t.header&&sw.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=M1.string2buf(t.dictionary):cae.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,r=sw.deflateSetDictionary(this.strm,n),r!==nC)throw new Error(V0[r]);this._dict_set=!0}}qR.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let s,o;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?hJe:uJe,typeof e=="string"?r.input=M1.string2buf(e):cae.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===fJe||o===mJe)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(s=sw.deflate(r,o),s===pJe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),s=sw.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===nC;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};qR.prototype.onData=function(e){this.chunks.push(e)};qR.prototype.onEnd=function(e){e===nC&&(this.result=jA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const H_=16209,yJe=16191;var bJe=function(t,r){let n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w,j,_,C,E,S,A,M;const O=t.state;n=t.next_in,A=t.input,s=n+(t.avail_in-5),o=t.next_out,M=t.output,i=o-(r-t.avail_out),l=o+(t.avail_out-257),c=O.dmax,d=O.wsize,u=O.whave,f=O.wnext,h=O.window,m=O.hold,x=O.bits,g=O.lencode,v=O.distcode,y=(1<<O.lenbits)-1,b=(1<<O.distbits)-1;e:do{x<15&&(m+=A[n++]<<x,x+=8,m+=A[n++]<<x,x+=8),w=g[m&y];t:for(;;){if(j=w>>>24,m>>>=j,x-=j,j=w>>>16&255,j===0)M[o++]=w&65535;else if(j&16){_=w&65535,j&=15,j&&(x<j&&(m+=A[n++]<<x,x+=8),_+=m&(1<<j)-1,m>>>=j,x-=j),x<15&&(m+=A[n++]<<x,x+=8,m+=A[n++]<<x,x+=8),w=v[m&b];r:for(;;){if(j=w>>>24,m>>>=j,x-=j,j=w>>>16&255,j&16){if(C=w&65535,j&=15,x<j&&(m+=A[n++]<<x,x+=8,x<j&&(m+=A[n++]<<x,x+=8)),C+=m&(1<<j)-1,C>c){t.msg="invalid distance too far back",O.mode=H_;break e}if(m>>>=j,x-=j,j=o-i,C>j){if(j=C-j,j>u&&O.sane){t.msg="invalid distance too far back",O.mode=H_;break e}if(E=0,S=h,f===0){if(E+=d-j,j<_){_-=j;do M[o++]=h[E++];while(--j);E=o-C,S=M}}else if(f<j){if(E+=d+f-j,j-=f,j<_){_-=j;do M[o++]=h[E++];while(--j);if(E=0,f<_){j=f,_-=j;do M[o++]=h[E++];while(--j);E=o-C,S=M}}}else if(E+=f-j,j<_){_-=j;do M[o++]=h[E++];while(--j);E=o-C,S=M}for(;_>2;)M[o++]=S[E++],M[o++]=S[E++],M[o++]=S[E++],_-=3;_&&(M[o++]=S[E++],_>1&&(M[o++]=S[E++]))}else{E=o-C;do M[o++]=M[E++],M[o++]=M[E++],M[o++]=M[E++],_-=3;while(_>2);_&&(M[o++]=M[E++],_>1&&(M[o++]=M[E++]))}}else if(j&64){t.msg="invalid distance code",O.mode=H_;break e}else{w=v[(w&65535)+(m&(1<<j)-1)];continue r}break}}else if(j&64)if(j&32){O.mode=yJe;break e}else{t.msg="invalid literal/length code",O.mode=H_;break e}else{w=g[(w&65535)+(m&(1<<j)-1)];continue t}break}}while(n<s&&o<l);_=x>>3,n-=_,x-=_<<3,m&=(1<<x)-1,t.next_in=n,t.next_out=o,t.avail_in=n<s?5+(s-n):5-(n-s),t.avail_out=o<l?257+(l-o):257-(o-l),O.hold=m,O.bits=x};const Yx=15,m9=852,h9=592,p9=0,tk=1,g9=2,wJe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),jJe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_Je=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),NJe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),SJe=(e,t,r,n,s,o,i,l)=>{const c=l.bits;let d=0,u=0,f=0,h=0,m=0,x=0,g=0,v=0,y=0,b=0,w,j,_,C,E,S=null,A;const M=new Uint16Array(Yx+1),O=new Uint16Array(Yx+1);let I=null,T,k,q;for(d=0;d<=Yx;d++)M[d]=0;for(u=0;u<n;u++)M[t[r+u]]++;for(m=c,h=Yx;h>=1&&M[h]===0;h--);if(m>h&&(m=h),h===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,l.bits=1,0;for(f=1;f<h&&M[f]===0;f++);for(m<f&&(m=f),v=1,d=1;d<=Yx;d++)if(v<<=1,v-=M[d],v<0)return-1;if(v>0&&(e===p9||h!==1))return-1;for(O[1]=0,d=1;d<Yx;d++)O[d+1]=O[d]+M[d];for(u=0;u<n;u++)t[r+u]!==0&&(i[O[t[r+u]]++]=u);if(e===p9?(S=I=i,A=20):e===tk?(S=wJe,I=jJe,A=257):(S=_Je,I=NJe,A=0),b=0,u=0,d=f,E=o,x=m,g=0,_=-1,y=1<<m,C=y-1,e===tk&&y>m9||e===g9&&y>h9)return 1;for(;;){T=d-g,i[u]+1<A?(k=0,q=i[u]):i[u]>=A?(k=I[i[u]-A],q=S[i[u]-A]):(k=32+64,q=0),w=1<<d-g,j=1<<x,f=j;do j-=w,s[E+(b>>g)+j]=T<<24|k<<16|q|0;while(j!==0);for(w=1<<d-1;b&w;)w>>=1;if(w!==0?(b&=w-1,b+=w):b=0,u++,--M[d]===0){if(d===h)break;d=t[r+i[u]]}if(d>m&&(b&C)!==_){for(g===0&&(g=m),E+=f,x=d-g,v=1<<x;x+g<h&&(v-=M[x+g],!(v<=0));)x++,v<<=1;if(y+=1<<x,e===tk&&y>m9||e===g9&&y>h9)return 1;_=b&C,s[_]=m<<24|x<<16|E-o|0}}return b!==0&&(s[E+b]=d-g<<24|64<<16|0),l.bits=m,0};var ow=SJe;const CJe=0,dae=1,uae=2,{Z_FINISH:x9,Z_BLOCK:AJe,Z_TREES:G_,Z_OK:cx,Z_STREAM_END:PJe,Z_NEED_DICT:EJe,Z_STREAM_ERROR:_u,Z_DATA_ERROR:fae,Z_MEM_ERROR:mae,Z_BUF_ERROR:kJe,Z_DEFLATED:v9}=jj,_A=16180,y9=16181,b9=16182,w9=16183,j9=16184,_9=16185,N9=16186,S9=16187,C9=16188,A9=16189,aC=16190,cm=16191,rk=16192,P9=16193,nk=16194,E9=16195,k9=16196,I9=16197,O9=16198,K_=16199,X_=16200,T9=16201,D9=16202,M9=16203,R9=16204,F9=16205,ak=16206,L9=16207,$9=16208,Vo=16209,hae=16210,pae=16211,IJe=852,OJe=592,TJe=15,DJe=TJe,B9=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function MJe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Cx=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<_A||t.mode>pae?1:0},gae=e=>{if(Cx(e))return _u;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=_A,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(IJe),t.distcode=t.distdyn=new Int32Array(OJe),t.sane=1,t.back=-1,cx},xae=e=>{if(Cx(e))return _u;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,gae(e)},vae=(e,t)=>{let r;if(Cx(e))return _u;const n=e.state;return t<0?(r=0,t=-t):(r=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?_u:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,xae(e))},yae=(e,t)=>{if(!e)return _u;const r=new MJe;e.state=r,r.strm=e,r.window=null,r.mode=_A;const n=vae(e,t);return n!==cx&&(e.state=null),n},RJe=e=>yae(e,DJe);let q9=!0,sk,ok;const FJe=e=>{if(q9){sk=new Int32Array(512),ok=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ow(dae,e.lens,0,288,sk,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ow(uae,e.lens,0,32,ok,0,e.work,{bits:5}),q9=!1}e.lencode=sk,e.lenbits=9,e.distcode=ok,e.distbits=5},bae=(e,t,r,n)=>{let s;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>n&&(s=n),o.window.set(t.subarray(r-n,r-n+s),o.wnext),n-=s,n?(o.window.set(t.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0},LJe=(e,t)=>{let r,n,s,o,i,l,c,d,u,f,h,m,x,g,v=0,y,b,w,j,_,C,E,S;const A=new Uint8Array(4);let M,O;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Cx(e)||!e.output||!e.input&&e.avail_in!==0)return _u;r=e.state,r.mode===cm&&(r.mode=rk),i=e.next_out,s=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,u=r.bits,f=l,h=c,S=cx;e:for(;;)switch(r.mode){case _A:if(r.wrap===0){r.mode=rk;break}for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&2&&d===35615){r.wbits===0&&(r.wbits=15),r.check=0,A[0]=d&255,A[1]=d>>>8&255,r.check=al(r.check,A,2,0),d=0,u=0,r.mode=y9;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((d&255)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=Vo;break}if((d&15)!==v9){e.msg="unknown compression method",r.mode=Vo;break}if(d>>>=4,u-=4,E=(d&15)+8,r.wbits===0&&(r.wbits=E),E>15||E>r.wbits){e.msg="invalid window size",r.mode=Vo;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=d&512?A9:cm,d=0,u=0;break;case y9:for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.flags=d,(r.flags&255)!==v9){e.msg="unknown compression method",r.mode=Vo;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=Vo;break}r.head&&(r.head.text=d>>8&1),r.flags&512&&r.wrap&4&&(A[0]=d&255,A[1]=d>>>8&255,r.check=al(r.check,A,2,0)),d=0,u=0,r.mode=b9;case b9:for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.head&&(r.head.time=d),r.flags&512&&r.wrap&4&&(A[0]=d&255,A[1]=d>>>8&255,A[2]=d>>>16&255,A[3]=d>>>24&255,r.check=al(r.check,A,4,0)),d=0,u=0,r.mode=w9;case w9:for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.head&&(r.head.xflags=d&255,r.head.os=d>>8),r.flags&512&&r.wrap&4&&(A[0]=d&255,A[1]=d>>>8&255,r.check=al(r.check,A,2,0)),d=0,u=0,r.mode=j9;case j9:if(r.flags&1024){for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.length=d,r.head&&(r.head.extra_len=d),r.flags&512&&r.wrap&4&&(A[0]=d&255,A[1]=d>>>8&255,r.check=al(r.check,A,2,0)),d=0,u=0}else r.head&&(r.head.extra=null);r.mode=_9;case _9:if(r.flags&1024&&(m=r.length,m>l&&(m=l),m&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+m),E)),r.flags&512&&r.wrap&4&&(r.check=al(r.check,n,m,o)),l-=m,o+=m,r.length-=m),r.length))break e;r.length=0,r.mode=N9;case N9:if(r.flags&2048){if(l===0)break e;m=0;do E=n[o+m++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E));while(E&&m<l);if(r.flags&512&&r.wrap&4&&(r.check=al(r.check,n,m,o)),l-=m,o+=m,E)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=S9;case S9:if(r.flags&4096){if(l===0)break e;m=0;do E=n[o+m++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E));while(E&&m<l);if(r.flags&512&&r.wrap&4&&(r.check=al(r.check,n,m,o)),l-=m,o+=m,E)break e}else r.head&&(r.head.comment=null);r.mode=C9;case C9:if(r.flags&512){for(;u<16;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&4&&d!==(r.check&65535)){e.msg="header crc mismatch",r.mode=Vo;break}d=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=cm;break;case A9:for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}e.adler=r.check=B9(d),d=0,u=0,r.mode=aC;case aC:if(r.havedict===0)return e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,EJe;e.adler=r.check=1,r.mode=cm;case cm:if(t===AJe||t===G_)break e;case rk:if(r.last){d>>>=u&7,u-=u&7,r.mode=ak;break}for(;u<3;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}switch(r.last=d&1,d>>>=1,u-=1,d&3){case 0:r.mode=P9;break;case 1:if(FJe(r),r.mode=K_,t===G_){d>>>=2,u-=2;break e}break;case 2:r.mode=k9;break;case 3:e.msg="invalid block type",r.mode=Vo}d>>>=2,u-=2;break;case P9:for(d>>>=u&7,u-=u&7;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if((d&65535)!==(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Vo;break}if(r.length=d&65535,d=0,u=0,r.mode=nk,t===G_)break e;case nk:r.mode=E9;case E9:if(m=r.length,m){if(m>l&&(m=l),m>c&&(m=c),m===0)break e;s.set(n.subarray(o,o+m),i),l-=m,o+=m,c-=m,i+=m,r.length-=m;break}r.mode=cm;break;case k9:for(;u<14;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.nlen=(d&31)+257,d>>>=5,u-=5,r.ndist=(d&31)+1,d>>>=5,u-=5,r.ncode=(d&15)+4,d>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Vo;break}r.have=0,r.mode=I9;case I9:for(;r.have<r.ncode;){for(;u<3;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.lens[I[r.have++]]=d&7,d>>>=3,u-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,M={bits:r.lenbits},S=ow(CJe,r.lens,0,19,r.lencode,0,r.work,M),r.lenbits=M.bits,S){e.msg="invalid code lengths set",r.mode=Vo;break}r.have=0,r.mode=O9;case O9:for(;r.have<r.nlen+r.ndist;){for(;v=r.lencode[d&(1<<r.lenbits)-1],y=v>>>24,b=v>>>16&255,w=v&65535,!(y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(w<16)d>>>=y,u-=y,r.lens[r.have++]=w;else{if(w===16){for(O=y+2;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(d>>>=y,u-=y,r.have===0){e.msg="invalid bit length repeat",r.mode=Vo;break}E=r.lens[r.have-1],m=3+(d&3),d>>>=2,u-=2}else if(w===17){for(O=y+3;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=y,u-=y,E=0,m=3+(d&7),d>>>=3,u-=3}else{for(O=y+7;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=y,u-=y,E=0,m=11+(d&127),d>>>=7,u-=7}if(r.have+m>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Vo;break}for(;m--;)r.lens[r.have++]=E}}if(r.mode===Vo)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Vo;break}if(r.lenbits=9,M={bits:r.lenbits},S=ow(dae,r.lens,0,r.nlen,r.lencode,0,r.work,M),r.lenbits=M.bits,S){e.msg="invalid literal/lengths set",r.mode=Vo;break}if(r.distbits=6,r.distcode=r.distdyn,M={bits:r.distbits},S=ow(uae,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,M),r.distbits=M.bits,S){e.msg="invalid distances set",r.mode=Vo;break}if(r.mode=K_,t===G_)break e;case K_:r.mode=X_;case X_:if(l>=6&&c>=258){e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,bJe(e,h),i=e.next_out,s=e.output,c=e.avail_out,o=e.next_in,n=e.input,l=e.avail_in,d=r.hold,u=r.bits,r.mode===cm&&(r.back=-1);break}for(r.back=0;v=r.lencode[d&(1<<r.lenbits)-1],y=v>>>24,b=v>>>16&255,w=v&65535,!(y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(b&&!(b&240)){for(j=y,_=b,C=w;v=r.lencode[C+((d&(1<<j+_)-1)>>j)],y=v>>>24,b=v>>>16&255,w=v&65535,!(j+y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=j,u-=j,r.back+=j}if(d>>>=y,u-=y,r.back+=y,r.length=w,b===0){r.mode=F9;break}if(b&32){r.back=-1,r.mode=cm;break}if(b&64){e.msg="invalid literal/length code",r.mode=Vo;break}r.extra=b&15,r.mode=T9;case T9:if(r.extra){for(O=r.extra;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=D9;case D9:for(;v=r.distcode[d&(1<<r.distbits)-1],y=v>>>24,b=v>>>16&255,w=v&65535,!(y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(!(b&240)){for(j=y,_=b,C=w;v=r.distcode[C+((d&(1<<j+_)-1)>>j)],y=v>>>24,b=v>>>16&255,w=v&65535,!(j+y<=u);){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}d>>>=j,u-=j,r.back+=j}if(d>>>=y,u-=y,r.back+=y,b&64){e.msg="invalid distance code",r.mode=Vo;break}r.offset=w,r.extra=b&15,r.mode=M9;case M9:if(r.extra){for(O=r.extra;u<O;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Vo;break}r.mode=R9;case R9:if(c===0)break e;if(m=h-c,r.offset>m){if(m=r.offset-m,m>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Vo;break}m>r.wnext?(m-=r.wnext,x=r.wsize-m):x=r.wnext-m,m>r.length&&(m=r.length),g=r.window}else g=s,x=i-r.offset,m=r.length;m>c&&(m=c),c-=m,r.length-=m;do s[i++]=g[x++];while(--m);r.length===0&&(r.mode=X_);break;case F9:if(c===0)break e;s[i++]=r.length,c--,r.mode=X_;break;case ak:if(r.wrap){for(;u<32;){if(l===0)break e;l--,d|=n[o++]<<u,u+=8}if(h-=c,e.total_out+=h,r.total+=h,r.wrap&4&&h&&(e.adler=r.check=r.flags?al(r.check,s,h,i-h):T1(r.check,s,h,i-h)),h=c,r.wrap&4&&(r.flags?d:B9(d))!==r.check){e.msg="incorrect data check",r.mode=Vo;break}d=0,u=0}r.mode=L9;case L9:if(r.wrap&&r.flags){for(;u<32;){if(l===0)break e;l--,d+=n[o++]<<u,u+=8}if(r.wrap&4&&d!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=Vo;break}d=0,u=0}r.mode=$9;case $9:S=PJe;break e;case Vo:S=fae;break e;case hae:return mae;case pae:default:return _u}return e.next_out=i,e.avail_out=c,e.next_in=o,e.avail_in=l,r.hold=d,r.bits=u,(r.wsize||h!==e.avail_out&&r.mode<Vo&&(r.mode<ak||t!==x9))&&bae(e,e.output,e.next_out,h-e.avail_out),f-=e.avail_in,h-=e.avail_out,e.total_in+=f,e.total_out+=h,r.total+=h,r.wrap&4&&h&&(e.adler=r.check=r.flags?al(r.check,s,h,e.next_out-h):T1(r.check,s,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===cm?128:0)+(r.mode===K_||r.mode===nk?256:0),(f===0&&h===0||t===x9)&&S===cx&&(S=kJe),S},$Je=e=>{if(Cx(e))return _u;let t=e.state;return t.window&&(t.window=null),e.state=null,cx},BJe=(e,t)=>{if(Cx(e))return _u;const r=e.state;return r.wrap&2?(r.head=t,t.done=!1,cx):_u},qJe=(e,t)=>{const r=t.length;let n,s,o;return Cx(e)||(n=e.state,n.wrap!==0&&n.mode!==aC)?_u:n.mode===aC&&(s=1,s=T1(s,t,r,0),s!==n.check)?fae:(o=bae(e,t,r,r),o?(n.mode=hae,mae):(n.havedict=1,cx))};var zJe=xae,UJe=vae,VJe=gae,WJe=RJe,HJe=yae,GJe=LJe,KJe=$Je,XJe=BJe,YJe=qJe,JJe="pako inflate (from Nodeca project)",ym={inflateReset:zJe,inflateReset2:UJe,inflateResetKeep:VJe,inflateInit:WJe,inflateInit2:HJe,inflate:GJe,inflateEnd:KJe,inflateGetHeader:XJe,inflateSetDictionary:YJe,inflateInfo:JJe};function QJe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ZJe=QJe;const wae=Object.prototype.toString,{Z_NO_FLUSH:eQe,Z_FINISH:tQe,Z_OK:R1,Z_STREAM_END:ik,Z_NEED_DICT:lk,Z_STREAM_ERROR:rQe,Z_DATA_ERROR:z9,Z_MEM_ERROR:nQe}=jj;function Nj(e){this.options=jA.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lae,this.strm.avail_out=0;let r=ym.inflateInit2(this.strm,t.windowBits);if(r!==R1)throw new Error(V0[r]);if(this.header=new ZJe,ym.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=M1.string2buf(t.dictionary):wae.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=ym.inflateSetDictionary(this.strm,t.dictionary),r!==R1)))throw new Error(V0[r])}Nj.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let o,i,l;if(this.ended)return!1;for(t===~~t?i=t:i=t===!0?tQe:eQe,wae.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=ym.inflate(r,i),o===lk&&s&&(o=ym.inflateSetDictionary(r,s),o===R1?o=ym.inflate(r,i):o===z9&&(o=lk));r.avail_in>0&&o===ik&&r.state.wrap>0&&e[r.next_in]!==0;)ym.inflateReset(r),o=ym.inflate(r,i);switch(o){case rQe:case z9:case lk:case nQe:return this.onEnd(o),this.ended=!0,!1}if(l=r.avail_out,r.next_out&&(r.avail_out===0||o===ik))if(this.options.to==="string"){let c=M1.utf8border(r.output,r.next_out),d=r.next_out-c,u=M1.buf2string(r.output,c);r.next_out=d,r.avail_out=n-d,d&&r.output.set(r.output.subarray(c,c+d),0),this.onData(u)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===R1&&l===0)){if(o===ik)return o=ym.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Nj.prototype.onData=function(e){this.chunks.push(e)};Nj.prototype.onEnd=function(e){e===R1&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=jA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function zR(e,t){const r=new Nj(t);if(r.push(e),r.err)throw r.msg||V0[r.err];return r.result}function aQe(e,t){return t=t||{},t.raw=!0,zR(e,t)}var sQe=Nj,oQe=zR,iQe=aQe,lQe=zR,cQe=jj,dQe={Inflate:sQe,inflate:oQe,inflateRaw:iQe,ungzip:lQe,constants:cQe};const{Inflate:uQe,inflate:fQe,inflateRaw:Pct,ungzip:Ect}=dQe;var U9=uQe,mQe=fQe;const jae=[];for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;jae[e]=t}const V9=4294967295;function hQe(e,t,r){let n=e;for(let s=0;s<r;s++)n=jae[(n^t[s])&255]^n>>>8;return n}function pQe(e,t){return(hQe(V9,e,t)^V9)>>>0}function W9(e,t,r){const n=e.readUint32(),s=pQe(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(s!==n)throw new Error(`CRC mismatch for chunk ${r}. Expected ${n}, found ${s}`)}function _ae(e,t,r){for(let n=0;n<r;n++)t[n]=e[n]}function Nae(e,t,r,n){let s=0;for(;s<n;s++)t[s]=e[s];for(;s<r;s++)t[s]=e[s]+t[s-n]&255}function Sae(e,t,r,n){let s=0;if(r.length===0)for(;s<n;s++)t[s]=e[s];else for(;s<n;s++)t[s]=e[s]+r[s]&255}function Cae(e,t,r,n,s){let o=0;if(r.length===0){for(;o<s;o++)t[o]=e[o];for(;o<n;o++)t[o]=e[o]+(t[o-s]>>1)&255}else{for(;o<s;o++)t[o]=e[o]+(r[o]>>1)&255;for(;o<n;o++)t[o]=e[o]+(t[o-s]+r[o]>>1)&255}}function Aae(e,t,r,n,s){let o=0;if(r.length===0){for(;o<s;o++)t[o]=e[o];for(;o<n;o++)t[o]=e[o]+t[o-s]&255}else{for(;o<s;o++)t[o]=e[o]+r[o]&255;for(;o<n;o++)t[o]=e[o]+gQe(t[o-s],r[o],r[o-s])&255}}function gQe(e,t,r){const n=e+t-r,s=Math.abs(n-e),o=Math.abs(n-t),i=Math.abs(n-r);return s<=o&&s<=i?e:o<=i?t:r}function xQe(e,t,r,n,s,o){switch(e){case 0:_ae(t,r,s);break;case 1:Nae(t,r,s,o);break;case 2:Sae(t,r,n,s);break;case 3:Cae(t,r,n,s,o);break;case 4:Aae(t,r,n,s,o);break;default:throw new Error(`Unsupported filter: ${e}`)}}const vQe=new Uint16Array([255]),yQe=new Uint8Array(vQe.buffer),bQe=yQe[0]===255;function wQe(e){const{data:t,width:r,height:n,channels:s,depth:o}=e,i=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(o/8)*s,c=new Uint8Array(n*r*l);let d=0;for(let u=0;u<7;u++){const f=i[u],h=Math.ceil((r-f.x)/f.xStep),m=Math.ceil((n-f.y)/f.yStep);if(h<=0||m<=0)continue;const x=h*l,g=new Uint8Array(x);for(let v=0;v<m;v++){const y=t[d++],b=t.subarray(d,d+x);d+=x;const w=new Uint8Array(x);xQe(y,b,w,g,x,l),g.set(w);for(let j=0;j<h;j++){const _=f.x+j*f.xStep,C=f.y+v*f.yStep;if(!(_>=r||C>=n))for(let E=0;E<l;E++)c[(C*r+_)*l+E]=w[j*l+E]}}}if(o===16){const u=new Uint16Array(c.buffer);if(bQe)for(let f=0;f<u.length;f++)u[f]=jQe(u[f]);return u}else return c}function jQe(e){return(e&255)<<8|e>>8&255}const _Qe=new Uint16Array([255]),NQe=new Uint8Array(_Qe.buffer),SQe=NQe[0]===255,CQe=new Uint8Array(0);function H9(e){const{data:t,width:r,height:n,channels:s,depth:o}=e,i=Math.ceil(o/8)*s,l=Math.ceil(o/8*s*r),c=new Uint8Array(n*l);let d=CQe,u=0,f,h;for(let m=0;m<n;m++){switch(f=t.subarray(u+1,u+1+l),h=c.subarray(m*l,(m+1)*l),t[u]){case 0:_ae(f,h,l);break;case 1:Nae(f,h,l,i);break;case 2:Sae(f,h,d,l);break;case 3:Cae(f,h,d,l,i);break;case 4:Aae(f,h,d,l,i);break;default:throw new Error(`Unsupported filter: ${t[u]}`)}d=h,u+=l+1}if(o===16){const m=new Uint16Array(c.buffer);if(SQe)for(let x=0;x<m.length;x++)m[x]=AQe(m[x]);return m}else return c}function AQe(e){return(e&255)<<8|e>>8&255}const q2=Uint8Array.of(137,80,78,71,13,10,26,10);function G9(e){if(!PQe(e.readBytes(q2.length)))throw new Error("wrong PNG signature")}function PQe(e){if(e.length<q2.length)return!1;for(let t=0;t<q2.length;t++)if(e[t]!==q2[t])return!1;return!0}const EQe="tEXt",kQe=0,Pae=new TextDecoder("latin1");function IQe(e){if(TQe(e),e.length===0||e.length>79)throw new Error("keyword length must be between 1 and 79")}const OQe=/^[\u0000-\u00FF]*$/;function TQe(e){if(!OQe.test(e))throw new Error("invalid latin1 text")}function DQe(e,t,r){const n=Eae(t);e[n]=MQe(t,r-n.length-1)}function Eae(e){for(e.mark();e.readByte()!==kQe;);const t=e.offset;e.reset();const r=Pae.decode(e.readBytes(t-e.offset-1));return e.skip(1),IQe(r),r}function MQe(e,t){return Pae.decode(e.readBytes(t))}const dd={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},ck={UNKNOWN:-1,DEFLATE:0},K9={UNKNOWN:-1,ADAPTIVE:0},dk={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Y_={NONE:0,BACKGROUND:1,PREVIOUS:2},uk={SOURCE:0,OVER:1};class RQe extends MR{constructor(r,n={}){super(r);fo(this,"_checkCrc");fo(this,"_inflator");fo(this,"_png");fo(this,"_apng");fo(this,"_end");fo(this,"_hasPalette");fo(this,"_palette");fo(this,"_hasTransparency");fo(this,"_transparency");fo(this,"_compressionMethod");fo(this,"_filterMethod");fo(this,"_interlaceMethod");fo(this,"_colorType");fo(this,"_isAnimated");fo(this,"_numberOfFrames");fo(this,"_numberOfPlays");fo(this,"_frames");fo(this,"_writingDataChunks");const{checkCrc:s=!1}=n;this._checkCrc=s,this._inflator=new U9,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=ck.UNKNOWN,this._filterMethod=K9.UNKNOWN,this._interlaceMethod=dk.UNKNOWN,this._colorType=dd.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(G9(this);!this._end;){const r=this.readUint32(),n=this.readChars(4);this.decodeChunk(r,n)}return this.decodeImage(),this._png}decodeApng(){for(G9(this);!this._end;){const r=this.readUint32(),n=this.readChars(4);this.decodeApngChunk(r,n)}return this.decodeApngImage(),this._apng}decodeChunk(r,n){const s=this.offset;switch(n){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(r);break;case"iCCP":this.decodeiCCP(r);break;case EQe:DQe(this._png.text,this,r);break;case"pHYs":this.decodepHYs();break;default:this.skip(r);break}if(this.offset-s!==r)throw new Error(`Length mismatch while decoding chunk ${n}`);this._checkCrc?W9(this,r+4,n):this.skip(4)}decodeApngChunk(r,n){const s=this.offset;switch(n!=="fdAT"&&n!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),n){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(r);break;default:this.decodeChunk(r,n),this.offset=s+r;break}if(this.offset-s!==r)throw new Error(`Length mismatch while decoding chunk ${n}`);this._checkCrc?W9(this,r+4,n):this.skip(4)}decodeIHDR(){const r=this._png;r.width=this.readUint32(),r.height=this.readUint32(),r.depth=FQe(this.readUint8());const n=this.readUint8();this._colorType=n;let s;switch(n){case dd.GREYSCALE:s=1;break;case dd.TRUECOLOUR:s=3;break;case dd.INDEXED_COLOUR:s=1;break;case dd.GREYSCALE_ALPHA:s=2;break;case dd.TRUECOLOUR_ALPHA:s=4;break;case dd.UNKNOWN:default:throw new Error(`Unknown color type: ${n}`)}if(this._png.channels=s,this._compressionMethod=this.readUint8(),this._compressionMethod!==ck.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const r={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(r)}decodePLTE(r){if(r%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${r}`);const n=r/3;this._hasPalette=!0;const s=[];this._palette=s;for(let o=0;o<n;o++)s.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(r){this._writingDataChunks=!0;const n=r,s=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,s,n)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodeFDAT(r){this._writingDataChunks=!0;let n=r,s=this.offset+this.byteOffset;if(s+=4,n-=4,this._inflator.push(new Uint8Array(this.buffer,s,n)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(r)}decodetRNS(r){switch(this._colorType){case dd.GREYSCALE:case dd.TRUECOLOUR:{if(r%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${r}`);if(r/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${r/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(r/2);for(let n=0;n<r/2;n++)this._transparency[n]=this.readUint16();break}case dd.INDEXED_COLOUR:{if(r>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${r} vs ${this._palette.length})`);let n=0;for(;n<r;n++){const s=this.readByte();this._palette[n].push(s)}for(;n<this._palette.length;n++)this._palette[n].push(255);break}case dd.UNKNOWN:case dd.GREYSCALE_ALPHA:case dd.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(r){const n=Eae(this),s=this.readUint8();if(s!==ck.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${s}`);const o=this.readBytes(r-n.length-2);this._png.iccEmbeddedProfile={name:n,profile:mQe(o)}}decodepHYs(){const r=this.readUint32(),n=this.readUint32(),s=this.readByte();this._png.resolution={x:r,y:n,unit:s}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let r=0;r<this._numberOfFrames;r++){const n={sequenceNumber:this._frames[r].sequenceNumber,delayNumber:this._frames[r].delayNumber,delayDenominator:this._frames[r].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},s=this._frames.at(r);if(s){if(s.data=H9({data:s.data,width:s.width,height:s.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),r===0||s.xOffset===0&&s.yOffset===0&&s.width===this._png.width&&s.height===this._png.height)n.data=s.data;else{const o=this._apng.frames.at(r-1);this.disposeFrame(s,o,n),this.addFrameDataToCanvas(n,s)}this._apng.frames.push(n)}}return this._apng}disposeFrame(r,n,s){switch(r.disposeOp){case Y_.NONE:break;case Y_.BACKGROUND:for(let o=0;o<this._png.height;o++)for(let i=0;i<this._png.width;i++){const l=(o*r.width+i)*this._png.channels;for(let c=0;c<this._png.channels;c++)s.data[l+c]=0}break;case Y_.PREVIOUS:s.data.set(n.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(r,n){const s=1<<this._png.depth,o=(i,l)=>{const c=((i+n.yOffset)*this._png.width+n.xOffset+l)*this._png.channels,d=(i*n.width+l)*this._png.channels;return{index:c,frameIndex:d}};switch(n.blendOp){case uk.SOURCE:for(let i=0;i<n.height;i++)for(let l=0;l<n.width;l++){const{index:c,frameIndex:d}=o(i,l);for(let u=0;u<this._png.channels;u++)r.data[c+u]=n.data[d+u]}break;case uk.OVER:for(let i=0;i<n.height;i++)for(let l=0;l<n.width;l++){const{index:c,frameIndex:d}=o(i,l);for(let u=0;u<this._png.channels;u++){const f=n.data[d+this._png.channels-1]/s,h=u%(this._png.channels-1)===0?1:n.data[d+u],m=Math.floor(f*h+(1-f)*r.data[c+u]);r.data[c+u]+=m}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const r=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==K9.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===dk.NO_INTERLACE)this._png.data=H9({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===dk.ADAM7)this._png.data=wQe({data:r,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const r=this._inflator.result,n=this._frames.at(-1);n?n.data=r:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Y_.NONE,blendOp:uk.SOURCE,data:r}),this._inflator=new U9,this._writingDataChunks=!1}}function FQe(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}var X9;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(X9||(X9={}));function LQe(e,t){return new RQe(e,t).decode()}var os=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function fk(){os.console&&typeof os.console.log=="function"&&os.console.log.apply(os.console,arguments)}var jo={log:fk,warn:function(e){os.console&&(typeof os.console.warn=="function"?os.console.warn.apply(os.console,arguments):fk.call(null,arguments))},error:function(e){os.console&&(typeof os.console.error=="function"?os.console.error.apply(os.console,arguments):fk(e))}};function mk(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){og(n.response,t,r)},n.onerror=function(){jo.error("could not download file")},n.send()}function Y9(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function J_(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var og=os.saveAs||((typeof window>"u"?"undefined":Ms(window))!=="object"||window!==os?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=os.URL||os.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener",typeof e=="string"?(s.href=e,s.origin!==location.origin?Y9(s.href)?mk(e,t,r):J_(s,s.target="_blank"):J_(s)):(s.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(s.href)},4e4),setTimeout(function(){J_(s)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(Y9(e))mk(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){J_(n)})}else navigator.msSaveOrOpenBlob(function(s,o){return o===void 0?o={autoBom:!1}:Ms(o)!=="object"&&(jo.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob([String.fromCharCode(65279),s],{type:s.type}):s}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return mk(e,t,r);var s=e.type==="application/octet-stream",o=/constructor/i.test(os.HTMLElement)||os.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||s&&o)&&(typeof FileReader>"u"?"undefined":Ms(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var u=l.result;u=i?u:u.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=u:location=u,n=null},l.readAsDataURL(e)}else{var c=os.URL||os.webkitURL,d=c.createObjectURL(e);n?n.location=d:location.href=d,n=null,setTimeout(function(){c.revokeObjectURL(d)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function kae(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<r.length;n++){var s=r[n].re,o=r[n].process,i=s.exec(e);i&&(t=o(i),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),d=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),d.length==1&&(d="0"+d),"#"+l+c+d}}var z2=os.atob.bind(os),J9=os.btoa.bind(os);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function hk(e,t){var r=e[0],n=e[1],s=e[2],o=e[3];r=Ll(r,n,s,o,t[0],7,-680876936),o=Ll(o,r,n,s,t[1],12,-389564586),s=Ll(s,o,r,n,t[2],17,606105819),n=Ll(n,s,o,r,t[3],22,-1044525330),r=Ll(r,n,s,o,t[4],7,-176418897),o=Ll(o,r,n,s,t[5],12,1200080426),s=Ll(s,o,r,n,t[6],17,-1473231341),n=Ll(n,s,o,r,t[7],22,-45705983),r=Ll(r,n,s,o,t[8],7,1770035416),o=Ll(o,r,n,s,t[9],12,-1958414417),s=Ll(s,o,r,n,t[10],17,-42063),n=Ll(n,s,o,r,t[11],22,-1990404162),r=Ll(r,n,s,o,t[12],7,1804603682),o=Ll(o,r,n,s,t[13],12,-40341101),s=Ll(s,o,r,n,t[14],17,-1502002290),r=$l(r,n=Ll(n,s,o,r,t[15],22,1236535329),s,o,t[1],5,-165796510),o=$l(o,r,n,s,t[6],9,-1069501632),s=$l(s,o,r,n,t[11],14,643717713),n=$l(n,s,o,r,t[0],20,-373897302),r=$l(r,n,s,o,t[5],5,-701558691),o=$l(o,r,n,s,t[10],9,38016083),s=$l(s,o,r,n,t[15],14,-660478335),n=$l(n,s,o,r,t[4],20,-405537848),r=$l(r,n,s,o,t[9],5,568446438),o=$l(o,r,n,s,t[14],9,-1019803690),s=$l(s,o,r,n,t[3],14,-187363961),n=$l(n,s,o,r,t[8],20,1163531501),r=$l(r,n,s,o,t[13],5,-1444681467),o=$l(o,r,n,s,t[2],9,-51403784),s=$l(s,o,r,n,t[7],14,1735328473),r=Bl(r,n=$l(n,s,o,r,t[12],20,-1926607734),s,o,t[5],4,-378558),o=Bl(o,r,n,s,t[8],11,-2022574463),s=Bl(s,o,r,n,t[11],16,1839030562),n=Bl(n,s,o,r,t[14],23,-35309556),r=Bl(r,n,s,o,t[1],4,-1530992060),o=Bl(o,r,n,s,t[4],11,1272893353),s=Bl(s,o,r,n,t[7],16,-155497632),n=Bl(n,s,o,r,t[10],23,-1094730640),r=Bl(r,n,s,o,t[13],4,681279174),o=Bl(o,r,n,s,t[0],11,-358537222),s=Bl(s,o,r,n,t[3],16,-722521979),n=Bl(n,s,o,r,t[6],23,76029189),r=Bl(r,n,s,o,t[9],4,-640364487),o=Bl(o,r,n,s,t[12],11,-421815835),s=Bl(s,o,r,n,t[15],16,530742520),r=ql(r,n=Bl(n,s,o,r,t[2],23,-995338651),s,o,t[0],6,-198630844),o=ql(o,r,n,s,t[7],10,1126891415),s=ql(s,o,r,n,t[14],15,-1416354905),n=ql(n,s,o,r,t[5],21,-57434055),r=ql(r,n,s,o,t[12],6,1700485571),o=ql(o,r,n,s,t[3],10,-1894986606),s=ql(s,o,r,n,t[10],15,-1051523),n=ql(n,s,o,r,t[1],21,-2054922799),r=ql(r,n,s,o,t[8],6,1873313359),o=ql(o,r,n,s,t[15],10,-30611744),s=ql(s,o,r,n,t[6],15,-1560198380),n=ql(n,s,o,r,t[13],21,1309151649),r=ql(r,n,s,o,t[4],6,-145523070),o=ql(o,r,n,s,t[11],10,-1120210379),s=ql(s,o,r,n,t[2],15,718787259),n=ql(n,s,o,r,t[9],21,-343485551),e[0]=qh(r,e[0]),e[1]=qh(n,e[1]),e[2]=qh(s,e[2]),e[3]=qh(o,e[3])}function NA(e,t,r,n,s,o){return t=qh(qh(t,e),qh(n,o)),qh(t<<s|t>>>32-s,r)}function Ll(e,t,r,n,s,o,i){return NA(t&r|~t&n,e,t,s,o,i)}function $l(e,t,r,n,s,o,i){return NA(t&n|r&~n,e,t,s,o,i)}function Bl(e,t,r,n,s,o,i){return NA(t^r^n,e,t,s,o,i)}function ql(e,t,r,n,s,o,i){return NA(r^(t|~n),e,t,s,o,i)}function Iae(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)hk(n,$Qe(e.substring(t-64,t)));e=e.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(hk(n,s),t=0;t<16;t++)s[t]=0;return s[14]=8*r,hk(n,s),n}function $Qe(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}var Q9="0123456789abcdef".split("");function BQe(e){for(var t="",r=0;r<4;r++)t+=Q9[e>>8*r+4&15]+Q9[e>>8*r&15];return t}function qQe(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function A3(e){return Iae(e).map(qQe).join("")}var zQe=function(e){for(var t=0;t<e.length;t++)e[t]=BQe(e[t]);return e.join("")}(Iae("hello"))!="5d41402abc4b2a76b9719d911017c592";function qh(e,t){if(zQe){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function P3(e,t){var r,n,s,o;if(e!==r){for(var i=(s=e,o=1+(256/e.length|0),new Array(o+1).join(s)),l=[],c=0;c<256;c++)l[c]=c;var d=0;for(c=0;c<256;c++){var u=l[c];d=(d+u+i.charCodeAt(c))%256,l[c]=l[d],l[d]=u}r=e,n=l}else l=n;var f=t.length,h=0,m=0,x="";for(c=0;c<f;c++)m=(m+(u=l[h=(h+1)%256]))%256,l[h]=l[m],l[m]=u,i=l[(l[h]+l[m])%256],x+=String.fromCharCode(t.charCodeAt(c)^i);return x}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var Z9={print:4,modify:8,copy:16,"annot-forms":32};function cv(e,t,r,n){this.v=1,this.r=2;var s=192;e.forEach(function(l){if(Z9.perm!==void 0)throw new Error("Invalid permission: "+l);s+=Z9[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(t+this.padding).substr(0,32),i=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,i),this.P=-(1+(255^s)),this.encryptionKey=A3(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=P3(this.encryptionKey,this.padding)}function dv(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var s=e.charCodeAt(n);t+=s<33||s===35||s===37||s===40||s===41||s===47||s===60||s===62||s===91||s===93||s===123||s===125||s>126?"#"+("0"+s.toString(16)).slice(-2):e[n]}return t}function eU(e){if(Ms(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,n,s){if(s=s||!1,typeof r!="string"||typeof n!="function"||typeof s!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var o=Math.random().toString(35);return t[r][o]=[n,!!s],o},this.unsubscribe=function(r){for(var n in t)if(t[n][r])return delete t[n][r],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),s=[];for(var o in t[r]){var i=t[r][o];try{i[0].apply(e,n)}catch(l){os.console&&jo.error("jsPDF PubSub Error",l.message,l)}i[1]&&s.push(o)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function F1(e){if(!(this instanceof F1))return new F1(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function Oae(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function kh(e,t,r,n,s){if(!(this instanceof kh))return new kh(e,t,r,n,s);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,Oae.call(this,n,s)}function Ag(e,t,r,n,s){if(!(this instanceof Ag))return new Ag(e,t,r,n,s);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,Oae.call(this,n,s)}function Ta(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],s=arguments[2],o=arguments[3],i=[],l=1,c=16,d="S",u=null;Ms(e=e||{})==="object"&&(r=e.orientation,n=e.unit||n,s=e.format||s,o=e.compress||e.compressPdf||o,(u=e.encryption||null)!==null&&(u.userPassword=u.userPassword||"",u.ownerPassword=u.ownerPassword||"",u.userPermissions=u.userPermissions||[]),l=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(c=e.floatPrecision),d=e.defaultPathOperation||"S"),i=e.filters||(o===!0?["FlateEncode"]:i),n=n||"mm",r=(""+(r||"P")).toLowerCase();var f=e.putOnlyUsedFonts||!1,h={},m={internal:{},__private__:{}};m.__private__.PubSub=eU;var x="1.3",g=m.__private__.getPdfVersion=function(){return x};m.__private__.setPdfVersion=function(R){x=R};var v={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};m.__private__.getPageFormats=function(){return v};var y=m.__private__.getPageFormat=function(R){return v[R]};s=s||"a4";var b="compat",w="advanced",j=b;function _(){this.saveGraphicsState(),ae(new ke(Vt,0,0,-Vt,0,Ji()*Vt).toString()+" cm"),this.setFontSize(this.getFontSize()/Vt),d="n",j=w}function C(){this.restoreGraphicsState(),d="S",j=b}var E=m.__private__.combineFontStyleAndFontWeight=function(R,de){if(R=="bold"&&de=="normal"||R=="bold"&&de==400||R=="normal"&&de=="italic"||R=="bold"&&de=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return de&&(R=de==400||de==="normal"?R==="italic"?"italic":"normal":de!=700&&de!=="bold"||R!=="normal"?(de==700?"bold":de)+""+R:"bold"),R};m.advancedAPI=function(R){var de=j===b;return de&&_.call(this),typeof R!="function"||(R(this),de&&C.call(this)),this},m.compatAPI=function(R){var de=j===w;return de&&C.call(this),typeof R!="function"||(R(this),de&&_.call(this)),this},m.isAdvancedAPI=function(){return j===w};var S,A=function(R){if(j!==w)throw new Error(R+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},M=m.roundToPrecision=m.__private__.roundToPrecision=function(R,de){var Ue=t||de;if(isNaN(R)||isNaN(Ue))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return R.toFixed(Ue).replace(/0+$/,"")};S=m.hpf=m.__private__.hpf=typeof c=="number"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return M(R,c)}:c==="smart"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return M(R,R>-1&&R<1?16:5)}:function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return M(R,16)};var O=m.f2=m.__private__.f2=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f2");return M(R,2)},I=m.__private__.f3=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f3");return M(R,3)},T=m.scale=m.__private__.scale=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.scale");return j===b?R*Vt:j===w?R:void 0},k=function(R){return T(function(de){return j===b?Ji()-de:j===w?de:void 0}(R))};m.__private__.setPrecision=m.setPrecision=function(R){typeof parseInt(R,10)=="number"&&(t=parseInt(R,10))};var q,B="00000000000000000000000000000000",z=m.__private__.getFileId=function(){return B},F=m.__private__.setFileId=function(R){return B=R!==void 0&&/^[a-fA-F0-9]{32}$/.test(R)?R.toUpperCase():B.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),u!==null&&(Oe=new cv(u.userPermissions,u.userPassword,u.ownerPassword,B)),B};m.setFileId=function(R){return F(R),this},m.getFileId=function(){return z()};var V=m.__private__.convertDateToPDFDate=function(R){var de=R.getTimezoneOffset(),Ue=de<0?"+":"-",vt=Math.floor(Math.abs(de/60)),Ht=Math.abs(de%60),Ur=[Ue,H(vt),"'",H(Ht),"'"].join("");return["D:",R.getFullYear(),H(R.getMonth()+1),H(R.getDate()),H(R.getHours()),H(R.getMinutes()),H(R.getSeconds()),Ur].join("")},me=m.__private__.convertPDFDateToDate=function(R){var de=parseInt(R.substr(2,4),10),Ue=parseInt(R.substr(6,2),10)-1,vt=parseInt(R.substr(8,2),10),Ht=parseInt(R.substr(10,2),10),Ur=parseInt(R.substr(12,2),10),mn=parseInt(R.substr(14,2),10);return new Date(de,Ue,vt,Ht,Ur,mn,0)},be=m.__private__.setCreationDate=function(R){var de;if(R===void 0&&(R=new Date),R instanceof Date)de=V(R);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(R))throw new Error("Invalid argument passed to jsPDF.setCreationDate");de=R}return q=de},U=m.__private__.getCreationDate=function(R){var de=q;return R==="jsDate"&&(de=me(q)),de};m.setCreationDate=function(R){return be(R),this},m.getCreationDate=function(R){return U(R)};var L,H=m.__private__.padd2=function(R){return("0"+parseInt(R)).slice(-2)},ie=m.__private__.padd2Hex=function(R){return("00"+(R=R.toString())).substr(R.length)},Y=0,W=[],se=[],pe=0,G=[],te=[],oe=!1,De=se;m.__private__.setCustomOutputDestination=function(R){oe=!0,De=R};var re=function(R){oe||(De=R)};m.__private__.resetCustomOutputDestination=function(){oe=!1,De=se};var ae=m.__private__.out=function(R){return R=R.toString(),pe+=R.length+1,De.push(R),De},ut=m.__private__.write=function(R){return ae(arguments.length===1?R.toString():Array.prototype.join.call(arguments," "))},pt=m.__private__.getArrayBuffer=function(R){for(var de=R.length,Ue=new ArrayBuffer(de),vt=new Uint8Array(Ue);de--;)vt[de]=R.charCodeAt(de);return Ue},ft=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];m.__private__.getStandardFonts=function(){return ft};var bt=e.fontSize||16;m.__private__.setFontSize=m.setFontSize=function(R){return bt=j===w?R/Vt:R,this};var Lt,Dt=m.__private__.getFontSize=m.getFontSize=function(){return j===b?bt:bt*Vt},Bt=e.R2L||!1;m.__private__.setR2L=m.setR2L=function(R){return Bt=R,this},m.__private__.getR2L=m.getR2L=function(){return Bt};var ge,wt=m.__private__.setZoomMode=function(R){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(R))Lt=R;else if(isNaN(R)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(R)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+R+'" is not recognized.');Lt=R}else Lt=parseInt(R,10)};m.__private__.getZoomMode=function(){return Lt};var Gt,Sr=m.__private__.setPageMode=function(R){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(R)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+R+'" is not recognized.');ge=R};m.__private__.getPageMode=function(){return ge};var wr=m.__private__.setLayoutMode=function(R){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(R)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+R+'" is not recognized.');Gt=R};m.__private__.getLayoutMode=function(){return Gt},m.__private__.setDisplayMode=m.setDisplayMode=function(R,de,Ue){return wt(R),wr(de),Sr(Ue),this};var he={title:"",subject:"",author:"",keywords:"",creator:""};m.__private__.getDocumentProperty=function(R){if(Object.keys(he).indexOf(R)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return he[R]},m.__private__.getDocumentProperties=function(){return he},m.__private__.setDocumentProperties=m.setProperties=m.setDocumentProperties=function(R){for(var de in he)he.hasOwnProperty(de)&&R[de]&&(he[de]=R[de]);return this},m.__private__.setDocumentProperty=function(R,de){if(Object.keys(he).indexOf(R)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return he[R]=de};var ot,Vt,qt,Re,Ct,Wt={},Er={},Me=[],lt={},gt={},or={},br={},ur=null,an=0,zr=[],Gr=new eU(m),ha=e.hotfixes||[],pn={},on={},cn=[],ke=function R(de,Ue,vt,Ht,Ur,mn){if(!(this instanceof R))return new R(de,Ue,vt,Ht,Ur,mn);isNaN(de)&&(de=1),isNaN(Ue)&&(Ue=0),isNaN(vt)&&(vt=0),isNaN(Ht)&&(Ht=1),isNaN(Ur)&&(Ur=0),isNaN(mn)&&(mn=0),this._matrix=[de,Ue,vt,Ht,Ur,mn]};Object.defineProperty(ke.prototype,"sx",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(ke.prototype,"shy",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(ke.prototype,"shx",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(ke.prototype,"sy",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(ke.prototype,"tx",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(ke.prototype,"ty",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(ke.prototype,"a",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(ke.prototype,"b",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(ke.prototype,"c",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(ke.prototype,"d",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(ke.prototype,"e",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(ke.prototype,"f",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(ke.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(ke.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(ke.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(ke.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),ke.prototype.join=function(R){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(S).join(R)},ke.prototype.multiply=function(R){var de=R.sx*this.sx+R.shy*this.shx,Ue=R.sx*this.shy+R.shy*this.sy,vt=R.shx*this.sx+R.sy*this.shx,Ht=R.shx*this.shy+R.sy*this.sy,Ur=R.tx*this.sx+R.ty*this.shx+this.tx,mn=R.tx*this.shy+R.ty*this.sy+this.ty;return new ke(de,Ue,vt,Ht,Ur,mn)},ke.prototype.decompose=function(){var R=this.sx,de=this.shy,Ue=this.shx,vt=this.sy,Ht=this.tx,Ur=this.ty,mn=Math.sqrt(R*R+de*de),ne=(R/=mn)*Ue+(de/=mn)*vt;Ue-=R*ne,vt-=de*ne;var Ae=Math.sqrt(Ue*Ue+vt*vt);return ne/=Ae,R*(vt/=Ae)<de*(Ue/=Ae)&&(R=-R,de=-de,ne=-ne,mn=-mn),{scale:new ke(mn,0,0,Ae,0,0),translate:new ke(1,0,0,1,Ht,Ur),rotate:new ke(R,de,-de,R,0,0),skew:new ke(1,0,ne,1,0,0)}},ke.prototype.toString=function(R){return this.join(" ")},ke.prototype.inversed=function(){var R=this.sx,de=this.shy,Ue=this.shx,vt=this.sy,Ht=this.tx,Ur=this.ty,mn=1/(R*vt-de*Ue),ne=vt*mn,Ae=-de*mn,Ee=-Ue*mn,it=R*mn;return new ke(ne,Ae,Ee,it,-ne*Ht-Ee*Ur,-Ae*Ht-it*Ur)},ke.prototype.applyToPoint=function(R){var de=R.x*this.sx+R.y*this.shx+this.tx,Ue=R.x*this.shy+R.y*this.sy+this.ty;return new si(de,Ue)},ke.prototype.applyToRectangle=function(R){var de=this.applyToPoint(R),Ue=this.applyToPoint(new si(R.x+R.w,R.y+R.h));return new zo(de.x,de.y,Ue.x-de.x,Ue.y-de.y)},ke.prototype.clone=function(){var R=this.sx,de=this.shy,Ue=this.shx,vt=this.sy,Ht=this.tx,Ur=this.ty;return new ke(R,de,Ue,vt,Ht,Ur)},m.Matrix=ke;var We=m.matrixMult=function(R,de){return de.multiply(R)},Ze=new ke(1,0,0,1,0,0);m.unitMatrix=m.identityMatrix=Ze;var Je=function(R,de){if(!gt[R]){var Ue=(de instanceof kh?"Sh":"P")+(Object.keys(lt).length+1).toString(10);de.id=Ue,gt[R]=Ue,lt[Ue]=de,Gr.publish("addPattern",de)}};m.ShadingPattern=kh,m.TilingPattern=Ag,m.addShadingPattern=function(R,de){return A("addShadingPattern()"),Je(R,de),this},m.beginTilingPattern=function(R){A("beginTilingPattern()"),Ac(R.boundingBox[0],R.boundingBox[1],R.boundingBox[2]-R.boundingBox[0],R.boundingBox[3]-R.boundingBox[1],R.matrix)},m.endTilingPattern=function(R,de){A("endTilingPattern()"),de.stream=te[L].join(`
`),Je(R,de),Gr.publish("endTilingPattern",de),cn.pop().restore()};var At,Ye=m.__private__.newObject=function(){var R=lr();return ce(R,!0),R},lr=m.__private__.newObjectDeferred=function(){return Y++,W[Y]=function(){return pe},Y},ce=function(R,de){return de=typeof de=="boolean"&&de,W[R]=pe,de&&ae(R+" 0 obj"),R},qe=m.__private__.newAdditionalObject=function(){var R={objId:lr(),content:""};return G.push(R),R},ze=lr(),xt=lr(),rr=m.__private__.decodeColorString=function(R){var de=R.split(" ");if(de.length!==2||de[1]!=="g"&&de[1]!=="G")de.length!==5||de[4]!=="k"&&de[4]!=="K"||(de=[(1-de[0])*(1-de[3]),(1-de[1])*(1-de[3]),(1-de[2])*(1-de[3]),"r"]);else{var Ue=parseFloat(de[0]);de=[Ue,Ue,Ue,"r"]}for(var vt="#",Ht=0;Ht<3;Ht++)vt+=("0"+Math.floor(255*parseFloat(de[Ht])).toString(16)).slice(-2);return vt},ir=m.__private__.encodeColorString=function(R){var de;typeof R=="string"&&(R={ch1:R});var Ue=R.ch1,vt=R.ch2,Ht=R.ch3,Ur=R.ch4,mn=R.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ue=="string"&&Ue.charAt(0)!=="#"){var ne=new kae(Ue);if(ne.ok)Ue=ne.toHex();else if(!/^\d*\.?\d*$/.test(Ue))throw new Error('Invalid color "'+Ue+'" passed to jsPDF.encodeColorString.')}if(typeof Ue=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ue)&&(Ue="#"+Ue[1]+Ue[1]+Ue[2]+Ue[2]+Ue[3]+Ue[3]),typeof Ue=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ue)){var Ae=parseInt(Ue.substr(1),16);Ue=Ae>>16&255,vt=Ae>>8&255,Ht=255&Ae}if(vt===void 0||Ur===void 0&&Ue===vt&&vt===Ht)de=typeof Ue=="string"?Ue+" "+mn[0]:R.precision===2?O(Ue/255)+" "+mn[0]:I(Ue/255)+" "+mn[0];else if(Ur===void 0||Ms(Ur)==="object"){if(Ur&&!isNaN(Ur.a)&&Ur.a===0)return["1.","1.","1.",mn[1]].join(" ");de=typeof Ue=="string"?[Ue,vt,Ht,mn[1]].join(" "):R.precision===2?[O(Ue/255),O(vt/255),O(Ht/255),mn[1]].join(" "):[I(Ue/255),I(vt/255),I(Ht/255),mn[1]].join(" ")}else de=typeof Ue=="string"?[Ue,vt,Ht,Ur,mn[2]].join(" "):R.precision===2?[O(Ue),O(vt),O(Ht),O(Ur),mn[2]].join(" "):[I(Ue),I(vt),I(Ht),I(Ur),mn[2]].join(" ");return de},Kr=m.__private__.getFilters=function(){return i},jr=m.__private__.putStream=function(R){var de=(R=R||{}).data||"",Ue=R.filters||Kr(),vt=R.alreadyAppliedFilters||[],Ht=R.addLength1||!1,Ur=de.length,mn=R.objectId,ne=function(yr){return yr};if(u!==null&&mn===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");u!==null&&(ne=Oe.encryptor(mn,0));var Ae={};Ue===!0&&(Ue=["FlateEncode"]);var Ee=R.additionalKeyValues||[],it=(Ae=Ta.API.processDataByFilters!==void 0?Ta.API.processDataByFilters(de,Ue):{data:de,reverseChain:[]}).reverseChain+(Array.isArray(vt)?vt.join(" "):vt.toString());if(Ae.data.length!==0&&(Ee.push({key:"Length",value:Ae.data.length}),Ht===!0&&Ee.push({key:"Length1",value:Ur})),it.length!=0)if(it.split("/").length-1==1)Ee.push({key:"Filter",value:it});else{Ee.push({key:"Filter",value:"["+it+"]"});for(var Et=0;Et<Ee.length;Et+=1)if(Ee[Et].key==="DecodeParms"){for(var gr=[],sr=0;sr<Ae.reverseChain.split("/").length-1;sr+=1)gr.push("null");gr.push(Ee[Et].value),Ee[Et].value="["+gr.join(" ")+"]"}}ae("<<");for(var Ir=0;Ir<Ee.length;Ir++)ae("/"+Ee[Ir].key+" "+Ee[Ir].value);ae(">>"),Ae.data.length!==0&&(ae("stream"),ae(ne(Ae.data)),ae("endstream"))},sa=m.__private__.putPage=function(R){var de=R.number,Ue=R.data,vt=R.objId,Ht=R.contentsObjId;ce(vt,!0),ae("<</Type /Page"),ae("/Parent "+R.rootDictionaryObjId+" 0 R"),ae("/Resources "+R.resourceDictionaryObjId+" 0 R"),ae("/MediaBox ["+parseFloat(S(R.mediaBox.bottomLeftX))+" "+parseFloat(S(R.mediaBox.bottomLeftY))+" "+S(R.mediaBox.topRightX)+" "+S(R.mediaBox.topRightY)+"]"),R.cropBox!==null&&ae("/CropBox ["+S(R.cropBox.bottomLeftX)+" "+S(R.cropBox.bottomLeftY)+" "+S(R.cropBox.topRightX)+" "+S(R.cropBox.topRightY)+"]"),R.bleedBox!==null&&ae("/BleedBox ["+S(R.bleedBox.bottomLeftX)+" "+S(R.bleedBox.bottomLeftY)+" "+S(R.bleedBox.topRightX)+" "+S(R.bleedBox.topRightY)+"]"),R.trimBox!==null&&ae("/TrimBox ["+S(R.trimBox.bottomLeftX)+" "+S(R.trimBox.bottomLeftY)+" "+S(R.trimBox.topRightX)+" "+S(R.trimBox.topRightY)+"]"),R.artBox!==null&&ae("/ArtBox ["+S(R.artBox.bottomLeftX)+" "+S(R.artBox.bottomLeftY)+" "+S(R.artBox.topRightX)+" "+S(R.artBox.topRightY)+"]"),typeof R.userUnit=="number"&&R.userUnit!==1&&ae("/UserUnit "+R.userUnit),Gr.publish("putPage",{objId:vt,pageContext:zr[de],pageNumber:de,page:Ue}),ae("/Contents "+Ht+" 0 R"),ae(">>"),ae("endobj");var Ur=Ue.join(`
`);return j===w&&(Ur+=`
Q`),ce(Ht,!0),jr({data:Ur,filters:Kr(),objectId:Ht}),ae("endobj"),vt},ia=m.__private__.putPages=function(){var R,de,Ue=[];for(R=1;R<=an;R++)zr[R].objId=lr(),zr[R].contentsObjId=lr();for(R=1;R<=an;R++)Ue.push(sa({number:R,data:te[R],objId:zr[R].objId,contentsObjId:zr[R].contentsObjId,mediaBox:zr[R].mediaBox,cropBox:zr[R].cropBox,bleedBox:zr[R].bleedBox,trimBox:zr[R].trimBox,artBox:zr[R].artBox,userUnit:zr[R].userUnit,rootDictionaryObjId:ze,resourceDictionaryObjId:xt}));ce(ze,!0),ae("<</Type /Pages");var vt="/Kids [";for(de=0;de<an;de++)vt+=Ue[de]+" 0 R ";ae(vt+"]"),ae("/Count "+an),ae(">>"),ae("endobj"),Gr.publish("postPutPages")},Kn=function(R){Gr.publish("putFont",{font:R,out:ae,newObject:Ye,putStream:jr}),R.isAlreadyPutted!==!0&&(R.objectNumber=Ye(),ae("<<"),ae("/Type /Font"),ae("/BaseFont /"+dv(R.postScriptName)),ae("/Subtype /Type1"),typeof R.encoding=="string"&&ae("/Encoding /"+R.encoding),ae("/FirstChar 32"),ae("/LastChar 255"),ae(">>"),ae("endobj"))},at=function(R){R.objectNumber=Ye();var de=[];de.push({key:"Type",value:"/XObject"}),de.push({key:"Subtype",value:"/Form"}),de.push({key:"BBox",value:"["+[S(R.x),S(R.y),S(R.x+R.width),S(R.y+R.height)].join(" ")+"]"}),de.push({key:"Matrix",value:"["+R.matrix.toString()+"]"});var Ue=R.pages[1].join(`
`);jr({data:Ue,additionalKeyValues:de,objectId:R.objectNumber}),ae("endobj")},Te=function(R,de){de||(de=21);var Ue=Ye(),vt=function(mn,ne){var Ae,Ee=[],it=1/(ne-1);for(Ae=0;Ae<1;Ae+=it)Ee.push(Ae);if(Ee.push(1),mn[0].offset!=0){var Et={offset:0,color:mn[0].color};mn.unshift(Et)}if(mn[mn.length-1].offset!=1){var gr={offset:1,color:mn[mn.length-1].color};mn.push(gr)}for(var sr="",Ir=0,yr=0;yr<Ee.length;yr++){for(Ae=Ee[yr];Ae>mn[Ir+1].offset;)Ir++;var Ut=mn[Ir].offset,_n=(Ae-Ut)/(mn[Ir+1].offset-Ut),Qr=mn[Ir].color,Ar=mn[Ir+1].color;sr+=ie(Math.round((1-_n)*Qr[0]+_n*Ar[0]).toString(16))+ie(Math.round((1-_n)*Qr[1]+_n*Ar[1]).toString(16))+ie(Math.round((1-_n)*Qr[2]+_n*Ar[2]).toString(16))}return sr.trim()}(R.colors,de),Ht=[];Ht.push({key:"FunctionType",value:"0"}),Ht.push({key:"Domain",value:"[0.0 1.0]"}),Ht.push({key:"Size",value:"["+de+"]"}),Ht.push({key:"BitsPerSample",value:"8"}),Ht.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ht.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),jr({data:vt,additionalKeyValues:Ht,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ue}),ae("endobj"),R.objectNumber=Ye(),ae("<< /ShadingType "+R.type),ae("/ColorSpace /DeviceRGB");var Ur="/Coords ["+S(parseFloat(R.coords[0]))+" "+S(parseFloat(R.coords[1]))+" ";R.type===2?Ur+=S(parseFloat(R.coords[2]))+" "+S(parseFloat(R.coords[3])):Ur+=S(parseFloat(R.coords[2]))+" "+S(parseFloat(R.coords[3]))+" "+S(parseFloat(R.coords[4]))+" "+S(parseFloat(R.coords[5])),ae(Ur+="]"),R.matrix&&ae("/Matrix ["+R.matrix.toString()+"]"),ae("/Function "+Ue+" 0 R"),ae("/Extend [true true]"),ae(">>"),ae("endobj")},Fe=function(R,de){var Ue=lr(),vt=Ye();de.push({resourcesOid:Ue,objectOid:vt}),R.objectNumber=vt;var Ht=[];Ht.push({key:"Type",value:"/Pattern"}),Ht.push({key:"PatternType",value:"1"}),Ht.push({key:"PaintType",value:"1"}),Ht.push({key:"TilingType",value:"1"}),Ht.push({key:"BBox",value:"["+R.boundingBox.map(S).join(" ")+"]"}),Ht.push({key:"XStep",value:S(R.xStep)}),Ht.push({key:"YStep",value:S(R.yStep)}),Ht.push({key:"Resources",value:Ue+" 0 R"}),R.matrix&&Ht.push({key:"Matrix",value:"["+R.matrix.toString()+"]"}),jr({data:R.stream,additionalKeyValues:Ht,objectId:R.objectNumber}),ae("endobj")},cr=function(R){for(var de in R.objectNumber=Ye(),ae("<<"),R)switch(de){case"opacity":ae("/ca "+O(R[de]));break;case"stroke-opacity":ae("/CA "+O(R[de]))}ae(">>"),ae("endobj")},ht=function(R){ce(R.resourcesOid,!0),ae("<<"),ae("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var de in ae("/Font <<"),Wt)Wt.hasOwnProperty(de)&&(f===!1||f===!0&&h.hasOwnProperty(de))&&ae("/"+de+" "+Wt[de].objectNumber+" 0 R");ae(">>")}(),function(){if(Object.keys(lt).length>0){for(var de in ae("/Shading <<"),lt)lt.hasOwnProperty(de)&&lt[de]instanceof kh&&lt[de].objectNumber>=0&&ae("/"+de+" "+lt[de].objectNumber+" 0 R");Gr.publish("putShadingPatternDict"),ae(">>")}}(),function(de){if(Object.keys(lt).length>0){for(var Ue in ae("/Pattern <<"),lt)lt.hasOwnProperty(Ue)&&lt[Ue]instanceof m.TilingPattern&&lt[Ue].objectNumber>=0&&lt[Ue].objectNumber<de&&ae("/"+Ue+" "+lt[Ue].objectNumber+" 0 R");Gr.publish("putTilingPatternDict"),ae(">>")}}(R.objectOid),function(){if(Object.keys(or).length>0){var de;for(de in ae("/ExtGState <<"),or)or.hasOwnProperty(de)&&or[de].objectNumber>=0&&ae("/"+de+" "+or[de].objectNumber+" 0 R");Gr.publish("putGStateDict"),ae(">>")}}(),function(){for(var de in ae("/XObject <<"),pn)pn.hasOwnProperty(de)&&pn[de].objectNumber>=0&&ae("/"+de+" "+pn[de].objectNumber+" 0 R");Gr.publish("putXobjectDict"),ae(">>")}(),ae(">>"),ae("endobj")},Xr=function(R){Er[R.fontName]=Er[R.fontName]||{},Er[R.fontName][R.fontStyle]=R.id},Ft=function(R,de,Ue,vt,Ht){var Ur={id:"F"+(Object.keys(Wt).length+1).toString(10),postScriptName:R,fontName:de,fontStyle:Ue,encoding:vt,isStandardFont:Ht||!1,metadata:{}};return Gr.publish("addFont",{font:Ur,instance:this}),Wt[Ur.id]=Ur,Xr(Ur),Ur.id},kr=m.__private__.pdfEscape=m.pdfEscape=function(R,de){return function(Ue,vt){var Ht,Ur,mn,ne,Ae,Ee,it,Et,gr;if(mn=(vt=vt||{}).sourceEncoding||"Unicode",Ae=vt.outputEncoding,(vt.autoencode||Ae)&&Wt[ot].metadata&&Wt[ot].metadata[mn]&&Wt[ot].metadata[mn].encoding&&(ne=Wt[ot].metadata[mn].encoding,!Ae&&Wt[ot].encoding&&(Ae=Wt[ot].encoding),!Ae&&ne.codePages&&(Ae=ne.codePages[0]),typeof Ae=="string"&&(Ae=ne[Ae]),Ae)){for(it=!1,Ee=[],Ht=0,Ur=Ue.length;Ht<Ur;Ht++)(Et=Ae[Ue.charCodeAt(Ht)])?Ee.push(String.fromCharCode(Et)):Ee.push(Ue[Ht]),Ee[Ht].charCodeAt(0)>>8&&(it=!0);Ue=Ee.join("")}for(Ht=Ue.length;it===void 0&&Ht!==0;)Ue.charCodeAt(Ht-1)>>8&&(it=!0),Ht--;if(!it)return Ue;for(Ee=vt.noBOM?[]:[254,255],Ht=0,Ur=Ue.length;Ht<Ur;Ht++){if((gr=(Et=Ue.charCodeAt(Ht))>>8)>>8)throw new Error("Character at position "+Ht+" of string '"+Ue+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Ee.push(gr),Ee.push(Et-(gr<<8))}return String.fromCharCode.apply(void 0,Ee)}(R,de).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},jt=m.__private__.beginPage=function(R){te[++an]=[],zr[an]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(R[0]),topRightY:Number(R[1])}},Cr(an),re(te[L])},er=function(R,de){var Ue,vt,Ht;switch(r=de||r,typeof R=="string"&&(Ue=y(R.toLowerCase()),Array.isArray(Ue)&&(vt=Ue[0],Ht=Ue[1])),Array.isArray(R)&&(vt=R[0]*Vt,Ht=R[1]*Vt),isNaN(vt)&&(vt=s[0],Ht=s[1]),(vt>14400||Ht>14400)&&(jo.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),vt=Math.min(14400,vt),Ht=Math.min(14400,Ht)),s=[vt,Ht],r.substr(0,1)){case"l":Ht>vt&&(s=[Ht,vt]);break;case"p":vt>Ht&&(s=[Ht,vt])}jt(s),xn(la),ae(As),Qc!==0&&ae(Qc+" J"),Cc!==0&&ae(Cc+" j"),Gr.publish("addPage",{pageNumber:an})},Nt=function(R){R>0&&R<=an&&(te.splice(R,1),zr.splice(R,1),an--,L>an&&(L=an),this.setPage(L))},Cr=function(R){R>0&&R<=an&&(L=R)},Lr=m.__private__.getNumberOfPages=m.getNumberOfPages=function(){return te.length-1},un=function(R,de,Ue){var vt,Ht=void 0;return Ue=Ue||{},R=R!==void 0?R:Wt[ot].fontName,de=de!==void 0?de:Wt[ot].fontStyle,vt=R.toLowerCase(),Er[vt]!==void 0&&Er[vt][de]!==void 0?Ht=Er[vt][de]:Er[R]!==void 0&&Er[R][de]!==void 0?Ht=Er[R][de]:Ue.disableWarning===!1&&jo.warn("Unable to look up font label for font '"+R+"', '"+de+"'. Refer to getFontList() for available fonts."),Ht||Ue.noFallback||(Ht=Er.times[de])==null&&(Ht=Er.times.normal),Ht},ra=m.__private__.putInfo=function(){var R=Ye(),de=function(vt){return vt};for(var Ue in u!==null&&(de=Oe.encryptor(R,0)),ae("<<"),ae("/Producer ("+kr(de("jsPDF "+Ta.version))+")"),he)he.hasOwnProperty(Ue)&&he[Ue]&&ae("/"+Ue.substr(0,1).toUpperCase()+Ue.substr(1)+" ("+kr(de(he[Ue]))+")");ae("/CreationDate ("+kr(de(q))+")"),ae(">>"),ae("endobj")},Wn=m.__private__.putCatalog=function(R){var de=(R=R||{}).rootDictionaryObjId||ze;switch(Ye(),ae("<<"),ae("/Type /Catalog"),ae("/Pages "+de+" 0 R"),Lt||(Lt="fullwidth"),Lt){case"fullwidth":ae("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ae("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ae("/OpenAction [3 0 R /Fit]");break;case"original":ae("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ue=""+Lt;Ue.substr(Ue.length-1)==="%"&&(Lt=parseInt(Lt)/100),typeof Lt=="number"&&ae("/OpenAction [3 0 R /XYZ null null "+O(Lt)+"]")}switch(Gt||(Gt="continuous"),Gt){case"continuous":ae("/PageLayout /OneColumn");break;case"single":ae("/PageLayout /SinglePage");break;case"two":case"twoleft":ae("/PageLayout /TwoColumnLeft");break;case"tworight":ae("/PageLayout /TwoColumnRight")}ge&&ae("/PageMode /"+ge),Gr.publish("putCatalog"),ae(">>"),ae("endobj")},ln=m.__private__.putTrailer=function(){ae("trailer"),ae("<<"),ae("/Size "+(Y+1)),ae("/Root "+Y+" 0 R"),ae("/Info "+(Y-1)+" 0 R"),u!==null&&ae("/Encrypt "+Oe.oid+" 0 R"),ae("/ID [ <"+B+"> <"+B+"> ]"),ae(">>")},da=m.__private__.putHeader=function(){ae("%PDF-"+x),ae("%")},va=m.__private__.putXRef=function(){var R="0000000000";ae("xref"),ae("0 "+(Y+1)),ae("0000000000 65535 f ");for(var de=1;de<=Y;de++)typeof W[de]=="function"?ae((R+W[de]()).slice(-10)+" 00000 n "):W[de]!==void 0?ae((R+W[de]).slice(-10)+" 00000 n "):ae("0000000000 00000 n ")},oa=m.__private__.buildDocument=function(){var R;Y=0,pe=0,se=[],W=[],G=[],ze=lr(),xt=lr(),re(se),Gr.publish("buildDocument"),da(),ia(),function(){Gr.publish("putAdditionalObjects");for(var Ue=0;Ue<G.length;Ue++){var vt=G[Ue];ce(vt.objId,!0),ae(vt.content),ae("endobj")}Gr.publish("postPutAdditionalObjects")}(),R=[],function(){for(var Ue in Wt)Wt.hasOwnProperty(Ue)&&(f===!1||f===!0&&h.hasOwnProperty(Ue))&&Kn(Wt[Ue])}(),function(){var Ue;for(Ue in or)or.hasOwnProperty(Ue)&&cr(or[Ue])}(),function(){for(var Ue in pn)pn.hasOwnProperty(Ue)&&at(pn[Ue])}(),function(Ue){var vt;for(vt in lt)lt.hasOwnProperty(vt)&&(lt[vt]instanceof kh?Te(lt[vt]):lt[vt]instanceof Ag&&Fe(lt[vt],Ue))}(R),Gr.publish("putResources"),R.forEach(ht),ht({resourcesOid:xt,objectOid:Number.MAX_SAFE_INTEGER}),Gr.publish("postPutResources"),u!==null&&(Oe.oid=Ye(),ae("<<"),ae("/Filter /Standard"),ae("/V "+Oe.v),ae("/R "+Oe.r),ae("/U <"+Oe.toHexString(Oe.U)+">"),ae("/O <"+Oe.toHexString(Oe.O)+">"),ae("/P "+Oe.P),ae(">>"),ae("endobj")),ra(),Wn();var de=pe;return va(),ln(),ae("startxref"),ae(""+de),ae("%%EOF"),re(te[L]),se.join(`
`)},Tn=m.__private__.getBlob=function(R){return new Blob([pt(R)],{type:"application/pdf"})},ee=m.output=m.__private__.output=(At=function(R,de){switch(typeof(de=de||{})=="string"?de={filename:de}:de.filename=de.filename||"generated.pdf",R){case void 0:return oa();case"save":m.save(de.filename);break;case"arraybuffer":return pt(oa());case"blob":return Tn(oa());case"bloburi":case"bloburl":if(os.URL!==void 0&&typeof os.URL.createObjectURL=="function")return os.URL&&os.URL.createObjectURL(Tn(oa()))||void 0;jo.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ue="",vt=oa();try{Ue=J9(vt)}catch{Ue=J9(unescape(encodeURIComponent(vt)))}return"data:application/pdf;filename="+de.filename+";base64,"+Ue;case"pdfobjectnewwindow":if(Object.prototype.toString.call(os)==="[object Window]"){var Ht="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Ur=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';de.pdfObjectUrl&&(Ht=de.pdfObjectUrl,Ur="");var mn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ht+'"'+Ur+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(de)+");<\/script></body></html>",ne=os.open();return ne!==null&&ne.document.write(mn),ne}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(os)==="[object Window]"){var Ae='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(de.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+de.filename+'" width="500px" height="400px" /></body></html>',Ee=os.open();if(Ee!==null){Ee.document.write(Ae);var it=this;Ee.document.documentElement.querySelector("#pdfViewer").onload=function(){Ee.document.title=de.filename,Ee.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(it.output("bloburl"))}}return Ee}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(os)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Et='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",de)+'"></iframe></body></html>',gr=os.open();if(gr!==null&&(gr.document.write(Et),gr.document.title=de.filename),gr||typeof safari>"u")return gr;break;case"datauri":case"dataurl":return os.document.location.href=this.output("datauristring",de);default:return null}},At.foo=function(){try{return At.apply(this,arguments)}catch(Ue){var R=Ue.stack||"";~R.indexOf(" at ")&&(R=R.split(" at ")[1]);var de="Error in function "+R.split(`
`)[0].split("<")[0]+": "+Ue.message;if(!os.console)throw new Error(de);os.console.error(de,Ue),os.alert&&alert(de)}},At.foo.bar=At,At.foo),Ie=function(R){return Array.isArray(ha)===!0&&ha.indexOf(R)>-1};switch(n){case"pt":Vt=1;break;case"mm":Vt=72/25.4;break;case"cm":Vt=72/2.54;break;case"in":Vt=72;break;case"px":Vt=Ie("px_scaling")==1?.75:96/72;break;case"pc":case"em":Vt=12;break;case"ex":Vt=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);Vt=n}var Oe=null;be(),F();var Yt=m.__private__.getPageInfo=m.getPageInfo=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:zr[R].objId,pageNumber:R,pageContext:zr[R]}},Pt=m.__private__.getPageInfoByObjId=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var de in zr)if(zr[de].objId===R)break;return Yt(de)},Qt=m.__private__.getCurrentPageInfo=m.getCurrentPageInfo=function(){return{objId:zr[L].objId,pageNumber:L,pageContext:zr[L]}};m.addPage=function(){return er.apply(this,arguments),this},m.setPage=function(){return Cr.apply(this,arguments),re.call(this,te[L]),this},m.insertPage=function(R){return this.addPage(),this.movePage(L,R),this},m.movePage=function(R,de){var Ue,vt;if(R>de){Ue=te[R],vt=zr[R];for(var Ht=R;Ht>de;Ht--)te[Ht]=te[Ht-1],zr[Ht]=zr[Ht-1];te[de]=Ue,zr[de]=vt,this.setPage(de)}else if(R<de){Ue=te[R],vt=zr[R];for(var Ur=R;Ur<de;Ur++)te[Ur]=te[Ur+1],zr[Ur]=zr[Ur+1];te[de]=Ue,zr[de]=vt,this.setPage(de)}return this},m.deletePage=function(){return Nt.apply(this,arguments),this},m.__private__.text=m.text=function(R,de,Ue,vt,Ht){var Ur,mn,ne,Ae,Ee,it,Et,gr,sr,Ir=(vt=vt||{}).scope||this;if(typeof R=="number"&&typeof de=="number"&&(typeof Ue=="string"||Array.isArray(Ue))){var yr=Ue;Ue=de,de=R,R=yr}if(arguments[3]instanceof ke==0?(ne=arguments[4],Ae=arguments[5],Ms(Et=arguments[3])==="object"&&Et!==null||(typeof ne=="string"&&(Ae=ne,ne=null),typeof Et=="string"&&(Ae=Et,Et=null),typeof Et=="number"&&(ne=Et,Et=null),vt={flags:Et,angle:ne,align:Ae})):(A("The transform parameter of text() with a Matrix value"),sr=Ht),isNaN(de)||isNaN(Ue)||R==null)throw new Error("Invalid arguments passed to jsPDF.text");if(R.length===0)return Ir;var Ut,_n="",Qr=typeof vt.lineHeightFactor=="number"?vt.lineHeightFactor:sn,Ar=Ir.internal.scaleFactor;function Fn(Ea){return Ea=Ea.split("	").join(Array(vt.TabLen||9).join(" ")),kr(Ea,Et)}function fr(Ea){for(var is,Ns=Ea.concat(),ss=[],ro=Ns.length;ro--;)typeof(is=Ns.shift())=="string"?ss.push(is):Array.isArray(Ea)&&(is.length===1||is[1]===void 0&&is[2]===void 0)?ss.push(is[0]):ss.push([is[0],is[1],is[2]]);return ss}function Yr(Ea,is){var Ns;if(typeof Ea=="string")Ns=is(Ea)[0];else if(Array.isArray(Ea)){for(var ss,ro,xl=Ea.concat(),D=[],X=xl.length;X--;)typeof(ss=xl.shift())=="string"?D.push(is(ss)[0]):Array.isArray(ss)&&typeof ss[0]=="string"&&(ro=is(ss[0],ss[1],ss[2]),D.push([ro[0],ro[1],ro[2]]));Ns=D}return Ns}var $r=!1,Dr=!0;if(typeof R=="string")$r=!0;else if(Array.isArray(R)){var dn=R.concat();mn=[];for(var Nn,ua=dn.length;ua--;)(typeof(Nn=dn.shift())!="string"||Array.isArray(Nn)&&typeof Nn[0]!="string")&&(Dr=!1);$r=Dr}if($r===!1)throw new Error('Type of text must be string or Array. "'+R+'" is not recognized.');typeof R=="string"&&(R=R.match(/[\r?\n]/)?R.split(/\r\n|\r|\n/g):[R]);var ds=bt/Ir.internal.scaleFactor,Xs=ds*(Qr-1);switch(vt.baseline){case"bottom":Ue-=Xs;break;case"top":Ue+=ds-Xs;break;case"hanging":Ue+=ds-2*Xs;break;case"middle":Ue+=ds/2-Xs}if((it=vt.maxWidth||0)>0&&(typeof R=="string"?R=Ir.splitTextToSize(R,it):Object.prototype.toString.call(R)==="[object Array]"&&(R=R.reduce(function(Ea,is){return Ea.concat(Ir.splitTextToSize(is,it))},[]))),Ur={text:R,x:de,y:Ue,options:vt,mutex:{pdfEscape:kr,activeFontKey:ot,fonts:Wt,activeFontSize:bt}},Gr.publish("preProcessText",Ur),R=Ur.text,ne=(vt=Ur.options).angle,sr instanceof ke==0&&ne&&typeof ne=="number"){ne*=Math.PI/180,vt.rotationDirection===0&&(ne=-ne),j===w&&(ne=-ne);var vn=Math.cos(ne),Or=Math.sin(ne);sr=new ke(vn,Or,-Or,vn,0,0)}else ne&&ne instanceof ke&&(sr=ne);j!==w||sr||(sr=Ze),(Ee=vt.charSpace||Si)!==void 0&&(_n+=S(T(Ee))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(gr=vt.horizontalScale)!==void 0&&(_n+=S(100*gr)+` Tz
`),vt.lang;var rn=-1,gn=vt.renderingMode!==void 0?vt.renderingMode:vt.stroke,Vn=Ir.internal.getCurrentPageInfo().pageContext;switch(gn){case 0:case!1:case"fill":rn=0;break;case 1:case!0:case"stroke":rn=1;break;case 2:case"fillThenStroke":rn=2;break;case 3:case"invisible":rn=3;break;case 4:case"fillAndAddForClipping":rn=4;break;case 5:case"strokeAndAddPathForClipping":rn=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":rn=6;break;case 7:case"addToPathForClipping":rn=7}var On=Vn.usedRenderingMode!==void 0?Vn.usedRenderingMode:-1;rn!==-1?_n+=rn+` Tr
`:On!==-1&&(_n+=`0 Tr
`),rn!==-1&&(Vn.usedRenderingMode=rn),Ae=vt.align||"left";var mr,Zr=bt*Qr,_r=Ir.internal.pageSize.getWidth(),Br=Wt[ot];Ee=vt.charSpace||Si,it=vt.maxWidth||0,Et=Object.assign({autoencode:!0,noBOM:!0},vt.flags);var qr=[],Rr=function(Ea){return Ir.getStringUnitWidth(Ea,{font:Br,charSpace:Ee,fontSize:bt,doKerning:!1})*bt/Ar};if(Object.prototype.toString.call(R)==="[object Array]"){var Vr;mn=fr(R),Ae!=="left"&&(mr=mn.map(Rr));var kn,le=0;if(Ae==="right"){de-=mr[0],R=[],ua=mn.length;for(var we=0;we<ua;we++)we===0?(kn=Na(de),Vr=Hn(Ue)):(kn=T(le-mr[we]),Vr=-Zr),R.push([mn[we],kn,Vr]),le=mr[we]}else if(Ae==="center"){de-=mr[0]/2,R=[],ua=mn.length;for(var et=0;et<ua;et++)et===0?(kn=Na(de),Vr=Hn(Ue)):(kn=T((le-mr[et])/2),Vr=-Zr),R.push([mn[et],kn,Vr]),le=mr[et]}else if(Ae==="left"){R=[],ua=mn.length;for(var _e=0;_e<ua;_e++)R.push(mn[_e])}else if(Ae==="justify"&&Br.encoding==="Identity-H"){R=[],ua=mn.length,it=it!==0?it:_r;for(var St=0,tt=0;tt<ua;tt++)if(Vr=tt===0?Hn(Ue):-Zr,kn=tt===0?Na(de):St,tt<ua-1){var Ne=T((it-mr[tt])/(mn[tt].split(" ").length-1)),Mt=mn[tt].split(" ");R.push([Mt[0]+" ",kn,Vr]),St=0;for(var Qe=1;Qe<Mt.length;Qe++){var ar=(Rr(Mt[Qe-1]+" "+Mt[Qe])-Rr(Mt[Qe]))*Ar+Ne;Qe==Mt.length-1?R.push([Mt[Qe],ar,0]):R.push([Mt[Qe]+" ",ar,0]),St-=ar}}else R.push([mn[tt],kn,Vr]);R.push(["",St,0])}else{if(Ae!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(R=[],ua=mn.length,it=it!==0?it:_r,tt=0;tt<ua;tt++){Vr=tt===0?Hn(Ue):-Zr,kn=tt===0?Na(de):0;var Sn=mn[tt].split(" ").length-1,wn=Sn>0?(it-mr[tt])/Sn:0;tt<ua-1?qr.push(S(T(wn))):qr.push(0),R.push([mn[tt],kn,Vr])}}}(typeof vt.R2L=="boolean"?vt.R2L:Bt)===!0&&(R=Yr(R,function(Ea,is,Ns){return[Ea.split("").reverse().join(""),is,Ns]})),Ur={text:R,x:de,y:Ue,options:vt,mutex:{pdfEscape:kr,activeFontKey:ot,fonts:Wt,activeFontSize:bt}},Gr.publish("postProcessText",Ur),R=Ur.text,Ut=Ur.mutex.isHex||!1;var $n=Wt[ot].encoding;$n!=="WinAnsiEncoding"&&$n!=="StandardEncoding"||(R=Yr(R,function(Ea,is,Ns){return[Fn(Ea),is,Ns]})),mn=fr(R),R=[];for(var En,pa,rs,Ys=Array.isArray(mn[0])?1:0,ea="",na=function(Ea,is,Ns){var ss="";return Ns instanceof ke?(Ns=typeof vt.angle=="number"?We(Ns,new ke(1,0,0,1,Ea,is)):We(new ke(1,0,0,1,Ea,is),Ns),j===w&&(Ns=We(new ke(1,0,0,-1,0,0),Ns)),ss=Ns.join(" ")+` Tm
`):ss=S(Ea)+" "+S(is)+` Td
`,ss},ya=0;ya<mn.length;ya++){switch(ea="",Ys){case 1:rs=(Ut?"<":"(")+mn[ya][0]+(Ut?">":")"),En=parseFloat(mn[ya][1]),pa=parseFloat(mn[ya][2]);break;case 0:rs=(Ut?"<":"(")+mn[ya]+(Ut?">":")"),En=Na(de),pa=Hn(Ue)}qr!==void 0&&qr[ya]!==void 0&&(ea=qr[ya]+` Tw
`),ya===0?R.push(ea+na(En,pa,sr)+rs):Ys===0?R.push(ea+rs):Ys===1&&R.push(ea+na(En,pa,sr)+rs)}R=Ys===0?R.join(` Tj
T* `):R.join(` Tj
`),R+=` Tj
`;var Wa=`BT
/`;return Wa+=ot+" "+bt+` Tf
`,Wa+=S(bt*Qr)+` TL
`,Wa+=ai+`
`,Wa+=_n,Wa+=R,ae(Wa+="ET"),h[ot]=!0,Ir};var nr=m.__private__.clip=m.clip=function(R){return ae(R==="evenodd"?"W*":"W"),this};m.clipEvenOdd=function(){return nr("evenodd")},m.__private__.discardPath=m.discardPath=function(){return ae("n"),this};var fn=m.__private__.isValidStyle=function(R){var de=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(R)!==-1&&(de=!0),de};m.__private__.setDefaultPathOperation=m.setDefaultPathOperation=function(R){return fn(R)&&(d=R),this};var J=m.__private__.getStyle=m.getStyle=function(R){var de=d;switch(R){case"D":case"S":de="S";break;case"F":de="f";break;case"FD":case"DF":de="B";break;case"f":case"f*":case"B":case"B*":de=R}return de},Xe=m.close=function(){return ae("h"),this};m.stroke=function(){return ae("S"),this},m.fill=function(R){return He("f",R),this},m.fillEvenOdd=function(R){return He("f*",R),this},m.fillStroke=function(R){return He("B",R),this},m.fillStrokeEvenOdd=function(R){return He("B*",R),this};var He=function(R,de){Ms(de)==="object"?xe(de,R):ae(R)},fe=function(R){R===null||j===w&&R===void 0||(R=J(R),ae(R))};function Ve(R,de,Ue,vt,Ht){var Ur=new Ag(de||this.boundingBox,Ue||this.xStep,vt||this.yStep,this.gState,Ht||this.matrix);Ur.stream=this.stream;var mn=R+"$$"+this.cloneIndex+++"$$";return Je(mn,Ur),Ur}var xe=function(R,de){var Ue=gt[R.key],vt=lt[Ue];if(vt instanceof kh)ae("q"),ae(kt(de)),vt.gState&&m.setGState(vt.gState),ae(R.matrix.toString()+" cm"),ae("/"+Ue+" sh"),ae("Q");else if(vt instanceof Ag){var Ht=new ke(1,0,0,-1,0,Ji());R.matrix&&(Ht=Ht.multiply(R.matrix||Ze),Ue=Ve.call(vt,R.key,R.boundingBox,R.xStep,R.yStep,Ht).id),ae("q"),ae("/Pattern cs"),ae("/"+Ue+" scn"),vt.gState&&m.setGState(vt.gState),ae(de),ae("Q")}},kt=function(R){switch(R){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},st=m.moveTo=function(R,de){return ae(S(T(R))+" "+S(k(de))+" m"),this},zt=m.lineTo=function(R,de){return ae(S(T(R))+" "+S(k(de))+" l"),this},pr=m.curveTo=function(R,de,Ue,vt,Ht,Ur){return ae([S(T(R)),S(k(de)),S(T(Ue)),S(k(vt)),S(T(Ht)),S(k(Ur)),"c"].join(" ")),this};m.__private__.line=m.line=function(R,de,Ue,vt,Ht){if(isNaN(R)||isNaN(de)||isNaN(Ue)||isNaN(vt)||!fn(Ht))throw new Error("Invalid arguments passed to jsPDF.line");return j===b?this.lines([[Ue-R,vt-de]],R,de,[1,1],Ht||"S"):this.lines([[Ue-R,vt-de]],R,de,[1,1]).stroke()},m.__private__.lines=m.lines=function(R,de,Ue,vt,Ht,Ur){var mn,ne,Ae,Ee,it,Et,gr,sr,Ir,yr,Ut,_n;if(typeof R=="number"&&(_n=Ue,Ue=de,de=R,R=_n),vt=vt||[1,1],Ur=Ur||!1,isNaN(de)||isNaN(Ue)||!Array.isArray(R)||!Array.isArray(vt)||!fn(Ht)||typeof Ur!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(st(de,Ue),mn=vt[0],ne=vt[1],Ee=R.length,yr=de,Ut=Ue,Ae=0;Ae<Ee;Ae++)(it=R[Ae]).length===2?(yr=it[0]*mn+yr,Ut=it[1]*ne+Ut,zt(yr,Ut)):(Et=it[0]*mn+yr,gr=it[1]*ne+Ut,sr=it[2]*mn+yr,Ir=it[3]*ne+Ut,yr=it[4]*mn+yr,Ut=it[5]*ne+Ut,pr(Et,gr,sr,Ir,yr,Ut));return Ur&&Xe(),fe(Ht),this},m.path=function(R){for(var de=0;de<R.length;de++){var Ue=R[de],vt=Ue.c;switch(Ue.op){case"m":st(vt[0],vt[1]);break;case"l":zt(vt[0],vt[1]);break;case"c":pr.apply(this,vt);break;case"h":Xe()}}return this},m.__private__.rect=m.rect=function(R,de,Ue,vt,Ht){if(isNaN(R)||isNaN(de)||isNaN(Ue)||isNaN(vt)||!fn(Ht))throw new Error("Invalid arguments passed to jsPDF.rect");return j===b&&(vt=-vt),ae([S(T(R)),S(k(de)),S(T(Ue)),S(T(vt)),"re"].join(" ")),fe(Ht),this},m.__private__.triangle=m.triangle=function(R,de,Ue,vt,Ht,Ur,mn){if(isNaN(R)||isNaN(de)||isNaN(Ue)||isNaN(vt)||isNaN(Ht)||isNaN(Ur)||!fn(mn))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ue-R,vt-de],[Ht-Ue,Ur-vt],[R-Ht,de-Ur]],R,de,[1,1],mn,!0),this},m.__private__.roundedRect=m.roundedRect=function(R,de,Ue,vt,Ht,Ur,mn){if(isNaN(R)||isNaN(de)||isNaN(Ue)||isNaN(vt)||isNaN(Ht)||isNaN(Ur)||!fn(mn))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ne=4/3*(Math.SQRT2-1);return Ht=Math.min(Ht,.5*Ue),Ur=Math.min(Ur,.5*vt),this.lines([[Ue-2*Ht,0],[Ht*ne,0,Ht,Ur-Ur*ne,Ht,Ur],[0,vt-2*Ur],[0,Ur*ne,-Ht*ne,Ur,-Ht,Ur],[2*Ht-Ue,0],[-Ht*ne,0,-Ht,-Ur*ne,-Ht,-Ur],[0,2*Ur-vt],[0,-Ur*ne,Ht*ne,-Ur,Ht,-Ur]],R+Ht,de,[1,1],mn,!0),this},m.__private__.ellipse=m.ellipse=function(R,de,Ue,vt,Ht){if(isNaN(R)||isNaN(de)||isNaN(Ue)||isNaN(vt)||!fn(Ht))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Ur=4/3*(Math.SQRT2-1)*Ue,mn=4/3*(Math.SQRT2-1)*vt;return st(R+Ue,de),pr(R+Ue,de-mn,R+Ur,de-vt,R,de-vt),pr(R-Ur,de-vt,R-Ue,de-mn,R-Ue,de),pr(R-Ue,de+mn,R-Ur,de+vt,R,de+vt),pr(R+Ur,de+vt,R+Ue,de+mn,R+Ue,de),fe(Ht),this},m.__private__.circle=m.circle=function(R,de,Ue,vt){if(isNaN(R)||isNaN(de)||isNaN(Ue)||!fn(vt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(R,de,Ue,Ue,vt)},m.setFont=function(R,de,Ue){return Ue&&(de=E(de,Ue)),ot=un(R,de,{disableWarning:!1}),this};var en=m.__private__.getFont=m.getFont=function(){return Wt[un.apply(m,arguments)]};m.__private__.getFontList=m.getFontList=function(){var R,de,Ue={};for(R in Er)if(Er.hasOwnProperty(R))for(de in Ue[R]=[],Er[R])Er[R].hasOwnProperty(de)&&Ue[R].push(de);return Ue},m.addFont=function(R,de,Ue,vt,Ht){var Ur=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Ur.indexOf(arguments[3])!==-1?Ht=arguments[3]:arguments[3]&&Ur.indexOf(arguments[3])==-1&&(Ue=E(Ue,vt)),Ft.call(this,R,de,Ue,Ht=Ht||"Identity-H")};var sn,la=e.lineWidth||.200025,Nr=m.__private__.getLineWidth=m.getLineWidth=function(){return la},xn=m.__private__.setLineWidth=m.setLineWidth=function(R){return la=R,ae(S(T(R))+" w"),this};m.__private__.setLineDash=Ta.API.setLineDash=Ta.API.setLineDashPattern=function(R,de){if(R=R||[],de=de||0,isNaN(de)||!Array.isArray(R))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return R=R.map(function(Ue){return S(T(Ue))}).join(" "),de=S(T(de)),ae("["+R+"] "+de+" d"),this};var Dn=m.__private__.getLineHeight=m.getLineHeight=function(){return bt*sn};m.__private__.getLineHeight=m.getLineHeight=function(){return bt*sn};var Pa=m.__private__.setLineHeightFactor=m.setLineHeightFactor=function(R){return typeof(R=R||1.15)=="number"&&(sn=R),this},Aa=m.__private__.getLineHeightFactor=m.getLineHeightFactor=function(){return sn};Pa(e.lineHeight);var Na=m.__private__.getHorizontalCoordinate=function(R){return T(R)},Hn=m.__private__.getVerticalCoordinate=function(R){return j===w?R:zr[L].mediaBox.topRightY-zr[L].mediaBox.bottomLeftY-T(R)},as=m.__private__.getHorizontalCoordinateString=m.getHorizontalCoordinateString=function(R){return S(Na(R))},to=m.__private__.getVerticalCoordinateString=m.getVerticalCoordinateString=function(R){return S(Hn(R))},As=e.strokeColor||"0 G";m.__private__.getStrokeColor=m.getDrawColor=function(){return rr(As)},m.__private__.setStrokeColor=m.setDrawColor=function(R,de,Ue,vt){return As=ir({ch1:R,ch2:de,ch3:Ue,ch4:vt,pdfColorType:"draw",precision:2}),ae(As),this};var Vs=e.fillColor||"0 g";m.__private__.getFillColor=m.getFillColor=function(){return rr(Vs)},m.__private__.setFillColor=m.setFillColor=function(R,de,Ue,vt){return Vs=ir({ch1:R,ch2:de,ch3:Ue,ch4:vt,pdfColorType:"fill",precision:2}),ae(Vs),this};var ai=e.textColor||"0 g",Ni=m.__private__.getTextColor=m.getTextColor=function(){return rr(ai)};m.__private__.setTextColor=m.setTextColor=function(R,de,Ue,vt){return ai=ir({ch1:R,ch2:de,ch3:Ue,ch4:vt,pdfColorType:"text",precision:3}),this};var Si=e.charSpace,Sc=m.__private__.getCharSpace=m.getCharSpace=function(){return parseFloat(Si||0)};m.__private__.setCharSpace=m.setCharSpace=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Si=R,this};var Qc=0;m.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},m.__private__.setLineCap=m.setLineCap=function(R){var de=m.CapJoinStyles[R];if(de===void 0)throw new Error("Line cap style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Qc=de,ae(de+" J"),this};var Cc=0;m.__private__.setLineJoin=m.setLineJoin=function(R){var de=m.CapJoinStyles[R];if(de===void 0)throw new Error("Line join style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Cc=de,ae(de+" j"),this},m.__private__.setLineMiterLimit=m.__private__.setMiterLimit=m.setLineMiterLimit=m.setMiterLimit=function(R){if(R=R||0,isNaN(R))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ae(S(T(R))+" M"),this},m.GState=F1,m.setGState=function(R){(R=typeof R=="string"?or[br[R]]:Yi(null,R)).equals(ur)||(ae("/"+R.id+" gs"),ur=R)};var Yi=function(R,de){if(!R||!br[R]){var Ue=!1;for(var vt in or)if(or.hasOwnProperty(vt)&&or[vt].equals(de)){Ue=!0;break}if(Ue)de=or[vt];else{var Ht="GS"+(Object.keys(or).length+1).toString(10);or[Ht]=de,de.id=Ht}return R&&(br[R]=de.id),Gr.publish("addGState",de),de}};m.addGState=function(R,de){return Yi(R,de),this},m.saveGraphicsState=function(){return ae("q"),Me.push({key:ot,size:bt,color:ai}),this},m.restoreGraphicsState=function(){ae("Q");var R=Me.pop();return ot=R.key,bt=R.size,ai=R.color,ur=null,this},m.setCurrentTransformationMatrix=function(R){return ae(R.toString()+" cm"),this},m.comment=function(R){return ae("#"+R),this};var si=function(R,de){var Ue=R||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ue},set:function(Ur){isNaN(Ur)||(Ue=parseFloat(Ur))}});var vt=de||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return vt},set:function(Ur){isNaN(Ur)||(vt=parseFloat(Ur))}});var Ht="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ht},set:function(Ur){Ht=Ur.toString()}}),this},zo=function(R,de,Ue,vt){si.call(this,R,de),this.type="rect";var Ht=Ue||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ht},set:function(mn){isNaN(mn)||(Ht=parseFloat(mn))}});var Ur=vt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Ur},set:function(mn){isNaN(mn)||(Ur=parseFloat(mn))}}),this},Uo=function(){this.page=an,this.currentPage=L,this.pages=te.slice(0),this.pagesContext=zr.slice(0),this.x=qt,this.y=Re,this.matrix=Ct,this.width=qd(L),this.height=pi(L),this.outputDestination=De,this.id="",this.objectNumber=-1};Uo.prototype.restore=function(){an=this.page,L=this.currentPage,zr=this.pagesContext,te=this.pages,qt=this.x,Re=this.y,Ct=this.matrix,Os(L,this.width),_s(L,this.height),De=this.outputDestination};var Ac=function(R,de,Ue,vt,Ht){cn.push(new Uo),an=L=0,te=[],qt=R,Re=de,Ct=Ht,jt([Ue,vt])};for(var gl in m.beginFormObject=function(R,de,Ue,vt,Ht){return Ac(R,de,Ue,vt,Ht),this},m.endFormObject=function(R){return function(de){if(on[de])cn.pop().restore();else{var Ue=new Uo,vt="Xo"+(Object.keys(pn).length+1).toString(10);Ue.id=vt,on[de]=vt,pn[vt]=Ue,Gr.publish("addFormObject",Ue),cn.pop().restore()}}(R),this},m.doFormObject=function(R,de){var Ue=pn[on[R]];return ae("q"),ae(de.toString()+" cm"),ae("/"+Ue.id+" Do"),ae("Q"),this},m.getFormObject=function(R){var de=pn[on[R]];return{x:de.x,y:de.y,width:de.width,height:de.height,matrix:de.matrix}},m.save=function(R,de){return R=R||"generated.pdf",(de=de||{}).returnPromise=de.returnPromise||!1,de.returnPromise===!1?(og(Tn(oa()),R),typeof og.unload=="function"&&os.setTimeout&&setTimeout(og.unload,911),this):new Promise(function(Ue,vt){try{var Ht=og(Tn(oa()),R);typeof og.unload=="function"&&os.setTimeout&&setTimeout(og.unload,911),Ue(Ht)}catch(Ur){vt(Ur.message)}})},Ta.API)Ta.API.hasOwnProperty(gl)&&(gl==="events"&&Ta.API.events.length?function(R,de){var Ue,vt,Ht;for(Ht=de.length-1;Ht!==-1;Ht--)Ue=de[Ht][0],vt=de[Ht][1],R.subscribe.apply(R,[Ue].concat(typeof vt=="function"?[vt]:vt))}(Gr,Ta.API.events):m[gl]=Ta.API[gl]);function qd(R){return zr[R].mediaBox.topRightX-zr[R].mediaBox.bottomLeftX}function Os(R,de){zr[R].mediaBox.topRightX=de+zr[R].mediaBox.bottomLeftX}function pi(R){return zr[R].mediaBox.topRightY-zr[R].mediaBox.bottomLeftY}function _s(R,de){zr[R].mediaBox.topRightY=de+zr[R].mediaBox.bottomLeftY}var Au=m.getPageWidth=function(R){return qd(R=R||L)/Vt},Zc=m.setPageWidth=function(R,de){Os(R,de*Vt)},Ji=m.getPageHeight=function(R){return pi(R=R||L)/Vt},Ol=m.setPageHeight=function(R,de){_s(R,de*Vt)};return m.internal={pdfEscape:kr,getStyle:J,getFont:en,getFontSize:Dt,getCharSpace:Sc,getTextColor:Ni,getLineHeight:Dn,getLineHeightFactor:Aa,getLineWidth:Nr,write:ut,getHorizontalCoordinate:Na,getVerticalCoordinate:Hn,getCoordinateString:as,getVerticalCoordinateString:to,collections:{},newObject:Ye,newAdditionalObject:qe,newObjectDeferred:lr,newObjectDeferredBegin:ce,getFilters:Kr,putStream:jr,events:Gr,scaleFactor:Vt,pageSize:{getWidth:function(){return Au(L)},setWidth:function(R){Zc(L,R)},getHeight:function(){return Ji(L)},setHeight:function(R){Ol(L,R)}},encryptionOptions:u,encryption:Oe,getEncryptor:function(R){return u!==null?Oe.encryptor(R,0):function(de){return de}},output:ee,getNumberOfPages:Lr,pages:te,out:ae,f2:O,f3:I,getPageInfo:Yt,getPageInfoByObjId:Pt,getCurrentPageInfo:Qt,getPDFVersion:g,Point:si,Rectangle:zo,Matrix:ke,hasHotfix:Ie},Object.defineProperty(m.internal.pageSize,"width",{get:function(){return Au(L)},set:function(R){Zc(L,R)},enumerable:!0,configurable:!0}),Object.defineProperty(m.internal.pageSize,"height",{get:function(){return Ji(L)},set:function(R){Ol(L,R)},enumerable:!0,configurable:!0}),function(R){for(var de=0,Ue=ft.length;de<Ue;de++){var vt=Ft.call(this,R[de][0],R[de][1],R[de][2],ft[de][3],!0);f===!1&&(h[vt]=!0);var Ht=R[de][0].split("-");Xr({id:vt,fontName:Ht[0],fontStyle:Ht[1]||""})}Gr.publish("addFonts",{fonts:Wt,dictionary:Er})}.call(m,ft),ot="F1",er(s,r),Gr.publish("initialized"),m}cv.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},cv.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},cv.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},cv.prototype.processOwnerPassword=function(e,t){return P3(A3(t).substr(0,5),e)},cv.prototype.encryptor=function(e,t){var r=A3(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return P3(r,n)}},F1.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||Ms(e)!==Ms(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return n===0},Ta.API={events:[]},Ta.version="3.0.3";var di=Ta.API,UR=1,Ax=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Jx=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},ms=function(e){return e.toFixed(2)},dh=function(e){return e.toFixed(5)};di.__acroform__={};var Jc=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},tU=function(e){return e*UR},jf=function(e){var t=new Dae,r=Ca.internal.getHeight(e)||0,n=Ca.internal.getWidth(e)||0;return t.BBox=[0,0,Number(ms(n)),Number(ms(r))],t},UQe=di.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},VQe=di.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},WQe=di.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},yi=di.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return WQe(e,t-1)},bi=di.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return UQe(e,t-1)},wi=di.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return VQe(e,t-1)},HQe=di.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,s=e[0],o=e[1],i=e[2],l=e[3],c={};return c.lowerLeft_X=r(s)||0,c.lowerLeft_Y=n(o+l)||0,c.upperRight_X=r(s+i)||0,c.upperRight_Y=n(o)||0,[Number(ms(c.lowerLeft_X)),Number(ms(c.lowerLeft_Y)),Number(ms(c.upperRight_X)),Number(ms(c.upperRight_Y))]},GQe=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=E3(e,r),s=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+s+" "+ms(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var o=jf(e);return o.scope=e.scope,o.stream=t.join(`
`),o}},E3=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},s=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");s=e.multiline?s.map(function(O){return O.split(`
`)}):s.map(function(O){return[O]});var o=r,i=Ca.internal.getHeight(e)||0;i=i<0?-i:i;var l=Ca.internal.getWidth(e)||0;l=l<0?-l:l;var c=function(O,I,T){if(O+1<s.length){var k=I+" "+s[O+1][0];return Q_(k,e,T).width<=l-4}return!1};o++;e:for(;o>0;){t="",o--;var d,u,f=Q_("3",e,o).height,h=e.multiline?i-o:(i-f)/2,m=h+=2,x=0,g=0,v=0;if(o<=0){t=`(...) Tj
`,t+="% Width of Text: "+Q_(t,e,o=12).width+", FieldWidth:"+l+`
`;break}for(var y="",b=0,w=0;w<s.length;w++)if(s.hasOwnProperty(w)){var j=!1;if(s[w].length!==1&&v!==s[w].length-1){if((f+2)*(b+2)+2>i)continue e;y+=s[w][v],j=!0,g=w,w--}else{y=(y+=s[w][v]+" ").substr(y.length-1)==" "?y.substr(0,y.length-1):y;var _=parseInt(w),C=c(_,y,o),E=w>=s.length-1;if(C&&!E){y+=" ",v=0;continue}if(C||E){if(E)g=_;else if(e.multiline&&(f+2)*(b+2)+2>i)continue e}else{if(!e.multiline||(f+2)*(b+2)+2>i)continue e;g=_}}for(var S="",A=x;A<=g;A++){var M=s[A];if(e.multiline){if(A===g){S+=M[v]+" ",v=(v+1)%M.length;continue}if(A===x){S+=M[M.length-1]+" ";continue}}S+=M[0]+" "}switch(S=S.substr(S.length-1)==" "?S.substr(0,S.length-1):S,u=Q_(S,e,o).width,e.textAlign){case"right":d=l-u-2;break;case"center":d=(l-u)/2;break;default:d=2}t+=ms(d)+" "+ms(m)+` Td
`,t+="("+Ax(S)+`) Tj
`,t+=-ms(d)+` 0 Td
`,m=-(o+2),u=0,x=j?g:g+1,b++,y=""}break}return n.text=t,n.fontSize=o,n},Q_=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),s=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:s}},KQe={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},XQe=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},YQe=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(hf.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(KQe)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");UR=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new Mae,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var s in n)if(n.hasOwnProperty(s)){var o=n[s];o.objId=void 0,o.hasAnnotation&&XQe(o,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(n,s){var o=!n;for(var i in n||(s.internal.newObjectDeferredBegin(s.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),s.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||s.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(i)){var l=n[i],c=[],d=l.Rect;if(l.Rect&&(l.Rect=HQe(l.Rect,s)),s.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Ca.createDefaultAppearanceStream(l),Ms(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=d,l.hasAppearanceStream&&!l.appearanceStreamContent){var u=GQe(l);c.push({key:"AP",value:"<</N "+u+">>"}),s.internal.acroformPlugin.xForms.push(u)}if(l.appearanceStreamContent){var f="";for(var h in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(h)){var m=l.appearanceStreamContent[h];if(f+="/"+h+" ",f+="<<",Object.keys(m).length>=1||Array.isArray(m)){for(var i in m)if(m.hasOwnProperty(i)){var x=m[i];typeof x=="function"&&(x=x.call(s,l)),f+="/"+i+" "+x+" ",s.internal.acroformPlugin.xForms.indexOf(x)>=0||s.internal.acroformPlugin.xForms.push(x)}}else typeof(x=m)=="function"&&(x=x.call(s,l)),f+="/"+i+" "+x,s.internal.acroformPlugin.xForms.indexOf(x)>=0||s.internal.acroformPlugin.xForms.push(x);f+=">>"}c.push({key:"AP",value:`<<
`+f+">>"})}s.internal.putStream({additionalKeyValues:c,objectId:l.objId}),s.internal.out("endobj")}o&&function(g,v){for(var y in g)if(g.hasOwnProperty(y)){var b=y,w=g[y];v.internal.newObjectDeferredBegin(w.objId,!0),Ms(w)==="object"&&typeof w.putStream=="function"&&w.putStream(),delete g[b]}}(s.internal.acroformPlugin.xForms,s)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},Tae=di.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(i){return i};if(Array.isArray(e)){for(var s="[",o=0;o<e.length;o++)switch(o!==0&&(s+=" "),Ms(e[o])){case"boolean":case"number":case"object":s+=e[o].toString();break;case"string":e[o].substr(0,1)!=="/"?(t!==void 0&&r&&(n=r.internal.getEncryptor(t)),s+="("+Ax(n(e[o].toString()))+")"):s+=e[o].toString()}return s+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},pk=function(e,t,r){var n=function(s){return s};return t!==void 0&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),"("+Ax(n(e))+")"},Ff=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Ff.prototype.toString=function(){return this.objId+" 0 R"},Ff.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},Ff.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var n=t[r],s=this[n];s&&(Array.isArray(s)?e.push({key:n,value:Tae(s,this.objId,this.scope)}):s instanceof Ff?(s.scope=this.scope,e.push({key:n,value:s.objId+" 0 R"})):typeof s!="function"&&e.push({key:n,value:s}))}return e};var Dae=function(){Ff.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};Jc(Dae,Ff);var Mae=function(){Ff.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+Ax(r(e))+")"}},set:function(r){e=r}})};Jc(Mae,Ff);var hf=function e(){Ff.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute F supplied.');t=y}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!yi(t,3)},set:function(y){y?this.F=bi(t,3):this.F=wi(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute Ff supplied.');r=y}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(y){n=y!==void 0?y:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(y){n[0]=y}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(y){n[1]=y}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(y){n[2]=y}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(y){n[3]=y}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(y){switch(y){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=y;break;default:throw new Error('Invalid value "'+y+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof sC)return;o="FieldObject"+e.FieldNum++}var y=function(b){return b};return this.scope&&(y=this.scope.internal.getEncryptor(this.objId)),"("+Ax(y(o))+")"},set:function(y){o=y.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(y){o=y}});var i="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return i},set:function(y){i=y}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(y){l=y}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(y){c=y}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/UR:d},set:function(y){d=y}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(y){u=y}});var f="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!f||this instanceof sC||this instanceof ip))return pk(f,this.objId,this.scope)},set:function(y){y=y.toString(),f=y}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof Vi==0?pk(h,this.objId,this.scope):h},set:function(y){y=y.toString(),h=this instanceof Vi==0?y.substr(0,1)==="("?Jx(y.substr(1,y.length-2)):Jx(y):y}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Vi==1?Jx(h.substr(1,h.length-1)):h},set:function(y){y=y.toString(),h=this instanceof Vi==1?"/"+y:y}});var m=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(m)return m},set:function(y){this.V=y}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof Vi==0?pk(m,this.objId,this.scope):m},set:function(y){y=y.toString(),m=this instanceof Vi==0?y.substr(0,1)==="("?Jx(y.substr(1,y.length-2)):Jx(y):y}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Vi==1?Jx(m.substr(1,m.length-1)):m},set:function(y){y=y.toString(),m=this instanceof Vi==1?"/"+y:y}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var x,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(y){y=!!y,g=y}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(x)return x},set:function(y){x=y}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,1)},set:function(y){y?this.Ff=bi(this.Ff,1):this.Ff=wi(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,2)},set:function(y){y?this.Ff=bi(this.Ff,2):this.Ff=wi(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,3)},set:function(y){y?this.Ff=bi(this.Ff,3):this.Ff=wi(this.Ff,3)}});var v=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(v!==null)return v},set:function(y){if([0,1,2].indexOf(y)===-1)throw new Error('Invalid value "'+y+'" for attribute Q supplied.');v=y}}),Object.defineProperty(this,"textAlign",{get:function(){var y;switch(v){case 0:default:y="left";break;case 1:y="center";break;case 2:y="right"}return y},configurable:!0,enumerable:!0,set:function(y){switch(y){case"right":case 2:v=2;break;case"center":case 1:v=1;break;default:v=0}}})};Jc(hf,Ff);var Lg=function(){hf.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Tae(t,this.objId,this.scope)},set:function(r){var n,s;s=[],typeof(n=r)=="string"&&(s=function(o,i,l){l||(l=1);for(var c,d=[];c=i.exec(o);)d.push(c[l]);return d}(n,/\((.*?)\)/g)),t=s}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,18)},set:function(r){r?this.Ff=bi(this.Ff,18):this.Ff=wi(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=bi(this.Ff,19):this.Ff=wi(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,20)},set:function(r){r?(this.Ff=bi(this.Ff,20),t.sort()):this.Ff=wi(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,22)},set:function(r){r?this.Ff=bi(this.Ff,22):this.Ff=wi(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,23)},set:function(r){r?this.Ff=bi(this.Ff,23):this.Ff=wi(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,27)},set:function(r){r?this.Ff=bi(this.Ff,27):this.Ff=wi(this.Ff,27)}}),this.hasAppearanceStream=!1};Jc(Lg,hf);var $g=function(){Lg.call(this),this.fontName="helvetica",this.combo=!1};Jc($g,Lg);var Bg=function(){$g.call(this),this.combo=!0};Jc(Bg,$g);var iw=function(){Bg.call(this),this.edit=!0};Jc(iw,Bg);var Vi=function(){hf.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,15)},set:function(r){r?this.Ff=bi(this.Ff,15):this.Ff=wi(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,16)},set:function(r){r?this.Ff=bi(this.Ff,16):this.Ff=wi(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,17)},set:function(r){r?this.Ff=bi(this.Ff,17):this.Ff=wi(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,26)},set:function(r){r?this.Ff=bi(this.Ff,26):this.Ff=wi(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,s=[];for(n in s.push("<<"),t)s.push("/"+n+" ("+Ax(r(t[n]))+")");return s.push(">>"),s.join(`
`)}},set:function(r){Ms(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};Jc(Vi,hf);var lw=function(){Vi.call(this),this.pushButton=!0};Jc(lw,Vi);var qg=function(){Vi.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};Jc(qg,Vi);var sC=function(){var e,t;hf.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(s){e=s}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(s){t=s}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(l){return l};this.scope&&(s=this.scope.internal.getEncryptor(this.objId));var o,i=[];for(o in i.push("<<"),n)i.push("/"+o+" ("+Ax(s(n[o]))+")");return i.push(">>"),i.join(`
`)},set:function(s){Ms(s)==="object"&&(n=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(s){typeof s=="string"&&(n.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(s){r=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(s){r="/"+s}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ca.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Jc(sC,hf),qg.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},qg.prototype.createOption=function(e){var t=new sC;return t.Parent=this,t.optionName=e,this.Kids.push(t),JQe.call(this.scope,t),t};var cw=function(){Vi.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ca.CheckBox.createAppearanceStream()};Jc(cw,Vi);var ip=function(){hf.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,13)},set:function(t){t?this.Ff=bi(this.Ff,13):this.Ff=wi(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,21)},set:function(t){t?this.Ff=bi(this.Ff,21):this.Ff=wi(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,23)},set:function(t){t?this.Ff=bi(this.Ff,23):this.Ff=wi(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,24)},set:function(t){t?this.Ff=bi(this.Ff,24):this.Ff=wi(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,25)},set:function(t){t?this.Ff=bi(this.Ff,25):this.Ff=wi(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,26)},set:function(t){t?this.Ff=bi(this.Ff,26):this.Ff=wi(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Jc(ip,hf);var dw=function(){ip.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!yi(this.Ff,14)},set:function(e){e?this.Ff=bi(this.Ff,14):this.Ff=wi(this.Ff,14)}}),this.password=!0};Jc(dw,ip);var Ca={CheckBox:{createAppearanceStream:function(){return{N:{On:Ca.CheckBox.YesNormal},D:{On:Ca.CheckBox.YesPushDown,Off:Ca.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=jf(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,s=e.scope.__private__.encodeColorString(e.color),o=E3(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+ms(Ca.internal.getWidth(e))+" "+ms(Ca.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+ms(o.fontSize)+" Tf "+s),r.push("BT"),r.push(o.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=jf(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),s=[],o=Ca.internal.getHeight(e),i=Ca.internal.getWidth(e),l=E3(e,e.caption);return s.push("1 g"),s.push("0 0 "+ms(i)+" "+ms(o)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+ms(i-1)+" "+ms(o-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+r+" "+ms(l.fontSize)+" Tf "+n),s.push(l.text),s.push("ET"),s.push("Q"),t.stream=s.join(`
`),t},OffPushDown:function(e){var t=jf(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+ms(Ca.internal.getWidth(e))+" "+ms(Ca.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:Ca.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=Ca.RadioButton.Circle.YesNormal,t.D[e]=Ca.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=jf(e);t.scope=e.scope;var r=[],n=Ca.internal.getWidth(e)<=Ca.internal.getHeight(e)?Ca.internal.getWidth(e)/4:Ca.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=Ca.internal.Bezier_C,o=Number((n*s).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+dh(Ca.internal.getWidth(e)/2)+" "+dh(Ca.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=jf(e);t.scope=e.scope;var r=[],n=Ca.internal.getWidth(e)<=Ca.internal.getHeight(e)?Ca.internal.getWidth(e)/4:Ca.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),o=Number((s*Ca.internal.Bezier_C).toFixed(5)),i=Number((n*Ca.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+dh(Ca.internal.getWidth(e)/2)+" "+dh(Ca.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),r.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),r.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),r.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+dh(Ca.internal.getWidth(e)/2)+" "+dh(Ca.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),r.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),r.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),r.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=jf(e);t.scope=e.scope;var r=[],n=Ca.internal.getWidth(e)<=Ca.internal.getHeight(e)?Ca.internal.getWidth(e)/4:Ca.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),o=Number((s*Ca.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+dh(Ca.internal.getWidth(e)/2)+" "+dh(Ca.internal.getHeight(e)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+o+" "+o+" "+s+" 0 "+s+" c"),r.push("-"+o+" "+s+" -"+s+" "+o+" -"+s+" 0 c"),r.push("-"+s+" -"+o+" -"+o+" -"+s+" 0 -"+s+" c"),r.push(o+" -"+s+" "+s+" -"+o+" "+s+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:Ca.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=Ca.RadioButton.Cross.YesNormal,t.D[e]=Ca.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=jf(e);t.scope=e.scope;var r=[],n=Ca.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+ms(Ca.internal.getWidth(e)-2)+" "+ms(Ca.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(ms(n.x1.x)+" "+ms(n.x1.y)+" m"),r.push(ms(n.x2.x)+" "+ms(n.x2.y)+" l"),r.push(ms(n.x4.x)+" "+ms(n.x4.y)+" m"),r.push(ms(n.x3.x)+" "+ms(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=jf(e);t.scope=e.scope;var r=Ca.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+ms(Ca.internal.getWidth(e))+" "+ms(Ca.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+ms(Ca.internal.getWidth(e)-2)+" "+ms(Ca.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(ms(r.x1.x)+" "+ms(r.x1.y)+" m"),n.push(ms(r.x2.x)+" "+ms(r.x2.y)+" l"),n.push(ms(r.x4.x)+" "+ms(r.x4.y)+" m"),n.push(ms(r.x3.x)+" "+ms(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=jf(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+ms(Ca.internal.getWidth(e))+" "+ms(Ca.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};Ca.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=Ca.internal.getWidth(e),r=Ca.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},Ca.internal.getWidth=function(e){var t=0;return Ms(e)==="object"&&(t=tU(e.Rect[2])),t},Ca.internal.getHeight=function(e){var t=0;return Ms(e)==="object"&&(t=tU(e.Rect[3])),t};var JQe=di.addField=function(e){if(YQe(this,e),!(e instanceof hf))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};di.AcroFormChoiceField=Lg,di.AcroFormListBox=$g,di.AcroFormComboBox=Bg,di.AcroFormEditBox=iw,di.AcroFormButton=Vi,di.AcroFormPushButton=lw,di.AcroFormRadioButton=qg,di.AcroFormCheckBox=cw,di.AcroFormTextField=ip,di.AcroFormPasswordField=dw,di.AcroFormAppearance=Ca,di.AcroForm={ChoiceField:Lg,ListBox:$g,ComboBox:Bg,EditBox:iw,Button:Vi,PushButton:lw,RadioButton:qg,CheckBox:cw,TextField:ip,PasswordField:dw,Appearance:Ca},Ta.AcroForm={ChoiceField:Lg,ListBox:$g,ComboBox:Bg,EditBox:iw,Button:Vi,PushButton:lw,RadioButton:qg,CheckBox:cw,TextField:ip,PasswordField:dw,Appearance:Ca};var QQe=Ta.AcroForm;function Rae(e){return e.reduce(function(t,r,n){return t[r]=n,t},{})}(function(e){var t="addImage_";e.__addimage__={};var r="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},s=e.__addimage__.getImageFileTypeByImageData=function(O,I){var T,k,q,B,z,F=r;if((I=I||r)==="RGBA"||O.data!==void 0&&O.data instanceof Uint8ClampedArray&&"height"in O&&"width"in O)return"RGBA";if(C(O))for(z in n)for(q=n[z],T=0;T<q.length;T+=1){for(B=!0,k=0;k<q[T].length;k+=1)if(q[T][k]!==void 0&&q[T][k]!==O[k]){B=!1;break}if(B===!0){F=z;break}}else for(z in n)for(q=n[z],T=0;T<q.length;T+=1){for(B=!0,k=0;k<q[T].length;k+=1)if(q[T][k]!==void 0&&q[T][k]!==O.charCodeAt(k)){B=!1;break}if(B===!0){F=z;break}}return F===r&&I!==r&&(F=I),F},o=function O(I){for(var T=this.internal.write,k=this.internal.putStream,q=(0,this.internal.getFilters)();q.indexOf("FlateEncode")!==-1;)q.splice(q.indexOf("FlateEncode"),1);I.objectId=this.internal.newObject();var B=[];if(B.push({key:"Type",value:"/XObject"}),B.push({key:"Subtype",value:"/Image"}),B.push({key:"Width",value:I.width}),B.push({key:"Height",value:I.height}),I.colorSpace===y.INDEXED?B.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(I.palette.length/3-1)+" "+("sMask"in I&&I.sMask!==void 0?I.objectId+2:I.objectId+1)+" 0 R]"}):(B.push({key:"ColorSpace",value:"/"+I.colorSpace}),I.colorSpace===y.DEVICE_CMYK&&B.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),B.push({key:"BitsPerComponent",value:I.bitsPerComponent}),"decodeParameters"in I&&I.decodeParameters!==void 0&&B.push({key:"DecodeParms",value:"<<"+I.decodeParameters+">>"}),"transparency"in I&&Array.isArray(I.transparency)&&I.transparency.length>0){for(var z="",F=0,V=I.transparency.length;F<V;F++)z+=I.transparency[F]+" "+I.transparency[F]+" ";B.push({key:"Mask",value:"["+z+"]"})}I.sMask!==void 0&&B.push({key:"SMask",value:I.objectId+1+" 0 R"});var me=I.filter!==void 0?["/"+I.filter]:void 0;if(k({data:I.data,additionalKeyValues:B,alreadyAppliedFilters:me,objectId:I.objectId}),T("endobj"),"sMask"in I&&I.sMask!==void 0){var be,U=(be=I.sMaskBitsPerComponent)!==null&&be!==void 0?be:I.bitsPerComponent,L={width:I.width,height:I.height,colorSpace:"DeviceGray",bitsPerComponent:U,data:I.sMask};"filter"in I&&(L.decodeParameters="/Predictor ".concat(I.predictor," /Colors 1 /BitsPerComponent ").concat(U," /Columns ").concat(I.width),L.filter=I.filter),O.call(this,L)}if(I.colorSpace===y.INDEXED){var H=this.internal.newObject();k({data:S(new Uint8Array(I.palette)),objectId:H}),T("endobj")}},i=function(){var O=this.internal.collections[t+"images"];for(var I in O)o.call(this,O[I])},l=function(){var O,I=this.internal.collections[t+"images"],T=this.internal.write;for(var k in I)T("/I"+(O=I[k]).index,O.objectId,"0","R")},c=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",i),this.internal.events.subscribe("putXobjectDict",l))},d=function(){var O=this.internal.collections[t+"images"];return c.call(this),O},u=function(){return Object.keys(this.internal.collections[t+"images"]).length},f=function(O){return typeof e["process"+O.toUpperCase()]=="function"},h=function(O){return Ms(O)==="object"&&O.nodeType===1},m=function(O,I){if(O.nodeName==="IMG"&&O.hasAttribute("src")){var T=""+O.getAttribute("src");if(T.indexOf("data:image/")===0)return z2(unescape(T).split("base64,").pop());var k=e.loadFile(T,!0);if(k!==void 0)return k}if(O.nodeName==="CANVAS"){if(O.width===0||O.height===0)throw new Error("Given canvas must have data. Canvas width: "+O.width+", height: "+O.height);var q;switch(I){case"PNG":q="image/png";break;case"WEBP":q="image/webp";break;default:q="image/jpeg"}return z2(O.toDataURL(q,1).split("base64,").pop())}},x=function(O){var I=this.internal.collections[t+"images"];if(I){for(var T in I)if(O===I[T].alias)return I[T]}},g=function(O,I,T){return O||I||(O=-96,I=-96),O<0&&(O=-1*T.width*72/O/this.internal.scaleFactor),I<0&&(I=-1*T.height*72/I/this.internal.scaleFactor),O===0&&(O=I*T.width/T.height),I===0&&(I=O*T.height/T.width),[O,I]},v=function(O,I,T,k,q,B){var z=g.call(this,T,k,q),F=this.internal.getCoordinateString,V=this.internal.getVerticalCoordinateString,me=d.call(this);if(T=z[0],k=z[1],me[q.index]=q,B){B*=Math.PI/180;var be=Math.cos(B),U=Math.sin(B),L=function(ie){return ie.toFixed(4)},H=[L(be),L(U),L(-1*U),L(be),0,0,"cm"]}this.internal.write("q"),B?(this.internal.write([1,"0","0",1,F(O),V(I+k),"cm"].join(" ")),this.internal.write(H.join(" ")),this.internal.write([F(T),"0","0",F(k),"0","0","cm"].join(" "))):this.internal.write([F(T),"0","0",F(k),F(O),V(I+k),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+q.index+" Do"),this.internal.write("Q")},y=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},w=e.__addimage__.sHashCode=function(O){var I,T,k=0;if(typeof O=="string")for(T=O.length,I=0;I<T;I++)k=(k<<5)-k+O.charCodeAt(I),k|=0;else if(C(O))for(T=O.byteLength/2,I=0;I<T;I++)k=(k<<5)-k+O[I],k|=0;return k},j=e.__addimage__.validateStringAsBase64=function(O){(O=O||"").toString().trim();var I=!0;return O.length===0&&(I=!1),O.length%4!=0&&(I=!1),/^[A-Za-z0-9+/]+$/.test(O.substr(0,O.length-2))===!1&&(I=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(O.substr(-2))===!1&&(I=!1),I},_=e.__addimage__.extractImageFromDataUrl=function(O){if(O==null||!(O=O.trim()).startsWith("data:"))return null;var I=O.indexOf(",");return I<0?null:O.substring(0,I).trim().endsWith("base64")?O.substring(I+1):null};e.__addimage__.isArrayBuffer=function(O){return O instanceof ArrayBuffer};var C=e.__addimage__.isArrayBufferView=function(O){return O instanceof Int8Array||O instanceof Uint8Array||O instanceof Uint8ClampedArray||O instanceof Int16Array||O instanceof Uint16Array||O instanceof Int32Array||O instanceof Uint32Array||O instanceof Float32Array||O instanceof Float64Array},E=e.__addimage__.binaryStringToUint8Array=function(O){for(var I=O.length,T=new Uint8Array(I),k=0;k<I;k++)T[k]=O.charCodeAt(k);return T},S=e.__addimage__.arrayBufferToBinaryString=function(O){for(var I="",T=C(O)?O:new Uint8Array(O),k=0;k<T.length;k+=8192)I+=String.fromCharCode.apply(null,T.subarray(k,k+8192));return I};e.addImage=function(){var O,I,T,k,q,B,z,F,V;if(typeof arguments[1]=="number"?(I=r,T=arguments[1],k=arguments[2],q=arguments[3],B=arguments[4],z=arguments[5],F=arguments[6],V=arguments[7]):(I=arguments[1],T=arguments[2],k=arguments[3],q=arguments[4],B=arguments[5],z=arguments[6],F=arguments[7],V=arguments[8]),Ms(O=arguments[0])==="object"&&!h(O)&&"imageData"in O){var me=O;O=me.imageData,I=me.format||I||r,T=me.x||T||0,k=me.y||k||0,q=me.w||me.width||q,B=me.h||me.height||B,z=me.alias||z,F=me.compression||F,V=me.rotation||me.angle||V}var be=this.internal.getFilters();if(F===void 0&&be.indexOf("FlateEncode")!==-1&&(F="SLOW"),isNaN(T)||isNaN(k))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var U=A.call(this,O,I,z,F);return v.call(this,T,k,q,B,U,V),this};var A=function(O,I,T,k){var q,B,z;if(typeof O=="string"&&s(O)===r){O=unescape(O);var F=M(O,!1);(F!==""||(F=e.loadFile(O,!0))!==void 0)&&(O=F)}if(h(O)&&(O=m(O,I)),I=s(O,I),!f(I))throw new Error("addImage does not support files of type '"+I+"', please ensure that a plugin for '"+I+"' support is added.");if(((z=T)==null||z.length===0)&&(T=function(V){return typeof V=="string"||C(V)?w(V):C(V.data)?w(V.data):null}(O)),(q=x.call(this,T))||(O instanceof Uint8Array||I==="RGBA"||(B=O,O=E(O)),q=this["process"+I.toUpperCase()](O,u.call(this),T,function(V){return V&&typeof V=="string"&&(V=V.toUpperCase()),V in e.image_compression?V:b.NONE}(k),B)),!q)throw new Error("An unknown error occurred whilst processing the image.");return q},M=e.__addimage__.convertBase64ToBinaryString=function(O,I){I=typeof I!="boolean"||I;var T,k="";if(typeof O=="string"){var q;T=(q=_(O))!==null&&q!==void 0?q:O;try{k=z2(T)}catch(B){if(I)throw j(T)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+B.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return k};e.getImageProperties=function(O){var I,T,k="";if(h(O)&&(O=m(O)),typeof O=="string"&&s(O)===r&&((k=M(O,!1))===""&&(k=e.loadFile(O)||""),O=k),T=s(O),!f(T))throw new Error("addImage does not support files of type '"+T+"', please ensure that a plugin for '"+T+"' support is added.");if(O instanceof Uint8Array||(O=E(O)),!(I=this["process"+T.toUpperCase()](O)))throw new Error("An unknown error occurred whilst processing the image");return I.fileType=T,I}})(Ta.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};Ta.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var n,s,o,i=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(r.objId),d=r.pageContext.annotations,u=!1,f=0;f<d.length&&!u;f++)switch((n=d[f]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(u=!0);break;case"reference":case"text":case"freetext":u=!0}if(u!=0){this.internal.write("/Annots [");for(var h=0;h<d.length;h++){n=d[h];var m=this.internal.pdfEscape,x=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var g=this.internal.newAdditionalObject(),v=this.internal.newAdditionalObject(),y=this.internal.getEncryptor(g.objId),b=n.title||"Note";o="<</Type /Annot /Subtype /Text "+(s="/Rect ["+i(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+m(y(n.contents))+")",o+=" /Popup "+v.objId+" 0 R",o+=" /P "+c.objId+" 0 R",o+=" /T ("+m(y(b))+") >>",g.content=o;var w=g.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(s="/Rect ["+i(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+w,n.open&&(o+=" /Open true"),o+=" >>",v.content=o,this.internal.write(g.objId,"0 R",v.objId,"0 R");break;case"freetext":s="/Rect ["+i(n.bounds.x)+" "+l(n.bounds.y)+" "+i(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var j=n.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+s+"/Contents ("+m(x(n.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+j+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(n.options.name){var _=this.annotations._nameMap[n.options.name];n.options.pageNumber=_.page,n.options.top=_.y}else n.options.top||(n.options.top=0);if(s="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",o="",n.options.url)o="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /A <</S /URI /URI ("+m(x(n.options.url))+") >>";else if(n.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,o+=" /FitV "+n.options.left+"]";break;default:var C=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),o+=" /XYZ "+n.options.left+" "+C+" "+n.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},e.link=function(r,n,s,o,i){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(r),y:d(n),w:c(r+s),h:d(n+o)},options:i,type:"link"})},e.textWithLink=function(r,n,s,o){var i,l,c=this.getTextWidth(r),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){l=o.maxWidth;var u=this.splitTextToSize(r,l).length;i=Math.ceil(d*u)}else l=c,i=d;return this.text(r,n,s,o),s+=.2*d,o.align==="center"&&(n-=c/2),o.align==="right"&&(n-=c),this.link(n,s-d,l,i,o),c},e.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(Ta.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];e.__arabicParser__={};var o=e.__arabicParser__.isInArabicSubstitutionA=function(g){return t[g.charCodeAt(0)]!==void 0},i=e.__arabicParser__.isArabicLetter=function(g){return typeof g=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(g)},l=e.__arabicParser__.isArabicEndLetter=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(g){return i(g)&&s.indexOf(g.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=1};var d=e.__arabicParser__.arabicLetterHasFinalForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length>=3};var u=e.__arabicParser__.arabicLetterHasMedialForm=function(g){return i(g)&&o(g)&&t[g.charCodeAt(0)].length==4},f=e.__arabicParser__.resolveLigatures=function(g){var v=0,y=r,b="",w=0;for(v=0;v<g.length;v+=1)y[g.charCodeAt(v)]!==void 0?(w++,typeof(y=y[g.charCodeAt(v)])=="number"&&(b+=String.fromCharCode(y),y=r,w=0),v===g.length-1&&(y=r,b+=g.charAt(v-(w-1)),v-=w-1,w=0)):(y=r,b+=g.charAt(v-w),v-=w,w=0);return b};e.__arabicParser__.isArabicDiacritic=function(g){return g!==void 0&&n[g.charCodeAt(0)]!==void 0};var h=e.__arabicParser__.getCorrectForm=function(g,v,y){return i(g)?o(g)===!1?-1:!d(g)||!i(v)&&!i(y)||!i(y)&&l(v)||l(g)&&!i(v)||l(g)&&c(v)||l(g)&&l(v)?0:u(g)&&i(v)&&!l(v)&&i(y)&&d(y)?3:l(g)||!i(y)?1:2:-1},m=function(g){var v=0,y=0,b=0,w="",j="",_="",C=(g=g||"").split("\\s+"),E=[];for(v=0;v<C.length;v+=1){for(E.push(""),y=0;y<C[v].length;y+=1)w=C[v][y],j=C[v][y-1],_=C[v][y+1],i(w)?(b=h(w,j,_),E[v]+=b!==-1?String.fromCharCode(t[w.charCodeAt(0)][b]):w):E[v]+=w;E[v]=f(E[v])}return E.join(" ")},x=e.__arabicParser__.processArabic=e.processArabic=function(){var g,v=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,y=[];if(Array.isArray(v)){var b=0;for(y=[],b=0;b<v.length;b+=1)Array.isArray(v[b])?y.push([m(v[b][0]),v[b][1],v[b][2]]):y.push([m(v[b])]);g=y}else g=m(v);return typeof arguments[0]=="string"?g:(arguments[0].text=g,arguments[0])};e.events.push(["preProcessText",x])}(Ta.API),Ta.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform",e.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var s=300;Object.defineProperty(this,"height",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=s+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(l){o=l}});var i={};Object.defineProperty(this,"style",{get:function(){return i},set:function(l){i=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,n){var s;if((r=r||"2d")!=="2d")return null;for(s in n)this.pdf.context2d.hasOwnProperty(s)&&(this.pdf.context2d[s]=n[s]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Ta.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(g){c=g}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(g){d=g}});var u=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return u},set:function(g){u=g}});var f=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return f},set:function(g){f=g}});var h=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return h},set:function(g){h=g}});var m=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return m},set:function(g){m=g}});var x=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return x},set:function(g){x=g}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(c){return n.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},e.getTextDimensions=function(c,d){n.call(this);var u=(d=d||{}).fontSize||this.getFontSize(),f=d.font||this.getFont(),h=d.scaleFactor||this.internal.scaleFactor,m=0,x=0,g=0,v=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var y=d.maxWidth;y>0?typeof c=="string"?c=this.splitTextToSize(c,y):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(w,j){return w.concat(v.splitTextToSize(j,y))},[])):c=Array.isArray(c)?c:[c];for(var b=0;b<c.length;b++)m<(g=this.getStringUnitWidth(c[b],{font:f})*u)&&(m=g);return m!==0&&(x=c.length),{w:m/=h,h:Math.max((x*u*this.getLineHeightFactor()-u*(this.getLineHeightFactor()-1))/h,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var i=e.cell=function(){var c;c=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var d=this.internal.__cell__.lastCell,u=this.internal.__cell__.padding,f=this.internal.__cell__.margins||t,h=this.internal.__cell__.tableHeaderRow,m=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===c.lineNumber?(c.x=(d.x||0)+(d.width||0),c.y=d.y||0):d.y+d.height+c.height+f.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=f.top,m&&h&&(this.printHeaderRow(c.lineNumber,!0),c.y+=h[0].height)):c.y=d.y+d.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,r===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-u,c.y+u,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+u,{align:"center",baseline:"top",maxWidth:c.width-u-u}):this.text(c.text,c.x+u,c.y+u,{align:"left",baseline:"top",maxWidth:c.width-u-u})),this.internal.__cell__.lastCell=c,this};e.table=function(c,d,u,f,h){if(n.call(this),!u)throw new Error("No data for PDF table.");var m,x,g,v,y=[],b=[],w=[],j={},_={},C=[],E=[],S=(h=h||{}).autoSize||!1,A=h.printHeaders!==!1,M=h.css&&h.css["font-size"]!==void 0?16*h.css["font-size"]:h.fontSize||12,O=h.margins||Object.assign({width:this.getPageWidth()},t),I=typeof h.padding=="number"?h.padding:3,T=h.headerBackgroundColor||"#c8c8c8",k=h.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=A,this.internal.__cell__.margins=O,this.internal.__cell__.table_font_size=M,this.internal.__cell__.padding=I,this.internal.__cell__.headerBackgroundColor=T,this.internal.__cell__.headerTextColor=k,this.setFontSize(M),f==null)b=y=Object.keys(u[0]),w=y.map(function(){return"left"});else if(Array.isArray(f)&&Ms(f[0])==="object")for(y=f.map(function(me){return me.name}),b=f.map(function(me){return me.prompt||me.name||""}),w=f.map(function(me){return me.align||"left"}),m=0;m<f.length;m+=1)_[f[m].name]=.7499990551181103*f[m].width;else Array.isArray(f)&&typeof f[0]=="string"&&(b=y=f,w=y.map(function(){return"left"}));if(S||Array.isArray(f)&&typeof f[0]=="string")for(m=0;m<y.length;m+=1){for(j[v=y[m]]=u.map(function(me){return me[v]}),this.setFont(void 0,"bold"),C.push(this.getTextDimensions(b[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),x=j[v],this.setFont(void 0,"normal"),g=0;g<x.length;g+=1)C.push(this.getTextDimensions(x[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);_[v]=Math.max.apply(null,C)+I+I,C=[]}if(A){var q={};for(m=0;m<y.length;m+=1)q[y[m]]={},q[y[m]].text=b[m],q[y[m]].align=w[m];var B=l.call(this,q,_);E=y.map(function(me){return new o(c,d,_[me],B,q[me].text,void 0,q[me].align)}),this.setTableHeaderRow(E),this.printHeaderRow(1,!1)}var z=f.reduce(function(me,be){return me[be.name]=be.align,me},{});for(m=0;m<u.length;m+=1){"rowStart"in h&&h.rowStart instanceof Function&&h.rowStart({row:m,data:u[m]},this);var F=l.call(this,u[m],_);for(g=0;g<y.length;g+=1){var V=u[m][y[g]];"cellStart"in h&&h.cellStart instanceof Function&&h.cellStart({row:m,col:g,data:V},this),i.call(this,new o(c,d,_[y[g]],F,V,m+2,z[y[g]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=d,this};var l=function(c,d){var u=this.internal.__cell__.padding,f=this.internal.__cell__.table_font_size,h=this.internal.scaleFactor;return Object.keys(c).map(function(m){var x=c[m];return this.splitTextToSize(x.hasOwnProperty("text")?x.text:x,d[m]-u-u)},this).map(function(m){return this.getLineHeightFactor()*m.length*f/h+u+u},this).reduce(function(m,x){return Math.max(m,x)},0)};e.setTableHeaderRow=function(c){n.call(this),this.internal.__cell__.tableHeaderRow=c},e.printHeaderRow=function(c,d){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var u;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var f=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(f[0],f[1],f[2],f[3],void 0,-1)}this.setFont(void 0,"bold");for(var h=[],m=0;m<this.internal.__cell__.tableHeaderRow.length;m+=1){u=this.internal.__cell__.tableHeaderRow[m].clone(),d&&(u.y=this.internal.__cell__.margins.top||0,h.push(u)),u.lineNumber=c;var x=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),i.call(this,u),this.setTextColor(x)}h.length>0&&this.setTableHeaderRow(h),this.setFont(void 0,"normal"),r=!1}}(Ta.API);var Fae={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Lae=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],k3=Rae(Lae),$ae=[100,200,300,400,500,600,700,800,900],ZQe=Rae($ae);function gk(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(o){return Fae[o=o||"normal"]?o:"normal"}(e.style),n=function(o){return o?typeof o=="number"?o>=100&&o<=900&&o%100==0?o:400:/^\d00$/.test(o)?parseInt(o):o==="bold"?700:400:400}(e.weight),s=function(o){return typeof k3[o=o||"normal"]=="number"?o:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:s,src:e.src||[],ref:e.ref||{name:t,style:[s,r,n].join(" ")}}}function rU(e,t,r,n){var s;for(s=r;s>=0&&s<t.length;s+=n)if(e[t[s]])return e[t[s]];for(s=r;s>=0&&s<t.length;s-=n)if(e[t[s]])return e[t[s]]}var eZe={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},nU={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function aU(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function sU(e){return e.trimLeft()}function tZe(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function rZe(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var Z_,oU,iU,Qx,e2,lU,cU,dU,xk=["times"];function uU(e,t,r,n,s){var o=4,i=mU;switch(s){case Ta.API.image_compression.FAST:o=1,i=fU;break;case Ta.API.image_compression.MEDIUM:o=6,i=hU;break;case Ta.API.image_compression.SLOW:o=9,i=pU}e=function(c,d,u,f){for(var h,m=c.length/d,x=new Uint8Array(c.length+m),g=[nZe,fU,mU,hU,pU],v=0;v<m;v+=1){var y=v*d,b=c.subarray(y,y+d);if(f)x.set(f(b,u,h),y+v);else{for(var w=g.length,j=[],_=0;_<w;_+=1)j[_]=g[_](b,u,h);var C=sZe(j.concat());x.set(j[C],y+v)}h=b}return x}(e,t,Math.ceil(r*n/8),i);var l=x3(e,{level:o});return Ta.API.__addimage__.arrayBufferToBinaryString(l)}function nZe(e){var t=Array.apply([],e);return t.unshift(0),t}function fU(e,t){var r=e.length,n=[];n[0]=1;for(var s=0;s<r;s+=1){var o=e[s-t]||0;n[s+1]=e[s]-o+256&255}return n}function mU(e,t,r){var n=e.length,s=[];s[0]=2;for(var o=0;o<n;o+=1){var i=r&&r[o]||0;s[o+1]=e[o]-i+256&255}return s}function hU(e,t,r){var n=e.length,s=[];s[0]=3;for(var o=0;o<n;o+=1){var i=e[o-t]||0,l=r&&r[o]||0;s[o+1]=e[o]+256-(i+l>>>1)&255}return s}function pU(e,t,r){var n=e.length,s=[];s[0]=4;for(var o=0;o<n;o+=1){var i=aZe(e[o-t]||0,r&&r[o]||0,r&&r[o-t]||0);s[o+1]=e[o]-i+256&255}return s}function aZe(e,t,r){if(e===t&&t===r)return e;var n=Math.abs(t-r),s=Math.abs(e-r),o=Math.abs(e+t-r-r);return n<=s&&n<=o?e:s<=o?t:r}function sZe(e){var t=e.map(function(r){return r.reduce(function(n,s){return n+Math.abs(s)},0)});return t.indexOf(Math.min.apply(null,t))}function vk(e,t,r){var n=t*r,s=Math.floor(n/8),o=16-(n-8*s+r),i=(1<<r)-1;return Bae(e,s)>>o&i}function gU(e,t,r,n){var s=r*n,o=Math.floor(s/8),i=16-(s-8*o+n),l=(1<<n)-1,c=(t&l)<<i;(function(d,u,f){if(u+1<d.byteLength)d.setUint16(u,f,!1);else{var h=f>>8&255;d.setUint8(u,h)}})(e,o,Bae(e,o)&~(l<<i)&65535|c)}function Bae(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function oZe(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,s=e[t++],o=s>>7,i=1<<1+(7&s);e[t++],e[t++];var l=null,c=null;o&&(l=t,c=i,t+=3*i);var d=!0,u=[],f=0,h=null,m=0,x=null;for(this.width=r,this.height=n;d&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,x=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var g=e[t++];f=e[t++]|e[t++]<<8,h=e[t++],1&g||(h=null),m=g>>2&7,t++;break;case 254:for(;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var v=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,j=e[t++],_=j>>6&1,C=1<<1+(7&j),E=l,S=c,A=!1;j>>7&&(A=!0,E=t,S=C,t+=3*C);var M=t;for(t++;;){var O;if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}u.push({x:v,y,width:b,height:w,has_local_palette:A,palette_offset:E,palette_size:S,data_offset:M,data_length:t-M,transparent_index:h,interlaced:!!_,delay:f,disposal:m});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return x},this.frameInfo=function(I){if(I<0||I>=u.length)throw new Error("Frame index out of range.");return u[I]},this.decodeAndBlitFrameBGRA=function(I,T){var k=this.frameInfo(I),q=k.width*k.height,B=new Uint8Array(q);xU(e,k.data_offset,B,q);var z=k.palette_offset,F=k.transparent_index;F===null&&(F=256);var V=k.width,me=r-V,be=V,U=4*(k.y*r+k.x),L=4*((k.y+k.height)*r+k.x),H=U,ie=4*me;k.interlaced===!0&&(ie+=4*r*7);for(var Y=8,W=0,se=B.length;W<se;++W){var pe=B[W];if(be===0&&(be=V,(H+=ie)>=L&&(ie=4*me+4*r*(Y-1),H=U+(V+me)*(Y<<1),Y>>=1)),pe===F)H+=4;else{var G=e[z+3*pe],te=e[z+3*pe+1],oe=e[z+3*pe+2];T[H++]=oe,T[H++]=te,T[H++]=G,T[H++]=255}--be}},this.decodeAndBlitFrameRGBA=function(I,T){var k=this.frameInfo(I),q=k.width*k.height,B=new Uint8Array(q);xU(e,k.data_offset,B,q);var z=k.palette_offset,F=k.transparent_index;F===null&&(F=256);var V=k.width,me=r-V,be=V,U=4*(k.y*r+k.x),L=4*((k.y+k.height)*r+k.x),H=U,ie=4*me;k.interlaced===!0&&(ie+=4*r*7);for(var Y=8,W=0,se=B.length;W<se;++W){var pe=B[W];if(be===0&&(be=V,(H+=ie)>=L&&(ie=4*me+4*r*(Y-1),H=U+(V+me)*(Y<<1),Y>>=1)),pe===F)H+=4;else{var G=e[z+3*pe],te=e[z+3*pe+1],oe=e[z+3*pe+2];T[H++]=G,T[H++]=te,T[H++]=oe,T[H++]=255}--be}}}function xU(e,t,r,n){for(var s=e[t++],o=1<<s,i=o+1,l=i+1,c=s+1,d=(1<<c)-1,u=0,f=0,h=0,m=e[t++],x=new Int32Array(4096),g=null;;){for(;u<16&&m!==0;)f|=e[t++]<<u,u+=8,m===1?m=e[t++]:--m;if(u<c)break;var v=f&d;if(f>>=c,u-=c,v!==o){if(v===i)break;for(var y=v<l?v:g,b=0,w=y;w>o;)w=x[w]>>8,++b;var j=w;if(h+b+(y!==v?1:0)>n)return void jo.log("Warning, gif stream longer than expected.");r[h++]=j;var _=h+=b;for(y!==v&&(r[h++]=j),w=y;b--;)w=x[w],r[--_]=255&w,w>>=8;g!==null&&l<4096&&(x[l++]=g<<8|j,l>=d+1&&c<12&&(++c,d=d<<1|1)),g=v}else l=i+1,d=(1<<(c=s+1))-1,g=null}return h!==n&&jo.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function yk(e){var t,r,n,s,o,i=Math.floor,l=new Array(64),c=new Array(64),d=new Array(64),u=new Array(64),f=new Array(65535),h=new Array(65535),m=new Array(64),x=new Array(64),g=[],v=0,y=7,b=new Array(64),w=new Array(64),j=new Array(64),_=new Array(256),C=new Array(2048),E=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],A=[0,1,2,3,4,5,6,7,8,9,10,11],M=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],O=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],k=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],q=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function B(U,L){for(var H=0,ie=0,Y=new Array,W=1;W<=16;W++){for(var se=1;se<=U[W];se++)Y[L[ie]]=[],Y[L[ie]][0]=H,Y[L[ie]][1]=W,ie++,H++;H*=2}return Y}function z(U){for(var L=U[0],H=U[1]-1;H>=0;)L&1<<H&&(v|=1<<y),H--,--y<0&&(v==255?(F(255),F(0)):F(v),y=7,v=0)}function F(U){g.push(U)}function V(U){F(U>>8&255),F(255&U)}function me(U,L,H,ie,Y){for(var W,se=Y[0],pe=Y[240],G=function(bt,Lt){var Dt,Bt,ge,wt,Gt,Sr,wr,he,ot,Vt,qt=0;for(ot=0;ot<8;++ot){Dt=bt[qt],Bt=bt[qt+1],ge=bt[qt+2],wt=bt[qt+3],Gt=bt[qt+4],Sr=bt[qt+5],wr=bt[qt+6];var Re=Dt+(he=bt[qt+7]),Ct=Dt-he,Wt=Bt+wr,Er=Bt-wr,Me=ge+Sr,lt=ge-Sr,gt=wt+Gt,or=wt-Gt,br=Re+gt,ur=Re-gt,an=Wt+Me,zr=Wt-Me;bt[qt]=br+an,bt[qt+4]=br-an;var Gr=.707106781*(zr+ur);bt[qt+2]=ur+Gr,bt[qt+6]=ur-Gr;var ha=.382683433*((br=or+lt)-(zr=Er+Ct)),pn=.5411961*br+ha,on=1.306562965*zr+ha,cn=.707106781*(an=lt+Er),ke=Ct+cn,We=Ct-cn;bt[qt+5]=We+pn,bt[qt+3]=We-pn,bt[qt+1]=ke+on,bt[qt+7]=ke-on,qt+=8}for(qt=0,ot=0;ot<8;++ot){Dt=bt[qt],Bt=bt[qt+8],ge=bt[qt+16],wt=bt[qt+24],Gt=bt[qt+32],Sr=bt[qt+40],wr=bt[qt+48];var Ze=Dt+(he=bt[qt+56]),Je=Dt-he,At=Bt+wr,Ye=Bt-wr,lr=ge+Sr,ce=ge-Sr,qe=wt+Gt,ze=wt-Gt,xt=Ze+qe,rr=Ze-qe,ir=At+lr,Kr=At-lr;bt[qt]=xt+ir,bt[qt+32]=xt-ir;var jr=.707106781*(Kr+rr);bt[qt+16]=rr+jr,bt[qt+48]=rr-jr;var sa=.382683433*((xt=ze+ce)-(Kr=Ye+Je)),ia=.5411961*xt+sa,Kn=1.306562965*Kr+sa,at=.707106781*(ir=ce+Ye),Te=Je+at,Fe=Je-at;bt[qt+40]=Fe+ia,bt[qt+24]=Fe-ia,bt[qt+8]=Te+Kn,bt[qt+56]=Te-Kn,qt++}for(ot=0;ot<64;++ot)Vt=bt[ot]*Lt[ot],m[ot]=Vt>0?Vt+.5|0:Vt-.5|0;return m}(U,L),te=0;te<64;++te)x[E[te]]=G[te];var oe=x[0]-H;H=x[0],oe==0?z(ie[0]):(z(ie[h[W=32767+oe]]),z(f[W]));for(var De=63;De>0&&x[De]==0;)De--;if(De==0)return z(se),H;for(var re,ae=1;ae<=De;){for(var ut=ae;x[ae]==0&&ae<=De;)++ae;var pt=ae-ut;if(pt>=16){re=pt>>4;for(var ft=1;ft<=re;++ft)z(pe);pt&=15}W=32767+x[ae],z(Y[(pt<<4)+h[W]]),z(f[W]),ae++}return De!=63&&z(se),H}function be(U){U=Math.min(Math.max(U,1),100),o!=U&&(function(L){for(var H=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ie=0;ie<64;ie++){var Y=i((H[ie]*L+50)/100);Y=Math.min(Math.max(Y,1),255),l[E[ie]]=Y}for(var W=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],se=0;se<64;se++){var pe=i((W[se]*L+50)/100);pe=Math.min(Math.max(pe,1),255),c[E[se]]=pe}for(var G=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],te=0,oe=0;oe<8;oe++)for(var De=0;De<8;De++)d[te]=1/(l[E[te]]*G[oe]*G[De]*8),u[te]=1/(c[E[te]]*G[oe]*G[De]*8),te++}(U<50?Math.floor(5e3/U):Math.floor(200-2*U)),o=U)}this.encode=function(U,L){L&&be(L),g=new Array,v=0,y=7,V(65496),V(65504),V(16),F(74),F(70),F(73),F(70),F(0),F(1),F(1),F(0),V(1),V(1),F(0),F(0),function(){V(65499),V(132),F(0);for(var Bt=0;Bt<64;Bt++)F(l[Bt]);F(1);for(var ge=0;ge<64;ge++)F(c[ge])}(),function(Bt,ge){V(65472),V(17),F(8),V(ge),V(Bt),F(3),F(1),F(17),F(0),F(2),F(17),F(1),F(3),F(17),F(1)}(U.width,U.height),function(){V(65476),V(418),F(0);for(var Bt=0;Bt<16;Bt++)F(S[Bt+1]);for(var ge=0;ge<=11;ge++)F(A[ge]);F(16);for(var wt=0;wt<16;wt++)F(M[wt+1]);for(var Gt=0;Gt<=161;Gt++)F(O[Gt]);F(1);for(var Sr=0;Sr<16;Sr++)F(I[Sr+1]);for(var wr=0;wr<=11;wr++)F(T[wr]);F(17);for(var he=0;he<16;he++)F(k[he+1]);for(var ot=0;ot<=161;ot++)F(q[ot])}(),V(65498),V(12),F(3),F(1),F(0),F(2),F(17),F(3),F(17),F(0),F(63),F(0);var H=0,ie=0,Y=0;v=0,y=7,this.encode.displayName="_encode_";for(var W,se,pe,G,te,oe,De,re,ae,ut=U.data,pt=U.width,ft=U.height,bt=4*pt,Lt=0;Lt<ft;){for(W=0;W<bt;){for(te=bt*Lt+W,De=-1,re=0,ae=0;ae<64;ae++)oe=te+(re=ae>>3)*bt+(De=4*(7&ae)),Lt+re>=ft&&(oe-=bt*(Lt+1+re-ft)),W+De>=bt&&(oe-=W+De-bt+4),se=ut[oe++],pe=ut[oe++],G=ut[oe++],b[ae]=(C[se]+C[pe+256|0]+C[G+512|0]>>16)-128,w[ae]=(C[se+768|0]+C[pe+1024|0]+C[G+1280|0]>>16)-128,j[ae]=(C[se+1280|0]+C[pe+1536|0]+C[G+1792|0]>>16)-128;H=me(b,d,H,t,n),ie=me(w,u,ie,r,s),Y=me(j,u,Y,r,s),W+=32}Lt+=8}if(y>=0){var Dt=[];Dt[1]=y+1,Dt[0]=(1<<y+1)-1,z(Dt)}return V(65497),new Uint8Array(g)},e=e||50,function(){for(var U=String.fromCharCode,L=0;L<256;L++)_[L]=U(L)}(),t=B(S,A),r=B(I,T),n=B(M,O),s=B(k,q),function(){for(var U=1,L=2,H=1;H<=15;H++){for(var ie=U;ie<L;ie++)h[32767+ie]=H,f[32767+ie]=[],f[32767+ie][1]=H,f[32767+ie][0]=ie;for(var Y=-(L-1);Y<=-U;Y++)h[32767+Y]=H,f[32767+Y]=[],f[32767+Y][1]=H,f[32767+Y][0]=L-1+Y;U<<=1,L<<=1}}(),function(){for(var U=0;U<256;U++)C[U]=19595*U,C[U+256|0]=38470*U,C[U+512|0]=7471*U+32768,C[U+768|0]=-11059*U,C[U+1024|0]=-21709*U,C[U+1280|0]=32768*U+8421375,C[U+1536|0]=-27439*U,C[U+1792|0]=-5329*U}(),be(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Fu(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function vU(e){function t(A){if(!A)throw Error("assert :P")}function r(A,M,O){for(var I=0;4>I;I++)if(A[M+I]!=O.charCodeAt(I))return!0;return!1}function n(A,M,O,I,T){for(var k=0;k<T;k++)A[M+k]=O[I+k]}function s(A,M,O,I){for(var T=0;T<I;T++)A[M+T]=O}function o(A){return new Int32Array(A)}function i(A,M){for(var O=[],I=0;I<A;I++)O.push(new M);return O}function l(A,M){var O=[];return function I(T,k,q){for(var B=q[k],z=0;z<B&&(T.push(q.length>k+1?[]:new M),!(q.length<k+1));z++)I(T[z],k+1,q)}(O,0,A),O}var c=function(){var A=this;function M(N,P){for(var $=1<<P-1>>>0;N&$;)$>>>=1;return $?(N&$-1)+$:N}function O(N,P,$,K,ue){t(!(K%$));do N[P+(K-=$)]=ue;while(0<K)}function I(N,P,$,K,ue){if(t(2328>=ue),512>=ue)var ve=o(512);else if((ve=o(ue))==null)return 0;return function(ye,Se,je,Be,dt,tr){var Ke,_t,Xt=Se,Mr=1<<je,hr=o(16),Wr=o(16);for(t(dt!=0),t(Be!=null),t(ye!=null),t(0<je),_t=0;_t<dt;++_t){if(15<Be[_t])return 0;++hr[Be[_t]]}if(hr[0]==dt)return 0;for(Wr[1]=0,Ke=1;15>Ke;++Ke){if(hr[Ke]>1<<Ke)return 0;Wr[Ke+1]=Wr[Ke]+hr[Ke]}for(_t=0;_t<dt;++_t)Ke=Be[_t],0<Be[_t]&&(tr[Wr[Ke]++]=_t);if(Wr[15]==1)return(Be=new T).g=0,Be.value=tr[0],O(ye,Xt,1,Mr,Be),Mr;var nn,In=-1,yn=Mr-1,Ma=0,Sa=1,vs=1,Ia=1<<je;for(_t=0,Ke=1,dt=2;Ke<=je;++Ke,dt<<=1){if(Sa+=vs<<=1,0>(vs-=hr[Ke]))return 0;for(;0<hr[Ke];--hr[Ke])(Be=new T).g=Ke,Be.value=tr[_t++],O(ye,Xt+Ma,dt,Ia,Be),Ma=M(Ma,Ke)}for(Ke=je+1,dt=2;15>=Ke;++Ke,dt<<=1){if(Sa+=vs<<=1,0>(vs-=hr[Ke]))return 0;for(;0<hr[Ke];--hr[Ke]){if(Be=new T,(Ma&yn)!=In){for(Xt+=Ia,nn=1<<(In=Ke)-je;15>In&&!(0>=(nn-=hr[In]));)++In,nn<<=1;Mr+=Ia=1<<(nn=In-je),ye[Se+(In=Ma&yn)].g=nn+je,ye[Se+In].value=Xt-Se-In}Be.g=Ke-je,Be.value=tr[_t++],O(ye,Xt+(Ma>>je),dt,Ia,Be),Ma=M(Ma,Ke)}}return Sa!=2*Wr[15]-1?0:Mr}(N,P,$,K,ue,ve)}function T(){this.value=this.g=0}function k(){this.value=this.g=0}function q(){this.G=i(5,T),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=i(Rr,k)}function B(N,P,$,K){t(N!=null),t(P!=null),t(2147483648>K),N.Ca=254,N.I=0,N.b=-8,N.Ka=0,N.oa=P,N.pa=$,N.Jd=P,N.Yc=$+K,N.Zc=4<=K?$+K-4+1:$,se(N)}function z(N,P){for(var $=0;0<P--;)$|=G(N,128)<<P;return $}function F(N,P){var $=z(N,P);return pe(N)?-$:$}function V(N,P,$,K){var ue,ve=0;for(t(N!=null),t(P!=null),t(4294967288>K),N.Sb=K,N.Ra=0,N.u=0,N.h=0,4<K&&(K=4),ue=0;ue<K;++ue)ve+=P[$+ue]<<8*ue;N.Ra=ve,N.bb=K,N.oa=P,N.pa=$}function me(N){for(;8<=N.u&&N.bb<N.Sb;)N.Ra>>>=8,N.Ra+=N.oa[N.pa+N.bb]<<le-8>>>0,++N.bb,N.u-=8;ie(N)&&(N.h=1,N.u=0)}function be(N,P){if(t(0<=P),!N.h&&P<=kn){var $=H(N)&Vr[P];return N.u+=P,me(N),$}return N.h=1,N.u=0}function U(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function L(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function H(N){return N.Ra>>>(N.u&le-1)>>>0}function ie(N){return t(N.bb<=N.Sb),N.h||N.bb==N.Sb&&N.u>le}function Y(N,P){N.u=P,N.h=ie(N)}function W(N){N.u>=we&&(t(N.u>=we),me(N))}function se(N){t(N!=null&&N.oa!=null),N.pa<N.Zc?(N.I=(N.oa[N.pa++]|N.I<<8)>>>0,N.b+=8):(t(N!=null&&N.oa!=null),N.pa<N.Yc?(N.b+=8,N.I=N.oa[N.pa++]|N.I<<8):N.Ka?N.b=0:(N.I<<=8,N.b+=8,N.Ka=1))}function pe(N){return z(N,1)}function G(N,P){var $=N.Ca;0>N.b&&se(N);var K=N.b,ue=$*P>>>8,ve=(N.I>>>K>ue)+0;for(ve?($-=ue,N.I-=ue+1<<K>>>0):$=ue+1,K=$,ue=0;256<=K;)ue+=8,K>>=8;return K=7^ue+et[K],N.b-=K,N.Ca=($<<K)-1,ve}function te(N,P,$){N[P+0]=$>>24&255,N[P+1]=$>>16&255,N[P+2]=$>>8&255,N[P+3]=255&$}function oe(N,P){return N[P+0]|N[P+1]<<8}function De(N,P){return oe(N,P)|N[P+2]<<16}function re(N,P){return oe(N,P)|oe(N,P+2)<<16}function ae(N,P){var $=1<<P;return t(N!=null),t(0<P),N.X=o($),N.X==null?0:(N.Mb=32-P,N.Xa=P,1)}function ut(N,P){t(N!=null),t(P!=null),t(N.Xa==P.Xa),n(P.X,0,N.X,0,1<<P.Xa)}function pt(){this.X=[],this.Xa=this.Mb=0}function ft(N,P,$,K){t($!=null),t(K!=null);var ue=$[0],ve=K[0];return ue==0&&(ue=(N*ve+P/2)/P),ve==0&&(ve=(P*ue+N/2)/N),0>=ue||0>=ve?0:($[0]=ue,K[0]=ve,1)}function bt(N,P){return N+(1<<P)-1>>>P}function Lt(N,P){return((4278255360&N)+(4278255360&P)>>>0&4278255360)+((16711935&N)+(16711935&P)>>>0&16711935)>>>0}function Dt(N,P){A[P]=function($,K,ue,ve,ye,Se,je){var Be;for(Be=0;Be<ye;++Be){var dt=A[N](Se[je+Be-1],ue,ve+Be);Se[je+Be]=Lt($[K+Be],dt)}}}function Bt(){this.ud=this.hd=this.jd=0}function ge(N,P){return((4278124286&(N^P))>>>1)+(N&P)>>>0}function wt(N){return 0<=N&&256>N?N:0>N?0:255<N?255:void 0}function Gt(N,P){return wt(N+(N-P+.5>>1))}function Sr(N,P,$){return Math.abs(P-$)-Math.abs(N-$)}function wr(N,P,$,K,ue,ve,ye){for(K=ve[ye-1],$=0;$<ue;++$)ve[ye+$]=K=Lt(N[P+$],K)}function he(N,P,$,K,ue){var ve;for(ve=0;ve<$;++ve){var ye=N[P+ve],Se=ye>>8&255,je=16711935&(je=(je=16711935&ye)+((Se<<16)+Se));K[ue+ve]=(4278255360&ye)+je>>>0}}function ot(N,P){P.jd=255&N,P.hd=N>>8&255,P.ud=N>>16&255}function Vt(N,P,$,K,ue,ve){var ye;for(ye=0;ye<K;++ye){var Se=P[$+ye],je=Se>>>8,Be=Se,dt=255&(dt=(dt=Se>>>16)+((N.jd<<24>>24)*(je<<24>>24)>>>5));Be=255&(Be=(Be+=(N.hd<<24>>24)*(je<<24>>24)>>>5)+((N.ud<<24>>24)*(dt<<24>>24)>>>5)),ue[ve+ye]=(4278255360&Se)+(dt<<16)+Be}}function qt(N,P,$,K,ue){A[P]=function(ve,ye,Se,je,Be,dt,tr,Ke,_t){for(je=tr;je<Ke;++je)for(tr=0;tr<_t;++tr)Be[dt++]=ue(Se[K(ve[ye++])])},A[N]=function(ve,ye,Se,je,Be,dt,tr){var Ke=8>>ve.b,_t=ve.Ea,Xt=ve.K[0],Mr=ve.w;if(8>Ke)for(ve=(1<<ve.b)-1,Mr=(1<<Ke)-1;ye<Se;++ye){var hr,Wr=0;for(hr=0;hr<_t;++hr)hr&ve||(Wr=K(je[Be++])),dt[tr++]=ue(Xt[Wr&Mr]),Wr>>=Ke}else A["VP8LMapColor"+$](je,Be,Xt,Mr,dt,tr,ye,Se,_t)}}function Re(N,P,$,K,ue){for($=P+$;P<$;){var ve=N[P++];K[ue++]=ve>>16&255,K[ue++]=ve>>8&255,K[ue++]=255&ve}}function Ct(N,P,$,K,ue){for($=P+$;P<$;){var ve=N[P++];K[ue++]=ve>>16&255,K[ue++]=ve>>8&255,K[ue++]=255&ve,K[ue++]=ve>>24&255}}function Wt(N,P,$,K,ue){for($=P+$;P<$;){var ve=(ye=N[P++])>>16&240|ye>>12&15,ye=240&ye|ye>>28&15;K[ue++]=ve,K[ue++]=ye}}function Er(N,P,$,K,ue){for($=P+$;P<$;){var ve=(ye=N[P++])>>16&248|ye>>13&7,ye=ye>>5&224|ye>>3&31;K[ue++]=ve,K[ue++]=ye}}function Me(N,P,$,K,ue){for($=P+$;P<$;){var ve=N[P++];K[ue++]=255&ve,K[ue++]=ve>>8&255,K[ue++]=ve>>16&255}}function lt(N,P,$,K,ue,ve){if(ve==0)for($=P+$;P<$;)te(K,((ve=N[P++])[0]>>24|ve[1]>>8&65280|ve[2]<<8&16711680|ve[3]<<24)>>>0),ue+=32;else n(K,ue,N,P,$)}function gt(N,P){A[P][0]=A[N+"0"],A[P][1]=A[N+"1"],A[P][2]=A[N+"2"],A[P][3]=A[N+"3"],A[P][4]=A[N+"4"],A[P][5]=A[N+"5"],A[P][6]=A[N+"6"],A[P][7]=A[N+"7"],A[P][8]=A[N+"8"],A[P][9]=A[N+"9"],A[P][10]=A[N+"10"],A[P][11]=A[N+"11"],A[P][12]=A[N+"12"],A[P][13]=A[N+"13"],A[P][14]=A[N+"0"],A[P][15]=A[N+"0"]}function or(N){return N==ba||N==Ws||N==Bs||N==oo}function br(){this.eb=[],this.size=this.A=this.fb=0}function ur(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function an(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new br,this.f.kb=new ur,this.sd=null}function zr(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Gr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ha(N){return alert("todo:WebPSamplerProcessPlane"),N.T}function pn(N,P){var $=N.T,K=P.ba.f.RGBA,ue=K.eb,ve=K.fb+N.ka*K.A,ye=Ql[P.ba.S],Se=N.y,je=N.O,Be=N.f,dt=N.N,tr=N.ea,Ke=N.W,_t=P.cc,Xt=P.dc,Mr=P.Mc,hr=P.Nc,Wr=N.ka,nn=N.ka+N.T,In=N.U,yn=In+1>>1;for(Wr==0?ye(Se,je,null,null,Be,dt,tr,Ke,Be,dt,tr,Ke,ue,ve,null,null,In):(ye(P.ec,P.fc,Se,je,_t,Xt,Mr,hr,Be,dt,tr,Ke,ue,ve-K.A,ue,ve,In),++$);Wr+2<nn;Wr+=2)_t=Be,Xt=dt,Mr=tr,hr=Ke,dt+=N.Rc,Ke+=N.Rc,ve+=2*K.A,ye(Se,(je+=2*N.fa)-N.fa,Se,je,_t,Xt,Mr,hr,Be,dt,tr,Ke,ue,ve-K.A,ue,ve,In);return je+=N.fa,N.j+nn<N.o?(n(P.ec,P.fc,Se,je,In),n(P.cc,P.dc,Be,dt,yn),n(P.Mc,P.Nc,tr,Ke,yn),$--):1&nn||ye(Se,je,null,null,Be,dt,tr,Ke,Be,dt,tr,Ke,ue,ve+K.A,null,null,In),$}function on(N,P,$){var K=N.F,ue=[N.J];if(K!=null){var ve=N.U,ye=P.ba.S,Se=ye==js||ye==Bs;P=P.ba.f.RGBA;var je=[0],Be=N.ka;je[0]=N.T,N.Kb&&(Be==0?--je[0]:(--Be,ue[0]-=N.width),N.j+N.ka+N.T==N.o&&(je[0]=N.o-N.j-Be));var dt=P.eb;Be=P.fb+Be*P.A,N=Jt(K,ue[0],N.width,ve,je,dt,Be+(Se?0:3),P.A),t($==je),N&&or(ye)&&yt(dt,Be,Se,ve,je,P.A)}return 0}function cn(N){var P=N.ma,$=P.ba.S,K=11>$,ue=$==La||$==Ss||$==js||$==Rs||$==12||or($);if(P.memory=null,P.Ib=null,P.Jb=null,P.Nd=null,!_r(P.Oa,N,ue?11:12))return 0;if(ue&&or($)&&Fn(),N.da)alert("todo:use_scaling");else{if(K){if(P.Ib=ha,N.Kb){if($=N.U+1>>1,P.memory=o(N.U+2*$),P.memory==null)return 0;P.ec=P.memory,P.fc=0,P.cc=P.ec,P.dc=P.fc+N.U,P.Mc=P.cc,P.Nc=P.dc+$,P.Ib=pn,Fn()}}else alert("todo:EmitYUV");ue&&(P.Jb=on,K&&Qr())}if(K&&!ga){for(N=0;256>N;++N)Ci[N]=89858*(N-128)+Pn>>tn,zd[N]=-22014*(N-128)+Pn,Dl[N]=-45773*(N-128),vl[N]=113618*(N-128)+Pn>>tn;for(N=Cn;N<qa;++N)P=76283*(N-16)+Pn>>tn,Zl[N-Cn]=rn(P,255),Ud[N-Cn]=rn(P+8>>4,15);ga=1}return 1}function ke(N){var P=N.ma,$=N.U,K=N.T;return t(!(1&N.ka)),0>=$||0>=K?0:($=P.Ib(N,P),P.Jb!=null&&P.Jb(N,P,$),P.Dc+=$,1)}function We(N){N.ma.memory=null}function Ze(N,P,$,K){return be(N,8)!=47?0:(P[0]=be(N,14)+1,$[0]=be(N,14)+1,K[0]=be(N,1),be(N,3)!=0?0:!N.h)}function Je(N,P){if(4>N)return N+1;var $=N-2>>1;return(2+(1&N)<<$)+be(P,$)+1}function At(N,P){return 120<P?P-120:1<=($=(($=Zi[P-1])>>4)*N+(8-(15&$)))?$:1;var $}function Ye(N,P,$){var K=H($),ue=N[P+=255&K].g-8;return 0<ue&&(Y($,$.u+8),K=H($),P+=N[P].value,P+=K&(1<<ue)-1),Y($,$.u+N[P].g),N[P].value}function lr(N,P,$){return $.g+=N.g,$.value+=N.value<<P>>>0,t(8>=$.g),N.g}function ce(N,P,$){var K=N.xc;return t((P=K==0?0:N.vc[N.md*($>>K)+(P>>K)])<N.Wb),N.Ya[P]}function qe(N,P,$,K){var ue=N.ab,ve=N.c*P,ye=N.C;P=ye+P;var Se=$,je=K;for(K=N.Ta,$=N.Ua;0<ue--;){var Be=N.gc[ue],dt=ye,tr=P,Ke=Se,_t=je,Xt=(je=K,Se=$,Be.Ea);switch(t(dt<tr),t(tr<=Be.nc),Be.hc){case 2:tt(Ke,_t,(tr-dt)*Xt,je,Se);break;case 0:var Mr=dt,hr=tr,Wr=je,nn=Se,In=(Ia=Be).Ea;Mr==0&&(_e(Ke,_t,null,null,1,Wr,nn),wr(Ke,_t+1,0,0,In-1,Wr,nn+1),_t+=In,nn+=In,++Mr);for(var yn=1<<Ia.b,Ma=yn-1,Sa=bt(In,Ia.b),vs=Ia.K,Ia=Ia.w+(Mr>>Ia.b)*Sa;Mr<hr;){var Fs=vs,Fi=Ia,ys=1;for(St(Ke,_t,Wr,nn-In,1,Wr,nn);ys<In;){var Oa=(ys&~Ma)+yn;Oa>In&&(Oa=In),(0,Sn[Fs[Fi++]>>8&15])(Ke,_t+ +ys,Wr,nn+ys-In,Oa-ys,Wr,nn+ys),ys=Oa}_t+=In,nn+=In,++Mr&Ma||(Ia+=Sa)}tr!=Be.nc&&n(je,Se-Xt,je,Se+(tr-dt-1)*Xt,Xt);break;case 1:for(Xt=Ke,hr=_t,In=(Ke=Be.Ea)-(nn=Ke&~(Wr=(_t=1<<Be.b)-1)),Mr=bt(Ke,Be.b),yn=Be.K,Be=Be.w+(dt>>Be.b)*Mr;dt<tr;){for(Ma=yn,Sa=Be,vs=new Bt,Ia=hr+nn,Fs=hr+Ke;hr<Ia;)ot(Ma[Sa++],vs),wn(vs,Xt,hr,_t,je,Se),hr+=_t,Se+=_t;hr<Fs&&(ot(Ma[Sa++],vs),wn(vs,Xt,hr,In,je,Se),hr+=In,Se+=In),++dt&Wr||(Be+=Mr)}break;case 3:if(Ke==je&&_t==Se&&0<Be.b){for(hr=je,Ke=Xt=Se+(tr-dt)*Xt-(nn=(tr-dt)*bt(Be.Ea,Be.b)),_t=je,Wr=Se,Mr=[],nn=(In=nn)-1;0<=nn;--nn)Mr[nn]=_t[Wr+nn];for(nn=In-1;0<=nn;--nn)hr[Ke+nn]=Mr[nn];Ne(Be,dt,tr,je,Xt,je,Se)}else Ne(Be,dt,tr,Ke,_t,je,Se)}Se=K,je=$}je!=$&&n(K,$,Se,je,ve)}function ze(N,P){var $=N.V,K=N.Ba+N.c*N.C,ue=P-N.C;if(t(P<=N.l.o),t(16>=ue),0<ue){var ve=N.l,ye=N.Ta,Se=N.Ua,je=ve.width;if(qe(N,ue,$,K),ue=Se=[Se],t(($=N.C)<(K=P)),t(ve.v<ve.va),K>ve.o&&(K=ve.o),$<ve.j){var Be=ve.j-$;$=ve.j,ue[0]+=Be*je}if($>=K?$=0:(ue[0]+=4*ve.v,ve.ka=$-ve.j,ve.U=ve.va-ve.v,ve.T=K-$,$=1),$){if(Se=Se[0],11>($=N.ca).S){var dt=$.f.RGBA,tr=(K=$.S,ue=ve.U,ve=ve.T,Be=dt.eb,dt.A),Ke=ve;for(dt=dt.fb+N.Ma*dt.A;0<Ke--;){var _t=ye,Xt=Se,Mr=ue,hr=Be,Wr=dt;switch(K){case ps:$n(_t,Xt,Mr,hr,Wr);break;case La:En(_t,Xt,Mr,hr,Wr);break;case ba:En(_t,Xt,Mr,hr,Wr),yt(hr,Wr,0,Mr,1,0);break;case xa:Ys(_t,Xt,Mr,hr,Wr);break;case Ss:lt(_t,Xt,Mr,hr,Wr,1);break;case Ws:lt(_t,Xt,Mr,hr,Wr,1),yt(hr,Wr,0,Mr,1,0);break;case js:lt(_t,Xt,Mr,hr,Wr,0);break;case Bs:lt(_t,Xt,Mr,hr,Wr,0),yt(hr,Wr,1,Mr,1,0);break;case Rs:pa(_t,Xt,Mr,hr,Wr);break;case oo:pa(_t,Xt,Mr,hr,Wr),Ge(hr,Wr,Mr,1,0);break;case Xn:rs(_t,Xt,Mr,hr,Wr);break;default:t(0)}Se+=je,dt+=tr}N.Ma+=ve}else alert("todo:EmitRescaledRowsYUVA");t(N.Ma<=$.height)}}N.C=P,t(N.C<=N.i)}function xt(N){var P;if(0<N.ua)return 0;for(P=0;P<N.Wb;++P){var $=N.Ya[P].G,K=N.Ya[P].H;if(0<$[1][K[1]+0].g||0<$[2][K[2]+0].g||0<$[3][K[3]+0].g)return 0}return 1}function rr(N,P,$,K,ue,ve){if(N.Z!=0){var ye=N.qd,Se=N.rd;for(t(Iu[N.Z]!=null);P<$;++P)Iu[N.Z](ye,Se,K,ue,K,ue,ve),ye=K,Se=ue,ue+=ve;N.qd=ye,N.rd=Se}}function ir(N,P){var $=N.l.ma,K=$.Z==0||$.Z==1?N.l.j:N.C;if(K=N.C<K?K:N.C,t(P<=N.l.o),P>K){var ue=N.l.width,ve=$.ca,ye=$.tb+ue*K,Se=N.V,je=N.Ba+N.c*K,Be=N.gc;t(N.ab==1),t(Be[0].hc==3),Qe(Be[0],K,P,Se,je,ve,ye),rr($,K,P,ve,ye,ue)}N.C=N.Ma=P}function Kr(N,P,$,K,ue,ve,ye){var Se=N.$/K,je=N.$%K,Be=N.m,dt=N.s,tr=$+N.$,Ke=tr;ue=$+K*ue;var _t=$+K*ve,Xt=280+dt.ua,Mr=N.Pb?Se:16777216,hr=0<dt.ua?dt.Wa:null,Wr=dt.wc,nn=tr<_t?ce(dt,je,Se):null;t(N.C<ve),t(_t<=ue);var In=!1;e:for(;;){for(;In||tr<_t;){var yn=0;if(Se>=Mr){var Ma=tr-$;t((Mr=N).Pb),Mr.wd=Mr.m,Mr.xd=Ma,0<Mr.s.ua&&ut(Mr.s.Wa,Mr.s.vb),Mr=Se+rm}if(je&Wr||(nn=ce(dt,je,Se)),t(nn!=null),nn.Qb&&(P[tr]=nn.qb,In=!0),!In)if(W(Be),nn.jc){yn=Be,Ma=P;var Sa=tr,vs=nn.pd[H(yn)&Rr-1];t(nn.jc),256>vs.g?(Y(yn,yn.u+vs.g),Ma[Sa]=vs.value,yn=0):(Y(yn,yn.u+vs.g-256),t(256<=vs.value),yn=vs.value),yn==0&&(In=!0)}else yn=Ye(nn.G[0],nn.H[0],Be);if(Be.h)break;if(In||256>yn){if(!In)if(nn.nd)P[tr]=(nn.qb|yn<<8)>>>0;else{if(W(Be),In=Ye(nn.G[1],nn.H[1],Be),W(Be),Ma=Ye(nn.G[2],nn.H[2],Be),Sa=Ye(nn.G[3],nn.H[3],Be),Be.h)break;P[tr]=(Sa<<24|In<<16|yn<<8|Ma)>>>0}if(In=!1,++tr,++je>=K&&(je=0,++Se,ye!=null&&Se<=ve&&!(Se%16)&&ye(N,Se),hr!=null))for(;Ke<tr;)yn=P[Ke++],hr.X[(506832829*yn&4294967295)>>>hr.Mb]=yn}else if(280>yn){if(yn=Je(yn-256,Be),Ma=Ye(nn.G[4],nn.H[4],Be),W(Be),Ma=At(K,Ma=Je(Ma,Be)),Be.h)break;if(tr-$<Ma||ue-tr<yn)break e;for(Sa=0;Sa<yn;++Sa)P[tr+Sa]=P[tr+Sa-Ma];for(tr+=yn,je+=yn;je>=K;)je-=K,++Se,ye!=null&&Se<=ve&&!(Se%16)&&ye(N,Se);if(t(tr<=ue),je&Wr&&(nn=ce(dt,je,Se)),hr!=null)for(;Ke<tr;)yn=P[Ke++],hr.X[(506832829*yn&4294967295)>>>hr.Mb]=yn}else{if(!(yn<Xt))break e;for(In=yn-280,t(hr!=null);Ke<tr;)yn=P[Ke++],hr.X[(506832829*yn&4294967295)>>>hr.Mb]=yn;yn=tr,t(!(In>>>(Ma=hr).Xa)),P[yn]=Ma.X[In],In=!0}In||t(Be.h==ie(Be))}if(N.Pb&&Be.h&&tr<ue)t(N.m.h),N.a=5,N.m=N.wd,N.$=N.xd,0<N.s.ua&&ut(N.s.vb,N.s.Wa);else{if(Be.h)break e;ye?.(N,Se>ve?ve:Se),N.a=0,N.$=tr-$}return 1}return N.a=3,0}function jr(N){t(N!=null),N.vc=null,N.yc=null,N.Ya=null;var P=N.Wa;P!=null&&(P.X=null),N.vb=null,t(N!=null)}function sa(){var N=new Ae;return N==null?null:(N.a=0,N.xb=Lj,gt("Predictor","VP8LPredictors"),gt("Predictor","VP8LPredictors_C"),gt("PredictorAdd","VP8LPredictorsAdd"),gt("PredictorAdd","VP8LPredictorsAdd_C"),tt=he,wn=Vt,$n=Re,En=Ct,pa=Wt,rs=Er,Ys=Me,A.VP8LMapColor32b=Mt,A.VP8LMapColor8b=ar,N)}function ia(N,P,$,K,ue){var ve=1,ye=[N],Se=[P],je=K.m,Be=K.s,dt=null,tr=0;e:for(;;){if($)for(;ve&&be(je,1);){var Ke=ye,_t=Se,Xt=K,Mr=1,hr=Xt.m,Wr=Xt.gc[Xt.ab],nn=be(hr,2);if(Xt.Oc&1<<nn)ve=0;else{switch(Xt.Oc|=1<<nn,Wr.hc=nn,Wr.Ea=Ke[0],Wr.nc=_t[0],Wr.K=[null],++Xt.ab,t(4>=Xt.ab),nn){case 0:case 1:Wr.b=be(hr,3)+2,Mr=ia(bt(Wr.Ea,Wr.b),bt(Wr.nc,Wr.b),0,Xt,Wr.K),Wr.K=Wr.K[0];break;case 3:var In,yn=be(hr,8)+1,Ma=16<yn?0:4<yn?1:2<yn?2:3;if(Ke[0]=bt(Wr.Ea,Ma),Wr.b=Ma,In=Mr=ia(yn,1,0,Xt,Wr.K)){var Sa,vs=yn,Ia=Wr,Fs=1<<(8>>Ia.b),Fi=o(Fs);if(Fi==null)In=0;else{var ys=Ia.K[0],Oa=Ia.w;for(Fi[0]=Ia.K[0][0],Sa=1;Sa<1*vs;++Sa)Fi[Sa]=Lt(ys[Oa+Sa],Fi[Sa-1]);for(;Sa<4*Fs;++Sa)Fi[Sa]=0;Ia.K[0]=null,Ia.K[0]=Fi,In=1}}Mr=In;break;case 2:break;default:t(0)}ve=Mr}}if(ye=ye[0],Se=Se[0],ve&&be(je,1)&&!(ve=1<=(tr=be(je,4))&&11>=tr)){K.a=3;break e}var Qn;if(Qn=ve)t:{var gi,gs,qs,Mo=K,yl=ye,ec=Se,ii=tr,Ml=$,tc=Mo.m,Li=Mo.s,Hs=[null],co=1,li=0,uo=td[ii];r:for(;;){if(Ml&&be(tc,1)){var bl=be(tc,3)+2,Ou=bt(yl,bl),xi=bt(ec,bl),Pc=Ou*xi;if(!ia(Ou,xi,0,Mo,Hs))break r;for(Hs=Hs[0],Li.xc=bl,gi=0;gi<Pc;++gi){var wo=Hs[gi]>>8&65535;Hs[gi]=wo,wo>=co&&(co=wo+1)}}if(tc.h)break r;for(gs=0;5>gs;++gs){var $i=wa[gs];!gs&&0<ii&&($i+=1<<ii),li<$i&&(li=$i)}var ad=i(co*uo,T),rc=co,sd=i(rc,q);if(sd==null)var od=null;else t(65536>=rc),od=sd;var Ec=o(li);if(od==null||Ec==null||ad==null){Mo.a=1;break r}var id=ad;for(gi=qs=0;gi<co;++gi){var So=od[gi],ld=So.G,Tu=So.H,Bp=0,am=1,wl=0;for(gs=0;5>gs;++gs){$i=wa[gs],ld[gs]=id,Tu[gs]=qs,!gs&&0<ii&&($i+=1<<ii);a:{var $j,XA=$i,Bj=Mo,Ty=Ec,mie=id,hie=qs,YA=0,th=Bj.m,pie=be(th,1);if(s(Ty,0,0,XA),pie){var gie=be(th,1)+1,xie=be(th,1),EF=be(th,xie==0?1:8);Ty[EF]=1,gie==2&&(Ty[EF=be(th,8)]=1);var qj=1}else{var kF=o(19),IF=be(th,4)+4;if(19<IF){Bj.a=3;var zj=0;break a}for($j=0;$j<IF;++$j)kF[xo[$j]]=be(th,3);var JA=void 0,Dy=void 0,OF=Bj,vie=kF,Uj=XA,TF=Ty,QA=0,rh=OF.m,DF=8,MF=i(128,T);n:for(;I(MF,0,7,vie,19);){if(be(rh,1)){var yie=2+2*be(rh,3);if((JA=2+be(rh,yie))>Uj)break n}else JA=Uj;for(Dy=0;Dy<Uj&&JA--;){W(rh);var RF=MF[0+(127&H(rh))];Y(rh,rh.u+RF.g);var Ex=RF.value;if(16>Ex)TF[Dy++]=Ex,Ex!=0&&(DF=Ex);else{var bie=Ex==16,FF=Ex-16,wie=Qi[FF],LF=be(rh,ed[FF])+wie;if(Dy+LF>Uj)break n;for(var jie=bie?DF:0;0<LF--;)TF[Dy++]=jie}}QA=1;break n}QA||(OF.a=3),qj=QA}(qj=qj&&!th.h)&&(YA=I(mie,hie,8,Ty,XA)),qj&&YA!=0?zj=YA:(Bj.a=3,zj=0)}if(zj==0)break r;if(am&&Za[gs]==1&&(am=id[qs].g==0),Bp+=id[qs].g,qs+=zj,3>=gs){var My,ZA=Ec[0];for(My=1;My<$i;++My)Ec[My]>ZA&&(ZA=Ec[My]);wl+=ZA}}if(So.nd=am,So.Qb=0,am&&(So.qb=(ld[3][Tu[3]+0].value<<24|ld[1][Tu[1]+0].value<<16|ld[2][Tu[2]+0].value)>>>0,Bp==0&&256>ld[0][Tu[0]+0].value&&(So.Qb=1,So.qb+=ld[0][Tu[0]+0].value<<8)),So.jc=!So.Qb&&6>wl,So.jc){var Vj,sm=So;for(Vj=0;Vj<Rr;++Vj){var nh=Vj,ah=sm.pd[nh],Wj=sm.G[0][sm.H[0]+nh];256<=Wj.value?(ah.g=Wj.g+256,ah.value=Wj.value):(ah.g=0,ah.value=0,nh>>=lr(Wj,8,ah),nh>>=lr(sm.G[1][sm.H[1]+nh],16,ah),nh>>=lr(sm.G[2][sm.H[2]+nh],0,ah),lr(sm.G[3][sm.H[3]+nh],24,ah))}}}Li.vc=Hs,Li.Wb=co,Li.Ya=od,Li.yc=ad,Qn=1;break t}Qn=0}if(!(ve=Qn)){K.a=3;break e}if(0<tr){if(Be.ua=1<<tr,!ae(Be.Wa,tr)){K.a=1,ve=0;break e}}else Be.ua=0;var eP=K,$F=ye,_ie=Se,tP=eP.s,rP=tP.xc;if(eP.c=$F,eP.i=_ie,tP.md=bt($F,rP),tP.wc=rP==0?-1:(1<<rP)-1,$){K.xb=KA;break e}if((dt=o(ye*Se))==null){K.a=1,ve=0;break e}ve=(ve=Kr(K,dt,0,ye,Se,Se,null))&&!je.h;break e}return ve?(ue!=null?ue[0]=dt:(t(dt==null),t($)),K.$=0,$||jr(Be)):jr(Be),ve}function Kn(N,P){var $=N.c*N.i,K=$+P+16*P;return t(N.c<=P),N.V=o(K),N.V==null?(N.Ta=null,N.Ua=0,N.a=1,0):(N.Ta=N.V,N.Ua=N.Ba+$+P,1)}function at(N,P){var $=N.C,K=P-$,ue=N.V,ve=N.Ba+N.c*$;for(t(P<=N.l.o);0<K;){var ye=16<K?16:K,Se=N.l.ma,je=N.l.width,Be=je*ye,dt=Se.ca,tr=Se.tb+je*$,Ke=N.Ta,_t=N.Ua;qe(N,ye,ue,ve),Kt(Ke,_t,dt,tr,Be),rr(Se,$,$+ye,dt,tr,je),K-=ye,ue+=ye*N.c,$+=ye}t($==P),N.C=N.Ma=P}function Te(){this.ub=this.yd=this.td=this.Rb=0}function Fe(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function cr(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function ht(){this.Yb=function(){var N=[];return function P($,K,ue){for(var ve=ue[K],ye=0;ye<ve&&($.push(ue.length>K+1?[]:0),!(ue.length<K+1));ye++)P($[ye],K+1,ue)}(N,0,[3,11]),N}()}function Xr(){this.jb=o(3),this.Wc=l([4,8],ht),this.Xc=l([4,17],ht)}function Ft(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function kr(){this.ld=this.La=this.dd=this.tc=0}function jt(){this.Na=this.la=0}function er(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Nt(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Cr(){this.uc=this.M=this.Nb=0,this.wa=Array(new kr),this.Y=0,this.ya=Array(new Nt),this.aa=0,this.l=new ra}function Lr(){this.y=o(16),this.f=o(8),this.ea=o(8)}function un(){this.cb=this.a=0,this.sc="",this.m=new U,this.Od=new Te,this.Kc=new Fe,this.ed=new Ft,this.Qa=new cr,this.Ic=this.$c=this.Aa=0,this.D=new Cr,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=i(8,U),this.ia=0,this.pb=i(4,er),this.Pa=new Xr,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Lr),this.Hd=0,this.rb=Array(new jt),this.sb=0,this.wa=Array(new kr),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Nt),this.L=this.aa=0,this.gd=l([4,2],kr),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function ra(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Wn(){var N=new un;return N!=null&&(N.a=0,N.sc="OK",N.cb=0,N.Xb=0,Tl||(Tl=oa)),N}function ln(N,P,$){return N.a==0&&(N.a=P,N.sc=$,N.cb=0),0}function da(N,P,$){return 3<=$&&N[P+0]==157&&N[P+1]==1&&N[P+2]==42}function va(N,P){if(N==null)return 0;if(N.a=0,N.sc="OK",P==null)return ln(N,2,"null VP8Io passed to VP8GetHeaders()");var $=P.data,K=P.w,ue=P.ha;if(4>ue)return ln(N,7,"Truncated header.");var ve=$[K+0]|$[K+1]<<8|$[K+2]<<16,ye=N.Od;if(ye.Rb=!(1&ve),ye.td=ve>>1&7,ye.yd=ve>>4&1,ye.ub=ve>>5,3<ye.td)return ln(N,3,"Incorrect keyframe parameters.");if(!ye.yd)return ln(N,4,"Frame not displayable.");K+=3,ue-=3;var Se=N.Kc;if(ye.Rb){if(7>ue)return ln(N,7,"cannot parse picture header");if(!da($,K,ue))return ln(N,3,"Bad code word");Se.c=16383&($[K+4]<<8|$[K+3]),Se.Td=$[K+4]>>6,Se.i=16383&($[K+6]<<8|$[K+5]),Se.Ud=$[K+6]>>6,K+=7,ue-=7,N.za=Se.c+15>>4,N.Ub=Se.i+15>>4,P.width=Se.c,P.height=Se.i,P.Da=0,P.j=0,P.v=0,P.va=P.width,P.o=P.height,P.da=0,P.ib=P.width,P.hb=P.height,P.U=P.width,P.T=P.height,s((ve=N.Pa).jb,0,255,ve.jb.length),t((ve=N.Qa)!=null),ve.Cb=0,ve.Bb=0,ve.Fb=1,s(ve.Zb,0,0,ve.Zb.length),s(ve.Lb,0,0,ve.Lb)}if(ye.ub>ue)return ln(N,7,"bad partition length");B(ve=N.m,$,K,ye.ub),K+=ye.ub,ue-=ye.ub,ye.Rb&&(Se.Ld=pe(ve),Se.Kd=pe(ve)),Se=N.Qa;var je,Be=N.Pa;if(t(ve!=null),t(Se!=null),Se.Cb=pe(ve),Se.Cb){if(Se.Bb=pe(ve),pe(ve)){for(Se.Fb=pe(ve),je=0;4>je;++je)Se.Zb[je]=pe(ve)?F(ve,7):0;for(je=0;4>je;++je)Se.Lb[je]=pe(ve)?F(ve,6):0}if(Se.Bb)for(je=0;3>je;++je)Be.jb[je]=pe(ve)?z(ve,8):255}else Se.Bb=0;if(ve.Ka)return ln(N,3,"cannot parse segment header");if((Se=N.ed).zd=pe(ve),Se.Tb=z(ve,6),Se.wb=z(ve,3),Se.Pc=pe(ve),Se.Pc&&pe(ve)){for(Be=0;4>Be;++Be)pe(ve)&&(Se.vd[Be]=F(ve,6));for(Be=0;4>Be;++Be)pe(ve)&&(Se.od[Be]=F(ve,6))}if(N.L=Se.Tb==0?0:Se.zd?1:2,ve.Ka)return ln(N,3,"cannot parse filter header");var dt=ue;if(ue=je=K,K=je+dt,Se=dt,N.Xb=(1<<z(N.m,2))-1,dt<3*(Be=N.Xb))$=7;else{for(je+=3*Be,Se-=3*Be,dt=0;dt<Be;++dt){var tr=$[ue+0]|$[ue+1]<<8|$[ue+2]<<16;tr>Se&&(tr=Se),B(N.Jc[+dt],$,je,tr),je+=tr,Se-=tr,ue+=3}B(N.Jc[+Be],$,je,Se),$=je<K?0:5}if($!=0)return ln(N,$,"cannot parse partitions");for($=z(je=N.m,7),ue=pe(je)?F(je,4):0,K=pe(je)?F(je,4):0,Se=pe(je)?F(je,4):0,Be=pe(je)?F(je,4):0,je=pe(je)?F(je,4):0,dt=N.Qa,tr=0;4>tr;++tr){if(dt.Cb){var Ke=dt.Zb[tr];dt.Fb||(Ke+=$)}else{if(0<tr){N.pb[tr]=N.pb[0];continue}Ke=$}var _t=N.pb[tr];_t.Sc[0]=Pu[rn(Ke+ue,127)],_t.Sc[1]=Yl[rn(Ke+0,127)],_t.Eb[0]=2*Pu[rn(Ke+K,127)],_t.Eb[1]=101581*Yl[rn(Ke+Se,127)]>>16,8>_t.Eb[1]&&(_t.Eb[1]=8),_t.Qc[0]=Pu[rn(Ke+Be,117)],_t.Qc[1]=Yl[rn(Ke+je,127)],_t.lc=Ke+je}if(!ye.Rb)return ln(N,4,"Not a key frame.");for(pe(ve),ye=N.Pa,$=0;4>$;++$){for(ue=0;8>ue;++ue)for(K=0;3>K;++K)for(Se=0;11>Se;++Se)Be=G(ve,GA[$][ue][K][Se])?z(ve,8):Fj[$][ue][K][Se],ye.Wc[$][ue].Yb[K][Se]=Be;for(ue=0;17>ue;++ue)ye.Xc[$][ue]=ye.Wc[$][yf[ue]]}return N.kc=pe(ve),N.kc&&(N.Bd=z(ve,8)),N.cb=1}function oa(N,P,$,K,ue,ve,ye){var Se=P[ue].Yb[$];for($=0;16>ue;++ue){if(!G(N,Se[$+0]))return ue;for(;!G(N,Se[$+1]);)if(Se=P[++ue].Yb[0],$=0,ue==16)return 16;var je=P[ue+1].Yb;if(G(N,Se[$+2])){var Be=N,dt=0;if(G(Be,(Ke=Se)[(tr=$)+3]))if(G(Be,Ke[tr+6])){for(Se=0,tr=2*(dt=G(Be,Ke[tr+8]))+(Ke=G(Be,Ke[tr+9+dt])),dt=0,Ke=ky[tr];Ke[Se];++Se)dt+=dt+G(Be,Ke[Se]);dt+=3+(8<<tr)}else G(Be,Ke[tr+7])?(dt=7+2*G(Be,165),dt+=G(Be,145)):dt=5+G(Be,159);else dt=G(Be,Ke[tr+4])?3+G(Be,Ke[tr+5]):2;Se=je[2]}else dt=1,Se=je[1];je=ye+Iy[ue],0>(Be=N).b&&se(Be);var tr,Ke=Be.b,_t=(tr=Be.Ca>>1)-(Be.I>>Ke)>>31;--Be.b,Be.Ca+=_t,Be.Ca|=1,Be.I-=(tr+1&_t)<<Ke,ve[je]=((dt^_t)-_t)*K[(0<ue)+0]}return 16}function Tn(N){var P=N.rb[N.sb-1];P.la=0,P.Na=0,s(N.zc,0,0,N.zc.length),N.ja=0}function ee(N,P,$,K,ue){ue=N[P+$+32*K]+(ue>>3),N[P+$+32*K]=-256&ue?0>ue?0:255:ue}function Ie(N,P,$,K,ue,ve){ee(N,P,0,$,K+ue),ee(N,P,1,$,K+ve),ee(N,P,2,$,K-ve),ee(N,P,3,$,K-ue)}function Oe(N){return(20091*N>>16)+N}function Yt(N,P,$,K){var ue,ve=0,ye=o(16);for(ue=0;4>ue;++ue){var Se=N[P+0]+N[P+8],je=N[P+0]-N[P+8],Be=(35468*N[P+4]>>16)-Oe(N[P+12]),dt=Oe(N[P+4])+(35468*N[P+12]>>16);ye[ve+0]=Se+dt,ye[ve+1]=je+Be,ye[ve+2]=je-Be,ye[ve+3]=Se-dt,ve+=4,P++}for(ue=ve=0;4>ue;++ue)Se=(N=ye[ve+0]+4)+ye[ve+8],je=N-ye[ve+8],Be=(35468*ye[ve+4]>>16)-Oe(ye[ve+12]),ee($,K,0,0,Se+(dt=Oe(ye[ve+4])+(35468*ye[ve+12]>>16))),ee($,K,1,0,je+Be),ee($,K,2,0,je-Be),ee($,K,3,0,Se-dt),ve++,K+=32}function Pt(N,P,$,K){var ue=N[P+0]+4,ve=35468*N[P+4]>>16,ye=Oe(N[P+4]),Se=35468*N[P+1]>>16;Ie($,K,0,ue+ye,N=Oe(N[P+1]),Se),Ie($,K,1,ue+ve,N,Se),Ie($,K,2,ue-ve,N,Se),Ie($,K,3,ue-ye,N,Se)}function Qt(N,P,$,K,ue){Yt(N,P,$,K),ue&&Yt(N,P+16,$,K+4)}function nr(N,P,$,K){na(N,P+0,$,K,1),na(N,P+32,$,K+128,1)}function fn(N,P,$,K){var ue;for(N=N[P+0]+4,ue=0;4>ue;++ue)for(P=0;4>P;++P)ee($,K,P,ue,N)}function J(N,P,$,K){N[P+0]&&Ea(N,P+0,$,K),N[P+16]&&Ea(N,P+16,$,K+4),N[P+32]&&Ea(N,P+32,$,K+128),N[P+48]&&Ea(N,P+48,$,K+128+4)}function Xe(N,P,$,K){var ue,ve=o(16);for(ue=0;4>ue;++ue){var ye=N[P+0+ue]+N[P+12+ue],Se=N[P+4+ue]+N[P+8+ue],je=N[P+4+ue]-N[P+8+ue],Be=N[P+0+ue]-N[P+12+ue];ve[0+ue]=ye+Se,ve[8+ue]=ye-Se,ve[4+ue]=Be+je,ve[12+ue]=Be-je}for(ue=0;4>ue;++ue)ye=(N=ve[0+4*ue]+3)+ve[3+4*ue],Se=ve[1+4*ue]+ve[2+4*ue],je=ve[1+4*ue]-ve[2+4*ue],Be=N-ve[3+4*ue],$[K+0]=ye+Se>>3,$[K+16]=Be+je>>3,$[K+32]=ye-Se>>3,$[K+48]=Be-je>>3,K+=64}function He(N,P,$){var K,ue=P-32,ve=qn,ye=255-N[ue-1];for(K=0;K<$;++K){var Se,je=ve,Be=ye+N[P-1];for(Se=0;Se<$;++Se)N[P+Se]=je[Be+N[ue+Se]];P+=32}}function fe(N,P){He(N,P,4)}function Ve(N,P){He(N,P,8)}function xe(N,P){He(N,P,16)}function kt(N,P){var $;for($=0;16>$;++$)n(N,P+32*$,N,P-32,16)}function st(N,P){var $;for($=16;0<$;--$)s(N,P,N[P-1],16),P+=32}function zt(N,P,$){var K;for(K=0;16>K;++K)s(P,$+32*K,N,16)}function pr(N,P){var $,K=16;for($=0;16>$;++$)K+=N[P-1+32*$]+N[P+$-32];zt(K>>5,N,P)}function en(N,P){var $,K=8;for($=0;16>$;++$)K+=N[P-1+32*$];zt(K>>4,N,P)}function sn(N,P){var $,K=8;for($=0;16>$;++$)K+=N[P+$-32];zt(K>>4,N,P)}function la(N,P){zt(128,N,P)}function Nr(N,P,$){return N+2*P+$+2>>2}function xn(N,P){var $,K=P-32;for(K=new Uint8Array([Nr(N[K-1],N[K+0],N[K+1]),Nr(N[K+0],N[K+1],N[K+2]),Nr(N[K+1],N[K+2],N[K+3]),Nr(N[K+2],N[K+3],N[K+4])]),$=0;4>$;++$)n(N,P+32*$,K,0,K.length)}function Dn(N,P){var $=N[P-1],K=N[P-1+32],ue=N[P-1+64],ve=N[P-1+96];te(N,P+0,16843009*Nr(N[P-1-32],$,K)),te(N,P+32,16843009*Nr($,K,ue)),te(N,P+64,16843009*Nr(K,ue,ve)),te(N,P+96,16843009*Nr(ue,ve,ve))}function Pa(N,P){var $,K=4;for($=0;4>$;++$)K+=N[P+$-32]+N[P-1+32*$];for(K>>=3,$=0;4>$;++$)s(N,P+32*$,K,4)}function Aa(N,P){var $=N[P-1+0],K=N[P-1+32],ue=N[P-1+64],ve=N[P-1-32],ye=N[P+0-32],Se=N[P+1-32],je=N[P+2-32],Be=N[P+3-32];N[P+0+96]=Nr(K,ue,N[P-1+96]),N[P+1+96]=N[P+0+64]=Nr($,K,ue),N[P+2+96]=N[P+1+64]=N[P+0+32]=Nr(ve,$,K),N[P+3+96]=N[P+2+64]=N[P+1+32]=N[P+0+0]=Nr(ye,ve,$),N[P+3+64]=N[P+2+32]=N[P+1+0]=Nr(Se,ye,ve),N[P+3+32]=N[P+2+0]=Nr(je,Se,ye),N[P+3+0]=Nr(Be,je,Se)}function Na(N,P){var $=N[P+1-32],K=N[P+2-32],ue=N[P+3-32],ve=N[P+4-32],ye=N[P+5-32],Se=N[P+6-32],je=N[P+7-32];N[P+0+0]=Nr(N[P+0-32],$,K),N[P+1+0]=N[P+0+32]=Nr($,K,ue),N[P+2+0]=N[P+1+32]=N[P+0+64]=Nr(K,ue,ve),N[P+3+0]=N[P+2+32]=N[P+1+64]=N[P+0+96]=Nr(ue,ve,ye),N[P+3+32]=N[P+2+64]=N[P+1+96]=Nr(ve,ye,Se),N[P+3+64]=N[P+2+96]=Nr(ye,Se,je),N[P+3+96]=Nr(Se,je,je)}function Hn(N,P){var $=N[P-1+0],K=N[P-1+32],ue=N[P-1+64],ve=N[P-1-32],ye=N[P+0-32],Se=N[P+1-32],je=N[P+2-32],Be=N[P+3-32];N[P+0+0]=N[P+1+64]=ve+ye+1>>1,N[P+1+0]=N[P+2+64]=ye+Se+1>>1,N[P+2+0]=N[P+3+64]=Se+je+1>>1,N[P+3+0]=je+Be+1>>1,N[P+0+96]=Nr(ue,K,$),N[P+0+64]=Nr(K,$,ve),N[P+0+32]=N[P+1+96]=Nr($,ve,ye),N[P+1+32]=N[P+2+96]=Nr(ve,ye,Se),N[P+2+32]=N[P+3+96]=Nr(ye,Se,je),N[P+3+32]=Nr(Se,je,Be)}function as(N,P){var $=N[P+0-32],K=N[P+1-32],ue=N[P+2-32],ve=N[P+3-32],ye=N[P+4-32],Se=N[P+5-32],je=N[P+6-32],Be=N[P+7-32];N[P+0+0]=$+K+1>>1,N[P+1+0]=N[P+0+64]=K+ue+1>>1,N[P+2+0]=N[P+1+64]=ue+ve+1>>1,N[P+3+0]=N[P+2+64]=ve+ye+1>>1,N[P+0+32]=Nr($,K,ue),N[P+1+32]=N[P+0+96]=Nr(K,ue,ve),N[P+2+32]=N[P+1+96]=Nr(ue,ve,ye),N[P+3+32]=N[P+2+96]=Nr(ve,ye,Se),N[P+3+64]=Nr(ye,Se,je),N[P+3+96]=Nr(Se,je,Be)}function to(N,P){var $=N[P-1+0],K=N[P-1+32],ue=N[P-1+64],ve=N[P-1+96];N[P+0+0]=$+K+1>>1,N[P+2+0]=N[P+0+32]=K+ue+1>>1,N[P+2+32]=N[P+0+64]=ue+ve+1>>1,N[P+1+0]=Nr($,K,ue),N[P+3+0]=N[P+1+32]=Nr(K,ue,ve),N[P+3+32]=N[P+1+64]=Nr(ue,ve,ve),N[P+3+64]=N[P+2+64]=N[P+0+96]=N[P+1+96]=N[P+2+96]=N[P+3+96]=ve}function As(N,P){var $=N[P-1+0],K=N[P-1+32],ue=N[P-1+64],ve=N[P-1+96],ye=N[P-1-32],Se=N[P+0-32],je=N[P+1-32],Be=N[P+2-32];N[P+0+0]=N[P+2+32]=$+ye+1>>1,N[P+0+32]=N[P+2+64]=K+$+1>>1,N[P+0+64]=N[P+2+96]=ue+K+1>>1,N[P+0+96]=ve+ue+1>>1,N[P+3+0]=Nr(Se,je,Be),N[P+2+0]=Nr(ye,Se,je),N[P+1+0]=N[P+3+32]=Nr($,ye,Se),N[P+1+32]=N[P+3+64]=Nr(K,$,ye),N[P+1+64]=N[P+3+96]=Nr(ue,K,$),N[P+1+96]=Nr(ve,ue,K)}function Vs(N,P){var $;for($=0;8>$;++$)n(N,P+32*$,N,P-32,8)}function ai(N,P){var $;for($=0;8>$;++$)s(N,P,N[P-1],8),P+=32}function Ni(N,P,$){var K;for(K=0;8>K;++K)s(P,$+32*K,N,8)}function Si(N,P){var $,K=8;for($=0;8>$;++$)K+=N[P+$-32]+N[P-1+32*$];Ni(K>>4,N,P)}function Sc(N,P){var $,K=4;for($=0;8>$;++$)K+=N[P+$-32];Ni(K>>3,N,P)}function Qc(N,P){var $,K=4;for($=0;8>$;++$)K+=N[P-1+32*$];Ni(K>>3,N,P)}function Cc(N,P){Ni(128,N,P)}function Yi(N,P,$){var K=N[P-$],ue=N[P+0],ve=3*(ue-K)+jn[1020+N[P-2*$]-N[P+$]],ye=fa[112+(ve+4>>3)];N[P-$]=qn[255+K+fa[112+(ve+3>>3)]],N[P+0]=qn[255+ue-ye]}function si(N,P,$,K){var ue=N[P+0],ve=N[P+$];return Fa[255+N[P-2*$]-N[P-$]]>K||Fa[255+ve-ue]>K}function zo(N,P,$,K){return 4*Fa[255+N[P-$]-N[P+0]]+Fa[255+N[P-2*$]-N[P+$]]<=K}function Uo(N,P,$,K,ue){var ve=N[P-3*$],ye=N[P-2*$],Se=N[P-$],je=N[P+0],Be=N[P+$],dt=N[P+2*$],tr=N[P+3*$];return 4*Fa[255+Se-je]+Fa[255+ye-Be]>K?0:Fa[255+N[P-4*$]-ve]<=ue&&Fa[255+ve-ye]<=ue&&Fa[255+ye-Se]<=ue&&Fa[255+tr-dt]<=ue&&Fa[255+dt-Be]<=ue&&Fa[255+Be-je]<=ue}function Ac(N,P,$,K){var ue=2*K+1;for(K=0;16>K;++K)zo(N,P+K,$,ue)&&Yi(N,P+K,$)}function gl(N,P,$,K){var ue=2*K+1;for(K=0;16>K;++K)zo(N,P+K*$,1,ue)&&Yi(N,P+K*$,1)}function qd(N,P,$,K){var ue;for(ue=3;0<ue;--ue)Ac(N,P+=4*$,$,K)}function Os(N,P,$,K){var ue;for(ue=3;0<ue;--ue)gl(N,P+=4,$,K)}function pi(N,P,$,K,ue,ve,ye,Se){for(ve=2*ve+1;0<ue--;){if(Uo(N,P,$,ve,ye))if(si(N,P,$,Se))Yi(N,P,$);else{var je=N,Be=P,dt=$,tr=je[Be-2*dt],Ke=je[Be-dt],_t=je[Be+0],Xt=je[Be+dt],Mr=je[Be+2*dt],hr=27*(nn=jn[1020+3*(_t-Ke)+jn[1020+tr-Xt]])+63>>7,Wr=18*nn+63>>7,nn=9*nn+63>>7;je[Be-3*dt]=qn[255+je[Be-3*dt]+nn],je[Be-2*dt]=qn[255+tr+Wr],je[Be-dt]=qn[255+Ke+hr],je[Be+0]=qn[255+_t-hr],je[Be+dt]=qn[255+Xt-Wr],je[Be+2*dt]=qn[255+Mr-nn]}P+=K}}function _s(N,P,$,K,ue,ve,ye,Se){for(ve=2*ve+1;0<ue--;){if(Uo(N,P,$,ve,ye))if(si(N,P,$,Se))Yi(N,P,$);else{var je=N,Be=P,dt=$,tr=je[Be-dt],Ke=je[Be+0],_t=je[Be+dt],Xt=fa[112+(4+(Mr=3*(Ke-tr))>>3)],Mr=fa[112+(Mr+3>>3)],hr=Xt+1>>1;je[Be-2*dt]=qn[255+je[Be-2*dt]+hr],je[Be-dt]=qn[255+tr+Mr],je[Be+0]=qn[255+Ke-Xt],je[Be+dt]=qn[255+_t-hr]}P+=K}}function Au(N,P,$,K,ue,ve){pi(N,P,$,1,16,K,ue,ve)}function Zc(N,P,$,K,ue,ve){pi(N,P,1,$,16,K,ue,ve)}function Ji(N,P,$,K,ue,ve){var ye;for(ye=3;0<ye;--ye)_s(N,P+=4*$,$,1,16,K,ue,ve)}function Ol(N,P,$,K,ue,ve){var ye;for(ye=3;0<ye;--ye)_s(N,P+=4,1,$,16,K,ue,ve)}function R(N,P,$,K,ue,ve,ye,Se){pi(N,P,ue,1,8,ve,ye,Se),pi($,K,ue,1,8,ve,ye,Se)}function de(N,P,$,K,ue,ve,ye,Se){pi(N,P,1,ue,8,ve,ye,Se),pi($,K,1,ue,8,ve,ye,Se)}function Ue(N,P,$,K,ue,ve,ye,Se){_s(N,P+4*ue,ue,1,8,ve,ye,Se),_s($,K+4*ue,ue,1,8,ve,ye,Se)}function vt(N,P,$,K,ue,ve,ye,Se){_s(N,P+4,1,ue,8,ve,ye,Se),_s($,K+4,1,ue,8,ve,ye,Se)}function Ht(){this.ba=new an,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Gr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ur(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function mn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function ne(){this.ua=0,this.Wa=new pt,this.vb=new pt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new q,this.yc=new T}function Ae(){this.xb=this.a=0,this.l=new ra,this.ca=new an,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new L,this.Pb=0,this.wd=new L,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new ne,this.ab=0,this.gc=i(4,mn),this.Oc=0}function Ee(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new ra,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function it(N,P,$,K,ue,ve,ye){for(N=N==null?0:N[P+0],P=0;P<ye;++P)ue[ve+P]=N+$[K+P]&255,N=ue[ve+P]}function Et(N,P,$,K,ue,ve,ye){var Se;if(N==null)it(null,null,$,K,ue,ve,ye);else for(Se=0;Se<ye;++Se)ue[ve+Se]=N[P+Se]+$[K+Se]&255}function gr(N,P,$,K,ue,ve,ye){if(N==null)it(null,null,$,K,ue,ve,ye);else{var Se,je=N[P+0],Be=je,dt=je;for(Se=0;Se<ye;++Se)Be=dt+(je=N[P+Se])-Be,dt=$[K+Se]+(-256&Be?0>Be?0:255:Be)&255,Be=je,ue[ve+Se]=dt}}function sr(N,P,$,K){var ue=P.width,ve=P.o;if(t(N!=null&&P!=null),0>$||0>=K||$+K>ve)return null;if(!N.Cc){if(N.ga==null){var ye;if(N.ga=new Ee,(ye=N.ga==null)||(ye=P.width*P.o,t(N.Gb.length==0),N.Gb=o(ye),N.Uc=0,N.Gb==null?ye=0:(N.mb=N.Gb,N.nb=N.Uc,N.rc=null,ye=1),ye=!ye),!ye){ye=N.ga;var Se=N.Fa,je=N.P,Be=N.qc,dt=N.mb,tr=N.nb,Ke=je+1,_t=Be-1,Xt=ye.l;if(t(Se!=null&&dt!=null&&P!=null),Iu[0]=null,Iu[1]=it,Iu[2]=Et,Iu[3]=gr,ye.ca=dt,ye.tb=tr,ye.c=P.width,ye.i=P.height,t(0<ye.c&&0<ye.i),1>=Be)P=0;else if(ye.$a=3&Se[je+0],ye.Z=Se[je+0]>>2&3,ye.Lc=Se[je+0]>>4&3,je=Se[je+0]>>6&3,0>ye.$a||1<ye.$a||4<=ye.Z||1<ye.Lc||je)P=0;else if(Xt.put=ke,Xt.ac=cn,Xt.bc=We,Xt.ma=ye,Xt.width=P.width,Xt.height=P.height,Xt.Da=P.Da,Xt.v=P.v,Xt.va=P.va,Xt.j=P.j,Xt.o=P.o,ye.$a)e:{t(ye.$a==1),P=sa();t:for(;;){if(P==null){P=0;break e}if(t(ye!=null),ye.mc=P,P.c=ye.c,P.i=ye.i,P.l=ye.l,P.l.ma=ye,P.l.width=ye.c,P.l.height=ye.i,P.a=0,V(P.m,Se,Ke,_t),!ia(ye.c,ye.i,1,P,null)||(P.ab==1&&P.gc[0].hc==3&&xt(P.s)?(ye.ic=1,Se=P.c*P.i,P.Ta=null,P.Ua=0,P.V=o(Se),P.Ba=0,P.V==null?(P.a=1,P=0):P=1):(ye.ic=0,P=Kn(P,ye.c)),!P))break t;P=1;break e}ye.mc=null,P=0}else P=_t>=ye.c*ye.i;ye=!P}if(ye)return null;N.ga.Lc!=1?N.Ga=0:K=ve-$}t(N.ga!=null),t($+K<=ve);e:{if(P=(Se=N.ga).c,ve=Se.l.o,Se.$a==0){if(Ke=N.rc,_t=N.Vc,Xt=N.Fa,je=N.P+1+$*P,Be=N.mb,dt=N.nb+$*P,t(je<=N.P+N.qc),Se.Z!=0)for(t(Iu[Se.Z]!=null),ye=0;ye<K;++ye)Iu[Se.Z](Ke,_t,Xt,je,Be,dt,P),Ke=Be,_t=dt,dt+=P,je+=P;else for(ye=0;ye<K;++ye)n(Be,dt,Xt,je,P),Ke=Be,_t=dt,dt+=P,je+=P;N.rc=Ke,N.Vc=_t}else{if(t(Se.mc!=null),P=$+K,t((ye=Se.mc)!=null),t(P<=ye.i),ye.C>=P)P=1;else if(Se.ic||Qr(),Se.ic){Se=ye.V,Ke=ye.Ba,_t=ye.c;var Mr=ye.i,hr=(Xt=1,je=ye.$/_t,Be=ye.$%_t,dt=ye.m,tr=ye.s,ye.$),Wr=_t*Mr,nn=_t*P,In=tr.wc,yn=hr<nn?ce(tr,Be,je):null;t(hr<=Wr),t(P<=Mr),t(xt(tr));t:for(;;){for(;!dt.h&&hr<nn;){if(Be&In||(yn=ce(tr,Be,je)),t(yn!=null),W(dt),256>(Mr=Ye(yn.G[0],yn.H[0],dt)))Se[Ke+hr]=Mr,++hr,++Be>=_t&&(Be=0,++je<=P&&!(je%16)&&ir(ye,je));else{if(!(280>Mr)){Xt=0;break t}Mr=Je(Mr-256,dt);var Ma,Sa=Ye(yn.G[4],yn.H[4],dt);if(W(dt),!(hr>=(Sa=At(_t,Sa=Je(Sa,dt)))&&Wr-hr>=Mr)){Xt=0;break t}for(Ma=0;Ma<Mr;++Ma)Se[Ke+hr+Ma]=Se[Ke+hr+Ma-Sa];for(hr+=Mr,Be+=Mr;Be>=_t;)Be-=_t,++je<=P&&!(je%16)&&ir(ye,je);hr<nn&&Be&In&&(yn=ce(tr,Be,je))}t(dt.h==ie(dt))}ir(ye,je>P?P:je);break t}!Xt||dt.h&&hr<Wr?(Xt=0,ye.a=dt.h?5:3):ye.$=hr,P=Xt}else P=Kr(ye,ye.V,ye.Ba,ye.c,ye.i,P,at);if(!P){K=0;break e}}$+K>=ve&&(N.Cc=1),K=1}if(!K)return null;if(N.Cc&&((K=N.ga)!=null&&(K.mc=null),N.ga=null,0<N.Ga))return alert("todo:WebPDequantizeLevels"),null}return N.nb+$*ue}function Ir(N,P,$,K,ue,ve){for(;0<ue--;){var ye,Se=N,je=P+($?1:0),Be=N,dt=P+($?0:3);for(ye=0;ye<K;++ye){var tr=Be[dt+4*ye];tr!=255&&(tr*=32897,Se[je+4*ye+0]=Se[je+4*ye+0]*tr>>23,Se[je+4*ye+1]=Se[je+4*ye+1]*tr>>23,Se[je+4*ye+2]=Se[je+4*ye+2]*tr>>23)}P+=ve}}function yr(N,P,$,K,ue){for(;0<K--;){var ve;for(ve=0;ve<$;++ve){var ye=N[P+2*ve+0],Se=15&(Be=N[P+2*ve+1]),je=4369*Se,Be=(240&Be|Be>>4)*je>>16;N[P+2*ve+0]=(240&ye|ye>>4)*je>>16&240|(15&ye|ye<<4)*je>>16>>4&15,N[P+2*ve+1]=240&Be|Se}P+=ue}}function Ut(N,P,$,K,ue,ve,ye,Se){var je,Be,dt=255;for(Be=0;Be<ue;++Be){for(je=0;je<K;++je){var tr=N[P+je];ve[ye+4*je]=tr,dt&=tr}P+=$,ye+=Se}return dt!=255}function _n(N,P,$,K,ue){var ve;for(ve=0;ve<ue;++ve)$[K+ve]=N[P+ve]>>8}function Qr(){yt=Ir,Ge=yr,Jt=Ut,Kt=_n}function Ar(N,P,$){A[N]=function(K,ue,ve,ye,Se,je,Be,dt,tr,Ke,_t,Xt,Mr,hr,Wr,nn,In){var yn,Ma=In-1>>1,Sa=Se[je+0]|Be[dt+0]<<16,vs=tr[Ke+0]|_t[Xt+0]<<16;t(K!=null);var Ia=3*Sa+vs+131074>>2;for(P(K[ue+0],255&Ia,Ia>>16,Mr,hr),ve!=null&&(Ia=3*vs+Sa+131074>>2,P(ve[ye+0],255&Ia,Ia>>16,Wr,nn)),yn=1;yn<=Ma;++yn){var Fs=Se[je+yn]|Be[dt+yn]<<16,Fi=tr[Ke+yn]|_t[Xt+yn]<<16,ys=Sa+Fs+vs+Fi+524296,Oa=ys+2*(Fs+vs)>>3;Ia=Oa+Sa>>1,Sa=(ys=ys+2*(Sa+Fi)>>3)+Fs>>1,P(K[ue+2*yn-1],255&Ia,Ia>>16,Mr,hr+(2*yn-1)*$),P(K[ue+2*yn-0],255&Sa,Sa>>16,Mr,hr+(2*yn-0)*$),ve!=null&&(Ia=ys+vs>>1,Sa=Oa+Fi>>1,P(ve[ye+2*yn-1],255&Ia,Ia>>16,Wr,nn+(2*yn-1)*$),P(ve[ye+2*yn+0],255&Sa,Sa>>16,Wr,nn+(2*yn+0)*$)),Sa=Fs,vs=Fi}1&In||(Ia=3*Sa+vs+131074>>2,P(K[ue+In-1],255&Ia,Ia>>16,Mr,hr+(In-1)*$),ve!=null&&(Ia=3*vs+Sa+131074>>2,P(ve[ye+In-1],255&Ia,Ia>>16,Wr,nn+(In-1)*$)))}}function Fn(){Ql[ps]=Oy,Ql[La]=$e,Ql[xa]=$p,Ql[Ss]=mt,Ql[js]=$t,Ql[Rs]=Zt,Ql[Xn]=vr,Ql[ba]=$e,Ql[Ws]=mt,Ql[Bs]=$t,Ql[oo]=Zt}function fr(N){return N&~fs?0>N?0:255:N>>Ts}function Yr(N,P){return fr((19077*N>>8)+(26149*P>>8)-14234)}function $r(N,P,$){return fr((19077*N>>8)-(6419*P>>8)-(13320*$>>8)+8708)}function Dr(N,P){return fr((19077*N>>8)+(33050*P>>8)-17685)}function dn(N,P,$,K,ue){K[ue+0]=Yr(N,$),K[ue+1]=$r(N,P,$),K[ue+2]=Dr(N,P)}function Nn(N,P,$,K,ue){K[ue+0]=Dr(N,P),K[ue+1]=$r(N,P,$),K[ue+2]=Yr(N,$)}function ua(N,P,$,K,ue){var ve=$r(N,P,$);P=ve<<3&224|Dr(N,P)>>3,K[ue+0]=248&Yr(N,$)|ve>>5,K[ue+1]=P}function ds(N,P,$,K,ue){var ve=240&Dr(N,P)|15;K[ue+0]=240&Yr(N,$)|$r(N,P,$)>>4,K[ue+1]=ve}function Xs(N,P,$,K,ue){K[ue+0]=255,dn(N,P,$,K,ue+1)}function vn(N,P,$,K,ue){Nn(N,P,$,K,ue),K[ue+3]=255}function Or(N,P,$,K,ue){dn(N,P,$,K,ue),K[ue+3]=255}function rn(N,P){return 0>N?0:N>P?P:N}function gn(N,P,$){A[N]=function(K,ue,ve,ye,Se,je,Be,dt,tr){for(var Ke=dt+(-2&tr)*$;dt!=Ke;)P(K[ue+0],ve[ye+0],Se[je+0],Be,dt),P(K[ue+1],ve[ye+0],Se[je+0],Be,dt+$),ue+=2,++ye,++je,dt+=2*$;1&tr&&P(K[ue+0],ve[ye+0],Se[je+0],Be,dt)}}function Vn(N,P,$){return $==0?N==0?P==0?6:5:P==0?4:0:$}function On(N,P,$,K,ue){switch(N>>>30){case 3:na(P,$,K,ue,0);break;case 2:ya(P,$,K,ue);break;case 1:Ea(P,$,K,ue)}}function mr(N,P){var $,K,ue=P.M,ve=P.Nb,ye=N.oc,Se=N.pc+40,je=N.oc,Be=N.pc+584,dt=N.oc,tr=N.pc+600;for($=0;16>$;++$)ye[Se+32*$-1]=129;for($=0;8>$;++$)je[Be+32*$-1]=129,dt[tr+32*$-1]=129;for(0<ue?ye[Se-1-32]=je[Be-1-32]=dt[tr-1-32]=129:(s(ye,Se-32-1,127,21),s(je,Be-32-1,127,9),s(dt,tr-32-1,127,9)),K=0;K<N.za;++K){var Ke=P.ya[P.aa+K];if(0<K){for($=-1;16>$;++$)n(ye,Se+32*$-4,ye,Se+32*$+12,4);for($=-1;8>$;++$)n(je,Be+32*$-4,je,Be+32*$+4,4),n(dt,tr+32*$-4,dt,tr+32*$+4,4)}var _t=N.Gd,Xt=N.Hd+K,Mr=Ke.ad,hr=Ke.Hc;if(0<ue&&(n(ye,Se-32,_t[Xt].y,0,16),n(je,Be-32,_t[Xt].f,0,8),n(dt,tr-32,_t[Xt].ea,0,8)),Ke.Za){var Wr=ye,nn=Se-32+16;for(0<ue&&(K>=N.za-1?s(Wr,nn,_t[Xt].y[15],4):n(Wr,nn,_t[Xt+1].y,0,4)),$=0;4>$;$++)Wr[nn+128+$]=Wr[nn+256+$]=Wr[nn+384+$]=Wr[nn+0+$];for($=0;16>$;++$,hr<<=2)Wr=ye,nn=Se+nm[$],rd[Ke.Ob[$]](Wr,nn),On(hr,Mr,16*+$,Wr,nn)}else if(Wr=Vn(K,ue,Ke.Ob[0]),Eu[Wr](ye,Se),hr!=0)for($=0;16>$;++$,hr<<=2)On(hr,Mr,16*+$,ye,Se+nm[$]);for($=Ke.Gc,Wr=Vn(K,ue,Ke.Dd),ku[Wr](je,Be),ku[Wr](dt,tr),hr=Mr,Wr=je,nn=Be,255&(Ke=0|$)&&(170&Ke?Wa(hr,256,Wr,nn):is(hr,256,Wr,nn)),Ke=dt,hr=tr,255&($>>=8)&&(170&$?Wa(Mr,320,Ke,hr):is(Mr,320,Ke,hr)),ue<N.Ub-1&&(n(_t[Xt].y,0,ye,Se+480,16),n(_t[Xt].f,0,je,Be+224,8),n(_t[Xt].ea,0,dt,tr+224,8)),$=8*ve*N.B,_t=N.sa,Xt=N.ta+16*K+16*ve*N.R,Mr=N.qa,Ke=N.ra+8*K+$,hr=N.Ha,Wr=N.Ia+8*K+$,$=0;16>$;++$)n(_t,Xt+$*N.R,ye,Se+32*$,16);for($=0;8>$;++$)n(Mr,Ke+$*N.B,je,Be+32*$,8),n(hr,Wr+$*N.B,dt,tr+32*$,8)}}function Zr(N,P,$,K,ue,ve,ye,Se,je){var Be=[0],dt=[0],tr=0,Ke=je!=null?je.kd:0,_t=je??new Ur;if(N==null||12>$)return 7;_t.data=N,_t.w=P,_t.ha=$,P=[P],$=[$],_t.gb=[_t.gb];e:{var Xt=P,Mr=$,hr=_t.gb;if(t(N!=null),t(Mr!=null),t(hr!=null),hr[0]=0,12<=Mr[0]&&!r(N,Xt[0],"RIFF")){if(r(N,Xt[0]+8,"WEBP")){hr=3;break e}var Wr=re(N,Xt[0]+4);if(12>Wr||4294967286<Wr){hr=3;break e}if(Ke&&Wr>Mr[0]-8){hr=7;break e}hr[0]=Wr,Xt[0]+=12,Mr[0]-=12}hr=0}if(hr!=0)return hr;for(Wr=0<_t.gb[0],$=$[0];;){e:{var nn=N;Mr=P,hr=$;var In=Be,yn=dt,Ma=Xt=[0];if((Ia=tr=[tr])[0]=0,8>hr[0])hr=7;else{if(!r(nn,Mr[0],"VP8X")){if(re(nn,Mr[0]+4)!=10){hr=3;break e}if(18>hr[0]){hr=7;break e}var Sa=re(nn,Mr[0]+8),vs=1+De(nn,Mr[0]+12);if(2147483648<=vs*(nn=1+De(nn,Mr[0]+15))){hr=3;break e}Ma!=null&&(Ma[0]=Sa),In!=null&&(In[0]=vs),yn!=null&&(yn[0]=nn),Mr[0]+=18,hr[0]-=18,Ia[0]=1}hr=0}}if(tr=tr[0],Xt=Xt[0],hr!=0)return hr;if(Mr=!!(2&Xt),!Wr&&tr)return 3;if(ve!=null&&(ve[0]=!!(16&Xt)),ye!=null&&(ye[0]=Mr),Se!=null&&(Se[0]=0),ye=Be[0],Xt=dt[0],tr&&Mr&&je==null){hr=0;break}if(4>$){hr=7;break}if(Wr&&tr||!Wr&&!tr&&!r(N,P[0],"ALPH")){$=[$],_t.na=[_t.na],_t.P=[_t.P],_t.Sa=[_t.Sa];e:{Sa=N,hr=P,Wr=$;var Ia=_t.gb;In=_t.na,yn=_t.P,Ma=_t.Sa,vs=22,t(Sa!=null),t(Wr!=null),nn=hr[0];var Fs=Wr[0];for(t(In!=null),t(Ma!=null),In[0]=null,yn[0]=null,Ma[0]=0;;){if(hr[0]=nn,Wr[0]=Fs,8>Fs){hr=7;break e}var Fi=re(Sa,nn+4);if(4294967286<Fi){hr=3;break e}var ys=8+Fi+1&-2;if(vs+=ys,0<Ia&&vs>Ia){hr=3;break e}if(!r(Sa,nn,"VP8 ")||!r(Sa,nn,"VP8L")){hr=0;break e}if(Fs[0]<ys){hr=7;break e}r(Sa,nn,"ALPH")||(In[0]=Sa,yn[0]=nn+8,Ma[0]=Fi),nn+=ys,Fs-=ys}}if($=$[0],_t.na=_t.na[0],_t.P=_t.P[0],_t.Sa=_t.Sa[0],hr!=0)break}$=[$],_t.Ja=[_t.Ja],_t.xa=[_t.xa];e:if(Ia=N,hr=P,Wr=$,In=_t.gb[0],yn=_t.Ja,Ma=_t.xa,Sa=hr[0],nn=!r(Ia,Sa,"VP8 "),vs=!r(Ia,Sa,"VP8L"),t(Ia!=null),t(Wr!=null),t(yn!=null),t(Ma!=null),8>Wr[0])hr=7;else{if(nn||vs){if(Ia=re(Ia,Sa+4),12<=In&&Ia>In-12){hr=3;break e}if(Ke&&Ia>Wr[0]-8){hr=7;break e}yn[0]=Ia,hr[0]+=8,Wr[0]-=8,Ma[0]=vs}else Ma[0]=5<=Wr[0]&&Ia[Sa+0]==47&&!(Ia[Sa+4]>>5),yn[0]=Wr[0];hr=0}if($=$[0],_t.Ja=_t.Ja[0],_t.xa=_t.xa[0],P=P[0],hr!=0)break;if(4294967286<_t.Ja)return 3;if(Se==null||Mr||(Se[0]=_t.xa?2:1),ye=[ye],Xt=[Xt],_t.xa){if(5>$){hr=7;break}Se=ye,Ke=Xt,Mr=ve,N==null||5>$?N=0:5<=$&&N[P+0]==47&&!(N[P+4]>>5)?(Wr=[0],Ia=[0],In=[0],V(yn=new L,N,P,$),Ze(yn,Wr,Ia,In)?(Se!=null&&(Se[0]=Wr[0]),Ke!=null&&(Ke[0]=Ia[0]),Mr!=null&&(Mr[0]=In[0]),N=1):N=0):N=0}else{if(10>$){hr=7;break}Se=Xt,N==null||10>$||!da(N,P+3,$-3)?N=0:(Ke=N[P+0]|N[P+1]<<8|N[P+2]<<16,Mr=16383&(N[P+7]<<8|N[P+6]),N=16383&(N[P+9]<<8|N[P+8]),1&Ke||3<(Ke>>1&7)||!(Ke>>4&1)||Ke>>5>=_t.Ja||!Mr||!N?N=0:(ye&&(ye[0]=Mr),Se&&(Se[0]=N),N=1))}if(!N||(ye=ye[0],Xt=Xt[0],tr&&(Be[0]!=ye||dt[0]!=Xt)))return 3;je!=null&&(je[0]=_t,je.offset=P-je.w,t(4294967286>P-je.w),t(je.offset==je.ha-$));break}return hr==0||hr==7&&tr&&je==null?(ve!=null&&(ve[0]|=_t.na!=null&&0<_t.na.length),K!=null&&(K[0]=ye),ue!=null&&(ue[0]=Xt),0):hr}function _r(N,P,$){var K=P.width,ue=P.height,ve=0,ye=0,Se=K,je=ue;if(P.Da=N!=null&&0<N.Da,P.Da&&(Se=N.cd,je=N.bd,ve=N.v,ye=N.j,11>$||(ve&=-2,ye&=-2),0>ve||0>ye||0>=Se||0>=je||ve+Se>K||ye+je>ue))return 0;if(P.v=ve,P.j=ye,P.va=ve+Se,P.o=ye+je,P.U=Se,P.T=je,P.da=N!=null&&0<N.da,P.da){if(!ft(Se,je,$=[N.ib],ve=[N.hb]))return 0;P.ib=$[0],P.hb=ve[0]}return P.ob=N!=null&&N.ob,P.Kb=N==null||!N.Sd,P.da&&(P.ob=P.ib<3*K/4&&P.hb<3*ue/4,P.Kb=0),1}function Br(N){if(N==null)return 2;if(11>N.S){var P=N.f.RGBA;P.fb+=(N.height-1)*P.A,P.A=-P.A}else P=N.f.kb,N=N.height,P.O+=(N-1)*P.fa,P.fa=-P.fa,P.N+=(N-1>>1)*P.Ab,P.Ab=-P.Ab,P.W+=(N-1>>1)*P.Db,P.Db=-P.Db,P.F!=null&&(P.J+=(N-1)*P.lb,P.lb=-P.lb);return 0}function qr(N,P,$,K){if(K==null||0>=N||0>=P)return 2;if($!=null){if($.Da){var ue=$.cd,ve=$.bd,ye=-2&$.v,Se=-2&$.j;if(0>ye||0>Se||0>=ue||0>=ve||ye+ue>N||Se+ve>P)return 2;N=ue,P=ve}if($.da){if(!ft(N,P,ue=[$.ib],ve=[$.hb]))return 2;N=ue[0],P=ve[0]}}K.width=N,K.height=P;e:{var je=K.width,Be=K.height;if(N=K.S,0>=je||0>=Be||!(N>=ps&&13>N))N=2;else{if(0>=K.Rd&&K.sd==null){ye=ve=ue=P=0;var dt=(Se=je*oi[N])*Be;if(11>N||(ve=(Be+1)/2*(P=(je+1)/2),N==12&&(ye=(ue=je)*Be)),(Be=o(dt+2*ve+ye))==null){N=1;break e}K.sd=Be,11>N?((je=K.f.RGBA).eb=Be,je.fb=0,je.A=Se,je.size=dt):((je=K.f.kb).y=Be,je.O=0,je.fa=Se,je.Fd=dt,je.f=Be,je.N=0+dt,je.Ab=P,je.Cd=ve,je.ea=Be,je.W=0+dt+ve,je.Db=P,je.Ed=ve,N==12&&(je.F=Be,je.J=0+dt+2*ve),je.Tc=ye,je.lb=ue)}if(P=1,ue=K.S,ve=K.width,ye=K.height,ue>=ps&&13>ue)if(11>ue)N=K.f.RGBA,P&=(Se=Math.abs(N.A))*(ye-1)+ve<=N.size,P&=Se>=ve*oi[ue],P&=N.eb!=null;else{N=K.f.kb,Se=(ve+1)/2,dt=(ye+1)/2,je=Math.abs(N.fa),Be=Math.abs(N.Ab);var tr=Math.abs(N.Db),Ke=Math.abs(N.lb),_t=Ke*(ye-1)+ve;P&=je*(ye-1)+ve<=N.Fd,P&=Be*(dt-1)+Se<=N.Cd,P=(P&=tr*(dt-1)+Se<=N.Ed)&je>=ve&Be>=Se&tr>=Se,P&=N.y!=null,P&=N.f!=null,P&=N.ea!=null,ue==12&&(P&=Ke>=ve,P&=_t<=N.Tc,P&=N.F!=null)}else P=0;N=P?0:2}}return N!=0||$!=null&&$.fd&&(N=Br(K)),N}var Rr=64,Vr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],kn=24,le=32,we=8,et=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Dt("Predictor0","PredictorAdd0"),A.Predictor0=function(){return 4278190080},A.Predictor1=function(N){return N},A.Predictor2=function(N,P,$){return P[$+0]},A.Predictor3=function(N,P,$){return P[$+1]},A.Predictor4=function(N,P,$){return P[$-1]},A.Predictor5=function(N,P,$){return ge(ge(N,P[$+1]),P[$+0])},A.Predictor6=function(N,P,$){return ge(N,P[$-1])},A.Predictor7=function(N,P,$){return ge(N,P[$+0])},A.Predictor8=function(N,P,$){return ge(P[$-1],P[$+0])},A.Predictor9=function(N,P,$){return ge(P[$+0],P[$+1])},A.Predictor10=function(N,P,$){return ge(ge(N,P[$-1]),ge(P[$+0],P[$+1]))},A.Predictor11=function(N,P,$){var K=P[$+0];return 0>=Sr(K>>24&255,N>>24&255,(P=P[$-1])>>24&255)+Sr(K>>16&255,N>>16&255,P>>16&255)+Sr(K>>8&255,N>>8&255,P>>8&255)+Sr(255&K,255&N,255&P)?K:N},A.Predictor12=function(N,P,$){var K=P[$+0];return(wt((N>>24&255)+(K>>24&255)-((P=P[$-1])>>24&255))<<24|wt((N>>16&255)+(K>>16&255)-(P>>16&255))<<16|wt((N>>8&255)+(K>>8&255)-(P>>8&255))<<8|wt((255&N)+(255&K)-(255&P)))>>>0},A.Predictor13=function(N,P,$){var K=P[$-1];return(Gt((N=ge(N,P[$+0]))>>24&255,K>>24&255)<<24|Gt(N>>16&255,K>>16&255)<<16|Gt(N>>8&255,K>>8&255)<<8|Gt(255&N,255&K))>>>0};var _e=A.PredictorAdd0;A.PredictorAdd1=wr,Dt("Predictor2","PredictorAdd2"),Dt("Predictor3","PredictorAdd3"),Dt("Predictor4","PredictorAdd4"),Dt("Predictor5","PredictorAdd5"),Dt("Predictor6","PredictorAdd6"),Dt("Predictor7","PredictorAdd7"),Dt("Predictor8","PredictorAdd8"),Dt("Predictor9","PredictorAdd9"),Dt("Predictor10","PredictorAdd10"),Dt("Predictor11","PredictorAdd11"),Dt("Predictor12","PredictorAdd12"),Dt("Predictor13","PredictorAdd13");var St=A.PredictorAdd2;qt("ColorIndexInverseTransform","MapARGB","32b",function(N){return N>>8&255},function(N){return N}),qt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(N){return N},function(N){return N>>8&255});var tt,Ne=A.ColorIndexInverseTransform,Mt=A.MapARGB,Qe=A.VP8LColorIndexInverseTransformAlpha,ar=A.MapAlpha,Sn=A.VP8LPredictorsAdd=[];Sn.length=16,(A.VP8LPredictors=[]).length=16,(A.VP8LPredictorsAdd_C=[]).length=16,(A.VP8LPredictors_C=[]).length=16;var wn,$n,En,pa,rs,Ys,ea,na,ya,Wa,Ea,is,Ns,ss,ro,xl,D,X,Pe,rt,Le,Tt,Ot,Rt,yt,Ge,Jt,Kt,Hr=o(511),hn=o(2041),An=o(225),xr=o(767),Tr=0,jn=hn,fa=An,qn=xr,Fa=Hr,ps=0,La=1,xa=2,Ss=3,js=4,Rs=5,Xn=6,ba=7,Ws=8,Bs=9,oo=10,ed=[2,3,7],Qi=[3,3,11],wa=[280,256,256,256,40],Za=[0,1,1,1,0],xo=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Zi=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],td=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],rm=8,Pu=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Yl=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Tl=null,ky=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Iy=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Jl=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Fj=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Px=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],GA=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],yf=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Eu=[],rd=[],ku=[],KA=1,Lj=2,Iu=[],Ql=[];Ar("UpsampleRgbLinePair",dn,3),Ar("UpsampleBgrLinePair",Nn,3),Ar("UpsampleRgbaLinePair",Or,4),Ar("UpsampleBgraLinePair",vn,4),Ar("UpsampleArgbLinePair",Xs,4),Ar("UpsampleRgba4444LinePair",ds,2),Ar("UpsampleRgb565LinePair",ua,2);var Oy=A.UpsampleRgbLinePair,$p=A.UpsampleBgrLinePair,$e=A.UpsampleRgbaLinePair,mt=A.UpsampleBgraLinePair,$t=A.UpsampleArgbLinePair,Zt=A.UpsampleRgba4444LinePair,vr=A.UpsampleRgb565LinePair,tn=16,Pn=1<<tn-1,Cn=-227,qa=482,Ts=6,fs=(256<<Ts)-1,ga=0,Ci=o(256),vl=o(256),Dl=o(256),zd=o(256),Zl=o(qa-Cn),Ud=o(qa-Cn);gn("YuvToRgbRow",dn,3),gn("YuvToBgrRow",Nn,3),gn("YuvToRgbaRow",Or,4),gn("YuvToBgraRow",vn,4),gn("YuvToArgbRow",Xs,4),gn("YuvToRgba4444Row",ds,2),gn("YuvToRgb565Row",ua,2);var nm=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ps=[0,2,8],bo=[8,7,6,4,4,2,2,2,1,1,1,1],nd=1;this.WebPDecodeRGBA=function(N,P,$,K,ue){var ve=La,ye=new Ht,Se=new an;ye.ba=Se,Se.S=ve,Se.width=[Se.width],Se.height=[Se.height];var je=Se.width,Be=Se.height,dt=new zr;if(dt==null||N==null)var tr=2;else t(dt!=null),tr=Zr(N,P,$,dt.width,dt.height,dt.Pd,dt.Qd,dt.format,null);if(tr!=0?je=0:(je!=null&&(je[0]=dt.width[0]),Be!=null&&(Be[0]=dt.height[0]),je=1),je){Se.width=Se.width[0],Se.height=Se.height[0],K!=null&&(K[0]=Se.width),ue!=null&&(ue[0]=Se.height);e:{if(K=new ra,(ue=new Ur).data=N,ue.w=P,ue.ha=$,ue.kd=1,P=[0],t(ue!=null),((N=Zr(ue.data,ue.w,ue.ha,null,null,null,P,null,ue))==0||N==7)&&P[0]&&(N=4),(P=N)==0){if(t(ye!=null),K.data=ue.data,K.w=ue.w+ue.offset,K.ha=ue.ha-ue.offset,K.put=ke,K.ac=cn,K.bc=We,K.ma=ye,ue.xa){if((N=sa())==null){ye=1;break e}if(function(Ke,_t){var Xt=[0],Mr=[0],hr=[0];t:for(;;){if(Ke==null)return 0;if(_t==null)return Ke.a=2,0;if(Ke.l=_t,Ke.a=0,V(Ke.m,_t.data,_t.w,_t.ha),!Ze(Ke.m,Xt,Mr,hr)){Ke.a=3;break t}if(Ke.xb=Lj,_t.width=Xt[0],_t.height=Mr[0],!ia(Xt[0],Mr[0],1,Ke,null))break t;return 1}return t(Ke.a!=0),0}(N,K)){if(K=(P=qr(K.width,K.height,ye.Oa,ye.ba))==0){t:{K=N;r:for(;;){if(K==null){K=0;break t}if(t(K.s.yc!=null),t(K.s.Ya!=null),t(0<K.s.Wb),t(($=K.l)!=null),t((ue=$.ma)!=null),K.xb!=0){if(K.ca=ue.ba,K.tb=ue.tb,t(K.ca!=null),!_r(ue.Oa,$,Ss)){K.a=2;break r}if(!Kn(K,$.width)||$.da)break r;if(($.da||or(K.ca.S))&&Qr(),11>K.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),K.ca.f.kb.F!=null&&Qr()),K.Pb&&0<K.s.ua&&K.s.vb.X==null&&!ae(K.s.vb,K.s.Wa.Xa)){K.a=1;break r}K.xb=0}if(!Kr(K,K.V,K.Ba,K.c,K.i,$.o,ze))break r;ue.Dc=K.Ma,K=1;break t}t(K.a!=0),K=0}K=!K}K&&(P=N.a)}else P=N.a}else{if((N=new Wn)==null){ye=1;break e}if(N.Fa=ue.na,N.P=ue.P,N.qc=ue.Sa,va(N,K)){if((P=qr(K.width,K.height,ye.Oa,ye.ba))==0){if(N.Aa=0,$=ye.Oa,t((ue=N)!=null),$!=null){if(0<(je=0>(je=$.Md)?0:100<je?255:255*je/100)){for(Be=dt=0;4>Be;++Be)12>(tr=ue.pb[Be]).lc&&(tr.ia=je*bo[0>tr.lc?0:tr.lc]>>3),dt|=tr.ia;dt&&(alert("todo:VP8InitRandom"),ue.ia=1)}ue.Ga=$.Id,100<ue.Ga?ue.Ga=100:0>ue.Ga&&(ue.Ga=0)}(function(Ke,_t){if(Ke==null)return 0;if(_t==null)return ln(Ke,2,"NULL VP8Io parameter in VP8Decode().");if(!Ke.cb&&!va(Ke,_t))return 0;if(t(Ke.cb),_t.ac==null||_t.ac(_t)){_t.ob&&(Ke.L=0);var Xt=Ps[Ke.L];if(Ke.L==2?(Ke.yb=0,Ke.zb=0):(Ke.yb=_t.v-Xt>>4,Ke.zb=_t.j-Xt>>4,0>Ke.yb&&(Ke.yb=0),0>Ke.zb&&(Ke.zb=0)),Ke.Va=_t.o+15+Xt>>4,Ke.Hb=_t.va+15+Xt>>4,Ke.Hb>Ke.za&&(Ke.Hb=Ke.za),Ke.Va>Ke.Ub&&(Ke.Va=Ke.Ub),0<Ke.L){var Mr=Ke.ed;for(Xt=0;4>Xt;++Xt){var hr;if(Ke.Qa.Cb){var Wr=Ke.Qa.Lb[Xt];Ke.Qa.Fb||(Wr+=Mr.Tb)}else Wr=Mr.Tb;for(hr=0;1>=hr;++hr){var nn=Ke.gd[Xt][hr],In=Wr;if(Mr.Pc&&(In+=Mr.vd[0],hr&&(In+=Mr.od[0])),0<(In=0>In?0:63<In?63:In)){var yn=In;0<Mr.wb&&(yn=4<Mr.wb?yn>>2:yn>>1)>9-Mr.wb&&(yn=9-Mr.wb),1>yn&&(yn=1),nn.dd=yn,nn.tc=2*In+yn,nn.ld=40<=In?2:15<=In?1:0}else nn.tc=0;nn.La=hr}}}Xt=0}else ln(Ke,6,"Frame setup failed"),Xt=Ke.a;if(Xt=Xt==0){if(Xt){Ke.$c=0,0<Ke.Aa||(Ke.Ic=nd);t:{Xt=Ke.Ic,Mr=4*(yn=Ke.za);var Ma=32*yn,Sa=yn+1,vs=0<Ke.L?yn*(0<Ke.Aa?2:1):0,Ia=(Ke.Aa==2?2:1)*yn;if((nn=Mr+832+(hr=3*(16*Xt+Ps[Ke.L])/2*Ma)+(Wr=Ke.Fa!=null&&0<Ke.Fa.length?Ke.Kc.c*Ke.Kc.i:0))!=nn)Xt=0;else{if(nn>Ke.Vb){if(Ke.Vb=0,Ke.Ec=o(nn),Ke.Fc=0,Ke.Ec==null){Xt=ln(Ke,1,"no memory during frame initialization.");break t}Ke.Vb=nn}nn=Ke.Ec,In=Ke.Fc,Ke.Ac=nn,Ke.Bc=In,In+=Mr,Ke.Gd=i(Ma,Lr),Ke.Hd=0,Ke.rb=i(Sa+1,jt),Ke.sb=1,Ke.wa=vs?i(vs,kr):null,Ke.Y=0,Ke.D.Nb=0,Ke.D.wa=Ke.wa,Ke.D.Y=Ke.Y,0<Ke.Aa&&(Ke.D.Y+=yn),t(!0),Ke.oc=nn,Ke.pc=In,In+=832,Ke.ya=i(Ia,Nt),Ke.aa=0,Ke.D.ya=Ke.ya,Ke.D.aa=Ke.aa,Ke.Aa==2&&(Ke.D.aa+=yn),Ke.R=16*yn,Ke.B=8*yn,yn=(Ma=Ps[Ke.L])*Ke.R,Ma=Ma/2*Ke.B,Ke.sa=nn,Ke.ta=In+yn,Ke.qa=Ke.sa,Ke.ra=Ke.ta+16*Xt*Ke.R+Ma,Ke.Ha=Ke.qa,Ke.Ia=Ke.ra+8*Xt*Ke.B+Ma,Ke.$c=0,In+=hr,Ke.mb=Wr?nn:null,Ke.nb=Wr?In:null,t(In+Wr<=Ke.Fc+Ke.Vb),Tn(Ke),s(Ke.Ac,Ke.Bc,0,Mr),Xt=1}}if(Xt){if(_t.ka=0,_t.y=Ke.sa,_t.O=Ke.ta,_t.f=Ke.qa,_t.N=Ke.ra,_t.ea=Ke.Ha,_t.Vd=Ke.Ia,_t.fa=Ke.R,_t.Rc=Ke.B,_t.F=null,_t.J=0,!Tr){for(Xt=-255;255>=Xt;++Xt)Hr[255+Xt]=0>Xt?-Xt:Xt;for(Xt=-1020;1020>=Xt;++Xt)hn[1020+Xt]=-128>Xt?-128:127<Xt?127:Xt;for(Xt=-112;112>=Xt;++Xt)An[112+Xt]=-16>Xt?-16:15<Xt?15:Xt;for(Xt=-255;510>=Xt;++Xt)xr[255+Xt]=0>Xt?0:255<Xt?255:Xt;Tr=1}ea=Xe,na=Qt,Wa=nr,Ea=fn,is=J,ya=Pt,Ns=Au,ss=Zc,ro=R,xl=de,D=Ji,X=Ol,Pe=Ue,rt=vt,Le=Ac,Tt=gl,Ot=qd,Rt=Os,rd[0]=Pa,rd[1]=fe,rd[2]=xn,rd[3]=Dn,rd[4]=Aa,rd[5]=Hn,rd[6]=Na,rd[7]=as,rd[8]=As,rd[9]=to,Eu[0]=pr,Eu[1]=xe,Eu[2]=kt,Eu[3]=st,Eu[4]=en,Eu[5]=sn,Eu[6]=la,ku[0]=Si,ku[1]=Ve,ku[2]=Vs,ku[3]=ai,ku[4]=Qc,ku[5]=Sc,ku[6]=Cc,Xt=1}else Xt=0}Xt&&(Xt=function(Fs,Fi){for(Fs.M=0;Fs.M<Fs.Va;++Fs.M){var ys,Oa=Fs.Jc[Fs.M&Fs.Xb],Qn=Fs.m,gi=Fs;for(ys=0;ys<gi.za;++ys){var gs=Qn,qs=gi,Mo=qs.Ac,yl=qs.Bc+4*ys,ec=qs.zc,ii=qs.ya[qs.aa+ys];if(qs.Qa.Bb?ii.$b=G(gs,qs.Pa.jb[0])?2+G(gs,qs.Pa.jb[2]):G(gs,qs.Pa.jb[1]):ii.$b=0,qs.kc&&(ii.Ad=G(gs,qs.Bd)),ii.Za=!G(gs,145)+0,ii.Za){var Ml=ii.Ob,tc=0;for(qs=0;4>qs;++qs){var Li,Hs=ec[0+qs];for(Li=0;4>Li;++Li){Hs=Px[Mo[yl+Li]][Hs];for(var co=Jl[G(gs,Hs[0])];0<co;)co=Jl[2*co+G(gs,Hs[co])];Hs=-co,Mo[yl+Li]=Hs}n(Ml,tc,Mo,yl,4),tc+=4,ec[0+qs]=Hs}}else Hs=G(gs,156)?G(gs,128)?1:3:G(gs,163)?2:0,ii.Ob[0]=Hs,s(Mo,yl,Hs,4),s(ec,0,Hs,4);ii.Dd=G(gs,142)?G(gs,114)?G(gs,183)?1:3:2:0}if(gi.m.Ka)return ln(Fs,7,"Premature end-of-partition0 encountered.");for(;Fs.ja<Fs.za;++Fs.ja){if(gi=Oa,gs=(Qn=Fs).rb[Qn.sb-1],Mo=Qn.rb[Qn.sb+Qn.ja],ys=Qn.ya[Qn.aa+Qn.ja],yl=Qn.kc?ys.Ad:0)gs.la=Mo.la=0,ys.Za||(gs.Na=Mo.Na=0),ys.Hc=0,ys.Gc=0,ys.ia=0;else{var li,uo;if(gs=Mo,Mo=gi,yl=Qn.Pa.Xc,ec=Qn.ya[Qn.aa+Qn.ja],ii=Qn.pb[ec.$b],qs=ec.ad,Ml=0,tc=Qn.rb[Qn.sb-1],Hs=Li=0,s(qs,Ml,0,384),ec.Za)var bl=0,Ou=yl[3];else{co=o(16);var xi=gs.Na+tc.Na;if(xi=Tl(Mo,yl[1],xi,ii.Eb,0,co,0),gs.Na=tc.Na=(0<xi)+0,1<xi)ea(co,0,qs,Ml);else{var Pc=co[0]+3>>3;for(co=0;256>co;co+=16)qs[Ml+co]=Pc}bl=1,Ou=yl[0]}var wo=15&gs.la,$i=15&tc.la;for(co=0;4>co;++co){var ad=1&$i;for(Pc=uo=0;4>Pc;++Pc)wo=wo>>1|(ad=(xi=Tl(Mo,Ou,xi=ad+(1&wo),ii.Sc,bl,qs,Ml))>bl)<<7,uo=uo<<2|(3<xi?3:1<xi?2:qs[Ml+0]!=0),Ml+=16;wo>>=4,$i=$i>>1|ad<<7,Li=(Li<<8|uo)>>>0}for(Ou=wo,bl=$i>>4,li=0;4>li;li+=2){for(uo=0,wo=gs.la>>4+li,$i=tc.la>>4+li,co=0;2>co;++co){for(ad=1&$i,Pc=0;2>Pc;++Pc)xi=ad+(1&wo),wo=wo>>1|(ad=0<(xi=Tl(Mo,yl[2],xi,ii.Qc,0,qs,Ml)))<<3,uo=uo<<2|(3<xi?3:1<xi?2:qs[Ml+0]!=0),Ml+=16;wo>>=2,$i=$i>>1|ad<<5}Hs|=uo<<4*li,Ou|=wo<<4<<li,bl|=(240&$i)<<li}gs.la=Ou,tc.la=bl,ec.Hc=Li,ec.Gc=Hs,ec.ia=43690&Hs?0:ii.ia,yl=!(Li|Hs)}if(0<Qn.L&&(Qn.wa[Qn.Y+Qn.ja]=Qn.gd[ys.$b][ys.Za],Qn.wa[Qn.Y+Qn.ja].La|=!yl),gi.Ka)return ln(Fs,7,"Premature end-of-file encountered.")}if(Tn(Fs),Qn=Fi,gi=1,ys=(Oa=Fs).D,gs=0<Oa.L&&Oa.M>=Oa.zb&&Oa.M<=Oa.Va,Oa.Aa==0)t:{if(ys.M=Oa.M,ys.uc=gs,mr(Oa,ys),gi=1,ys=(uo=Oa.D).Nb,gs=(Hs=Ps[Oa.L])*Oa.R,Mo=Hs/2*Oa.B,co=16*ys*Oa.R,Pc=8*ys*Oa.B,yl=Oa.sa,ec=Oa.ta-gs+co,ii=Oa.qa,qs=Oa.ra-Mo+Pc,Ml=Oa.Ha,tc=Oa.Ia-Mo+Pc,$i=(wo=uo.M)==0,Li=wo>=Oa.Va-1,Oa.Aa==2&&mr(Oa,uo),uo.uc)for(ad=(xi=Oa).D.M,t(xi.D.uc),uo=xi.yb;uo<xi.Hb;++uo){bl=uo,Ou=ad;var rc=(sd=(wl=xi).D).Nb;li=wl.R;var sd=sd.wa[sd.Y+bl],od=wl.sa,Ec=wl.ta+16*rc*li+16*bl,id=sd.dd,So=sd.tc;if(So!=0)if(t(3<=So),wl.L==1)0<bl&&Tt(od,Ec,li,So+4),sd.La&&Rt(od,Ec,li,So),0<Ou&&Le(od,Ec,li,So+4),sd.La&&Ot(od,Ec,li,So);else{var ld=wl.B,Tu=wl.qa,Bp=wl.ra+8*rc*ld+8*bl,am=wl.Ha,wl=wl.Ia+8*rc*ld+8*bl;rc=sd.ld,0<bl&&(ss(od,Ec,li,So+4,id,rc),xl(Tu,Bp,am,wl,ld,So+4,id,rc)),sd.La&&(X(od,Ec,li,So,id,rc),rt(Tu,Bp,am,wl,ld,So,id,rc)),0<Ou&&(Ns(od,Ec,li,So+4,id,rc),ro(Tu,Bp,am,wl,ld,So+4,id,rc)),sd.La&&(D(od,Ec,li,So,id,rc),Pe(Tu,Bp,am,wl,ld,So,id,rc))}}if(Oa.ia&&alert("todo:DitherRow"),Qn.put!=null){if(uo=16*wo,wo=16*(wo+1),$i?(Qn.y=Oa.sa,Qn.O=Oa.ta+co,Qn.f=Oa.qa,Qn.N=Oa.ra+Pc,Qn.ea=Oa.Ha,Qn.W=Oa.Ia+Pc):(uo-=Hs,Qn.y=yl,Qn.O=ec,Qn.f=ii,Qn.N=qs,Qn.ea=Ml,Qn.W=tc),Li||(wo-=Hs),wo>Qn.o&&(wo=Qn.o),Qn.F=null,Qn.J=null,Oa.Fa!=null&&0<Oa.Fa.length&&uo<wo&&(Qn.J=sr(Oa,Qn,uo,wo-uo),Qn.F=Oa.mb,Qn.F==null&&Qn.F.length==0)){gi=ln(Oa,3,"Could not decode alpha data.");break t}uo<Qn.j&&(Hs=Qn.j-uo,uo=Qn.j,t(!(1&Hs)),Qn.O+=Oa.R*Hs,Qn.N+=Oa.B*(Hs>>1),Qn.W+=Oa.B*(Hs>>1),Qn.F!=null&&(Qn.J+=Qn.width*Hs)),uo<wo&&(Qn.O+=Qn.v,Qn.N+=Qn.v>>1,Qn.W+=Qn.v>>1,Qn.F!=null&&(Qn.J+=Qn.v),Qn.ka=uo-Qn.j,Qn.U=Qn.va-Qn.v,Qn.T=wo-uo,gi=Qn.put(Qn))}ys+1!=Oa.Ic||Li||(n(Oa.sa,Oa.ta-gs,yl,ec+16*Oa.R,gs),n(Oa.qa,Oa.ra-Mo,ii,qs+8*Oa.B,Mo),n(Oa.Ha,Oa.Ia-Mo,Ml,tc+8*Oa.B,Mo))}if(!gi)return ln(Fs,6,"Output aborted.")}return 1}(Ke,_t)),_t.bc!=null&&_t.bc(_t),Xt&=1}return Xt?(Ke.cb=0,Xt):0})(N,K)||(P=N.a)}}else P=N.a}P==0&&ye.Oa!=null&&ye.Oa.fd&&(P=Br(ye.ba))}ye=P}ve=ye!=0?null:11>ve?Se.f.RGBA.eb:Se.f.kb.y}else ve=null;return ve};var oi=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(A,M){for(var O="",I=0;I<4;I++)O+=String.fromCharCode(A[M++]);return O}function u(A,M){return A[M+0]|A[M+1]<<8}function f(A,M){return(A[M+0]|A[M+1]<<8|A[M+2]<<16)>>>0}function h(A,M){return(A[M+0]|A[M+1]<<8|A[M+2]<<16|A[M+3]<<24)>>>0}new c;var m=[0],x=[0],g=[],v=new c,y=e,b=function(A,M){var O={},I=0,T=!1,k=0,q=0;if(O.frames=[],!function(U,L){for(var H=0;H<4;H++)if(U[L+H]!="RIFF".charCodeAt(H))return!0;return!1}(A,M)){for(h(A,M+=4),M+=8;M<A.length;){var B=d(A,M),z=h(A,M+=4);M+=4;var F=z+(1&z);switch(B){case"VP8 ":case"VP8L":O.frames[I]===void 0&&(O.frames[I]={}),(be=O.frames[I]).src_off=T?q:M-8,be.src_size=k+z+8,I++,T&&(T=!1,k=0,q=0);break;case"VP8X":(be=O.header={}).feature_flags=A[M];var V=M+4;be.canvas_width=1+f(A,V),V+=3,be.canvas_height=1+f(A,V),V+=3;break;case"ALPH":T=!0,k=F+8,q=M-8;break;case"ANIM":(be=O.header).bgcolor=h(A,M),V=M+4,be.loop_count=u(A,V),V+=2;break;case"ANMF":var me,be;(be=O.frames[I]={}).offset_x=2*f(A,M),M+=3,be.offset_y=2*f(A,M),M+=3,be.width=1+f(A,M),M+=3,be.height=1+f(A,M),M+=3,be.duration=f(A,M),M+=3,me=A[M++],be.dispose=1&me,be.blend=me>>1&1}B!="ANMF"&&(M+=F)}return O}}(y,0);b.response=y,b.rgbaoutput=!0,b.dataurl=!1;var w=b.header?b.header:null,j=b.frames?b.frames:null;if(w){w.loop_counter=w.loop_count,m=[w.canvas_height],x=[w.canvas_width];for(var _=0;_<j.length&&j[_].blend!=0;_++);}var C=j[0],E=v.WebPDecodeRGBA(y,C.src_off,C.src_size,x,m);C.rgba=E,C.imgwidth=x[0],C.imgheight=m[0];for(var S=0;S<x[0]*m[0]*4;S++)g[S]=E[S];return this.width=x,this.height=m,this.data=g,this}(function(e){var t,r,n,s,o,i,l,c,d,u=function(U){return U=U||{},this.isStrokeTransparent=U.isStrokeTransparent||!1,this.strokeOpacity=U.strokeOpacity||1,this.strokeStyle=U.strokeStyle||"#000000",this.fillStyle=U.fillStyle||"#000000",this.isFillTransparent=U.isFillTransparent||!1,this.fillOpacity=U.fillOpacity||1,this.font=U.font||"10px sans-serif",this.textBaseline=U.textBaseline||"alphabetic",this.textAlign=U.textAlign||"left",this.lineWidth=U.lineWidth||1,this.lineJoin=U.lineJoin||"miter",this.lineCap=U.lineCap||"butt",this.path=U.path||[],this.transform=U.transform!==void 0?U.transform.clone():new c,this.globalCompositeOperation=U.globalCompositeOperation||"normal",this.globalAlpha=U.globalAlpha||1,this.clip_path=U.clip_path||[],this.currentPoint=U.currentPoint||new i,this.miterLimit=U.miterLimit||10,this.lastPoint=U.lastPoint||new i,this.lineDashOffset=U.lineDashOffset||0,this.lineDash=U.lineDash||[],this.margin=U.margin||[0,0,0,0],this.prevPageLastElemOffset=U.prevPageLastElemOffset||0,this.ignoreClearRect=typeof U.ignoreClearRect!="boolean"||U.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new f(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,i=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,d=new u}]);var f=function(U){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var L=U;Object.defineProperty(this,"pdf",{get:function(){return L}});var H=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return H},set:function(re){H=!!re}});var ie=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return ie},set:function(re){ie=!!re}});var Y=0;Object.defineProperty(this,"posX",{get:function(){return Y},set:function(re){isNaN(re)||(Y=re)}});var W=0;Object.defineProperty(this,"posY",{get:function(){return W},set:function(re){isNaN(re)||(W=re)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function(re){var ae;typeof re=="number"?ae=[re,re,re,re]:((ae=new Array(4))[0]=re[0],ae[1]=re.length>=2?re[1]:ae[0],ae[2]=re.length>=3?re[2]:ae[0],ae[3]=re.length>=4?re[3]:ae[1]),d.margin=ae}});var se=!1;Object.defineProperty(this,"autoPaging",{get:function(){return se},set:function(re){se=re}});var pe=0;Object.defineProperty(this,"lastBreak",{get:function(){return pe},set:function(re){pe=re}});var G=[];Object.defineProperty(this,"pageBreaks",{get:function(){return G},set:function(re){G=re}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function(re){re instanceof u&&(d=re)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function(re){d.path=re}});var te=[];Object.defineProperty(this,"ctxStack",{get:function(){return te},set:function(re){te=re}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(re){var ae;ae=h(re),this.ctx.fillStyle=ae.style,this.ctx.isFillTransparent=ae.a===0,this.ctx.fillOpacity=ae.a,this.pdf.setFillColor(ae.r,ae.g,ae.b,{a:ae.a}),this.pdf.setTextColor(ae.r,ae.g,ae.b,{a:ae.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(re){var ae=h(re);this.ctx.strokeStyle=ae.style,this.ctx.isStrokeTransparent=ae.a===0,this.ctx.strokeOpacity=ae.a,ae.a===0?this.pdf.setDrawColor(255,255,255):(ae.a,this.pdf.setDrawColor(ae.r,ae.g,ae.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(re){["butt","round","square"].indexOf(re)!==-1&&(this.ctx.lineCap=re,this.pdf.setLineCap(re))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(re){isNaN(re)||(this.ctx.lineWidth=re,this.pdf.setLineWidth(re))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(re){["bevel","round","miter"].indexOf(re)!==-1&&(this.ctx.lineJoin=re,this.pdf.setLineJoin(re))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(re){isNaN(re)||(this.ctx.miterLimit=re,this.pdf.setMiterLimit(re))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(re){this.ctx.textBaseline=re}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(re){["right","end","center","left","start"].indexOf(re)!==-1&&(this.ctx.textAlign=re)}});var oe=null,De=null;Object.defineProperty(this,"fontFaces",{get:function(){return De},set:function(re){oe=null,De=re}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(re){var ae;if(this.ctx.font=re,(ae=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(re))!==null){var ut=ae[1];ae[2];var pt=ae[3],ft=ae[4];ae[5];var bt=ae[6],Lt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(ft)[2];ft=Math.floor(Lt==="px"?parseFloat(ft)*this.pdf.internal.scaleFactor:Lt==="em"?parseFloat(ft)*this.pdf.getFontSize():parseFloat(ft)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(ft);var Dt=function(Vt){var qt,Re,Ct=[],Wt=Vt.trim();if(Wt==="")return xk;if(Wt in nU)return[nU[Wt]];for(;Wt!=="";){switch(Re=null,qt=(Wt=sU(Wt)).charAt(0)){case'"':case"'":Re=tZe(Wt.substring(1),qt);break;default:Re=rZe(Wt)}if(Re===null||(Ct.push(Re[0]),(Wt=sU(Re[1]))!==""&&Wt.charAt(0)!==","))return xk;Wt=Wt.replace(/^,/,"")}return Ct}(bt);if(this.fontFaces){var Bt=function(Vt,qt){if(oe===null){var Re=function(Ct){var Wt=[];return Object.keys(Ct).forEach(function(Er){Ct[Er].forEach(function(Me){var lt=null;switch(Me){case"bold":lt={family:Er,weight:"bold"};break;case"italic":lt={family:Er,style:"italic"};break;case"bolditalic":lt={family:Er,weight:"bold",style:"italic"};break;case"":case"normal":lt={family:Er}}lt!==null&&(lt.ref={name:Er,style:Me},Wt.push(lt))})}),Wt}(Vt.getFontList());oe=function(Ct){for(var Wt={},Er=0;Er<Ct.length;++Er){var Me=gk(Ct[Er]),lt=Me.family,gt=Me.stretch,or=Me.style,br=Me.weight;Wt[lt]=Wt[lt]||{},Wt[lt][gt]=Wt[lt][gt]||{},Wt[lt][gt][or]=Wt[lt][gt][or]||{},Wt[lt][gt][or][br]=Me}return Wt}(Re.concat(qt))}return oe}(this.pdf,this.fontFaces),ge=Dt.map(function(Vt){return{family:Vt,stretch:"normal",weight:pt,style:ut}}),wt=function(Vt,qt,Re){for(var Ct=(Re=Re||{}).defaultFontFamily||"times",Wt=Object.assign({},eZe,Re.genericFontFamilies||{}),Er=null,Me=null,lt=0;lt<qt.length;++lt)if(Wt[(Er=gk(qt[lt])).family]&&(Er.family=Wt[Er.family]),Vt.hasOwnProperty(Er.family)){Me=Vt[Er.family];break}if(!(Me=Me||Vt[Ct]))throw new Error("Could not find a font-family for the rule '"+aU(Er)+"' and default family '"+Ct+"'.");if(Me=function(gt,or){if(or[gt])return or[gt];var br=k3[gt],ur=br<=k3.normal?-1:1,an=rU(or,Lae,br,ur);if(!an)throw new Error("Could not find a matching font-stretch value for "+gt);return an}(Er.stretch,Me),Me=function(gt,or){if(or[gt])return or[gt];for(var br=Fae[gt],ur=0;ur<br.length;++ur)if(or[br[ur]])return or[br[ur]];throw new Error("Could not find a matching font-style for "+gt)}(Er.style,Me),!(Me=function(gt,or){if(or[gt])return or[gt];if(gt===400&&or[500])return or[500];if(gt===500&&or[400])return or[400];var br=ZQe[gt],ur=rU(or,$ae,br,gt<400?-1:1);if(!ur)throw new Error("Could not find a matching font-weight for value "+gt);return ur}(Er.weight,Me)))throw new Error("Failed to resolve a font for the rule '"+aU(Er)+"'.");return Me}(Bt,ge);this.pdf.setFont(wt.ref.name,wt.ref.style)}else{var Gt="";(pt==="bold"||parseInt(pt,10)>=700||ut==="bold")&&(Gt="bold"),ut==="italic"&&(Gt+="italic"),Gt.length===0&&(Gt="normal");for(var Sr="",wr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},he=0;he<Dt.length;he++){if(this.pdf.internal.getFont(Dt[he],Gt,{noFallback:!0,disableWarning:!0})!==void 0){Sr=Dt[he];break}if(Gt==="bolditalic"&&this.pdf.internal.getFont(Dt[he],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Sr=Dt[he],Gt="bold";else if(this.pdf.internal.getFont(Dt[he],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Sr=Dt[he],Gt="normal";break}}if(Sr===""){for(var ot=0;ot<Dt.length;ot++)if(wr[Dt[ot]]){Sr=wr[Dt[ot]];break}}Sr=Sr===""?"Times":Sr,this.pdf.setFont(Sr,Gt)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(re){this.ctx.globalCompositeOperation=re}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(re){this.ctx.globalAlpha=re}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(re){this.ctx.lineDashOffset=re,be.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(re){this.ctx.lineDash=re,be.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(re){this.ctx.ignoreClearRect=!!re}})};f.prototype.setLineDash=function(U){this.lineDash=U},f.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},f.prototype.fill=function(){j.call(this,"fill",!1)},f.prototype.stroke=function(){j.call(this,"stroke",!1)},f.prototype.beginPath=function(){this.path=[{type:"begin"}]},f.prototype.moveTo=function(U,L){if(isNaN(U)||isNaN(L))throw jo.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var H=this.ctx.transform.applyToPoint(new i(U,L));this.path.push({type:"mt",x:H.x,y:H.y}),this.ctx.lastPoint=new i(U,L)},f.prototype.closePath=function(){var U=new i(0,0),L=0;for(L=this.path.length-1;L!==-1;L--)if(this.path[L].type==="begin"&&Ms(this.path[L+1])==="object"&&typeof this.path[L+1].x=="number"){U=new i(this.path[L+1].x,this.path[L+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new i(U.x,U.y)},f.prototype.lineTo=function(U,L){if(isNaN(U)||isNaN(L))throw jo.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var H=this.ctx.transform.applyToPoint(new i(U,L));this.path.push({type:"lt",x:H.x,y:H.y}),this.ctx.lastPoint=new i(H.x,H.y)},f.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),j.call(this,null,!0)},f.prototype.quadraticCurveTo=function(U,L,H,ie){if(isNaN(H)||isNaN(ie)||isNaN(U)||isNaN(L))throw jo.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Y=this.ctx.transform.applyToPoint(new i(H,ie)),W=this.ctx.transform.applyToPoint(new i(U,L));this.path.push({type:"qct",x1:W.x,y1:W.y,x:Y.x,y:Y.y}),this.ctx.lastPoint=new i(Y.x,Y.y)},f.prototype.bezierCurveTo=function(U,L,H,ie,Y,W){if(isNaN(Y)||isNaN(W)||isNaN(U)||isNaN(L)||isNaN(H)||isNaN(ie))throw jo.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var se=this.ctx.transform.applyToPoint(new i(Y,W)),pe=this.ctx.transform.applyToPoint(new i(U,L)),G=this.ctx.transform.applyToPoint(new i(H,ie));this.path.push({type:"bct",x1:pe.x,y1:pe.y,x2:G.x,y2:G.y,x:se.x,y:se.y}),this.ctx.lastPoint=new i(se.x,se.y)},f.prototype.arc=function(U,L,H,ie,Y,W){if(isNaN(U)||isNaN(L)||isNaN(H)||isNaN(ie)||isNaN(Y))throw jo.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(W=!!W,!this.ctx.transform.isIdentity){var se=this.ctx.transform.applyToPoint(new i(U,L));U=se.x,L=se.y;var pe=this.ctx.transform.applyToPoint(new i(0,H)),G=this.ctx.transform.applyToPoint(new i(0,0));H=Math.sqrt(Math.pow(pe.x-G.x,2)+Math.pow(pe.y-G.y,2))}Math.abs(Y-ie)>=2*Math.PI&&(ie=0,Y=2*Math.PI),this.path.push({type:"arc",x:U,y:L,radius:H,startAngle:ie,endAngle:Y,counterclockwise:W})},f.prototype.arcTo=function(U,L,H,ie,Y){throw new Error("arcTo not implemented.")},f.prototype.rect=function(U,L,H,ie){if(isNaN(U)||isNaN(L)||isNaN(H)||isNaN(ie))throw jo.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(U,L),this.lineTo(U+H,L),this.lineTo(U+H,L+ie),this.lineTo(U,L+ie),this.lineTo(U,L),this.lineTo(U+H,L),this.lineTo(U,L)},f.prototype.fillRect=function(U,L,H,ie){if(isNaN(U)||isNaN(L)||isNaN(H)||isNaN(ie))throw jo.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!m.call(this)){var Y={};this.lineCap!=="butt"&&(Y.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Y.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(U,L,H,ie),this.fill(),Y.hasOwnProperty("lineCap")&&(this.lineCap=Y.lineCap),Y.hasOwnProperty("lineJoin")&&(this.lineJoin=Y.lineJoin)}},f.prototype.strokeRect=function(U,L,H,ie){if(isNaN(U)||isNaN(L)||isNaN(H)||isNaN(ie))throw jo.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");x.call(this)||(this.beginPath(),this.rect(U,L,H,ie),this.stroke())},f.prototype.clearRect=function(U,L,H,ie){if(isNaN(U)||isNaN(L)||isNaN(H)||isNaN(ie))throw jo.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(U,L,H,ie))},f.prototype.save=function(U){U=typeof U!="boolean"||U;for(var L=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("q");if(this.pdf.setPage(L),U){this.ctx.fontSize=this.pdf.internal.getFontSize();var ie=new u(this.ctx);this.ctxStack.push(this.ctx),this.ctx=ie}},f.prototype.restore=function(U){U=typeof U!="boolean"||U;for(var L=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("Q");this.pdf.setPage(L),U&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},f.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(U){var L,H,ie,Y;if(U.isCanvasGradient===!0&&(U=U.getColor()),!U)return{r:0,g:0,b:0,a:0,style:U};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(U))L=0,H=0,ie=0,Y=0;else{var W=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(U);if(W!==null)L=parseInt(W[1]),H=parseInt(W[2]),ie=parseInt(W[3]),Y=1;else if((W=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(U))!==null)L=parseInt(W[1]),H=parseInt(W[2]),ie=parseInt(W[3]),Y=parseFloat(W[4]);else{if(Y=1,typeof U=="string"&&U.charAt(0)!=="#"){var se=new kae(U);U=se.ok?se.toHex():"#000000"}U.length===4?(L=U.substring(1,2),L+=L,H=U.substring(2,3),H+=H,ie=U.substring(3,4),ie+=ie):(L=U.substring(1,3),H=U.substring(3,5),ie=U.substring(5,7)),L=parseInt(L,16),H=parseInt(H,16),ie=parseInt(ie,16)}}return{r:L,g:H,b:ie,a:Y,style:U}},m=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},x=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};f.prototype.fillText=function(U,L,H,ie){if(isNaN(L)||isNaN(H)||typeof U!="string")throw jo.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(ie=isNaN(ie)?void 0:ie,!m.call(this)){var Y=F(this.ctx.transform.rotation),W=this.ctx.transform.scaleX;I.call(this,{text:U,x:L,y:H,scale:W,angle:Y,align:this.textAlign,maxWidth:ie})}},f.prototype.strokeText=function(U,L,H,ie){if(isNaN(L)||isNaN(H)||typeof U!="string")throw jo.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!x.call(this)){ie=isNaN(ie)?void 0:ie;var Y=F(this.ctx.transform.rotation),W=this.ctx.transform.scaleX;I.call(this,{text:U,x:L,y:H,scale:W,renderingMode:"stroke",angle:Y,align:this.textAlign,maxWidth:ie})}},f.prototype.measureText=function(U){if(typeof U!="string")throw jo.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var L=this.pdf,H=this.pdf.internal.scaleFactor,ie=L.internal.getFontSize(),Y=L.getStringUnitWidth(U)*ie/L.internal.scaleFactor;return new function(W){var se=(W=W||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return se}}),this}({width:Y*=Math.round(96*H/72*1e4)/1e4})},f.prototype.scale=function(U,L){if(isNaN(U)||isNaN(L))throw jo.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var H=new c(U,0,0,L,0,0);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.rotate=function(U){if(isNaN(U))throw jo.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var L=new c(Math.cos(U),Math.sin(U),-Math.sin(U),Math.cos(U),0,0);this.ctx.transform=this.ctx.transform.multiply(L)},f.prototype.translate=function(U,L){if(isNaN(U)||isNaN(L))throw jo.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var H=new c(1,0,0,1,U,L);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.transform=function(U,L,H,ie,Y,W){if(isNaN(U)||isNaN(L)||isNaN(H)||isNaN(ie)||isNaN(Y)||isNaN(W))throw jo.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var se=new c(U,L,H,ie,Y,W);this.ctx.transform=this.ctx.transform.multiply(se)},f.prototype.setTransform=function(U,L,H,ie,Y,W){U=isNaN(U)?1:U,L=isNaN(L)?0:L,H=isNaN(H)?0:H,ie=isNaN(ie)?1:ie,Y=isNaN(Y)?0:Y,W=isNaN(W)?0:W,this.ctx.transform=new c(U,L,H,ie,Y,W)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};f.prototype.drawImage=function(U,L,H,ie,Y,W,se,pe,G){var te=this.pdf.getImageProperties(U),oe=1,De=1,re=1,ae=1;ie!==void 0&&pe!==void 0&&(re=pe/ie,ae=G/Y,oe=te.width/ie*pe/ie,De=te.height/Y*G/Y),W===void 0&&(W=L,se=H,L=0,H=0),ie!==void 0&&pe===void 0&&(pe=ie,G=Y),ie===void 0&&pe===void 0&&(pe=te.width,G=te.height);for(var ut,pt=this.ctx.transform.decompose(),ft=F(pt.rotate.shx),bt=new c,Lt=(bt=(bt=(bt=bt.multiply(pt.translate)).multiply(pt.skew)).multiply(pt.scale)).applyToRectangle(new l(W-L*re,se-H*ae,ie*oe,Y*De)),Dt=v.call(this,Lt),Bt=[],ge=0;ge<Dt.length;ge+=1)Bt.indexOf(Dt[ge])===-1&&Bt.push(Dt[ge]);if(w(Bt),this.autoPaging)for(var wt=Bt[0],Gt=Bt[Bt.length-1],Sr=wt;Sr<Gt+1;Sr++){this.pdf.setPage(Sr);var wr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],he=Sr===1?this.posY+this.margin[0]:this.margin[0],ot=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Vt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],qt=Sr===1?0:ot+(Sr-2)*Vt;if(this.ctx.clip_path.length!==0){var Re=this.path;ut=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(ut,this.posX+this.margin[3],-qt+he+this.ctx.prevPageLastElemOffset),_.call(this,"fill",!0),this.path=Re}var Ct=JSON.parse(JSON.stringify(Lt));Ct=b([Ct],this.posX+this.margin[3],-qt+he+this.ctx.prevPageLastElemOffset)[0];var Wt=(Sr>wt||Sr<Gt)&&g.call(this);Wt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],wr,Vt,null).clip().discardPath()),this.pdf.addImage(U,"JPEG",Ct.x,Ct.y,Ct.w,Ct.h,null,null,ft),Wt&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(U,"JPEG",Lt.x,Lt.y,Lt.w,Lt.h,null,null,ft)};var v=function(U,L,H){var ie=[];L=L||this.pdf.internal.pageSize.width,H=H||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Y=this.posY+this.ctx.prevPageLastElemOffset;switch(U.type){default:case"mt":case"lt":ie.push(Math.floor((U.y+Y)/H)+1);break;case"arc":ie.push(Math.floor((U.y+Y-U.radius)/H)+1),ie.push(Math.floor((U.y+Y+U.radius)/H)+1);break;case"qct":var W=V(this.ctx.lastPoint.x,this.ctx.lastPoint.y,U.x1,U.y1,U.x,U.y);ie.push(Math.floor((W.y+Y)/H)+1),ie.push(Math.floor((W.y+W.h+Y)/H)+1);break;case"bct":var se=me(this.ctx.lastPoint.x,this.ctx.lastPoint.y,U.x1,U.y1,U.x2,U.y2,U.x,U.y);ie.push(Math.floor((se.y+Y)/H)+1),ie.push(Math.floor((se.y+se.h+Y)/H)+1);break;case"rect":ie.push(Math.floor((U.y+Y)/H)+1),ie.push(Math.floor((U.y+U.h+Y)/H)+1)}for(var pe=0;pe<ie.length;pe+=1)for(;this.pdf.internal.getNumberOfPages()<ie[pe];)y.call(this);return ie},y=function(){var U=this.fillStyle,L=this.strokeStyle,H=this.font,ie=this.lineCap,Y=this.lineWidth,W=this.lineJoin;this.pdf.addPage(),this.fillStyle=U,this.strokeStyle=L,this.font=H,this.lineCap=ie,this.lineWidth=Y,this.lineJoin=W},b=function(U,L,H){for(var ie=0;ie<U.length;ie++)switch(U[ie].type){case"bct":U[ie].x2+=L,U[ie].y2+=H;case"qct":U[ie].x1+=L,U[ie].y1+=H;default:U[ie].x+=L,U[ie].y+=H}return U},w=function(U){return U.sort(function(L,H){return L-H})},j=function(U,L){for(var H,ie,Y=this.fillStyle,W=this.strokeStyle,se=this.lineCap,pe=this.lineWidth,G=Math.abs(pe*this.ctx.transform.scaleX),te=this.lineJoin,oe=JSON.parse(JSON.stringify(this.path)),De=JSON.parse(JSON.stringify(this.path)),re=[],ae=0;ae<De.length;ae++)if(De[ae].x!==void 0)for(var ut=v.call(this,De[ae]),pt=0;pt<ut.length;pt+=1)re.indexOf(ut[pt])===-1&&re.push(ut[pt]);for(var ft=0;ft<re.length;ft++)for(;this.pdf.internal.getNumberOfPages()<re[ft];)y.call(this);if(w(re),this.autoPaging)for(var bt=re[0],Lt=re[re.length-1],Dt=bt;Dt<Lt+1;Dt++){this.pdf.setPage(Dt),this.fillStyle=Y,this.strokeStyle=W,this.lineCap=se,this.lineWidth=G,this.lineJoin=te;var Bt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ge=Dt===1?this.posY+this.margin[0]:this.margin[0],wt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Gt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Sr=Dt===1?0:wt+(Dt-2)*Gt;if(this.ctx.clip_path.length!==0){var wr=this.path;H=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(H,this.posX+this.margin[3],-Sr+ge+this.ctx.prevPageLastElemOffset),_.call(this,U,!0),this.path=wr}if(ie=JSON.parse(JSON.stringify(oe)),this.path=b(ie,this.posX+this.margin[3],-Sr+ge+this.ctx.prevPageLastElemOffset),L===!1||Dt===0){var he=(Dt>bt||Dt<Lt)&&g.call(this);he&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Bt,Gt,null).clip().discardPath()),_.call(this,U,L),he&&this.pdf.restoreGraphicsState()}this.lineWidth=pe}else this.lineWidth=G,_.call(this,U,L),this.lineWidth=pe;this.path=oe},_=function(U,L){if((U!=="stroke"||L||!x.call(this))&&(U==="stroke"||L||!m.call(this))){for(var H,ie,Y=[],W=this.path,se=0;se<W.length;se++){var pe=W[se];switch(pe.type){case"begin":Y.push({begin:!0});break;case"close":Y.push({close:!0});break;case"mt":Y.push({start:pe,deltas:[],abs:[]});break;case"lt":var G=Y.length;if(W[se-1]&&!isNaN(W[se-1].x)&&(H=[pe.x-W[se-1].x,pe.y-W[se-1].y],G>0)){for(;G>=0;G--)if(Y[G-1].close!==!0&&Y[G-1].begin!==!0){Y[G-1].deltas.push(H),Y[G-1].abs.push(pe);break}}break;case"bct":H=[pe.x1-W[se-1].x,pe.y1-W[se-1].y,pe.x2-W[se-1].x,pe.y2-W[se-1].y,pe.x-W[se-1].x,pe.y-W[se-1].y],Y[Y.length-1].deltas.push(H);break;case"qct":var te=W[se-1].x+2/3*(pe.x1-W[se-1].x),oe=W[se-1].y+2/3*(pe.y1-W[se-1].y),De=pe.x+2/3*(pe.x1-pe.x),re=pe.y+2/3*(pe.y1-pe.y),ae=pe.x,ut=pe.y;H=[te-W[se-1].x,oe-W[se-1].y,De-W[se-1].x,re-W[se-1].y,ae-W[se-1].x,ut-W[se-1].y],Y[Y.length-1].deltas.push(H);break;case"arc":Y.push({deltas:[],abs:[],arc:!0}),Array.isArray(Y[Y.length-1].abs)&&Y[Y.length-1].abs.push(pe)}}ie=L?null:U==="stroke"?"stroke":"fill";for(var pt=!1,ft=0;ft<Y.length;ft++)if(Y[ft].arc)for(var bt=Y[ft].abs,Lt=0;Lt<bt.length;Lt++){var Dt=bt[Lt];Dt.type==="arc"?S.call(this,Dt.x,Dt.y,Dt.radius,Dt.startAngle,Dt.endAngle,Dt.counterclockwise,void 0,L,!pt):T.call(this,Dt.x,Dt.y),pt=!0}else if(Y[ft].close===!0)this.pdf.internal.out("h"),pt=!1;else if(Y[ft].begin!==!0){var Bt=Y[ft].start.x,ge=Y[ft].start.y;k.call(this,Y[ft].deltas,Bt,ge),pt=!0}ie&&A.call(this,ie),L&&M.call(this)}},C=function(U){var L=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,H=L*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return U-H;case"top":return U+L-H;case"hanging":return U+L-2*H;case"middle":return U+L/2-H;default:return U}},E=function(U){return U+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};f.prototype.createLinearGradient=function(){var U=function(){};return U.colorStops=[],U.addColorStop=function(L,H){this.colorStops.push([L,H])},U.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},U.isCanvasGradient=!0,U},f.prototype.createPattern=function(){return this.createLinearGradient()},f.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(U,L,H,ie,Y,W,se,pe,G){for(var te=B.call(this,H,ie,Y,W),oe=0;oe<te.length;oe++){var De=te[oe];oe===0&&(G?O.call(this,De.x1+U,De.y1+L):T.call(this,De.x1+U,De.y1+L)),q.call(this,U,L,De.x2,De.y2,De.x3,De.y3,De.x4,De.y4)}pe?M.call(this):A.call(this,se)},A=function(U){switch(U){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},M=function(){this.pdf.clip(),this.pdf.discardPath()},O=function(U,L){this.pdf.internal.out(r(U)+" "+n(L)+" m")},I=function(U){var L;switch(U.align){case"right":case"end":L="right";break;case"center":L="center";break;default:L="left"}var H=this.pdf.getTextDimensions(U.text),ie=C.call(this,U.y),Y=E.call(this,ie)-H.h,W=this.ctx.transform.applyToPoint(new i(U.x,ie)),se=this.ctx.transform.decompose(),pe=new c;pe=(pe=(pe=pe.multiply(se.translate)).multiply(se.skew)).multiply(se.scale);for(var G,te,oe,De=this.ctx.transform.applyToRectangle(new l(U.x,ie,H.w,H.h)),re=pe.applyToRectangle(new l(U.x,Y,H.w,H.h)),ae=v.call(this,re),ut=[],pt=0;pt<ae.length;pt+=1)ut.indexOf(ae[pt])===-1&&ut.push(ae[pt]);if(w(ut),this.autoPaging)for(var ft=ut[0],bt=ut[ut.length-1],Lt=ft;Lt<bt+1;Lt++){this.pdf.setPage(Lt);var Dt=Lt===1?this.posY+this.margin[0]:this.margin[0],Bt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ge=this.pdf.internal.pageSize.height-this.margin[2],wt=ge-this.margin[0],Gt=this.pdf.internal.pageSize.width-this.margin[1],Sr=Gt-this.margin[3],wr=Lt===1?0:Bt+(Lt-2)*wt;if(this.ctx.clip_path.length!==0){var he=this.path;G=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=b(G,this.posX+this.margin[3],-1*wr+Dt),_.call(this,"fill",!0),this.path=he}var ot=b([JSON.parse(JSON.stringify(re))],this.posX+this.margin[3],-wr+Dt+this.ctx.prevPageLastElemOffset)[0];U.scale>=.01&&(te=this.pdf.internal.getFontSize(),this.pdf.setFontSize(te*U.scale),oe=this.lineWidth,this.lineWidth=oe*U.scale);var Vt=this.autoPaging!=="text";if(Vt||ot.y+ot.h<=ge){if(Vt||ot.y>=Dt&&ot.x<=Gt){var qt=Vt?U.text:this.pdf.splitTextToSize(U.text,U.maxWidth||Gt-ot.x)[0],Re=b([JSON.parse(JSON.stringify(De))],this.posX+this.margin[3],-wr+Dt+this.ctx.prevPageLastElemOffset)[0],Ct=Vt&&(Lt>ft||Lt<bt)&&g.call(this);Ct&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Sr,wt,null).clip().discardPath()),this.pdf.text(qt,Re.x,Re.y,{angle:U.angle,align:L,renderingMode:U.renderingMode}),Ct&&this.pdf.restoreGraphicsState()}}else ot.y<ge&&(this.ctx.prevPageLastElemOffset+=ge-ot.y);U.scale>=.01&&(this.pdf.setFontSize(te),this.lineWidth=oe)}else U.scale>=.01&&(te=this.pdf.internal.getFontSize(),this.pdf.setFontSize(te*U.scale),oe=this.lineWidth,this.lineWidth=oe*U.scale),this.pdf.text(U.text,W.x+this.posX,W.y+this.posY,{angle:U.angle,align:L,renderingMode:U.renderingMode,maxWidth:U.maxWidth}),U.scale>=.01&&(this.pdf.setFontSize(te),this.lineWidth=oe)},T=function(U,L,H,ie){H=H||0,ie=ie||0,this.pdf.internal.out(r(U+H)+" "+n(L+ie)+" l")},k=function(U,L,H){return this.pdf.lines(U,L,H,null,null)},q=function(U,L,H,ie,Y,W,se,pe){this.pdf.internal.out([t(s(H+U)),t(o(ie+L)),t(s(Y+U)),t(o(W+L)),t(s(se+U)),t(o(pe+L)),"c"].join(" "))},B=function(U,L,H,ie){for(var Y=2*Math.PI,W=Math.PI/2;L>H;)L-=Y;var se=Math.abs(H-L);se<Y&&ie&&(se=Y-se);for(var pe=[],G=ie?-1:1,te=L;se>1e-5;){var oe=te+G*Math.min(se,W);pe.push(z.call(this,U,te,oe)),se-=Math.abs(oe-te),te=oe}return pe},z=function(U,L,H){var ie=(H-L)/2,Y=U*Math.cos(ie),W=U*Math.sin(ie),se=Y,pe=-W,G=se*se+pe*pe,te=G+se*Y+pe*W,oe=4/3*(Math.sqrt(2*G*te)-te)/(se*W-pe*Y),De=se-oe*pe,re=pe+oe*se,ae=De,ut=-re,pt=ie+L,ft=Math.cos(pt),bt=Math.sin(pt);return{x1:U*Math.cos(L),y1:U*Math.sin(L),x2:De*ft-re*bt,y2:De*bt+re*ft,x3:ae*ft-ut*bt,y3:ae*bt+ut*ft,x4:U*Math.cos(H),y4:U*Math.sin(H)}},F=function(U){return 180*U/Math.PI},V=function(U,L,H,ie,Y,W){var se=U+.5*(H-U),pe=L+.5*(ie-L),G=Y+.5*(H-Y),te=W+.5*(ie-W),oe=Math.min(U,Y,se,G),De=Math.max(U,Y,se,G),re=Math.min(L,W,pe,te),ae=Math.max(L,W,pe,te);return new l(oe,re,De-oe,ae-re)},me=function(U,L,H,ie,Y,W,se,pe){var G,te,oe,De,re,ae,ut,pt,ft,bt,Lt,Dt,Bt,ge,wt=H-U,Gt=ie-L,Sr=Y-H,wr=W-ie,he=se-Y,ot=pe-W;for(te=0;te<41;te++)ft=(ut=(oe=U+(G=te/40)*wt)+G*((re=H+G*Sr)-oe))+G*(re+G*(Y+G*he-re)-ut),bt=(pt=(De=L+G*Gt)+G*((ae=ie+G*wr)-De))+G*(ae+G*(W+G*ot-ae)-pt),te==0?(Lt=ft,Dt=bt,Bt=ft,ge=bt):(Lt=Math.min(Lt,ft),Dt=Math.min(Dt,bt),Bt=Math.max(Bt,ft),ge=Math.max(ge,bt));return new l(Math.round(Lt),Math.round(Dt),Math.round(Bt-Lt),Math.round(ge-Dt))},be=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var U,L,H=(U=this.ctx.lineDash,L=this.ctx.lineDashOffset,JSON.stringify({lineDash:U,lineDashOffset:L}));this.prevLineDash!==H&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=H)}}})(Ta.API),function(e){var t=function(i){var l,c,d,u,f,h,m,x,g,v;for(c=[],d=0,u=(i+=l="\0\0\0\0".slice(i.length%4||4)).length;u>d;d+=4)(f=(i.charCodeAt(d)<<24)+(i.charCodeAt(d+1)<<16)+(i.charCodeAt(d+2)<<8)+i.charCodeAt(d+3))!==0?(h=(f=((f=((f=((f=(f-(v=f%85))/85)-(g=f%85))/85)-(x=f%85))/85)-(m=f%85))/85)%85,c.push(h+33,m+33,x+33,g+33,v+33)):c.push(122);return function(y,b){for(var w=b;w>0;w--)y.pop()}(c,l.length),String.fromCharCode.apply(String,c)+"~>"},r=function(i){var l,c,d,u,f,h=String,m="length",x=255,g="charCodeAt",v="slice",y="replace";for(i[v](-2),i=i[v](0,-2)[y](/\s/g,"")[y]("z","!!!!!"),d=[],u=0,f=(i+=l="uuuuu"[v](i[m]%5||5))[m];f>u;u+=5)c=52200625*(i[g](u)-33)+614125*(i[g](u+1)-33)+7225*(i[g](u+2)-33)+85*(i[g](u+3)-33)+(i[g](u+4)-33),d.push(x&c>>24,x&c>>16,x&c>>8,x&c);return function(b,w){for(var j=w;j>0;j--)b.pop()}(d,l[m]),h.fromCharCode.apply(h,d)},n=function(i){return i.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},s=function(i){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((i=i.replace(/\s/g,"")).indexOf(">")!==-1&&(i=i.substr(0,i.indexOf(">"))),i.length%2&&(i+="0"),l.test(i)===!1)return"";for(var c="",d=0;d<i.length;d+=2)c+=String.fromCharCode("0x"+(i[d]+i[d+1]));return c},o=function(i){for(var l=new Uint8Array(i.length),c=i.length;c--;)l[c]=i.charCodeAt(c);return(l=x3(l)).reduce(function(d,u){return d+String.fromCharCode(u)},"")};e.processDataByFilters=function(i,l){var c=0,d=i||"",u=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":d=r(d),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=t(d),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=s(d),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=n(d),u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=o(d),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:d,reverseChain:u.reverse().join(" ")}}}(Ta.API),function(e){e.loadFile=function(t,r,n){return function(s,o,i){o=o!==!1,i=typeof i=="function"?i:function(){};var l=void 0;try{l=function(c,d,u){var f=new XMLHttpRequest,h=0,m=function(x){var g=x.length,v=[],y=String.fromCharCode;for(h=0;h<g;h+=1)v.push(y(255&x.charCodeAt(h)));return v.join("")};if(f.open("GET",c,!d),f.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(f.onload=function(){f.status===200?u(m(this.responseText)):u(void 0)}),f.send(null),d&&f.status===200)return m(f.responseText)}(s,o,i)}catch{}return l}(t,r,n)},e.loadImageFile=e.loadFile}(Ta.API),function(e){function t(){return(os.html2canvas?Promise.resolve(os.html2canvas):zf(()=>import("./html2canvas.esm-f16e60ff.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function r(){return(os.DOMPurify?Promise.resolve(os.DOMPurify):zf(()=>import("./purify.es-fd086bfc.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var n=function(l){var c=Ms(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},s=function(l,c){var d=document.createElement(l);for(var u in c.className&&(d.className=c.className),c.innerHTML&&c.dompurify&&(d.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)d.style[u]=c.style[u];return d},o=function l(c,d){for(var u=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),f=c.firstChild;f;f=f.nextSibling)d!==!0&&f.nodeType===1&&f.nodeName==="SCRIPT"||u.appendChild(l(f,d));return c.nodeType===1&&(c.nodeName==="CANVAS"?(u.width=c.width,u.height=c.height,u.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(u.value=c.value),u.addEventListener("load",function(){u.scrollTop=c.scrollTop,u.scrollLeft=c.scrollLeft},!0)),u},i=function l(c){var d=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),u=l.convert(Promise.resolve(),d);return(u=u.setProgress(1,l,1,[l])).set(c)};(i.prototype=Object.create(Promise.prototype)).constructor=i,i.convert=function(l,c){return l.__proto__=c||i.prototype,l},i.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},i.prototype.from=function(l,c){return this.then(function(){switch(c=c||function(d){switch(n(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(l),c){case"string":return this.then(r).then(function(d){return this.set({src:s("div",{innerHTML:l,dompurify:d})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},i.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},i.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=o(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},i.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,c(this.prop.container,d)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},i.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(t).then(function(c){var d=this.opt.jsPDF,u=this.opt.fontFaces,f=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,h=Object.assign({async:!0,allowTaint:!0,scale:f,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete h.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=u,u)for(var m=0;m<u.length;++m){var x=u[m],g=x.src.find(function(v){return v.format==="truetype"});g&&d.addFont(g.url,x.ref.name,x.ref.style)}return h.windowHeight=h.windowHeight||0,h.windowHeight=h.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):h.windowHeight,d.context2d.save(!0),c(this.prop.container,h)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},i.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},i.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},i.prototype.output=function(l,c,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},i.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},i.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},i.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},i.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},i.prototype.set=function(l){if(n(l)!=="object")return this;var c=Object.keys(l||{}).map(function(d){if(d in i.template.prop)return function(){this.prop[d]=l[d]};switch(d){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[d]=l[d]}}},this);return this.then(function(){return this.thenList(c)})},i.prototype.get=function(l,c){return this.then(function(){var d=l in i.template.prop?this.prop[l]:this.opt[l];return c?c(d):d})},i.prototype.setMargin=function(l){return this.then(function(){switch(n(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},i.prototype.setPageSize=function(l){function c(d,u){return Math.floor(d*u/72*96)}return this.then(function(){(l=l||Ta.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},i.prototype.setProgress=function(l,c,d,u){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),d!=null&&(this.progress.n=d),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},i.prototype.updateProgress=function(l,c,d,u){return this.setProgress(l?this.progress.val+l:null,c||null,d?this.progress.n+d:null,u?this.progress.stack.concat(u):null)},i.prototype.then=function(l,c){var d=this;return this.thenCore(l,c,function(u,f){return d.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,function(h){return d.updateProgress(null,u),h}).then(u,f).then(function(h){return d.updateProgress(1),h})})},i.prototype.thenCore=function(l,c,d){d=d||Promise.prototype.then;var u=this;l&&(l=l.bind(u)),c&&(c=c.bind(u));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?u:i.convert(Object.assign({},u),Promise.prototype),h=d.call(f,l,c);return i.convert(h,u.__proto__)},i.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},i.prototype.thenList=function(l){var c=this;return l.forEach(function(d){c=c.thenCore(d)}),c},i.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return i.convert(c,this)},i.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},i.prototype.error=function(l){return this.then(function(){throw new Error(l)})},i.prototype.using=i.prototype.set,i.prototype.saveAs=i.prototype.save,i.prototype.export=i.prototype.output,i.prototype.run=i.prototype.then,Ta.getPageSize=function(l,c,d){if(Ms(l)==="object"){var u=l;l=u.orientation,c=u.unit||c,d=u.format||d}c=c||"mm",d=d||"a4",l=(""+(l||"P")).toLowerCase();var f,h=(""+d).toLowerCase(),m={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":f=1;break;case"mm":f=72/25.4;break;case"cm":f=72/2.54;break;case"in":f=72;break;case"px":f=.75;break;case"pc":case"em":f=12;break;case"ex":f=6;break;default:throw"Invalid unit: "+c}var x,g=0,v=0;if(m.hasOwnProperty(h))g=m[h][1]/f,v=m[h][0]/f;else try{g=d[1],v=d[0]}catch{throw new Error("Invalid format: "+d)}if(l==="p"||l==="portrait")l="p",v>g&&(x=v,v=g,g=x);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",g>v&&(x=v,v=g,g=x)}return{width:v,height:g,unit:c,k:f,orientation:l}},e.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(gk):null;var d=new i(c);return c.worker?d:d.from(l).doCallback()}}(Ta.API),Ta.API.addJS=function(e){return iU=e,this.internal.events.subscribe("postPutResources",function(){Z_=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Z_+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),oU=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+iU+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Z_!==void 0&&oU!==void 0&&this.internal.out("/Names <</JavaScript "+Z_+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var s=r.outline.render().split(/\r\n/),o=0;o<s.length;o++){var i=s[o],l=n.exec(i);if(l!=null){var c=l[1];r.internal.newObjectDeferredBegin(c,!1)}r.internal.write(i)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,u=[];for(o=0;o<d;o++){var f=r.internal.newObject();u.push(f);var h=r.internal.getPageInfo(o+1);r.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var m=r.internal.newObject();for(r.internal.write("<< /Names [ "),o=0;o<u.length;o++)r.internal.write("(page_"+(o+1)+")"+u[o]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+m+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var r=this;r.outline.root.children.length>0&&(r.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&r.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,s,o){var i={title:s,options:o,children:[]};return n==null&&(n=this.root),n.children.push(i),i},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var s=0;s<n.children.length;s++)this.genIds_r(n.children[s])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var s=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<n.children.length;o++){var i=n.children[o];this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(n)),o>0&&this.line("/Prev "+this.makeRef(n.children[o-1])),o<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[o+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var l=this.count=this.count_r({count:0},i);if(l>0&&this.line("/Count "+l),i.options&&i.options.pageNumber){var c=r.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+s(0)+" 0]")}this.objEnd()}for(var d=0;d<n.children.length;d++)this.renderItems(n.children[d])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,s){for(var o=0;o<s.children.length;o++)n.count++,this.count_r(n,s.children[o]);return n.count}}])}(Ta.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,n,s,o,i,l){var c,d=this.decode.DCT_DECODE,u=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=i||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,c=function(f){for(var h,m=256*f.charCodeAt(4)+f.charCodeAt(5),x=f.length,g={width:0,height:0,numcomponents:1},v=4;v<x;v+=2){if(v+=m,t.indexOf(f.charCodeAt(v+1))!==-1){h=256*f.charCodeAt(v+5)+f.charCodeAt(v+6),g={width:256*f.charCodeAt(v+7)+f.charCodeAt(v+8),height:h,numcomponents:f.charCodeAt(v+9)};break}m=256*f.charCodeAt(v+2)+f.charCodeAt(v+3)}return g}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}u={data:r,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:d,index:n,alias:s}}return u}}(Ta.API),Ta.API.processPNG=function(e,t,r,n){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var s,o=LQe(e,{checkCrc:!0}),i=o.width,l=o.height,c=o.channels,d=o.palette,u=o.depth;s=d&&c===1?function(S){for(var A=S.width,M=S.height,O=S.data,I=S.palette,T=S.depth,k=!1,q=[],B=[],z=void 0,F=!1,V=0,me=0;me<I.length;me++){var be=t9(I[me],4),U=be[0],L=be[1],H=be[2],ie=be[3];q.push(U,L,H),ie!=null&&(ie===0?(V++,B.length<1&&B.push(me)):ie<255&&(F=!0))}if(F||V>1){k=!0,B=void 0;var Y=A*M;z=new Uint8Array(Y);for(var W=new DataView(O.buffer),se=0;se<Y;se++){var pe=vk(W,se,T),G=t9(I[pe],4)[3];z[se]=G}}else V===0&&(B=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:k?8:void 0,colorBytes:O,alphaBytes:z,needSMask:k,palette:q,mask:B}}(o):c===2||c===4?function(S){for(var A=S.data,M=S.width,O=S.height,I=S.channels,T=S.depth,k=I===2?"DeviceGray":"DeviceRGB",q=I-1,B=M*O,z=q,F=B*z,V=1*B,me=Math.ceil(F*T/8),be=Math.ceil(V*T/8),U=new Uint8Array(me),L=new Uint8Array(be),H=new DataView(A.buffer),ie=new DataView(U.buffer),Y=new DataView(L.buffer),W=!1,se=0;se<B;se++){for(var pe=se*I,G=0;G<z;G++)gU(ie,vk(H,pe+G,T),se*z+G,T);var te=vk(H,pe+z,T);te<(1<<T)-1&&(W=!0),gU(Y,te,1*se,T)}return{colorSpace:k,colorsPerPixel:q,sMaskBitsPerComponent:W?T:void 0,colorBytes:U,alphaBytes:L,needSMask:W}}(o):function(S){var A=S.data,M=S.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:M,colorsPerPixel:M==="DeviceGray"?1:3,colorBytes:A instanceof Uint16Array?function(O){for(var I=O.length,T=new Uint8Array(2*I),k=new DataView(T.buffer,T.byteOffset,T.byteLength),q=0;q<I;q++)k.setUint16(2*q,O[q],!1);return T}(A):A,needSMask:!1}}(o);var f,h,m,x=s,g=x.colorSpace,v=x.colorsPerPixel,y=x.sMaskBitsPerComponent,b=x.colorBytes,w=x.alphaBytes,j=x.needSMask,_=x.palette,C=x.mask,E=null;return n!==Ta.API.image_compression.NONE&&typeof x3=="function"?(E=function(S){var A;switch(S){case Ta.API.image_compression.FAST:A=11;break;case Ta.API.image_compression.MEDIUM:A=13;break;case Ta.API.image_compression.SLOW:A=14;break;default:A=12}return A}(n),f=this.decode.FLATE_DECODE,h="/Predictor ".concat(E," /Colors ").concat(v," /BitsPerComponent ").concat(u," /Columns ").concat(i),e=uU(b,Math.ceil(i*v*u/8),v,u,n),j&&(m=uU(w,Math.ceil(i*y/8),1,y,n))):(f=void 0,h=void 0,e=b,j&&(m=w)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(m&&this.__addimage__.isArrayBuffer(m)||this.__addimage__.isArrayBufferView(m))&&(m=this.__addimage__.arrayBufferToBinaryString(m)),{alias:r,data:e,index:t,filter:f,decodeParameters:h,transparency:C,palette:_,sMask:m,predictor:E,width:i,height:l,bitsPerComponent:u,sMaskBitsPerComponent:y,colorSpace:g}}},function(e){e.processGIF89A=function(t,r,n,s){var o=new oZe(t),i=o.width,l=o.height,c=[];o.decodeAndBlitFrameRGBA(0,c);var d={data:c,width:i,height:l},u=new yk(100).encode(d,100);return e.processJPEG.call(this,u,r,n,s)},e.processGIF87A=e.processGIF89A}(Ta.API),Fu.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:s,green:n,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Fu.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){jo.log("bit decode error:"+r)}},Fu.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,s=0;s<t;s++)for(var o=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+8*s*4,l=0;l<8&&8*s+l<this.width;l++){var c=this.palette[o>>7-l&1];this.data[i+4*l]=c.blue,this.data[i+4*l+1]=c.green,this.data[i+4*l+2]=c.red,this.data[i+4*l+3]=255}r!==0&&(this.pos+=4-r)}},Fu.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<e;s++){var o=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+2*s*4,l=o>>4,c=15&o,d=this.palette[l];if(this.data[i]=d.blue,this.data[i+1]=d.green,this.data[i+2]=d.red,this.data[i+3]=255,2*s+1>=this.width)break;d=this.palette[c],this.data[i+4]=d.blue,this.data[i+4+1]=d.green,this.data[i+4+2]=d.red,this.data[i+4+3]=255}t!==0&&(this.pos+=4-t)}},Fu.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var s=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+4*n;if(s<this.palette.length){var i=this.palette[s];this.data[o]=i.red,this.data[o+1]=i.green,this.data[o+2]=i.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}e!==0&&(this.pos+=4-e)}},Fu.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<this.width;s++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(o&t)/t*255|0,l=(o>>5&t)/t*255|0,c=(o>>10&t)/t*255|0,d=o>>15?255:0,u=n*this.width*4+4*s;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=i,this.data[u+3]=d}this.pos+=e}},Fu.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var s=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(i&t)/t*255|0,c=(i>>5&r)/r*255|0,d=(i>>11)/t*255|0,u=s*this.width*4+4*o;this.data[u]=d,this.data[u+1]=c,this.data[u+2]=l,this.data[u+3]=255}this.pos+=e}},Fu.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),i=t*this.width*4+4*r;this.data[i]=o,this.data[i+1]=s,this.data[i+2]=n,this.data[i+3]=255}this.pos+=this.width%4}},Fu.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*r;this.data[l]=o,this.data[l+1]=s,this.data[l+2]=n,this.data[l+3]=i}},Fu.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,s){var o=new Fu(t,!1),i=o.width,l=o.height,c={data:o.getData(),width:i,height:l},d=new yk(100).encode(c,100);return e.processJPEG.call(this,d,r,n,s)}}(Ta.API),vU.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,s){var o=new vU(t),i=o.width,l=o.height,c={data:o.getData(),width:i,height:l},d=new yk(100).encode(c,100);return e.processJPEG.call(this,d,r,n,s)}}(Ta.API),Ta.API.processRGBA=function(e,t,r){for(var n=e.data,s=n.length,o=new Uint8Array(s/4*3),i=new Uint8Array(s/4),l=0,c=0,d=0;d<s;d+=4){var u=n[d],f=n[d+1],h=n[d+2],m=n[d+3];o[l++]=u,o[l++]=f,o[l++]=h,i[c++]=m}var x=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(i),data:x,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Ta.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Qx=Ta.API,e2=Qx.getCharWidthsArray=function(e,t){var r,n,s=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),i=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:s.metadata.Unicode.widths,c=l.fof?l.fof:1,d=t.kerning?t.kerning:s.metadata.Unicode.kerning,u=d.fof?d.fof:1,f=t.doKerning!==!1,h=0,m=e.length,x=0,g=l[0]||c,v=[];for(r=0;r<m;r++)n=e.charCodeAt(r),typeof s.metadata.widthOfString=="function"?v.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(n))+i*(1e3/o)||0)/1e3):(h=f&&Ms(d[n])==="object"&&!isNaN(parseInt(d[n][x],10))?d[n][x]/u:0,v.push((l[n]||g)/c+h)),x=n;return v},lU=Qx.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),s=t.charSpace||this.internal.getCharSpace();return Qx.processArabic&&(e=Qx.processArabic(e)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(e,r,s)/r:e2.apply(this,arguments).reduce(function(o,i){return o+i},0)},cU=function(e,t,r,n){for(var s=[],o=0,i=e.length,l=0;o!==i&&l+t[o]<r;)l+=t[o],o++;s.push(e.slice(0,o));var c=o;for(l=0;o!==i;)l+t[o]>n&&(s.push(e.slice(c,o)),l=0,c=o),l+=t[o],o++;return c!==o&&s.push(e.slice(c,o)),s},dU=function(e,t,r){r||(r={});var n,s,o,i,l,c,d,u=[],f=[u],h=r.textIndent||0,m=0,x=0,g=e.split(" "),v=e2.apply(this,[" ",r])[0];if(c=r.lineIndent===-1?g[0].length+2:r.lineIndent||0){var y=Array(c).join(" "),b=[];g.map(function(j){(j=j.split(/\s*\n/)).length>1?b=b.concat(j.map(function(_,C){return(C&&_.length?`
`:"")+_})):b.push(j[0])}),g=b,c=lU.apply(this,[y,r])}for(o=0,i=g.length;o<i;o++){var w=0;if(n=g[o],c&&n[0]==`
`&&(n=n.substr(1),w=1),h+m+(x=(s=e2.apply(this,[n,r])).reduce(function(j,_){return j+_},0))>t||w){if(x>t){for(l=cU.apply(this,[n,s,t-(h+m),t]),u.push(l.shift()),u=[l.pop()];l.length;)f.push([l.shift()]);x=s.slice(n.length-(u[0]?u[0].length:0)).reduce(function(j,_){return j+_},0)}else u=[n];f.push(u),h=x+c,m=v}else u.push(n),h+=m+x,m=v}return d=c?function(j,_){return(_?y:"")+j.join(" ")}:function(j){return j.join(" ")},f.map(d)},Qx.splitTextToSize=function(e,t,r){var n,s=(r=r||{}).fontSize||this.internal.getFontSize(),o=function(u){if(u.widths&&u.kerning)return{widths:u.widths,kerning:u.kerning};var f=this.internal.getFont(u.fontName,u.fontStyle),h="Unicode";return f.metadata[h]?{widths:f.metadata[h].widths||{0:1},kerning:f.metadata[h].kerning||{}}:{font:f.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var i=1*this.internal.scaleFactor*t/s;o.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/s:0,o.lineIndent=r.lineIndent;var l,c,d=[];for(l=0,c=n.length;l<c;l++)d=d.concat(dU.apply(this,[n[l],i,o]));return d},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",r="klmnopqrstuvwxyz",n={},s={},o=0;o<16;o++)n[r[o]]=t[o],s[t[o]]=r[o];var i=function(h){return"0x"+parseInt(h,10).toString(16)},l=e.__fontmetrics__.compress=function(h){var m,x,g,v,y=["{"];for(var b in h){if(m=h[b],isNaN(parseInt(b,10))?x="'"+b+"'":(b=parseInt(b,10),x=(x=i(b).slice(2)).slice(0,-1)+s[x.slice(-1)]),typeof m=="number")m<0?(g=i(m).slice(3),v="-"):(g=i(m).slice(2),v=""),g=v+g.slice(0,-1)+s[g.slice(-1)];else{if(Ms(m)!=="object")throw new Error("Don't know what to do with value type "+Ms(m)+".");g=l(m)}y.push(x+g)}return y.push("}"),y.join("")},c=e.__fontmetrics__.uncompress=function(h){if(typeof h!="string")throw new Error("Invalid argument passed to uncompress.");for(var m,x,g,v,y={},b=1,w=y,j=[],_="",C="",E=h.length-1,S=1;S<E;S+=1)(v=h[S])=="'"?m?(g=m.join(""),m=void 0):m=[]:m?m.push(v):v=="{"?(j.push([w,g]),w={},g=void 0):v=="}"?((x=j.pop())[0][x[1]]=w,g=void 0,w=x[0]):v=="-"?b=-1:g===void 0?n.hasOwnProperty(v)?(_+=n[v],g=parseInt(_,16)*b,b=1,_=""):_+=v:n.hasOwnProperty(v)?(C+=n[v],w[g]=parseInt(C,16)*b,b=1,g=void 0,C=""):C+=v;return y},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},f={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(h){var m=h.font,x=f.Unicode[m.postScriptName];x&&(m.metadata.Unicode={},m.metadata.Unicode.widths=x.widths,m.metadata.Unicode.kerning=x.kerning);var g=u.Unicode[m.postScriptName];g&&(m.metadata.Unicode.encoding=g,m.encoding=g.codePages[0])}])}(Ta.API),function(e){var t=function(r){for(var n=r.length,s=new Uint8Array(n),o=0;o<n;o++)s[o]=r.charCodeAt(o);return s};e.API.events.push(["addFont",function(r){var n=void 0,s=r.font,o=r.instance;if(!s.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if(typeof(n=o.existsFileInVFS(s.postScriptName)===!1?o.loadFile(s.postScriptName):o.getFileFromVFS(s.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");(function(i,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(z2(l)),i.metadata=e.API.TTFFont.open(l),i.metadata.Unicode=i.metadata.Unicode||{encoding:{},kerning:{},widths:[]},i.metadata.glyIdsUsed=[0]})(s,n)}}])}(Ta),Ta.API.addSvgAsImage=function(e,t,r,n,s,o,i,l){if(isNaN(t)||isNaN(r))throw jo.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(s))throw jo.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=n,c.height=s;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},f=this;return(os.canvg?Promise.resolve(os.canvg):zf(()=>import("./index.es-6f2dee36.js"),[])).catch(function(h){return Promise.reject(new Error("Could not load canvg: "+h))}).then(function(h){return h.default?h.default:h}).then(function(h){return h.fromString(d,e,u)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(h){return h.render(u)}).then(function(){f.addImage(c.toDataURL("image/jpeg",1),t,r,n,s,i,l)})},Ta.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var s=0;s<this.internal.pages[n].length;s++)this.internal.pages[n][s]=this.internal.pages[n][s].replace(t,r);return this},Ta.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,s,o,i={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(i),c=[],d=0,u=0,f=0;function h(x,g){var v,y=!1;for(v=0;v<x.length;v+=1)x[v]===g&&(y=!0);return y}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(i)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var m=l.length;for(f=0;f<m;f+=1)r[l[f]].value=r[l[f]].defaultValue,r[l[f]].explicitSet=!1}if(Ms(e)==="object"){for(s in e)if(o=e[s],h(l,s)&&o!==void 0){if(r[s].type==="boolean"&&typeof o=="boolean")r[s].value=o;else if(r[s].type==="name"&&h(r[s].valueSet,o))r[s].value=o;else if(r[s].type==="integer"&&Number.isInteger(o))r[s].value=o;else if(r[s].type==="array"){for(d=0;d<o.length;d+=1)if(n=!0,o[d].length===1&&typeof o[d][0]=="number")c.push(String(o[d]-1));else if(o[d].length>1){for(u=0;u<o[d].length;u+=1)typeof o[d][u]!="number"&&(n=!1);n===!0&&c.push([o[d][0]-1,o[d][1]-1].join(" "))}r[s].value="["+c.join(" ")+"]"}else r[s].value=r[s].defaultValue;r[s].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var x,g=[];for(x in r)r[x].explicitSet===!0&&(r[x].type==="name"?g.push("/"+x+" /"+r[x].value):g.push("/"+x+" "+r[x].value));g.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+g.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',s=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(n)),i=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),d=o.length+i.length+l.length+s.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+d+" >>"),this.internal.write("stream"),this.internal.write(s+o+i+l+c),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(n,s){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:s||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(Ta.API),function(e){var t=e.API,r=t.pdfEscape16=function(o,i){for(var l,c=i.metadata.Unicode.widths,d=["","0","00","000","0000"],u=[""],f=0,h=o.length;f<h;++f){if(l=i.metadata.characterToGlyph(o.charCodeAt(f)),i.metadata.glyIdsUsed.push(l),i.metadata.toUnicode[l]=o.charCodeAt(f),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(i.metadata.widthOfGlyph(l),10)])),l=="0")return u.join("");l=l.toString(16),u.push(d[4-l.length],l)}return u.join("")},n=function(o){var i,l,c,d,u,f,h;for(u=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],f=0,h=(l=Object.keys(o).sort(function(m,x){return m-x})).length;f<h;f++)i=l[f],c.length>=100&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),o[i]!==void 0&&o[i]!==null&&typeof o[i].toString=="function"&&(d=("0000"+o[i].toString(16)).slice(-4),i=("0000"+(+i).toString(16)).slice(-4),c.push("<"+i+"><"+d+">"));return c.length&&(u+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),u+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(o){(function(i){var l=i.font,c=i.out,d=i.newObject,u=i.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="Identity-H"){for(var f=l.metadata.Unicode.widths,h=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),m="",x=0;x<h.length;x++)m+=String.fromCharCode(h[x]);var g=d();u({data:m,addLength1:!0,objectId:g}),c("endobj");var v=d();u({data:n(l.metadata.toUnicode),addLength1:!0,objectId:v}),c("endobj");var y=d();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+dv(l.fontName)),c("/FontFile2 "+g+" 0 R"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var b=d();c("<<"),c("/Type /Font"),c("/BaseFont /"+dv(l.fontName)),c("/FontDescriptor "+y+" 0 R"),c("/W "+e.API.PDFObject.convert(f)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=d(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+v+" 0 R"),c("/BaseFont /"+dv(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+b+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]),t.events.push(["putFont",function(o){(function(i){var l=i.font,c=i.out,d=i.newObject,u=i.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var f=l.metadata.rawData,h="",m=0;m<f.length;m++)h+=String.fromCharCode(f[m]);var x=d();u({data:h,addLength1:!0,objectId:x}),c("endobj");var g=d();u({data:n(l.metadata.toUnicode),addLength1:!0,objectId:g}),c("endobj");var v=d();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+x+" 0 R"),c("/Flags 96"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+dv(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=d();for(var y=0;y<l.metadata.hmtx.widths.length;y++)l.metadata.hmtx.widths[y]=parseInt(l.metadata.hmtx.widths[y]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+g+" 0 R/BaseFont/"+dv(l.fontName)+"/FontDescriptor "+v+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]);var s=function(o){var i,l=o.text||"",c=o.x,d=o.y,u=o.options||{},f=o.mutex||{},h=f.pdfEscape,m=f.activeFontKey,x=f.fonts,g=m,v="",y=0,b="",w=x[g].encoding;if(x[g].encoding!=="Identity-H")return{text:l,x:c,y:d,options:u,mutex:f};for(b=l,g=m,Array.isArray(l)&&(b=l[0]),y=0;y<b.length;y+=1)x[g].metadata.hasOwnProperty("cmap")&&(i=x[g].metadata.cmap.unicode.codeMap[b[y].charCodeAt(0)]),i||b[y].charCodeAt(0)<256&&x[g].metadata.hasOwnProperty("Unicode")?v+=b[y]:v+="";var j="";return parseInt(g.slice(1))<14||w==="WinAnsiEncoding"?j=h(v,g).split("").map(function(_){return _.charCodeAt(0).toString(16)}).join(""):w==="Identity-H"&&(j=r(v,x[g])),f.isHex=!0,{text:j,x:c,y:d,options:u,mutex:f}};t.events.push(["postProcessText",function(o){var i=o.text||"",l=[],c={text:i,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(i)){var d=0;for(d=0;d<i.length;d+=1)Array.isArray(i[d])&&i[d].length===3?l.push([s(Object.assign({},c,{text:i[d][0]})).text,i[d][1],i[d][2]]):l.push(s(Object.assign({},c,{text:i[d]})).text);o.text=l}else o.text=s(Object.assign({},c,{text:i})).text}])}(Ta),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,n){return t.call(this),this.internal.vFS[r]=n,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(Ta.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(n){var s,o,i,l,c,d,u,f=t,h=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],m=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],x={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},g={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},v=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],y=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),b=!1,w=0;this.__bidiEngine__={};var j=function(O){var I=O.charCodeAt(),T=I>>8,k=g[T];return k!==void 0?f[256*k+(255&I)]:T===252||T===253?"AL":y.test(T)?"L":T===8?"R":"N"},_=function(O){for(var I,T=0;T<O.length;T++){if((I=j(O.charAt(T)))==="L")return!1;if(I==="R")return!0}return!1},C=function(O,I,T,k){var q,B,z,F,V=I[k];switch(V){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":b=!1;break;case"N":case"AN":break;case"EN":b&&(V="AN");break;case"AL":b=!0,V="R";break;case"WS":case"BN":V="N";break;case"CS":k<1||k+1>=I.length||(q=T[k-1])!=="EN"&&q!=="AN"||(B=I[k+1])!=="EN"&&B!=="AN"?V="N":b&&(B="AN"),V=B===q?B:"N";break;case"ES":V=(q=k>0?T[k-1]:"B")==="EN"&&k+1<I.length&&I[k+1]==="EN"?"EN":"N";break;case"ET":if(k>0&&T[k-1]==="EN"){V="EN";break}if(b){V="N";break}for(z=k+1,F=I.length;z<F&&I[z]==="ET";)z++;V=z<F&&I[z]==="EN"?"EN":"N";break;case"NSM":if(i&&!l){for(F=I.length,z=k+1;z<F&&I[z]==="NSM";)z++;if(z<F){var me=O[k],be=me>=1425&&me<=2303||me===64286;if(q=I[z],be&&(q==="R"||q==="AL")){V="R";break}}}V=k<1||(q=I[k-1])==="B"?"N":T[k-1];break;case"B":b=!1,s=!0,V=w;break;case"S":o=!0,V="N"}return V},E=function(O,I,T){var k=O.split("");return T&&S(k,T,{hiLevel:w}),k.reverse(),I&&I.reverse(),k.join("")},S=function(O,I,T){var k,q,B,z,F,V=-1,me=O.length,be=0,U=[],L=w?m:h,H=[];for(b=!1,s=!1,o=!1,q=0;q<me;q++)H[q]=j(O[q]);for(B=0;B<me;B++){if(F=be,U[B]=C(O,H,U,B),k=240&(be=L[F][x[U[B]]]),be&=15,I[B]=z=L[be][5],k>0)if(k===16){for(q=V;q<B;q++)I[q]=1;V=-1}else V=-1;if(L[be][6])V===-1&&(V=B);else if(V>-1){for(q=V;q<B;q++)I[q]=z;V=-1}H[B]==="B"&&(I[B]=0),T.hiLevel|=z}o&&function(ie,Y,W){for(var se=0;se<W;se++)if(ie[se]==="S"){Y[se]=w;for(var pe=se-1;pe>=0&&ie[pe]==="WS";pe--)Y[pe]=w}}(H,I,me)},A=function(O,I,T,k,q){if(!(q.hiLevel<O)){if(O===1&&w===1&&!s)return I.reverse(),void(T&&T.reverse());for(var B,z,F,V,me=I.length,be=0;be<me;){if(k[be]>=O){for(F=be+1;F<me&&k[F]>=O;)F++;for(V=be,z=F-1;V<z;V++,z--)B=I[V],I[V]=I[z],I[z]=B,T&&(B=T[V],T[V]=T[z],T[z]=B);be=F}be++}}},M=function(O,I,T){var k=O.split(""),q={hiLevel:w};return T||(T=[]),S(k,T,q),function(B,z,F){if(F.hiLevel!==0&&u)for(var V,me=0;me<B.length;me++)z[me]===1&&(V=v.indexOf(B[me]))>=0&&(B[me]=v[V+1])}(k,T,q),A(2,k,I,T,q),A(1,k,I,T,q),k.join("")};return this.__bidiEngine__.doBidiReorder=function(O,I,T){if(function(q,B){if(B)for(var z=0;z<q.length;z++)B[z]=z;l===void 0&&(l=_(q)),d===void 0&&(d=_(q))}(O,I),i||!c||d)if(i&&c&&l^d)w=l?1:0,O=E(O,I,T);else if(!i&&c&&d)w=l?1:0,O=M(O,I,T),O=E(O,I);else if(!i||l||c||d){if(i&&!c&&l^d)O=E(O,I),l?(w=0,O=M(O,I,T)):(w=1,O=M(O,I,T),O=E(O,I));else if(i&&l&&!c&&d)w=1,O=M(O,I,T),O=E(O,I);else if(!i&&!c&&l^d){var k=u;l?(w=1,O=M(O,I,T),w=0,u=!1,O=M(O,I,T),u=k):(w=0,O=M(O,I,T),O=E(O,I),w=1,u=!1,O=M(O,I,T),u=k,O=E(O,I))}}else w=0,O=M(O,I,T);else w=l?1:0,O=M(O,I,T);return O},this.__bidiEngine__.setOptions=function(O){O&&(i=O.isInputVisual,c=O.isOutputVisual,l=O.isInputRtl,d=O.isOutputRtl,u=O.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(n){var s=n.text;n.x,n.y;var o=n.options||{};n.mutex,o.lang;var i=[];if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,r.setOptions(o),Object.prototype.toString.call(s)==="[object Array]"){var l=0;for(i=[],l=0;l<s.length;l+=1)Object.prototype.toString.call(s[l])==="[object Array]"?i.push([r.doBidiReorder(s[l][0]),s[l][1],s[l][2]]):i.push([r.doBidiReorder(s[l])]);n.text=i}else n.text=r.doBidiReorder(s);r.setOptions({isInputVisual:!0})}])}(Ta),Ta.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new jp(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new wZe(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new iZe(this.contents),this.head=new cZe(this),this.name=new hZe(this),this.cmap=new qae(this),this.toUnicode={},this.hhea=new dZe(this),this.maxp=new pZe(this),this.hmtx=new gZe(this),this.post=new fZe(this),this.os2=new uZe(this),this.loca=new bZe(this),this.glyf=new xZe(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,n,s,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var i,l,c,d;for(d=[],i=0,l=(c=this.bbox).length;i<l;i++)t=c[i],d.push(Math.round(t*this.scaleFactor));return d}.call(this),this.stemV=0,this.post.exists?(n=255&(s=this.post.italic_angle),32768&(r=s>>16)&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,n){var s,o,i,l;for(i=0,o=0,l=(t=""+t).length;0<=l?o<l:o>l;o=0<=l?++o:--o)s=t.charCodeAt(o),i+=this.widthOfGlyph(this.characterToGlyph(s))+n*(1e3/r)||0;return i*(r/1e3)},e.prototype.lineHeight=function(t,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},e}();var pf,jp=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,n;for(n=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(t){var r,n,s;for(s=[],r=0,n=t.length;0<=n?r<n:r>n;r=0<=n?++r:--r)s.push(this.writeByte(t.charCodeAt(r)));return s},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,n,s,o,i,l,c;return t=this.readByte(),r=this.readByte(),n=this.readByte(),s=this.readByte(),o=this.readByte(),i=this.readByte(),l=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^s)+16777216*(255^o)+65536*(255^i)+256*(255^l)+(255^c)+1):72057594037927940*t+281474976710656*r+1099511627776*n+4294967296*s+16777216*o+65536*i+256*l+c},e.prototype.writeLongLong=function(t){var r,n;return r=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,n;for(r=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)r.push(this.readByte());return r},e.prototype.write=function(t){var r,n,s,o;for(o=[],n=0,s=t.length;n<s;n++)r=t[n],o.push(this.writeByte(r));return o},e}(),iZe=function(){var e;function t(r){var n,s,o;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},s=0,o=this.tableCount;0<=o?s<o:s>o;s=0<=o?++s:--s)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(r){var n,s,o,i,l,c,d,u,f,h,m,x,g;for(g in m=Object.keys(r).length,c=Math.log(2),f=16*Math.floor(Math.log(m)/c),i=Math.floor(f/c),u=16*m-f,(s=new jp).writeInt(this.scalarType),s.writeShort(m),s.writeShort(f),s.writeShort(i),s.writeShort(u),o=16*m,d=s.pos+o,l=null,x=[],r)for(h=r[g],s.writeString(g),s.writeInt(e(h)),s.writeInt(d),s.writeInt(h.length),x=x.concat(h),g==="head"&&(l=d),d+=h.length;d%4;)x.push(0),d++;return s.write(x),n=2981146554-e(s.data),s.pos=l+8,s.writeUInt32(n),s.data},e=function(r){var n,s,o,i;for(r=zae.call(r);r.length%4;)r.push(0);for(o=new jp(r),s=0,n=0,i=r.length;n<i;n=n+=4)s+=o.readUInt32();return 4294967295&s},t}(),lZe={}.hasOwnProperty,tm=function(e,t){for(var r in t)lZe.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};pf=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var cZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new jp).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),yU=function(){function e(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),f=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(m=t.readUInt16(),h=m/2,t.pos+=6,o=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),t.pos+=2,g=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),d=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),u=function(){var j,_;for(_=[],c=j=0;0<=h?j<h:j>h;c=0<=h?++j:--j)_.push(t.readUInt16());return _}(),s=(this.length-t.pos+this.offset)/2,l=function(){var j,_;for(_=[],c=j=0;0<=s?j<s:j>s;c=0<=s?++j:--j)_.push(t.readUInt16());return _}(),c=y=0,w=o.length;y<w;c=++y)for(v=o[c],n=b=x=g[c];x<=v?b<=v:b>=v;n=x<=v?++b:--b)u[c]===0?i=n+d[c]:(i=l[u[c]/2+(n-x)-(h-c)]||0)!==0&&(i+=d[c]),this.codeMap[n]=65535&i}t.pos=f}return e.encode=function(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y,b,w,j,_,C,E,S,A,M,O,I,T,k,q,B,z,F,V,me,be,U,L,H,ie,Y,W,se,pe,G,te,oe;switch(k=new jp,i=Object.keys(t).sort(function(De,re){return De-re}),r){case"macroman":for(g=0,v=function(){var De=[];for(x=0;x<256;++x)De.push(0);return De}(),b={0:0},o={},q=0,V=i.length;q<V;q++)b[pe=t[s=i[q]]]==null&&(b[pe]=++g),o[s]={old:t[s],new:b[t[s]]},v[s]=b[t[s]];return k.writeUInt16(1),k.writeUInt16(0),k.writeUInt32(12),k.writeUInt16(0),k.writeUInt16(262),k.writeUInt16(0),k.write(v),{charMap:o,subtable:k.data,maxGlyphID:g+1};case"unicode":for(I=[],f=[],w=0,b={},n={},y=d=null,B=0,me=i.length;B<me;B++)b[_=t[s=i[B]]]==null&&(b[_]=++w),n[s]={old:_,new:b[_]},l=b[_]-s,y!=null&&l===d||(y&&f.push(y),I.push(s),d=l),y=s;for(y&&f.push(y),f.push(65535),I.push(65535),M=2*(A=I.length),S=2*Math.pow(Math.log(A)/Math.LN2,2),h=Math.log(S/2)/Math.LN2,E=2*A-S,c=[],C=[],m=[],x=z=0,be=I.length;z<be;x=++z){if(O=I[x],u=f[x],O===65535){c.push(0),C.push(0);break}if(O-(T=n[O].new)>=32768)for(c.push(0),C.push(2*(m.length+A-x)),s=F=O;O<=u?F<=u:F>=u;s=O<=u?++F:--F)m.push(n[s].new);else c.push(T-O),C.push(0)}for(k.writeUInt16(3),k.writeUInt16(1),k.writeUInt32(12),k.writeUInt16(4),k.writeUInt16(16+8*A+2*m.length),k.writeUInt16(0),k.writeUInt16(M),k.writeUInt16(S),k.writeUInt16(h),k.writeUInt16(E),W=0,U=f.length;W<U;W++)s=f[W],k.writeUInt16(s);for(k.writeUInt16(0),se=0,L=I.length;se<L;se++)s=I[se],k.writeUInt16(s);for(G=0,H=c.length;G<H;G++)l=c[G],k.writeUInt16(l);for(te=0,ie=C.length;te<ie;te++)j=C[te],k.writeUInt16(j);for(oe=0,Y=m.length;oe<Y;oe++)g=m[oe],k.writeUInt16(g);return{charMap:n,subtable:k.data,maxGlyphID:w+1}}},e}(),qae=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,n,s;for(t.pos=this.offset,this.version=t.readUInt16(),s=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=s?n<s:n>s;n=0<=s?++n:--n)r=new yU(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var n,s;return r==null&&(r="macroman"),n=yU.encode(t,r),(s=new jp).writeUInt16(0),s.writeUInt16(1),n.table=s.data.concat(n.subtable),n},e}(),dZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),uZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(t.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),fZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="post",e.prototype.parse=function(t){var r,n,s;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var o;for(n=t.readUInt16(),this.glyphNameIndex=[],o=0;0<=n?o<n:o>n;o=0<=n?++o:--o)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],s=[];t.pos<this.offset+this.length;)r=t.readByte(),s.push(this.names.push(t.readString(r)));return s;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 262144:return this.map=function(){var i,l,c;for(c=[],o=i=0,l=this.file.maxp.numGlyphs;0<=l?i<l:i>l;o=0<=l?++i:--i)c.push(t.readUInt32());return c}.call(this)}},e}(),mZe=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},hZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="name",e.prototype.parse=function(t){var r,n,s,o,i,l,c,d,u,f,h;for(t.pos=this.offset,t.readShort(),r=t.readShort(),l=t.readShort(),n=[],o=0;0<=r?o<r:o>r;o=0<=r?++o:--o)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+l+t.readShort()});for(c={},o=u=0,f=n.length;u<f;o=++u)s=n[o],t.pos=s.offset,d=t.readString(s.length),i=new mZe(d,s),c[h=s.nameID]==null&&(c[h]=[]),c[s.nameID].push(i);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},e}(),pZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),gZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,n,s,o,i,l,c;for(t.pos=this.offset,this.metrics=[],r=0,l=this.file.hhea.numberOfMetrics;0<=l?r<l:r>l;r=0<=l?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,u;for(u=[],r=d=0;0<=s?d<s:d>s;r=0<=s?++d:--d)u.push(t.readInt16());return u}(),this.widths=function(){var d,u,f,h;for(h=[],d=0,u=(f=this.metrics).length;d<u;d++)o=f[d],h.push(o.advance);return h}.call(this),n=this.widths[this.widths.length-1],c=[],r=i=0;0<=s?i<s:i>s;r=0<=s?++i:--i)c.push(this.widths.push(n));return c},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),zae=[].slice,xZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,n,s,o,i,l,c,d,u,f;return t in this.cache?this.cache[t]:(o=this.file.loca,r=this.file.contents,n=o.indexOf(t),(s=o.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+n,i=(l=new jp(r.read(s))).readShort(),d=l.readShort(),f=l.readShort(),c=l.readShort(),u=l.readShort(),this.cache[t]=i===-1?new yZe(l,d,f,c,u):new vZe(l,i,d,f,c,u),this.cache[t]))},e.prototype.encode=function(t,r,n){var s,o,i,l,c;for(i=[],o=[],l=0,c=r.length;l<c;l++)s=t[r[l]],o.push(i.length),s&&(i=i.concat(s.encode(n)));return o.push(i.length),{table:i,offsets:o}},e}(),vZe=function(){function e(t,r,n,s,o,i){this.raw=t,this.numberOfContours=r,this.xMin=n,this.yMin=s,this.xMax=o,this.yMax=i,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),yZe=function(){function e(t,r,n,s,o){var i,l;for(this.raw=t,this.xMin=r,this.yMin=n,this.xMax=s,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],i=this.raw;l=i.readShort(),this.glyphOffsets.push(i.pos),this.glyphIDs.push(i.readUInt16()),32&l;)i.pos+=1&l?4:2,128&l?i.pos+=8:64&l?i.pos+=4:8&l&&(i.pos+=2)}return e.prototype.encode=function(){var t,r,n;for(r=new jp(zae.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),bZe=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return tm(e,pf),e.prototype.tag="loca",e.prototype.parse=function(t){var r,n;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?function(){var s,o;for(o=[],n=0,s=this.length;n<s;n+=2)o.push(2*t.readUInt16());return o}.call(this):function(){var s,o;for(o=[],n=0,s=this.length;n<s;n+=4)o.push(t.readUInt32());return o}.call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var n=new Uint32Array(this.offsets.length),s=0,o=0,i=0;i<n.length;++i)if(n[i]=s,o<r.length&&r[o]==i){++o,n[i]=s;var l=this.offsets[i],c=this.offsets[i+1]-l;c>0&&(s+=c)}for(var d=new Array(4*n.length),u=0;u<n.length;++u)d[4*u+3]=255&n[u],d[4*u+2]=(65280&n[u])>>8,d[4*u+1]=(16711680&n[u])>>16,d[4*u]=(4278190080&n[u])>>24;return d},e}(),wZe=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,n,s,o;for(r in s=this.font.cmap.tables[0].codeMap,t={},o=this.subset)n=o[r],t[r]=s[n];return t},e.prototype.glyphsFor=function(t){var r,n,s,o,i,l,c;for(s={},i=0,l=t.length;i<l;i++)s[o=t[i]]=this.font.glyf.glyphFor(o);for(o in r=[],s)(n=s[o])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(o in c=this.glyphsFor(r))n=c[o],s[o]=n;return s},e.prototype.encode=function(t,r){var n,s,o,i,l,c,d,u,f,h,m,x,g,v,y;for(s in n=qae.encode(this.generateCmap(),"unicode"),i=this.glyphsFor(t),m={0:0},y=n.charMap)m[(c=y[s]).old]=c.new;for(x in h=n.maxGlyphID,i)x in m||(m[x]=h++);return u=function(b){var w,j;for(w in j={},b)j[b[w]]=w;return j}(m),f=Object.keys(u).sort(function(b,w){return b-w}),g=function(){var b,w,j;for(j=[],b=0,w=f.length;b<w;b++)l=f[b],j.push(u[l]);return j}(),o=this.font.glyf.encode(i,g,m),d=this.font.loca.encode(o.offsets,g),v={cmap:this.font.cmap.raw(),glyf:o.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(v["OS/2"]=this.font.os2.raw()),this.font.directory.encode(v)},e}();Ta.API.PDFObject=function(){var e;function t(){}return e=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},t.convert=function(r){var n,s,o,i;if(Array.isArray(r))return"["+function(){var l,c,d;for(d=[],l=0,c=r.length;l<c;l++)n=r[l],d.push(t.convert(n));return d}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r?.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(s in o=["<<"],r)i=r[s],o.push("/"+s+" "+t.convert(i));return o.push(">>"),o.join(`
`)}return""+r},t}();const jZe=Object.freeze(Object.defineProperty({__proto__:null,AcroForm:QQe,AcroFormAppearance:Ca,AcroFormButton:Vi,AcroFormCheckBox:cw,AcroFormChoiceField:Lg,AcroFormComboBox:Bg,AcroFormEditBox:iw,AcroFormListBox:$g,AcroFormPasswordField:dw,AcroFormPushButton:lw,AcroFormRadioButton:qg,AcroFormTextField:ip,GState:F1,ShadingPattern:kh,TilingPattern:Ag,default:Ta,jsPDF:Ta},Symbol.toStringTag,{value:"Module"})),Ai=e=>{const t=String(e??"").replace(/\D/g,"");if(!t)return"";const r=(Number(t)/100).toFixed(2),[n,s]=r.split(".");return`${n.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${s}`},el=e=>{if(e==null||e==="")return NaN;const t=String(e).replace(/\./g,"").replace(",","."),r=parseFloat(t);return Number.isFinite(r)?r:NaN};function _Ze({setIsModalOpen:e,setBookings:t,form:r,setForm:n,localCustomers:s,onOpenClientModal:o,onClientModalSuccess:i}){const{toast:l}=Zs(),{userProfile:c}=lo(),{loadAlerts:d}=oj(),{isPaymentModalOpen:u,closePaymentModal:f,editingBooking:h,paymentTotal:m,setPaymentTotal:x,participantsForm:g,setParticipantsForm:v,payMethods:y,openEditParticipantModal:b,protectPaymentModal:w,unprotectPaymentModal:j,onParticipantReplacedRef:_,lastVisibilityChangeTime:C,isModalProtected:E}=qN();window.__protectPaymentModal=w,p.useEffect(()=>(u&&(document.body.style.overflow="auto",document.body.style.pointerEvents="auto"),()=>{document.body.style.overflow="",document.body.style.pointerEvents=""}),[u]);const[S,A]=p.useState(""),[M,O]=p.useState([]);p.useState(null);const[I,T]=p.useState(null),[k,q]=p.useState(!1),[B,z]=p.useState(""),[F,V]=p.useState(!1),[me,be]=p.useState([]);p.useState(null);const[U,L]=p.useState(0),[H,ie]=p.useState(!1),[Y,W]=p.useState(""),[se,pe]=p.useState([]),[G,te]=p.useState([]),oe=p.useRef(!1),De=p.useRef({}),re=p.useRef({}),ae=p.useRef({}),[ut,pt]=p.useState(null),[ft,bt]=p.useState(null),[Lt,Dt]=p.useState(!1),[Bt,ge]=p.useState("downloading"),[wt,Gt]=p.useState(0),[Sr,wr]=p.useState(null),[he,ot]=p.useState(""),[Vt,qt]=p.useState(null),Re=p.useRef(null),Ct=p.useRef(null),Wt=p.useRef(null),Er=p.useRef(null),Me=p.useRef([]),lt=p.useRef(null),gt=p.useRef(!1),or=p.useRef(null),br=p.useRef([]),[ur,an]=p.useState({isOpen:!1,participantIndex:null,currentStatus:null}),zr=p.useRef(!1),Gr=p.useCallback((at,Te)=>{te(Fe=>{const cr=[...Fe];return at>=0&&at<cr.length&&(Te===""&&cr[at].nome&&(ae.current[at]=cr[at].nome),Te!==""&&delete ae.current[at],cr[at]={...cr[at],nome:Te}),v(cr),cr})},[v]),ha=p.useCallback(at=>{const Te=ae.current[at];Te&&(te(Fe=>{const cr=[...Fe];return at>=0&&at<cr.length&&(cr[at]={...cr[at],nome:Te}),delete ae.current[at],v(cr),cr}),setTimeout(()=>{De.current[at]?.focus()},0))},[v]),pn=p.useCallback((at,Te,Fe)=>{if(Te==="Pago"){const cr=el(Fe);if(Number.isFinite(cr)&&cr>0)return}zr.current=!0,console.log(" [StatusConfirmation] Modal protegido por 3 segundos"),setTimeout(()=>{zr.current=!1,console.log(" [StatusConfirmation] Proteo removida")},3e3),an({isOpen:!0,participantIndex:at,currentStatus:Te})},[]),on=p.useCallback(at=>{const{participantIndex:Te}=ur;Te!==null&&(te(Fe=>{const cr=[...Fe];return Te>=0&&Te<cr.length&&(cr[Te]={...cr[Te],status_pagamento:at}),v(cr),cr}),setTimeout(()=>{console.log(" [StatusChange] Recarregando alertas..."),d().catch(Fe=>{console.error(" [StatusChange] Erro ao recarregar alertas:",Fe)})},500)),an({isOpen:!1,participantIndex:null,currentStatus:null})},[ur,v,d]),cn=p.useCallback(at=>!s||!Array.isArray(s)?!1:s.find(Fe=>Fe.id===at)?.is_consumidor_final===!0,[s]),ke=p.useCallback(()=>{const at=M||[],Te=(G||[]).map((ht,Xr)=>({...ht,_originalIndex:Xr})).filter(ht=>!at.includes(ht._originalIndex)),Fe=Te.find(ht=>cn(ht.cliente_id)&&ht.nome&&ht.nome.toLowerCase().includes("cliente consumidor"));return Fe?Fe._originalIndex:Te.find(ht=>cn(ht.cliente_id)&&ht.nome)?._originalIndex??null},[G,M,cn]),We=p.useCallback(at=>{const Te=M||[],cr=(G||[]).map((Xr,Ft)=>({...Xr,_originalIndex:Ft})).filter(Xr=>!Te.includes(Xr._originalIndex)).filter(Xr=>cn(Xr.cliente_id));if(cr.length===0)return null;const ht=cr.findIndex(Xr=>Xr._originalIndex===at);return ht!==-1?ht<cr.length-1?cr[ht+1]._originalIndex:cr[0]._originalIndex:null},[G,M,cn]),Ze=p.useCallback(at=>{const Te=M||[],cr=(G||[]).map((Xr,Ft)=>({...Xr,_originalIndex:Ft})).filter(Xr=>!Te.includes(Xr._originalIndex)).filter(Xr=>cn(Xr.cliente_id)),ht=cr.findIndex(Xr=>Xr._originalIndex===at);return ht>0?cr[ht-1]._originalIndex:null},[G,M,cn]),Je=p.useCallback(()=>{if(!y||y.length===0)return null;const at=y.find(Te=>Te.codigo_interno==="01");return at||y[0]},[y]),At=p.useMemo(()=>{const at=G||[],Te=M||[];return at.filter((Fe,cr)=>!Te.includes(cr)).length},[G,M]),Ye=p.useMemo(()=>{const at=G||[],Te=M||[],Fe=at.filter((er,Nt)=>!Te.includes(Nt)),cr=el(m);let ht=0,Xr=0,Ft=0,kr=!1;Fe.forEach(er=>{let Nt=el(er?.valor_cota);if(er?.aplicar_taxa===!0&&Number.isFinite(Nt)){const Lr=y.find(ra=>String(ra.id)===String(er.finalizadora_id)),un=Number(Lr?.taxa_percentual||0);un>0&&(Nt=Nt/(1+un/100),kr=!0)}Number.isFinite(Nt)&&(ht+=Nt),(er?.status_pagamento||"Pendente")==="Pago"?Xr++:Ft++});const jt=Number.isFinite(cr)?ht-cr:0;return{totalTarget:cr,totalAssigned:ht,diff:jt,paid:Xr,pending:Ft,temTaxaAplicada:kr}},[G,M,m,y]),lr=()=>{const at=el(m);if(!Number.isFinite(at)||At===0)return;const Te=at/At,Fe=Ai(String(Te.toFixed(2)));te(cr=>{const ht=[...cr];return ht.forEach((Xr,Ft)=>{ht[Ft]={...ht[Ft],valor_cota:Fe,status_pagamento:"Pago",aplicar_taxa:!1}}),ht})},ce=()=>{te(at=>{const Te=[...at];return Te.forEach((Fe,cr)=>{Te[cr]={...Te[cr],valor_cota:"",status_pagamento:"Pendente",aplicar_taxa:!1}}),Te})},qe=()=>{te(at=>{const Te=[...at];return Te.forEach((Fe,cr)=>{const ht=el(Fe.valor_cota);if(ht>0){const Ft=y.find(jt=>String(jt.id)===String(Fe.finalizadora_id)),kr=Number(Ft?.taxa_percentual||0);if(kr>0&&!Fe.aplicar_taxa){const jt=ht*(1+kr/100);Te[cr]={...Te[cr],aplicar_taxa:!0,valor_cota:Ai(jt.toFixed(2))}}}}),Te})},ze=(at,Te)=>{const cr=(G||[])[at]?.nome||Te||"";b(at,cr)},xt=()=>{W(m||""),ie(!0)},rr=()=>{try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] confirmEditingTotal",{prev:m,next:Y,timestamp:new Date().toISOString()})}catch{}x(Y),ie(!1)},ir=()=>{W(""),ie(!1)},Kr=async(at={})=>{const{autoSave:Te=!1}=at;try{if(gt.current||k){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [SAVE-PAYMENTS] Salvamento ignorado (j existe um em andamento)",{autoSave:Te})}catch{}return}gt.current=!0,q(!0);const Fe=h?.id,cr=c?.codigo_empresa;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [SAVE-PAYMENTS] Iniciando salvamento",{autoSave:Te,agendamentoId:Fe,timestamp:new Date().toISOString()})}catch{}if(!Fe||!cr){l({title:"Erro ao salvar pagamentos",description:"Agendamento ou empresa indisponvel.",variant:"destructive"});return}const ht=(G||[]).filter((Ie,Oe)=>!(M||[]).includes(Oe)).slice().sort((Ie,Oe)=>{const Yt=Number(Ie?.ordem),Pt=Number(Oe?.ordem),Qt=Number.isFinite(Yt),nr=Number.isFinite(Pt);return Qt&&nr?Yt-Pt:Qt&&!nr?-1:!Qt&&nr?1:0}),Xr=H?Y:m;try{if(H){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] forcing total from editing state before save",{prev:m,editingTotalValue:Y,totalStrToSave:Xr,timestamp:new Date().toISOString()})}catch{}x(Xr),ie(!1)}}catch{}let Ft=0;const kr=ht.reduce((Ie,Oe)=>{const Yt=Oe.status_pagamento||"Pendente";return Ie+(Yt!=="Pago"?1:0)},0);try{localStorage.getItem("debug:agenda")==="1"&&(console.log(" [SAVE-PAYMENTS] Dados a salvar:",{totalParticipantes:ht.length,pendentes:kr}),console.log("[ORDER-SAVE] savingIds:",ht.map(Ie=>Ie.cliente_id)))}catch{}const jt=new Date().toISOString();try{localStorage.getItem("debug:agenda")==="1"&&console.log(`

========== SALVAMENTO INICIADO ${jt} ==========`)}catch{}const{data:er,error:Nt}=await Q.from("agendamento_participantes").select("*").eq("codigo_empresa",cr).eq("agendamento_id",Fe).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(Nt)throw console.error(" Erro ao buscar participantes originais:",Nt),Nt;try{localStorage.getItem("debug:agenda")==="1"&&(console.log(` Participantes originais no banco: ${er?.length||0}`),console.log("[ORDER-SAVE] originalIds:",(er||[]).map(Ie=>Ie.cliente_id)))}catch{}Ft=0,ht.forEach((Ie,Oe)=>{console.log(`  #${Oe+1} (novo): ${Ie.nome}`)});const Cr=(er||[]).map(Ie=>String(Ie?.id||"")),Lr=(ht||[]).map(Ie=>String(Ie?.participante_row_id||""));if(Cr.length>0&&Cr.length===Lr.length&&Lr.every(Boolean)&&Cr.every((Ie,Oe)=>Ie===Lr[Oe])){console.log(" Atualizando participantes existentes (sem recriar / sem mexer na ordem)");for(let Ie=0;Ie<ht.length;Ie++){const Oe=ht[Ie],Yt=el(Oe.valor_cota),Pt=Je(),Qt=Oe.finalizadora_id||(Pt?.id?String(Pt.id):null),nr=Number.isFinite(Number(Oe?.ordem))?Number(Oe.ordem):Ie+1,{error:fn}=await Q.from("agendamento_participantes").update({nome:(Oe?.nome||"").trim()||"Cliente Consumidor",valor_cota:Number.isFinite(Yt)?Yt:0,status_pagamento:Oe.status_pagamento||"Pendente",finalizadora_id:Qt,aplicar_taxa:Oe.aplicar_taxa||!1,ordem:nr,is_representante:Ie===0,deleted_at:null}).eq("codigo_empresa",cr).eq("agendamento_id",Fe).eq("id",String(Oe.participante_row_id));if(fn)throw console.error(" Erro ao atualizar participante existente:",fn),fn}}else{console.log(" Fazendo recriao completa de participantes (soft-delete + insert)");try{const{error:Ie}=await Q.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).eq("codigo_empresa",cr).eq("agendamento_id",Fe).is("deleted_at",null);if(Ie)throw console.error(" Erro ao aplicar soft-delete nos participantes atuais:",Ie),Ie}catch(Ie){throw console.error(" Falha ao soft-deletar participantes antes de recriar:",Ie),Ie}if(ht.length>0){const Ie=ht.map((Yt,Pt)=>{const Qt=el(Yt.valor_cota),nr=Je(),fn=Yt.finalizadora_id||(nr?.id?String(nr.id):null),J=Number.isFinite(Number(Yt?.ordem))?Number(Yt.ordem):Pt+1;return{codigo_empresa:cr,agendamento_id:Fe,cliente_id:Yt.cliente_id,nome:(Yt?.nome||"").trim()||"Cliente Consumidor",valor_cota:Number.isFinite(Qt)?Qt:0,status_pagamento:Yt.status_pagamento||"Pendente",finalizadora_id:fn,aplicar_taxa:Yt.aplicar_taxa||!1,ordem:J,is_representante:Pt===0,deleted_at:null}}),{error:Oe}=await Q.from("agendamento_participantes").insert(Ie);if(Oe)throw console.error(" Erro ao inserir participantes recriados:",Oe),Oe}}console.log(" Salvamento de participantes concludo"),console.log("========== SALVAMENTO CONCLUDO ==========");const ra=ht.map(Ie=>({id:Ie.cliente_id,nome:Ie.nome,codigo:Ie.codigo!==null&&Ie.codigo!==void 0?Ie.codigo:null})),Wn=ra[0]||null,ln=ra.map(Ie=>Ie?.nome).filter(Boolean),da=el(Xr),va=Number.isFinite(da)?da:null;try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] updating agendamentos.valor_total",{agendamentoId:Fe,codigo_empresa:cr,totalStrToSave:Xr,totalNum:da,totalToPersist:va,timestamp:new Date().toISOString()})}catch{}const{data:oa,error:Tn}=await Q.from("agendamentos").update({cliente_id:Wn?.id??null,clientes:ln,valor_total:va}).eq("codigo_empresa",cr).eq("id",Fe).select("id, valor_total");try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal][TOTAL] update agendamentos result",{ok:!Tn,error:Tn?Tn.message||Tn:null,data:oa,timestamp:new Date().toISOString()})}catch{}if(Tn)throw Tn;n(Ie=>({...Ie,selectedClients:ra})),t(Ie=>Ie.map(Oe=>Oe.id===Fe?{...Oe,customer:Wn?.nome||Oe.customer,cliente_id:Wn?.id??null,clientes:ln,valor_total:va}:Oe));let ee=ht;if(ft!==null){const Ie=De.current?.[ft]?.value;typeof Ie=="string"&&(ee=[...ht],ft>=0&&ft<ee.length&&(ee[ft]={...ee[ft],nome:Ie}))}te(ee),O([]),Te||(kr>0?l({title:"Pagamentos salvos",description:`${kr} ${kr===1?"pendente":"pendentes"}`,variant:"warning"}):l({title:"Pagamentos salvos",variant:"success"})),T(null),v(ht);try{window.dispatchEvent(new CustomEvent("payments:saved",{detail:{agendamentoId:Fe,participants:ht}}))}catch{}d().catch(Ie=>{console.error("[PaymentModal] Erro ao recarregar alertas:",Ie)});try{localStorage.getItem("debug:agenda")==="1"&&(console.log(" [SAVE-PAYMENTS] Salvamento concludo com sucesso"),console.log(" [SAVE-PAYMENTS] Contagem final de pendentes:",kr))}catch{}console.log(" [LOG 2 - FECHAR PAYMENT MODAL] Dados salvos no banco:"),console.log("   Total:",ht.length),console.log("   Pendentes:",kr),ht.forEach((Ie,Oe)=>{console.log(`   #${Oe+1}: ${Ie.nome} | Status: ${Ie.status_pagamento} | Valor: ${Ie.valor_cota}`)}),Te&&console.log(" [SAVE-PAYMENTS] Salvamento em modo autoSave (sem fechar modal)")}catch(Fe){throw console.error(" [SAVE-PAYMENTS] Erro ao salvar:",Fe),l({title:"Erro ao salvar pagamentos",description:"Tente novamente.",variant:"destructive"}),Fe}finally{gt.current=!1,q(!1)}},jr=p.useCallback(async(at="close")=>{try{if(!u||oe.current||Lt&&Bt==="downloading"||ur?.isOpen||F||E&&String(at)==="interactOutside")return;oe.current=!0;try{await Kr({autoSave:!0})}catch(Te){console.error("[PaymentModal] Falha ao salvar ao fechar:",Te)}finally{try{j()}catch{}f({force:!0});try{window.dispatchEvent(new Event("paymentmodal:closed"))}catch{}}}catch{}finally{oe.current=!1}},[u,Lt,Bt,ur?.isOpen,F,E,Kr,f,j]);p.useEffect(()=>{const at=Te=>{if(u&&!F&&!Lt&&(Te.key==="Escape"&&(Te.preventDefault(),jr("escape-key")),Te.key==="F8"&&(Te.preventDefault(),m&&At>0&&lr()),Te.key==="F9"&&(Te.preventDefault(),At>0&&qe()),Te.key==="F10"&&(Te.preventDefault(),At>0&&ce()),Te.key==="Delete")){const Fe=document.activeElement;if(!(Fe&&Fe.tagName==="INPUT")){Te.preventDefault();const ht=ke();ht!==null&&(Gr(ht,""),setTimeout(()=>{De.current[ht]?.focus()},0))}}};return window.addEventListener("keydown",at),()=>window.removeEventListener("keydown",at)},[u,F,Lt,m,At,lr,qe,ce,jr,G,M,cn,Gr,ke]),p.useEffect(()=>{if(u){const at=ke();pt(at)}},[u,G,M,ke]),p.useEffect(()=>{if(u){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Modal aberto - payMethods:",y?.length||0,"initializedRef:",Ct.current)}catch{}Wt.current=setTimeout(()=>{try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Timeout de 3s acionado - initializedRef:",Ct.current,"payMethods:",y?.length||0)}catch{}if(!Ct.current&&(!y||y.length===0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log(" [PaymentModal] Inicializando com timeout (sem finalizadoras)")}catch{}const at=(r?.selectedClients||[]).map(Te=>{let Fe=Te.codigo;if(Fe==null&&s&&Array.isArray(s)){const cr=s.find(ht=>ht.id===Te.id);Fe=cr?.codigo!==null&&cr?.codigo!==void 0?cr.codigo:null}return{cliente_id:Te.id,nome:Te.nome,codigo:Fe,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1}});Array.isArray(G)&&G.length>0||te(at),Ct.current=Date.now()}},3e3),!Ct.current&&y&&y.length>0&&(Wt.current&&(clearTimeout(Wt.current),Wt.current=null),(async()=>{const{defaultMethod:Te,defaultFinalizadoraId:Fe,defaultAplicarTaxa:cr}=(()=>{const kr=Je(),jt=kr?.id?String(kr.id):null,er=Number(kr?.taxa_percentual||0)>0;return{defaultMethod:kr,defaultFinalizadoraId:jt,defaultAplicarTaxa:er}})();let ht=[],Xr="nenhuma";if(h?.id)try{const{data:kr,error:jt}=await Q.from("agendamento_participantes").select("*").eq("agendamento_id",h.id).eq("codigo_empresa",c?.codigo_empresa).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});jt?console.error(" Erro ao buscar participantes:",jt):kr&&kr.length>0?(ht=[...kr].sort((Nt,Cr)=>{const Lr=Number(Nt?.ordem),un=Number(Cr?.ordem),ra=Number.isFinite(Lr),Wn=Number.isFinite(un);if(ra&&Wn&&Lr!==un)return Lr-un;if(ra&&!Wn)return-1;if(!ra&&Wn)return 1;const ln=String(Nt?.id??""),da=String(Cr?.id??"");return ln.localeCompare(da)}).map(Nt=>({participante_row_id:Nt.id,cliente_id:Nt.cliente_id,nome:Nt.nome,codigo:null,valor_cota:Nt.valor_cota?Ai(String(Number(Nt.valor_cota).toFixed(2))):"0,00",status_pagamento:Nt.status_pagamento||"Pendente",finalizadora_id:Nt.finalizadora_id?String(Nt.finalizadora_id):Fe,aplicar_taxa:Nt.aplicar_taxa||!1,ordem:Nt.ordem??null})),Xr="banco de dados"):Xr="banco vazio"}catch(kr){console.error(" Erro ao buscar participantes:",kr)}ht.length===0&&g&&g.length>0?(ht=g,Xr="participantsForm (contexto)"):ht.length===0&&r?.selectedClients&&r.selectedClients.length>0&&(ht=(r?.selectedClients||[]).map(kr=>{let jt=kr.codigo;if(jt==null&&s&&Array.isArray(s)){const er=s.find(Nt=>Nt.id===kr.id);jt=er?.codigo!==null&&er?.codigo!==void 0?er.codigo:null}return{cliente_id:kr.id,nome:kr.nome,codigo:jt,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:Fe,aplicar_taxa:cr}}),Xr="form.selectedClients");let Ft=ht.map(kr=>{let jt=kr.codigo;if(jt==null&&s&&Array.isArray(s)){const Nt=s.find(Cr=>Cr.id===kr.cliente_id);jt=Nt?.codigo!==null&&Nt?.codigo!==void 0?Nt.codigo:null}let er=kr.finalizadora_id;if(!er){const Nt=Je();er=Nt?.id?String(Nt.id):null}return{...kr,codigo:jt??kr.codigo,finalizadora_id:er}});try{const kr=(r?.selectedClients||[]).slice();if(kr.length>0&&Ft.length>0){const jt=kr.map(Nt=>String(Nt?.id??""));if(!(new Set(jt).size!==jt.length&&String(Xr).startsWith("banco de dados"))){const Nt=new Map;Ft.forEach(un=>{const ra=Nt.get(un.cliente_id)||[];ra.push(un),Nt.set(un.cliente_id,ra)});const Cr=new Map,Lr=[];for(const un of kr){const ra=Cr.get(un.id)||0,ln=(Nt.get(un.id)||[])[ra];if(ln)Lr.push(ln),Cr.set(un.id,ra+1);else{const da=Je(),va=da?.id?String(da.id):null;Lr.push({participante_row_id:null,cliente_id:un.id,nome:un.nome,codigo:un.codigo??null,valor_cota:"0,00",status_pagamento:"Pendente",finalizadora_id:va,aplicar_taxa:Number(da?.taxa_percentual||0)>0,ordem:null})}}ht=Lr,Xr=Xr+" (reordenado pelos chips)"}}}catch(kr){console.error("[PaymentModal] Falha ao reordenar por chips:",kr)}if(Ft=ht.map(kr=>{let jt=kr.codigo;if(jt==null&&s&&Array.isArray(s)){const er=s.find(Nt=>Nt.id===kr.cliente_id);jt=er?.codigo!==null&&er?.codigo!==void 0?er.codigo:null}return{...kr,codigo:jt??kr.codigo,finalizadora_id:kr.finalizadora_id||(()=>{const er=Je();return er?.id?String(er.id):null})()}}),Ft.length===0&&h?.id){console.error(" ALERTA CRTICO: Nenhum participante encontrado em NENHUMA fonte!"),console.error(" Agendamento ID:",h.id),console.error(" Empresa:",c?.codigo_empresa),console.error(" Isso pode indicar perda de dados!");try{const{data:kr,error:jt}=await Q.from("agendamento_participantes").select("*").eq("agendamento_id",h.id);console.error(" Busca sem filtro de empresa:",{encontrados:kr?.length||0,dados:kr,erro:jt})}catch(kr){console.error(" Erro na busca de debug:",kr)}}if(Ft.length>0||!h?.id){if(Array.isArray(G)&&G.length>0){const kr=(G||[]).some(Nt=>!Nt?.participante_row_id),jt=(Ft||[]).some(Nt=>!!Nt?.participante_row_id);String(Xr).startsWith("banco de dados")&&jt&&kr&&te(Ft),Ct.current=Date.now()}else te(Ft),Ct.current=Date.now();try{if(localStorage.getItem("debug:agenda")==="1"){console.log(" [LOG 1 - ABRIR PAYMENT MODAL] Participantes carregados:"),console.log("   Total:",Ft.length),console.log("   Fonte:",Xr),Ft.forEach((er,Nt)=>{console.log(`   #${Nt+1}: ${er.nome} | Status: ${er.status_pagamento} | Valor: ${er.valor_cota}`)});const kr=(r?.selectedClients||[]).map(er=>er.id),jt=Ft.map(er=>er.cliente_id);console.log("[ORDER] chipsIds:",kr),console.log("[ORDER] finalIds:",jt)}}catch{}}else console.error(" BLOQUEADO: No vou sobrescrever com array vazio!"),console.error(" Mantendo dados anteriores para evitar perda.")})())}else Wt.current&&(clearTimeout(Wt.current),Wt.current=null),A(""),T(null),O([]),te([]);return()=>{Wt.current&&clearTimeout(Wt.current)}},[u,y,Je,g,r?.selectedClients,s,G]),p.useEffect(()=>{u&&!Ct.current&&Array.isArray(G)&&G.length>0&&(Ct.current=Date.now())},[u,G]),p.useEffect(()=>{if(!u)return;const at=(G||[]).length;if(or.current==null){or.current=at,br.current=Array.isArray(G)?G:[];return}const Te=at<or.current;let Fe=[];try{const cr=Array.isArray(br.current)?br.current:[],ht=Array.isArray(G)?G:[],Xr=kr=>`${kr?.cliente_id??""}|${(kr?.nome??"").toLowerCase()}`,Ft=new Set(ht.map(Xr));Fe=cr.filter(kr=>!Ft.has(Xr(kr)))}catch{}if(or.current=at,br.current=Array.isArray(G)?G:[],Te&&h?.id)try{const cr=Fe.map(ht=>ht?.nome).filter(Boolean);console.log(" [PaymentModal] Participante(s) removido(s):",cr);try{window.dispatchEvent(new CustomEvent("payments:participant-removed",{detail:{agendamentoId:h?.id,removed:Fe}}))}catch{}}catch{}},[u,G,h?.id,Kr]),p.useEffect(()=>{if(!u)return;const at=p.useRef.__prevHidden=p.useRef.__prevHidden||{len:0},Te=(M||[]).length,Fe=Te>(at.len||0);if(at.len=Te,Fe&&h?.id)try{console.log(" [PaymentModal] ndices ocultados (remoo lgica):",M)}catch{}},[M,u,h?.id,Kr]),p.useEffect(()=>{Ct.current=null},[h?.id]),p.useEffect(()=>(_.current=at=>{pe([at]),setTimeout(()=>{pe([])},1e3)},()=>{_.current=null}),[_]);const sa=p.useCallback(at=>{te(at)},[]);p.useEffect(()=>(u&&(v.updateLocal=sa,v.getLocal=()=>G),()=>{v.updateLocal&&(delete v.updateLocal,delete v.getLocal)}),[u,sa,G]),p.useLayoutEffect(()=>{if(!u)return;const at=(r?.selectedClients||[]).slice();if(at.length===0||!G||G.length===0||(G||[]).some(ht=>!!ht?.participante_row_id))return;const Te=at.map(ht=>String(ht?.id??""));if(!(new Set(Te).size!==Te.length||ft!==null||(G||[]).some(ht=>ht?.status_pagamento&&ht.status_pagamento!=="Pendente"||ht?.valor_cota&&ht.valor_cota!==""&&ht.valor_cota!=="0,00")))try{const ht=new Map;G.forEach(Cr=>{const Lr=ht.get(Cr.cliente_id)||[];Lr.push(Cr),ht.set(Cr.cliente_id,Lr)});const Xr=new Map,Ft=[];for(const Cr of at){const Lr=Xr.get(Cr.id)||0,ra=(ht.get(Cr.id)||[])[Lr];ra?(Ft.push(ra),Xr.set(Cr.id,Lr+1)):Ft.push({cliente_id:Cr.id,nome:Cr.nome,codigo:Cr.codigo??null,valor_cota:"0,00",status_pagamento:"Pendente",finalizadora_id:Je()?.id?String(Je().id):null,aplicar_taxa:Number(Je()?.taxa_percentual||0)>0})}const kr=new Map(Xr),jt=[];ht.forEach((Cr,Lr)=>{const un=kr.get(Lr)||0;for(let ra=un;ra<Cr.length;ra++)jt.push(Cr[ra])});const er=Ft.concat(jt);if(er.length!==G.length||er.some((Cr,Lr)=>Cr.cliente_id!==G[Lr]?.cliente_id||Cr.nome!==G[Lr]?.nome)){try{if(localStorage.getItem("debug:agenda")==="1"){const Cr=at.map(un=>un.nome),Lr=er.map(un=>un.nome);console.log("[ORDER] chipsNames:",Cr),console.log("[ORDER] finalNames (next):",Lr)}}catch{}te(er)}}catch(ht){console.error("[PaymentModal] Falha ao reordenar aps mudana de chips:",ht)}},[u,r?.selectedClients]),p.useEffect(()=>{F||(be([]),z("")),L(0)},[F]),p.useEffect(()=>{F&&Me.current[U]&&Me.current[U]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[U,F]),p.useEffect(()=>{const at=Te=>{if(F){if(Te.key==="Escape"){Te.preventDefault(),V(!1),z(""),be([]);try{j()}catch{}}if(Te.key==="Enter"&&Te.target.tagName!=="INPUT"&&me.length>0){Te.preventDefault();const Fe=me.map(cr=>({cliente_id:cr.id,nome:cr.nome,codigo:cr.codigo,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:(()=>{const ht=Je();return ht?.id?String(ht.id):null})(),aplicar_taxa:(()=>{const ht=Je();return Number(ht?.taxa_percentual||0)>0})()}));te(cr=>{const ht=cr.length,Xr=Fe.map((Ft,kr)=>ht+kr);return pe(Xr),setTimeout(()=>{pe([])},1e3),[...cr,...Fe]}),V(!1),be([]),z("");try{j()}catch{}}}};return window.addEventListener("keydown",at),()=>window.removeEventListener("keydown",at)},[F,me,Je,te,l,z,V,be]),p.useEffect(()=>{const at=async()=>{await jr("external:save-and-close")};return window.addEventListener("paymentmodal:save-and-close",at),()=>window.removeEventListener("paymentmodal:save-and-close",at)},[jr]),p.useEffect(()=>{!Lt&&Vt&&(console.log(" [PDF] Revogando URL do blob ao fechar modal"),URL.revokeObjectURL(Vt),qt(null))},[Lt,Vt]);const ia=p.useRef(null),Kn=async()=>{try{if(console.log(" [PDF] Iniciando gerao do PDF"),!ia.current)throw new Error("Elemento do relatrio no encontrado");console.log(" [PDF] Abrindo modal de download"),Vt&&URL.revokeObjectURL(Vt),Dt(!0),ge("downloading"),Gt(0),wr(null),qt(null),ot("");const at=(G||[]).filter((va,oa)=>!(M||[]).includes(oa)),Te=20,Fe=Math.ceil(at.length/Te);Gt(5);const cr=new Ta({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),ht=297,Xr=210;for(let va=0;va<Fe;va++){const oa=va*Te,Tn=Math.min(oa+Te,at.length),ee=at.slice(oa,Tn),Ie=10+Math.floor(va/Fe*80);Gt(Ie);const Oe=ia.current;if(!Oe)throw new Error("Elemento do relatrio no encontrado durante a gerao");console.log(` [PDF] Capturando pgina ${va+1}/${Fe} (participantes ${oa+1}-${Tn})`);const Yt={visibility:Oe.style.visibility,opacity:Oe.style.opacity};Oe.style.visibility="visible",Oe.style.opacity="1",console.log(` [PDF] Elemento innerHTML length: ${Oe.innerHTML.length}`),console.log(` [PDF] Elemento scrollHeight: ${Oe.scrollHeight}`),console.log(` [PDF] Elemento scrollWidth: ${Oe.scrollWidth}`);const Pt=Oe.querySelector('div[style*="borderBottom"]'),Qt=Oe.querySelectorAll('div[style*="borderBottom"]')[1];va>0?(Pt&&(Pt.style.display="none"),Qt&&(Qt.style.display="none")):(Pt&&(Pt.style.display="block"),Qt&&(Qt.style.display="flex"));const nr=Oe.querySelectorAll("tbody tr");console.log(` [PDF] Total de linhas na tabela: ${nr.length}`),nr.forEach((Ve,xe)=>{Ve.style.display=xe>=oa&&xe<Tn?"table-row":"none"});const fn=Oe.querySelector("#page-indicator");fn&&(fn.textContent=`Pgina ${va+1} de ${Fe}`),console.log(" [PDF] Forando reflow..."),Oe.offsetHeight,Oe.getBoundingClientRect(),Oe.scrollHeight,Oe.offsetWidth,Oe.clientHeight,console.log(" [PDF] Aguardando renderizao..."),await new Promise(Ve=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(Ve,2e3)})})})}),console.log(" [PDF] Renderizao completa, iniciando captura...");const J=Oe.querySelectorAll("tbody tr");if(console.log(` [PDF] Linhas da tabela encontradas: ${J.length}`),J.forEach((Ve,xe)=>{const kt=Ve.querySelectorAll("td"),st=Array.from(kt).map(zt=>zt.textContent.trim()).join(" | ");console.log(` [PDF] Linha ${xe+1}: ${st}`)}),J.length===0){console.warn(" [PDF] AVISO: Nenhuma linha de tabela encontrada! Verificando estrutura...");const Ve=Oe.querySelector("tbody");console.log(" [PDF] tbody existe:",!!Ve),Ve&&console.log(" [PDF] innerHTML do tbody:",Ve.innerHTML.substring(0,500))}let Xe;try{const Ve=Oe.scrollHeight,xe=Oe.scrollWidth;if(console.log(` [PDF] Dimenses reais: width=${xe}px, height=${Ve}px`),Xe=await bXe(Oe,{pixelRatio:2,backgroundColor:"#ffffff",cacheBust:!0,skipFonts:!1}),!Xe||Xe.length===0)throw new Error("Canvas vazio retornado pela captura");console.log(` [PDF] Pgina ${va+1} capturada (${Xe.length} bytes, ${Ve}px altura, ${J.length} linhas)`)}catch(Ve){throw console.error(` [PDF] Erro ao capturar pgina ${va+1}:`,Ve),Oe.style.visibility=Yt.visibility,Oe.style.opacity=Yt.opacity,new Error(`Falha ao capturar pgina ${va+1}: ${Ve.message}`)}Oe.style.visibility=Yt.visibility,Oe.style.opacity=Yt.opacity,va>0&&cr.addPage();const He=ht,fe=Oe.scrollHeight/Oe.scrollWidth*ht;cr.addImage(Xe,"PNG",0,0,He,fe,"","MEDIUM"),console.log(` [PDF] Pgina ${va+1} adicionada ao PDF (${He}mm x ${fe}mm)`)}if(ia.current){ia.current.querySelectorAll("tbody tr").forEach(Tn=>{Tn.style.display="table-row"});const oa=ia.current.querySelector("#page-indicator");oa&&(oa.textContent="")}Gt(95);const Ft=Fe>1?` (${Fe} pginas)`:"",kr=(G||[]).filter((va,oa)=>!(M||[]).includes(oa));let jt=kr.find(va=>!s?.find(Tn=>Tn.id===va.cliente_id)?.is_consumidor_final);!jt&&kr.length>0&&(jt=kr[0]);const Nt=(jt?.nome||"sem-nome").trim().split(/\s+/),Cr=Nt[0]||"sem",Lr=Nt.length>1?Nt[Nt.length-1]:"nome",ra=`rel-${`${Cr}-${Lr}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9-]+/g,"-").replace(/^-+|-+$/g,"")}-${h?.code||"0"}${Ft}.pdf`,Wn=cr.output("blob"),ln=URL.createObjectURL(Wn);wr(Wn),qt(ln),ot(ra),Gt(100);const da=document.createElement("a");da.href=ln,da.download=ra,da.click(),await new Promise(va=>setTimeout(va,500)),console.log(" [PDF] PDF gerado com sucesso! Modal de download deve permanecer aberto."),console.log(" [PDF] isPaymentModalOpen deve continuar true"),ge("success"),console.log(" [PDF] Status atualizado para success")}catch(at){console.error(" [PDF] Erro ao gerar PDF:",at),Dt(!1),l({title:"Erro ao gerar PDF",description:at?.message||"No foi possvel gerar o PDF.",variant:"destructive"})}};return a.jsxs(a.Fragment,{children:[a.jsx(Un,{open:u,onOpenChange:at=>{if(console.log(" [PaymentModal] onOpenChange chamado:",{open:at,isDownloadModalOpen:Lt}),!at){if(console.log(" [PaymentModal] Tentando fechar modal de pagamentos"),Lt&&Bt==="downloading"){console.log(" [PaymentModal] BLOQUEADO: Modal de download est gerando");return}jr("x")}},children:a.jsx(zn,{forceMount:!0,className:"w-full max-w-screen-sm sm:max-w-[1100px] max-h-[90vh] overflow-y-auto overflow-x-hidden mx-auto px-5 sm:px-6 flex flex-col items-center sm:items-stretch",onOpenAutoFocus:at=>at.preventDefault(),onInteractOutside:async at=>{const Te=Date.now(),Fe=Ct.current?Te-Ct.current:0,cr=Te-C,ht=at?.detail?.originalEvent?.type,Xr=ht==="focusin"||ht==="focusout",Ft=typeof document<"u"&&document.visibilityState==="visible"&&cr<8e3;if(console.log(" [PaymentModal] onInteractOutside disparado:",{target:at.target?.tagName,className:at.target?.className?.substring?.(0,50),timeSinceInit:`${Fe}ms`,timeSinceVisibility:`${cr}ms`,originalType:ht,isFocusRestoreEvent:Xr,isJustBecameVisible:Ft,isAddParticipantOpen:F,isDownloadModalOpen:Lt,statusConfirmationOpen:ur.isOpen,isModalProtected:E,timestamp:new Date().toISOString()}),ur.isOpen){console.log(" [PaymentModal] Bloqueado: modal de confirmao de status est aberto"),at.preventDefault();return}if(Lt){console.log(" [PaymentModal] Bloqueado: modal de download est aberto"),at.preventDefault();return}if(E){console.log(" [PaymentModal] Bloqueado: modal protegido (protectPaymentModal ativo)"),at.preventDefault();return}if(Xr||Ft){console.log(" [PaymentModal] Bloqueado: retorno de foco/aba (ignorar onInteractOutside)"),at.preventDefault();return}if(F){console.log(" [PaymentModal] Bloqueado: modal de adicionar participante aberto"),at.preventDefault();return}if(Ct.current&&Fe<500){console.log(" [PaymentModal] Bloqueado: modal abriu recentemente"),at.preventDefault();return}if(cr<3e3){console.log(` [PaymentModal] Bloqueado: mudana de visibilidade recente (${cr}ms atrs)`),at.preventDefault();return}at.preventDefault(),await jr("interactOutside")},onEscapeKeyDown:at=>{at.preventDefault(),jr("escape")},children:!y||y.length===0?Ct.current?a.jsxs(a.Fragment,{children:[a.jsxs(Bn,{className:"sr-only",children:[a.jsx(Ln,{children:"Aviso"}),a.jsx(ma,{children:"Nenhuma forma de pagamento cadastrada"})]}),a.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4",children:[a.jsx(Kf,{className:"w-12 h-12 text-amber-500"}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("p",{className:"font-semibold text-amber-500",children:"Nenhuma forma de pagamento cadastrada"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Cadastre pelo menos uma finalizadora para gerenciar pagamentos."})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:f,children:"Fechar"}),a.jsx(H4,{to:"/finalizadoras",children:a.jsx(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:f,children:"Cadastrar Finalizadora"})})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(Bn,{className:"sr-only",children:[a.jsx(Ln,{children:"Carregando"}),a.jsx(ma,{children:"Carregando formas de pagamento"})]}),a.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Carregando formas de pagamento..."})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(Bn,{className:"relative pb-4 w-full max-w-[600px] mx-auto sm:max-w-none sm:mx-0",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3 sm:gap-4",children:[a.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsx(Ln,{children:"Registrar pagamento"})}),a.jsx(ma,{className:"hidden sm:block",children:"As alteraes so salvas ao fechar o modal."})]}),a.jsxs(Z,{type:"button",variant:"outline",size:"sm",onClick:Kn,className:"flex-shrink-0 gap-2 w-full sm:w-auto mt-2 sm:mt-0 sm:mr-12",title:"Baixar relatrio como imagem",children:[a.jsx(ws,{className:"w-4 h-4"}),a.jsx("span",{children:"Baixar Relatrio"})]})]})}),a.jsxs("div",{className:"space-y-3 sm:space-y-6 w-full max-w-[600px] mx-auto sm:max-w-none sm:mx-0",children:[a.jsxs("div",{className:"sm:hidden space-y-2 max-w-md mx-auto",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{className:"p-2 rounded-lg bg-emerald-600/10 border border-emerald-500/30 min-w-0 relative group",children:[a.jsx("div",{className:"text-[10px] text-emerald-300/80 mb-1 truncate",children:"Total"}),H?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(It,{type:"text",value:Y,onChange:at=>W(Ai(at.target.value)),className:"w-full h-6 text-xs text-center font-bold bg-emerald-950/50 border-emerald-400/50 text-emerald-300 px-1",placeholder:"0,00",autoFocus:!0,onKeyDown:at=>{at.key==="Enter"&&Y!==m?rr():at.key==="Escape"&&ir()},onBlur:()=>{Y!==m?rr():ir()}}),Y!==m&&a.jsx("button",{onMouseDown:at=>at.preventDefault(),onClick:rr,className:"p-0.5 rounded hover:bg-emerald-500/20 transition-colors flex-shrink-0",title:"Confirmar",children:a.jsx(Fm,{className:"w-3 h-3 text-emerald-400"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-bold text-emerald-400 truncate",children:Ai(m)||"R$ 0,00"}),a.jsx("button",{onClick:xt,className:"absolute right-1 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-emerald-500/20 transition-colors",title:"Editar",children:a.jsx(fc,{className:"w-3 h-3 text-emerald-400"})})]})]}),a.jsxs("div",{className:`p-2 rounded-lg border min-w-0 ${Ye.diff===0?"bg-emerald-600/10 border-emerald-500/30":Ye.diff>0?"bg-amber-600/10 border-amber-500/30":"bg-rose-600/10 border-rose-500/30"}`,children:[a.jsx("div",{className:`text-[10px] mb-1 truncate ${Ye.diff===0?"text-emerald-300/80":Ye.diff>0?"text-amber-300/80":"text-rose-300/80"}`,children:"Diferena"}),a.jsxs("div",{className:`text-sm font-bold truncate ${Ye.diff===0?"text-emerald-400":Ye.diff>0?"text-amber-400":"text-rose-400"}`,children:[Ye.diff>0?"+":"",Ai(String(Math.abs(Ye.diff).toFixed(2)))]})]})]}),a.jsxs("div",{className:"flex gap-1.5 text-xs justify-center",children:[a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"})," ",a.jsx("strong",{children:At})]}),a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Atribudo:"})," ",a.jsxs("strong",{children:["R$ ",Ye.totalAssigned.toFixed(2)]})]}),a.jsxs("span",{className:"px-2.5 py-1.5 rounded bg-white/5 border border-white/10 whitespace-nowrap",children:[a.jsx("span",{className:"text-text-secondary",children:"Alvo:"})," ",a.jsxs("strong",{children:["R$ ",Ye.totalTarget.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Z,{type:"button",size:"sm",className:"bg-sky-600 hover:bg-sky-500 text-white text-xs h-8 px-3",onClick:lr,disabled:!m||At===0,children:(()=>{const at=el(m);if(Number.isFinite(at)&&At>0){const Te=at/At;return`Dividir (${Ai(String(Te.toFixed(2)))})`}return"Dividir"})()}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-amber-500/30 text-amber-400 hover:bg-amber-500/10 text-xs h-8 px-3 flex-1",onClick:qe,disabled:At===0,children:"Aplicar taxas"}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-white/10 text-xs h-8 px-3 flex-1",onClick:ce,disabled:At===0,children:"Zerar"})]})]})]}),a.jsx("div",{className:"hidden sm:block p-4 rounded-lg border border-border bg-gradient-to-br from-surface-2 to-surface shadow-md",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start gap-3 w-full",children:[a.jsxs("div",{className:"flex flex-row gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(ct,{className:"font-bold text-base text-white",children:"Valor total a receber"}),a.jsx("div",{className:"w-[180px] px-3 py-2 rounded-md bg-gradient-to-br from-emerald-600/20 to-emerald-700/20 border-2 border-emerald-500/40 shadow-lg flex items-center justify-center gap-2 relative group",children:H?a.jsxs(a.Fragment,{children:[a.jsx(It,{type:"text",value:Y,onChange:at=>W(Ai(at.target.value)),className:"w-full h-8 text-center text-lg font-bold bg-emerald-950/50 border-emerald-400/50 text-emerald-300",placeholder:"0,00",autoFocus:!0,onKeyDown:at=>{at.key==="Enter"&&Y!==m?rr():at.key==="Escape"&&ir()},onBlur:()=>{Y!==m?rr():ir()}}),Y!==m&&a.jsx("button",{onMouseDown:at=>at.preventDefault(),onClick:rr,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-emerald-500/20 transition-colors",title:"Confirmar (Enter)",children:a.jsx(Fm,{className:"w-4 h-4 text-emerald-400"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-xl font-bold text-emerald-400",children:Ai(m)||"R$ 0,00"}),a.jsx("button",{onClick:xt,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-emerald-500/20 transition-colors opacity-0 group-hover:opacity-100",title:"Editar valor total",children:a.jsx(fc,{className:"w-4 h-4 text-emerald-400"})})]})})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(ct,{className:"font-bold text-base text-white",children:"Diferena"}),a.jsx("div",{className:`w-[180px] px-3 py-2 rounded-md border-2 shadow-lg flex items-center justify-center ${Ye.diff===0?"bg-gradient-to-br from-emerald-600/20 to-emerald-700/20 border-emerald-500/40":Ye.diff>0?"bg-gradient-to-br from-amber-600/20 to-amber-700/20 border-amber-500/40":"bg-gradient-to-br from-rose-600/20 to-rose-700/20 border-rose-500/40"}`,children:a.jsxs("span",{className:`text-xl font-bold ${Ye.diff===0?"text-emerald-400":Ye.diff>0?"text-amber-400":"text-rose-400"}`,children:[Ye.diff>0?"+":"",Ai(String(Math.abs(Ye.diff).toFixed(2)))]})})]})]}),a.jsxs("div",{className:"ml-auto flex flex-col gap-3 items-end",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"}),a.jsx("strong",{children:At})]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Atribudo:"}),a.jsxs("strong",{children:["R$ ",Ye.totalAssigned.toFixed(2)]})]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-white/5 border border-white/10",children:[a.jsx("span",{className:"text-text-secondary",children:"Alvo:"}),a.jsxs("strong",{children:["R$ ",Ye.totalTarget.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[a.jsx(Z,{type:"button",variant:"secondary",size:"sm",className:"bg-sky-600 hover:bg-sky-500 text-white flex-shrink-0",onClick:lr,disabled:!m||At===0,children:(()=>{const at=el(m);if(Number.isFinite(at)&&At>0){const Te=at/At;return a.jsxs(a.Fragment,{children:["Dividir igualmente (",Ai(String(Te.toFixed(2)))," cada)",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-sky-700/50 rounded border border-sky-500/30",children:"F8"})]})}return a.jsxs(a.Fragment,{children:["Dividir igualmente",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-sky-700/50 rounded border border-sky-500/30",children:"F8"})]})})()}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-amber-500/30 text-amber-400 hover:bg-amber-500/10 flex-1 sm:flex-initial whitespace-nowrap",onClick:qe,disabled:At===0,children:["Aplicar taxas",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-amber-700/50 rounded border border-amber-500/30",children:"F9"})]}),a.jsxs(Z,{type:"button",variant:"ghost",size:"sm",className:"border border-white/10 flex-1 sm:flex-initial",onClick:ce,disabled:At===0,children:["Zerar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"F10"})]})]})]})]})]})}),(r.selectedClients||[]).length===0?a.jsx("div",{className:"text-xs text-text-muted italic",children:'Nenhum participante neste agendamento. Adicione participantes no campo "Clientes" do modal principal.'}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("div",{className:"relative flex-1 min-w-0",children:[a.jsx(It,{ref:Re,type:"text",placeholder:"Buscar participante...",value:S,onChange:at=>A(at.target.value),className:"pr-16"}),a.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-amber-400 hover:text-amber-300",onClick:()=>{A(""),Re.current?.focus()},children:"limpar"})]}),a.jsxs(Z,{type:"button",size:"sm",className:"bg-amber-500 hover:bg-amber-400 text-black shadow-md flex-shrink-0",onClick:at=>{at.preventDefault(),at.stopPropagation(),w(2e3),V(!0)},children:[a.jsx("span",{className:"hidden sm:inline",children:"Adicionar participante +"}),a.jsx("span",{className:"sm:hidden",children:"Participante +"})]})]}),I?.type==="pending"&&a.jsxs("div",{role:"alert",className:"mb-2 rounded-md border border-amber-600/40 bg-amber-500/10 px-3 py-2 text-amber-200 flex items-start gap-3",children:[a.jsx(Kf,{className:"w-4 h-4 text-amber-300 mt-0.5"}),a.jsxs("div",{className:"flex-1 text-sm",children:[a.jsx("strong",{children:"Ateno:"})," Existem ",a.jsx("strong",{children:I.count})," participante(s) com status ",a.jsx("strong",{children:"Pendente"}),"."]}),a.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded bg-amber-500/20 hover:bg-amber-500/30 border border-amber-600/40",onClick:()=>T(null),children:"Entendi"})]}),a.jsx("div",{className:"border border-border rounded-md overflow-hidden",children:a.jsx("div",{className:"divide-y divide-border max-h-[50vh] overflow-y-scroll",children:(()=>{const at=S.trim().toLowerCase(),Te=M||[],cr=(G||[]).map((ht,Xr)=>({...ht,_originalIndex:Xr})).filter(ht=>!Te.includes(ht._originalIndex)).filter(ht=>!at||String(ht?.nome||"").toLowerCase().includes(at));return cr.length===0?a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Nenhum participante com esse nome"}):cr.map(ht=>{const Xr=`participant-${ht._originalIndex}`,Ft=ht._originalIndex,kr=se.includes(Ft);return a.jsxs("div",{className:`p-2 sm:p-3 border-b last:border-b-0 transition-all duration-500 ease-out ${kr?"bg-white/10":""}`,children:[a.jsxs("div",{className:"sm:hidden space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[ht.codigo!==null&&ht.codigo!==void 0&&a.jsxs("span",{className:`text-xs font-bold rounded px-1.5 py-0.5 shrink-0 ${ht.status_pagamento==="Pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",ht.codigo]}),cn(ht.cliente_id)?a.jsxs("div",{className:"relative flex-1 min-w-0",children:[a.jsx("input",{ref:jt=>{jt&&(De.current[Ft]=jt)},type:"text",value:ht.nome||"",onChange:jt=>Gr(Ft,jt.target.value),onFocus:()=>bt(Ft),onKeyDown:jt=>{if(jt.key==="Enter"){jt.preventDefault();const er=We(Ft);er!==null&&setTimeout(()=>{De.current[er]?.focus()},0)}else if(jt.key==="Delete"&&ht.nome&&jt.target===document.activeElement)jt.preventDefault(),jt.stopPropagation(),Gr(Ft,""),setTimeout(()=>{De.current[Ft]?.focus()},0);else if(jt.key==="ArrowDown"){jt.preventDefault();const er=We(Ft);er!==null&&setTimeout(()=>{De.current[er]?.focus()},0)}else if(jt.key==="ArrowUp"){jt.preventDefault();const er=Ze(Ft);er!==null&&setTimeout(()=>{De.current[er]?.focus()},0)}},onBlur:async jt=>{bt(null);const er=(jt.currentTarget?.value||"").trim();er===""?ae.current[Ft]&&ha(Ft):(te(Nt=>{const Cr=[...Nt];return Ft>=0&&Ft<Cr.length&&(Cr[Ft]={...Cr[Ft],nome:er}),Cr}),delete ae.current[Ft])},placeholder:"Nome do cliente...",className:"font-medium text-sm bg-black/40 text-white placeholder:text-white/50 border border-white/15 rounded px-2 py-0.5 pr-11 focus:border-white/30 focus:outline-none focus:ring-1 focus:ring-white/20 w-full",title:"Editar nome do Cliente Consumidor (histrico do agendamento)"}),ht.nome?a.jsx("button",{type:"button",onClick:()=>{Gr(Ft,""),setTimeout(()=>{De.current[Ft]?.focus()},0)},className:`absolute right-1 top-1/2 -translate-y-1/2 px-1.5 py-0.5 text-[10px] font-bold border rounded transition-all ${ft===Ft||!ft&&ut===Ft?"text-amber-300 bg-amber-500/20 border-amber-400/50 animate-pulse shadow-lg shadow-amber-500/20":"text-white/60 bg-white/10 hover:bg-white/20 hover:text-white/90 border-white/20"}`,title:ft===Ft||!ft&&ut===Ft?"Ser limpo ao pressionar Delete":"Limpar nome (tecla Delete)",children:"DEL"}):ae.current[Ft]?a.jsx("button",{type:"button",onClick:()=>ha(Ft),className:"absolute right-1 top-1/2 -translate-y-1/2 p-1 text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20 hover:text-emerald-300 border border-emerald-500/30 rounded transition-all",title:"Restaurar ltimo nome",children:a.jsx(c$,{className:"w-3 h-3"})}):null]}):a.jsx("span",{className:"font-medium text-sm truncate",children:ht.nome})]}),a.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[a.jsx("button",{type:"button",className:"p-1 text-text-secondary hover:text-brand transition-colors",onClick:()=>ze(Ft,ht.nome),title:"Trocar",children:a.jsx(fc,{className:"w-4 h-4"})}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400 h-6 w-6 p-0",onClick:()=>{O(jt=>[...jt,Ft])},children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{children:[a.jsx(ct,{className:"text-[10px] text-text-muted",children:"Mtodo"}),a.jsxs(Zn,{value:String(ht.finalizadora_id||""),onValueChange:jt=>{te(er=>{const Nt=[...er];if(Ft>=0&&Ft<Nt.length){const Cr=y.find(un=>String(un.id)===String(jt)),Lr=Number(Cr?.taxa_percentual||0)>0;Nt[Ft]={...Nt[Ft],finalizadora_id:jt,aplicar_taxa:Lr?Nt[Ft].aplicar_taxa??!0:!1}}return Nt})},children:[a.jsx(Yn,{className:"h-8 text-xs",children:a.jsx(ta,{placeholder:"Mtodo"})}),a.jsx(Jn,{children:y.map(jt=>a.jsx(nt,{value:String(jt.id),children:jt.nome||jt.tipo||"Outros"},jt.id))})]}),(()=>{const jt=y.find(Lr=>String(Lr.id)===String(ht.finalizadora_id)),er=Number(jt?.taxa_percentual||0);if(er<=0)return a.jsx("div",{className:"h-4 mt-1"});const Nt=el(ht.valor_cota),Cr=Number.isFinite(Nt)&&Nt>0;return a.jsxs("label",{className:`flex items-center gap-1.5 mt-1 text-[11px] ${Cr?"cursor-pointer":"cursor-not-allowed opacity-50"}`,title:Cr?`Taxa de ${er.toFixed(2)}%`:"Informe o valor primeiro",children:[a.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!ht.aplicar_taxa,disabled:!Cr,onChange:Lr=>{if(!Cr){l({title:"Valor necessrio",description:"Informe o valor antes de aplicar a taxa.",variant:"destructive"});return}te(un=>{const ra=[...un];if(Ft>=0&&Ft<ra.length){const Wn=Lr.target.checked;let ln=Nt;Wn?ln=Nt*(1+er/100):ln=Nt/(1+er/100),ra[Ft]={...ra[Ft],aplicar_taxa:Wn,valor_cota:Ai(ln.toFixed(2))}}return ra})},style:{accentColor:"#f59e0b"}}),a.jsxs("span",{className:"text-amber-500 font-medium",children:["Taxa (",er.toFixed(2),"%)"]})]})})()]}),a.jsxs("div",{className:"isolate",children:[a.jsx(ct,{className:"text-[10px] text-text-muted",children:"Valor"}),a.jsx(It,{ref:jt=>{jt&&(re.current[Ft]=jt)},type:"text",inputMode:"decimal",placeholder:"R$ 0,00",value:Ai(ht.valor_cota),onChange:jt=>{const er=Ai(jt.target.value),Nt=el(er),Cr=Number.isFinite(Nt)&&Nt>0?"Pago":"Pendente";te(Lr=>{const un=[...Lr];return Ft>=0&&Ft<un.length&&(un[Ft]={...un[Ft],valor_cota:er,status_pagamento:Cr,aplicar_taxa:er===""||Nt<=0?!1:un[Ft].aplicar_taxa}),un})},className:"h-8 text-xs text-text-primary placeholder:text-slate-400 bg-surface-2 border-border hover:border-border-hover focus:border-brand focus:ring-2 focus:ring-brand/20"})]})]}),a.jsx("div",{className:"flex justify-end",children:(()=>{const jt=ht.status_pagamento==="Pago",er=Number.isFinite(el(ht.valor_cota))&&el(ht.valor_cota)>0,Nt=jt&&er;return a.jsx("button",{type:"button",onClick:()=>pn(Ft,ht.status_pagamento,ht.valor_cota),disabled:Nt,className:`inline-flex items-center justify-center px-3 py-0.5 rounded text-xs font-medium border transition-all ${jt&&er?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 cursor-not-allowed":jt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 hover:bg-emerald-600/30 hover:border-emerald-600/60 cursor-pointer":"bg-amber-600/20 text-amber-400 border-amber-700/40 hover:bg-amber-600/30 hover:border-amber-600/60 cursor-pointer"}`,title:Nt?"No  possvel alterar (valor preenchido)":"Clique para alterar status",children:jt?"Pago":"Pendente"})})()})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-3",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"flex items-center gap-2",children:[ht.codigo!==null&&ht.codigo!==void 0&&a.jsxs("span",{className:`text-sm font-bold rounded-md px-2.5 py-1 shadow-sm ${ht.status_pagamento==="Pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",ht.codigo]}),cn(ht.cliente_id)?a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:jt=>{jt&&(De.current[Ft]=jt)},type:"text",value:ht.nome||"",onChange:jt=>Gr(Ft,jt.target.value),onFocus:()=>bt(Ft),onKeyDown:jt=>{if(jt.key==="Enter"){jt.preventDefault();const er=We(Ft);er!==null&&setTimeout(()=>{De.current[er]?.focus()},0)}else if(jt.key==="Delete"&&ht.nome&&jt.target===document.activeElement)jt.preventDefault(),jt.stopPropagation(),Gr(Ft,""),setTimeout(()=>{De.current[Ft]?.focus()},0);else if(jt.key==="ArrowDown"){jt.preventDefault();const er=We(Ft);er!==null&&setTimeout(()=>{De.current[er]?.focus()},0)}else if(jt.key==="ArrowUp"){jt.preventDefault();const er=Ze(Ft);er!==null&&setTimeout(()=>{De.current[er]?.focus()},0)}},onBlur:async jt=>{bt(null);const er=(jt.currentTarget?.value||"").trim();er===""?ae.current[Ft]&&ha(Ft):(te(Nt=>{const Cr=[...Nt];return Ft>=0&&Ft<Cr.length&&(Cr[Ft]={...Cr[Ft],nome:er}),Cr}),delete ae.current[Ft])},placeholder:"Nome do cliente...",className:"font-medium text-base bg-black/40 text-white placeholder:text-white/50 border border-white/15 rounded-md px-3 py-1.5 pr-14 focus:border-white/30 focus:outline-none focus:ring-2 focus:ring-white/20 min-w-[200px] max-w-[300px]",title:"Editar nome do Cliente Consumidor (histrico do agendamento)"}),ht.nome?a.jsx("button",{type:"button",onClick:()=>{Gr(Ft,""),setTimeout(()=>{De.current[Ft]?.focus()},0)},className:`absolute right-2 top-1/2 -translate-y-1/2 px-2 py-1 text-xs font-bold border rounded transition-all ${ft===Ft||!ft&&ut===Ft?"text-amber-300 bg-amber-500/20 border-amber-400/50 animate-pulse shadow-lg shadow-amber-500/30":"text-white/60 bg-white/10 hover:bg-white/20 hover:text-white/90 border-white/20 shadow-sm"}`,title:ft===Ft||!ft&&ut===Ft?"Ser limpo ao pressionar Delete":"Limpar nome (tecla Delete)",children:"DEL"}):ae.current[Ft]?a.jsx("button",{type:"button",onClick:()=>ha(Ft),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20 hover:text-emerald-300 border border-emerald-500/30 rounded transition-all shadow-sm",title:"Restaurar ltimo nome",children:a.jsx(c$,{className:"w-4 h-4"})}):null]}):a.jsx("span",{className:"font-medium text-base",children:ht.nome}),a.jsx("button",{type:"button",className:"p-1 text-text-secondary hover:text-brand transition-colors",onClick:()=>ze(Ft,ht.nome),title:"Trocar participante",children:a.jsx(fc,{className:"w-5 h-5"})})]})}),a.jsx("div",{className:"isolate",children:a.jsx(It,{ref:jt=>{jt&&(re.current[Ft]=jt)},type:"text",inputMode:"decimal",placeholder:"R$ 0,00",value:Ai(ht.valor_cota),onChange:jt=>{const er=Ai(jt.target.value),Nt=el(er),Cr=Number.isFinite(Nt)&&Nt>0?"Pago":"Pendente";te(Lr=>{const un=[...Lr];return Ft>=0&&Ft<un.length&&(un[Ft]={...un[Ft],valor_cota:er,status_pagamento:Cr,aplicar_taxa:er===""||Nt<=0?!1:un[Ft].aplicar_taxa}),un})},className:"w-28 text-text-primary placeholder:text-slate-400 bg-surface-2 border-border hover:border-border-hover focus:border-brand focus:ring-2 focus:ring-brand/20"})}),a.jsxs("div",{className:"flex items-center gap-2 min-w-[240px] isolate",children:[a.jsxs(Zn,{value:String(ht.finalizadora_id||""),onValueChange:jt=>{te(er=>{const Nt=[...er];if(Ft>=0&&Ft<Nt.length){const Cr=y.find(un=>String(un.id)===String(jt)),Lr=Number(Cr?.taxa_percentual||0)>0;Nt[Ft]={...Nt[Ft],finalizadora_id:jt,aplicar_taxa:Lr?Nt[Ft].aplicar_taxa??!0:!1}}return Nt})},children:[a.jsx(Yn,{className:"w-[140px] flex-shrink-0",children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsx(Jn,{children:y.map(jt=>a.jsx(nt,{value:String(jt.id),children:jt.nome||jt.tipo||"Outros"},jt.id))})]}),a.jsx("div",{className:"flex-1 min-w-0 isolate",children:(()=>{const jt=y.find(Lr=>String(Lr.id)===String(ht.finalizadora_id)),er=Number(jt?.taxa_percentual||0);if(er<=0)return a.jsx("div",{className:"h-5"});const Nt=el(ht.valor_cota),Cr=Nt>0;return a.jsxs("label",{className:`flex items-center gap-1.5 text-xs transition-colors ${Cr?"cursor-pointer hover:text-text-primary":"cursor-not-allowed opacity-50"}`,title:Cr?`Taxa de ${er.toFixed(2)}%`:"Informe o valor primeiro",children:[a.jsx("input",{type:"checkbox",checked:!!ht.aplicar_taxa,disabled:!Cr,onChange:Lr=>{if(!Cr){l({title:"Valor necessrio",description:"Informe o valor antes de aplicar a taxa.",variant:"destructive"});return}te(un=>{const ra=[...un];if(Ft>=0&&Ft<ra.length){const Wn=Lr.target.checked;let ln=Nt;Wn?ln=Nt*(1+er/100):ln=Nt/(1+er/100),ra[Ft]={...ra[Ft],aplicar_taxa:Wn,valor_cota:Ai(ln.toFixed(2))}}return ra})},className:`w-4 h-4 rounded border-2 border-amber-500 checked:bg-amber-500 checked:border-amber-500 focus:ring-2 focus:ring-amber-500 focus:ring-offset-1 ${Cr?"cursor-pointer":"cursor-not-allowed"}`,style:{accentColor:"#f59e0b"}}),a.jsxs("span",{className:"whitespace-nowrap text-amber-500 font-medium",children:["Taxa (",er.toFixed(2),"%)"]})]})})()})]}),(()=>{const jt=ht.status_pagamento==="Pago",er=Number.isFinite(el(ht.valor_cota))&&el(ht.valor_cota)>0,Nt=jt&&er;return a.jsx("button",{type:"button",onClick:()=>pn(Ft,ht.status_pagamento,ht.valor_cota),disabled:Nt,className:`inline-flex items-center justify-center w-[90px] px-3 py-1 rounded text-sm font-medium border transition-all ${jt&&er?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 cursor-not-allowed":jt?"bg-emerald-600/20 text-emerald-400 border-emerald-700/40 hover:bg-emerald-600/30 hover:border-emerald-600/60 cursor-pointer":"bg-amber-600/20 text-amber-400 border-amber-700/40 hover:bg-amber-600/30 hover:border-amber-600/60 cursor-pointer"}`,title:Nt?"No  possvel alterar (valor preenchido)":"Clique para alterar status",children:jt?"Pago":"Pendente"})})(),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400",onClick:()=>{O(jt=>[...jt,Ft])},children:"Remover"})]})]},Xr)})})()})})]})]}),a.jsx(Ga,{className:"gap-2",children:a.jsxs(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:async()=>{await jr("footer-close")},children:["Fechar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]})})]})})}),a.jsxs("div",{ref:ia,style:{position:"fixed",left:"0",top:"0",width:"900px",minHeight:"auto",padding:"30px",backgroundColor:"#ffffff !important",color:"#000000 !important",fontFamily:"Arial, sans-serif",opacity:"0",visibility:"hidden",zIndex:"-9999",pointerEvents:"none",overflow:"hidden"},children:[a.jsxs("div",{style:{marginBottom:"8px",paddingBottom:"6px",borderBottom:"2px solid #000",backgroundColor:"#fff",color:"#000"},children:[a.jsx("h1",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 6px 0",color:"#000",letterSpacing:"0.5px",textAlign:"center"},children:"RELATRIO DE PAGAMENTOS"}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"10px",color:"#000",fontWeight:"600"},children:[a.jsxs("div",{style:{display:"flex",gap:"20px",flex:1},children:[a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Data:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.start?new Date(h.start).toLocaleDateString("pt-BR"):"-"})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Quadra:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.court||"-"})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Cdigo:"}),a.jsx("span",{style:{marginLeft:"4px"},children:h?.code?`#${h.code}`:"-"})]})]}),a.jsxs("div",{style:{display:"flex",gap:"30px",textAlign:"right"},children:[a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Total:"}),a.jsxs("strong",{style:{marginLeft:"4px",color:"#000",fontSize:"11px",display:"inline"},children:["R$ ",Ai(m||0)]})]}),a.jsxs("div",{children:[a.jsx("span",{style:{fontWeight:"700"},children:"Diferena:"}),a.jsxs("strong",{style:{marginLeft:"4px",color:Ye.diff<0?"#dc2626":"#16a34a",fontSize:"11px",display:"inline"},children:[Ye.diff<0?"-":"","R$ ",Ai(Math.abs(Ye.diff).toFixed(2))]})]})]})]})]}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"8px",fontSize:"10px",backgroundColor:"#fff",fontFamily:"Arial, sans-serif",border:"1px solid #000",tableLayout:"fixed"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{backgroundColor:"#cccccc",borderBottom:"1px solid #000"},children:[a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"5%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"N"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"35%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Nome"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"10%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Cdigo"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"15%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Valor"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"20%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Forma"}),a.jsx("th",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:"#000",width:"15%",backgroundColor:"#cccccc",fontSize:"9px",border:"1px solid #000",wordWrap:"break-word"},children:"Status"})]})}),a.jsx("tbody",{children:(()=>(G||[]).filter((Te,Fe)=>!(M||[]).includes(Fe)).map((Te,Fe)=>{const cr=y?.find(Nt=>String(Nt.id)===String(Te.finalizadora_id)),ht=Te.status_pagamento==="Pago",Ft=s?.find(Nt=>Nt.id===Te.cliente_id)?.is_consumidor_final,jt=(Te.nome||"Sem nome").trim().split(/\s+/).slice(0,2).join(" "),er=Ft?"0":Te.codigo||"N/A";return a.jsxs("tr",{"data-participant-index":Fe,style:{backgroundColor:"#fff"},children:[a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word"},children:Fe+1}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"left",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word",overflow:"hidden"},children:jt}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",fontSize:"10px",fontWeight:"600",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:er}),a.jsxs("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",backgroundColor:"#fff",fontSize:"10px",fontWeight:"600",border:"1px solid #000",wordWrap:"break-word"},children:["R$ ",Ai(Te.valor_cota||0)]}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",color:"#000",fontSize:"10px",fontWeight:"600",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:cr?.nome||"N/D"}),a.jsx("td",{style:{padding:"4px 2px",textAlign:"center",fontWeight:"900",color:ht?"#16a34a":"#ca8a04",fontSize:"10px",backgroundColor:"#fff",border:"1px solid #000",wordWrap:"break-word"},children:ht?" Pago":" Pendente"})]},`participant-${Fe}-${Te.cliente_id}`)}))()})]}),a.jsx("div",{style:{height:"2px",backgroundColor:"#fff"}}),a.jsxs("div",{style:{marginTop:"2px",textAlign:"center",fontSize:"10px",color:"#000",borderTop:"1px solid #000",paddingTop:"2px",display:"flex",justifyContent:"space-between",backgroundColor:"#fff"},children:[a.jsxs("div",{style:{color:"#000",fontWeight:"500"},children:["Gerado em: ",new Date().toLocaleString("pt-BR")]}),a.jsx("div",{id:"page-indicator",style:{fontSize:"10px",fontWeight:"bold",color:"#000"}})]})]}),a.jsx(Un,{open:F,onOpenChange:at=>{if(!at){be([]),z("");try{j()}catch{}}V(at)},children:a.jsxs(zn,{className:"sm:max-w-[500px]",onInteractOutside:at=>{at.preventDefault(),V(!1);try{j()}catch{}},children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Adicionar Participante"}),a.jsx(ma,{children:"Selecione um cliente para adicionar aos pagamentos."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{ref:Er,placeholder:"Buscar por cdigo ou nome...",value:B,onChange:at=>{z(at.target.value),L(0)},onKeyDown:at=>{const Te=B.toLowerCase().trim(),Fe=(s||[]).filter(kr=>{if(!Te)return!0;const jt=String(kr.codigo||""),er=(kr.nome||"").toLowerCase();return jt.includes(Te)||er.includes(Te)}),cr=Fe.find(kr=>kr?.is_consumidor_final===!0),Xr=Fe.filter(kr=>kr?.is_consumidor_final!==!0).sort((kr,jt)=>{const er=kr.codigo||0,Nt=jt.codigo||0;return er-Nt}),Ft=cr?[cr,...Xr]:Xr;if(at.key==="ArrowDown")at.preventDefault(),L(kr=>Math.min(kr+1,Ft.length-1));else if(at.key==="ArrowUp")at.preventDefault(),L(kr=>Math.max(kr-1,0));else if(at.key==="Enter"&&Ft[U]){at.preventDefault();const jt={...Ft[U],timestamp:Date.now()};be(er=>[...er,jt])}},className:"pl-10 pr-10"}),B&&a.jsx("button",{type:"button",onClick:()=>z(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text",children:a.jsx(Hc,{className:"h-4 w-4"})})]}),a.jsx(Z,{type:"button",size:"sm",className:"bg-amber-500 hover:bg-amber-400 text-black shadow-md",onClick:()=>{o&&(w(15e3),o(()=>{V(!0)}),V(!1),z(""))},children:"+Novo"})]}),a.jsx("div",{ref:lt,className:"border rounded-md max-h-[400px] overflow-y-auto",children:(()=>{const at=B.toLowerCase().trim(),Te=(s||[]).filter(Ft=>{if(!at)return!0;const kr=String(Ft.codigo||""),jt=(Ft.nome||"").toLowerCase();return kr.includes(at)||jt.includes(at)}),Fe=Te.find(Ft=>Ft?.is_consumidor_final===!0),ht=Te.filter(Ft=>Ft?.is_consumidor_final!==!0).sort((Ft,kr)=>{const jt=Ft.codigo||0,er=kr.codigo||0;return jt-er}),Xr=Fe?[Fe,...ht]:ht;return Xr.length===0?a.jsx("div",{className:"p-8 text-center text-text-muted",children:"Nenhum cliente encontrado."}):Xr.map((Ft,kr)=>{const jt=Ft?.is_consumidor_final===!0,er=me.filter(Cr=>Cr.id===Ft.id).length,Nt=kr===U;return a.jsxs("div",{ref:Cr=>{Me.current[kr]=Cr},role:"button",tabIndex:0,className:`w-full px-4 py-3 text-left transition-all border-b border-border last:border-0 flex items-center gap-3 cursor-pointer ${Nt?"ring-2 ring-blue-500 ring-inset z-10":""} ${jt?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":er>0?"bg-emerald-600/20 hover:bg-emerald-600/30":"hover:bg-surface-2"}`,onMouseEnter:()=>L(kr),onClick:Cr=>{Cr.preventDefault(),Cr.stopPropagation();const Lr={...Ft,timestamp:Date.now()};be(un=>[...un,Lr])},onKeyDown:Cr=>{if(Cr.key==="Enter"||Cr.key===" "){Cr.preventDefault();const Lr={...Ft,timestamp:Date.now()};be(un=>[...un,Lr])}},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[(()=>Ft.codigo!==null&&Ft.codigo!==void 0?a.jsxs("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors ${jt?"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Ft.codigo]}):null)(),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:`font-medium ${jt?"text-amber-100/90":""}`,children:Ft.nome}),jt&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),er>0&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-rose-600 hover:bg-rose-500 text-white text-base font-bold transition-colors",onClick:Cr=>{Cr.preventDefault(),Cr.stopPropagation(),be(Lr=>{const un=Lr.findIndex(ra=>ra.id===Ft.id);if(un!==-1){const ra=[...Lr];return ra.splice(un,1),ra}return Lr})},children:"-"}),a.jsx("span",{className:"inline-flex items-center justify-center min-w-[32px] h-7 px-2 rounded-full bg-sky-600 text-white text-base font-bold",children:er}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-emerald-600 hover:bg-emerald-500 text-white text-base font-bold transition-colors",onClick:Cr=>{Cr.preventDefault(),Cr.stopPropagation();const Lr={...Ft,timestamp:Date.now()};be(un=>[...un,Lr])},children:"+"})]})]},Ft.id)})})()})]}),a.jsxs(Ga,{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-text-muted",children:me.length>0&&a.jsxs("span",{className:"font-medium",children:[me.length," ",me.length===1?"participante selecionado":"participantes selecionados"]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{type:"button",variant:"ghost",className:"border border-border",onClick:at=>{at.preventDefault(),at.stopPropagation(),w(1e3),V(!1),z(""),be([]);try{j()}catch{}},children:["Cancelar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]}),a.jsxs(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",disabled:me.length===0,onClick:at=>{console.log("[AddParticipant] Boto Salvar clicado"),at.preventDefault(),at.stopPropagation(),console.log("[AddParticipant] Protegendo modal de pagamentos (3000ms)"),w(3e3),console.log("[AddParticipant] Adicionando participantes:",me.length);const Te=me.map(Fe=>({cliente_id:Fe.id,nome:Fe.nome,codigo:Fe.codigo,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:(()=>{const cr=Je();return cr?.id?String(cr.id):null})(),aplicar_taxa:(()=>{const cr=Je();return Number(cr?.taxa_percentual||0)>0})()}));te(Fe=>{const cr=Fe.length,ht=Te.map((Xr,Ft)=>cr+Ft);return pe(ht),setTimeout(()=>{pe([])},1e3),[...Fe,...Te]}),console.log("[AddParticipant] Fechando modal de adicionar participante"),V(!1),z(""),be([]);try{j()}catch{}console.log("[AddParticipant] Concludo")},children:["Confirmar (",me.length,")",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-emerald-700/50 rounded border border-emerald-500/30",children:""})]})]})]})]})}),a.jsx(Un,{open:Lt,onOpenChange:at=>{console.log(" [DownloadModal] onOpenChange chamado:",{open:at,downloadStatus:Bt}),!at&&Bt==="success"?(console.log(" [DownloadModal] Fechando modal de download (sucesso)"),Dt(!1)):at||console.log(" [DownloadModal] BLOQUEADO: Ainda baixando")},children:a.jsxs(zn,{className:"sm:max-w-md",onPointerDownOutside:at=>{Bt==="downloading"&&at.preventDefault()},onEscapeKeyDown:at=>{Bt==="downloading"&&at.preventDefault()},children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-center",children:Bt==="downloading"?"Gerando PDF...":"PDF Gerado com Sucesso!"}),a.jsx(ma,{className:"sr-only",children:Bt==="downloading"?"Aguarde enquanto o relatrio de pagamentos est sendo gerado":"Relatrio de pagamentos gerado e baixado com sucesso"})]}),a.jsx("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:Bt==="downloading"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-green-500"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Gerando seu relatrio..."}),a.jsxs("div",{className:"w-full max-w-xs",children:[a.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[a.jsx("span",{children:"Progresso"}),a.jsxs("span",{children:[wt,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:a.jsx("div",{className:"bg-green-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${wt}%`}})})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"rounded-full bg-green-100 p-3",children:a.jsx("svg",{className:"w-12 h-12 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),a.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Relatrio baixado com sucesso!"}),a.jsx("p",{className:"text-xs text-gray-400 text-center",children:he})]})}),Bt==="success"&&a.jsxs("div",{className:"flex flex-col gap-2",children:[navigator.share&&navigator.canShare&&navigator.canShare({files:[]})&&a.jsxs(Z,{onClick:async()=>{if(!Sr){l({title:"Arquivo no disponvel",description:"Tente gerar o PDF novamente.",variant:"destructive"});return}try{console.log(" [PDF] Compartilhando via Web Share API...");const at=new File([Sr],he,{type:"application/pdf"});await navigator.share({files:[at],title:"Relatrio de Pagamentos",text:"Confira o relatrio de pagamentos"}),console.log(" [PDF] Compartilhado com sucesso"),l({title:"Compartilhado com sucesso!",variant:"success"})}catch(at){if(at.name==="AbortError"){console.log(" [PDF] Compartilhamento cancelado");return}console.error(" [PDF] Erro ao compartilhar:",at),l({title:"Erro ao compartilhar",description:at.message,variant:"destructive"})}},className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Compartilhar"]}),a.jsxs(Z,{onClick:()=>{Vt?(console.log(" [PDF] Abrindo PDF em nova aba:",Vt),window.open(Vt,"_blank")):(console.error(" [PDF] URL do blob no disponvel"),l({title:"Erro ao abrir PDF",description:"URL do PDF no est disponvel.",variant:"destructive"}))},className:"w-full bg-green-600 hover:bg-green-700",children:[a.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Abrir PDF"]}),a.jsx("p",{className:"text-xs text-center text-gray-500 px-2",children:"O PDF foi baixado. Abra-o para visualizar, imprimir ou compartilhar."}),a.jsx(Z,{onClick:()=>Dt(!1),variant:"ghost",className:"w-full",children:"Fechar"})]})]})}),a.jsx(Un,{open:ur.isOpen,onOpenChange:at=>{if(!at&&zr.current){console.log(" [StatusConfirmation] Bloqueado onOpenChange (protegido)");return}at||(console.log(" [StatusConfirmation] Fechando modal via onOpenChange"),an({isOpen:!1,participantIndex:null,currentStatus:null}))},children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-[400px]",onInteractOutside:at=>{zr.current&&(console.log(" [StatusConfirmation] Bloqueado clique fora"),at.preventDefault())},onEscapeKeyDown:at=>{zr.current&&(console.log(" [StatusConfirmation] Bloqueado ESC"),at.preventDefault())},children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Alterar Status de Pagamento"}),a.jsx(ma,{children:ur.currentStatus==="Pago"?a.jsxs(a.Fragment,{children:["Tem certeza que deseja marcar este participante como ",a.jsx("strong",{children:"Pendente"}),"?"]}):a.jsxs(a.Fragment,{children:["Tem certeza que deseja marcar este participante como ",a.jsx("strong",{children:"Pago"})," mesmo sem valor registrado?"]})})]}),a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/30",children:a.jsx("p",{className:"text-sm text-amber-400",children:ur.currentStatus==="Pago"?a.jsx(a.Fragment,{children:" Esta ao marcar o participante como pendente novamente para refazer o pagamento."}):a.jsx(a.Fragment,{children:" Esta ao marcar o participante como pago sem um valor especfico."})})})}),a.jsxs(Ga,{className:"gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>{an({isOpen:!1,participantIndex:null,currentStatus:null})},children:"Cancelar"}),a.jsx(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:()=>on(ur.currentStatus==="Pago"?"Pendente":"Pago"),children:"Confirmar"})]})]})})]})}function NZe({form:e,setForm:t,localCustomers:r}){Zs(),lo();const{isEditParticipantModalOpen:n,closeEditParticipantModal:s,editParticipantData:o,participantsForm:i,setParticipantsForm:l,payMethods:c,protectPaymentModal:d,onParticipantReplacedRef:u}=qN(),[f,h]=p.useState(""),[m,x]=p.useState(!1),[g,v]=p.useState(0),y=Ce.useRef(null),b=Ce.useRef([]),w=Ce.useRef(null),j=O=>{const I=o.participantId,T=l.getLocal&&l.updateLocal?l.getLocal()||[]:null;if((Array.isArray(T)?T[I]:i[I])?.cliente_id===O.id)return;console.log(" [EditParticipantModal] Substituindo participante:",{de:o.participantName,para:O.nome,indice:I,id_para:O.id});const q=Array.isArray(T)?T[I]:i[I];if(l.updateLocal&&l.getLocal){const B=l.getLocal();if(I>=0&&I<B.length){const z={cliente_id:O.id,nome:O.nome,codigo:O.codigo,participante_row_id:null,ordem:q?.ordem??I+1,valor_cota:q?.valor_cota||"",status_pagamento:q?.status_pagamento||"Pendente",finalizadora_id:q?.finalizadora_id||(c[0]?.id?String(c[0].id):null),aplicar_taxa:q?.aplicar_taxa||!1},F=[...B];F[I]=z,l.updateLocal(F)}}else l(B=>{if(I<0||I>=B.length)return B;const z=B[I],F={cliente_id:O.id,nome:O.nome,codigo:O.codigo,participante_row_id:null,ordem:z?.ordem??I+1,valor_cota:z?.valor_cota||"",status_pagamento:z?.status_pagamento||"Pendente",finalizadora_id:z?.finalizadora_id||(c[0]?.id?String(c[0].id):null),aplicar_taxa:z?.aplicar_taxa||!1},V=[...B];return V[I]=F,V});d(3e3),s(),h(""),u?.current&&u.current(I)};if(p.useEffect(()=>{if(n){h(""),x(!1),v(0);try{if(localStorage.getItem("debug:agenda")==="1"){const O=o?.participantId,I=l.getLocal&&l.updateLocal?l.getLocal()||[]:null,T=Array.isArray(i)?i:[],k=Array.isArray(I)?I[O]:void 0,q=T[O];console.log(" [EditParticipantModal][OPEN] alvo",{idx:O,editParticipantData:o,localCount:Array.isArray(I)?I.length:null,ctxCount:T.length,localAt:k?{cliente_id:k?.cliente_id,nome:k?.nome,ordem:k?.ordem,participante_row_id:k?.participante_row_id}:null,ctxAt:q?{cliente_id:q?.cliente_id,nome:q?.nome,ordem:q?.ordem,participante_row_id:q?.participante_row_id}:null}),Array.isArray(I)&&console.log(" [EditParticipantModal][OPEN] localList snapshot",I.map((B,z)=>({i:z,cliente_id:B?.cliente_id,nome:B?.nome,ordem:B?.ordem,participante_row_id:B?.participante_row_id}))),console.log(" [EditParticipantModal][OPEN] ctxList snapshot",T.map((B,z)=>({i:z,cliente_id:B?.cliente_id,nome:B?.nome,ordem:B?.ordem,participante_row_id:B?.participante_row_id})))}}catch(O){console.warn(" [EditParticipantModal][OPEN] falha ao logar debug:",O)}}},[n]),p.useEffect(()=>{n&&b.current[g]&&b.current[g]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[g,n]),!n)return null;const _=f.trim().toLowerCase(),C=(r||[]).filter(O=>_?String(O?.nome||"").toLowerCase().includes(_):!0),E=C.find(O=>O?.is_consumidor_final===!0),A=C.filter(O=>O?.is_consumidor_final!==!0).sort((O,I)=>{const T=Number(O?.codigo),k=Number(I?.codigo);return Number.isFinite(T)&&Number.isFinite(k)?T-k:String(O?.nome||"").localeCompare(String(I?.nome||""))}),M=E?[E,...A]:A;return a.jsx(Un,{open:n,onOpenChange:O=>{console.log("[EditParticipantModal] onOpenChange:",O),O||(console.log("[EditParticipantModal] Protegendo modal de pagamentos"),d(2e3),s(),h(""))},modal:!0,children:a.jsxs(zn,{className:"sm:max-w-[500px]",onPointerDownOutside:O=>{console.log(" [EditParticipantModal] onPointerDownOutside - prevenindo"),O.preventDefault(),O.stopPropagation()},onInteractOutside:O=>{console.log(" [EditParticipantModal] onInteractOutside - prevenindo"),O.preventDefault(),O.stopPropagation(),d(2e3)},children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Trocar Participante"}),a.jsxs(ma,{children:["Substituindo: ",a.jsx("strong",{children:o.participantName})]})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"edit-participant-search",children:"Buscar cliente"}),a.jsx(It,{ref:y,id:"edit-participant-search",type:"text",placeholder:"Digite o nome do cliente...",value:f,onChange:O=>{h(O.target.value),v(0)},onKeyDown:O=>{if(O.key==="ArrowDown")O.preventDefault(),v(I=>Math.min(I+1,M.length-1));else if(O.key==="ArrowUp")O.preventDefault(),v(I=>Math.max(I-1,0));else if(O.key==="Enter"&&M[g]){O.preventDefault();const I=M[g],T=o.participantId;i[T]?.cliente_id===I.id||(d(2e3),j(I))}},className:"mt-1",autoFocus:!0})]}),a.jsx("div",{ref:w,className:"border border-border rounded-md max-h-[300px] overflow-y-auto",children:m?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:"Carregando clientes..."}):M.length===0?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:_?"Nenhum cliente encontrado":"Nenhum cliente cadastrado"}):M.map((O,I)=>{const T=o.participantId,k=l.getLocal&&l.updateLocal?l.getLocal()||[]:null,B=(Array.isArray(k)?k[T]:i[T])?.cliente_id===O.id,z=O?.is_consumidor_final===!0,F=I===g;return a.jsxs("button",{ref:V=>{b.current[I]=V},type:"button",className:Pr(F&&"ring-2 ring-blue-500 ring-inset z-10","w-full px-4 py-3 text-left transition-all","border-b border-border last:border-b-0","flex items-center gap-3",B&&"bg-brand/10 cursor-not-allowed opacity-60",!B&&z&&"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40",!B&&!z&&"hover:bg-surface-2"),disabled:B,onMouseEnter:()=>v(I),onClick:V=>{V.preventDefault(),V.stopPropagation(),console.log("[EditParticipantModal] Cliente selecionado - protegendo modal"),d(2e3),j(O)},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[O.codigo!==null&&O.codigo!==void 0&&a.jsxs("span",{className:Pr("inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors",z&&"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20",!z&&"bg-emerald-600/20 text-emerald-400"),children:["#",O.codigo]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:Pr("font-medium",z&&"text-amber-100/90"),children:O.nome}),z&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),B&&a.jsx("span",{className:"text-xs text-brand font-medium",children:"Atual"})]},O.id)})})]}),a.jsx(Ga,{children:a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:O=>{console.log(" [EditParticipantModal] ========== BOTO CANCELAR CLICADO =========="),console.log(" [EditParticipantModal] preventDefault()"),O.preventDefault(),console.log(" [EditParticipantModal] stopPropagation()"),O.stopPropagation(),console.log(" [EditParticipantModal] Protegendo modal de pagamentos (2000ms)"),d(2e3),console.log(" [EditParticipantModal] Fechando modal de editar participante"),s(),console.log(" [EditParticipantModal] Limpando busca"),h(""),console.log(" [EditParticipantModal] ========== CANCELAR CONCLUDO ==========")},children:"Cancelar"})})]})})}const SZe=e=>e?e.trim().split(/\s+/).slice(0,2).join(" "):"",uh=56,bk=30,CZe=6,AZe=24;function PZe({weekStart:e,weekBookings:t,activeCourtFilter:r,courtsMap:n,participantsByAgendamento:s,onBookingClick:o,onSlotClick:i,statusConfig:l,dayStartHour:c=CZe,dayEndHourExclusive:d=AZe,weekDiasFuncionamento:u={},sidebarVisible:f=!1}){const h=p.useRef(null),m=p.useRef(null),[x,g]=Ce.useState(0),[v,y]=Ce.useState(window.innerWidth<768);Ce.useEffect(()=>{const S=()=>{y(window.innerWidth<768)};return window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const b=p.useMemo(()=>Array.from({length:7},(S,A)=>Es(e,A)),[e]);p.useEffect(()=>{const S=()=>{m.current&&h.current&&(h.current.scrollLeft=m.current.scrollLeft)},A=()=>{h.current&&m.current&&(m.current.scrollLeft=h.current.scrollLeft)},M=()=>{if(m.current){const T=m.current.scrollHeight>m.current.clientHeight;g(T?17:0)}},O=m.current,I=h.current;return O&&O.addEventListener("scroll",S),I&&I.addEventListener("scroll",A),M(),window.addEventListener("resize",M),()=>{O&&O.removeEventListener("scroll",S),I&&I.removeEventListener("scroll",A),window.removeEventListener("resize",M)}},[]);const w=p.useMemo(()=>{if(r&&n[r]){const S=n[r],A=S.hora_inicio||`${c}:00:00`,M=S.hora_fim||`${d}:00:00`,[O]=String(A).split(":").map(Number),[I,T]=String(M).split(":").map(Number);let k=I===0&&T===0?24:I;return T>0&&k<24&&(k+=1),{start:O||c,end:k||d}}return{start:c,end:d}},[r,n,c,d]),j=p.useMemo(()=>Array.from({length:Math.max(0,w.end-w.start)},(S,A)=>w.start+A),[w]),_=p.useMemo(()=>Math.max(0,w.end-w.start)*(60/bk)*uh,[w]),C=p.useMemo(()=>{const S={};return b.forEach(A=>{S[dr(A,"yyyy-MM-dd")]=[]}),t.forEach(A=>{const M=dr(Po(A.start),"yyyy-MM-dd");S[M]&&S[M].push(A)}),S},[b,t]),E=(S,A)=>{const M=S.start.getHours()*60+S.start.getMinutes(),I=S.end.getHours()*60+S.end.getMinutes()-M,T=w.start*60,k=(M-T)/bk*uh,q=I/bk*uh,z=l[S.status]||{hex:"#888",text:"text-gray-400",label:"Unknown",icon:null},F=z.icon,V=40,me=Math.max(V,q-4),be=Math.min(1.3,me/55),U=Math.max(11,Math.round(13*be)),L=Math.max(10,Math.round(11*be)),H=Math.max(9,Math.round(10*be)),ie=Math.max(14,Math.round(16*be)),Y=A?.[S.id]||[],W=Y.filter(G=>String(G.status_pagamento||"").toLowerCase()==="pago").length,se=Y.length,pe=I===30;return a.jsx("div",{id:`booking-${S.id}`,className:"absolute left-0.5 right-0.5 rounded-md border-2 bg-surface cursor-pointer transition-all hover:bg-surface-2 hover:shadow-md overflow-hidden",style:{top:`${k}px`,height:`${Math.max(V,q)}px`,borderColor:z.hex||"#888",borderLeftWidth:"3px",zIndex:5},onClick:()=>o(S),children:a.jsxs("div",{className:"h-full flex flex-col justify-center px-2 py-1",children:[a.jsx("div",{className:"flex items-center gap-1.5 mb-0.5",children:a.jsx("p",{className:"font-semibold truncate",style:{fontSize:`${U}px`,lineHeight:1.1,color:"#e2e8f0"},children:SZe(S.customer)})}),pe&&(S.modality||se>0)&&a.jsxs("div",{className:"flex items-center gap-1 w-full justify-between",style:{lineHeight:1},children:[S.modality&&a.jsx("span",{className:"text-xs font-bold text-white bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded px-1.5 py-0.5 whitespace-nowrap shadow-sm flex-shrink-0",style:{fontSize:Math.max(7,H-1)},children:S.modality}),se>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-1.5 py-0.5 border flex items-center gap-0.5 whitespace-nowrap flex-shrink-0 ${W===se?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(8,H-1)},children:[a.jsx(Wi,{style:{width:Math.max(10,H-1),height:Math.max(10,H-1)}}),a.jsxs("span",{children:[W,"/",se]})]})]}),pe&&a.jsxs("div",{className:"flex items-center gap-1.5 justify-between",children:[a.jsxs("span",{className:"font-semibold whitespace-nowrap",style:{fontSize:`${L}px`,color:"#999",lineHeight:1},children:[dr(S.start,"HH:mm"),"",dr(S.end,"HH:mm")]}),F&&a.jsxs("div",{className:"flex items-center gap-0.5",children:[!f&&!v&&a.jsx(F,{style:{width:Math.max(12,ie-2),height:Math.max(12,ie-2),color:z.hex}}),a.jsx("span",{className:"truncate font-semibold",style:{fontSize:`${L}px`,color:z.hex,lineHeight:1},children:z.label})]})]}),!pe&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"truncate",style:{fontSize:`${L}px`,color:"#999",lineHeight:1,marginBottom:"2px"},children:[dr(S.start,"HH:mm"),"",dr(S.end,"HH:mm")]}),S.modality&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded px-1.5 py-0.5 whitespace-nowrap shadow-sm mb-0.5",style:{fontSize:Math.max(7,H-1),display:"inline-block",width:"fit-content"},children:S.modality}),a.jsxs("div",{className:"flex items-center gap-1 w-full justify-between",children:[F&&a.jsxs("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[!f&&!v&&a.jsx(F,{style:{width:ie,height:ie,color:z.hex}}),a.jsx("span",{className:"truncate font-semibold",style:{fontSize:`${H}px`,color:z.hex,lineHeight:1},children:S.status==="in_progress"?"Andamento":z.label})]}),se>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-1.5 py-0.5 border flex items-center gap-0.5 whitespace-nowrap flex-shrink-0 ${W===se?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(8,H-1)},children:[a.jsx(Wi,{style:{width:Math.max(12,H),height:Math.max(12,H)}}),a.jsxs("span",{children:[W,"/",se]})]})]})]})]})},S.id)};return a.jsxs("div",{className:"flex-1 bg-surface rounded-lg border border-border flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"flex sticky top-0 z-20 bg-surface border-b border-border",children:[a.jsx("div",{className:"w-20 flex-shrink-0 flex items-center justify-center font-semibold text-sm border-r border-border bg-surface",children:"Horrios"}),a.jsxs("div",{ref:h,"data-header-scroll":!0,className:"flex flex-1 overflow-auto",style:{scrollbarWidth:"none",msOverflowStyle:"none",paddingRight:`${x}px`,minWidth:0},children:[a.jsx("style",{children:`
            [data-header-scroll]::-webkit-scrollbar {
              display: none;
            }
          `}),b.map(S=>a.jsxs("div",{className:"flex-1 basis-[140px] min-w-[140px] flex flex-col items-center justify-center py-3 border-r border-border bg-surface-2/50 text-center",children:[a.jsx("div",{className:"text-xs font-semibold text-text-muted",children:dr(S,"EEE",{locale:$a}).toUpperCase()}),a.jsx("div",{className:"text-sm font-bold text-text-primary",children:dr(S,"dd")})]},dr(S,"yyyy-MM-dd")))]})]}),a.jsxs("div",{ref:m,className:"flex flex-1 overflow-auto",style:{minWidth:0},children:[a.jsxs("div",{className:"w-20 flex-shrink-0 bg-surface sticky left-0 z-10 flex flex-col relative",style:{borderRight:"1px solid var(--color-border)",minHeight:`${_}px`},children:[j.map(S=>a.jsxs(Ce.Fragment,{children:[a.jsx("div",{className:Pr("relative border-b border-border/60",S%2===1&&"bg-surface-2/30"),style:{height:uh},children:a.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded px-1 text-sm font-bold whitespace-nowrap",children:[String(S).padStart(2,"0"),":00"]})}),a.jsx("div",{className:Pr("relative border-b border-border/60",S%2===1&&"bg-surface-2/30"),style:{height:uh},children:a.jsxs("span",{className:"absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded px-1 text-sm font-bold whitespace-nowrap",children:[String(S).padStart(2,"0"),":30"]})})]},`time-${S}`)),a.jsx("div",{className:"absolute right-0 top-0 w-px bg-border pointer-events-none",style:{height:`${_}px`}})]}),b.map(S=>{const A=dr(S,"yyyy-MM-dd"),M=C[A]||[],O=u[A]||{},I=r&&O[r]&&!O[r].funciona;return a.jsxs("div",{className:"flex-1 basis-[140px] min-w-[140px] relative border-r border-border bg-surface-2/10",style:{minHeight:`${_}px`},children:[j.map(T=>a.jsx("div",{className:Pr("border-b border-border/60",T%2===1&&"bg-surface-2/5"),style:{height:uh*2},children:I?a.jsx("div",{className:"w-full h-full cursor-not-allowed bg-surface/60 flex items-center justify-center border-b border-border/60 transition-colors",onClick:k=>k.preventDefault(),children:a.jsxs("div",{className:"text-center pointer-events-none",children:[a.jsx(X4,{className:"h-5 w-5 text-text-primary mx-auto mb-1"}),a.jsx("div",{className:"text-xs font-medium text-text-primary mb-1",children:"Fechada"}),O[r]?.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:O[r].observacao})]})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"relative border-b border-border/60 transition-colors flex items-center justify-center cursor-pointer hover:bg-white/5",style:{height:uh},onClick:()=>{const k=new Date(S.getTime());k.setHours(T,0,0,0),console.log("Slot :00 clicked",{day:S,hour:T,slotDate:k,activeCourtFilter:r}),i?.(k,r)}}),a.jsx("div",{className:"relative border-b border-border/60 transition-colors flex items-center justify-center cursor-pointer hover:bg-white/5",style:{height:uh},onClick:()=>{const k=new Date(S.getTime());k.setHours(T,30,0,0),console.log("Slot :30 clicked",{day:S,hour:T,slotDate:k,activeCourtFilter:r}),i?.(k,r)}})]})},`${A}-${T}`)),M.map(T=>E(T,s))]},A)})]})]})}const Cs=30,Gp=e=>{const t=String(e??"").replace(/\D/g,"");if(!t)return"";const r=(Number(t)/100).toFixed(2),[n,s]=r.split(".");return`${n.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${s}`},dm=e=>{if(e==null||e==="")return NaN;const t=String(e).replace(/\./g,"").replace(",","."),r=parseFloat(t);return Number.isFinite(r)?r:NaN};function bU(e){const t=String(e||"").trim().split(/\s+/).filter(Boolean);return t.length===0?"":t.length===1?t[0]:`${t[0]} ${t[1]}`}const jl=56,EZe=6,oC=6,I3=24;Array.from({length:(I3-oC)*(60/Cs)},(e,t)=>{const r=oC*60+t*Cs,n=Math.floor(r/60),s=r%60;return{time:`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}`,isHourMark:s===0}});const Kp=["Futebol","Beach Tennis","Futevlei","Treino"];function vh(e){return wu(e,{weekStartsOn:1})}function kZe(e){const t=vh(e),r=Es(t,6);return t.getMonth()===r.getMonth()?`${dr(t,"dd")}-${dr(r,"dd")} de ${dr(r,"MMMM",{locale:$a})} de ${dr(r,"yyyy")}`:`${dr(t,"dd")} de ${dr(t,"MMMM",{locale:$a})} - ${dr(r,"dd")} de ${dr(r,"MMMM",{locale:$a})} de ${dr(r,"yyyy")}`}const tl={scheduled:{label:"Agendado",accent:"bg-[#3B82F6]",text:"text-[#3B82F6]",border:"border-[#3B82F6]",hex:"#3B82F6",icon:Io},confirmed:{label:"Confirmado",accent:"bg-[#22C55E]",text:"text-[#22C55E]",border:"border-[#22C55E]",hex:"#22C55E",icon:Di},in_progress:{label:"Em andamento",accent:"bg-[#FACC15]",text:"text-[#FACC15]",border:"border-[#FACC15]",hex:"#FACC15",icon:_G},finished:{label:"Finalizado",accent:"bg-[#6B7280]",text:"text-[#6B7280]",border:"border-[#6B7280]",hex:"#6B7280",icon:que},canceled:{label:"Cancelado",accent:"bg-[#EF4444]",text:"text-[#EF4444]",border:"border-[#EF4444]",hex:"#EF4444",icon:Og},absent:{label:"Ausente",accent:"bg-[#F97316]",text:"text-[#F97316]",border:"border-[#F97316]",hex:"#F97316",icon:CG}},IZe={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},wU={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},jU=e=>{let t=Math.floor(e/60);const r=e%60;return t>=24&&(t=t%24),`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}`};function OZe({sidebarVisible:e=!1}){const{toast:t}=Zs(),{loadAlerts:r}=oj(),n=_i(),{isPaymentModalOpen:s,openPaymentModal:o,closePaymentModal:i,isEditParticipantModalOpen:l,openEditParticipantModal:c,closeEditParticipantModal:d,editParticipantData:u,editingBooking:f,setEditingBooking:h,participantsForm:m,setParticipantsForm:x,paymentTotal:g,setPaymentTotal:v,payMethods:y,setPayMethods:b}=qN(),w=p.useMemo(()=>{try{return typeof window<"u"&&localStorage.getItem("debug:agenda")==="1"}catch{return!1}},[]),j=p.useCallback((...le)=>{if(w)try{console.log("[AgendaDbg]",...le)}catch{}},[w]);p.useEffect(()=>{try{Ie.current=Date.now()+2500,j("runAutomation:startup grace set",{until:Ie.current}),setTimeout(()=>{try{Yr()}catch{}},2500+200)}catch{}const le=console.log,we=console.info,et=console.debug,_e=console.warn,St=console.error,tt=Ne=>{const Mt=String(Ne||"");return Mt.startsWith("[AgendaDbg]")||!1||Mt.startsWith("[PulseDump]")||Mt.startsWith("[Clientes:load]")||Mt.startsWith("[AgendaSettings]")||Mt.startsWith("[Auto]")||Mt.startsWith("[DEBUG-PaymentModal]")||Mt.startsWith(" EditGuard")};return console.log=(...Ne)=>{try{if(tt(Ne[0]))return}catch{}return le(...Ne)},console.info=(...Ne)=>{try{if(tt(Ne[0]))return}catch{}return we(...Ne)},console.debug=(...Ne)=>{try{if(tt(Ne[0]))return}catch{}return et(...Ne)},console.warn=(...Ne)=>{try{if(tt(Ne[0]))return}catch{}return _e(...Ne)},console.error=(...Ne)=>{try{if(tt(Ne[0]))return}catch{}return St(...Ne)},()=>{console.log=le,console.info=we,console.debug=et,console.warn=_e,console.error=St}},[]);const _=p.useRef({active:!1,tag:"",start:0,timer:null,events:[]}),C=p.useCallback((le,we)=>{if(w)try{const et=Date.now(),_e=_.current&&_.current.active?et-(_.current.start||et):0;_.current.events.push({t:et,ms:_e,event:le,data:we})}catch{}},[w]),E=p.useCallback(le=>{if(w){try{if(!_.current.active)return;const{tag:we,start:et,events:_e}=_.current,St=`[PulseDump] tag=${we} dur=${Date.now()-et}ms reason=${le}`;console.groupCollapsed(St);for(const tt of _e)console.log(` +${String(tt.ms).padStart(4," ")}ms`,tt.event,tt.data||{});console.groupEnd()}catch{}try{_.current.timer&&clearTimeout(_.current.timer)}catch{}_.current={active:!1,tag:"",start:0,timer:null,events:[]}}},[w]),S=p.useCallback((le,we=5e3)=>{if(w){try{_.current.timer&&clearTimeout(_.current.timer)}catch{}_.current={active:!0,tag:le,start:Date.now(),timer:null,events:[]},_.current.timer=setTimeout(()=>E("timeout"),we),j("PulseStart",{tag:le,timeoutMs:we})}},[w,E,j]),{userProfile:A,authReady:M,company:O}=lo(),[I,T]=qC(),[k,q]=p.useState(new Date),[B,z]=p.useState("day"),[F,V]=p.useState(!1),[me,be]=p.useState({}),[U,L]=p.useState(!1),[H,ie]=p.useState({}),[Y,W]=p.useState(""),[se,pe]=p.useState("");p.useEffect(()=>{let le=!1;return(async()=>{try{if(!M||!O?.id)return;const{data:we,error:et}=await Q.from("agenda_settings").select("isis_subdomain, isis_display_name").eq("empresa_id",O.id).single();if(le||et&&et.code!=="PGRST116")return;const _e=(we?.isis_subdomain||"").toLowerCase().replace(/[^a-z0-9]+/g,"").trim();W(_e);const St=(we?.isis_display_name||"").toString().trim();pe(St)}catch{}})(),()=>{le=!0}},[M,O?.id]);const G=p.useMemo(()=>{const le=O?.nome_fantasia||O?.nome||O?.razao_social||O?.codigoEmpresa||"";return String(le).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"").trim()},[O?.nome_fantasia,O?.nome,O?.razao_social,O?.codigoEmpresa]),te=p.useMemo(()=>{const le=Y||G;return le?`https://${le}.f7arena.com`:""},[Y,G]),oe=p.useCallback(async le=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(le);else{const we=document.createElement("textarea");we.value=le,we.style.position="fixed",we.style.top="0",we.style.left="0",we.style.opacity="0",document.body.appendChild(we),we.focus(),we.select(),document.execCommand("copy"),document.body.removeChild(we)}return!0}catch{return!1}},[]),[De,re]=p.useState(!1),[ae,ut]=p.useState(!1),[pt,ft]=p.useState(""),bt=p.useRef(null),[Lt,Dt]=p.useState(!1),[Bt,ge]=p.useState(new Date),wt=p.useRef(!1),Gt=p.useRef(""),Sr=p.useRef(null),wr=p.useRef([]),he=p.useRef({}),ot=p.useRef([]),Vt=p.useRef(oC),qt=p.useRef(I3),Re=p.useRef(new Date);p.useEffect(()=>{try{De||ge(k||new Date)}catch{}},[k,De]),p.useEffect(()=>{try{Re.current=Bt||new Date}catch{}},[Bt]);const Ct=p.useCallback(()=>{try{return Sr.current||wr.current?.[0]||""}catch{return""}},[]),Wt=p.useCallback((le=null)=>{try{const we=Ct();if(!we)return[];const et=he.current||{},_e=ot.current||[],St=Vt.current,tt=qt.current,Ne=le||Bt||new Date,Mt=(()=>{const na=et?.[we]?.hora_inicio;if(!na)return St*60;const[ya,Wa]=String(na).split(":").map(Number);return ya*60+(Wa||0)})(),Qe=(()=>{const na=et?.[we]?.hora_fim;if(!na)return tt*60;const[ya,Wa]=String(na).split(":").map(Number);return(ya===0&&Wa===0?24:ya)*60+(Wa||0)})(),ar=na=>{const ya=Wd(na),Wa=Hd(na);return ya===0&&Wa===0?1440:ya*60+Wa},Sn=dr(Ne,"yyyy-MM-dd"),wn=et?.[we]?.id,$n=(_e||[]).filter(na=>{const ya=na.court===we,Wa=wn!=null&&String(na.court_id||"")===String(wn);return(ya||Wa)&&dr(na.start,"yyyy-MM-dd")===Sn&&na.status!=="canceled"}).map(na=>[ar(na.start),ar(na.end)]).sort((na,ya)=>na[0]-ya[0]),En=[];let pa=Mt;for(const[na,ya]of $n)na>pa&&En.push([pa,na]),pa=Math.max(pa,ya);pa<Qe&&En.push([pa,Qe]);const rs=new Date,Ys=dr(rs,"yyyy-MM-dd");let ea=0;if(Ys===Sn){const na=Wd(rs),ya=Hd(rs),Wa=na*60+ya,Ea=Cs||30;ea=Math.ceil(Wa/Ea)*Ea}else if(rs>Ne)return[];return ea<=Mt?En:ea>=Qe?[]:En.map(([na,ya])=>[Math.max(na,ea),ya]).filter(([na,ya])=>ya>na).filter(([na,ya])=>ya-na>=60)}catch{return[]}},[Ct,Bt]),Er=p.useMemo(()=>{const le=te||"",we=Bt||new Date,et=dr(we,"EEEE",{locale:$a}).replace(/-feira\b/gi,"").trim(),_e=et?`${et.charAt(0).toUpperCase()}${et.slice(1)}`:"",St=`${_e}${_e?", ":""}${dr(we,"dd/MM",{locale:$a})}`,tt=ar=>{let Sn=Math.floor(ar/60),wn=ar%60;return Sn>=24&&(Sn=Sn%24),`${String(Sn).padStart(2,"0")}:${String(wn).padStart(2,"0")}`},Mt=(Wt(we)||[]).map(([ar,Sn])=>`${tt(ar)}${tt(Sn)}`);if(Mt.length===0)return`No momento no temos horrios disponveis para ${St}.
Confira novamente mais tarde e agende pelo link abaixo 

${le}`.trim();const Qe=Mt.join(`
`);return`Horrios disponveis (${St}):
${Qe}

Agende pelo link abaixo 

${le}`.trim()},[te,Bt,Wt]),Me=p.useCallback(async()=>{if(te){ft("");try{bt.current=null}catch{}try{ge(k||new Date)}catch{}re(!0)}},[te,k]),lt=p.useCallback(()=>{re(!1)},[]);p.useEffect(()=>{De||Dt(!1)},[De]);const gt=p.useCallback(le=>new Promise((we,et)=>{try{if(!le)return we(null);const _e=new Image;_e.crossOrigin="anonymous",_e.onload=()=>we(_e),_e.onerror=()=>we(null),_e.src=le}catch{we(null)}}),[]),or=p.useCallback(async le=>await(await fetch(le)).blob(),[]),br=p.useCallback(async()=>{const et=document.createElement("canvas");et.width=1080,et.height=1680;const _e=et.getContext("2d");if(!_e)throw new Error("Canvas indisponvel");const St=_e.createLinearGradient(0,0,1080,1680);St.addColorStop(0,"#07070A"),St.addColorStop(1,"#0B0B10"),_e.fillStyle=St,_e.fillRect(0,0,1080,1680);try{_e.save(),_e.globalAlpha=.55;const xr=_e.createRadialGradient(Math.round(1080*.55),Math.round(1680*.22),40,Math.round(1080*.55),Math.round(1680*.22),760);xr.addColorStop(0,"rgba(249,115,22,0.55)"),xr.addColorStop(1,"rgba(249,115,22,0)"),_e.fillStyle=xr,_e.fillRect(0,0,1080,1680),_e.restore()}catch{}const tt=O?.logo_url||"",Ne=await gt(tt),Mt=1080/2;let Qe=220;if(Ne){const jn=Math.min(640/Ne.width,260/Ne.height),fa=Math.round(Ne.width*jn),qn=Math.round(Ne.height*jn),Fa=Math.round(Mt-fa/2),ps=130;_e.save(),_e.globalAlpha=.98,_e.drawImage(Ne,Fa,ps,fa,qn),_e.restore(),Qe=ps+qn}else _e.save(),_e.globalAlpha=.2,_e.fillStyle="white",_e.fillRect(Math.round(1080*.22),190,Math.round(1080*.56),10),_e.restore(),Qe=230;const ar=(se||O?.nome_fantasia||O?.nome||O?.razao_social||"").toString().trim();_e.textAlign="center",_e.textBaseline="top",ar&&(_e.fillStyle="#E0E0E0",_e.font="600 40px system-ui, -apple-system, Segoe UI, Roboto, Arial",_e.fillText(ar,Mt,Qe+28),Qe+=28+44);const Sn="Horrios disponveis",wn=Re.current||new Date,$n=dr(wn,"EEEE",{locale:$a}).replace(/-feira\b/gi,"").trim(),En=$n?`${$n.charAt(0).toUpperCase()}${$n.slice(1)}`:"",pa=`${En}${En?"  ":""}${dr(wn,"dd/MM",{locale:$a})}`;_e.textAlign="center",_e.textBaseline="top";const rs=Qe+40;_e.fillStyle="#F8F8F8",_e.font="bold 72px system-ui, -apple-system, Segoe UI, Roboto, Arial",_e.fillText(Sn,Mt,rs);const na=_e.measureText(Sn).width*.5,ya=rs+72+10,Wa=Mt-na/2;_e.save(),_e.fillStyle="#F5A623",_e.fillRect(Wa,ya,na,2),_e.restore();const Ea=ya+22;_e.font="700 52px system-ui, -apple-system, Segoe UI, Roboto, Arial",_e.fillStyle="#F5A623",_e.fillText(pa,Mt,Ea);const is=_e.measureText(pa).width,Ns=24,ss=Ea+56,ro=Mt-is/2-Ns/2,xl=is+Ns;_e.save();const D=_e.createLinearGradient(ro,ss,ro+xl,ss);D.addColorStop(0,"rgba(249,115,22,0.0)"),D.addColorStop(.5,"rgba(249,115,22,0.9)"),D.addColorStop(1,"rgba(249,115,22,0.0)"),_e.strokeStyle=D,_e.lineWidth=4,_e.beginPath(),_e.moveTo(ro,ss),_e.lineTo(ro+xl,ss),_e.stroke(),_e.restore();const X=Wt(),Pe=120,rt=700,Le=1080-240,Tt=720;_e.save(),_e.fillStyle="rgba(0,0,0,0.38)",_e.strokeStyle="rgba(255,255,255,0.10)",_e.lineWidth=2,((xr,Tr,jn,fa,qn)=>{_e.beginPath(),_e.moveTo(xr+qn,Tr),_e.lineTo(xr+jn-qn,Tr),_e.quadraticCurveTo(xr+jn,Tr,xr+jn,Tr+qn),_e.lineTo(xr+jn,Tr+fa-qn),_e.quadraticCurveTo(xr+jn,Tr+fa,xr+jn-qn,Tr+fa),_e.lineTo(xr+qn,Tr+fa),_e.quadraticCurveTo(xr,Tr+fa,xr,Tr+fa-qn),_e.lineTo(xr,Tr+qn),_e.quadraticCurveTo(xr,Tr,xr+qn,Tr),_e.closePath()})(Pe,rt,Le,Tt,28),_e.fill(),_e.stroke();const yt=xr=>{let Tr=Math.floor(xr/60),jn=xr%60;return Tr>=24&&(Tr=Tr%24),`${String(Tr).padStart(2,"0")}:${String(jn).padStart(2,"0")}`},Ge=(X||[]).map(([xr,Tr])=>`${yt(xr)}${yt(Tr)}`),Jt=10,Kt=Ge.slice(0,Jt),Hr=Ge.length-Kt.length;_e.fillStyle="#FFFFFF",_e.font="700 54px system-ui, -apple-system, Segoe UI, Roboto, Arial",_e.shadowColor="rgba(0,0,0,0.6)",_e.shadowBlur=12,_e.shadowOffsetX=0,_e.shadowOffsetY=4;let hn=rt+96;const An=80;if(Kt.length===0)_e.fillText("Sem horrios disponveis",1080/2,hn);else if(Ge.length===1)_e.fillStyle="#FFFFFF",_e.font="800 76px system-ui, -apple-system, Segoe UI, Roboto, Arial",_e.fillText(Ge[0],1080/2,hn+12);else{for(const xr of Kt)_e.fillText(xr,1080/2,hn),hn+=An;Hr>0&&(_e.fillStyle="rgba(255,255,255,0.80)",_e.font="600 34px system-ui, -apple-system, Segoe UI, Roboto, Arial",_e.fillText(`+${Hr} intervalos`,1080/2,hn+10))}_e.restore();try{const xr=(te||"").replace(/^https?:\/\//,"").trim();if(xr){_e.save(),_e.textAlign="center",_e.textBaseline="middle",_e.font="800 40px system-ui, -apple-system, Segoe UI, Roboto, Arial";const qn=_e.measureText(xr).width,Fa=Math.min(1080-200,Math.max(520,qn+30*2)),ps=(1080-Fa)/2;_e.fillStyle="rgba(0,0,0,0.55)",_e.strokeStyle="rgba(245,166,35,0.55)",_e.lineWidth=2;const La=24;_e.beginPath(),_e.moveTo(ps+La,1450),_e.lineTo(ps+Fa-La,1450),_e.quadraticCurveTo(ps+Fa,1450,ps+Fa,1450+La),_e.lineTo(ps+Fa,1450+78-La),_e.quadraticCurveTo(ps+Fa,1450+78,ps+Fa-La,1450+78),_e.lineTo(ps+La,1450+78),_e.quadraticCurveTo(ps,1450+78,ps,1450+78-La),_e.lineTo(ps,1450+La),_e.quadraticCurveTo(ps,1450,ps+La,1450),_e.closePath(),_e.fill(),_e.stroke(),_e.fillStyle="#F5A623",_e.shadowColor="rgba(0,0,0,0.55)",_e.shadowBlur=10,_e.shadowOffsetX=0,_e.shadowOffsetY=4,_e.fillText(xr,1080/2,1450+78/2),_e.restore()}}catch{}return et.toDataURL("image/png")},[O?.logo_url,se,gt,Ct,Wt,te]);p.useEffect(()=>{wt.current=!!ae},[ae]),p.useEffect(()=>{Gt.current=pt||""},[pt]);const ur=p.useCallback(async()=>{if(!wt.current){if(Gt.current)return Gt.current;wt.current=!0,ut(!0);try{const le=await br();Gt.current=le,ft(le);try{bt.current=await or(le)}catch{bt.current=null}return le}finally{wt.current=!1,ut(!1)}}},[br,or]);p.useEffect(()=>{if(De){try{bt.current=null}catch{}ft("");try{Gt.current=""}catch{}try{wt.current=!1}catch{}ur()}},[Bt,De,ur]),p.useEffect(()=>{De&&ur()},[De,ur]);const an=p.useCallback(async()=>{const we=await(async et=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(et);else{const _e=document.createElement("textarea");_e.value=et,_e.style.position="fixed",_e.style.top="0",_e.style.left="0",_e.style.opacity="0",document.body.appendChild(_e),_e.focus(),_e.select(),document.execCommand("copy"),document.body.removeChild(_e)}return!0}catch{return!1}})(Er);t({title:we?"Legenda copiada":"No foi possvel copiar",description:we?"Cole no story/status.":"Tente novamente.",variant:we?"success":"destructive"})},[Er,t]),zr=p.useCallback(async()=>{const le=await oe(te),we=(te||"").replace(/^https?:\/\//,"");t({title:le?"Link copiado":"No foi possvel copiar",description:we,variant:le?"success":"destructive"})},[oe,te,t]),Gr=p.useCallback(async()=>{try{const le=pt||await br(),we=document.createElement("a");we.href=le;const _e=dr(new Date,"yyyy-MM-dd-HH-mm");we.download=`horarios-${_e}.png`,document.body.appendChild(we),we.click(),document.body.removeChild(we),t({title:"Imagem baixada",description:"Agora  s postar no story/status.",variant:"success"})}catch{t({title:"Erro ao baixar imagem",description:"Tente novamente.",variant:"destructive"})}},[pt,br,t]),ha=p.useCallback(async()=>{try{if(typeof window<"u"&&window.isSecureContext&&navigator.share){const le=await ur()||pt||await br(),we=bt.current||await or(le),_e=dr(new Date,"yyyy-MM-dd-HH-mm"),tt={files:[new File([we],`horarios-${_e}.png`,{type:"image/png"})]};try{if(!navigator.canShare||navigator.canShare(tt)){await navigator.share(tt);try{window.location.href="whatsapp://app"}catch{}return}}catch{}}await Gr();try{typeof window<"u"&&window.innerWidth<768?window.location.href="whatsapp://app":window.open("https://web.whatsapp.com/","_blank","noopener,noreferrer")}catch{}t({title:"Imagem pronta",description:"Imagem baixada. Abra o WhatsApp e envie no Status.",variant:"success"})}catch{await Gr()}},[pt,ur,br,or,Gr,t]),pn=p.useCallback(async()=>{try{if(typeof window<"u"&&window.isSecureContext&&navigator.share){const le=await ur()||pt||await br(),we=bt.current||await or(le),_e=dr(new Date,"yyyy-MM-dd-HH-mm"),tt={files:[new File([we],`horarios-${_e}.png`,{type:"image/png"})]};try{!navigator.canShare||navigator.canShare(tt)?await navigator.share(tt):await Gr()}catch{await Gr()}}else await Gr();try{typeof window<"u"&&window.innerWidth<768?window.location.href="instagram://story-camera":window.open("https://www.instagram.com/","_blank","noopener,noreferrer")}catch{}}catch{await Gr()}},[pt,ur,br,or,Gr]);p.useCallback(async()=>{try{const le=pt||await br(),we=bt.current||await or(le),_e=dr(new Date,"yyyy-MM-dd-HH-mm"),St=new File([we],`horarios-${_e}.png`,{type:"image/png"}),tt={text:Er,files:[St]};if(navigator.share&&navigator.canShare&&navigator.canShare(tt)){await navigator.share(tt);return}if(navigator.share){await navigator.share({text:Er,url:te});return}const Mt=`https://wa.me/?text=${encodeURIComponent(Er)}`;window.open(Mt,"_blank","noopener,noreferrer"),await an(),await Gr()}catch{await an(),await Gr()}},[te,Er,pt,br,or,an,Gr]),p.useEffect(()=>{const le=we=>{if(we.key==="Escape"&&F){V(!1);return}if(we.key==="F10"){try{we.preventDefault()}catch{}V(et=>!et)}};return window.addEventListener("keydown",le),()=>window.removeEventListener("keydown",le)},[F]),p.useEffect(()=>{if(F&&window.innerWidth<768)if(screen.orientation&&screen.orientation.lock)screen.orientation.lock("landscape").catch(()=>{const le=document.getElementById("screen-orientation-meta");le&&le.setAttribute("content","landscape")});else{const le=document.getElementById("screen-orientation-meta");le&&le.setAttribute("content","landscape")}else if(!F&&window.innerWidth<768){screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock();const le=document.getElementById("screen-orientation-meta");le&&le.setAttribute("content","portrait-primary")}},[F]),p.useEffect(()=>{const le=I.get("date");if(le)try{const we=new Date(le+"T00:00:00");isNaN(we.getTime())||(q(we),I.delete("date"),T(I,{replace:!0}))}catch(we){console.error("[AgendaPage] Erro ao parsear date da URL:",we)}},[I,T]);const[on,cn]=p.useState([]),ke=p.useRef([]);p.useEffect(()=>{ke.current=Array.isArray(on)?on:[]},[on]);const[We,Ze]=p.useState(!1),[Je,At]=p.useState(""),Ye=p.useRef(0),lr=p.useRef(""),ce=p.useRef(!1),qe=p.useRef(0),[ze,xt]=p.useState(!1),[rr,ir]=p.useState(!1),Kr=p.useRef(!1);p.useEffect(()=>{Kr.current||!M||!A?.codigo_empresa||k&&(Kr.current=!0,(async()=>{try{const le=Po(k),we=Es(le,1),{data:et,error:_e}=await Q.from("agendamentos").select("id, codigo, inicio, fim, status, modalidade, quadra_id, cliente_id, auto_disabled, clientes, valor_total, created_by_isis").eq("codigo_empresa",A.codigo_empresa).gte("inicio",le.toISOString()).lt("inicio",we.toISOString()).order("inicio",{ascending:!0});if(_e)return;const St=(et||[]).map(tt=>({id:tt.id,code:tt.codigo,start:new Date(tt.inicio),end:new Date(tt.fim),status:tt.status||"scheduled",modality:tt.modalidade||"",customer:Array.isArray(tt.clientes)&&tt.clientes.length>0?tt.clientes[0]:"",court:String(tt.quadra_id||""),court_id:tt.quadra_id,valor_total:tt.valor_total??null,auto_disabled:!!tt.auto_disabled,created_by_isis:!!tt.created_by_isis}));cn(tt=>Array.isArray(tt)&&tt.length>0?tt:St)}catch{}})())},[M,A?.codigo_empresa,k,Q]);const[jr,sa]=p.useState(4),[ia,Kn]=p.useState(!1),[at,Te]=p.useState(!1),Fe=f,cr=h,[ht,Xr]=p.useState({}),Ft=p.useRef(0),kr=p.useRef("");p.useEffect(()=>{const le=we=>{try{const et=we?.detail||{},_e=et.agendamentoId,St=et.participants;if(!_e||!Array.isArray(St))return;Xr(tt=>{const Ne=tt[_e]||[],Mt=St.map((Qe,ar)=>{const Sn=Ne[ar]||{};return{...Sn,cliente_id:Qe.cliente_id,nome:Qe.nome,codigo:Qe.codigo!==void 0?Qe.codigo:Sn.codigo??null,valor_cota:typeof Qe.valor_cota=="string"?Qe.valor_cota:Sn.valor_cota??"",status_pagamento:Qe.status_pagamento??Sn.status_pagamento??"Pendente",finalizadora_id:Qe.finalizadora_id??Sn.finalizadora_id??null,aplicar_taxa:Qe.aplicar_taxa??Sn.aplicar_taxa??!1,ordem:ar+1}});return{...tt,[_e]:Mt}})}catch{}};return window.addEventListener("payments:saved",le),()=>window.removeEventListener("payments:saved",le)},[]);const jt=p.useRef(!1);p.useEffect(()=>{jt.current=ze,j("Modal state change:",{isModalOpen:ze}),C("modal",{open:ze})},[ze,j]);const er=p.useRef("init"),Nt=p.useRef(0),Cr=p.useRef(!1),Lr=p.useRef(0),un=p.useRef(!1),ra=p.useRef(0),[Wn,ln]=p.useState(!1),da=p.useRef(0),va=p.useRef(!1),oa=p.useRef(0),Tn=p.useCallback((le=800)=>{oa.current=Date.now()+le,j("UI:busy set",{ms:le})},[j]),ee=p.useCallback(()=>Date.now()<oa.current,[]),Ie=p.useRef(0),Oe=p.useRef(0),Yt=p.useRef(!1),Pt=p.useCallback(()=>{const le=Date.now();ze||le-Oe.current<350||(Oe.current=le,xt(!0),Yt.current=!0)},[ze]),Qt=p.useRef(!1);p.useEffect(()=>{n.state?.openModal&&!ze&&!Qt.current&&(Qt.current=!0,Pt(),window.history.replaceState({},document.title))},[n.state?.openModal,ze,Pt]);const[nr,fn]=p.useState({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),[J,Xe]=p.useState(null),[He,fe]=p.useState(!0),Ve=p.useRef(!0);p.useEffect(()=>{Ve.current=!!He},[He]);const xe=p.useMemo(()=>Object.fromEntries((J??[]).map(le=>[le.nome,le])),[J]),kt=p.useMemo(()=>(J??[]).map(le=>le.nome),[J]),[st,zt]=p.useState([]);p.useEffect(()=>{try{if(He)return;const le=J||[];if(!Array.isArray(le)||le.length===0||!Array.isArray(on)||on.length===0)return;let we=!1;const et=on.map(_e=>{if(!_e)return _e;const St=_e.court_id;if(St==null)return _e;const tt=le.find(Ne=>String(Ne.id)===String(St));return tt?.nome&&_e.court!==tt.nome&&!(kt||[]).includes(_e.court)?(we=!0,{..._e,court:tt.nome}):_e});we&&cn(et)}catch{}},[He,J,on,kt]);const pr=A?.codigo_empresa,en=p.useMemo(()=>pr?`quadras:list:${pr}`:"quadras:list",[pr]),sn=p.useMemo(()=>pr?`agenda:selectedCourts:${pr}`:"agenda:selectedCourts",[pr]),la=p.useMemo(()=>pr?`agenda:viewFilter:${pr}`:"agenda:viewFilter",[pr]),[Nr,xn]=p.useState(null),[Dn,Pa]=p.useState(0);p.useEffect(()=>{try{Sr.current=Nr}catch{}},[Nr]),p.useEffect(()=>{try{wr.current=Array.isArray(st)?st:[]}catch{}},[st]),p.useEffect(()=>{try{he.current=xe||{}}catch{}},[xe]),p.useEffect(()=>{try{ot.current=Array.isArray(on)?on:[]}catch{}},[on]),p.useEffect(()=>{st.length>0&&Nr===null&&xn(st[0])},[st,Nr]);const[Aa,Na]=p.useState([]),Hn=p.useRef(null),as=p.useRef({scheduled:!0,canceledOnly:!1}),[to,As]=p.useState(null),[Vs,ai]=p.useState(""),Ni=p.useRef(0),Si=p.useRef(!1),Sc=p.useRef(!1),[Qc,Cc]=p.useState(!1),[Yi,si]=p.useState(()=>{try{return localStorage.getItem("agenda:hideCanceledInfo")==="1"}catch{return!1}});p.useEffect(()=>{try{localStorage.setItem("agenda:hideCanceledInfo",Yi?"1":"0")}catch{}},[Yi]);const zo=p.useMemo(()=>{if(!A?.codigo_empresa)return null;const le=dr(B==="week"?vh(k):k,"yyyy-MM-dd"),we=B==="week"?"week":"day";return`agenda:bookings:${A.codigo_empresa}:${we}:${le}`},[A?.codigo_empresa,k,B]),Uo=p.useMemo(()=>{if(!A?.codigo_empresa)return null;const le=dr(k,"yyyy-MM-dd");return`agenda:participants:${A.codigo_empresa}:${le}`},[A?.codigo_empresa,k]),[Ac,gl]=p.useState(!1),qd=p.useMemo(()=>({autoConfirmEnabled:!1,autoConfirmMinutesBefore:120,autoStartEnabled:!0,autoFinishEnabled:!0}),[]),[Os,pi]=p.useState(qd),[_s,Au]=p.useState(qd),[Zc,Ji]=p.useState(!1),[Ol,R]=p.useState(0),de=p.useCallback(()=>Date.now()+(Number.isFinite(Ol)?Ol:0),[Ol]),[Ue,vt]=p.useState(null);p.useEffect(()=>{(async()=>{if(console.log("[AgendaSettings][LOAD] Iniciando carregamento...",{authReady:M,company_id:O?.id}),!M||!O?.id){console.warn("[AgendaSettings][LOAD] Aguardando autenticao...");return}try{console.log("[AgendaSettings][LOAD] Modo:","PRODUO (wrapper)"),console.log("[AgendaSettings][LOAD] Buscando para empresa_id:",O.id);const{data:we,error:et}=await Q.from("agenda_settings").select("*").eq("empresa_id",O.id).maybeSingle();if(console.log("[AgendaSettings][LOAD] Resultado da query:",{data:we,error:et}),console.log("[AgendaSettings][LOAD] Data type:",we===null?"null":typeof we),et){console.error("[AgendaSettings][LOAD] ERRO ao carregar:",et);return}if(!we){console.warn("[AgendaSettings][LOAD] Nenhum registro encontrado (ainda no criado)");return}console.log("[AgendaSettings][LOAD]  Registro encontrado:",we);const _e={autoConfirmEnabled:!!we.auto_confirm_enabled,autoConfirmMinutesBefore:we.auto_confirm_enabled&&Number.isFinite(Number(we.auto_confirm_hours))?Number(we.auto_confirm_hours)*60:qd.autoConfirmMinutesBefore,autoStartEnabled:!!we.auto_start_enabled,autoFinishEnabled:!!we.auto_finish_enabled};console.log("[AgendaSettings][LOAD]  Estado mapeado:",_e),pi(St=>({...St,..._e})),Au(_e),console.log("[AgendaSettings][LOAD]  Estados atualizados com sucesso!")}catch(we){console.warn("[AgendaSettings] unexpected load error",we)}})()},[M,O?.id]),p.useEffect(()=>{let le=!0,we=null,et=!1;const _e=async()=>{try{const{data:St,error:tt}=await Q.functions.invoke("time-br",{body:{}});if(!tt&&St&&le){const Ne=Number(St.nowMs);if(Number.isFinite(Ne)){const Mt=Ne-Date.now();R(Mt),vt(Date.now());return}}if(!et){et=!0;try{console.warn("[TimeSync] time-br sem dados vlidos; usando relgio local.")}catch{}}}catch{if(!et){et=!0;try{console.warn("[TimeSync] time-br falhou; usando relgio local.")}catch{}}}};return _e(),we=setInterval(_e,5*60*1e3),()=>{le=!1,we&&clearInterval(we)}},[]);const[Ht,Ur]=p.useState({}),mn=2*60*60*1e3,ne=p.useCallback(le=>{Ur(we=>({...we,[le]:Date.now()}))},[]),Ae=p.useCallback(le=>{Ur(we=>{if(!we||!(le in we))return we;const et={...we};return delete et[le],et})},[]),Ee=p.useCallback(le=>{const we=Ht?.[le];return typeof we=="number"&&Date.now()-we<mn},[Ht]),[it,Et]=p.useState(null),gr=p.useCallback(()=>new Promise(le=>{Et({resolve:le})}),[]),sr=p.useRef(new Map),Ir=async()=>{console.log(" [AgendaSettings][SAVE] FUNO CHAMADA! "),console.log("[AgendaSettings][SAVE] Linha 509 - Antes do try");try{if(console.log("[AgendaSettings][SAVE] Linha 511 - Dentro do try"),console.log("[AgendaSettings][SAVE] authReady:",M),console.log("[AgendaSettings][SAVE] company:",O),!M||!O?.id){console.error("[AgendaSettings][SAVE] ERRO: No autenticado",{authReady:M,company:O}),t({title:"No autenticado",description:"Faa login para salvar as configuraes.",variant:"destructive"});return}console.log("[AgendaSettings][SAVE]  Autenticado! Preparando payload..."),console.log("[AgendaSettings][SAVE] automation atual:",Os),Ji(!0);const le={empresa_id:O.id,auto_confirm_enabled:!!Os.autoConfirmEnabled,auto_confirm_hours:Os.autoConfirmEnabled?Math.max(0,Math.round(Number(Os.autoConfirmMinutesBefore||0)/60)):null,auto_start_enabled:!!Os.autoStartEnabled,auto_finish_enabled:!!Os.autoFinishEnabled};console.log("[AgendaSettings][SAVE] Payload preparado:",le),console.log("[AgendaSettings][SAVE] Modo:","PRODUO (wrapper)"),console.log("[AgendaSettings][SAVE] Supabase client type:",typeof Q.from);const{data:we,error:et}=await Q.from("agenda_settings").upsert(le,{onConflict:"empresa_id"}).select();if(console.log("[AgendaSettings][SAVE] Resultado do upsert:",{data:we,error:et}),console.log("[AgendaSettings][SAVE] Data type:",Array.isArray(we)?"array":typeof we),console.log("[AgendaSettings][SAVE] Data length:",we?.length),et)throw console.error("[AgendaSettings][SAVE]  ERRO no upsert:",et),et;!we||we.length===0?console.error("[AgendaSettings][SAVE]  AVISO: Upsert no retornou dados!"):console.log("[AgendaSettings][SAVE]  Dados salvos com sucesso:",we[0]),Au(Os),console.log("[AgendaSettings][SAVE]  savedAutomation atualizado:",Os),t({title:"Configuraes salvas",description:"As automaes da agenda foram atualizadas com sucesso."}),gl(!1),console.log("[AgendaSettings][SAVE]  Salvamento concludo!")}catch(le){console.error(" [AgendaSettings][SAVE] ERRO CAPTURADO:",le),console.error("[AgendaSettings][SAVE] Stack:",le?.stack),console.error("[AgendaSettings][SAVE] Message:",le?.message);const we=le?.message||"Falha ao salvar as configuraes.";t({title:"Erro ao salvar",description:we,variant:"destructive"})}finally{console.log("[AgendaSettings][SAVE] Finally executado"),Ji(!1)}},yr=p.useCallback(async(le,we,et="user")=>{try{const _e=["canceled","finished","absent"],St=["scheduled","confirmed","in_progress"],tt=_e.includes(we),Ne=we==="canceled";let Mt=!1;if(et==="user"&&St.includes(we)){const wn=(on||[]).find(pa=>pa.id===le),$n=wn?_e.includes(wn.status):!1,En=wn?!!wn.auto_disabled:!1;($n||En)&&(Mt=!!await gr())}const Qe=Ne?{canceled_by:et||"user",canceled_at:new Date().toISOString()}:{},ar=tt?{status:we,auto_disabled:!0,...Qe}:Mt?{status:we,auto_disabled:!1}:{status:we},{error:Sn}=await Q.from("agendamentos").update(ar).eq("codigo_empresa",A.codigo_empresa).eq("id",le).select("id");if(Sn)throw Sn;cn(wn=>wn.map($n=>{if($n.id!==le)return $n;const En={...$n,status:we,customer:$n.customer||""};return tt?En.auto_disabled=!0:Mt&&(En.auto_disabled=!1),En}));try{sr.current.set(le,{status:we,ts:Date.now(),src:et})}catch{}try{const wn=JSON.parse(localStorage.getItem(zo)||"[]");if(Array.isArray(wn)&&wn.length>0){const $n=Array.isArray(wn)?wn.map(En=>{if(En.id!==le)return En;const pa={...En,status:we,customer:En.customer||""};return tt?pa.auto_disabled=!0:Mt&&(pa.auto_disabled=!1),pa}):wn;localStorage.setItem(zo,JSON.stringify($n))}}catch{}if(et==="user")try{Mt?Ae(le):ne(le)}catch{}}catch(_e){console.error("Auto-status: falha ao atualizar",le,we,_e)}},[on,zo,ne,Ae,gr,nr]),Ut=p.useRef(!1),_n=p.useRef(null),Qr=p.useRef(null),Ar=p.useRef(null),Fn=p.useRef(!1),fr=p.useCallback(()=>{try{_n.current&&(clearTimeout(_n.current),_n.current=null)}catch{}},[]),Yr=p.useCallback(()=>{if(!M||!A?.codigo_empresa)return;if(Date.now()<(Ie.current||0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AutoDiag] scheduleNextAutomation:deferred returning-from-hidden")}catch{}Qr.current||(Qr.current=setTimeout(()=>{Qr.current=null;try{Yr()}catch{}},800));return}if(Qr.current){try{clearTimeout(Qr.current)}catch{}Qr.current=null}if(!Fn.current){j("scheduleNextAutomation:skipped (initial data not ready)"),setTimeout(()=>Yr(),800);return}if(jt.current){j("scheduleNextAutomation:skipped (modal open)");return}C("auto:schedule"),fr();const we=de();let et=1/0;const _e=St=>{Number.isFinite(St)&&St>we&&St<et&&(et=St)};try{for(const St of on||[]){if(!St||St.auto_disabled||Ee(St.id))continue;const tt=St.start instanceof Date?St.start.getTime():new Date(St.start).getTime(),Ne=St.end instanceof Date?St.end.getTime():new Date(St.end).getTime();if(St.status==="scheduled"&&_s.autoConfirmEnabled){const Mt=Number(_s.autoConfirmMinutesBefore||0)*6e4;_e(tt-Mt),_s.autoFinishEnabled&&_e(Ne)}St.status==="confirmed"&&(_s.autoStartEnabled&&_e(tt),_s.autoFinishEnabled&&_e(Ne)),St.status==="in_progress"&&_s.autoFinishEnabled&&_e(Ne)}}catch{}if(et!==1/0){const St=Math.max(0,Math.min(et-we+250,6e5));try{console.debug("[Auto] next schedule in ms",St)}catch{}try{Vn(et)}catch{}_n.current=setTimeout(()=>{try{Ar.current&&Ar.current()}catch{}},St)}},[M,A?.codigo_empresa,on,_s,Ee,fr,de]),$r=p.useCallback(async le=>{try{if(!(typeof Ue=="number"&&Date.now()-Ue<6e5))try{const{data:_e}=await Q.functions.invoke("time-br",{body:{}}),St=Number(_e?.nowMs);Number.isFinite(St)&&(R(St-Date.now()),vt(Date.now()))}catch{}try{Yr()}catch{}let et=null;if(le?.id&&A?.codigo_empresa){const{data:_e}=await Q.from("agendamentos").select("id, inicio, fim, status, modalidade, quadra_id, cliente_id, auto_disabled").eq("codigo_empresa",A.codigo_empresa).eq("id",le.id).single();if(_e){const St={...le,start:new Date(_e.inicio),end:new Date(_e.fim),status:_e.status||le.status,modality:_e.modalidade||le.modality,auto_disabled:!!_e.auto_disabled,customer:le.customer||""};et=St,cn(tt=>tt.map(Ne=>Ne.id===le.id?St:Ne))}}try{const _e=et||le;if(_e&&_e.id){const St=de(),tt=_e.start instanceof Date?_e.start.getTime():new Date(_e.start).getTime(),Ne=_e.end instanceof Date?_e.end.getTime():new Date(_e.end).getTime();if(!_e.auto_disabled&&!Ee(_e.id))if(_e.status==="in_progress"&&_s.autoFinishEnabled&&Number.isFinite(Ne)&&St>=Ne)await yr(_e.id,"finished","automation");else if(_e.status==="scheduled"&&_s.autoStartEnabled&&Number.isFinite(tt)&&St>=tt)await yr(_e.id,"in_progress","automation");else if(_e.status==="confirmed"&&_s.autoStartEnabled&&Number.isFinite(tt)&&St>=tt)await yr(_e.id,"in_progress","automation");else if(_e.status==="scheduled"&&_s.autoConfirmEnabled&&Number.isFinite(tt)){const Qe=Number(_s.autoConfirmMinutesBefore||0)*6e4;St>=tt-Qe&&await yr(_e.id,"confirmed","automation")}else(_e.status==="scheduled"||_e.status==="confirmed")&&_s.autoFinishEnabled&&Number.isFinite(Ne)&&St>=Ne&&await yr(_e.id,"finished","automation")}}catch{}try{Ar.current&&Ar.current()}catch{}try{console.log(" EditGuard | ok | tempo=",typeof Ue=="number"?"Servidor":"Local")}catch{}return{booking:et}}catch(we){try{console.warn(" EditGuard | falha leve",we?.message||we)}catch{}return{booking:null}}},[Ue,Q,A,cn,Yr,de,Os,Ee,yr]);p.useEffect(()=>{if(!(!M||!A?.codigo_empresa)&&Ue&&!Fn.current){Fn.current=!0,j("initial-data:ready",{at:Ue});try{Yr()}catch{}}},[Ue,M,A,Yr,j]);const Dr=p.useCallback(async()=>{if(!(!M||!A?.codigo_empresa)){if(jt.current){j("runAutomation:skipped (modal open)");return}if(Date.now()<(Ie.current||0)){j("runAutomation:skipped (returning-from-hidden grace)");try{Yr()}catch{}return}if(!Fn.current){j("runAutomation:skipped (initial data not ready)");try{Yr()}catch{}return}if(!Ut.current){Ut.current=!0;try{try{console.debug("[Auto] tick")}catch{}C("auto:tick");const le=de(),we=new Date(le),et=dr(we,"yyyy-MM-dd");let _e=(on||[]).filter(tt=>dr(tt.start,"yyyy-MM-dd")===et);if(_e.length===0)try{const tt=Po(we),Ne=Es(tt,1),{data:Mt,error:Qe}=await Q.from("agendamentos").select("id, inicio, fim, status, auto_disabled").eq("codigo_empresa",A.codigo_empresa).gte("inicio",tt.toISOString()).lt("inicio",Ne.toISOString());!Qe&&Array.isArray(Mt)&&(_e=Mt.map(ar=>({id:ar.id,start:new Date(ar.inicio),end:new Date(ar.fim),status:ar.status||"scheduled",auto_disabled:!!ar.auto_disabled})))}catch{}try{const{data:tt,error:Ne}=await Q.from("agendamentos").select("id, inicio, fim, status, auto_disabled").eq("codigo_empresa",A.codigo_empresa).lt("fim",we.toISOString()).in("status",["scheduled","confirmed","in_progress"]);if(!Ne&&Array.isArray(tt)&&tt.length>0){const Mt=tt.map(ar=>({id:ar.id,start:new Date(ar.inicio),end:new Date(ar.fim),status:ar.status||"scheduled",auto_disabled:!!ar.auto_disabled})),Qe=new Map(_e.map(ar=>[ar.id,ar]));for(const ar of Mt)Qe.has(ar.id)||Qe.set(ar.id,ar);_e=Array.from(Qe.values())}}catch{}let St=!1;for(const tt of _e){if(tt.auto_disabled||Ee(tt.id))continue;const Ne=tt.start instanceof Date?tt.start.getTime():new Date(tt.start).getTime(),Mt=tt.end instanceof Date?tt.end.getTime():new Date(tt.end).getTime();if(tt.status==="in_progress"&&_s.autoFinishEnabled&&le>=Mt){try{console.debug("[Auto] finish",{id:tt.id})}catch{}await yr(tt.id,"finished","automation"),St=!0;continue}if(tt.status==="scheduled"&&_s.autoStartEnabled&&le>=Ne){try{console.debug("[Auto] start-direct (skip confirm)",{id:tt.id})}catch{}await yr(tt.id,"in_progress","automation"),St=!0;continue}if(tt.status==="confirmed"&&_s.autoStartEnabled&&le>=Ne){try{console.debug("[Auto] start",{id:tt.id})}catch{}await yr(tt.id,"in_progress","automation"),St=!0;continue}if(tt.status==="scheduled"&&_s.autoConfirmEnabled){const Qe=Number(_s.autoConfirmMinutesBefore||0)*6e4;if(le>=Ne-Qe){try{console.debug("[Auto] confirm",{id:tt.id})}catch{}await yr(tt.id,"confirmed","automation"),St=!0;continue}}if((tt.status==="scheduled"||tt.status==="confirmed")&&_s.autoFinishEnabled&&le>=Mt){try{console.debug("[Auto] catchup-finish",{id:tt.id})}catch{}await yr(tt.id,"finished","automation"),St=!0;continue}}if(St)try{setTimeout(()=>{try{Nn()}catch{}},800)}catch{}try{Yr()}catch{}}finally{Ut.current=!1}}}},[M,A?.codigo_empresa,on,_s,yr,Ee,Yr,de]);p.useEffect(()=>{Ar.current=Dr},[Dr]),p.useEffect(()=>{const le=setInterval(Dr,1e4);try{Ar.current&&Ar.current()}catch{}try{Yr()}catch{}return()=>clearInterval(le)},[Dr]),p.useEffect(()=>{const le=setInterval(()=>{try{if(!!!(_s?.autoConfirmEnabled||_s?.autoStartEnabled||_s?.autoFinishEnabled))return;Ar.current&&(console.debug("[Auto][Watchdog] forcing periodic automation run"),Ar.current())}catch{}},18e5);return()=>clearInterval(le)},[_s]),p.useEffect(()=>{if(zo)try{const le=JSON.parse(localStorage.getItem(zo)||"[]");if(Array.isArray(le)&&le.length>0){const we=le.map(et=>({...et,start:new Date(et.start),end:new Date(et.end),customer:et.customer||"",created_by_isis:!!et.created_by_isis}));j("cache:bookings:hydrate",{count:we.length,sample:we[0]}),C("cache:hydrate",{count:we.length}),cn(et=>et&&et.length>0?et:we),Tn(1200)}}catch{}},[zo,j]),p.useEffect(()=>{const le=()=>{try{const _e=new Date().toISOString();if(document.visibilityState==="visible"){const St=Date.now();Ie.current=St+800}}catch{}},we=()=>{try{const _e=new Date().toISOString()}catch{}},et=()=>{try{const _e=new Date().toISOString()}catch{}};return document.addEventListener("visibilitychange",le),window.addEventListener("focus",we),window.addEventListener("blur",et),()=>{document.removeEventListener("visibilitychange",le),window.removeEventListener("focus",we),window.removeEventListener("blur",et)}},[ze,on]),p.useEffect(()=>{try{Yr()}catch{}return()=>{try{fr()}catch{}}},[on,Os,Yr,fr]),p.useEffect(()=>{if(Uo)try{const le=JSON.parse(localStorage.getItem(Uo)||"{}");if(le&&typeof le=="object"){const we={};for(const[et,_e]of Object.entries(le||{})){const St=Array.isArray(_e)?_e.slice():[];St.sort((tt,Ne)=>{const Mt=Number.isFinite(Number(tt?.ordem))?Number(tt.ordem):Number.MAX_SAFE_INTEGER,Qe=Number.isFinite(Number(Ne?.ordem))?Number(Ne.ordem):Number.MAX_SAFE_INTEGER;return Mt!==Qe?Mt-Qe:String(tt?.id||"").localeCompare(String(Ne?.id||""))}),we[et]=St}Xr(we),kr.current=dr(k,"yyyy-MM-dd")}}catch{}},[Uo]);const dn=p.useCallback(async(le,we)=>{if(!M||!A?.codigo_empresa)return{map:{},ids:[]};const et=(Array.isArray(le)?le:[]).filter(Boolean);if(et.length===0)return{map:{},ids:[]};try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] fetchParticipantsBatch:start",{reqId:we,ids:et.length})}catch{}const{data:_e,error:St}=await Q.from("agendamento_participantes").select("id, agendamento_id, codigo_empresa, cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey(nome, codigo)").in("agendamento_id",et).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(Ye.current!==we)return{map:{},ids:et};if(St)throw St;const tt={};for(const Ne of _e||[]){const Mt=Ne.agendamento_id;tt[Mt]||(tt[Mt]=[]);const Qe=Ne.nome||(Array.isArray(Ne.cliente)?Ne.cliente[0]?.nome:Ne.cliente?.nome)||"",ar=(Array.isArray(Ne.cliente)?Ne.cliente[0]?.codigo:Ne.cliente?.codigo)||null;tt[Mt].push({...Ne,nome:Qe,codigo:ar})}for(const Ne of et){const Mt=Array.isArray(tt[Ne])?tt[Ne].slice():[];Mt.sort((Qe,ar)=>{const Sn=Number.isFinite(Number(Qe?.ordem))?Number(Qe.ordem):Number.MAX_SAFE_INTEGER,wn=Number.isFinite(Number(ar?.ordem))?Number(ar.ordem):Number.MAX_SAFE_INTEGER;return Sn!==wn?Sn-wn:String(Qe?.id||"").localeCompare(String(ar?.id||""))}),tt[Ne]=Mt}Xr(Ne=>{const Mt={...Ne};for(const Qe of et)Mt[Qe]=tt[Qe]||[];try{Uo&&localStorage.setItem(Uo,JSON.stringify(Mt))}catch{}return Mt}),cn(Ne=>{const Mt=Ne||[];let Qe=!1;const ar=Mt.map(Sn=>{const wn=tt[Sn.id];if(Array.isArray(wn)&&wn.length>0){const $n=(wn.find(En=>En?.is_representante)||wn[0])?.nome||"";if($n&&$n!==Sn.customer)return Qe=!0,{...Sn,customer:$n}}return Sn});return Qe?ar:Ne});try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] fetchParticipantsBatch:done",{reqId:we,rows:(_e||[]).length})}catch{}return{map:tt,ids:et}},[M,A?.codigo_empresa,Uo,Xr,cn]),Nn=p.useCallback(async()=>{if(!M||!A?.codigo_empresa||ze)return;j("fetchBookings:start",{date:dr(k,"yyyy-MM-dd"),empresa:A?.codigo_empresa}),C("fetch:start",{day:dr(k,"yyyy-MM-dd")});const le=Po(k),we=B==="week"?vh(k):le,et=B==="week"?Es(we,7):Es(we,1),{data:_e,error:St}=await Q.from("agendamentos").select(`
        id, codigo, codigo_empresa, quadra_id, cliente_id, clientes, valor_total, inicio, fim, modalidade, status, auto_disabled, created_by_isis,
        quadra:quadra_id ( nome )
      `).eq("codigo_empresa",A.codigo_empresa).gte("inicio",we.toISOString()).lt("inicio",et.toISOString()).order("inicio",{ascending:!0});if(St){j("fetchBookings:error",{message:St?.message,code:St?.code,status:St?.status}),C("fetch:error",{message:St?.message,code:St?.code,status:St?.status}),t({title:"Erro ao carregar agendamentos",description:St.message,variant:"destructive"}),Si.current||(Si.current=!0,setTimeout(Nn,900));return}if(!_e||_e.length===0)return j("fetchBookings:empty-hit"),C("fetch:empty"),Si.current?Si.current=!1:(Si.current=!0,setTimeout(Nn,700)),ke.current;Si.current=!1;const tt=Date.now(),Ne=(()=>{try{const Qe=Array.isArray(ke.current)?ke.current:[];return new Map(Qe.map(ar=>[ar.id,ar]))}catch{return new Map}})(),Mt=(_e||[]).map(Qe=>{const ar=new Date(Qe.inicio),Sn=new Date(Qe.fim),wn=Ne.get(Qe.id),$n=Qe.quadra?.[0]?.nome||Qe.quadra?.nome||Object.values(xe).find(ea=>ea.id===Qe.quadra_id)?.nome||"",En=Qe.quadra_id!=null?String(Qe.quadra_id):"";let pa="";if(!pa&&Qe.clientes)try{const ea=typeof Qe.clientes=="string"?JSON.parse(Qe.clientes):Qe.clientes;Array.isArray(ea)&&ea.length>0&&(pa=ea[0]?.nome||ea[0]||"")}catch{}const rs=sr.current.get(Qe.id),Ys=rs&&tt-rs.ts<4e3;return{id:Qe.id,code:Qe.codigo,court:$n||En,court_id:Qe.quadra_id,customer:wn&&wn.customer?wn.customer:pa,valor_total:Qe.valor_total!==void 0?Qe.valor_total:wn?.valor_total??null,start:ar,end:Sn,status:Ys?rs.status:Qe.status||"scheduled",modality:Qe.modalidade||"",auto_disabled:!!Qe.auto_disabled,created_by_isis:!!Qe.created_by_isis}});cn(Qe=>{const ar=Array.isArray(Qe)?Qe:[],Sn=Array.isArray(Mt)?Mt:[];if(ar.length!==Sn.length)return Mt;for(let wn=0;wn<ar.length;wn++){const $n=ar[wn],En=Sn[wn];if(!$n||!En)return Mt;const pa=$n.start instanceof Date?$n.start.getTime():new Date($n.start).getTime(),rs=$n.end instanceof Date?$n.end.getTime():new Date($n.end).getTime(),Ys=En.start instanceof Date?En.start.getTime():new Date(En.start).getTime(),ea=En.end instanceof Date?En.end.getTime():new Date(En.end).getTime();if($n.id!==En.id||$n.status!==En.status||$n.modality!==En.modality||String($n.court||"")!==String(En.court||"")||String($n.court_id||"")!==String(En.court_id||"")||String($n.customer||"")!==String(En.customer||"")||Number($n.valor_total??NaN)!==Number(En.valor_total??NaN)||!!$n.auto_disabled!=!!En.auto_disabled||pa!==Ys||rs!==ea)return Mt}return Qe});try{if(zo){const Qe=Mt.map(ar=>({id:ar.id,code:ar.code,court:ar.court,court_id:ar.court_id,customer:ar.customer,valor_total:ar.valor_total??null,start:ar.start.toISOString(),end:ar.end.toISOString(),status:ar.status,modality:ar.modality,auto_disabled:ar.auto_disabled,created_by_isis:!!ar.created_by_isis}));localStorage.setItem(zo,JSON.stringify(Qe))}}catch{}return Mt},[M,A?.codigo_empresa,k,xe,zo,t,j,w,B,ze]);p.useEffect(()=>{(async()=>{if(!M||!A?.codigo_empresa||!k||ze)return;const we=dr(B==="week"?vh(k):k,"yyyy-MM-dd"),et=`${A.codigo_empresa}:${B}:${we}`;if(lr.current===et||ce.current)return;ce.current=!0;const _e=++Ye.current;qe.current=Date.now();try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] start",{reqId:_e,bootKey:et,ts:new Date().toISOString()})}catch{}Ze(!0),At("Carregando quadras");try{if(Ve.current){const En=Date.now();let pa=!1;await new Promise(rs=>{const Ys=setInterval(()=>{if(Ye.current!==_e){clearInterval(Ys),rs();return}if(Ve.current||(clearInterval(Ys),rs()),!pa&&Date.now()-En>5e3){pa=!0;try{console.warn("[AgendaBoot] aguardando courtsLoading >5s",{reqId:_e,bootKey:et})}catch{}}if(Date.now()-En>6500){try{console.warn("[AgendaBoot] timeout aguardando courtsLoading, prosseguindo boot",{reqId:_e,bootKey:et})}catch{}clearInterval(Ys),rs()}},50)})}if(Ye.current!==_e)return;At("Carregando agendamentos");try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] stage",{reqId:_e,stage:"bookings"})}catch{}const St=Date.now();let tt=!1;const Ne=setInterval(()=>{if(!tt&&Ye.current===_e&&Date.now()-St>5e3){tt=!0;try{console.warn("[AgendaBoot] aguardando fetchBookings >5s",{reqId:_e,bootKey:et})}catch{}}},250);let Mt=await Nn();try{clearInterval(Ne)}catch{}if(Ye.current!==_e)return;let Qe=Array.isArray(Mt)?Mt:[];if(Qe.length===0){try{localStorage.getItem("debug:agenda")==="1"&&console.warn("[AgendaBoot] fetchBookings vazio, tentando novamente",{reqId:_e,bootKey:et})}catch{}if(await new Promise(En=>setTimeout(En,750)),Mt=await Nn(),Ye.current!==_e)return;Qe=Array.isArray(Mt)?Mt:[]}const ar=Qe.map(En=>En.id).filter(Boolean);try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] bookings loaded",{reqId:_e,count:Qe.length,idsCount:ar.length})}catch{}At("Carregando participantes");try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] stage",{reqId:_e,stage:"participants"})}catch{}const Sn=Date.now();let wn=!1;const $n=setInterval(()=>{if(!wn&&Ye.current===_e&&Date.now()-Sn>5e3){wn=!0;try{console.warn("[AgendaBoot] aguardando fetchParticipantsBatch >5s",{reqId:_e,bootKey:et,ids:ar.length})}catch{}}},250);await dn(ar,_e);try{clearInterval($n)}catch{}lr.current=et}catch(St){try{console.warn("[AgendaBoot] erro ao carregar agenda:",{reqId:_e,bootKey:et,message:St?.message,e:St})}catch{}}finally{if(ce.current=!1,Ye.current===_e){Ze(!1),At("");try{const St=Date.now()-(qe.current||Date.now());localStorage.getItem("debug:agenda")==="1"&&console.log("[AgendaBoot] done",{reqId:_e,bootKey:et,ms:St})}catch{}}}})()},[M,A?.codigo_empresa,k,B,ze,He,Nn,dn]),p.useEffect(()=>{if(w)try{const le=(on||[]).map(we=>`${we.id}:${dr(we.start,"HH:mm")}-${dr(we.end,"HH:mm")}:${we.status}`).join(" | ");console.log("[AgendaDbg] bookings:changed",{count:Array.isArray(on)?on.length:0,summary:le})}catch{}},[on,w]),p.useEffect(()=>{try{const le=Date.now()+1800;Lr.current=le,j("Picker:suppressClose window set",{until:le})}catch{}},[on]),p.useEffect(()=>{M&&A?.codigo_empresa&&Nn()},[M,A?.codigo_empresa,k,xe,zo]);const ua=p.useRef(null),[ds,Xs]=p.useState("idle"),[vn,Or]=p.useState(null),rn=p.useRef(!1);p.useEffect(()=>{if(!M||!A?.codigo_empresa)return;const le=Po(k),we=Es(le,1),et=Qe=>{try{const ar=new Date(Qe);return ar>=le&&ar<we}catch{return!1}},_e=Qe=>{const ar=Qe?.new||Qe?.old;if(ar&&ar.codigo_empresa===A.codigo_empresa&&(et(ar.inicio)||et(ar.fim))){try{console.debug("[Realtime] agendamentos change",{event:Qe.eventType,id:ar.id})}catch{}ua.current&&clearTimeout(ua.current);try{Or(Date.now())}catch{}if(jt.current){j("Realtime:onChange deferred due to modal open"),rn.current=!0,C("rt:change:deferred",{id:ar.id,event:Qe.eventType});return}j("Realtime:onChange scheduling fetchBookings"),C("rt:change",{id:ar.id,event:Qe.eventType}),ua.current=setTimeout(()=>{try{j("Realtime:debounced fetchBookings fire"),C("rt:debounced:fire"),Tn(300),Nn()}catch{}},400)}},St=Qe=>{const ar=Qe?.new||Qe?.old;if(ar&&ar.codigo_empresa===A.codigo_empresa){try{console.debug("[Realtime] agendamento_participantes change",{event:Qe.eventType,agendamento_id:ar.agendamento_id})}catch{}ua.current&&clearTimeout(ua.current);try{Or(Date.now())}catch{}if(jt.current){j("Realtime:onParticipantsChange deferred due to modal open"),rn.current=!0,C("rt:participants:deferred",{agendamento_id:ar.agendamento_id,event:Qe.eventType});return}j("Realtime:onParticipantsChange scheduling fetchBookings"),C("rt:participants",{agendamento_id:ar.agendamento_id,event:Qe.eventType}),ua.current=setTimeout(()=>{try{j("Realtime:participants debounced fetchBookings fire"),C("rt:participants:debounced:fire"),Tn(300),Nn()}catch{}},400)}},tt=Q.channel(`agendamentos:${A.codigo_empresa}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamentos",filter:`codigo_empresa=eq.${A.codigo_empresa}`},_e).subscribe(Qe=>{try{console.debug("[Realtime] channel status",Qe)}catch{}try{Xs(String(Qe||"unknown"))}catch{}}),Ne=Q.channel(`agendamento_participantes:${A.codigo_empresa}`).on("postgres_changes",{event:"*",schema:"public",table:"agendamento_participantes",filter:`codigo_empresa=eq.${A.codigo_empresa}`},St).subscribe(),Mt=setInterval(()=>{jt.current||Nn()},3e4);return()=>{try{ua.current&&clearTimeout(ua.current)}catch{}try{Q.removeChannel(tt)}catch{}try{Q.removeChannel(Ne)}catch{}try{clearInterval(Mt)}catch{}try{Xs("polling")}catch{}}},[M,A?.codigo_empresa,k,Nn]),p.useEffect(()=>{if(!ze&&rn.current){rn.current=!1;try{j("Modal closed: flushing pending realtime refresh"),C("rt:flushAfterModalClose"),Nn()}catch{}}},[ze,Nn,j]);const[gn,Vn]=p.useState(null),On=p.useRef("");p.useEffect(()=>{try{const le=typeof Ue=="number"&&Date.now()-Ue<6e5,we=ar=>typeof ar=="number"?dr(new Date(ar),"HH:mm:ss",{locale:$a}):"",et=ar=>typeof ar=="number"?dr(new Date(ar),"HH:mm",{locale:$a}):"",_e=le?"":"",tt=String(ds).toUpperCase()==="SUBSCRIBED"||String(ds).toLowerCase()==="polling"?"":"",Ne=typeof gn=="number"?"":"",Mt=Array.isArray(on)?on.length:0,Qe=` Agenda | ${_e} Tempo=${le?"Servidor":"Local"} (${Math.round(Ol)}ms, sync ${we(Ue)}) |  Realtime=${tt} ${ds}${vn?` (${we(vn)})`:""} | ${Ne} Prximo=${et(gn)} |  Agendamentos=${Mt}`;On.current!==Qe&&(On.current=Qe,console.log(Qe)),typeof window<"u"&&(window.__AgendaConn={usingServer:le,serverOffsetMs:Ol,lastTimeSyncAtMs:Ue,realtimeStatus:ds,lastRealtimeEventAtMs:vn,nextAutoAtMs:gn})}catch{}},[Ol,Ue,ds,vn,Os,gn,A?.codigo_empresa,k,Array.isArray(on)?on.length:0]),p.useEffect(()=>{const le=setInterval(()=>{try{const we=Date.now();if(we<(Ie.current||0)){try{localStorage.getItem("debug:agenda")==="1"&&console.log("[AutoDiag] reconcile:skipped returning-from-hidden")}catch{}return}if(ze){console.log("[AutoDiag] reconcile:skipped modal-open");return}const et=String(ds||"").toUpperCase()==="SUBSCRIBED",_e=typeof vn=="number"?we-vn:1/0,St=!et||_e>7*60*1e3,tt=typeof gn=="number"?we>gn+60*1e3:!1;if(St||tt){console.debug("[Reconcile] forcing fetchBookings (stale=",St," tickDue=",tt,")"),Nn();try{Yr()}catch{}}}catch{}},3e5);return()=>clearInterval(le)},[ds,vn,gn,Nn,Yr]),p.useEffect(()=>{(async()=>{if(!M||!A?.codigo_empresa||Date.now()<(Ie.current||0))return;if(jt.current){j("Participants:skipped (modal open)");return}j("Participants:load start"),C("parts:start");const we=(on||[]).map(Mt=>Mt.id).filter(Boolean),et=dr(k,"yyyy-MM-dd");if(!we.length){if(kr.current!==et){Xr({});try{Uo&&localStorage.setItem(Uo,"{}")}catch{}}kr.current=et;return}const _e=++Ft.current,{data:St,error:tt}=await Q.from("agendamento_participantes").select("id, agendamento_id, codigo_empresa, cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey(nome, codigo)").in("agendamento_id",we).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(Ft.current!==_e)return;if(tt){console.warn("[Participants] load error",tt),j("Participants:error",{message:tt?.message,code:tt?.code,status:tt?.status}),C("parts:error",{code:tt?.code});return}const Ne={};for(const Mt of St||[]){const Qe=Mt.agendamento_id;Ne[Qe]||(Ne[Qe]=[]);const ar=Mt.nome||(Array.isArray(Mt.cliente)?Mt.cliente[0]?.nome:Mt.cliente?.nome)||"",Sn=(Array.isArray(Mt.cliente)?Mt.cliente[0]?.codigo:Mt.cliente?.codigo)||null;Ne[Qe].push({...Mt,nome:ar,codigo:Sn})}for(const Mt of we){const Qe=Array.isArray(Ne[Mt])?Ne[Mt].slice():[];Qe.sort((ar,Sn)=>{const wn=Number.isFinite(Number(ar?.ordem))?Number(ar.ordem):Number.MAX_SAFE_INTEGER,$n=Number.isFinite(Number(Sn?.ordem))?Number(Sn.ordem):Number.MAX_SAFE_INTEGER;return wn!==$n?wn-$n:String(ar?.id||"").localeCompare(String(Sn?.id||""))}),Ne[Mt]=Qe}j("Participants:loaded",{bookings:we.length,rows:(St||[]).length}),C("parts:loaded",{rows:(St||[]).length}),kr.current=et,Xr(Mt=>{const Qe={...Mt};for(const ar of we)Qe[ar]=Ne[ar]||[];try{Uo&&localStorage.setItem(Uo,JSON.stringify(Qe))}catch{}return j("Participants:set state for ids",{ids:we}),C("parts:set",{idsCount:we.length}),Qe}),cn(Mt=>{const Qe=Mt||[];let ar=!1;const Sn=Qe.map(wn=>{const $n=Ne[wn.id];if(Array.isArray($n)&&$n.length>0){const En=($n.find(pa=>pa?.is_representante)||$n[0])?.nome||"";if(En&&En!==wn.customer)return ar=!0,{...wn,customer:En}}return wn});return ar?Sn:Mt})})()},[M,A?.codigo_empresa,on,k,Uo,j]),p.useEffect(()=>{(async()=>{if(!(!M||!A?.codigo_empresa||!kt.length)){L(!0);try{const we=dr(k,"yyyy-MM-dd"),et=k.getDay(),{data:_e,error:St}=await Q.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",A.codigo_empresa).or(`and(tipo.eq.data_fechamento,data_fechamento.eq.${we}),and(tipo.eq.dia_semana,dia_semana.eq.${et})`);if(St){console.error("Erro ao carregar dias de funcionamento:",St);return}const tt={};kt.forEach(Ne=>{const Mt=xe[Ne];if(!Mt)return;const Qe=_e?.find(Sn=>Sn.quadra_id===Mt.id&&Sn.tipo==="data_fechamento"&&Sn.data_fechamento===we);if(Qe&&!Qe.funciona){tt[Ne]={funciona:!1,motivo:"data_especifica",observacao:Qe.observacao||"Fechamento especial"};return}const ar=_e?.find(Sn=>Sn.quadra_id===Mt.id&&Sn.tipo==="dia_semana"&&Sn.dia_semana===et);ar?tt[Ne]={funciona:ar.funciona,motivo:ar.funciona?"normal":"dia_semana",observacao:ar.funciona?null:"Fechado neste dia da semana"}:tt[Ne]={funciona:!0,motivo:"normal",observacao:null}}),be(tt)}catch(we){console.error("Erro ao verificar dias de funcionamento:",we)}finally{L(!1)}}})()},[M,A?.codigo_empresa,k,kt,xe]),p.useEffect(()=>{if(!M||!A?.codigo_empresa||kt.length===0)return;(async()=>{try{const we=new Date(k);we.setDate(we.getDate()-we.getDay());const{data:et,error:_e}=await Q.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",A.codigo_empresa);if(_e){console.error("Erro ao carregar funcionamento da semana:",_e);return}const St={};for(let tt=0;tt<7;tt++){const Ne=new Date(we);Ne.setDate(Ne.getDate()+tt);const Mt=dr(Ne,"yyyy-MM-dd"),Qe=Ne.getDay(),ar={};kt.forEach(Sn=>{const wn=xe[Sn];if(!wn)return;const $n=et?.find(pa=>pa.quadra_id===wn.id&&pa.tipo==="data_fechamento"&&pa.data_fechamento===Mt);if($n&&!$n.funciona){ar[Sn]={funciona:!1,motivo:"data_especifica",observacao:$n.observacao||"Fechamento especial"};return}const En=et?.find(pa=>pa.quadra_id===wn.id&&pa.tipo==="dia_semana"&&pa.dia_semana===Qe);En?ar[Sn]={funciona:En.funciona,motivo:En.funciona?"normal":"dia_semana",observacao:En.funciona?null:"Fechado neste dia da semana"}:ar[Sn]={funciona:!0,motivo:"normal",observacao:null}}),St[Mt]=ar}ie(St)}catch(we){console.error("Erro ao carregar funcionamento da semana:",we)}})()},[M,A?.codigo_empresa,k,kt,xe]),p.useEffect(()=>{Object.values(me).some(we=>!we.funciona)&&Hn.current},[me]),p.useEffect(()=>{if(pr)try{const le=JSON.parse(localStorage.getItem(en)||"[]");Array.isArray(le)&&le.length&&(!J||J.length===0)&&(Xe(le),fe(!1))}catch{}},[pr,en]),p.useEffect(()=>{const le=async()=>{if(!A?.codigo_empresa)return;try{localStorage.getItem("debug:agenda")==="1"&&console.log("[Agenda][Courts] loadCourts:start",{empresa:A.codigo_empresa,hasCache:!!localStorage.getItem(en)})}catch{}try{const St=JSON.parse(localStorage.getItem(en)||"[]");if(Array.isArray(St)&&St.length>0){const tt=St[0]?.codigo_empresa;if(tt&&tt!==A.codigo_empresa){console.warn(" [Cache Limpo] Quadras de outra empresa detectadas e removidas"),localStorage.removeItem(en),localStorage.removeItem(sn),Xe([]);try{zt([])}catch{}try{xn(null)}catch{}try{setForm(Ne=>({...Ne,court:""}))}catch{}}}}catch{}(!J||J.length===0)&&fe(!0);const{data:we,error:et}=await Q.from("quadras").select("id, nome, modalidades, hora_inicio, hora_fim, valor, codigo_empresa, status").eq("codigo_empresa",A.codigo_empresa).eq("status","Ativa").order("nome",{ascending:!0});if(et){console.error("Erro ao buscar quadras:",et),Sc.current?fe(!1):(Sc.current=!0,setTimeout(le,900));try{localStorage.getItem("debug:agenda")==="1"&&console.warn("[Agenda][Courts] loadCourts:error",{empresa:A.codigo_empresa,message:et?.message,code:et?.code})}catch{}return}const _e=we||[];if(_e.length===0){let St=0;try{const tt=JSON.parse(localStorage.getItem("quadras:list")||"[]");St=Array.isArray(tt)?tt.length:0}catch{}if(St>0&&!Sc.current){Sc.current=!0,fe(!1),setTimeout(le,700);return}}Sc.current=!1,Xe(_e);try{localStorage.setItem(en,JSON.stringify(_e))}catch{}fe(!1);try{localStorage.getItem("debug:agenda")==="1"&&console.log("[Agenda][Courts] loadCourts:done",{empresa:A.codigo_empresa,count:Array.isArray(_e)?_e.length:0})}catch{}};M&&A?.codigo_empresa&&le()},[M,A?.codigo_empresa,en,sn]),p.useEffect(()=>{try{if(He)return;const le=kt||[];form?.court&&!le.includes(form.court)&&setForm(we=>({...we,court:le[0]||""})),(!form?.court||form.court==="")&&le.length>0&&setForm(we=>({...we,court:le[0]}))}catch{}},[He,kt,A?.codigo_empresa]),p.useEffect(()=>{if(He)return;const le=(()=>{try{return JSON.parse(localStorage.getItem(sn)||"[]")}catch{return[]}})(),we=(()=>{try{return JSON.parse(localStorage.getItem(la)||"{}")}catch{return{}}})(),et=le.filter(_e=>kt.includes(_e));et.length>0?zt(et):st.length===0&&zt(kt),we&&typeof we=="object"&&fn(_e=>({..._e,canceledOnly:!1,...we}))},[He,kt.length]),p.useEffect(()=>{try{localStorage.setItem(sn,JSON.stringify(st))}catch{}},[st,sn]),p.useEffect(()=>{try{localStorage.setItem(la,JSON.stringify(nr))}catch{}},[nr,la]);const mr=p.useMemo(()=>{const le=st.map(et=>xe[et]?.hora_inicio||"06:00:00").map(et=>{const[_e,St]=String(et).split(":").map(Number);return(_e||0)*60+(St||0)});if(!le.length)return oC;const we=Math.min(...le);return Math.floor(we/60)},[st,xe]),Zr=p.useMemo(()=>{const le=st.map(et=>xe[et]?.hora_fim||"24:00:00").map(et=>{const[_e,St]=String(et).split(":").map(Number);return(_e===0&&St===0?24:_e||0)*60+(St||0)});if(!le.length)return I3;const we=Math.max(...le);return Math.ceil(we/60)},[st,xe]);p.useEffect(()=>{try{Vt.current=mr}catch{}},[mr]),p.useEffect(()=>{try{qt.current=Zr}catch{}},[Zr]),p.useEffect(()=>{const le=new Date,we=Wd(le),et=Hd(le);setTimeout(()=>{if(!Hn.current)return;const St=Math.max(0,(we-mr)*60+et)/Cs;Hn.current.scrollTop=Math.max(0,St*jl-120)},150)},[mr]);const _r=({booking:le,courtGridStart:we,courtGridEnd:et})=>{const _e=jl,St=Kt=>{const Hr=Wd(Kt),hn=Hd(Kt);return Hr===0&&hn===0?1440:Hr*60+hn},tt=St(le.start),Ne=St(le.end),Mt=we!==void 0?we:Nr?kn.start*60:mr*60,Qe=et!==void 0?et:Nr?kn.end*60:Zr*60,ar=tt-Mt,Sn=(Qe-Mt)/Cs;let wn=Math.floor(ar/Cs);const $n=Math.max(0,Ne-tt),En=Math.max(1,Math.ceil($n/Cs));let pa=wn+En;wn=Math.max(0,Math.min(wn,Sn-1)),pa=Math.max(0,Math.min(pa,Sn)),pa<=wn&&(pa=wn+1),pa=Math.min(pa,Sn);const rs=wn*_e;let Ys=(pa-wn)*_e;const ea=tl[le.status]||tl.confirmed,na=ea.icon,ya=ea.border,Wa=En===1,is=Wa?4:EZe,Ns=rs+is,ss=Math.max(Wa?40:32,Ys-is*2),ro=$n>=90,xl=2,D=1.15,X=ro?(()=>{const Kt=Math.min(Math.max(($n-90)/90,0),1);return Math.min(D+Kt*(xl-D),xl)})():1,Pe=16,rt=14,Le=Wa?16:24,Tt=Math.round(Pe*(ro?X:1)),Ot=Math.round(rt*(ro?X:1)),Rt=Math.round(Le*(ro?X:1)),yt=ht[le.id]||[],Ge=yt.filter(Kt=>String(Kt.status_pagamento||"").toLowerCase()==="pago").length,Jt=yt.length;return a.jsxs(Fr.div,{layout:ze?!1:"position",initial:ze?!1:{opacity:0,y:6},animate:ze?!1:{opacity:1,y:0},exit:ze?!1:{opacity:0,y:6},id:`booking-${le.id}`,className:Pr("absolute left-2 right-2 rounded-md border-2 bg-surface text-sm shadow-sm z-0 cursor-pointer",ya,"overflow-hidden transition-all duration-150 hover:bg-surface-2 hover:shadow-md"),style:{top:`${Ns}px`,height:`${ss}px`},onClick:async()=>{const Kt=$r(le),Hr=new Promise(xr=>setTimeout(xr,600));let hn=null;try{hn=await Promise.race([Kt,Hr])}catch{}const An=hn&&hn.booking||on.find(xr=>xr.id===le.id)||le;try{const xr=ht[le.id]||[];console.log("[ORDER:CLICK] booking",{id:le.id,customer:An?.customer||le.customer,partsCount:xr.length}),xr.length>0&&console.table(xr.map((Tr,jn)=>({idx:jn+1,ordem:Tr?.ordem,nome:Tr?.nome,cliente_id:Tr?.cliente_id}))),console.log("[ORDER:CLICK] agendamento.clientes",An?.clientes??"(sem campo clientes)")}catch{}cr(An),Pt()},children:[a.jsx("div",{className:Pr("absolute left-0 top-0 h-full w-[6px] rounded-l-md",ea.accent)}),a.jsxs(Fr.div,{className:"flex-1 flex flex-col overflow-hidden pl-4 pr-3 py-2.5 md:pr-4 md:py-3",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[a.jsx("p",{className:"font-semibold text-text-primary truncate text-base",style:{fontSize:Tt,lineHeight:1.15},children:bU(le.customer)}),Wa&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded-md px-2 py-0.5 whitespace-nowrap shadow-md",style:{fontSize:Ot},children:le.modality})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("span",{className:Pr("text-text-muted font-semibold text-base whitespace-nowrap"),style:{fontSize:Tt},children:[dr(le.start,"HH:mm"),"",dr(le.end,"HH:mm")]}),Wa&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(na,{className:Pr(ea.text),style:{width:Rt,height:Rt}}),a.jsx("span",{className:Pr("truncate font-semibold",ea.text,"text-base"),style:{fontSize:Tt},children:ea.label})]}),Wa&&Jt>0&&a.jsxs("span",{className:`text-xs font-semibold rounded-full px-2 py-0.5 border ${Ge===Jt?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"}`,style:{fontSize:Math.max(11,Math.round(11*(ro?X:1)))},children:[Ge,"/",Jt]})]}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2 flex-wrap",children:[!Wa&&a.jsx("span",{className:"text-xs font-bold text-white truncate bg-gradient-to-r from-slate-700 to-slate-800 border border-slate-600/60 rounded-md px-2.5 py-1 shadow-md",style:{fontSize:Ot},children:le.modality}),!Wa&&a.jsxs("div",{className:"flex items-center gap-1.5 text-base flex-wrap justify-end",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(na,{className:Pr(ea.text),style:{width:Rt,height:Rt}}),a.jsx("span",{className:Pr("truncate font-semibold",ea.text),style:{fontSize:Tt},children:(()=>typeof window<"u"&&window.innerWidth<768&&le.status==="in_progress"?"Andamento":ea.label)()})]}),Jt>0&&(()=>{const Kt=typeof window<"u"&&window.innerWidth<768;return a.jsxs("span",{className:Pr("font-bold rounded-full border flex items-center gap-1 whitespace-nowrap",Wa?"px-2 py-0.5 text-xs":"px-2.5 py-1 text-sm",Ge===Jt?"text-emerald-300 bg-emerald-500/10 border-emerald-400/30":"text-amber-300 bg-amber-500/10 border-amber-400/30"),style:{fontSize:Math.max(Wa?11:13,Math.round((Wa?11:13)*(ro?X:1)))},children:[a.jsx(Wi,{className:"w-3 h-3 flex-shrink-0"}),a.jsxs("span",{className:"whitespace-nowrap",children:[Ge,"/",Jt,Kt?"":" pagos"]})]})})()]})]})]})]})},Br=()=>{p.useRef(Math.random().toString(36).slice(2)),qN();const le=p.useRef(0),we=p.useRef(""),et=$e=>{if(!$e)return"";if(typeof $e=="string")return $e;const mt=$e.nome||$e.name||"",$t=$e.codigo??$e.code;return $t!=null?`[${$t}] ${mt}`:mt},_e=$e=>$e?typeof $e=="string"?$e:$e.nome||$e.name||"":"",St=$e=>{const mt=xe[$e];if(!mt)return{start:mr*60,end:Zr*60};const[$t,Zt]=String(mt.hora_inicio||"06:00:00").split(":").map(Number),[vr,tn]=String(mt.hora_fim||"24:00:00").split(":").map(Number),Pn=vr===0&&tn===0?24:vr;return{start:$t*60+(Zt||0),end:Pn*60+(tn||0)}},tt=()=>{const $e=Wd(new Date),mt=Hd(new Date),$t=$e*60+mt,Zt=kt[0]||"",vr=St(Zt);return Math.max(vr.start,Math.min(vr.end-Cs,Math.round($t/Cs)*Cs))},[Ne,Mt]=p.useState(()=>{let $e=[];try{if(Array.isArray(Rt)&&Rt.length>0?$e=Rt:Array.isArray(Le.current)&&Le.current.length>0&&($e=Le.current),$e.length>0)try{ar.current=!0}catch{}}catch{}return{selectedClients:$e,court:(()=>kt.find(Zt=>!me[Zt]||me[Zt].funciona)||kt[0]||"")(),modality:Kp[0],status:"scheduled",date:k,startMinutes:tt(),endMinutes:tt()+60}}),Qe=p.useRef([]),ar=p.useRef(!1),Sn=p.useRef(null);p.useEffect(()=>{Qe.current=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[];try{(Qe.current||[]).length>0&&(ar.current=!0)}catch{}},[Ne.selectedClients]);const[wn,$n]=p.useState(!1),[En,pa]=p.useState(""),rs=p.useRef(""),Ys=p.useRef(""),ea=p.useCallback($e=>{try{rs.current=String($e||""),Ys.current=new Error("selectedClients:set").stack||""}catch{}},[]),na=p.useRef(!1);p.useEffect(()=>{try{if(!ze||!Fe?.id||na.current)return;const $e=ht[Fe.id]||[];if(!Array.isArray($e)||$e.length===0)return;const mt=$e.map(vr=>({id:vr.cliente_id,nome:vr.nome,codigo:vr.codigo??null})),$t=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[];if(!($t.length===mt.length&&$t.every((vr,tn)=>vr&&mt[tn]&&vr.id===mt[tn].id))){try{ea("edit:apply-from-participants")}catch{}Mt(vr=>({...vr,selectedClients:mt}));try{Le.current=mt}catch{}try{Ge(mt)}catch{}try{ar.current=!0}catch{}try{da.current=Date.now()+1500}catch{}try{console.log("[ORDER:OPEN_MODAL] chips (aplicados)",mt.map(vr=>vr.nome)),console.table($e.map((vr,tn)=>({idx:tn+1,ordem:vr?.ordem,nome:vr?.nome,cliente_id:vr?.cliente_id})))}catch{}}na.current=!0}catch{}},[ze,Fe?.id,ht]),p.useEffect(()=>{try{if(!ze)return;const $e=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[];if($e.length>0&&console.log("[ORDER:CHIPS] atual:",$e.map(mt=>mt.nome)),Fe?.id){const mt=Array.isArray(ht?.[Fe.id])?ht[Fe.id]:[],$t=mt.map(tn=>String(tn?.cliente_id??"")),Zt=$e.map(tn=>String(tn?.id??""));if($t.length>0&&$t.join("|")!==Zt.join("|")){console.warn("[ORDER:CHIPS][MISMATCH]",{bookingId:Fe.id,ref:mt.map(tn=>({ordem:tn?.ordem,nome:tn?.nome,id:tn?.cliente_id})),cur:$e.map((tn,Pn)=>({idx:Pn+1,nome:tn?.nome,id:tn?.id})),lastReason:rs.current});try{console.warn(Ys.current)}catch{}}}}catch{}},[ze,Ne.selectedClients,Fe?.id,ht]);const[ya,Wa]=p.useState(0),Ea=p.useRef(0),is=p.useRef(!1);p.useEffect(()=>{const $e=()=>{try{if(document.visibilityState==="hidden"){is.current=!!(Wn||wn);const mt=Date.now();try{da.current=mt+1200}catch{}try{Lr.current=mt+1200}catch{}try{Ea.current=mt+800}catch{}}else if(document.visibilityState==="visible"){const mt=is.current;is.current=!1;const $t=Date.now();try{da.current=Math.max(da.current||0,$t+600)}catch{}try{Lr.current=Math.max(Lr.current||0,$t+600)}catch{}try{Ea.current=Math.max(Ea.current||0,$t+400)}catch{}mt&&!jt.current&&setTimeout(()=>{jt.current||($n(!0),ln(!0))},60)}}catch{}};return document.addEventListener("visibilitychange",$e),()=>document.removeEventListener("visibilitychange",$e)},[Wn,wn,ze]),p.useEffect(()=>{},[wn,Wn]);const Ns=p.useRef(0);p.useEffect(()=>{const $e=Array.isArray(Ne.selectedClients)?Ne.selectedClients.length:-1,mt=Ns.current;$e!==mt&&(Ns.current=$e)},[Ne.selectedClients,wn,Wn]);const[ss,ro]=p.useState(!1),[xl,D]=p.useState(null),[X,Pe]=p.useState(!1),rt=p.useRef(!1),Le=p.useRef([]),Tt=p.useRef("init"),Ot=p.useRef(!1),[Rt,yt]=p.useState([]),Ge=p.useCallback($e=>{yt($e)},[]),Jt=p.useRef(null),Kt=p.useRef(null),Hr=p.useRef([]);p.useEffect(()=>{Wn&&Hr.current[ya]&&Hr.current[ya]?.scrollIntoView({behavior:"smooth",block:"nearest"})},[ya,Wn]),p.useEffect(()=>{Wn&&Wa(0)},[Wn]);const[hn,An]=p.useState(!1),[xr,Tr]=p.useState(!1);p.useState(!1);const[jn,fa]=p.useState(!1);p.useEffect(()=>{if(!s)return;let $e=!1;return(async()=>{try{if(!M||!A?.codigo_empresa)return;const mt=await Fh({somenteAtivas:!0,codigoEmpresa:A.codigo_empresa});$e||b(Array.isArray(mt)?mt:[])}catch{}})(),()=>{$e=!0}},[s,M,A?.codigo_empresa]),p.useEffect(()=>{if(!s||!Array.isArray(y)||y.length===0)return;const $e=String(y[0].id);x(mt=>mt.length===0&&Array.isArray(Ne.selectedClients)&&Ne.selectedClients.length>0?Ne.selectedClients.map(vr=>({cliente_id:vr.id,nome:vr.nome,valor_cota:"",status_pagamento:"Pendente",finalizadora_id:$e})):mt.map(Zt=>({...Zt,finalizadora_id:Zt.finalizadora_id&&Zt.finalizadora_id!==""?Zt.finalizadora_id:$e})))},[s,y]);const qn=p.useCallback(($e,mt)=>{try{const $t=Date.now(),Zt=$t<(Ni.current||0)||$t<(Lr.current||0),vr=!Wn,tn=!!Ot.current;let Pn=Array.isArray(mt)?mt:[];if(Pn.length===0&&vr&&Zt&&!tn){const Cn=Array.isArray(Le.current)?Le.current:[];Cn.length>0&&(Pn=Cn)}try{if(!Fe&&Array.isArray(Pn)&&Pn.length>0&&Sn.current){const Cn=Pn.findIndex(qa=>qa&&qa.id===Sn.current);Cn>0&&(Pn=[Pn[Cn],...Pn.filter((Ts,fs)=>fs!==Cn)])}}catch{}try{ea(`applySelectedClients:${$e}`)}catch{}Mt(Cn=>({...Cn,selectedClients:Pn})),Array.isArray(Pn)&&Pn.length>0&&(Le.current=Pn,Ge(Pn),Ot.current=!1);try{Tt.current=$e}catch{}}catch{}},[Wn,Mt,Ge]);p.useState(""),p.useRef(null),p.useEffect(()=>{try{Nt.current=Date.now()}catch{}},[wn,xr]),p.useEffect(()=>{if(w){if(Cr.current=wn,wn)S("customer-picker",6e3),C("picker:open"),un.current=!0,ln(!0);else if(C("picker:close"),E("picker-close"),rn.current){rn.current=!1;try{j("Picker closed: flushing pending refresh"),C("picker:flush"),Nn()}catch{}}}},[wn]);const Fa=p.useCallback(($e,mt={})=>{if(w)try{const $t=new Date().toISOString(),Zt=er.current,vr=!!un.current,tn=!!rt.current}catch{}},[w,ze,wn,Wn,xr,ss]);p.useEffect(()=>{w&&Fa("state-change",{isCustomerPickerOpen:wn,effectiveCustomerPickerOpen:Wn})},[w,wn,Wn]),p.useEffect(()=>{if(!ze||Wn)return;const $e=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[],mt=Array.isArray(Le.current)?Le.current:[],$t=Date.now()<(da.current||0);if($e.length===0&&mt.length>0&&!Ot.current&&$t)Tt.current="global:restore",Mt(Zt=>({...Zt,selectedClients:mt}));else if($e.length===0&&mt.length>0&&Ot.current&&!$t)try{Le.current=[]}catch{}},[ze,Wn,Ne.selectedClients]),p.useEffect(()=>{if(!ze)return;let $e=un.current;try{const $t=localStorage.getItem("agenda:customerPicker:desiredAt");if($t){const Zt=Number($t);Number.isFinite(Zt)&&Date.now()-Zt<3e3&&($e=!0)}}catch{}if(!$e||wn||Date.now()<Lr.current||ee())return;const mt=Date.now();mt-ra.current<800||(ra.current=mt,er.current="open",$n(!0),ln(!0))},[wn,ze]),p.useEffect(()=>{const $e=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[];$e.length>0&&(Le.current=$e,Ge($e))},[Ne.selectedClients]),p.useEffect(()=>{if(!ze||Wn||un.current)return;const $e=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[],mt=(()=>{const $t=Array.isArray(Le.current)?Le.current:[];return $t&&$t.length>0?$t:[]})();$e.length===0&&mt.length>0&&!Ot.current&&(Mt($t=>({...$t,selectedClients:mt})),rt.current=!1)},[Wn,ze]);const ps=p.useRef(0);p.useEffect(()=>{try{const $e=Date.now(),mt=Array.isArray(Qe.current)?Qe.current:[],$t=Array.isArray(Le.current)?Le.current:[];if($e-ps.current>300&&(ps.current=$e),ze&&!Wn&&mt.length===0&&$t.length>0&&!Ot.current){try{Ni.current=Date.now()+2e3}catch{}try{const Zt=Lr?.current||0,vr={ts:new Date().toISOString(),reason:"empty-after-close",modalOpen:ze,pickerOpen:Wn,formLen:Array.isArray(Ne?.selectedClients)?Ne.selectedClients.length:NaN,curLen:mt.length,lastLen:$t.length,clearedByUser:!!Ot?.current,lastAction:Tt?.current,chipsLen:Array.isArray(Rt)?Rt.length:NaN,clientsLoading:!!xr,suppressUntil:Zt}}catch{}Ge($t),Mt(Zt=>({...Zt,selectedClients:[...$t]}));try{Promise.resolve().then(()=>{Mt(Zt=>({...Zt,selectedClients:[...Le.current]}))})}catch{}try{requestAnimationFrame(()=>{Mt(Zt=>({...Zt,selectedClients:[...Le.current||[]]}))})}catch{}setTimeout(()=>{const Zt=Array.isArray(Qe.current)?Qe.current:[],vr=Array.isArray(Le.current)?Le.current:[];Zt.length===0&&vr.length>0&&Mt(tn=>({...tn,selectedClients:[...vr]}))},25),setTimeout(()=>{const Zt=Array.isArray(Qe.current)?Qe.current:[],vr=Array.isArray(Le.current)?Le.current:[];Zt.length===0&&vr.length>0&&Mt(tn=>({...tn,selectedClients:[...vr]}))},120),setTimeout(()=>{const Zt=Array.isArray(Qe.current)?Qe.current:[],vr=Array.isArray(Le.current)?Le.current:[];Zt.length===0&&vr.length>0&&Mt(tn=>({...tn,selectedClients:[...vr]}))},240)}}catch{}},[Ne.selectedClients,Wn,ze]),p.useEffect(()=>{try{const $e=now<(Ni.current||0),mt=Array.isArray(Qe.current)?Qe.current:[],$t=Array.isArray(Le.current)?Le.current:[],Zt=now<(da.current||0);if(ze&&!Wn&&($e||Zt)&&mt.length===0&&$t.length>0&&!Ot.current){yt($t),Mt(vr=>({...vr,selectedClients:[...$t]}));try{requestAnimationFrame(()=>Mt(vr=>({...vr,selectedClients:[...Le.current||[]]})))}catch{}setTimeout(()=>Mt(vr=>({...vr,selectedClients:[...Le.current||[]]})),32),setTimeout(()=>Mt(vr=>({...vr,selectedClients:[...Le.current||[]]})),96)}}catch{}},[Ne.selectedClients,Wn,ze]),p.useEffect(()=>{Date.now()<(Ie.current||0)},[Ne.selectedClients,ze,Wn]);const[La,xa]=p.useState([]);p.useEffect(()=>{s&&xa([])},[s]);const Ss=p.useRef(!1),js=p.useRef(!1),[Rs,Xn]=p.useState(null);p.useState(null);const ba=p.useRef(!1);p.useEffect(()=>{const $e=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[],mt=Rs,$t=mt&&$e.some(Zt=>Zt&&Zt.id===mt);if($e.length>0&&!$t){let Zt=$e[0]?.id||null;try{if(Fe?.id){const vr=ht?.[Fe.id]||[],tn=Array.isArray(vr)?vr.find(Pn=>Pn?.is_representante===!0):null;tn?.cliente_id&&$e.some(Pn=>String(Pn?.id)===String(tn.cliente_id))&&(Zt=tn.cliente_id)}}catch{}Xn(Zt)}else $e.length===0&&mt&&Xn(null)},[Ne.selectedClients,ze,Fe,ht]);const Ws=p.useRef(!1),Bs=p.useRef(!1),[oo,ed]=p.useState(Aa),Qi=p.useRef(0);p.useEffect(()=>{if(!(Date.now()<(Ie.current||0)))if(xr){Qi.current||(Qi.current=Date.now());const mt=setTimeout(()=>{xr&&(!Array.isArray(oo)||oo.length===0)&&Tr(!1)},2e3);return()=>clearTimeout(mt)}else Qi.current=0},[xr,oo]);const wa=p.useMemo(()=>Array.isArray(Ne.selectedClients)?Ne.selectedClients:[],[Ne.selectedClients]),Za=p.useMemo(()=>{const $e=wa||[];if($e.length===0)return"Adicionar clientes";const mt=$e[0]?.nome||"Cliente",$t=$e.length-1;return $t>0?`${mt} +${$t}`:mt},[wa]),xo=p.useMemo(()=>{const $e=Array.isArray(Ne.selectedClients)?Ne.selectedClients:[],mt=Array.isArray(Qe.current)?Qe.current:[],$t=Array.isArray(Le.current)?Le.current:[],Zt=Array.isArray(Rt)?Rt:[];return $e.length>0&&$e.every(vr=>vr?.nome)?$e:$e.length>0?$e.map(vr=>{if(vr?.nome)return vr;const tn=mt.find(Ts=>Ts?.id===vr?.id),Pn=$t.find(Ts=>Ts?.id===vr?.id),Cn=Zt.find(Ts=>Ts?.id===vr?.id),qa=(oo||[]).find(Ts=>Ts?.id===vr?.id);return{...vr,nome:tn?.nome||Pn?.nome||Cn?.nome||qa?.nome||vr?.nome||"Cliente"}}):mt.length>0&&mt.every(vr=>vr?.nome)?mt:Zt.length>0&&Zt.every(vr=>vr?.nome)?Zt:$t.length>0&&$t.every(vr=>vr?.nome)?$t:$e},[Ne.selectedClients,Rt,oo]),Zi=!!(ze&&Fe?.id&&!(Array.isArray(ht?.[Fe.id])&&ht[Fe.id].length>0));p.useEffect(()=>{if(!(Date.now()<(Ie.current||0)))try{j("Chips:effective change",{effectiveLen:Array.isArray(wa)?wa.length:0,formLen:Array.isArray(Ne.selectedClients)?Ne.selectedClients.length:0,lastLen:Array.isArray(Le.current)?Le.current.length:0,pickerOpen:wn})}catch{}},[wa,Ne.selectedClients,wn]);const td=p.useRef(null),rm=p.useRef(!1);p.useEffect(()=>{if(ze){Array.isArray(Aa)&&Aa.length>0&&ed(Aa);try{if(!oo||oo.length===0){const $e=A?.codigo_empresa?`clientes:list:${A.codigo_empresa}`:null;if($e){const mt=JSON.parse(localStorage.getItem($e)||"[]");Array.isArray(mt)&&mt.length>0&&ed(mt)}}}catch{}}},[ze,Aa]),p.useEffect(()=>{ze||(td.current=null,Tr(!1))},[ze]),p.useEffect(()=>{ze||(Ss.current=!1,js.current=!1,fa(!1),Bs.current=!1)},[ze]);const Pu=p.useRef(!1);p.useEffect(()=>{if(ze&&!Pu.current?Pu.current=!0:!ze&&Pu.current,Fe)Yl.current=!1;else{if(Yl.current)return;Yl.current=!0;try{if(Date.now()<(le.current||0))return}catch{}try{un.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{Ot.current=!1}catch{}try{try{Le.current=[]}catch{}try{yt([])}catch{}Mt($e=>({...$e,selectedClients:[]}))}catch{}}},[ze,Fe]);const Yl=p.useRef(!1);p.useEffect(()=>{if(!ze){Yl.current=!1;try{we.current="";try{Le.current=[]}catch{}try{yt([])}catch{}try{ar.current=!1}catch{}try{le.current=0}catch{}try{da.current=0}catch{}ir(!1),sa(4);try{Lr.current=0}catch{}try{er.current=null}catch{}try{un.current=!1}catch{}Mt($e=>({...$e,selectedClients:[]})),Xn(null)}catch{}return}if(Fe)Yl.current=!1;else{if(Yl.current)return;Yl.current=!0;try{if(Date.now()<(le.current||0))return}catch{}try{un.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{Ot.current=!1}catch{}try{try{Le.current=[]}catch{}try{yt([])}catch{}Mt($e=>({...$e,selectedClients:[]}))}catch{}}},[ze,Fe]);const Tl=p.useCallback(async($e={})=>{const{autoSave:mt=!1}=$e;if(!jn){fa(!0);try{const $t=xe[Ne.court];if(!$t){t({title:"Selecione uma quadra",variant:"destructive"}),Ss.current=!1,js.current=!1;return}const Zt=Ne.startMinutes,vr=Ne.endMinutes;if(!(Number.isFinite(Zt)&&Number.isFinite(vr)&&vr>Zt)){t({title:"Horrio invlido",variant:"destructive"}),Ss.current=!1,js.current=!1;return}if(!yf(Zt,vr)){t({title:"Conflito de horrio",description:"O horrio selecionado est ocupado.",variant:"destructive"}),Ss.current=!1,js.current=!1;return}const Pn=(Ps,bo)=>new Date(Ps.getFullYear(),Ps.getMonth(),Ps.getDate(),Math.floor(bo/60),bo%60,0,0),Cn=Pn(Ne.date,Zt),qa=Pn(Ne.date,vr);let Ts=Array.isArray(Ne.selectedClients)&&Ne.selectedClients.length>0?Ne.selectedClients:Array.isArray(Qe.current)?Qe.current:[];if((!Ts||Ts.length===0)&&Fe?.id)try{const Ps=Array.isArray(Le.current)?Le.current:[];Ps&&Ps.length>0&&(Ts=Ps,Mt(bo=>({...bo,selectedClients:Ps})))}catch{}const fs=[...Ts];console.log(" [FIX] selNowSnapshot criado:",fs.length,"participantes"),console.log(" [FIX] form.selectedClients:",Ne.selectedClients?.length||0),console.log(" [FIX] editingBooking.id:",Fe?.id),console.log(" [LOG 3 - FECHAR MODAL AGENDAMENTO] Estado ao salvar:"),console.log("   Participantes selecionados:",fs.length),fs.forEach((Ps,bo)=>{console.log(`   #${bo+1}: ${Ps.nome}`)}),console.log("   participantsForm (contexto):",(m||[]).length),(m||[]).forEach((Ps,bo)=>{console.log(`   #${bo+1}: ${Ps.nome} | Status: ${Ps.status_pagamento} | Valor: ${Ps.valor_cota}`)});let ga=fs,Ci=!1,vl=!1;if(Fe?.id){const Ps=ht[Fe.id]||[],bo=ue=>String(ue||"").trim().toLowerCase(),nd=Ps.map(ue=>`${String(ue?.cliente_id??"")}::${bo(ue?.nome)}`),oi=fs.map(ue=>`${String(ue?.id??"")}::${bo(ue?.nome)}`),N=nd.join("|"),P=oi.join("|");vl=N!==P;const $=[...nd].sort().join("|"),K=[...oi].sort().join("|");Ci=$!==K,console.log(" [DEBUG] Comparao de ordem:"),console.log("   ordemAtual:",P),console.log("   ordemBanco:",N),console.log("   mudouOrdem:",vl),console.log("   mudouParticipantes:",Ci)}const Dl=Ci||vl;let zd=0;(!Number.isFinite(zd)||zd<0||zd>=(ga||[]).length)&&(zd=0);const Zl=ga[0],Ud=ga.map(_e).filter(Boolean);if(!Fe?.id&&!Zl?.id){t({title:"Selecione um cliente",description:"Para criar um agendamento, selecione pelo menos um cliente.",variant:"destructive"});return}if(Fe?.id){const Ps=Fe.status,bo=Ne.status!==Ps,nd={quadra_id:$t.id,cliente_id:Zl?.id??null,clientes:Ud,inicio:Cn.toISOString(),fim:qa.toISOString(),modalidade:Ne.modality};if(!bo){let ve=Ne.status;try{const ye=de(),Se=Cn.getTime();if(!!Os?.autoConfirmEnabled&&Number.isFinite(Number(Os?.autoConfirmMinutesBefore))){const Be=Number(Os.autoConfirmMinutesBefore)*6e4,dt=Se-Be;ve==="confirmed"&&ye<dt?ve="scheduled":ve==="scheduled"&&ye>=dt&&(ve="confirmed")}}catch{}nd.status=ve}const{error:oi}=await Q.from("agendamentos").update(nd).eq("codigo_empresa",A.codigo_empresa).eq("id",Fe.id);if(oi)throw oi;const{data:N}=await Q.from("agendamento_participantes").select("*").eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0}),P=N||[],$=(P||[]).some(ve=>{const ye=Number(ve?.valor_cota)||0,Se=ve?.status_pagamento||"Pendente";return ye>0||Se==="Pago"});if(console.log(" [SAVE-BOOKING] houveMudancaDeParticipantes:",Ci),console.log(" [SAVE-BOOKING] currentArray.length:",P.length),console.log(" [SAVE-BOOKING] selNowFinal.length:",ga.length),console.log(" [SAVE-BOOKING] hasPayments:",$),Dl)if(!ga||ga.length===0)console.error(" [SAVE-BOOKING] PROTEO ACIONADA: No vou deletar participantes com selNowFinal vazio!"),console.error(" [SAVE-BOOKING] Isso evita perda de dados. Verifique por que selNowFinal est vazio.");else if($){try{const je=(P||[]).map(Be=>Be?.id).filter(Boolean);if(je.length>0){const{error:Be}=await Q.from("agendamento_participantes").update({ordem:null,is_representante:!1}).in("id",je).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id).is("deleted_at",null);Be&&console.error("Erro ao liberar ordens antes do update (com pagamentos):",Be)}}catch(je){console.error("Erro inesperado ao liberar ordens antes do update (com pagamentos):",je)}const ve=new Map;try{(P||[]).forEach(je=>{const Be=String(je?.cliente_id??""),dt=ve.get(Be)||[];dt.push(je),ve.set(Be,dt)})}catch{}const ye=new Map,Se=new Set;for(let je=0;je<ga.length;je++){const Be=ga[je];if(!Be?.id)continue;const dt=String(Be.id),tr=ye.get(dt)||0,_t=(ve.get(dt)||[])[tr]||null;if(ye.set(dt,tr+1),_t?.id){Se.add(_t.id);const Xt={cliente_id:Be.id,nome:_t.nome??Be.nome,ordem:je+1,is_representante:je===zd,deleted_at:null},{error:Mr}=await Q.from("agendamento_participantes").update(Xt).eq("id",_t.id).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id);Mr&&console.error("Erro ao atualizar participante (com pagamentos):",Mr)}else{const Xt={codigo_empresa:A.codigo_empresa,agendamento_id:Fe.id,cliente_id:Be.id,nome:Be.nome,ordem:je+1,valor_cota:0,status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1,pago_em:null,is_representante:je===zd,deleted_at:null},{error:Mr}=await Q.from("agendamento_participantes").insert([Xt]);Mr&&console.error("Erro ao inserir participante (com pagamentos):",Mr)}}try{const je=(P||[]).filter(Be=>Be?.id&&!Se.has(Be.id)).map(Be=>Be.id);if(je.length>0){const{error:Be}=await Q.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).in("id",je).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id);Be&&console.error("Erro ao remover participantes (com pagamentos):",Be)}}catch{}}else{const ve=Math.min(P.length,ga.length);try{const ye=(P||[]).map(Se=>Se?.id).filter(Boolean);if(ye.length>0){const{error:Se}=await Q.from("agendamento_participantes").update({ordem:null,is_representante:!1}).in("id",ye).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id).is("deleted_at",null);Se&&console.error("Erro ao liberar ordens antes do update:",Se)}}catch(ye){console.error("Erro inesperado ao liberar ordens antes do update:",ye)}try{await Q.from("agendamento_participantes").update({is_representante:!1}).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id).is("deleted_at",null)}catch{}for(let ye=0;ye<ve;ye++){const Se=P[ye],je=ga[ye];if(!Se?.id||!je?.id)continue;const Be=String(Se.cliente_id)===String(je.id),dt={cliente_id:je.id,nome:je.nome,ordem:ye+1,is_representante:!1,deleted_at:null};Be||(dt.valor_cota=0,dt.status_pagamento="Pendente",dt.finalizadora_id=null,dt.aplicar_taxa=!1,dt.pago_em=null);const{error:tr}=await Q.from("agendamento_participantes").update(dt).eq("id",Se.id).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id);tr&&console.error("Erro ao atualizar participante:",tr)}if(ga.length<P.length){const ye=P.slice(ga.length).map(Se=>Se?.id).filter(Boolean);if(ye.length>0){const{error:Se}=await Q.from("agendamento_participantes").update({deleted_at:new Date().toISOString(),is_representante:!1}).in("id",ye).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id);Se&&console.error("Erro ao remover participantes:",Se)}}if(ga.length>P.length){const ye=P.length,Se=ga.slice(ye).map((je,Be)=>({codigo_empresa:A.codigo_empresa,agendamento_id:Fe.id,cliente_id:je.id,nome:je.nome,ordem:ye+Be+1,valor_cota:0,status_pagamento:"Pendente",finalizadora_id:null,aplicar_taxa:!1,pago_em:null,is_representante:!1,deleted_at:null}));if(Se.length>0){const{error:je}=await Q.from("agendamento_participantes").insert(Se);je&&console.error("Erro ao inserir participantes:",je)}}try{const ye=zd+1;if(Number.isFinite(ye)&&ye>0){const{error:Se}=await Q.from("agendamento_participantes").update({is_representante:!0}).eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id).eq("ordem",ye).is("deleted_at",null);Se&&console.error("Erro ao marcar representante:",Se)}}catch{}}const K=Zl?.nome||Zl?.name||_e(Zl)||Ud[0]||Fe.customer,ue={...Fe,court:Ne.court,customer:K,start:Cn,end:qa,modality:Ne.modality,...bo?{}:{status:nd.status??Ne.status}};if(cn(ve=>ve.map(ye=>ye.id===Fe.id?ue:ye)),cr(ue),bo)try{xt(!1),await yr(Fe.id,Ne.status,"user")}catch{}if(mt||t({title:"Agendamento atualizado"}),js.current=!0,Ss.current=!1,!$||Dl){const ve=new Map;try{(P||[]).forEach(je=>{const Be=String(je?.cliente_id??""),dt=ve.get(Be)||[];dt.push(je),ve.set(Be,dt)})}catch{}const ye=new Map,Se=ga.map((je,Be)=>{const dt=String(je?.id??""),tr=ye.get(dt)||0,_t=(ve.get(dt)||[])[tr]||null;ye.set(dt,tr+1);const Xt=!!_t;return{cliente_id:je.id,nome:je.nome,codigo:je.codigo||null,valor_cota:Xt?_t.valor_cota??0:0,status_pagamento:Xt?_t.status_pagamento??"Pendente":"Pendente",finalizadora_id:Xt?_t.finalizadora_id??null:null,aplicar_taxa:Xt?_t.aplicar_taxa??!1:!1,ordem:Be+1,is_representante:Be===zd,deleted_at:null}});Xr(je=>({...je,[Fe.id]:Se})),console.log(" [FIX] houveMudancaDeParticipantes =",Ci),Ci?(console.log(" [FIX] Mudana de participantes detectada - reconstruindo participantsForm"),x(Se.map(je=>({cliente_id:je.cliente_id,nome:je.nome,codigo:je.codigo,valor_cota:je.valor_cota?Gp(String(Number(je.valor_cota).toFixed(2))):"",status_pagamento:je.status_pagamento,finalizadora_id:je.finalizadora_id?String(je.finalizadora_id):y?.[0]?.id?String(y[0].id):null,aplicar_taxa:je.aplicar_taxa})))):(console.log(" [FIX] Sem mudana de participantes - preservando dados de pagamento do contexto"),x(je=>{const Be=Array.isArray(je)?je:[],dt=new Map;try{Be.forEach(_t=>{const Xt=String(_t?.cliente_id??""),Mr=dt.get(Xt)||[];Mr.push(_t),dt.set(Xt,Mr)})}catch{}const tr=new Map,Ke=Se.map(_t=>{const Xt=String(_t?.cliente_id??""),Mr=tr.get(Xt)||0,Wr=(dt.get(Xt)||[])[Mr]||null;return tr.set(Xt,Mr+1),Wr?{cliente_id:_t.cliente_id,nome:Wr.nome||_t.nome,codigo:Wr.codigo??_t.codigo,valor_cota:Wr.valor_cota||_t.valor_cota,status_pagamento:Wr.status_pagamento||_t.status_pagamento,finalizadora_id:Wr.finalizadora_id??_t.finalizadora_id,aplicar_taxa:Wr.aplicar_taxa??_t.aplicar_taxa}:_t});return console.log(" [FIX] Dados de pagamento preservados:",Ke),Ke.length>0?Ke:Se})),console.log(" [LOG 3 - RESULTADO FINAL] participantsForm aps atualizao:"),console.log("   Total:",Se.length),Se.forEach((je,Be)=>{console.log(`   #${Be+1}: ${je.nome} | Status: ${je.status_pagamento} | Valor: ${je.valor_cota}`)})}if(r().catch(ve=>{console.error("[AgendaPage] Erro ao recarregar alertas:",ve)}),!mt){try{Le.current=[]}catch{}try{yt([])}catch{}xt(!1)}return}let nm=null;try{const{data:Ps}=await Q.from("agendamentos").select("id, status, codigo").eq("codigo_empresa",A.codigo_empresa).eq("quadra_id",$t.id).eq("inicio",Cn.toISOString()).eq("fim",qa.toISOString()).limit(1);Array.isArray(Ps)&&Ps.length>0&&(nm=Ps[0])}catch{}if(nm?.id&&nm.status!=="canceled"){const Ps={id:nm.id,code:nm.codigo,court:Ne.court,customer:Zl?.nome||Ud[0]||"",start:Cn,end:qa,status:Ne.status,modality:Ne.modality};cn(bo=>bo.some(oi=>oi.id===nm.id)?bo:[...bo,Ps]),t({title:"Agendamento confirmado"}),js.current=!0,xt(!1);return}if(rr&&jr>1){const Ps=[],bo=[];for(let P=0;P<jr;P++){const $=Es(Ne.date,P*7),K=new Date($);K.setHours(Math.floor(Ne.startMinutes/60),Ne.startMinutes%60,0,0);const ue=new Date($);ue.setHours(Math.floor(Ne.endMinutes/60),Ne.endMinutes%60,0,0),Ps.push({codigo_empresa:A.codigo_empresa,quadra_id:$t.id,cliente_id:Zl?.id??null,clientes:Ud,inicio:K.toISOString(),fim:ue.toISOString(),modalidade:Ne.modality,status:Ne.status})}const{data:nd,error:oi}=await Q.from("agendamentos").insert(Ps).select("id, codigo, inicio, fim");if(oi)throw oi;const N=[];for(const P of nd){const $=ga.map((K,ue)=>({codigo_empresa:A.codigo_empresa,agendamento_id:P.id,cliente_id:K.id,nome:K.nome,valor_cota:0,status_pagamento:"Pendente",ordem:ue+1}));N.push(...$),bo.push({id:P.id,code:P.codigo,court:Ne.court,customer:Zl?.nome||Ud[0]||"",start:new Date(P.inicio),end:new Date(P.fim),status:Ne.status,modality:Ne.modality})}N.length>0&&await Q.from("agendamento_participantes").insert(N),cn(P=>[...P,...bo]),t({title:`${jr} Agendamentos criados!`,description:"Agendamentos recorrentes criados com sucesso.",variant:"success"}),ir(!1),sa(4)}else{const{data:Ps,error:bo}=await Q.from("agendamentos").insert({codigo_empresa:A.codigo_empresa,quadra_id:$t.id,cliente_id:Zl?.id??null,clientes:Ud,inicio:Cn.toISOString(),fim:qa.toISOString(),modalidade:Ne.modality,status:Ne.status}).select("id, codigo").single();if(bo)throw bo;const nd={id:Ps.id,code:Ps.codigo,court:Ne.court,customer:Zl?.nome||Ud[0]||"",start:Cn,end:qa,status:Ne.status,modality:Ne.modality};cn(oi=>[...oi,nd]),t({title:"Agendamento criado",variant:"success",duration:2e3}),r().catch(oi=>{console.error("[AgendaPage] Erro ao recarregar alertas:",oi)});try{const oi=ga.map((N,P)=>({codigo_empresa:A.codigo_empresa,agendamento_id:Ps.id,cliente_id:N.id,nome:N.nome,valor_cota:0,status_pagamento:"Pendente",ordem:P+1,is_representante:P===0,deleted_at:null}));if(oi.length>0){const{error:N}=await Q.from("agendamento_participantes").insert(oi);if(!N){const P=oi.map($=>({agendamento_id:$.agendamento_id,cliente_id:$.cliente_id,nome:$.nome,codigo:ga.find(K=>K.id===$.cliente_id)?.codigo||null,valor_cota:$.valor_cota,status_pagamento:$.status_pagamento,ordem:$.ordem}));Xr($=>({...$,[Ps.id]:P}))}}}catch{}}js.current=!0,Ss.current=!1;try{Le.current=[]}catch{}try{yt([])}catch{}xt(!1)}catch($t){t({title:"Erro ao salvar agendamento",description:$t?.message||"Tentando novamente automaticamente",variant:"destructive"})}finally{fa(!1)}}},[jn,xe,Ne,Fe,A,yf,cn,t,xt,yr]),ky=p.useCallback(async()=>{if(!Fe?.id){xt(!1),cr(null),As(null),ba.current=!1,ir(!1),sa(4);return}try{await Tl({autoSave:!0})}catch($e){console.error(" [Close] Erro ao salvar ao fechar modal:",$e)}finally{try{Le.current=[]}catch{}try{yt([])}catch{}xt(!1),cr(null),As(null),ba.current=!1,ir(!1),sa(4)}},[Fe?.id,Tl,yt,cr,xt,As]);p.useEffect(()=>{const $e=async()=>{if(!ze||!A?.codigo_empresa)return;const mt=String(A.codigo_empresa);if(td.current!==mt)try{Tr(!0);try{const vr=`clientes:list:${A.codigo_empresa}`,tn=JSON.parse(localStorage.getItem(vr)||"[]");if(Array.isArray(tn)&&tn.length>0){ed(tn);try{Na(Pn=>JSON.stringify(Pn)===JSON.stringify(tn)?Pn:tn)}catch{}}}catch{}const{data:$t,error:Zt}=await Q.from("clientes").select("id, nome, codigo, email, telefone, status, codigo_empresa, is_consumidor_final").eq("codigo_empresa",A.codigo_empresa).eq("status","active").eq("flag_cliente",!0).order("nome",{ascending:!0});if(Zt){console.error("Falha ao carregar clientes:",Zt);return}if(Array.isArray($t)){if($t.length===0){let vr=0;try{const tn=`clientes:list:${A.codigo_empresa}`,Pn=JSON.parse(localStorage.getItem(tn)||"[]");vr=Array.isArray(Pn)?Pn.length:0}catch{}if(vr>0&&!rm.current){rm.current=!0,setTimeout($e,700);return}}rm.current=!1,td.current=mt,ed($t);try{const vr=`clientes:list:${A.codigo_empresa}`;localStorage.setItem(vr,JSON.stringify($t))}catch{}try{Na(vr=>JSON.stringify(vr)===JSON.stringify($t)?vr:$t)}catch{}}}catch{}finally{Tr(!1)}};$e()},[ze,A?.codigo_empresa]),p.useEffect(()=>{try{if(Fe?.id){const tn=Fe?.valor_total,Pn=Number(tn);if(tn!=null&&tn!==""&&Number.isFinite(Pn)){v(Gp(String(Pn.toFixed(2))));return}}}catch{}const $e=xe[Ne.court];if(!$e)return;const mt=Number($e.valor||0);if(!Number.isFinite(mt)||mt<=0)return;const $t=Math.max(0,Ne.endMinutes-Ne.startMinutes);if($t<=0)return;const Zt=$t/Cs,vr=Math.round(mt*Zt*100)/100;v(Gp(String(vr.toFixed(2))))},[xe,Ne.court,Ne.startMinutes,Ne.endMinutes]),p.useEffect(()=>{if(ze&&!Bs.current)if(Fe){const $e=Wd(Fe.start)*60+Hd(Fe.start),mt=Wd(Fe.end)*60+Hd(Fe.end),$t=(()=>{try{if((kt||[]).includes(Fe.court))return Fe.court;const Cn=Fe.court_id;if(Cn!=null){const qa=(J||[]).find(Ts=>String(Ts.id)===String(Cn));if(qa?.nome)return qa.nome}}catch{}return(kt||[])[0]||""})(),Zt=ht[Fe.id]||[],vr=Zt.filter(Cn=>Cn&&Cn.cliente_id).map(Cn=>({id:Cn.cliente_id,nome:Cn.nome,codigo:Cn.codigo||null})),tn=xe[$t]?.modalidades||Kp,Pn=tn.includes(Fe.modality)?Fe.modality:tn[0]||"";try{ea("edit:init-from-cache")}catch{}Mt({selectedClients:vr,court:$t,modality:Pn,status:Fe.status,date:Po(Fe.start),startMinutes:$e,endMinutes:mt}),Ws.current=!0,x(Zt.map(Cn=>({cliente_id:Cn.cliente_id,nome:Cn.nome,codigo:Cn.codigo,valor_cota:(()=>{const qa=Number.isFinite(Number(Cn.valor_cota))?Number(Cn.valor_cota):dm(Cn.valor_cota);return Gp(String((Number.isFinite(qa)?qa:0).toFixed(2)))})(),status_pagamento:Cn.status_pagamento||"Pendente",finalizadora_id:Cn.finalizadora_id||null,aplicar_taxa:Cn.aplicar_taxa||!1}))),Xn(vr[0]?.id||null),(async()=>{try{const{data:Cn,error:qa}=await Q.from("agendamento_participantes").select("cliente_id, nome, valor_cota, status_pagamento, finalizadora_id, aplicar_taxa, ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey ( nome, codigo )").eq("codigo_empresa",A.codigo_empresa).eq("agendamento_id",Fe.id).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});if(!qa&&Array.isArray(Cn)){const Ts=Cn.slice();try{Xn(String(Ts[0]?.cliente_id||"")||null)}catch{}const fs=Ts.filter(ga=>ga&&ga.cliente_id).map(ga=>({id:ga.cliente_id,nome:ga.nome||ga.cliente?.nome||"",codigo:ga.cliente?.codigo||null}));Mt(ga=>{try{ea("edit:background-refresh")}catch{}return(Array.isArray(ga.selectedClients)?ga.selectedClients:[]).length>0?ga:{...ga,selectedClients:fs}}),x(Ts.map(ga=>({cliente_id:ga.cliente_id,nome:ga.nome||ga.cliente?.nome||"",codigo:ga.cliente?.codigo||null,valor_cota:(()=>{const Ci=Number.isFinite(Number(ga.valor_cota))?Number(ga.valor_cota):dm(ga.valor_cota);return Gp(String((Number.isFinite(Ci)?Ci:0).toFixed(2)))})(),status_pagamento:ga.status_pagamento||"Pendente",finalizadora_id:ga.finalizadora_id?String(ga.finalizadora_id):null,aplicar_taxa:ga.aplicar_taxa||!1})))}}catch(Cn){console.error("Falha ao carregar participantes (refresh)",Cn)}})(),Bs.current=!0}else if(to){const $e=(kt||[]).includes(to.court)?to.court:(kt||[])[0]||"",mt={selectedClients:ar.current?Array.isArray(Ne.selectedClients)?Ne.selectedClients:[]:[],court:$e,modality:(()=>(xe[$e]?.modalidades||Kp)[0]||"")(),status:"scheduled",date:to.date??k,startMinutes:to.startMinutes??tt(),endMinutes:to.endMinutes??tt()+60};Mt(mt),x([]),Ws.current=!0,Bs.current=!0}else{const $e=kt[0]||"",mt=xe[$e]?.modalidades||Kp,$t=Array.isArray(Rt)?Rt:[],Zt=ar.current?Array.isArray(Ne.selectedClients)?Ne.selectedClients:[]:$t.length>0?$t:[];if(!ar.current&&$t.length>0)try{ar.current=!0}catch{}Mt({selectedClients:Zt,court:$e,modality:mt[0]||"",status:"scheduled",date:k,startMinutes:tt(),endMinutes:tt()+60}),x([]),Ws.current=!0,Bs.current=!0}},[ze,Fe,k,to,kt,Kp,ht]),p.useEffect(()=>{if(ze&&Fe){Bs.current=!1,ba.current=!1,ar.current||Mt($e=>({...$e,selectedClients:[]}));try{Ot.current=!1}catch{}}},[Fe,ze]),p.useEffect(()=>{if(ze)try{ba.current=!1}catch{}},[ze]),p.useEffect(()=>{if(!ze||!Fe||ba.current)return;const $e=ht[Fe.id]||[];if(!$e.length)return;const mt=$e.slice();try{Xn(String(mt[0]?.cliente_id||"")||null)}catch{}const $t=mt.filter(Zt=>Zt&&Zt.cliente_id).map(Zt=>({id:Zt.cliente_id,nome:Zt.nome,codigo:Zt.codigo||null}));if($t.length>0){try{localStorage.getItem("debug:agenda")==="1"&&(console.log("[ORDER-AGENDA] chipsIdsNow:",chipsNow.map(Zt=>Zt.id)),console.log("[ORDER-AGENDA] selectedFromPartsIds:",$t.map(Zt=>Zt.id)))}catch{}Mt(Zt=>{try{ea("edit:prefill-tardy")}catch{}return(Array.isArray(Zt.selectedClients)?Zt.selectedClients:[]).length>0?Zt:{...Zt,selectedClients:$t}}),x(mt.map(Zt=>({cliente_id:Zt.cliente_id,nome:Zt.nome,codigo:Zt.codigo||null,valor_cota:(()=>{const vr=Number.isFinite(Number(Zt.valor_cota))?Number(Zt.valor_cota):dm(Zt.valor_cota);return Gp(String((Number.isFinite(vr)?vr:0).toFixed(2)))})(),status_pagamento:Zt.status_pagamento||"Pendente",finalizadora_id:Zt.finalizadora_id||null,aplicar_taxa:Zt.aplicar_taxa||!1}))),ba.current=!0}},[ze,Fe,ht]);const Iy=p.useCallback(async()=>{try{if(s)return;if(!Fe?.id){o();return}if(jn)return;try{try{Ss.current=!1}catch{}try{js.current=!1}catch{}await Tl({autoSave:!0}),await Promise.resolve()}catch{}js.current&&o()}catch{}},[s,Fe?.id,jn,Tl,o]);p.useEffect(()=>{const $e=mt=>{ze&&(s||Fe&&(mt.key==="F3"&&(mt.preventDefault(),An(!0)),mt.key==="F4"&&(mt.preventDefault(),Iy())))};return window.addEventListener("keydown",$e),()=>window.removeEventListener("keydown",$e)},[ze,Fe,s,Iy,An,Tl,Ss,js,xt,Ne]);const Jl=p.useMemo(()=>{const $e=xe[Ne.court];if(!$e)return{start:mr*60,end:Zr*60};const[mt,$t]=String($e.hora_inicio||"06:00:00").split(":").map(Number),[Zt,vr]=String($e.hora_fim||"24:00:00").split(":").map(Number),tn=Zt===0&&vr===0?24:Zt;return{start:mt*60+($t||0),end:tn*60+(vr||0)}},[xe,Ne.court,mr,Zr]),Fj=p.useCallback(($e,mt)=>{const $t=dr(Ne.date,"yyyy-MM-dd"),Zt=tn=>{const Pn=Wd(tn),Cn=Hd(tn);return Pn===0&&Cn===0?1440:Pn*60+Cn},vr=xe?.[Ne.court]?.id;return on.filter(tn=>{const Pn=tn.court===Ne.court,Cn=vr!=null&&String(tn.court_id||"")===String(vr);return(Pn||Cn)&&dr(tn.start,"yyyy-MM-dd")===$t&&tn.status!=="canceled"&&(!Fe||tn.id!==Fe.id)}).map(tn=>[Zt(tn.start),Zt(tn.end)]).sort((tn,Pn)=>tn[0]-Pn[0])},[on,Ne.court,Ne.date,Fe]),Px=p.useMemo(()=>{try{return Fj()}catch{return[]}},[Fj]),GA=($e,mt,$t,Zt)=>$e<Zt&&$t<mt;function yf($e,mt){if(mt<=$e||$e<Jl.start||mt>Jl.end)return!1;for(const[$t,Zt]of Px)if(GA($e,mt,$t,Zt))return!1;return!0}const Eu=$e=>{let mt=$e+Cs;if(!yf($e,mt))return null;for(;mt+Cs<=Jl.end&&yf($e,mt+Cs);)mt+=Cs;return mt},rd=p.useMemo(()=>{const $e=Jl,mt=[];for(let $t=$e.start;$t<=$e.end;$t+=Cs){const Zt=yf($t,$t+Cs);let vr=Math.floor($t/60);const tn=$t%60;vr>=24&&$t===1440&&(vr=0),mt.push({value:$t,label:`${String(vr).padStart(2,"0")}:${String(tn).padStart(2,"0")}`,available:Zt})}return mt},[Jl,Px]),ku=p.useMemo(()=>{const $e=Eu(Ne.startMinutes),mt=[];for(let $t=Ne.startMinutes+Cs;$t<=Jl.end;$t+=Cs){const Zt=!!$e&&$t<=$e;let vr=Math.floor($t/60);const tn=$t%60;vr>=24&&(vr=vr%24),mt.push({value:$t,label:`${String(vr).padStart(2,"0")}:${String(tn).padStart(2,"0")}`,available:Zt})}return mt},[Ne.startMinutes,Px,Jl]);p.useEffect(()=>{if(Ws.current){Ws.current=!1;return}const mt=(()=>{if(yf(Ne.startMinutes,Ne.startMinutes+Cs))return Ne.startMinutes;for(let vr=Math.max(Jl.start,Ne.startMinutes);vr<=Jl.end-Cs;vr+=Cs)if(yf(vr,vr+Cs))return vr;for(let vr=Jl.start;vr<=Jl.end-Cs;vr+=Cs)if(yf(vr,vr+Cs))return vr;return Ne.startMinutes})();if(mt!==Ne.startMinutes){Mt(vr=>({...vr,startMinutes:mt}));return}const $t=Eu(mt);if(!$t)return;let Zt=Ne.endMinutes;(!Number.isFinite(Zt)||Zt<=mt||Zt>$t)&&(Zt=Math.min(mt+60,$t),Zt<mt+Cs&&(Zt=mt+Cs),Mt(vr=>({...vr,endMinutes:Zt})))},[Ne.startMinutes,Ne.court,Ne.date,Px,Jl]);const KA=p.useMemo(()=>xe[Ne.court]?.modalidades||Kp,[xe,Ne.court]);p.useEffect(()=>{const $e=xe[Ne.court]?.modalidades||Kp;$e.includes(Ne.modality)||Mt(mt=>({...mt,modality:$e[0]||""}))},[Ne.court,xe]),p.useEffect(()=>{if(Ws.current||!Kl(Ne.date,k))return;if(me[Ne.court]&&!me[Ne.court].funciona){const $t=kt.find(Zt=>!me[Zt]||me[Zt].funciona);$t&&Mt(Zt=>({...Zt,court:$t}))}},[Ne.court,Ne.date,me,kt,k]);const Lj=p.useMemo(()=>{const $e=Math.max(0,Ne.endMinutes-Ne.startMinutes),mt=Math.floor($e/60),$t=$e%60;return mt>0&&$t>0?`${mt}h ${$t}min`:mt>0?`${mt}h`:`${$t}min`},[Ne.startMinutes,Ne.endMinutes]),Iu=p.useMemo(()=>{if(!ze)return"";const $e=new Date,mt=Wd($e)*60+Hd($e),$t=Number(Ne.startMinutes),Zt=Number(Ne.endMinutes),vr=tn=>{let Pn=Math.floor(tn/60);const Cn=tn%60;return Pn>=24&&(Pn=Pn%24),`${String(Pn).padStart(2,"0")}:${String(Cn).padStart(2,"0")}`};if(Os.autoConfirmEnabled&&Ne.status==="scheduled"){const tn=Math.max(0,$t-Number(Os.autoConfirmMinutesBefore||0));if(mt<tn)return`Este agendamento est com automao ativa (Confirmar automaticamente s ${vr(tn)})`}return Os.autoStartEnabled&&Ne.status==="confirmed"&&mt<$t?`Este agendamento est com automao ativa (Iniciar automaticamente s ${vr($t)})`:Os.autoFinishEnabled&&Ne.status==="in_progress"&&mt<Zt?`Este agendamento est com automao ativa (Finalizar automaticamente s ${vr(Zt)})`:""},[ze,Ne.startMinutes,Ne.endMinutes,Ne.status,Os]),Ql=p.useMemo(()=>(m||[]).length,[m]),Oy=p.useMemo(()=>{const mt=(m||[]).map(Cn=>{const qa=dm(Cn?.valor_cota);return Number.isFinite(qa)?qa:0}).reduce((Cn,qa)=>Cn+qa,0),$t=dm(g),Zt=Number.isFinite($t)?$t:0,vr=Number((Zt-mt).toFixed(2));let tn=0,Pn=0;for(const Cn of m||[])(Cn?.status_pagamento||"Pendente")==="Pago"?tn++:Pn++;return{totalAssigned:mt,totalTarget:Zt,diff:vr,paid:tn,pending:Pn}},[m,g]);p.useEffect(()=>{const $e=dm(g);if(!Number.isFinite($e)||$e<=0)return;(m||[]).some($t=>dm($t?.valor_cota)>=$e)&&(m||[]).some($t=>$t.status_pagamento!=="Pago")&&x($t=>$t.map(Zt=>({...Zt,status_pagamento:"Pago"})))},[m,g]),p.useCallback(()=>{const $e=(Ne.selectedClients||[]).length;if(!$e)return;const mt=dm(g);if(!Number.isFinite(mt)||mt<0)return;const $t=Math.round(mt*100),Zt=Math.floor($t/$e);let vr=$t-Zt*$e;x(tn=>{const Pn=(Ne.selectedClients||[]).slice(),Cn=new Map,qa=new Map;return(tn||[]).forEach(fs=>{const ga=qa.get(fs.cliente_id)||[];ga.push(fs),qa.set(fs.cliente_id,ga)}),Pn.map(fs=>{const ga=Cn.get(fs.id)||0,vl=(qa.get(fs.id)||[])[ga];Cn.set(fs.id,ga+1);const Dl=Zt+(vr>0?1:0);vr>0&&vr--;const zd=(Dl/100).toFixed(2),Zl=Gp(String(zd)),Ud=dm(Zl);return{cliente_id:fs.id,nome:fs.nome,codigo:vl?.codigo??fs.codigo??null,valor_cota:Zl,status_pagamento:Number.isFinite(Ud)&&Ud>0?"Pago":"Pendente",finalizadora_id:vl?.finalizadora_id??null,aplicar_taxa:vl?.aplicar_taxa??!1}})})},[Ne.selectedClients,g,x]),p.useCallback(()=>{x($e=>$e.map(mt=>({...mt,valor_cota:"",status_pagamento:"Pendente"})))},[x]);const $p=p.useCallback(async()=>{try{un.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{er.current="close"}catch{}try{$n(!1),ln(!1)}catch{}},[Fe?.id,Tl]);return a.jsxs(a.Fragment,{children:[it&&a.jsx(Un,{open:!0,onOpenChange:$e=>{if(!$e&&it){try{it.resolve(!1)}catch{}Et(null)}},children:a.jsxs(zn,{onOpenAutoFocus:$e=>$e.preventDefault(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Reativar automao?"}),a.jsx(ma,{children:"Ao reativar, este agendamento voltar a ser atualizado automaticamente (incio e trmino) pelas regras da agenda."})]}),a.jsx(Ga,{children:a.jsxs("div",{className:"ml-auto flex gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>{try{it?.resolve(!1)}catch{}Et(null)},children:"Cancelar"}),a.jsx(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white",onClick:()=>{try{it?.resolve(!0)}catch{}Et(null)},children:"Reativar"})]})})]})}),ze&&a.jsx(Un,{open:!0,onOpenChange:async $e=>{if($e)xt(!0);else{try{const mt=Date.now()<(Lr.current||0);if(Wn||ss||mt){try{const $t={ts:new Date().toISOString(),hook:"Dialog:onOpenChange(blocked)",effectiveCustomerPickerOpen:Wn,isClientFormOpen:ss,suppressUntil:Lr.current,formLen:Array.isArray(Ne?.selectedClients)?Ne.selectedClients.length:NaN,curLen:Array.isArray(Qe.current)?Qe.current.length:NaN,lastLen:Array.isArray(Le.current)?Le.current.length:NaN};console.warn("[CustomerPicker][DIALOG:block-close]",$t)}catch{}return}}catch{}try{const mt={ts:new Date().toISOString(),hook:"Dialog:onOpenChange(allow-close)",effectiveCustomerPickerOpen:Wn,isClientFormOpen:ss,suppressUntil:Lr.current,formLen:Array.isArray(Ne?.selectedClients)?Ne.selectedClients.length:NaN,curLen:Array.isArray(Qe.current)?Qe.current.length:NaN,lastLen:Array.isArray(Le.current)?Le.current.length:NaN};console.warn("[CustomerPicker][DIALOG:allow-close]",mt)}catch{}if(s&&console.log("[Dialog] Fechamento solicitado com PaymentModal aberto - iniciando coordenao"),console.log(" [FLUXO CRTICO] Solicitao de fechamento do modal de agendamento recebida"),console.log(" Estado atual:",{isPaymentModalOpen:s,editingBooking:Fe?.id,timestamp:new Date().toISOString()}),s&&typeof window<"u"){console.log(" [FLUXO CRTICO] PaymentModal aberto - solicitando save-and-close");try{await new Promise(mt=>{const $t=()=>{window.removeEventListener("paymentmodal:closed",$t),console.log(" [FLUXO CRTICO] PaymentModal confirmou fechamento"),mt()},Zt=setTimeout(()=>{window.removeEventListener("paymentmodal:closed",$t),console.warn(" [FLUXO CRTICO] Timeout aguardando PaymentModal fechar"),mt()},3e3),vr=()=>{clearTimeout(Zt),$t()};window.addEventListener("paymentmodal:closed",vr,{once:!0}),window.dispatchEvent(new Event("paymentmodal:save-and-close"))})}catch{}}await ky(),console.log(" [FLUXO CRTICO] Modal de agendamento fechado")}},children:a.jsxs(zn,{forceMount:!0,disableAnimations:!0,alignTop:!0,className:"sm:max-w-[960px] max-h-[85vh] min-h-[360px] flex flex-col p-0",onOpenAutoFocus:$e=>$e.preventDefault(),onInteractOutside:async $e=>{try{const mt=Date.now()<(Lr.current||0);if(s||Wn||ss||mt){try{const $t={ts:new Date().toISOString(),hook:"DialogContent:onInteractOutside(blocked)",effectiveCustomerPickerOpen:Wn,isClientFormOpen:ss,isPaymentModalOpen:s,suppressUntil:Lr.current,formLen:Array.isArray(Ne?.selectedClients)?Ne.selectedClients.length:NaN,curLen:Array.isArray(Qe.current)?Qe.current.length:NaN,lastLen:Array.isArray(Le.current)?Le.current.length:NaN}}catch{}$e.preventDefault();return}if(Fe?.id){$e.preventDefault(),await ky();return}}catch{}},onEscapeKeyDown:$e=>{try{const mt=Date.now()<(Lr.current||0);if(s||Wn||ss||mt){$e.preventDefault();return}}catch{}},children:[a.jsxs(Bn,{className:"px-6 pt-6 pb-4 flex-shrink-0",children:[a.jsxs(Ln,{className:"flex items-center justify-between gap-3 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{children:Fe?(()=>{const $e=Fe?.code,mt=typeof $e=="number"?String($e).padStart(3,"0"):null;return mt?`Editar agendamento - ${mt}`:"Editar Agendamento"})():"Novo Agendamento"}),Fe?.created_by_isis&&a.jsxs("span",{className:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs bg-fuchsia-600/10 text-fuchsia-400 border-fuchsia-700/30",title:"Criado pela sis",children:[a.jsx("span",{className:"rounded-full overflow-hidden bg-background w-4 h-4 flex items-center justify-center shadow-[0_0_0_2px_rgba(0,0,0,0.25)]",children:a.jsx(dl,{size:"xs",className:"w-4 h-4"})}),"Criado pela sis"]})]}),Fe&&(()=>{Oy?.pending===0&&Ql>0;const $e=(Oy?.pending||0)>0,mt="inline-flex items-center gap-2 px-2.5 py-1 rounded-full border text-xs",$t="bg-emerald-600/10 text-emerald-400 border-emerald-700/30",Zt="bg-amber-600/15 text-amber-400 border-amber-700/30",vr=tn=>a.jsx("span",{"aria-hidden":!0,className:`inline-block w-2 h-2 rounded-full ${tn}`});return a.jsxs("span",{className:`${mt} ${$e?Zt:$t}`,title:$e?"H pagamentos pendentes":"Todos participantes pagos","aria-live":"polite",children:[vr($e?"bg-amber-400":"bg-emerald-400"),a.jsx("span",{className:"tracking-wide",children:"Pagos"}),a.jsx("strong",{className:"text-base font-semibold tabular-nums",children:Oy?.paid||0}),a.jsx("span",{className:"opacity-60",children:"/"}),a.jsx("span",{className:"text-base font-semibold tabular-nums",children:Ql})]})})(),a.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md border text-sm bg-white/5 border-white/10 text-text-primary mr-12 max-w-full",title:"Data do agendamento",children:[a.jsx(Io,{className:"w-4 h-4 opacity-80"}),a.jsxs("span",{className:"font-semibold",children:[dr(Ne.date,"dd/MM/yyyy"),(()=>{const $e=Number(Ne?.startMinutes),mt=Number(Ne?.endMinutes);if(!(Number.isFinite($e)&&Number.isFinite(mt)&&mt>$e))return"";const Zt=vr=>{let tn=Math.floor(vr/60);const Pn=vr%60;return tn>=24&&(tn=tn%24),`${String(tn).padStart(2,"0")}:${String(Pn).padStart(2,"0")}`};return`  ${Zt($e)}${Zt(mt)}`})()]})]})]}),a.jsx(ma,{children:Fe?"As alteraes so salvas automaticamente enquanto voc edita.":"Preencha os detalhes para criar uma nova reserva."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-4 pb-4",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"clientes-field",className:"font-bold",children:"Clientes"}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsxs(Qo,{modal:!1,open:Wn,onOpenChange:$e=>{const mt=Date.now(),$t=mt<(da.current||0)||mt<(Lr.current||0)||mt<(Ea.current||0)||ee();if(!((ss||xr)&&$e===!1)){if(!$e&&$t){Fa("onOpenChange:blocked:guard-window");return}if(!$e&&er.current!=="close"){Fa("onOpenChange:blocked:sticky-close");return}if($e){un.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}ln(!0),Fa("open:accepted")}else{un.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}try{const Zt=Array.isArray(Qe.current)?[...Qe.current]:[];Zt.length>0?(Tt.current="onOpenChange:close:preserve",Ge(Zt),qn("onOpenChange:close:preserve",Zt)):Ot.current||(Tt.current="onOpenChange:close:empty",qn("onOpenChange:close:empty",[]))}catch{}try{Lr.current=Date.now()+1500}catch{}try{const Zt={ts:new Date().toISOString(),hook:"onOpenChange(false)",formLen:Array.isArray(Ne?.selectedClients)?Ne.selectedClients.length:NaN,curLen:Array.isArray(Qe.current)?Qe.current.length:NaN,lastLen:Array.isArray(Le.current)?Le.current.length:NaN,chipsLen:Array.isArray(Rt)?Rt.length:NaN,clientsLoading:!!xr,lastAction:Tt?.current,clearedByUser:!!Ot?.current,suppressUntil:Lr.current};console.warn("[CustomerPicker][CLOSE:onOpenChange]",Zt)}catch{}ln(!1),Fa("close:accepted")}!$e&&rt.current&&(Pe(!0),rt.current=!1,setTimeout(()=>Pe(!1),1200)),er.current=$e?"open":"close",$n($e)}},children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"outline",className:Pr("min-w-[180px] justify-between",X&&"ring-2 ring-emerald-500/40 ring-offset-2 ring-offset-transparent transition-shadow"),onClick:()=>{Fa("trigger:click");try{er.current="open"}catch{}try{un.current=!0,localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}$n(!0),ln(!0),setTimeout(()=>{$n(!0),ln(!0),Fa("trigger:reassert-open")},30),Fa("trigger:after-set-open")},children:[Za,a.jsx(hx,{className:"w-4 h-4 ml-2 opacity-60"})]})}),a.jsx(Go,{forceMount:!0,side:"bottom",align:"start",className:"w-[360px] p-2 z-[9999]",onPointerDownOutside:$e=>{const mt=Date.now();if(mt<(da.current||0)||mt<(Lr.current||0)||mt<(Ea.current||0)||ee()){$e.preventDefault();return}if(ss||xr){$e.preventDefault();return}try{const Zt=Array.isArray(Qe.current)?[...Qe.current]:[];Zt.length>0?(Tt.current="outside:close:snapshot",Le.current=Zt,Ge(Zt),qn("outside:close:apply",Zt),Ot.current=!1):(Tt.current="outside:close:empty",Ot.current&&(Le.current=[],console.warn("[CustomerPicker][outside:close:empty:cleared]",{ts:new Date().toISOString()})),qn("outside:close:empty",[]))}catch{}try{Lr.current=Date.now()+1500}catch{}try{const Zt={ts:new Date().toISOString(),hook:"onPointerDownOutside",formLen:Array.isArray(Ne?.selectedClients)?Ne.selectedClients.length:NaN,curLen:Array.isArray(Qe.current)?Qe.current.length:NaN,lastLen:Array.isArray(Le.current)?Le.current.length:NaN,chipsLen:Array.isArray(Rt)?Rt.length:NaN,clientsLoading:!!xr,lastAction:Tt?.current,clearedByUser:!!Ot?.current,suppressUntil:Lr.current}}catch{}rt.current=!0,er.current="close",un.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}$n(!1),ln(!1)},onFocusOutside:$e=>{Fa("focusOutside"),(ss||xr)&&$e.preventDefault()},onEscapeKeyDown:$e=>{Fa("escapeKeyDown"),(ss||xr)&&$e.preventDefault()},children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{ref:Jt,placeholder:"Buscar por cdigo ou nome...",value:En,onChange:$e=>{pa($e.target.value),Wa(0)},onKeyDown:$e=>{if($e.key==="ArrowDown"||$e.key==="ArrowUp"){$e.preventDefault();const mt=(oo||[]).filter(Pn=>{const Cn=En.trim().toLowerCase();return Cn?String(et(Pn)||"").toLowerCase().includes(Cn):!0}),$t=mt.find(Pn=>Pn?.is_consumidor_final===!0),vr=mt.filter(Pn=>Pn?.is_consumidor_final!==!0).slice().sort((Pn,Cn)=>{const qa=typeof Pn=="object"&&Number.isFinite(Number(Pn?.codigo))?Number(Pn.codigo):1/0,Ts=typeof Cn=="object"&&Number.isFinite(Number(Cn?.codigo))?Number(Cn.codigo):1/0;if(qa!==Ts)return qa-Ts;const fs=String(_e(Pn)||"").toLowerCase(),ga=String(_e(Cn)||"").toLowerCase();return fs.localeCompare(ga)}),tn=$t?[$t,...vr]:vr;$e.key==="ArrowDown"?Wa(Pn=>Math.min(Pn+1,tn.length-1)):Wa(Pn=>Math.max(Pn-1,0))}if($e.key==="Enter"){$e.preventDefault();const mt=(oo||[]).filter(Cn=>{const qa=En.trim().toLowerCase();return qa?String(et(Cn)||"").toLowerCase().includes(qa):!0}),$t=mt.find(Cn=>Cn?.is_consumidor_final===!0),vr=mt.filter(Cn=>Cn?.is_consumidor_final!==!0).slice().sort((Cn,qa)=>{const Ts=typeof Cn=="object"&&Number.isFinite(Number(Cn?.codigo))?Number(Cn.codigo):1/0,fs=typeof qa=="object"&&Number.isFinite(Number(qa?.codigo))?Number(qa.codigo):1/0;if(Ts!==fs)return Ts-fs;const ga=String(_e(Cn)||"").toLowerCase(),Ci=String(_e(qa)||"").toLowerCase();return ga.localeCompare(Ci)}),Pn=($t?[$t,...vr]:vr)[ya];if(Pn){const Cn=Pn.id,qa=_e(Pn),Ts=Pn.codigo,fs={id:Cn,nome:qa,codigo:Ts},ga=[...Array.isArray(Qe.current)?Qe.current:[],fs];try{(Qe.current||[]).length===0&&(Sn.current=Cn||null)}catch{}try{Ot.current=!1}catch{}try{ga.length>0&&(Le.current=ga)}catch{}try{Qe.current=ga}catch{}qn("keyboard:enter",ga),un.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}}}},className:"pl-10 pr-10"}),En&&a.jsx("button",{type:"button","aria-label":"Limpar busca",className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary p-1 rounded hover:bg-white/10",onClick:()=>{pa(""),Jt.current?.focus()},children:a.jsx(Hc,{className:"w-4 h-4"})})]}),a.jsxs("div",{ref:Kt,className:"max-h-[260px] overflow-y-auto divide-y divide-border rounded-md border border-border",onWheel:$e=>{$e.stopPropagation()},onTouchMove:$e=>{$e.stopPropagation()},style:{overscrollBehavior:"contain"},children:[xr&&(oo||[]).length===0&&a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Carregando clientes"}),!xr&&(oo||[]).length===0&&a.jsx("div",{className:"px-3 py-4 text-sm text-text-muted",children:"Nenhum cliente encontrado"}),!xr&&(()=>{const $e=(oo||[]).filter(tn=>{const Pn=En.trim().toLowerCase();return Pn?String(et(tn)||"").toLowerCase().includes(Pn):!0}),mt=$e.find(tn=>tn?.is_consumidor_final===!0),Zt=$e.filter(tn=>tn?.is_consumidor_final!==!0).slice().sort((tn,Pn)=>{const Cn=typeof tn=="object"&&Number.isFinite(Number(tn?.codigo))?Number(tn.codigo):1/0,qa=typeof Pn=="object"&&Number.isFinite(Number(Pn?.codigo))?Number(Pn.codigo):1/0;if(Cn!==qa)return Cn-qa;const Ts=String(_e(tn)||"").toLowerCase(),fs=String(_e(Pn)||"").toLowerCase();return Ts.localeCompare(fs)});return mt?[mt,...Zt]:Zt})().map(($e,mt)=>{const $t=$e?.is_consumidor_final===!0,Zt=typeof $e=="object"?$e.id:null,vr=_e($e),tn=typeof $e=="object"?$e.codigo:null,Pn=String(vr||"").toLowerCase(),Cn=fs=>fs.id&&Zt?fs.id===Zt:String(fs.nome||"").toLowerCase()===Pn,qa=(Ne.selectedClients||[]).some(Cn),Ts=mt===ya;return a.jsxs("button",{ref:fs=>{Hr.current[mt]=fs},type:"button",className:`w-full text-left py-3 px-4 flex items-center gap-3 transition-all border-b border-border last:border-0 ${Ts?"ring-2 ring-blue-500 ring-inset z-10":""} ${$t?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":qa?"bg-emerald-600/20 hover:bg-emerald-600/30":"hover:bg-surface-2"}`,onMouseEnter:()=>Wa(mt),onMouseDown:fs=>{fs.stopPropagation()},role:"option","aria-checked":qa,onClick:()=>{const fs={id:Zt,nome:vr,codigo:tn},ga=[...Array.isArray(Qe.current)?Qe.current:[],fs];try{(Qe.current||[]).length===0&&(Sn.current=Zt||null)}catch{}try{Ot.current=!1}catch{}try{ga.length>0&&(Le.current=ga)}catch{}try{Qe.current=ga}catch{}qn("list:add",ga),un.current=!0;try{localStorage.setItem("agenda:customerPicker:desiredAt",String(Date.now()))}catch{}},children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[tn!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-colors ${$t?"bg-amber-500/15 text-amber-300/90 ring-1 ring-amber-500/20":"bg-emerald-600/20 text-emerald-400"}`,children:["#",tn]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[a.jsx("span",{className:`font-medium truncate ${$t?"text-amber-100/90":""}`,children:vr}),$t&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]})]})]}),(()=>{const fs=(Ne.selectedClients||[]).filter(ga=>Cn(ga)).length;return fs>0?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-rose-600 hover:bg-rose-500 text-white text-base font-bold transition-colors",onClick:ga=>{ga.stopPropagation();const Ci=Array.isArray(Qe.current)?Qe.current:[],vl=Ci.findIndex(Dl=>Cn(Dl));if(vl!==-1){const Dl=[...Ci];Dl.splice(vl,1);try{Ot.current=Dl.length===0}catch{}try{Dl.length===0&&(Sn.current=null)}catch{}try{Dl.length>0&&(Le.current=Dl)}catch{}try{Qe.current=Dl}catch{}qn("list:remove-one",Dl)}},children:"-"}),a.jsx("span",{className:"inline-flex items-center justify-center min-w-[32px] h-7 px-2 rounded-full bg-sky-600 text-white text-base font-bold",children:fs}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-emerald-600 hover:bg-emerald-500 text-white text-base font-bold transition-colors",onClick:ga=>{ga.stopPropagation();const Ci={id:Zt,nome:vr,codigo:tn},vl=[...Array.isArray(Qe.current)?Qe.current:[],Ci];try{(Qe.current||[]).length===0&&(Sn.current=Zt||null)}catch{}try{Ot.current=!1}catch{}try{vl.length>0&&(Le.current=vl)}catch{}try{Qe.current=vl}catch{}qn("list:add-one",vl)},children:"+"})]}):null})()]},Zt||Pn)})]}),a.jsxs("div",{className:"flex items-center justify-between pt-1",children:[a.jsx(Z,{type:"button",size:"sm",className:"bg-emerald-600 hover:bg-emerald-500 text-white shadow-md ring-2 ring-emerald-400/40 ring-offset-2 ring-offset-transparent",onMouseDown:$e=>{try{Lr.current=Date.now()+3e3}catch{}try{da.current=Date.now()+3500}catch{}try{le.current=Date.now()+5e3}catch{}try{er.current="close"}catch{}try{un.current=!1,localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}$e.stopPropagation()},onClick:()=>{er.current="close",un.current=!1;try{le.current=Date.now()+5e3}catch{}try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}va.current=!0;const mt=Array.isArray(Qe.current)?[...Qe.current]:[];try{mt.length>0&&(Tt.current="conclude:close:snapshot",Le.current=mt)}catch{}Ge(mt);try{da.current=Date.now()+3e3}catch{}qn("conclude:close:apply",mt),Mt($t=>({...$t,selectedClients:[...mt]}));try{Ot.current=!1}catch{}try{Lr.current=Date.now()+2500}catch{}$n(!1),ln(!1),setTimeout(()=>{try{Lr.current=Date.now()+2500}catch{}$n(!1),ln(!1)},15),setTimeout(()=>{try{Lr.current=Date.now()+2500}catch{}$n(!1),ln(!1)},120);try{Lr.current=Date.now()+2500}catch{}try{const $t={ts:new Date().toISOString(),hook:"conclude:click",formLen:Array.isArray(Ne?.selectedClients)?Ne.selectedClients.length:NaN,curLen:Array.isArray(Qe.current)?Qe.current.length:NaN,lastLen:Array.isArray(Le.current)?Le.current.length:NaN,chipsLen:Array.isArray(Rt)?Rt.length:NaN,clientsLoading:!!xr,lastAction:Tt?.current,clearedByUser:!!Ot?.current,suppressUntil:Lr.current,selectionLockUntil:da.current,restoreGuardUntil:Ni.current,modalSessionId:we.current||"",closingAt:null,pickerOpen:!!Wn,modalOpen:!!ze}}catch{}setTimeout(()=>{try{va.current=!1}catch{}},3e3)},children:"Concluir"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:"text-xs text-text-muted",children:[(wa||[]).length," selecionado(s)"]})})]})]})})]}),a.jsx(Z,{type:"button",onClick:()=>{try{const $e=Array.isArray(Qe.current)?Qe.current:[];$e.length>0&&(Le.current=$e,Ge($e))}catch{}un.current=!1;try{localStorage.removeItem("agenda:customerPicker:desiredAt")}catch{}er.current="close",$n(!1),ln(!1),D(null),ro(!0)},children:"+ Novo"})]}),Zi?a.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-text-muted",children:[a.jsx(cl,{className:"w-4 h-4 animate-spin"}),"Carregando participantes..."]}):xo.length>0?a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:xo.map(($e,mt)=>{const $t=String($e?.nome||"").toLowerCase(),Zt=`${$e?.id||$t}-${mt}`,vr=$e?.id||`__name:${$t}`;return a.jsxs("span",{className:"text-sm font-medium bg-white/5 border border-white/10 rounded px-2 py-1 flex items-center gap-2",children:[bU($e.nome),a.jsxs("button",{type:"button","aria-label":"Remover cliente",title:"Remover cliente",className:"text-text-muted hover:text-red-400 p-1 rounded hover:bg-red-500/10",onClick:()=>{j("CustomerPicker:chip:remove",{token:vr,chipIdx:mt});const tn=(Array.isArray(Qe.current)?Qe.current:[]).filter((Pn,Cn)=>Cn!==mt);try{Ot.current=tn.length===0}catch{}try{Le.current=tn}catch{}try{Qe.current=tn}catch{}qn("chips:remove",tn)},children:[a.jsx(Hc,{className:"w-5 h-5"}),a.jsx("span",{className:"sr-only",children:"Remover"})]})]},Zt)})}):null]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"quadra-select",className:"font-bold",children:"Quadra"}),a.jsxs(Zn,{value:Ne.court,onValueChange:$e=>Mt(mt=>({...mt,court:$e})),children:[a.jsx(Yn,{className:"mt-1",onMouseDown:()=>{Wn&&setTimeout($p,0)},children:a.jsx(ta,{children:Ne.court&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:wh(Ne.court)}}),a.jsx("span",{children:Ne.court})]})})}),a.jsx(Jn,{className:"z-[60]",children:kt.map($e=>{const mt=dr(Ne.date,"yyyy-MM-dd"),$t=H[mt]||{},Zt=$t[$e]&&!$t[$e].funciona;return a.jsx(nt,{value:$e,disabled:Zt,className:Zt?"opacity-50 cursor-not-allowed":"",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:wh($e)}}),a.jsx("span",{children:$e}),Zt&&a.jsx("span",{className:"text-xs text-text-muted ml-auto",children:"(Fechada)"})]})},$e)})})]})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"modalidade-select",className:"font-bold",children:"Modalidade"}),a.jsxs(Zn,{value:Ne.modality,onValueChange:$e=>Mt(mt=>({...mt,modality:$e})),children:[a.jsx(Yn,{className:"mt-1",onMouseDown:()=>{Wn&&setTimeout($p,0)},children:a.jsx(ta,{})}),a.jsx(Jn,{children:(KA||[]).map($e=>a.jsx(nt,{value:$e,children:$e},$e))})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"status-select",className:"font-bold",children:"Status"}),a.jsxs(Zn,{value:Ne.status,onValueChange:$e=>Mt(mt=>({...mt,status:$e})),children:[a.jsx(Yn,{className:"mt-1",onMouseDown:()=>{Wn&&setTimeout($p,0)},children:a.jsx(ta,{})}),a.jsx(Jn,{children:Object.keys(tl).map($e=>a.jsx(nt,{value:$e,children:a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{"aria-hidden":!0,className:`inline-block h-4 w-1 rounded ${tl[$e].accent}`}),tl[$e].label]})},$e))})]}),Iu&&a.jsx("div",{className:"mt-1.5 text-xs text-text-primary font-medium bg-brand/5 border border-brand/20 rounded px-2 py-1.5",children:Iu})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"horario-inicio",className:"font-bold",children:"Horrio"}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsxs(Zn,{value:String(Ne.startMinutes),onValueChange:$e=>Mt(mt=>({...mt,startMinutes:Number($e)})),children:[a.jsx(Yn,{className:"w-32","aria-label":"Hora incio",onMouseDown:()=>{Wn&&setTimeout($p,0)},children:a.jsx(ta,{})}),a.jsx(Jn,{className:"max-h-[300px] z-[60] [&>div]:scrollbar-thin [&>div]:scrollbar-track-surface [&>div]:scrollbar-thumb-brand/40 [&>div]:hover:scrollbar-thumb-brand/60",children:rd.map($e=>a.jsx(nt,{value:String($e.value),disabled:!$e.available,className:Pr(!$e.available&&"opacity-60"),children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[$e.available?a.jsx(pu,{className:"w-4 h-4 opacity-80"}):a.jsx(d0,{className:"w-4 h-4 opacity-80"}),$e.label]})},$e.value))})]}),a.jsxs(Zn,{value:String(Ne.endMinutes),onValueChange:$e=>Mt(mt=>({...mt,endMinutes:Number($e)})),children:[a.jsx(Yn,{className:"w-32","aria-label":"Hora fim",onMouseDown:()=>{Wn&&setTimeout($p,0)},children:a.jsx(ta,{})}),a.jsx(Jn,{className:"max-h-[300px] z-[60] [&>div]:scrollbar-thin [&>div]:scrollbar-track-surface [&>div]:scrollbar-thumb-brand/40 [&>div]:hover:scrollbar-thumb-brand/60",children:ku.map($e=>a.jsx(nt,{value:String($e.value),disabled:!$e.available,className:Pr(!$e.available&&"opacity-60"),children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[$e.available?a.jsx(pu,{className:"w-4 h-4 opacity-80"}):a.jsx(d0,{className:"w-4 h-4 opacity-80"}),$e.label]})},$e.value))})]})]}),a.jsxs("div",{className:"mt-1 inline-block text-xs font-semibold text-text-secondary bg-white/5 border border-white/10 rounded px-2 py-0.5",children:["Durao: ",Lj]})]}),!Fe&&a.jsxs("div",{className:"border-t border-border pt-4 mt-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("input",{type:"checkbox",id:"is-recorrente",checked:rr,onChange:$e=>ir($e.target.checked),className:"mt-1 h-4 w-4 rounded border-gray-300 text-brand focus:ring-brand"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"is-recorrente",className:"font-semibold text-text-primary cursor-pointer",children:"Agendamento Fixo (Recorrente)"}),a.jsx("p",{className:"text-xs text-text-secondary mt-0.5",children:"Criar este agendamento automaticamente nas prximas semanas, no mesmo dia e horrio"})]})]}),rr&&a.jsxs("div",{className:"ml-7 mt-3 space-y-3",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"quantidade-semanas",className:"text-sm font-medium",children:"Repetir por quantas semanas?"}),a.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-md bg-surface-2",children:[a.jsx("button",{type:"button",onClick:()=>sa($e=>Math.max(2,($e||2)-1)),className:"px-3 py-2 hover:bg-surface-3 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:jr<=2,children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),a.jsx("div",{className:"px-4 py-2 min-w-[60px] text-center font-semibold border-x border-border",children:jr}),a.jsx("button",{type:"button",onClick:()=>sa($e=>($e||2)+1),className:"px-3 py-2 hover:bg-surface-3 transition-colors",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),a.jsxs("span",{className:"text-sm text-text-secondary",children:["semanas (",jr," agendamentos)"]})]})]}),Ne.date&&jr>=2&&a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-slate-300 mb-2 uppercase tracking-wide",children:"Datas que sero criadas:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:jr}).map(($e,mt)=>{const $t=Es(Ne.date,mt*7);return a.jsxs("div",{className:"inline-flex items-center gap-1.5 bg-slate-700/50 border border-slate-600 rounded px-2 py-1",children:[a.jsx("svg",{className:"w-3.5 h-3.5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),a.jsx("span",{className:"text-xs font-medium text-white",children:dr($t,"dd/MM/yyyy '('EEEE')'",{locale:$a})})]},mt)})})]}),a.jsx("div",{className:"bg-slate-800/50 border-l-4 border-blue-600 rounded-r-lg p-3",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),a.jsxs("div",{className:"text-xs text-gray-300",children:[a.jsx("p",{className:"font-semibold mb-1 text-blue-300",children:"Importante: Revise os dados antes de salvar"}),a.jsxs("p",{children:["Sero criados ",a.jsxs("strong",{className:"text-white",children:[jr," agendamentos"]})," incluindo a data selecionada e as prximas ",jr-1," semanas. Editar ou cancelar depois exigir alterar cada agendamento individualmente."]})]})]})})]})]})]})]})}),a.jsx(Ga,{className:"flex-shrink-0 border-t border-border bg-surface px-6 py-3",children:a.jsxs("div",{className:"w-full flex flex-col gap-3 sm:flex-row sm:items-center",children:[Fe&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:mr-auto w-full sm:w-auto",children:[a.jsxs(Z,{type:"button",variant:"destructive",className:"bg-red-600 hover:bg-red-500 text-white border border-red-700 w-full sm:w-auto justify-center",onClick:()=>An(!0),children:[a.jsx(Og,{className:"w-4 h-4 mr-2 opacity-90"}),"Cancelar agendamento",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-red-700/50 rounded border border-red-500/30",children:"F3"})]}),a.jsxs(Z,{type:"button",variant:"secondary",className:"bg-teal-600 hover:bg-teal-500 text-white border-teal-700 w-full sm:w-auto justify-center",onClick:()=>{Iy()},children:[a.jsx(Wi,{className:"w-4 h-4 mr-2 opacity-90"}),a.jsx("span",{className:"hidden sm:inline",children:"Gerenciar Pagamentos"}),a.jsx("span",{className:"sm:hidden",children:"Pagamentos"}),a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-teal-700/50 rounded border border-teal-500/30",children:"F4"})]})]}),a.jsx(Gu,{open:hn,onOpenChange:An,children:a.jsxs(tu,{children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Cancelar agendamento?"}),a.jsx(su,{children:'Ao cancelar, este agendamento deixar de aparecer na agenda padro. Ele s ser visvel ao selecionar o filtro "Cancelados".'})]}),a.jsxs(nu,{children:[a.jsx(ou,{children:"Voltar"}),a.jsx(Ku,{className:"bg-red-600 hover:bg-red-500",onClick:async()=>{try{An(!1),xt(!1),await yr(Fe.id,"canceled","user"),t({title:"Agendamento cancelado"})}catch($e){t({title:"Erro ao cancelar",description:$e?.message||"Tente novamente."})}},children:"Confirmar cancelamento"})]})]})})]}),a.jsxs("div",{className:"flex gap-2 w-full sm:w-auto sm:ml-auto",children:[a.jsxs(Z,{type:"button",variant:"ghost",className:"border border-white/10 flex-1 sm:flex-none",onClick:async()=>{await ky()},children:["Fechar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-white/10 rounded border border-white/20",children:"Esc"})]}),!Fe?.id&&a.jsxs(Z,{type:"button",className:"bg-emerald-600 hover:bg-emerald-500 text-white disabled:opacity-60 disabled:cursor-not-allowed flex-1 sm:flex-none",disabled:jn,onClick:async()=>{try{if(jn)return;if(rr&&!Fe){Kn(!0);return}Ss.current=!0,js.current=!1,await Tl()}catch{}},children:["Salvar",a.jsx("kbd",{className:"hidden sm:inline ml-2 px-2 py-1 text-sm font-mono bg-emerald-700/50 rounded border border-emerald-500/30",children:""})]})]})]})})]})}),a.jsx(Gu,{open:ia,onOpenChange:Kn,children:a.jsxs(tu,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(ru,{children:[a.jsxs(au,{className:"flex items-center gap-3 text-xl",children:[a.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-lg bg-orange-600/20 border border-orange-600/40",children:a.jsx("svg",{className:"w-6 h-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),"Confirmar Criao de Agendamentos Recorrentes"]}),a.jsxs(su,{className:"space-y-4 mt-4",children:[Ne.date&&jr>=2&&a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-slate-300 mb-2 uppercase tracking-wide",children:" Datas que sero criadas:"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from({length:jr}).map(($e,mt)=>{const $t=Es(Ne.date,mt*7);return a.jsxs("div",{className:"flex items-center gap-2 bg-slate-700/50 border border-slate-600 rounded px-2 py-1.5",children:[a.jsxs("span",{className:"text-xs font-semibold text-slate-400",children:["#",mt+1]}),a.jsx("span",{className:"text-xs font-medium text-white",children:dr($t,"dd/MM/yyyy '('EEEE')'",{locale:$a})})]},mt)})})]}),a.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wide",children:"Resumo do Agendamento"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Quadra"}),a.jsx("span",{className:"font-semibold text-white",children:xe[Ne.court]?.name||Ne.court})]}),a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Horrio"}),a.jsxs("span",{className:"font-semibold text-white font-mono",children:[jU(Ne.startMinutes)," - ",jU(Ne.endMinutes)]})]}),a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-700/50",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Modalidade"}),a.jsx("span",{className:"font-semibold text-white",children:Ne.modality})]}),a.jsxs("div",{className:"flex items-start justify-between py-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Participantes"}),a.jsx("div",{className:"text-right max-w-xs",children:Ne.selectedClients?.length>0?a.jsxs("div",{className:"font-semibold text-white",children:[at?Ne.selectedClients.map($e=>$e.nome).join(", "):Ne.selectedClients.slice(0,3).map($e=>$e.nome).join(", "),!at&&Ne.selectedClients.length>3&&a.jsxs("span",{className:"text-slate-400",children:[" +",Ne.selectedClients.length-3]}),Ne.selectedClients.length>3&&a.jsxs(a.Fragment,{children:[" ",a.jsx("button",{type:"button",onClick:()=>Te(!at),className:"text-xs text-blue-400 hover:text-blue-300 underline inline",children:at?"Ver menos":"Ver todos"})]})]}):a.jsx("span",{className:"font-semibold text-white",children:"Nenhum participante"})})]})]})]}),a.jsx("div",{className:"bg-red-900/30 border-l-4 border-red-600 rounded-r-lg p-4",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-red-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsx("div",{children:a.jsxs("p",{className:"text-sm text-gray-300",children:[a.jsx("strong",{className:"text-red-300",children:"Importante:"})," Aps criar, editar ou cancelar exigir alterar cada agendamento individualmente. Certifique-se de que todos os dados esto corretos!"]})})]})})]})]}),a.jsxs(nu,{className:"gap-2",children:[a.jsx(ou,{onClick:()=>{Kn(!1),Te(!1)},className:"border-slate-600 hover:bg-slate-800",children:"Cancelar e Revisar"}),a.jsxs(Ku,{className:"bg-emerald-700 hover:bg-emerald-600 text-white font-semibold",onClick:async()=>{Kn(!1),Te(!1),Ss.current=!0,js.current=!1,await Tl()},children:[a.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirmar e Criar ",jr," Agendamentos"]})]})]})}),ss&&a.jsx(_ne,{open:ss,onOpenChange:$e=>{ro($e),$e||(D(null),window.__paymentModalCallback&&(window.__paymentModalCallback=null))},client:xl,onSaved:$e=>{try{if($e&&typeof $e=="object"){console.warn("[CustomerPicker][onSaved:START]",{clientId:$e.id,clientName:$e.nome,currentSelection:Array.isArray(Qe.current)?Qe.current.length:0});try{le.current=Date.now()+3e3,da.current=Date.now()+3e3,Ni.current=Date.now()+3e3}catch{}(oo||[]).some($t=>typeof $t=="object"?$t.id===$e.id:!1)||(ed($t=>[...$t||[],$e]),Na($t=>[...$t||[],$e])),Mt($t=>{const Zt=Array.isArray($t.selectedClients)?$t.selectedClients:[],vr={id:$e.id,nome:$e.nome||$e.name||_e($e),codigo:$e.codigo},tn=Zt.filter(Cn=>Cn.id!==$e.id),Pn=[vr,...tn];try{Qe.current=Pn}catch{}try{Le.current=Pn}catch{}try{Ge(Pn)}catch{}try{Ot.current=!1}catch{}return console.warn("[CustomerPicker][onSaved:COMPLETE]",{newClientId:$e.id,newClientName:$e.nome,totalSelected:Pn.length,refsSynced:!0,protectionActive:!0}),{...$t,selectedClients:Pn}}),Promise.resolve().then(()=>{try{const $t=Array.isArray(Qe.current)?Qe.current:[];Mt(Zt=>(Array.isArray(Zt.selectedClients)?Zt.selectedClients:[]).length>0?Zt:$t.length>0?(console.warn("[CustomerPicker][onSaved:REASSERT]",{count:$t.length}),{...Zt,selectedClients:[...$t]}):Zt)}catch{}})}if(window.__paymentModalCallback&&typeof window.__paymentModalCallback=="function")try{window.__protectPaymentModal&&window.__protectPaymentModal(3e3),window.__paymentModalCallback(),window.__paymentModalCallback=null}catch(mt){console.error("[PaymentModal][callback:ERROR]",mt)}}catch(mt){console.error("[CustomerPicker][onSaved:ERROR]",mt)}}}),s&&a.jsx(_Ze,{setIsModalOpen:xt,setBookings:cn,form:Ne,setForm:Mt,localCustomers:oo,onOpenClientModal:$e=>{ro(!0),window.__paymentModalCallback=$e}}),l&&a.jsx(NZe,{form:Ne,setForm:Mt,localCustomers:oo})]})},qr=p.useMemo(()=>{const le=dr(k,"yyyy-MM-dd");let we=on.filter(St=>dr(St.start,"yyyy-MM-dd")===le);if(!!!Ue){if(we=we.filter(St=>St.status!=="canceled"),Vs.trim()){const St=Vs.trim().toLowerCase();we=we.filter(tt=>(tt.customer||"").toLowerCase().includes(St)||(tt.court||"").toLowerCase().includes(St)||(tl[tt.status]?.label||"").toLowerCase().includes(St))}return we}let _e=nr.canceledOnly?we.filter(St=>St.status==="canceled"):we.filter(St=>St.status!=="canceled");if(nr.pendingPayments&&(_e=_e.filter(St=>{const tt=ht[St.id]||[];return tt.some(Mt=>String(Mt.status_pagamento||"").toLowerCase()!=="pago")&&tt.length>0})),Vs.trim()){const St=Vs.trim().toLowerCase();_e=_e.filter(tt=>(tt.customer||"").toLowerCase().includes(St)||(tt.court||"").toLowerCase().includes(St)||(tl[tt.status]?.label||"").toLowerCase().includes(St))}try{const St=Date.now(),tt=(on||[]).filter(Mt=>dr(Mt.start,"yyyy-MM-dd")===le).filter(Mt=>Mt.status!=="canceled").filter(Mt=>{const Qe=sr.current.get(Mt.id);return Qe&&Qe.src==="automation"&&St-Qe.ts<2e3}),Ne=new Map(_e.map(Mt=>[Mt.id,Mt]));for(const Mt of tt)Ne.has(Mt.id)||Ne.set(Mt.id,Mt);_e=Array.from(Ne.values())}catch{}return _e},[on,k,nr.scheduled,nr.canceledOnly,nr.pendingPayments,Vs,ht,Ue]),Rr=p.useMemo(()=>{const le=dr(k,"yyyy-MM-dd"),we=Nr||st[0],et=on.filter(St=>dr(St.start,"yyyy-MM-dd")===le&&St.status!=="canceled"&&St.court===we);let _e=0;return et.forEach(St=>{const Ne=(ht[St.id]||[]).filter(Mt=>String(Mt.status_pagamento||"").toLowerCase()!=="pago").length;_e+=Ne}),{totalBookings:et.length,totalPendingPayments:_e}},[on,k,ht,Nr,st]),Vr=p.useMemo(()=>{const le=vh(k),we=Es(le,6);let et=on.filter(tt=>{const Ne=Po(tt.start),Mt=Po(le),Qe=Po(we);return Ne>=Mt&&Ne<=Qe});if(!!!Ue){if(et=et.filter(tt=>tt.status!=="canceled"),Vs.trim()){const tt=Vs.trim().toLowerCase();et=et.filter(Ne=>(Ne.customer||"").toLowerCase().includes(tt)||(Ne.court||"").toLowerCase().includes(tt)||(tl[Ne.status]?.label||"").toLowerCase().includes(tt))}return et}let St=nr.canceledOnly?et.filter(tt=>tt.status==="canceled"):et.filter(tt=>tt.status!=="canceled");if(nr.pendingPayments&&(St=St.filter(tt=>{const Ne=ht[tt.id]||[];return Ne.some(Qe=>String(Qe.status_pagamento||"").toLowerCase()!=="pago")&&Ne.length>0})),Vs.trim()){const tt=Vs.trim().toLowerCase();St=St.filter(Ne=>(Ne.customer||"").toLowerCase().includes(tt)||(Ne.court||"").toLowerCase().includes(tt)||(tl[Ne.status]?.label||"").toLowerCase().includes(tt))}try{const tt=Date.now(),Ne=(on||[]).filter(Qe=>{const ar=Po(Qe.start);return ar>=Po(le)&&ar<=Po(we)}).filter(Qe=>Qe.status!=="canceled").filter(Qe=>{const ar=sr.current.get(Qe.id);return ar&&ar.src==="automation"&&tt-ar.ts<2e3}),Mt=new Map(St.map(Qe=>[Qe.id,Qe]));for(const Qe of Ne)Mt.has(Qe.id)||Mt.set(Qe.id,Qe);St=Array.from(Mt.values())}catch{}return St},[on,k,nr.scheduled,nr.canceledOnly,nr.pendingPayments,Vs,ht,Ue]);p.useEffect(()=>{if(!Vs.trim()||!(nr.scheduled||nr.canceledOnly||nr.pendingPayments)||!qr||qr.length===0)return;const le=[...qr].sort((et,_e)=>et.start-_e.start)[0];if(!le?.id)return;const we=document.getElementById(`booking-${le.id}`);we?.scrollIntoView&&we.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},[Vs,qr,nr.scheduled,nr.canceledOnly,nr.pendingPayments]),p.useEffect(()=>{const le=Hn.current,we=as.current||{},et=nr.canceledOnly&&!we.canceledOnly,_e=nr.scheduled&&!we.scheduled&&!nr.canceledOnly,St=nr.pendingPayments&&!we.pendingPayments;if(!le||!et&&!_e&&!St){as.current={scheduled:nr.scheduled,canceledOnly:nr.canceledOnly,pendingPayments:nr.pendingPayments};return}const tt=qr||[];if(tt.length===0){as.current={scheduled:nr.scheduled,canceledOnly:nr.canceledOnly,pendingPayments:nr.pendingPayments};return}const Ne=le.getBoundingClientRect();if(!tt.some(Qe=>{const ar=document.getElementById(`booking-${Qe.id}`);if(!ar)return!1;const Sn=ar.getBoundingClientRect();return Sn.bottom>Ne.top&&Sn.top<Ne.bottom})){const Qe=[...tt].sort((Sn,wn)=>Sn.start-wn.start)[0],ar=Qe&&document.getElementById(`booking-${Qe.id}`);ar?.scrollIntoView&&ar.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}as.current={scheduled:nr.scheduled,canceledOnly:nr.canceledOnly,pendingPayments:nr.pendingPayments}},[nr.scheduled,nr.canceledOnly,nr.pendingPayments,qr]);const kn=p.useMemo(()=>{if(!Nr||!xe[Nr])return{start:mr,end:Zr};const le=xe[Nr],we=le.hora_inicio||`${mr}:00:00`,et=le.hora_fim||`${Zr}:00:00`,[_e,St]=String(we).split(":").map(Number),[tt,Ne]=String(et).split(":").map(Number),Mt=tt===0&&Ne===0?24:tt,Qe=Mt*60+(Ne||0);return{start:_e||mr,end:Mt||Zr,startMinutes:(_e||0)*60+(St||0),endMinutes:Qe}},[Nr,xe,mr,Zr]);return p.useMemo(()=>{const le=kn.start,we=kn.end;return Array.from({length:Math.max(0,we-le)},(et,_e)=>le+_e)},[kn]),p.useMemo(()=>{const le=kn.start,we=kn.end;return Math.max(0,we-le)*(60/Cs)*jl},[kn]),a.jsxs(a.Fragment,{children:[a.jsxs(Fr.div,{variants:ze?void 0:IZe,initial:ze?!1:"hidden",animate:ze?!1:"visible",className:Pr("h-full w-full flex flex-col md:px-0",F&&"fixed inset-0 z-40 bg-surface"),children:[a.jsx(Fr.div,{variants:wU,className:"p-3 bg-surface mb-6 md:rounded-lg",children:a.jsxs("div",{className:"max-w-[1200px] mx-auto w-full flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>q(B==="day"?Gv(k,1):Gv(k,7)),children:a.jsx(zI,{className:"h-5 w-5"})}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"ghost",className:"w-full sm:w-auto max-w-full justify-center text-base font-semibold whitespace-nowrap truncate",children:[a.jsx(Io,{className:"mr-2 h-5 w-5"}),B==="day"?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden sm:inline",children:dr(k,"EEE, dd 'de' MMMM 'de' yyyy",{locale:$a})}),a.jsx("span",{className:"sm:hidden",children:dr(k,"EEE, dd/MM/yyyy",{locale:$a})})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden sm:inline",children:kZe(k)}),a.jsxs("span",{className:"sm:hidden",children:[dr(vh(k),"dd/MM/yyyy")," - ",dr(Es(vh(k),6),"dd/MM/yyyy")]})]})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:k,onSelect:le=>le&&q(le),initialFocus:!0})})]}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>q(B==="day"?Es(k,1):Es(k,7)),children:a.jsx(Kg,{className:"h-5 w-5"})})]}),st.length>0&&a.jsx("div",{className:"hidden md:flex md:justify-center md:flex-1",children:st.length===1?a.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 rounded-lg w-52 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:wh(st[0])}}),a.jsx("span",{className:"font-semibold text-sm",children:st[0]})]}):a.jsxs(Zn,{value:Nr||st[0],onValueChange:le=>{xn(le)},children:[a.jsx(Yn,{className:"w-52 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10 hover:border-brand/50 hover:bg-gradient-to-r hover:from-brand/10 hover:to-brand/15 transition-all shadow-sm",children:a.jsx(ta,{placeholder:"Selecionar quadra"})}),a.jsx(Jn,{className:"border-brand/30",children:st.map(le=>{const we=wh(le);return a.jsx(nt,{value:le,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:we}}),a.jsx("span",{className:"font-semibold",children:le})]})},le)})})]})}),a.jsxs("div",{className:"flex flex-col gap-3 w-full md:w-auto md:ml-auto",children:[a.jsxs("div",{className:"flex items-center gap-3 justify-center md:hidden",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-lg bg-surface-2/30 p-0.5",children:[a.jsx(Z,{variant:B==="day"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("day"),children:"Dia"}),a.jsx(Z,{variant:B==="week"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("week"),children:"Semana"})]}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsxs(Z,{variant:"outline",size:"sm",className:"gap-2",disabled:kt.length===0,children:[a.jsx(f$,{className:"h-4 w-4"})," Filtros"]})}),a.jsxs(Yu,{align:"end",className:"w-64",children:[a.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[a.jsx(l3,{className:"p-0",children:"Exibio"}),a.jsx(Z,{variant:"ghost",size:"sm",className:"h-7 text-xs text-text-muted hover:text-text-primary",onClick:()=>fn({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),children:"Limpar"})]}),a.jsx(L2,{}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Io,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Agendados"})]}),a.jsx(Qs,{checked:nr.scheduled,onCheckedChange:le=>fn(we=>({...we,scheduled:!!le,canceledOnly:le?!1:we.canceledOnly}))})]})}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(UI,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Livres"})]}),a.jsx(Qs,{checked:nr.available,onCheckedChange:le=>fn(we=>({...we,available:!!le,canceledOnly:le?!1:we.canceledOnly}))})]})}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Og,{className:"h-4 w-4 text-rose-400"}),a.jsx("span",{children:"Cancelados"})]}),a.jsx(Qs,{checked:nr.canceledOnly,onCheckedChange:le=>{const we=!!le;fn(et=>({...et,canceledOnly:we,scheduled:we?!1:et.scheduled,available:we?!1:et.available})),we&&!Yi&&Cc(!0)}})]})}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Wi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{children:"Pagamentos Pendentes"})]}),a.jsx(Qs,{checked:nr.pendingPayments,onCheckedChange:le=>fn(we=>({...we,pendingPayments:!!le}))})]})})]})]}),a.jsxs("div",{className:"relative inline-block group",children:[a.jsx(Z,{variant:F?"default":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>V(!F),"aria-label":F?"Minimizar grid":"Expandir grid",children:F?a.jsx(i$,{className:"h-4 w-4"}):a.jsx(o$,{className:"h-4 w-4"})}),a.jsx("div",{className:"hidden group-hover:block absolute right-0 mt-1 z-50 pointer-events-none",children:a.jsx("div",{className:"px-2 py-1 rounded-md bg-surface-2 text-xs text-text-primary border border-border shadow",children:F?"Minimizar (F10)":"Expandir (F10)"})})]}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>gl(!0),disabled:kt.length===0,"aria-label":"Configurar agenda",title:"Configurar agenda",children:a.jsx(Wc,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"flex items-center gap-3 justify-end flex-shrink-0",children:[a.jsxs("div",{className:"relative w-full sm:w-56",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar agendamento...",className:"pl-9",value:Vs,onChange:le=>ai(le.target.value),onBlur:()=>ai("")}),Vs&&a.jsx("button",{type:"button","aria-label":"Limpar busca",className:"absolute right-2 top-1/2 -translate-y-1/2 px-2 py-0.5 rounded text-xs font-medium text-primary hover:bg-surface-2",onClick:()=>ai(""),children:"Limpar"})]}),a.jsxs(Z,{size:"sm",onClick:()=>{cr(null),As(null),Pt()},"aria-label":"Novo agendamento",className:"gap-2",disabled:kt.length===0||st.every(le=>me[le]&&!me[le].funciona),children:[a.jsx(so,{className:"h-4 w-4"})," Agendar"]})]}),st.length>0&&a.jsxs("div",{className:"md:hidden flex items-center justify-center gap-2",children:[st.length===1?a.jsxs("div",{className:"inline-flex items-center justify-center gap-3 px-4 py-2 rounded-lg w-auto h-10 max-w-full border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:wh(st[0])}}),a.jsx("span",{className:"font-semibold text-sm text-center whitespace-nowrap truncate",children:st[0]})]}):a.jsxs(Zn,{value:st[Dn%st.length],onValueChange:le=>{const we=st.indexOf(le);we!==-1&&Pa(we)},children:[a.jsx(Yn,{className:"w-48 h-10 border-2 border-brand/30 bg-gradient-to-r from-brand/5 to-brand/10 hover:border-brand/50 hover:bg-gradient-to-r hover:from-brand/10 hover:to-brand/15 transition-all shadow-sm",children:a.jsx(ta,{placeholder:"Selecionar quadra"})}),a.jsx(Jn,{className:"border-brand/30",children:st.map(le=>{const we=wh(le);return a.jsx(nt,{value:le,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:we}}),a.jsx("span",{className:"font-semibold",children:le})]})},le)})})]}),te&&a.jsx("button",{type:"button",onClick:async()=>{try{navigator.vibrate&&navigator.vibrate(30)}catch{}Me()},className:"inline-flex items-center justify-center p-2 rounded-md border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-colors","aria-label":"Compartilhar",title:"Compartilhar",children:a.jsx(d$,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"hidden md:flex items-center gap-3 justify-end",children:[a.jsxs("div",{className:"flex items-center border border-border rounded-lg bg-surface-2/30 p-0.5",children:[a.jsx(Z,{variant:B==="day"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("day"),children:"Dia"}),a.jsx(Z,{variant:B==="week"?"default":"ghost",size:"sm",className:"h-8 px-3 text-xs font-medium",onClick:()=>z("week"),children:"Semana"})]}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsxs(Z,{variant:"outline",size:"sm",className:"gap-2",disabled:kt.length===0,children:[a.jsx(f$,{className:"h-4 w-4"})," Filtros"]})}),a.jsxs(Yu,{align:"end",className:"w-64",children:[a.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[a.jsx(l3,{className:"p-0",children:"Exibio"}),a.jsx(Z,{variant:"ghost",size:"sm",className:"h-7 text-xs text-text-muted hover:text-text-primary",onClick:()=>fn({scheduled:!0,available:!0,canceledOnly:!1,pendingPayments:!1}),children:"Limpar"})]}),a.jsx(L2,{}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Io,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Agendados"})]}),a.jsx(Qs,{checked:nr.scheduled,onCheckedChange:le=>fn(we=>({...we,scheduled:!!le,canceledOnly:le?!1:we.canceledOnly}))})]})}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(UI,{className:"h-4 w-4 text-text-muted"}),a.jsx("span",{children:"Livres"})]}),a.jsx(Qs,{checked:nr.available,onCheckedChange:le=>fn(we=>({...we,available:!!le,canceledOnly:le?!1:we.canceledOnly}))})]})}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Og,{className:"h-4 w-4 text-rose-400"}),a.jsx("span",{children:"Cancelados"})]}),a.jsx(Qs,{checked:nr.canceledOnly,onCheckedChange:le=>{const we=!!le;fn(et=>({...et,canceledOnly:we,scheduled:we?!1:et.scheduled,available:we?!1:et.available})),we&&!Yi&&Cc(!0)}})]})}),a.jsx(bs,{onClick:le=>le.preventDefault(),children:a.jsxs("div",{className:"flex items-center justify-between gap-3 w-full",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Wi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{children:"Pagamentos Pendentes"})]}),a.jsx(Qs,{checked:nr.pendingPayments,onCheckedChange:le=>fn(we=>({...we,pendingPayments:!!le}))})]})})]})]}),a.jsxs("div",{className:"relative inline-block group",children:[a.jsx(Z,{variant:F?"default":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>V(!F),"aria-label":F?"Minimizar grid":"Expandir grid",children:F?a.jsx(i$,{className:"h-4 w-4"}):a.jsx(o$,{className:"h-4 w-4"})}),a.jsx("div",{className:"hidden group-hover:block absolute right-0 mt-1 z-50 pointer-events-none",children:a.jsx("div",{className:"px-2 py-1 rounded-md bg-surface-2 text-xs text-text-primary border border-border shadow",children:F?"Minimizar (F10)":"Expandir (F10)"})})]}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>gl(!0),disabled:kt.length===0,"aria-label":"Configurar agenda",title:"Configurar agenda",children:a.jsx(Wc,{className:"h-5 w-5"})})]})]})]})}),a.jsx(Un,{open:Ac,onOpenChange:le=>{le||pi(_s),gl(le)},children:a.jsxs(zn,{className:"sm:max-w-[680px]",onOpenAutoFocus:le=>le.preventDefault(),children:[a.jsx(Bn,{className:"pb-3 border-b border-border bg-surface-2/40 rounded-t-lg px-2 -mx-2 -mt-2",children:a.jsx(Ln,{className:"text-base font-semibold tracking-tight",children:"Configuraes da Agenda"})}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[a.jsx(Di,{className:"h-4 w-4",style:{color:tl.confirmed.hex}}),a.jsx("span",{className:"text-sm font-medium",children:"Confirmao automtica"})]}),a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-3",style:{borderLeftWidth:3,borderLeftColor:tl.confirmed.hex},children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qs,{id:"autoConfirmEnabled",checked:Os.autoConfirmEnabled,onCheckedChange:le=>pi(we=>({...we,autoConfirmEnabled:!!le}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:tl.confirmed.hex}}),a.jsx(ct,{htmlFor:"autoConfirmEnabled",className:"font-medium",children:"Confirmao automtica"})]})]})}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(ct,{htmlFor:"autoconfirm-hours",className:"text-sm text-text-muted",children:"Confirmar se faltar"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(Zn,{value:String(Math.max(0,Math.round((Os.autoConfirmMinutesBefore||0)/60))),onValueChange:le=>pi(we=>({...we,autoConfirmMinutesBefore:Math.max(0,Number(le))*60})),disabled:!Os.autoConfirmEnabled,children:[a.jsx(Yn,{className:"w-32",children:a.jsx(ta,{placeholder:"Horas"})}),a.jsxs(Jn,{align:"start",children:[a.jsx(nt,{value:"0",children:"Imediato"}),a.jsx(nt,{value:"1",children:"1 h"}),a.jsx(nt,{value:"2",children:"2 h"}),a.jsx(nt,{value:"3",children:"3 h"}),a.jsx(nt,{value:"4",children:"4 h"}),a.jsx(nt,{value:"6",children:"6 h"}),a.jsx(nt,{value:"8",children:"8 h"}),a.jsx(nt,{value:"12",children:"12 h"}),a.jsx(nt,{value:"24",children:"24 h"})]})]}),a.jsx("span",{className:"text-sm text-text-muted",children:"antes"})]})]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[a.jsx(_G,{className:"h-4 w-4",style:{color:tl.in_progress.hex}}),a.jsx("span",{className:"text-sm font-medium",children:"Transies automticas"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-2",style:{borderLeftWidth:3,borderLeftColor:tl.in_progress.hex},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qs,{id:"autoStartEnabled",checked:Os.autoStartEnabled,onCheckedChange:le=>pi(we=>({...we,autoStartEnabled:!!le}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:tl.in_progress.hex}}),a.jsx(ct,{htmlFor:"autoStartEnabled",className:"font-medium",children:"Iniciar no horrio"})]})]}),a.jsx("p",{className:"text-xs text-text-muted ml-7",children:"Confirmado  Em andamento no horrio de incio."})]}),a.jsxs("div",{className:"rounded-lg border border-border bg-surface-2/40 p-4 space-y-2",style:{borderLeftWidth:3,borderLeftColor:tl.finished.hex},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qs,{id:"autoFinishEnabled",checked:Os.autoFinishEnabled,onCheckedChange:le=>pi(we=>({...we,autoFinishEnabled:!!le}))}),a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:tl.finished.hex}}),a.jsx(ct,{htmlFor:"autoFinishEnabled",className:"font-medium",children:"Finalizar ao trmino"})]})]}),a.jsx("p",{className:"text-xs text-text-muted ml-7",children:"Em andamento  Finalizado no horrio de trmino."})]})]})]})]}),a.jsxs(Ga,{className:"mt-2 gap-2",children:[a.jsx(Z,{type:"button",variant:"ghost",className:"border border-white/10",onClick:()=>gl(!1),children:"Cancelar"}),a.jsx(Z,{type:"button",variant:"default",onClick:()=>{console.log(" BOTO SALVAR CLICADO!"),Ir()},disabled:Zc,children:Zc?"Salvando":"Salvar"})]})]})}),a.jsx(Un,{open:Qc,onOpenChange:Cc,children:a.jsxs(zn,{className:"sm:max-w-[520px]",onOpenAutoFocus:le=>le.preventDefault(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Sobre agendamentos cancelados"}),a.jsx(ma,{children:"Agendamentos cancelados no aparecem na agenda quando o filtro no est selecionado e no ocupam horrio."})]}),a.jsxs("div",{className:"flex items-start gap-3 mt-2",children:[a.jsx(Qs,{id:"hide-canceled-info",checked:Yi,onCheckedChange:le=>si(!!le),className:"mt-0.5"}),a.jsx(ct,{htmlFor:"hide-canceled-info",className:"text-sm cursor-pointer text-text-secondary",children:"No mostrar novamente"})]}),a.jsx(Ga,{className:"mt-4",children:a.jsx(Z,{type:"button",onClick:()=>Cc(!1),children:"Entendi"})})]})}),!He&&kt.length===0&&a.jsxs("div",{className:"mb-4 p-4 rounded-lg border border-border bg-surface text-sm flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:"Nenhuma quadra encontrada"}),a.jsx("div",{className:"text-text-muted",children:"Cadastre suas quadras para comear a usar a agenda."})]}),a.jsx(Z,{asChild:!0,className:"w-full sm:w-auto",children:a.jsxs(H4,{to:"/quadras",children:[a.jsx("span",{className:"hidden sm:inline",children:"Ir para Cadastros  Quadras"}),a.jsx("span",{className:"sm:hidden",children:"Adicionar"})]})})]}),We?a.jsx("div",{className:"mt-4 rounded-xl border border-border bg-surface/70 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-surface/60",children:a.jsxs("div",{className:"flex items-center justify-center gap-4 px-6 py-8",children:[a.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full border-2 border-border/60 border-t-brand animate-spin"}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Carregando agenda"}),a.jsx("div",{className:"text-xs text-text-muted truncate",children:Je||"Aguarde um instante"}),a.jsx("div",{className:"mt-3 h-1.5 w-56 max-w-[70vw] rounded-full bg-border/40 overflow-hidden",children:a.jsx("div",{className:"h-full w-1/2 bg-gradient-to-r from-brand/30 via-brand to-brand/30 animate-pulse"})})]})]})}):a.jsxs(a.Fragment,{children:[st.length>0&&B==="week"&&(()=>{const le=Nr||st[0],we=Ue?Vr.filter(et=>{const _e=et.court===le,St=xe?.[le]||{},tt=String(St.id||St.codigo||""),Ne=tt&&String(et.court_id||"")===tt;return _e||Ne}):Vr;return a.jsx(a.Fragment,{children:a.jsx(PZe,{weekStart:vh(k),weekBookings:we,activeCourtFilter:le,courtsMap:xe,participantsByAgendamento:ht,onBookingClick:et=>{cr(et),xt(!0)},onSlotClick:(et,_e)=>{cr(null);const St=et.getHours()*60+et.getMinutes(),tt=_e||Nr||st[0],Ne=dr(et,"yyyy-MM-dd"),Mt=xe?.[tt]?.id,Qe=(()=>{try{return(on||[]).filter(En=>{const pa=En.court===tt,rs=Mt!=null&&String(En.court_id||"")===String(Mt);return(pa||rs)&&dr(En.start,"yyyy-MM-dd")===Ne&&En.status!=="canceled"}).map(En=>Wd(En.start)*60+Hd(En.start)).filter(En=>En>St).sort((En,pa)=>En-pa)[0]}catch{}})(),ar=(()=>{const En=xe[tt]?.hora_fim;if(!En)return Zr*60;const[pa,rs]=String(En).split(":").map(Number);return(pa===0&&(rs||0)===0?24:pa)*60+(rs||0)})(),Sn=typeof Qe=="number"?Qe:ar;let wn=Math.min(St+60,Sn);wn-St<30&&(Sn-30>=St?wn=Sn:wn=Math.min(ar,St+30));const $n={date:Po(et),court:tt,startMinutes:St,endMinutes:wn};console.log("onSlotClick in AgendaPage - BEFORE setPrefill",{slotDate:et,court:_e,activeCourtFilter:Nr,selectedCourts:st,startMinutes:St,endMinutes:wn,prefillData:$n}),As($n),console.log("onSlotClick in AgendaPage - AFTER setPrefill (state not updated yet)"),Pt()},statusConfig:tl,dayStartHour:mr,dayEndHourExclusive:Zr,weekDiasFuncionamento:H,sidebarVisible:e},`weekly-${le}`)})})(),st.length>0&&B==="day"&&(()=>{const le=typeof window<"u"&&window.innerWidth<768,we=le?[st[Dn%st.length]]:Nr?[Nr]:st,et=le?we[0]:Nr,_e=(()=>{if(et&&xe[et]){const Ne=xe[et],Mt=Ne.hora_inicio||`${mr}:00:00`,Qe=Ne.hora_fim||`${Zr}:00:00`,[ar]=String(Mt).split(":").map(Number),[Sn,wn]=String(Qe).split(":").map(Number);let $n=Sn===0&&wn===0?24:Sn;return wn>0&&$n<24&&($n+=1),{start:ar||mr,end:$n||Zr}}return{start:mr,end:Zr}})(),St=Array.from({length:Math.max(0,_e.end-_e.start)},(Ne,Mt)=>_e.start+Mt),tt=Math.max(0,_e.end-_e.start)*(60/Cs)*jl;return we.some(Ne=>me[Ne]&&!me[Ne].funciona),a.jsx(a.Fragment,{children:a.jsx(Fr.div,{variants:ze?void 0:wU,className:Pr("bg-surface fx-scroll","overflow-auto",le?"":"rounded-lg border border-border"),ref:Hn,style:{flex:"1 1 auto",minWidth:0},children:a.jsxs("div",{className:Pr("grid",!le&&"mx-auto"),style:{gridTemplateColumns:le?"60px 1fr":we.length===1?"120px 760px":we.length===2?"120px repeat(2, 520px)":`120px repeat(${we.length}, 1fr)`,width:le?"100%":we.length<=2?"fit-content":void 0,columnGap:le?"4px":"16px"},children:[a.jsxs("div",{className:"sticky left-0 bg-surface z-20",children:[a.jsx("div",{className:"sticky top-0 z-20 h-14 border-b border-r border-border bg-surface flex items-center justify-center px-2",children:a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"ghost",className:"hover:bg-surface-2/50 text-lg font-semibold",children:Kl(k,new Date)?"Hoje":dr(k,"EEEE",{locale:$a})})}),a.jsxs(Yu,{align:"center",children:[a.jsx(bs,{onClick:()=>q(new Date),children:"Hoje"}),a.jsx(L2,{}),(()=>{const Ne=["Segunda","Tera","Quarta","Quinta","Sexta","Sbado","Domingo"],Mt=wu(k,{weekStartsOn:1,locale:$a});return Ne.map((Qe,ar)=>a.jsx(bs,{onClick:()=>q(Es(Mt,ar)),children:Qe},Qe))})()]})]})}),St.map(Ne=>a.jsxs("div",{className:Pr("border-r border-border",Ne%2===1&&"bg-surface-2/30"),children:[a.jsx("div",{className:"relative border-b border-border/80",style:{height:jl},children:a.jsxs("span",{className:Pr("absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded font-bold",le?"px-1 text-sm":"px-2 text-lg"),children:[String(Ne).padStart(2,"0"),":00"]})}),a.jsx("div",{className:"relative border-b border-border/80",style:{height:jl},children:a.jsxs("span",{className:Pr("absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 bg-surface rounded font-bold",le?"px-1 text-sm":"px-2 text-lg"),children:[String(Ne).padStart(2,"0"),":30"]})})]},`time-${Ne}`))]}),we.map((Ne,Mt)=>a.jsxs("div",{className:"relative border-r border-border",children:[a.jsx("div",{className:"h-14 border-b border-border sticky top-0 bg-surface z-10 flex items-center justify-center",children:Mt===0&&a.jsxs("div",{className:"flex items-center justify-center gap-4 px-3",children:[Rr.totalBookings>0&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-surface-2/50",children:[a.jsx("span",{className:"text-lg",children:""}),a.jsx("span",{className:"font-bold text-text-primary",children:Rr.totalBookings}),a.jsxs("span",{className:"font-semibold text-xs text-text-muted",children:["agendamento",Rr.totalBookings!==1?"s":""]})]}),Rr.totalPendingPayments>0&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-surface-2/50",children:[a.jsx("span",{className:"text-lg",children:""}),a.jsx("span",{className:"font-bold text-text-primary",children:Rr.totalPendingPayments}),a.jsxs("span",{className:"font-semibold text-xs text-text-muted",children:["pendente",Rr.totalPendingPayments!==1?"s":""]})]}),te&&!le&&a.jsxs("button",{type:"button",onClick:async()=>{try{navigator.vibrate&&navigator.vibrate(30)}catch{}Me()},className:Pr("inline-flex items-center rounded-md text-xs border border-white/10 bg-surface/60 hover:bg-surface-2/70 hover:border-white/20 transition-colors",le?"p-2":"gap-2 px-3 py-1.5"),"aria-label":"Compartilhar",title:"Compartilhar",children:[a.jsx(d$,{className:"w-4 h-4"}),!le&&a.jsx("span",{className:"hidden sm:inline",children:"Compartilhar"})]})]})}),a.jsxs("div",{className:Pr("relative"),style:{height:tt},children:[me[Ne]&&!me[Ne].funciona?(()=>St.map(Qe=>a.jsx("div",{className:"absolute w-full cursor-not-allowed bg-surface/60 flex items-center justify-center border-b border-border/30 transition-colors",style:{height:jl*2,top:St.indexOf(Qe)*jl*2},children:a.jsxs("div",{className:"text-center pointer-events-none",children:[a.jsx(X4,{className:"h-5 w-5 text-text-primary mx-auto mb-1"}),a.jsx("div",{className:"text-xs font-medium text-text-primary mb-1",children:"Fechada"}),me[Ne].observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:me[Ne].observacao})]})},`closed-${Ne}-${Qe}`)))():null,(nr.scheduled||nr.canceledOnly||nr.pendingPayments)&&(()=>{const Qe=_e.start*60,ar=_e.end*60,Sn=(()=>{const ya=xe[Ne]?.hora_inicio,Wa=xe[Ne]?.hora_fim,[Ea,is]=String(ya||`${_e.start}:00:00`).split(":").map(Number),[Ns,ss]=String(Wa||`${_e.end}:00:00`).split(":").map(Number),ro=Ns===0&&ss===0?24:Ns||0;return{start:(Ea||0)*60+(is||0),end:ro*60+(ss||0)}})(),wn=Math.max(Sn.start,Qe),$n=Math.min(Sn.end,ar),En=Math.max(0,Math.floor((wn-Qe)/Cs)),pa=Math.max(En,Math.ceil(($n-Qe)/Cs)),rs=Math.max(0,(ar-Qe)/Cs),Ys=En*jl,ea=Math.min(rs,Math.max(0,pa-En)),na=Math.max(0,(rs-pa)*jl);return a.jsxs(a.Fragment,{children:[Ys>0&&a.jsx("div",{style:{height:Ys}}),Array.from({length:ea},(ya,Wa)=>{const Ea=En+Wa,Ns=(Math.floor(Ea/(60/Cs))+Math.floor(Qe/60))%2===1;return a.jsx("div",{className:Pr("border-b border-border/80",Ns&&"bg-surface-2/30"),style:{height:jl}},`base-${Ne}-slot-${Ea}`)}),na>0&&a.jsx("div",{style:{height:na}})]})})(),qr.filter(Qe=>{if(!Ue)return!0;const ar=Qe.court===Ne,Sn=xe?.[Ne]||{},wn=String(Sn.id||Sn.codigo||""),$n=wn&&String(Qe.court_id||"")===wn;return ar||$n}).map(Qe=>a.jsx(_r,{booking:Qe,courtGridStart:_e.start*60,courtGridEnd:_e.end*60},Qe.id)),nr.available&&!(me[Ne]&&!me[Ne].funciona)&&(()=>{const Qe=(()=>{const ea=xe[Ne]?.hora_inicio;if(!ea)return mr*60;const[na,ya]=String(ea).split(":").map(Number);return na*60+(ya||0)})(),ar=(()=>{const ea=xe[Ne]?.hora_fim;if(!ea)return Zr*60;const[na,ya]=String(ea).split(":").map(Number);return(na===0&&ya===0?24:na)*60+(ya||0)})(),Sn=ea=>{const na=Wd(ea),ya=Hd(ea);return na===0&&ya===0?1440:na*60+ya},wn=dr(k,"yyyy-MM-dd"),$n=xe?.[Ne]?.id,En=on.filter(ea=>{const na=ea.court===Ne,ya=$n!=null&&String(ea.court_id||"")===String($n);return(na||ya)&&dr(ea.start,"yyyy-MM-dd")===wn&&ea.status!=="canceled"}).map(ea=>[Sn(ea.start),Sn(ea.end)]).sort((ea,na)=>ea[0]-na[0]),pa=[];let rs=Qe;for(const[ea,na]of En)ea>rs&&pa.push([rs,ea]),rs=Math.max(rs,na);rs<ar&&pa.push([rs,ar]);const Ys=({startM:ea,endM:na})=>{const[ya,Wa]=p.useState(null),Ea=_e.start*60,is=Math.floor((ea-Ea)/Cs),Ns=Math.max(1,Math.ceil((na-ea)/Cs)),ss=is+Ns,ro=is*jl-1,xl=(ss-is)*jl+2;let D=Math.floor(ea/60),X=Math.floor(na/60);D>=24&&(D=D%24),X>=24&&(X=X%24);const Pe=`${String(D).padStart(2,"0")}:${String(ea%60).padStart(2,"0")}`,rt=`${String(X).padStart(2,"0")}:${String(na%60).padStart(2,"0")}`;return a.jsxs("div",{className:Pr("absolute left-2 right-2 rounded-md border-2 border-dashed text-sm z-0 cursor-pointer","border-[#10B981]","bg-transparent hover:border-[#10B981]/80 hover:shadow-sm"),style:{top:`${ro}px`,height:`${xl}px`},onMouseMove:Le=>{const Tt=Le.currentTarget.getBoundingClientRect(),Ot=Math.min(Math.max(0,Le.clientY-Tt.top),Tt.height);let Rt=Math.floor(Ot/jl);Rt=Math.max(0,Math.min(Rt,Ns-1)),Wa(Rt)},onMouseLeave:()=>Wa(null),onClick:Le=>{const Tt=Le.currentTarget.getBoundingClientRect(),Ot=Math.min(Math.max(0,Le.clientY-Tt.top),Tt.height),Rt=Math.floor(Ot/jl);let yt=ea+Rt*Cs;yt=Math.max(ea,Math.min(yt,na-Cs));const Ge=(()=>{const Hr=xe?.[Ne]?.id;return on.filter(An=>{const xr=An.court===Ne,Tr=Hr!=null&&String(An.court_id||"")===String(Hr);return(xr||Tr)&&dr(An.start,"yyyy-MM-dd")===wn}).map(An=>Wd(An.start)*60+Hd(An.start)).filter(An=>An>yt).sort((An,xr)=>An-xr)[0]})(),Jt=typeof Ge=="number"?Ge:ar;let Kt=Math.min(yt+60,Jt);if(Kt-yt<30){const Hr=Jt-30;Hr>=ea?(yt=Math.max(ea,Math.min(yt,Hr)),Kt=Jt):(yt=ea,Kt=Math.min(Jt,na))}cr(null);{const Hr=kt||[],hn=Hr.includes(Ne)?Ne:Hr[0]||"";As({court:hn,date:k,startMinutes:yt,endMinutes:Kt})}try{lastNonEmptySelectionRef.current=[],setChipsSnapshot([])}catch{}Pt()},title:`Livre: ${Pe}${rt}`,children:[ya!==null&&a.jsx("div",{className:"pointer-events-none absolute left-[6px] right-[6px] rounded-md border border-white/10 bg-white/5",style:{top:`${ya*jl}px`,height:`${jl}px`}}),a.jsxs("div",{className:"h-full px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"font-medium text-[#10B981]",children:"Livre"}),a.jsxs("span",{className:"text-text-muted",children:[Pe,"",rt]})]})]})};return pa.map(([ea,na],ya)=>a.jsx(Ys,{startM:ea,endM:na},`free-${Ne}-${ya}`))})()]})]},Ne))]})})})})()]})]}),Br(),a.jsx(Un,{open:De,onOpenChange:le=>{le||lt()},children:a.jsxs(zn,{className:"w-[calc(100vw-24px)] sm:w-full max-w-[980px] max-h-[85vh] overflow-y-auto mx-auto p-4 sm:p-6",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Compartilhar"}),a.jsx(ma,{children:"Gere uma imagem pronta para Story/Status."})]}),a.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[a.jsx(Z,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>ge(le=>Gv(le||new Date,1)),"aria-label":"Dia anterior",title:"Dia anterior",children:a.jsx(zI,{className:"h-5 w-5"})}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"ghost",className:"w-full sm:w-auto max-w-full justify-center text-base font-semibold whitespace-nowrap truncate",children:[a.jsx(Io,{className:"mr-2 h-5 w-5"}),a.jsx("span",{className:"sm:hidden",children:`${dr(Bt||new Date,"EEEE",{locale:$a}).replace(/-feira\b/gi,"").trim()}, ${dr(Bt||new Date,"dd/MM",{locale:$a})}`}),a.jsx("span",{className:"hidden sm:inline",children:`${dr(Bt||new Date,"EEEE",{locale:$a}).replace(/-feira\b/gi,"").trim()}, ${dr(Bt||new Date,"dd 'de' MMMM 'de' yyyy",{locale:$a})}`})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:Bt||new Date,onSelect:le=>le&&ge(le),initialFocus:!0})})]}),a.jsx(Z,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>ge(le=>Es(le||new Date,1)),"aria-label":"Prximo dia",title:"Prximo dia",children:a.jsx(Kg,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[a.jsx("div",{className:"w-full",children:a.jsx("div",{className:"w-full rounded-xl border border-white/10 bg-black/25 overflow-hidden shadow-[0_0_0_1px_rgba(255,255,255,0.06)]",children:a.jsx("div",{className:"w-full aspect-[9/16] flex items-center justify-center",children:pt?a.jsx("img",{src:pt,alt:"Prvia",className:"w-full h-full object-cover"}):a.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 text-text-muted",children:[a.jsx(cl,{className:"w-5 h-5 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Gerando imagem"})]})})})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Legenda"}),a.jsxs("button",{type:"button",onClick:an,className:"inline-flex items-center gap-2 px-2 py-1 rounded-md border border-white/10 bg-black/10 hover:bg-black/20 transition-colors","aria-label":"Copiar legenda",title:"Copiar legenda",children:[a.jsx(Q4,{className:"w-4 h-4"}),a.jsx("span",{className:"text-xs",children:"Copiar"})]})]}),a.jsx("pre",{className:"whitespace-pre-wrap text-sm text-text-primary font-sans leading-relaxed",children:Er})]}),a.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[a.jsx("div",{className:"text-xs text-text-muted mb-3",children:"Compartilhar"}),a.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-1",children:[a.jsxs("button",{type:"button",onClick:Gr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:a.jsx("img",{src:"/imagem.png",alt:"Imagem",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Imagem"})]}),a.jsxs("button",{type:"button",onClick:ha,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-emerald-500/15 border border-emerald-400/20 flex items-center justify-center",children:a.jsx("img",{src:"/whattsapp.png",alt:"WhatsApp",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"WhatsApp"})]}),a.jsxs("button",{type:"button",onClick:pn,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-fuchsia-500/15 border border-fuchsia-400/20 flex items-center justify-center",children:a.jsx("img",{src:"/instagram.png",alt:"Instagram",className:"w-9 h-9 object-contain"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Instagram"})]}),a.jsxs("button",{type:"button",onClick:zr,className:"shrink-0 flex flex-col items-center gap-2",children:[a.jsx("span",{className:"w-12 h-12 rounded-full bg-white/10 border border-white/10 flex items-center justify-center",children:a.jsx(Jue,{className:"w-6 h-6"})}),a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Link"})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted",children:"Recomendamos compartilhar pelo celular para melhor experincia."})]})]})]}),a.jsx(Ga,{children:a.jsx(Z,{type:"button",variant:"outline",onClick:lt,children:"Fechar"})})]})})]})}function _U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function NU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_U(Object(r),!0).forEach(function(n){gje(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_U(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tc(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var SU=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),wk=function(){return Math.random().toString(36).substring(7).split("").join(".")},CU={INIT:"@@redux/INIT"+wk(),REPLACE:"@@redux/REPLACE"+wk(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+wk()}};function TZe(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Uae(e,t,r){var n;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Tc(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Tc(1));return r(Uae)(e,t)}if(typeof e!="function")throw new Error(Tc(2));var s=e,o=t,i=[],l=i,c=!1;function d(){l===i&&(l=i.slice())}function u(){if(c)throw new Error(Tc(3));return o}function f(g){if(typeof g!="function")throw new Error(Tc(4));if(c)throw new Error(Tc(5));var v=!0;return d(),l.push(g),function(){if(v){if(c)throw new Error(Tc(6));v=!1,d();var b=l.indexOf(g);l.splice(b,1),i=null}}}function h(g){if(!TZe(g))throw new Error(Tc(7));if(typeof g.type>"u")throw new Error(Tc(8));if(c)throw new Error(Tc(9));try{c=!0,o=s(o,g)}finally{c=!1}for(var v=i=l,y=0;y<v.length;y++){var b=v[y];b()}return g}function m(g){if(typeof g!="function")throw new Error(Tc(10));s=g,h({type:CU.REPLACE})}function x(){var g,v=f;return g={subscribe:function(b){if(typeof b!="object"||b===null)throw new Error(Tc(11));function w(){b.next&&b.next(u())}w();var j=v(w);return{unsubscribe:j}}},g[SU]=function(){return this},g}return h({type:CU.INIT}),n={dispatch:h,subscribe:f,getState:u,replaceReducer:m},n[SU]=x,n}function AU(e,t){return function(){return t(e.apply(this,arguments))}}function PU(e,t){if(typeof e=="function")return AU(e,t);if(typeof e!="object"||e===null)throw new Error(Tc(16));var r={};for(var n in e){var s=e[n];typeof s=="function"&&(r[n]=AU(s,t))}return r}function Vae(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?function(n){return n}:t.length===1?t[0]:t.reduce(function(n,s){return function(){return n(s.apply(void 0,arguments))}})}function DZe(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return function(){var s=n.apply(void 0,arguments),o=function(){throw new Error(Tc(15))},i={getState:s.getState,dispatch:function(){return o.apply(void 0,arguments)}},l=t.map(function(c){return c(i)});return o=Vae.apply(void 0,l)(s.dispatch),NU(NU({},s),{},{dispatch:o})}}}var Wae=Ce.createContext(null);function MZe(e){e()}var Hae=MZe,RZe=function(t){return Hae=t},FZe=function(){return Hae};function LZe(){var e=FZe(),t=null,r=null;return{clear:function(){t=null,r=null},notify:function(){e(function(){for(var s=t;s;)s.callback(),s=s.next})},get:function(){for(var s=[],o=t;o;)s.push(o),o=o.next;return s},subscribe:function(s){var o=!0,i=r={callback:s,next:null,prev:r};return i.prev?i.prev.next=i:t=i,function(){!o||t===null||(o=!1,i.next?i.next.prev=i.prev:r=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}var EU={notify:function(){},get:function(){return[]}};function Gae(e,t){var r,n=EU;function s(f){return c(),n.subscribe(f)}function o(){n.notify()}function i(){u.onStateChange&&u.onStateChange()}function l(){return!!r}function c(){r||(r=t?t.addNestedSub(i):e.subscribe(i),n=LZe())}function d(){r&&(r(),r=void 0,n.clear(),n=EU)}var u={addNestedSub:s,notifyNestedSubs:o,handleChangeWrapper:i,isSubscribed:l,trySubscribe:c,tryUnsubscribe:d,getListeners:function(){return n}};return u}var Kae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?p.useLayoutEffect:p.useEffect;function $Ze(e){var t=e.store,r=e.context,n=e.children,s=p.useMemo(function(){var l=Gae(t);return{store:t,subscription:l}},[t]),o=p.useMemo(function(){return t.getState()},[t]);Kae(function(){var l=s.subscription;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==t.getState()&&l.notifyNestedSubs(),function(){l.tryUnsubscribe(),l.onStateChange=null}},[s,o]);var i=r||Wae;return Ce.createElement(i.Provider,{value:s},n)}var Xae={exports:{}},go={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pl=typeof Symbol=="function"&&Symbol.for,VR=pl?Symbol.for("react.element"):60103,WR=pl?Symbol.for("react.portal"):60106,SA=pl?Symbol.for("react.fragment"):60107,CA=pl?Symbol.for("react.strict_mode"):60108,AA=pl?Symbol.for("react.profiler"):60114,PA=pl?Symbol.for("react.provider"):60109,EA=pl?Symbol.for("react.context"):60110,HR=pl?Symbol.for("react.async_mode"):60111,kA=pl?Symbol.for("react.concurrent_mode"):60111,IA=pl?Symbol.for("react.forward_ref"):60112,OA=pl?Symbol.for("react.suspense"):60113,BZe=pl?Symbol.for("react.suspense_list"):60120,TA=pl?Symbol.for("react.memo"):60115,DA=pl?Symbol.for("react.lazy"):60116,qZe=pl?Symbol.for("react.block"):60121,zZe=pl?Symbol.for("react.fundamental"):60117,UZe=pl?Symbol.for("react.responder"):60118,VZe=pl?Symbol.for("react.scope"):60119;function Bd(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case VR:switch(e=e.type,e){case HR:case kA:case SA:case AA:case CA:case OA:return e;default:switch(e=e&&e.$$typeof,e){case EA:case IA:case DA:case TA:case PA:return e;default:return t}}case WR:return t}}}function Yae(e){return Bd(e)===kA}go.AsyncMode=HR;go.ConcurrentMode=kA;go.ContextConsumer=EA;go.ContextProvider=PA;go.Element=VR;go.ForwardRef=IA;go.Fragment=SA;go.Lazy=DA;go.Memo=TA;go.Portal=WR;go.Profiler=AA;go.StrictMode=CA;go.Suspense=OA;go.isAsyncMode=function(e){return Yae(e)||Bd(e)===HR};go.isConcurrentMode=Yae;go.isContextConsumer=function(e){return Bd(e)===EA};go.isContextProvider=function(e){return Bd(e)===PA};go.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===VR};go.isForwardRef=function(e){return Bd(e)===IA};go.isFragment=function(e){return Bd(e)===SA};go.isLazy=function(e){return Bd(e)===DA};go.isMemo=function(e){return Bd(e)===TA};go.isPortal=function(e){return Bd(e)===WR};go.isProfiler=function(e){return Bd(e)===AA};go.isStrictMode=function(e){return Bd(e)===CA};go.isSuspense=function(e){return Bd(e)===OA};go.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===SA||e===kA||e===AA||e===CA||e===OA||e===BZe||typeof e=="object"&&e!==null&&(e.$$typeof===DA||e.$$typeof===TA||e.$$typeof===PA||e.$$typeof===EA||e.$$typeof===IA||e.$$typeof===zZe||e.$$typeof===UZe||e.$$typeof===VZe||e.$$typeof===qZe)};go.typeOf=Bd;Xae.exports=go;var WZe=Xae.exports,GR=WZe,HZe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},GZe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},KZe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Jae={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},KR={};KR[GR.ForwardRef]=KZe;KR[GR.Memo]=Jae;function kU(e){return GR.isMemo(e)?Jae:KR[e.$$typeof]||HZe}var XZe=Object.defineProperty,YZe=Object.getOwnPropertyNames,IU=Object.getOwnPropertySymbols,JZe=Object.getOwnPropertyDescriptor,QZe=Object.getPrototypeOf,OU=Object.prototype;function Qae(e,t,r){if(typeof t!="string"){if(OU){var n=QZe(t);n&&n!==OU&&Qae(e,n,r)}var s=YZe(t);IU&&(s=s.concat(IU(t)));for(var o=kU(e),i=kU(t),l=0;l<s.length;++l){var c=s[l];if(!GZe[c]&&!(r&&r[c])&&!(i&&i[c])&&!(o&&o[c])){var d=JZe(t,c);try{XZe(e,c,d)}catch{}}}}return e}var ZZe=Qae;const TU=Us(ZZe);var Zae={exports:{}},No={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MA=60103,RA=60106,Sj=60107,Cj=60108,Aj=60114,Pj=60109,Ej=60110,kj=60112,Ij=60113,XR=60120,Oj=60115,Tj=60116,ese=60121,tse=60122,rse=60117,nse=60129,ase=60131;if(typeof Symbol=="function"&&Symbol.for){var _l=Symbol.for;MA=_l("react.element"),RA=_l("react.portal"),Sj=_l("react.fragment"),Cj=_l("react.strict_mode"),Aj=_l("react.profiler"),Pj=_l("react.provider"),Ej=_l("react.context"),kj=_l("react.forward_ref"),Ij=_l("react.suspense"),XR=_l("react.suspense_list"),Oj=_l("react.memo"),Tj=_l("react.lazy"),ese=_l("react.block"),tse=_l("react.server.block"),rse=_l("react.fundamental"),nse=_l("react.debug_trace_mode"),ase=_l("react.legacy_hidden")}function gf(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case MA:switch(e=e.type,e){case Sj:case Aj:case Cj:case Ij:case XR:return e;default:switch(e=e&&e.$$typeof,e){case Ej:case kj:case Tj:case Oj:case Pj:return e;default:return t}}case RA:return t}}}var eet=Pj,tet=MA,ret=kj,net=Sj,aet=Tj,set=Oj,oet=RA,iet=Aj,cet=Cj,det=Ij;No.ContextConsumer=Ej;No.ContextProvider=eet;No.Element=tet;No.ForwardRef=ret;No.Fragment=net;No.Lazy=aet;No.Memo=set;No.Portal=oet;No.Profiler=iet;No.StrictMode=cet;No.Suspense=det;No.isAsyncMode=function(){return!1};No.isConcurrentMode=function(){return!1};No.isContextConsumer=function(e){return gf(e)===Ej};No.isContextProvider=function(e){return gf(e)===Pj};No.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===MA};No.isForwardRef=function(e){return gf(e)===kj};No.isFragment=function(e){return gf(e)===Sj};No.isLazy=function(e){return gf(e)===Tj};No.isMemo=function(e){return gf(e)===Oj};No.isPortal=function(e){return gf(e)===RA};No.isProfiler=function(e){return gf(e)===Aj};No.isStrictMode=function(e){return gf(e)===Cj};No.isSuspense=function(e){return gf(e)===Ij};No.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Sj||e===Aj||e===nse||e===Cj||e===Ij||e===XR||e===ase||typeof e=="object"&&e!==null&&(e.$$typeof===Tj||e.$$typeof===Oj||e.$$typeof===Pj||e.$$typeof===Ej||e.$$typeof===kj||e.$$typeof===rse||e.$$typeof===ese||e[0]===tse)};No.typeOf=gf;Zae.exports=No;var uet=Zae.exports,fet=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],met=["reactReduxForwardedRef"],het=[],pet=[null,null];function get(e,t){var r=e[1];return[t.payload,r+1]}function DU(e,t,r){Kae(function(){return e.apply(void 0,t)},r)}function xet(e,t,r,n,s,o,i){e.current=n,t.current=s,r.current=!1,o.current&&(o.current=null,i())}function vet(e,t,r,n,s,o,i,l,c,d){if(e){var u=!1,f=null,h=function(){if(!u){var g=t.getState(),v,y;try{v=n(g,s.current)}catch(b){y=b,f=b}y||(f=null),v===o.current?i.current||c():(o.current=v,l.current=v,i.current=!0,d({type:"STORE_UPDATED",payload:{error:y}}))}};r.onStateChange=h,r.trySubscribe(),h();var m=function(){if(u=!0,r.tryUnsubscribe(),r.onStateChange=null,f)throw f};return m}}var yet=function(){return[null,0]};function bet(e,t){t===void 0&&(t={});var r=t,n=r.getDisplayName,s=n===void 0?function(w){return"ConnectAdvanced("+w+")"}:n,o=r.methodName,i=o===void 0?"connectAdvanced":o,l=r.renderCountProp,c=l===void 0?void 0:l,d=r.shouldHandleStateChanges,u=d===void 0?!0:d,f=r.storeKey,h=f===void 0?"store":f;r.withRef;var m=r.forwardRef,x=m===void 0?!1:m,g=r.context,v=g===void 0?Wae:g,y=_S(r,fet),b=v;return function(j){var _=j.displayName||j.name||"Component",C=s(_),E=Ka({},y,{getDisplayName:s,methodName:i,renderCountProp:c,shouldHandleStateChanges:u,storeKey:h,displayName:C,wrappedComponentName:_,WrappedComponent:j}),S=y.pure;function A(k){return e(k.dispatch,E)}var M=S?p.useMemo:function(k){return k()};function O(k){var q=p.useMemo(function(){var bt=k.reactReduxForwardedRef,Lt=_S(k,met);return[k.context,bt,Lt]},[k]),B=q[0],z=q[1],F=q[2],V=p.useMemo(function(){return B&&B.Consumer&&uet.isContextConsumer(Ce.createElement(B.Consumer,null))?B:b},[B,b]),me=p.useContext(V),be=!!k.store&&!!k.store.getState&&!!k.store.dispatch;me&&me.store;var U=be?k.store:me.store,L=p.useMemo(function(){return A(U)},[U]),H=p.useMemo(function(){if(!u)return pet;var bt=Gae(U,be?null:me.subscription),Lt=bt.notifyNestedSubs.bind(bt);return[bt,Lt]},[U,be,me]),ie=H[0],Y=H[1],W=p.useMemo(function(){return be?me:Ka({},me,{subscription:ie})},[be,me,ie]),se=p.useReducer(get,het,yet),pe=se[0],G=pe[0],te=se[1];if(G&&G.error)throw G.error;var oe=p.useRef(),De=p.useRef(F),re=p.useRef(),ae=p.useRef(!1),ut=M(function(){return re.current&&F===De.current?re.current:L(U.getState(),F)},[U,G,F]);DU(xet,[De,oe,ae,F,ut,re,Y]),DU(vet,[u,U,ie,L,De,oe,ae,re,Y,te],[U,ie,L]);var pt=p.useMemo(function(){return Ce.createElement(j,Ka({},ut,{ref:z}))},[z,j,ut]),ft=p.useMemo(function(){return u?Ce.createElement(V.Provider,{value:W},pt):pt},[V,pt,W]);return ft}var I=S?Ce.memo(O):O;if(I.WrappedComponent=j,I.displayName=O.displayName=C,x){var T=Ce.forwardRef(function(q,B){return Ce.createElement(I,Ka({},q,{reactReduxForwardedRef:B}))});return T.displayName=C,T.WrappedComponent=j,TU(T,j)}return TU(I,j)}}function MU(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function jk(e,t){if(MU(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var s=0;s<r.length;s++)if(!Object.prototype.hasOwnProperty.call(t,r[s])||!MU(e[r[s]],t[r[s]]))return!1;return!0}function wet(e,t){var r={},n=function(i){var l=e[i];typeof l=="function"&&(r[i]=function(){return t(l.apply(void 0,arguments))})};for(var s in e)n(s);return r}function YR(e){return function(r,n){var s=e(r,n);function o(){return s}return o.dependsOnOwnProps=!1,o}}function RU(e){return e.dependsOnOwnProps!==null&&e.dependsOnOwnProps!==void 0?!!e.dependsOnOwnProps:e.length!==1}function sse(e,t){return function(n,s){s.displayName;var o=function(l,c){return o.dependsOnOwnProps?o.mapToProps(l,c):o.mapToProps(l)};return o.dependsOnOwnProps=!0,o.mapToProps=function(l,c){o.mapToProps=e,o.dependsOnOwnProps=RU(e);var d=o(l,c);return typeof d=="function"&&(o.mapToProps=d,o.dependsOnOwnProps=RU(d),d=o(l,c)),d},o}}function jet(e){return typeof e=="function"?sse(e):void 0}function _et(e){return e?void 0:YR(function(t){return{dispatch:t}})}function Net(e){return e&&typeof e=="object"?YR(function(t){return wet(e,t)}):void 0}const Cet=[jet,_et,Net];function Aet(e){return typeof e=="function"?sse(e):void 0}function Pet(e){return e?void 0:YR(function(){return{}})}const Eet=[Aet,Pet];function ket(e,t,r){return Ka({},r,e,t)}function Iet(e){return function(r,n){n.displayName;var s=n.pure,o=n.areMergedPropsEqual,i=!1,l;return function(d,u,f){var h=e(d,u,f);return i?(!s||!o(h,l))&&(l=h):(i=!0,l=h),l}}}function Oet(e){return typeof e=="function"?Iet(e):void 0}function Tet(e){return e?void 0:function(){return ket}}const Det=[Oet,Tet];var Met=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function Ret(e,t,r,n){return function(o,i){return r(e(o,i),t(n,i),i)}}function Fet(e,t,r,n,s){var o=s.areStatesEqual,i=s.areOwnPropsEqual,l=s.areStatePropsEqual,c=!1,d,u,f,h,m;function x(w,j){return d=w,u=j,f=e(d,u),h=t(n,u),m=r(f,h,u),c=!0,m}function g(){return f=e(d,u),t.dependsOnOwnProps&&(h=t(n,u)),m=r(f,h,u),m}function v(){return e.dependsOnOwnProps&&(f=e(d,u)),t.dependsOnOwnProps&&(h=t(n,u)),m=r(f,h,u),m}function y(){var w=e(d,u),j=!l(w,f);return f=w,j&&(m=r(f,h,u)),m}function b(w,j){var _=!i(j,u),C=!o(w,d,j,u);return d=w,u=j,_&&C?g():_?v():C?y():m}return function(j,_){return c?b(j,_):x(j,_)}}function Let(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,s=t.initMergeProps,o=_S(t,Met),i=r(e,o),l=n(e,o),c=s(e,o),d=o.pure?Fet:Ret;return d(i,l,c,e,o)}var $et=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function _k(e,t,r){for(var n=t.length-1;n>=0;n--){var s=t[n](e);if(s)return s}return function(o,i){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+i.wrappedComponentName+".")}}function Bet(e,t){return e===t}function qet(e){var t=e===void 0?{}:e,r=t.connectHOC,n=r===void 0?bet:r,s=t.mapStateToPropsFactories,o=s===void 0?Eet:s,i=t.mapDispatchToPropsFactories,l=i===void 0?Cet:i,c=t.mergePropsFactories,d=c===void 0?Det:c,u=t.selectorFactory,f=u===void 0?Let:u;return function(m,x,g,v){v===void 0&&(v={});var y=v,b=y.pure,w=b===void 0?!0:b,j=y.areStatesEqual,_=j===void 0?Bet:j,C=y.areOwnPropsEqual,E=C===void 0?jk:C,S=y.areStatePropsEqual,A=S===void 0?jk:S,M=y.areMergedPropsEqual,O=M===void 0?jk:M,I=_S(y,$et),T=_k(m,o,"mapStateToProps"),k=_k(x,l,"mapDispatchToProps"),q=_k(g,d,"mergeProps");return n(f,Ka({methodName:"connect",getDisplayName:function(z){return"Connect("+z+")"},shouldHandleStateChanges:!!m,initMapStateToProps:T,initMapDispatchToProps:k,initMergeProps:q,pure:w,areStatesEqual:_,areOwnPropsEqual:E,areStatePropsEqual:A,areMergedPropsEqual:O},I))}}const ose=qet();RZe(Km.unstable_batchedUpdates);function zet(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function ise(e,t){var r=p.useState(function(){return{inputs:t,result:e()}})[0],n=p.useRef(!0),s=p.useRef(r),o=n.current||!!(t&&s.current.inputs&&zet(t,s.current.inputs)),i=o?s.current:{inputs:t,result:e()};return p.useEffect(function(){n.current=!1,s.current=i},[i]),i.result}function Uet(e,t){return ise(function(){return e},t)}var Gs=ise,Ba=Uet,Ju=function(t){var r=t.top,n=t.right,s=t.bottom,o=t.left,i=n-o,l=s-r,c={top:r,right:n,bottom:s,left:o,width:i,height:l,x:o,y:r,center:{x:(n+o)/2,y:(s+r)/2}};return c},JR=function(t,r){return{top:t.top-r.top,left:t.left-r.left,bottom:t.bottom+r.bottom,right:t.right+r.right}},FU=function(t,r){return{top:t.top+r.top,left:t.left+r.left,bottom:t.bottom-r.bottom,right:t.right-r.right}},Vet=function(t,r){return{top:t.top+r.y,left:t.left+r.x,bottom:t.bottom+r.y,right:t.right+r.x}},Nk={top:0,right:0,bottom:0,left:0},QR=function(t){var r=t.borderBox,n=t.margin,s=n===void 0?Nk:n,o=t.border,i=o===void 0?Nk:o,l=t.padding,c=l===void 0?Nk:l,d=Ju(JR(r,s)),u=Ju(FU(r,i)),f=Ju(FU(u,c));return{marginBox:d,borderBox:Ju(r),paddingBox:u,contentBox:f,margin:s,border:i,padding:c}},Yd=function(t){var r=t.slice(0,-2),n=t.slice(-2);if(n!=="px")return 0;var s=Number(r);return isNaN(s)&&vp(!1),s},Wet=function(){return{x:window.pageXOffset,y:window.pageYOffset}},iC=function(t,r){var n=t.borderBox,s=t.border,o=t.margin,i=t.padding,l=Vet(n,r);return QR({borderBox:l,border:s,margin:o,padding:i})},lC=function(t,r){return r===void 0&&(r=Wet()),iC(t,r)},lse=function(t,r){var n={top:Yd(r.marginTop),right:Yd(r.marginRight),bottom:Yd(r.marginBottom),left:Yd(r.marginLeft)},s={top:Yd(r.paddingTop),right:Yd(r.paddingRight),bottom:Yd(r.paddingBottom),left:Yd(r.paddingLeft)},o={top:Yd(r.borderTopWidth),right:Yd(r.borderRightWidth),bottom:Yd(r.borderBottomWidth),left:Yd(r.borderLeftWidth)};return QR({borderBox:t,margin:n,padding:s,border:o})},cse=function(t){var r=t.getBoundingClientRect(),n=window.getComputedStyle(t);return lse(r,n)},LU=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function Het(e,t){return!!(e===t||LU(e)&&LU(t))}function Get(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!Het(e[r],t[r]))return!1;return!0}function fl(e,t){t===void 0&&(t=Get);var r,n=[],s,o=!1;function i(){for(var l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];return o&&r===this&&t(l,n)||(s=e.apply(this,l),o=!0,r=this,n=l),s}return i}var Ket=function(t){var r=[],n=null,s=function(){for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];r=l,!n&&(n=requestAnimationFrame(function(){n=null,t.apply(void 0,r)}))};return s.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},s};const L1=Ket;function dse(e,t){}dse.bind(null,"warn");dse.bind(null,"error");function lp(){}function Xet(e,t){return Ka({},e,{},t)}function mu(e,t,r){var n=t.map(function(s){var o=Xet(r,s.options);return e.addEventListener(s.eventName,s.fn,o),function(){e.removeEventListener(s.eventName,s.fn,o)}});return function(){n.forEach(function(o){o()})}}var Yet="Invariant failed";function cC(e){this.message=e}cC.prototype.toString=function(){return this.message};function Gn(e,t){if(!e)throw new cC(Yet)}var Jet=function(e){qZ(t,e);function t(){for(var n,s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.callbacks=null,n.unbind=lp,n.onWindowError=function(l){var c=n.getCallbacks();c.isDragging()&&c.tryAbort();var d=l.error;d instanceof cC&&l.preventDefault()},n.getCallbacks=function(){if(!n.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return n.callbacks},n.setCallbacks=function(l){n.callbacks=l},n}var r=t.prototype;return r.componentDidMount=function(){this.unbind=mu(window,[{eventName:"error",fn:this.onWindowError}])},r.componentDidCatch=function(s){if(s instanceof cC){this.setState({});return}throw s},r.componentWillUnmount=function(){this.unbind()},r.render=function(){return this.props.children(this.setCallbacks)},t}(Ce.Component),Qet=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,dC=function(t){return t+1},Zet=function(t){return`
  You have lifted an item in position `+dC(t.source.index)+`
`},use=function(t,r){var n=t.droppableId===r.droppableId,s=dC(t.index),o=dC(r.index);return n?`
      You have moved the item from position `+s+`
      to position `+o+`
    `:`
    You have moved the item from position `+s+`
    in list `+t.droppableId+`
    to list `+r.droppableId+`
    in position `+o+`
  `},fse=function(t,r,n){var s=r.droppableId===n.droppableId;return s?`
      The item `+t+`
      has been combined with `+n.draggableId:`
      The item `+t+`
      in list `+r.droppableId+`
      has been combined with `+n.draggableId+`
      in list `+n.droppableId+`
    `},ett=function(t){var r=t.destination;if(r)return use(t.source,r);var n=t.combine;return n?fse(t.draggableId,t.source,n):"You are over an area that cannot be dropped on"},$U=function(t){return`
  The item has returned to its starting position
  of `+dC(t.index)+`
`},ttt=function(t){if(t.reason==="CANCEL")return`
      Movement cancelled.
      `+$U(t.source)+`
    `;var r=t.destination,n=t.combine;return r?`
      You have dropped the item.
      `+use(t.source,r)+`
    `:n?`
      You have dropped the item.
      `+fse(t.draggableId,t.source,n)+`
    `:`
    The item has been dropped while not over a drop area.
    `+$U(t.source)+`
  `},U2={dragHandleUsageInstructions:Qet,onDragStart:Zet,onDragUpdate:ett,onDragEnd:ttt},ml={x:0,y:0},Al=function(t,r){return{x:t.x+r.x,y:t.y+r.y}},Cd=function(t,r){return{x:t.x-r.x,y:t.y-r.y}},cp=function(t,r){return t.x===r.x&&t.y===r.y},Ay=function(t){return{x:t.x!==0?-t.x:0,y:t.y!==0?-t.y:0}},dx=function(t,r,n){var s;return n===void 0&&(n=0),s={},s[t]=r,s[t==="x"?"y":"x"]=n,s},$1=function(t,r){return Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))},BU=function(t,r){return Math.min.apply(Math,r.map(function(n){return $1(t,n)}))},mse=function(t){return function(r){return{x:t(r.x),y:t(r.y)}}},rtt=function(e,t){var r=Ju({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return r.width<=0||r.height<=0?null:r},Dj=function(t,r){return{top:t.top+r.y,left:t.left+r.x,bottom:t.bottom+r.y,right:t.right+r.x}},qU=function(t){return[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.bottom}]},ntt={top:0,right:0,bottom:0,left:0},att=function(t,r){return r?Dj(t,r.scroll.diff.displacement):t},stt=function(t,r,n){if(n&&n.increasedBy){var s;return Ka({},t,(s={},s[r.end]=t[r.end]+n.increasedBy[r.line],s))}return t},ott=function(t,r){return r&&r.shouldClipSubject?rtt(r.pageMarginBox,t):Ju(t)},G0=function(e){var t=e.page,r=e.withPlaceholder,n=e.axis,s=e.frame,o=att(t.marginBox,s),i=stt(o,n,r),l=ott(i,s);return{page:t,withPlaceholder:r,active:l}},ZR=function(e,t){e.frame||Gn(!1);var r=e.frame,n=Cd(t,r.scroll.initial),s=Ay(n),o=Ka({},r,{scroll:{initial:r.scroll.initial,current:t,diff:{value:n,displacement:s},max:r.scroll.max}}),i=G0({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:o}),l=Ka({},e,{frame:o,subject:i});return l};function uC(e){return Object.values?Object.values(e):Object.keys(e).map(function(t){return e[t]})}function eF(e,t){if(e.findIndex)return e.findIndex(t);for(var r=0;r<e.length;r++)if(t(e[r]))return r;return-1}function Lp(e,t){if(e.find)return e.find(t);var r=eF(e,t);if(r!==-1)return e[r]}function hse(e){return Array.prototype.slice.call(e)}var pse=fl(function(e){return e.reduce(function(t,r){return t[r.descriptor.id]=r,t},{})}),gse=fl(function(e){return e.reduce(function(t,r){return t[r.descriptor.id]=r,t},{})}),FA=fl(function(e){return uC(e)}),itt=fl(function(e){return uC(e)}),Py=fl(function(e,t){var r=itt(t).filter(function(n){return e===n.descriptor.droppableId}).sort(function(n,s){return n.descriptor.index-s.descriptor.index});return r});function tF(e){return e.at&&e.at.type==="REORDER"?e.at.destination:null}function LA(e){return e.at&&e.at.type==="COMBINE"?e.at.combine:null}var $A=fl(function(e,t){return t.filter(function(r){return r.descriptor.id!==e.descriptor.id})}),ltt=function(e){var t=e.isMovingForward,r=e.draggable,n=e.destination,s=e.insideDestination,o=e.previousImpact;if(!n.isCombineEnabled)return null;var i=tF(o);if(!i)return null;function l(g){var v={type:"COMBINE",combine:{draggableId:g,droppableId:n.descriptor.id}};return Ka({},o,{at:v})}var c=o.displaced.all,d=c.length?c[0]:null;if(t)return d?l(d):null;var u=$A(r,s);if(!d){if(!u.length)return null;var f=u[u.length-1];return l(f.descriptor.id)}var h=eF(u,function(g){return g.descriptor.id===d});h===-1&&Gn(!1);var m=h-1;if(m<0)return null;var x=u[m];return l(x.descriptor.id)},Ey=function(e,t){return e.descriptor.droppableId===t.descriptor.id},xse={point:ml,value:0},B1={invisible:{},visible:{},all:[]},ctt={displaced:B1,displacedBy:xse,at:null},xu=function(e,t){return function(r){return e<=r&&r<=t}},vse=function(e){var t=xu(e.top,e.bottom),r=xu(e.left,e.right);return function(n){var s=t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right);if(s)return!0;var o=t(n.top)||t(n.bottom),i=r(n.left)||r(n.right),l=o&&i;if(l)return!0;var c=n.top<e.top&&n.bottom>e.bottom,d=n.left<e.left&&n.right>e.right,u=c&&d;if(u)return!0;var f=c&&i||d&&o;return f}},dtt=function(e){var t=xu(e.top,e.bottom),r=xu(e.left,e.right);return function(n){var s=t(n.top)&&t(n.bottom)&&r(n.left)&&r(n.right);return s}},rF={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},yse={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},utt=function(e){return function(t){var r=xu(t.top,t.bottom),n=xu(t.left,t.right);return function(s){return e===rF?r(s.top)&&r(s.bottom):n(s.left)&&n(s.right)}}},ftt=function(t,r){var n=r.frame?r.frame.scroll.diff.displacement:ml;return Dj(t,n)},mtt=function(t,r,n){return r.subject.active?n(r.subject.active)(t):!1},htt=function(t,r,n){return n(r)(t)},nF=function(t){var r=t.target,n=t.destination,s=t.viewport,o=t.withDroppableDisplacement,i=t.isVisibleThroughFrameFn,l=o?ftt(r,n):r;return mtt(l,n,i)&&htt(l,s,i)},ptt=function(t){return nF(Ka({},t,{isVisibleThroughFrameFn:vse}))},bse=function(t){return nF(Ka({},t,{isVisibleThroughFrameFn:dtt}))},gtt=function(t){return nF(Ka({},t,{isVisibleThroughFrameFn:utt(t.destination.axis)}))},xtt=function(t,r,n){if(typeof n=="boolean")return n;if(!r)return!0;var s=r.invisible,o=r.visible;if(s[t])return!1;var i=o[t];return i?i.shouldAnimate:!0};function vtt(e,t){var r=e.page.marginBox,n={top:t.point.y,right:0,bottom:0,left:t.point.x};return Ju(JR(r,n))}function q1(e){var t=e.afterDragging,r=e.destination,n=e.displacedBy,s=e.viewport,o=e.forceShouldAnimate,i=e.last;return t.reduce(function(c,d){var u=vtt(d,n),f=d.descriptor.id;c.all.push(f);var h=ptt({target:u,destination:r,viewport:s,withDroppableDisplacement:!0});if(!h)return c.invisible[d.descriptor.id]=!0,c;var m=xtt(f,i,o),x={draggableId:f,shouldAnimate:m};return c.visible[f]=x,c},{all:[],visible:{},invisible:{}})}function ytt(e,t){if(!e.length)return 0;var r=e[e.length-1].descriptor.index;return t.inHomeList?r:r+1}function zU(e){var t=e.insideDestination,r=e.inHomeList,n=e.displacedBy,s=e.destination,o=ytt(t,{inHomeList:r});return{displaced:B1,displacedBy:n,at:{type:"REORDER",destination:{droppableId:s.descriptor.id,index:o}}}}function fC(e){var t=e.draggable,r=e.insideDestination,n=e.destination,s=e.viewport,o=e.displacedBy,i=e.last,l=e.index,c=e.forceShouldAnimate,d=Ey(t,n);if(l==null)return zU({insideDestination:r,inHomeList:d,displacedBy:o,destination:n});var u=Lp(r,function(g){return g.descriptor.index===l});if(!u)return zU({insideDestination:r,inHomeList:d,displacedBy:o,destination:n});var f=$A(t,r),h=r.indexOf(u),m=f.slice(h),x=q1({afterDragging:m,destination:n,displacedBy:o,last:i,viewport:s.frame,forceShouldAnimate:c});return{displaced:x,displacedBy:o,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:l}}}}function _p(e,t){return!!t.effected[e]}var btt=function(e){var t=e.isMovingForward,r=e.destination,n=e.draggables,s=e.combine,o=e.afterCritical;if(!r.isCombineEnabled)return null;var i=s.draggableId,l=n[i],c=l.descriptor.index,d=_p(i,o);return d?t?c:c-1:t?c+1:c},wtt=function(e){var t=e.isMovingForward,r=e.isInHomeList,n=e.insideDestination,s=e.location;if(!n.length)return null;var o=s.index,i=t?o+1:o-1,l=n[0].descriptor.index,c=n[n.length-1].descriptor.index,d=r?c:c+1;return i<l||i>d?null:i},jtt=function(e){var t=e.isMovingForward,r=e.isInHomeList,n=e.draggable,s=e.draggables,o=e.destination,i=e.insideDestination,l=e.previousImpact,c=e.viewport,d=e.afterCritical,u=l.at;if(u||Gn(!1),u.type==="REORDER"){var f=wtt({isMovingForward:t,isInHomeList:r,location:u.destination,insideDestination:i});return f==null?null:fC({draggable:n,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:f})}var h=btt({isMovingForward:t,destination:o,displaced:l.displaced,draggables:s,combine:u.combine,afterCritical:d});return h==null?null:fC({draggable:n,insideDestination:i,destination:o,viewport:c,last:l.displaced,displacedBy:l.displacedBy,index:h})},_tt=function(e){var t=e.displaced,r=e.afterCritical,n=e.combineWith,s=e.displacedBy,o=!!(t.visible[n]||t.invisible[n]);return _p(n,r)?o?ml:Ay(s.point):o?s.point:ml},Ntt=function(e){var t=e.afterCritical,r=e.impact,n=e.draggables,s=LA(r);s||Gn(!1);var o=s.draggableId,i=n[o].page.borderBox.center,l=_tt({displaced:r.displaced,afterCritical:t,combineWith:o,displacedBy:r.displacedBy});return Al(i,l)},wse=function(t,r){return r.margin[t.start]+r.borderBox[t.size]/2},Stt=function(t,r){return r.margin[t.end]+r.borderBox[t.size]/2},aF=function(t,r,n){return r[t.crossAxisStart]+n.margin[t.crossAxisStart]+n.borderBox[t.crossAxisSize]/2},UU=function(t){var r=t.axis,n=t.moveRelativeTo,s=t.isMoving;return dx(r.line,n.marginBox[r.end]+wse(r,s),aF(r,n.marginBox,s))},VU=function(t){var r=t.axis,n=t.moveRelativeTo,s=t.isMoving;return dx(r.line,n.marginBox[r.start]-Stt(r,s),aF(r,n.marginBox,s))},Ctt=function(t){var r=t.axis,n=t.moveInto,s=t.isMoving;return dx(r.line,n.contentBox[r.start]+wse(r,s),aF(r,n.contentBox,s))},Att=function(e){var t=e.impact,r=e.draggable,n=e.draggables,s=e.droppable,o=e.afterCritical,i=Py(s.descriptor.id,n),l=r.page,c=s.axis;if(!i.length)return Ctt({axis:c,moveInto:s.page,isMoving:l});var d=t.displaced,u=t.displacedBy,f=d.all[0];if(f){var h=n[f];if(_p(f,o))return VU({axis:c,moveRelativeTo:h.page,isMoving:l});var m=iC(h.page,u.point);return VU({axis:c,moveRelativeTo:m,isMoving:l})}var x=i[i.length-1];if(x.descriptor.id===r.descriptor.id)return l.borderBox.center;if(_p(x.descriptor.id,o)){var g=iC(x.page,Ay(o.displacedBy.point));return UU({axis:c,moveRelativeTo:g,isMoving:l})}return UU({axis:c,moveRelativeTo:x.page,isMoving:l})},O3=function(e,t){var r=e.frame;return r?Al(t,r.scroll.diff.displacement):t},Ptt=function(t){var r=t.impact,n=t.draggable,s=t.droppable,o=t.draggables,i=t.afterCritical,l=n.page.borderBox.center,c=r.at;return!s||!c?l:c.type==="REORDER"?Att({impact:r,draggable:n,draggables:o,droppable:s,afterCritical:i}):Ntt({impact:r,draggables:o,afterCritical:i})},BA=function(e){var t=Ptt(e),r=e.droppable,n=r?O3(r,t):t;return n},jse=function(e,t){var r=Cd(t,e.scroll.initial),n=Ay(r),s=Ju({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),o={frame:s,scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:r,displacement:n}}};return o};function WU(e,t){return e.map(function(r){return t[r]})}function Ett(e,t){for(var r=0;r<t.length;r++){var n=t[r].visible[e];if(n)return n}return null}var ktt=function(e){var t=e.impact,r=e.viewport,n=e.destination,s=e.draggables,o=e.maxScrollChange,i=jse(r,Al(r.scroll.current,o)),l=n.frame?ZR(n,Al(n.frame.scroll.current,o)):n,c=t.displaced,d=q1({afterDragging:WU(c.all,s),destination:n,displacedBy:t.displacedBy,viewport:i.frame,last:c,forceShouldAnimate:!1}),u=q1({afterDragging:WU(c.all,s),destination:l,displacedBy:t.displacedBy,viewport:r.frame,last:c,forceShouldAnimate:!1}),f={},h={},m=[c,d,u];c.all.forEach(function(g){var v=Ett(g,m);if(v){h[g]=v;return}f[g]=!0});var x=Ka({},t,{displaced:{all:c.all,invisible:f,visible:h}});return x},Itt=function(e,t){return Al(e.scroll.diff.displacement,t)},sF=function(e){var t=e.pageBorderBoxCenter,r=e.draggable,n=e.viewport,s=Itt(n,t),o=Cd(s,r.page.borderBox.center);return Al(r.client.borderBox.center,o)},_se=function(e){var t=e.draggable,r=e.destination,n=e.newPageBorderBoxCenter,s=e.viewport,o=e.withDroppableDisplacement,i=e.onlyOnMainAxis,l=i===void 0?!1:i,c=Cd(n,t.page.borderBox.center),d=Dj(t.page.borderBox,c),u={target:d,destination:r,withDroppableDisplacement:o,viewport:s};return l?gtt(u):bse(u)},Ott=function(e){var t=e.isMovingForward,r=e.draggable,n=e.destination,s=e.draggables,o=e.previousImpact,i=e.viewport,l=e.previousPageBorderBoxCenter,c=e.previousClientSelection,d=e.afterCritical;if(!n.isEnabled)return null;var u=Py(n.descriptor.id,s),f=Ey(r,n),h=ltt({isMovingForward:t,draggable:r,destination:n,insideDestination:u,previousImpact:o})||jtt({isMovingForward:t,isInHomeList:f,draggable:r,draggables:s,destination:n,insideDestination:u,previousImpact:o,viewport:i,afterCritical:d});if(!h)return null;var m=BA({impact:h,draggable:r,droppable:n,draggables:s,afterCritical:d}),x=_se({draggable:r,destination:n,newPageBorderBoxCenter:m,viewport:i.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});if(x){var g=sF({pageBorderBoxCenter:m,draggable:r,viewport:i});return{clientSelection:g,impact:h,scrollJumpRequest:null}}var v=Cd(m,l),y=ktt({impact:h,viewport:i,destination:n,draggables:s,maxScrollChange:v});return{clientSelection:c,impact:y,scrollJumpRequest:v}},nc=function(t){var r=t.subject.active;return r||Gn(!1),r},Ttt=function(e){var t=e.isMovingForward,r=e.pageBorderBoxCenter,n=e.source,s=e.droppables,o=e.viewport,i=n.subject.active;if(!i)return null;var l=n.axis,c=xu(i[l.start],i[l.end]),d=FA(s).filter(function(f){return f!==n}).filter(function(f){return f.isEnabled}).filter(function(f){return!!f.subject.active}).filter(function(f){return vse(o.frame)(nc(f))}).filter(function(f){var h=nc(f);return t?i[l.crossAxisEnd]<h[l.crossAxisEnd]:h[l.crossAxisStart]<i[l.crossAxisStart]}).filter(function(f){var h=nc(f),m=xu(h[l.start],h[l.end]);return c(h[l.start])||c(h[l.end])||m(i[l.start])||m(i[l.end])}).sort(function(f,h){var m=nc(f)[l.crossAxisStart],x=nc(h)[l.crossAxisStart];return t?m-x:x-m}).filter(function(f,h,m){return nc(f)[l.crossAxisStart]===nc(m[0])[l.crossAxisStart]});if(!d.length)return null;if(d.length===1)return d[0];var u=d.filter(function(f){var h=xu(nc(f)[l.start],nc(f)[l.end]);return h(r[l.line])});return u.length===1?u[0]:u.length>1?u.sort(function(f,h){return nc(f)[l.start]-nc(h)[l.start]})[0]:d.sort(function(f,h){var m=BU(r,qU(nc(f))),x=BU(r,qU(nc(h)));return m!==x?m-x:nc(f)[l.start]-nc(h)[l.start]})[0]},HU=function(t,r){var n=t.page.borderBox.center;return _p(t.descriptor.id,r)?Cd(n,r.displacedBy.point):n},Dtt=function(t,r){var n=t.page.borderBox;return _p(t.descriptor.id,r)?Dj(n,Ay(r.displacedBy.point)):n},Mtt=function(e){var t=e.pageBorderBoxCenter,r=e.viewport,n=e.destination,s=e.insideDestination,o=e.afterCritical,i=s.filter(function(l){return bse({target:Dtt(l,o),destination:n,viewport:r.frame,withDroppableDisplacement:!0})}).sort(function(l,c){var d=$1(t,O3(n,HU(l,o))),u=$1(t,O3(n,HU(c,o)));return d<u?-1:u<d?1:l.descriptor.index-c.descriptor.index});return i[0]||null},Mj=fl(function(t,r){var n=r[t.line];return{value:n,point:dx(t.line,n)}}),Rtt=function(t,r,n){var s=t.axis;if(t.descriptor.mode==="virtual")return dx(s.line,r[s.line]);var o=t.subject.page.contentBox[s.size],i=Py(t.descriptor.id,n),l=i.reduce(function(u,f){return u+f.client.marginBox[s.size]},0),c=l+r[s.line],d=c-o;return d<=0?null:dx(s.line,d)},Nse=function(t,r){return Ka({},t,{scroll:Ka({},t.scroll,{max:r})})},Sse=function(t,r,n){var s=t.frame;Ey(r,t)&&Gn(!1),t.subject.withPlaceholder&&Gn(!1);var o=Mj(t.axis,r.displaceBy).point,i=Rtt(t,o,n),l={placeholderSize:o,increasedBy:i,oldFrameMaxScroll:t.frame?t.frame.scroll.max:null};if(!s){var c=G0({page:t.subject.page,withPlaceholder:l,axis:t.axis,frame:t.frame});return Ka({},t,{subject:c})}var d=i?Al(s.scroll.max,i):s.scroll.max,u=Nse(s,d),f=G0({page:t.subject.page,withPlaceholder:l,axis:t.axis,frame:u});return Ka({},t,{subject:f,frame:u})},Ftt=function(t){var r=t.subject.withPlaceholder;r||Gn(!1);var n=t.frame;if(!n){var s=G0({page:t.subject.page,axis:t.axis,frame:null,withPlaceholder:null});return Ka({},t,{subject:s})}var o=r.oldFrameMaxScroll;o||Gn(!1);var i=Nse(n,o),l=G0({page:t.subject.page,axis:t.axis,frame:i,withPlaceholder:null});return Ka({},t,{subject:l,frame:i})},Ltt=function(e){var t=e.previousPageBorderBoxCenter,r=e.moveRelativeTo,n=e.insideDestination,s=e.draggable,o=e.draggables,i=e.destination,l=e.viewport,c=e.afterCritical;if(!r){if(n.length)return null;var d={displaced:B1,displacedBy:xse,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:0}}},u=BA({impact:d,draggable:s,droppable:i,draggables:o,afterCritical:c}),f=Ey(s,i)?i:Sse(i,s,o),h=_se({draggable:s,destination:f,newPageBorderBoxCenter:u,viewport:l.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0});return h?d:null}var m=t[i.axis.line]<=r.page.borderBox.center[i.axis.line],x=function(){var v=r.descriptor.index;return r.descriptor.id===s.descriptor.id||m?v:v+1}(),g=Mj(i.axis,s.displaceBy);return fC({draggable:s,insideDestination:n,destination:i,viewport:l,displacedBy:g,last:B1,index:x})},$tt=function(e){var t=e.isMovingForward,r=e.previousPageBorderBoxCenter,n=e.draggable,s=e.isOver,o=e.draggables,i=e.droppables,l=e.viewport,c=e.afterCritical,d=Ttt({isMovingForward:t,pageBorderBoxCenter:r,source:s,droppables:i,viewport:l});if(!d)return null;var u=Py(d.descriptor.id,o),f=Mtt({pageBorderBoxCenter:r,viewport:l,destination:d,insideDestination:u,afterCritical:c}),h=Ltt({previousPageBorderBoxCenter:r,destination:d,draggable:n,draggables:o,moveRelativeTo:f,insideDestination:u,viewport:l,afterCritical:c});if(!h)return null;var m=BA({impact:h,draggable:n,droppable:d,draggables:o,afterCritical:c}),x=sF({pageBorderBoxCenter:m,draggable:n,viewport:l});return{clientSelection:x,impact:h,scrollJumpRequest:null}},Od=function(e){var t=e.at;return t?t.type==="REORDER"?t.destination.droppableId:t.combine.droppableId:null},Btt=function(t,r){var n=Od(t);return n?r[n]:null},qtt=function(e){var t=e.state,r=e.type,n=Btt(t.impact,t.dimensions.droppables),s=!!n,o=t.dimensions.droppables[t.critical.droppable.id],i=n||o,l=i.axis.direction,c=l==="vertical"&&(r==="MOVE_UP"||r==="MOVE_DOWN")||l==="horizontal"&&(r==="MOVE_LEFT"||r==="MOVE_RIGHT");if(c&&!s)return null;var d=r==="MOVE_DOWN"||r==="MOVE_RIGHT",u=t.dimensions.draggables[t.critical.draggable.id],f=t.current.page.borderBoxCenter,h=t.dimensions,m=h.draggables,x=h.droppables;return c?Ott({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,destination:i,draggables:m,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):$tt({isMovingForward:d,previousPageBorderBoxCenter:f,draggable:u,isOver:i,draggables:m,droppables:x,viewport:t.viewport,afterCritical:t.afterCritical})};function ig(e){return e.phase==="DRAGGING"||e.phase==="COLLECTING"}function Cse(e){var t=xu(e.top,e.bottom),r=xu(e.left,e.right);return function(s){return t(s.y)&&r(s.x)}}function ztt(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top}function Utt(e){var t=e.pageBorderBox,r=e.draggable,n=e.candidates,s=r.page.borderBox.center,o=n.map(function(i){var l=i.axis,c=dx(i.axis.line,t.center[l.line],i.page.borderBox.center[l.crossAxisLine]);return{id:i.descriptor.id,distance:$1(s,c)}}).sort(function(i,l){return l.distance-i.distance});return o[0]?o[0].id:null}function Vtt(e){var t=e.pageBorderBox,r=e.draggable,n=e.droppables,s=FA(n).filter(function(o){if(!o.isEnabled)return!1;var i=o.subject.active;if(!i||!ztt(t,i))return!1;if(Cse(i)(t.center))return!0;var l=o.axis,c=i.center[l.crossAxisLine],d=t[l.crossAxisStart],u=t[l.crossAxisEnd],f=xu(i[l.crossAxisStart],i[l.crossAxisEnd]),h=f(d),m=f(u);return!h&&!m?!0:h?d<c:u>c});return s.length?s.length===1?s[0].descriptor.id:Utt({pageBorderBox:t,draggable:r,candidates:s}):null}var Ase=function(t,r){return Ju(Dj(t,r))},Wtt=function(e,t){var r=e.frame;return r?Ase(t,r.scroll.diff.value):t};function Pse(e){var t=e.displaced,r=e.id;return!!(t.visible[r]||t.invisible[r])}function Htt(e){var t=e.draggable,r=e.closest,n=e.inHomeList;return r?n&&r.descriptor.index>t.descriptor.index?r.descriptor.index-1:r.descriptor.index:null}var Gtt=function(e){var t=e.pageBorderBoxWithDroppableScroll,r=e.draggable,n=e.destination,s=e.insideDestination,o=e.last,i=e.viewport,l=e.afterCritical,c=n.axis,d=Mj(n.axis,r.displaceBy),u=d.value,f=t[c.start],h=t[c.end],m=$A(r,s),x=Lp(m,function(v){var y=v.descriptor.id,b=v.page.borderBox.center[c.line],w=_p(y,l),j=Pse({displaced:o,id:y});return w?j?h<=b:f<b-u:j?h<=b+u:f<b}),g=Htt({draggable:r,closest:x,inHomeList:Ey(r,n)});return fC({draggable:r,insideDestination:s,destination:n,viewport:i,last:o,displacedBy:d,index:g})},Ktt=4,Xtt=function(e){var t=e.draggable,r=e.pageBorderBoxWithDroppableScroll,n=e.previousImpact,s=e.destination,o=e.insideDestination,i=e.afterCritical;if(!s.isCombineEnabled)return null;var l=s.axis,c=Mj(s.axis,t.displaceBy),d=c.value,u=r[l.start],f=r[l.end],h=$A(t,o),m=Lp(h,function(g){var v=g.descriptor.id,y=g.page.borderBox,b=y[l.size],w=b/Ktt,j=_p(v,i),_=Pse({displaced:n.displaced,id:v});return j?_?f>y[l.start]+w&&f<y[l.end]-w:u>y[l.start]-d+w&&u<y[l.end]-d-w:_?f>y[l.start]+d+w&&f<y[l.end]+d-w:u>y[l.start]+w&&u<y[l.end]-w});if(!m)return null;var x={displacedBy:c,displaced:n.displaced,at:{type:"COMBINE",combine:{draggableId:m.descriptor.id,droppableId:s.descriptor.id}}};return x},Ese=function(e){var t=e.pageOffset,r=e.draggable,n=e.draggables,s=e.droppables,o=e.previousImpact,i=e.viewport,l=e.afterCritical,c=Ase(r.page.borderBox,t),d=Vtt({pageBorderBox:c,draggable:r,droppables:s});if(!d)return ctt;var u=s[d],f=Py(u.descriptor.id,n),h=Wtt(u,c);return Xtt({pageBorderBoxWithDroppableScroll:h,draggable:r,previousImpact:o,destination:u,insideDestination:f,afterCritical:l})||Gtt({pageBorderBoxWithDroppableScroll:h,draggable:r,destination:u,insideDestination:f,last:o.displaced,viewport:i,afterCritical:l})},oF=function(e,t){var r;return Ka({},e,(r={},r[t.descriptor.id]=t,r))},Ytt=function(t){var r=t.previousImpact,n=t.impact,s=t.droppables,o=Od(r),i=Od(n);if(!o||o===i)return s;var l=s[o];if(!l.subject.withPlaceholder)return s;var c=Ftt(l);return oF(s,c)},Jtt=function(e){var t=e.draggable,r=e.draggables,n=e.droppables,s=e.previousImpact,o=e.impact,i=Ytt({previousImpact:s,impact:o,droppables:n}),l=Od(o);if(!l)return i;var c=n[l];if(Ey(t,c)||c.subject.withPlaceholder)return i;var d=Sse(c,t,r);return oF(i,d)},uw=function(e){var t=e.state,r=e.clientSelection,n=e.dimensions,s=e.viewport,o=e.impact,i=e.scrollJumpRequest,l=s||t.viewport,c=n||t.dimensions,d=r||t.current.client.selection,u=Cd(d,t.initial.client.selection),f={offset:u,selection:d,borderBoxCenter:Al(t.initial.client.borderBoxCenter,u)},h={selection:Al(f.selection,l.scroll.current),borderBoxCenter:Al(f.borderBoxCenter,l.scroll.current),offset:Al(f.offset,l.scroll.diff.value)},m={client:f,page:h};if(t.phase==="COLLECTING")return Ka({phase:"COLLECTING"},t,{dimensions:c,viewport:l,current:m});var x=c.draggables[t.critical.draggable.id],g=o||Ese({pageOffset:h.offset,draggable:x,draggables:c.draggables,droppables:c.droppables,previousImpact:t.impact,viewport:l,afterCritical:t.afterCritical}),v=Jtt({draggable:x,impact:g,previousImpact:t.impact,draggables:c.draggables,droppables:c.droppables}),y=Ka({},t,{current:m,dimensions:{draggables:c.draggables,droppables:v},impact:g,viewport:l,scrollJumpRequest:i||null,forceShouldAnimate:i?!1:null});return y};function Qtt(e,t){return e.map(function(r){return t[r]})}var kse=function(e){var t=e.impact,r=e.viewport,n=e.draggables,s=e.destination,o=e.forceShouldAnimate,i=t.displaced,l=Qtt(i.all,n),c=q1({afterDragging:l,destination:s,displacedBy:t.displacedBy,viewport:r.frame,forceShouldAnimate:o,last:i});return Ka({},t,{displaced:c})},Ise=function(e){var t=e.impact,r=e.draggable,n=e.droppable,s=e.draggables,o=e.viewport,i=e.afterCritical,l=BA({impact:t,draggable:r,draggables:s,droppable:n,afterCritical:i});return sF({pageBorderBoxCenter:l,draggable:r,viewport:o})},Ose=function(e){var t=e.state,r=e.dimensions,n=e.viewport;t.movementMode!=="SNAP"&&Gn(!1);var s=t.impact,o=n||t.viewport,i=r||t.dimensions,l=i.draggables,c=i.droppables,d=l[t.critical.draggable.id],u=Od(s);u||Gn(!1);var f=c[u],h=kse({impact:s,viewport:o,destination:f,draggables:l}),m=Ise({impact:h,draggable:d,droppable:f,draggables:l,viewport:o,afterCritical:t.afterCritical});return uw({impact:h,clientSelection:m,state:t,dimensions:i,viewport:o})},Ztt=function(e){return{index:e.index,droppableId:e.droppableId}},Tse=function(e){var t=e.draggable,r=e.home,n=e.draggables,s=e.viewport,o=Mj(r.axis,t.displaceBy),i=Py(r.descriptor.id,n),l=i.indexOf(t);l===-1&&Gn(!1);var c=i.slice(l+1),d=c.reduce(function(m,x){return m[x.descriptor.id]=!0,m},{}),u={inVirtualList:r.descriptor.mode==="virtual",displacedBy:o,effected:d},f=q1({afterDragging:c,destination:r,displacedBy:o,last:null,viewport:s.frame,forceShouldAnimate:!1}),h={displaced:f,displacedBy:o,at:{type:"REORDER",destination:Ztt(t.descriptor)}};return{impact:h,afterCritical:u}},ert=function(e,t){return{draggables:e.draggables,droppables:oF(e.droppables,t)}},trt=function(e){var t=e.draggable,r=e.offset,n=e.initialWindowScroll,s=iC(t.client,r),o=lC(s,n),i=Ka({},t,{placeholder:Ka({},t.placeholder,{client:s}),client:s,page:o});return i},rrt=function(e){var t=e.frame;return t||Gn(!1),t},nrt=function(e){var t=e.additions,r=e.updatedDroppables,n=e.viewport,s=n.scroll.diff.value;return t.map(function(o){var i=o.descriptor.droppableId,l=r[i],c=rrt(l),d=c.scroll.diff.value,u=Al(s,d),f=trt({draggable:o,offset:u,initialWindowScroll:n.scroll.initial});return f})},art=function(e){var t=e.state,r=e.published,n=r.modified.map(function(w){var j=t.dimensions.droppables[w.droppableId],_=ZR(j,w.scroll);return _}),s=Ka({},t.dimensions.droppables,{},pse(n)),o=gse(nrt({additions:r.additions,updatedDroppables:s,viewport:t.viewport})),i=Ka({},t.dimensions.draggables,{},o);r.removals.forEach(function(w){delete i[w]});var l={droppables:s,draggables:i},c=Od(t.impact),d=c?l.droppables[c]:null,u=l.draggables[t.critical.draggable.id],f=l.droppables[t.critical.droppable.id],h=Tse({draggable:u,home:f,draggables:i,viewport:t.viewport}),m=h.impact,x=h.afterCritical,g=d&&d.isCombineEnabled?t.impact:m,v=Ese({pageOffset:t.current.page.offset,draggable:l.draggables[t.critical.draggable.id],draggables:l.draggables,droppables:l.droppables,previousImpact:g,viewport:t.viewport,afterCritical:x}),y=Ka({phase:"DRAGGING"},t,{phase:"DRAGGING",impact:v,onLiftImpact:m,dimensions:l,afterCritical:x,forceShouldAnimate:!1});if(t.phase==="COLLECTING")return y;var b=Ka({phase:"DROP_PENDING"},y,{phase:"DROP_PENDING",reason:t.reason,isWaiting:!1});return b},T3=function(t){return t.movementMode==="SNAP"},Sk=function(t,r,n){var s=ert(t.dimensions,r);return!T3(t)||n?uw({state:t,dimensions:s}):Ose({state:t,dimensions:s})};function Ck(e){return e.isDragging&&e.movementMode==="SNAP"?Ka({phase:"DRAGGING"},e,{scrollJumpRequest:null}):e}var GU={phase:"IDLE",completed:null,shouldFlush:!1},srt=function(e,t){if(e===void 0&&(e=GU),t.type==="FLUSH")return Ka({},GU,{shouldFlush:!0});if(t.type==="INITIAL_PUBLISH"){e.phase!=="IDLE"&&Gn(!1);var r=t.payload,n=r.critical,s=r.clientSelection,o=r.viewport,i=r.dimensions,l=r.movementMode,c=i.draggables[n.draggable.id],d=i.droppables[n.droppable.id],u={selection:s,borderBoxCenter:c.client.borderBox.center,offset:ml},f={client:u,page:{selection:Al(u.selection,o.scroll.initial),borderBoxCenter:Al(u.selection,o.scroll.initial),offset:Al(u.selection,o.scroll.diff.value)}},h=FA(i.droppables).every(function(te){return!te.isFixedOnPage}),m=Tse({draggable:c,home:d,draggables:i.draggables,viewport:o}),x=m.impact,g=m.afterCritical,v={phase:"DRAGGING",isDragging:!0,critical:n,movementMode:l,dimensions:i,initial:f,current:f,isWindowScrollAllowed:h,impact:x,afterCritical:g,onLiftImpact:x,viewport:o,scrollJumpRequest:null,forceShouldAnimate:null};return v}if(t.type==="COLLECTION_STARTING"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&Gn(!1);var y=Ka({phase:"COLLECTING"},e,{phase:"COLLECTING"});return y}if(t.type==="PUBLISH_WHILE_DRAGGING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"||Gn(!1),art({state:e,published:t.payload});if(t.type==="MOVE"){if(e.phase==="DROP_PENDING")return e;ig(e)||Gn(!1);var b=t.payload.client;return cp(b,e.current.client.selection)?e:uw({state:e,clientSelection:b,impact:T3(e)?e.impact:null})}if(t.type==="UPDATE_DROPPABLE_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="COLLECTING")return Ck(e);ig(e)||Gn(!1);var w=t.payload,j=w.id,_=w.newScroll,C=e.dimensions.droppables[j];if(!C)return e;var E=ZR(C,_);return Sk(e,E,!1)}if(t.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(e.phase==="DROP_PENDING")return e;ig(e)||Gn(!1);var S=t.payload,A=S.id,M=S.isEnabled,O=e.dimensions.droppables[A];O||Gn(!1),O.isEnabled===M&&Gn(!1);var I=Ka({},O,{isEnabled:M});return Sk(e,I,!0)}if(t.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(e.phase==="DROP_PENDING")return e;ig(e)||Gn(!1);var T=t.payload,k=T.id,q=T.isCombineEnabled,B=e.dimensions.droppables[k];B||Gn(!1),B.isCombineEnabled===q&&Gn(!1);var z=Ka({},B,{isCombineEnabled:q});return Sk(e,z,!0)}if(t.type==="MOVE_BY_WINDOW_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="DROP_ANIMATING")return e;ig(e)||Gn(!1),e.isWindowScrollAllowed||Gn(!1);var F=t.payload.newScroll;if(cp(e.viewport.scroll.current,F))return Ck(e);var V=jse(e.viewport,F);return T3(e)?Ose({state:e,viewport:V}):uw({state:e,viewport:V})}if(t.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!ig(e))return e;var me=t.payload.maxScroll;if(cp(me,e.viewport.scroll.max))return e;var be=Ka({},e.viewport,{scroll:Ka({},e.viewport.scroll,{max:me})});return Ka({phase:"DRAGGING"},e,{viewport:be})}if(t.type==="MOVE_UP"||t.type==="MOVE_DOWN"||t.type==="MOVE_LEFT"||t.type==="MOVE_RIGHT"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&Gn(!1);var U=qtt({state:e,type:t.type});return U?uw({state:e,impact:U.impact,clientSelection:U.clientSelection,scrollJumpRequest:U.scrollJumpRequest}):e}if(t.type==="DROP_PENDING"){var L=t.payload.reason;e.phase!=="COLLECTING"&&Gn(!1);var H=Ka({phase:"DROP_PENDING"},e,{phase:"DROP_PENDING",isWaiting:!0,reason:L});return H}if(t.type==="DROP_ANIMATE"){var ie=t.payload,Y=ie.completed,W=ie.dropDuration,se=ie.newHomeClientOffset;e.phase==="DRAGGING"||e.phase==="DROP_PENDING"||Gn(!1);var pe={phase:"DROP_ANIMATING",completed:Y,dropDuration:W,newHomeClientOffset:se,dimensions:e.dimensions};return pe}if(t.type==="DROP_COMPLETE"){var G=t.payload.completed;return{phase:"IDLE",completed:G,shouldFlush:!1}}return e},ort=function(t){return{type:"BEFORE_INITIAL_CAPTURE",payload:t}},irt=function(t){return{type:"LIFT",payload:t}},lrt=function(t){return{type:"INITIAL_PUBLISH",payload:t}},crt=function(t){return{type:"PUBLISH_WHILE_DRAGGING",payload:t}},drt=function(){return{type:"COLLECTION_STARTING",payload:null}},urt=function(t){return{type:"UPDATE_DROPPABLE_SCROLL",payload:t}},frt=function(t){return{type:"UPDATE_DROPPABLE_IS_ENABLED",payload:t}},mrt=function(t){return{type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:t}},Dse=function(t){return{type:"MOVE",payload:t}},hrt=function(t){return{type:"MOVE_BY_WINDOW_SCROLL",payload:t}},prt=function(t){return{type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:t}},grt=function(){return{type:"MOVE_UP",payload:null}},xrt=function(){return{type:"MOVE_DOWN",payload:null}},vrt=function(){return{type:"MOVE_RIGHT",payload:null}},yrt=function(){return{type:"MOVE_LEFT",payload:null}},iF=function(){return{type:"FLUSH",payload:null}},brt=function(t){return{type:"DROP_ANIMATE",payload:t}},lF=function(t){return{type:"DROP_COMPLETE",payload:t}},Mse=function(t){return{type:"DROP",payload:t}},wrt=function(t){return{type:"DROP_PENDING",payload:t}},Rse=function(){return{type:"DROP_ANIMATION_FINISHED",payload:null}},jrt=function(e){return function(t){var r=t.getState,n=t.dispatch;return function(s){return function(o){if(o.type!=="LIFT"){s(o);return}var i=o.payload,l=i.id,c=i.clientSelection,d=i.movementMode,u=r();u.phase==="DROP_ANIMATING"&&n(lF({completed:u.completed})),r().phase!=="IDLE"&&Gn(!1),n(iF()),n(ort({draggableId:l,movementMode:d}));var f={shouldPublishImmediately:d==="SNAP"},h={draggableId:l,scrollOptions:f},m=e.startPublishing(h),x=m.critical,g=m.dimensions,v=m.viewport;n(lrt({critical:x,dimensions:g,clientSelection:c,movementMode:d,viewport:v}))}}}},_rt=function(e){return function(){return function(t){return function(r){r.type==="INITIAL_PUBLISH"&&e.dragging(),r.type==="DROP_ANIMATE"&&e.dropping(r.payload.completed.result.reason),(r.type==="FLUSH"||r.type==="DROP_COMPLETE")&&e.resting(),t(r)}}}},cF={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},z1={opacity:{drop:0,combining:.7},scale:{drop:.75}},dF={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},Xp=dF.outOfTheWay+"s "+cF.outOfTheWay,fw={fluid:"opacity "+Xp,snap:"transform "+Xp+", opacity "+Xp,drop:function(t){var r=t+"s "+cF.drop;return"transform "+r+", opacity "+r},outOfTheWay:"transform "+Xp,placeholder:"height "+Xp+", width "+Xp+", margin "+Xp},KU=function(t){return cp(t,ml)?null:"translate("+t.x+"px, "+t.y+"px)"},D3={moveTo:KU,drop:function(t,r){var n=KU(t);return n?r?n+" scale("+z1.scale.drop+")":n:null}},M3=dF.minDropTime,Fse=dF.maxDropTime,Nrt=Fse-M3,XU=1500,Srt=.6,Crt=function(e){var t=e.current,r=e.destination,n=e.reason,s=$1(t,r);if(s<=0)return M3;if(s>=XU)return Fse;var o=s/XU,i=M3+Nrt*o,l=n==="CANCEL"?i*Srt:i;return Number(l.toFixed(2))},Art=function(e){var t=e.impact,r=e.draggable,n=e.dimensions,s=e.viewport,o=e.afterCritical,i=n.draggables,l=n.droppables,c=Od(t),d=c?l[c]:null,u=l[r.descriptor.droppableId],f=Ise({impact:t,draggable:r,draggables:i,afterCritical:o,droppable:d||u,viewport:s}),h=Cd(f,r.client.borderBox.center);return h},Prt=function(e){var t=e.draggables,r=e.reason,n=e.lastImpact,s=e.home,o=e.viewport,i=e.onLiftImpact;if(!n.at||r!=="DROP"){var l=kse({draggables:t,impact:i,destination:s,viewport:o,forceShouldAnimate:!0});return{impact:l,didDropInsideDroppable:!1}}if(n.at.type==="REORDER")return{impact:n,didDropInsideDroppable:!0};var c=Ka({},n,{displaced:B1});return{impact:c,didDropInsideDroppable:!0}},Ert=function(e){var t=e.getState,r=e.dispatch;return function(n){return function(s){if(s.type!=="DROP"){n(s);return}var o=t(),i=s.payload.reason;if(o.phase==="COLLECTING"){r(wrt({reason:i}));return}if(o.phase!=="IDLE"){var l=o.phase==="DROP_PENDING"&&o.isWaiting;l&&Gn(!1),o.phase==="DRAGGING"||o.phase==="DROP_PENDING"||Gn(!1);var c=o.critical,d=o.dimensions,u=d.draggables[o.critical.draggable.id],f=Prt({reason:i,lastImpact:o.impact,afterCritical:o.afterCritical,onLiftImpact:o.onLiftImpact,home:o.dimensions.droppables[o.critical.droppable.id],viewport:o.viewport,draggables:o.dimensions.draggables}),h=f.impact,m=f.didDropInsideDroppable,x=m?tF(h):null,g=m?LA(h):null,v={index:c.draggable.index,droppableId:c.droppable.id},y={draggableId:u.descriptor.id,type:u.descriptor.type,source:v,reason:i,mode:o.movementMode,destination:x,combine:g},b=Art({impact:h,draggable:u,dimensions:d,viewport:o.viewport,afterCritical:o.afterCritical}),w={critical:o.critical,afterCritical:o.afterCritical,result:y,impact:h},j=!cp(o.current.client.offset,b)||!!y.combine;if(!j){r(lF({completed:w}));return}var _=Crt({current:o.current.client.offset,destination:b,reason:i}),C={newHomeClientOffset:b,dropDuration:_,completed:w};r(brt(C))}}}},Lse=function(){return{x:window.pageXOffset,y:window.pageYOffset}};function krt(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(r){r.target!==window&&r.target!==window.document||e()}}}function Irt(e){var t=e.onWindowScroll;function r(){t(Lse())}var n=L1(r),s=krt(n),o=lp;function i(){return o!==lp}function l(){i()&&Gn(!1),o=mu(window,[s])}function c(){i()||Gn(!1),n.cancel(),o(),o=lp}return{start:l,stop:c,isActive:i}}var Ort=function(t){return t.type==="DROP_COMPLETE"||t.type==="DROP_ANIMATE"||t.type==="FLUSH"},Trt=function(e){var t=Irt({onWindowScroll:function(n){e.dispatch(hrt({newScroll:n}))}});return function(r){return function(n){!t.isActive()&&n.type==="INITIAL_PUBLISH"&&t.start(),t.isActive()&&Ort(n)&&t.stop(),r(n)}}},Drt=function(e){var t=!1,r=!1,n=setTimeout(function(){r=!0}),s=function(i){t||r||(t=!0,e(i),clearTimeout(n))};return s.wasCalled=function(){return t},s},Mrt=function(){var e=[],t=function(o){var i=eF(e,function(d){return d.timerId===o});i===-1&&Gn(!1);var l=e.splice(i,1),c=l[0];c.callback()},r=function(o){var i=setTimeout(function(){return t(i)}),l={timerId:i,callback:o};e.push(l)},n=function(){if(e.length){var o=[].concat(e);e.length=0,o.forEach(function(i){clearTimeout(i.timerId),i.callback()})}};return{add:r,flush:n}},Rrt=function(t,r){return t==null&&r==null?!0:t==null||r==null?!1:t.droppableId===r.droppableId&&t.index===r.index},Frt=function(t,r){return t==null&&r==null?!0:t==null||r==null?!1:t.draggableId===r.draggableId&&t.droppableId===r.droppableId},Lrt=function(t,r){if(t===r)return!0;var n=t.draggable.id===r.draggable.id&&t.draggable.droppableId===r.draggable.droppableId&&t.draggable.type===r.draggable.type&&t.draggable.index===r.draggable.index,s=t.droppable.id===r.droppable.id&&t.droppable.type===r.droppable.type;return n&&s},cb=function(t,r){r()},t2=function(t,r){return{draggableId:t.draggable.id,type:t.droppable.type,source:{droppableId:t.droppable.id,index:t.draggable.index},mode:r}},Ak=function(t,r,n,s){if(!t){n(s(r));return}var o=Drt(n),i={announce:o};t(r,i),o.wasCalled()||n(s(r))},$rt=function(e,t){var r=Mrt(),n=null,s=function(h,m){n&&Gn(!1),cb("onBeforeCapture",function(){var x=e().onBeforeCapture;if(x){var g={draggableId:h,mode:m};x(g)}})},o=function(h,m){n&&Gn(!1),cb("onBeforeDragStart",function(){var x=e().onBeforeDragStart;x&&x(t2(h,m))})},i=function(h,m){n&&Gn(!1);var x=t2(h,m);n={mode:m,lastCritical:h,lastLocation:x.source,lastCombine:null},r.add(function(){cb("onDragStart",function(){return Ak(e().onDragStart,x,t,U2.onDragStart)})})},l=function(h,m){var x=tF(m),g=LA(m);n||Gn(!1);var v=!Lrt(h,n.lastCritical);v&&(n.lastCritical=h);var y=!Rrt(n.lastLocation,x);y&&(n.lastLocation=x);var b=!Frt(n.lastCombine,g);if(b&&(n.lastCombine=g),!(!v&&!y&&!b)){var w=Ka({},t2(h,n.mode),{combine:g,destination:x});r.add(function(){cb("onDragUpdate",function(){return Ak(e().onDragUpdate,w,t,U2.onDragUpdate)})})}},c=function(){n||Gn(!1),r.flush()},d=function(h){n||Gn(!1),n=null,cb("onDragEnd",function(){return Ak(e().onDragEnd,h,t,U2.onDragEnd)})},u=function(){if(n){var h=Ka({},t2(n.lastCritical,n.mode),{combine:null,destination:null,reason:"CANCEL"});d(h)}};return{beforeCapture:s,beforeStart:o,start:i,update:l,flush:c,drop:d,abort:u}},Brt=function(e,t){var r=$rt(e,t);return function(n){return function(s){return function(o){if(o.type==="BEFORE_INITIAL_CAPTURE"){r.beforeCapture(o.payload.draggableId,o.payload.movementMode);return}if(o.type==="INITIAL_PUBLISH"){var i=o.payload.critical;r.beforeStart(i,o.payload.movementMode),s(o),r.start(i,o.payload.movementMode);return}if(o.type==="DROP_COMPLETE"){var l=o.payload.completed.result;r.flush(),s(o),r.drop(l);return}if(s(o),o.type==="FLUSH"){r.abort();return}var c=n.getState();c.phase==="DRAGGING"&&r.update(c.critical,c.impact)}}}},qrt=function(e){return function(t){return function(r){if(r.type!=="DROP_ANIMATION_FINISHED"){t(r);return}var n=e.getState();n.phase!=="DROP_ANIMATING"&&Gn(!1),e.dispatch(lF({completed:n.completed}))}}},zrt=function(e){var t=null,r=null;function n(){r&&(cancelAnimationFrame(r),r=null),t&&(t(),t=null)}return function(s){return function(o){if((o.type==="FLUSH"||o.type==="DROP_COMPLETE"||o.type==="DROP_ANIMATION_FINISHED")&&n(),s(o),o.type==="DROP_ANIMATE"){var i={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){var c=e.getState();c.phase==="DROP_ANIMATING"&&e.dispatch(Rse())}};r=requestAnimationFrame(function(){r=null,t=mu(window,[i])})}}}},Urt=function(e){return function(){return function(t){return function(r){(r.type==="DROP_COMPLETE"||r.type==="FLUSH"||r.type==="DROP_ANIMATE")&&e.stopPublishing(),t(r)}}}},Vrt=function(e){var t=!1;return function(){return function(r){return function(n){if(n.type==="INITIAL_PUBLISH"){t=!0,e.tryRecordFocus(n.payload.critical.draggable.id),r(n),e.tryRestoreFocusRecorded();return}if(r(n),!!t){if(n.type==="FLUSH"){t=!1,e.tryRestoreFocusRecorded();return}if(n.type==="DROP_COMPLETE"){t=!1;var s=n.payload.completed.result;s.combine&&e.tryShiftRecord(s.draggableId,s.combine.draggableId),e.tryRestoreFocusRecorded()}}}}}},Wrt=function(t){return t.type==="DROP_COMPLETE"||t.type==="DROP_ANIMATE"||t.type==="FLUSH"},Hrt=function(e){return function(t){return function(r){return function(n){if(Wrt(n)){e.stop(),r(n);return}if(n.type==="INITIAL_PUBLISH"){r(n);var s=t.getState();s.phase!=="DRAGGING"&&Gn(!1),e.start(s);return}r(n),e.scroll(t.getState())}}}},Grt=function(e){return function(t){return function(r){if(t(r),r.type==="PUBLISH_WHILE_DRAGGING"){var n=e.getState();n.phase==="DROP_PENDING"&&(n.isWaiting||e.dispatch(Mse({reason:n.reason})))}}}},Krt=Vae,Xrt=function(e){var t=e.dimensionMarshal,r=e.focusMarshal,n=e.styleMarshal,s=e.getResponders,o=e.announce,i=e.autoScroller;return Uae(srt,Krt(DZe(_rt(n),Urt(t),jrt(t),Ert,qrt,zrt,Grt,Hrt(i),Trt,Vrt(r),Brt(s,o))))},Pk=function(){return{additions:{},removals:{},modified:{}}};function Yrt(e){var t=e.registry,r=e.callbacks,n=Pk(),s=null,o=function(){s||(r.collectionStarting(),s=requestAnimationFrame(function(){s=null;var u=n,f=u.additions,h=u.removals,m=u.modified,x=Object.keys(f).map(function(y){return t.draggable.getById(y).getDimension(ml)}).sort(function(y,b){return y.descriptor.index-b.descriptor.index}),g=Object.keys(m).map(function(y){var b=t.droppable.getById(y),w=b.callbacks.getScrollWhileDragging();return{droppableId:y,scroll:w}}),v={additions:x,removals:Object.keys(h),modified:g};n=Pk(),r.publish(v)}))},i=function(u){var f=u.descriptor.id;n.additions[f]=u,n.modified[u.descriptor.droppableId]=!0,n.removals[f]&&delete n.removals[f],o()},l=function(u){var f=u.descriptor;n.removals[f.id]=!0,n.modified[f.droppableId]=!0,n.additions[f.id]&&delete n.additions[f.id],o()},c=function(){s&&(cancelAnimationFrame(s),s=null,n=Pk())};return{add:i,remove:l,stop:c}}var $se=function(e){var t=e.scrollHeight,r=e.scrollWidth,n=e.height,s=e.width,o=Cd({x:r,y:t},{x:s,y:n}),i={x:Math.max(0,o.x),y:Math.max(0,o.y)};return i},Bse=function(){var e=document.documentElement;return e||Gn(!1),e},qse=function(){var e=Bse(),t=$se({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight});return t},Jrt=function(){var e=Lse(),t=qse(),r=e.y,n=e.x,s=Bse(),o=s.clientWidth,i=s.clientHeight,l=n+o,c=r+i,d=Ju({top:r,left:n,right:l,bottom:c}),u={frame:d,scroll:{initial:e,current:e,max:t,diff:{value:ml,displacement:ml}}};return u},Qrt=function(e){var t=e.critical,r=e.scrollOptions,n=e.registry,s=Jrt(),o=s.scroll.current,i=t.droppable,l=n.droppable.getAllByType(i.type).map(function(f){return f.callbacks.getDimensionAndWatchScroll(o,r)}),c=n.draggable.getAllByType(t.draggable.type).map(function(f){return f.getDimension(o)}),d={draggables:gse(c),droppables:pse(l)},u={dimensions:d,critical:t,viewport:s};return u};function YU(e,t,r){if(r.descriptor.id===t.id||r.descriptor.type!==t.type)return!1;var n=e.droppable.getById(r.descriptor.droppableId);return n.descriptor.mode==="virtual"}var Zrt=function(e,t){var r=null,n=Yrt({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),s=function(m,x){e.droppable.exists(m)||Gn(!1),r&&t.updateDroppableIsEnabled({id:m,isEnabled:x})},o=function(m,x){r&&(e.droppable.exists(m)||Gn(!1),t.updateDroppableIsCombineEnabled({id:m,isCombineEnabled:x}))},i=function(m,x){r&&(e.droppable.exists(m)||Gn(!1),t.updateDroppableScroll({id:m,newScroll:x}))},l=function(m,x){r&&e.droppable.getById(m).callbacks.scroll(x)},c=function(){if(r){n.stop();var m=r.critical.droppable;e.droppable.getAllByType(m.type).forEach(function(x){return x.callbacks.dragStopped()}),r.unsubscribe(),r=null}},d=function(m){r||Gn(!1);var x=r.critical.draggable;m.type==="ADDITION"&&YU(e,x,m.value)&&n.add(m.value),m.type==="REMOVAL"&&YU(e,x,m.value)&&n.remove(m.value)},u=function(m){r&&Gn(!1);var x=e.draggable.getById(m.draggableId),g=e.droppable.getById(x.descriptor.droppableId),v={draggable:x.descriptor,droppable:g.descriptor},y=e.subscribe(d);return r={critical:v,unsubscribe:y},Qrt({critical:v,registry:e,scrollOptions:m.scrollOptions})},f={updateDroppableIsEnabled:s,updateDroppableIsCombineEnabled:o,scrollDroppable:l,updateDroppableScroll:i,startPublishing:u,stopPublishing:c};return f},zse=function(e,t){return e.phase==="IDLE"?!0:e.phase!=="DROP_ANIMATING"||e.completed.result.draggableId===t?!1:e.completed.result.reason==="DROP"},ent=function(e){window.scrollBy(e.x,e.y)},tnt=fl(function(e){return FA(e).filter(function(t){return!(!t.isEnabled||!t.frame)})}),rnt=function(t,r){var n=Lp(tnt(r),function(s){return s.frame||Gn(!1),Cse(s.frame.pageMarginBox)(t)});return n},nnt=function(e){var t=e.center,r=e.destination,n=e.droppables;if(r){var s=n[r];return s.frame?s:null}var o=rnt(t,n);return o},dp={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:function(t){return Math.pow(t,2)},durationDampening:{stopDampeningAt:1200,accelerateAt:360}},ant=function(e,t){var r=e[t.size]*dp.startFromPercentage,n=e[t.size]*dp.maxScrollAtPercentage,s={startScrollingFrom:r,maxScrollValueAt:n};return s},Use=function(e){var t=e.startOfRange,r=e.endOfRange,n=e.current,s=r-t;if(s===0)return 0;var o=n-t,i=o/s;return i},uF=1,snt=function(e,t){if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return dp.maxPixelScroll;if(e===t.startScrollingFrom)return uF;var r=Use({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),n=1-r,s=dp.maxPixelScroll*dp.ease(n);return Math.ceil(s)},JU=dp.durationDampening.accelerateAt,QU=dp.durationDampening.stopDampeningAt,ont=function(e,t){var r=t,n=QU,s=Date.now(),o=s-r;if(o>=QU)return e;if(o<JU)return uF;var i=Use({startOfRange:JU,endOfRange:n,current:o}),l=e*dp.ease(i);return Math.ceil(l)},ZU=function(e){var t=e.distanceToEdge,r=e.thresholds,n=e.dragStartTime,s=e.shouldUseTimeDampening,o=snt(t,r);return o===0?0:s?Math.max(ont(o,n),uF):o},eV=function(e){var t=e.container,r=e.distanceToEdges,n=e.dragStartTime,s=e.axis,o=e.shouldUseTimeDampening,i=ant(t,s),l=r[s.end]<r[s.start];return l?ZU({distanceToEdge:r[s.end],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o}):-1*ZU({distanceToEdge:r[s.start],thresholds:i,dragStartTime:n,shouldUseTimeDampening:o})},int=function(e){var t=e.container,r=e.subject,n=e.proposedScroll,s=r.height>t.height,o=r.width>t.width;return!o&&!s?n:o&&s?null:{x:o?0:n.x,y:s?0:n.y}},lnt=mse(function(e){return e===0?0:e}),Vse=function(e){var t=e.dragStartTime,r=e.container,n=e.subject,s=e.center,o=e.shouldUseTimeDampening,i={top:s.y-r.top,right:r.right-s.x,bottom:r.bottom-s.y,left:s.x-r.left},l=eV({container:r,distanceToEdges:i,dragStartTime:t,axis:rF,shouldUseTimeDampening:o}),c=eV({container:r,distanceToEdges:i,dragStartTime:t,axis:yse,shouldUseTimeDampening:o}),d=lnt({x:c,y:l});if(cp(d,ml))return null;var u=int({container:r,subject:n,proposedScroll:d});return u?cp(u,ml)?null:u:null},cnt=mse(function(e){return e===0?0:e>0?1:-1}),fF=function(){var e=function(r,n){return r<0?r:r>n?r-n:0};return function(t){var r=t.current,n=t.max,s=t.change,o=Al(r,s),i={x:e(o.x,n.x),y:e(o.y,n.y)};return cp(i,ml)?null:i}}(),Wse=function(t){var r=t.max,n=t.current,s=t.change,o={x:Math.max(n.x,r.x),y:Math.max(n.y,r.y)},i=cnt(s),l=fF({max:o,current:n,change:i});return!l||i.x!==0&&l.x===0||i.y!==0&&l.y===0},mF=function(t,r){return Wse({current:t.scroll.current,max:t.scroll.max,change:r})},dnt=function(t,r){if(!mF(t,r))return null;var n=t.scroll.max,s=t.scroll.current;return fF({current:s,max:n,change:r})},hF=function(t,r){var n=t.frame;return n?Wse({current:n.scroll.current,max:n.scroll.max,change:r}):!1},unt=function(t,r){var n=t.frame;return!n||!hF(t,r)?null:fF({current:n.scroll.current,max:n.scroll.max,change:r})},fnt=function(e){var t=e.viewport,r=e.subject,n=e.center,s=e.dragStartTime,o=e.shouldUseTimeDampening,i=Vse({dragStartTime:s,container:t.frame,subject:r,center:n,shouldUseTimeDampening:o});return i&&mF(t,i)?i:null},mnt=function(e){var t=e.droppable,r=e.subject,n=e.center,s=e.dragStartTime,o=e.shouldUseTimeDampening,i=t.frame;if(!i)return null;var l=Vse({dragStartTime:s,container:i.pageMarginBox,subject:r,center:n,shouldUseTimeDampening:o});return l&&hF(t,l)?l:null},tV=function(e){var t=e.state,r=e.dragStartTime,n=e.shouldUseTimeDampening,s=e.scrollWindow,o=e.scrollDroppable,i=t.current.page.borderBoxCenter,l=t.dimensions.draggables[t.critical.draggable.id],c=l.page.marginBox;if(t.isWindowScrollAllowed){var d=t.viewport,u=fnt({dragStartTime:r,viewport:d,subject:c,center:i,shouldUseTimeDampening:n});if(u){s(u);return}}var f=nnt({center:i,destination:Od(t.impact),droppables:t.dimensions.droppables});if(f){var h=mnt({dragStartTime:r,droppable:f,subject:c,center:i,shouldUseTimeDampening:n});h&&o(f.descriptor.id,h)}},hnt=function(e){var t=e.scrollWindow,r=e.scrollDroppable,n=L1(t),s=L1(r),o=null,i=function(u){o||Gn(!1);var f=o,h=f.shouldUseTimeDampening,m=f.dragStartTime;tV({state:u,scrollWindow:n,scrollDroppable:s,dragStartTime:m,shouldUseTimeDampening:h})},l=function(u){o&&Gn(!1);var f=Date.now(),h=!1,m=function(){h=!0};tV({state:u,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:m,scrollDroppable:m}),o={dragStartTime:f,shouldUseTimeDampening:h},h&&i(u)},c=function(){o&&(n.cancel(),s.cancel(),o=null)};return{start:l,stop:c,scroll:i}},pnt=function(e){var t=e.move,r=e.scrollDroppable,n=e.scrollWindow,s=function(d,u){var f=Al(d.current.client.selection,u);t({client:f})},o=function(d,u){if(!hF(d,u))return u;var f=unt(d,u);if(!f)return r(d.descriptor.id,u),null;var h=Cd(u,f);r(d.descriptor.id,h);var m=Cd(u,h);return m},i=function(d,u,f){if(!d||!mF(u,f))return f;var h=dnt(u,f);if(!h)return n(f),null;var m=Cd(f,h);n(m);var x=Cd(f,m);return x},l=function(d){var u=d.scrollJumpRequest;if(u){var f=Od(d.impact);f||Gn(!1);var h=o(d.dimensions.droppables[f],u);if(h){var m=d.viewport,x=i(d.isWindowScrollAllowed,m,h);x&&s(d,x)}}};return l},gnt=function(e){var t=e.scrollDroppable,r=e.scrollWindow,n=e.move,s=hnt({scrollWindow:r,scrollDroppable:t}),o=pnt({move:n,scrollWindow:r,scrollDroppable:t}),i=function(d){if(d.phase==="DRAGGING"){if(d.movementMode==="FLUID"){s.scroll(d);return}d.scrollJumpRequest&&o(d)}},l={scroll:i,start:s.start,stop:s.stop};return l},K0="data-rbd",X0=function(){var e=K0+"-drag-handle";return{base:e,draggableId:e+"-draggable-id",contextId:e+"-context-id"}}(),R3=function(){var e=K0+"-draggable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),xnt=function(){var e=K0+"-droppable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),rV={contextId:K0+"-scroll-container-context-id"},vnt=function(t){return function(r){return"["+r+'="'+t+'"]'}},db=function(t,r){return t.map(function(n){var s=n.styles[r];return s?n.selector+" { "+s+" }":""}).join(" ")},ynt="pointer-events: none;",bnt=function(e){var t=vnt(e),r=function(){var l=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:t(X0.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:l,dragging:ynt,dropAnimating:l}}}(),n=function(){var l=`
      transition: `+fw.outOfTheWay+`;
    `;return{selector:t(R3.contextId),styles:{dragging:l,dropAnimating:l,userCancel:l}}}(),s={selector:t(xnt.contextId),styles:{always:"overflow-anchor: none;"}},o={selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}},i=[n,r,s,o];return{always:db(i,"always"),resting:db(i,"resting"),dragging:db(i,"dragging"),dropAnimating:db(i,"dropAnimating"),userCancel:db(i,"userCancel")}},Td=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?p.useLayoutEffect:p.useEffect,Ek=function(){var t=document.querySelector("head");return t||Gn(!1),t},nV=function(t){var r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.type="text/css",r};function wnt(e,t){var r=Gs(function(){return bnt(e)},[e]),n=p.useRef(null),s=p.useRef(null),o=Ba(fl(function(f){var h=s.current;h||Gn(!1),h.textContent=f}),[]),i=Ba(function(f){var h=n.current;h||Gn(!1),h.textContent=f},[]);Td(function(){!n.current&&!s.current||Gn(!1);var f=nV(t),h=nV(t);return n.current=f,s.current=h,f.setAttribute(K0+"-always",e),h.setAttribute(K0+"-dynamic",e),Ek().appendChild(f),Ek().appendChild(h),i(r.always),o(r.resting),function(){var m=function(g){var v=g.current;v||Gn(!1),Ek().removeChild(v),g.current=null};m(n),m(s)}},[t,i,o,r.always,r.resting,e]);var l=Ba(function(){return o(r.dragging)},[o,r.dragging]),c=Ba(function(f){if(f==="DROP"){o(r.dropAnimating);return}o(r.userCancel)},[o,r.dropAnimating,r.userCancel]),d=Ba(function(){s.current&&o(r.resting)},[o,r.resting]),u=Gs(function(){return{dragging:l,dropping:c,resting:d}},[l,c,d]);return u}var Hse=function(e){return e&&e.ownerDocument?e.ownerDocument.defaultView:window};function qA(e){return e instanceof Hse(e).HTMLElement}function jnt(e,t){var r="["+X0.contextId+'="'+e+'"]',n=hse(document.querySelectorAll(r));if(!n.length)return null;var s=Lp(n,function(o){return o.getAttribute(X0.draggableId)===t});return!s||!qA(s)?null:s}function _nt(e){var t=p.useRef({}),r=p.useRef(null),n=p.useRef(null),s=p.useRef(!1),o=Ba(function(h,m){var x={id:h,focus:m};return t.current[h]=x,function(){var v=t.current,y=v[h];y!==x&&delete v[h]}},[]),i=Ba(function(h){var m=jnt(e,h);m&&m!==document.activeElement&&m.focus()},[e]),l=Ba(function(h,m){r.current===h&&(r.current=m)},[]),c=Ba(function(){n.current||s.current&&(n.current=requestAnimationFrame(function(){n.current=null;var h=r.current;h&&i(h)}))},[i]),d=Ba(function(h){r.current=null;var m=document.activeElement;m&&m.getAttribute(X0.draggableId)===h&&(r.current=h)},[]);Td(function(){return s.current=!0,function(){s.current=!1;var h=n.current;h&&cancelAnimationFrame(h)}},[]);var u=Gs(function(){return{register:o,tryRecordFocus:d,tryRestoreFocusRecorded:c,tryShiftRecord:l}},[o,d,c,l]);return u}function Nnt(){var e={draggables:{},droppables:{}},t=[];function r(f){return t.push(f),function(){var m=t.indexOf(f);m!==-1&&t.splice(m,1)}}function n(f){t.length&&t.forEach(function(h){return h(f)})}function s(f){return e.draggables[f]||null}function o(f){var h=s(f);return h||Gn(!1),h}var i={register:function(h){e.draggables[h.descriptor.id]=h,n({type:"ADDITION",value:h})},update:function(h,m){var x=e.draggables[m.descriptor.id];x&&x.uniqueId===h.uniqueId&&(delete e.draggables[m.descriptor.id],e.draggables[h.descriptor.id]=h)},unregister:function(h){var m=h.descriptor.id,x=s(m);x&&h.uniqueId===x.uniqueId&&(delete e.draggables[m],n({type:"REMOVAL",value:h}))},getById:o,findById:s,exists:function(h){return!!s(h)},getAllByType:function(h){return uC(e.draggables).filter(function(m){return m.descriptor.type===h})}};function l(f){return e.droppables[f]||null}function c(f){var h=l(f);return h||Gn(!1),h}var d={register:function(h){e.droppables[h.descriptor.id]=h},unregister:function(h){var m=l(h.descriptor.id);m&&h.uniqueId===m.uniqueId&&delete e.droppables[h.descriptor.id]},getById:c,findById:l,exists:function(h){return!!l(h)},getAllByType:function(h){return uC(e.droppables).filter(function(m){return m.descriptor.type===h})}};function u(){e.draggables={},e.droppables={},t.length=0}return{draggable:i,droppable:d,subscribe:r,clean:u}}function Snt(){var e=Gs(Nnt,[]);return p.useEffect(function(){return function(){requestAnimationFrame(e.clean)}},[e]),e}var pF=Ce.createContext(null),mC=function(){var e=document.body;return e||Gn(!1),e},Cnt={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},Ant=function(t){return"rbd-announcement-"+t};function Pnt(e){var t=Gs(function(){return Ant(e)},[e]),r=p.useRef(null);p.useEffect(function(){var o=document.createElement("div");return r.current=o,o.id=t,o.setAttribute("aria-live","assertive"),o.setAttribute("aria-atomic","true"),Ka(o.style,Cnt),mC().appendChild(o),function(){setTimeout(function(){var c=mC();c.contains(o)&&c.removeChild(o),o===r.current&&(r.current=null)})}},[t]);var n=Ba(function(s){var o=r.current;if(o){o.textContent=s;return}},[]);return n}var Ent=0,knt={separator:"::"};function gF(e,t){return t===void 0&&(t=knt),Gs(function(){return""+e+t.separator+Ent++},[t.separator,e])}function Int(e){var t=e.contextId,r=e.uniqueId;return"rbd-hidden-text-"+t+"-"+r}function Ont(e){var t=e.contextId,r=e.text,n=gF("hidden-text",{separator:"-"}),s=Gs(function(){return Int({contextId:t,uniqueId:n})},[n,t]);return p.useEffect(function(){var i=document.createElement("div");return i.id=s,i.textContent=r,i.style.display="none",mC().appendChild(i),function(){var c=mC();c.contains(i)&&c.removeChild(i)}},[s,r]),s}var zA=Ce.createContext(null);function Gse(e){var t=p.useRef(e);return p.useEffect(function(){t.current=e}),t}function Tnt(){var e=null;function t(){return!!e}function r(i){return i===e}function n(i){e&&Gn(!1);var l={abandon:i};return e=l,l}function s(){e||Gn(!1),e=null}function o(){e&&(e.abandon(),s())}return{isClaimed:t,isActive:r,claim:n,release:s,tryAbandon:o}}var Dnt=9,Mnt=13,xF=27,Kse=32,Rnt=33,Fnt=34,Lnt=35,$nt=36,Bnt=37,qnt=38,znt=39,Unt=40,r2,Vnt=(r2={},r2[Mnt]=!0,r2[Dnt]=!0,r2),Xse=function(e){Vnt[e.keyCode]&&e.preventDefault()},UA=function(){var e="visibilitychange";if(typeof document>"u")return e;var t=[e,"ms"+e,"webkit"+e,"moz"+e,"o"+e],r=Lp(t,function(n){return"on"+n in document});return r||e}(),Yse=0,aV=5;function Wnt(e,t){return Math.abs(t.x-e.x)>=aV||Math.abs(t.y-e.y)>=aV}var sV={type:"IDLE"};function Hnt(e){var t=e.cancel,r=e.completed,n=e.getPhase,s=e.setPhase;return[{eventName:"mousemove",fn:function(i){var l=i.button,c=i.clientX,d=i.clientY;if(l===Yse){var u={x:c,y:d},f=n();if(f.type==="DRAGGING"){i.preventDefault(),f.actions.move(u);return}f.type!=="PENDING"&&Gn(!1);var h=f.point;if(Wnt(h,u)){i.preventDefault();var m=f.actions.fluidLift(u);s({type:"DRAGGING",actions:m})}}}},{eventName:"mouseup",fn:function(i){var l=n();if(l.type!=="DRAGGING"){t();return}i.preventDefault(),l.actions.drop({shouldBlockNextClick:!0}),r()}},{eventName:"mousedown",fn:function(i){n().type==="DRAGGING"&&i.preventDefault(),t()}},{eventName:"keydown",fn:function(i){var l=n();if(l.type==="PENDING"){t();return}if(i.keyCode===xF){i.preventDefault(),t();return}Xse(i)}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(){n().type==="PENDING"&&t()}},{eventName:"webkitmouseforcedown",fn:function(i){var l=n();if(l.type==="IDLE"&&Gn(!1),l.actions.shouldRespectForcePress()){t();return}i.preventDefault()}},{eventName:UA,fn:t}]}function Gnt(e){var t=p.useRef(sV),r=p.useRef(lp),n=Gs(function(){return{eventName:"mousedown",fn:function(f){if(!f.defaultPrevented&&f.button===Yse&&!(f.ctrlKey||f.metaKey||f.shiftKey||f.altKey)){var h=e.findClosestDraggableId(f);if(h){var m=e.tryGetLock(h,i,{sourceEvent:f});if(m){f.preventDefault();var x={x:f.clientX,y:f.clientY};r.current(),d(m,x)}}}}}},[e]),s=Gs(function(){return{eventName:"webkitmouseforcewillbegin",fn:function(f){if(!f.defaultPrevented){var h=e.findClosestDraggableId(f);if(h){var m=e.findOptionsForDraggable(h);m&&(m.shouldRespectForcePress||e.canGetLock(h)&&f.preventDefault())}}}}},[e]),o=Ba(function(){var f={passive:!1,capture:!0};r.current=mu(window,[s,n],f)},[s,n]),i=Ba(function(){var u=t.current;u.type!=="IDLE"&&(t.current=sV,r.current(),o())},[o]),l=Ba(function(){var u=t.current;i(),u.type==="DRAGGING"&&u.actions.cancel({shouldBlockNextClick:!0}),u.type==="PENDING"&&u.actions.abort()},[i]),c=Ba(function(){var f={capture:!0,passive:!1},h=Hnt({cancel:l,completed:i,getPhase:function(){return t.current},setPhase:function(x){t.current=x}});r.current=mu(window,h,f)},[l,i]),d=Ba(function(f,h){t.current.type!=="IDLE"&&Gn(!1),t.current={type:"PENDING",point:h,actions:f},c()},[c]);Td(function(){return o(),function(){r.current()}},[o])}var Zx;function Knt(){}var Xnt=(Zx={},Zx[Fnt]=!0,Zx[Rnt]=!0,Zx[$nt]=!0,Zx[Lnt]=!0,Zx);function Ynt(e,t){function r(){t(),e.cancel()}function n(){t(),e.drop()}return[{eventName:"keydown",fn:function(o){if(o.keyCode===xF){o.preventDefault(),r();return}if(o.keyCode===Kse){o.preventDefault(),n();return}if(o.keyCode===Unt){o.preventDefault(),e.moveDown();return}if(o.keyCode===qnt){o.preventDefault(),e.moveUp();return}if(o.keyCode===znt){o.preventDefault(),e.moveRight();return}if(o.keyCode===Bnt){o.preventDefault(),e.moveLeft();return}if(Xnt[o.keyCode]){o.preventDefault();return}Xse(o)}},{eventName:"mousedown",fn:r},{eventName:"mouseup",fn:r},{eventName:"click",fn:r},{eventName:"touchstart",fn:r},{eventName:"resize",fn:r},{eventName:"wheel",fn:r,options:{passive:!0}},{eventName:UA,fn:r}]}function Jnt(e){var t=p.useRef(Knt),r=Gs(function(){return{eventName:"keydown",fn:function(o){if(o.defaultPrevented||o.keyCode!==Kse)return;var i=e.findClosestDraggableId(o);if(!i)return;var l=e.tryGetLock(i,u,{sourceEvent:o});if(!l)return;o.preventDefault();var c=!0,d=l.snapLift();t.current();function u(){c||Gn(!1),c=!1,t.current(),n()}t.current=mu(window,Ynt(d,u),{capture:!0,passive:!1})}}},[e]),n=Ba(function(){var o={passive:!1,capture:!0};t.current=mu(window,[r],o)},[r]);Td(function(){return n(),function(){t.current()}},[n])}var kk={type:"IDLE"},Qnt=120,Znt=.15;function eat(e){var t=e.cancel,r=e.getPhase;return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:function(s){s.preventDefault()}},{eventName:"keydown",fn:function(s){if(r().type!=="DRAGGING"){t();return}s.keyCode===xF&&s.preventDefault(),t()}},{eventName:UA,fn:t}]}function tat(e){var t=e.cancel,r=e.completed,n=e.getPhase;return[{eventName:"touchmove",options:{capture:!1},fn:function(o){var i=n();if(i.type!=="DRAGGING"){t();return}i.hasMoved=!0;var l=o.touches[0],c=l.clientX,d=l.clientY,u={x:c,y:d};o.preventDefault(),i.actions.move(u)}},{eventName:"touchend",fn:function(o){var i=n();if(i.type!=="DRAGGING"){t();return}o.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),r()}},{eventName:"touchcancel",fn:function(o){if(n().type!=="DRAGGING"){t();return}o.preventDefault(),t()}},{eventName:"touchforcechange",fn:function(o){var i=n();i.type==="IDLE"&&Gn(!1);var l=o.touches[0];if(l){var c=l.force>=Znt;if(c){var d=i.actions.shouldRespectForcePress();if(i.type==="PENDING"){d&&t();return}if(d){if(i.hasMoved){o.preventDefault();return}t();return}o.preventDefault()}}}},{eventName:UA,fn:t}]}function rat(e){var t=p.useRef(kk),r=p.useRef(lp),n=Ba(function(){return t.current},[]),s=Ba(function(m){t.current=m},[]),o=Gs(function(){return{eventName:"touchstart",fn:function(m){if(!m.defaultPrevented){var x=e.findClosestDraggableId(m);if(x){var g=e.tryGetLock(x,l,{sourceEvent:m});if(g){var v=m.touches[0],y=v.clientX,b=v.clientY,w={x:y,y:b};r.current(),f(g,w)}}}}}},[e]),i=Ba(function(){var m={capture:!0,passive:!1};r.current=mu(window,[o],m)},[o]),l=Ba(function(){var h=t.current;h.type!=="IDLE"&&(h.type==="PENDING"&&clearTimeout(h.longPressTimerId),s(kk),r.current(),i())},[i,s]),c=Ba(function(){var h=t.current;l(),h.type==="DRAGGING"&&h.actions.cancel({shouldBlockNextClick:!0}),h.type==="PENDING"&&h.actions.abort()},[l]),d=Ba(function(){var m={capture:!0,passive:!1},x={cancel:c,completed:l,getPhase:n},g=mu(window,tat(x),m),v=mu(window,eat(x),m);r.current=function(){g(),v()}},[c,n,l]),u=Ba(function(){var m=n();m.type!=="PENDING"&&Gn(!1);var x=m.actions.fluidLift(m.point);s({type:"DRAGGING",actions:x,hasMoved:!1})},[n,s]),f=Ba(function(m,x){n().type!=="IDLE"&&Gn(!1);var g=setTimeout(u,Qnt);s({type:"PENDING",point:x,actions:m,longPressTimerId:g}),d()},[d,n,s,u]);Td(function(){return i(),function(){r.current();var x=n();x.type==="PENDING"&&(clearTimeout(x.longPressTimerId),s(kk))}},[n,i,s]),Td(function(){var m=mu(window,[{eventName:"touchmove",fn:function(){},options:{capture:!1,passive:!1}}]);return m},[])}var nat={input:!0,button:!0,textarea:!0,select:!0,option:!0,optgroup:!0,video:!0,audio:!0};function Jse(e,t){if(t==null)return!1;var r=!!nat[t.tagName.toLowerCase()];if(r)return!0;var n=t.getAttribute("contenteditable");return n==="true"||n===""?!0:t===e?!1:Jse(e,t.parentElement)}function aat(e,t){var r=t.target;return qA(r)?Jse(e,r):!1}var sat=function(e){return Ju(e.getBoundingClientRect()).center};function oat(e){return e instanceof Hse(e).Element}var iat=function(){var e="matches";if(typeof document>"u")return e;var t=[e,"msMatchesSelector","webkitMatchesSelector"],r=Lp(t,function(n){return n in Element.prototype});return r||e}();function Qse(e,t){return e==null?null:e[iat](t)?e:Qse(e.parentElement,t)}function lat(e,t){return e.closest?e.closest(t):Qse(e,t)}function cat(e){return"["+X0.contextId+'="'+e+'"]'}function dat(e,t){var r=t.target;if(!oat(r))return null;var n=cat(e),s=lat(r,n);return!s||!qA(s)?null:s}function uat(e,t){var r=dat(e,t);return r?r.getAttribute(X0.draggableId):null}function fat(e,t){var r="["+R3.contextId+'="'+e+'"]',n=hse(document.querySelectorAll(r)),s=Lp(n,function(o){return o.getAttribute(R3.id)===t});return!s||!qA(s)?null:s}function mat(e){e.preventDefault()}function n2(e){var t=e.expected,r=e.phase,n=e.isLockActive;return e.shouldWarn,!(!n()||t!==r)}function Zse(e){var t=e.lockAPI,r=e.store,n=e.registry,s=e.draggableId;if(t.isClaimed())return!1;var o=n.draggable.findById(s);return!(!o||!o.options.isEnabled||!zse(r.getState(),s))}function hat(e){var t=e.lockAPI,r=e.contextId,n=e.store,s=e.registry,o=e.draggableId,i=e.forceSensorStop,l=e.sourceEvent,c=Zse({lockAPI:t,store:n,registry:s,draggableId:o});if(!c)return null;var d=s.draggable.getById(o),u=fat(r,d.descriptor.id);if(!u||l&&!d.options.canDragInteractiveElements&&aat(u,l))return null;var f=t.claim(i||lp),h="PRE_DRAG";function m(){return d.options.shouldRespectForcePress}function x(){return t.isActive(f)}function g(C,E){n2({expected:C,phase:h,isLockActive:x,shouldWarn:!0})&&n.dispatch(E())}var v=g.bind(null,"DRAGGING");function y(C){function E(){t.release(),h="COMPLETED"}h!=="PRE_DRAG"&&(E(),h!=="PRE_DRAG"&&Gn(!1)),n.dispatch(irt(C.liftActionArgs)),h="DRAGGING";function S(A,M){if(M===void 0&&(M={shouldBlockNextClick:!1}),C.cleanup(),M.shouldBlockNextClick){var O=mu(window,[{eventName:"click",fn:mat,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(O)}E(),n.dispatch(Mse({reason:A}))}return Ka({isActive:function(){return n2({expected:"DRAGGING",phase:h,isLockActive:x,shouldWarn:!1})},shouldRespectForcePress:m,drop:function(M){return S("DROP",M)},cancel:function(M){return S("CANCEL",M)}},C.actions)}function b(C){var E=L1(function(A){v(function(){return Dse({client:A})})}),S=y({liftActionArgs:{id:o,clientSelection:C,movementMode:"FLUID"},cleanup:function(){return E.cancel()},actions:{move:E}});return Ka({},S,{move:E})}function w(){var C={moveUp:function(){return v(grt)},moveRight:function(){return v(vrt)},moveDown:function(){return v(xrt)},moveLeft:function(){return v(yrt)}};return y({liftActionArgs:{id:o,clientSelection:sat(u),movementMode:"SNAP"},cleanup:lp,actions:C})}function j(){var C=n2({expected:"PRE_DRAG",phase:h,isLockActive:x,shouldWarn:!0});C&&t.release()}var _={isActive:function(){return n2({expected:"PRE_DRAG",phase:h,isLockActive:x,shouldWarn:!1})},shouldRespectForcePress:m,fluidLift:b,snapLift:w,abort:j};return _}var pat=[Gnt,Jnt,rat];function gat(e){var t=e.contextId,r=e.store,n=e.registry,s=e.customSensors,o=e.enableDefaultSensors,i=[].concat(o?pat:[],s||[]),l=p.useState(function(){return Tnt()})[0],c=Ba(function(b,w){b.isDragging&&!w.isDragging&&l.tryAbandon()},[l]);Td(function(){var b=r.getState(),w=r.subscribe(function(){var j=r.getState();c(b,j),b=j});return w},[l,r,c]),Td(function(){return l.tryAbandon},[l.tryAbandon]);for(var d=Ba(function(y){return Zse({lockAPI:l,registry:n,store:r,draggableId:y})},[l,n,r]),u=Ba(function(y,b,w){return hat({lockAPI:l,registry:n,contextId:t,store:r,draggableId:y,forceSensorStop:b,sourceEvent:w&&w.sourceEvent?w.sourceEvent:null})},[t,l,n,r]),f=Ba(function(y){return uat(t,y)},[t]),h=Ba(function(y){var b=n.draggable.findById(y);return b?b.options:null},[n.draggable]),m=Ba(function(){l.isClaimed()&&(l.tryAbandon(),r.getState().phase!=="IDLE"&&r.dispatch(iF()))},[l,r]),x=Ba(l.isClaimed,[l]),g=Gs(function(){return{canGetLock:d,tryGetLock:u,findClosestDraggableId:f,findOptionsForDraggable:h,tryReleaseLock:m,isLockClaimed:x}},[d,u,f,h,m,x]),v=0;v<i.length;v++)i[v](g)}var xat=function(t){return{onBeforeCapture:t.onBeforeCapture,onBeforeDragStart:t.onBeforeDragStart,onDragStart:t.onDragStart,onDragEnd:t.onDragEnd,onDragUpdate:t.onDragUpdate}};function ub(e){return e.current||Gn(!1),e.current}function vat(e){var t=e.contextId,r=e.setCallbacks,n=e.sensors,s=e.nonce,o=e.dragHandleUsageInstructions,i=p.useRef(null),l=Gse(e),c=Ba(function(){return xat(l.current)},[l]),d=Pnt(t),u=Ont({contextId:t,text:o}),f=wnt(t,s),h=Ba(function(A){ub(i).dispatch(A)},[]),m=Gs(function(){return PU({publishWhileDragging:crt,updateDroppableScroll:urt,updateDroppableIsEnabled:frt,updateDroppableIsCombineEnabled:mrt,collectionStarting:drt},h)},[h]),x=Snt(),g=Gs(function(){return Zrt(x,m)},[x,m]),v=Gs(function(){return gnt(Ka({scrollWindow:ent,scrollDroppable:g.scrollDroppable},PU({move:Dse},h)))},[g.scrollDroppable,h]),y=_nt(t),b=Gs(function(){return Xrt({announce:d,autoScroller:v,dimensionMarshal:g,focusMarshal:y,getResponders:c,styleMarshal:f})},[d,v,g,y,c,f]);i.current=b;var w=Ba(function(){var A=ub(i),M=A.getState();M.phase!=="IDLE"&&A.dispatch(iF())},[]),j=Ba(function(){var A=ub(i).getState();return A.isDragging||A.phase==="DROP_ANIMATING"},[]),_=Gs(function(){return{isDragging:j,tryAbort:w}},[j,w]);r(_);var C=Ba(function(A){return zse(ub(i).getState(),A)},[]),E=Ba(function(){return ig(ub(i).getState())},[]),S=Gs(function(){return{marshal:g,focus:y,contextId:t,canLift:C,isMovementAllowed:E,dragHandleUsageInstructionsId:u,registry:x}},[t,g,u,y,C,E,x]);return gat({contextId:t,store:b,registry:x,customSensors:n,enableDefaultSensors:e.enableDefaultSensors!==!1}),p.useEffect(function(){return w},[w]),Ce.createElement(zA.Provider,{value:S},Ce.createElement($Ze,{context:pF,store:b},e.children))}var yat=0;function bat(){return Gs(function(){return""+yat++},[])}function wat(e){var t=bat(),r=e.dragHandleUsageInstructions||U2.dragHandleUsageInstructions;return Ce.createElement(Jet,null,function(n){return Ce.createElement(vat,{nonce:e.nonce,contextId:t,setCallbacks:n,dragHandleUsageInstructions:r,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd},e.children)})}var eoe=function(t){return function(r){return t===r}},jat=eoe("scroll"),_at=eoe("auto"),oV=function(t,r){return r(t.overflowX)||r(t.overflowY)},Nat=function(t){var r=window.getComputedStyle(t),n={overflowX:r.overflowX,overflowY:r.overflowY};return oV(n,jat)||oV(n,_at)},Sat=function(){return!1},Cat=function e(t){return t==null?null:t===document.body?Sat()?t:null:t===document.documentElement?null:Nat(t)?t:e(t.parentElement)},F3=function(e){return{x:e.scrollLeft,y:e.scrollTop}},Aat=function e(t){if(!t)return!1;var r=window.getComputedStyle(t);return r.position==="fixed"?!0:e(t.parentElement)},Pat=function(e){var t=Cat(e),r=Aat(e);return{closestScrollable:t,isFixedOnPage:r}},Eat=function(e){var t=e.descriptor,r=e.isEnabled,n=e.isCombineEnabled,s=e.isFixedOnPage,o=e.direction,i=e.client,l=e.page,c=e.closest,d=function(){if(!c)return null;var m=c.scrollSize,x=c.client,g=$se({scrollHeight:m.scrollHeight,scrollWidth:m.scrollWidth,height:x.paddingBox.height,width:x.paddingBox.width});return{pageMarginBox:c.page.marginBox,frameClient:x,scrollSize:m,shouldClipSubject:c.shouldClipSubject,scroll:{initial:c.scroll,current:c.scroll,max:g,diff:{value:ml,displacement:ml}}}}(),u=o==="vertical"?rF:yse,f=G0({page:l,withPlaceholder:null,axis:u,frame:d}),h={descriptor:t,isCombineEnabled:n,isFixedOnPage:s,axis:u,isEnabled:r,client:i,page:l,frame:d,subject:f};return h},kat=function(t,r){var n=cse(t);if(!r||t!==r)return n;var s=n.paddingBox.top-r.scrollTop,o=n.paddingBox.left-r.scrollLeft,i=s+r.scrollHeight,l=o+r.scrollWidth,c={top:s,right:l,bottom:i,left:o},d=JR(c,n.border),u=QR({borderBox:d,margin:n.margin,border:n.border,padding:n.padding});return u},Iat=function(e){var t=e.ref,r=e.descriptor,n=e.env,s=e.windowScroll,o=e.direction,i=e.isDropDisabled,l=e.isCombineEnabled,c=e.shouldClipSubject,d=n.closestScrollable,u=kat(t,d),f=lC(u,s),h=function(){if(!d)return null;var x=cse(d),g={scrollHeight:d.scrollHeight,scrollWidth:d.scrollWidth};return{client:x,page:lC(x,s),scroll:F3(d),scrollSize:g,shouldClipSubject:c}}(),m=Eat({descriptor:r,isEnabled:!i,isCombineEnabled:l,isFixedOnPage:n.isFixedOnPage,direction:o,client:u,page:f,closest:h});return m},Oat={passive:!1},Tat={passive:!0},iV=function(e){return e.shouldPublishImmediately?Oat:Tat};function hC(e){var t=p.useContext(e);return t||Gn(!1),t}var a2=function(t){return t&&t.env.closestScrollable||null};function Dat(e){var t=p.useRef(null),r=hC(zA),n=gF("droppable"),s=r.registry,o=r.marshal,i=Gse(e),l=Gs(function(){return{id:e.droppableId,type:e.type,mode:e.mode}},[e.droppableId,e.mode,e.type]),c=p.useRef(l),d=Gs(function(){return fl(function(j,_){t.current||Gn(!1);var C={x:j,y:_};o.updateDroppableScroll(l.id,C)})},[l.id,o]),u=Ba(function(){var j=t.current;return!j||!j.env.closestScrollable?ml:F3(j.env.closestScrollable)},[]),f=Ba(function(){var j=u();d(j.x,j.y)},[u,d]),h=Gs(function(){return L1(f)},[f]),m=Ba(function(){var j=t.current,_=a2(j);j&&_||Gn(!1);var C=j.scrollOptions;if(C.shouldPublishImmediately){f();return}h()},[h,f]),x=Ba(function(j,_){t.current&&Gn(!1);var C=i.current,E=C.getDroppableRef();E||Gn(!1);var S=Pat(E),A={ref:E,descriptor:l,env:S,scrollOptions:_};t.current=A;var M=Iat({ref:E,descriptor:l,env:S,windowScroll:j,direction:C.direction,isDropDisabled:C.isDropDisabled,isCombineEnabled:C.isCombineEnabled,shouldClipSubject:!C.ignoreContainerClipping}),O=S.closestScrollable;return O&&(O.setAttribute(rV.contextId,r.contextId),O.addEventListener("scroll",m,iV(A.scrollOptions))),M},[r.contextId,l,m,i]),g=Ba(function(){var j=t.current,_=a2(j);return j&&_||Gn(!1),F3(_)},[]),v=Ba(function(){var j=t.current;j||Gn(!1);var _=a2(j);t.current=null,_&&(h.cancel(),_.removeAttribute(rV.contextId),_.removeEventListener("scroll",m,iV(j.scrollOptions)))},[m,h]),y=Ba(function(j){var _=t.current;_||Gn(!1);var C=a2(_);C||Gn(!1),C.scrollTop+=j.y,C.scrollLeft+=j.x},[]),b=Gs(function(){return{getDimensionAndWatchScroll:x,getScrollWhileDragging:g,dragStopped:v,scroll:y}},[v,x,g,y]),w=Gs(function(){return{uniqueId:n,descriptor:l,callbacks:b}},[b,l,n]);Td(function(){return c.current=w.descriptor,s.droppable.register(w),function(){t.current&&v(),s.droppable.unregister(w)}},[b,l,v,w,o,s.droppable]),Td(function(){t.current&&o.updateDroppableIsEnabled(c.current.id,!e.isDropDisabled)},[e.isDropDisabled,o]),Td(function(){t.current&&o.updateDroppableIsCombineEnabled(c.current.id,e.isCombineEnabled)},[e.isCombineEnabled,o])}function Ik(){}var lV={width:0,height:0,margin:ntt},Mat=function(t){var r=t.isAnimatingOpenOnMount,n=t.placeholder,s=t.animate;return r||s==="close"?lV:{height:n.client.borderBox.height,width:n.client.borderBox.width,margin:n.client.margin}},Rat=function(t){var r=t.isAnimatingOpenOnMount,n=t.placeholder,s=t.animate,o=Mat({isAnimatingOpenOnMount:r,placeholder:n,animate:s});return{display:n.display,boxSizing:"border-box",width:o.width,height:o.height,marginTop:o.margin.top,marginRight:o.margin.right,marginBottom:o.margin.bottom,marginLeft:o.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:s!=="none"?fw.placeholder:null}};function Fat(e){var t=p.useRef(null),r=Ba(function(){t.current&&(clearTimeout(t.current),t.current=null)},[]),n=e.animate,s=e.onTransitionEnd,o=e.onClose,i=e.contextId,l=p.useState(e.animate==="open"),c=l[0],d=l[1];p.useEffect(function(){return c?n!=="open"?(r(),d(!1),Ik):t.current?Ik:(t.current=setTimeout(function(){t.current=null,d(!1)}),r):Ik},[n,c,r]);var u=Ba(function(h){h.propertyName==="height"&&(s(),n==="close"&&o())},[n,o,s]),f=Rat({isAnimatingOpenOnMount:c,animate:e.animate,placeholder:e.placeholder});return Ce.createElement(e.placeholder.tagName,{style:f,"data-rbd-placeholder-context-id":i,onTransitionEnd:u,ref:e.innerRef})}var Lat=Ce.memo(Fat),vF=Ce.createContext(null),$at=function(e){qZ(t,e);function t(){for(var n,s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return n=e.call.apply(e,[this].concat(o))||this,n.state={isVisible:!!n.props.on,data:n.props.on,animate:n.props.shouldAnimate&&n.props.on?"open":"none"},n.onClose=function(){n.state.animate==="close"&&n.setState({isVisible:!1})},n}t.getDerivedStateFromProps=function(s,o){return s.shouldAnimate?s.on?{isVisible:!0,data:s.on,animate:"open"}:o.isVisible?{isVisible:!0,data:o.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!s.on,data:s.on,animate:"none"}};var r=t.prototype;return r.render=function(){if(!this.state.isVisible)return null;var s={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(s)},t}(Ce.PureComponent),cV={dragging:5e3,dropAnimating:4500},Bat=function(t,r){return r?fw.drop(r.duration):t?fw.snap:fw.fluid},qat=function(t,r){return t?r?z1.opacity.drop:z1.opacity.combining:null},zat=function(t){return t.forceShouldAnimate!=null?t.forceShouldAnimate:t.mode==="SNAP"};function Uat(e){var t=e.dimension,r=t.client,n=e.offset,s=e.combineWith,o=e.dropping,i=!!s,l=zat(e),c=!!o,d=c?D3.drop(n,i):D3.moveTo(n),u={position:"fixed",top:r.marginBox.top,left:r.marginBox.left,boxSizing:"border-box",width:r.borderBox.width,height:r.borderBox.height,transition:Bat(l,o),transform:d,opacity:qat(i,c),zIndex:c?cV.dropAnimating:cV.dragging,pointerEvents:"none"};return u}function Vat(e){return{transform:D3.moveTo(e.offset),transition:e.shouldAnimateDisplacement?null:"none"}}function Wat(e){return e.type==="DRAGGING"?Uat(e):Vat(e)}function Hat(e,t,r){r===void 0&&(r=ml);var n=window.getComputedStyle(t),s=t.getBoundingClientRect(),o=lse(s,n),i=lC(o,r),l={client:o,tagName:t.tagName.toLowerCase(),display:n.display},c={x:o.marginBox.width,y:o.marginBox.height},d={descriptor:e,placeholder:l,displaceBy:c,client:o,page:i};return d}function Gat(e){var t=gF("draggable"),r=e.descriptor,n=e.registry,s=e.getDraggableRef,o=e.canDragInteractiveElements,i=e.shouldRespectForcePress,l=e.isEnabled,c=Gs(function(){return{canDragInteractiveElements:o,shouldRespectForcePress:i,isEnabled:l}},[o,l,i]),d=Ba(function(m){var x=s();return x||Gn(!1),Hat(r,x,m)},[r,s]),u=Gs(function(){return{uniqueId:t,descriptor:r,options:c,getDimension:d}},[r,d,c,t]),f=p.useRef(u),h=p.useRef(!0);Td(function(){return n.draggable.register(f.current),function(){return n.draggable.unregister(f.current)}},[n.draggable]),Td(function(){if(h.current){h.current=!1;return}var m=f.current;f.current=u,n.draggable.update(u,m)},[u,n.draggable])}function Kat(e){e.preventDefault()}function Xat(e){var t=p.useRef(null),r=Ba(function(A){t.current=A},[]),n=Ba(function(){return t.current},[]),s=hC(zA),o=s.contextId,i=s.dragHandleUsageInstructionsId,l=s.registry,c=hC(vF),d=c.type,u=c.droppableId,f=Gs(function(){return{id:e.draggableId,index:e.index,type:d,droppableId:u}},[e.draggableId,e.index,d,u]),h=e.children,m=e.draggableId,x=e.isEnabled,g=e.shouldRespectForcePress,v=e.canDragInteractiveElements,y=e.isClone,b=e.mapped,w=e.dropAnimationFinished;if(!y){var j=Gs(function(){return{descriptor:f,registry:l,getDraggableRef:n,canDragInteractiveElements:v,shouldRespectForcePress:g,isEnabled:x}},[f,l,n,v,g,x]);Gat(j)}var _=Gs(function(){return x?{tabIndex:0,role:"button","aria-describedby":i,"data-rbd-drag-handle-draggable-id":m,"data-rbd-drag-handle-context-id":o,draggable:!1,onDragStart:Kat}:null},[o,i,m,x]),C=Ba(function(A){b.type==="DRAGGING"&&b.dropping&&A.propertyName==="transform"&&w()},[w,b]),E=Gs(function(){var A=Wat(b),M=b.type==="DRAGGING"&&b.dropping?C:null,O={innerRef:r,draggableProps:{"data-rbd-draggable-context-id":o,"data-rbd-draggable-id":m,style:A,onTransitionEnd:M},dragHandleProps:_};return O},[o,_,m,b,C,r]),S=Gs(function(){return{draggableId:f.id,type:f.type,source:{index:f.index,droppableId:f.droppableId}}},[f.droppableId,f.id,f.index,f.type]);return h(E,b.snapshot,S)}var toe=function(e,t){return e===t},roe=function(e){var t=e.combine,r=e.destination;return r?r.droppableId:t?t.droppableId:null},Yat=function(t){return t.combine?t.combine.draggableId:null},Jat=function(t){return t.at&&t.at.type==="COMBINE"?t.at.combine.draggableId:null};function Qat(){var e=fl(function(s,o){return{x:s,y:o}}),t=fl(function(s,o,i,l,c){return{isDragging:!0,isClone:o,isDropAnimating:!!c,dropAnimation:c,mode:s,draggingOver:i,combineWith:l,combineTargetFor:null}}),r=fl(function(s,o,i,l,c,d,u){return{mapped:{type:"DRAGGING",dropping:null,draggingOver:c,combineWith:d,mode:o,offset:s,dimension:i,forceShouldAnimate:u,snapshot:t(o,l,c,d,null)}}}),n=function(o,i){if(o.isDragging){if(o.critical.draggable.id!==i.draggableId)return null;var l=o.current.client.offset,c=o.dimensions.draggables[i.draggableId],d=Od(o.impact),u=Jat(o.impact),f=o.forceShouldAnimate;return r(e(l.x,l.y),o.movementMode,c,i.isClone,d,u,f)}if(o.phase==="DROP_ANIMATING"){var h=o.completed;if(h.result.draggableId!==i.draggableId)return null;var m=i.isClone,x=o.dimensions.draggables[i.draggableId],g=h.result,v=g.mode,y=roe(g),b=Yat(g),w=o.dropDuration,j={duration:w,curve:cF.drop,moveTo:o.newHomeClientOffset,opacity:b?z1.opacity.drop:null,scale:b?z1.scale.drop:null};return{mapped:{type:"DRAGGING",offset:o.newHomeClientOffset,dimension:x,dropping:j,draggingOver:y,combineWith:b,mode:v,forceShouldAnimate:null,snapshot:t(v,m,y,b,j)}}}return null};return n}function noe(e){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}var Zat={mapped:{type:"SECONDARY",offset:ml,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:noe(null)}};function est(){var e=fl(function(i,l){return{x:i,y:l}}),t=fl(noe),r=fl(function(i,l,c){return l===void 0&&(l=null),{mapped:{type:"SECONDARY",offset:i,combineTargetFor:l,shouldAnimateDisplacement:c,snapshot:t(l)}}}),n=function(l){return l?r(ml,l,!0):null},s=function(l,c,d,u){var f=d.displaced.visible[l],h=!!(u.inVirtualList&&u.effected[l]),m=LA(d),x=m&&m.draggableId===l?c:null;if(!f){if(!h)return n(x);if(d.displaced.invisible[l])return null;var g=Ay(u.displacedBy.point),v=e(g.x,g.y);return r(v,x,!0)}if(h)return n(x);var y=d.displacedBy.point,b=e(y.x,y.y);return r(b,x,f.shouldAnimate)},o=function(l,c){if(l.isDragging)return l.critical.draggable.id===c.draggableId?null:s(c.draggableId,l.critical.draggable.id,l.impact,l.afterCritical);if(l.phase==="DROP_ANIMATING"){var d=l.completed;return d.result.draggableId===c.draggableId?null:s(c.draggableId,d.result.draggableId,d.impact,d.afterCritical)}return null};return o}var tst=function(){var t=Qat(),r=est(),n=function(o,i){return t(o,i)||r(o,i)||Zat};return n},rst={dropAnimationFinished:Rse},nst=ose(tst,rst,null,{context:pF,pure:!0,areStatePropsEqual:toe})(Xat);function aoe(e){var t=hC(vF),r=t.isUsingCloneFor;return r===e.draggableId&&!e.isClone?null:Ce.createElement(nst,e)}function ast(e){var t=typeof e.isDragDisabled=="boolean"?!e.isDragDisabled:!0,r=!!e.disableInteractiveElementBlocking,n=!!e.shouldRespectForcePress;return Ce.createElement(aoe,Ka({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:r,shouldRespectForcePress:n}))}function sst(e){var t=p.useContext(zA);t||Gn(!1);var r=t.contextId,n=t.isMovementAllowed,s=p.useRef(null),o=p.useRef(null),i=e.children,l=e.droppableId,c=e.type,d=e.mode,u=e.direction,f=e.ignoreContainerClipping,h=e.isDropDisabled,m=e.isCombineEnabled,x=e.snapshot,g=e.useClone,v=e.updateViewportMaxScroll,y=e.getContainerForClone,b=Ba(function(){return s.current},[]),w=Ba(function(O){s.current=O},[]);Ba(function(){return o.current},[]);var j=Ba(function(O){o.current=O},[]),_=Ba(function(){n()&&v({maxScroll:qse()})},[n,v]);Dat({droppableId:l,type:c,mode:d,direction:u,isDropDisabled:h,isCombineEnabled:m,ignoreContainerClipping:f,getDroppableRef:b});var C=Ce.createElement($at,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},function(O){var I=O.onClose,T=O.data,k=O.animate;return Ce.createElement(Lat,{placeholder:T,onClose:I,innerRef:j,animate:k,contextId:r,onTransitionEnd:_})}),E=Gs(function(){return{innerRef:w,placeholder:C,droppableProps:{"data-rbd-droppable-id":l,"data-rbd-droppable-context-id":r}}},[r,l,C,w]),S=g?g.dragging.draggableId:null,A=Gs(function(){return{droppableId:l,type:c,isUsingCloneFor:S}},[l,S,c]);function M(){if(!g)return null;var O=g.dragging,I=g.render,T=Ce.createElement(aoe,{draggableId:O.draggableId,index:O.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},function(k,q){return I(k,q,O)});return U4.createPortal(T,y())}return Ce.createElement(vF.Provider,{value:A},i(E,x),M())}var Ok=function(t,r){return t===r.droppable.type},dV=function(t,r){return r.draggables[t.draggable.id]},ost=function(){var t={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},r=Ka({},t,{shouldAnimatePlaceholder:!1}),n=fl(function(i){return{draggableId:i.id,type:i.type,source:{index:i.index,droppableId:i.droppableId}}}),s=fl(function(i,l,c,d,u,f){var h=u.descriptor.id,m=u.descriptor.droppableId===i;if(m){var x=f?{render:f,dragging:n(u.descriptor)}:null,g={isDraggingOver:c,draggingOverWith:c?h:null,draggingFromThisWith:h,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!1,snapshot:g,useClone:x}}if(!l)return r;if(!d)return t;var v={isDraggingOver:c,draggingOverWith:h,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:u.placeholder,shouldAnimatePlaceholder:!0,snapshot:v,useClone:null}}),o=function(l,c){var d=c.droppableId,u=c.type,f=!c.isDropDisabled,h=c.renderClone;if(l.isDragging){var m=l.critical;if(!Ok(u,m))return r;var x=dV(m,l.dimensions),g=Od(l.impact)===d;return s(d,f,g,g,x,h)}if(l.phase==="DROP_ANIMATING"){var v=l.completed;if(!Ok(u,v.critical))return r;var y=dV(v.critical,l.dimensions);return s(d,f,roe(v.result)===d,Od(v.impact)===d,y,h)}if(l.phase==="IDLE"&&l.completed&&!l.shouldFlush){var b=l.completed;if(!Ok(u,b.critical))return r;var w=Od(b.impact)===d,j=!!(b.impact.at&&b.impact.at.type==="COMBINE"),_=b.critical.droppable.id===d;return w?j?t:r:_?t:r}return r};return o},ist={updateViewportMaxScroll:prt};function lst(){return document.body||Gn(!1),document.body}var cst={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:lst},soe=ose(ost,ist,null,{context:pF,pure:!0,areStatePropsEqual:toe})(sst);soe.defaultProps=cst;function ev({className:e,...t}){return a.jsx("div",{className:Pr("animate-pulse rounded-md bg-muted/20",e),...t})}function VA(e){return{id:e.id,code:e.codigo_produto??"",name:e.nome,category:e.categoria??"",type:e.tipo_produto==="uso_interno"?"Uso Interno":"Venda",cost:Number(e.valor_custo??e.preco_custo??0),price:Number(e.valor_venda??e.preco_venda??0),stock:Number(e.estoque??e.estoque_atual??0),minStock:Number(e.estoque_minimo??0),status:e.status??(e.ativo===!1||Number(e.estoque??0)===0?"inactive":Number(e.estoque??0)>0&&Number(e.estoque??0)<=Number(e.estoque_minimo??0)?"low_stock":"active"),validade:e.validade?new Date(e.validade):null,barcode:e.codigo_barras??"",barcodeBox:e.codigo_barras_caixa??"",reference:e.referencia??"",brand:e.marca??"",group:e.grupo??"",unit:e.unidade??"UN",initialStock:Number(e.estoque_inicial??0),currentStock:Number(e.estoque_atual??e.estoque??0),weight:e.peso!=null?Number(e.peso):null,buyPrice:e.preco_compra!=null?Number(e.preco_compra):null,costsPercent:e.custos_percent!=null?Number(e.custos_percent):null,costPrice:e.preco_custo!=null?Number(e.preco_custo):null,marginPercent:e.lucro_percent!=null?Number(e.lucro_percent):null,salePrice:e.preco_venda!=null?Number(e.preco_venda):null,wholesaleQty:e.qtd_atacado!=null?Number(e.qtd_atacado):null,wholesalePrice:e.preco_atacado!=null?Number(e.preco_atacado):null,commissionPercent:e.comissao_percent!=null?Number(e.comissao_percent):null,discountPercent:e.desconto_percent!=null?Number(e.desconto_percent):null,cfopInterno:e.cfop_interno??"",cstIcmsInterno:e.cst_icms_interno??"",csosnInterno:e.csosn_interno??"",aliqIcmsInterno:e.aliquota_icms_interno!=null?Number(e.aliquota_icms_interno):null,cfopExterno:e.cfop_externo??"",cstIcmsExterno:e.cst_icms_externo??"",csosnExterno:e.csosn_externo??"",aliqIcmsExterno:e.aliquota_icms_externo!=null?Number(e.aliquota_icms_externo):null,cstPisEntrada:e.cst_pis_entrada??"",cstPisSaida:e.cst_pis_saida??"",aliqPisPercent:e.aliquota_pis_percent!=null?Number(e.aliquota_pis_percent):null,aliqCofinsPercent:e.aliquota_cofins_percent!=null?Number(e.aliquota_cofins_percent):null,cstIpi:e.cst_ipi??"",aliqIpiPercent:e.aliquota_ipi_percent!=null?Number(e.aliquota_ipi_percent):null,fcpPercent:e.fcp_percent!=null?Number(e.fcp_percent):null,mvaPercent:e.mva_percent!=null?Number(e.mva_percent):null,baseReduzidaPercent:e.base_reduzida_percent!=null?Number(e.base_reduzida_percent):null,ncm:e.ncm??"",ncmDescription:e.descricao_ncm??"",cest:e.cest??"",active:e.ativo??!0,allowSale:e.permite_venda??!0,payCommission:e.paga_comissao??!1,variablePrice:e.preco_variavel??!1,composition:e.composicao??!1,service:e.servico??!1,hasGrid:e.grade??!1,usePriceTable:e.usar_tabela_preco??!1,fuel:e.combustivel??!1,useImei:e.usa_imei??!1,stockByGrid:e.controle_estoque_por_grade??!1,showInApp:e.mostrar_no_app??!1,dataImportacao:e.data_importacao?new Date(e.data_importacao):null,importadoViaXml:e.importado_via_xml??!1}}async function dst({from:e,to:t,codigoEmpresa:r,limit:n=1e3}={}){if(!e||!t)throw new Error("Perodo invlido");const s=(e instanceof Date?e:new Date(e)).toISOString(),o=(t instanceof Date?t:new Date(t)).toISOString(),{data:i,error:l}=await Ri(x=>{let g=Q.from("comanda_itens").select("produto_id, quantidade, created_at").gte("created_at",s).lte("created_at",o).limit(n).abortSignal(x);return r&&(g=g.eq("codigo_empresa",r)),g},2e4,"Timeout getSoldProductsByPeriod (20s)");if(l)throw l;const c=new Map;for(const x of i||[]){const g=x.produto_id,v=Number(x.quantidade||0);c.set(g,(c.get(g)||0)+v)}const d=Array.from(c.entries()).sort((x,g)=>g[1]-x[1]);if(d.length===0)return[];const u=d.map(([x])=>x),{data:f,error:h}=await Ri(x=>{let g=Q.from("produtos").select("id, nome").in("id",u).abortSignal(x);return r&&(g=g.eq("codigo_empresa",r)),g},15e3,"Timeout getSoldProductsByPeriod:produtos (15s)");if(h)throw h;const m=new Map((f||[]).map(x=>[x.id,x.nome]));return d.map(([x,g])=>({id:x,name:m.get(x)||String(x),total:g}))}async function Zv({productId:e,delta:t,codigoEmpresa:r}){const n=Number(t);if(!e||!Number.isFinite(n)||n===0)throw new Error("Parmetros invlidos para ajuste de estoque");const{data:s,error:o}=await Ri(d=>{let u=Q.from("produtos").select("id, estoque, estoque_atual").eq("id",e).single().abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},1e4,"Timeout get current stock (10s)");if(o)throw o;const l=Number(s?.estoque??s?.estoque_atual??0)+n,{error:c}=await Ri(d=>{let u=Q.from("produtos").update({estoque:l,estoque_atual:l}).eq("id",e).abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},1e4,"Timeout update stock (10s)");if(c)throw c;return{id:e,stock:l}}async function ust({limit:e=5,codigoEmpresa:t}={}){const r=new Date;r.setHours(0,0,0,0);const n=r.toISOString(),{data:s,error:o}=await Ri(h=>{let m=Q.from("comanda_itens").select("produto_id, quantidade, created_at").gte("created_at",n).abortSignal(h);return t&&(m=m.eq("codigo_empresa",t)),m},15e3,"Timeout getMostSoldProductsToday (15s)");if(o)throw o;const i=new Map;for(const h of s||[]){const m=h.produto_id,x=Number(h.quantidade||0);i.set(m,(i.get(m)||0)+x)}const l=Array.from(i.entries()).sort((h,m)=>m[1]-h[1]).slice(0,e);if(l.length===0)return[];const c=l.map(([h])=>h),{data:d,error:u}=await Ri(h=>{let m=Q.from("produtos").select("id, nome").in("id",c).abortSignal(h);return t&&(m=m.eq("codigo_empresa",t)),m},15e3,"Timeout getMostSoldProductsToday:produtos (15s)");if(u)throw u;const f=new Map((d||[]).map(h=>[h.id,h.nome]));return l.map(([h,m])=>({id:h,name:f.get(h)||String(h),total:m}))}async function uV({codigoEmpresa:e}={}){if(!e)throw new Error("codigoEmpresa  obrigatrio");const{data:t,error:r}=await Ri(l=>Q.from("produtos").select("codigo_produto").eq("codigo_empresa",e).order("codigo_produto",{ascending:!0}).abortSignal(l),15e3,"Timeout getNextProductCode (15s)");if(r)throw r;const n=new Set;for(const l of t||[]){const c=(l.codigo_produto||"").trim();if(/^\d+$/.test(c)){const d=parseInt(c,10);Number.isFinite(d)&&d>0&&n.add(d)}}let s=1;const o=(n.size||0)+1e3;let i=0;for(;n.has(s)&&i<o;)s+=1,i+=1;return(!Number.isFinite(s)||s<=0)&&(s=1),String(s).padStart(4,"0")}function ooe(e){return{codigo_produto:e.code||null,nome:e.name,categoria:e.category||null,tipo_produto:e.type==="Uso Interno"?"uso_interno":"venda",valor_custo:e.cost!=null?Number(e.cost):0,valor_venda:e.price!=null?Number(e.price):0,estoque:e.stock!=null?Number(e.stock):0,estoque_minimo:e.minStock!=null?Number(e.minStock):0,status:e.status||null,validade:e.validade?new Date(e.validade).toISOString().slice(0,10):null,codigo_barras:e.barcode||null,codigo_barras_caixa:e.barcodeBox||null,referencia:e.reference||null,marca:e.brand||null,grupo:e.group||null,unidade:e.unit||null,estoque_inicial:e.initialStock!=null?Number(e.initialStock):null,estoque_atual:e.currentStock!=null?Number(e.currentStock):null,peso:e.weight!=null?Number(e.weight):null,preco_compra:e.buyPrice!=null?Number(e.buyPrice):null,custos_percent:e.costsPercent!=null?Number(e.costsPercent):null,preco_custo:e.costPrice!=null?Number(e.costPrice):null,lucro_percent:e.marginPercent!=null?Number(e.marginPercent):null,preco_venda:e.salePrice!=null?Number(e.salePrice):null,qtd_atacado:e.wholesaleQty!=null?Number(e.wholesaleQty):null,preco_atacado:e.wholesalePrice!=null?Number(e.wholesalePrice):null,comissao_percent:e.commissionPercent!=null?Number(e.commissionPercent):null,desconto_percent:e.discountPercent!=null?Number(e.discountPercent):null,cfop_interno:e.cfopInterno||null,cst_icms_interno:e.cstIcmsInterno||null,csosn_interno:e.csosnInterno||null,aliquota_icms_interno:e.aliqIcmsInterno!=null?Number(e.aliqIcmsInterno):null,cfop_externo:e.cfopExterno||null,cst_icms_externo:e.cstIcmsExterno||null,csosn_externo:e.csosnExterno||null,aliquota_icms_externo:e.aliqIcmsExterno!=null?Number(e.aliqIcmsExterno):null,cst_pis_entrada:e.cstPisEntrada||null,cst_pis_saida:e.cstPisSaida||null,aliquota_pis_percent:e.aliqPisPercent!=null?Number(e.aliqPisPercent):null,aliquota_cofins_percent:e.aliqCofinsPercent!=null?Number(e.aliqCofinsPercent):null,cst_ipi:e.cstIpi||null,aliquota_ipi_percent:e.aliqIpiPercent!=null?Number(e.aliqIpiPercent):null,fcp_percent:e.fcpPercent!=null?Number(e.fcpPercent):null,mva_percent:e.mvaPercent!=null?Number(e.mvaPercent):null,base_reduzida_percent:e.baseReduzidaPercent!=null?Number(e.baseReduzidaPercent):null,ncm:e.ncm||null,descricao_ncm:e.ncmDescription||null,cest:e.cest||null,ativo:e.active!=null?!!e.active:!0,permite_venda:e.allowSale!=null?!!e.allowSale:!0,paga_comissao:e.payCommission!=null?!!e.payCommission:!1,preco_variavel:e.variablePrice!=null?!!e.variablePrice:!1,composicao:e.composition!=null?!!e.composition:!1,servico:e.service!=null?!!e.service:!1,grade:e.hasGrid!=null?!!e.hasGrid:!1,usar_tabela_preco:e.usePriceTable!=null?!!e.usePriceTable:!1,combustivel:e.fuel!=null?!!e.fuel:!1,usa_imei:e.useImei!=null?!!e.useImei:!1,controle_estoque_por_grade:e.stockByGrid!=null?!!e.stockByGrid:!1,mostrar_no_app:e.showInApp!=null?!!e.showInApp:!1,importado_via_xml:e.importedViaXML===!0,data_importacao:e.dataImportacao?e.dataImportacao instanceof Date?e.dataImportacao.toISOString():new Date(e.dataImportacao).toISOString():null,xml_chave:e.xmlChave||null,xml_numero:e.xmlNumero||null,xml_serie:e.xmlSerie||null,xml_emissao:e.xmlEmissao?new Date(e.xmlEmissao).toISOString():null}}async function uf(e={}){const{includeInactive:t=!1,search:r="",codigoEmpresa:n}=e;console.log("[products.api] ====== listProducts INICIO ======"),console.log("[products.api] Parametros:",{includeInactive:t,search:r,codigoEmpresa:n});const{data:s,error:o}=await Ri(c=>{let d=Q.from("produtos").select("*").eq("codigo_empresa",n).order("nome",{ascending:!0}).abortSignal(c);if(t||(d=d.neq("status","inactive"),d=d.or("ativo.is.null,ativo.eq.true"),console.log("[products.api] Filtro aplicado: status != inactive AND (ativo IS NULL OR ativo = true)")),r&&r.trim().length>0){const u=r.trim();d=d.or(`nome.ilike.%${u}%,codigo_produto.ilike.%${u}%`)}return d},15e3,"Timeout listProducts (15s)");if(o)throw console.error("[products.api] listProducts:error",o),o;const i=(s||[]).map(VA);console.log("[products.api] listProducts RETORNOU:",i.length,"produtos"),console.log("[products.api] includeInactive:",t),console.log("[products.api] Produtos:",i.map(c=>({id:c.id,name:c.name,code:c.code})));const l=i.filter(c=>!c.code||c.code.trim()==="");return console.log("[products.api] Produtos SEM cdigo:",l.length),l.length>0&&l.forEach(c=>{console.log("  -",c.name,"| active:",c.active,"| status:",c.status,"| code:",c.code||"NULL")}),i}async function fst(e={}){const{includeInactive:t=!1,search:r="",codigoEmpresa:n,page:s=1,pageSize:o=100}=e;if(!n)return{data:[],count:0};const i=s>0?s:1,l=o>0?o:100,c=(i-1)*l,d=c+l-1;console.log("[products.api] ====== listProductsPaged INICIO ======",{includeInactive:t,search:r,codigoEmpresa:n,page:i,pageSize:l});try{const{data:u,error:f,count:h}=await Ri(x=>{let g=Q.from("produtos").select("*",{count:"exact"}).eq("codigo_empresa",n).order("nome",{ascending:!0}).range(c,d).abortSignal(x);if(t||(g=g.neq("status","inactive"),g=g.or("ativo.is.null,ativo.eq.true")),r&&r.trim().length>0){const v=r.trim();g=g.or(`nome.ilike.%${v}%,codigo_produto.ilike.%${v}%`)}return g},2e4,"Timeout listProductsPaged (20s)");if(f)throw console.error("[products.api] listProductsPaged:error",f),f;const m=(u||[]).map(VA);return console.log("[products.api] listProductsPaged RETORNOU:",m.length,"produtos de",h||0),{data:m,count:h||0}}catch(u){return console.error("[products.api] listProductsPaged:exception",u),{data:[],count:0}}}async function pC(e,t={}){const{codigoEmpresa:r}=t,n=ooe(e);r&&(n.codigo_empresa=r),console.info("[products.api] createProduct: payload",n);const s=async()=>Ri(d=>Q.from("produtos").insert(n).select("*").single().abortSignal(d),15e3,"Timeout createProduct (15s)"),o=d=>{if(!d)return!1;if(d.code&&String(d.code)==="23505")return!0;const u=[d.message,d.details,d.hint].filter(Boolean).join(" ").toLowerCase();return u.includes("duplicate key")||u.includes("unique constraint")||u.includes("ux_produtos_empresa_codigo_produto")||u.includes("codigo_produto")};let i,l;if({data:i,error:l}=await s(),l&&o(l)&&n.codigo_produto){console.warn("[products.api] createProduct: duplicate code, trying to free code from inactive product");const{data:d,error:u}=await Ri(h=>Q.from("produtos").select("id,status").eq("codigo_produto",n.codigo_produto).eq("status","inactive").limit(1).abortSignal(h),15e3,"Timeout find duplicate product (15s)"),f=Array.isArray(d)&&d.length>0?d[0]:null;if(!u&&f&&f.status==="inactive"){const{error:h}=await Ri(m=>Q.from("produtos").update({codigo_produto:null}).eq("id",f.id).abortSignal(m),15e3,"Timeout clear duplicate code (15s)");h||({data:i,error:l}=await s())}else{const h=n.codigo_produto;n.codigo_produto=null,console.warn("[products.api] createProduct: no inactive found for duplicate code, retrying with codigo_produto = null (original:",h,")"),{data:i,error:l}=await s()}}if(l)throw console.error("[products.api] createProduct:error",l),l;const c=VA(i);return console.info("[products.api] createProduct: ok",c),c}async function U1(e,t,r={}){const n=ooe(t);n.data_importacao=null,console.info("[products.api] updateProduct: id",e,"payload",n);const{data:s,error:o}=await Ri(l=>Q.from("produtos").update(n).eq("id",e).select("*").single().abortSignal(l),15e3,"Timeout updateProduct (15s)");if(o)throw console.error("[products.api] updateProduct:error",o),o;const i=VA(s);return console.info("[products.api] updateProduct: ok",i),i}async function Ri(e,t,r){const n=new AbortController,s=setTimeout(()=>n.abort(new Error(r)),t);try{return await e(n.signal)}catch(o){throw o?.name==="AbortError"?new Error(r):o}finally{clearTimeout(s)}}async function yF(e){console.info("[products.api] deleteProduct (soft): id",e);const{error:t}=await Ri(r=>Q.from("produtos").update({status:"inactive",codigo_produto:null}).eq("id",e).abortSignal(r),15e3,"Timeout deleteProduct (15s)");if(t)throw console.error("[products.api] deleteProduct:error",t),t;return console.info("[products.api] deleteProduct: ok (inativado)"),!0}async function mst({ids:e,status:t}){const r=Array.isArray(e)?e.filter(Boolean):[];if(!r.length)throw new Error("Nenhum produto selecionado para atualizao em massa");if(!["active","inactive","low_stock"].includes(t))throw new Error("Status invlido para atualizao em massa");const n=t!=="inactive";console.info("[products.api] bulkUpdateProductStatus:start",{count:r.length,status:t});const{error:s}=await Ri(o=>Q.from("produtos").update({status:t,ativo:n}).in("id",r).abortSignal(o),2e4,"Timeout bulkUpdateProductStatus (20s)");if(s)throw console.error("[products.api] bulkUpdateProductStatus:error",s),s;return console.info("[products.api] bulkUpdateProductStatus:ok",{count:r.length,status:t}),!0}async function hst({ids:e}){const t=Array.isArray(e)?e.filter(Boolean):[];if(!t.length)throw new Error("Nenhum produto selecionado para limpar flag de novo");console.info("[products.api] bulkClearNewFlag:start",{count:t.length});const{error:r}=await Ri(n=>Q.from("produtos").update({data_importacao:null}).in("id",t).abortSignal(n),2e4,"Timeout bulkClearNewFlag (20s)");if(r)throw console.error("[products.api] bulkClearNewFlag:error",r),r;return console.info("[products.api] bulkClearNewFlag:ok",{count:t.length}),!0}async function fV(e={}){const{codigoEmpresa:t}=e;console.info("[products.api] listCategories: start");const{data:r,error:n}=await Ri(i=>{let l=Q.from("produto_categorias").select("nome").eq("ativa",!0).order("nome",{ascending:!0}).abortSignal(i);return t&&(l=l.eq("codigo_empresa",t)),l},15e3,"Timeout listCategories (15s)");if(n)throw console.error("[products.api] listCategories:error",n),n;const s=[],o=new Set;for(const i of r||[]){const l=(i?.nome||"").trim();if(!l)continue;const c=l.toLowerCase();o.has(c)||(o.add(c),s.push(l))}return console.info("[products.api] listCategories: ok",{count:s.length}),s}async function pst(e,t={}){const{codigoEmpresa:r}=t,n=String(e||"").trim();if(!n)throw new Error("Nome da categoria invlido");console.info("[products.api] createCategory:",n);const s={nome:n};r&&(s.codigo_empresa=r);const{data:o,error:i}=await Ri(l=>Q.from("produto_categorias").insert(s).select("nome").single().abortSignal(l),15e3,"Timeout createCategory (15s)");if(i)throw console.error("[products.api] createCategory:error",i),i;return o?.nome||n}async function gst(e,t={}){const{codigoEmpresa:r}=t,n=String(e||"").trim();if(!n)throw new Error("Nome da categoria invlido");console.info("[products.api] removeCategory:",n);const{count:s,error:o}=await Ri(d=>{let u=Q.from("produtos").select("id",{count:"exact",head:!0}).eq("categoria",n).neq("status","inactive").abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},15e3,"Timeout removeCategory:count (15s)");if(o)throw console.error("[products.api] removeCategory:count:error",o),o;if((s??0)>0){const d=new Error("Categoria possui produtos ativos vinculados");throw console.warn("[products.api] removeCategory: blocked by active products",{nome:n,prodCount:s}),d}const{data:i,error:l}=await Ri(d=>{let u=Q.from("produto_categorias").update({ativa:!1}).eq("nome",n).select("nome").abortSignal(d);return r&&(u=u.eq("codigo_empresa",r)),u},15e3,"Timeout removeCategory (15s)");if(l)throw console.error("[products.api] removeCategory:error",l),l;if((Array.isArray(i)?i.length:0)===0){const d=new Error("Categoria no encontrada para desativar");throw console.warn("[products.api] removeCategory: no rows affected",{nome:n}),d}return!0}function xst({item:e,onApply:t,onClose:r,codigoEmpresa:n}){const{toast:s}=Zs(),[o,i]=p.useState(e?.desconto_tipo||"percentual"),[l,c]=p.useState(e?.desconto_valor||0),[d,u]=p.useState(e?.desconto_motivo||""),[f,h]=p.useState(!1);if(!e)return null;const m=Number(e.price||e.preco_unitario||0),x=Number(e.quantity||e.quantidade||1),g=m*x,v=o==="percentual"?g*(1-l/100):g-l,y=async()=>{try{if(h(!0),l<0){s({title:"Erro",description:"Desconto no pode ser negativo",variant:"destructive"});return}if(o==="percentual"&&l>100){s({title:"Erro",description:"Desconto percentual no pode ser maior que 100%",variant:"destructive"});return}console.log("Aplicando desconto:",{itemId:e.id,desconto_tipo:o,desconto_valor:Number(l),desconto_motivo:d||null,codigoEmpresa:n});const w=await wKe({itemId:e.id,desconto_tipo:o,desconto_valor:Number(l),desconto_motivo:d||null,codigoEmpresa:n});console.log("Resultado:",w),s({title:"Sucesso",description:"Desconto aplicado!",variant:"success"}),t(),r()}catch(w){console.error("Erro ao aplicar desconto:",w),s({title:"Erro",description:w.message||"Falha ao aplicar desconto",variant:"destructive"})}finally{h(!1)}},b=async()=>{try{h(!0),await _Ke({itemId:e.id,codigoEmpresa:n}),s({title:"Sucesso",description:"Desconto removido!",variant:"success"}),t(),r()}catch(w){console.error("Erro ao remover desconto:",w),s({title:"Erro",description:w.message||"Falha ao remover desconto",variant:"destructive"})}finally{h(!1)}};return a.jsx(Un,{open:!0,onOpenChange:r,children:a.jsxs(zn,{overlayClassName:"z-[90]",className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[91]",children:[a.jsx(Bn,{children:a.jsxs(Ln,{className:"text-lg font-bold",children:["Desconto - ",e.name]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(ct,{className:"text-sm font-semibold mb-2 block",children:"Tipo de Desconto"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:o==="percentual"?"default":"outline",onClick:()=>i("percentual"),disabled:f,className:"flex-1",children:"Percentual (%)"}),a.jsx(Z,{variant:o==="fixo"?"default":"outline",onClick:()=>i("fixo"),disabled:f,className:"flex-1",children:"Fixo (R$)"})]})]}),a.jsxs("div",{children:[a.jsxs(ct,{htmlFor:"desconto-valor",className:"text-sm font-semibold",children:["Valor ",o==="percentual"?"(%)":"(R$)"]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx(It,{id:"desconto-valor",type:"text",value:o==="percentual"?l===0?"":l:l===0?"":`R$ ${l.toFixed(2)}`,onChange:w=>{let j=w.target.value.trim();if(j===""){c(0);return}o==="fixo"&&(j=j.replace(/[^\d.,]/g,"").replace(",","."));let _=Number(j);isNaN(_)&&(_=0),o==="percentual"&&_>100&&(_=100),_<0&&(_=0),c(_)},placeholder:o==="percentual"?"0":"0,00",disabled:f,className:"mt-1"}),o==="percentual"&&a.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary font-semibold",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"desconto-motivo",className:"text-sm font-semibold",children:"Motivo"}),a.jsxs("select",{id:"desconto-motivo",value:d,onChange:w=>u(w.target.value),className:"w-full border border-border rounded-md p-2 mt-1 text-sm bg-background",disabled:f,children:[a.jsx("option",{value:"",children:"Selecione um motivo..."}),a.jsx("option",{value:"Promoo",children:"Promoo"}),a.jsx("option",{value:"Meia entrada",children:"Meia entrada"}),a.jsx("option",{value:"Cortesia",children:"Cortesia"}),a.jsx("option",{value:"Ajuste",children:"Ajuste"}),a.jsx("option",{value:"Outro",children:"Outro"})]})]}),a.jsxs("div",{className:"bg-surface-2 p-4 rounded-lg space-y-2 border border-border",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:"Preo Original:"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",g.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm text-destructive font-semibold",children:[a.jsx("span",{children:"Desconto:"}),a.jsxs("span",{children:["-R$ ",(g-v).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-base font-bold border-t border-border pt-2",children:[a.jsx("span",{children:"Total do Item:"}),a.jsxs("span",{className:"text-brand",children:["R$ ",Math.max(0,v).toFixed(2)]})]})]}),d&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded",children:[a.jsx("strong",{children:"Motivo:"})," ",d]})]}),a.jsxs(Ga,{className:"flex gap-2",children:[a.jsx(Z,{variant:"outline",onClick:r,disabled:f,children:"Cancelar"}),e.desconto_valor>0&&a.jsxs(Z,{variant:"destructive",onClick:b,disabled:f,size:"sm",className:"gap-2",children:[a.jsx(bc,{className:"w-4 h-4"}),"Remover"]}),a.jsx(Z,{onClick:y,disabled:f,className:"gap-2",children:f?"Aplicando...":"Aplicar Desconto"})]})]})})}function ioe({comanda:e,subtotal:t,onApply:r,onClose:n,codigoEmpresa:s}){const{toast:o}=Zs(),[i,l]=p.useState(e?.desconto_tipo||"percentual"),[c,d]=p.useState(e?.desconto_valor||0),[u,f]=p.useState(e?.desconto_motivo||""),[h,m]=p.useState(!1);if(!e)return null;const x=i==="percentual"?t*c/100:c,g=Math.max(0,t-x),v=async()=>{try{if(m(!0),c<0){o({title:"Erro",description:"Desconto no pode ser negativo",variant:"destructive"});return}if(i==="percentual"&&c>100){o({title:"Erro",description:"Desconto percentual no pode ser maior que 100%",variant:"destructive"});return}if(x>t){o({title:"Erro",description:"Desconto no pode ser maior que o subtotal",variant:"destructive"});return}console.log("Aplicando desconto comanda:",{comandaId:e.id,desconto_tipo:i,desconto_valor:Number(c),desconto_motivo:u||null,codigoEmpresa:s});const b=await jKe({comandaId:e.id,desconto_tipo:i,desconto_valor:Number(c),desconto_motivo:u||null,codigoEmpresa:s});console.log("Resultado comanda:",b),o({title:"Sucesso",description:"Desconto aplicado na comanda!",variant:"success"}),r?.(b),n()}catch(b){console.error("Erro ao aplicar desconto:",b),o({title:"Erro",description:b.message||"Falha ao aplicar desconto",variant:"destructive"})}finally{m(!1)}},y=async()=>{try{m(!0);const b=await NKe({comandaId:e.id,codigoEmpresa:s});o({title:"Sucesso",description:"Desconto removido!",variant:"success"}),r?.(b),n()}catch(b){console.error("Erro ao remover desconto:",b),o({title:"Erro",description:b.message||"Falha ao remover desconto",variant:"destructive"})}finally{m(!1)}};return a.jsx(Un,{open:!0,modal:!0,onOpenChange:n,children:a.jsxs(zn,{overlayClassName:"z-[80]",className:"sm:max-w-[420px] w-[92vw] max-h-[75vh] flex flex-col animate-none p-3 sm:p-6",style:{zIndex:1e3},onOpenAutoFocus:b=>b.preventDefault(),onKeyDown:b=>b.stopPropagation(),onKeyDownCapture:b=>b.stopPropagation(),onEscapeKeyDown:b=>b.stopPropagation(),children:[a.jsx(Bn,{className:"pr-6",children:a.jsxs(Ln,{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(nfe,{className:"w-6 h-6 text-brand"}),"Desconto da Comanda"]})}),a.jsxs("div",{className:"mt-2 space-y-4 flex-1 overflow-y-auto thin-scroll pr-0 sm:pr-1",children:[a.jsxs("div",{children:[a.jsx(ct,{className:"text-sm font-semibold mb-2 block",children:"Tipo de Desconto"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:i==="percentual"?"default":"outline",onClick:()=>l("percentual"),disabled:h,className:"flex-1",children:"Percentual (%)"}),a.jsx(Z,{variant:i==="fixo"?"default":"outline",onClick:()=>l("fixo"),disabled:h,className:"flex-1",children:"Fixo (R$)"})]})]}),a.jsxs("div",{children:[a.jsxs(ct,{htmlFor:"desconto-valor",className:"text-sm font-semibold",children:["Valor ",i==="percentual"?"(%)":"(R$)"]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx(It,{id:"desconto-valor",type:"text",name:"desconto-valor",autoComplete:"off",autoCorrect:"off",spellCheck:!1,value:i==="percentual"?c===0?"":String(c):c===0?"":new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(c),onChange:b=>{const w=b.target.value||"";if(w.trim()===""){d(0);return}if(i==="fixo"){const C=w.replace(/\D/g,""),E=C?Number(C)/100:0;d(E);return}let j=w.replace(/[^\d.,]/g,"").replace(",","."),_=Number(j);isNaN(_)&&(_=0),_<0&&(_=0),_>100&&(_=100),d(_)},placeholder:i==="percentual"?"0":"0,00",disabled:h,className:"mt-1"}),i==="percentual"&&a.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary font-semibold",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"desconto-motivo",className:"text-sm font-semibold",children:"Motivo"}),a.jsxs("select",{id:"desconto-motivo",value:u,onChange:b=>f(b.target.value),className:"w-full border border-border rounded-md p-2 mt-1 text-sm bg-background",disabled:h,children:[a.jsx("option",{value:"",children:"Selecione um motivo..."}),a.jsx("option",{value:"Promoo",children:"Promoo"}),a.jsx("option",{value:"Cortesia",children:"Cortesia"}),a.jsx("option",{value:"Ajuste",children:"Ajuste"}),a.jsx("option",{value:"Outro",children:"Outro"})]})]}),a.jsxs("div",{className:"bg-surface-2 p-4 rounded-lg space-y-2 border border-border",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:"Subtotal:"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",t.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm text-destructive font-semibold",children:[a.jsx("span",{children:"Desconto:"}),a.jsxs("span",{children:["-R$ ",x.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-base font-bold border-t border-border pt-2",children:[a.jsx("span",{children:"Total da Comanda:"}),a.jsxs("span",{className:"text-brand",children:["R$ ",g.toFixed(2)]})]})]}),u&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded",children:[a.jsx("strong",{children:"Motivo:"})," ",u]})]}),a.jsxs(Ga,{className:"flex flex-col sm:flex-row gap-2 sm:justify-end pt-3 border-t border-border mt-2",children:[a.jsx(Z,{variant:"outline",onClick:n,disabled:h,className:"w-full sm:w-auto",children:"Cancelar"}),e.desconto_valor>0&&a.jsxs(Z,{variant:"destructive",onClick:y,disabled:h,size:"sm",className:"gap-2 w-full sm:w-auto",children:[a.jsx(bc,{className:"w-4 h-4"}),"Remover"]}),a.jsx(Z,{onClick:v,disabled:h,className:"gap-2 w-full sm:w-auto",children:h?"Aplicando...":"Aplicar Desconto"})]})]})})}const vst={available:{label:"Livre",color:"border-success/50 bg-success/10 text-success",icon:Di},"in-use":{label:"Em Uso",color:"border-warning/50 bg-warning/10 text-warning",icon:pu},"awaiting-payment":{label:"Pagamento",color:"border-info/50 bg-info/10 text-info",icon:il}};function yst(){const{toast:e}=Zs(),{userProfile:t,authReady:r}=lo(),n=Il(),[s,o]=p.useState([]),[i,l]=p.useState(null),[c,d]=p.useState(!1),[u,f]=p.useState(0);p.useRef(!1);const[h,m]=p.useState(!1);p.useState([]);const[x,g]=p.useState(!1),[v,y]=p.useState(new Map),[b,w]=p.useState(!1);p.useRef(null),p.useRef(null);const j=p.useRef([]),_=p.useRef(null),[C,E]=p.useState(0),[S,A]=p.useState("tables");p.useRef(null);const[M,O]=p.useState("order");p.useRef(null),p.useRef(null),p.useState(!1);const[I,T]=p.useState(null),[k,q]=p.useState(null),[B,z]=p.useState(!1),[F,V]=p.useState(!1),[me,be]=p.useState(!1),[U,L]=p.useState(null),[H,ie]=p.useState(!1),[Y,W]=p.useState([]),[se,pe]=p.useState(!1),[G,te]=p.useState(!1),[oe,De]=p.useState(!1),[re,ae]=p.useState(!1),[ut,pt]=p.useState(!1),[ft,bt]=p.useState(!1),[Lt,Dt]=p.useState(!1),[Bt,ge]=p.useState(!1),[wt,Gt]=p.useState(null),[Sr,wr]=p.useState(""),[he,ot]=p.useState(!1),[Vt,qt]=p.useState(!1),[Re,Ct]=p.useState([]),[Wt,Er]=p.useState(null),[Me,lt]=p.useState(null),[gt,or]=p.useState(!1),br=p.useRef(""),[ur,an]=p.useState(!1),[zr,Gr]=p.useState(!1),[ha,pn]=p.useState("order"),[on,cn]=p.useState(!1),[ke,We]=p.useState(""),[Ze,Je]=p.useState(()=>{try{return typeof window<"u"&&window.innerWidth<=640}catch{return!1}}),[At,Ye]=p.useState(null),[lr,ce]=p.useState(null),[qe,ze]=p.useState(!1);p.useEffect(()=>{const ne=t?.codigo_empresa;ne&&(async()=>{try{if(Array.isArray(Re)&&Re.length>0)return;const Ae=await Fh({somenteAtivas:!0,codigoEmpresa:ne});Ct(Array.isArray(Ae)?Ae:[])}catch{}})()},[t?.codigo_empresa]);const xt=p.useMemo(()=>{const ne=new Map,Ae=i?.order||[];for(const Ee of Ae){const it=String(Ee.productId);ne.set(it,(ne.get(it)||0)+Number(Ee.quantity||0))}return ne},[i?.order]),rr=async ne=>{try{const Ae=i?.order||[],Ee=Ae.find(Ar=>String(Ar.productId)===String(ne.id));if(!Ee)return;const it=Number(Ee.quantity||0)-1;if(String(Ee.id||"").startsWith("tmp-")){const Ar=it>0?Ae.map(Yr=>Yr.id===Ee.id?{...Yr,quantity:it}:Yr):Ae.filter(Yr=>Yr.id!==Ee.id),Fn=Ar.reduce((Yr,$r)=>Yr+Number($r.price||0)*Number($r.quantity||0),0),fr={...i,order:Ar,totalHint:Fn};l(fr),o(Yr=>Yr.map($r=>$r.id===fr.id?{...$r,totalHint:Fn}:$r)),setTimeout(async()=>{try{const $r=(await ci({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Nn=>({id:Nn.id,productId:Nn.produto_id,name:Nn.descricao||"Item",price:Number(Nn.preco_unitario||0),quantity:Number(Nn.quantidade||1)})),Dr=($r||[]).reduce((Nn,ua)=>Nn+Number(ua.price||0)*Number(ua.quantity||0),0),dn={...i,order:$r,totalHint:Dr};l(dn),o(Nn=>Nn.map(ua=>ua.id===dn.id?{...ua,totalHint:Dr}:ua))}catch{}},300);return}const gr=i,sr=s,Ir=it>0?Ae.map(Ar=>Ar.id===Ee.id?{...Ar,quantity:it}:Ar):Ae.filter(Ar=>Ar.id!==Ee.id),yr=Ir.reduce((Ar,Fn)=>Ar+Number(Fn.price||0)*Number(Fn.quantity||0),0),Ut={...i,order:Ir,totalHint:yr};l(Ut),o(Ar=>Ar.map(Fn=>Fn.id===Ut.id?{...Fn,totalHint:yr}:Fn));try{it>0?await Qd({itemId:Ee.id,quantidade:it,codigoEmpresa:t?.codigo_empresa}):await Dv({itemId:Ee.id,codigoEmpresa:t?.codigo_empresa})}catch(Ar){throw l(gr),o(sr),Ar}const _n=Math.max(it,0);let Qr=!1;for(let Ar=0;Ar<3&&!Qr;Ar++){const fr=(await ci({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map($r=>({id:$r.id,productId:$r.produto_id,name:$r.descricao||"Item",price:Number($r.preco_unitario||0),quantity:Number($r.quantidade||1)}));if((fr.find($r=>String($r.productId)===String(ne.id))?.quantity||0)===_n){const $r=fr.reduce((dn,Nn)=>dn+Number(Nn.price||0)*Number(Nn.quantity||0),0),Dr={...i,order:fr,totalHint:$r};l(Dr),o(dn=>dn.map(Nn=>Nn.id===Dr.id?Dr:Nn)),Qr=!0;break}await new Promise($r=>setTimeout($r,180*(Ar+1)))}try{const Ar=await Ph({codigoEmpresa:t?.codigo_empresa}),Fn=new Map;for(const fr of Ar||[]){const Yr=String(fr.produto_id),$r=Number(fr.quantidade||0);Fn.set(Yr,(Fn.get(Yr)||0)+$r)}y(Fn)}catch(Ar){console.error("[decProduct] Erro ao atualizar estoque reservado:",Ar)}}catch(Ae){console.error("[decProduct] Erro:",Ae),e({title:"Falha ao alterar quantidade",description:Ae?.message||"Tente novamente",variant:"destructive"})}},ir=p.useRef(null),Kr=p.useCallback(()=>{try{const ne=ir.current;if(!ne)return 1;const Ee=window.getComputedStyle(ne).gridTemplateColumns||"";if(Ee){const Et=Ee.split(" ").filter(Boolean).length;if(Et>0)return Et}const it=ne.querySelector("[data-table-id]");if(it){const Et=it.getBoundingClientRect().width,gr=ne.getBoundingClientRect().width;if(Et>0)return Math.max(1,Math.floor(gr/Et))}return 1}catch{return 1}},[]),[jr,sa]=p.useState(!1),ia=p.useRef(!1);p.useEffect(()=>{ia.current=he},[he]);const Kn=p.useRef(0),at=p.useRef(null),Te=p.useRef(null),Fe=p.useRef(null),cr=p.useRef(null),ht=p.useRef([]);p.useRef(null);const Xr=p.useRef(!1),Ft=p.useRef(null),kr=p.useRef(null);_i();const jt=p.useMemo(()=>(s||[]).find(ne=>ne.status==="available")?.id||null,[s]),er=G||ut||F||x||he||gt||h||B||zr||me||b||!1,Nt=async ne=>{try{if(!ne)return;if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}if(Vt)return;if(qt(!0),l(Ae=>!Ae||Ae.id!==ne.id?ne:Ae),ne.status==="available"||!ne.comandaId){Gt(ne),pt(!0);return}try{await Oe(ne)}catch{try{const it=(await ci({comandaId:ne.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(sr=>({id:sr.id,productId:sr.produto_id,name:sr.descricao||"Item",price:Number(sr.preco_unitario||0),quantity:Number(sr.quantidade||1)}));let Et=null;try{const Ir=(await nl({comandaId:ne.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(yr=>yr?.nome).filter(Boolean);Et=Ir.length?Ir.join(", "):null}catch{}const gr={...ne,order:it,customer:Et};l(gr),o(sr=>sr.map(Ir=>Ir.id===gr.id?gr:Ir))}catch{}}}finally{qt(!1)}};p.useEffect(()=>{const ne=()=>{try{Je(typeof window<"u"&&window.innerWidth<=640)}catch{Je(!1)}};return ne(),window.addEventListener("resize",ne),()=>window.removeEventListener("resize",ne)},[]),p.useEffect(()=>{const ne=async Ae=>{try{if(b)return;const Ee=String(Ae.target?.tagName||"").toLowerCase();if(["input","textarea","select"].includes(Ee)||Ae.target?.isContentEditable||er)return;if(Ae.key==="F1"){Ae.preventDefault();try{const Et=(s||[]).filter(gr=>gr.status==="available");Et.length>0?(l(Et[0]),Gt?.(Et[0])):!i&&Array.isArray(s)&&s.length>0&&(l(s[0]),Gt?.(s[0]))}catch{}pt(!0);return}if(Ae.key==="F2"){Ae.preventDefault(),i?.comandaId?await va():e({title:"Nenhuma comanda selecionada",description:"Selecione uma mesa com comanda aberta antes de fechar.",variant:"warning"});return}if(Ae.key==="F10"){Ae.preventDefault(),c?e({title:"Caixa j est aberto",description:"Use F11 para ver detalhes do caixa.",variant:"info"}):or(!0);return}if(Ae.key==="F11"){Ae.preventDefault(),g(!0);return}if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(Ae.key)){if(S!=="tables"||!i||!Array.isArray(s)||s.length===0)return;Ae.preventDefault(),Ae.stopPropagation();let Et=Math.max(0,s.findIndex(Ut=>Ut.id===i?.id));Et<0&&(Et=0);let gr=Kr(),sr=Et;Ae.key==="ArrowRight"&&(sr=Et+1),Ae.key==="ArrowLeft"&&(sr=Et-1),Ae.key==="ArrowDown"&&(sr=Et+gr),Ae.key==="ArrowUp"&&(sr=Et-gr);const Ir=s.length;sr=(sr%Ir+Ir)%Ir;const yr=s[sr];yr&&yr.id!==i?.id&&(l(yr),setTimeout(()=>{try{document.querySelector(`[data-table-id="${yr.id}"]`)?.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}catch{}},0));return}if(Ae.key==="Enter"){if(S!=="tables")return;Ae.preventDefault(),Ae.stopPropagation(),i&&!Vt&&await Nt(i);return}if(Ae.key==="Escape"){if(Ae.preventDefault(),i&&(M==="products"||ha==="products")){O("order"),pn("order");return}if(i){l(null);return}return}if(Ae.key==="p"||Ae.key==="P"){if(Ae.preventDefault(),h){setTimeout(()=>{try{_.current?.focus()}catch{}},0);return}if(i){w(!0);try{Gr(!1)}catch{}return}m(!0),setTimeout(()=>{try{_.current?.focus()}catch{}},50);return}}catch{}};return window.addEventListener("keydown",ne),()=>window.removeEventListener("keydown",ne)},[er,i?.id,s,Kr,b]),p.useEffect(()=>{try{i?.id&&t?.codigo_empresa&&localStorage.setItem(`vendas:selected:${t.codigo_empresa}`,String(i.id))}catch{}},[i?.id,t?.codigo_empresa]),p.useEffect(()=>{(async()=>{try{if(!i&&t?.codigo_empresa&&Array.isArray(s)&&s.length>0){const Ae=localStorage.getItem(`vendas:selected:${t.codigo_empresa}`);if(Ae){const Ee=s.find(it=>String(it.id)===String(Ae));if(Ee)if(A("tables"),Ee.comandaId)try{await Oe(Ee),A("tables")}catch(it){console.error("[Restore Selection] Erro ao carregar detalhes:",it),localStorage.removeItem(`vendas:selected:${t.codigo_empresa}`)}else localStorage.removeItem(`vendas:selected:${t.codigo_empresa}`)}}}catch(Ae){console.error("[Restore Selection] Erro:",Ae)}})()},[s,i,t?.codigo_empresa]);const Cr=p.useCallback(async()=>{try{const ne=await $h({codigoEmpresa:t?.codigo_empresa});d(!!(ne&&(ne.id||ne?.length)))}catch{d(!1)}},[t?.codigo_empresa]),Lr=async()=>{const ne=t?.codigo_empresa||null;try{if(!ne)return;const[Ae,Ee]=await Promise.all([P1({codigoEmpresa:ne}).catch(()=>null),$h({codigoEmpresa:ne}).catch(()=>null)]);if(!Ee?.id){T(null);return}let it=0,Et=[];try{Et=await Fg({caixaSessaoId:Ee.id,codigoEmpresa:ne}),it=(Et||[]).filter(sr=>(sr?.tipo||"")==="sangria").reduce((sr,Ir)=>sr+Number(Ir?.valor||0),0)}catch{}const gr={saldo_inicial:Ee.saldo_inicial||0,totalPorFinalizadora:Ae?.totalPorFinalizadora||Ae?.porFinalizadora||{},totalEntradas:Ae?.totalEntradas||Ae?.entradas||0,totalSangria:it,totalSaidas:it,sessaoId:Ee.id,movimentacoes:Et};Ce.startTransition(()=>{T(gr)})}catch{Ce.startTransition(()=>{T(null)})}finally{}},un=p.useRef(!1);p.useEffect(()=>{x&&!un.current?(un.current=!0,Lr().catch(()=>{})):x||(un.current=!1)},[x]);const ra=p.useRef(!0);p.useEffect(()=>(ra.current=!0,()=>{ra.current=!1}),[]);const Wn=p.useRef(0),ln=p.useRef(0),da=p.useRef(0);p.useEffect(()=>{const ne=t?.codigo_empresa||null,Ae=ne?`vendas:tables:${ne}`:null,Ee=()=>{try{if(!Ae)return;const Et=JSON.parse(localStorage.getItem(Ae)||"[]");Array.isArray(Et)&&Et.length>0&&o(Et)}catch{}};ne&&Ee();const it=async()=>{try{if(!r||!ne)return;const Et=++da.current,gr=setTimeout(()=>{ra.current&&Ee()},2e3),sr=setTimeout(()=>{ra.current&&da.current===Et&&Ee()},1e4),[Ir,yr]=await Promise.all([Lh(ne),Ph({codigoEmpresa:ne}).catch(()=>[])]);if(ra.current&&da.current===Et){const Dr=new Map;for(const dn of yr||[]){const Nn=String(dn.produto_id),ua=Number(dn.quantidade||0);Dr.set(Nn,(Dr.get(Nn)||0)+ua)}y(Dr)}let Ut=[];try{Ut=await yd({codigoEmpresa:ne})}catch(Dr){console.error("[VendasPage:load] Erro ao carregar comandas abertas:",Dr)}const _n=await(async()=>{try{return await JS((Ut||[]).map(Dr=>Dr.id),ne)}catch{return{}}})(),Qr=await(async()=>{try{const Dr=await Promise.all((Ut||[]).map(async dn=>{try{const ua=(await nl({comandaId:dn.id,codigoEmpresa:ne})||[]).map(ds=>ds?.nome).filter(Boolean);return[dn.id,ua.length?ua.join(", "):null]}catch{return[dn.id,null]}}));return Object.fromEntries(Dr)}catch{return{}}})(),Ar=new Map;(Ut||[]).forEach(Dr=>Ar.set(Dr.mesa_id,Dr));const fr=(Ir||[]).map(Dr=>{const dn=Ar.get(Dr.id);let Nn,ua=null,ds=null,Xs=0,vn=null;return dn?(Nn=dn.status==="awaiting-payment"||dn.status==="awaiting_payment"?"awaiting-payment":"in-use",ua=dn.id,ds=Qr[dn.id]||null,Xs=_n[dn.id]||0,vn=dn.aberto_em||null):Nn="available",{id:Dr.id,number:Dr.numero,name:Dr.nome||null,status:Nn,order:[],customer:ds,comandaId:ua,totalHint:Xs,aberto_em:vn}}).map(Dr=>i&&Dr.id===i.id?{...Dr,order:i.order||[],customer:i.customer||Dr.customer}:Dr);if(!ra.current||da.current!==Et){clearTimeout(gr),clearTimeout(sr);return}if(o(fr),(fr||[]).length===0)try{Ae&&localStorage.removeItem(Ae)}catch{}else try{Ae&&localStorage.setItem(Ae,JSON.stringify(fr))}catch{}const Yr=ne?`vendas:selected:${ne}`:null;if(Yr)try{const Dr=localStorage.getItem(Yr);if(Dr){const dn=fr.find(Nn=>String(Nn.id)===String(Dr));dn&&!dn.comandaId&&localStorage.removeItem(Yr)}}catch{}ln.current=Array.isArray(fr)?fr.length:0,Wn.current=Date.now();let $r=null;try{const Dr=ne?`vendas:selected:${ne}`:null,dn=Dr?localStorage.getItem(Dr):null;if(dn){const Nn=fr.find(ua=>String(ua.id)===String(dn));Nn&&($r=Nn)}}catch{}$r?he||l(Dr=>!Dr||Dr.id!==$r.id?$r:{...$r,order:Dr.order||$r.order||[],customer:Dr.customer||$r.customer||null,observacoes:Dr.observacoes??$r.observacoes??null,desconto_tipo:Dr.desconto_tipo??$r.desconto_tipo??null,desconto_valor:Dr.desconto_valor??$r.desconto_valor??0,desconto_motivo:Dr.desconto_motivo??$r.desconto_motivo??null}):he||l(Dr=>{const dn=Dr?fr.find(ua=>ua.id===Dr.id):null;return dn?{...dn,order:Dr.order||dn.order||[],customer:Dr.customer||dn.customer||null,observacoes:Dr.observacoes??dn.observacoes??null,desconto_tipo:Dr.desconto_tipo??dn.desconto_tipo??null,desconto_valor:Dr.desconto_valor??dn.desconto_valor??0,desconto_motivo:Dr.desconto_motivo??dn.desconto_motivo??null}:fr[0]||null}),clearTimeout(gr),clearTimeout(sr)}catch(Et){console.error("Erro ao carregar mesas:",Et)}};return Ee(),r&&ne&&it(),()=>{}},[r,t?.codigo_empresa]),p.useEffect(()=>{if(!r||!t?.codigo_empresa)return;let ne=!1;const Ae=t.codigo_empresa;return(async()=>{try{const Ee=await uf({includeInactive:!1,codigoEmpresa:Ae});ne||W(Ee||[])}catch(Ee){console.warn("Falha ao carregar produtos:",Ee?.message||Ee),ne||W([])}})(),()=>{ne=!0}},[r,t?.codigo_empresa]),p.useEffect(()=>{!r||!t?.codigo_empresa||Cr()},[r,t?.codigo_empresa,Cr]),p.useEffect(()=>{let ne=!0;return(async()=>{try{if(!t?.codigo_empresa){ne&&f(0);return}const Ae=await yd({codigoEmpresa:t?.codigo_empresa});if(!ne)return;f(Array.isArray(Ae)?Ae.length:0)}catch{ne&&f(0)}})(),()=>{ne=!1}},[t?.codigo_empresa,s.length]),p.useEffect(()=>{const ne=t?.codigo_empresa||null,Ae=ne?`vendas:selected:${ne}`:null;try{Ae&&i?.id&&localStorage.setItem(Ae,String(i.id))}catch{}i?.comandaId&&(!i.order||i.order.length===0)&&Oe(i)},[i?.id,i?.comandaId]),p.useEffect(()=>()=>{},[i?.comandaId,er,me]);const va=async()=>{try{if(!i?.comandaId){e({title:"Selecione uma mesa com comanda aberta",variant:"warning"});return}await bm({codigoEmpresa:t?.codigo_empresa});try{const it=(await ci({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(gr=>({id:gr.id,productId:gr.produto_id,name:gr.descricao||"Item",price:Number(gr.preco_unitario||0),quantity:Number(gr.quantidade||1),desconto_tipo:gr.desconto_tipo||null,desconto_valor:Number(gr.desconto_valor||0),desconto_motivo:gr.desconto_motivo||null})),Et={...i,order:it};l(Et),o(gr=>gr.map(sr=>sr.id===Et.id?Et:sr))}catch{}const ne=await Fh({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa});Ct(ne||[]);const Ae=ne&&ne[0]&&ne[0].id?ne[0].id:null;Er(Ae),lt(Ae),ot(!0)}catch(ne){e({title:"Falha ao carregar finalizadoras",description:ne?.message||"Tente novamente",variant:"destructive"})}},oa=ne=>{if(!ne.destination)return;const Ae=Array.from(s),[Ee]=Ae.splice(ne.source.index,1);Ae.splice(ne.destination.index,0,Ee),o(Ae),e({title:"Layout das mesas atualizado!",description:"As posies foram salvas temporariamente.",variant:"success"})},Tn=(ne,Ae)=>{let Ee=0;for(const Et of ne||[]){let gr=(Et.price||0)*(Et.quantity||1);Et.desconto_tipo==="percentual"&&Et.desconto_valor>0?gr*=1-Et.desconto_valor/100:Et.desconto_tipo==="fixo"&&Et.desconto_valor>0&&(gr-=Et.desconto_valor),Ee+=Math.max(0,gr)}let it=Ee;return Ae?.desconto_tipo==="percentual"&&Ae?.desconto_valor>0?it*=1-Ae.desconto_valor/100:Ae?.desconto_tipo==="fixo"&&Ae?.desconto_valor>0&&(it-=Ae.desconto_valor),Math.max(0,it)},ee=ne=>{if(!ne)return"";const Ae=ne.trim().split(/\s+/);return Ae.length<=2?ne:Ae.slice(0,2).join(" ")},Ie=ne=>{if(!ne)return"";const Ae=it=>String(it).replace(/^\s*[\[]+\s*/g,"").replace(/\s*[\]]+\s*$/g,"").trim(),Ee=ne.split(",").map(it=>Ae(it)).filter(Boolean);return Ee.length===0?"":Ee.length===1?ee(Ee[0]):`${ee(Ee[0])} +${Ee.length-1}`},Oe=async ne=>{try{if(!ne?.comandaId)return;const Ee=(await ci({comandaId:ne.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(sr=>({id:sr.id,productId:sr.produto_id,name:sr.descricao||"Item",price:Number(sr.preco_unitario||0),quantity:Number(sr.quantidade||1),desconto_tipo:sr.desconto_tipo||null,desconto_valor:Number(sr.desconto_valor||0),desconto_motivo:sr.desconto_motivo||null}));let it=ne.customer||null;try{const Ir=(await nl({comandaId:ne.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(yr=>yr?.nome).filter(Boolean);it=Ir.length?Ir.join(", "):null}catch{}let Et=ne;try{const Ir=(await yd({codigoEmpresa:t?.codigo_empresa}))?.find(yr=>yr.id===ne.comandaId);Ir&&(Et={...ne,desconto_tipo:Ir.desconto_tipo||null,desconto_valor:Number(Ir.desconto_valor||0),desconto_motivo:Ir.desconto_motivo||null,observacoes:Ir.observacoes||null})}catch{}const gr={...Et,status:ne.status==="awaiting-payment"?"awaiting-payment":"in-use",order:Ee,customer:it};l(gr),o(sr=>sr.map(Ir=>Ir.id===gr.id?gr:Ir))}catch(Ae){console.warn("[VendasPage] Falha ao recarregar detalhes da mesa selecionada:",Ae)}},Yt=async({showToast:ne=!1}={})=>{try{const Ae=t?.codigo_empresa;if(!Ae)return;const Ee=await Lh(Ae);let it=[];try{it=await yd({codigoEmpresa:Ae})}catch(Ut){console.error("[refreshTablesLight] Erro ao carregar comandas:",Ut)}const Et=new Map((it||[]).map(Ut=>[Ut.mesa_id,Ut])),gr={},sr={};try{const Ut=(it||[]).map(Ar=>Ar.id);(await Promise.all(Ut.map(async Ar=>{try{return{id:Ar,vinculos:await nl({comandaId:Ar,codigoEmpresa:Ae})}}catch{return{id:Ar,vinculos:[]}}}))).forEach(({id:Ar,vinculos:Fn})=>{const fr=(Fn||[]).map(Yr=>Yr?.nome).filter(Boolean);gr[Ar]=fr.length?fr.join(", "):null}),(await Promise.all(Ut.map(async Ar=>{try{const fr=(await ci({comandaId:Ar,codigoEmpresa:Ae})||[]).reduce((Yr,$r)=>{const Dr=($r.quantidade||0)*($r.preco_unitario||0)-($r.desconto||0);return Yr+Dr},0);return{comandaId:Ar,total:fr}}catch(Fn){return console.error(`[refreshTablesLight] Erro ao buscar itens da comanda ${Ar}:`,Fn),{comandaId:Ar,total:0}}}))).forEach(({comandaId:Ar,total:Fn})=>{sr[Ar]=Fn})}catch(Ut){console.error("[refreshTablesLight] Erro ao carregar clientes/totais:",Ut)}const yr=(Ee||[]).map(Ut=>{const _n=Et.get(Ut.id);let Qr,Ar=null,Fn=null,fr=0;return _n?(Qr=_n.status==="awaiting-payment"||_n.status==="awaiting_payment"?"awaiting-payment":"in-use",Ar=_n.id,Fn=gr[_n.id]||null,fr=sr[_n.id]||0):Qr="available",{id:Ut.id,number:Ut.numero,name:Ut.nome||null,status:Qr,order:[],customer:Fn,comandaId:Ar,totalHint:fr}}).map(Ut=>{if(i&&Ut.id===i.id)return i.status==="available"?{...Ut,status:"available",comandaId:null,order:[],customer:null,totalHint:0}:Ut.comandaId?{...Ut,order:i.order||[],customer:i.customer||Ut.customer}:{...Ut,order:[],customer:null};try{const _n=J.current.get(Ut.id);if(_n&&Date.now()-_n<3e4)return{...Ut,status:"available",comandaId:null,order:[],customer:null,totalHint:0}}catch{}return Ut});if(o(yr),i){const Ut=yr.find(_n=>_n.id===i.id);Ut&&!Ut.comandaId&&l({...Ut,order:[],customer:null})}}catch(Ae){console.error("[refreshTablesLight] Erro fatal:",Ae),ne&&e({title:"Erro ao atualizar mesas",description:"Recarregue a pgina se o problema persistir",variant:"destructive"})}},Pt=p.useRef(null);p.useEffect(()=>{Pt.current=i},[i]);const Qt=p.useRef(null),nr=p.useRef(null),fn=p.useRef(null),J=p.useRef(new Map);p.useEffect(()=>{const ne=t?.codigo_empresa;if(!ne)return;try{const it=typeof window<"u"?window.localStorage.getItem("custom-auth-token"):null;if(it&&it.trim())Q.realtime.setAuth(it.trim());else{let Et="";try{Et=(new URL(Q.supabaseUrl||"").host||"").split(".")[0]||""}catch{}const gr=Et?`sb-${Et}-auth-token`:"sb-auth-token",sr=typeof window<"u"?window.localStorage.getItem(gr):null;if(sr)try{const Ir=JSON.parse(sr),yr=Ir?.access_token||Ir?.currentSession?.access_token;yr&&Q.realtime.setAuth(yr)}catch{}}}catch{}const Ae=Q.channel(`loja:${ne}`),Ee=it=>{if(ia.current)return;const Et=it?.table||it?.table_name||"",gr=it?.new||it?.old||{},sr=it?.eventType||it?.type||it?.event||"";let Ir=!0;if(Et!=="comanda_itens"&&Et!=="comanda_clientes"){const yr=gr?.codigo_empresa;yr!=null&&yr!==""&&(Ir=String(yr)===String(ne||""))}if(!Ir){try{console.log("[Realtime][Vendas] IGNORADO por empresa",{t:Et,evt:sr,rowEmpresa:gr?.codigo_empresa,codigoEmpresa:ne})}catch{}return}try{console.log("[Realtime][Vendas] payload recebido",{t:Et,evt:sr,row:gr,codigoEmpresa:ne})}catch{}(async()=>{try{await Yt({showToast:!1})}catch{}})()};if(Ae.on("postgres_changes",{event:"*",schema:"public",table:"comandas"},Ee).on("postgres_changes",{event:"*",schema:"public",table:"comanda_itens"},Ee).on("postgres_changes",{event:"*",schema:"public",table:"comanda_clientes"},Ee).on("postgres_changes",{event:"*",schema:"public",table:"pagamentos",filter:`codigo_empresa=eq.${ne}`},Ee).on("postgres_changes",{event:"*",schema:"public",table:"mesas"},Ee).subscribe(),Qt.current=Ae,fn.current)try{clearInterval(fn.current)}catch{}return fn.current=setInterval(async()=>{if(!ia.current)try{await Yt({showToast:!1})}catch{}},6e4),()=>{if(Qt.current){try{Q.removeChannel(Qt.current)}catch{}Qt.current=null}if(nr.current){try{clearTimeout(nr.current)}catch{}nr.current=null}if(fn.current){try{clearInterval(fn.current)}catch{}fn.current=null}}},[t?.codigo_empresa]);const Xe=({table:ne,provided:Ae,isDragging:Ee})=>{const it=vst[ne.status],Et=it.icon,gr=Array.isArray(ne.order)?ne.order:[],sr=gr.filter(Ar=>String(Ar.id||"").startsWith("tmp-")).reduce((Ar,Fn)=>Ar+Number(Fn.quantity||0)*Number(Fn.price||0),0),Ir=gr.filter(Ar=>!String(Ar.id||"").startsWith("tmp-")).reduce((Ar,Fn)=>Ar+Number(Fn.quantity||0)*Number(Fn.price||0),0),yr=Number(ne.totalHint||0);Ie(ne.customer);const Ut=ne.status==="available"&&ne.id===jt,_n=ne.status==="in-use"||ne.status==="awaiting-payment"?(yr>0?yr:Ir)+sr:0,Qr=ne.status==="available"?"text-success bg-success/10 border-success/30":ne.status==="in-use"?"text-warning bg-warning/10 border-warning/30":"text-info bg-info/10 border-info/30";return a.jsxs("div",{ref:Ae?.innerRef,"data-table-id":ne.id,...Ae?.draggableProps||{},className:Pr("p-4 rounded-lg border bg-surface flex flex-col relative h-44 shadow-sm min-w-[240px]",Ee&&"shadow-lg",S==="tables"&&i?.id===ne.id&&"ring-2 ring-brand/60 bg-surface-2",c?"cursor-pointer":"cursor-not-allowed opacity-60"),onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}Nt(ne)},children:[a.jsx("div",{...Ae?.dragHandleProps||{},className:"absolute top-2 right-2 text-text-muted opacity-60 hover:opacity-100",children:a.jsx(Vue,{size:14})}),a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Et,{className:"w-5 h-5 text-text-secondary"}),a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("span",{className:"text-lg font-semibold text-text-primary truncate",children:ne.name?ne.name:`Mesa ${ne.number}`}),Ut&&a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F1"})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(ne.status==="in-use"||ne.status==="awaiting-payment")&&ne.aberto_em&&a.jsxs("div",{className:"flex items-center gap-0.5 text-xs text-text-secondary",children:[a.jsx(pu,{className:"w-3.5 h-3.5 text-text-muted"}),a.jsx("span",{className:"font-medium",children:(()=>{try{const Ar=new Date(ne.aberto_em),fr=new Date-Ar,Yr=Math.floor(fr/6e4),$r=Math.floor(Yr/60),Dr=Yr%60;return Yr<1?"agora":$r===0?`${Dr}m`:$r>0&&Dr===0?`${$r}h`:`${$r}h${Dr}m`}catch{return""}})()})]}),a.jsx("span",{className:Pr("text-[11px] font-medium px-2 py-0.5 rounded-full border flex-shrink-0",Qr),children:it.label})]})]}),a.jsx("div",{className:Pr("flex-1 flex items-center justify-center"),children:ne.status==="available"?a.jsx("img",{src:"/mesalivre.png",alt:"Mesa livre",className:Pr("w-16 h-16 object-contain opacity-80",i?.id===ne.id&&"opacity-100")}):ne.status==="in-use"?a.jsx("img",{src:"/mesaocupada.png",alt:"Mesa ocupada",className:Pr("w-16 h-16 object-contain opacity-80",i?.id===ne.id&&"opacity-100")}):a.jsx("div",{className:Pr("w-16 h-16 rounded-lg bg-info/20 border-2 border-info/40 flex items-center justify-center",i?.id===ne.id&&"bg-info/30 border-info/60"),children:a.jsx(il,{className:"w-8 h-8 text-info"})})}),a.jsx("div",{className:"w-full mt-auto",children:ne.status==="in-use"||ne.status==="awaiting-payment"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[a.jsx(mc,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),a.jsx("div",{className:"text-sm sm:text-base font-medium text-text-primary truncate",title:ne.customer||"",children:Ie(ne.customer)||""})]}),a.jsxs("div",{className:"flex items-center gap-1 justify-between",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Wi,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),a.jsxs("div",{className:"text-sm font-bold text-text-secondary",children:["R$ ",_n.toFixed(2)]})]}),a.jsx("button",{onClick:Ar=>{Ar.stopPropagation(),n(`/historico?mesa=${ne.id}`)},className:"p-1 hover:bg-surface-2 rounded transition-colors",title:"Ver histrico desta mesa",children:a.jsx(il,{className:"w-4 h-4 text-text-secondary hover:text-text-primary"})})]})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Sem comanda"}),a.jsx("button",{onClick:Ar=>{Ar.stopPropagation(),n(`/historico?mesa=${ne.id}`)},className:"p-1 hover:bg-surface-2 rounded transition-colors",title:"Ver histrico desta mesa",children:a.jsx(il,{className:"w-4 h-4 text-text-secondary hover:text-text-primary"})})]})})]})},He=()=>{const ne=i?Tn(i.order,i):0,[Ae,Ee]=p.useState(!1),[it,Et]=p.useState([]),[gr,sr]=p.useState(1),[Ir,yr]=p.useState([]),Ut=p.useRef(new Map),_n=typeof window<"u"&&window.innerWidth<=640,Qr=p.useRef(!1),Ar=Or=>{const rn=String(Or||"").replace(/\D/g,"");return rn?Number(rn)/100:0},Fn=Or=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.max(0,Number(Or)||0)),fr=Or=>{const rn=(Re||[]).find(Vn=>String(Vn.id)===String(Or.methodId)),gn=rn&&rn.taxa_percentual!=null?Number(rn.taxa_percentual):0;return Number.isFinite(gn)?gn/100:0},Yr=Or=>(Re||[]).find(rn=>String(rn.id)===String(Or)),[$r,Dr]=p.useState(null);p.useEffect(()=>(Te.current=Et,Fe.current=sr,cr.current=i?.comandaId||null,()=>{Te.current=null,Fe.current=null,cr.current=null}),[i?.comandaId]),p.useEffect(()=>{ht.current=it||[]},[it]);const dn=(Or,rn)=>{try{if(_n)return;const gn=(it||[]).findIndex(Vn=>Vn.id===rn);if(gn>=0){const Vn=(it||[])[gn+1]||null;if(Vn&&Ut.current.get(Vn.id)){const On=Ut.current.get(Vn.id);setTimeout(()=>{try{On.focus(),On.select?.()}catch{}},0);return}}if(Or&&Or instanceof HTMLElement){const Vn=Array.from(document.querySelectorAll('input[data-pay-value="1"]')),On=Vn.indexOf(Or);if(On>=0&&Vn[On+1]){const mr=Vn[On+1];setTimeout(()=>{try{mr.focus(),mr.select?.()}catch{}},0);return}}Qr.current=!0,Et(Vn=>{const On=Ir[0]?.id||"",mr=Re&&Re[0]&&Re[0].id?Re[0].id:null,Zr=Array.isArray(Vn)?Vn:[],Br=Zr.reduce((Rr,Vr)=>Math.max(Rr,Number(Vr?.id||0)),0)+1,qr=[...Zr,{id:Br,clientId:On,methodId:mr,value:"",chargeFee:!0}];return sr(Rr=>Math.max(Rr,Br+1)),_n||setTimeout(()=>{const Rr=Ut.current.get(Br);if(Rr)try{Rr.focus(),Rr.select?.()}catch{}},0),qr})}catch{}};p.useEffect(()=>{let Or=!0;return(async()=>{try{if(!he||!i?.comandaId)return;let gn=[],Vn=[];try{const[Rr,Vr]=await Promise.all([hKe({comandaId:i.comandaId,status:"Pendente",codigoEmpresa:t?.codigo_empresa}).catch(()=>[]),nl({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa}).catch(()=>[])]);gn=Array.isArray(Rr)?Rr:[],Vn=(Array.isArray(Vr)?Vr:[]).map(le=>{const we=le?.cliente_id??le?.clientes?.id??le?.id??null,et=le?.clientes?.nome??le?.nome??le?.nome_livre??"";return!we&&et?{id:`livre-${le?.id||Math.random()}`,nome:et}:we?{id:we,nome:et}:null}).filter(Boolean)}catch{}if(!Or)return;if(yr(Vn),Array.isArray(gn)&&gn.length>0){const Rr=gn.map((Vr,kn)=>{const le=Number(Vr.valor||0),et={id:kn+1,clientId:Vr.cliente_id||null,methodId:Vr.finalizadora_id||null,chargeFee:!0},_e=fr(et),St=le,tt=et.chargeFee!==!1?St*(1+_e):St;return{...et,baseValue:St,value:Fn(tt)}});Et(Rr),sr(Rr.length+1),Qr.current=!1;return}let On=Re&&Re[0]&&Re[0].id?Re[0].id:null,mr=Vn[0]?.id||null;const Zr=ne>0?ne:0,_r={id:1,clientId:mr,methodId:On,baseValue:Zr,chargeFee:!0},Br=fr(_r),qr=_r.chargeFee?Zr*(1+Br):Zr;Et([{..._r,value:Fn(qr)}]),sr(2),Qr.current=!1}catch(gn){console.error(gn)}})(),()=>{Or=!1}},[he,i?.comandaId]),p.useEffect(()=>{if(!he||!i?.comandaId||!Array.isArray(it)||it.length===0||!Qr.current)return;at.current&&clearTimeout(at.current);const Or=setTimeout(async()=>{if(Qr.current)try{const rn=(it||[]).map(gn=>{const Vn=Number(gn.baseValue||0),On=(Re||[]).find(Zr=>String(Zr.id)===String(gn.methodId)),mr=On?.tipo||On?.nome||"outros";return{clienteId:gn.clientId||null,finalizadoraId:gn.methodId||null,metodo:mr,valor:Vn}});Kn.current=Date.now(),await Hx({comandaId:i.comandaId,linhas:rn,codigoEmpresa:t?.codigo_empresa})}catch(rn){console.warn("[PayDialog] Falha ao salvar rascunho de pagamentos (debounced):",rn)}},400);return at.current=Or,()=>{clearTimeout(Or),at.current===Or&&(at.current=null)}},[he,i?.comandaId,it,Re,t?.codigo_empresa]),p.useEffect(()=>{let Or=!0;return(async()=>{try{if(!he||Array.isArray(Re)&&Re.length>0)return;const gn=await Fh({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa});if(!Or)return;Ct(gn||[])}catch{}})(),()=>{Or=!1}},[he]),p.useEffect(()=>{he&&(!Array.isArray(Re)||Re.length===0||Et(Or=>{if(!Array.isArray(Or)||Or.length===0)return Or;const rn=Re&&Re[0]&&Re[0].id?Re[0].id:null;if(!rn)return Or;let gn=!1;const Vn=Or.map(On=>{if(!On.methodId){gn=!0;const mr={...On,methodId:rn},Zr=fr(mr),_r=mr.chargeFee!==!1?Number(mr.baseValue||0)*(1+Zr):Number(mr.baseValue||0);return{...mr,value:Fn(_r)}}return On});return gn?Vn:Or}))},[he,Re]);const Nn=async()=>{try{if(!i?.comandaId)return;const Or=t?.codigo_empresa;if(!Or){e({title:"Empresa no definida",variant:"destructive"});return}if(!Array.isArray(it)||it.length===0){e({title:"Informe os pagamentos",description:"Adicione pelo menos uma forma de pagamento.",variant:"warning"});return}for(const Vr of it){if(!Vr.methodId){e({title:"Forma de pagamento faltando",description:"Selecione a finalizadora em todas as linhas.",variant:"warning"});return}if(Ar(Vr.value)<=0){e({title:"Valor invlido",description:"Informe valores maiores que zero.",variant:"warning"});return}}ge(!0);const rn=ne>0?ne:0,gn=(it||[]).reduce((Vr,kn)=>Vr+Ar(kn.value),0),Vn=(it||[]).reduce((Vr,kn)=>{const le=Number(kn.baseValue||0),we=fr(kn);return Vr+(kn.chargeFee!==!1&&we>0?le*we:0)},0),On=rn+Vn,mr=gn-On,Zr=Math.abs(mr),_r=i.comandaId,Br=i.id;o(Vr=>Vr.map(kn=>kn.id===Br?{...kn,status:"available",order:[],comandaId:null,customer:null,totalHint:0}:kn)),l(Vr=>Vr&&Vr.id===Br?null:Vr),ot(!1);try{Gr(!1)}catch{}let qr=ne;if(qr<=0)try{qr=(await ci({comandaId:_r,codigoEmpresa:t?.codigo_empresa})||[]).reduce((le,we)=>le+Number(we.quantidade||0)*Number(we.preco_unitario||0),0)}catch{}Ee(!0),ge(!0),await bm({codigoEmpresa:t?.codigo_empresa});try{const Vr=(it||[]).map(kn=>{const le=Number(kn.baseValue||0),we=(Re||[]).find(_e=>String(_e.id)===String(kn.methodId)),et=we?.tipo||we?.nome||"outros";return{clienteId:kn.clientId||null,finalizadoraId:kn.methodId||null,metodo:et,valor:le}});await Hx({comandaId:_r,linhas:Vr,codigoEmpresa:Or})}catch(Vr){console.warn("[PayDialog] Falha ao salvar rascunho antes de promover:",Vr)}await pKe({comandaId:_r,codigoEmpresa:Or}),await U0({comandaId:_r,codigoEmpresa:t?.codigo_empresa,diferencaPagamento:mr});try{t?.codigo_empresa&&localStorage.removeItem(`vendas:tables:${t.codigo_empresa}`)}catch{}try{const Vr=await Lh(t?.codigo_empresa),kn=await yd({codigoEmpresa:t?.codigo_empresa}),le={};await Promise.all((kn||[]).map(async et=>{try{const St=(await nl({comandaId:et.id,codigoEmpresa:t?.codigo_empresa})||[]).map(tt=>tt?.nome).filter(Boolean);le[et.id]=St.length?St.join(", "):null}catch{le[et.id]=null}}));const we=(Vr||[]).map(et=>{const _e=(kn||[]).find(St=>St.mesa_id===et.id);return{id:et.id,name:et.nome||`Mesa ${et.numero}`,status:_e?"in-use":"available",comandaId:_e?.id||null,customer:_e?le[_e.id]:null,order:[],totalHint:0,aberto_em:_e?.aberto_em||null}});o(we)}catch{}const Rr=Zr>.009?mr>0?` | Diferena cobrada a mais: R$ ${Zr.toFixed(2)}`:` | Diferena cobrada a menos: R$ ${Zr.toFixed(2)}`:"";e({title:"Pagamento registrado",description:`Total itens R$ ${qr.toFixed(2)} | Pagamentos R$ ${gn.toFixed(2)}${Rr}`,variant:"success"})}catch(Or){e({title:"Falha ao registrar pagamento",description:Or?.message||"Tente novamente",variant:"destructive"})}finally{Ee(!1),ge(!1)}};it&&it.length>0;const ua=ne>0?ne:0,ds=(it||[]).reduce((Or,rn)=>Or+Ar(rn.value),0),Xs=(it||[]).reduce((Or,rn)=>{const gn=Number(rn.baseValue||0),Vn=fr(rn);return Or+(rn.chargeFee!==!1&&Vn>0?gn*Vn:0)},0),vn=ua+Xs;return a.jsx(Un,{open:he,onOpenChange:Or=>{qe||ot(Or)},children:a.jsxs(zn,{onOpenAutoFocus:Or=>Or.preventDefault(),className:"sm:max-w-xl w-[92vw] max-h-[80vh] min-h-0 animate-none flex flex-col overflow-hidden p-3 sm:p-6",onKeyDown:Or=>Or.stopPropagation(),onKeyDownCapture:Or=>Or.stopPropagation(),children:[a.jsx(Bn,{className:"flex flex-col gap-1 pr-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3",children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Fechar Conta"}),!Ze&&a.jsx(Z,{type:"button",size:"sm",variant:"outline",className:"self-start sm:self-auto",onClick:()=>ze(!0),children:"Desconto"})]})}),a.jsxs("div",{className:"flex-1 min-h-0 flex flex-col space-y-2",children:[(()=>{let Or=0,rn=0;for(const On of i?.order||[]){const mr=(On.price||0)*(On.quantity||1);Or+=mr,On.desconto_tipo==="percentual"&&On.desconto_valor>0?rn+=mr*(On.desconto_valor/100):On.desconto_tipo==="fixo"&&On.desconto_valor>0&&(rn+=On.desconto_valor)}const gn=Or-rn;let Vn=0;return i?.desconto_tipo==="percentual"&&i?.desconto_valor>0?Vn=gn*(i.desconto_valor/100):i?.desconto_tipo==="fixo"&&i?.desconto_valor>0&&(Vn=i.desconto_valor),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm text-text-secondary",children:[a.jsx("span",{children:"Subtotal"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Or.toFixed(2)]})]}),Vn>5e-4&&a.jsxs("div",{className:"flex items-center justify-between text-sm text-destructive",children:[a.jsx("span",{children:"Desconto da comanda"}),a.jsxs("span",{className:"font-semibold",children:["-R$ ",Vn.toFixed(2)]})]}),a.jsxs("div",{className:"border-t border-border pt-1 mt-1 flex items-center justify-between text-lg font-semibold",children:[a.jsx("span",{children:"Total com desconto"}),a.jsxs("span",{children:["R$ ",ne.toFixed(2)]})]})]})})(),(()=>{const Or=vn,rn=ds;let gn=Or-rn,Vn=0;return gn<0&&(Vn=Math.abs(gn),gn=0),a.jsxs("div",{className:"space-y-1 text-xs text-text-muted pt-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Total a pagar"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Or.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Pagamentos"}),a.jsxs("span",{className:"font-semibold",children:["R$ ",rn.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center justify-between font-semibold",children:[a.jsx("span",{children:"Restante"}),a.jsxs("span",{className:Math.abs(gn)<.005?"text-emerald-600":"text-amber-600",children:["R$ ",gn.toFixed(2)]})]}),Vn>0&&a.jsxs("div",{className:"flex items-center justify-between font-semibold",children:[a.jsx("span",{children:"Troco"}),a.jsxs("span",{children:["R$ ",Vn.toFixed(2)]})]})]})})(),a.jsxs("div",{className:"flex-1 space-y-2 overflow-y-auto thin-scroll pr-0 sm:pr-1",children:[a.jsx(ct,{className:"block",children:"Pagamentos"}),a.jsx("div",{className:"sm:hidden space-y-2",children:(it||[]).map((Or,rn)=>{const gn=On=>{if(!On)return"Cliente";const mr=(Ir||[]).find(Zr=>String(Zr.id)===String(On));return mr?.nome?mr.nome:"Cliente"};(Ir||[]).length>1;const Vn=(Ir||[])[0]||null;return a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"rounded-md bg-surface-2 border border-border overflow-hidden",children:[a.jsxs("button",{type:"button",className:"w-full flex items-center justify-between gap-2 px-3 py-2 text-left",onClick:()=>Dr(On=>On===Or.id?null:Or.id),children:[a.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[a.jsx("span",{className:"text-xs text-text-secondary truncate",children:gn(Vn?.id||Or.clientId)}),a.jsxs("span",{className:"text-xs font-semibold text-text-primary truncate",children:[Or.methodId&&Yr(Or.methodId)?.nome||"Forma no selecionada","  R$ ",Or.value||"0,00"]})]}),a.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:it.length>1&&rn>0&&a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:On=>{On.stopPropagation(),Qr.current=!0,Et(mr=>{const Zr=mr.filter(Rr=>Rr.id!==Or.id);if(Zr.length===0)return[];const _r=ne>0?ne:0,Br=Math.floor(_r/Zr.length*100)/100,qr=_r-Br*Zr.length;return Zr.map((Rr,Vr)=>{const kn=Vr===Zr.length-1?Br+qr:Br,le={...Rr},we=fr(le),_e=le.chargeFee!==!1&&we>0?kn/(1+we):kn;return{...le,baseValue:_e,value:Fn(kn)}})})},children:a.jsx(bc,{className:"h-3 w-3"})})})]}),$r===Or.id&&a.jsxs("div",{className:"px-3 pb-3 pt-1 space-y-2 border-t border-border/60",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(Zn,{value:String(Or.methodId||""),onValueChange:On=>{Qr.current=!0;const mr=(it||[]).map(Zr=>{if(Zr.id!==Or.id)return Zr;const _r=String(On),Br={...Zr,methodId:_r},qr=fr(Br),Rr=Br.chargeFee!==!1?Number(Br.baseValue||0)*(1+qr):Number(Br.baseValue||0);return{...Br,value:Fn(Rr)}});Et(mr);try{const Zr=i?.comandaId,_r=t?.codigo_empresa;if(Zr&&_r){const Br=mr.map(qr=>{const Rr=Number(qr.baseValue||0),Vr=(Re||[]).find(le=>String(le.id)===String(qr.methodId)),kn=Vr?.tipo||Vr?.nome||"outros";return{clienteId:qr.clientId||null,finalizadoraId:qr.methodId||null,metodo:kn,valor:Rr}});Kn.current=Date.now(),Hx({comandaId:Zr,linhas:Br,codigoEmpresa:_r}).then(()=>{}).catch(qr=>{console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora (bg):",qr),Qr.current=!0}),Qr.current=!1}}catch(Zr){console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora:",Zr)}},children:[a.jsx(Yn,{className:"flex-1 h-9 truncate text-sm",children:a.jsx(ta,{placeholder:"Forma de pagamento"})}),a.jsx(Jn,{children:(Re||[]).map(On=>a.jsx(nt,{value:String(On.id),children:On.nome},String(On.id)))})]}),a.jsx(It,{placeholder:"0,00",inputMode:"numeric",value:Or.value,className:"w-28 h-9 text-sm",onChange:On=>{Qr.current=!0;const mr=(On.target.value||"").replace(/\D/g,""),Zr=mr?Number(mr)/100:0;Et(_r=>_r.map(Br=>{if(Br.id!==Or.id)return Br;const qr=fr(Br),Rr=Br.chargeFee!==!1&&qr>0?Zr/(1+qr):Zr,Vr=Br.chargeFee!==!1?Rr*(1+qr):Rr;return{...Br,baseValue:Rr,value:Fn(Vr)}}))},onKeyDown:On=>{if(On.stopPropagation(),On.key==="Enter"){On.preventDefault(),dn(On.currentTarget,Or.id);return}["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(On.key)||/^[0-9]$/.test(On.key)||On.preventDefault()},onBeforeInput:On=>{const mr=On.data??"";mr&&/\D/.test(mr)&&On.preventDefault()}})]}),a.jsx("div",{className:"-mt-1 pl-1",children:(()=>{const On=fr(Or),mr=On*100,Zr=Or.chargeFee!==!1,_r=Or.baseValue!=null?Number(Or.baseValue):(()=>{const Rr=(Or.value||"").toString().replace(/\D/g,""),Vr=Rr?Number(Rr)/100:0;return Zr&&On>0?Vr/(1+On):Vr})();if(!mr||mr<=0||!Number.isFinite(_r)||_r<=0)return null;const Br=Zr?_r*On:0;return a.jsxs("button",{type:"button",onClick:async()=>{Qr.current=!0;const qr=(it||[]).map(Rr=>{if(Rr.id!==Or.id)return Rr;const Vr=fr(Rr),kn=Rr.chargeFee!==!1,le=Rr.baseValue!=null?Number(Rr.baseValue):Ar(Rr.value),we=kn?le:le*(1+Vr);return{...Rr,chargeFee:!kn,baseValue:le,value:Fn(we)}});Et(qr);try{const Rr=i?.comandaId,Vr=t?.codigo_empresa;if(Rr&&Vr){const kn=qr.map(le=>({clienteId:le.clientId||null,finalizadoraId:le.methodId||null,metodo:(Re||[]).find(we=>String(we.id)===String(le.methodId))?.tipo||(Re||[]).find(we=>String(we.id)===String(le.methodId))?.nome||"outros",valor:Number(le.baseValue||0)}));Kn.current=Date.now(),await Hx({comandaId:Rr,linhas:kn,codigoEmpresa:Vr}),Qr.current=!1}}catch(Rr){console.warn("[PayDialog] Falha ao salvar rascunho aps alternar taxa:",Rr)}},className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",Zr?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:Zr?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",Zr?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",Br.toFixed(2)]})]})})()})]})]})},"payline-m-"+Or.id)})}),(it||[]).map((Or,rn)=>{const gn=mr=>{if(!mr)return"Cliente";const Zr=(Ir||[]).find(_r=>String(_r.id)===String(mr));return Zr?.nome?Zr.nome:"Cliente"},Vn=(Ir||[]).length>1,On=(Ir||[])[0]||null;return(Ir||[]).filter(mr=>String(mr.id)!==String(On?.id||"")),a.jsxs("div",{className:"hidden sm:grid sm:grid-cols-12 gap-2 items-center",children:[a.jsx("div",{className:"sm:col-span-1 flex sm:justify-start",children:it.length>1&&rn>0&&a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"h-8 w-8",onClick:()=>{Qr.current=!0,Et(mr=>{const Zr=mr.filter(Rr=>Rr.id!==Or.id);if(Zr.length===0)return[];const _r=ne>0?ne:0,Br=Math.floor(_r/Zr.length*100)/100,qr=_r-Br*Zr.length;return Zr.map((Rr,Vr)=>{const kn=Vr===Zr.length-1?Br+qr:Br,le={...Rr},we=fr(le),_e=le.chargeFee!==!1&&we>0?kn/(1+we):kn;return{...le,baseValue:_e,value:Fn(kn)}})})},children:a.jsx(bc,{size:14})})}),rn===0?a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:gn(On?.id||Or.clientId)})}):Vn?a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(Zn,{value:Or.clientId||"",onValueChange:mr=>Et(Zr=>Zr.map(_r=>_r.id===Or.id?{..._r,clientId:mr}:_r)),children:[a.jsx(Yn,{className:"w-full truncate",children:a.jsx(ta,{placeholder:"Cliente"})}),a.jsx(Jn,{children:(Ir||[]).map(mr=>a.jsx(nt,{value:mr.id,children:mr.nome},mr.id))})]})}):a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:gn(On?.id||Or.clientId)})}),a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(Zn,{value:String(Or.methodId||""),onValueChange:mr=>{Qr.current=!0;const Zr=(it||[]).map(_r=>{if(_r.id!==Or.id)return _r;const Br=String(mr),qr={..._r,methodId:Br},Rr=fr(qr),Vr=qr.chargeFee!==!1?Number(qr.baseValue||0)*(1+Rr):Number(qr.baseValue||0);return{...qr,value:Fn(Vr)}});Et(Zr);try{const _r=i?.comandaId,Br=t?.codigo_empresa;if(_r&&Br){const qr=Zr.map(Rr=>{const Vr=Number(Rr.baseValue||0),kn=(Re||[]).find(we=>String(we.id)===String(Rr.methodId)),le=kn?.tipo||kn?.nome||"outros";return{clienteId:Rr.clientId||null,finalizadoraId:Rr.methodId||null,metodo:le,valor:Vr}});Kn.current=Date.now(),Hx({comandaId:_r,linhas:qr,codigoEmpresa:Br}).then(()=>{}).catch(Rr=>{console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora (bg):",Rr),Qr.current=!0}),Qr.current=!1}}catch(_r){console.warn("[PayDialog] Falha ao salvar rascunho aps troca de finalizadora:",_r)}},children:[a.jsx(Yn,{className:"w-full truncate",children:a.jsx(ta,{placeholder:"Forma de pagamento"})}),a.jsx(Jn,{children:(Re||[]).map(mr=>a.jsx(nt,{value:String(mr.id),children:mr.nome},String(mr.id)))})]})}),a.jsx("div",{className:"sm:col-span-3",children:a.jsx(It,{placeholder:"0,00",inputMode:"numeric",value:Or.value,"data-pay-value":"1",ref:mr=>{mr?Ut.current.set(Or.id,mr):Ut.current.delete(Or.id)},onChange:mr=>{Qr.current=!0;const Zr=(mr.target.value||"").replace(/\D/g,""),_r=Zr?Number(Zr)/100:0;Et(Br=>Br.map(qr=>{if(qr.id!==Or.id)return qr;const Rr=fr(qr),Vr=qr.chargeFee!==!1&&Rr>0?_r/(1+Rr):_r,kn=qr.chargeFee!==!1?Vr*(1+Rr):Vr;return{...qr,baseValue:Vr,value:Fn(kn)}}))},onKeyDown:mr=>{if(mr.stopPropagation(),mr.key==="Enter"){mr.preventDefault(),dn(mr.currentTarget,Or.id);return}["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(mr.key)||/^[0-9]$/.test(mr.key)||mr.preventDefault()},onBeforeInput:mr=>{const Zr=mr.data??"";Zr&&/\D/.test(Zr)&&mr.preventDefault()}})}),a.jsx("div",{className:"sm:col-span-12 -mt-1 pl-1",children:(()=>{const mr=fr(Or),Zr=mr*100,_r=Or.chargeFee!==!1,Br=Or.baseValue!=null?Number(Or.baseValue):(()=>{const Vr=(Or.value||"").toString().replace(/\D/g,""),kn=Vr?Number(Vr)/100:0;return _r&&mr>0?kn/(1+mr):kn})();if(!Zr||Zr<=0||!Number.isFinite(Br)||Br<=0)return null;const qr=_r?Br*mr:0;return a.jsxs("button",{type:"button",onClick:async()=>{Qr.current=!0;const Rr=(it||[]).map(Vr=>{if(Vr.id!==Or.id)return Vr;const kn=fr(Vr),le=Vr.chargeFee!==!1,we=Vr.baseValue!=null?Number(Vr.baseValue):Ar(Vr.value),et=le?we:we*(1+kn);return{...Vr,chargeFee:!le,baseValue:we,value:Fn(et)}});Et(Rr);try{const Vr=i?.comandaId,kn=t?.codigo_empresa;if(Vr&&kn){const le=Rr.map(we=>({clienteId:we.clientId||null,finalizadoraId:we.methodId||null,metodo:(Re||[]).find(et=>String(et.id)===String(we.methodId))?.tipo||(Re||[]).find(et=>String(et.id)===String(we.methodId))?.nome||"outros",valor:Number(we.baseValue||0)}));Kn.current=Date.now(),await Hx({comandaId:Vr,linhas:le,codigoEmpresa:kn}),Qr.current=!1}}catch(Vr){console.warn("[PayDialog] Falha ao salvar rascunho aps alternar taxa:",Vr)}},className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",_r?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:_r?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",_r?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",qr.toFixed(2)]})]})})()})]},"payline-"+Or.id)}),a.jsx("div",{children:a.jsx(Z,{type:"button",variant:"secondary",size:"sm",className:"pointer-events-auto",onClick:Or=>{Or.preventDefault(),Or.stopPropagation(),Qr.current=!0,Et(rn=>{const gn=Array.isArray(rn)?rn:[],On=gn.reduce((kn,le)=>Math.max(kn,Number(le?.id||0)),0)+1,mr=Ir[0]?.id||"",Zr=Re&&Re[0]&&Re[0].id?Re[0].id:null,_r=[...gn,{id:On,clientId:mr,methodId:Zr,value:"",chargeFee:!0}],Br=ne>0?ne:0,qr=Math.floor(Br/_r.length*100)/100,Rr=Br-qr*_r.length,Vr=_r.map((kn,le)=>{const we=le===_r.length-1?qr+Rr:qr,et=fr(kn),St=kn.chargeFee!==!1&&et>0?we/(1+et):we;return{...kn,baseValue:St,value:Fn(we)}});return sr(kn=>Math.max(kn,On+1)),Vr})},children:"Adicionar forma"})})]})]}),a.jsxs(Ga,{className:"sticky bottom-0 bg-surface/95 backdrop-blur supports-[backdrop-filter]:bg-surface/75 border-t border-border",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>ot(!1),disabled:Ae,children:"Cancelar"}),a.jsx(Z,{type:"button",onClick:Nn,disabled:!(it&&it.length>0&&!Ae),children:Ae?"Processando...":"Confirmar Pagamento"})]})]})})},fe=Ce.memo(({open:ne,onOpenChange:Ae,cashSummary:Ee})=>{const it=dn=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(dn||0)),[Et,gr]=p.useState(!0);p.useEffect(()=>{gr(!!ne)},[ne]);const sr=p.useMemo(()=>{const dn=Number(Ee?.saldo_inicial??Ee?.saldoInicial??0),Nn=Ee?.totalPorFinalizadora||Ee?.porFinalizadora||{},ua=Number(Ee?.totalEntradas??Ee?.entradas??0),ds=ua>0?ua:Object.values(Nn||{}).reduce((rn,gn)=>rn+Number(gn||0),0),Xs=Number(Ee?.sangria??Ee?.totalSangria??0),vn=Number(Ee?.totalSaidas??Ee?.saidas??Xs),Or=Math.max(0,dn+ds-vn);return{saldoInicial:dn,porFinalizadora:Nn,entradasInformadas:ua,entradasCalc:ds,sangriaVal:Xs,saidas:vn,saldoAtual:Or}},[Ee]);p.useEffect(()=>{if(ne&&Ee){const dn=setTimeout(()=>gr(!1),50);return()=>clearTimeout(dn)}},[ne,Ee]);const{porFinalizadora:Ir,sangriaVal:yr}=sr,[Ut,_n]=p.useState(!1),[Qr,Ar]=p.useState(""),[Fn,fr]=p.useState(""),[Yr,$r]=p.useState(!1),Dr=async()=>{try{$r(!0);const dn=String(Qr||"").replace(/\D/g,""),Nn=dn?Number(dn)/100:0;if(Nn<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await bm({codigoEmpresa:t?.codigo_empresa}),await u3({tipo:"sangria",valor:Nn,observacao:Fn,codigoEmpresa:t?.codigo_empresa}),_n(!1),Ar(""),fr(""),await Lr(),e({title:"Sangria registrada",variant:"success"})}catch(dn){e({title:"Falha ao registrar sangria",description:dn?.message||"Tente novamente",variant:"destructive"})}finally{$r(!1)}};return a.jsx(Un,{open:ne,onOpenChange:Ae,children:a.jsxs(zn,{forceMount:!0,className:"sm:max-w-lg w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden",onOpenAutoFocus:dn=>dn.preventDefault(),onKeyDown:dn=>dn.stopPropagation(),onKeyDownCapture:dn=>dn.stopPropagation(),onPointerDownOutside:dn=>dn.stopPropagation(),onInteractOutside:dn=>dn.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),a.jsx(ma,{children:"Resumo da sesso atual do caixa."})]}),Et||!Ee?a.jsxs("div",{className:"px-4 space-y-3",children:[a.jsx(ev,{className:"h-16 w-full"}),a.jsx(ev,{className:"h-16 w-full"}),a.jsx(ev,{className:"h-12 w-full"})]}):a.jsxs("div",{className:"px-1",children:[Object.keys(Ir).length===0?a.jsx("div",{className:"p-3 text-sm text-text-muted border rounded-md",children:"Nenhuma finalizadora registrada ainda."}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"rounded-md border border-border overflow-hidden divide-y divide-border",children:Object.entries(Ir).map(([dn,Nn])=>a.jsxs("li",{className:"bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:String(dn)}),a.jsx("span",{className:"text-sm font-semibold tabular-nums",children:it(Nn)})]},dn))}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Sangrias"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-danger",children:it(yr)})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted leading-relaxed px-1",children:'Sadas incluem sangrias e ajustes. Use "Registrar Sangria" para lanar uma retirada.'})]}),a.jsxs(Ga,{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"mr-auto"}),a.jsx(Z,{variant:"destructive",onClick:()=>_n(!0),children:"Registrar Sangria"}),a.jsx(Z,{variant:"secondary",onClick:()=>Ae(!1),children:"Fechar"})]}),a.jsx(Un,{open:Ut,onOpenChange:_n,children:a.jsxs(zn,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:dn=>dn.stopPropagation(),onKeyDownCapture:dn=>dn.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold",children:"Registrar Sangria"}),a.jsx(ma,{children:"Informe o valor a retirar do caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"sangria-valor",children:"Valor"}),a.jsx(It,{id:"sangria-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:Qr,onChange:dn=>{const Nn=(dn.target.value||"").replace(/\D/g,""),ua=Nn?Number(Nn)/100:0,ds=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(ua);Ar(ds)},onKeyDown:dn=>{dn.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(dn.key)&&(/^[0-9]$/.test(dn.key)||dn.preventDefault())},onBeforeInput:dn=>{const Nn=dn.data??"";Nn&&/\D/.test(Nn)&&dn.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"sangria-obs",children:"Observao"}),a.jsx(It,{id:"sangria-obs",placeholder:"Opcional",value:Fn,onChange:dn=>fr(dn.target.value)})]})]}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>_n(!1),disabled:Yr,children:"Cancelar"}),a.jsx(Z,{onClick:Dr,disabled:Yr,children:Yr?"Registrando...":"Confirmar"})]})]})})]})})}),Ve=()=>{const ne=async()=>{if(U)try{await Dv({itemId:U.id,codigoEmpresa:t?.codigo_empresa});try{await Oe(i)}catch{}e({title:"Item removido",description:U.name,variant:"warning"})}catch(Ae){e({title:"Falha ao remover item",description:Ae?.message||"Tente novamente",variant:"destructive"})}finally{ie(!1),L(null)}};return a.jsx(Gu,{open:H,onOpenChange:ie,children:a.jsxs(tu,{children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Remover item?"}),a.jsxs(su,{children:['Tem certeza que deseja remover "',U?.name,'" da comanda? Esta ao no pode ser desfeita.']})]}),a.jsxs(nu,{children:[a.jsx(ou,{children:"Cancelar"}),a.jsx(Ku,{onClick:ne,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})})},xe=()=>{const ne=i,Ae=ne?.order||[],Ee=ne?Tn(Ae):0;return a.jsx(Un,{open:F,onOpenChange:V,children:a.jsxs(zn,{className:"sm:max-w-xl w-[92vw] animate-none",onKeyDown:it=>it.stopPropagation(),onKeyDownCapture:it=>it.stopPropagation(),onPointerDownOutside:it=>it.stopPropagation(),onInteractOutside:it=>it.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsxs(Ln,{className:"text-2xl font-bold",children:["Comanda da Mesa ",ne?.number??""]}),a.jsx(ma,{children:ne?.customer?`Cliente: ${ne.customer}`:"Sem cliente vinculado"})]}),a.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto thin-scroll",children:Ae.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum item na comanda."}):a.jsx("ul",{className:"divide-y divide-border",children:Ae.map(it=>a.jsxs("li",{className:"py-2 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:it.name}),a.jsxs("div",{className:"text-xs text-text-muted",children:["Qtd: ",it.quantity,"  Unit: R$ ",Number(it.price||0).toFixed(2)]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"font-semibold",children:["R$ ",(Number(it.price||0)*Number(it.quantity||0)).toFixed(2)]})})]},it.id))})}),a.jsxs(Ga,{children:[a.jsxs("div",{className:"mr-auto text-sm font-semibold",children:["Total: R$ ",Ee.toFixed(2)]}),a.jsx(Z,{variant:"secondary",onClick:()=>V(!1),children:"Fechar"}),ne?.comandaId&&a.jsxs(Z,{variant:"outline",onClick:()=>window.open(`/print-comanda?comanda=${ne.comandaId}`,"_blank"),children:[a.jsx(NG,{className:"mr-2 h-4 w-4"})," Imprimir"]}),a.jsxs(Z,{onClick:async()=>{V(!1),await va()},disabled:!ne||Ae.length===0,children:[a.jsx(Wi,{className:"mr-2 h-4 w-4"})," Fechar Conta",a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-amber-600 border border-amber-700 rounded shadow-sm",children:"F2"})]})]})]})})},kt=p.useMemo(()=>xe,[i?.id,F]),st=({table:ne})=>{const[Ae,Ee]=p.useState(""),[it,Et]=p.useState(!1),[gr,sr]=p.useState(!1),Ir=async()=>{if(!(!ne?.comandaId||it))try{Et(!0),await SKe({comandaId:ne.comandaId,observacoes:Ae,codigoEmpresa:Number(t?.codigo_empresa)}),e({title:"Observaes salvas",description:"As observaes da comanda foram atualizadas."});try{await Oe(ne)}catch(yr){console.error("Erro ao recarregar detalhes da comanda aps salvar observaes:",yr)}}catch(yr){yr?.code!=="42804"&&(console.error("Erro ao salvar observao:",yr),e({title:"Erro ao salvar observaes",description:"Tente novamente mais tarde.",variant:"destructive"}))}finally{Et(!1)}};return p.useEffect(()=>{if(!ne?.comandaId){Ee("");return}Ee(ne.observacoes||"")},[ne?.comandaId,ne?.observacoes]),ne?a.jsxs("div",{className:"flex flex-col h-full p-4 space-y-4 overflow-y-auto thin-scroll",children:[ne.order&&ne.order.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(ct,{className:"text-sm font-semibold",children:"Descontos por Item"}),a.jsx(Z,{size:"xs",variant:"ghost",className:"h-6 px-2 text-[11px]",onClick:()=>sr(yr=>!yr),children:gr?"Esconder":`Mostrar (${ne.order.length})`})]}),gr&&a.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:ne.order.map(yr=>a.jsx("button",{onClick:()=>ce(yr),className:"w-full p-3 rounded border border-border bg-surface hover:bg-surface-2 transition text-left",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm font-semibold truncate",children:yr.name}),a.jsxs("p",{className:"text-xs text-text-secondary",children:["Qtd: ",yr.quantity,"  R$ ",(yr.price||0).toFixed(2)]})]}),a.jsx("div",{className:"text-right flex-shrink-0",children:yr.desconto_valor>0?a.jsxs("span",{className:"text-xs font-bold text-destructive",children:["-",yr.desconto_tipo==="percentual"?yr.desconto_valor+"%":"R$"+(yr.desconto_valor||0).toFixed(2)]}):a.jsx("span",{className:"text-xs text-text-muted",children:"Sem desconto"})})]})},yr.id))})]}),ne.comandaId&&a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx(ct,{className:"text-sm font-semibold",children:"Observaes"}),it&&a.jsx("span",{className:"text-[11px] text-text-secondary",children:"Salvando..."})]}),a.jsx("textarea",{className:"border border-border rounded p-3 text-sm resize-none bg-background min-h-20",placeholder:"Ex: sem cebola, urgente, etc.",value:Ae,onChange:yr=>{const Ut=yr.target.value;Ee(Ut)},onKeyDown:async yr=>{yr.key==="Enter"&&!yr.shiftKey&&(yr.preventDefault(),await Ir())}})]}),!Ze&&ne.comandaId&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{className:"text-sm font-semibold",children:"Desconto da Comanda"}),a.jsx(Z,{size:"sm",variant:ne.desconto_valor>0?"default":"outline",onClick:()=>ze(!0),className:"w-full gap-2",children:ne.desconto_valor>0?a.jsxs(a.Fragment,{children:[a.jsx("span",{children:"Desconto Ativo:"}),a.jsxs("span",{className:"font-bold",children:["-",ne.desconto_tipo==="percentual"?ne.desconto_valor+"%":"R$"+ne.desconto_valor.toFixed(2)]})]}):"Aplicar Desconto"}),ne.desconto_motivo&&a.jsxs("div",{className:"text-xs text-text-secondary bg-surface p-2 rounded border border-border",children:[a.jsx("strong",{children:"Motivo:"})," ",ne.desconto_motivo]})]})]}):a.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:a.jsxs("div",{className:"text-center",children:[a.jsx(il,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),a.jsx("p",{children:"Selecione uma mesa"})]})})},zt=({table:ne})=>{if(!ne)return a.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:a.jsxs("div",{className:"text-center",children:[a.jsx(qv,{className:"mx-auto mb-4 h-12 w-12 opacity-50"}),a.jsx("p",{children:"Selecione uma mesa para ver a comanda"})]})});if(jr)return a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2",children:[a.jsx("div",{className:"h-0 w-0","aria-hidden":"true"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap",disabled:!c,onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de abrir uma mesa.",variant:"warning"});return}Gt(ne),pt(!0)},children:"Abrir Mesa"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 thin-scroll",children:[a.jsx(ev,{className:"h-20 w-full"}),a.jsx(ev,{className:"h-20 w-full"}),a.jsx(ev,{className:"h-20 w-full"})]}),a.jsxs("div",{className:"p-4 border-t border-border mt-auto",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm font-semibold text-text-secondary mb-2",children:[a.jsx("span",{children:"Total"}),a.jsx("span",{children:"R$ 0,00"})]}),a.jsx(Z,{size:"lg",className:"w-full",disabled:!c,children:"Fechar Conta"})]})]});const Ae=Tn(ne.order,ne),Ee=Ie(ne.customer),it=async()=>{if(!ne?.comandaId)return;const Ir=(await ci({comandaId:ne.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Qr=>({id:Qr.id,productId:Qr.produto_id,name:Qr.descricao||"Item",price:Number(Qr.preco_unitario||0),quantity:Number(Qr.quantidade||1)})),yr=(Ir||[]).reduce((Qr,Ar)=>Qr+Number(Ar.price||0)*Number(Ar.quantity||0),0);let Ut=ne.customer||null;try{const Ar=(await nl({comandaId:ne.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(Fn=>Fn?.nome).filter(Boolean);Ut=Ar.length?Ar.join(", "):null}catch{}const _n={...ne,order:Ir,customer:Ut,totalHint:yr};l(_n),o(Qr=>Qr.map(Ar=>Ar.id===_n.id?_n:Ar))},Et=async(sr,Ir)=>{try{const Ut=Number(sr.quantity||1)+Ir;if(Ut<=0){L(sr),ie(!0),setTimeout(async()=>{H||await it()},100);return}const _n=Number(sr.price||0)*Number(Ir||0);_n&&(l(Qr=>Qr&&{...Qr,totalHint:Math.max(0,Number(Qr.totalHint||0)+_n)}),o(Qr=>Qr.map(Ar=>Ar.id===i?.id?{...Ar,totalHint:Math.max(0,Number(Ar.totalHint||0)+_n)}:Ar))),await Qd({itemId:sr.id,quantidade:Ut,codigoEmpresa:t?.codigo_empresa}),await it(),e({title:"Quantidade atualizada",description:`${sr.name}: ${Ut}`,variant:"success"})}catch(yr){e({title:"Falha ao atualizar quantidade",description:yr?.message||"Tente novamente",variant:"destructive"})}},gr=async sr=>{L(sr),ie(!0),setTimeout(async()=>{H||await it()},100)};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col h-full",onMouseDown:sr=>{sr.target===sr.currentTarget&&sr.preventDefault()},children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-center md:justify-between gap-2",children:[Ee?a.jsx("div",{className:"hidden sm:block text-sm font-medium text-text-primary leading-none truncate",title:ne.customer||"",children:Ee}):a.jsx("div",{className:"h-0 w-0","aria-hidden":"true"}),a.jsx("div",{className:"flex items-center gap-2",children:ne.comandaId?a.jsxs(a.Fragment,{children:[a.jsxs(Z,{size:"sm",className:"h-8 px-3 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-black/60 text-white border border-white/10 shadow-sm hover:bg-black/80 hover:shadow transition-all flex items-center",onClick:()=>{be(!0);try{w(!1)}catch{}try{z(!1)}catch{}try{ot(!1)}catch{}try{Gr(!1)}catch{}try{V(!1)}catch{}},children:[a.jsx(mc,{size:12,className:"text-white/80 mr-1.5"}),"Clientes"]}),a.jsxs(Z,{size:"sm",variant:"outline",className:"h-8 px-3 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-black/60 text-white border border-white/10 shadow-sm hover:bg-black/80 hover:shadow transition-all",onClick:()=>V(!0),children:[a.jsx("span",{className:"inline-flex items-center justify-center h-5 w-5 rounded-full bg-black/40 border border-white/10 mr-1.5",children:a.jsx(il,{size:12,className:"text-white/80"})}),"Comanda"]}),a.jsxs(Gu,{children:[a.jsx(_g,{asChild:!0,children:a.jsx(Z,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap bg-red-600 hover:bg-red-500 text-white border border-red-600/70 focus:outline-none focus:ring-0 focus-visible:ring-0 shadow-none",children:"Cancelar"})}),a.jsxs(tu,{className:"sm:max-w-[420px] animate-none",onKeyDown:sr=>sr.stopPropagation(),children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Cancelar comanda?"}),a.jsx(su,{children:"Esta ao no pode ser desfeita. Os itens sero descartados e a mesa voltar a ficar livre."})]}),a.jsxs(nu,{children:[a.jsx(ou,{children:"Voltar"}),a.jsx(Ku,{disabled:Lt,onClick:async sr=>{const Ir=sr.currentTarget.closest('[role="alertdialog"]');Ir&&Ir.querySelector("[data-radix-collection-item]")?.click();try{Dt(!0);const yr=t?.codigo_empresa;if(yr)try{localStorage.removeItem(`vendas:selected:${yr}`),localStorage.removeItem(`vendas:tables:${yr}`)}catch{}await Uz({comandaId:ne.comandaId,codigoEmpresa:yr}),l(null);try{Gr(!1)}catch{}await Yt({showToast:!1}),e({title:"Comanda cancelada",variant:"success"})}catch(yr){console.error("[Cancelar Comanda] Erro:",yr),e({title:"Falha ao cancelar comanda",description:yr?.message||"Tente novamente",variant:"destructive"});try{await Yt({showToast:!1})}catch(Ut){console.error("[Cancelar Comanda] Erro ao recarregar aps falha:",Ut)}}finally{Dt(!1)}},children:"Confirmar Cancelamento"})]})]})]})]}):a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",className:"h-7 px-2.5 rounded-full text-[12px] font-medium leading-none whitespace-nowrap",disabled:!c,onClick:()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de abrir uma mesa.",variant:"warning"});return}Gt(ne),pt(!0)},children:"Abrir Mesa"})})})]}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-3 thin-scroll",children:ne.order.length===0?a.jsx("div",{className:"text-center text-text-muted pt-16",children:a.jsx("p",{children:"Comanda vazia. Adicione produtos na aba ao lado."})}):a.jsx("ul",{className:"space-y-3",children:ne.order.map(sr=>a.jsxs("li",{className:"p-2 rounded-md border border-border/30 bg-surface",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("p",{className:"text-sm font-semibold text-text-primary truncate",title:sr.name,children:sr.name})}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>Et(sr,-1),children:a.jsx(_v,{size:12})}),a.jsx("span",{className:"w-7 text-center font-semibold text-sm",children:sr.quantity}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>Et(sr,1),children:a.jsx(so,{size:12})})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-right flex-1",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsxs("span",{className:"font-bold text-text-primary",children:["R$ ",(sr.price*sr.quantity).toFixed(2)]}),sr.desconto_valor>0&&a.jsxs("span",{className:"text-xs font-semibold text-destructive",children:["-",sr.desconto_tipo==="percentual"?sr.desconto_valor+"%":"R$"+(sr.desconto_valor||0).toFixed(2)]})]})}),a.jsx(Z,{variant:"ghost",size:"icon",className:"text-danger/80 hover:text-danger h-7 w-7",onClick:()=>gr(sr),children:a.jsx(bc,{size:14})})]})]})]},sr.id))})}),a.jsxs("div",{className:"p-3 border-t border-border mt-auto space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm font-semibold text-text-secondary",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",Ae.toFixed(2)]})]}),a.jsxs(Z,{size:"lg",className:"w-full",onClick:va,children:[a.jsx(Wi,{className:"mr-2"})," Fechar Conta",a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-amber-600 border border-amber-700 rounded shadow-sm",children:"F2"})]})]})]}),a.jsx(He,{})]})},pr=()=>{const[ne,Ae]=p.useState(""),[Ee,it]=p.useState(""),Et=async()=>{try{if(se)return;pe(!0);const gr=(ne??"").toString().trim(),sr=gr?Number(gr):void 0;if(sr!==void 0&&(Number.isNaN(sr)||sr<=0)){e({title:"Nmero invlido",description:"Informe um nmero positivo.",variant:"warning"});return}const Ir=await gKe({numero:sr,nome:(Ee||"").trim()||void 0,codigoEmpresa:t?.codigo_empresa}),yr={id:Ir.id,number:Ir.numero,name:Ir.nome,status:"available",order:[],customer:null,comandaId:null,totalHint:0};o(Ut=>(Ut.some(Ar=>Ar.id===yr.id)?Ut.map(Ar=>Ar.id===yr.id?yr:Ar):[...Ut,yr]).slice().sort((Ar,Fn)=>Number(Ar.number)-Number(Fn.number))),Ce.startTransition(()=>{l(yr),De(!1)}),e({title:"Mesa criada",description:`Mesa ${Ir.numero} adicionada`,variant:"success"}),Ae(""),it("")}catch(gr){e({title:"Falha ao criar mesa",description:gr?.message||"Tente novamente",variant:"destructive"})}finally{pe(!1)}};return a.jsx(Un,{open:oe,onOpenChange:gr=>{De(gr),gr||(Ae(""),it(""))},children:a.jsxs(zn,{className:"sm:max-w-md w-[92vw]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Nova Mesa"}),a.jsx(ma,{children:"Informe o nome da mesa. Se deixar em branco, ser criada com numerao automtica."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(ct,{htmlFor:"nova-mesa-nome",children:"Nome da mesa"}),a.jsx(It,{id:"nova-mesa-nome",type:"text",placeholder:"Ex: Mesa 1, Varanda, etc.",value:Ee,onChange:gr=>it(gr.target.value),onKeyDown:gr=>{gr.stopPropagation(),gr.key==="Enter"&&!se&&(gr.preventDefault(),Et())},onKeyPress:gr=>gr.stopPropagation()})]}),a.jsxs(Ga,{children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>De(!1),disabled:se,children:"Cancelar"}),a.jsx(Z,{type:"button",onClick:Et,disabled:se,children:se?"Criando...":"Criar Mesa"})]})]})})},en=()=>{const[ne,Ae]=p.useState([]),[Ee,it]=p.useState(new Set),[Et,gr]=p.useState(!1),{userProfile:sr}=lo(),{toast:Ir}=Zs(),yr=async()=>{try{gr(!0);const fr=await fKe(sr?.codigo_empresa);Ae(Array.isArray(fr)?fr:[])}catch(fr){Ir({title:"Falha ao listar mesas",description:fr?.message||"Tente novamente",variant:"destructive"})}finally{gr(!1)}};p.useEffect(()=>{re&&yr()},[re]);const Ut=fr=>{const Yr=new Set(Ee);Yr.has(fr)?Yr.delete(fr):Yr.add(fr),it(Yr)},_n=(ne||[]).length>0&&(ne||[]).every(fr=>Ee.has(fr.id)),Qr=()=>{(ne||[]).length!==0&&it(_n?new Set:new Set((ne||[]).map(fr=>fr.id)))},Ar=async()=>{const fr=ne.filter(Yr=>Ee.has(Yr.id)&&Yr.status==="available").map(Yr=>Yr.id);if(fr.length===0){Ir({title:"Selecione mesas disponveis",variant:"warning"});return}try{for(const Yr of fr)await uKe({mesaId:Yr,codigoEmpresa:sr?.codigo_empresa});Ir({title:"Mesas inativadas",description:`${fr.length} mesa(s)`,variant:"success"});try{await Yt({showToast:!1})}catch{}await yr()}catch(Yr){Ir({title:"Falha ao inativar",description:Yr?.message||"Tente novamente",variant:"destructive"})}},Fn=async()=>{const fr=ne.filter(Yr=>Ee.has(Yr.id)&&Yr.status==="inactive").map(Yr=>Yr.id);if(fr.length===0){Ir({title:"Selecione mesas inativas",variant:"warning"});return}try{for(const Yr of fr)await mKe({mesaId:Yr,codigoEmpresa:sr?.codigo_empresa});Ir({title:"Mesas reativadas",description:`${fr.length} mesa(s)`,variant:"success"});try{await Yt({showToast:!1})}catch{}await yr()}catch(Yr){Ir({title:"Falha ao reativar",description:Yr?.message||"Tente novamente",variant:"destructive"})}};return a.jsx(Un,{open:re,onOpenChange:fr=>{ae(fr),fr||it(new Set)},children:a.jsxs(zn,{className:"sm:max-w-xl w-[92vw]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Gerenciar Mesas"}),a.jsx(ma,{children:"Selecione mesas e ative/inative."})]}),a.jsxs("div",{className:"space-y-3 max-h-[50vh] overflow-auto thin-scroll",children:[a.jsxs("div",{className:"flex items-center gap-2 px-1",children:[a.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded-sm border border-amber-500/60 bg-black accent-amber-400",checked:_n,onChange:Qr}),a.jsx("span",{className:"text-sm select-none",children:"Selecionar todas"})]}),Et?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando..."}):a.jsx("ul",{className:"space-y-1",children:ne.map(fr=>{const Yr=String(fr.status||"").toLowerCase(),$r=Yr==="inactive",Dr=$r?"Inativa":Yr==="available"?"Disponvel":Yr==="occupied"?"Ocupada":Yr==="awaiting-payment"?"Aguardando Pagamento":fr.status||"",dn=$r?"bg-slate-500/15 text-slate-300 border border-slate-500/30":Yr==="available"?"bg-emerald-500/15 text-emerald-300 border border-emerald-500/30":"bg-amber-500/15 text-amber-300 border border-amber-500/30";return a.jsxs("li",{className:"flex items-center justify-between gap-3 border border-border/40 rounded px-2 py-1.5",children:[a.jsxs("label",{className:"flex items-center gap-2 select-none min-w-0",children:[a.jsx("input",{type:"checkbox",checked:Ee.has(fr.id),onChange:()=>Ut(fr.id),className:"h-4 w-4 rounded-sm border border-amber-500/60 bg-black accent-amber-400"}),a.jsx("span",{className:"text-sm whitespace-nowrap truncate max-w-[55vw] md:max-w-[32rem]",children:fr.nome||`Mesa ${fr.numero}`})]}),a.jsx("span",{className:`text-[11px] px-2 py-0.5 rounded-full font-semibold whitespace-nowrap ${dn}`,children:Dr})]},fr.id)})})]}),a.jsxs(Ga,{className:"flex items-center justify-end gap-2",children:[a.jsx(Z,{type:"button",variant:"destructive",onClick:Ar,disabled:Et,children:"Inativar"}),a.jsx(Z,{type:"button",onClick:Fn,disabled:Et,children:"Ativar"})]})]})})},sn=async ne=>{try{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}if(!i?.comandaId){e({title:"Selecione uma mesa",description:"Abra a comanda clicando na mesa primeiro.",variant:"destructive"});return}const Ae=Number(ne.stock??ne.currentStock??0),Ee=v.get(String(ne.id))||0,it=Math.max(0,Ae-Ee);if(((i?.order||[]).find(fr=>String(fr.productId)===String(ne.id))?.quantity||0)+1>it){e({title:"Estoque insuficiente",description:`${ne.name} - Estoque disponvel: ${it} (${Ae} total, ${Ee} reservado em outras comandas)`,variant:"destructive"});return}const sr=Number(ne.salePrice??ne.price??0),yr=(await ci({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).find(fr=>String(fr.produto_id)===String(ne.id));let Ut;if(yr){const fr=Number(yr.quantidade||0);await Qd({itemId:yr.id,quantidade:fr+1,codigoEmpresa:t?.codigo_empresa}),Ut={id:yr.id,productId:yr.produto_id,name:yr.descricao||ne.name,price:sr,quantity:fr+1}}else Ut=await f3({comandaId:i.comandaId,produtoId:ne.id,descricao:ne.name,quantidade:1,precoUnitario:sr,codigoEmpresa:t?.codigo_empresa});const Qr=(await ci({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa})||[]).map(fr=>({id:fr.id,productId:fr.produto_id,name:fr.descricao||"Item",price:Number(fr.preco_unitario||0),quantity:Number(fr.quantidade||1)})),Ar=(Qr||[]).reduce((fr,Yr)=>fr+Number(Yr.price||0)*Number(Yr.quantity||0),0),Fn={...i,order:Qr,totalHint:Ar};l(Fn),o(fr=>fr.map(Yr=>Yr.id===Fn.id?Fn:Yr));try{const fr=await Ph({codigoEmpresa:t?.codigo_empresa}),Yr=new Map;for(const $r of fr||[]){const Dr=String($r.produto_id),dn=Number($r.quantidade||0);Yr.set(Dr,(Yr.get(Dr)||0)+dn)}y(Yr)}catch(fr){console.error("[addProductToComanda] Erro ao atualizar estoque reservado:",fr)}Ye(ne.id),setTimeout(()=>{Ye(fr=>fr===ne.id?null:fr)},500),e({title:"Produto adicionado",variant:"success"})}catch(Ae){console.error("[addProductToComanda] EXCEPTION:",Ae),e({title:"Falha ao adicionar produto",description:Ae?.message||"Tente novamente",variant:"destructive"})}},la=()=>{const[ne,Ae]=p.useState(""),[Ee,it]=p.useState("all"),Et=p.useRef(null),gr=p.useRef(0),sr=p.useRef(null),yr=(Y||[]).slice().sort((Ut,_n)=>{const Qr=Ut.code||"",Ar=_n.code||"";return/^\d+$/.test(Qr)&&/^\d+$/.test(Ar)?parseInt(Qr,10)-parseInt(Ar,10):Qr.localeCompare(Ar)}).filter(Ut=>{const _n=ne.trim().toLowerCase(),Qr=!_n||(Ut.name||"").toLowerCase().includes(_n)||String(Ut.code||"").toLowerCase().includes(_n);if(Ee==="all")return Qr;const Ar=Number(Ut.stock??Ut.currentStock??0),Fn=v.get(String(Ut.id))||0,fr=Math.max(0,Ar-Fn);return Ee==="available"?Qr&&fr>0:Ee==="low"?Qr&&fr>0&&fr<=5:Ee==="out"?Qr&&fr<=0:Qr});return i?a.jsx(Un,{open:b,onOpenChange:Ut=>{if(w(Ut),A(Ut?"panel":"tables"),Ut)try{Gr(!1)}catch{}},children:a.jsxs(zn,{overlayClassName:"z-[88]",className:"w-[95vw] sm:max-w-4xl max-h-[80vh] sm:max-h-[85vh] flex flex-col p-0 gap-0 focus:outline-none focus-visible:outline-none !overflow-visible z-[89]",style:{scrollBehavior:"auto"},onOpenAutoFocus:Ut=>{Ut.preventDefault(),A("panel")},onWheel:Ut=>{Ut.stopPropagation()},onKeyDown:Ut=>{const _n=Ut.target,Qr=_n&&(_n.tagName==="INPUT"||_n.closest("input")),Ar=_n&&_n.closest("[data-product-card]");if(!["ArrowDown","ArrowUp","Home","End","Enter","Delete","Escape"].includes(Ut.key)||Qr||Ar)return;Ut.preventDefault(),Ut.stopPropagation();const Fn=C||0,fr=yr.length;if(Ut.key==="ArrowDown"){const Yr=Math.min(Fn+1,fr-1);E(Yr),gr.current=Yr,requestAnimationFrame(()=>j.current[Yr]?.focus());return}if(Ut.key==="ArrowUp"){const Yr=Math.max(Fn-1,0);E(Yr),gr.current=Yr,requestAnimationFrame(()=>j.current[Yr]?.focus());return}if(Ut.key==="Home"){E(0),gr.current=0,requestAnimationFrame(()=>j.current[0]?.focus());return}if(Ut.key==="End"){const Yr=Math.max(0,fr-1);E(Yr),gr.current=Yr,requestAnimationFrame(()=>j.current[Yr]?.focus());return}if(Ut.key==="Escape"){w(!1);return}},children:[a.jsxs(Bn,{className:"px-6 py-4 border-b border-border",children:[a.jsxs(Ln,{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(qv,{className:"w-6 h-6 text-brand"}),"Adicionar Produtos"]}),a.jsxs(ma,{className:"text-base mt-2",children:["Mesa ",i.number,"  ",Ie(i.customer)||"Sem cliente"]})]}),a.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-border bg-surface/50",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-text-muted"}),a.jsx("input",{ref:Et,type:"text",className:"w-full pl-10 pr-4 py-3 text-base rounded-lg bg-background border-2 border-border focus:border-brand focus:ring-2 focus:ring-brand/20 transition-all outline-none",placeholder:"Digite o nome ou cdigo do produto...",value:ne,onChange:Ut=>Ae(Ut.target.value),onClick:Ut=>{Ut.stopPropagation(),Ut.currentTarget.focus(),A("panel")},onFocus:Ut=>{Ut.stopPropagation(),A("panel")},onKeyDown:Ut=>{if(Ut.stopPropagation(),Ut.nativeEvent&&typeof Ut.nativeEvent.stopImmediatePropagation=="function"&&Ut.nativeEvent.stopImmediatePropagation(),A("panel"),["ArrowDown","ArrowUp","Home","End","Escape"].includes(Ut.key)){Ut.preventDefault();const _n=C||0,Qr=yr.length;if(Ut.key==="ArrowDown"){E(Math.min(_n+1,Qr-1));return}if(Ut.key==="ArrowUp"){E(Math.max(_n-1,0));return}if(Ut.key==="Home"){E(0);return}if(Ut.key==="End"){E(Qr-1);return}if(Ut.key==="Escape"){w(!1);return}}}})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4 mt-3",children:[a.jsx("button",{onClick:()=>it("all"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="all"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Todos"}),a.jsx("button",{onClick:()=>it("available"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="available"?"bg-success text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Disponvel"}),a.jsx("button",{onClick:()=>it("low"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="low"?"bg-warning text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Estoque Baixo"}),a.jsx("button",{onClick:()=>it("out"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${Ee==="out"?"bg-destructive text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Sem Estoque"}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2 ml-auto text-xs text-text-muted flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface border border-border rounded text-xs font-mono",children:""}),a.jsx("span",{children:"Navegar"})]}),a.jsx("div",{className:"w-px h-3 bg-border"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface border border-border rounded text-xs font-mono",children:"Esc"}),a.jsx("span",{children:"Fechar"})]})]})]})]}),a.jsx("div",{ref:sr,className:"flex-1 overflow-y-auto px-6 py-4 focus:outline-none",tabIndex:-1,onKeyDown:Ut=>{["ArrowDown","ArrowUp","Home","End","PageDown","PageUp","Space"].includes(Ut.key)&&(Ut.preventDefault(),Ut.stopPropagation(),Ut.nativeEvent&&typeof Ut.nativeEvent.stopImmediatePropagation=="function"&&Ut.nativeEvent.stopImmediatePropagation()),Ut.stopPropagation();const _n=Ut.target,Qr=_n&&(_n.tagName==="INPUT"||_n.closest("input"));if(!["ArrowDown","ArrowUp","Home","End","Escape"].includes(Ut.key)||Qr)return;const Ar=C||0,Fn=yr.length;if(Ut.key==="ArrowDown"){const fr=Math.min(Ar+1,Fn-1);E(fr),gr.current=fr,requestAnimationFrame(()=>j.current[fr]?.focus());return}if(Ut.key==="ArrowUp"){const fr=Math.max(Ar-1,0);E(fr),gr.current=fr,requestAnimationFrame(()=>j.current[fr]?.focus());return}if(Ut.key==="Home"){E(0),gr.current=0,requestAnimationFrame(()=>j.current[0]?.focus());return}if(Ut.key==="End"){const fr=Math.max(0,Fn-1);E(fr),gr.current=fr,requestAnimationFrame(()=>j.current[fr]?.focus());return}if(Ut.key==="Escape"){w(!1);return}},children:yr.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[a.jsx(qv,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhum produto encontrado"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Tente ajustar sua busca ou cadastre novos produtos"}),a.jsxs(Z,{onClick:()=>{w(!1),n("/produtos")},children:[a.jsx(so,{className:"w-4 h-4 mr-2"}),"Cadastrar Produtos"]})]}):a.jsx("div",{className:"flex flex-col gap-1.5",children:yr.map((Ut,_n)=>{const Qr=(i?.order||[]).reduce((Dr,dn)=>Dr+(String(dn.productId)===String(Ut.id)?Number(dn.quantity||0):0),0),Ar=Number(Ut.stock??Ut.currentStock??0),Fn=v.get(String(Ut.id))||0,fr=Math.max(0,Ar-Fn),Yr=_n===C,$r=Ut.id===At;return a.jsxs("div",{ref:Dr=>{j.current[_n]=Dr},"data-product-card":!0,className:Pr("flex items-center gap-2 sm:gap-4 p-2.5 sm:p-3 rounded-lg border-2 transition-colors duration-500 outline-none focus:outline-none focus-visible:outline-none",fr===0&&Qr===0?"opacity-50 cursor-not-allowed bg-surface-2 border-border":"cursor-pointer",Yr?"border-brand bg-brand/5 shadow-md":fr>0?"border-border bg-surface hover:border-brand/50 hover:bg-surface-2":Qr>0?"border-border bg-surface":"border-border",$r&&"bg-brand/8"),tabIndex:fr>0||Qr>0?0:-1,onKeyDown:Dr=>{if(["ArrowDown","ArrowUp","Home","End","PageDown","PageUp","Space"].includes(Dr.key)&&(Dr.preventDefault(),Dr.stopPropagation(),Dr.nativeEvent&&typeof Dr.nativeEvent.stopImmediatePropagation=="function"&&Dr.nativeEvent.stopImmediatePropagation()),!["ArrowDown","ArrowUp","Home","End","Escape"].includes(Dr.key))return;Dr.stopPropagation();const dn=yr.length;if(Dr.key==="ArrowDown"){const Nn=Math.min(_n+1,dn-1);E(Nn),gr.current=Nn,requestAnimationFrame(()=>j.current[Nn]?.focus());return}if(Dr.key==="ArrowUp"){const Nn=Math.max(_n-1,0);E(Nn),gr.current=Nn,requestAnimationFrame(()=>j.current[Nn]?.focus());return}if(Dr.key==="Home"){E(0),gr.current=0,requestAnimationFrame(()=>j.current[0]?.focus());return}if(Dr.key==="End"){const Nn=Math.max(0,dn-1);E(Nn),gr.current=Nn,requestAnimationFrame(()=>j.current[Nn]?.focus());return}if(Dr.key==="Escape"){w(!1);return}},onClick:()=>{fr===0&&Qr===0||(E(_n),gr.current=_n,requestAnimationFrame(()=>j.current[_n]?.focus()))},onMouseDown:Dr=>{if(fr===0&&Qr===0){Dr.preventDefault();return}Dr.currentTarget.focus()},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Ut.code&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-mono font-semibold bg-surface-2 border border-border rounded",children:Ut.code}),a.jsx("h4",{className:"font-semibold text-sm sm:text-base text-text-primary truncate",children:Ut.name})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] sm:text-xs mt-0.5",children:[a.jsx("span",{className:Pr("font-bold",fr===0?"text-text-muted":"text-brand"),children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Ut.salePrice??Ut.price??0))}),a.jsxs("span",{className:"text-text-muted whitespace-nowrap",children:["Estoque: ",a.jsx("span",{className:Pr("font-semibold",fr<=5?"text-destructive":"text-text-secondary"),children:fr})]}),Qr>0&&a.jsxs("span",{className:"px-2 py-0.5 bg-brand/10 text-brand text-[11px] font-semibold rounded whitespace-nowrap",children:[Qr,"x na comanda"]})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[a.jsx(Z,{size:"icon",variant:"outline",onClick:Dr=>{Dr.stopPropagation(),rr(Ut)},disabled:Qr===0,className:"h-8 w-8 p-0",children:a.jsx(_v,{className:"w-4 h-4"})}),a.jsx(Z,{size:"icon",onClick:Dr=>{Dr.stopPropagation(),sn(Ut)},disabled:fr===0,className:"h-8 w-8 p-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",children:a.jsx(so,{className:"w-4 h-4"})})]})]},Ut.id)})},(i?.order||[]).map(Ut=>`${String(Ut.productId)}:${Number(Ut.quantity||0)}`).join("|"))}),a.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-t border-border bg-surface/50",children:a.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2",children:[a.jsxs("div",{className:"hidden sm:block text-sm text-text-muted",children:[yr.length," produto",yr.length!==1?"s":"","  ",(i.order||[]).length," ite",(i.order||[]).length!==1?"ns":"m"," na comanda"]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 w-full sm:w-auto",children:[a.jsxs("div",{className:"text-left sm:text-right",children:[a.jsx("div",{className:"text-xs text-text-muted",children:"Total"}),a.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.totalHint||0)})]}),a.jsx(Z,{onClick:()=>w(!1),className:"px-4 sm:px-6 min-w-[96px] sm:min-w-[120px]",size:"sm",children:"Concluir"})]})]})})]})]})}):null},[Nr,xn]=p.useState(null),[Dn,Pa]=p.useState([]),[Aa,Na]=p.useState(!1),[Hn,as]=p.useState(""),[to,As]=p.useState(!1),[Vs,ai]=p.useState([]),[Ni,Si]=p.useState(!1),[Sc,Qc]=p.useState(null),[Cc,Yi]=p.useState([]),[si,zo]=p.useState(!1),[Uo,Ac]=p.useState(null),gl=p.useRef(null);p.useEffect(()=>{gl.current=Nr},[Nr]);const qd=p.useMemo(()=>{const ne=new Map;for(const Ae of Dn||[]){const Ee=Ae.productId,it=Number(Ae.quantity||0);ne.set(Ee,(ne.get(Ee)||0)+it)}return ne},[Dn]),Os=async ne=>{if(!ne)return;const Ee=(await ci({comandaId:ne,codigoEmpresa:t?.codigo_empresa})||[]).map(it=>({id:it.id,productId:it.produto_id,name:it.descricao||"Item",price:Number(it.preco_unitario||0),quantity:Number(it.quantidade||1)}));Pa(Ee)},pi=async ne=>{try{const Ae=t?.codigo_empresa;if(!Ae){e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}let Ee=Nr;if(!Ee){if(Ee=(await $2({codigoEmpresa:Ae}))?.id,!Ee){e({title:"Falha ao iniciar venda no balco",description:"No foi possvel criar ou recuperar a comanda.",variant:"destructive"});return}xn(Ee)}const it=Number(ne.salePrice??ne.price??0);await f3({comandaId:Ee,produtoId:ne.id,descricao:ne.name,quantidade:1,precoUnitario:it,codigoEmpresa:Ae}),await Os(Ee),e({title:"Produto adicionado (balco)",description:ne.name,variant:"success"})}catch(Ae){e({title:"Falha ao adicionar produto (balco)",description:Ae?.message||"Tente novamente",variant:"destructive"})}},_s=async ne=>{if(!(!Nr||!ne)){As(!1);try{await rw({comandaId:Nr,clienteIds:[ne],nomesLivres:[],codigoEmpresa:t?.codigo_empresa}),Qc(ne),Yi(Ae=>{const Ee=new Set((Ae||[]).map(it=>String(it)));return Ee.add(String(ne)),Array.from(Ee)}),as(""),ai([]),e({title:"Cliente associado",variant:"success"})}catch(Ae){e({title:"Falha ao associar cliente",description:Ae?.message||"Tente novamente",variant:"destructive"}),As(!0)}}},Au=async()=>{if(Nr)try{const ne=Tn(Dn,null);if(ne<=0){e({title:"Sem itens",description:"Adicione itens antes de pagar.",variant:"warning"});return}Na(!0),await bm({codigoEmpresa:t?.codigo_empresa});let Ae=Re;if(!Array.isArray(Ae)||Ae.length===0)try{Ae=await Fh({somenteAtivas:!0,codigoEmpresa:t?.codigo_empresa}),Ct(Ae)}catch{}const Ee=Ae?.[0],it=Ee?.tipo||Ee?.nome||"outros";await PR({comandaId:Nr,finalizadoraId:Ee?.id,metodo:it,valor:ne,codigoEmpresa:t?.codigo_empresa}),await U0({comandaId:Nr,codigoEmpresa:t?.codigo_empresa}),e({title:"Pagamento registrado (balco)",description:`R$ ${ne.toFixed(2)}`,variant:"success"}),Pa([]),xn(null),m(!1)}catch(ne){e({title:"Falha no pagamento (balco)",description:ne?.message||"Tente novamente",variant:"destructive"})}finally{Na(!1)}},Zc=()=>{p.useEffect(()=>{let Ae=!0;return(async()=>{if(h)try{Na(!0);const it=t?.codigo_empresa;if(!it){Ae&&e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}const Et=await Tv({codigoEmpresa:it});if(!Ae)return;if(Et?.id){xn(Et.id),await Os(Et.id);try{const gr=await nl({comandaId:Et.id,codigoEmpresa:it}),sr=(gr||[]).map(yr=>yr?.cliente_id).filter(Boolean).map(yr=>String(yr));Yi(sr);const Ir=Array.isArray(gr)&&gr.length>0?gr[0]:null;Ir?.cliente_id&&Qc(Ir.cliente_id)}catch{}}else xn(null),Pa([])}catch(it){Ae&&e({title:"Falha ao abrir Modo Balco",description:it?.message||"Tente novamente",variant:"destructive"})}finally{Ae&&Na(!1)}})(),()=>{Ae=!1}},[h]),p.useEffect(()=>{if(!to)return;let Ae=!0;const it=setTimeout(async()=>{try{Si(!0);const Et=await tw({searchTerm:Hn,limit:20,codigoEmpresa:t?.codigo_empresa});Ae&&ai(Et||[])}catch{Ae&&ai([])}finally{Ae&&Si(!1)}},250);return()=>{Ae=!1,clearTimeout(it)}},[to,Hn]);const ne=Tn(Dn,null);return a.jsx(Un,{open:h,onOpenChange:m,children:a.jsxs(zn,{className:"max-w-4xl h-[90vh]",onKeyDown:Ae=>Ae.stopPropagation(),onKeyDownCapture:Ae=>Ae.stopPropagation(),onPointerDownOutside:Ae=>Ae.stopPropagation(),onInteractOutside:Ae=>Ae.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Modo Balco"}),a.jsx(ma,{children:"Venda rpida para clientes sem mesa."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-6 h-full overflow-hidden pt-4",children:[a.jsxs("div",{className:"col-span-1 flex flex-col border-r border-border pr-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Catlogo de Produtos"}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>As(!0),children:Sc?a.jsxs(a.Fragment,{children:[a.jsx(Di,{className:"mr-1 h-4 w-4 text-success"})," Cliente"]}):"Cliente"})]}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar produto...",className:"pl-9",value:Hn,onChange:Ae=>as(Ae.target.value),ref:_})]}),a.jsx("div",{className:"flex-1 overflow-y-auto -mr-4 pr-4 thin-scroll",children:a.jsxs("ul",{className:"space-y-2",children:[(Y||[]).filter(Ae=>{const Ee=Hn.trim().toLowerCase();return Ee?(Ae.name||"").toLowerCase().includes(Ee)||(Ae.code||"").toLowerCase().includes(Ee):!0}).sort((Ae,Ee)=>{const it=Ae.code||"",Et=Ee.code||"";return/^\d+$/.test(it)&&/^\d+$/.test(Et)?parseInt(it,10)-parseInt(Et,10):it.localeCompare(Et)}).map(Ae=>{const Ee=(Dn||[]).reduce((sr,Ir)=>sr+(String(Ir.productId)===String(Ae.id)?Number(Ir.quantity||0):0),0),it=Number(Ae.stock??Ae.currentStock??0),Et=v.get(String(Ae.id))||0,gr=Math.max(0,it-Et);return a.jsxs("li",{className:"flex items-center p-2 rounded-md hover:bg-surface-2 transition-colors",onClick:()=>{Ac(Ae),zo(!0)},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"font-semibold truncate",title:`${Ae.code?`[${Ae.code}] `:""}${Ae.name}`,children:[Ae.code&&a.jsxs("span",{className:"text-text-muted",children:["[",Ae.code,"]"]})," ",Ae.name]}),Ee>0&&a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-brand/15 text-brand border border-brand/30 flex-shrink-0",children:["x",Ee]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["R$ ",Number(Ae.salePrice??Ae.price??0).toFixed(2)]}),a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-surface-2 text-text-secondary border border-border flex-shrink-0",children:["Qtd ",gr]})]})]}),a.jsx(Z,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:sr=>{sr.stopPropagation(),pi(Ae)},"aria-label":`Adicionar ${Ae.name}`,children:a.jsx(so,{size:16})})]},Ae.id)}),(!Y||Y.length===0)&&a.jsxs("li",{className:"text-center text-text-muted py-8",children:[a.jsx("div",{className:"mb-3",children:"Nenhum produto cadastrado. Cadastre produtos para vender no balco."}),a.jsx(Z,{size:"sm",onClick:()=>n("/produtos"),children:"Cadastrar Produtos"})]})]})})]}),a.jsxs("div",{className:"col-span-1 flex flex-col",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Comanda do Balco"}),a.jsx("div",{className:"flex-1 overflow-y-auto bg-surface-2 rounded-lg p-4 thin-scroll",children:Dn.length===0?a.jsx("p",{className:"text-center text-text-muted pt-16",children:"Adicione produtos  comanda."}):a.jsx("ul",{className:"divide-y divide-border",children:Dn.map(Ae=>a.jsxs("li",{className:"py-2 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:Ae.name}),a.jsxs("div",{className:"text-xs text-text-muted",children:["Qtd: ",Ae.quantity,"  Unit: R$ ",Number(Ae.price||0).toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"font-semibold mr-2",children:["R$ ",(Number(Ae.price||0)*Number(Ae.quantity||0)).toFixed(2)]}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:async()=>{const Ee=Number(Ae.quantity||1)-1;if(Ee<=0)L(Ae),ie(!0),setTimeout(async()=>{H||await Os(Nr)},100);else try{await Qd({itemId:Ae.id,quantidade:Ee,codigoEmpresa:t?.codigo_empresa}),await Os(Nr)}catch(it){e({title:"Falha ao atualizar",description:it?.message||"Tente novamente",variant:"destructive"})}},children:a.jsx(_v,{size:14})}),a.jsx("span",{className:"w-8 text-center font-semibold",children:Ae.quantity}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:async()=>{try{await Qd({itemId:Ae.id,quantidade:Number(Ae.quantity||1)+1,codigoEmpresa:t?.codigo_empresa}),await Os(Nr)}catch(Ee){e({title:"Falha ao atualizar",description:Ee?.message||"Tente novamente",variant:"destructive"})}},children:a.jsx(so,{size:14})})]})]},Ae.id))})}),a.jsxs("div",{className:"p-4 border-t border-border mt-auto",children:[a.jsxs("div",{className:"flex justify-between items-center text-xl font-bold mb-4",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",ne.toFixed(2)]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(Gu,{children:[a.jsx(_g,{asChild:!0,children:a.jsx(Z,{size:"lg",className:"flex-1 bg-red-600 hover:bg-red-500 text-white border border-red-600/70",children:"Cancelar"})}),a.jsxs(tu,{className:"sm:max-w-[420px] animate-none",onKeyDown:Ae=>Ae.stopPropagation(),children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Cancelar comanda do balco?"}),a.jsx(su,{children:"Os itens sero descartados e o balco ser limpo. Esta ao no pode ser desfeita."})]}),a.jsxs(nu,{children:[a.jsx(ou,{children:"Voltar"}),a.jsx(Ku,{onClick:async()=>{try{if(!Nr){m(!1);return}await Uz({comandaId:Nr,codigoEmpresa:t?.codigo_empresa}),Pa([]),xn(null),m(!1),e({title:"Comanda cancelada (balco)",variant:"success"})}catch(Ae){e({title:"Falha ao cancelar",description:Ae?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar Cancelamento"})]})]})]}),a.jsxs(Z,{size:"lg",className:"flex-1",onClick:Au,disabled:Aa||ne<=0,children:[a.jsx(Wi,{className:"mr-2"})," Finalizar Pagamento"]})]})]})]})]}),to&&a.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center",onClick:Ae=>{Ae.target===Ae.currentTarget&&As(!1)},onKeyDown:Ae=>{Ae.key==="Escape"&&As(!1)},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border shadow-lg w-full max-w-md p-4",role:"dialog","aria-modal":"true",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"text-lg font-semibold",children:"Selecionar Cliente"}),a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>As(!1),children:"Fechar"})]}),a.jsxs("div",{className:"relative mb-2",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Nome, e-mail, telefone ou cdigo",className:"pl-9",value:Hn,onChange:Ae=>as(Ae.target.value)})]}),a.jsx("div",{className:"max-h-64 overflow-auto thin-scroll border rounded-md",children:Ni?a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Carregando clientes..."}):Vs.length>0?a.jsx("ul",{children:Vs.map(Ae=>{const Ee=Array.isArray(Cc)&&Cc.includes(String(Ae.id));return a.jsxs("li",{className:Pr("p-2 flex items-center justify-between cursor-pointer hover:bg-surface-2",Ee&&"bg-surface-2"),onClick:()=>_s(Ae.id),children:[a.jsx("div",{children:a.jsxs("div",{className:"font-medium",children:[Ae.codigo!=null?String(Ae.codigo)+" - ":"",Ae.nome]})}),Ee&&a.jsx(Di,{size:16,className:"text-success"})]},Ae.id)})}):a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum cliente encontrado."})})]})})]})})},Ji=()=>{const ne=Uo,Ae=ne&&qd.get(ne.id)||0,Ee=ne?Number(ne.salePrice??ne.price??0):0,it=Et=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Et||0));return a.jsx(Un,{open:si,onOpenChange:Et=>{zo(Et),Et||Ac(null)},children:a.jsxs(zn,{className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[61]",onKeyDown:Et=>Et.stopPropagation(),onPointerDownOutside:Et=>Et.stopPropagation(),onInteractOutside:Et=>Et.stopPropagation(),onEscapeKeyDown:Et=>{Et.preventDefault(),Et.stopPropagation()},children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold break-words",title:ne?.name||"",children:ne?.name||"Produto"}),a.jsx(ma,{children:"Detalhes do produto (Balco)."})]}),ne?a.jsxs("div",{className:"space-y-3 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:it(Ee)})]}),ne.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:ne.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof ne.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:ne.stock})]}),typeof ne.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:ne.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",Ae]})]})]})]}):null,a.jsxs(Ga,{className:"flex items-center justify-between gap-2",children:[a.jsxs(Z,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{ne&&n("/produtos",{state:{productId:ne.id,productName:ne.name}})},children:[a.jsx(il,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(Z,{variant:"outline",onClick:()=>{zo(!1),Ac(null)},children:"Fechar"}),a.jsx(Z,{onClick:async()=>{ne&&(await pi(ne),zo(!1),Ac(null))},children:"Adicionar"})]})]})})},Ol=()=>{const[ne,Ae]=p.useState(""),[Ee,it]=p.useState(!1),[Et,gr]=p.useState([]),[sr,Ir]=p.useState([]),[yr,Ut]=p.useState(0),[_n,Qr]=p.useState(!1),[Ar,Fn]=p.useState(0),fr=p.useRef([]),Yr=p.useRef(null),$r=p.useRef(null),Dr=p.useRef(null),dn=p.useRef(null),Nn=p.useRef(0),ua=p.useRef(0);p.useEffect(()=>{let vn=!0;return(async()=>{try{it(!0);const rn=await tw({searchTerm:ne,limit:20});if(!vn)return;const gn=(rn||[]).slice(),Vn=String(ne||"").trim().toLowerCase(),On=mr=>{const Zr=String(mr?.nome||"").toLowerCase();return Vn?Zr.startsWith(Vn)?0:Zr.includes(Vn)?1:2:2};gn.sort((mr,Zr)=>{const _r=On(mr),Br=On(Zr);if(_r!==Br)return _r-Br;const qr=Number(mr?.codigo||0),Rr=Number(Zr?.codigo||0);return qr-Rr}),gr(gn),Fn(0)}catch{if(!vn)return;gr([])}finally{vn&&it(!1)}})(),()=>{vn=!1}},[ne]);const ds=p.useRef(!1);p.useEffect(()=>{try{ut&&!ds.current&&(ds.current=!0,Dr.current&&(Dr.current.scrollTop=0),Yr.current&&(Yr.current.scrollTop=0),$r.current&&($r.current.scrollTop=0)),ut||(ds.current=!1)}catch{}},[ut]),p.useEffect(()=>{try{ut&&Array.isArray(Et)&&Et.length>0&&(Fn(0),setTimeout(()=>{try{Yr.current?.focus(),$r.current&&($r.current.scrollTop=0)}catch{}},0))}catch{}},[ut,Et.length]);const Xs=async(vn=null)=>{try{if(!wt)return;bt(!0);const Or=await yKe({mesaId:wt.id,codigoEmpresa:t?.codigo_empresa}),gn=Array.isArray(vn)?vn:sr,Vn=Array.isArray(gn)?Array.from(new Set(gn)):[];let On=[],mr=Math.max(0,Number(yr||0));Vn.length===0&&mr===0&&(mr=1);for(let Br=0;Br<mr;Br++)On.push("Consumidor");await rw({comandaId:Or.id,clienteIds:Vn,nomesLivres:On,codigoEmpresa:t?.codigo_empresa,replace:!0});let Zr=null;try{const Br=await nl({comandaId:Or.id,codigoEmpresa:t?.codigo_empresa}),Rr=(Array.isArray(Br)?Br:[]).map(Vr=>Vr?.nome).filter(Boolean);Zr=Rr.length?Rr.join(", "):null}catch(Br){console.error("[confirmOpen] Erro ao buscar vnculos:",Br)}if(!Zr){const Br=Array.isArray(Vn)?Vn:[],qr=Array.isArray(Et)?Et:[];Zr=Br.length?Br.map(Rr=>qr.find(Vr=>Vr.id===Rr)?.nome).filter(Boolean).join(", "):On.length>0?On.join(", "):""}const _r={...wt,comandaId:Or.id,status:"in-use",customer:Zr||null,order:[]};l(_r),o(Br=>Br.map(qr=>qr.id===_r.id?_r:qr)),await new Promise(Br=>setTimeout(Br,500));try{const Br=await Lh(t?.codigo_empresa),qr=await yd({codigoEmpresa:t?.codigo_empresa}),Rr={},Vr={},kn=Array.isArray(qr)?qr:[];await Promise.all(kn.map(async we=>{try{const et=await nl({comandaId:we.id,codigoEmpresa:t?.codigo_empresa}),St=(Array.isArray(et)?et:[]).map(Qe=>Qe?.nome).filter(Boolean);Rr[we.id]=St.length?St.join(", "):null;const tt=await ci({comandaId:we.id,codigoEmpresa:t?.codigo_empresa}),Mt=(Array.isArray(tt)?tt:[]).reduce((Qe,ar)=>{const Sn=(ar.quantidade||0)*(ar.preco_unitario||0)-(ar.desconto||0);return Qe+Sn},0);Vr[we.id]=Mt}catch(et){console.error("[confirmOpen] Erro ao buscar dados da comanda:",et),Rr[we.id]=null,Vr[we.id]=0}}));const le=(Br||[]).map(we=>{const et=(qr||[]).find(St=>St.mesa_id===we.id),_e=et?Rr[et.id]!==null?Rr[et.id]:Zr:null;return{id:we.id,name:we.nome||`Mesa ${we.numero}`,status:et?"in-use":"available",comandaId:et?.id||null,customer:_e,order:[],totalHint:et&&Vr[et.id]||0,aberto_em:et?.aberto_em||null}});o(le)}catch(Br){console.error("[confirmOpen] Erro ao atualizar mesas:",Br)}pt(!1),Gt(null),wr(""),Ir([]),Ut(0),Qr(!1),e({title:"Mesa aberta",description:Zr?`Comanda criada para: ${Zr}`:"Comanda criada.",variant:"success"})}catch(Or){console.error("[confirmOpen] Falha ao abrir mesa:",Or?.message||Or,Or?.stack),e({title:"Falha ao abrir mesa",description:Or?.message||"Tente novamente",variant:"destructive"})}finally{bt(!1)}};return a.jsx(Un,{open:ut,onOpenChange:vn=>{pt(vn),vn||(Gt(null),wr(""),Ir([]),Ut(0),Qr(!1))},children:a.jsxs(zn,{className:"w-[95vw] max-w-md h-[560px] max-h-[75vh] flex flex-col animate-none overflow-hidden",onOpenAutoFocus:vn=>vn.preventDefault(),onPointerDownOutside:vn=>{vn.preventDefault(),vn.stopPropagation()},onInteractOutside:vn=>{vn.preventDefault(),vn.stopPropagation()},onEscapeKeyDown:vn=>{vn.preventDefault(),pt(!1)},onKeyDown:vn=>{vn.key==="Escape"&&(vn.preventDefault(),vn.stopPropagation(),pt(!1))},ref:Dr,children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsxs(Ln,{className:"text-xl font-bold",children:["Abrir Mesa ",wt?`#${wt.number}`:""]}),a.jsx(ma,{className:"text-sm",children:"Selecione um ou mais clientes para a mesa."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto thin-scroll min-h-0 space-y-2 py-2",ref:$r,children:[a.jsxs("div",{children:[a.jsx(ct,{className:"text-sm font-medium mb-1.5 block",children:"Buscar cliente"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Nome, telefone ou cdigo",className:"pl-8 h-9 text-sm",value:ne,ref:dn,onChange:vn=>{ua.current=Date.now(),Ae(vn.target.value)},onKeyDown:vn=>{if(vn.key==="Enter"){vn.preventDefault();try{if(Array.isArray(Et)&&Et.length>0){const Or=Math.min(Math.max(Ar||0,0),Et.length-1),rn=Et[Or];rn?.id&&Ir(gn=>gn.includes(rn.id)?gn.filter(Vn=>Vn!==rn.id):[...gn,rn.id])}}catch{}Ae(""),setTimeout(()=>{try{Yr.current?.focus()}catch{}},0)}else ua.current=Date.now()}})]}),a.jsx(Z,{type:"button",size:"icon",title:"Cadastrar cliente",className:"h-9 w-9 flex-shrink-0 bg-brand text-black hover:bg-brand/90",onClick:()=>{window.location.href="/clientes"},children:a.jsx(so,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"mt-1.5 text-[12px] text-text-muted flex items-center gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:""})," seleciona"]}),a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:""})," desmarca"]}),a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-border/70 bg-surface-2",children:"Enter"})," confirma"]}),a.jsx("span",{className:"inline-flex items-center gap-1",children:"Digite para buscar"})]})]}),a.jsx("div",{className:"min-h-[8px]",children:sr.length>0&&a.jsxs("div",{className:"bg-success/10 border border-success/30 rounded-md p-2.5",children:[a.jsxs("div",{className:"text-xs font-medium text-success mb-1",children:[sr.length," cliente",sr.length>1?"s":""," selecionado",sr.length>1?"s":""]}),a.jsx("div",{className:"text-sm text-text-primary",children:Et.filter(vn=>sr.includes(vn.id)).map(vn=>vn.nome).join(", ")})]})}),a.jsx("div",{className:"border rounded-md focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0",role:"listbox","aria-label":"Clientes","aria-activedescendant":Et&&Et.length>0&&Et[Ar]&&Et[Ar].id?`ot-option-${Et[Ar].id}`:void 0,ref:Yr,tabIndex:0,onKeyDown:vn=>{try{if(vn.key&&vn.key.length===1&&!vn.ctrlKey&&!vn.metaKey&&!vn.altKey||vn.key==="Backspace"){vn.preventDefault(),vn.stopPropagation();let rn=String(ne||"");vn.key==="Backspace"?rn=rn.slice(0,-1):rn+=vn.key,Ae(rn),ua.current=Date.now();try{$r.current&&($r.current.scrollTop=0)}catch{}setTimeout(()=>{try{if(dn.current){dn.current.focus();const gn=rn.length;dn.current.setSelectionRange?.(gn,gn)}}catch{}},0);return}if(["ArrowDown","ArrowUp","Home","End","ArrowRight","ArrowLeft"," "].includes(vn.key)){let rn=Ar||0;const gn=Et.length;vn.key==="ArrowDown"&&(rn=Math.min(rn+1,gn-1)),vn.key==="ArrowUp"&&(rn=Math.max(rn-1,0)),vn.key==="Home"&&(rn=0),vn.key==="End"&&(rn=gn-1),Fn(rn),setTimeout(()=>{try{fr.current[rn]?.scrollIntoView({block:"nearest"})}catch{}},0);const Vn=Et[rn],On=Vn?.codigo===0;if(vn.key==="ArrowRight"&&Vn?.id&&(On?(Qr(!0),Ut(mr=>mr+1)):(wr(""),Ir(mr=>mr.includes(Vn.id)?mr:[...mr,Vn.id]))),vn.key==="ArrowLeft"&&Vn?.id)if(On){const mr=Math.max(0,yr-1);Ut(mr),mr===0&&Qr(!1)}else Ir(mr=>mr.filter(Zr=>Zr!==Vn.id));vn.key===" "&&Vn?.id&&(wr(""),Ir(mr=>mr.includes(Vn.id)?mr.filter(Zr=>Zr!==Vn.id):[...mr,Vn.id]));return}if(vn.key==="Enter"){vn.preventDefault();const rn=Math.min(Math.max(Ar||0,0),Et.length-1),gn=Et[rn];if(Date.now()-ua.current<600||document.activeElement===dn.current||ne&&ne.length>0){gn?.id&&(wr(""),Ir(mr=>mr.includes(gn.id)?mr.filter(Zr=>Zr!==gn.id):[...mr,gn.id])),Ae(""),setTimeout(()=>{try{Yr.current?.focus(),$r.current&&($r.current.scrollTop=0)}catch{}},0);return}if(gn?.id){const mr=sr.includes(gn.id)?sr:[...sr,gn.id];sr.includes(gn.id)||Ir(Zr=>[...Zr,gn.id]),setTimeout(()=>{try{Xs(mr)}catch{}},0);return}setTimeout(()=>{try{Xs(sr)}catch{}},0);return}}catch{}},children:Ee?a.jsx("div",{className:"p-3 text-center text-sm text-text-muted",children:"Carregando..."}):Et.length>0?a.jsx("ul",{className:"divide-y divide-border",children:Et.map((vn,Or)=>{const rn=vn.codigo===0,gn=sr.includes(vn.id),Vn=Or===(Ar||0),On=rn?yr:0;return a.jsxs("li",{id:`ot-option-${vn.id}`,ref:mr=>{fr.current[Or]=mr},role:"option","aria-selected":Vn,className:Pr("p-2.5 flex items-center gap-2 cursor-pointer transition-colors outline-none focus:outline-none focus-visible:outline-none border border-transparent",rn?"bg-amber-500/5 border-l-2 border-l-amber-500/40":"",gn&&!rn?"bg-success/10 hover:bg-success/15":"hover:bg-surface-2",_n&&rn?"bg-amber-500/10":"",Vn?"bg-brand/10":""),onClick:()=>{rn?_n||(Qr(!0),Ut(1)):(wr(""),Ir(mr=>mr.includes(vn.id)?mr.filter(Zr=>Zr!==vn.id):[...mr,vn.id]))},onDoubleClick:()=>{if(!rn){const mr=sr.includes(vn.id)?sr:[...sr,vn.id];Ir(mr),setTimeout(()=>{try{Xs(mr)}catch{}},0)}},onMouseEnter:()=>{Date.now()-(Nn.current||0)>300&&Fn(Or)},tabIndex:-1,children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[!rn&&a.jsx("span",{className:Pr("w-2 h-2 rounded-full flex-shrink-0",gn?"bg-success":Vn?"bg-brand":"bg-border")}),a.jsxs("div",{className:"font-medium text-sm truncate",children:[vn.codigo!=null&&vn.codigo!==0?`${vn.codigo} - `:"",vn.nome,rn&&a.jsx("span",{className:"ml-2 text-xs text-amber-600",children:"Cliente Padro"})]})]}),rn?_n?a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx(Z,{type:"button",size:"sm",variant:"ghost",className:"h-7 w-7 p-0 hover:bg-red-500/10",onClick:mr=>{mr.stopPropagation();const Zr=Math.max(0,yr-1);Ut(Zr),Zr===0&&Qr(!1)},children:a.jsx(_v,{className:"h-4 w-4"})}),a.jsx("div",{className:"w-8 h-7 flex items-center justify-center bg-surface-2 rounded text-sm font-medium",children:On}),a.jsx(Z,{type:"button",size:"sm",variant:"ghost",className:"h-7 w-7 p-0 hover:bg-green-500/10",onClick:mr=>{mr.stopPropagation(),Ut(Zr=>Zr+1)},children:a.jsx(so,{className:"h-4 w-4"})})]}):null:a.jsx("div",{className:"ml-2 flex-shrink-0",children:gn?a.jsx(Di,{size:18,className:"text-success"}):a.jsx("div",{className:"w-[18px] h-[18px] rounded-full border-2 border-border"})})]},vn.id)})}):a.jsx("div",{className:"p-4 text-center text-sm text-text-muted",children:"Nenhum cliente encontrado"})})]}),a.jsxs(Ga,{className:"flex-shrink-0 pt-3",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>{pt(!1),Gt(null),wr(""),Ir([])},children:"Cancelar"}),a.jsx(Z,{onClick:()=>Xs(),disabled:!wt||ft,children:ft?"Abrindo...":"Confirmar Abertura"})]})]})})},R=()=>{const[ne,Ae]=p.useState("");return p.useEffect(()=>{br.current&&Ae(br.current)},[]),a.jsxs(a.Fragment,{children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Abrir Caixa"}),a.jsx(su,{children:"Insira o valor inicial (suprimento) para abrir o caixa."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(ct,{htmlFor:"initial-value",children:"Valor Inicial"}),a.jsxs("div",{className:"relative mt-2",children:[a.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:"R$"}),a.jsx(It,{id:"initial-value",type:"text",inputMode:"numeric",pattern:"[0-9.,]*",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,name:"cash-open-initial",placeholder:"0,00",className:"pl-9 font-semibold",value:ne,onChange:Ee=>{const it=(Ee.target.value||"").replace(/\D/g,""),Et=it?Number(it)/100:0,gr=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Et);Ae(gr),br.current=gr},onKeyDown:Ee=>{Ee.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ee.key)&&(/^[0-9]$/.test(Ee.key)||Ee.preventDefault())},onBeforeInput:Ee=>{const it=Ee.data??"";it&&/\D/.test(it)&&Ee.preventDefault()},onMouseDown:Ee=>Ee.stopPropagation()})]})]}),a.jsxs(nu,{children:[a.jsx(ou,{onClick:()=>or(!1),children:"Cancelar"}),a.jsx(Ku,{onClick:async()=>{if(!ur){an(!0);try{const Ee=String(ne).replace(/\./g,"").replace(",","."),it=Number(Ee)||0;try{localStorage.setItem("cash:opening",String(Date.now()))}catch{}await bm({saldoInicial:it,codigoEmpresa:t?.codigo_empresa}),await Cr(),await Yt({showToast:!1}),or(!1),e({title:"Caixa aberto com sucesso!",variant:"success"}),br.current="",Ae("")}catch(Ee){e({title:"Falha ao abrir caixa",description:Ee?.message||"Tente novamente",variant:"destructive"})}finally{try{localStorage.removeItem("cash:opening")}catch{}an(!1)}}},children:"Confirmar Abertura"})]})]})},de=()=>a.jsxs(Gu,{open:gt,onOpenChange:or,children:[a.jsx(_g,{asChild:!0,children:a.jsxs(Z,{variant:"success",size:"sm",disabled:c||ur,onClick:()=>or(!0),className:"px-3 whitespace-nowrap",children:[a.jsx(SG,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Abrir"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Abrir Caixa"}),a.jsx("kbd",{className:"ml-2 hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-emerald-700 border border-emerald-800 rounded shadow-sm",children:"F10"})]})}),a.jsx(tu,{className:"sm:max-w-[425px] animate-none",onKeyDown:ne=>ne.stopPropagation(),onKeyDownCapture:ne=>ne.stopPropagation(),onEscapeKeyDown:ne=>ne.preventDefault(),onPointerDownOutside:ne=>{ne.preventDefault(),ne.stopPropagation()},onInteractOutside:ne=>{ne.preventDefault(),ne.stopPropagation()},children:a.jsx(R,{})})]}),Ue=()=>{const[ne,Ae]=p.useState({loading:!1,saldoInicial:0,resumo:null}),[Ee,it]=p.useState(!1),[Et,gr]=p.useState(!1),[sr,Ir]=p.useState(!1),[yr,Ut]=p.useState(!1),[_n,Qr]=p.useState(""),Ar=async()=>{try{Ae({loading:!0,saldoInicial:0,resumo:null});const $r=await $h({codigoEmpresa:t?.codigo_empresa}),Dr=await P1({codigoEmpresa:t?.codigo_empresa});Ae({loading:!1,saldoInicial:Number($r?.saldo_inicial||0),resumo:Dr||{totalPorFinalizadora:{}}})}catch{Ae({loading:!1,saldoInicial:0,resumo:{totalPorFinalizadora:{}}})}},Fn=ne?.resumo?.totalPorFinalizadora||{},fr=Object.values(Fn).reduce(($r,Dr)=>$r+Number(Dr||0),0),Yr=Number(ne.saldoInicial||0)+fr;return a.jsxs(a.Fragment,{children:[a.jsxs(Gu,{open:Ee,onOpenChange:$r=>{it($r),$r&&Ar()},children:[a.jsx(_g,{asChild:!0,children:a.jsxs(Z,{variant:"destructive",size:"sm",disabled:!c,onClick:()=>it(!0),className:"px-3 whitespace-nowrap",children:[a.jsx(d0,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Fechar"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Fechar Caixa"})]})}),a.jsxs(tu,{className:"sm:max-w-[425px] w-[92vw] max-h-[85vh] animate-none",onOpenAutoFocus:$r=>$r.preventDefault(),onKeyDown:$r=>$r.stopPropagation(),onKeyDownCapture:$r=>$r.stopPropagation(),onPointerDownOutside:$r=>{$r.preventDefault(),$r.stopPropagation()},onInteractOutside:$r=>{$r.preventDefault(),$r.stopPropagation()},children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Fechar Caixa"}),a.jsx(su,{children:"Confira os valores e confirme o fechamento do caixa. Esta ao  irreversvel."})]}),sr&&a.jsxs("div",{className:"md:hidden mb-2 text-[12px] text-warning bg-warning/10 border border-warning/30 rounded px-2 py-1 flex items-center gap-1",children:[a.jsx(Pd,{className:"h-3.5 w-3.5"}),"Existem comandas abertas. Finalize-as antes de fechar o caixa."]}),ne.loading?a.jsx("div",{className:"py-4 text-text-muted",children:"Carregando resumo"}):a.jsxs("div",{className:"py-4 space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial:"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(ne.saldoInicial||0).toFixed(2)]})]}),Object.keys(Fn).length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos nesta sesso."}):Object.entries(Fn).map(([$r,Dr])=>a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"text-text-secondary",children:[String($r),":"]})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(Dr||0).toFixed(2)]})]},$r)),a.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[a.jsx("span",{className:"text-text-primary",children:"Total em Caixa:"})," ",a.jsxs("span",{className:"font-mono text-success",children:["R$ ",Number(Yr||0).toFixed(2)]})]})]}),a.jsxs(nu,{children:[a.jsx(ou,{onClick:()=>it(!1),disabled:yr,children:"Cancelar"}),a.jsx(Ku,{onClick:()=>{gr(!0)},disabled:yr,children:"Continuar"})]})]})]}),a.jsx(Gu,{open:Et,onOpenChange:$r=>{yr||gr($r)},children:a.jsxs(tu,{className:"sm:max-w-[425px] w-[92vw] max-h-[85vh] animate-none",onOpenAutoFocus:$r=>$r.preventDefault(),onEscapeKeyDown:$r=>{yr||$r.preventDefault()},onKeyDown:$r=>$r.stopPropagation(),onKeyDownCapture:$r=>$r.stopPropagation(),onPointerDownOutside:$r=>{yr||($r.preventDefault(),$r.stopPropagation())},onInteractOutside:$r=>{yr||($r.preventDefault(),$r.stopPropagation())},children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Confirmar Fechamento do Caixa"}),a.jsx(su,{children:"Informe o saldo final para finalizar o fechamento."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(ct,{htmlFor:"valor-contado-final",className:"text-sm font-medium text-text-primary mb-2 block",children:"Saldo Final (opcional)"}),a.jsx("input",{id:"valor-contado-final",type:"text",placeholder:"R$ 0,00",value:_n,onChange:$r=>{let Dr=$r.target.value.replace(/\D/g,"");Dr.length>0&&(Dr=(Number(Dr)/100).toFixed(2),Dr=Dr.replace(".",","),Dr="R$ "+Dr),Qr(Dr)},className:"w-full px-3 py-2 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),a.jsxs(nu,{children:[a.jsx(ou,{onClick:()=>{gr(!1)},disabled:yr,children:"Voltar"}),a.jsx(Ku,{onClick:async()=>{try{if(yr)return;Ut(!0);const $r=Number(ne.saldoInicial||0)+fr,Dr=_n?Number(_n.replace(/[^0-9,]/g,"").replace(",",".")):null;await lne({saldoFinal:$r,valorFinalDinheiro:Dr,codigoEmpresa:t?.codigo_empresa}),d(!1),typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{gr(!1),it(!1),Qr(""),e({title:"Caixa fechado!",description:`Saldo final: R$ ${$r.toFixed(2)}`,duration:4e3})}):(gr(!1),it(!1),Qr(""),e({title:"Caixa fechado!",description:`Saldo final: R$ ${$r.toFixed(2)}`,duration:4e3})),setTimeout(async()=>{try{await $h({codigoEmpresa:t?.codigo_empresa})}catch{}},0)}catch($r){console.error($r);const Dr=$r?.message||"Tente novamente";if(Ze){We(Dr.includes("Existem")?Dr:`Falha ao fechar caixa: ${Dr}`);try{gr(!1),it(!1)}catch{}typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>{cn(!0)}):cn(!0),setTimeout(()=>cn(!1),2600)}else e({title:"Falha ao fechar caixa",description:Dr,variant:"destructive"})}finally{Ut(!1)}},children:"Confirmar Fechamento"})]})]})})]})},vt=()=>{const[ne,Ae]=p.useState(""),[Ee,it]=p.useState([]),[Et,gr]=p.useState([]),[sr,Ir]=p.useState(!1),[yr,Ut]=p.useState(new Set),_n=p.useRef([]),Qr=p.useRef(!1),[Ar,Fn]=p.useState(0);p.useRef([]);const fr=p.useRef(null);p.useRef(0);const[Yr,$r]=p.useState(!1),[Dr,dn]=p.useState(null),[Nn,ua]=p.useState(null),[ds,Xs]=p.useState("");p.useEffect(()=>{let _r=!0;const Br=async()=>{if(!(!me||!i?.comandaId)&&!(Qr.current&&ne===""))try{Ir(!0);const qr=await nl({comandaId:i.comandaId,codigoEmpresa:t?.codigo_empresa});if(!_r)return;const Rr=(qr||[]).map(le=>({id:le.id,cliente_id:le.cliente_id,nome:le.nome||"",tipo:le.tipo||(le.cliente_id?"cadastrado":"livre")}));gr(Rr),_n.current=JSON.parse(JSON.stringify(Rr)),Ut(new Set);const Vr=await tw({searchTerm:ne,limit:50,codigoEmpresa:t?.codigo_empresa});if(!_r)return;const kn=(Vr||[]).slice().sort((le,we)=>Number(le?.codigo||0)-Number(we?.codigo||0));it(kn),Fn(0),Qr.current=!0}catch(qr){console.error("Erro ao carregar clientes:",qr)}finally{_r&&Ir(!1)}};return me?(Br(),()=>{_r=!1}):(Qr.current=!1,Ae(""),()=>{_r=!1})},[me,i?.comandaId]),p.useEffect(()=>{me&&Array.isArray(Ee)&&Ee.length>0&&(Fn(0),setTimeout(()=>{try{const _r=document.querySelector('[role="dialog"]');if(_r){const Br=_r.querySelector(".overflow-y-auto");Br&&(Br.scrollTop=0)}}catch{}},0))},[me,Ee.length]),p.useEffect(()=>(me&&i?.comandaId?(Xr.current=!0,Ft.current=i.comandaId,kr.current=_r=>{gr(_r||[]),vn(_r||[])}):me||Xr.current&&Ft.current===i?.comandaId&&(Xr.current=!1,Ft.current=null,kr.current=null),()=>{me||(Xr.current=!1,Ft.current=null,kr.current=null)}),[me,i?.comandaId]);const vn=_r=>{try{if(!i?.id)return;const Br=(_r||[]).map(Rr=>Rr?.nome).filter(Boolean),qr=Br.length?Br.join(", "):null;l(Rr=>Rr&&Rr.id===i.id?{...Rr,customer:qr}:Rr),o(Rr=>Rr.map(Vr=>Vr.id===i.id?{...Vr,customer:qr}:Vr))}catch(Br){console.error("[ManageClientsDialog] Erro ao sincronizar nomes na mesa:",Br)}},Or=()=>{try{console.log("[ManageClientsDialog] addConsumidor clicado")}catch{}i?.comandaId&&(async()=>{try{Ir(!0);const{data:_r,error:Br}=await Q.from("comanda_clientes").insert({comanda_id:i.comandaId,nome_livre:"Consumidor",codigo_empresa:t?.codigo_empresa}).select("id, cliente_id, nome_livre").single();if(Br)throw Br;const qr={id:_r.id,cliente_id:_r.cliente_id,nome:_r.nome_livre||"Consumidor",tipo:"livre"};gr(Rr=>{const Vr=[...Rr,qr];return vn(Vr),Vr}),ua(qr.id),Xs(qr.nome||"Consumidor")}catch(_r){console.error("[ManageClientsDialog] Erro ao adicionar consumidor:",_r),e({title:"Falha ao adicionar consumidor",description:_r?.message||"Tente novamente",variant:"destructive"})}finally{Ir(!1)}})()},rn=_r=>{try{console.log("[ManageClientsDialog] addClientFromModal clicado:",_r)}catch{}if(!i?.comandaId)return;const Br=Ee.find(qr=>qr.id===_r);Br&&(async()=>{try{Ir(!0);const{data:qr,error:Rr}=await Q.from("comanda_clientes").insert({comanda_id:i.comandaId,cliente_id:_r,codigo_empresa:t?.codigo_empresa}).select("id, cliente_id").single();if(Rr)throw Rr;const Vr={id:qr.id,cliente_id:qr.cliente_id,nome:Br.nome,tipo:"cadastrado"};gr(kn=>{const le=[...kn,Vr];return vn(le),le}),$r(!1)}catch(qr){console.error("[ManageClientsDialog] Erro ao adicionar cliente:",qr),e({title:"Falha ao adicionar cliente",description:qr?.message||"Tente novamente",variant:"destructive"})}finally{Ir(!1)}})()},gn=(_r,Br)=>{const qr=Ee.find(Vr=>Vr.id===Br);!qr||!Et.find(Vr=>Vr.id===_r)||(async()=>{try{if(Ir(!0),String(_r).startsWith("temp-")){const{data:Vr,error:kn}=await Q.from("comanda_clientes").insert({comanda_id:i.comandaId,cliente_id:Br,codigo_empresa:t?.codigo_empresa}).select("id, cliente_id").single();if(kn)throw kn;const le={id:Vr.id,cliente_id:Vr.cliente_id,nome:qr.nome,tipo:"cadastrado"};gr(we=>{const et=[...we.filter(_e=>_e.id!==_r),le];return vn(et),et})}else{const{error:Vr}=await Q.from("comanda_clientes").update({cliente_id:Br,nome_livre:null}).eq("id",_r).eq("codigo_empresa",t?.codigo_empresa);if(Vr)throw Vr;gr(kn=>{const le=kn.map(we=>we.id===_r?{...we,cliente_id:Br,nome:qr.nome,tipo:"cadastrado"}:we);return vn(le),le})}dn(null),$r(!1)}catch(Vr){console.error("[ManageClientsDialog] Erro ao trocar cliente:",Vr),e({title:"Falha ao trocar cliente",description:Vr?.message||"Tente novamente",variant:"destructive"})}finally{Ir(!1)}})()},Vn=_r=>{if(Et.find(qr=>qr.id===_r)){if(String(_r).startsWith("temp-")||!i?.comandaId){gr(qr=>{const Rr=qr.filter(Vr=>Vr.id!==_r);return vn(Rr),Rr});return}(async()=>{try{Ir(!0);const{error:qr}=await Q.from("comanda_clientes").delete().eq("id",_r).eq("codigo_empresa",t?.codigo_empresa);if(qr)throw qr;gr(Rr=>{const Vr=Rr.filter(kn=>kn.id!==_r);return vn(Vr),Vr})}catch(qr){console.error("[ManageClientsDialog] Erro ao remover cliente:",qr),e({title:"Falha ao remover cliente",description:qr?.message||"Tente novamente",variant:"destructive"})}finally{Ir(!1)}})()}},On=_r=>{try{console.log("[ManageClientsDialog] startEditConsumidor clicado:",_r)}catch{}const Br=Et.find(qr=>qr.id===_r);Br&&(ua(_r),Xs(Br.nome||"Consumidor"))},mr=()=>{if(!Nn||!i?.comandaId)return;const _r=ds.trim()||"Consumidor";(async()=>{try{if(Ir(!0),!String(Nn).startsWith("temp-")){const{error:Br}=await Q.from("comanda_clientes").update({nome_livre:_r}).eq("id",Nn).eq("codigo_empresa",t?.codigo_empresa);if(Br)throw Br}gr(Br=>{const qr=Br.map(Rr=>Rr.id===Nn?{...Rr,nome:_r}:Rr);return vn(qr),qr})}catch(Br){console.error("[ManageClientsDialog] Erro ao salvar consumidor:",Br),e({title:"Falha ao salvar cliente",description:Br?.message||"Tente novamente",variant:"destructive"})}finally{Ir(!1),ua(null),Xs("")}})()},Zr=async()=>{be(!1)};return a.jsxs(Un,{open:me,onOpenChange:be,children:[a.jsxs(zn,{className:"sm:max-w-[480px] w-[92vw] max-h-[85vh] h-[85vh] animate-none flex flex-col overflow-hidden",onOpenAutoFocus:_r=>_r.preventDefault(),onPointerDownOutside:_r=>{_r.preventDefault(),_r.stopPropagation()},onInteractOutside:_r=>{_r.preventDefault(),_r.stopPropagation()},onEscapeKeyDown:_r=>_r.preventDefault(),children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsx(Ln,{children:"Gerenciar Clientes da Mesa"}),a.jsx(ma,{children:"Gerencie os clientes vinculados a esta mesa."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 space-y-4 thin-scroll",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-sm font-medium text-text-primary",children:["Clientes vinculados (",Et.length,"):"]}),Et.length===0?a.jsx("div",{className:"p-4 text-center text-sm text-text-muted border border-dashed rounded-md",children:"Nenhum cliente vinculado ainda"}):a.jsx("div",{className:"space-y-2",children:Et.map(_r=>{const Br=_r.tipo==="livre",qr=Nn===_r.id;return a.jsx("div",{className:Pr("flex items-center gap-2 p-2 rounded-md border",Br?"bg-amber-500/10 border-amber-500/30":"bg-surface-2 border-border"),children:qr?a.jsxs(a.Fragment,{children:[a.jsx(It,{value:ds,onChange:Rr=>Xs(Rr.target.value),onKeyDown:Rr=>{Rr.key==="Enter"&&mr(),Rr.key==="Escape"&&(ua(null),Xs("")),Rr.stopPropagation()},className:"flex-1 h-8",autoFocus:!0}),a.jsx(Z,{size:"sm",onClick:mr,className:"h-8 px-2",children:a.jsx(Di,{className:"h-4 w-4"})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:Pr("flex-1 text-sm truncate p-1 rounded",Br?"cursor-pointer hover:bg-amber-500/10":"cursor-default"),onClick:()=>Br&&On(_r.id),title:Br?"Clique para editar":"",children:[a.jsx("span",{children:_r.nome}),Br&&a.jsx("span",{className:"ml-2 text-[11px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-600 border border-amber-500/30 align-middle",children:"Cliente Padro"})]}),!Br&&a.jsx(Z,{size:"sm",variant:"ghost",onClick:()=>{dn(_r.id),$r(!0)},className:"h-7 px-2",title:"Trocar cliente",children:a.jsx(fc,{className:"h-4 w-4"})}),a.jsx(Z,{size:"sm",variant:"ghost",onClick:()=>Vn(_r.id),className:"h-7 px-2 text-destructive hover:text-destructive",children:a.jsx(Hc,{className:"h-4 w-4"})})]})},_r.id)})})]}),a.jsxs(Z,{onClick:()=>{dn(null),$r(!0)},className:"w-full",size:"sm",children:[a.jsx(so,{className:"h-4 w-4 mr-2"}),"Adicionar Cliente"]})]}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>be(!1),disabled:sr,children:"Cancelar"}),a.jsx(Z,{onClick:Zr,disabled:sr,children:sr?"Salvando...":`Confirmar ${yr.size>0?`(${yr.size} alteraes)`:""}`})]})]}),a.jsx(Un,{open:Yr,onOpenChange:$r,children:a.jsxs(zn,{className:"sm:max-w-[500px] max-h-[80vh] flex flex-col",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:Dr?"Trocar Cliente":"Adicionar Cliente"}),a.jsx(ma,{children:"Selecione um cliente da lista"})]}),a.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar cliente...",className:"pl-9",value:ne,onChange:_r=>Ae(_r.target.value)})]}),a.jsx("div",{className:"flex-1 border rounded-md overflow-y-auto thin-scroll",role:"listbox","aria-label":"Clientes disponveis",ref:fr,tabIndex:0,children:sr?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Carregando..."}):Ee.length===0?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Nenhum cliente encontrado"}):a.jsx("ul",{className:"divide-y divide-border",children:Ee.map(_r=>{const Br=_r.codigo===0,qr=Et.some(Rr=>Rr.cliente_id===_r.id&&Rr.tipo==="cadastrado");return a.jsxs("li",{className:Pr("p-3 cursor-pointer transition-colors flex items-center justify-between",Br?"bg-amber-500/5 hover:bg-amber-500/10":"hover:bg-surface-2"),onClick:()=>{Br?Dr?(dn(null),$r(!1)):(Or(),$r(!1)):Dr?gn(Dr,_r.id):rn(_r.id)},children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"font-medium truncate flex items-center gap-2",children:[Br?"Cliente Consumidor":`${_r?.codigo?`${_r.codigo} - `:""}${_r?.nome||""}`,Br&&a.jsx("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-600 border border-amber-500/30",children:"Cliente Padro"})]}),!Br&&_r.telefone&&a.jsx("div",{className:"text-xs text-text-muted",children:_r.telefone}),Br&&a.jsx("div",{className:"text-xs text-text-muted",children:"Clique para adicionar consumidor"})]}),qr&&!Br&&a.jsx(Di,{className:"h-5 w-5 text-success ml-2 flex-shrink-0"})]},_r.id)})})})]}),a.jsx(Ga,{children:a.jsx(Z,{variant:"outline",onClick:()=>$r(!1),children:"Cancelar"})})]})})]})},Ht=()=>{const ne=Ae=>Ae==="available"?"bg-success/10 border-success/30 text-success":Ae==="in-use"?"bg-warning/10 border-warning/30 text-warning":Ae==="awaiting-payment"?"bg-info/10 border-info/30 text-info":"bg-surface-2 border-border text-text-secondary";return a.jsx("div",{className:"md:hidden space-y-2",children:s.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("div",{className:"text-text-muted mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhuma mesa encontrada"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Crie sua primeira mesa para comear"})]}):s.map(Ae=>{const Ee=Tn(Ae.order||[],Ae),it=Ae.totalHint>0?Ae.totalHint:Ee;return a.jsx("div",{onClick:async()=>{if(!c){e({title:"Caixa Fechado",description:"Abra o caixa antes de gerenciar as mesas.",variant:"warning"});return}await Nt(Ae),Ae.status!=="available"&&Gr(!0)},className:Pr("p-3 rounded-lg border-2 bg-surface transition-all active:scale-[0.98]",ne(Ae.status),i?.id===Ae.id&&"ring-2 ring-brand/60",c?"cursor-pointer":"cursor-not-allowed opacity-60"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("h3",{className:"font-bold text-base truncate",children:Ae.name||`Mesa ${Ae.number}`}),Ae.status==="available"&&Ae.id===jt&&a.jsx("kbd",{className:"hidden md:inline px-2 py-1 text-xs font-bold font-mono text-gray-400 bg-transparent border border-gray-300/50 rounded flex-shrink-0",children:"F1"})]})}),Ae.status==="in-use"||Ae.status==="awaiting-payment"?a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-text-secondary",children:[a.jsx(mc,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:Ie(Ae.customer)||"Sem cliente"})]}),a.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-semibold text-text-primary",children:[a.jsx(Wi,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsxs("span",{children:["R$ ",it.toFixed(2)]})]})]}):a.jsx("div",{className:"text-xs text-text-muted",children:"Mesa disponvel"})]}),a.jsx("div",{className:"w-12 flex items-center justify-center ml-1 mr-1",children:Ae.status==="available"?a.jsx("img",{src:"/mesalivre.png",alt:"Mesa livre",className:"w-10 h-10 object-contain opacity-80"}):a.jsx("img",{src:"/mesaocupada.png",alt:"Mesa ocupada",className:"w-10 h-10 object-contain opacity-80"})}),a.jsx(Kg,{className:"w-5 h-5 text-text-muted flex-shrink-0 ml-1"})]})},Ae.id)})})},Ur=()=>i?a.jsx(Un,{open:zr,modal:!B,onOpenChange:ne=>{qe||!ne&&B||(Gr(ne),ne||ce(null),ne&&A("tables"))},children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-2xl max-h-[85vh] flex flex-col p-0 gap-0 animate-none",children:[a.jsxs("div",{className:"p-4 border-b border-border bg-surface-2",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(Ln,{className:"text-xl font-bold",children:i.name||`Mesa ${i.number}`})}),a.jsx(ma,{className:"sr-only",children:"Visualizao da comanda e produtos da mesa selecionada"}),(i.status==="in-use"||i.status==="awaiting-payment")&&a.jsxs("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(mc,{className:"w-4 h-4"}),a.jsx("span",{children:Ie(i.customer)||"Sem cliente"})]}),i.order&&i.order.length>0&&a.jsxs("div",{className:"flex items-center gap-1 font-semibold text-text-primary",children:[a.jsx(Wi,{className:"w-4 h-4"}),a.jsxs("span",{children:["R$ ",(i.totalHint>0?i.totalHint:Tn(i.order||[])).toFixed(2)]})]})]})]}),a.jsxs(_d,{value:ha,onValueChange:ne=>{if(pn(ne),ce(null),ne==="products"&&i){w(!0);try{Gr(!1)}catch{}pn("order")}},className:"flex flex-col flex-1 min-h-0",children:[a.jsxs(xc,{className:"grid w-full grid-cols-3 m-2 rounded-lg",children:[a.jsx(Ya,{value:"order",className:"text-sm flex items-center justify-center gap-2",children:"Comanda"}),a.jsx(Ya,{value:"details",className:"text-sm flex items-center justify-center gap-2",children:"Detalhes"}),a.jsxs(Ya,{value:"products",className:"text-sm flex items-center justify-center gap-2",onClick:()=>{if(i){w(!0);try{Gr(!1)}catch{}}},children:["Produtos",a.jsx("kbd",{className:"hidden md:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"P"})]})]}),a.jsx(yo,{value:"order",className:"flex-1 overflow-hidden min-h-0 m-0",onKeyDown:ne=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(ne.key)&&A("tables")},children:a.jsx(zt,{table:i})}),a.jsx(yo,{value:"details",className:"flex-1 overflow-hidden min-h-0 m-0",children:a.jsx(st,{table:i})})]})]})}):null,mn=()=>{const ne=k,Ae=ne&&xt.get(ne.id)||0,Ee=ne?Number(ne.salePrice??ne.price??0):0,it=Et=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Et||0));return a.jsx(Un,{open:B,onOpenChange:Et=>{z(Et),Et||q(null)},children:a.jsxs(zn,{overlayClassName:"z-[70]",className:"sm:max-w-[420px] w-[92vw] max-h-[85vh] flex flex-col animate-none z-[71]",onOpenAutoFocus:Et=>{},onKeyDown:Et=>Et.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold break-words",title:ne?.name||"",children:ne?.name||"Produto"}),a.jsx(ma,{children:"Detalhes do produto e aes rpidas."})]}),ne?a.jsxs("div",{className:"space-y-3 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:it(Ee)})]}),ne.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:ne.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof ne.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:ne.stock})]}),typeof ne.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:ne.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",Ae]})]})]})]}):null,a.jsxs(Ga,{className:"flex items-center justify-between gap-2",children:[a.jsxs(Z,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{ne&&n("/produtos",{state:{productId:ne.id,productName:ne.name}})},children:[a.jsx(il,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(Z,{variant:"outline",onClick:()=>{z(!1),q(null)},children:"Fechar"}),a.jsx(Z,{onClick:async()=>{ne&&(await sn(ne),z(!1),q(null))},children:"Adicionar"})]})]})})};return a.jsxs(a.Fragment,{children:[a.jsx(mn,{}),a.jsx(Ji,{}),a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"md:hidden mb-2 w-full",children:a.jsx(_d,{value:"mesas",onValueChange:ne=>{ne==="mesas"&&n("/vendas"),ne==="balcao"&&n("/balcao"),ne==="historico"&&n("/historico")},children:a.jsxs(xc,{className:"grid w-full grid-cols-3",children:[a.jsx(Ya,{value:"mesas",className:"text-xs",title:"Pressione B para alternar",children:"Mesas"}),a.jsx(Ya,{value:"balcao",className:"text-xs",title:"Pressione B para alternar",children:"Balco"}),a.jsx(Ya,{value:"historico",className:"text-xs",title:"Pressione H para ir ao histrico",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center justify-between mb-2 md:mb-6 gap-2 md:gap-3 pr-2",children:[a.jsx("div",{className:"hidden md:flex items-center gap-2 md:gap-3",children:a.jsx(_d,{value:"mesas",onValueChange:ne=>{ne==="mesas"&&n("/vendas"),ne==="balcao"&&n("/balcao"),ne==="historico"&&n("/historico")},children:a.jsxs(xc,{className:"inline-flex",children:[a.jsx(Ya,{value:"mesas",className:"text-sm",title:"Pressione B para alternar",children:"Mesas"}),a.jsx(Ya,{value:"balcao",className:"text-sm",title:"Pressione B para alternar",children:"Balco"}),a.jsx(Ya,{value:"historico",className:"text-sm",title:"Pressione H para ir ao histrico",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[a.jsx(de,{}),a.jsx(Ue,{}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>g(!0),className:"px-2.5",children:[a.jsx(Y4,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Detalhes"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Detalhes do Caixa"}),a.jsx("kbd",{className:"ml-2 hidden lg:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F11"})]}),a.jsx("div",{className:"hidden md:block w-px h-6 bg-border mx-1"}),a.jsx(Z,{onClick:()=>ae(!0),className:"inline-flex h-9 w-9 p-0 items-center justify-center shrink-0",size:"icon",variant:"outline",title:"Gerenciar Mesas",children:a.jsx(Wc,{className:"h-4 w-4"})}),a.jsxs(Z,{onClick:()=>De(!0),className:"hidden md:flex px-3",size:"sm",children:[a.jsx(so,{className:"mr-2 h-4 w-4"})," Nova Mesa",a.jsx("kbd",{className:"ml-2 hidden lg:inline px-2 py-1 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"F1"})]})]})]}),!c&&u>0&&a.jsxs("div",{className:"md:hidden mb-3 text-[11px] text-warning flex items-center gap-2",children:[a.jsx(Pd,{className:"h-3 w-3"}),"H comandas abertas, mas o caixa parece fechado.",a.jsx(Z,{size:"sm",variant:"outline",className:"h-6 px-2 text-[11px]",onClick:()=>or(!0),children:"Reabrir sesso"})]}),a.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-visible min-h-0",children:[a.jsxs("div",{className:"lg:col-span-2 bg-surface rounded-lg border border-border p-4 md:p-6 overflow-y-auto thin-scroll min-h-0",tabIndex:0,onKeyDown:ne=>{S==="tables"&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(ne.key)&&ne.preventDefault()},onClick:ne=>{ne.stopPropagation(),ne.preventDefault(),A("tables"),!i&&s.length>0&&l(s[0]),ne.currentTarget.focus()},onFocus:()=>{A("tables"),!i&&s.length>0&&l(s[0])},style:{outline:S==="tables"?"2px solid rgba(148, 163, 184, 0.4)":"none",outlineOffset:"-2px",transition:"outline 0.15s ease"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 gap-4",children:[a.jsx("h2",{className:"text-xl font-bold",children:"Mapa de Mesas"}),a.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-text-muted flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:""}),a.jsx("span",{children:"Navegar"})]}),a.jsx("div",{className:"w-px h-3 bg-border"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"Enter"}),a.jsx("span",{children:"Selecionar"})]})]}),a.jsx(Z,{type:"button",className:"md:hidden h-9 w-9 p-0 bg-amber-400 text-black hover:bg-amber-300 flex-shrink-0",size:"icon",title:"Nova Mesa",onClick:()=>De(!0),children:a.jsx(so,{className:"h-5 w-5"})})]}),a.jsx(Ht,{}),a.jsx("div",{className:"hidden md:block",children:a.jsx(wat,{onDragEnd:oa,children:a.jsx(soe,{droppableId:"tables",children:ne=>a.jsxs("div",{...ne.droppableProps,ref:Ae=>{ne.innerRef(Ae),ir.current=Ae},role:"grid","aria-label":"Lista de mesas",className:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(240px,1fr))]",children:[s.length===0?a.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("div",{className:"text-text-muted mb-4",children:a.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),a.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhuma mesa encontrada"}),a.jsx("p",{className:"text-text-muted mb-4",children:"Crie sua primeira mesa para comear a receber pedidos"}),a.jsxs(Z,{onClick:()=>De(!0),className:"flex items-center gap-2",children:[a.jsx(so,{size:16}),"Criar Nova Mesa"]})]}):s.map((Ae,Ee)=>a.jsx(ast,{draggableId:Ae.id,index:Ee,children:(it,Et)=>a.jsx(Xe,{table:Ae,provided:it,isDragging:Et.isDragging})},Ae.id)),ne.placeholder]})})})})]}),a.jsx("div",{className:"hidden md:flex bg-surface rounded-lg border border-border flex-col min-h-0 transition-all overflow-hidden",style:{boxShadow:S==="panel"?"inset 0 0 0 2px rgba(148, 163, 184, 0.4)":"none"},children:a.jsxs(_d,{value:M,onValueChange:ne=>{O(ne),ne==="products"&&i&&(w(!0),O("order"))},className:"flex flex-col h-full",children:[a.jsxs(xc,{className:"grid w-full grid-cols-3 m-2",children:[a.jsx(Ya,{value:"order",className:"flex items-center justify-center gap-2 text-xs",children:"Comanda"}),a.jsx(Ya,{value:"details",className:"flex items-center justify-center gap-2 text-xs",children:"Detalhes"}),a.jsxs(Ya,{value:"products",onClick:()=>{i&&w(!0)},className:"flex items-center justify-center gap-2 text-xs",children:["Produtos",a.jsx("kbd",{className:"hidden md:inline px-1 py-0.5 text-[10px] font-bold font-mono text-white bg-gray-700 border border-gray-600 rounded",children:"P"})]})]}),a.jsx(yo,{value:"order",className:"flex-1 overflow-hidden min-h-0",children:a.jsx(zt,{table:i})}),a.jsx(yo,{value:"details",className:"flex-1 overflow-hidden min-h-0",children:a.jsx(st,{table:i})})]})})]})]}),a.jsx(Ur,{}),a.jsx(Zc,{}),a.jsx(fe,{open:x,onOpenChange:g,cashSummary:I}),a.jsx(kt,{}),a.jsx(Ve,{}),me?a.jsx(vt,{}):null,a.jsx(Ol,{}),a.jsx(pr,{}),a.jsx(en,{}),on&&a.jsx("div",{className:"fixed left-3 right-3 z-[9999]",role:"alert","aria-live":"assertive",style:{bottom:"calc(12px + env(safe-area-inset-bottom, 0px))"},children:a.jsxs("div",{className:"pointer-events-none flex items-start gap-2 rounded-md border border-amber-500 bg-amber-400 text-black px-3 py-2 shadow-lg",children:[a.jsx(Pd,{className:"h-4 w-4 mt-0.5","aria-hidden":"true"}),a.jsx("div",{className:"text-sm font-semibold leading-snug drop-shadow-[0_1px_0_rgba(255,255,255,0.25)]",children:ke||"Ateno"})]})}),lr&&a.jsx(xst,{item:lr,onApply:()=>{i&&Oe(i)},onClose:()=>{ce(null)},codigoEmpresa:t?.codigo_empresa}),!Ze&&i&&qe&&a.jsx(ioe,{comanda:{id:i.comandaId,desconto_tipo:i.desconto_tipo||null,desconto_valor:Number(i.desconto_valor||0),desconto_motivo:i.desconto_motivo||null},subtotal:(()=>{let ne=0,Ae=0;for(const Ee of i.order||[]){const it=(Ee.price||0)*(Ee.quantity||1);ne+=it,Ee.desconto_tipo==="percentual"&&Ee.desconto_valor>0?Ae+=it*(Ee.desconto_valor/100):Ee.desconto_tipo==="fixo"&&Ee.desconto_valor>0&&(Ae+=Ee.desconto_valor)}return Math.max(0,ne-Ae)})(),onApply:ne=>{(async()=>(ne&&l(Ae=>!Ae||Ae.comandaId!==ne.id?Ae:{...Ae,desconto_tipo:ne.desconto_tipo||null,desconto_valor:Number(ne.desconto_valor||0),desconto_motivo:ne.desconto_motivo||null}),i&&await Oe(i),ze(!1)))()},onClose:()=>ze(!1),codigoEmpresa:t?.codigo_empresa}),(ft||Lt||Bt)&&a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80",children:a.jsxs("div",{className:"px-8 py-6 rounded-xl bg-surface border border-border shadow-2xl flex flex-col items-center gap-4 max-w-sm w-[85vw] text-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-brand border-t-transparent animate-spin","aria-hidden":"true"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"block text-base font-semibold text-text-primary",children:ft?"Abrindo mesa...":Lt?"Cancelando comanda...":"Fechando conta..."}),a.jsx("span",{className:"block text-xs text-text-muted",children:ft?"Aguarde, estamos criando a comanda e sincronizando com os outros dispositivos.":Lt?"Aguarde, estamos cancelando a comanda e liberando a mesa em todos os dispositivos.":"Aguarde, estamos registrando os pagamentos e liberando a mesa em todos os dispositivos."})]})]})}),p.useMemo(()=>a.jsx(la,{},(i?.order||[]).map(ne=>`${String(ne.productId)}:${Number(ne.quantity||0)}`).join("|")),[b,i?.id,i?.order])]})}function bst(){const{toast:e}=Zs(),t=Il(),{userProfile:r}=lo(),[n,s]=p.useState(null),[o,i]=p.useState([]),[l,c]=p.useState([]),[d,u]=p.useState(!0),[f,h]=p.useState(!1),[m,x]=p.useState(!1),[g,v]=p.useState(!1),[y,b]=p.useState(""),[w,j]=p.useState(""),[_,C]=p.useState(null),[E,S]=p.useState(null),[A,M]=p.useState(!1),O=p.useRef(!1),[I,T]=p.useState(new Map),[k,q]=p.useState(!1),[B,z]=p.useState(!1),[F,V]=p.useState(!1),[me,be]=p.useState(!1),[U,L]=p.useState(null),[H,ie]=p.useState(!1),[Y,W]=p.useState(!1),[se,pe]=p.useState([]);p.useState(null);const[G,te]=p.useState(!1),[oe,De]=p.useState([]),[re,ae]=p.useState(1),[ut,pt]=p.useState([]),[ft,bt]=p.useState(!1),[Lt,Dt]=p.useState({tipo:null,valor:0,motivo:""}),[Bt,ge]=p.useState(null),[wt,Gt]=p.useState(null),[Sr,wr]=p.useState(!1),[he,ot]=p.useState(null),[Vt,qt]=p.useState(!1),[Re,Ct]=p.useState(""),[Wt,Er]=p.useState(!1),[Me,lt]=p.useState(""),[gt,or]=p.useState(()=>{try{return typeof window<"u"&&window.innerWidth<=640}catch{return!1}});p.useEffect(()=>{const J=()=>{try{or(typeof window<"u"&&window.innerWidth<=640)}catch{or(!1)}};return J(),window.addEventListener("resize",J),()=>window.removeEventListener("resize",J)},[]),p.useState("cadastrado");const[br,ur]=p.useState(""),[an,zr]=p.useState([]),[Gr,ha]=p.useState([]);p.useState(!1),p.useState(!1);const[pn,on]=p.useState(!1),[cn,ke]=p.useState(!1),[We,Ze]=p.useState(0),[Je,At]=p.useState("all"),[Ye,lr]=p.useState(()=>{try{return localStorage.getItem("balcao_sort_order")||"code"}catch{return"code"}}),ce=p.useRef([]),qe=p.useRef(null),[ze,xt]=p.useState(()=>{try{const J=localStorage.getItem("balcao_left_panel_width");return J?parseFloat(J):50}catch{return 50}}),[rr,ir]=p.useState(!1),Kr=p.useRef(null),jr=p.useRef(0),sa=p.useRef([]);p.useEffect(()=>{sa.current=l},[l]);const ia=p.useRef(!1);p.useEffect(()=>(ia.current=!0,()=>{ia.current=!1}),[]);const Kn=p.useRef(null),at=p.useRef(null),Te=p.useRef(null),Fe=p.useRef(null);p.useEffect(()=>{Fe.current=n},[n]),p.useEffect(()=>{const J=r?.codigo_empresa;if(!J)return;try{const fe=typeof window<"u"?window.localStorage.getItem("custom-auth-token"):null;if(fe&&fe.trim())Q.realtime.setAuth(fe.trim());else{let Ve="";try{Ve=(new URL(Q.supabaseUrl||"").host||"").split(".")[0]||""}catch{}const xe=Ve?`sb-${Ve}-auth-token`:"sb-auth-token",kt=typeof window<"u"?window.localStorage.getItem(xe):null;if(kt)try{const st=JSON.parse(kt),zt=st?.access_token||st?.currentSession?.access_token;zt&&Q.realtime.setAuth(zt)}catch{}}}catch{}const Xe=Q.channel(`loja:${J}`),He=async fe=>{const Ve=fe?.table||fe?.table_name||"",xe=fe?.new||fe?.old||{},kt=fe?.eventType||fe?.type||fe?.event||"";try{if(Ve==="comanda_itens"){const st=fe?.new?.comanda_id||fe?.old?.comanda_id||xe?.comanda_id||null;if(st){const zt=Fe.current;if(zt&&String(zt)===String(st)){try{await ee(zt,2)}catch{}try{const pr=await Ph({codigoEmpresa:J}),en=new Map;for(const sn of pr||[])en.set(sn.produto_id,(en.get(sn.produto_id)||0)+Number(sn.quantidade||0));T(en)}catch{}return}try{const pr=await Tv({codigoEmpresa:J});if(pr?.id&&String(pr.id)===String(st)){s(pr.id);try{await ee(pr.id,2)}catch{}try{const en=await Ph({codigoEmpresa:J}),sn=new Map;for(const la of en||[])sn.set(la.produto_id,(sn.get(la.produto_id)||0)+Number(la.quantidade||0));T(sn)}catch{}return}}catch{}}}if(Ve==="comanda_clientes"){const st=fe?.new?.comanda_id||fe?.old?.comanda_id||xe?.comanda_id||null;if(st&&Fe.current&&String(Fe.current)===String(st)){try{await ee(st,2)}catch{}return}}if(Ve==="comandas"){const st=xe?.mesa_id,zt=xe?.id||fe?.old?.id||null,pr=String(xe?.status||"").toLowerCase(),en=String(kt||"").toUpperCase()==="DELETE"||pr.includes("fechad")||pr.includes("closed")||pr.includes("encerr"),sn=String(kt||"").toUpperCase()==="INSERT";if(en&&st==null&&Fe.current&&zt&&String(Fe.current)===String(zt)){c([]),s(null),ha([]),b(""),ke(!1);try{localStorage.removeItem(Tn.comandaId),localStorage.removeItem(Tn.items),localStorage.removeItem(Tn.customerName),localStorage.removeItem(Tn.pendingClientIds),localStorage.removeItem(Tn.clientChosen)}catch{}}if(sn&&st==null&&["open","awaiting-payment","awaiting_payment"].includes(pr)){s(zt);try{await ee(zt,2)}catch{}}}}catch{}if(at.current)try{clearTimeout(at.current)}catch{}at.current=setTimeout(async()=>{const st=Fe.current;if(st)try{await ee(st,2)}catch{}else try{const zt=await Tv({codigoEmpresa:J});if(zt?.id){s(zt.id);try{await ee(zt.id,2)}catch{}}}catch{}},250)};if(Xe.on("postgres_changes",{event:"*",schema:"public",table:"comandas",filter:`codigo_empresa=eq.${J}`},He).on("postgres_changes",{event:"*",schema:"public",table:"comanda_itens"},He).on("postgres_changes",{event:"*",schema:"public",table:"comanda_clientes"},He).subscribe(),Kn.current=Xe,Te.current)try{clearInterval(Te.current)}catch{}return Te.current=setInterval(async()=>{const fe=Fe.current;if(fe)try{await ee(fe,1)}catch{}else try{const Ve=await Tv({codigoEmpresa:J});if(Ve?.id){s(Ve.id);try{await ee(Ve.id,1)}catch{}}}catch{}},6e4),()=>{if(Kn.current){try{Q.removeChannel(Kn.current)}catch{}Kn.current=null}if(at.current){try{clearTimeout(at.current)}catch{}at.current=null}if(Te.current){try{clearInterval(Te.current)}catch{}Te.current=null}}},[r?.codigo_empresa]),p.useEffect(()=>{(l||[]).length>0&&(O.current=!0)},[l]),p.useEffect(()=>{n&&O.current&&(l||[]).length===0&&ee(n,2)},[n,l?.length]),p.useEffect(()=>{if(H)return;let J=!0;return(async()=>{try{const Xe=await $h({codigoEmpresa:r?.codigo_empresa});J&&q(!!Xe)}catch{J&&q(!1)}})(),()=>{J=!1}},[r?.codigo_empresa,H]);const cr=async()=>{const J=r?.codigo_empresa||null;try{if(!J)return;be(!0);const[Xe,He]=await Promise.all([P1({codigoEmpresa:J}).catch(()=>null),$h({codigoEmpresa:J}).catch(()=>null)]);if(!He?.id){L(null);return}let fe=0,Ve=0,xe=[];try{xe=await Fg({caixaSessaoId:He.id,codigoEmpresa:J}),fe=(xe||[]).filter(st=>String(st?.tipo||"").toLowerCase()==="sangria").reduce((st,zt)=>st+Number(zt?.valor||0),0),Ve=(xe||[]).filter(st=>String(st?.tipo||"").toLowerCase()==="suprimento").reduce((st,zt)=>st+Number(zt?.valor||0),0)}catch{}const kt={saldo_inicial:He.saldo_inicial||0,totalPorFinalizadora:Xe?.totalPorFinalizadora||Xe?.porFinalizadora||{},totalEntradas:Xe?.totalEntradas||Xe?.entradas||0,totalSangria:fe,totalSuprimento:Ve,totalSaidas:fe,sessaoId:He.id,movimentacoes:xe};L(kt)}catch{L(null)}finally{be(!1)}};p.useEffect(()=>{let J=!0;return(async()=>{try{if(!Y||!n)return;const He=r?.codigo_empresa;let fe=[];try{const kt=await nl({comandaId:n,codigoEmpresa:He});fe=(Array.isArray(kt)?kt:[]).map(zt=>{const pr=zt?.clientes?.id??zt?.cliente_id??zt?.id??null,en=zt?.clientes?.nome??zt?.nome??zt?.nome_livre??"";return pr?{id:pr,nome:en}:null}).filter(Boolean)}catch{fe=[]}if(!J)return;pt(fe);const xe=Array.isArray(Gr)&&Gr.length>0?Gr:fe.map(kt=>kt.id);if(!Array.isArray(xe)||xe.length===0)return;De(kt=>{let st=kt&&kt.length?[...kt]:[{id:1,clientId:xe[0],methodId:se[0]?.id||"",value:""}];st[0]||(st[0]={id:1,clientId:xe[0],methodId:se[0]?.id||"",value:""}),st[0].clientId=xe[0];const zt=new Set([st[0].clientId].filter(Boolean));for(let pr=1;pr<st.length;pr++){if(!st[pr].clientId||zt.has(st[pr].clientId)){const en=(xe||[]).find(sn=>!zt.has(sn));st[pr].clientId=en||xe[0]}zt.add(st[pr].clientId)}return st})}catch{}})(),()=>{J=!1}},[Y,Gr,n,r?.codigo_empresa]),p.useEffect(()=>{let J=!0;return(async()=>{try{if(!Y||!n)return;const{data:He}=await Q.from("comandas").select("desconto_tipo, desconto_valor, desconto_motivo").eq("id",n).single();if(!J)return;Dt({tipo:He?.desconto_tipo||null,valor:Number(He?.desconto_valor||0),motivo:He?.desconto_motivo||""})}catch{J&&Dt({tipo:null,valor:0,motivo:""})}})(),()=>{J=!1}},[Y,n]);const ht=J=>{const Xe=String(J||"").replace(/\D/g,"");return Xe?Number(Xe)/100:0},Xr=J=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(J),Ft=J=>(se||[]).find(Xe=>String(Xe.id)===String(J)),kr=J=>Number(Ft(J.methodId)?.taxa_percentual||0),jt=J=>{const Xe=ht(J.value),He=kr(J);return!J.chargeFee||!He?Xe:Xe/(1+He/100)},er=J=>{const Xe=jt(J),He=kr(J);return!J.chargeFee||!He||Xe<=0?0:Xe*(He/100)},Nt=(J,Xe)=>{const He=kr(J);if(J.chargeFee&&He>0){const fe=Xe*(1+He/100);return{...J,value:Xr(fe)}}return{...J,value:Xr(Xe)}},Cr=()=>(oe||[]).reduce((J,Xe)=>J+jt(Xe),0),Lr=()=>(oe||[]).reduce((J,Xe)=>J+er(Xe),0),un=()=>Cr()+Lr();p.useEffect(()=>{try{if(!Y)return;let J=0;try{J=(l||[]).reduce((st,zt)=>st+Number(zt.quantity||0)*Number(zt.price||0),0)}catch{}const Xe=Lt?.tipo,He=Number(Lt?.valor||0);let fe=0;Xe==="percentual"&&He>0?fe=J*(He/100):Xe==="fixo"&&He>0&&(fe=He);const Ve=Math.max(0,J-fe),xe=Cr(),kt=Ve-xe;Math.abs(kt)>.009&&Math.abs(kt)<=.05&&Array.isArray(oe)&&oe.length>0&&De(st=>st.map((zt,pr,en)=>{if(pr!==en.length-1)return zt;const sn=jt(zt)+kt;return Nt(zt,sn)}))}catch{}},[oe,Y]);const ra=async()=>{try{if(v(!0),!n){e({title:"Nenhuma comanda aberta",description:"Adicione itens para abrir uma comanda.",variant:"warning"});return}const J=r?.codigo_empresa;if(!J){e({title:"Empresa no definida",variant:"destructive"});return}try{const{data:zt,error:pr}=await Q.from("comandas").select("id").eq("id",n).eq("codigo_empresa",J).single();if(pr||!zt){console.error("[confirmPay] Comanda no encontrada no banco:",n),e({title:"Comanda invlida",description:"A comanda no existe mais. Criando nova comanda...",variant:"warning"}),s(null),c([]);try{localStorage.removeItem(Tn.comandaId),localStorage.removeItem(Tn.items)}catch{}await Ie();return}}catch(zt){console.error("[confirmPay] Erro ao validar comanda:",zt),e({title:"Erro de validao",description:"No foi possvel validar a comanda.",variant:"destructive"});return}if(!Array.isArray(oe)||oe.length===0){e({title:"Informe os pagamentos",description:"Adicione pelo menos uma forma de pagamento.",variant:"warning"});return}for(const zt of oe){if(!zt.methodId){e({title:"Forma de pagamento faltando",description:"Selecione a finalizadora em todas as linhas.",variant:"warning"});return}if(!String(zt.value||"").replace(/\D/g,"")){e({title:"Valor invlido",description:"Informe valores maiores que zero.",variant:"warning"});return}}let Xe=0;try{Xe=(await ci({comandaId:n,codigoEmpresa:J})||[]).reduce((pr,en)=>pr+Number(en.quantidade||0)*Number(en.preco_unitario||0),0)}catch{}const He=Lt?.tipo,fe=Number(Lt?.valor||0);let Ve=0;He==="percentual"&&fe>0?Ve=Xe*(fe/100):He==="fixo"&&fe>0&&(Ve=fe);const xe=Math.max(0,Xe-Ve),kt=Cr(),st=Math.abs(kt-xe);if(st>.009&&st<=.05){const zt=xe-kt;De(pr=>pr.map((en,sn,la)=>{if(sn!==la.length-1)return en;const Nr=jt(en)+zt;return Nt(en,Nr)}))}else if(st>.05){const zt=xe-kt;zt>0?e({title:"Valor insuficiente",description:`Faltam R$ ${zt.toFixed(2)} para fechar o total.`,variant:"warning"}):e({title:"Valor excedente",description:`Excedeu em R$ ${Math.abs(zt).toFixed(2)}. Ajuste os valores.`,variant:"warning"});return}te(!0),await bm({codigoEmpresa:J});for(const zt of oe){const pr=ht(zt.value),en=se.find(la=>String(la.id)===String(zt.methodId)),sn=en?.nome||en?.tipo||"outros";await PR({comandaId:n,finalizadoraId:zt.methodId,metodo:sn,valor:pr,status:"Pago",codigoEmpresa:J,clienteId:zt.clientId||null})}await U0({comandaId:n,codigoEmpresa:J}),s(null),c([]),ha([]),b(""),ke(!1),De([]);try{localStorage.removeItem(Tn.comandaId),localStorage.removeItem(Tn.items),localStorage.removeItem(Tn.customerName)}catch{}e({title:"Pagamento concludo",description:`Total R$ ${xe.toFixed(2)}`,variant:"success"}),W(!1)}catch(J){e({title:"Falha ao concluir",description:J?.message||"Tente novamente",variant:"destructive"})}finally{te(!1),v(!1)}};p.useEffect(()=>{(async()=>{try{if(!B)return;await cr()}catch{}})()},[B,r?.codigo_empresa]);const Wn=()=>{const[J,Xe]=p.useState(""),He=p.useRef(null);return p.useEffect(()=>{if(typeof window<"u"&&window.innerWidth<=640)return;const Ve=setTimeout(()=>{try{He.current?.focus()}catch{}},0);return()=>clearTimeout(Ve)},[]),a.jsxs(a.Fragment,{children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Abrir Caixa"}),a.jsx(su,{children:"Insira o valor inicial (suprimento) para abrir o caixa."})]}),a.jsxs("div",{className:"py-4",children:[a.jsx(ct,{className:"mb-2 block",htmlFor:"open-cash-initial",children:"Saldo inicial"}),a.jsx(It,{id:"open-cash-initial",ref:He,type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:J,onChange:fe=>{const Ve=(fe.target.value||"").replace(/\D/g,""),xe=Ve?Number(Ve)/100:0,kt=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(xe);Xe(kt)},onKeyDown:fe=>{fe.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(fe.key)&&(/^[0-9]$/.test(fe.key)||fe.preventDefault())},onBeforeInput:fe=>{const Ve=fe.data??"";Ve&&/\D/.test(Ve)&&fe.preventDefault()}}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Digite nmeros; a mscara formata em reais automaticamente."})]}),a.jsxs(nu,{children:[a.jsx(ou,{onClick:()=>V(!1),children:"Cancelar"}),a.jsx(Ku,{onClick:async()=>{try{const fe=String(J||"").replace(/\D/g,""),Ve=fe?Number(fe)/100:0;await bm({saldoInicial:Ve,codigoEmpresa:r?.codigo_empresa}),q(!0),V(!1),e({title:"Caixa aberto com sucesso!",variant:"success"})}catch(fe){e({title:"Falha ao abrir caixa",description:fe?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar Abertura"})]})]})},ln=()=>a.jsxs(Gu,{open:F,onOpenChange:V,children:[a.jsx(_g,{asChild:!0,children:a.jsxs(Z,{variant:"success",size:"sm",disabled:k,onClick:()=>V(!0),className:"px-3",children:[a.jsx(SG,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Abrir"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Abrir Caixa"})]})}),a.jsx(tu,{className:"sm:max-w-[425px] w-[92vw] animate-none",onKeyDown:J=>J.stopPropagation(),onEscapeKeyDown:J=>{J.preventDefault(),J.stopPropagation()},onPointerDownOutside:J=>{J.preventDefault(),J.stopPropagation()},onFocusOutside:J=>{J.preventDefault(),J.stopPropagation()},onInteractOutside:J=>{J.preventDefault(),J.stopPropagation()},onOpenAutoFocus:J=>{J.preventDefault()},onCloseAutoFocus:J=>{J.preventDefault()},children:a.jsx(Wn,{})})]}),da=()=>{const[J,Xe]=p.useState({loading:!1,saldoInicial:0,resumo:null}),[He,fe]=p.useState(!1),[Ve,xe]=p.useState(""),[kt,st]=p.useState(!1),zt=async()=>{try{Xe({loading:!0,saldoInicial:0,resumo:null});const xn=await $h({codigoEmpresa:r?.codigo_empresa}),Dn=await P1({codigoEmpresa:r?.codigo_empresa});Xe({loading:!1,saldoInicial:Number(xn?.saldo_inicial||0),resumo:Dn||{totalPorFinalizadora:{}}})}catch{Xe({loading:!1,saldoInicial:0,resumo:{totalPorFinalizadora:{}}})}},pr=J?.resumo?.totalPorFinalizadora||{},en=Object.values(pr).reduce((xn,Dn)=>xn+Number(Dn||0),0),sn=Number(J.saldoInicial||0)+en,la=Number(U?.totalSuprimento||0),Nr=Number(U?.totalSangria||0);return a.jsxs(Gu,{open:H,onOpenChange:xn=>{xn&&(ie(!0),st(!1),zt())},children:[a.jsx(_g,{asChild:!0,children:a.jsxs(Z,{variant:"destructive",size:"sm",disabled:!k,onClick:()=>{ie(!0)},className:"px-3",children:[a.jsx(d0,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2",children:"Fechar Caixa"})]})}),a.jsxs(tu,{className:"sm-max-w-[425px] animate-none",onKeyDown:xn=>xn.stopPropagation(),onEscapeKeyDown:xn=>{xn.preventDefault(),xn.stopPropagation()},onPointerDownOutside:xn=>{xn.preventDefault(),xn.stopPropagation()},onFocusOutside:xn=>{xn.preventDefault(),xn.stopPropagation()},onInteractOutside:xn=>{xn.preventDefault(),xn.stopPropagation()},onOpenAutoFocus:xn=>{xn.preventDefault()},onCloseAutoFocus:xn=>{xn.preventDefault()},children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Fechar Caixa"}),a.jsx(su,{children:"Confira os valores e confirme o fechamento do caixa. Esta ao  irreversvel."})]}),He&&a.jsxs("div",{className:"md:hidden mb-2 text-[12px] text-warning bg-warning/10 border border-warning/30 rounded px-2 py-1 flex items-center gap-1",children:[a.jsx(Pd,{className:"h-3.5 w-3.5"}),"Existem comandas abertas. Finalize-as antes de fechar o caixa."]}),J.loading?a.jsx("div",{className:"py-4 text-text-muted",children:"Carregando resumo"}):a.jsx("div",{className:"py-4 space-y-2",children:kt?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(J.saldoInicial||0).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Final"})," ",a.jsx("span",{className:"font-mono",children:(()=>{const xn=String(Ve||"").replace(/\D/g,""),Dn=xn?Number(xn)/100:0;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Dn)})()})]})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx(ct,{className:"mb-1 block",children:"Saldo Final (opcional)"}),a.jsx(It,{type:"text",inputMode:"numeric",placeholder:"0,00",value:Ve,onChange:xn=>{const Dn=(xn.target.value||"").replace(/\D/g,""),Pa=Dn?Number(Dn)/100:0,Aa=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Pa);xe(Aa)},onKeyDown:xn=>{xn.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(xn.key)&&(/^[0-9]$/.test(xn.key)||xn.preventDefault())},onBeforeInput:xn=>{const Dn=xn.data??"";Dn&&/\D/.test(Dn)&&xn.preventDefault()}})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mb-1",children:"Resumo"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor Inicial"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(J.saldoInicial||0).toFixed(2)]})]}),Object.keys(pr).length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos nesta sesso."}):a.jsx("div",{className:"space-y-1",children:Object.entries(pr).map(([xn,Dn])=>a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:String(xn)})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Number(Dn||0).toFixed(2)]})]},xn))}),a.jsx("div",{className:"my-2 h-px bg-border"}),a.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mb-1",children:"Conferncia"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Suprimentos"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",la.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Sangrias"})," ",a.jsxs("span",{className:"font-mono",children:["R$ ",Nr.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between font-medium text-base",children:[a.jsx("span",{className:"text-text-secondary",children:"Total em Caixa"})," ",a.jsxs("span",{className:"font-mono text-success",children:["R$ ",Number(sn||0).toFixed(2)]})]})]})}),a.jsx(nu,{children:kt?a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:()=>st(!1),children:"Voltar"}),a.jsx(Z,{onClick:async()=>{try{try{const Pa=await yd({codigoEmpresa:r?.codigo_empresa});if(Array.isArray(Pa)&&Pa.length>0){gt?(fe(!0),e({title:"Fechamento bloqueado",description:`Existem ${Pa.length} comandas abertas. Feche todas antes de encerrar o caixa.`,variant:"warning"})):e({title:"Fechamento bloqueado",description:`Existem ${Pa.length} comandas abertas. Feche todas antes de encerrar o caixa.`,variant:"warning",duration:2500});return}}catch{}const xn=String(Ve||"").replace(/\D/g,""),Dn=xn?Number(xn)/100:0;await lne({codigoEmpresa:r?.codigo_empresa,valorFinalDinheiro:Dn}),q(!1),ie(!1),e({title:"Caixa fechado!",description:"Fechamento registrado com sucesso.",variant:"success"})}catch(xn){e({title:"Falha ao fechar caixa",description:xn?.message||"Tente novamente",variant:"destructive"})}},children:"Fechar Caixa"})]}):a.jsxs(a.Fragment,{children:[a.jsx(ou,{onClick:()=>ie(!1),children:"Cancelar"}),a.jsx(Z,{onClick:()=>st(!0),children:"Confirmar Fechamento"})]})})]})]})},va=()=>{const J=Hn=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Hn||0)),[Xe,He]=p.useState(!1),[fe,Ve]=p.useState(!1),[xe,kt]=p.useState(""),[st,zt]=p.useState(""),[pr,en]=p.useState(!1),sn=async()=>{try{en(!0);const Hn=String(xe||"").replace(/\D/g,""),as=Hn?Number(Hn)/100:0;if(as<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await bm({codigoEmpresa:r?.codigo_empresa}),await u3({tipo:"sangria",valor:as,observacao:st,codigoEmpresa:r?.codigo_empresa}),He(!1),kt(""),zt(""),await cr(),e({title:"Sangria registrada",variant:"success"})}catch(Hn){e({title:"Falha ao registrar sangria",description:Hn?.message||"Tente novamente",variant:"destructive"})}finally{en(!1)}},[la,Nr]=p.useState(""),[xn,Dn]=p.useState(""),[Pa,Aa]=p.useState(!1),Na=async()=>{try{Aa(!0);const Hn=String(la||"").replace(/\D/g,""),as=Hn?Number(Hn)/100:0;if(as<=0){e({title:"Valor invlido",description:"Informe um valor positivo.",variant:"warning"});return}await bm({codigoEmpresa:r?.codigo_empresa}),await u3({tipo:"suprimento",valor:as,observacao:xn,codigoEmpresa:r?.codigo_empresa}),Ve(!1),Nr(""),Dn(""),await cr(),e({title:"Suprimento registrado",variant:"success"})}catch(Hn){e({title:"Falha ao registrar suprimento",description:Hn?.message||"Tente novamente",variant:"destructive"})}finally{Aa(!1)}};return a.jsx(Un,{open:B,onOpenChange:z,children:a.jsxs(zn,{className:"sm:max-w-lg w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden",onKeyDown:Hn=>Hn.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),a.jsx(ma,{children:me?"Carregando resumo...":U?"Resumo da sesso atual do caixa.":"Nenhuma sesso de caixa aberta."})]}),U?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex-1 overflow-y-auto pr-1",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Saldo Inicial"}),a.jsx("div",{className:"text-base md:text-lg font-bold tabular-nums leading-tight",children:J(U.saldo_inicial)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Entradas"}),a.jsx("div",{className:"text-base md:text-lg font-bold text-success tabular-nums leading-tight",children:J(U.totalEntradas)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Sadas"}),a.jsx("div",{className:"text-base md:text-lg font-bold text-danger tabular-nums leading-tight",children:J(U.totalSangria)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border text-center",children:[a.jsx("div",{className:"text-[12px] text-text-secondary whitespace-nowrap mb-1",children:"Saldo Atual"}),a.jsx("div",{className:"text-base md:text-lg font-bold tabular-nums leading-tight",children:J((U.saldo_inicial||0)+(U.totalEntradas||0)-(U.totalSangria||0))})]})]}),a.jsxs("div",{className:"mt-5",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h4",{className:"text-sm font-semibold text-text-secondary",children:"Totais por Finalizadora"})}),Object.keys(U.totalPorFinalizadora||{}).length===0?a.jsx("div",{className:"p-3 text-sm text-text-muted border rounded-md",children:"Nenhuma finalizadora registrada ainda."}):a.jsx("ul",{className:"rounded-md border border-border overflow-hidden divide-y divide-border",children:Object.entries(U.totalPorFinalizadora||{}).map(([Hn,as])=>a.jsxs("li",{className:"bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:String(Hn)}),a.jsx("span",{className:"text-sm font-semibold tabular-nums",children:J(as)})]},Hn))}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Suprimentos"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-success",children:J(U.totalSuprimento||0)})]}),a.jsxs("div",{className:"mt-2 rounded-md border border-border bg-surface px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate pr-3",children:"Sangrias"}),a.jsx("span",{className:"text-sm font-semibold tabular-nums text-danger",children:J(U.totalSangria||0)})]})]})]}),a.jsxs(Ga,{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"mr-auto"}),a.jsx(Z,{variant:"outline",onClick:()=>Ve(!0),children:"Registrar Suprimento"}),a.jsx(Z,{variant:"destructive",onClick:()=>He(!0),children:"Registrar Sangria"}),a.jsx(Z,{variant:"secondary",onClick:()=>z(!1),children:"Fechar"})]}),a.jsx(Un,{open:fe,onOpenChange:Ve,children:a.jsxs(zn,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Hn=>Hn.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold",children:"Registrar Suprimento"}),a.jsx(ma,{children:"Informe o valor de entrada no caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"flex-1 flex flex-col space-y-3",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"r-valor",children:"Valor"}),a.jsx(It,{id:"r-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:la,onChange:Hn=>{const as=(Hn.target.value||"").replace(/\D/g,""),to=as?Number(as)/100:0,As=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(to);Nr(As)},onKeyDown:Hn=>{Hn.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Hn.key)&&(/^[0-9]$/.test(Hn.key)||Hn.preventDefault())},onBeforeInput:Hn=>{const as=Hn.data??"";as&&/\D/.test(as)&&Hn.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"r-obs",children:"Observao"}),a.jsx(It,{id:"r-obs",placeholder:"Opcional",value:xn,onChange:Hn=>Dn(Hn.target.value)})]})]}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>Ve(!1),disabled:Pa,children:"Cancelar"}),a.jsx(Z,{onClick:Na,disabled:Pa,children:Pa?"Registrando...":"Confirmar"})]})]})}),a.jsx(Un,{open:Xe,onOpenChange:He,children:a.jsxs(zn,{className:"sm:max-w-sm w-[92vw] max-h-[85vh] animate-none",onKeyDown:Hn=>Hn.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold",children:"Registrar Sangria"}),a.jsx(ma,{children:"Informe o valor a retirar do caixa e, opcionalmente, uma observao."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"s-valor",children:"Valor"}),a.jsx(It,{id:"s-valor",type:"text",inputMode:"numeric",autoComplete:"off",placeholder:"0,00",value:xe,onChange:Hn=>{const as=(Hn.target.value||"").replace(/\D/g,""),to=as?Number(as)/100:0,As=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(to);kt(As)},onKeyDown:Hn=>{Hn.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Hn.key)&&(/^[0-9]$/.test(Hn.key)||Hn.preventDefault())},onBeforeInput:Hn=>{const as=Hn.data??"";as&&/\D/.test(as)&&Hn.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"s-obs",children:"Observao"}),a.jsx(It,{id:"s-obs",placeholder:"Opcional",value:st,onChange:Hn=>zt(Hn.target.value)})]})]}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>He(!1),disabled:pr,children:"Cancelar"}),a.jsx(Z,{onClick:sn,disabled:pr,children:pr?"Registrando...":"Confirmar"})]})]})})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma sesso de caixa aberta."})]})})},oa=r?.codigo_empresa||"anon",Tn={comandaId:`balcao:comandaId:${oa}`,items:`balcao:items:${oa}`,customerName:`balcao:customer:${oa}`,clientChosen:`balcao:clientChosen:${oa}`,pendingClientIds:`balcao:pendingClientIds:${oa}`,missCount:`balcao:missCount:${oa}`,lastMissTs:`balcao:lastMissTs:${oa}`},ee=async(J,Xe=3)=>{if(!J)return;const He=r?.codigo_empresa,fe=++jr.current;for(let Ve=0;Ve<Xe;Ve++)try{const xe=await ci({comandaId:J,codigoEmpresa:He});if(fe!==jr.current)return;const kt=(xe||[]).map(st=>({id:st.id,productId:st.produto_id,name:st.descricao||"Item",price:Number(st.preco_unitario||0),quantity:Number(st.quantidade||1)}));c(kt);try{const st=await nl({comandaId:J,codigoEmpresa:He});if(fe!==jr.current)return;const zt=(st||[]).map(sn=>sn?.nome).filter(Boolean),pr=zt.length?zt.join(", "):"";b(pr),ke(!!pr);const en=Array.from(new Set((st||[]).map(sn=>sn?.cliente_id).filter(Boolean)));en.length>0&&ha(en)}catch{b(""),ke(!1)}break}catch(xe){if(Ve===Xe-1)e({title:"Falha ao atualizar itens",description:xe?.message||"Tente novamente",variant:"destructive"});else{const kt=350*(Ve+1),st=Math.floor(Math.random()*120);await new Promise(zt=>setTimeout(zt,kt+st))}}},Ie=async()=>{try{u(!0);let J=setTimeout(()=>{ia.current&&u(!1)},1e4);const Xe=r?.codigo_empresa;if(!Xe){ia.current&&u(!1);return}try{const xe=localStorage.getItem(Tn.comandaId),kt=JSON.parse(localStorage.getItem(Tn.items)||"[]"),st=localStorage.getItem(Tn.customerName)||"",zt=localStorage.getItem(Tn.clientChosen),pr=JSON.parse(localStorage.getItem(Tn.pendingClientIds)||"[]");xe&&s(Number.isNaN(+xe)?xe:Number(xe)),Array.isArray(kt)&&kt.length>0&&c(kt),st&&b(st),zt==="true"&&ke(!0),Array.isArray(pr)&&pr.length>0&&ha(pr)}catch{}const He=localStorage.getItem(Tn.comandaId),fe=He?Number.isNaN(+He)?He:Number(He):null,Ve=await Tv({codigoEmpresa:Xe}).catch(()=>null);if(Ve?.id)s(Ve.id),await ee(Ve.id);else if(fe)s(fe),await ee(fe,3);else{let xe=0,kt=0;try{xe=Number(localStorage.getItem(Tn.missCount)||"0"),kt=Number(localStorage.getItem(Tn.lastMissTs)||"0")}catch{}const st=Date.now(),pr=st-kt<9e4?xe+1:1;try{localStorage.setItem(Tn.missCount,String(pr)),localStorage.setItem(Tn.lastMissTs,String(st))}catch{}try{const en=localStorage.getItem(Tn.customerName)||"",sn=localStorage.getItem(Tn.clientChosen)==="true",la=JSON.parse(localStorage.getItem(Tn.pendingClientIds)||"[]");b(en||""),ke(!!sn),ha(Array.isArray(la)?la:[])}catch{}if(s(null),pr>=2){c([]);try{localStorage.removeItem(Tn.comandaId),localStorage.removeItem(Tn.items)}catch{}}else try{const en=JSON.parse(localStorage.getItem(Tn.items)||"[]");Array.isArray(en)&&en.length>0&&c(en)}catch{}}try{const xe=await uf({includeInactive:!1,search:w?.trim()||void 0,codigoEmpresa:Xe});ia.current&&i(xe||[])}catch{i([])}clearTimeout(J)}catch(J){e({title:"Falha ao carregar Modo Balco",description:J?.message||"Tente novamente",variant:"destructive"})}finally{ia.current&&u(!1)}},Oe=async()=>{try{M(!0),x(!0);const J=r?.codigo_empresa;if(n&&J)try{try{await Q.from("comanda_itens").delete().eq("comanda_id",n).eq("codigo_empresa",J)}catch{}try{await Q.from("comanda_clientes").delete().eq("comanda_id",n).eq("codigo_empresa",J)}catch{}await Q.from("comandas").delete().eq("id",n).eq("codigo_empresa",J)}catch{}}finally{s(null),c([]),ha([]),b(""),ke(!1),S(null);try{localStorage.removeItem(Tn.comandaId),localStorage.removeItem(Tn.items),localStorage.removeItem(Tn.customerName)}catch{}M(!1),e({title:"Venda cancelada",variant:"success"}),x(!1)}};p.useEffect(()=>{let J=!1;(async()=>{await Ie(),!J&&ia.current&&!n&&(sa.current||[]).length===0&&(J=!0,setTimeout(()=>{ia.current&&Ie()},700))})()},[r?.codigo_empresa]),p.useEffect(()=>{try{n&&localStorage.setItem(Tn.comandaId,String(n)),localStorage.setItem(Tn.items,JSON.stringify(l||[])),localStorage.setItem(Tn.customerName,y||""),localStorage.setItem(Tn.clientChosen,cn?"true":"false"),n?localStorage.removeItem(Tn.pendingClientIds):localStorage.setItem(Tn.pendingClientIds,JSON.stringify(Gr||[]))}catch{}},[n,l,y,cn,Gr]),p.useEffect(()=>{const J=()=>{n&&ee(n,2)},Xe=()=>{document.visibilityState==="visible"&&n&&ee(n,2)};return window.addEventListener("focus",J),document.addEventListener("visibilitychange",Xe),()=>{window.removeEventListener("focus",J),document.removeEventListener("visibilitychange",Xe)}},[n]),p.useEffect(()=>{const J=Xe=>{const He=Xe.target;if(!(He&&(He.tagName==="INPUT"||He.tagName==="TEXTAREA"))){if(Xe.key==="p"||Xe.key==="P"){Xe.preventDefault(),qe.current?.focus();return}if((Xe.key==="c"||Xe.key==="C")&&k&&cn){Xe.preventDefault(),on(!0);return}if(Xe.key==="Escape"){if(Vt){qt(!1);return}if(pn){on(!1);return}if(Y){W(!1);return}if(Sr){wr(!1);return}}}};return window.addEventListener("keydown",J),()=>window.removeEventListener("keydown",J)},[k,cn,Vt,pn,Y,Sr]),p.useEffect(()=>{const J=He=>{if(!rr||!Kr.current)return;const Ve=Kr.current.getBoundingClientRect(),xe=18;Ve.width-xe;const st=(He.clientX-Ve.left)/Ve.width*100;st>=20&&st<=80&&xt(st)},Xe=()=>{if(rr){ir(!1);try{localStorage.setItem("balcao_left_panel_width",String(ze))}catch{}}};return rr&&(document.addEventListener("mousemove",J),document.addEventListener("mouseup",Xe),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",Xe),document.body.style.cursor="",document.body.style.userSelect=""}},[rr,ze]),p.useEffect(()=>{let J=!0;const Xe=setTimeout(async()=>{try{const He=await uf({includeInactive:!1,search:w?.trim()||void 0,codigoEmpresa:r?.codigo_empresa});if(!J)return;let fe=He||[];if(w?.trim()){const Ve=w.trim().toLowerCase();fe=fe.filter(xe=>(xe.name||"").toLowerCase().includes(Ve)||(xe.code||"").toLowerCase().includes(Ve))}fe.sort((Ve,xe)=>{const kt=Ve.code||"",st=xe.code||"";return/^\d+$/.test(kt)&&/^\d+$/.test(st)?parseInt(kt,10)-parseInt(st,10):kt.localeCompare(st)}),i(fe)}catch{J&&i([])}},300);return()=>{J=!1,clearTimeout(Xe)}},[w]),p.useEffect(()=>{if(H)return;let J=!0;const Xe=async()=>{try{const fe=r?.codigo_empresa;if(!fe)return;const Ve=await Ph({codigoEmpresa:fe});if(!J)return;const xe=new Map;for(const kt of Ve||[]){const st=kt.produto_id,zt=Number(kt.quantidade||0);xe.set(st,(xe.get(st)||0)+zt)}T(xe)}catch(fe){console.error("[BalcaoPage] Erro ao buscar estoque reservado:",fe),J&&T(new Map)}};Xe();const He=setInterval(Xe,5e3);return()=>{J=!1,clearInterval(He)}},[r?.codigo_empresa,l,H]),p.useEffect(()=>{if(H)return;let J=!0;const Xe=setTimeout(async()=>{try{const He=await tw({searchTerm:br,limit:20,codigoEmpresa:r?.codigo_empresa});if(!J)return;const fe=(He||[]).slice().sort((Ve,xe)=>Number(Ve?.codigo||0)-Number(xe?.codigo||0));if(zr(fe),!n&&!cn&&pn&&(!Gr||Gr.length===0)){const Ve=fe?.find(xe=>xe?.codigo===0);if(Ve){ha([Ve.id]);try{localStorage.setItem(Tn.pendingClientIds,JSON.stringify([Ve.id]))}catch{}}}}catch{J&&zr([])}},250);return()=>{J=!1,clearTimeout(Xe)}},[br,pn,H]);const Yt=p.useMemo(()=>l.reduce((J,Xe)=>J+Number(Xe.price||0)*Number(Xe.quantity||0),0),[l]),Pt=p.useMemo(()=>{try{const J=(l||[]).reduce((Ve,xe)=>Ve+Number(xe.price||0)*Number(xe.quantity||0),0),Xe=Lt?.tipo,He=Number(Lt?.valor||0);let fe=0;return Xe==="percentual"&&He>0?fe=J*(He/100):Xe==="fixo"&&He>0&&(fe=He),Math.max(0,J-fe)}catch{return Yt}},[l,Lt,Yt]),Qt=p.useMemo(()=>{const J=new Map;for(const Xe of l||[]){const He=Xe.productId;if(!He)continue;const fe=Number(Xe.quantity||0);J.set(He,(J.get(He)||0)+fe)}return J},[l]),nr=async(J,Xe={})=>{try{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}if(!cn&&!Xe.skipClientCheck){S(J),on(!0),e({title:"Selecione o cliente",description:"Escolha um cliente cadastrado antes de vender.",variant:"warning"});return}const He=r?.codigo_empresa;if(!He){e({title:"Empresa no definida",description:"Faa login novamente.",variant:"destructive"});return}if(_)return;const fe=Number(J.stock??J.currentStock??0),Ve=I.get(J.id)||0,xe=Math.max(0,fe-Ve),kt=Number(J.minStock??0);if(xe<=0){e({title:"Sem estoque disponvel",description:`Produto "${J.name}" est sem estoque (${fe} total, ${Ve} reservado em outras comandas).`,variant:"destructive"});return}C(J.id);let st=n;const zt=!st;if(!st)try{h(!0);const sn=await $2({codigoEmpresa:He});st=sn.id,s(sn.id),await new Promise(Nr=>setTimeout(Nr,300));const{data:la}=await Q.from("comandas").select("id").eq("id",st).eq("codigo_empresa",He).single();if(!la)throw new Error("Comanda criada mas no acessvel via RLS")}catch(sn){if(sn?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para vender",description:"Voc precisa abrir o caixa antes de iniciar uma comanda no Balco.",variant:"warning"});return}throw sn}finally{h(!1)}const pr=Number(J.salePrice??J.price??0),en=(sa.current||[]).find(sn=>sn.productId===J.id);en?await Qd({itemId:en.id,quantidade:Number(en.quantity||0)+1,codigoEmpresa:He}):await f3({comandaId:st,produtoId:J.id,descricao:J.name,quantidade:1,precoUnitario:pr,codigoEmpresa:He}),await ee(st);try{const sn=await Ph({codigoEmpresa:He}),la=new Map;for(const Nr of sn||[]){const xn=Nr.produto_id,Dn=Number(Nr.quantidade||0);la.set(xn,(la.get(xn)||0)+Dn)}T(la)}catch(sn){console.error("[BalcaoPage:addProduct] Erro ao atualizar estoque reservado:",sn)}if(zt)try{const sn=Array.from(new Set(Gr||[]));if(sn.length>0){await rw({comandaId:st,clienteIds:sn,nomesLivres:[],codigoEmpresa:He,replace:!0}),await ee(st);const Nr=(await nl({comandaId:st,codigoEmpresa:He})||[]).map(xn=>xn?.nome).filter(Boolean);b(Nr.length?Nr.join(", "):""),ke(!0);try{localStorage.removeItem(Tn.pendingClientIds),localStorage.setItem(Tn.customerName,Nr.length?Nr.join(", "):""),localStorage.setItem(Tn.clientChosen,"true")}catch(xn){console.error("Erro ao atualizar cache local:",xn)}}}catch(sn){console.error("Erro ao associar clientes:",sn)}fe-1<=0?e({title:"ltima unidade vendida",description:`"${J.name}" esgotou aps esta venda.`,variant:"warning"}):fe-1<=kt?e({title:"Estoque baixo",description:`"${J.name}" atingiu nvel de estoque baixo.`,variant:"warning"}):e({title:"Produto adicionado",description:J.name,variant:"success"})}catch(He){const fe=String(He?.message||"").toLowerCase();He?.code==="OUT_OF_STOCK"||fe.includes("sem estoque")?e({title:"Sem estoque",description:"Este produto est sem estoque.",variant:"destructive"}):He?.code==="INSUFFICIENT_STOCK"||fe.includes("insuficiente")?e({title:"Estoque insuficiente",description:He?.message||"Quantidade maior que o disponvel.",variant:"destructive"}):e({title:"Falha ao adicionar",description:He?.message||"Tente novamente",variant:"destructive"})}finally{C(null)}},fn=async()=>{try{if(te(!0),!cn){on(!0),e({title:"Selecione o cliente",description:"Escolha um cliente cadastrado antes de pagar.",variant:"warning"}),te(!1);return}const J=r?.codigo_empresa;if(!J){e({title:"Empresa no definida",variant:"destructive"});return}if(!n)try{h(!0);const Dn=await $2({codigoEmpresa:J});if(!Dn?.id){e({title:"Comanda no encontrada",description:"Abra uma comanda antes de pagar.",variant:"destructive"}),te(!1);return}s(Dn.id)}catch(Dn){if(Dn?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para pagar",description:" necessrio abrir o caixa antes de iniciar/confirmar uma venda.",variant:"warning"}),te(!1);return}throw Dn}finally{h(!1)}try{await dKe({comandaId:n,codigoEmpresa:J})}catch(Dn){const Pa=Array.isArray(Dn?.items)&&Dn.items.length?Dn.items.map(Aa=>`${Aa.name} (solicitado ${Aa.solicitado}, estoque ${Aa.estoque})`).join("; "):Dn?.message||"Estoque insuficiente na comanda";e({title:"Estoque insuficiente",description:Pa,variant:"destructive",duration:7e3}),te(!1);return}const Xe=await Fh({somenteAtivas:!0,codigoEmpresa:J});pe(Xe||[]);let He=[];try{const Dn=await nl({comandaId:n,codigoEmpresa:J});He=(Array.isArray(Dn)?Dn:[]).map(Aa=>{const Na=Aa?.cliente_id??Aa?.clientes?.id??null,Hn=Aa?.clientes?.nome??Aa?.nome??Aa?.nome_livre??"";return Na?{id:Na,nome:Hn}:null}).filter(Boolean)}catch{He=[]}pt(He);const fe=Xe&&Xe[0]&&Xe[0].id?Xe[0].id:null,Ve=Gr&&Gr.length>0?Gr[0]:He[0]?.id||null;let xe=0;try{xe=(await ci({comandaId:n,codigoEmpresa:J})||[]).reduce((Pa,Aa)=>Pa+Number(Aa.quantidade||0)*Number(Aa.preco_unitario||0),0)}catch{}const kt=Lt?.tipo,st=Number(Lt?.valor||0);let zt=0;kt==="percentual"&&st>0?zt=xe*(st/100):kt==="fixo"&&st>0&&(zt=st);const pr=Math.max(0,xe-zt),en=(Xe||[]).find(Dn=>String(Dn.id)===String(fe)),sn=Number(en?.taxa_percentual||0),la=sn>0,Nr=la?pr*(1+sn/100):pr,xn=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Nr);De([{id:1,clientId:Ve,methodId:fe,value:xn,chargeFee:la}]),ae(2),W(!0),te(!1);return}catch(J){if(J?.code==="NO_OPEN_CASH_SESSION"){e({title:"Abra o caixa para pagar",description:" necessrio abrir o caixa antes de iniciar/confirmar uma venda.",variant:"warning"}),te(!1);return}e({title:"Falha ao iniciar pagamento",description:J?.message||"Tente novamente",variant:"destructive"})}finally{te(!1)}};return a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"md:hidden mb-2 w-full",children:a.jsx(_d,{value:"balcao",onValueChange:J=>{J==="mesas"&&t("/vendas"),J==="balcao"&&t("/balcao"),J==="historico"&&t("/historico")},children:a.jsxs(xc,{className:"grid w-full grid-cols-3",children:[a.jsx(Ya,{value:"mesas",className:"text-xs",children:"Mesas"}),a.jsx(Ya,{value:"balcao",className:"text-xs",children:"Balco"}),a.jsx(Ya,{value:"historico",className:"text-xs",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center justify-between mb-2 md:mb-6 gap-2 md:gap-4",children:[a.jsx("div",{className:"hidden md:flex items-center gap-2 md:gap-3",children:a.jsx(_d,{value:"balcao",onValueChange:J=>{J==="mesas"&&t("/vendas"),J==="balcao"&&t("/balcao"),J==="historico"&&t("/historico")},children:a.jsxs(xc,{className:"inline-flex",children:[a.jsx(Ya,{value:"mesas",className:"text-sm",children:"Mesas"}),a.jsx(Ya,{value:"balcao",className:"text-sm",children:"Balco"}),a.jsx(Ya,{value:"historico",className:"text-sm",children:"Histrico"})]})})}),a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-3 md:ml-auto",children:[a.jsx(ln,{}),a.jsx(da,{}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>z(!0),className:"px-3",children:[a.jsx(Y4,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2 md:hidden",children:"Detalhes"}),a.jsx("span",{className:"ml-2 hidden md:inline",children:"Detalhes do Caixa"})]})]})]}),a.jsx("div",{className:"md:hidden flex-1 flex flex-col",children:a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden bg-surface flex-1 min-h-0",children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Comanda"}),a.jsx("div",{className:"text-base font-bold truncate",children:"Balco"}),cn&&y&&a.jsx("div",{className:"text-[11px] text-text-muted truncate mt-0.5",children:y})]}),a.jsx("div",{className:"flex flex-col items-end gap-1",children:cn?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsxs(Z,{size:"sm",className:"h-8 px-2 text-xs bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}qt(!0)},children:[a.jsx(so,{className:"h-4 w-4 mr-1"})," Produto"]}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs",onClick:()=>on(!0),children:"+ Cliente"})]}),a.jsxs("span",{className:"text-xs text-text-muted whitespace-nowrap",children:["Total: R$ ",Yt.toFixed(2)]})]}):a.jsx(Z,{size:"sm",className:"h-8 px-3 text-xs bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}on(!0)},children:"Iniciar venda"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3 thin-scroll min-h-0",children:cn?l.length===0?a.jsxs("div",{className:"text-center pt-8 text-xs text-text-muted space-y-2",children:[a.jsx("div",{children:"Comanda criada para o cliente."}),a.jsxs("div",{children:["Use o boto ",a.jsx("span",{className:"font-semibold",children:"Produto"})," para adicionar itens."]})]}):a.jsx("ul",{className:"space-y-2",children:l.map(J=>a.jsxs("li",{className:"p-2 rounded-md border border-border/40 bg-surface-2",children:[a.jsx("div",{className:"text-sm font-medium truncate",title:J.name,children:J.name}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Xe=>{Xe.stopPropagation();const He=r?.codigo_empresa;if(!He){e({title:"Empresa no definida",variant:"destructive"});return}const fe=Number(J.quantity||1)-1;try{fe<=0?(await Dv({itemId:J.id,codigoEmpresa:He}),c(Ve=>Ve.filter(xe=>xe.id!==J.id))):(await Qd({itemId:J.id,quantidade:fe,codigoEmpresa:He}),c(Ve=>Ve.map(xe=>xe.id===J.id?{...xe,quantity:fe}:xe)))}catch(Ve){e({title:"Falha ao atualizar item",description:Ve?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-7 text-center text-sm font-semibold",children:J.quantity}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Xe=>{Xe.stopPropagation();const He=r?.codigo_empresa;if(!He){e({title:"Empresa no definida",variant:"destructive"});return}const fe=Number(J.quantity||1)+1;try{await Qd({itemId:J.id,quantidade:fe,codigoEmpresa:He}),c(Ve=>Ve.map(xe=>xe.id===J.id?{...xe,quantity:fe}:xe))}catch(Ve){e({title:"Falha ao atualizar item",description:Ve?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]}),a.jsxs("span",{className:"text-sm font-semibold whitespace-nowrap",children:["R$ ",(Number(J.quantity)*Number(J.price)).toFixed(2)]})]})]},J.id))}):a.jsx("div",{className:"text-center pt-8 text-xs text-text-muted space-y-2",children:a.jsxs("div",{children:["Para comear, toque em ",a.jsx("span",{className:"font-semibold",children:"Iniciar venda"})," e selecione o cliente."]})})}),a.jsx("div",{className:"p-3 border-t border-border flex gap-2",children:cn?a.jsxs(a.Fragment,{children:[a.jsx(Z,{className:"flex-1",variant:"outline",size:"sm",onClick:Oe,disabled:A,children:"Cancelar"}),a.jsx(Z,{className:"flex-1",size:"sm",disabled:Yt<=0,onClick:fn,children:"Finalizar"})]}):a.jsx(Z,{className:"flex-1",size:"sm",variant:"outline",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}on(!0)},children:"Iniciar venda"})})]})}),a.jsx(va,{}),a.jsx(Un,{open:Sr,onOpenChange:J=>{wr(J),J||Gt(null)},children:a.jsxs(zn,{className:"sm:max-w-[420px] w-full max-h-[85vh] flex flex-col animate-none",onKeyDown:J=>J.stopPropagation(),onPointerDownOutside:J=>J.stopPropagation(),onInteractOutside:J=>J.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold break-words",title:wt?.name||"",children:wt?.name||"Produto"}),a.jsx(ma,{children:"Detalhes do produto e aes rpidas."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Preo"}),a.jsx("span",{className:"text-sm font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(wt?.price??wt?.salePrice??0))})]}),wt?.category?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Categoria"}),a.jsx("span",{className:"text-sm font-medium",children:wt.category})]}):null,a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[typeof wt?.stock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Estoque"}),a.jsx("div",{className:"text-base font-semibold",children:wt.stock})]}),typeof wt?.minStock<"u"&&a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Mnimo"}),a.jsx("div",{className:"text-base font-semibold",children:wt.minStock})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Na Comanda"}),a.jsxs("div",{className:"text-base font-semibold",children:["x",Qt.get(wt?.id)||0]})]})]})]}),a.jsxs(Ga,{className:"flex items-center justify-between gap-2",children:[a.jsxs(Z,{variant:"ghost",size:"sm",className:"mr-auto inline-flex items-center gap-1",onClick:()=>{wt&&t("/produtos",{state:{productId:wt.id,productName:wt.name}})},children:[a.jsx(il,{className:"w-4 h-4"}),a.jsx("span",{children:"Info"})]}),a.jsx(Z,{variant:"outline",onClick:()=>{wr(!1),Gt(null)},children:"Fechar"}),a.jsx(Z,{onClick:async()=>{wt&&(await nr(wt,{skipClientCheck:!1}),wr(!1),Gt(null))},children:"Adicionar"})]})]})}),(f||m||g)&&a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80",children:a.jsxs("div",{className:"px-8 py-6 rounded-xl bg-surface border border-border shadow-2xl flex flex-col items-center gap-4 max-w-sm w-[85vw] text-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-brand border-t-transparent animate-spin","aria-hidden":"true"}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("span",{className:"block text-base font-semibold text-text-primary",children:f?"Abrindo venda...":m?"Cancelando venda...":"Fechando conta..."}),a.jsx("span",{className:"block text-xs text-text-muted",children:f?"Aguarde, estamos iniciando a venda e sincronizando com os dispositivos.":m?"Aguarde, estamos cancelando a venda e limpando os itens.":"Aguarde, estamos registrando o pagamento e encerrando a venda."})]})]})}),a.jsx(Un,{open:Vt,onOpenChange:qt,children:a.jsxs(zn,{className:"sm:max-w-xl w-[92vw] sm:w-auto max-h-[85vh] flex flex-col overflow-hidden animate-none p-3 sm:p-6",onOpenAutoFocus:J=>J.preventDefault(),onKeyDown:J=>J.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsxs(Ln,{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(qv,{className:"w-6 h-6 text-brand"}),"Adicionar Produtos"]}),a.jsx(ma,{className:"text-base mt-2",children:"Balco  Busque e adicione produtos  comanda atual"})]}),a.jsx("div",{className:"px-3 pt-0 pb-3 sm:p-4 sm:pt-0",children:a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar produto...",className:"pl-9",value:Re,onChange:J=>Ct(J.target.value)})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-0 sm:px-4 pb-3 sm:pb-4 thin-scroll",children:[a.jsx("ul",{className:"space-y-2",children:(o||[]).filter(J=>{const Xe=(Re||"").toLowerCase();if(!Xe)return!0;const He=String(J.name||J.descricao||"").toLowerCase(),fe=String(J.code||J.codigo||"").toLowerCase();return He.includes(Xe)||fe.includes(Xe)}).sort((J,Xe)=>{const He=J.code?parseInt(J.code,10):999999,fe=Xe.code?parseInt(Xe.code,10):999999;return He-fe}).map(J=>{const Xe=Qt.get(J.id)||0,He=Number(J.stock??J.currentStock??0),fe=Math.max(0,He-Xe),Ve=Number(J.salePrice??J.price??0),xe=fe===0;return a.jsxs("li",{className:`flex items-center w-full px-3 sm:px-2 py-2 sm:py-2 rounded-md border border-border/40 transition-colors ${xe?"opacity-50 grayscale":"hover:bg-surface-2"}`,children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[a.jsxs("p",{className:"font-semibold text-xs sm:text-sm truncate w-full",title:`${J.code?`[${J.code}] `:""}${J.name}`,children:[J.code&&a.jsxs("span",{className:"text-text-muted",children:["[",J.code,"]"]})," ",J.name]}),Xe>0&&a.jsxs("span",{className:"inline-flex items-center justify-center px-1.5 py-0.5 bg-brand/10 text-brand text-[11px] font-semibold rounded whitespace-nowrap flex-shrink-0",children:[Xe,"x na comanda"]})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] sm:text-xs mt-0.5",children:[a.jsxs("span",{className:`font-bold ${fe===0?"text-text-muted":"text-brand"}`,children:["R$ ",Ve.toFixed(2)]}),a.jsxs("span",{className:"text-text-muted whitespace-nowrap",children:["Estoque:"," ",a.jsx("span",{className:`font-semibold ${fe<=5?"text-destructive":"text-text-secondary"}`,children:fe})]})]})]}),a.jsx(Z,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:async()=>{await nr(J)},"aria-label":`Adicionar ${J.name}`,children:a.jsx(so,{className:"h-4 w-4"})})]},J.id)})}),Array.isArray(o)&&o.length===0&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(qv,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("p",{className:"text-sm text-text-muted",children:"Nenhum produto encontrado."})]})]}),a.jsx(Ga,{children:a.jsx(Z,{variant:"outline",onClick:()=>qt(!1),children:"Fechar"})})]})}),a.jsxs("div",{ref:Kr,className:"hidden md:flex gap-0 h-full overflow-hidden relative",children:[a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden",style:{width:`${ze}%`},children:[a.jsxs("div",{className:"p-4 border-b border-border space-y-3 cursor-pointer",onClick:J=>{J.target.tagName==="INPUT"||J.target.tagName==="BUTTON"||J.target.closest("button")||qe.current?.focus()},children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar produto...",className:"pl-9",value:w,onChange:J=>j(J.target.value),onKeyDown:J=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(J.key)&&J.stopPropagation()}})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("button",{onClick:()=>At("all"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${Je==="all"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Todos"}),a.jsx("button",{onClick:()=>At("available"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${Je==="available"?"bg-success text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Disponvel"}),a.jsx("button",{onClick:()=>At("low"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${Je==="low"?"bg-warning text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Estoque Baixo"}),a.jsx("button",{onClick:()=>At("out"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${Je==="out"?"bg-destructive text-white":"bg-surface text-text-muted hover:bg-surface-2"}`,children:"Sem Estoque"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{lr("code");try{localStorage.setItem("balcao_sort_order","code")}catch{}},className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${Ye==="code"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,title:"Ordenar por cdigo",children:"Cdigo"}),a.jsx("button",{onClick:()=>{lr("name");try{localStorage.setItem("balcao_sort_order","name")}catch{}},className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors whitespace-nowrap ${Ye==="name"?"bg-brand text-black":"bg-surface text-text-muted hover:bg-surface-2"}`,title:"Ordenar por nome",children:"A-Z"})]})]}),a.jsx("div",{className:"flex items-center gap-4 text-sm text-text-muted cursor-pointer",onClick:()=>qe.current?.focus(),children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("kbd",{className:"px-2 py-1 bg-surface border border-border rounded text-xs font-mono",children:""}),a.jsx("span",{children:"Navegar"})]})})]}),a.jsx("div",{ref:qe,className:"flex-1 overflow-y-auto p-4 thin-scroll focus:outline-none focus:ring-2 focus:ring-brand/20",tabIndex:0,onClick:()=>qe.current?.focus(),onKeyDown:J=>{const Xe=o.filter(Ve=>{const xe=w.trim().toLowerCase(),kt=!xe||(Ve.name||"").toLowerCase().includes(xe)||String(Ve.code||"").toLowerCase().includes(xe);if(Je==="all")return kt;const st=I.get(Ve.id)||0,zt=Number(Ve.stock??Ve.currentStock??0),pr=Math.max(0,zt-st);return Je==="available"?kt&&pr>0:Je==="low"?kt&&pr>0&&pr<=5:Je==="out"?kt&&pr<=0:kt}).sort((Ve,xe)=>{if(Ye==="name"){const kt=(Ve.name||"").toLowerCase(),st=(xe.name||"").toLowerCase();return kt.localeCompare(st)}else{const kt=Ve.code?parseInt(Ve.code,10):999999,st=xe.code?parseInt(xe.code,10):999999;return kt-st}});if(!["ArrowDown","ArrowUp","Home","End"].includes(J.key))return;J.preventDefault();const He=We||0,fe=Xe.length;if(J.key==="ArrowDown"){const Ve=Math.min(He+1,fe-1);Ze(Ve),requestAnimationFrame(()=>ce.current[Ve]?.scrollIntoView({block:"nearest"}))}if(J.key==="ArrowUp"){const Ve=Math.max(He-1,0);Ze(Ve),requestAnimationFrame(()=>ce.current[Ve]?.scrollIntoView({block:"nearest"}))}if(J.key==="Home"&&(Ze(0),requestAnimationFrame(()=>ce.current[0]?.scrollIntoView({block:"nearest"}))),J.key==="End"){const Ve=Math.max(0,fe-1);Ze(Ve),requestAnimationFrame(()=>ce.current[Ve]?.scrollIntoView({block:"nearest"}))}},children:(o||[]).length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12",children:[a.jsx(qv,{className:"w-16 h-16 text-text-muted mb-4"}),a.jsx("p",{className:"text-lg font-semibold text-text-primary mb-2",children:"Nenhum produto cadastrado"}),a.jsx("p",{className:"text-sm text-text-muted mb-6 text-center",children:"Cadastre produtos para comear a vender"}),a.jsxs(Z,{onClick:()=>t("/produtos"),children:[a.jsx(so,{className:"mr-2 h-4 w-4"}),"Cadastrar Produto"]})]}):a.jsx("ul",{className:"space-y-2",children:o.filter(J=>{const Xe=w.trim().toLowerCase(),He=!Xe||(J.name||"").toLowerCase().includes(Xe)||String(J.code||"").toLowerCase().includes(Xe);if(Je==="all")return He;const fe=I.get(J.id)||0,Ve=Number(J.stock??J.currentStock??0),xe=Math.max(0,Ve-fe);return Je==="available"?He&&xe>0:Je==="low"?He&&xe>0&&xe<=5:Je==="out"?He&&xe<=0:He}).sort((J,Xe)=>{if(Ye==="name"){const He=(J.name||"").toLowerCase(),fe=(Xe.name||"").toLowerCase();return He.localeCompare(fe)}else{const He=J.code?parseInt(J.code,10):999999,fe=Xe.code?parseInt(Xe.code,10):999999;return He-fe}}).map((J,Xe)=>{const He=Qt.get(J.id)||0,fe=I.get(J.id)||0,Ve=Number(J.stock??J.currentStock??0),xe=Math.max(0,Ve-fe),kt=Number(J.salePrice??J.price??0),st=Xe===We;return a.jsx(Ce.Fragment,{children:a.jsxs("li",{ref:zt=>{ce.current[Xe]=zt},className:`flex items-center gap-3 p-2 rounded-md transition-colors border-2 ${st?"border-brand bg-brand/5":"border-transparent hover:bg-surface-2"} ${xe===0&&He===0?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{Ze(Xe),qe.current?.focus()},children:[a.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:zt=>{zt.stopPropagation(),Gt({...J,qty:He,remaining:xe,price:kt}),wr(!0)},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsxs("p",{className:"font-semibold truncate",title:`${J.code?`[${J.code}] `:""}${J.name}`,children:[J.code&&a.jsxs("span",{className:"text-text-muted",children:["[",J.code,"]"]})," ",J.name]}),He>0&&a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-brand/15 text-brand border border-brand/30 flex-shrink-0",children:["x",He]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["R$ ",kt.toFixed(2)]}),a.jsxs("span",{className:`text-xs font-medium whitespace-nowrap ${xe<=0?"text-destructive":xe<=5?"text-warning":"text-text-secondary"}`,children:["Estoque: ",xe]})]})]}),a.jsx(Z,{size:"icon",className:"flex-shrink-0 bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",onClick:zt=>{zt.stopPropagation(),nr(J)},disabled:xe===0,"aria-label":`Adicionar ${J.name}`,children:a.jsx(so,{className:"h-4 w-4"})})]})},J.id)})})})]}),a.jsx("div",{className:"w-2 bg-border hover:bg-brand cursor-col-resize transition-colors flex-shrink-0 mx-2",onMouseDown:()=>ir(!0),title:"Arraste para redimensionar"}),a.jsxs("div",{className:"flex flex-col border rounded-lg border-border overflow-hidden",style:{width:`${100-ze}%`},children:[a.jsxs("div",{className:"p-3 border-b border-border flex items-center justify-between gap-2 flex-wrap",children:[a.jsxs("div",{className:"min-w-0 flex-shrink",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Comanda"}),a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"text-base font-bold whitespace-nowrap",children:"Balco"}),y?a.jsx("span",{className:"truncate text-[11px] px-2 py-0.5 rounded-full border border-border bg-surface-2 text-text-secondary",children:y}):null]})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 flex-wrap",children:[a.jsxs(Z,{size:"sm",className:"md:hidden h-8 px-2 text-xs whitespace-nowrap bg-amber-500 hover:bg-amber-400 text-black border border-amber-500/60",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar produtos.",variant:"warning"});return}qt(!0)},title:"Adicionar produto",children:[a.jsx(so,{className:"h-4 w-4 mr-1"}),"Produto"]}),cn&&a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs whitespace-nowrap",disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de adicionar clientes.",variant:"warning"});return}on(!0)},children:"+ Cliente"}),cn?a.jsxs(Gu,{children:[a.jsx(_g,{asChild:!0,children:a.jsx(Z,{size:"sm",className:"h-8 px-2 text-xs whitespace-nowrap bg-red-600 hover:bg-red-500 text-white border border-red-600/70 focus:outline-none focus:ring-0 focus-visible:ring-0 shadow-none",disabled:A,children:A?"Cancelando...":"Cancelar"})}),a.jsxs(tu,{className:"sm:max-w-[420px] animate-none",onKeyDown:J=>J.stopPropagation(),children:[a.jsxs(ru,{children:[a.jsx(au,{children:"Cancelar venda do balco?"}),a.jsx(su,{children:"Os itens sero descartados e a venda ser limpa. Esta ao no pode ser desfeita."})]}),a.jsxs(nu,{children:[a.jsx(ou,{children:"Voltar"}),a.jsx(Ku,{onClick:Oe,children:"Confirmar Cancelamento"})]})]})]}):a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 px-2 text-xs opacity-60 cursor-not-allowed whitespace-nowrap",disabled:!0,children:"Cancelar"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 thin-scroll",children:cn?l.length===0?a.jsx("div",{className:"text-center text-text-muted pt-16",children:'Comanda vazia. Use o boto "+" para adicionar produtos.'}):a.jsx("ul",{className:"space-y-3 pr-1",children:l.map(J=>a.jsxs("li",{className:"p-2 rounded-md border border-border/30 bg-surface hover:bg-surface-2 transition-colors",children:[a.jsx("div",{className:"min-w-0 flex-1",children:a.jsx("div",{className:"font-medium truncate",title:J.name,children:J.name})}),a.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Xe=>{Xe.stopPropagation();const He=r?.codigo_empresa;if(!He){e({title:"Empresa no definida",variant:"destructive"});return}const fe=Number(J.quantity||1)-1;try{fe<=0?(await Dv({itemId:J.id,codigoEmpresa:He}),c(Ve=>Ve.filter(xe=>xe.id!==J.id))):(await Qd({itemId:J.id,quantidade:fe,codigoEmpresa:He}),c(Ve=>Ve.map(xe=>xe.id===J.id?{...xe,quantity:fe}:xe)));try{const Ve=await Ph({codigoEmpresa:He}),xe=new Map;for(const kt of Ve||[]){const st=kt.produto_id,zt=Number(kt.quantidade||0);xe.set(st,(xe.get(st)||0)+zt)}T(xe)}catch(Ve){console.error("[BalcaoPage:removeItem] Erro ao atualizar estoque reservado:",Ve)}}catch(Ve){const xe=String(Ve?.message||"").toLowerCase();Ve?.code==="INSUFFICIENT_STOCK"||xe.includes("insuficiente")?e({title:"Estoque insuficiente",description:Ve?.message||"Quantidade maior que o disponvel.",variant:"warning"}):e({title:"Falha ao atualizar item",description:Ve?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-7 text-center font-semibold",children:J.quantity}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:async Xe=>{Xe.stopPropagation();const He=r?.codigo_empresa;if(!He){e({title:"Empresa no definida",variant:"destructive"});return}const fe=Number(J.quantity||1)+1;try{await Qd({itemId:J.id,quantidade:fe,codigoEmpresa:He}),c(Ve=>Ve.map(xe=>xe.id===J.id?{...xe,quantity:fe}:xe))}catch(Ve){const xe=String(Ve?.message||"").toLowerCase();Ve?.code==="INSUFFICIENT_STOCK"||xe.includes("insuficiente")?e({title:"Estoque insuficiente",description:Ve?.message||"Quantidade maior que o disponvel.",variant:"warning"}):e({title:"Falha ao atualizar item",description:Ve?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"font-semibold whitespace-nowrap",children:["R$ ",(Number(J.quantity)*Number(J.price)).toFixed(2)]}),a.jsxs("span",{className:"inline-flex items-center justify-center text-[11px] px-1.5 py-0.5 rounded-full bg-surface text-text-secondary border border-border",children:["x",J.quantity]})]})]})]},J.id))}):a.jsxs("div",{className:"text-center pt-12",children:[a.jsx("div",{className:"text-sm text-text-secondary mb-3",children:"Para comear, inicie uma nova venda e selecione o cliente."}),a.jsx(Z,{disabled:!k,onClick:()=>{if(!k){e({title:"Caixa Fechado",description:"Abra o caixa antes de iniciar uma venda.",variant:"warning"});return}on(!0)},children:"Iniciar nova venda"})]})}),a.jsxs("div",{className:"p-4 border-t border-border",children:[a.jsxs("div",{className:"flex justify-between items-center text-lg font-bold mb-3",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["R$ ",Pt.toFixed(2)]})]}),a.jsx(Z,{size:"lg",className:"w-full",onClick:fn,disabled:Pt<=0,children:"Finalizar Pagamento"})]})]})]}),a.jsx(Un,{open:Y,onOpenChange:W,children:a.jsxs(zn,{className:"sm:max-w-xl w-[92vw] max-h-[80vh] min-h-0 flex flex-col overflow-hidden animate-none p-3 sm:p-6",onKeyDown:J=>J.stopPropagation(),children:[a.jsx(Bn,{className:"flex flex-col gap-1 pr-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3",children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Fechar Conta"}),a.jsx(Z,{type:"button",size:"sm",variant:"outline",className:"self-start sm:self-auto",onClick:()=>bt(!0),children:"Desconto"})]})}),a.jsxs("div",{className:"flex-1 min-h-0 flex flex-col space-y-3",children:[(()=>{const J=(l||[]).reduce((kt,st)=>kt+Number(st.quantity||0)*Number(st.price||0),0),Xe=Lt?.tipo,He=Number(Lt?.valor||0);let fe=0;Xe==="percentual"&&He>0?fe=J*(He/100):Xe==="fixo"&&He>0&&(fe=He);const Ve=Math.max(0,J-fe),xe=fe>5e-4;return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-sm text-text-secondary",children:[a.jsx("span",{children:"Subtotal"}),a.jsxs("span",{children:["R$ ",J.toFixed(2)]})]}),xe&&a.jsxs("div",{className:"flex justify-between text-sm text-destructive",children:[a.jsx("span",{children:"Desconto da comanda"}),a.jsxs("span",{children:["-R$ ",fe.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t border-border pt-1 mt-1",children:[a.jsx("span",{children:"Total com desconto"}),a.jsxs("span",{children:["R$ ",Ve.toFixed(2)]})]})]})})(),a.jsxs("div",{className:"flex-1 min-h-0 space-y-2 overflow-y-auto thin-scroll pr-0 sm:pr-1",children:[a.jsx(ct,{className:"block",children:"Pagamentos"}),(()=>null)(),(()=>null)(),(oe||[]).map((J,Xe)=>{const He=xe=>{if(!xe)return y||"Cliente";const kt=String(xe),st=(ut||[]).find(pr=>String(pr.id)===kt);if(st?.nome)return st.nome;const zt=(an||[]).find(pr=>String(pr.id)===kt);return zt?.nome?zt.nome:y||"Cliente"},fe=(ut||[]).length>1,Ve=(ut||[])[0]||null;return(ut||[]).filter(xe=>String(xe.id)!==String(Ve?.id||"")),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"sm:hidden rounded-md bg-surface-2 border border-border overflow-hidden",children:[a.jsxs("button",{type:"button",className:"w-full flex items-center justify-between gap-2 px-3 py-2 text-left",onClick:()=>ge(xe=>xe===J.id?null:J.id),children:[a.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[a.jsx("span",{className:"text-xs text-text-secondary truncate",children:He(Ve?.id||J.clientId)}),a.jsxs("span",{className:"text-xs font-semibold text-text-primary truncate",children:[J.methodId&&Ft(J.methodId)?.nome||"Forma no selecionada","  R$ ",J.value||"0,00"]})]}),a.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:oe.length>1&&Xe>0&&a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:xe=>{xe.stopPropagation(),De(kt=>{const st=kt.filter(Dn=>Dn.id!==J.id);if(st.length===0)return[];const zt=(l||[]).reduce((Dn,Pa)=>Dn+Number(Pa.quantity||0)*Number(Pa.price||0),0),pr=Lt?.tipo,en=Number(Lt?.valor||0);let sn=0;pr==="percentual"&&en>0?sn=zt*(en/100):pr==="fixo"&&en>0&&(sn=en);const la=Math.max(0,zt-sn),Nr=Math.floor(la/st.length*100)/100,xn=la-Nr*st.length;return st.map((Dn,Pa)=>{const Aa=Pa===st.length-1?Nr+xn:Nr;return Nt(Dn,Aa)})})},children:a.jsx(bc,{className:"h-3 w-3"})})})]}),Bt===J.id&&a.jsxs("div",{className:"px-3 pb-3 pt-1 space-y-2 border-t border-border/60",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(Zn,{value:J.methodId||"",onValueChange:xe=>De(kt=>kt.map(st=>{if(st.id!==J.id)return st;const zt=Ft(xe),pr=Number(zt?.taxa_percentual||0);if(pr>0){const sn=jt(st)*(1+pr/100);return{...st,methodId:xe,chargeFee:!0,value:Xr(sn)}}else{const en=jt(st);return{...st,methodId:xe,chargeFee:!1,value:Xr(en)}}})),children:[a.jsx(Yn,{className:"flex-1 h-9 truncate text-sm",children:a.jsx(ta,{placeholder:"Forma de pagamento"})}),a.jsx(Jn,{children:(se||[]).map(xe=>a.jsx(nt,{value:xe.id,children:xe.nome},xe.id))})]}),a.jsx(It,{placeholder:"0,00",inputMode:"numeric",value:J.value,className:"w-28 h-9 text-sm",onChange:xe=>{const kt=(xe.target.value||"").replace(/\D/g,""),st=kt?Number(kt)/100:0,zt=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(st);De(pr=>pr.map(en=>en.id===J.id?{...en,value:zt}:en))},onKeyDown:xe=>{xe.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(xe.key)&&(/^[0-9]$/.test(xe.key)||xe.preventDefault())},onBeforeInput:xe=>{const kt=xe.data??"";kt&&/\D/.test(kt)&&xe.preventDefault()}})]}),(()=>{const xe=kr(J);if(!xe)return null;const kt=er(J),st=!!J.chargeFee;return a.jsxs("button",{type:"button",onClick:()=>De(zt=>zt.map(pr=>{if(pr.id!==J.id)return pr;const en=jt(pr);if(!st){const sn=en*(1+xe/100);return{...pr,chargeFee:!0,value:Xr(sn)}}return{...pr,chargeFee:!1,value:Xr(en)}})),className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-[11px] font-medium border transition-colors w-full justify-between",st?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:st?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",st?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{className:"text-[11px]",children:["Taxa R$ ",kt.toFixed(2)]})]})})()]})]}),a.jsxs("div",{className:"hidden sm:grid grid-cols-12 gap-2 items-start",children:[a.jsx("div",{className:"sm:col-span-1 flex sm:justify-start",children:oe.length>1&&Xe>0&&a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>{De(xe=>{const kt=xe.filter(xn=>xn.id!==J.id);if(kt.length===0)return[];const st=(l||[]).reduce((xn,Dn)=>xn+Number(Dn.quantity||0)*Number(Dn.price||0),0),zt=Lt?.tipo,pr=Number(Lt?.valor||0);let en=0;zt==="percentual"&&pr>0?en=st*(pr/100):zt==="fixo"&&pr>0&&(en=pr);const sn=Math.max(0,st-en),la=Math.floor(sn/kt.length*100)/100,Nr=sn-la*kt.length;return kt.map((xn,Dn)=>{const Pa=Dn===kt.length-1?la+Nr:la;return Nt(xn,Pa)})})},children:a.jsx(bc,{className:"h-4 w-4"})})}),Xe===0?a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:He(Ve?.id||J.clientId)})}):fe?a.jsx("div",{className:"sm:col-span-4",children:a.jsxs(Zn,{value:J.clientId||"",onValueChange:xe=>De(kt=>kt.map(st=>st.id===J.id?{...st,clientId:xe}:st)),children:[a.jsx(Yn,{className:"w-full truncate",children:a.jsx(ta,{placeholder:"Cliente"})}),a.jsx(Jn,{children:(ut||[]).map(xe=>a.jsx(nt,{value:xe.id,children:xe.nome},xe.id))})]})}):a.jsx("div",{className:"sm:col-span-4",children:a.jsx("div",{className:"h-9 px-3 rounded-md border border-border bg-surface flex items-center text-sm truncate",children:He(Ve?.id||J.clientId)})}),a.jsxs("div",{className:"sm:col-span-4",children:[a.jsxs(Zn,{value:J.methodId||"",onValueChange:xe=>De(kt=>kt.map(st=>{if(st.id!==J.id)return st;const zt=Ft(xe),pr=Number(zt?.taxa_percentual||0);if(pr>0){const sn=jt(st)*(1+pr/100);return{...st,methodId:xe,chargeFee:!0,value:Xr(sn)}}else{const en=jt(st);return{...st,methodId:xe,chargeFee:!1,value:Xr(en)}}})),children:[a.jsx(Yn,{className:"w-full h-9 truncate",children:a.jsx(ta,{placeholder:"Forma de pagamento"})}),a.jsx(Jn,{children:(se||[]).map(xe=>a.jsx(nt,{value:xe.id,children:xe.nome},xe.id))})]}),(()=>{const xe=kr(J);if(!xe)return null;const kt=er(J),st=!!J.chargeFee;return a.jsx("div",{className:"mt-1",children:a.jsxs("button",{type:"button",onClick:()=>De(zt=>zt.map(pr=>{if(pr.id!==J.id)return pr;const en=jt(pr);if(!st){const sn=en*(1+xe/100);return{...pr,chargeFee:!0,value:Xr(sn)}}return{...pr,chargeFee:!1,value:Xr(en)}})),className:["inline-flex items-center gap-2 px-3 py-1 rounded-sm text-xs font-medium border transition-colors",st?"bg-black text-amber-400 border-amber-500":"bg-surface text-text-secondary border-border hover:border-border-hover"].join(" "),title:st?"Desmarcar taxa":"Cobrar taxa",children:[a.jsx("span",{className:["inline-block h-3 w-3 rounded-sm border",st?"bg-amber-500 border-amber-400":"bg-transparent border-border"].join(" ")}),a.jsxs("span",{children:["Taxa R$ ",kt.toFixed(2)]})]})})})()]}),a.jsx("div",{className:"sm:col-span-3",children:a.jsx(It,{placeholder:"0,00",inputMode:"numeric",value:J.value,className:"h-9",onChange:xe=>{const kt=(xe.target.value||"").replace(/\D/g,""),st=kt?Number(kt)/100:0,zt=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(st);De(pr=>pr.map(en=>en.id===J.id?{...en,value:zt}:en))},onKeyDown:xe=>{xe.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(xe.key)&&(/^[0-9]$/.test(xe.key)||xe.preventDefault())},onBeforeInput:xe=>{const kt=xe.data??"";kt&&/\D/.test(kt)&&xe.preventDefault()}})})]})]},J.id)}),a.jsx("div",{children:a.jsx(Z,{type:"button",variant:"secondary",size:"sm",onClick:()=>{De(J=>{const He=Array.isArray(Gr)&&Gr.length>0?Gr:(ut||[]).map(Aa=>Aa.id),fe=new Set(J.map(Aa=>Aa.clientId).filter(Boolean)),xe=(He||[]).filter(Aa=>!fe.has(Aa))[0]||He[0]||"",kt=se[0]?.id||"",st=Ft(kt),zt=Number(st?.taxa_percentual||0)>0,pr=[...J,{id:re,clientId:xe,methodId:kt,value:"",chargeFee:zt}],en=(l||[]).reduce((Aa,Na)=>Aa+Number(Na.quantity||0)*Number(Na.price||0),0),sn=Lt?.tipo,la=Number(Lt?.valor||0);let Nr=0;sn==="percentual"&&la>0?Nr=en*(la/100):sn==="fixo"&&la>0&&(Nr=la);const xn=Math.max(0,en-Nr),Dn=Math.floor(xn/pr.length*100)/100,Pa=xn-Dn*pr.length;return pr.map((Aa,Na)=>{const Hn=Na===pr.length-1?Dn+Pa:Dn;return Nt(Aa,Hn)})}),ae(J=>J+1)},children:"Adicionar forma"})}),(()=>{const J=un(),Xe=Lr(),He=(l||[]).reduce((en,sn)=>en+Number(sn.quantity||0)*Number(sn.price||0),0),fe=Lt?.tipo,Ve=Number(Lt?.valor||0);let xe=0;fe==="percentual"&&Ve>0?xe=He*(Ve/100):fe==="fixo"&&Ve>0&&(xe=Ve);const kt=Math.max(0,He-xe),st=Math.max(0,kt+Xe);let zt=st-J,pr=0;return zt<0&&(pr=Math.abs(zt),zt=0),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"flex justify-between font-semibold border-t border-border pt-1 mt-1",children:[a.jsx("span",{children:"Total a pagar"}),a.jsxs("span",{children:["R$ ",st.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between pt-1",children:[a.jsx("span",{className:"text-text-secondary",children:"Pagamentos"}),a.jsxs("span",{children:["R$ ",J.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between font-semibold",children:[a.jsx("span",{children:"Restante"}),a.jsxs("span",{className:Math.abs(zt)<.005?"text-success":"text-warning",children:["R$ ",zt.toFixed(2)]})]}),pr>0&&a.jsxs("div",{className:"flex justify-between font-semibold text-text-secondary",children:[a.jsx("span",{children:"Troco"}),a.jsxs("span",{children:["R$ ",pr.toFixed(2)]})]})]})})()]})]}),a.jsxs(Ga,{className:"sticky bottom-0 bg-surface/95 backdrop-blur supports-[backdrop-filter]:bg-surface/75 border-t border-border",children:[a.jsx(Z,{variant:"outline",onClick:()=>W(!1),disabled:G,children:"Cancelar"}),a.jsx(Z,{onClick:ra,disabled:G,children:G?"Processando...":"Confirmar Pagamento"})]})]})}),ft&&a.jsx(ioe,{comanda:{id:n,desconto_tipo:Lt?.tipo,desconto_valor:Number(Lt?.valor||0),desconto_motivo:Lt?.motivo||""},subtotal:(l||[]).reduce((J,Xe)=>J+Number(Xe.quantity||0)*Number(Xe.price||0),0),onApply:async()=>{try{const{data:J}=await Q.from("comandas").select("desconto_tipo, desconto_valor, desconto_motivo").eq("id",n).single();Dt({tipo:J?.desconto_tipo||null,valor:Number(J?.desconto_valor||0),motivo:J?.desconto_motivo||""})}catch{}bt(!1)},onClose:()=>bt(!1),codigoEmpresa:r?.codigo_empresa}),a.jsx(Un,{open:pn,onOpenChange:J=>on(J),children:a.jsxs(zn,{className:"max-w-lg",onOpenAutoFocus:J=>J.preventDefault(),onKeyDown:J=>J.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Identificar Cliente"}),a.jsx(ma,{children:"Selecione um cliente cadastrado para esta venda."})]}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"w-full",children:[a.jsx(ct,{className:"mb-1 block",children:"Buscar cliente"}),a.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Nome, e-mail, telefone ou cdigo",className:"pl-9",value:br,onChange:J=>ur(J.target.value),onKeyDown:J=>J.stopPropagation()})]}),a.jsx(Z,{type:"button",size:"icon",title:"Cadastrar cliente",className:"ml-2 bg-brand text-black hover:bg-brand/90 border border-brand",onClick:()=>{window.location.href="/clientes"},children:a.jsx(so,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"mt-2 max-h-48 overflow-auto border rounded-md thin-scroll",children:a.jsxs("ul",{children:[(an||[]).map(J=>{const Xe=(Gr||[]).includes(J.id);return a.jsxs("li",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-surface-2 ${J?.codigo===0?"bg-warning/10 border-l-4 border-warning":""} ${Xe?"bg-surface-2":""}`,onClick:()=>{ha(He=>{const fe=new Set(He||[]);fe.has(J.id)?fe.delete(J.id):fe.add(J.id);const Ve=Array.from(fe);try{localStorage.setItem(Tn.pendingClientIds,JSON.stringify(Ve))}catch{}return Ve})},children:[a.jsx("div",{children:a.jsxs("div",{className:"font-medium",children:[J.codigo!=null?String(J.codigo)+" - ":"",J.nome,J?.codigo===0&&a.jsx("span",{className:"ml-2 text-xs text-warning",children:"(Padro)"})]})}),a.jsx(Di,{size:16,className:Xe?"text-success":"text-text-muted opacity-40"})]},J.id)}),(!an||an.length===0)&&a.jsx("li",{className:"p-2 text-sm text-text-muted",children:"Nenhum cliente encontrado."})]})})]})}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>on(!1),children:"Fechar"}),a.jsx(Z,{onClick:async()=>{try{const J=Array.from(new Set(Gr||[]));if(J.length===0){e({title:"Selecione pelo menos um cliente",variant:"warning"});return}const Xe=r?.codigo_empresa;if(n){try{const{data:Ve,error:xe}=await Q.from("comandas").select("id").eq("id",n).eq("codigo_empresa",Xe).single();if(xe||!Ve){console.error("[ClientWizard] Comanda no encontrada:",n),e({title:"Comanda invlida",description:"A comanda no existe mais. Reiniciando...",variant:"warning"}),s(null),c([]),ke(!1),b("");try{localStorage.removeItem(Tn.comandaId),localStorage.removeItem(Tn.items),localStorage.removeItem(Tn.customerName),localStorage.removeItem(Tn.clientChosen)}catch{}on(!1);return}}catch(Ve){console.error("[ClientWizard] Erro ao validar comanda:",Ve),e({title:"Erro de validao",variant:"destructive"});return}try{await rw({comandaId:n,clienteIds:J,nomesLivres:[],codigoEmpresa:Xe,replace:!0})}catch(Ve){if(Ve?.message?.includes("violates foreign key")){console.error("[ClientWizard] Foreign key error, limpando cache:",Ve),s(null),c([]);try{localStorage.removeItem(Tn.comandaId),localStorage.removeItem(Tn.items)}catch{}e({title:"Comanda invlida",description:"Reinicie a venda.",variant:"destructive"}),on(!1);return}if(!Ve?.message?.includes("duplicate"))throw Ve}const fe=(await nl({comandaId:n,codigoEmpresa:Xe})||[]).map(Ve=>Ve?.nome).filter(Boolean);b(fe.length?fe.join(", "):""),ke(!0),on(!1)}else{if(!Xe){e({title:"Empresa no definida",variant:"destructive"});return}try{h(!0);const He=await $2({codigoEmpresa:Xe});if(!He?.id){e({title:"Falha ao abrir venda",description:"No foi possvel criar a comanda.",variant:"destructive"});return}const fe=He.id;await rw({comandaId:fe,clienteIds:J,nomesLivres:[],codigoEmpresa:Xe,replace:!0}),s(fe);const Ve=(an||[]).filter(kt=>J.includes(kt.id)).map(kt=>kt?.nome).filter(Boolean),xe=Ve.length?Ve.join(", "):"";b(xe),ke(!0);try{localStorage.setItem(Tn.comandaId,String(fe)),localStorage.setItem(Tn.customerName,xe||""),localStorage.setItem(Tn.clientChosen,"true"),localStorage.removeItem(Tn.pendingClientIds)}catch{}try{await ee(fe,2)}catch{}on(!1)}catch(He){console.error("[ClientWizard] Erro ao criar comanda de balco:",He),e({title:"Falha ao iniciar venda",description:He?.message||"Tente novamente.",variant:"destructive"});return}finally{h(!1)}}if(E){const He=E;S(null),await nr(He,{skipClientCheck:!0})}}catch(J){e({title:"Falha ao iniciar venda",description:J?.message||"Tente novamente",variant:"destructive"})}},children:"Confirmar"})]})]})}),a.jsx(Un,{open:!!he,onOpenChange:J=>!J&&ot(null),children:a.jsx(zn,{className:"sm:max-w-[425px]",children:he&&a.jsxs(a.Fragment,{children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-lg",children:he.name}),a.jsx(ma,{className:"text-sm",children:"Detalhes do item"})]}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Preo Unitrio"}),a.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Number(he.price).toFixed(2)]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:async J=>{J.stopPropagation();const Xe=r?.codigo_empresa;if(!Xe){e({title:"Empresa no definida",variant:"destructive"});return}const He=Math.max(0,he.quantity-1);try{He<=0?(await Dv({itemId:he.id,codigoEmpresa:Xe}),ot(null)):(await Qd({itemId:he.id,quantidade:He,codigoEmpresa:Xe}),ot({...he,quantity:He}));const fe=await ci({comandaId:n,codigoEmpresa:Xe});c((fe||[]).map(Ve=>({id:Ve.id,productId:Ve.produto_id,name:Ve.descricao||"Item",price:Number(Ve.preco_unitario||0),quantity:Number(Ve.quantidade||1)})))}catch(fe){e({title:"Erro ao atualizar quantidade",description:fe?.message||"Tente novamente",variant:"destructive"})}},children:"-"}),a.jsx("span",{className:"w-8 text-center font-semibold",children:he.quantity}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:async J=>{J.stopPropagation();const Xe=r?.codigo_empresa;if(!Xe){e({title:"Empresa no definida",variant:"destructive"});return}const He=he.quantity+1;try{await Qd({itemId:he.id,quantidade:He,codigoEmpresa:Xe}),ot({...he,quantity:He});const fe=await ci({comandaId:n,codigoEmpresa:Xe});c((fe||[]).map(Ve=>({id:Ve.id,productId:Ve.produto_id,name:Ve.descricao||"Item",price:Number(Ve.preco_unitario||0),quantity:Number(Ve.quantidade||1)})))}catch(fe){e({title:"Erro ao atualizar quantidade",description:fe?.message||"Tente novamente",variant:"destructive"})}},children:"+"})]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Subtotal"}),a.jsxs("p",{className:"text-lg font-bold",children:["R$ ",(he.quantity*he.price).toFixed(2)]})]})]}),a.jsx(Ga,{children:a.jsx(Z,{variant:"destructive",onClick:async()=>{try{const J=r?.codigo_empresa;if(!J){e({title:"Empresa no definida",variant:"destructive"});return}await Dv({itemId:he.id,codigoEmpresa:J});const Xe=await ci({comandaId:n,codigoEmpresa:J});c((Xe||[]).map(He=>({id:He.id,productId:He.produto_id,name:He.descricao||"Item",price:Number(He.preco_unitario||0),quantity:Number(He.quantidade||1)}))),ot(null),e({title:"Item removido",variant:"success"})}catch(J){e({title:"Falha ao remover item",description:J?.message||"Tente novamente",variant:"destructive"})}},children:"Remover Item"})})]})})}),Wt&&a.jsx("div",{className:"fixed left-3 right-3 z-[9999] md:hidden",role:"alert","aria-live":"assertive",style:{bottom:"calc(12px + env(safe-area-inset-bottom, 0px))"},children:a.jsxs("div",{className:"pointer-events-none flex items-start gap-2 rounded-md border border-amber-500 bg-amber-400 text-black px-3 py-2 shadow-lg",children:[a.jsx(Pd,{className:"h-4 w-4 mt-0.5","aria-hidden":"true"}),a.jsx("div",{className:"text-sm font-semibold leading-snug drop-shadow-[0_1px_0_rgba(255,255,255,0.25)]",children:Me||"Ateno"})]})})]})}async function loe({userId:e,scope:t}){if(!e||!t)return null;try{const{data:r,error:n}=await Q.from("user_ui_settings").select("settings").eq("user_id",e).eq("scope",t).maybeSingle();return n?(console.error("[user_ui_settings] getUserUISettings:error",n),null):r?.settings||null}catch(r){return console.error("[user_ui_settings] getUserUISettings:exception",r),null}}async function coe({userId:e,scope:t,settings:r}){if(!(!e||!t))try{const n={user_id:e,scope:t,settings:r||{},updated_at:new Date().toISOString()},{error:s}=await Q.from("user_ui_settings").upsert(n,{onConflict:"user_id,scope"});s&&console.error("[user_ui_settings] saveUserUISettings:error",s)}catch(n){console.error("[user_ui_settings] saveUserUISettings:exception",n)}}function gC(e){try{const r=new DOMParser().parseFromString(e,"text/xml"),n=r.querySelector("parsererror");if(n)throw new Error("XML invlido: "+n.textContent);const s=wst(r),o=jst(r),i=_st(r),l=Nst(r),c=i.reduce((u,f)=>u+(f.valorTotal||0),0),d={produtos:i,fornecedor:o,pagamentos:l,nfe:{...s,totalNota:c},success:!0};return console.log("[XMLParser] Resultado final:",d),{data:d,success:!0}}catch(t){return console.error("[XMLParser] Erro ao fazer parse do XML:",t),{produtos:[],fornecedor:null,nfe:null,success:!1,error:t.message}}}function wst(e){const t=e.querySelector("ide");if(!t)return null;let r="";const n=e.querySelector("chNFe");if(n&&(r=n.textContent.trim()),!r){const s=e.querySelector("infNFe");if(s){const o=s.getAttribute("Id");o&&(r=o.replace("NFe",""))}}return{numero:Ua(t,"nNF"),serie:Ua(t,"serie"),dataEmissao:Ua(t,"dhEmi"),chaveAcesso:r,tipo:Ua(t,"tpNF")==="0"?"Entrada":"Sada",naturezaOperacao:Ua(t,"natOp"),modelo:Ua(t,"mod")||null}}function jst(e){const t=e.querySelector("emit");return t?{cnpj:Ua(t,"CNPJ"),razaoSocial:Ua(t,"xNome"),nomeFantasia:Ua(t,"xFant"),endereco:{logradouro:Ua(t,"xLgr"),numero:Ua(t,"nro"),bairro:Ua(t,"xBairro"),cidade:Ua(t,"xMun"),uf:Ua(t,"UF"),cep:Ua(t,"CEP"),codigoIBGE:Ua(t,"cMun"),fone:Ua(t,"fone")},ie:Ua(t,"IE"),iest:Ua(t,"IEST"),im:Ua(t,"IM"),crt:Ua(t,"CRT")}:null}function _st(e){const t=e.querySelectorAll("det"),r=new Map;return t.forEach((n,s)=>{const o=n.querySelector("prod"),i=n.querySelector("imposto");if(!o)return;const l=Ua(o,"cProd"),c=Ua(o,"cEAN"),d=Ua(o,"xProd"),u=parseFloat(Ua(o,"qCom")||"0"),f=c&&c!=="SEM GTIN"?`ean:${c}`:l?`cod:${l}`:`nome:${d.toLowerCase().trim()}`;if(r.has(f)){const h=r.get(f);h.quantidade+=u,h.valorTotal+=parseFloat(Ua(o,"vProd")||"0")}else{const h={codigo:l,ean:c,nome:d,ncm:Ua(o,"NCM"),cest:Ua(o,"CEST"),cfop:Ua(o,"CFOP"),unidade:Ua(o,"uCom"),quantidade:u,valorUnitario:parseFloat(Ua(o,"vUnCom")||"0"),precoVenda:parseFloat(Ua(o,"vUnCom")||"0"),valorTotal:parseFloat(Ua(o,"vProd")||"0"),desconto:parseFloat(Ua(o,"vDesc")||"0"),impostos:Cst(i),descricao:d,origem:s+1};r.set(f,h)}}),Array.from(r.values())}function Nst(e){const t=e.querySelectorAll("pag"),r=[];return t.forEach(n=>{const s=Ua(n,"tPag"),o=parseFloat(Ua(n,"vPag")||"0");s&&r.push({codigoSefaz:s,valor:o,nome:Sst(s)})}),console.log("[XMLParser] Pagamentos extrados:",r),r}function Sst(e){return{"01":"Dinheiro","02":"Cheque","03":"Carto de Crdito","04":"Carto de Dbito","05":"Carto da Loja",10:"Vale Alimentao",11:"Vale Refeio",12:"Vale Presente",13:"Vale Combustvel",14:"Duplicata Mercantil",15:"Boleto Bancrio",16:"Depsito Bancrio",17:"PIX Dinmico",18:"Transferncia Bancria",19:"Programa de Fidelidade",20:"PIX Esttico",21:"Crdito em Loja",22:"Pagamento Eletrnico",90:"Sem Pagamento",99:"Outros"}[e]||"Outros"}function Cst(e){if(!e)return{};const t={},r=e.querySelector("ICMS");if(r){const i=r.children[0];i&&(t.icms={cst:Ua(i,"CST"),csosn:Ua(i,"CSOSN"),aliquota:parseFloat(Ua(i,"pICMS")||"0"),valor:parseFloat(Ua(i,"vICMS")||"0"),orig:Ua(i,"orig"),fcpAliquota:parseFloat(Ua(i,"pFCP")||"0"),mva:parseFloat(Ua(i,"pMVAST")||"0"),pRedBC:parseFloat(Ua(i,"pRedBC")||"0")})}const n=e.querySelector("PIS");if(n){const i=n.children[0];i&&(t.pis={cst:Ua(i,"CST"),aliquota:parseFloat(Ua(i,"pPIS")||"0"),valor:parseFloat(Ua(i,"vPIS")||"0")})}const s=e.querySelector("COFINS");if(s){const i=s.children[0];i&&(t.cofins={cst:Ua(i,"CST"),aliquota:parseFloat(Ua(i,"pCOFINS")||"0"),valor:parseFloat(Ua(i,"vCOFINS")||"0")})}const o=e.querySelector("IPI");if(o){const i=o.querySelector("IPITrib");i&&(t.ipi={cst:Ua(i,"CST"),aliquota:parseFloat(Ua(i,"pIPI")||"0"),valor:parseFloat(Ua(i,"vIPI")||"0")})}return t}function Ua(e,t){if(!e)return"";const r=e.querySelector(t);return r?r.textContent.trim():""}function xC(e,t){const r=e.unidade?.toUpperCase().trim()||"";if(e.ean&&e.ean!=="SEM GTIN"){const s=t.find(i=>{const l=i.unit?.toUpperCase().trim()||"";return i.barcode===e.ean&&l===r});if(s)return s;const o=t.find(i=>i.barcode===e.ean);o&&console.log("[xmlParser] EAN igual mas unidade diferente (no considerar o mesmo produto):",{ean:e.ean,unidadeXML:r,unidadeSistema:(o.unit||"").toUpperCase()})}if(e.codigo){const s=t.find(i=>{const l=i.unit?.toUpperCase().trim()||"";return i.code===e.codigo&&l===r});if(s)return s;const o=t.find(i=>i.code===e.codigo);o&&console.log("[xmlParser] Cdigo igual mas unidade diferente (no considerar o mesmo produto):",{codigo:e.codigo,unidadeXML:r,unidadeSistema:(o.unit||"").toUpperCase()})}const n=e.nome?.toLowerCase().trim()||"";if(n){const s=t.find(o=>{const i=o.name?.toLowerCase().trim()||"",l=o.unit?.toUpperCase().trim()||"",c=i===n,d=l===r,u=c&&d;return c&&!d&&(console.log("[xmlParser] Nome igual mas UNIDADE diferente - NO  o mesmo produto:"),console.log("  Nome XML:",n,"| Unidade XML:",r),console.log("  Nome Sistema:",i,"| Unidade Sistema:",l)),u&&(console.log("[xmlParser] MATCH ENCONTRADO (nome + unidade):"),console.log("  XML:",n,"| Unidade:",r),console.log("  Sistema:",i,"| Unidade:",l),console.log("  Produto:",o)),u});if(s)return console.log("[xmlParser] Produto existente encontrado por nome + unidade:",s.name,s.unit),s}return console.log("[xmlParser] Nenhum produto encontrado para:",n,"| Unidade:",r),null}function L3(e,t){const r=e.valorUnitario||0,n=30,s=r>0?r/(1-n/100):0;return{code:e.codigo||"",name:e.nome||"",barcode:e.ean&&e.ean!=="SEM GTIN"?e.ean:"",ncm:e.ncm||"",cest:e.cest||"",unit:e.unidade||"UN",costPrice:r,salePrice:s,price:s,stock:0,minStock:0,status:"active",active:!0,type:"Venda",category:"Importados",cfopInterno:e.cfop||"",cstIcmsInterno:e.impostos?.icms?.cst||"",csosnInterno:e.impostos?.icms?.csosn||"",aliqIcmsInterno:e.impostos?.icms?.aliquota||0,fcpPercent:e.impostos?.icms?.fcpAliquota||0,mvaPercent:e.impostos?.icms?.mva||0,baseReduzidaPercent:e.impostos?.icms?.pRedBC||0,cstPisEntrada:e.impostos?.pis?.cst||"",aliqPisPercent:e.impostos?.pis?.aliquota||0,aliqCofinsPercent:e.impostos?.cofins?.aliquota||0,cstIpi:e.impostos?.ipi?.cst||"",aliqIpiPercent:e.impostos?.ipi?.aliquota||0,codigo_empresa:t,importedViaXML:!0,dataImportacao:new Date,xmlChave:e?.xmlChave||null,xmlNumero:e?.xmlNumero||null,xmlSerie:e?.xmlSerie||null,xmlEmissao:e?.xmlEmissao||null}}async function Ast(e,t){if(!e||!t)return null;const r=e.replace(/\D/g,"");try{const{data:n,error:s}=await Q.from("clientes").select("*").eq("codigo_empresa",t).eq("cnpj",r).eq("flag_fornecedor",!0).maybeSingle();if(s)throw s;return n}catch(n){throw console.error("[Suppliers] Erro ao buscar fornecedor:",n),n}}async function Pst(e,t){if(!e||!t)throw new Error("Dados do fornecedor e cdigo da empresa so obrigatrios");const r=e.cnpj?.replace(/\D/g,"")||"";if(!r)throw new Error("CNPJ do fornecedor no encontrado no XML");const n={codigo_empresa:t,tipo_pessoa:"PJ",cnpj:r,nome:e.razaoSocial||"Fornecedor Importado",apelido:e.nomeFantasia||e.razaoSocial,flag_fornecedor:!0,flag_cliente:!1,status:"active",endereco:e.endereco?.logradouro||null,numero:e.endereco?.numero||null,complemento:e.endereco?.complemento||null,bairro:e.endereco?.bairro||null,cidade:e.endereco?.cidade||null,uf:e.endereco?.uf||null,cep:e.endereco?.cep?.replace(/\D/g,"")||null,cidade_ibge:e.endereco?.codigoIBGE||null,telefone:e.endereco?.fone||null,ie:e.ie||null,iest:e.iest||null,im:e.im||null};try{const{data:s,error:o}=await Q.from("clientes").insert(n).select().single();if(o)throw o;return console.log("[Suppliers] Fornecedor criado:",s),s}catch(s){throw console.error("[Suppliers] Erro ao criar fornecedor:",s),s}}async function Est(e,t){if(!e?.cnpj)throw new Error("CNPJ do fornecedor no encontrado no XML");try{const r=await Ast(e.cnpj,t);if(r){console.log("[Suppliers] Fornecedor encontrado:",r.razao_social||r.nome);const s={},o=e.endereco||{},i=l=>l==null||String(l).trim()===""?null:l;return!i(r.ie)&&i(e.ie)&&(s.ie=e.ie),!i(r.iest)&&i(e.iest)&&(s.iest=e.iest),!i(r.im)&&i(e.im)&&(s.im=e.im),!i(r.endereco)&&i(o.logradouro)&&(s.endereco=o.logradouro),!i(r.numero)&&i(o.numero)&&(s.numero=o.numero),!i(r.complemento)&&i(o.complemento)&&(s.complemento=o.complemento),!i(r.bairro)&&i(o.bairro)&&(s.bairro=o.bairro),!i(r.cidade)&&i(o.cidade)&&(s.cidade=o.cidade),!i(r.uf)&&i(o.uf)&&(s.uf=o.uf),!i(r.cep)&&i(o.cep)&&(s.cep=String(o.cep).replace(/\D/g,"")),!i(r.cidade_ibge)&&i(o.codigoIBGE)&&(s.cidade_ibge=o.codigoIBGE),!i(r.telefone)&&i(o.fone)&&(s.telefone=o.fone),!i(r.nome)&&i(e.razaoSocial)&&(s.nome=e.razaoSocial),!i(r.apelido)&&(i(e.nomeFantasia)||i(e.razaoSocial))&&(s.apelido=e.nomeFantasia||e.razaoSocial),Object.keys(s).length>0?(await Q.from("clientes").update(s).eq("id",r.id),console.log("[Suppliers] Fornecedor atualizado com campos faltantes:",s),{...r,...s}):r}return console.log("[Suppliers] Criando novo fornecedor:",e.razaoSocial),await Pst(e,t)}catch(r){throw console.error("[Suppliers] Erro ao buscar/criar fornecedor:",r),r}}async function kst(e){if(!e)return[];try{const{data:t,error:r}=await Q.from("clientes").select("*").eq("codigo_empresa",e).eq("flag_fornecedor",!0).order("nome",{ascending:!0});if(r)throw r;return t||[]}catch(t){return console.error("[Suppliers] Erro ao listar fornecedores:",t),[]}}async function Ist(e,t){if(!e||!t)return null;try{const{data:r,error:n}=await Q.from("compras").select("*").eq("codigo_empresa",t).eq("chave_nfe",e).order("ativo",{ascending:!1}).maybeSingle();if(n)throw n;return r}catch(r){throw console.error("[Purchases] Erro ao buscar compra:",r),r}}async function Ost(e){const t={codigo_empresa:e.codigoEmpresa,fornecedor_id:e.fornecedorId,chave_nfe:e.chaveNfe,numero_nfe:e.numeroNfe,serie_nfe:e.serieNfe,data_emissao:e.dataEmissao,tipo_operacao:e.tipoOperacao,natureza_operacao:e.naturezaOperacao,valor_produtos:e.valorProdutos,valor_total:e.valorTotal,forma_pagamento:e.formaPagamento||null,status:"processada",observacoes:e.observacoes||null,xml_completo:e.xmlCompleto||null};try{const{data:r,error:n}=await Q.from("compras").insert(t).select().single();if(n)throw n;return console.log("[Purchases] Compra criada:",r.numero_nfe,"ID:",r.id),r}catch(r){throw console.error("[Purchases] Erro ao criar compra:",r),r}}async function doe(e,t){if(!e||!t||t.length===0)throw new Error("ID da compra e itens so obrigatrios");const r=t.map(n=>({compra_id:e,produto_id:n.produtoId||null,codigo_produto_xml:n.codigoProdutoXML||null,nome_produto_xml:n.nomeProdutoXML,ean_xml:n.eanXML||null,ncm_xml:n.ncmXML||null,cfop_xml:n.cfopXML||null,unidade_xml:n.unidadeXML||null,quantidade:n.quantidade,valor_unitario:n.valorUnitario,valor_total:n.valorTotal,valor_desconto:n.valorDesconto||0,valor_frete:n.valorFrete||0,valor_seguro:n.valorSeguro||0,valor_outras_despesas:n.valorOutrasDespesas||0,icms_aliquota:n.icmsAliquota||null,icms_valor:n.icmsValor||null,ipi_aliquota:n.ipiAliquota||null,ipi_valor:n.ipiValor||null,pis_aliquota:n.pisAliquota||null,pis_valor:n.pisValor||null,cofins_aliquota:n.cofinsAliquota||null,cofins_valor:n.cofinsValor||null,vinculado_manualmente:n.vinculadoManualmente||!1,observacoes:n.observacoes||null,selecionado_na_importacao:n.selecionadoNaImportacao||!1}));try{const{data:n,error:s}=await Q.from("compras_itens").insert(r).select();if(s)throw s;return console.log("[Purchases] Itens criados:",n.length),n}catch(n){throw console.error("[Purchases] Erro ao criar itens:",n),n}}async function Tst(e,t={}){if(!e)return{data:[],count:0};try{const r=t.page&&t.page>0?t.page:1,n=t.pageSize&&t.pageSize>0?t.pageSize:100,s=(r-1)*n,o=s+n-1;let i=Q.from("compras").select("*,fornecedor:clientes!compras_fornecedor_id_fkey(id,nome,cnpj)",{count:"exact"}).eq("codigo_empresa",e);t.apenasInativas?i=i.eq("ativo",!1):t.incluirInativas||(i=i.eq("ativo",!0)),t.status&&(i=i.eq("status",t.status)),t.fornecedorId&&(i=i.eq("fornecedor_id",t.fornecedorId)),t.dataInicio&&(i=i.gte("data_emissao",t.dataInicio)),t.dataFim&&(i=i.lte("data_emissao",t.dataFim)),i=i.order("data_emissao",{ascending:!1}).range(s,o);const{data:l,error:c,count:d}=await i;if(c)throw c;return{data:l||[],count:d??0}}catch(r){return console.error("[Purchases] Erro ao listar compras:",r),{data:[],count:0}}}async function uoe(e){try{const{data:t,error:r}=await Q.from("compras_itens").select(`
        *,
        produto:produto_id(id, nome, codigo_produto, codigo_barras, data_importacao)
      `).eq("compra_id",e).order("criado_em",{ascending:!0});if(r)throw console.error("[Purchases] Erro ao buscar itens:",r),r;return t}catch(t){throw console.error("[Purchases] Erro ao buscar itens:",t),t}}async function Dst(e,t,r){if(!e||!t)throw new Error("ID da compra e motivo so obrigatrios");try{const{data:n,error:s}=await Q.from("compras").update({ativo:!1,motivo_inativacao:t,inativado_em:new Date().toISOString(),inativado_por:r}).eq("id",e).select().single();if(s)throw s;return console.log("[Purchases] Compra inativada:",e),n}catch(n){throw console.error("[Purchases] Erro ao inativar compra:",n),n}}async function Mst(e){try{console.log("[Purchases] Deletando itens da compra:",e);const{error:t}=await Q.from("compras_itens").delete().eq("compra_id",e);if(t)throw console.error("[Purchases] Erro ao deletar itens:",t),t;return console.log("[Purchases] Itens deletados com sucesso"),!0}catch(t){throw console.error("[Purchases] Erro ao deletar itens:",t),t}}async function Rst(e,t){try{return console.log("[Purchases] Reprocessando XML da compra:",e),await Mst(e),await doe(e,t),console.log("[Purchases] XML reprocessado com sucesso"),!0}catch(r){throw console.error("[Purchases] Erro ao reprocessar XML:",r),r}}async function Fst(e,t){try{console.log("[Purchases] Atualizando compra:",e,t);const{data:r,error:n}=await Q.from("compras").update({fornecedor_id:t.fornecedorId,numero_nfe:t.numeroNfe,serie_nfe:t.serieNfe,data_emissao:t.dataEmissao,tipo_operacao:t.tipoOperacao,natureza_operacao:t.naturezaOperacao,valor_produtos:t.valorProdutos,valor_total:t.valorTotal,forma_pagamento:t.formaPagamento,observacoes:t.observacoes,atualizado_em:new Date().toISOString()}).eq("id",e).select().single();if(n)throw console.error("[Purchases] Erro ao atualizar compra:",n),n;return console.log("[Purchases] Compra atualizada:",r),r}catch(r){throw console.error("[Purchases] Erro ao atualizar compra:",r),r}}function foe({isOpen:e,onClose:t,onSelect:r,currentProduct:n}){const{userProfile:s}=lo(),[o,i]=p.useState([]),[l,c]=p.useState(!0),[d,u]=p.useState(""),[f,h]=p.useState(null);p.useEffect(()=>{e&&s?.codigo_empresa&&m()},[e,s?.codigo_empresa]);const m=async()=>{try{c(!0),console.log("[ProductSelectionModal] Carregando produtos para empresa:",s.codigo_empresa);const y=await uf({codigoEmpresa:s.codigo_empresa,includeInactive:!1,search:""});console.log("[ProductSelectionModal] Produtos carregados:",y?.length||0),console.log("[ProductSelectionModal] Primeiro produto:",y?.[0]),console.log("[ProductSelectionModal] Estrutura do produto:",Object.keys(y?.[0]||{})),i(y||[])}catch(y){console.error("[ProductSelectionModal] Erro ao carregar produtos:",y),i([])}finally{c(!1)}},x=p.useMemo(()=>{if(console.log("[ProductSelectionModal] Filtrando produtos. Total:",o.length,"Busca:",d),!d.trim())return o;const y=d.toLowerCase().trim(),b=o.filter(w=>(w.name||w.nome)?.toLowerCase().includes(y)||(w.code||w.codigo_produto)?.toLowerCase().includes(y)||(w.barcode||w.codigo_barras)?.toLowerCase().includes(y));return console.log("[ProductSelectionModal] Produtos filtrados:",b.length),b},[o,d]),g=()=>{f?(console.log("[ProductSelectionModal] Produto selecionado para vinculao:",f),console.log("[ProductSelectionModal] ID do produto:",f.id),console.log("[ProductSelectionModal] Nome do produto:",f.name),r(f),v()):console.log("[ProductSelectionModal] ERRO: Nenhum produto selecionado")},v=()=>{u(""),h(null),t()};return a.jsx(Un,{open:e,onOpenChange:v,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-3xl max-h-[80vh] overflow-hidden flex flex-col bg-black text-white border border-neutral-700",children:[a.jsxs(Bn,{className:"bg-neutral-900 -mx-6 -mt-6 mb-4 px-6 py-4 border-b border-neutral-600",children:[a.jsxs(Ln,{className:"flex items-center gap-2 text-white",children:[a.jsx(bu,{className:"h-5 w-5 text-yellow-500"}),"Selecionar Produto para Vinculao"]}),a.jsx(ma,{className:"text-neutral-300",children:"Busque e selecione um produto cadastrado para vincular ao item do XML"})]}),a.jsx("div",{className:"px-6 pb-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-400"}),a.jsx(It,{placeholder:"Buscar por nome, cdigo do produto ou cdigo de barras...",value:d,onChange:y=>u(y.target.value),className:"pl-10 bg-neutral-900 border-neutral-600 text-white placeholder-neutral-400 focus:border-yellow-500",autoFocus:!0})]})}),a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col px-6",children:l?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500 mb-4"}),a.jsx("p",{className:"text-neutral-400",children:"Carregando produtos..."})]})}):x.length===0?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(bu,{className:"h-12 w-12 text-neutral-400 mx-auto mb-4"}),a.jsx("p",{className:"text-neutral-400",children:d?"Nenhum produto encontrado":"Nenhum produto cadastrado"}),d&&a.jsx("p",{className:"text-sm text-neutral-500 mt-2",children:"Tente buscar por nome, cdigo ou cdigo de barras"})]})}):a.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:a.jsx("ul",{className:"space-y-2",children:x.map(y=>{const b=y.code||y.codigo_produto,w=y.name||y.nome||"Produto sem nome",j=y.stock||y.estoque||0,_=Number(y.salePrice||y.preco_venda||0),C=f?.id===y.id;return a.jsxs("li",{className:`flex items-center gap-3 p-3 rounded-lg transition-all cursor-pointer border-2 ${C?"border-yellow-500 bg-yellow-500/10":"border-neutral-600 bg-black hover:border-yellow-400 hover:bg-neutral-900"}`,onClick:()=>h(y),children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsxs("p",{className:"font-semibold text-white truncate",title:`${b?`[${b}] `:""}${w}`,children:[b&&a.jsxs("span",{className:"text-neutral-400",children:["[",b,"]"]})," ",w]})}),a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("p",{className:"text-sm text-neutral-300",children:["R$ ",_.toFixed(2)]}),a.jsxs("span",{className:"text-xs font-medium text-neutral-400 whitespace-nowrap",children:["Estoque: ",j]})]})]}),C&&a.jsx(Fm,{className:"h-5 w-5 text-yellow-500 flex-shrink-0"})]},y.id)})})})}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-neutral-600 px-6 pb-6",children:[a.jsxs("div",{className:"text-sm text-neutral-400",children:[x.length," produto",x.length!==1?"s":"",d&&` encontrado${x.length!==1?"s":""}`]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:"outline",onClick:v,className:"border-neutral-600 text-neutral-300 hover:bg-neutral-700",children:"Cancelar"}),a.jsxs(Z,{onClick:g,disabled:!f,className:"gap-2 bg-yellow-600 hover:bg-yellow-700 text-black",children:[a.jsx(Fm,{className:"h-4 w-4"}),"Vincular Produto"]})]})]})]})})}function moe({isOpen:e,onClose:t,onConfirm:r,products:n,editedProducts:s,isReprocess:o=!1,allProducts:i=[]}){if(!e||!n)return null;const l=n.filter(d=>d.selected),c=l.reduce((d,u,f)=>{const h=u.originalIndex!==void 0?u.originalIndex:f,m=s[h]||{},x=m.linkedProductId,g=m.updatePrice,v=Number(m.quantity||m.qty||u.xml?.quantidade||0);let y=0;if(m.salePrice!=null?y=Number(m.salePrice):m.margin!=null&&u.xml?.valorUnitario?y=Number(u.xml.valorUnitario)*(1+m.margin/100):u.xml?.precoVenda&&(y=Number(u.xml.precoVenda)),u.isNew&&!x)d.newProducts.push({name:m.name||u.xml?.nome,quantity:v,price:y,total:v*(u.xml?.valorUnitario||0),xmlName:u.xml?.nome});else if(x||u.existing){const b=x&&i.find(E=>E.id===x)||u.existing,w=Number(b?.stock||0),j=Number(b?.preco_venda||b?.salePrice||b?.price||0),_=o?0:v,C=o?w:w+v;d.updatedProducts.push({name:b?.name||m.name||u.xml?.nome,currentStock:w,newStock:C,stockChange:_,currentPrice:j,newPrice:g?y:j,priceChange:g?y-j:0,willUpdatePrice:g,total:v*(u.xml?.valorUnitario||0),xmlName:u.xml?.nome,isLinked:!!x,linkedProductId:x,linkedProductName:x?b?.name:null})}else x&&d.linkedProducts.push({xmlName:u.xml?.nome,linkedName:m.name||u.xml?.nome,quantity:v,total:v*(u.xml?.valorUnitario||0),linkedProductId:x});return d.totalValue+=v*(u.xml?.valorUnitario||0),d.totalItems+=v,d},{newProducts:[],updatedProducts:[],linkedProducts:[],totalValue:0,totalItems:0});return a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsx(Bn,{children:a.jsxs(Ln,{className:"flex items-center gap-2",children:[a.jsx(Kf,{className:"h-5 w-5 text-warning"}),"Confirmar ",o?"Reprocessamento":"Importao"]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(bu,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Total de Produtos"})]}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:l.length})]}),a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(Wue,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Total de Itens"})]}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:c.totalItems})]}),a.jsxs("div",{className:"bg-surface border border-border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary mb-2",children:[a.jsx(Wi,{className:"h-4 w-4 text-warning"}),a.jsx("span",{className:"font-medium",children:"Valor Total"})]}),a.jsxs("p",{className:"text-2xl font-bold text-text-primary",children:["R$ ",c.totalValue.toFixed(2)]})]})]}),!o&&c.newProducts.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(so,{className:"h-4 w-4 text-success"}),"Produtos que sero criados (",c.newProducts.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:c.newProducts.map((d,u)=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-text-primary",children:d.name}),a.jsxs("p",{className:"text-sm text-text-muted",children:["Quantidade: ",d.quantity,"  Preo unit.: R$ ",(d.total/d.quantity).toFixed(2),"  Total: R$ ",d.total.toFixed(2)]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",d.total.toFixed(2)]})})]},u))})]}),!o&&c.updatedProducts.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Ig,{className:"h-4 w-4 text-info"}),"Produtos que sero atualizados (",c.updatedProducts.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:c.updatedProducts.map((d,u)=>a.jsx("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[d.isLinked?a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(jG,{className:"h-4 w-4 text-warning"}),a.jsxs("p",{className:"font-medium text-text-primary",children:[d.xmlName,"  ",d.linkedProductName||d.name]})]}):a.jsx("p",{className:"font-medium text-text-primary",children:d.name}),a.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[o?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Estoque:"}),a.jsx("span",{className:"font-medium text-text-primary",children:d.currentStock}),a.jsx("span",{className:"text-text-muted",children:"(sem alterao no reprocesso)"})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Estoque:"}),a.jsx("span",{className:"font-medium text-text-primary",children:d.currentStock}),a.jsx(Lm,{className:"h-3 w-3 text-success"}),a.jsx("span",{className:"font-medium text-success",children:d.newStock}),a.jsxs("span",{className:"text-success",children:["(+",d.stockChange,")"]})]}),d.willUpdatePrice&&d.priceChange!==0&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Preo:"}),a.jsxs("span",{className:"font-medium text-text-primary",children:["R$ ",d.currentPrice.toFixed(2)]}),d.priceChange>0?a.jsx(Lm,{className:"h-3 w-3 text-success"}):a.jsx(ife,{className:"h-3 w-3 text-destructive"}),a.jsxs("span",{className:`font-medium ${d.priceChange>0?"text-success":"text-destructive"}`,children:["R$ ",d.newPrice.toFixed(2)]}),a.jsxs("span",{className:d.priceChange>0?"text-success":"text-destructive",children:["(",d.priceChange>0?"+":"","R$ ",d.priceChange.toFixed(2),")"]})]})]})]}),a.jsxs("div",{className:"text-right",children:[o?a.jsxs("p",{className:"text-xs text-text-muted",children:["Total NF-e (custo): R$ ",d.total.toFixed(2)]}):a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit.: R$ ",(d.total/d.stockChange).toFixed(2)]}),a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",d.total.toFixed(2)]})]})]})},u))})]}),o&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(Ig,{className:"h-4 w-4 text-info"}),"Itens da NF-e que sero reprocessados (",l.length,")"]})}),a.jsx("div",{className:"p-4 space-y-3",children:l.map((d,u)=>{const f=d.originalIndex!==void 0?d.originalIndex:u,h=s[f]||{},m=Number(h.quantity||h.qty||d.xml?.quantidade||0),x=Number(d.xml?.valorUnitario||0),g=m*x;return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-text-primary",children:d.xml?.nome}),a.jsxs("p",{className:"text-sm text-text-muted",children:["Quantidade: ",m,"  Valor unit.: R$ ",x.toFixed(2),"  Total: R$ ",g.toFixed(2)]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"font-medium text-warning",children:["R$ ",g.toFixed(2)]})})]},u)})})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Kf,{className:"h-5 w-5 text-warning flex-shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-warning mb-2",children:o?"Ateno - Reprocessamento":"Ateno - Importao"}),a.jsxs("ul",{className:"text-sm text-text-muted space-y-1",children:[o?a.jsxs(a.Fragment,{children:[a.jsx("li",{children:" Os itens atuais da compra sero substitudos pelos selecionados"}),a.jsx("li",{children:" As quantidades de estoque sero ajustadas conforme as mudanas"}),a.jsx("li",{children:" Esta ao no pode ser desfeita automaticamente"})]}):a.jsxs(a.Fragment,{children:[a.jsx("li",{children:" Os produtos selecionados sero criados ou atualizados no sistema"}),a.jsx("li",{children:" As quantidades sero adicionadas ao estoque atual"}),a.jsx("li",{children:" Uma nova compra ser registrada no histrico"})]}),a.jsx("li",{children:" Verifique cuidadosamente as informaes antes de confirmar"})]})]})]})})]}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[a.jsxs("div",{className:"text-sm text-text-muted",children:[l.length," produto",l.length!==1?"s":""," selecionado",l.length!==1?"s":""]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:"outline",onClick:t,children:"Cancelar"}),a.jsxs(Z,{onClick:r,className:"gap-2",children:[a.jsx(Ig,{className:"h-4 w-4"}),"Confirmar ",o?"Reprocessamento":"Importao"]})]})]})]})})}function Lst({open:e,onOpenChange:t,products:r,codigoEmpresa:n,onSuccess:s}){const{toast:o}=Zs(),[i,l]=p.useState("upload"),[c,d]=p.useState(null),[u,f]=p.useState(null),[h,m]=p.useState([]),[x,g]=p.useState(!1),[v,y]=p.useState({created:0,updated:0,errors:0,details:[]}),[b,w]=p.useState({}),[j,_]=p.useState({}),[C,E]=p.useState({isOpen:!1,productIndex:null,currentProduct:null}),[S,A]=p.useState({isOpen:!1}),M=()=>{const L=u?.nfe?.modelo;return L==="55"?"NF-e":L==="65"?"NFC-e":"NF-e / NFC-e"},O=async L=>{const H=L.target.files?.[0];if(!H){console.log("[XMLImport] Nenhum arquivo selecionado");return}if(console.log("[XMLImport] Arquivo selecionado:",H.name),!H.name.endsWith(".xml")){o({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}d(H);try{console.log("[XMLImport] Lendo contedo do arquivo...");const ie=await H.text();console.log("[XMLImport] Arquivo lido, parseando XML...");const Y=gC(ie);if(console.log("[XMLImport] XML parseado:",Y),!Y.success){o({title:"Erro ao ler XML",description:Y.error||"XML invlido",variant:"destructive"});return}if(!Y.data?.produtos||Y.data.produtos.length===0){o({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}f(Y.data);let W=r;try{W=await uf({search:"",codigoEmpresa:n,includeInactive:!0})||r,console.log("[XMLImport] Produtos carregados para validao:",W.length),console.log("[XMLImport] Nomes dos produtos:",W.map(te=>te.name))}catch(G){console.warn("[XMLImport] No foi possvel carregar lista completa, usando cache:",G)}const se=Y.data.produtos.map((G,te)=>{const oe=xC(G,W),De={...G};if(G.impostos){const{icms:re,pis:ae,cofins:ut,ipi:pt}=G.impostos;re&&(De.icmsAliquota=re.aliquota??De.icmsAliquota,De.icmsValor=re.valor??De.icmsValor),pt&&(De.ipiAliquota=pt.aliquota??De.ipiAliquota,De.ipiValor=pt.valor??De.ipiValor),ae&&(De.pisAliquota=ae.aliquota??De.pisAliquota,De.pisValor=ae.valor??De.pisValor),ut&&(De.cofinsAliquota=ut.aliquota??De.cofinsAliquota,De.cofinsValor=ut.valor??De.cofinsValor)}return{xml:De,existing:oe,isNew:!oe,willCreate:!oe,willUpdate:!!oe,selected:!0,index:te}});m(se);const pe={};se.forEach((G,te)=>{G.xml.precoVenda&&(pe[te]={salePrice:Number(G.xml.precoVenda)})}),console.log("[XMLImport] Pr-populando editedProducts:",pe),w(pe),console.log("[XMLImport] Preview preparado, mudando para step preview. Total produtos:",se.length),l("preview")}catch(ie){console.error("[XMLImport] Erro ao processar arquivo:",ie),o({title:"Erro ao processar XML",description:ie.message,variant:"destructive"})}},I=()=>{A({isOpen:!0})},T=async()=>{A({isOpen:!1});let L="";if(c)try{L=await c.text()}catch(W){console.error("[XMLImport] Erro ao ler XML:",W),o({title:"Erro ao ler XML",description:"No foi possvel ler o arquivo XML.",variant:"destructive"});return}l("processing"),g(!0);const H={created:0,updated:0,errors:0,skipped:0,details:[],supplierId:null},ie=h.filter(W=>W.selected);if(ie.length===0){o({title:"Nenhum produto selecionado",description:"Selecione ao menos um produto para importar.",variant:"warning"}),g(!1),l("preview");return}let Y=null;if(u?.fornecedor)try{Y=await Est(u.fornecedor,n),H.supplierId=Y.id,console.log("[XMLImport] Fornecedor processado:",Y.razao_social,"ID:",Y.id)}catch(W){console.error("[XMLImport] Erro ao processar fornecedor:",W),o({title:"Aviso",description:"No foi possvel criar/vincular o fornecedor, mas os produtos sero importados.",variant:"warning"})}console.log("[XMLImport] Processando apenas produtos selecionados:",ie.length);for(const W of ie){const se=b[W.index]||{},pe=se.name||W.xml.nome,G=se.qty!==void 0?se.qty:Number(W.xml.quantidade),te=se.margin,oe=se.salePrice,De=se.linkedProductId;try{if(De&&De!=="force-new"){G>0&&await Zv({productId:De,delta:G,codigoEmpresa:n}),H.updated++,H.details.push({produto:pe,acao:`Vinculado - Estoque atualizado (+${G})`,status:"success"});continue}if(W.isNew||De==="force-new"){const re=L3(W.xml,n);if(se.name&&(re.name=se.name),oe!=null)re.salePrice=oe,re.price=oe;else if(te!=null&&te>0){const ae=re.costPrice||0;if(ae>0){const ut=ae*(1+te/100);re.salePrice=ut,re.price=ut}}else re.salePrice!=null&&re.price==null&&(re.price=re.salePrice);re.stock=G,re.initialStock=G,re.currentStock=G,re.importedViaXML=!0,re.category="Importados",u?.nfe&&(re.xmlChave=u.nfe.chaveAcesso||null,re.xmlNumero=u.nfe.numero||null,re.xmlSerie=u.nfe.serie||null,re.xmlEmissao=u.nfe.dataEmissao||null);try{await pC(re,{codigoEmpresa:n}),H.created++,H.details.push({produto:pe,acao:"Criado",status:"success"})}catch(ae){if(ae.message?.includes("duplicate")||ae.message?.includes("unique constraint")){console.warn("[XMLImport] Produto j existe, tentando atualizar estoque:",W.xml.nome);const pt=(await uf({search:W.xml.nome,codigoEmpresa:n,includeInactive:!0})).find(ft=>{const bt=(ft.name||"").toLowerCase().trim()===(W.xml.nome||"").toLowerCase().trim(),Lt=(ft.unit||"").toUpperCase().trim()===(W.xml.unidade||"").toUpperCase().trim(),Dt=(ft.barcode||"")===(W.xml.ean||""),Bt=(ft.code||"")===(W.xml.codigo||""),ge=bt&&Lt||Dt&&Lt||Bt&&Lt;return!ge&&(Dt||Bt)&&!Lt&&console.log("[XMLImport] Encontrado mesmo EAN/Cdigo porm unidade diferente. NO unir:",{nomeSistema:ft.name,unidadeSistema:ft.unit,nomeXML:W.xml.nome,unidadeXML:W.xml.unidade,ean:W.xml.ean,codigo:W.xml.codigo}),ge});if(pt&&Number(W.xml.quantidade)>0)await Zv({productId:pt.id,delta:Number(W.xml.quantidade)||0,codigoEmpresa:n}),H.updated++,H.details.push({produto:W.xml.nome,acao:"J existe - Estoque atualizado",status:"success"});else if(pt)H.skipped++,H.details.push({produto:W.xml.nome,acao:"Sem quantidade para ajustar",status:"warning"});else try{console.log("[XMLImport] Duplicate report mas no encontrou por nome+unidade/EAN+unidade/cdigo+unidade. Tentando criar novo produto.");const ft=L3(W.xml,n);ft.salePrice!=null&&ft.price==null&&(ft.price=ft.salePrice);const bt=Number(W.xml.quantidade)||0;ft.stock=bt,ft.initialStock=bt,ft.currentStock=bt,await pC(ft,{codigoEmpresa:n}),H.created++,H.details.push({produto:W.xml.nome,acao:"Criado aps checagem",status:"success"})}catch(ft){console.warn("[XMLImport] Falhou ao criar aps duplicate:",ft),H.skipped++,H.details.push({produto:W.xml.nome,acao:"Falha ao criar aps duplicate",status:"warning"})}}else throw ae}}else{const re=Number(W.xml.quantidade)||0;if(re>0&&await Zv({productId:W.existing.id,delta:re,codigoEmpresa:n}),se.updatePrice===!0){const ut=Number(W.xml.valorUnitario)||0;if(ut>0)try{const pt={costPrice:ut};if(oe!=null)pt.salePrice=oe,pt.price=oe;else if(te!=null&&te>0){const ft=ut*(1+te/100);pt.salePrice=ft,pt.price=ft}await U1(W.existing.id,pt)}catch(pt){console.warn("[XMLImport] Falha ao atualizar preo do produto existente",pt)}}try{const ut=W.existing||{},pt=W.xml.impostos||{},ft=pt.icms||{},bt=pt.pis||{},Lt=pt.cofins||{},Dt=pt.ipi||{},Bt={},ge=wt=>wt==null||typeof wt=="string"&&wt.trim()==="";ge(ut.ncm)&&W.xml.ncm&&(Bt.ncm=W.xml.ncm),ge(ut.cfopInterno)&&W.xml.cfop&&(Bt.cfopInterno=W.xml.cfop),ge(ut.cstIcmsInterno)&&ft.cst&&(Bt.cstIcmsInterno=ft.cst),ge(ut.csosnInterno)&&ft.csosn&&(Bt.csosnInterno=ft.csosn),ge(ut.cstIpi)&&Dt.cst&&(Bt.cstIpi=Dt.cst),ge(ut.cstPisEntrada)&&bt.cst&&(Bt.cstPisEntrada=bt.cst),ut.aliqIcmsInterno==null&&Number(ft.aliquota||0)>0&&(Bt.aliqIcmsInterno=Number(ft.aliquota)),ut.aliqIpiPercent==null&&Number(Dt.aliquota||0)>=0&&(Bt.aliqIpiPercent=Number(Dt.aliquota)),ut.aliqPisPercent==null&&Number(bt.aliquota||0)>=0&&(Bt.aliqPisPercent=Number(bt.aliquota)),ut.aliqCofinsPercent==null&&Number(Lt.aliquota||0)>=0&&(Bt.aliqCofinsPercent=Number(Lt.aliquota)),ut.fcpPercent==null&&Number(ft.fcpAliquota||0)>0&&(Bt.fcpPercent=Number(ft.fcpAliquota)),ut.mvaPercent==null&&Number(ft.mva||0)>0&&(Bt.mvaPercent=Number(ft.mva)),ut.baseReduzidaPercent==null&&Number(ft.pRedBC||0)>0&&(Bt.baseReduzidaPercent=Number(ft.pRedBC)),Object.keys(Bt).length>0&&(await U1(W.existing.id,Bt),console.log("[XMLImport] Produto existente atualizado com fiscais faltantes",{id:W.existing.id,patch:Bt}))}catch(ut){console.warn("[XMLImport] Falha ao completar fiscais no produto existente",ut)}H.updated++,H.details.push({produto:W.xml.nome,acao:re>0?`Estoque +${re} (somado)`:"Verificado",status:"success"})}}catch(re){console.error("[XMLImport] Erro ao processar produto:",W.xml.nome,re),H.errors++,H.details.push({produto:W.xml.nome,acao:"Erro",status:"error",error:re.message})}}if(u?.nfe?.chaveAcesso&&Y)try{const W=await Ist(u.nfe.chaveAcesso,n);let se=W;if(!W||!W.ativo){const G={codigoEmpresa:n,fornecedorId:Y.id,chaveNfe:u.nfe.chaveAcesso,numeroNfe:u.nfe.numero,serieNfe:u.nfe.serie,dataEmissao:u.nfe.dataEmissao,tipoOperacao:u.nfe.tipo||"Entrada",naturezaOperacao:u.nfe.naturezaOperacao,valorProdutos:u.nfe.totalNota||0,valorTotal:u.nfe.totalNota||0,xmlCompleto:L,formaPagamento:u.pagamentos&&u.pagamentos.length>0?u.pagamentos.map(te=>te.nome).join(", "):null};se=await Ost(G),console.log("[XMLImport] Nova compra registrada:",se.numero_nfe)}else console.log("[XMLImport] NF-e j existe, adicionando novos itens:",W.numero_nfe),H.purchaseAlreadyExists=!0;const pe=ie.map(G=>{const te=b[G.index]||{},oe=te.linkedProductId;let De=null;return oe&&oe!=="force-new"?De=oe:G.existing&&!oe&&(De=G.existing.id),{produtoId:De,codigoProdutoXML:G.xml.codigo,nomeProdutoXML:G.xml.nome,eanXML:G.xml.ean,ncmXML:G.xml.ncm,cfopXML:G.xml.cfop,unidadeXML:G.xml.unidade,quantidade:te.qty!==void 0?te.qty:Number(G.xml.quantidade),valorUnitario:Number(G.xml.valorUnitario)||0,valorTotal:Number(G.xml.valorTotal)||0,valorDesconto:G.xml.valorDesconto||0,valorFrete:G.xml.valorFrete||0,valorSeguro:G.xml.valorSeguro||0,valorOutrasDespesas:G.xml.valorOutrasDespesas||0,icmsAliquota:G.xml.icmsAliquota,icmsValor:G.xml.icmsValor,ipiAliquota:G.xml.ipiAliquota,ipiValor:G.xml.ipiValor,pisAliquota:G.xml.pisAliquota,pisValor:G.xml.pisValor,cofinsAliquota:G.xml.cofinsAliquota,cofinsValor:G.xml.cofinsValor,vinculadoManualmente:!!te.linkedProductId,observacoes:te.observacoes||null,selecionadoNaImportacao:G.selected}});await doe(se.id,pe),console.log("[XMLImport] Itens adicionados  compra:",pe.length),H.purchaseId=se.id}catch(W){console.error("[XMLImport] Erro ao registrar compra:",W)}y(H),g(!1),l("done"),H.purchaseAlreadyExists?o({title:"NF-e j importada!",description:`Esta NF-e j existe no sistema. ${H.created} produto(s) criado(s), ${H.updated} atualizado(s).`,variant:"warning"}):H.errors===0?o({title:"Importao concluda!",description:`${H.created} produto(s) criado(s), ${H.updated} atualizado(s).`,variant:"success"}):o({title:"Importao concluda com erros",description:`${H.created} criado(s), ${H.updated} atualizado(s), ${H.errors} erro(s).`,variant:"warning"}),s&&s()},k=()=>{console.log("[XMLImport] Fechando modal"),l("upload"),d(null),f(null),m([]),w({}),_({}),y({created:0,updated:0,errors:0,details:[]}),t(!1)};Ce.useEffect(()=>{e&&console.log("[XMLImport] Modal aberto. Step atual:",i)},[e,i]);const q=()=>{l("upload"),d(null),f(null),m([]),w({}),_({})},B=L=>{m(H=>H.map((ie,Y)=>Y===L?{...ie,selected:!ie.selected}:ie))},z=()=>{const L=h.every(H=>H.selected);m(H=>H.map(ie=>({...ie,selected:!L})))},F=(L,H,ie)=>{w(Y=>({...Y,[L]:{...Y[L],[H]:ie}}))},V=(L,H)=>{console.log("[XMLImportModal] handleLinkProduct chamado:",{index:L,productId:H}),console.log("[XMLImportModal] Estado editedProducts completo antes:",b),console.log("[XMLImportModal] Estado editedProducts[index] antes:",b[L]),w(ie=>{console.log("[XMLImportModal] Estado prev no setEditedProducts:",ie);const Y={...ie,[L]:{...ie[L],linkedProductId:H}};return console.log("[XMLImportModal] Novo estado editedProducts:",Y),Y})},me=(L,H)=>!L||!H?0:L*(1+H/100),be=(L,H,ie)=>b[L]?.[H]??ie,U=L=>{_(H=>({...H,[L]:!H[L]}))};return a.jsxs(Un,{open:e,onOpenChange:k,children:[a.jsxs(zn,{className:"w-[95vw] sm:max-w-4xl max-h-[85vh] flex flex-col",children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsxs(Ln,{className:"flex items-center gap-2 text-2xl font-bold",children:[a.jsx("span",{children:"Importar XML de Compra"}),u?.nfe&&a.jsx("span",{className:"inline-flex items-center rounded-full bg-surface-2 border border-border px-2 py-0.5 text-xs font-semibold text-text-muted uppercase tracking-wide",children:M()})]}),a.jsxs(ma,{children:[i==="upload"&&"Selecione o arquivo XML da nota fiscal de entrada",i==="preview"&&"Revise os produtos que sero importados",i==="processing"&&"Processando produtos...",i==="done"&&"Importao finalizada"]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-2 py-1",children:[i==="upload"&&a.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:a.jsx("div",{className:"w-full max-w-md",children:a.jsxs("label",{htmlFor:"xml-upload",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-border rounded-lg cursor-pointer bg-surface hover:bg-surface-2 transition-colors",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(tD,{className:"w-12 h-12 mb-4 text-text-muted"}),a.jsx("p",{className:"mb-2 text-sm text-text-primary font-semibold",children:"Clique para selecionar ou arraste o arquivo"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Arquivo XML de NF-e (Nota Fiscal Eletrnica)"})]}),a.jsx("input",{id:"xml-upload",type:"file",accept:".xml",className:"hidden",onChange:O})]})})}),i==="preview"&&a.jsxs("div",{className:"space-y-4",children:[u?.nfe&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"font-semibold mb-2",children:["Informaes da ",M()]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",a.jsx("span",{className:"font-mono",children:u.nfe.numero})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",a.jsx("span",{className:"font-mono",children:u.nfe.serie})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Tipo:"})," ",a.jsx("span",{children:u.nfe.tipo})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Fornecedor:"})," ",a.jsx("span",{children:u.fornecedor?.razaoSocial})]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2 min-w-[200px]",children:[a.jsxs("div",{className:"bg-brand/10 rounded-lg p-3 border border-brand/20",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Valor Total NF-e"}),a.jsxs("p",{className:"text-xl font-bold text-brand",children:["R$ ",Number(u.nfe.totalNota||0).toFixed(2)]})]}),u.pagamentos&&u.pagamentos.length>0&&a.jsxs("div",{className:"bg-success/10 rounded-lg p-2.5 border border-success/20",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Forma de Pagamento"}),a.jsx("p",{className:"text-sm font-semibold text-success",children:u.pagamentos.map(L=>L.nome).join(", ")})]})]})]}),u.nfe.chaveAcesso&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-border",children:[a.jsx("span",{className:"text-text-muted text-xs",children:"Chave de Acesso:"}),a.jsx("p",{className:"font-mono text-xs break-all",children:u.nfe.chaveAcesso})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4 px-2",children:[a.jsx(Z,{variant:"outline",size:"sm",onClick:z,children:h.every(L=>L.selected)?"Desmarcar Todos":"Selecionar Todos"}),a.jsxs("span",{className:"text-sm text-text-muted",children:[h.filter(L=>L.selected).length," de ",h.length," selecionados"]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3 text-base",children:"Produtos Encontrados"}),a.jsx("div",{className:"space-y-2",children:h.map((L,H)=>{const ie=be(H,"linkedProductId",null),Y=be(H,"name",L.xml.nome),W=be(H,"quantity",L.xml.quantidade),se=be(H,"margin",L.xml.margem),pe=be(H,"salePrice",null),G=L.xml.valorUnitario||0;let te=pe;te==null&&!L.isNew&&L.existing&&(te=Number(L.existing.preco_venda||L.existing.salePrice||L.existing.price||0)),te==null&&se!=null&&(te=me(G,se)),te==null&&L.xml.precoVenda&&(te=Number(L.xml.precoVenda));let oe=null;if(se!=null)oe=se;else if(te!=null&&G>0&&te>0){const re=(te-G)/G*100;oe=Math.max(-999,Math.min(9999,re))}const De=j[H];return a.jsxs("div",{className:Pr("rounded-lg border transition-all",L.selected?L.isNew?"bg-success/10 border-success/30":"bg-info/10 border-info/30":"bg-surface opacity-60 border-border"),children:[a.jsxs("div",{className:"p-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("input",{type:"checkbox",checked:L.selected,onChange:()=>B(H),className:"w-4 h-4 rounded border-border accent-warning cursor-pointer"}),a.jsx("button",{onClick:()=>U(H),className:"p-0.5 hover:bg-surface-2 rounded transition-colors",children:De?a.jsx(hx,{className:"w-4 h-4 text-text-muted"}):a.jsx(Kg,{className:"w-4 h-4 text-text-muted"})}),a.jsx("div",{children:L.isNew?a.jsx(so,{className:"w-5 h-5 text-success"}):a.jsx(Ig,{className:"w-5 h-5 text-info"})})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:Y}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-text-muted mt-0.5",children:[L.xml.codigo&&a.jsxs("span",{className:"flex-shrink-0",children:["#",L.xml.codigo]}),a.jsxs("span",{children:["Qtd: ",W]})]})]}),a.jsx("div",{className:"flex-shrink-0 ml-2",children:L.isNew?a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-success/20 text-success font-medium",children:"Novo"}):a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-info/20 text-info font-medium",children:"Cadastrado"})})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-muted",children:[a.jsxs("span",{children:["R$ ",Number(G).toFixed(2),te?`  R$ ${te.toFixed(2)}`:""]}),oe!=null&&a.jsxs("span",{className:"ml-2 "+(oe>0?"text-success":oe<0?"text-destructive":"text-text-muted"),children:[oe.toFixed(1),"%"]})]})]})]}),De&&a.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3 border-t border-border/50",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Nome do Produto"}),a.jsx("input",{type:"text",value:Y,onChange:re=>F(H,"name",re.target.value),disabled:!L.selected,className:"w-full px-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>F(H,"qty",Math.max(0,W-1)),disabled:!L.selected||W<=0,className:"w-9 h-9 rounded-md border border-border bg-surface hover:bg-surface-2 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:a.jsx(_v,{className:"w-4 h-4"})}),a.jsx("input",{type:"text",value:W,onChange:re=>{const ae=re.target.value.replace(/\D/g,"");F(H,"qty",ae===""?0:Number(ae))},disabled:!L.selected,className:"w-14 text-center px-2 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50"}),a.jsx("button",{type:"button",onClick:()=>F(H,"qty",W+1),disabled:!L.selected,className:"w-9 h-9 rounded-md bg-warning hover:bg-warning/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center text-black font-bold shadow-sm",children:a.jsx(so,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Margem %"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:(()=>{const re=be(H,"margin",null);if(re!=null)return String(re);if(!L.isNew&&L.existing&&G>0){const ae=Number(L.existing.preco_venda||L.existing.salePrice||L.existing.price||0);if(ae>0)return((ae-G)/G*100).toFixed(1)}return""})(),onChange:re=>{const ae=re.target.value;if(ae===""){F(H,"margin",null);return}const ut=ae.replace(/[^0-9.,\-]/g,"").replace(",",".");if(ut==="."||ut==="-"||ut==="-.")return;const pt=parseFloat(ut);if(!isNaN(pt)&&(F(H,"margin",pt),G>0)){const ft=me(G,pt);F(H,"salePrice",ft)}},disabled:!L.selected,placeholder:"0",className:"w-24 pl-3 pr-6 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right"}),a.jsx("span",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Custo"}),a.jsx("div",{className:"px-3 py-2 bg-surface/50 rounded-md border border-border",children:a.jsxs("span",{className:"text-sm font-semibold",children:["R$ ",G.toFixed(2)]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Preo Venda"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"R$"}),a.jsx("input",{type:"text",value:(()=>{const re=be(H,"salePrice",te);return re==null?"":Number(re).toFixed(2).replace(".",",")})(),onChange:re=>{const ae=re.target.value.replace(/\D/g,"");if(ae===""){F(H,"salePrice",null);return}const ut=Number(ae)/100;if(F(H,"salePrice",ut),ut>0&&G>0){const pt=(ut-G)/G*100;F(H,"margin",Math.round(pt*100)/100)}},disabled:!L.selected,placeholder:"0,00",className:"w-28 pl-7 pr-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right font-semibold text-success"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:L.isNew?"Vincular a Produto Existente (Opcional)":"Ao para este Produto"}),a.jsx("div",{className:"flex gap-2",children:a.jsxs(Zn,{value:ie==="force-new"?"force-new":ie||(L.isNew?"new":L.existing?.id||"new"),onValueChange:re=>{re==="new"||re===L.existing?.id?V(H,null):re==="search"?E({isOpen:!0,productIndex:H,currentProduct:L}):V(H,re)},disabled:!L.selected,children:[a.jsx(Yn,{className:"flex-1 hover:bg-white/5 transition-colors text-xs sm:text-sm",children:a.jsx(ta,{placeholder:L.isNew?"Criar novo":"Atualizar existente",children:ie&&ie!=="force-new"&&ie!=="new"?(()=>{const re=r?.find(ae=>ae.id===ie);return re?`Vinculado: ${re.name}`:L.isNew?"Criar novo":"Atualizar existente"})():ie==="force-new"?"Criar novo (ignorar)":L.isNew?"Criar novo":"Atualizar existente"})}),a.jsxs(Jn,{className:"max-h-[300px] overflow-y-auto text-xs sm:text-sm",children:[L.isNew?a.jsx(nt,{value:"new",children:"Criar novo produto"}):a.jsxs(nt,{value:L.existing?.id||"new",children:["Atualizar: ",L.existing?.name," (Estoque: ",L.existing?.stock||0,")"]}),!L.isNew&&a.jsx(nt,{value:"force-new",children:"Criar novo (ignorar existente)"}),a.jsx(nt,{value:"search",children:"Buscar produto para vincular"})]})]})})]}),!L.isNew&&a.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:be(H,"updatePrice",!1),onChange:re=>F(H,"updatePrice",re.target.checked),disabled:!L.selected,className:"w-4 h-4 rounded border-border bg-surface text-brand focus:ring-2 focus:ring-brand/50 disabled:opacity-50 disabled:cursor-not-allowed"}),a.jsx("span",{className:"text-text-secondary",children:"Atualizar preo de custo e venda deste produto"})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[L.xml.codigo&&a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["Cdigo: ",L.xml.codigo]}),L.xml.ean&&L.xml.ean!=="SEM GTIN"&&a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["EAN: ",L.xml.ean]}),a.jsxs("span",{className:"px-2 py-1 bg-surface rounded border border-border",children:["Unidade: ",L.xml.unidade]})]})]})]},H)})})]}),a.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-success"}),a.jsxs("span",{children:[h.filter(L=>L.isNew&&L.selected).length," novos"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-info"}),a.jsxs("span",{children:[h.filter(L=>!L.isNew&&L.selected).length," existentes"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-warning"}),a.jsxs("span",{children:[h.filter(L=>b[L.index]?.linkedProductId).length," vinculados"]})]})]})]}),i==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(cl,{className:"w-12 h-12 animate-spin text-warning mb-4"}),a.jsx("p",{className:"text-lg font-semibold",children:"Processando produtos..."}),a.jsx("p",{className:"text-sm text-text-muted",children:"Aguarde enquanto importamos os produtos"})]}),i==="done"&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-6 border border-border text-center",children:[a.jsx(Di,{className:"w-16 h-16 text-success mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Importao Concluda!"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-success",children:v.created}),a.jsx("p",{className:"text-sm text-text-muted",children:"Criados"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-info",children:v.updated}),a.jsx("p",{className:"text-sm text-text-muted",children:"Atualizados"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-danger",children:v.errors}),a.jsx("p",{className:"text-sm text-text-muted",children:"Erros"})]})]})]}),v.details.length>0&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Detalhes"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:v.details.map((L,H)=>a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[L.status==="success"?a.jsx(Di,{className:"w-4 h-4 text-success flex-shrink-0"}):a.jsx(Pd,{className:"w-4 h-4 text-danger flex-shrink-0"}),a.jsx("span",{className:"flex-1 truncate",children:L.produto}),a.jsx("span",{className:Pr("text-xs px-2 py-1 rounded",L.status==="success"?"bg-success/20 text-success":"bg-danger/20 text-danger"),children:L.acao})]},H))})]})]})]}),a.jsxs(Ga,{children:[i==="upload"&&a.jsx(Z,{variant:"outline",onClick:k,children:"Cancelar"}),i==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:q,children:"Voltar"}),a.jsxs(Z,{onClick:I,disabled:h.filter(L=>L.selected).length===0,children:["Confirmar Importao (",h.filter(L=>L.selected).length," de ",h.length," produtos)"]})]}),i==="done"&&a.jsx(Z,{onClick:k,children:"Fechar"})]})]}),a.jsx(foe,{isOpen:C.isOpen,onClose:()=>E({isOpen:!1,productIndex:null,currentProduct:null}),onSelect:L=>{console.log("[XMLImportModal] onSelect chamado com produto:",L),console.log("[XMLImportModal] Index do produto:",C.productIndex),V(C.productIndex,L.id),E({isOpen:!1,productIndex:null,currentProduct:null})},currentProduct:C.currentProduct}),a.jsx(moe,{isOpen:S.isOpen,onClose:()=>A({isOpen:!1}),onConfirm:T,products:h.map((L,H)=>({...L,originalIndex:H})),editedProducts:b,allProducts:r,isReprocess:!1})]})}const $st=[],Bst=[],qst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},$3={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},mV="produtosPage:settings";function zst(e){const t=["Cdigo","Produto","Categoria","Tipo","Unidade","Preo Custo","Preo Venda","% Lucro","Estoque","Estoque Mn.","Validade","Status","Ativo","EAN-13","EAN-13 Caixa","Referncia","Marca","Grupo","NCM","Descrio NCM","CEST","Usar CSOSN","CFOP Interno","CST ICMS Interno","CSOSN Interno","Aliq ICMS Interno (%)","CFOP Externo","CST ICMS Externo","CSOSN Externo","Aliq ICMS Externo (%)","CST PIS Entrada","CST PIS Sada","Aliq PIS (%)","Aliq COFINS (%)","CST IPI","Aliq IPI (%)","FCP (%)","MVA (%)","Base Reduzida (%)"],r=";",n=g=>{const v=Number(g??0);return Number.isFinite(v)?v.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):"0,00"},s=g=>`R$ ${n(g)}`,o=g=>{const v=Number(g??0);return Number.isFinite(v)?v.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},i=g=>{if(!g)return"";try{if(typeof g=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(g)){const[y,b,w]=g.split("-");return`${w}/${b}/${y}`}const v=new Date(g);if(!isNaN(v)){const y=String(v.getDate()).padStart(2,"0"),b=String(v.getMonth()+1).padStart(2,"0"),w=v.getFullYear();return`${y}/${b}/${w}`}}catch{}return String(g)},l=g=>g==="active"?"Ativo":g==="low_stock"?"Estoque Baixo":g==="inactive"?"Inativo":"",c=g=>g?"Sim":"No",d=g=>g??"",u=g=>{const v=g==null?"":String(g);return/[";\n]/.test(v)?`"${v.replace(/"/g,'""')}"`:v},f=[];f.push("\uFEFF"+t.join(r));for(const g of e){const v=[d(g.code),d(g.name),d(g.category),d(g.type),d(g.unit),s(g.costPrice),s(g.price??g.salePrice),o(g.marginPercent),Number(g.stock??0),Number(g.minStock??0),i(g.validade),l(g.status),c(g.active!==!1),d(g.barcode),d(g.barcodeBox),d(g.reference),d(g.brand),d(g.group),d(g.ncm),d(g.ncmDescription),d(g.cest),g.useCsosn?"Sim":"",d(g.cfopInterno),d(g.cstIcmsInterno),d(g.csosnInterno),o(g.aliqIcmsInterno),d(g.cfopExterno),d(g.cstIcmsExterno),d(g.csosnExterno),o(g.aliqIcmsExterno),d(g.cstPisEntrada),d(g.cstPisSaida),o(g.aliqPisPercent),o(g.aliqCofinsPercent),d(g.cstIpi),o(g.aliqIpiPercent),o(g.fcpPercent),o(g.mvaPercent),o(g.baseReduzidaPercent)].map(u).join(r);f.push(v)}const h=new Blob([f.join(`
`)],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(h),x=document.createElement("a");x.href=m,x.download="produtos.csv",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m)}function pd(e,{action:t}={}){const r=String(e?.message||e||"").toLowerCase();if(r.includes("categoria possui produtos ativos vinculados"))return{title:"No  possvel remover",description:"Existem produtos ativos vinculados a esta categoria. Inative ou recategoriz-os antes."};if(r.includes("categoria no encontrada"))return{title:"Categoria no encontrada",description:"No foi possvel localizar a categoria para desativao."};if(r.includes("duplicate key")&&r.includes("ux_produtos_empresa_codigo_produto"))return{title:"Cdigo j cadastrado",description:"J existe um produto com este cdigo na sua empresa. Informe outro cdigo."};if(r.includes("duplicate key")&&r.includes("unique constraint"))return{title:"Registro j existe",description:"J existe um registro com estes dados."};if(r.includes("permission denied")||r.includes("violates row-level security")||r.includes("rls"))return{title:"Sem permisso",description:"Voc no tem permisso para executar esta ao."};const n=r.match(/null value in column "([^"]+)" violates not-null constraint/);return n?{title:"Campo obrigatrio",description:`Preencha o campo "${n[1].replace(/_/g," ")}".`}:r.includes("invalid input syntax")||r.includes("invalid input value")?{title:"Valor invlido",description:"Revise os valores informados (formato invlido)."}:r.includes("violates check constraint")?{title:"Valor invlido",description:"Os dados informados no atendem s regras do sistema."}:r.includes("violates foreign key constraint")?r.includes("update or delete on table")?{title:"No  possvel excluir",description:"Existem registros vinculados que impedem a excluso."}:{title:"Relao invlida",description:"O registro relacionado no foi encontrado ou  invlido."}:r.includes("failed to fetch")||r.includes("networkerror")||r.includes("network error")?{title:"Falha de conexo",description:"Verifique sua internet e tente novamente."}:r.includes("timeout")?{title:"Tempo esgotado",description:"A operao demorou demais. Tente novamente."}:r.includes("rate limit")||r.includes("too many requests")||r.includes("status code 429")?{title:"Muitas solicitaes",description:"Aguarde alguns segundos e tente novamente."}:t==="save"?{title:"Falha ao salvar",description:"No foi possvel salvar o produto. Tente novamente."}:t==="delete"?{title:"Falha ao inativar",description:"No foi possvel inativar o produto."}:t==="fetch"?{title:"Erro ao carregar",description:"No foi possvel atualizar a lista de produtos."}:t==="export"?{title:"Falha ao exportar",description:"No foi possvel gerar o arquivo."}:{title:"Erro",description:e?.message||"Ocorreu um erro."}}const Tk=({icon:e,title:t,value:r,subtitle:n,color:s,onClick:o,isActive:i})=>{const l=e;return a.jsxs(Fr.div,{variants:$3,className:Pr("bg-surface rounded-2xl border-2 p-3 sm:p-4 flex flex-col justify-between gap-2 cursor-pointer transition-all duration-300",i?`${s}/30 border-${s}`:"border-border hover:border-border-hover"),onClick:o,children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[a.jsx("p",{className:"text-text-secondary text-xs sm:text-sm font-semibold leading-snug whitespace-nowrap overflow-hidden text-ellipsis",children:t}),a.jsx(l,{className:Pr("w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0",s)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold text-text-primary leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:r}),a.jsx("p",{className:"hidden sm:block text-xs text-text-muted",children:n})]})]})};function Ust({open:e,onOpenChange:t,product:r,onSave:n,categories:s,onCreateCategory:o,suggestedCode:i,onRefreshProducts:l,products:c}){const{toast:d}=Zs(),{userProfile:u}=lo(),[f,h]=p.useState("dados"),[m,x]=p.useState(r?.code||""),[g,v]=p.useState(r?.name||""),[y,b]=p.useState(r?.category||""),[w,j]=p.useState(r?.type||"Venda"),[_,C]=p.useState(r?.unit||"UN"),[E,S]=p.useState(r?.active??!0),[A,M]=p.useState(r?.barcode||""),[O,I]=p.useState(r?.barcodeBox||""),[T,k]=p.useState(r?.reference||""),[q,B]=p.useState(r?.brand||""),[z,F]=p.useState(r?.group||""),[V,me]=p.useState(!!r?.allowSale),[be,U]=p.useState(!!r?.payCommission),[L,H]=p.useState(!!r?.variablePrice),[ie,Y]=p.useState(!!r?.composition),[W,se]=p.useState(!!r?.service),[pe,G]=p.useState(!!r?.hasGrid),[te,oe]=p.useState(!!r?.usePriceTable),[De,re]=p.useState(!!r?.fuel),[ae,ut]=p.useState(!!r?.useImei),[pt,ft]=p.useState(!!r?.stockByGrid),[bt,Lt]=p.useState(!!r?.showInApp),[Dt,Bt]=p.useState(r?.costPrice!=null?Number(r.costPrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.cost!=null?Number(r.cost).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),[ge,wt]=p.useState(r?.salePrice!=null?Number(r.salePrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.price!=null?Number(r.price).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),[Gt,Sr]=p.useState(r?.marginPercent!=null?String(Number(r.marginPercent).toFixed(2)).replace(".",","):""),[wr,he]=p.useState(r?.stock?String(r.stock):""),[ot,Vt]=p.useState(r?.minStock?String(r.minStock):""),[qt,Re]=p.useState(r?.status||"active"),[Ct,Wt]=p.useState(r?.validade||null),[Er,Me]=p.useState(!1),[lt,gt]=p.useState(!1),[or,br]=p.useState(""),[ur,an]=p.useState(!0),[zr,Gr]=p.useState(!!(r?.csosnInterno||r?.csosnExterno)),[ha,pn]=p.useState(r?.cfopInterno||""),[on,cn]=p.useState(r?.cstIcmsInterno||""),[ke,We]=p.useState(r?.csosnInterno||""),[Ze,Je]=p.useState(r?.aliqIcmsInterno!=null?String(r.aliqIcmsInterno).replace(".",","):""),[At,Ye]=p.useState(r?.cfopExterno||""),[lr,ce]=p.useState(r?.cstIcmsExterno||""),[qe,ze]=p.useState(r?.csosnExterno||""),[xt,rr]=p.useState(r?.aliqIcmsExterno!=null?String(r.aliqIcmsExterno).replace(".",","):""),[ir,Kr]=p.useState(r?.cstPisEntrada||""),[jr,sa]=p.useState(r?.cstPisSaida||""),[ia,Kn]=p.useState(r?.aliqPisPercent!=null?String(r.aliqPisPercent).replace(".",","):""),[at,Te]=p.useState(r?.aliqCofinsPercent!=null?String(r.aliqCofinsPercent).replace(".",","):""),[Fe,cr]=p.useState(r?.cstIpi||""),[ht,Xr]=p.useState(r?.aliqIpiPercent!=null?String(r.aliqIpiPercent).replace(".",","):""),[Ft,kr]=p.useState(r?.fcpPercent!=null?String(r.fcpPercent).replace(".",","):""),[jt,er]=p.useState(r?.mvaPercent!=null?String(r.mvaPercent).replace(".",","):""),[Nt,Cr]=p.useState(r?.baseReduzidaPercent!=null?String(r.baseReduzidaPercent).replace(".",","):""),[Lr,un]=p.useState(r?.ncm||""),[ra,Wn]=p.useState(r?.ncmDescription||""),[ln,da]=p.useState(r?.cest||""),[va,oa]=p.useState(!1),[Tn,ee]=p.useState(!1),Ie=fe=>{const Ve=String(fe||"").replace(/\D/g,"");return(Ve?Number(Ve)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},Oe=fe=>{if(!fe)return 0;const Ve=String(fe).replace(/\./g,"").replace(",","."),xe=Number(Ve);return Number.isFinite(xe)?xe:0},Yt=fe=>{const Ve=String(fe||"").replace(/[^\d,]/g,"");return Ve?`% ${Ve}`:""},Pt=fe=>{if(fe==null||fe==="")return 0;const Ve=String(fe).replace(/\./g,"").replace(",","."),xe=Number(Ve);return Number.isFinite(xe)?xe:0},Qt=fe=>String(fe||"").replace(/\D/g,"").slice(0,13),nr=fe=>String(fe||"").replace(/\D/g,"").slice(0,4),fn=fe=>String(fe||"").replace(/\D/g,"").slice(0,8),J=fe=>String(fe||"").replace(/\D/g,"").slice(0,7);p.useEffect(()=>{x(r?.code||""),v(r?.name||""),b(r?.category||""),j(r?.type||"Venda"),C(r?.unit||"UN"),S(r?.active??!0),M(r?.barcode||""),I(r?.barcodeBox||""),k(r?.reference||""),B(r?.brand||""),F(r?.group||""),me(!!r?.allowSale),U(!!r?.payCommission),H(!!r?.variablePrice),Y(!!r?.composition),se(!!r?.service),G(!!r?.hasGrid),oe(!!r?.usePriceTable),re(!!r?.fuel),ut(!!r?.useImei),ft(!!r?.stockByGrid),Lt(!!r?.showInApp),Bt(r?.costPrice!=null?Number(r.costPrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.cost!=null?Number(r.cost).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),wt(r?.salePrice!=null?Number(r.salePrice).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):r?.price!=null?Number(r.price).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""),Sr(r?.marginPercent!=null?String(Number(r.marginPercent).toFixed(2)).replace(".",","):""),he(r?.stock?String(r.stock):""),Vt(r?.minStock?String(r.minStock):""),Re(r?.status||"active"),Wt(r?.validade||null),Gr(!!(r?.csosnInterno||r?.csosnExterno)),pn(r?.cfopInterno||""),cn(r?.cstIcmsInterno||""),We(r?.csosnInterno||""),Je(r?.aliqIcmsInterno!=null?String(r.aliqIcmsInterno).replace(".",","):""),Ye(r?.cfopExterno||""),ce(r?.cstIcmsExterno||""),ze(r?.csosnExterno||""),rr(r?.aliqIcmsExterno!=null?String(r.aliqIcmsExterno).replace(".",","):""),Kr(r?.cstPisEntrada||""),sa(r?.cstPisSaida||""),Kn(r?.aliqPisPercent!=null?String(r.aliqPisPercent).replace(".",","):""),Te(r?.aliqCofinsPercent!=null?String(r.aliqCofinsPercent).replace(".",","):""),cr(r?.cstIpi||""),Xr(r?.aliqIpiPercent!=null?String(r.aliqIpiPercent).replace(".",","):""),kr(r?.fcpPercent!=null?String(r.fcpPercent).replace(".",","):""),er(r?.mvaPercent!=null?String(r.mvaPercent).replace(".",","):""),Cr(r?.baseReduzidaPercent!=null?String(r.baseReduzidaPercent).replace(".",","):""),un(r?.ncm||""),Wn(r?.ncmDescription||""),da(r?.cest||""),an(!0),!r&&i&&!m&&x(i),oa(!1),ee(!1)},[r,e]);const Xe=p.useRef("salePrice");p.useEffect(()=>{if(Xe.current==="salePrice"){const fe=Oe(Dt),Ve=Oe(ge);if(Ve>0){const xe=(Ve-fe)/Ve*100;Sr(xe.toFixed(2).replace(".",","))}else Sr("")}},[Dt,ge]),p.useEffect(()=>{if(Xe.current==="marginPercent"){const fe=setTimeout(()=>{const Ve=Oe(Dt),xe=Pt(Gt);if(console.log("[Margem] Custo:",Ve,"Margem:",xe),Ve>0&&xe>0)if(xe>=100){const kt=Ve*(1+xe/100);console.log("[Margem] Preo calculado (markup):",kt),wt(kt.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}else{const kt=Ve/(1-xe/100);console.log("[Margem] Preo calculado (margem):",kt),wt(kt.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}},500);return()=>clearTimeout(fe)}},[Gt,Dt]);const He=async fe=>{if(fe.preventDefault(),Er)return;const Ve=[];if(g?.trim()||Ve.push("Descrio"),_?.trim()||Ve.push("Unidade"),w||Ve.push("Tipo de Produto"),Oe(ge)<=0&&Ve.push("Preo de Venda"),Ve.length){d({title:"Preencha os campos obrigatrios",description:Ve.join(", "),variant:"destructive"});return}console.log("[ProdutosPage] handleSave - Estado active antes de salvar:",E);let xe=qt;E?qt==="inactive"&&E&&(xe="active"):xe="inactive",console.log("[ProdutosPage] handleSave - Status ajustado:",xe);const kt={id:r?.id,code:m?.trim()||"",name:g,category:y,type:w,stock:Number(wr||0),minStock:Number(ot||0),status:xe,validade:Ct,unit:_,active:E,barcode:Qt(A),barcodeBox:Qt(O),reference:T?.trim()||null,brand:q?.trim()||null,group:z?.trim()||null,cost:Oe(Dt),price:Oe(ge),buyPrice:null,costsPercent:null,costPrice:Oe(Dt),salePrice:Oe(ge),marginPercent:Pt(Gt),allowSale:V,payCommission:be,variablePrice:L,composition:ie,service:W,hasGrid:pe,usePriceTable:te,fuel:De,useImei:ae,stockByGrid:pt,showInApp:bt,cfopInterno:nr(ha)||null,cstIcmsInterno:zr?null:on||null,csosnInterno:zr&&ke||null,aliqIcmsInterno:Pt(Ze),cfopExterno:nr(At)||null,cstIcmsExterno:zr?null:lr||null,csosnExterno:zr&&qe||null,aliqIcmsExterno:Pt(xt),cstPisEntrada:ir||null,cstPisSaida:jr||null,aliqPisPercent:Pt(ia),aliqCofinsPercent:Pt(at),cstIpi:Fe||null,aliqIpiPercent:Pt(ht),fcpPercent:Pt(Ft),mvaPercent:Pt(jt),baseReduzidaPercent:Pt(Nt),ncm:fn(Lr)||null,ncmDescription:ra||null,cest:J(ln)||null};try{Me(!0),console.log("[Produtos] Salvando produto",kt);const st=2e4,zt=new Promise((pr,en)=>setTimeout(()=>en(new Error("Timeout ao salvar produto (20s)")),st));await Promise.race([n(kt),zt]),d({title:"Produto salvo",description:"O produto foi salvo com sucesso.",variant:"success",duration:4e3,className:"bg-amber-500 text-black shadow-xl"}),t(!1)}catch(st){console.error("[Produtos] Erro ao salvar",st);const zt=pd(st,{action:"save"});d({title:zt.title,description:zt.description,variant:"destructive",duration:6e3})}finally{Me(!1)}};return p.useEffect(()=>{e||Me(!1)},[e]),a.jsxs(Un,{open:e,onOpenChange:t,children:[a.jsxs(zn,{className:"w-[90vw] sm:max-w-[780px] max-h-[80vh] sm:max-h-[85vh] flex flex-col",onKeyDown:fe=>{fe.key==="F5"&&(fe.preventDefault(),He(fe)),fe.key==="Escape"&&(fe.preventDefault(),t(!1))},children:[a.jsx(Bn,{children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{children:[a.jsx(Ln,{className:"text-lg sm:text-xl",children:r?"Detalhes do Produto":"Novo Produto"}),a.jsx(ma,{className:"text-xs sm:text-sm",children:"Preencha as informaes e use as abas para navegar."})]})})}),a.jsx("form",{onSubmit:He,className:"grid gap-4 py-2 flex-1 overflow-y-auto pr-1 fx-scroll",children:a.jsxs(_d,{value:f,onValueChange:h,className:"w-full",children:[a.jsx("div",{className:"sm:hidden mb-4",children:a.jsxs(Zn,{value:f,onValueChange:h,children:[a.jsx(Yn,{className:"w-full",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"dados",children:"Dados"}),a.jsx(nt,{value:"estoque",children:"Estoque"}),a.jsx(nt,{value:"preco",children:"Preo e Lucro"}),a.jsx(nt,{value:"impostos",children:"Impostos"}),a.jsx(nt,{value:"outras",children:"Outras Info"})]})]})}),a.jsxs(xc,{className:"hidden sm:grid grid-cols-5 gap-1",children:[a.jsx(Ya,{value:"dados",children:"Dados"}),a.jsx(Ya,{value:"estoque",children:"Estoque"}),a.jsx(Ya,{value:"preco",children:"Preo e Lucro"}),a.jsx(Ya,{value:"impostos",children:"Impostos"}),a.jsx(Ya,{value:"outras",children:"Outras Info"})]}),a.jsx("div",{className:"mt-2 text-[10px] sm:text-[11px] text-text-muted",children:"* Campo obrigatrio"}),a.jsxs(yo,{value:"dados",className:"space-y-3 mt-2",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{htmlFor:"code",className:"text-left sm:text-right text-xs sm:text-sm",children:["Cdigo ",a.jsx("span",{className:"text-text-muted text-[10px] sm:text-xs",children:"(auto)"})]}),a.jsx(It,{id:"code",value:m,onChange:fe=>x(fe.target.value.replace(/\D/g,"")),className:"col-span-1 sm:col-span-3 text-sm",placeholder:i||"Ex.: 0001",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{htmlFor:"name",className:"text-left sm:text-right text-xs sm:text-sm",children:["Descrio ",!g?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(It,{id:"name",value:g,onChange:fe=>v(fe.target.value),className:"col-span-1 sm:col-span-3 text-sm",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"category",className:"text-left sm:text-right text-xs sm:text-sm",children:"Categoria"}),a.jsxs("div",{className:"col-span-3 flex gap-2 items-center",children:[a.jsxs(Zn,{value:y,onValueChange:fe=>ur&&b(fe),children:[a.jsx(Yn,{className:"w-full",disabled:!ur,children:a.jsx(ta,{placeholder:"Selecione..."})}),a.jsx(Jn,{children:s.map(fe=>a.jsx(nt,{value:fe,children:fe},fe))})]}),a.jsxs(Z,{type:"button",onClick:()=>gt(fe=>!fe),className:"bg-amber-500 hover:bg-amber-400 text-black inline-flex items-center gap-2 whitespace-nowrap px-3",title:lt?"Fechar":"Adicionar nova categoria",disabled:!ur,children:[a.jsx("span",{className:"font-bold",children:"+"}),a.jsx("span",{children:"Novo"})]})]})]}),lt&&a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx("div",{className:"col-span-1"}),a.jsxs("div",{className:"col-span-3 flex gap-2",children:[a.jsx(It,{value:or,onChange:fe=>br(fe.target.value),placeholder:"Nome da nova categoria"}),a.jsx(Z,{type:"button",onClick:async()=>{const fe=or.trim();if(fe)try{if(s.includes(fe)){d({title:"Categoria j existe",description:"Escolha outro nome.",variant:"destructive"});return}await o?.(fe),b(fe),br(""),gt(!1),d({title:"Categoria adicionada",description:"Ela j est selecionada no formulrio.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(Ve){console.error("[Produto] add category inline:error",Ve);const xe=pd(Ve,{action:"save"});d({title:xe.title,description:xe.description,variant:"destructive"})}},children:"Adicionar"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{htmlFor:"unit",className:"text-left sm:text-right text-xs sm:text-sm",children:["Unidade ",!_?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsxs(Zn,{value:_,onValueChange:fe=>ur&&C(fe),children:[a.jsx(Yn,{className:"col-span-1 sm:col-span-3 text-sm",disabled:!ur,children:a.jsx(ta,{placeholder:"Selecione a unidade"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"UN",children:"UN - Unidade"}),a.jsx(nt,{value:"CX",children:"CX - Caixa"}),a.jsx(nt,{value:"PC",children:"PC - Pea"}),a.jsx(nt,{value:"KG",children:"KG - Quilograma"}),a.jsx(nt,{value:"G",children:"G - Grama"}),a.jsx(nt,{value:"L",children:"L - Litro"}),a.jsx(nt,{value:"ML",children:"ML - Mililitro"}),a.jsx(nt,{value:"M",children:"M - Metro"}),a.jsx(nt,{value:"M2",children:"M - Metro Quadrado"}),a.jsx(nt,{value:"M3",children:"M - Metro Cbico"}),a.jsx(nt,{value:"PAR",children:"PAR - Par"}),a.jsx(nt,{value:"DZ",children:"DZ - Dzia"}),a.jsx(nt,{value:"FD",children:"FD - Fardo"}),a.jsx(nt,{value:"SC",children:"SC - Saco"}),a.jsx(nt,{value:"PT",children:"PT - Pacote"}),a.jsx(nt,{value:"SERV",children:"SERV - Servio"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{className:"text-left sm:text-right text-xs sm:text-sm",children:["Tipo ",!w&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsxs(Zn,{value:w,onValueChange:fe=>ur&&j(fe),children:[a.jsx(Yn,{className:"col-span-1 sm:col-span-3 text-sm",disabled:!ur,children:a.jsx(ta,{placeholder:"Selecione o tipo"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"Venda",children:"Produto para Venda"}),a.jsx(nt,{value:"Uso Interno",children:"Produto de Uso Interno"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-left sm:text-right text-xs sm:text-sm",children:"Ativo"}),a.jsx("div",{className:"col-span-1 sm:col-span-3",children:r?a.jsxs(a.Fragment,{children:[a.jsx(Qs,{checked:E,onCheckedChange:fe=>{console.log("[ProdutosPage] Checkbox active mudou para:",fe),S(!!fe)},disabled:!ur}),a.jsx("span",{className:"ml-2 text-xs sm:text-sm",children:"Ativo"})]}):a.jsxs(Zn,{value:E?"ativo":"inativo",onValueChange:fe=>{console.log("[ProdutosPage] Select active mudou para:",fe),S(fe==="ativo")},children:[a.jsx(Yn,{className:"w-full sm:w-48 text-sm",disabled:!ur,children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"ativo",children:"Ativo"}),a.jsx(nt,{value:"inativo",children:"Inativo"})]})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"barcode",className:"text-left sm:text-right text-xs sm:text-sm",children:"EAN-13"}),a.jsx(It,{id:"barcode",value:A,onChange:fe=>M(Qt(fe.target.value)),className:"col-span-1 sm:col-span-3 text-sm",placeholder:"789...",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{htmlFor:"validade",className:"text-left sm:text-right text-xs sm:text-sm",children:["Validade ",a.jsx("span",{className:"text-text-muted text-[10px] sm:text-xs",children:"(Opcional)"})]}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:Pr("col-span-1 sm:col-span-3 justify-start text-left font-normal text-xs sm:text-sm",!Ct&&"text-muted-foreground"),disabled:!ur,children:[a.jsx(A2,{className:"mr-2 h-3 w-3 sm:h-4 sm:w-4"}),Ct?dr(Ct,"dd/MM/yyyy"):a.jsx("span",{children:"Selecione a data"})]})}),a.jsx(Go,{className:"p-0 w-[280px] sm:w-[300px]",children:a.jsx("div",{className:"w-[280px] sm:w-[300px] min-h-[300px] sm:min-h-[332px]",children:a.jsx(ei,{mode:"single",selected:Ct,onSelect:Wt,initialFocus:!0,fixedWeeks:!0})})})]})]})]}),a.jsx(yo,{value:"estoque",className:"space-y-3 mt-2",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"grid grid-cols-2 items-center gap-2",children:[a.jsx(ct,{htmlFor:"stock",className:"text-right",children:"Estoque"}),a.jsx(It,{id:"stock",value:wr,onChange:fe=>he(fe.target.value.replace(/[^0-9]/g,"")),disabled:!ur,className:"col-span-1",inputMode:"numeric"})]}),a.jsxs("div",{className:"grid grid-cols-2 items-center gap-4",children:[a.jsx(ct,{htmlFor:"minStock",className:"text-right",children:"Estoque Mn."}),a.jsx(It,{id:"minStock",value:ot,onChange:fe=>Vt(fe.target.value.replace(/[^0-9]/g,"")),disabled:!ur,inputMode:"numeric"})]})]})}),a.jsxs(yo,{value:"preco",className:"space-y-3 mt-2",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"costPrice",className:"text-xs sm:text-right",children:"Preo de Custo (R$)"}),a.jsx(It,{id:"costPrice",inputMode:"numeric",placeholder:"Ex.: 10,00",value:`R$ ${Dt||"0,00"}`,onChange:fe=>{Bt(Ie(fe.target.value))},disabled:!ur,className:"sm:col-span-3 text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{htmlFor:"salePrice",className:"text-xs sm:text-right",children:["Preo de Venda (R$) ",(!ge||Oe(ge)<=0)&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(It,{id:"salePrice",inputMode:"numeric",placeholder:"Ex.: 15,00",value:`R$ ${ge||"0,00"}`,onChange:fe=>{Xe.current="salePrice",wt(Ie(fe.target.value))},disabled:!ur,className:"sm:col-span-3 text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"marginPercent",className:"text-xs sm:text-right",children:"% de Lucro (Margem)"}),a.jsx(It,{id:"marginPercent",type:"text",placeholder:"Ex.: 40",value:Gt?`% ${Gt}`:"",onChange:fe=>{Xe.current="marginPercent";const Ve=fe.target.value.replace(/[^\d,]/g,"");Sr(Ve)},onBlur:()=>{if(Xe.current==="marginPercent"){const fe=Oe(Dt),Ve=Pt(Gt);if(fe>0&&Ve>0)if(Ve>=100){const xe=fe*(1+Ve/100);wt(xe.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}else{const xe=fe/(1-Ve/100);wt(xe.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}))}}},disabled:!ur,className:"sm:col-span-3 text-xs sm:text-sm"})]})]}),a.jsxs(yo,{value:"impostos",className:"space-y-4 mt-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Qs,{id:"useCsosn",checked:zr,onCheckedChange:fe=>Gr(!!fe),disabled:!ur}),a.jsx(ct,{htmlFor:"useCsosn",className:"cursor-pointer text-xs sm:text-sm",children:"Usar CSOSN (Simples Nacional)"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"ICMS - Operao Interna"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{className:"text-xs sm:text-right",children:["CFOP ",!ha?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(It,{value:ha,onChange:fe=>pn(nr(fe.target.value)),className:Pr("sm:col-span-3 text-xs sm:text-sm",!ha?.trim()&&"border-danger focus-visible:ring-danger/60"),placeholder:"5102",disabled:!ur})]}),!zr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CST"}),a.jsx(It,{value:on,onChange:fe=>cn(fe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"00, 20, 40...",disabled:!ur})]}),zr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CSOSN"}),a.jsx(It,{value:ke,onChange:fe=>We(fe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"101, 102...",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"Alquota ICMS (%)"}),a.jsx(It,{value:`${Ze||""}`,onChange:fe=>Je(Yt(fe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!ur})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"ICMS - Operao Externa"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{className:"text-xs sm:text-right",children:["CFOP ",!At?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(It,{value:At,onChange:fe=>Ye(nr(fe.target.value)),className:Pr("sm:col-span-3 text-xs sm:text-sm",!At?.trim()&&"border-danger focus-visible:ring-danger/60"),placeholder:"6102",disabled:!ur})]}),!zr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CST"}),a.jsx(It,{value:lr,onChange:fe=>ce(fe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"00, 20, 40...",disabled:!ur})]}),zr&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CSOSN"}),a.jsx(It,{value:qe,onChange:fe=>ze(fe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"101, 102...",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"Alquota ICMS (%)"}),a.jsx(It,{value:`${xt||""}`,onChange:fe=>rr(Yt(fe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!ur})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"PIS/COFINS"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CST PIS Entrada"}),a.jsx(It,{value:ir,onChange:fe=>Kr(fe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"50, 70...",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CST PIS Sada"}),a.jsx(It,{value:jr,onChange:fe=>sa(fe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"01, 04...",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"Alquota PIS (%)"}),a.jsx(It,{value:`${ia||""}`,onChange:fe=>Kn(Yt(fe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,65",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"Alquota COFINS (%)"}),a.jsx(It,{value:`${at||""}`,onChange:fe=>Te(Yt(fe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"3,00",disabled:!ur})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs sm:text-sm font-semibold",children:"IPI"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CST IPI"}),a.jsx(It,{value:Fe,onChange:fe=>cr(fe.target.value.toUpperCase()),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"50, 99...",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"Alquota IPI (%)"}),a.jsx(It,{value:`${ht||""}`,onChange:fe=>Xr(Yt(fe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"0,00",disabled:!ur})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"FCP (%)"}),a.jsx(It,{value:`${Ft||""}`,onChange:fe=>kr(Yt(fe.target.value)),placeholder:"2,00",disabled:!ur,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"MVA (%)"}),a.jsx(It,{value:`${jt||""}`,onChange:fe=>er(Yt(fe.target.value)),placeholder:"40,00",disabled:!ur,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"Base Reduzida (%)"}),a.jsx(It,{value:`${Nt||""}`,onChange:fe=>Cr(Yt(fe.target.value)),placeholder:"0,00",disabled:!ur,className:"text-xs sm:text-sm"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 sm:gap-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsxs(ct,{className:"text-xs sm:text-right",children:["NCM ",!Lr?.trim()&&a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(It,{value:Lr,onChange:fe=>un(fn(fe.target.value)),placeholder:"00000000",disabled:!ur,className:Pr("text-xs sm:text-sm",!Lr?.trim()&&"border-danger focus-visible:ring-danger/60")})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"CEST"}),a.jsx(It,{value:ln,onChange:fe=>da(J(fe.target.value)),placeholder:"0000000",disabled:!ur,className:"text-xs sm:text-sm"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 items-start sm:items-center gap-2 sm:gap-4 sm:col-span-2",children:[a.jsx(ct,{className:"text-xs sm:text-right",children:"Descrio NCM"}),a.jsx(It,{value:ra,onChange:fe=>Wn(fe.target.value),placeholder:"Descrio do NCM",disabled:!ur,className:"text-sm"})]})]})]}),a.jsxs(yo,{value:"outras",className:"space-y-3 mt-2",children:[r&&a.jsxs("div",{className:"pb-4 mb-4 border-b border-border",children:[a.jsx(Z,{type:"button",onClick:()=>oa(!0),disabled:!ur,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:"Desmembrar e Unir Produto"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Divida o preo por quantidade e opcionalmente una com outro produto"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"barcode2",className:"text-xs sm:text-right",children:"Cdigo de Barras"}),a.jsx(It,{id:"barcode2",value:A,onChange:fe=>M(Qt(fe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"EAN-13",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"barcodeBox",className:"text-xs sm:text-right",children:"Cdigo Barras (Caixa)"}),a.jsx(It,{id:"barcodeBox",value:O,onChange:fe=>I(Qt(fe.target.value)),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"EAN-13 da caixa",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"reference",className:"text-xs sm:text-right",children:"Referncia"}),a.jsx(It,{id:"reference",value:T,onChange:fe=>k(fe.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: REF-123",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"brand",className:"text-xs sm:text-right",children:"Marca"}),a.jsx(It,{id:"brand",value:q,onChange:fe=>B(fe.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: Nike",disabled:!ur})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[a.jsx(ct,{htmlFor:"group",className:"text-xs sm:text-right",children:"Grupo"}),a.jsx(It,{id:"group",value:z,onChange:fe=>F(fe.target.value),className:"sm:col-span-3 text-xs sm:text-sm",placeholder:"Ex.: Calados",disabled:!ur})]})]}),!1]})}),a.jsxs(Ga,{children:[a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",children:"Cancelar"})}),a.jsx(Z,{type:"button",onClick:He,disabled:Er||!ur,title:"F5 para salvar",children:Er?"Salvando...":"Salvar Produto"})]})]}),a.jsx(Vst,{open:va,onOpenChange:oa,product:r,currentPrice:ge,allProducts:c,userProfile:u,onApply:async(fe,Ve,xe,kt)=>{if(!xe)wt(fe),he(Ve),oa(!1),d({title:"Preo desmembrado!",description:`Preo unitrio: R$ ${Oe(fe).toFixed(2)} | Estoque: ${Ve}`,variant:"success"});else try{const st=Number(Ve),zt=await Zv({productId:xe.id,delta:st,codigoEmpresa:u?.codigo_empresa}),pr=Number(zt?.stock??Number(xe.stock||0)+st);if(kt){const en={...xe,stock:pr,salePrice:Oe(fe),price:Oe(fe)};await U1(xe.id,en)}await yF(r.id),d({title:"Produto desmembrado e unido!",description:`${xe.name}: novo estoque = ${pr} | preo unitrio = R$ ${Oe(fe).toFixed(2)}`,variant:"success"}),oa(!1),t(!1);try{typeof l=="function"&&l()}catch{}}catch(st){console.error("[Desmembrar e Unir] Erro:",st),d({title:"Erro ao processar",description:st?.message||"Tente novamente",variant:"destructive"})}}})]})}function Vst({open:e,onOpenChange:t,product:r,currentPrice:n,allProducts:s,userProfile:o,onApply:i}){const[l,c]=p.useState(""),[d,u]=p.useState(""),[f,h]=p.useState(!1),[m,x]=p.useState(""),[g,v]=p.useState(null),[y,b]=p.useState(!1),w=S=>{const A=String(S||"").replace(/\D/g,"");return(A?Number(A)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},j=S=>{if(!S)return 0;const A=String(S).replace(/\./g,"").replace(",","."),M=Number(A);return Number.isFinite(M)?M:0};p.useEffect(()=>{e&&n&&(c(n),u(""),h(!1),x(""),v(null),b(!1))},[e,n]);const _=l&&d&&Number(d)>0?j(l)/Number(d):0,C=(s||[]).filter(S=>{if(!r||S.id===r.id)return!1;if(!m.trim())return!0;const A=m.toLowerCase();return(S.name||"").toLowerCase().includes(A)||(S.code||"").toLowerCase().includes(A)}).slice(0,10),E=g?Number(d||0)+Number(g.stock||0):0;return a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-[650px] max-h-[85vh] flex flex-col overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Desmembrar e Unir Produto"}),a.jsx(ma,{children:"Divida o preo por quantidade e opcionalmente una com outro produto"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-sm font-semibold",children:"1. Desmembrar Preo"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{children:"Valor Total (R$)"}),a.jsx(It,{inputMode:"numeric",placeholder:"0,00",value:`R$ ${l||"0,00"}`,onChange:S=>c(w(S.target.value))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{children:"Quantidade de Unidades"}),a.jsx(It,{type:"text",inputMode:"numeric",placeholder:"0",value:d,onChange:S=>u(S.target.value.replace(/[^0-9]/g,""))})]}),_>0&&a.jsx("div",{className:"bg-muted/50 border border-border p-3 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Preo Unitrio:"}),a.jsxs("span",{className:"text-lg font-bold",children:["R$ ",_.toFixed(2)]})]})})]}),_>0&&a.jsxs("div",{className:"space-y-3 border-t pt-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qs,{id:"wantToMerge",checked:f,onCheckedChange:S=>{h(!!S),S||(v(null),x(""),b(!1))}}),a.jsx(ct,{htmlFor:"wantToMerge",className:"cursor-pointer text-sm font-semibold",children:"2. Unir com outro produto (opcional)"})]}),f&&a.jsxs("div",{className:"space-y-3 ml-6",children:[a.jsx("div",{className:"bg-muted/30 border border-border p-3 rounded-lg",children:a.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.jsx("strong",{children:"Produto atual:"})," ",r?.name," (ser inativado aps unio)"]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{children:"Buscar Produto Destino"}),a.jsx(It,{placeholder:"Digite o nome ou cdigo...",value:m,onChange:S=>x(S.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(ct,{className:"text-xs",children:["Produtos Disponveis (",C.length,")"]}),a.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:C.length===0?a.jsx("p",{className:"text-xs text-muted-foreground p-2 text-center",children:"Nenhum produto encontrado"}):C.map(S=>a.jsx("div",{onClick:()=>v(S),className:Pr("p-2 rounded-md cursor-pointer border transition-colors",g?.id===S.id?"bg-primary/10 border-primary":"bg-background hover:bg-muted/50 border-transparent"),children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium truncate",children:S.name}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[S.code&&`Cdigo: ${S.code}  `,"Estoque: ",S.stock||0,"  R$ ",Number(S.price||S.salePrice||0).toFixed(2)]})]}),g?.id===S.id&&a.jsx(Di,{className:"w-4 h-4 text-primary flex-shrink-0"})]})},S.id))})]}),g&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"bg-primary/5 border border-primary/20 p-3 rounded-lg",children:[a.jsx("p",{className:"text-xs font-medium mb-1",children:"Resumo da Unio:"}),a.jsxs("div",{className:"text-xs space-y-0.5 text-muted-foreground",children:[a.jsxs("p",{children:[" Destino: ",a.jsx("strong",{children:g.name})]}),a.jsxs("p",{children:[" Estoque atual: ",g.stock||0]}),a.jsxs("p",{children:[" Estoque a somar: +",d]}),a.jsxs("p",{className:"text-primary font-bold",children:[" Novo estoque: ",E]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qs,{id:"updatePrice",checked:y,onCheckedChange:S=>b(!!S)}),a.jsxs(ct,{htmlFor:"updatePrice",className:"cursor-pointer text-xs",children:["Atualizar preo do destino para R$ ",_.toFixed(2)]})]})]})]})]})]}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),a.jsx(Z,{onClick:()=>{if(_>0){const S=_.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});i(S,d,f?g:null,y)}},disabled:_<=0||f&&!g,children:f&&g?"Desmembrar e Unir":"Aplicar Desmembramento"})]})]})})}function Wst({open:e,onOpenChange:t,categories:r,onAddCategory:n,onRemoveCategory:s}){const{toast:o}=Zs(),[i,l]=p.useState(""),[c,d]=p.useState(!1),u=async()=>{const h=i.trim();if(h){if(r.includes(h)){o({title:"Categoria j existe",description:"Escolha outro nome.",variant:"destructive"});return}try{d(!0),await n(h),l(""),o({title:"Categoria adicionada",description:"Ela j aparece na lista.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(m){console.error("[Categorias] add:error",m);const x=pd(m,{action:"save"});o({title:x.title,description:x.description,variant:"destructive"})}finally{d(!1)}}},f=async h=>{try{d(!0),await s(h),o({title:"Categoria desativada",description:"A categoria foi marcada como inativa.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(m){console.error("[Categorias] remove:error",m);const x=pd(m,{action:"save"});o({title:x.title,description:x.description,variant:"destructive"})}finally{d(!1)}};return a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"w-[90vw] sm:max-w-[480px]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Gerenciar Categorias"}),a.jsx(ma,{children:"Adicione ou remova categorias de produtos."})]}),a.jsxs("div",{className:"py-4 space-y-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx(It,{value:i,onChange:h=>l(h.target.value),placeholder:"Nome da nova categoria"}),a.jsx(Z,{onClick:u,disabled:c,children:c?"Processando...":"Adicionar"})]}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map(h=>a.jsxs("div",{className:"flex items-center justify-between bg-surface-2 p-2 rounded-md",children:[a.jsx("span",{className:"font-semibold",children:h}),a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-danger/80 hover:text-danger",onClick:()=>f(h),disabled:c,children:a.jsx(bc,{size:14})})]},h))})]})]})})}function Hst(){const{toast:e}=Zs(),{userProfile:t,authReady:r}=lo();_i();const[n,s]=p.useState($st),[o,i]=p.useState(Bst),[l,c]=p.useState([]),[d,u]=p.useState("");p.useState("list");const[f,h]=p.useState(!0),[m,x]=p.useState(null),[g,v]=p.useState(!1),[y,b]=p.useState(!1),[w,j]=p.useState("all"),[_,C]=p.useState(""),[E,S]=p.useState({type:"all",category:"all",status:"active",newOnly:!1}),[A,M]=p.useState(!1),[O,I]=p.useState(!1),[T,k]=p.useState(!1),[q,B]=p.useState(null),[z,F]=p.useState({by:"code",dir:"asc"}),V=p.useRef(!0),me=p.useRef(0),be=p.useRef(0);p.useRef(!1);const[U,L]=p.useState(!1),[H,ie]=p.useState("paged"),Y=H==="paged",[W,se]=p.useState(1),[pe]=p.useState(100),[G,te]=p.useState(0);p.useEffect(()=>(V.current=!0,()=>{V.current=!1}),[]),p.useEffect(()=>{try{const ce=localStorage.getItem(mV);if(!ce)return;const qe=JSON.parse(ce);qe&&typeof qe=="object"&&((qe.listMode==="paged"||qe.listMode==="all")&&ie(qe.listMode),typeof qe.showStats=="boolean"&&h(qe.showStats))}catch{}},[]),p.useEffect(()=>{(async()=>{if(!t?.codigo_empresa||!t?.id&&!t?.user_id)return;const qe=t.id||t.user_id,ze=`produtos:${t.codigo_empresa}`,xt=await loe({userId:qe,scope:ze});xt&&((xt.listMode==="paged"||xt.listMode==="all")&&ie(xt.listMode),typeof xt.showStats=="boolean"&&h(xt.showStats))})()},[t?.codigo_empresa,t?.id]),p.useEffect(()=>{try{const ce={listMode:H,showStats:f};localStorage.setItem(mV,JSON.stringify(ce))}catch{}if(t?.codigo_empresa&&(t?.id||t?.user_id)){const ce=t.id||t.user_id,qe=`produtos:${t.codigo_empresa}`;coe({userId:ce,scope:qe,settings:{listMode:H,showStats:f}})}},[H,f,t?.codigo_empresa,t?.id]);const oe=async()=>{const ce=t?.codigo_empresa||null;if(!r||!ce)return;const qe=`produtos:list:${ce}`;M(!0);const ze=setTimeout(()=>{if(V.current)try{const xt=JSON.parse(localStorage.getItem(qe)||"[]");Array.isArray(xt)&&xt.length>0&&(console.warn("[Produtos] slow fallback: using cached snapshot"),s(xt))}catch{}},2e3);try{const xt=E.status==="all"||E.status==="inactive";let rr=[];if(Y){console.log("[Produtos] refetchProducts - modo paginado - Filtro status:",E.status,"includeInactive:",xt,"page:",W,"pageSize:",pe);const ir=await fst({includeInactive:xt,search:_,codigoEmpresa:ce,page:W,pageSize:pe});if(!V.current)return;rr=ir?.data||[];const Kr=ir?.count||0;console.log("[Produtos] refetchProducts - Produtos carregados (paginado):",rr.length,"de",Kr),s(rr),te(Kr)}else{if(console.log("[Produtos] refetchProducts - modo TODOS - Filtro status:",E.status,"includeInactive:",xt),rr=await uf({includeInactive:xt,search:_,codigoEmpresa:ce}),!V.current)return;console.log("[Produtos] refetchProducts - Produtos carregados (todos):",rr.length),s(rr),te(rr.length)}try{localStorage.setItem(qe,JSON.stringify(rr))}catch{}be.current=rr.length,me.current=Date.now()}catch(xt){console.error("[Produtos] refetchProducts:error",xt);const rr=pd(xt,{action:"fetch"});e({title:rr.title,description:rr.description,variant:"destructive"})}finally{clearTimeout(ze),M(!1)}};p.useEffect(()=>{const ce=(()=>{try{const ir=localStorage.getItem("auth:userProfile");return ir&&JSON.parse(ir)?.codigo_empresa||null}catch{return null}})(),qe=t?.codigo_empresa||ce;if(!qe)return;const ze=`produtos:list:${qe}`,xt=(()=>{try{return JSON.parse(localStorage.getItem(ze)||"[]")}catch{return[]}})();Array.isArray(xt)&&xt.length>0&&(s(xt),be.current=xt.length);const rr=async(ir=3)=>{for(let Kr=0;Kr<ir;Kr++)try{if(V.current){await oe();break}}catch(jr){console.warn(`[ProdutosPage] Tentativa ${Kr+1} falhou:`,jr),Kr===ir-1?console.error("[ProdutosPage] Todas as tentativas falharam"):await new Promise(sa=>setTimeout(sa,1e3*(Kr+1)))}};try{const ir=JSON.parse(localStorage.getItem(`produtos:cats:${qe}`)||"[]");Array.isArray(ir)&&ir.length>0&&i(ir)}catch{}if(r&&t?.codigo_empresa){const ir=setTimeout(()=>rr(),100);return(async()=>{try{const Kr=await fV({codigoEmpresa:t.codigo_empresa});if(!V.current)return;i(Kr);try{localStorage.setItem(`produtos:cats:${t.codigo_empresa}`,JSON.stringify(Kr))}catch{}}catch(Kr){console.error("[Categorias] load on mount:error",Kr)}})(),()=>clearTimeout(ir)}},[r,t?.codigo_empresa]),p.useEffect(()=>{const ce=()=>{(Date.now()-(me.current||0)>3e4||be.current===0)&&oe()},qe=()=>{document.visibilityState==="visible"&&(Date.now()-(me.current||0)>3e4||be.current===0)&&oe()};return window.addEventListener("focus",ce),document.addEventListener("visibilitychange",qe),()=>{window.removeEventListener("focus",ce),document.removeEventListener("visibilitychange",qe)}},[r,t?.codigo_empresa]),p.useEffect(()=>{se(1),r&&oe()},[E.status,r]),p.useEffect(()=>{const ce=setTimeout(()=>{se(1),r&&oe()},300);return()=>clearTimeout(ce)},[_,r]),p.useEffect(()=>{se(1),r&&oe()},[H,r]);const[De,re]=p.useState("N/A");p.useEffect(()=>{let ce=!0;return(async()=>{try{const qe=await ust({limit:1,codigoEmpresa:t?.codigo_empresa});if(!ce)return;if(Array.isArray(qe)&&qe.length>0){const ze=qe[0];re(`${ze.name} (${ze.total})`)}else re("")}catch{ce&&re("N/A")}})(),()=>{ce=!1}},[t?.codigo_empresa]);const[ae,ut]=p.useState(!1),[pt,ft]=p.useState(()=>{const ce=new Date;return ce.setHours(0,0,0,0),ce}),[bt,Lt]=p.useState(!1),[Dt,Bt]=p.useState(()=>new Date),[ge,wt]=p.useState(!1),[Gt,Sr]=p.useState([]),[wr,he]=p.useState(!1),ot=async()=>{try{wt(!0);const ce=await dst({from:pt,to:Dt,codigoEmpresa:t?.codigo_empresa});Sr(ce||[])}catch(ce){e({title:"Falha ao carregar vendas do perodo",description:ce?.message||"Tente novamente",variant:"destructive"})}finally{wt(!1)}},Vt=p.useMemo(()=>{const ce=new Date;return{mostSold:De,lowStock:n.filter(qe=>qe.status==="low_stock"||qe.stock>0&&qe.stock<=qe.minStock).length,expired:n.filter(qe=>qe.validade&&qe.validade<ce).length}},[n,De]),qt=p.useMemo(()=>{const ce=new Date;return n.filter(qe=>{const ze=w==="all"?!0:w==="low_stock"?qe.status==="low_stock"||qe.stock>0&&qe.stock<=qe.minStock:w==="expired"?qe.validade&&qe.validade<ce:!1,xt=E.status==="all"?!0:qe.status===E.status,rr=E.type==="all"||qe.type===E.type,ir=E.category==="all"||qe.category===E.category,Kr=!E.newOnly||qe.dataImportacao&&(()=>Math.floor((new Date-qe.dataImportacao)/864e5)<=7)();return ze&&xt&&rr&&ir&&Kr})},[n,w,E]),Re=ce=>ce?.dataImportacao?Math.floor((new Date-ce.dataImportacao)/(1e3*60*60*24))<=7:!1,Ct=p.useMemo(()=>{const ce=[...qt],qe=z.dir==="asc"?1:-1,ze=(rr,ir)=>Number.isFinite(rr)?rr:ir,xt=rr=>{if(!rr)return NaN;if(rr instanceof Date)return rr.getTime();const ir=new Date(rr);return Number.isNaN(ir.getTime())?NaN:ir.getTime()};return ce.sort((rr,ir)=>{if(z.by==="code"){const Kr=ze(parseInt((rr.code||"").trim(),10),1/0),jr=ze(parseInt((ir.code||"").trim(),10),1/0);return Kr===jr?0:Kr>jr?qe:-qe}if(z.by==="name"){const Kr=(rr.name||"").toString(),jr=(ir.name||"").toString();return Kr.localeCompare(jr,"pt-BR",{sensitivity:"base"})*qe}if(z.by==="validade"){const Kr=ze(xt(rr.validade),1/0),jr=ze(xt(ir.validade),1/0);return Kr===jr?0:Kr>jr?qe:-qe}return 0}),ce},[qt,z]),Wt=p.useMemo(()=>{if(!pe)return 1;const ce=Math.ceil((G||0)/pe);return ce>0?ce:1},[G,pe]),Er=ce=>{F(qe=>qe.by===ce?{by:ce,dir:qe.dir==="asc"?"desc":"asc"}:{by:ce,dir:"asc"})},Me=ce=>{j(qe=>qe===ce?"all":ce)},lt=()=>{ft(()=>{const ce=new Date;return ce.setHours(0,0,0,0),ce}),Bt(new Date),ut(!0),setTimeout(ot,0)},gt=(ce,qe)=>{S(ze=>({...ze,[ce]:qe}))},or=async()=>{x(null);const ce=t?.codigo_empresa||null;let qe="";if(ce)try{qe=await uV({codigoEmpresa:ce})}catch(ze){console.error("[Produtos] handleAddNew: falha ao obter prximo cdigo",ze)}u(qe||""),v(!0)},br=ce=>{x(ce),v(!0)},ur=()=>{try{zst(Ct),e({title:"Exportao concluda",description:`${Ct.length} produto(s) exportado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(ce){console.error("[Produtos] export:error",ce);const qe=pd(ce,{action:"export"});e({title:qe.title,description:qe.description,variant:"destructive"})}},an=ce=>{c(qe=>qe.includes(ce)?qe.filter(ze=>ze!==ce):[...qe,ce])},zr=()=>{const ce=Ct.map(qe=>qe.id);ce.length&&c(ce)},Gr=()=>{c([])},ha=ce=>{ce?zr():Gr()},pn=p.useMemo(()=>Ct.filter(ce=>l.includes(ce.id)),[Ct,l]),on=p.useMemo(()=>pn.some(Re),[pn]),cn=async ce=>{if(l.length)try{await mst({ids:l,status:ce}),await oe(),Gr(),e({title:ce==="inactive"?"Produtos inativados":"Produtos atualizados",description:`${l.length} produto(s) atualizado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(qe){const ze=pd(qe,{action:"save"});e({title:ze.title,description:ze.description,variant:"destructive"})}},ke=async()=>{if(!(!l.length||!on))try{await hst({ids:l}),await oe(),Gr(),e({title:"Novos removidos",description:"A etiqueta de novo foi removida dos produtos selecionados.",variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(ce){const qe=pd(ce,{action:"save"});e({title:qe.title,description:qe.description,variant:"destructive"})}},We=async()=>{const ce=t?.codigo_empresa||null;if(!(!r||!ce))try{const qe=await fV({codigoEmpresa:ce});if(!V.current)return;i(qe);try{localStorage.setItem(`produtos:cats:${ce}`,JSON.stringify(qe))}catch{}}catch(qe){console.error("[Categorias] load on mount:error",qe)}},Ze=async ce=>{i(qe=>{if(qe.includes(ce))return qe;const ze=[...qe,ce];return ze.sort((xt,rr)=>xt.localeCompare(rr,"pt-BR")),ze});try{await pst(ce,{codigoEmpresa:t?.codigo_empresa}),await We()}catch(qe){i(xt=>xt.filter(rr=>rr!==ce)),console.error("[Categorias] add:error",qe);const ze=pd(qe,{action:"save"});e({title:ze.title,description:ze.description,variant:"destructive"})}},Je=async ce=>{if(n.some(xt=>xt.category===ce&&xt.status!=="inactive"))throw new Error("Categoria possui produtos ativos vinculados");const ze=o;i(xt=>xt.filter(rr=>rr!==ce));try{await gst(ce,{codigoEmpresa:t?.codigo_empresa}),await We()}catch(xt){i(ze),console.error("[Categorias] remove:error",xt);const rr=pd(xt,{action:"save"});e({title:rr.title,description:rr.description,variant:"destructive"})}},At=async ce=>{try{if(console.log("[Produtos] handleSaveProduct",ce),!ce||typeof ce!="object"){console.warn("[Produtos] handleSaveProduct chamado sem payload vlido. Ignorando.");return}const qe=t?.codigo_empresa||null;if(!ce.code&&qe)try{const xt=await uV({codigoEmpresa:qe});ce.code=xt}catch(xt){console.error("[Produtos] Falha ao obter prximo cdigo automtico",xt)}const ze=async xt=>{const ir=new Promise((Kr,jr)=>setTimeout(()=>jr(new Error("Timeout update/create (12s)")),12e3));return Promise.race([xt,ir])};if(ce.id){const xt=await ze(U1(ce.id,ce,{codigoEmpresa:qe}));console.log("[Produtos] Produto atualizado - active:",xt.active,"status:",xt.status),s(rr=>rr.map(ir=>ir.id===xt.id?xt:ir)),await oe(),console.log("[Produtos] Refetch concludo aps update")}else{ce.dataImportacao||(ce.dataImportacao=new Date);const xt=await ze(pC(ce,{codigoEmpresa:qe}));console.log("[Produtos] Produto criado",xt),s(rr=>[xt,...rr]),setTimeout(()=>{oe().catch(rr=>console.error("[Produtos] refetch ps-create falhou",rr))},0)}}catch(qe){console.error("[Produtos] Erro no handleSaveProduct",qe);const ze=pd(qe,{action:"save"});throw e({title:ze.title,description:ze.description,variant:"destructive"}),qe}},Ye=ce=>{B(ce),I(!0)},lr=async()=>{if(q?.id)try{k(!0),await yF(q.id),s(qe=>qe.filter(ze=>ze.id!==q.id)),await oe();const ce=pd(null,{action:"delete"});e({variant:"success",title:ce.title,description:`Produto "${q.name}" foi inativado com sucesso.`})}catch(ce){const qe=pd(ce,{action:"delete"});e({variant:"destructive",...qe})}finally{k(!1),I(!1),B(null)}};return a.jsxs(a.Fragment,{children:[a.jsxs(Fr.div,{variants:qst,initial:"hidden",animate:"visible",className:"flex flex-col",children:[a.jsxs(Fr.div,{variants:$3,className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-black text-text-primary tracking-tighter",children:"Controle de Produtos"}),a.jsx("p",{className:"text-text-secondary hidden md:block",children:"Controle total sobre seu inventrio e estoque."})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full hidden md:flex items-center justify-center",onClick:()=>L(!0),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(Wc,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"hidden md:flex items-center gap-2 flex-wrap",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:()=>h(ce=>!ce),title:f?"Ocultar resumo":"Mostrar resumo","aria-label":f?"Ocultar resumo":"Mostrar resumo",children:f?a.jsx(kg,{className:"h-4 w-4"}):a.jsx(Xg,{className:"h-4 w-4"})}),a.jsxs(Z,{variant:"outline",onClick:ur,children:[a.jsx(ws,{className:"mr-2 h-4 w-4"})," Exportar"]}),a.jsxs(Z,{variant:"secondary",onClick:()=>Lt(!0),children:[a.jsx(il,{className:"mr-2 h-4 w-4"})," Importar XML"]}),a.jsxs(Z,{onClick:or,children:[a.jsx(so,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]}),a.jsxs("div",{className:"mt-2 flex md:hidden items-center gap-2",children:[a.jsxs(Z,{variant:"outline",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:ur,title:"Exportar CSV","aria-label":"Exportar CSV",children:[a.jsx(ws,{className:"h-4 w-4"}),a.jsx("span",{children:"CSV"})]}),a.jsxs(Z,{variant:"secondary",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:()=>Lt(!0),title:"Importar XML","aria-label":"Importar XML",children:[a.jsx(il,{className:"h-4 w-4"}),a.jsx("span",{children:"XML"})]}),a.jsxs(Z,{className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:or,title:"Novo Produto","aria-label":"Novo Produto",children:[a.jsx(so,{className:"h-4 w-4"}),a.jsx("span",{children:"Prod"})]}),a.jsxs(Z,{variant:"outline",className:"h-9 px-3 rounded-xl flex items-center gap-1 text-xs",onClick:()=>b(!0),title:"Gerenciar categorias","aria-label":"Gerenciar categorias",children:[a.jsx(u_,{className:"h-4 w-4"}),a.jsx("span",{children:"Cat."})]}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-xl flex items-center justify-center ml-auto",onClick:()=>L(!0),title:"Configuraes da aba","aria-label":"Configuraes da aba",children:a.jsx(Wc,{className:"h-4 w-4"})}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-xl flex items-center justify-center ml-auto",onClick:()=>h(ce=>!ce),title:f?"Ocultar resumo":"Mostrar resumo","aria-label":f?"Ocultar resumo":"Mostrar resumo",children:f?a.jsx(kg,{className:"h-5 w-5"}):a.jsx(Xg,{className:"h-5 w-5"})})]})]}),f&&a.jsxs("div",{className:"grid grid-cols-3 gap-3 md:gap-6 mb-6",children:[a.jsx(Tk,{icon:jd,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Mais Vendido (Dia)"}),a.jsx("span",{className:"md:hidden",children:"+ vendidos"})]}),value:Vt.mostSold,subtitle:"Produto com mais sadas hoje",color:"text-brand",onClick:lt}),a.jsx(Tk,{icon:Kf,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Estoque Baixo"}),a.jsx("span",{className:"md:hidden",children:"Est. baixo"})]}),value:Vt.lowStock,subtitle:"Produtos precisando de reposio",color:"text-warning",onClick:()=>Me("low_stock"),isActive:w==="low_stock"}),a.jsx(Tk,{icon:A2,title:a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"hidden md:inline",children:"Vendidos"}),a.jsx("span",{className:"md:hidden",children:"Vencidos"})]}),value:Vt.expired,subtitle:"Produtos fora da data de validade",color:"text-danger",onClick:()=>Me("expired"),isActive:w==="expired"})]}),a.jsx(Un,{open:ae,onOpenChange:ut,children:a.jsxs(zn,{className:"max-w-2xl",onKeyDown:ce=>ce.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold",children:"Vendas por Perodo"}),a.jsx(ma,{children:"Selecione o intervalo de datas e visualize os produtos vendidos."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Incio"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start",children:[a.jsx(A2,{className:"mr-2 h-4 w-4"}),pt?dr(pt,"dd/MM/yyyy"):"Incio"]})}),a.jsx(Go,{className:"p-0 w-[300px]",children:a.jsx("div",{className:"w-[300px] min-h-[332px]",children:a.jsx(ei,{mode:"single",selected:pt,onSelect:ce=>ce&&ft(ce),initialFocus:!0,fixedWeeks:!0})})})]})]}),a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Fim"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start",children:[a.jsx(A2,{className:"mr-2 h-4 w-4"}),Dt?dr(Dt,"dd/MM/yyyy"):"Fim"]})}),a.jsx(Go,{className:"p-0 w-[300px]",children:a.jsx("div",{className:"w-[300px] min-h-[332px]",children:a.jsx(ei,{mode:"single",selected:Dt,onSelect:ce=>ce&&Bt(ce),initialFocus:!0,fixedWeeks:!0})})})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{type:"button",onClick:ot,disabled:ge,className:"w-full",children:ge?"Carregando...":"Aplicar"}),a.jsx(Z,{type:"button",variant:"secondary",onClick:()=>{try{const ce=Gt||[],qe=";",ze=()=>{const Kr=["Produto;Quantidade"];for(const jr of ce)Kr.push(`${(jr.name||"").replace(/;/g,",")}${qe}${Number(jr.total||0)}`);return Kr.join(`
`)},xt=new Blob(["\uFEFF"+ze()],{type:"text/csv;charset=utf-8;"}),rr=URL.createObjectURL(xt),ir=document.createElement("a");ir.href=rr,ir.download="vendas-periodo.csv",document.body.appendChild(ir),ir.click(),document.body.removeChild(ir),URL.revokeObjectURL(rr),e({title:"Exportao concluda",description:`${ce.length} linha(s)`,variant:"success"})}catch(ce){e({title:"Falha ao exportar",description:ce?.message||"Tente novamente",variant:"destructive"})}},children:"Exportar CSV"})]})]}),a.jsx("div",{className:"mt-3 border rounded-md max-h-[50vh] overflow-auto thin-scroll",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-surface-2",children:[a.jsx("th",{className:"text-left p-2",children:"Produto"}),a.jsx("th",{className:"text-right p-2",children:"Quantidade"})]})}),a.jsxs("tbody",{children:[(Gt||[]).length===0&&!ge&&a.jsx("tr",{children:a.jsx("td",{colSpan:2,className:"p-3 text-text-muted",children:"Nenhum item no perodo."})}),(Gt||[]).map(ce=>a.jsxs("tr",{className:"border-t border-border",children:[a.jsx("td",{className:"p-2",children:ce.name}),a.jsx("td",{className:"p-2 text-right font-mono",children:Number(ce.total||0)})]},ce.id))]})]})}),a.jsx(Ga,{children:a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",children:"Fechar"})})})]})}),a.jsx(Un,{open:U,onOpenChange:L,children:a.jsxs(zn,{className:"max-w-2xl",children:[a.jsx(Bn,{children:a.jsx(Ln,{children:"Configuraes da aba"})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-[11px] font-medium text-text-muted",children:"Modo de listagem"}),a.jsxs(Zn,{value:H,onValueChange:ie,children:[a.jsx(Yn,{className:"w-[200px] h-8 text-xs",children:a.jsx(ta,{placeholder:"Paginado"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"paged",children:"Paginado (100 por pgina)"}),a.jsx(nt,{value:"all",children:"Todos (sem paginao)"})]})]})]}),a.jsx("div",{className:"flex items-center justify-between pt-1",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qs,{id:"produtos-show-stats",checked:f,onCheckedChange:h}),a.jsx("label",{htmlFor:"produtos-show-stats",className:"text-xs font-medium text-text-primary",children:"Mostrar cards de resumo no topo"})]})})]}),a.jsx(Ga,{children:a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",children:"Fechar"})})})]})}),a.jsxs(Fr.div,{variants:$3,className:"bg-surface rounded-lg border border-border flex flex-col",children:[a.jsxs("div",{className:"p-3 pb-4 sm:p-4 border-b border-border space-y-3 flex-shrink-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar por nome ou cdigo...",className:"pl-9 text-sm",value:_,onChange:ce=>C(ce.target.value)})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex md:hidden items-center justify-center",onClick:()=>he(!0),"aria-label":"Abrir filtros",title:"Filtros",children:a.jsx(wN,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"hidden md:flex w-full items-center gap-3",children:[a.jsx("div",{className:"flex-1 min-w-[120px]",children:a.jsxs(Zn,{value:E.type,onValueChange:ce=>gt("type",ce),children:[a.jsx(Yn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Tipos"}),a.jsx(nt,{value:"Venda",children:"Venda"}),a.jsx(nt,{value:"Uso Interno",children:"Uso Interno"})]})]})}),a.jsx("div",{className:"flex-1 min-w-[140px]",children:a.jsxs(Zn,{value:E.category,onValueChange:ce=>gt("category",ce),children:[a.jsx(Yn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Categorias"}),o.map(ce=>a.jsx(nt,{value:ce,children:ce},ce))]})]})}),a.jsx("div",{className:"flex-1 max-w-[180px]",children:a.jsxs(Zn,{value:E.status,onValueChange:ce=>gt("status",ce),children:[a.jsx(Yn,{className:"w-full text-xs sm:text-sm bg-surface-2 border border-border rounded-full px-3",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Status"}),a.jsx(nt,{value:"active",children:"Ativo"}),a.jsx(nt,{value:"low_stock",children:"Estoque Baixo"}),a.jsx(nt,{value:"inactive",children:"Inativo"})]})]})}),a.jsxs("div",{className:"flex-1 flex justify-end gap-2 min-w-[160px]",children:[a.jsxs(Z,{variant:"outline",onClick:()=>gt("newOnly",!E.newOnly),className:Pr("text-xs sm:text-sm rounded-full px-3 border border-border bg-surface-2 hover:bg-surface flex items-center gap-1 whitespace-nowrap",E.newOnly&&"bg-amber-500 text-black border-amber-500 hover:bg-amber-400"),size:"sm",children:[a.jsx("span",{className:"mr-1",children:""}),a.jsx("span",{children:"Novos"})]}),a.jsxs(Z,{variant:"outline",onClick:()=>b(!0),className:"text-xs sm:text-sm rounded-full px-3 border border-border bg-surface-2 hover:bg-surface flex items-center gap-1 whitespace-nowrap",size:"sm",children:[a.jsx(u_,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.jsx("span",{children:"Categorias"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex items-center justify-center",onClick:()=>L(ce=>!ce),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(Wc,{className:"h-4 w-4"})})]})]})]}),l.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"px-3 sm:px-4 py-2.5 border-b border-border flex md:hidden items-center gap-2 text-xs",children:[a.jsxs("span",{className:"font-medium mr-2",children:[l.length," sel."]}),a.jsxs("button",{type:"button",className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border bg-surface-2",onClick:()=>{const ce=Ct.length>0&&Ct.every(qe=>l.includes(qe.id));ha(!ce)},children:[a.jsx(Qs,{checked:Ct.length>0&&Ct.every(ce=>l.includes(ce.id)),className:"h-4 w-4"}),a.jsx("span",{children:"Todos"})]}),a.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>cn("active"),children:a.jsx(Di,{className:"h-4 w-4"})}),a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8 text-danger border-danger/60 hover:bg-danger/10",onClick:()=>cn("inactive"),children:a.jsx(bc,{className:"h-4 w-4"})}),on&&a.jsx(Z,{variant:"outline",size:"icon",className:"h-8 w-8 border-amber-500/70 text-amber-700 hover:bg-amber-500/10",onClick:ke,children:a.jsx(u_,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"hidden md:flex px-4 py-2 border-b border-border items-center gap-3 text-xs",children:[a.jsx("span",{className:"font-medium text-text-secondary whitespace-nowrap",children:l.length===0?"Nenhum item selecionado":`${l.length} produto${l.length>1?"s":""} selecionado${l.length>1?"s":""}`}),a.jsxs("div",{className:"flex flex-1 flex-wrap items-center justify-end gap-2",children:[a.jsxs(Z,{variant:"outline",size:"xs",className:"h-7 px-3 rounded-full border border-border bg-surface-2 hover:bg-surface flex items-center gap-1",onClick:zr,children:[a.jsx(Di,{className:"h-3 w-3"}),a.jsx("span",{children:"Marcar filtrados"})]}),a.jsxs(Z,{variant:"outline",size:"xs",className:"h-7 px-3 rounded-full border border-border bg-surface-2 hover:bg-surface flex items-center gap-1",onClick:Gr,children:[a.jsx(wN,{className:"h-3 w-3"}),a.jsx("span",{children:"Limpar seleo"})]}),a.jsxs(Z,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full border-emerald-500/70 text-emerald-300 bg-emerald-500/10 hover:bg-emerald-500/20 flex items-center gap-1",onClick:()=>cn("active"),children:[a.jsx(Di,{className:"h-3 w-3"}),a.jsx("span",{children:"Ativar itens"})]}),a.jsxs(Z,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full text-danger border-danger/60 hover:bg-danger/10 flex items-center gap-1",onClick:()=>cn("inactive"),children:[a.jsx(kg,{className:"h-3 w-3"}),a.jsx("span",{children:"Desativar itens"})]}),on&&a.jsxs(Z,{size:"xs",variant:"outline",className:"h-7 px-3 rounded-full border-amber-500/70 text-amber-500 hover:bg-amber-500/10 flex items-center gap-1",onClick:ke,children:[a.jsx(u_,{className:"h-3 w-3"}),a.jsx("span",{children:'Limpar tag "Novo"'})]})]})]})]}),a.jsx("div",{children:Ct.length===0?a.jsxs("div",{className:"p-10 text-center text-text-secondary",children:[a.jsx("p",{className:"text-lg mb-3",children:"Nenhum produto cadastrado."}),a.jsxs(Z,{onClick:or,children:[a.jsx(so,{className:"mr-2 h-4 w-4"}),"Cadastrar primeiro produto"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden p-3 space-y-3",children:Ct.map(ce=>{const qe=l.includes(ce.id);return a.jsxs("div",{className:Pr("rounded-lg border bg-surface p-4 space-y-3 cursor-pointer",qe?"border-brand/70 bg-brand/5":"border-border"),onClick:()=>br(ce),children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsx("button",{type:"button",className:"pt-1 pr-2 -ml-1 flex items-center justify-center w-9 h-9",onClick:ze=>{ze.stopPropagation(),an(ce.id)},children:a.jsx(Qs,{checked:qe,className:"h-5 w-5 border-2"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"font-semibold text-base text-text-primary truncate",title:ce.name,children:ce.name}),ce.dataImportacao&&(()=>Math.floor((new Date-ce.dataImportacao)/864e5)<=7?a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand text-xs font-medium flex-shrink-0",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Novo"})]}):null)()]}),a.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:ce.category||"Sem categoria"})]}),a.jsx("span",{className:Pr("inline-flex px-2 py-0.5 rounded-full text-xs border flex-shrink-0",ce.status==="active"&&"bg-emerald-50/5 border-emerald-500/30 text-emerald-400",ce.status==="low_stock"&&"bg-amber-50/5 border-amber-500/30 text-amber-400",ce.status==="inactive"&&"bg-surface-2 border-border text-text-muted"),children:ce.status==="active"?"Ativo":ce.status==="low_stock"?"Estoque Baixo":"Inativo"})]}),a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-text-muted",children:[ce.code&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Cd."}),a.jsx("span",{className:"font-mono text-text-primary text-xs",children:ce.code})]}),a.jsx("span",{className:"mx-1 text-text-muted",children:""}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"R$"}),a.jsx("span",{className:"font-semibold text-text-primary",children:ce.price.toFixed(2)})]}),a.jsx("span",{className:"mx-1 text-text-muted",children:""}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Est."}),a.jsx("span",{className:"font-medium text-text-primary",children:ce.stock})]}),ce.validade&&a.jsx("span",{className:"mx-1 text-text-muted",children:""}),ce.validade&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{children:"Val."}),a.jsx("span",{className:"text-text-primary",children:(()=>{const ze=ce.validade instanceof Date?ce.validade:x8(String(ce.validade));return isNaN(ze)?"-":dr(ze,"dd/MM/yy")})()})]}),a.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:ze=>{ze.stopPropagation(),br(ce)},className:"h-7 w-7",children:a.jsx(fc,{className:"h-3.5 w-3.5"})}),a.jsx(Z,{variant:"outline",size:"icon",onClick:ze=>{ze.stopPropagation(),Ye(ce)},className:"h-7 w-7 text-danger hover:text-danger",children:a.jsx(bc,{className:"h-3.5 w-3.5"})})]})]})]},ce.id)})}),a.jsx("div",{className:"hidden md:block rounded-lg border border-border overflow-hidden",children:a.jsxs("table",{className:"w-full text-sm bg-surface table-fixed",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{className:"border-b border-border",children:[a.jsx("th",{className:"p-3 w-10 text-center",children:a.jsx(Qs,{checked:Ct.length>0&&Ct.every(ce=>l.includes(ce.id)),onCheckedChange:ce=>ha(!!ce)})}),a.jsxs("th",{className:"p-3 text-left font-semibold select-none cursor-pointer whitespace-nowrap w-[110px]",onClick:()=>Er("code"),children:["Cdigo ",z.by==="code"?z.dir==="asc"?"":"":""]}),a.jsxs("th",{className:"p-3 text-left font-semibold select-none cursor-pointer whitespace-nowrap w-[40%]",onClick:()=>Er("name"),children:["Produto ",z.by==="name"?z.dir==="asc"?"":"":""]}),a.jsx("th",{className:"p-3 text-left font-semibold whitespace-nowrap w-[18%]",children:"Categoria"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[120px]",children:"Preo"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[110px]",children:"Estoque"}),a.jsxs("th",{className:"p-3 text-center font-semibold select-none cursor-pointer whitespace-nowrap w-[120px]",onClick:()=>Er("validade"),children:["Validade ",z.by==="validade"?z.dir==="asc"?"":"":""]}),a.jsx("th",{className:"p-3 text-center font-semibold whitespace-nowrap w-[140px]",children:"Status"}),a.jsx("th",{className:"p-3 text-right font-semibold whitespace-nowrap w-[90px]",children:"Aes"})]})}),a.jsx("tbody",{className:"text-text-primary divide-y divide-border",children:Ct.map(ce=>a.jsxs("tr",{className:"hover:bg-surface-2 transition-colors group cursor-pointer align-middle",children:[a.jsx("td",{className:"p-3 text-center align-middle",children:a.jsx(Qs,{checked:l.includes(ce.id),onCheckedChange:()=>an(ce.id)})}),a.jsx("td",{className:"p-3 font-mono text-sm text-text-secondary align-middle whitespace-nowrap",onClick:()=>br(ce),children:ce.code||"-"}),a.jsx("td",{className:"p-3 font-semibold align-middle text-text-primary whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>br(ce),title:ce.name,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"truncate",children:ce.name}),ce.dataImportacao&&(()=>Math.floor((new Date-ce.dataImportacao)/864e5)<=7?a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand text-xs font-medium flex-shrink-0",children:[a.jsx("span",{children:""}),a.jsx("span",{children:"Novo"})]}):null)()]})}),a.jsx("td",{className:"p-3 text-text-secondary align-middle whitespace-nowrap",onClick:()=>br(ce),children:ce.category}),a.jsxs("td",{className:"p-3 text-right font-mono tabular-nums align-middle whitespace-nowrap",onClick:()=>br(ce),children:["R$ ",ce.price.toFixed(2)]}),a.jsx("td",{className:"p-3 text-right font-mono tabular-nums align-middle whitespace-nowrap",onClick:()=>br(ce),children:ce.stock}),a.jsx("td",{className:"p-3 text-center font-mono tabular-nums whitespace-nowrap",onClick:()=>br(ce),children:(()=>{if(!ce.validade)return"-";const qe=ce.validade instanceof Date?ce.validade:x8(String(ce.validade));return isNaN(qe)?"-":dr(qe,"dd/MM/yy")})()}),a.jsx("td",{className:"p-3 text-center whitespace-nowrap",onClick:()=>br(ce),children:a.jsx("span",{className:Pr("px-2 py-1 text-xs font-bold rounded-full",ce.status==="active"&&"bg-success/10 text-success",ce.status==="low_stock"&&"bg-warning/10 text-warning",ce.status==="inactive"&&"bg-danger/10 text-danger"),children:ce.status==="active"?"Ativo":ce.status==="low_stock"?"Estoque Baixo":"Inativo"})}),a.jsx("td",{className:"p-3 whitespace-nowrap",children:a.jsx("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(Z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-text-muted hover:text-danger",onClick:qe=>{qe.stopPropagation(),Ye(ce)},children:a.jsx(bc,{size:14})})})})]},ce.id))})]})})]})}),Y&&a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-2 text-xs sm:text-sm text-text-muted px-3 sm:px-4 pb-3",children:[a.jsxs("span",{children:["Pgina ",W," de ",Wt," (",G," produto(s))"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>se(ce=>Math.max(1,ce-1)),disabled:W<=1,children:"Anterior"}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>se(ce=>Math.min(Wt,ce+1)),disabled:W>=Wt,children:"Prxima"})]})]})]})]}),a.jsx(Ust,{open:g,onOpenChange:v,product:m,categories:o,onSave:At,onCreateCategory:Ze,suggestedCode:m?void 0:d,onRefreshProducts:oe,products:n}),a.jsx(Un,{open:O,onOpenChange:I,children:a.jsxs(zn,{className:"sm:max-w-[480px]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Excluir produto"}),a.jsxs(ma,{children:["Tem certeza que deseja excluir o produto",q?` "${q.name}"`:"","? Esta ao no pode ser desfeita."]})]}),a.jsxs(Ga,{children:[a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",disabled:T,children:"Cancelar"})}),a.jsx(Z,{type:"button",variant:"destructive",onClick:lr,disabled:T,children:T?"Excluindo...":"Excluir"})]})]})}),a.jsx(Lst,{open:bt,onOpenChange:Lt,products:n,codigoEmpresa:t?.codigo_empresa,onSuccess:()=>{oe(),Lt(!1)}}),a.jsx(Un,{open:wr,onOpenChange:he,children:a.jsxs(zn,{className:"w-[90vw] sm:max-w-[420px]",children:[a.jsx(Bn,{children:a.jsx(Ln,{className:"text-base",children:"Filtros de Produtos"})}),a.jsxs("div",{className:"space-y-3 py-2 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(ct,{className:"text-xs",children:"Tipo"}),a.jsxs(Zn,{value:E.type,onValueChange:ce=>gt("type",ce),children:[a.jsx(Yn,{className:"text-xs",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todos"}),a.jsx(nt,{value:"Venda",children:"Venda"}),a.jsx(nt,{value:"Uso Interno",children:"Uso Interno"})]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(ct,{className:"text-xs",children:"Categoria"}),a.jsxs(Zn,{value:E.category,onValueChange:ce=>gt("category",ce),children:[a.jsx(Yn,{className:"text-xs",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todas"}),o.map(ce=>a.jsx(nt,{value:ce,children:ce},ce))]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(ct,{className:"text-xs",children:"Status"}),a.jsxs(Zn,{value:E.status,onValueChange:ce=>gt("status",ce),children:[a.jsx(Yn,{className:"text-xs",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todos"}),a.jsx(nt,{value:"active",children:"Ativo"}),a.jsx(nt,{value:"low_stock",children:"Estoque Baixo"}),a.jsx(nt,{value:"inactive",children:"Inativo"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[a.jsx(Qs,{id:"mobileNewOnly",checked:!!E.newOnly,onCheckedChange:ce=>gt("newOnly",!!ce)}),a.jsx(ct,{htmlFor:"mobileNewOnly",className:"text-xs flex items-center gap-1",children:a.jsx("span",{children:"Somente Novos"})})]})]}),a.jsxs(Ga,{className:"flex justify-between mt-2",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"text-xs",onClick:()=>{S({type:"all",category:"all",status:"active",newOnly:!1}),he(!1)},children:"Limpar"}),a.jsx(Z,{type:"button",size:"sm",className:"text-xs",onClick:()=>he(!1),children:"Aplicar"})]})]})}),a.jsx(Wst,{open:y,onOpenChange:b,categories:o,onAddCategory:Ze,onRemoveCategory:Je})]})}function Gst({purchase:e,items:t,onClose:r,onEdit:n,onReprocess:s,onDownloadXML:o,onInactivate:i}){if(!e)return null;const l=t.reduce((d,u)=>d+Number(u.valor_total||0),0),c=d=>d?.data_importacao?Hwe(new Date,new Date(d.data_importacao))<=7:!1;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-3 py-4 bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"relative w-[95vw] sm:w-full sm:max-w-4xl max-h-[85vh] bg-surface rounded-xl shadow-2xl border border-border overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"relative bg-surface border-b border-border p-4",children:[a.jsx("button",{onClick:r,className:"absolute top-3 right-3 p-1.5 hover:bg-surface-2 rounded-lg transition-colors",children:a.jsx(Hc,{className:"h-4 w-4 text-text-muted"})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4 pr-0 sm:pr-10",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"p-2 bg-brand/10 rounded-lg",children:a.jsx(il,{className:"h-5 w-5 text-brand"})}),a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-bold text-text-primary mb-0.5",children:["NF-e ",e.numero_nfe,e.serie_nfe&&` / Srie ${e.serie_nfe}`]}),a.jsx("p",{className:"text-text-muted text-xs",children:e.natureza_operacao||"Nota Fiscal Eletrnica"})]})]}),a.jsxs("div",{className:"mt-3 sm:mt-0 sm:text-right",children:[a.jsx("p",{className:"text-text-muted text-xs mb-0.5",children:"Valor Total"}),a.jsxs("p",{className:"text-xl sm:text-2xl font-bold text-success whitespace-nowrap",children:["R$ ",Number(e.valor_total||0).toFixed(2)]})]})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-6",children:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-surface-2 rounded-lg border border-border p-4",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a.jsx(kf,{className:"h-4 w-4 text-brand"})}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-0.5",children:"Fornecedor"}),a.jsx("p",{className:"font-semibold text-base text-text-primary leading-snug break-words",children:e.fornecedor?.nome||"No identificado"}),e.fornecedor?.cnpj&&a.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:["CNPJ: ",e.fornecedor.cnpj]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-5 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(Io,{className:"h-3.5 w-3.5 text-info"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Emisso"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.data_emissao?dr(new Date(e.data_emissao),"dd/MM/yyyy",{locale:$a}):"No informada"})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(lfe,{className:"h-3.5 w-3.5 text-warning"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Operao"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.tipo_operacao||"Entrada"})]}),e.forma_pagamento&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(Dh,{className:"h-3.5 w-3.5 text-success"}),a.jsx("span",{className:"text-xs font-medium text-text-muted",children:"Pagamento"})]}),a.jsx("p",{className:"font-semibold text-text-primary",children:e.forma_pagamento})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-1",children:"Valor dos Produtos"}),a.jsxs("p",{className:"font-semibold text-text-primary",children:["R$ ",l.toFixed(2)]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-text-muted mb-1",children:"Valor Total NF-e"}),a.jsxs("p",{className:"font-semibold text-brand",children:["R$ ",Number(e.valor_total||0).toFixed(2)]})]})]})]})}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-base font-semibold text-text-primary flex items-center gap-2 mb-3",children:[a.jsx(bu,{className:"h-4 w-4 text-brand"}),"Produtos da NF-e",a.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-brand/10 text-brand font-medium ml-2",children:t.length})]}),a.jsx("div",{className:"space-y-2",children:t.map((d,u)=>a.jsx("div",{className:"p-3 bg-surface-2 rounded-lg border border-border hover:border-brand/30 transition-colors",children:a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-brand/10 text-brand text-xs font-bold flex items-center justify-center mt-0.5",children:u+1}),a.jsxs("div",{className:"flex-1",children:[d.produto?.nome?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"font-medium text-base text-text-primary mb-0.5",children:["Produto atual: ",d.produto.nome]}),d.nome_produto_xml&&a.jsxs("p",{className:"text-xs text-text-muted mb-1",children:["XML original: ",a.jsx("span",{className:"font-medium text-text-primary",children:d.nome_produto_xml})]})]}):a.jsx("p",{className:"font-medium text-sm text-text-primary mb-1",children:d.nome_produto_xml}),a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-0.5 text-xs text-text-muted mb-1.5",children:[(d.produto?.codigo_produto||d.codigo_produto_xml)&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"Cd:"})," ",d.produto?.codigo_produto||d.codigo_produto_xml]}),d.ean_xml&&d.ean_xml!=="SEM GTIN"&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"EAN:"})," ",d.ean_xml]}),d.ncm_xml&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"NCM:"})," ",d.ncm_xml]}),d.unidade_xml&&a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:"Un:"})," ",d.unidade_xml]}),d.produto&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-success/20 text-success font-medium",children:" Cadastrado"}),d.produto&&c(d.produto)&&a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-brand/20 text-brand font-medium",children:[a.jsx(UI,{className:"h-3 w-3"}),"Novo"]}),d.vinculado_manualmente&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-warning/20 text-warning font-medium",children:" Vinculado"}),!d.produto&&a.jsx("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-text-muted/20 text-text-muted font-medium",children:" No importado"})]})]})]})}),a.jsxs("div",{className:"flex-shrink-0 text-right",children:[a.jsxs("div",{className:"mb-1.5",children:[a.jsx("span",{className:"text-xs text-text-muted mr-1",children:"Qtd:"}),a.jsx("span",{className:"font-bold text-base text-warning",children:d.quantidade})]}),a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit: ",a.jsxs("span",{className:"font-semibold text-success",children:["R$ ",Number(d.valor_unitario||0).toFixed(2)]})]}),a.jsxs("p",{className:"text-sm font-bold text-text-primary",children:["Total: R$ ",Number(d.valor_total||0).toFixed(2)]})]})]})]})},u))})]}),e.chave_nfe&&a.jsxs("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("p",{className:"text-xs font-medium text-text-muted mb-1.5 flex items-center gap-1.5",children:[a.jsx(il,{className:"h-3 w-3"}),"Chave de Acesso NF-e:"]}),a.jsx("p",{className:"font-mono text-xs text-text-primary break-all leading-relaxed select-all",children:e.chave_nfe})]})]})}),a.jsxs("div",{className:"p-3 sm:p-4 bg-surface-2 border-t border-border flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsx("div",{className:"flex flex-wrap gap-2",children:e.ativo&&a.jsxs(a.Fragment,{children:[a.jsxs(Z,{onClick:()=>n?.(e),size:"sm",variant:"outline",className:"gap-2",children:[a.jsx(fc,{className:"h-4 w-4"}),"Editar"]}),a.jsxs(Z,{onClick:()=>s?.(e),size:"sm",variant:"outline",className:"gap-2",disabled:!e.xml_completo,children:[a.jsx(Ig,{className:"h-4 w-4"}),"Reprocessar"]}),e.xml_completo&&a.jsx(a.Fragment,{children:a.jsxs(Z,{onClick:()=>o?.(e),size:"sm",variant:"outline",className:"gap-2",children:[a.jsx(ws,{className:"h-4 w-4"}),"XML"]})}),a.jsxs(Z,{onClick:()=>i?.(e),size:"sm",variant:"outline",className:"gap-2 text-destructive hover:text-destructive",children:[a.jsx(bc,{className:"h-4 w-4"}),"Inativar"]})]})}),a.jsx(Z,{onClick:r,variant:"outline",className:"w-full sm:w-auto",children:"Fechar"})]})]})})}function Kst({open:e,onOpenChange:t,purchase:r,products:n,codigoEmpresa:s,onSuccess:o,autoFile:i}){const{toast:l}=Zs(),[c,d]=p.useState("upload"),[u,f]=p.useState(null),[h,m]=p.useState(null),[x,g]=p.useState([]),[v,y]=p.useState(!1),[b,w]=p.useState({created:0,updated:0,errors:0,details:[]}),[j,_]=p.useState({}),[C,E]=p.useState({}),[S,A]=p.useState({}),[M,O]=p.useState({isOpen:!1,productIndex:null,currentProduct:null}),[I,T]=p.useState({isOpen:!1}),k=()=>{const W=h?.nfe?.modelo||r?.modelo_nfe;return W==="55"?"NF-e":W==="65"?"NFC-e":"NF-e / NFC-e"},q=(W,se,pe)=>j[W]?.[se]??pe,B=(W,se)=>!W||!se?0:W*(1+se/100),z=W=>{E(se=>({...se,[W]:!se[W]}))},F=(W,se,pe)=>{console.log("[XMLReprocessModal] handleEditProduct chamado:",{index:W,field:se,value:pe}),_(G=>{const te={...G,[W]:{...G[W],[se]:pe}};return console.log("[XMLReprocessModal] Novo estado editedProducts:",te),te})},V=W=>{g(se=>se.map((pe,G)=>{if(G===W){const te=!pe.selected;return A(oe=>({...oe,[W]:te})),{...pe,selected:te}}return pe}))},me=(W,se)=>{console.log("[XMLReprocessModal] handleLinkProduct chamado:",{index:W,productId:se}),console.log("[XMLReprocessModal] Estado editedProducts antes:",j[W]),F(W,"linkedProductId",se),console.log("[XMLReprocessModal] Estado editedProducts depois:",{...j,[W]:{...j[W],linkedProductId:se}})};p.useEffect(()=>{i&&e&&be(i)},[i,e]);const be=async W=>{f(W);try{console.log("[XMLReprocess] Processando arquivo automtico..."),console.log("[XMLReprocess] Purchase data:",r);const pe=await W.text();console.log("[XMLReprocess] XML content length:",pe.length);const G=gC(pe);if(!G.success){l({title:"Erro ao ler XML",description:G.error||"XML invlido",variant:"destructive"});return}console.log("[XMLReprocess] Dados parseados:",G.data),console.log("[XMLReprocess] Produtos encontrados:",G.data?.produtos?.length||0),console.log("[XMLReprocess] Comparando chaves:",{xmlChave:G.data?.nfe?.chaveAcesso,purchaseChave:r?.chave_nfe,match:G.data?.nfe?.chaveAcesso===r?.chave_nfe}),m(G.data);const te=await uoe(r.id);console.log("[XMLReprocess] Itens da compra original:",te.length);const oe=G.data?.produtos?.map((re,ae)=>{const ut=xC(re,n),pt=!ut,ft=te.find(Dt=>re.codigo&&Dt.codigo_produto_xml?Dt.codigo_produto_xml===re.codigo:Dt.nome_produto_xml===re.nome),bt=!!ft,Lt=ft?.selecionado_na_importacao||!1;return console.log(`[XMLReprocess] Produto ${ae+1}: ${re.nome}`),console.log(`  - Cdigo XML: ${re.codigo}`),console.log("  - originalItem encontrado:",ft?`${ft.nome_produto_xml} (cdigo: ${ft.codigo_produto_xml})`:"NO ENCONTRADO"),console.log(`  - wasImported: ${bt}`),console.log(`  - wasSelectedInOriginalImport: ${Lt}`),{index:ae,xml:re,existing:ut,isNew:pt,wasImported:bt,selected:S[ae]!==void 0?S[ae]:bt}})||[];console.log("[XMLReprocess] Preview preparado:",oe.length,"produtos"),console.log("[XMLReprocess] Produtos marcados:",oe.filter(re=>re.selected).length),console.log("[XMLReprocess] Produtos importados originalmente:",oe.filter(re=>re.wasImported).length),console.log("[XMLReprocess] Items da compra original detalhado:"),te.forEach((re,ae)=>{console.log(`  ${ae+1}. ${re.nome_produto_xml} (cdigo: ${re.codigo_produto_xml}) - selecionado_na_importacao: ${re.selecionado_na_importacao}`)}),g(oe);const De={};oe.forEach((re,ae)=>{re.xml.precoVenda&&(De[ae]={salePrice:Number(re.xml.precoVenda)})}),console.log("[XMLReprocess] Pr-populando editedProducts:",De),_(De),d("preview")}catch(pe){console.error("[XMLReprocess] Erro ao processar arquivo automtico:",pe),l({title:"Erro",description:"Erro ao processar o XML salvo.",variant:"destructive"})}},U=async W=>{const se=W.target.files?.[0];if(!se){console.log("[XMLReprocess] Nenhum arquivo selecionado");return}if(console.log("[XMLReprocess] Arquivo selecionado:",se.name),!se.name.endsWith(".xml")){l({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}f(se);try{console.log("[XMLReprocess] Lendo contedo do arquivo...");const pe=await se.text();console.log("[XMLReprocess] Arquivo lido, parseando XML...");const G=gC(pe);if(console.log("[XMLReprocess] XML parseado:",G),!G.success){l({title:"Erro ao ler XML",description:G.error||"XML invlido",variant:"destructive"});return}if(!G.data?.produtos||G.data.produtos.length===0){l({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}if(G.data?.nfe?.chaveAcesso!==r?.chave_nfe){l({title:"XML incompatvel",description:"Este XML no corresponde  NF-e selecionada. Verifique a chave de acesso.",variant:"destructive"});return}m(G.data);let te=n;try{te=await uf({search:"",codigoEmpresa:s,includeInactive:!0})||n,console.log("[XMLReprocess] Produtos carregados para validao:",te.length)}catch(re){console.warn("[XMLReprocess] No foi possvel carregar lista completa, usando cache:",re)}const oe=G.data.produtos.map((re,ae)=>{const ut=xC(re,te);return{xml:re,existing:ut,isNew:!ut,willCreate:!ut,willUpdate:!!ut,selected:!0,index:ae}});g(oe);const De={};oe.forEach((re,ae)=>{re.xml.precoVenda&&(De[ae]={salePrice:Number(re.xml.precoVenda)})}),console.log("[XMLReprocess] Pr-populando editedProducts:",De),_(De),console.log("[XMLReprocess] Preview preparado, mudando para step preview. Total produtos:",oe.length),d("preview")}catch(pe){console.error("[XMLReprocess] Erro ao processar arquivo:",pe),l({title:"Erro",description:"Erro ao processar o arquivo XML.",variant:"destructive"})}},L=()=>{T({isOpen:!0})},H=async()=>{if(T({isOpen:!1}),!h||!r){l({title:"Erro",description:"Dados insuficientes para reprocessamento.",variant:"destructive"});return}y(!0),d("processing");const W={created:0,updated:0,removed:0,errors:0,details:[]},se=x.filter(G=>G.selected),pe=x.filter(G=>!G.selected);console.log("[XMLReprocess] Iniciando reprocessamento para compra:",r.id),console.log("[XMLReprocess] Produtos selecionados:",se.length),console.log("[XMLReprocess] Produtos desmarcados:",pe.length);try{for(const G of pe){const oe=(j[G.index]||{}).name||G.xml.nome,De=Number(G.xml.quantidade);try{if(G.isNew){const re=G.existing;re&&(await yF(re.id),W.removed++,W.details.push({produto:oe,acao:"Produto removido (era novo e foi desmarcado)",status:"success"}))}else{const re=G.existing;re&&De>0&&(await Zv({productId:re.id,delta:-De,codigoEmpresa:r.codigo_empresa}),W.updated++,W.details.push({produto:oe,acao:`Estoque revertido -${De}`,status:"success"}))}}catch(re){console.error(`[XMLReprocess] Erro ao processar produto desmarcado: ${oe}`,re),W.errors++,W.details.push({produto:oe,acao:`Erro ao reverter: ${re.message}`,status:"error"})}}for(const G of se){const te=j[G.index]||{},oe=te.name||G.xml.nome,De=te.qty!==void 0?te.qty:Number(G.xml.quantidade),re=te.margin,ae=te.salePrice,ut=te.linkedProductId;try{if(G.isNew&&(!ut||ut==="new")){const pt=L3(G.xml,r.codigo_empresa);if(oe&&(pt.name=oe),ae!=null)pt.salePrice=ae,pt.price=ae;else if(re!=null&&re>0){const bt=pt.costPrice||0;if(bt>0){const Lt=bt*(1+re/100);pt.salePrice=Lt,pt.price=Lt}}else pt.salePrice!=null&&pt.price==null&&(pt.price=pt.salePrice);const ft=await pC(pt,{codigoEmpresa:r.codigo_empresa});De>0&&await Zv({productId:ft.id,delta:De,codigoEmpresa:r.codigo_empresa}),W.created++,W.details.push({produto:oe,acao:De>0?`Criado com estoque ${De}`:"Criado",status:"success"})}else{const pt=ut&&ut!=="force-new"&&ut!=="new"?n.find(ft=>ft.id===ut):G.existing;if(te.updatePrice&&pt){const ft=Number(G.xml.valorUnitario)||0,bt={};if(ft>0&&(bt.costPrice=ft),ae!=null)bt.salePrice=ae,bt.price=ae;else if(re!=null&&re>0&&ft>0){const Lt=ft*(1+re/100);bt.salePrice=Lt,bt.price=Lt}await U1(pt.id,bt)}W.updated++,W.details.push({produto:oe,acao:te.updatePrice?"Preo atualizado":"Mantido sem alteraes",status:"success"})}}catch(pt){console.error(`[XMLReprocess] Erro ao processar produto: ${oe}`,pt),W.errors++,W.details.push({produto:oe,acao:`Erro: ${pt.message}`,status:"error"})}}}catch(G){console.error("[XMLReprocess] Erro geral no reprocessamento:",G),W.errors++,W.details.push({produto:"Sistema",acao:`Erro geral: ${G.message}`,status:"error",error:G.message})}try{const G=se.map(te=>{const oe=j[te.index]||{},De=oe.linkedProductId;let re=null;return De&&De!=="force-new"?re=De:!te.isNew&&De!=="force-new"&&(re=te.existing?.id||null),{produtoId:re,codigoProdutoXML:te.xml.codigo,nomeProdutoXML:te.xml.nome,eanXML:te.xml.ean,ncmXML:te.xml.ncm,cfopXML:te.xml.cfop,unidadeXML:te.xml.unidade,quantidade:oe.qty!==void 0?oe.qty:Number(te.xml.quantidade),valorUnitario:Number(te.xml.valorUnitario)||0,valorTotal:Number(te.xml.valorTotal)||0,vinculadoManualmente:!!De&&De!=="force-new"}});await Rst(r.id,G),console.log("[XMLReprocess] Itens reprocessados:",G.length)}catch(G){console.error("[XMLReprocess] Erro ao reprocessar itens da compra:",G),W.errors++,W.details.push({produto:"Itens da NF-e",acao:"Erro ao reprocessar",status:"error",error:G.message})}w(W),y(!1),d("done"),W.errors===0?l({title:"Reprocessamento concludo!",description:`${W.created} produto(s) criado(s), ${W.updated} atualizado(s).`,variant:"success"}):l({title:"Reprocessamento com erros",description:`${W.errors} erro(s) encontrado(s). Verifique os detalhes.`,variant:"destructive"}),o&&o()};p.useEffect(()=>{e||(d("upload"),f(null),m(null),g([]),_({}),E({}),w({created:0,updated:0,errors:0,details:[]}),y(!1),A({}))},[e]);const ie=()=>{t(!1)},Y=x.filter(W=>W.selected).length;return a.jsxs(Un,{open:e,onOpenChange:ie,children:[a.jsxs(zn,{className:"w-[95vw] sm:max-w-4xl max-h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs(Bn,{children:[a.jsxs(Ln,{className:"flex items-center gap-2",children:[a.jsx(Ig,{className:"h-5 w-5"}),a.jsx("span",{children:"Reprocessar XML"}),a.jsx("span",{className:"inline-flex items-center rounded-full bg-surface-2 border border-border px-2 py-0.5 text-xs font-semibold text-text-muted uppercase tracking-wide",children:k()}),a.jsx("span",{className:"text-sm text-text-muted",children:r?.numero_nfe})]}),a.jsx(ma,{children:"Reimporte o XML para atualizar os produtos e itens desta NF-e. Os itens atuais sero substitudos pelos novos."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto",children:[c==="upload"&&a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center",children:[a.jsx(tD,{className:"h-12 w-12 mx-auto text-text-muted mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Selecione o arquivo XML"}),a.jsxs("p",{className:"text-text-muted mb-4",children:["Faa upload do XML da NF-e ",r?.numero_nfe," para reprocessar os produtos"]}),a.jsx("input",{type:"file",accept:".xml",onChange:U,className:"hidden",id:"xml-reprocess-upload"}),a.jsx("label",{htmlFor:"xml-reprocess-upload",children:a.jsx(Z,{asChild:!0,children:a.jsx("span",{children:"Selecionar XML"})})})]})}),c==="preview"&&h&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Informaes da NF-e"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",h.nfe.numero]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",h.nfe.serie]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Modelo:"})," ",k()]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Fornecedor:"})," ",h.fornecedor?.nome]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Total:"})," R$ ",Number(h.nfe.totalNota||0).toFixed(2)]})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"font-semibold text-base",children:"Produtos Encontrados"}),a.jsxs("span",{className:"text-sm text-text-muted",children:[x.filter(W=>W.selected).length," de ",x.length," selecionados"]})]}),a.jsx("div",{className:"space-y-2",children:x.map((W,se)=>{const pe=q(se,"name",W.xml.nome),G=q(se,"qty",Number(W.xml.quantidade)),te=q(se,"linkedProductId",null),oe=W.xml.valorUnitario||0,De=q(se,"margin",null);let ae=q(se,"salePrice",null);ae==null&&!W.isNew&&W.existing&&(ae=Number(W.existing.preco_venda||W.existing.salePrice||W.existing.price||0)),ae==null&&De!=null&&(ae=B(oe,De)),ae==null&&W.xml.precoVenda&&(ae=Number(W.xml.precoVenda));let ut=null;if(De!=null)ut=De;else if(ae!=null&&oe>0&&ae>0){const ft=(ae-oe)/oe*100;ut=Math.max(-999,Math.min(9999,ft))}const pt=C[se];return a.jsxs("div",{className:Pr("rounded-lg border transition-all",W.selected?"bg-info/10 border-info/30":"bg-surface opacity-60 border-border"),children:[a.jsxs("div",{className:"p-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("input",{type:"checkbox",checked:W.selected,onChange:()=>V(se),className:"w-4 h-4 rounded border-border accent-warning cursor-pointer"}),a.jsx("button",{onClick:()=>z(se),className:"p-0.5 hover:bg-surface-2 rounded transition-colors",children:pt?a.jsx(hx,{className:"w-4 h-4 text-text-muted"}):a.jsx(Kg,{className:"w-4 h-4 text-text-muted"})}),a.jsx("div",{children:te?a.jsx(jG,{className:"w-5 h-5 text-warning"}):a.jsx(Ig,{className:"w-5 h-5 text-info"})})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:te&&te!=="force-new"&&te!=="new"?(()=>{const ft=n.find(bt=>bt.id===te);return ft?ft.name:pe})():pe}),a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-text-muted mt-0.5",children:[W.xml.codigo&&a.jsxs("span",{className:"flex-shrink-0",children:["#",W.xml.codigo]}),a.jsxs("span",{children:["Qtd: ",G]})]})]}),a.jsx("div",{className:"flex-shrink-0 ml-2",children:te?a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-warning/20 text-warning font-medium",children:"Vinculado"}):a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-info/20 text-info font-medium",children:"Cadastrado"})})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-muted",children:[a.jsxs("span",{children:["R$ ",oe.toFixed(2),ae?`  R$ ${ae.toFixed(2)}`:""]}),ut!=null&&a.jsxs("span",{className:"ml-2 "+(ut>0?"text-success":ut<0?"text-destructive":"text-text-muted"),children:[ut.toFixed(1),"%"]})]})]})]}),pt&&a.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3 border-t border-border/50",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Nome do Produto"}),a.jsx("input",{type:"text",value:pe,onChange:ft=>F(se,"name",ft.target.value),disabled:!W.selected,className:"w-full px-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Quantidade"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>F(se,"qty",Math.max(0,G-1)),disabled:!W.selected||G<=0,className:"w-9 h-9 rounded-md border border-border bg-surface hover:bg-surface-2 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:a.jsx(_v,{className:"w-4 h-4"})}),a.jsx("input",{type:"text",value:G,onChange:ft=>{const bt=ft.target.value.replace(/\D/g,"");F(se,"qty",bt===""?0:Number(bt))},disabled:!W.selected,className:"w-14 text-center px-2 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50"}),a.jsx("button",{type:"button",onClick:()=>F(se,"qty",G+1),disabled:!W.selected,className:"w-9 h-9 rounded-md bg-warning hover:bg-warning/90 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center text-black font-bold shadow-sm",children:a.jsx(so,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Margem %"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:(()=>{const ft=q(se,"margin",null);return ft!=null?String(ft):""})(),onChange:ft=>{const bt=ft.target.value;if(bt===""){F(se,"margin",null),F(se,"salePrice",null);return}const Lt=bt.replace(/[^0-9.,\-]/g,"").replace(",",".");if(Lt==="."||Lt==="-"||Lt==="-.")return;const Dt=parseFloat(Lt);if(!isNaN(Dt)&&(F(se,"margin",Dt),oe>0)){const Bt=B(oe,Dt);F(se,"salePrice",Bt)}},disabled:!W.selected,placeholder:"0",className:"w-24 pl-3 pr-6 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right"}),a.jsx("span",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"%"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Custo"}),a.jsx("div",{className:"px-3 py-2 bg-surface/50 rounded-md border border-border",children:a.jsxs("span",{className:"text-sm font-semibold",children:["R$ ",oe.toFixed(2)]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-muted mb-1 block",children:"Preo Venda"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-sm text-text-muted pointer-events-none",children:"R$"}),a.jsx("input",{type:"text",value:(()=>{const ft=q(se,"salePrice",ae);return ft==null?"":Number(ft).toFixed(2).replace(".",",")})(),onChange:ft=>{const bt=ft.target.value.replace(/\D/g,"");if(bt===""){F(se,"salePrice",null);return}const Lt=Number(bt)/100;if(F(se,"salePrice",Lt),Lt>0&&oe>0){const Dt=(Lt-oe)/oe*100;F(se,"margin",Math.round(Dt*100)/100)}},disabled:!W.selected,placeholder:"0,00",className:"w-28 pl-7 pr-3 py-2 text-sm bg-surface border border-border rounded-md focus:border-brand focus:ring-1 focus:ring-brand outline-none disabled:opacity-50 text-right font-semibold text-success"})]})]})]}),a.jsxs("div",{className:"flex items-center space-x-2 mt-3",children:[a.jsx("input",{type:"checkbox",id:`update-price-${se}`,checked:q(se,"updatePrice",!1),onChange:ft=>F(se,"updatePrice",ft.target.checked),disabled:!W.selected,className:"w-4 h-4 text-brand bg-surface border-border rounded focus:ring-brand focus:ring-2 disabled:opacity-50"}),a.jsx("label",{htmlFor:`update-price-${se}`,className:"text-sm text-text-primary select-none cursor-pointer",children:"Atualizar preo do produto no sistema"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-text-primary mb-1 block",children:"Vincular a Produto Existente (Opcional)"}),a.jsxs(Zn,{value:te==="force-new"?"force-new":te||(W.isNew?"new":W.existing?.id||"new"),onValueChange:ft=>{ft==="new"||ft===W.existing?.id?me(se,null):ft==="search"?O({isOpen:!0,productIndex:se,currentProduct:W}):me(se,ft)},disabled:!W.selected,children:[a.jsx(Yn,{className:"w-full hover:bg-white/5 transition-colors",children:a.jsx(ta,{placeholder:W.isNew?" Criar como novo produto":" Atualizar produto existente"})}),a.jsxs(Jn,{className:"max-h-[300px] overflow-y-auto",children:[W.isNew?a.jsx(nt,{value:"new",children:" Criar como novo produto"}):a.jsxs(nt,{value:W.existing?.id||"new",children:[" Atualizar: ",W.existing?.name," (Estoque atual: ",W.existing?.stock||0,")"]}),!W.isNew&&a.jsx(nt,{value:"force-new",children:" Criar como novo produto (ignorar existente)"}),a.jsx(nt,{value:"search",children:" Buscar produto para vincular..."})]})]})]})]})]},se)})})]})]}),c==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(cl,{className:"h-12 w-12 animate-spin text-brand mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Reprocessando XML..."}),a.jsx("p",{className:"text-text-muted",children:"Atualizando produtos e itens da NF-e"})]}),c==="done"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center py-6",children:[b.errors===0?a.jsx(Di,{className:"h-12 w-12 text-success mx-auto mb-4"}):a.jsx(Pd,{className:"h-12 w-12 text-warning mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:b.errors===0?"Reprocessamento Concludo!":"Reprocessamento com Erros"}),a.jsxs("div",{className:"text-text-muted",children:[b.created," produto(s) criado(s), ",b.updated," atualizado(s)",b.errors>0&&`, ${b.errors} erro(s)`]})]}),b.details.length>0&&a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-3",children:"Detalhes do Reprocessamento"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:b.details.map((W,se)=>a.jsxs("div",{className:Pr("flex items-center gap-3 p-2 rounded",W.status==="success"?"bg-green-50 text-green-800":W.status==="error"?"bg-red-50 text-red-800":"bg-gray-50 text-gray-800"),children:[W.status==="success"?a.jsx(Di,{className:"h-4 w-4 flex-shrink-0"}):a.jsx(Pd,{className:"h-4 w-4 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:W.produto}),a.jsx("div",{className:"text-xs",children:W.acao}),W.error&&a.jsx("div",{className:"text-xs mt-1 opacity-75",children:W.error})]})]},se))})]})]})]}),a.jsxs(Ga,{children:[c==="upload"&&a.jsx(Z,{variant:"outline",onClick:ie,children:"Cancelar"}),c==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:()=>d("upload"),children:"Voltar"}),a.jsxs(Z,{onClick:L,disabled:Y===0,children:["Reprocessar (",Y," produtos)"]})]}),c==="done"&&a.jsx(Z,{onClick:ie,children:"Fechar"})]})]}),a.jsx(foe,{isOpen:M.isOpen,onClose:()=>O({isOpen:!1,productIndex:null,currentProduct:null}),onSelect:W=>{console.log("[XMLReprocessModal] onSelect chamado com produto:",W),console.log("[XMLReprocessModal] Index do produto:",M.productIndex),me(M.productIndex,W.id),O({isOpen:!1,productIndex:null,currentProduct:null})},currentProduct:M.currentProduct}),a.jsx(moe,{isOpen:I.isOpen,onClose:()=>T({isOpen:!1}),onConfirm:H,products:x.map((W,se)=>({...W,originalIndex:se})),editedProducts:j,allProducts:n,isReprocess:!0})]})}const hV="comprasPage:settings";function hoe(){const{user:e,userProfile:t}=lo(),[r,n]=p.useState([]),[s,o]=p.useState(!0),[i,l]=p.useState(""),[c,d]=p.useState(null),[u,f]=p.useState([]),[h,m]=p.useState(!1),[x,g]=p.useState(()=>wc(new Date)),[v,y]=p.useState(()=>h5(new Date)),[b,w]=p.useState("all"),[j,_]=p.useState(!0),[C,E]=p.useState(!1),[S,A]=p.useState("active"),[M,O]=p.useState({show:!1,purchase:null}),[I,T]=p.useState(""),[k,q]=p.useState({show:!1,purchase:null}),[B,z]=p.useState({}),[F,V]=p.useState({show:!1,purchase:null}),[me,be]=p.useState([]),[U,L]=p.useState(!1),[H,ie]=p.useState(!1),[Y,W]=p.useState("paged"),se=Y==="paged",[pe,G]=p.useState(1),[te]=p.useState(100),[oe,De]=p.useState(0),[re,ae]=p.useState(!1),ut=Re=>{const Ct=String(Re||"").replace(/\D/g,"");return(Ct?Number(Ct)/100:0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})},pt=async()=>{try{ae(!0);const Re=(he||[]).filter(an=>!!an.xml_completo).map(an=>({tipo:"entrada",chave:an.chave_nfe,xml:an.xml_completo}));if(!Re.length){alert("Nenhum XML disponvel nos resultados filtrados.");return}const Ct=an=>String(an||"").replace(/[^0-9A-Za-z_-]/g,""),Wt=x?dr(x,"yyyy-MM-dd"):"",Er=v?dr(v,"yyyy-MM-dd"):"",Me=`nfe-entrada-filtrados-${Ct(Wt)}_a_${Ct(Er)}-xml.zip`,{data:lt,error:gt}=await Q.functions.invoke("emissor",{body:{acao:"export_zip",ambiente:"homologacao",cnpj:"",dados:{items:Re,includePdf:!1,zipName:Me}},responseType:"arrayBuffer"});if(gt)throw gt;const or=new Blob([lt],{type:"application/zip"}),br=URL.createObjectURL(or),ur=document.createElement("a");ur.href=br,ur.download=Me,document.body.appendChild(ur),ur.click(),document.body.removeChild(ur),URL.revokeObjectURL(br)}catch(Re){alert(`Falha ao exportar ZIP: ${Re?.message||Re}`)}finally{ae(!1)}},ft=Re=>{if(!Re.xml_completo){alert("XML no disponvel para esta NF-e");return}const Ct=new Blob([Re.xml_completo],{type:"text/xml;charset=utf-8"}),Wt=URL.createObjectURL(Ct),Er=document.createElement("a");Er.href=Wt,Er.download=`${Re.chave_nfe}.xml`,document.body.appendChild(Er),Er.click(),document.body.removeChild(Er),URL.revokeObjectURL(Wt)},bt=async Re=>{if(!Re.xml_completo){alert("XML no disponvel para reprocessamento automtico");return}if(confirm("Deseja reprocessar esta NF-e? Isso substituir todos os itens atuais pelos dados do XML original."))try{console.log("[ComprasPage] Iniciando reprocessamento para purchase:",Re),console.log("[ComprasPage] Chave NF-e:",Re.chave_nfe),console.log("[ComprasPage] XML disponvel:",!!Re.xml_completo);const Ct=new Blob([Re.xml_completo],{type:"text/xml"}),Wt=new File([Ct],`${Re.chave_nfe}.xml`,{type:"text/xml"});V({show:!0,purchase:Re,autoFile:Wt})}catch(Ct){console.error("Erro no reprocessamento automtico:",Ct),alert("Erro ao iniciar reprocessamento automtico")}},Lt=Re=>{if(!Re)return 0;const Ct=String(Re).replace(/\./g,"").replace(",",".");return parseFloat(Ct)||0};p.useEffect(()=>{try{const Re=localStorage.getItem(hV);if(!Re)return;const Ct=JSON.parse(Re);Ct&&typeof Ct=="object"&&((Ct.listMode==="paged"||Ct.listMode==="all")&&W(Ct.listMode),typeof Ct.showStats=="boolean"&&_(Ct.showStats))}catch{}},[]),p.useEffect(()=>{(async()=>{if(!e?.id||!t?.codigo_empresa)return;const Ct=`compras:${t.codigo_empresa}`,Wt=await loe({userId:e.id,scope:Ct});Wt&&((Wt.listMode==="paged"||Wt.listMode==="all")&&W(Wt.listMode),typeof Wt.showStats=="boolean"&&_(Wt.showStats))})()},[e?.id,t?.codigo_empresa]),p.useEffect(()=>{try{const Re={listMode:Y,showStats:j};localStorage.setItem(hV,JSON.stringify(Re))}catch{}if(e?.id&&t?.codigo_empresa){const Re=`compras:${t.codigo_empresa}`;coe({userId:e.id,scope:Re,settings:{listMode:Y,showStats:j}})}},[Y,j,e?.id,t?.codigo_empresa]),p.useEffect(()=>{t?.codigo_empresa&&(Bt(),Dt())},[t,S,b,x,v,pe,Y]),p.useEffect(()=>{G(1)},[S,b,x,v,Y]);const Dt=async()=>{try{const Re=await uf({codigoEmpresa:t.codigo_empresa});be(Re||[])}catch(Re){console.error("[Compras] Erro ao carregar produtos:",Re)}},Bt=async()=>{try{o(!0);let Re=null,Ct=null;if(x){const gt=new Date(x);gt.setHours(0,0,0,0),Re=gt.toISOString()}if(v){const gt=new Date(v);gt.setHours(23,59,59,999),Ct=gt.toISOString()}const Me={incluirInativas:S==="all"||S==="inactive",apenasInativas:S==="inactive",fornecedorId:b!=="all"?b:void 0,dataInicio:Re,dataFim:Ct,page:se?pe:1,pageSize:se?te:1e4},lt=await Tst(t.codigo_empresa,Me);n(lt?.data||[]),De(lt?.count||0)}catch(Re){console.error("[Compras] Erro ao carregar compras:",Re)}finally{o(!1)}},ge=async Re=>{d(Re),m(!0);try{const Ct=await uoe(Re.id);f(Ct||[])}catch(Ct){console.error("[Compras] Erro ao carregar itens:",Ct),f([])}finally{m(!1)}},wt=()=>{d(null),f([])},Gt=Re=>{q({show:!0,purchase:Re}),z({numeroNfe:Re.numero_nfe||"",serieNfe:Re.serie_nfe||"",dataEmissao:Re.data_emissao?Re.data_emissao.split("T")[0]:"",tipoOperacao:Re.tipo_operacao||"",naturezaOperacao:Re.natureza_operacao||"",valorProdutos:ut((Re.valor_produtos||0)*100),valorTotal:ut((Re.valor_total||0)*100),formaPagamento:Re.forma_pagamento||"",observacoes:Re.observacoes||""})},Sr=async()=>{try{await Fst(k.purchase.id,{...B,valorProdutos:Lt(B.valorProdutos),valorTotal:Lt(B.valorTotal),fornecedorId:k.purchase.fornecedor_id}),await Bt(),q({show:!1,purchase:null}),z({}),console.log("Compra editada com sucesso!")}catch(Re){console.error("Erro ao editar compra:",Re)}},wr=p.useMemo(()=>{const Re=new Map;return r.forEach(Ct=>{Ct.fornecedor?.id&&Re.set(Ct.fornecedor.id,Ct.fornecedor)}),Array.from(Re.values())},[r]),he=p.useMemo(()=>r.filter(Re=>{if(i){const Ct=i.toLowerCase();if(!(Re.numero_nfe?.toLowerCase().includes(Ct)||Re.fornecedor?.nome?.toLowerCase().includes(Ct)||Re.chave_nfe?.toLowerCase().includes(Ct)))return!1}return!0}),[r,i]),ot=p.useMemo(()=>{const Re=he.reduce((lt,gt)=>lt+Number(gt.valor_total||0),0),Ct=he.length,Wt=Ct>0?Re/Ct:0,Er={};he.forEach(lt=>{const gt=lt.fornecedor?.id||"unknown",or=lt.fornecedor?.nome||"No identificado";Er[gt]||(Er[gt]={name:or,total:0,count:0}),Er[gt].total+=Number(lt.valor_total||0),Er[gt].count+=1});const Me=Object.values(Er).sort((lt,gt)=>gt.total-lt.total).slice(0,5);return{total:Re,count:Ct,avgTicket:Wt,topSuppliers:Me}},[he]),Vt=p.useMemo(()=>{if(!te)return 1;const Re=Math.ceil((oe||0)/te);return Re>0?Re:1},[oe,te]),qt=()=>{const Re=["NF-e","Serie","Data Emissao","Fornecedor","CNPJ","Tipo","Valor Total","Valor Produtos","Forma Pagamento"],Ct=he.map(lt=>[lt.numero_nfe||"",lt.serie_nfe||"",lt.data_emissao?dr(new Date(lt.data_emissao),"dd/MM/yyyy"):"",(lt.fornecedor?.nome||"").replace(/,/g," "),lt.fornecedor?.cnpj||"",lt.tipo_operacao||"",Number(lt.valor_total||0).toFixed(2),Number(lt.valor_produtos||0).toFixed(2),(lt.forma_pagamento||"").replace(/,/g," ")]),Wt=[Re,...Ct].map(lt=>lt.join(";")).join(`
`),Er=new Blob(["\uFEFF"+Wt],{type:"text/csv;charset=utf-8;"}),Me=document.createElement("a");Me.href=URL.createObjectURL(Er),Me.download=`compras_${dr(new Date,"yyyy-MM-dd")}.csv`,Me.click()};return a.jsxs("div",{className:"px-3 py-4 md:p-6 max-w-7xl mx-auto",children:[a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx("h1",{className:"text-3xl font-bold text-text-primary",children:"Compras (NF-e)"}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex items-center justify-center",onClick:()=>ie(!0),"aria-label":"Configuraes da aba",title:"Configuraes da aba",children:a.jsx(Wc,{className:"h-4 w-4"})}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"h-9",disabled:re,children:"Aes"})}),a.jsx(Yu,{align:"end",children:a.jsxs(bs,{disabled:he.length===0,onClick:pt,children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]})})]})]}),a.jsxs("div",{className:"flex flex-row flex-wrap items-end gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted block mb-1",children:"Perodo Inicial"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start text-left font-normal h-9 text-sm",children:[a.jsx(Io,{className:"mr-2 h-4 w-4"}),x?dr(x,"dd/MM/yyyy"):a.jsx("span",{children:"Selecionar"})]})}),a.jsx(Go,{className:"w-auto p-0 z-50",align:"end",children:a.jsx(ei,{mode:"single",selected:x,onSelect:g,locale:$a})})]})]}),a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted block mb-1",children:"Perodo Final"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"w-full justify-start text-left font-normal h-9 text-sm",children:[a.jsx(Io,{className:"mr-2 h-4 w-4"}),v?dr(v,"dd/MM/yyyy"):a.jsx("span",{children:"Selecionar"})]})}),a.jsx(Go,{className:"w-auto p-0 z-50",align:"end",children:a.jsx(ei,{mode:"single",selected:v,onSelect:y,locale:$a})})]})]}),(x||v)&&a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>{g(null),y(null)},className:"h-8 px-3 text-xs",children:"Limpar"})]})]})}),j&&he.length>0&&a.jsxs("div",{className:"mb-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(il,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"NF-es"})]}),a.jsx("p",{className:"text-lg md:text-2xl font-bold text-text-primary leading-none",children:ot.count})]}),a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(Wi,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"Total"})]}),a.jsxs("p",{className:"text-base md:text-2xl font-bold text-success leading-none whitespace-nowrap",children:["R$ ",ot.total.toFixed(2)]})]}),a.jsxs("div",{className:"bg-surface rounded-lg border border-border px-2 py-3 flex flex-col items-center justify-center text-center",children:[a.jsxs("div",{className:"flex items-center gap-1 text-text-muted text-[11px] mb-1",children:[a.jsx(kf,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"Fornec."})]}),a.jsx("p",{className:"text-lg md:text-2xl font-bold text-info leading-none",children:wr.length})]})]}),ot.topSuppliers.length>0&&a.jsxs("div",{className:"bg-surface rounded-lg border border-border p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("h3",{className:"font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(C2,{className:"h-4 w-4"}),"Top 5 Fornecedores"]}),a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>E(!0),className:"text-xs",children:"Ver Todos"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:ot.topSuppliers.map((Re,Ct)=>{const Wt=Re.total/ot.total*100;return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsx("span",{className:"text-text-primary font-medium truncate flex-1",title:Re.name,children:Re.name}),a.jsxs("span",{className:"text-text-muted text-xs ml-2 flex-shrink-0",children:["R$ ",Re.total.toFixed(2)]})]}),a.jsx("div",{className:"w-full bg-surface-2 rounded-full h-1.5",children:a.jsx("div",{className:"bg-brand rounded-full h-1.5 transition-all",style:{width:`${Wt}%`}})})]},Ct)})})]})]}),a.jsx("div",{className:"mb-6 space-y-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3 md:gap-4 md:flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2 w-full md:flex-1 md:min-w-[250px]",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar por NF-e, fornecedor ou chave...",value:i,onChange:Re=>l(Re.target.value),className:"pl-10"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 rounded-full flex md:hidden items-center justify-center",onClick:()=>L(Re=>!Re),"aria-label":"Filtros",children:a.jsx(wN,{className:"h-4 w-4"})})]}),U&&a.jsxs("div",{className:"md:hidden mt-1 space-y-3 px-0.5",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Fornecedor"}),a.jsxs(Zn,{value:b,onValueChange:w,children:[a.jsxs(Yn,{className:"w-full text-sm",children:[a.jsx(kf,{className:"h-4 w-4 mr-2 flex-shrink-0"}),a.jsx("div",{className:"truncate",children:a.jsx(ta,{placeholder:"Todos"})})]}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todos"}),wr.map(Re=>a.jsx(nt,{value:Re.id,children:a.jsx("div",{className:"truncate max-w-[220px]",title:Re.nome,children:Re.nome})},Re.id))]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Status"}),a.jsxs(Zn,{value:S,onValueChange:A,children:[a.jsx(Yn,{className:"w-full text-sm",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"active",children:"Apenas ativas"}),a.jsx(nt,{value:"all",children:"Todas"}),a.jsx(nt,{value:"inactive",children:"Apenas inativas"})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1 border-t border-border/60",children:[a.jsxs(Z,{type:"button",variant:"ghost",size:"sm",className:"gap-2 text-xs px-2",onClick:()=>_(!j),children:[a.jsx(C2,{className:"h-4 w-4"}),j?"Ocultar estatsticas":"Mostrar estatsticas"]}),a.jsxs(Z,{type:"button",variant:"outline",size:"sm",onClick:qt,disabled:he.length===0,className:"gap-1 text-xs px-3",children:[a.jsx(ws,{className:"h-4 w-4"}),"CSV"]})]})]}),a.jsxs("div",{className:"hidden md:flex md:items-center md:gap-4 md:flex-wrap w-full",children:[a.jsxs(Zn,{value:b,onValueChange:w,children:[a.jsxs(Yn,{className:"w-full md:w-[220px]",children:[a.jsx(kf,{className:"h-4 w-4 mr-2 flex-shrink-0"}),a.jsx("div",{className:"truncate",children:a.jsx(ta,{placeholder:"Fornecedor"})})]}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todos"}),wr.map(Re=>a.jsx(nt,{value:Re.id,children:a.jsx("div",{className:"truncate max-w-[180px]",title:Re.nome,children:Re.nome})},Re.id))]})]}),a.jsxs(Z,{variant:"outline",onClick:qt,disabled:he.length===0,className:"gap-2 w-full sm:w-auto justify-center",children:[a.jsx(ws,{className:"h-4 w-4"}),"Exportar CSV"]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs(Z,{variant:"ghost",size:"sm",onClick:()=>_(!j),className:"gap-2",children:[a.jsx(C2,{className:"h-4 w-4"}),j?"Ocultar":"Mostrar"]}),a.jsxs(Zn,{value:S,onValueChange:A,children:[a.jsx(Yn,{className:"w-[140px]",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"active",children:"Apenas ativas"}),a.jsx(nt,{value:"all",children:"Todas"}),a.jsx(nt,{value:"inactive",children:"Apenas inativas"})]})]})]})]})]})}),s?a.jsxs("div",{className:"text-center py-12 bg-surface rounded-lg border border-border",children:[a.jsx(bu,{className:"h-12 w-12 mx-auto text-text-muted mb-4"}),a.jsx("p",{className:"text-text-muted",children:i?"Nenhuma compra encontrada":"Nenhuma NF-e importada ainda"}),a.jsx("p",{className:"text-sm text-text-muted mt-2",children:"Importe XMLs de NF-e na pgina de Produtos"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid gap-3",children:he.map(Re=>a.jsx("div",{className:`rounded-lg border overflow-hidden transition-all hover:shadow-lg ${Re.ativo===!1?"bg-gray-900/60 border-red-500 shadow-red-500/20":"bg-surface border-border hover:border-brand/50"}`,onClick:()=>ge(Re),children:a.jsx("div",{className:"p-4",children:a.jsx("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:a.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[a.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[a.jsx(il,{className:"h-6 w-6 text-brand mt-0.5 flex-shrink-0"}),a.jsx("div",{className:"min-w-0",children:a.jsxs("h3",{className:`font-semibold text-sm md:text-base leading-snug ${Re.ativo===!1?"text-red-600":"text-text-primary"}`,children:["NF-e ",Re.numero_nfe," / Srie ",Re.serie_nfe,Re.ativo===!1&&a.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 bg-red-100 text-red-700 text-[10px] rounded-full font-medium align-middle",children:"INATIVA"})]})})]}),a.jsx("div",{className:"sm:hidden flex items-center",children:a.jsxs("span",{className:"text-success font-semibold text-xs whitespace-nowrap pr-2",children:["R$ ",Number(Re.valor_total||0).toFixed(2)]})})]}),a.jsxs("div",{className:"space-y-2.5",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[a.jsx(kf,{className:"h-5 w-5 flex-shrink-0 text-brand"}),a.jsx("span",{className:"font-medium text-text-primary text-sm md:text-base overflow-hidden truncate",title:Re.fornecedor?.nome||"Fornecedor no identificado",children:Re.fornecedor?.nome||"Fornecedor no identificado"})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1.5 text-xs md:text-sm text-text-muted",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Io,{className:"h-4 w-4"}),a.jsx("span",{children:Re.data_emissao?dr(new Date(Re.data_emissao),"dd/MM/yyyy",{locale:$a}):"Data no informada"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(bu,{className:"h-4 w-4"}),a.jsx("span",{children:Re.tipo_operacao||"Entrada"})]}),Re.chave_nfe&&a.jsxs("div",{className:"text-[10px] md:text-xs max-w-[180px] md:max-w-xs overflow-hidden whitespace-nowrap truncate",children:[a.jsx("span",{className:"font-medium",children:"Chave:"})," ",Re.chave_nfe.length>20?Re.chave_nfe.slice(0,20)+"...":Re.chave_nfe]})]}),Re.natureza_operacao&&a.jsx("p",{className:"text-[10px] md:text-xs text-text-muted overflow-hidden whitespace-nowrap truncate",title:Re.natureza_operacao,children:Re.natureza_operacao})]})]}),a.jsxs("div",{className:"hidden sm:flex sm:flex-col sm:gap-3 sm:mt-0 sm:w-auto",children:[a.jsx("div",{className:"w-full flex justify-end",children:a.jsxs("div",{className:"text-right text-text-muted",children:[a.jsxs("span",{className:"text-success font-semibold text-base md:text-lg whitespace-nowrap",children:["R$ ",Number(Re.valor_total||0).toFixed(2)]}),a.jsxs("p",{className:"text-[11px] md:text-xs mt-0.5",children:["Produtos: R$ ",Number(Re.valor_produtos||0).toFixed(2)]})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full justify-end",children:[a.jsxs(Z,{onClick:Ct=>{Ct.stopPropagation(),ge(Re)},size:"sm",className:"gap-2 w-full justify-center",children:[a.jsx(Xg,{className:"h-4 w-4"}),a.jsx("span",{className:"text-xs sm:text-sm",children:"Detalhes"})]}),Re.ativo&&a.jsxs(Z,{onClick:Ct=>{Ct.stopPropagation(),Gt(Re)},size:"sm",variant:"outline",className:"gap-2 w-full justify-center",children:[a.jsx(fc,{className:"h-4 w-4"}),a.jsx("span",{className:"text-xs sm:text-sm",children:"Editar"})]})]})]})]})})})},Re.id))}),se&&a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-2 text-xs sm:text-sm text-text-muted",children:[a.jsxs("span",{children:["Pgina ",pe," de ",Vt," (",oe," NF-es)"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>G(Re=>Math.max(1,Re-1)),disabled:pe<=1,children:"Anterior"}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>G(Re=>Math.min(Vt,Re+1)),disabled:pe>=Vt,children:"Prxima"})]})]})]}),a.jsx(Un,{open:H,onOpenChange:ie,children:a.jsxs(zn,{className:"w-[90vw] sm:max-w-md max-h-[80vh] flex flex-col",children:[a.jsx(Bn,{children:a.jsx(Ln,{children:"Configuraes de Compras"})}),a.jsxs("div",{className:"space-y-4 text-sm",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-medium text-text-muted",children:"Modo de listagem"}),a.jsxs(Zn,{value:Y,onValueChange:W,children:[a.jsx(Yn,{className:"w-full h-9 text-sm",children:a.jsx(ta,{placeholder:"Paginado"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"paged",children:"Paginado (100 por pgina)"}),a.jsx(nt,{value:"all",children:"Todos (sem paginao)"})]})]})]}),a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qs,{id:"compras-show-stats",checked:j,onCheckedChange:_}),a.jsx("label",{htmlFor:"compras-show-stats",className:"text-xs font-medium text-text-primary",children:"Mostrar cards de estatsticas"})]})})]})]})}),a.jsx(Un,{open:M.show,onOpenChange:Re=>O({show:Re,purchase:null}),children:a.jsxs(zn,{className:"w-[90vw] sm:max-w-md",children:[a.jsx(Bn,{children:a.jsx(Ln,{children:"Inativar NF-e"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("p",{className:"text-sm text-text-muted",children:["Tem certeza que deseja inativar a NF-e ",a.jsx("strong",{children:M.purchase?.numero_nfe}),"?"]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Motivo da inativao:"}),a.jsx(It,{value:I,onChange:Re=>T(Re.target.value),placeholder:"Ex: NF-e duplicada, erro na importao...",className:"w-full"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx(Z,{variant:"outline",onClick:()=>{O({show:!1,purchase:null}),T("")},children:"Cancelar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!I.trim()){alert("Por favor, informe o motivo da inativao");return}try{await Dst(M.purchase.id,I.trim(),t.id),O({show:!1,purchase:null}),T(""),Bt()}catch(Re){console.error("Erro ao inativar compra:",Re),alert("Erro ao inativar NF-e. Tente novamente.")}},disabled:!I.trim(),children:"Inativar"})]})]})]})}),c&&a.jsx(Gst,{purchase:c,items:h?[]:u,onClose:wt,onEdit:Gt,onReprocess:bt,onDownloadXML:ft,onInactivate:Re=>O({show:!0,purchase:Re})}),a.jsx(Un,{open:C,onOpenChange:E,children:a.jsxs(zn,{className:"w-[90vw] sm:max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[a.jsx(Bn,{children:a.jsx(Ln,{children:"Todos os Fornecedores"})}),a.jsx("div",{className:"px-6 py-3 bg-surface-2 border-y border-border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-muted",children:"Valor Total Geral"}),a.jsxs("span",{className:"text-2xl font-bold text-success",children:["R$ ",ot.total.toFixed(2)]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:a.jsx("div",{className:"space-y-3 pr-2",children:Object.entries(he.reduce((Re,Ct)=>{const Wt=Ct.fornecedor?.id||"unknown",Er=Ct.fornecedor?.nome||"No identificado";return Re[Wt]||(Re[Wt]={name:Er,total:0,count:0}),Re[Wt].total+=Number(Ct.valor_total||0),Re[Wt].count+=1,Re},{})).sort(([,Re],[,Ct])=>Ct.total-Re.total).map(([Re,Ct],Wt)=>{const Er=Ct.total/ot.total*100;return a.jsxs("div",{className:"p-3 bg-surface-2 rounded-lg border border-border",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-brand/10 text-brand text-xs font-bold flex items-center justify-center",children:Wt+1}),a.jsx("span",{className:"font-medium text-text-primary",children:Ct.name})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"font-bold text-success",children:["R$ ",Ct.total.toFixed(2)]}),a.jsxs("p",{className:"text-xs text-text-muted",children:[Ct.count," NF-es"]})]})]}),a.jsx("div",{className:"w-full bg-surface rounded-full h-2",children:a.jsx("div",{className:"bg-brand rounded-full h-2 transition-all",style:{width:`${Er}%`}})})]},Re)})})})]})}),a.jsx(Un,{open:k.show,onOpenChange:Re=>q({show:Re,purchase:null}),children:a.jsxs(zn,{className:"w-[90vw] sm:max-w-2xl max-h-[80vh] flex flex-col",onOpenAutoFocus:Re=>Re.preventDefault(),children:[a.jsx(Bn,{children:a.jsx(Ln,{children:"Editar NF-e"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Nmero NF-e"}),a.jsx(It,{value:B.numeroNfe||"",onChange:Re=>z(Ct=>({...Ct,numeroNfe:Re.target.value})),placeholder:"Nmero da NF-e"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Srie"}),a.jsx(It,{value:B.serieNfe||"",onChange:Re=>z(Ct=>({...Ct,serieNfe:Re.target.value})),placeholder:"Srie"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Data de Emisso"}),a.jsx(It,{type:"date",value:B.dataEmissao||"",onChange:Re=>z(Ct=>({...Ct,dataEmissao:Re.target.value}))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Tipo de Operao"}),a.jsxs(Zn,{value:B.tipoOperacao||"",onValueChange:Re=>z(Ct=>({...Ct,tipoOperacao:Re})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione o tipo"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"Entrada",children:"0 - Entrada"}),a.jsx(nt,{value:"Sada",children:"1 - Sada"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Natureza da Operao"}),a.jsxs(Zn,{value:B.naturezaOperacao||"",onValueChange:Re=>z(Ct=>({...Ct,naturezaOperacao:Re})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione a natureza"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"Compra para comercializao",children:"Compra para comercializao"}),a.jsx(nt,{value:"Compra para industrializao",children:"Compra para industrializao"}),a.jsx(nt,{value:"Compra para uso ou consumo",children:"Compra para uso ou consumo"}),a.jsx(nt,{value:"Compra de ativo imobilizado",children:"Compra de ativo imobilizado"}),a.jsx(nt,{value:"Compra de material para uso ou consumo",children:"Compra de material para uso ou consumo"}),a.jsx(nt,{value:"Devoluo de venda de produo do estabelecimento",children:"Devoluo de venda de produo do estabelecimento"}),a.jsx(nt,{value:"Devoluo de venda de mercadoria adquirida ou recebida de terceiros",children:"Devoluo de venda de mercadoria adquirida ou recebida de terceiros"}),a.jsx(nt,{value:"Remessa de mercadoria por conta e ordem de terceiros",children:"Remessa de mercadoria por conta e ordem de terceiros"}),a.jsx(nt,{value:"Retorno de mercadoria remetida por conta e ordem de terceiros",children:"Retorno de mercadoria remetida por conta e ordem de terceiros"}),a.jsx(nt,{value:"Remessa para industrializao por encomenda",children:"Remessa para industrializao por encomenda"}),a.jsx(nt,{value:"Retorno de mercadoria remetida para industrializao por encomenda",children:"Retorno de mercadoria remetida para industrializao por encomenda"}),a.jsx(nt,{value:"Transferncia de produo do estabelecimento",children:"Transferncia de produo do estabelecimento"}),a.jsx(nt,{value:"Transferncia de mercadoria adquirida ou recebida de terceiros",children:"Transferncia de mercadoria adquirida ou recebida de terceiros"})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Valor dos Produtos"}),a.jsx(It,{inputMode:"numeric",placeholder:"R$ 0,00",value:`R$ ${B.valorProdutos||"0,00"}`,onChange:Re=>z(Ct=>({...Ct,valorProdutos:ut(Re.target.value)}))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Valor Total"}),a.jsx(It,{inputMode:"numeric",placeholder:"R$ 0,00",value:`R$ ${B.valorTotal||"0,00"}`,onChange:Re=>z(Ct=>({...Ct,valorTotal:ut(Re.target.value)}))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Forma de Pagamento"}),a.jsxs(Zn,{value:B.formaPagamento||"",onValueChange:Re=>z(Ct=>({...Ct,formaPagamento:Re})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione a forma de pagamento"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"01 - Dinheiro",children:"01 - Dinheiro"}),a.jsx(nt,{value:"02 - Cheque",children:"02 - Cheque"}),a.jsx(nt,{value:"03 - Carto de Crdito",children:"03 - Carto de Crdito"}),a.jsx(nt,{value:"04 - Carto de Dbito",children:"04 - Carto de Dbito"}),a.jsx(nt,{value:"05 - Carto da Loja (Private Label)",children:"05 - Carto da Loja (Private Label)"}),a.jsx(nt,{value:"10 - Vale Alimentao",children:"10 - Vale Alimentao"}),a.jsx(nt,{value:"11 - Vale Refeio",children:"11 - Vale Refeio"}),a.jsx(nt,{value:"12 - Vale Presente",children:"12 - Vale Presente"}),a.jsx(nt,{value:"13 - Vale Combustvel",children:"13 - Vale Combustvel"}),a.jsx(nt,{value:"14 - Duplicata Mercantil",children:"14 - Duplicata Mercantil"}),a.jsx(nt,{value:"15 - Boleto Bancrio",children:"15 - Boleto Bancrio"}),a.jsx(nt,{value:"16 - Depsito Bancrio",children:"16 - Depsito Bancrio"}),a.jsx(nt,{value:"17 - PIX Dinmico (QR-Code)",children:"17 - PIX Dinmico (QR-Code)"}),a.jsx(nt,{value:"18 - Transferncia Bancria / Carteira Digital",children:"18 - Transferncia Bancria / Carteira Digital"}),a.jsx(nt,{value:"19 - Programa de Fidelidade / Cashback",children:"19 - Programa de Fidelidade / Cashback"}),a.jsx(nt,{value:"20 - PIX Esttico",children:"20 - PIX Esttico"}),a.jsx(nt,{value:"21 - Crdito em Loja",children:"21 - Crdito em Loja"}),a.jsx(nt,{value:"22 - Pagamento Eletrnico no Informado",children:"22 - Pagamento Eletrnico no Informado"}),a.jsx(nt,{value:"90 - Sem Pagamento",children:"90 - Sem Pagamento"}),a.jsx(nt,{value:"99 - Outros",children:"99 - Outros"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Observaes"}),a.jsx(It,{value:B.observacoes||"",onChange:Re=>z(Ct=>({...Ct,observacoes:Re.target.value})),placeholder:"Observaes adicionais"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>q({show:!1,purchase:null}),children:"Cancelar"}),a.jsx(Z,{onClick:Sr,children:"Salvar Alteraes"})]})]})]})}),a.jsx(Kst,{open:F.show,onOpenChange:Re=>V({show:Re,purchase:null}),purchase:F.purchase,products:me,codigoEmpresa:t?.codigo_empresa,autoFile:F.autoFile,onSuccess:()=>{Bt(),V({show:!1,purchase:null})}})]})}const oc=Ce.forwardRef(({className:e,...t},r)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:r,className:Pr("w-full caption-bottom text-sm",e),...t})}));oc.displayName="Table";const ic=Ce.forwardRef(({className:e,...t},r)=>a.jsx("thead",{ref:r,className:Pr("[&_tr]:border-b",e),...t}));ic.displayName="TableHeader";const lc=Ce.forwardRef(({className:e,...t},r)=>a.jsx("tbody",{ref:r,className:Pr("[&_tr:last-child]:border-0",e),...t}));lc.displayName="TableBody";const Xst=Ce.forwardRef(({className:e,...t},r)=>a.jsx("tfoot",{ref:r,className:Pr("bg-primary font-medium text-primary-foreground",e),...t}));Xst.displayName="TableFooter";const zs=Ce.forwardRef(({className:e,...t},r)=>a.jsx("tr",{ref:r,className:Pr("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));zs.displayName="TableRow";const ka=Ce.forwardRef(({className:e,...t},r)=>a.jsx("th",{ref:r,className:Pr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));ka.displayName="TableHead";const ca=Ce.forwardRef(({className:e,...t},r)=>a.jsx("td",{ref:r,className:Pr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));ca.displayName="TableCell";const Yst=Ce.forwardRef(({className:e,...t},r)=>a.jsx("caption",{ref:r,className:Pr("mt-4 text-sm text-muted-foreground",e),...t}));Yst.displayName="TableCaption";const Jst={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},poe={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},s2=({icon:e,title:t,value:r,color:n,onClick:s,isActive:o})=>{const i=e;return a.jsxs(Fr.div,{variants:poe,className:Pr("bg-surface rounded-lg border p-4 flex items-center gap-4 cursor-pointer transition-all duration-200",o?"border-brand ring-2 ring-brand/50":"border-border hover:border-brand/50"),onClick:s,children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${n}/20`,children:a.jsx(i,{className:`w-6 h-6 ${n}`})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary text-sm font-medium",children:t}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r})]})]})};function Qst({open:e,onOpenChange:t,client:r,onEdit:n,onInactivate:s,codigoEmpresa:o}){const{toast:i}=Zs(),l={scheduled:{bg:"bg-[#3B82F6]/10",text:"text-[#3B82F6]",border:"border-[#3B82F6]/30"},confirmed:{bg:"bg-[#22C55E]/10",text:"text-[#22C55E]",border:"border-[#22C55E]/30"},in_progress:{bg:"bg-[#FACC15]/10",text:"text-[#FACC15]",border:"border-[#FACC15]/30"},finished:{bg:"bg-[#6B7280]/10",text:"text-[#6B7280]",border:"border-[#6B7280]/30"},canceled:{bg:"bg-[#EF4444]/10",text:"text-[#EF4444]",border:"border-[#EF4444]/30"},absent:{bg:"bg-[#F97316]/10",text:"text-[#F97316]",border:"border-[#F97316]/30"}},c=({label:T,value:k})=>a.jsxs("div",{className:"grid grid-cols-12 items-start gap-3 py-2 border-b border-border/50",children:[a.jsx("div",{className:"col-span-5 sm:col-span-4",children:a.jsx("span",{className:"block text-[11px] uppercase tracking-wide text-text-muted font-semibold",children:T})}),a.jsx("div",{className:"col-span-7 sm:col-span-8",children:a.jsx("span",{className:"block text-sm font-medium text-text-primary break-words",children:k})})]}),[d,u]=p.useState(!1),[f,h]=p.useState([]),[m,x]=p.useState(!1),[g,v]=p.useState([]),y=p.useRef(!1),b=p.useRef(!1),[w,j]=p.useState(!1),[_,C]=p.useState(null),[E,S]=p.useState(!1),[A,M]=p.useState(null),O=p.useMemo(()=>{try{const T=(f||[]).map(q=>({kind:"comanda",ts:new Date(q.aberto_em||q.created_at||0).getTime(),data:q})),k=(g||[]).map(q=>({kind:"agendamento",ts:new Date(q.inicio||0).getTime(),data:q}));return[...T,...k].sort((q,B)=>B.ts-q.ts).slice(0,10)}catch{return[]}},[f,g]),I=async T=>{try{if(j(!0),C(T?.kind||null),S(!0),M(null),T?.kind==="comanda"){const k=T?.data?.comanda_id;if(!k){S(!1);return}let q=Q.from("comanda_itens").select("id, quantidade, preco_unitario, desconto, produto:produtos!comanda_itens_produto_id_fkey ( nome )").eq("comanda_id",k);o&&(q=q.eq("codigo_empresa",o));const{data:B}=await q,z=(B||[]).map(W=>({id:W.id,quantidade:W.quantidade,preco_unitario:W.preco_unitario,desconto:W.desconto,produto_nome:W.produto?.[0]?.nome||W.produto?.nome||"Item"}));let F=Q.from("pagamentos").select("id, valor, status, recebido_em, metodo").eq("comanda_id",k);o&&(F=F.eq("codigo_empresa",o));const{data:V}=await F,me=V||[];let be=Q.from("comanda_clientes").select("cliente:clientes!comanda_clientes_cliente_id_fkey ( id, nome, email, telefone )").eq("comanda_id",k);o&&(be=be.eq("codigo_empresa",o));const{data:U}=await be,L=(U||[]).map(W=>W.cliente?.[0]||W.cliente).filter(Boolean),H=(z||[]).reduce((W,se)=>W+(Number(se.quantidade||0)*Number(se.preco_unitario||0)-Number(se.desconto||0)),0),ie=(me||[]).filter(W=>(W.status||"Pago")!=="Cancelado"&&(W.status||"Pago")!=="Estornado").reduce((W,se)=>W+Number(se.valor||0),0),Y=Math.max(0,H-ie);M({comandaId:k,mesa_title:T?.data?.mesa_title||"Balco",status:T?.data?.status||"open",itens:z||[],pagamentos:me||[],clientes:L,totalItens:H,totalPagos:ie,saldo:Y,aberto_em:T?.data?.aberto_em||T?.data?.created_at||null,fechado_em:T?.data?.fechado_em||null})}else if(T?.kind==="agendamento"){const k=T?.data?.id;if(!k){S(!1);return}let q=[];try{const{data:F}=await Q.from("agendamento_participantes").select("cliente_id, nome, valor_cota, status_pagamento").eq("agendamento_id",k).limit(200);q=F||[]}catch{q=[]}const B=Array.from(new Set((q||[]).map(F=>F.cliente_id).filter(Boolean)));let z=[];if(z=(q||[]).map(F=>({id:F.cliente_id,nome:F.nome||null,email:null,telefone:null,codigo:null,valor_cota:F.valor_cota??null,status_pagamento:F.status_pagamento||null})),B.length>0)try{const{data:F}=await Q.from("clientes").select("id,nome,email,telefone,codigo").in("id",B),V=new Map((F||[]).map(me=>[String(me.id),me]));z=z.map(me=>{const be=V.get(String(me.id));return be?{...me,nome:me.nome||be.nome,email:be.email,telefone:be.telefone,codigo:be.codigo}:me})}catch{}M({id:k,inicio:T?.data?.inicio||null,fim:T?.data?.fim||null,status:T?.data?.status||null,modalidade:T?.data?.modalidade||null,quadra_nome:T?.data?.quadra_nome||null,participantes:z})}}catch{}finally{S(!1)}};return p.useEffect(()=>{let T=!1;if(e&&(y.current=!1,b.current=!1),e&&r?.id&&!o)return u(!1),x(!1),()=>{T=!0};const k=async()=>{if(!e||!r?.id)return;u(!0);const B=Number(r?.codigo??-1)===0;let z=Q.from("comanda_clientes").select("comanda_id, created_at");B?z=z.is("cliente_id",null):z=z.eq("cliente_id",r.id),z=z.order("created_at",{ascending:!1}).limit(50),o&&(z=z.eq("codigo_empresa",o));const{data:F,error:V}=await z;if(V)throw V;const me=Array.from(new Set((F||[]).map(ie=>ie.comanda_id).filter(Boolean)));let be=[];if(!B){let ie=Q.from("comandas").select("id, status, aberto_em, fechado_em").eq("cliente_id",r.id).order("aberto_em",{ascending:!1}).limit(10);o&&(ie=ie.eq("codigo_empresa",o));const{data:Y,error:W}=await ie;if(W)throw W;be=Y||[]}const U=Array.from(new Set((be||[]).map(ie=>ie.id))),L=Array.from(new Set([...me,...U]));if(L.length===0){h([]),u(!1);return}let H;try{H=setTimeout(()=>u(!1),1e4)}catch{}try{let ie=Q.from("comandas").select("id,status,aberto_em,fechado_em, mesa:mesas!comandas_mesa_id_fkey ( nome, numero )").in("id",L);o&&(ie=ie.eq("codigo_empresa",o));const{data:Y,error:W}=await ie;if(W)throw W;const se=new Map((Y||[]).map(Dt=>[Dt.id,Dt]));let pe=Q.from("comanda_itens").select("comanda_id, quantidade, preco_unitario, desconto").in("comanda_id",L);o&&(pe=pe.eq("codigo_empresa",o));const{data:G,error:te}=await pe;if(te)throw te;const oe={};for(const Dt of G||[]){const Bt=Number(Dt.quantidade||0)*Number(Dt.preco_unitario||0),ge=Number(Dt.desconto||0);oe[Dt.comanda_id]=(oe[Dt.comanda_id]||0)+Math.max(0,Bt-ge)}let De=Q.from("pagamentos").select("comanda_id, valor, status, recebido_em, metodo").in("comanda_id",L);o&&(De=De.eq("codigo_empresa",o));const{data:re,error:ae}=await De;if(ae)throw ae;const ut={};for(const Dt of re||[])(Dt.status||"Pago")!=="Cancelado"&&(Dt.status||"Pago")!=="Estornado"&&(ut[Dt.comanda_id]=(ut[Dt.comanda_id]||0)+Number(Dt.valor||0));const pt=(Dt,Bt=null)=>{const ge=se.get(Dt)||{},wt=Number(oe[Dt]||0),Gt=Number(ut[Dt]||0),Sr=Math.max(0,wt-Gt),wr=ge.mesa?.[0]?.nome||ge.mesa?.nome||null,he=ge.mesa?.[0]?.numero||ge.mesa?.numero||null,ot=wr||(he!=null?`Mesa ${he}`:"Balco");return{comanda_id:Dt,created_at:Bt,aberto_em:ge.aberto_em||null,fechado_em:ge.fechado_em||null,status:ge.status||"open",total:wt,pago:Gt,saldo:Sr,mesa_title:ot}},ft=(F||[]).map(Dt=>pt(Dt.comanda_id,Dt.created_at)),bt=(be||[]).filter(Dt=>!(me||[]).includes(Dt.id)).map(Dt=>pt(Dt.id,Dt.aberto_em)),Lt=[...ft,...bt].sort((Dt,Bt)=>{const ge=new Date(Dt.aberto_em||Dt.created_at||0).getTime();return new Date(Bt.aberto_em||Bt.created_at||0).getTime()-ge}).slice(0,10);if(!T&&Lt.length===0&&!y.current){y.current=!0,console.debug("[ClientDetailsModal] loadHistory: empty result, retrying once..."),setTimeout(()=>{e&&r?.id&&k()},700);return}T||h(Lt)}catch(ie){i({title:"Falha ao carregar histrico do cliente",description:ie?.message||"Tente novamente",variant:"destructive"})}finally{try{clearTimeout(H)}catch{}T||u(!1)}},q=async()=>{if(!e||!r?.id)return;x(!0);let B;try{B=setTimeout(()=>x(!1),1e4)}catch{}try{console.debug("[ClientDetailsModal] loadBookings: start",{clientId:r.id,codigoEmpresa:o});let z=Q.from("agendamentos").select(`
            id, inicio, fim, status, modalidade,
            quadra:quadra_id ( nome )
          `).eq("cliente_id",r.id).order("inicio",{ascending:!1}).limit(10);o&&(z=z.eq("codigo_empresa",o));const{data:F,error:V}=await z;if(V)throw V;const me=(F||[]).map(pe=>({id:pe.id,inicio:pe.inicio,fim:pe.fim,status:pe.status,modalidade:pe.modalidade,quadra_nome:pe.quadra?.[0]?.nome||pe.quadra?.nome||null}));let be=Q.from("v_agendamento_participantes").select("agendamento_id").eq("cliente_id",r.id).limit(30);const{data:U,error:L}=await be;if(L)throw L;const H=Array.from(new Set((U||[]).map(pe=>pe.agendamento_id).filter(Boolean))),ie=new Set((me||[]).map(pe=>pe.id)),Y=H.filter(pe=>!ie.has(pe));let W=[];if(Y.length>0){let pe=Q.from("agendamentos").select(`
              id, inicio, fim, status, modalidade,
              quadra:quadra_id ( nome )
            `).in("id",Y);o&&(pe=pe.eq("codigo_empresa",o));const{data:G,error:te}=await pe;if(te)throw te;W=(G||[]).map(oe=>({id:oe.id,inicio:oe.inicio,fim:oe.fim,status:oe.status,modalidade:oe.modalidade,quadra_nome:oe.quadra?.[0]?.nome||oe.quadra?.nome||null}))}const se=[...me,...W].sort((pe,G)=>new Date(G.inicio)-new Date(pe.inicio)).slice(0,10);if(!T&&se.length===0&&!b.current){b.current=!0,console.debug("[ClientDetailsModal] loadBookings: empty result, retrying once..."),setTimeout(()=>{e&&r?.id&&q()},700);return}T||v(se)}catch(z){console.warn("[ClientDetailsModal] Falha ao carregar agendamentos do cliente:",z)}finally{try{clearTimeout(B)}catch{}T||x(!1)}};return k(),q(),()=>{T=!0,e||(u(!1),x(!1))}},[e,r?.id,o]),r?a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto w-full",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Detalhes do Cliente"}),a.jsx(ma,{children:"Informaes cadastrais e histrico recente deste cliente."})]}),a.jsxs("div",{className:"p-4 sm:p-6 space-y-6 sm:space-y-8",children:[a.jsx("div",{className:"overflow-hidden",children:a.jsx("div",{className:"flex items-start justify-between gap-4",children:a.jsxs("div",{className:"min-w-0",children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-extrabold tracking-tight text-text-primary truncate",children:r.nome}),a.jsxs("div",{className:"mt-2 flex items-center flex-wrap gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-surface-2 border border-border text-text-secondary",children:["Cdigo: ",a.jsx("span",{className:"text-text-primary font-mono",children:r.codigo})]}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold border ${r.status==="active"?"bg-emerald-500/10 text-emerald-400 border-emerald-400/30":"bg-rose-500/10 text-rose-400 border-rose-400/30"}`,children:r.status==="active"?"Ativo":"Inativo"}),r.flag_cliente&&a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),r.flag_fornecedor&&a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]}),a.jsx("span",{className:"mt-2 block text-sm text-text-secondary truncate",children:r.email||""})]})})}),a.jsx("div",{className:"grid grid-cols-1 gap-8",children:a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-text-secondary mb-2",children:"Informaes Cadastrais"}),a.jsxs("div",{className:"bg-surface-2 p-3 sm:p-4 rounded-lg space-y-1",children:[a.jsx(c,{label:"Cdigo",value:r.codigo}),a.jsx(c,{label:"CPF/CNPJ",value:r.cpf||r.cnpj||""}),a.jsx(c,{label:"Telefone",value:r.telefone||""}),a.jsx(c,{label:"Aniversrio",value:r.aniversario?new Date(r.aniversario).toLocaleDateString("pt-BR"):""}),a.jsx(c,{label:"Email",value:r.email||""}),a.jsx(c,{label:"Status",value:r.status==="active"?"Ativo":"Inativo"})]})]})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-primary",children:[a.jsx(Hue,{className:"w-5 h-5 text-text-secondary"}),a.jsx("h4",{className:"font-semibold",children:"Histrico Recente"})]}),a.jsx("div",{className:"bg-surface-2 p-3 sm:p-4 rounded-lg",children:d&&m?a.jsx("div",{className:"text-center py-8 text-sm text-text-muted",children:"Carregando histrico..."}):O&&O.length>0?a.jsx("div",{className:"max-h-64 overflow-y-auto thin-scroll pr-1",children:a.jsx("div",{className:"space-y-3",children:O.map((T,k)=>a.jsxs("div",{className:"group flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 p-3 rounded-md border border-border/60 bg-background cursor-pointer transition-colors transition-shadow hover:bg-surface-2/60 hover:shadow-md hover:border-brand/30",title:"Clique para ver detalhes",onClick:()=>I(T),children:[a.jsx("div",{className:"min-w-0",children:T.kind==="comanda"?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:T.data.mesa_title||"Balco"}),a.jsx("div",{className:"text-xs text-text-secondary truncate",children:(()=>{const q=T.data;return q.aberto_em?new Date(q.aberto_em).toLocaleString("pt-BR"):new Date(q.created_at).toLocaleString("pt-BR")})()})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:T.data.modalidade||"Agendamento"}),a.jsxs("div",{className:"text-xs text-text-secondary truncate",children:[new Date(T.data.inicio).toLocaleString("pt-BR"),"  ",T.data.quadra_nome||"Quadra"]})]})}),a.jsx("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-end",children:T.kind==="comanda"?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:Pr("px-2 py-1 text-[11px] font-semibold rounded-full border",T.data.status==="closed"||T.data.fechado_em?"bg-success/10 text-success border-success/30":T.data.status==="awaiting-payment"?"bg-info/10 text-info border-info/30":"bg-warning/10 text-warning border-warning/30"),children:T.data.status==="closed"||T.data.fechado_em?"Fechada":T.data.status==="awaiting-payment"?"Pagamento":"Em uso"}),a.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[11px] text-text-secondary whitespace-nowrap",children:"Clique para detalhes"})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:Pr("px-2 py-1 text-[11px] font-semibold rounded-full border",(()=>{const q=String(T.data.status||"").toLowerCase(),B=l[q]||l.scheduled;return`${B.bg} ${B.text} ${B.border}`})()),children:(()=>{switch(T.data.status){case"finished":return"Finalizado";case"canceled":return"Cancelado";case"in_progress":return"Em andamento";case"confirmed":return"Confirmado";case"absent":return"Ausente";case"scheduled":default:return"Agendado"}})()}),a.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-[11px] text-text-secondary whitespace-nowrap",children:"Clique para detalhes"})]})})]},`${T.kind}-${k}`))})}):a.jsx("div",{className:"text-center py-8 text-sm text-text-muted",children:"Sem registros recentes para este cliente."})})]}),a.jsx(Un,{open:w,onOpenChange:j,children:a.jsxs(zn,{className:"sm:max-w-[700px] w-full max-h-[85vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:_==="comanda"?A?.mesa_title||"Detalhes da Comanda":"Detalhes do Agendamento"}),a.jsx(ma,{children:_==="comanda"?"Itens e pagamentos desta comanda.":"Informaes do agendamento e participantes."}),a.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:"Cliente:"}),a.jsx("span",{className:"text-sm font-medium text-text-primary",children:r?.nome||""}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-surface-2 border border-border text-text-secondary",children:["Cdigo: ",a.jsx("span",{className:"text-text-primary font-mono",children:r?.codigo??""})]})]})]}),a.jsx("div",{className:"space-y-4",children:E?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando detalhes..."}):_==="comanda"&&A?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Status"}),a.jsx("p",{className:"font-semibold",children:(()=>{const T=String(A.status||"").toLowerCase();return T==="closed"||A.fechado_em?"Fechada":T==="awaiting-payment"?"Aguardando pagamento":"Aberta"})()})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Abertura"}),a.jsx("p",{className:"font-semibold",children:A.aberto_em?new Date(A.aberto_em).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Fechamento"}),a.jsx("p",{className:"font-semibold",children:A.fechado_em?new Date(A.fechado_em).toLocaleString("pt-BR"):""})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Itens"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(A.itens||[]).map(T=>a.jsxs("div",{className:"p-2 flex flex-col sm:grid sm:grid-cols-12 gap-1 sm:gap-2 text-sm",children:[a.jsx("div",{className:"sm:col-span-6 font-medium",children:T.produto_nome||"Item"}),a.jsxs("div",{className:"sm:col-span-2 sm:text-right text-text-muted",children:["Qtd: ",Number(T.quantidade||0)]}),a.jsxs("div",{className:"sm:col-span-2 sm:text-right",children:["R$ ",Number(T.preco_unitario||0).toFixed(2)]}),a.jsx("div",{className:"sm:col-span-2 sm:text-right text-text-secondary",children:Number(T.desconto||0)?`- R$ ${Number(T.desconto||0).toFixed(2)}`:""})]},T.id)),(!A.itens||A.itens.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum item."})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Pagamentos"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(A.pagamentos||[]).map(T=>a.jsxs("div",{className:"p-2 flex items-center justify-between text-sm",children:[a.jsxs("span",{className:"truncate",children:[T.metodo||""," ",T.status?`(${T.status})`:""]}),a.jsxs("span",{className:"font-semibold",children:["R$ ",Number(T.valor||0).toFixed(2)]})]},T.id)),(!A.pagamentos||A.pagamentos.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum pagamento registrado."})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total de Itens"}),a.jsxs("p",{className:"font-bold",children:["R$ ",Number(A.totalItens||0).toFixed(2)]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total Pago"}),a.jsxs("p",{className:"font-bold text-success",children:["R$ ",Number(A.totalPagos||0).toFixed(2)]})]})]})]}):_==="agendamento"&&A?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Modalidade"}),a.jsx("p",{className:"font-semibold",children:A.modalidade||""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Quadra"}),a.jsx("p",{className:"font-semibold",children:A.quadra_nome||""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Incio"}),a.jsx("p",{className:"font-semibold",children:A.inicio?new Date(A.inicio).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded-md p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Fim"}),a.jsx("p",{className:"font-semibold",children:A.fim?new Date(A.fim).toLocaleString("pt-BR"):""})]})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-semibold mb-2",children:"Participantes"}),a.jsxs("div",{className:"border rounded-md divide-y divide-border",children:[(A.participantes||[]).map((T,k)=>a.jsxs("div",{className:"p-2 text-sm flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3",children:[a.jsx("div",{className:"min-w-0",children:a.jsxs("div",{className:"flex items-center gap-2",children:[T.codigo!==null&&T.codigo!==void 0&&a.jsxs("span",{className:`text-xs font-bold rounded px-1.5 py-0.5 shrink-0 ${String(T.status_pagamento||"").toLowerCase()==="pago"?"text-emerald-400 bg-emerald-600/20 border border-emerald-700/40":"text-amber-400 bg-amber-600/20 border border-amber-700/40"}`,children:["#",T.codigo]}),a.jsx("span",{className:"font-medium truncate",children:T.nome||"Participante"})]})}),a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-end",children:[T.valor_cota!=null&&a.jsxs("span",{className:"text-xs font-semibold text-text-secondary",children:["R$ ",Number(T.valor_cota||0).toFixed(2)]}),a.jsx("span",{className:`text-[11px] font-semibold rounded-full px-2 py-0.5 border ${String(T.status_pagamento||"").toLowerCase()==="pago"?"bg-success/10 text-success border-success/30":"bg-warning/10 text-warning border-warning/30"}`,children:String(T.status_pagamento||T.status_pagamento_text||"Pendente")})]})]},`${T.id}-${k}`)),(!A.participantes||A.participantes.length===0)&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum participante encontrado."})]})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma informao para exibir."})}),a.jsx(Ga,{children:a.jsx(Z,{variant:"outline",onClick:()=>j(!1),children:"Fechar"})})]})})]}),a.jsxs(Ga,{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-0 sm:justify-between",children:[!r?.is_consumidor_final&&a.jsx("div",{className:"w-full sm:flex-1",children:a.jsxs(Z,{type:"button",variant:"destructive",className:"bg-red-600 hover:bg-red-500 text-white w-full sm:w-auto",onClick:()=>s?.(r),children:[a.jsx(CG,{className:"mr-2 h-4 w-4"})," Inativar Cliente"]})}),a.jsxs("div",{className:"flex gap-2 w-full sm:w-auto sm:ml-auto",children:[a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"flex-1 sm:flex-none",children:"Fechar"})}),!r?.is_consumidor_final&&a.jsxs(Z,{onClick:()=>n(r),className:"flex-1 sm:flex-none",children:[a.jsx(fc,{className:"mr-2 h-4 w-4"})," Editar Cliente"]})]})]})]})}):null}function Zst(){const{toast:e}=Zs(),{userProfile:t,authReady:r}=lo(),n=_i(),[s,o]=p.useState(()=>{try{const L=localStorage.getItem("auth:userProfile"),H=L&&JSON.parse(L)?.codigo_empresa||null,ie=H?`clientes:list:${H}`:"clientes:list",Y=JSON.parse(localStorage.getItem(ie)||"[]");return Array.isArray(Y)?Y:[]}catch{return[]}}),[i,l]=p.useState(!1),[c,d]=p.useState(!0),[u,f]=p.useState(!1),[h,m]=p.useState(!1),[x,g]=p.useState(null),[v,y]=p.useState(null),[b,w]=p.useState({searchTerm:"",status:"all",tipo:"todos"}),j=p.useRef(!1),_=p.useRef(0),C=p.useRef(0),E=p.useRef(!1);p.useEffect(()=>{n.state?.openModal&&!u&&!E.current&&(E.current=!0,f(!0),window.history.replaceState({},document.title))},[n.state?.openModal,u]);const S=async()=>{try{const L=s&&s.length>0;if(L||l(!0),!t?.codigo_empresa)return;const H=`clientes:list:${t.codigo_empresa}`;let ie=Q.from("clientes").select("*, is_consumidor_final").eq("codigo_empresa",t.codigo_empresa).order("codigo",{ascending:!0});if(b.searchTerm.trim()!==""){const G=b.searchTerm.trim();/^\d+$/.test(G)?ie=ie.or(`codigo.eq.${G},nome.ilike.%${G}%,email.ilike.%${G}%,telefone.ilike.%${G}%`):ie=ie.or(`nome.ilike.%${G}%,email.ilike.%${G}%,telefone.ilike.%${G}%`)}b.status!=="all"&&(ie=ie.eq("status",b.status));const Y=setTimeout(()=>{try{if(!L){const G=JSON.parse(localStorage.getItem(H)||"[]");Array.isArray(G)&&G.length>0&&(console.warn("[Clientes] slow fallback: using cached snapshot"),o(G),C.current=G.length)}}catch{}},2e3),{data:W,error:se}=await ie;if(se){if(!j.current){j.current=!0,setTimeout(S,900);return}throw se}const pe=W||[];if(pe.length===0&&L&&!j.current){j.current=!0,setTimeout(S,700);return}j.current=!1,o(pe);try{localStorage.setItem(H,JSON.stringify(pe))}catch{}C.current=pe.length,_.current=Date.now()}catch(L){e({title:"Erro ao carregar clientes",description:L.message,variant:"destructive"})}finally{l(!1);try{clearTimeout(slowFallback)}catch{}}};p.useEffect(()=>{try{const L=localStorage.getItem("auth:userProfile"),H=t?.codigo_empresa||L&&JSON.parse(L)?.codigo_empresa||null;if(H){const ie=`clientes:list:${H}`,Y=JSON.parse(localStorage.getItem(ie)||"[]");Array.isArray(Y)&&Y.length&&s.length===0&&(o(Y),C.current=Y.length)}}catch{}if(r&&t?.codigo_empresa){const L=setTimeout(S,50);return()=>clearTimeout(L)}return()=>{}},[r,t?.codigo_empresa]),p.useEffect(()=>{if(r&&t?.codigo_empresa){const L=setTimeout(S,200);return()=>clearTimeout(L)}return()=>{}},[b.searchTerm,b.status,r,t?.codigo_empresa]),p.useEffect(()=>{const L=()=>{(Date.now()-(_.current||0)>3e4||C.current===0)&&r&&t?.codigo_empresa&&S()},H=()=>{document.visibilityState==="visible"&&(Date.now()-(_.current||0)>3e4||C.current===0)&&r&&t?.codigo_empresa&&S()};return window.addEventListener("focus",L),document.addEventListener("visibilitychange",H),()=>{window.removeEventListener("focus",L),document.removeEventListener("visibilitychange",H)}},[r,t?.codigo_empresa]);const A=p.useMemo(()=>{const H=new Date().getMonth();return{total:s.length,birthdays:s.filter(ie=>ie.aniversario&&new Date(ie.aniversario).getMonth()===H).length,active:s.filter(ie=>ie.status==="active").length}},[s]);function M(L){const H=["Cdigo","Tipo Pessoa","Nome/Razo Social","Apelido/Nome Fantasia","CPF","CNPJ","RG","IE","Email","Telefone","Fone 2","Celular 1","Celular 2","WhatsApp","CEP","Endereo","Nmero","Complemento","Bairro","Cidade","UF","Cidade IBGE","Limite Crdito","Tipo Recebimento","Regime Tributrio","Tipo Contribuinte","Aniversrio","Sexo","Estado Civil","Nome da Me","Nome do Pai","Observaes"," Cliente"," Fornecedor"," Funcionrio"," Administradora"," Parceiro","CCF/SPC","Status"],ie=";",Y=re=>{if(!re)return"";try{const ae=new Date(re);if(!isNaN(ae)){const ut=String(ae.getDate()).padStart(2,"0"),pt=String(ae.getMonth()+1).padStart(2,"0"),ft=ae.getFullYear();return`${ut}/${pt}/${ft}`}}catch{}return String(re)},W=re=>{const ae=Number(re??0);return Number.isFinite(ae)?ae.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}):""},se=re=>re?"Sim":"No",pe=re=>{const ae=re==null?"":String(re);return/[";\n]/.test(ae)?`"${ae.replace(/"/g,'""')}"`:ae},G=[];G.push("\uFEFF"+H.join(ie));for(const re of L){const ae=[re.codigo??"",re.tipo_pessoa||"",re.nome||"",re.apelido||"",re.cpf||"",re.cnpj||"",re.rg||"",re.ie||"",re.email||"",re.telefone||"",re.fone2||"",re.celular1||"",re.celular2||"",re.whatsapp||"",re.cep||"",re.endereco||"",re.numero||"",re.complemento||"",re.bairro||"",re.cidade||"",re.uf||"",re.cidade_ibge||"",W(re.limite_credito),re.tipo_recebimento||"",re.regime_tributario||"",re.tipo_contribuinte||"",Y(re.aniversario),re.sexo||"",re.estado_civil||"",re.nome_mae||"",re.nome_pai||"",re.observacoes||"",se(!!re.flag_cliente),se(!!re.flag_fornecedor),se(!!re.flag_funcionario),se(!!re.flag_administradora),se(!!re.flag_parceiro),se(!!re.flag_ccf_spc),re.status==="active"?"Ativo":"Inativo"].map(pe).join(ie);G.push(ae)}const te=new Blob([G.join(`
`)],{type:"text/csv;charset=utf-8;"}),oe=URL.createObjectURL(te),De=document.createElement("a");De.href=oe,De.download="clientes.csv",document.body.appendChild(De),De.click(),document.body.removeChild(De),URL.revokeObjectURL(oe)}const O=()=>{try{M(I),e({title:"Exportao concluda",description:`${I.length} cliente(s) exportado(s).`,variant:"success",className:"bg-amber-500 text-black shadow-xl"})}catch(L){e({title:"Falha ao exportar",description:L?.message||"No foi possvel gerar o arquivo.",variant:"destructive"})}},I=p.useMemo(()=>(new Date().getMonth(),s.filter(H=>{const ie=b.searchTerm.toLowerCase()===""||(H.nome||"").toLowerCase().includes(b.searchTerm.toLowerCase())||(H.cpf||"").includes(b.searchTerm)||(H.telefone||"").includes(b.searchTerm),Y=b.status==="all"||H.status===b.status;let W=!0;return b.tipo==="clientes"?W=H.flag_cliente===!0:b.tipo==="fornecedores"?W=H.flag_fornecedor===!0:b.tipo==="ambos"&&(W=H.flag_cliente===!0&&H.flag_fornecedor===!0),ie&&Y&&W})),[s,b]),[T,k]=p.useState({by:"codigo",dir:"asc"}),q=L=>{k(H=>H.by===L&&H.dir==="asc"?{by:L,dir:"desc"}:{by:L,dir:"asc"})},B=p.useMemo(()=>{const L=I.find(se=>se?.is_consumidor_final===!0),ie=[...I.filter(se=>se?.is_consumidor_final!==!0)],Y=T.dir==="asc"?1:-1,W=(se,pe)=>Number.isFinite(se)?se:pe;return ie.sort((se,pe)=>{if(T.by==="codigo"){const G=W(parseInt(String(se.codigo||"").trim(),10),1/0),te=W(parseInt(String(pe.codigo||"").trim(),10),1/0);return G===te?0:G>te?Y:-Y}if(T.by==="nome"){const G=(se.nome||"").toString(),te=(pe.nome||"").toString();return G.localeCompare(te,"pt-BR",{sensitivity:"base"})*Y}return 0}),L?[L,...ie]:ie},[I,T]),z=L=>{g(L),m(!0)},F=()=>{y(null),f(!0)},V=L=>{m(!1),y(L),f(!0)},me=async L=>{try{const{error:H}=await Q.from("clientes").update({status:"inactive"}).eq("id",L.id);if(H)throw H;m(!1),e({title:"Cliente inativado",description:`${L.nome} foi marcado como inativo.`}),S()}catch(H){e({title:"Erro ao inativar cliente",description:H.message,variant:"destructive"})}},be=()=>{w({searchTerm:"",status:"all",tipo:"todos"})},U=b.searchTerm!==""||b.status!=="all"||b.tipo!=="todos";return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-full flex flex-col",children:a.jsxs(Fr.div,{variants:Jst,initial:"hidden",animate:"visible",children:[a.jsxs(Fr.div,{variants:poe,className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary tracking-tighter",children:"Clientes & Fornecedores"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Gesto completa de clientes e fornecedores"})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:()=>d(L=>!L),title:c?"Ocultar resumo":"Mostrar resumo","aria-label":c?"Ocultar resumo":"Mostrar resumo",className:"flex-shrink-0",children:c?a.jsx(kg,{className:"h-4 w-4"}):a.jsx(Xg,{className:"h-4 w-4"})}),a.jsxs(Z,{variant:"outline",onClick:O,className:"text-sm",children:[a.jsx(ws,{className:"mr-2 h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),a.jsx("span",{className:"sm:hidden",children:"CSV"})]}),a.jsxs(Z,{onClick:F,className:"text-sm",children:[a.jsx(so,{className:"mr-2 h-4 w-4"})," ",a.jsx("span",{className:"hidden xs:inline",children:"Novo"}),a.jsx("span",{className:"xs:hidden",children:"Novo"})]})]})]}),c&&a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[a.jsx(s2,{icon:mc,title:"Total de Clientes",value:s.filter(L=>L.flag_cliente).length,color:"text-brand",onClick:()=>w(L=>({...L,tipo:"clientes"})),isActive:b.tipo==="clientes"}),a.jsx(s2,{icon:mc,title:"Total de Fornecedores",value:s.filter(L=>L.flag_fornecedor).length,color:"text-purple-500",onClick:()=>w(L=>({...L,tipo:"fornecedores"})),isActive:b.tipo==="fornecedores"}),a.jsx(s2,{icon:Uue,title:"Aniversariantes do Ms",value:A.birthdays,color:"text-info",onClick:()=>w(L=>({...L,tipo:"todos"})),isActive:b.tipo==="todos"}),a.jsx(s2,{icon:Lm,title:"Ativos",value:A.active,color:"text-success",onClick:()=>w(L=>({...L,status:"active"})),isActive:b.status==="active"})]}),a.jsx(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsxs("div",{className:"p-4 border-b border-border flex flex-col gap-4",children:[a.jsxs("div",{className:"relative w-full",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar por nome, CPF ou telefone...",className:"pl-9",value:b.searchTerm,onChange:L=>w(H=>({...H,searchTerm:L.target.value}))})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[a.jsxs(Zn,{value:b.tipo,onValueChange:L=>w(H=>({...H,tipo:L})),children:[a.jsx(Yn,{className:"w-full sm:w-[200px]",children:a.jsx(ta,{placeholder:"Tipo"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"todos",children:"Todos"}),a.jsx(nt,{value:"clientes",children:"Apenas Clientes"}),a.jsx(nt,{value:"fornecedores",children:"Apenas Fornecedores"}),a.jsx(nt,{value:"ambos",children:"Clientes e Fornecedores"})]})]}),a.jsxs(Zn,{value:b.status,onValueChange:L=>w(H=>({...H,status:L})),children:[a.jsx(Yn,{className:"w-full sm:w-[180px]",children:a.jsx(ta,{placeholder:"Status"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todos os Status"}),a.jsx(nt,{value:"active",children:"Ativos"}),a.jsx(nt,{value:"inactive",children:"Inativos"})]})]}),U&&a.jsxs(Z,{variant:"ghost",onClick:be,className:"w-full sm:w-auto",children:[a.jsx(Og,{className:"mr-2 h-4 w-4"}),"Limpar Filtros"]})]})]}),a.jsx("div",{className:"md:hidden space-y-3 p-4",children:i?a.jsx("div",{className:"text-center py-8 text-text-muted",children:"Carregando..."}):B.length>0?B.map(L=>{const H=L?.is_consumidor_final===!0;return a.jsxs("div",{className:Pr("rounded-lg border bg-surface p-4 space-y-3 cursor-pointer transition-all",H?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-4 border-l-amber-500/40 border-t-border border-r-border border-b-border":"border-border hover:border-brand/50"),onClick:()=>z(L),children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx("span",{className:Pr("font-mono text-sm font-semibold",H?"text-amber-300/90":"text-text-primary"),children:L.codigo}),a.jsx("span",{className:Pr("px-2 py-0.5 text-xs font-semibold rounded-full flex-shrink-0",L.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:L.status==="active"?"Ativo":"Inativo"})]}),a.jsxs("div",{children:[a.jsx("h3",{className:Pr("font-semibold text-base mb-1",H?"text-amber-100/90":"text-text-primary"),children:L.nome||""}),H&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium mb-1",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]}),a.jsx("p",{className:"text-sm text-text-muted",children:L.cpf&&`CPF: ${L.cpf}`||L.cnpj&&`CNPJ: ${L.cnpj}`||(L.apelido?`Apelido: ${L.apelido}`:" ")})]}),a.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[L.flag_cliente&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),L.flag_fornecedor&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]}),(L.telefone||L.email)&&a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Contato"}),a.jsx("span",{className:"text-sm font-medium",children:L.telefone||L.email})]}),a.jsx("div",{className:"text-xs text-text-muted text-center pt-2 border-t border-border/50",children:"Toque para ver detalhes"})]},L.id)}):a.jsx("div",{className:"text-center py-8 text-text-muted",children:"Nenhum cliente encontrado com os filtros aplicados."})}),a.jsx("div",{className:"hidden md:block",children:a.jsxs(oc,{children:[a.jsx(ic,{className:"sticky top-0 bg-surface-2 z-10",children:a.jsxs(zs,{className:"border-b border-border",children:[a.jsxs(ka,{className:"select-none cursor-pointer text-text-secondary",onClick:()=>q("codigo"),title:"Ordenar por cdigo",children:["Cdigo ",T.by==="codigo"?T.dir==="asc"?"":"":""]}),a.jsxs(ka,{className:"text-text-secondary select-none cursor-pointer",onClick:()=>q("nome"),title:"Ordenar por nome",children:["Cliente ",T.by==="nome"?T.dir==="asc"?"":"":""]}),a.jsx(ka,{className:"text-text-secondary",children:"Contato"}),a.jsx(ka,{className:"text-text-secondary",children:"Tipo"}),a.jsx(ka,{className:"text-text-secondary",children:"Status"})]})}),a.jsx(lc,{children:i?a.jsx(zs,{children:a.jsx(ca,{colSpan:5,className:"h-24 text-center",children:"Carregando..."})}):B.length>0?B.map(L=>{const H=L?.is_consumidor_final===!0;return a.jsxs(zs,{className:Pr("cursor-pointer transition-all",H?"bg-gradient-to-r from-amber-500/5 to-transparent hover:from-amber-500/10 border-l-2 border-l-amber-500/40":"hover:bg-surface-2"),onClick:()=>z(L),children:[a.jsx(ca,{className:Pr("font-mono text-base font-semibold",H?"text-amber-300/90":"text-text-primary"),children:L.codigo}),a.jsx(ca,{children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:Pr("text-base font-semibold truncate",H?"text-amber-100/90":"text-text-primary"),children:L.nome||""}),H&&a.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-amber-400/70 font-medium",children:[a.jsx("svg",{className:"w-3 h-3 opacity-60",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cliente Padro"]}),a.jsx("span",{className:"text-xs text-text-muted truncate",children:L.cpf&&`CPF: ${L.cpf}`||L.cnpj&&`CNPJ: ${L.cnpj}`||(L.apelido?`Apelido: ${L.apelido}`:" ")})]})}),a.jsx(ca,{children:a.jsx("div",{className:"flex flex-col",children:a.jsx("span",{className:"text-sm truncate",children:L.telefone||L.email||""})})}),a.jsx(ca,{children:a.jsxs("div",{className:"flex flex-wrap gap-1",children:[L.flag_cliente&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-500/10 text-blue-500 border border-blue-500/30",children:"Cliente"}),L.flag_fornecedor&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-purple-500/10 text-purple-500 border border-purple-500/30",children:"Fornecedor"})]})}),a.jsx(ca,{children:a.jsx("span",{className:Pr("px-2 py-1 text-xs font-semibold rounded-full",L.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:L.status==="active"?"Ativo":"Inativo"})})]},L.id)}):a.jsx(zs,{children:a.jsx(ca,{colSpan:5,className:"h-24 text-center",children:"Nenhum cliente encontrado com os filtros aplicados."})})})]})})]})})]})}),a.jsx(_ne,{open:u,onOpenChange:f,client:v,onSaved:S}),a.jsx(Qst,{open:h,onOpenChange:m,client:x,onEdit:V,onInactivate:me,codigoEmpresa:t?.codigo_empresa})]})}const eot=[],tot={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},goe={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},Dk=({icon:e,title:t,value:r,color:n})=>{const s=e;return a.jsxs(Fr.div,{variants:goe,className:"bg-surface rounded-lg border border-border p-4 flex items-center gap-4",children:[a.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${n}/20`,children:a.jsx(s,{className:`w-6 h-6 ${n}`})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-text-secondary text-sm font-medium",children:t}),a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r})]})]})};function rot({open:e,onOpenChange:t,member:r,onEdit:n}){return r?a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"sm:max-w-[500px] w-full",children:[a.jsx(Bn,{children:a.jsx(Ln,{children:"Detalhes do Funcionrio"})}),a.jsxs("div",{className:"p-4 sm:p-6 space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-xl font-bold",children:r.name}),a.jsx("p",{className:"text-brand font-semibold",children:r.role})]}),a.jsxs("div",{className:"bg-surface-2 p-8 rounded-lg text-center border border-border",children:[a.jsx("p",{className:"text-lg font-semibold text-text-secondary",children:" Em desenvolvimento"}),a.jsx("p",{className:"text-sm text-text-muted mt-2",children:"Detalhes completos do funcionrio estaro disponveis em breve."})]})]}),a.jsxs(Ga,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Fechar"})}),a.jsxs(Z,{onClick:()=>n(r),className:"w-full sm:w-auto",children:[a.jsx(fc,{className:"mr-2 h-4 w-4"})," Editar"]})]})]})}):null}function not({open:e,onOpenChange:t,member:r,onSave:n,loading:s}){const{toast:o}=Zs(),[i,l]=p.useState(r?.name||""),[c,d]=p.useState(r?.role||"");p.useEffect(()=>{e&&(l(r?.name||""),d(r?.role||""))},[r,e]);const u=async f=>{if(f.preventDefault(),!i.trim()){o({title:"Nome  obrigatrio",variant:"destructive"});return}await n({name:i.trim(),role:c.trim()})};return a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"sm:max-w-[700px] w-full",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:r?"Editar Funcionrio":"Novo Funcionrio"}),a.jsx(ma,{children:"Informe apenas nome e cargo. O cargo  livre (texto)."})]}),a.jsx("form",{onSubmit:u,className:"py-2",children:a.jsx("div",{className:"bg-surface-2 border border-border rounded-lg p-4 space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{htmlFor:"name",children:"Nome"}),a.jsxs("div",{className:"relative",children:[a.jsx(kf,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{id:"name",value:i,onChange:f=>l(f.target.value),className:"pl-9",placeholder:"Ex.: Maria Silva"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{htmlFor:"role",children:"Cargo"}),a.jsxs("div",{className:"relative",children:[a.jsx(Kue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{id:"role",value:c,onChange:f=>d(f.target.value),className:"pl-9",placeholder:"Ex.: Gerente, Caixa, ..."})]})]})]})})}),a.jsxs(Ga,{className:"flex flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(Zh,{asChild:!0,children:a.jsx(Z,{type:"button",variant:"secondary",className:"w-full sm:w-auto",children:"Cancelar"})}),a.jsx(Z,{type:"submit",onClick:u,disabled:!!s,className:"w-full sm:w-auto",children:s?"Salvando...":"Salvar"})]})]})})}function aot(){const{company:e,authReady:t,userProfile:r}=lo(),{toast:n}=Zs(),[s,o]=p.useState(eot),[i,l]=p.useState(!1),[c,d]=p.useState(!1),[u,f]=p.useState(null),[h,m]=p.useState(null),[x,g]=p.useState(""),[v,y]=p.useState(!1),b=p.useRef(!1),w=p.useRef(!0);p.useEffect(()=>(w.current=!0,()=>{w.current=!1}),[]);const j=async()=>{try{const T=e?.codigo_empresa||null;if(!T&&!e?.id)return;const k=T?`team:list:${T}`:"team:list",q=setTimeout(()=>{if(w.current)try{const U=localStorage.getItem(k),L=U?JSON.parse(U):[];Array.isArray(L)&&L.length>0&&(console.warn("[Equipe] slow fallback: using cached snapshot"),o(L))}catch{}},5e3);let B=Q.from("colaboradores").select("*").order("nome",{ascending:!0});T&&(B=B.eq("codigo_empresa",T));const{data:z,error:F}=await B;if(F){if(!b.current){b.current=!0,setTimeout(j,800);return}throw F}let me=(z||[]).map(U=>({id:U.id,name:U.nome||"",role:U.cargo||"user",status:U.ativo===!1?"inactive":"active",online:!1,permissions:{}}));const be=r?.codigo_empresa&&e?.codigo_empresa&&r.codigo_empresa===e.codigo_empresa;if(r?.id&&be&&(me.some(L=>L.id===r.id)||(me=[{id:r.id,name:r.nome||"Voc",role:r.cargo||"user",status:"active",online:!1,permissions:{}},...me])),!w.current)return;o(me);try{localStorage.setItem(k,JSON.stringify(me))}catch{}}catch(T){console.error("Falha ao carregar equipe:",T);const k=e?.codigo_empresa||null,q=k?`team:list:${k}`:"team:list";try{const B=localStorage.getItem(q);B&&w.current&&o(JSON.parse(B))}catch{}}finally{b.current=!1}};p.useEffect(()=>{const T=e?.codigo_empresa||null;if(!(!t||!T)){try{const k=localStorage.getItem(`team:list:${T}`),q=k?JSON.parse(k):[];Array.isArray(q)&&q.length>0&&o(q)}catch{}j()}},[t,e?.codigo_empresa]),p.useEffect(()=>{const T=()=>{document.visibilityState==="visible"&&t&&(e?.codigo_empresa||e?.id)&&j()},k=()=>{t&&(e?.codigo_empresa||e?.id)&&j()};return document.addEventListener("visibilitychange",T),window.addEventListener("focus",k),()=>{document.removeEventListener("visibilitychange",T),window.removeEventListener("focus",k)}},[t,e?.codigo_empresa,e?.id]);const _=p.useMemo(()=>({total:s.length,active:s.filter(T=>T.status==="active").length,inactive:s.filter(T=>T.status==="inactive").length}),[s]),C=p.useMemo(()=>s.filter(T=>T.name.toLowerCase().includes(x.toLowerCase())||T.role.toLowerCase().includes(x.toLowerCase())),[s,x]),E=T=>{f(T),d(!0)},S=()=>{m(null),l(!0)},A=T=>{d(!1),m(T),l(!0)},M=T=>{m(T),l(!0)},O=async({name:T,role:k})=>{try{if(y(!0),!e?.codigo_empresa&&!e?.id)throw new Error("Empresa no encontrada para o usurio atual.");let q=e?.codigo_empresa||null;if(!q&&e?.id){const{data:B}=await Q.from("empresas").select("codigo_empresa").eq("id",e.id).single();q=B?.codigo_empresa||null}if(!q)throw new Error("Empresa sem cdigo. Defina o cdigo da empresa antes de adicionar colaboradores.");if(h){const{error:B}=await Q.from("colaboradores").update({nome:T,cargo:k}).eq("id",h.id);if(B)throw B;n({title:"Funcionrio atualizado",description:h.name,variant:"default"})}else{const{error:B}=await Q.from("colaboradores").insert({codigo_empresa:q,nome:T,cargo:k,ativo:!0});if(B)throw B;n({title:"Funcionrio criado com sucesso",description:T,variant:"success"})}await j(),l(!1),m(null)}catch(q){n({title:"Erro ao salvar funcionrio",description:q.message||String(q),variant:"destructive"})}finally{y(!1)}},I=async T=>{try{if(!(e?.id||e?.codigo_empresa))return;const k=s[0]?.id;if(T.id===k){n({title:"Ao no permitida",description:"No  possvel desativar o primeiro funcionrio.",variant:"destructive"});return}if(r?.id&&T.id===r.id){n({title:"Ao no permitida",description:"Voc no pode desativar o seu prprio usurio.",variant:"destructive"});return}if(s.filter(B=>B.status==="active").length<=1){n({title:"Ao no permitida",description:"Deve haver pelo menos um funcionrio ativo.",variant:"destructive"});return}const{error:q}=await Q.from("colaboradores").update({ativo:!1}).eq("id",T.id);if(q)throw q;n({title:"Funcionrio desativado",description:T.name}),await j()}catch(k){n({title:"Erro ao desativar",description:k.message||String(k),variant:"destructive"})}};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-full flex flex-col",children:a.jsxs(Fr.div,{variants:tot,initial:"hidden",animate:"visible",children:[a.jsxs(Fr.div,{variants:goe,className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-text-primary tracking-tighter",children:"Gesto de Equipe"}),a.jsx("p",{className:"text-sm sm:text-base text-text-secondary",children:"Controle de funcionrios, permisses e logs."})]}),a.jsxs(Z,{onClick:S,disabled:!t||!e?.codigo_empresa,title:t?e?.codigo_empresa?"":"Empresa sem cdigo. Defina o cdigo da empresa antes.":"Aguardando autenticao...",children:[a.jsx(so,{className:"mr-2 h-4 w-4"})," Novo Funcionrio"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsx(Dk,{icon:mc,title:"Total",value:_.total,color:"text-brand"}),a.jsx(Dk,{icon:cfe,title:"Ativos",value:_.active,color:"text-success"}),a.jsx(Dk,{icon:sfe,title:"Desativados",value:_.inactive,color:"text-danger"})]}),a.jsx(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[a.jsx("div",{className:"p-4 border-b border-border",children:a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar por nome ou cargo...",className:"pl-9",value:x,onChange:T=>g(T.target.value)})]})}),a.jsx("div",{className:"md:hidden p-4 space-y-3",children:C.length===0?a.jsx("div",{className:"text-center py-10 text-text-muted",children:"Nenhum funcionrio cadastrado."}):C.map((T,k)=>a.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4 space-y-3",onClick:()=>E(T),children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-base text-text-primary truncate",children:T.name}),a.jsx("p",{className:"text-sm text-text-muted mt-0.5",children:T.role})]}),a.jsx("span",{className:Pr("inline-flex px-2 py-0.5 rounded-full text-xs font-semibold flex-shrink-0",T.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:T.status==="active"?"Ativo":"Inativo"})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx(Z,{variant:"outline",size:"sm",onClick:q=>{q.stopPropagation(),E(T)},className:"flex-1",children:"Ver Detalhes"}),a.jsx(Z,{variant:"outline",size:"sm",onClick:q=>{q.stopPropagation(),M(T)},children:a.jsx(fc,{className:"h-3 w-3"})}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{variant:"outline",size:"sm",onClick:q=>q.stopPropagation(),children:a.jsx(l$,{className:"h-3 w-3"})})}),a.jsx(Yu,{align:"end",children:a.jsx(bs,{className:"text-danger",disabled:k===0||s.filter(q=>q.status==="active").length<=1||r?.id&&T.id===r.id,onClick:q=>{q.stopPropagation(),I(T)},children:"Desativar"})})]})]})]},T.id))}),a.jsx("div",{className:"hidden md:block",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Funcionrio"}),a.jsx(ka,{children:"Cargo"}),a.jsx(ka,{children:"Status"}),a.jsx(ka,{className:"w-[80px] text-center",children:"Aes"})]})}),a.jsxs(lc,{children:[C.length===0&&a.jsx(zs,{children:a.jsx(ca,{colSpan:4,className:"text-center py-10 text-text-muted",children:"Nenhum funcionrio cadastrado."})}),C.map((T,k)=>a.jsxs(zs,{className:"cursor-pointer",onClick:()=>E(T),children:[a.jsx(ca,{className:"font-medium",children:a.jsx("div",{className:"flex items-center gap-3",children:a.jsx("span",{children:T.name})})}),a.jsx(ca,{children:T.role}),a.jsx(ca,{children:a.jsx("span",{className:Pr("px-2 py-1 text-xs font-semibold rounded-full",T.status==="active"?"bg-success/10 text-success":"bg-danger/10 text-danger"),children:T.status==="active"?"Ativo":"Inativo"})}),a.jsx(ca,{className:"text-center",children:a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{variant:"ghost",className:"h-8 w-8 p-0 mx-auto",onClick:q=>q.stopPropagation(),children:a.jsx(l$,{className:"h-4 w-4"})})}),a.jsxs(Yu,{align:"end",children:[a.jsx(bs,{onClick:q=>{q.stopPropagation(),E(T)},children:"Ver Detalhes"}),a.jsx(bs,{onClick:q=>{q.stopPropagation(),M(T)},children:"Editar"}),a.jsx(bs,{className:"text-danger",disabled:k===0||s.filter(q=>q.status==="active").length<=1||r?.id&&T.id===r.id,onClick:q=>{q.stopPropagation(),I(T)},children:"Desativar"})]})]})})]},T.id))]})]})})]})})]})}),a.jsx(not,{open:i,onOpenChange:l,member:h,onSave:O,loading:v}),a.jsx(rot,{open:c,onOpenChange:d,member:u,onEdit:A})]})}const sot="v2.5.1";function fh({title:e,icon:t,children:r,className:n="",collapsible:s=!1,defaultOpen:o=!0}){return s?a.jsx("div",{className:`bg-surface rounded-lg border border-border shadow-sm ${n}`,children:a.jsxs("details",{className:"group",open:o,children:[a.jsxs("summary",{className:"list-none cursor-pointer select-none p-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[t&&a.jsx(t,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"text-base font-semibold",children:e})]}),a.jsx("span",{className:"text-xs text-text-secondary group-open:rotate-180 transition-transform",children:""})]}),a.jsx("div",{className:"px-4 pb-4",children:r})]})}):a.jsxs("div",{className:`bg-surface rounded-lg border border-border shadow-sm p-4 ${n}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t&&a.jsx(t,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"text-base font-semibold",children:e})]}),r]})}function mh({label:e,value:t}){return a.jsxs("div",{className:"flex items-center justify-between gap-3 py-1 text-sm",children:[a.jsx("span",{className:"text-text-secondary",children:e}),a.jsx("span",{className:"font-medium truncate",children:t||""})]})}function oot(){const{userProfile:e,company:t,authReady:r,loading:n}=lo();_i();const[s,o]=p.useState("Agenda"),[i,l]=p.useState("Mdia"),[c,d]=p.useState(""),[u,f]=p.useState(""),[h,m]=p.useState(!0),[x,g]=p.useState(()=>window.__installPrompt||null),[v,y]=p.useState(!1),[b,w]=p.useState(!1),[j,_]=p.useState(!1),[C,E]=p.useState("unknown"),S="Fluxo7 Arena",A="fluxo7team@gmail.com",M="https://wa.me/5534998936088",O="tel:+5534998936088",I="+55 (34) 99893-6088";p.useEffect(()=>{try{const V=window.matchMedia("(pointer:fine)"),me=()=>m(V.matches);return me(),V.addEventListener?.("change",me),()=>V.removeEventListener?.("change",me)}catch{m(!0)}},[]),p.useEffect(()=>{const V=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;w(V);const me=navigator.userAgent;me.includes("Chrome")&&!me.includes("Edg")?E("chrome"):me.includes("Edg")?E("edge"):me.includes("Firefox")?E("firefox"):me.includes("Safari")&&!me.includes("Chrome")?E("safari"):E("other"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&y(!0),window.__installPrompt&&!x&&g(window.__installPrompt);const be=()=>{y(!0),g(null),_(!1)};return window.addEventListener("appinstalled",be),()=>{window.removeEventListener("appinstalled",be)}},[x]);const T=async()=>{if(x)try{await x.prompt();const{outcome:V}=await x.userChoice;V==="accepted"?(y(!0),_(!1)):_(!0),g(null),window.__installPrompt=null}catch(V){console.error("Erro ao mostrar prompt de instalao:",V),_(!0)}else _(!0)},k=()=>{navigator.share?navigator.share({title:"F7 Arena",text:"Adicione F7 Arena  sua tela inicial",url:window.location.href}).catch(()=>{alert(`Para adicionar  tela inicial:

1. Toque no boto de Compartilhar (cone de quadrado com seta)
2. Role para baixo
3. Toque em "Adicionar  Tela de Incio"`)}):alert(`Para adicionar  tela inicial:

1. Toque no boto de Compartilhar (cone de quadrado com seta)
2. Role para baixo
3. Toque em "Adicionar  Tela de Incio"`)},q=p.useMemo(()=>{try{return{empresa:t?.nome||t?.fantasia||t?.razao_social||t?.razaoSocial||t?.displayName||t?.codigo_empresa||"",usuario:e?.nome||e?.name||e?.email||"",dataHora:new Date().toLocaleString("pt-BR")}}catch{return{empresa:"",usuario:"",dataHora:new Date().toLocaleString("pt-BR")}}},[t?.nome,t?.fantasia,t?.razao_social,t?.razaoSocial,t?.displayName,t?.codigo_empresa,e?.nome,e?.name,e?.email]),B=p.useMemo(()=>[`[${S} - Suporte]`,`Assunto: ${c||"(sem assunto)"} `,`Categoria: ${s} `,`Severidade: ${i}`,"","Descrio:",(u||"(adicione uma descrio detalhada, passos para reproduzir, prints se possvel)")+`
`," Dados ",`Empresa: ${q.empresa}`,`Usurio: ${q.usuario}`,`Data e Hora: ${q.dataHora}`].join(`
`),[c,s,i,u,q]),z=`${M}?text=${encodeURIComponent(B)}`,F=`mailto:${A}?subject=${encodeURIComponent(`[Suporte] ${c||"Assunto"}`)}&body=${encodeURIComponent(B)}`;return a.jsxs("div",{className:"px-4 md:px-6 lg:px-8 py-4 md:py-6",children:[a.jsxs("div",{className:"bg-surface rounded-xl border border-border p-5 md:p-6 mb-6",children:[a.jsxs("div",{className:"flex items-start md:items-center justify-between gap-4 flex-col md:flex-row",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand/10 border border-brand/30 flex items-center justify-center",children:a.jsx(wG,{className:"w-5 h-5 text-brand"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl md:text-2xl font-semibold",children:"Suporte"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Precisa de ajuda? Fale com a gente ou consulte as respostas rpidas abaixo."})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center",children:a.jsx(jd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-base md:text-xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-base md:text-xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-base md:text-xl",style:{color:"#B0B0B0"},children:" Arena"})]})]}),a.jsxs("div",{className:"text-xs text-text-secondary mt-1",children:["Verso ",sot]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4",children:[a.jsx(fh,{title:"Status",icon:bb,children:a.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[a.jsx(mh,{label:"Empresa",value:q.empresa}),a.jsx(mh,{label:"Usurio",value:`${q.usuario}`})]})}),a.jsx(fh,{title:"Fale com a gente",icon:kP,children:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("a",{href:M,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-brand text-black hover:opacity-90 transition",children:[a.jsx(kP,{className:"w-4 h-4"})," WhatsApp"]}),a.jsxs("a",{href:`mailto:${A}`,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(u0,{className:"w-4 h-4"})," E-mail"]}),a.jsxs("a",{href:O,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(Tw,{className:"w-4 h-4"})," ",h?I:"Telefone"]})]})}),!v&&b&&a.jsx(fh,{title:"Adicionar  Tela Inicial",icon:IP,children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-text-secondary",children:"Crie um atalho do F7 Arena na sua tela inicial para acesso rpido."}),a.jsxs("button",{onClick:k,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-md bg-brand text-black font-medium hover:opacity-90 transition",children:[a.jsx(u$,{className:"w-4 h-4"})," Criar Atalho"]}),a.jsxs("details",{className:"text-xs text-text-muted",children:[a.jsx("summary",{className:"cursor-pointer hover:text-text-secondary",children:"Como fazer manualmente?"}),a.jsxs("div",{className:"mt-2 space-y-1 pl-2",children:[a.jsxs("p",{children:["1. Toque no boto ",a.jsx(u$,{className:"inline w-3 h-3"})," (Compartilhar)"]}),a.jsx("p",{children:'2. Role para baixo e toque em "Adicionar  Tela de Incio"'}),a.jsx("p",{children:'3. Toque em "Adicionar"'})]})]})]})}),!v&&!b&&a.jsx(fh,{title:"Instalar Aplicativo",icon:IP,children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-text-secondary",children:"Instale o F7 Arena no seu dispositivo para acesso rpido e experincia completa de aplicativo."}),a.jsxs("button",{onClick:T,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-md bg-brand text-black font-medium hover:opacity-90 transition",children:[a.jsx(ws,{className:"w-4 h-4"})," Instalar App"]}),a.jsx("p",{className:"text-xs text-text-muted text-center",children:"Pode demorar alguns segundos. Se no aparecer nada, veja as instrues no tutorial."})]})}),v&&a.jsx(fh,{title:"Aplicativo Instalado",icon:bb,children:a.jsxs("div",{className:"flex items-center gap-2 text-sm text-success",children:[a.jsx(bb,{className:"w-4 h-4"}),a.jsx("span",{children:"F7 Arena est instalado no seu dispositivo!"})]})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2 space-y-3",children:a.jsx(fh,{title:"Perguntas Frequentes (FAQ)",children:a.jsxs("div",{className:"divide-y divide-border/60",children:[a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como abrir comanda de balco?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Abra o caixa antes. A tela de balco utiliza uma comanda sem mesa (mesa_id nulo). Se no existir, o sistema cria ao abrir o balco; caso o caixa esteja fechado, a abertura da comanda  bloqueada."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Por que no consigo fechar o caixa?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"O fechamento  bloqueado se houver comandas com itens em aberto (inclui balco e mesas). Finalize ou feche as comandas pendentes antes de encerrar o caixa."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como adicionar participantes no agendamento?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"No modal de agendamento, selecione um ou mais clientes. Aps salvar, o chip de pagamentos  atualizado imediatamente. Se no visualizar, recarregue os dados da agenda."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como ver o histrico completo do cliente?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Abra o cliente e utilize o Histrico Recente, que combina comandas e agendamentos em uma nica timeline com totais e status."})]}),a.jsxs("details",{className:"py-3",children:[a.jsx("summary",{className:"cursor-pointer select-none font-medium",children:"Como ajustar estoque mnimo e ver mais vendidos?"}),a.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"Na aba de Produtos voc pode gerenciar estoque, preos e relatrios. Utilize filtros e exportaes para anlise."})]})]})})}),a.jsx("div",{className:"lg:col-span-1",children:a.jsxs("div",{className:"space-y-3 lg:sticky lg:top-6",children:[a.jsx(fh,{title:"Reportar um problema",icon:Due,collapsible:!0,defaultOpen:!1,children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Categoria"}),a.jsxs("select",{value:s,onChange:V=>o(V.target.value),className:"w-full mt-1 px-2 py-2 rounded-md bg-background border border-border",children:[a.jsx("option",{children:"Agenda"}),a.jsx("option",{children:"Vendas"}),a.jsx("option",{children:"Clientes"}),a.jsx("option",{children:"Produtos"}),a.jsx("option",{children:"Financeiro"}),a.jsx("option",{children:"Outros"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Severidade"}),a.jsxs("select",{value:i,onChange:V=>l(V.target.value),className:"w-full mt-1 px-2 py-2 rounded-md bg-background border border-border",children:[a.jsx("option",{children:"Baixa"}),a.jsx("option",{children:"Mdia"}),a.jsx("option",{children:"Alta"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Assunto"}),a.jsx("input",{value:c,onChange:V=>d(V.target.value),placeholder:"Ex.: Erro ao salvar agendamento",className:"w-full mt-1 px-3 py-2 rounded-md bg-background border border-border"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Descrio"}),a.jsx("textarea",{value:u,onChange:V=>f(V.target.value),rows:4,placeholder:"Descreva o que aconteceu, passos para reproduzir, expectativa.",className:"w-full mt-1 px-3 py-2 rounded-md bg-background border border-border resize-y"})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 pt-1",children:[a.jsxs("a",{href:z,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-brand text-black hover:opacity-90 transition",children:[a.jsx(kP,{className:"w-4 h-4"})," Enviar no WhatsApp"]}),a.jsxs("a",{href:F,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(u0,{className:"w-4 h-4"})," Enviar por E-mail"]}),a.jsxs("a",{href:O,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-border hover:bg-surface-2 transition",children:[a.jsx(Tw,{className:"w-4 h-4"})," ",h?I:"Ligar agora"]})]})]})}),a.jsx(fh,{title:"Diagnstico",icon:Bue,children:a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsx(mh,{label:"Empresa",value:q.empresa}),a.jsx(mh,{label:"Usurio",value:`${q.usuario}`}),a.jsx(mh,{label:"Data/Hora",value:q.dataHora}),a.jsx(mh,{label:"Canal - WhatsApp",value:"(34) 99893-6088"}),a.jsx(mh,{label:"Canal - E-mail",value:"fluxo7team@gmail.com"}),a.jsx(mh,{label:"Canal - Telefone",value:"(34) 99893-6088"})]})})]})})]}),a.jsx(Un,{open:j,onOpenChange:_,children:a.jsxs(zn,{className:"max-w-2xl max-h-[85vh] overflow-y-auto",children:[a.jsx(Bn,{children:a.jsxs(Ln,{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-xl bg-brand/10 border border-brand/30 flex items-center justify-center",children:a.jsx(ws,{className:"w-6 h-6 text-brand"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold",children:"Como Instalar o F7 Arena"}),a.jsx("p",{className:"text-sm text-text-secondary font-normal",children:"Siga as instrues para o seu navegador"})]})]})}),a.jsxs("div",{className:"mt-6 space-y-6",children:[(C==="chrome"||C==="edge")&&a.jsxs("div",{className:"bg-gradient-to-br from-brand/10 to-brand/5 rounded-xl p-6 border-2 border-brand/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand flex items-center justify-center",children:a.jsx(Lue,{className:"w-6 h-6 text-black"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Chrome (Celular)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Siga os passos abaixo"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"1"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-semibold mb-2",children:["Toque nos 3 pontinhos ",a.jsx("span",{className:"text-2xl",children:""})]}),a.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"No canto superior direito da tela"}),a.jsx("div",{className:"bg-background/50 rounded-md p-3 border border-border/50",children:a.jsx("p",{className:"text-xs text-text-muted",children:" Os 3 pontinhos ficam ao lado da barra de endereo"})})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"2"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure uma destas opes:"}),a.jsxs("div",{className:"space-y-2 mb-3",children:[a.jsx("div",{className:"bg-brand/20 rounded-md p-3 border-2 border-brand/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Instalar aplicativo"'})}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-text-muted text-sm font-medium",children:[a.jsx("div",{className:"h-px bg-border flex-1"}),a.jsx("span",{children:"OU"}),a.jsx("div",{className:"h-px bg-border flex-1"})]}),a.jsx("div",{className:"bg-brand/20 rounded-md p-3 border-2 border-brand/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Adicionar  tela inicial"'})})]}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Toque em qualquer uma dessas opes no menu"})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-brand text-black flex items-center justify-center font-bold",children:"3"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-2",children:"Confirme a instalao"}),a.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"Aparecer uma janela perguntando se deseja instalar"}),a.jsx("div",{className:"bg-success/10 rounded-md p-3 border border-success/30",children:a.jsx("p",{className:"text-sm font-medium text-center",children:' Toque em "Instalar"'})})]})]})}),a.jsxs("div",{className:"bg-success/5 rounded-lg p-4 border border-success/20",children:[a.jsx("p",{className:"text-sm font-medium text-success mb-1",children:" Pronto!"}),a.jsx("p",{className:"text-xs text-text-secondary",children:"O app aparecer na sua tela inicial e voc poder abri-lo como qualquer outro aplicativo!"})]})]})]}),C==="firefox"&&a.jsxs("div",{className:"bg-gradient-to-br from-orange-500/10 to-orange-500/5 rounded-xl p-6 border-2 border-orange-500/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-500 flex items-center justify-center",children:a.jsx(rfe,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Firefox (Celular)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Siga os passos abaixo"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold",children:"1"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-semibold mb-2",children:["Toque nos 3 pontinhos ",a.jsx("span",{className:"text-2xl",children:""})]}),a.jsx("p",{className:"text-sm text-text-secondary",children:"No canto inferior direito da tela"})]})]})}),a.jsx("div",{className:"bg-surface rounded-lg p-4 border border-border",children:a.jsxs("div",{className:"flex gap-3 items-start",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center font-bold",children:"2"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure uma destas opes:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-orange-500/20 rounded-md p-3 border-2 border-orange-500/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Instalar"'})}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-text-muted text-sm font-medium",children:[a.jsx("div",{className:"h-px bg-border flex-1"}),a.jsx("span",{children:"OU"}),a.jsx("div",{className:"h-px bg-border flex-1"})]}),a.jsx("div",{className:"bg-orange-500/20 rounded-md p-3 border-2 border-orange-500/40",children:a.jsx("p",{className:"font-bold text-center text-base",children:' "Adicionar  tela inicial"'})})]})]})]})}),a.jsxs("div",{className:"bg-success/5 rounded-lg p-4 border border-success/20",children:[a.jsx("p",{className:"text-sm font-medium text-success mb-1",children:" Pronto!"}),a.jsx("p",{className:"text-xs text-text-secondary",children:"O app ser adicionado  sua tela inicial!"})]})]})]}),(C==="safari"||C==="other")&&a.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-500/5 rounded-xl p-6 border-2 border-purple-500/30",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center",children:a.jsx(IP,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold",children:"Outros Navegadores"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Instrues gerais"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-surface rounded-lg p-4 border border-border",children:[a.jsx("p",{className:"font-semibold mb-3",children:"Procure no menu do navegador:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Instalar aplicativo"'})}),a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Adicionar  tela inicial"'})}),a.jsx("div",{className:"bg-purple-500/10 rounded-md p-3 border border-purple-500/30",children:a.jsx("p",{className:"font-medium",children:' "Criar atalho"'})})]})]}),a.jsx("div",{className:"bg-background/50 rounded-lg p-4 border border-border/50",children:a.jsx("p",{className:"text-sm text-text-muted",children:" Geralmente a opo est no menu de 3 pontos ou 3 linhas do navegador"})})]})]}),a.jsxs("div",{className:"bg-brand/5 rounded-lg p-4 border border-brand/20",children:[a.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[a.jsx(bb,{className:"w-5 h-5 text-brand"}),"Benefcios do App Instalado"]}),a.jsxs("ul",{className:"space-y-1.5 text-sm text-text-secondary",children:[a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Acesso rpido direto da rea de trabalho ou menu iniciar"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Funciona em tela cheia, sem barras do navegador"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Notificaes e atualizaes automticas"]}),a.jsxs("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand"}),"Melhor desempenho e experincia de uso"]})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{onClick:()=>_(!1),className:"px-6 py-2.5 rounded-md bg-surface-2 hover:bg-surface text-text-primary font-medium transition",children:"Entendi"})})]})]})})]})}function xoe(e,t,r,n,s){n=n||{};var o=1.15,i=s.internal.scaleFactor,l=s.internal.getFontSize()/i,c=s.getLineHeightFactor?s.getLineHeightFactor():o,d=l*c,u=/\r\n|\r|\n/g,f="",h=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(f=typeof e=="string"?e.split(u):e,h=f.length||1),r+=l*(2-o),n.valign==="middle"?r-=h/2*d:n.valign==="bottom"&&(r-=h*d),n.halign==="center"||n.halign==="right"){var m=l;if(n.halign==="center"&&(m*=.5),f&&h>=1){for(var x=0;x<f.length;x++)s.text(f[x],t-s.getStringUnitWidth(f[x])*m,r),r+=d;return s}t-=s.getStringUnitWidth(e)*m}return n.halign==="justify"?s.text(e,t,r,{maxWidth:n.maxWidth||100,align:"justify"}):s.text(e,t,r),s}var pV={},e0=function(){function e(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return e.setDefaults=function(t,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=t:pV=t},e.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},e.prototype.applyStyles=function(t,r){var n,s,o;r===void 0&&(r=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var i=this.jsPDFDocument.internal.getFont(),l=i.fontStyle,c=i.fontName;if(t.font&&(c=t.font),t.fontStyle){l=t.fontStyle;var d=this.getFontList()[c];d&&d.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(d[0]),l=d[0])}if(this.jsPDFDocument.setFont(c,l),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!r){var u=e.unifyColor(t.fillColor);u&&(n=this.jsPDFDocument).setFillColor.apply(n,u),u=e.unifyColor(t.textColor),u&&(s=this.jsPDFDocument).setTextColor.apply(s,u),u=e.unifyColor(t.lineColor),u&&(o=this.jsPDFDocument).setDrawColor.apply(o,u),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(t,r,n){return this.jsPDFDocument.splitTextToSize(t,r,n)},e.prototype.rect=function(t,r,n,s,o){return this.jsPDFDocument.rect(t,r,n,s,o)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return pV||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},e.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},e.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}(),B3=function(e,t){return B3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},B3(e,t)};function voe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");B3(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var yoe=function(e){voe(t,e);function t(r){var n=e.call(this)||this;return n._element=r,n}return t}(Array);function iot(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function lot(e){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[e]}function vC(e,t,r){r.applyStyles(t,!0);var n=Array.isArray(e)?e:[e],s=n.map(function(o){return r.getTextWidth(o)}).reduce(function(o,i){return Math.max(o,i)},0);return s}function boe(e,t,r,n){var s=t.settings.tableLineWidth,o=t.settings.tableLineColor;e.applyStyles({lineWidth:s,lineColor:o});var i=woe(s,!1);i&&e.rect(r.x,r.y,t.getWidth(e.pageSize().width),n.y-r.y,i)}function woe(e,t){var r=e>0,n=t||t===0;return r&&n?"DF":r?"S":n?"F":null}function WA(e,t){var r,n,s,o;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===3)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e.length===1?e=e[0]:e=t}return typeof e=="object"?(typeof e.vertical=="number"&&(e.top=e.vertical,e.bottom=e.vertical),typeof e.horizontal=="number"&&(e.right=e.horizontal,e.left=e.horizontal),{left:(r=e.left)!==null&&r!==void 0?r:t,top:(n=e.top)!==null&&n!==void 0?n:t,right:(s=e.right)!==null&&s!==void 0?s:t,bottom:(o=e.bottom)!==null&&o!==void 0?o:t}):(typeof e!="number"&&(e=t),{top:e,right:e,bottom:e,left:e})}function joe(e,t){var r=WA(t.settings.margin,0);return e.pageSize().width-(r.left+r.right)}function cot(e,t,r,n,s){var o={},i=1.3333333333333333,l=Mk(t,function(w){return s.getComputedStyle(w).backgroundColor});l!=null&&(o.fillColor=l);var c=Mk(t,function(w){return s.getComputedStyle(w).color});c!=null&&(o.textColor=c);var d=uot(n,r);d&&(o.cellPadding=d);var u="borderTopColor",f=i*r,h=n.borderTopWidth;if(n.borderBottomWidth===h&&n.borderRightWidth===h&&n.borderLeftWidth===h){var m=(parseFloat(h)||0)/f;m&&(o.lineWidth=m)}else o.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/f,right:(parseFloat(n.borderRightWidth)||0)/f,bottom:(parseFloat(n.borderBottomWidth)||0)/f,left:(parseFloat(n.borderLeftWidth)||0)/f},o.lineWidth.top||(o.lineWidth.right?u="borderRightColor":o.lineWidth.bottom?u="borderBottomColor":o.lineWidth.left&&(u="borderLeftColor"));var x=Mk(t,function(w){return s.getComputedStyle(w)[u]});x!=null&&(o.lineColor=x);var g=["left","right","center","justify"];g.indexOf(n.textAlign)!==-1&&(o.halign=n.textAlign),g=["middle","bottom","top"],g.indexOf(n.verticalAlign)!==-1&&(o.valign=n.verticalAlign);var v=parseInt(n.fontSize||"");isNaN(v)||(o.fontSize=v/i);var y=dot(n);y&&(o.fontStyle=y);var b=(n.fontFamily||"").toLowerCase();return e.indexOf(b)!==-1&&(o.font=b),o}function dot(e){var t="";return(e.fontWeight==="bold"||e.fontWeight==="bolder"||parseInt(e.fontWeight)>=700)&&(t="bold"),(e.fontStyle==="italic"||e.fontStyle==="oblique")&&(t+="italic"),t}function Mk(e,t){var r=_oe(e,t);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var s=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],o=parseInt(n[4]);return o===0||isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function _oe(e,t){var r=t(e);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?e.parentElement==null?null:_oe(e.parentElement,t):r}function uot(e,t){var r=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],n=96/(72/t),s=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,o=r.map(function(l){return parseInt(l||"0")/n}),i=WA(o,0);return s>i.top&&(i.top=s),s>i.bottom&&(i.bottom=s),i}function Noe(e,t,r,n,s){var o,i;n===void 0&&(n=!1),s===void 0&&(s=!1);var l;typeof t=="string"?l=r.document.querySelector(t):l=t;var c=Object.keys(e.getFontList()),d=e.scaleFactor(),u=[],f=[],h=[];if(!l)return console.error("Html table could not be found with input: ",t),{head:u,body:f,foot:h};for(var m=0;m<l.rows.length;m++){var x=l.rows[m],g=(i=(o=x?.parentElement)===null||o===void 0?void 0:o.tagName)===null||i===void 0?void 0:i.toLowerCase(),v=fot(c,d,r,x,n,s);v&&(g==="thead"?u.push(v):g==="tfoot"?h.push(v):f.push(v))}return{head:u,body:f,foot:h}}function fot(e,t,r,n,s,o){for(var i=new yoe(n),l=0;l<n.cells.length;l++){var c=n.cells[l],d=r.getComputedStyle(c);if(s||d.display!=="none"){var u=void 0;o&&(u=cot(e,c,t,d,r)),i.push({rowSpan:c.rowSpan,colSpan:c.colSpan,styles:u,_element:c,content:mot(c)})}}var f=r.getComputedStyle(n);if(i.length>0&&(s||f.display!=="none"))return i}function mot(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),t.innerText||t.textContent||""}function hot(e,t,r){for(var n=0,s=[e,t,r];n<s.length;n++){var o=s[n];o&&typeof o!="object"&&console.error("The options parameter should be of type object, is: "+typeof o),o.startY&&typeof o.startY!="number"&&(console.error("Invalid value for startY option",o.startY),delete o.startY)}}function Am(e,t,r,n,s){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),i=1;i<arguments.length;i++){var l=arguments[i];if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c])}return o}function bF(e,t){var r=new e0(e),n=r.getDocumentOptions(),s=r.getGlobalOptions();hot(s,n,t);var o=Am({},s,n,t),i;typeof window<"u"&&(i=window);var l=pot(s,n,t),c=got(s,n,t),d=xot(r,o),u=yot(r,o,i);return{id:t.tableId,content:u,hooks:c,styles:l,settings:d}}function pot(e,t,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},s=function(c){if(c==="columnStyles"){var d=e[c],u=t[c],f=r[c];n.columnStyles=Am({},d,u,f)}else{var h=[e,t,r],m=h.map(function(x){return x[c]||{}});n[c]=Am({},m[0],m[1],m[2])}},o=0,i=Object.keys(n);o<i.length;o++){var l=i[o];s(l)}return n}function got(e,t,r){for(var n=[e,t,r],s={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},o=0,i=n;o<i.length;o++){var l=i[o];l.didParseCell&&s.didParseCell.push(l.didParseCell),l.willDrawCell&&s.willDrawCell.push(l.willDrawCell),l.didDrawCell&&s.didDrawCell.push(l.didDrawCell),l.willDrawPage&&s.willDrawPage.push(l.willDrawPage),l.didDrawPage&&s.didDrawPage.push(l.didDrawPage)}return s}function xot(e,t){var r,n,s,o,i,l,c,d,u,f,h,m,x=WA(t.margin,40/e.scaleFactor()),g=(r=vot(e,t.startY))!==null&&r!==void 0?r:x.top,v;t.showFoot===!0?v="everyPage":t.showFoot===!1?v="never":v=(n=t.showFoot)!==null&&n!==void 0?n:"everyPage";var y;t.showHead===!0?y="everyPage":t.showHead===!1?y="never":y=(s=t.showHead)!==null&&s!==void 0?s:"everyPage";var b=(o=t.useCss)!==null&&o!==void 0?o:!1,w=t.theme||(b?"plain":"striped"),j=!!t.horizontalPageBreak,_=(i=t.horizontalPageBreakRepeat)!==null&&i!==void 0?i:null;return{includeHiddenHtml:(l=t.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:b,theme:w,startY:g,margin:x,pageBreak:(c=t.pageBreak)!==null&&c!==void 0?c:"auto",rowPageBreak:(d=t.rowPageBreak)!==null&&d!==void 0?d:"auto",tableWidth:(u=t.tableWidth)!==null&&u!==void 0?u:"auto",showHead:y,showFoot:v,tableLineWidth:(f=t.tableLineWidth)!==null&&f!==void 0?f:0,tableLineColor:(h=t.tableLineColor)!==null&&h!==void 0?h:200,horizontalPageBreak:j,horizontalPageBreakRepeat:_,horizontalPageBreakBehaviour:(m=t.horizontalPageBreakBehaviour)!==null&&m!==void 0?m:"afterAllRows"}}function vot(e,t){var r=e.getLastAutoTable(),n=e.scaleFactor(),s=e.pageNumber(),o=!1;if(r&&r.startPageNumber){var i=r.startPageNumber+r.pageNumber-1;o=i===s}return typeof t=="number"?t:(t==null||t===!1)&&o&&r?.finalY!=null?r.finalY+20/n:null}function yot(e,t,r){var n=t.head||[],s=t.body||[],o=t.foot||[];if(t.html){var i=t.includeHiddenHtml;if(r){var l=Noe(e,t.html,r,i,t.useCss)||{};n=l.head||n,s=l.body||n,o=l.foot||n}else console.error("Cannot parse html in non browser environment")}var c=t.columns||bot(n,s,o);return{columns:c,head:n,body:s,foot:o}}function bot(e,t,r){var n=e[0]||t[0]||r[0]||[],s=[];return Object.keys(n).filter(function(o){return o!=="_element"}).forEach(function(o){var i=1,l;Array.isArray(n)?l=n[parseInt(o)]:l=n[o],typeof l=="object"&&!Array.isArray(l)&&(i=l?.colSpan||1);for(var c=0;c<i;c++){var d=void 0;Array.isArray(n)?d=s.length:d=o+(c>0?"_".concat(c):"");var u={dataKey:d};s.push(u)}}),s}var yC=function(){function e(t,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=t.getDocument()}return e}(),Soe=function(e){voe(t,e);function t(r,n,s,o,i,l){var c=e.call(this,r,n,l)||this;return c.cell=s,c.row=o,c.column=i,c.section=o.section,c}return t}(yC),Coe=function(){function e(t,r){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return e.prototype.getHeadHeight=function(t){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.getFootHeight=function(t){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(t,r,n,s,o,i){for(var l=0,c=r;l<c.length;l++){var d=c[l],u=new Soe(t,this,n,s,o,i),f=d(u)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],f)return!1}return!0},e.prototype.callEndPageHooks=function(t,r){t.applyStyles(t.userStyles);for(var n=0,s=this.hooks.didDrawPage;n<s.length;n++){var o=s[n];o(new yC(t,this,r))}},e.prototype.callWillDrawPageHooks=function(t,r){for(var n=0,s=this.hooks.willDrawPage;n<s.length;n++){var o=s[n];o(new yC(t,this,r))}},e.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(s,o){return s+o.wrappedWidth},0);return r}else{var n=this.settings.margin;return t-n.left-n.right}},e}(),wF=function(){function e(t,r,n,s,o){o===void 0&&(o=!1),this.height=0,this.raw=t,t instanceof yoe&&(this.raw=t._element,this.element=t._element),this.index=r,this.section=n,this.cells=s,this.spansMultiplePages=o}return e.prototype.getMaxCellHeight=function(t){var r=this;return t.reduce(function(n,s){var o;return Math.max(n,((o=r.cells[s.index])===null||o===void 0?void 0:o.height)||0)},0)},e.prototype.hasRowSpan=function(t){var r=this;return t.filter(function(n){var s=r.cells[n.index];return s?s.rowSpan>1:!1}).length>0},e.prototype.canEntireRowFit=function(t,r){return this.getMaxCellHeight(r)<=t},e.prototype.getMinimumRowHeight=function(t,r){var n=this;return t.reduce(function(s,o){var i=n.cells[o.index];if(!i)return 0;var l=r.getLineHeight(i.styles.fontSize),c=i.padding("vertical"),d=c+l;return d>s?d:s},0)},e}(),jF=function(){function e(t,r,n){var s;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=t;var o=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,o=(s=t.content)!==null&&s!==void 0?s:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var i=o!=null?""+o:"",l=/\r\n|\r|\n/g;this.text=i.split(l)}return e.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");t=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var s=this.width-this.padding("horizontal");n=this.x+s/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:t}},e.prototype.getContentHeight=function(t,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,s=this.styles.fontSize/t*r,o=n*s+this.padding("vertical");return Math.max(o,this.styles.minCellHeight)},e.prototype.padding=function(t){var r=WA(this.styles.cellPadding,0);return t==="vertical"?r.top+r.bottom:t==="horizontal"?r.left+r.right:r[t]},e}(),Aoe=function(){function e(t,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=r,this.index=n}return e.prototype.getMaxCustomCellWidth=function(t){for(var r=0,n=0,s=t.allRows();n<s.length;n++){var o=s[n],i=o.cells[this.index];i&&typeof i.styles.cellWidth=="number"&&(r=Math.max(r,i.styles.cellWidth))}return r},e}();function wot(e,t){jot(e,t);var r=[],n=0;t.columns.forEach(function(o){var i=o.getMaxCustomCellWidth(t);i?o.width=i:(o.width=o.wrappedWidth,r.push(o)),n+=o.width});var s=t.getWidth(e.pageSize().width)-n;s&&(s=q3(r,s,function(o){return Math.max(o.minReadableWidth,o.minWidth)})),s&&(s=q3(r,s,function(o){return o.minWidth})),s=Math.abs(s),!t.settings.horizontalPageBreak&&s>.1/e.scaleFactor()&&(s=s<1?s:Math.round(s),console.warn("Of the table content, ".concat(s," units width could not fit page"))),Not(t),Sot(t,e),_ot(t)}function jot(e,t){var r=e.scaleFactor(),n=t.settings.horizontalPageBreak,s=joe(e,t);t.allRows().forEach(function(o){for(var i=0,l=t.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d){var u=t.hooks.didParseCell;t.callCellHooks(e,u,d,o,c,null);var f=d.padding("horizontal");d.contentWidth=vC(d.text,d.styles,e)+f;var h=vC(d.text.join(" ").split(/[^\S\u00A0]+/),d.styles,e);if(d.minReadableWidth=h+d.padding("horizontal"),typeof d.styles.cellWidth=="number")d.minWidth=d.styles.cellWidth,d.wrappedWidth=d.styles.cellWidth;else if(d.styles.cellWidth==="wrap"||n===!0)d.contentWidth>s?(d.minWidth=s,d.wrappedWidth=s):(d.minWidth=d.contentWidth,d.wrappedWidth=d.contentWidth);else{var m=10/r;d.minWidth=d.styles.minCellWidth||m,d.wrappedWidth=d.contentWidth,d.minWidth>d.wrappedWidth&&(d.wrappedWidth=d.minWidth)}}}}),t.allRows().forEach(function(o){for(var i=0,l=t.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d&&d.colSpan===1)c.wrappedWidth=Math.max(c.wrappedWidth,d.wrappedWidth),c.minWidth=Math.max(c.minWidth,d.minWidth),c.minReadableWidth=Math.max(c.minReadableWidth,d.minReadableWidth);else{var u=t.styles.columnStyles[c.dataKey]||t.styles.columnStyles[c.index]||{},f=u.cellWidth||u.minCellWidth;f&&typeof f=="number"&&(c.minWidth=f,c.wrappedWidth=f)}d&&(d.colSpan>1&&!c.minWidth&&(c.minWidth=d.minWidth),d.colSpan>1&&!c.wrappedWidth&&(c.wrappedWidth=d.minWidth))}})}function q3(e,t,r){for(var n=t,s=e.reduce(function(m,x){return m+x.wrappedWidth},0),o=0;o<e.length;o++){var i=e[o],l=i.wrappedWidth/s,c=n*l,d=i.width+c,u=r(i),f=d<u?u:d;t-=f-i.width,i.width=f}if(t=Math.round(t*1e10)/1e10,t){var h=e.filter(function(m){return t<0?m.width>r(m):!0});h.length&&(t=q3(h,t,r))}return t}function _ot(e){for(var t={},r=1,n=e.allRows(),s=0;s<n.length;s++)for(var o=n[s],i=0,l=e.columns;i<l.length;i++){var c=l[i],d=t[c.index];if(r>1)r--,delete o.cells[c.index];else if(d)d.cell.height+=o.height,r=d.cell.colSpan,delete o.cells[c.index],d.left--,d.left<=1&&delete t[c.index];else{var u=o.cells[c.index];if(!u)continue;if(u.height=o.height,u.rowSpan>1){var f=n.length-s,h=u.rowSpan>f?f:u.rowSpan;t[c.index]={cell:u,left:h,row:o}}}}}function Not(e){for(var t=e.allRows(),r=0;r<t.length;r++)for(var n=t[r],s=null,o=0,i=0,l=0;l<e.columns.length;l++){var c=e.columns[l];if(i-=1,i>1&&e.columns[l+1])o+=c.width,delete n.cells[c.index];else if(s){var d=s;delete n.cells[c.index],s=null,d.width=c.width+o}else{var d=n.cells[c.index];if(!d)continue;if(i=d.colSpan,o=0,d.colSpan>1){s=d,o+=c.width;continue}d.width=c.width+o}}}function Sot(e,t){for(var r={count:0,height:0},n=0,s=e.allRows();n<s.length;n++){for(var o=s[n],i=0,l=e.columns;i<l.length;i++){var c=l[i],d=o.cells[c.index];if(d){t.applyStyles(d.styles,!0);var u=d.width-d.padding("horizontal");if(d.styles.overflow==="linebreak")d.text=t.splitTextToSize(d.text,u+1/t.scaleFactor(),{fontSize:d.styles.fontSize});else if(d.styles.overflow==="ellipsize")d.text=gV(d.text,u,d.styles,t,"...");else if(d.styles.overflow==="hidden")d.text=gV(d.text,u,d.styles,t,"");else if(typeof d.styles.overflow=="function"){var f=d.styles.overflow(d.text,u);typeof f=="string"?d.text=[f]:d.text=f}d.contentHeight=d.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var h=d.contentHeight/d.rowSpan;d.rowSpan>1&&r.count*r.height<h*d.rowSpan?r={height:h,count:d.rowSpan}:r&&r.count>0&&r.height>h&&(h=r.height),h>o.height&&(o.height=h)}}r.count--}}function gV(e,t,r,n,s){return e.map(function(o){return Cot(o,t,r,n,s)})}function Cot(e,t,r,n,s){var o=1e4*n.scaleFactor();if(t=Math.ceil(t*o)/o,t>=vC(e,r,n))return e;for(;t<vC(e+s,r,n)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+s}function _F(e,t){var r=new e0(e),n=Aot(t,r.scaleFactor()),s=new Coe(t,n);return wot(r,s),r.applyStyles(r.userStyles),s}function Aot(e,t){var r=e.content,n=Eot(r.columns);if(r.head.length===0){var s=xV(n,"head");s&&r.head.push(s)}if(r.foot.length===0){var s=xV(n,"foot");s&&r.foot.push(s)}var o=e.settings.theme,i=e.styles;return{columns:n,head:Rk("head",r.head,n,i,o,t),body:Rk("body",r.body,n,i,o,t),foot:Rk("foot",r.foot,n,i,o,t)}}function Rk(e,t,r,n,s,o){var i={},l=t.map(function(c,d){for(var u=0,f={},h=0,m=0,x=0,g=r;x<g.length;x++){var v=g[x];if(i[v.index]==null||i[v.index].left===0)if(m===0){var y=void 0;Array.isArray(c)?y=c[v.index-h-u]:y=c[v.dataKey];var b={};typeof y=="object"&&!Array.isArray(y)&&(b=y?.styles||{});var w=kot(e,v,d,s,n,o,b),j=new jF(y,w,e);f[v.dataKey]=j,f[v.index]=j,m=j.colSpan-1,i[v.index]={left:j.rowSpan-1,times:m}}else m--,h++;else i[v.index].left--,m=i[v.index].times,u++}return new wF(c,d,e,f)});return l}function xV(e,t){var r={};return e.forEach(function(n){if(n.raw!=null){var s=Pot(t,n.raw);s!=null&&(r[n.dataKey]=s)}}),Object.keys(r).length>0?r:null}function Pot(e,t){if(e==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(e==="foot"&&typeof t=="object")return t.footer;return null}function Eot(e){return e.map(function(t,r){var n,s;return typeof t=="object"?s=(n=t.dataKey)!==null&&n!==void 0?n:r:s=r,new Aoe(s,t,r)})}function kot(e,t,r,n,s,o,i){var l=lot(n),c;e==="head"?c=s.headStyles:e==="body"?c=s.bodyStyles:e==="foot"&&(c=s.footStyles);var d=Am({},l.table,l[e],s.styles,c),u=s.columnStyles[t.dataKey]||s.columnStyles[t.index]||{},f=e==="body"?u:{},h=e==="body"&&r%2===0?Am({},l.alternateRow,s.alternateRowStyles):{},m=iot(o),x=Am({},m,d,h,f);return Am(x,i)}function Iot(e,t,r){var n;r===void 0&&(r={});var s=joe(e,t),o=new Map,i=[],l=[],c=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?c=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(c=[t.settings.horizontalPageBreakRepeat]),c.forEach(function(h){var m=t.columns.find(function(x){return x.dataKey===h||x.index===h});m&&!o.has(m.index)&&(o.set(m.index,!0),i.push(m.index),l.push(t.columns[m.index]),s-=m.wrappedWidth)});for(var d=!0,u=(n=r?.start)!==null&&n!==void 0?n:0;u<t.columns.length;){if(o.has(u)){u++;continue}var f=t.columns[u].wrappedWidth;if(d||s>=f)d=!1,i.push(u),l.push(t.columns[u]),s-=f;else break;u++}return{colIndexes:i,columns:l,lastIndex:u-1}}function Oot(e,t){for(var r=[],n=0;n<t.columns.length;n++){var s=Iot(e,t,{start:n});s.columns.length&&(r.push(s),n=s.lastIndex)}return r}function NF(e,t){var r=t.settings,n=r.startY,s=r.margin,o={x:s.left,y:n},i=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),l=n+s.bottom+i;if(r.pageBreak==="avoid"){var c=t.body,d=c.reduce(function(h,m){return h+m.height},0);l+=d}var u=new e0(e);(r.pageBreak==="always"||r.startY!=null&&l>u.pageSize().height)&&(Eoe(u),o.y=s.top),t.callWillDrawPageHooks(u,o);var f=Am({},o);t.startPageNumber=u.pageNumber(),r.horizontalPageBreak?Tot(u,t,f,o):(u.applyStyles(u.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&t.head.forEach(function(h){return Hm(u,t,h,o,t.columns)}),u.applyStyles(u.userStyles),t.body.forEach(function(h,m){var x=m===t.body.length-1;bC(u,t,h,x,f,o,t.columns)}),u.applyStyles(u.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&t.foot.forEach(function(h){return Hm(u,t,h,o,t.columns)})),boe(u,t,f,o),t.callEndPageHooks(u,o),t.finalY=o.y,e.lastAutoTable=t,u.applyStyles(u.userStyles)}function Tot(e,t,r,n){var s=Oot(e,t),o=t.settings;if(o.horizontalPageBreakBehaviour==="afterAllRows")s.forEach(function(d,u){e.applyStyles(e.userStyles),u>0?mw(e,t,r,n,d.columns,!0):vV(e,t,n,d.columns),Dot(e,t,r,n,d.columns),Fk(e,t,n,d.columns)});else for(var i=-1,l=s[0],c=function(){var d=i;if(l){e.applyStyles(e.userStyles);var u=l.columns;i>=0?mw(e,t,r,n,u,!0):vV(e,t,n,u),d=yV(e,t,i+1,n,u),Fk(e,t,n,u)}var f=d-i;s.slice(1).forEach(function(h){e.applyStyles(e.userStyles),mw(e,t,r,n,h.columns,!0),yV(e,t,i+1,n,h.columns,f),Fk(e,t,n,h.columns)}),i=d};i<t.body.length-1;)c()}function vV(e,t,r,n){var s=t.settings;e.applyStyles(e.userStyles),(s.showHead==="firstPage"||s.showHead==="everyPage")&&t.head.forEach(function(o){return Hm(e,t,o,r,n)})}function Dot(e,t,r,n,s){e.applyStyles(e.userStyles),t.body.forEach(function(o,i){var l=i===t.body.length-1;bC(e,t,o,l,r,n,s)})}function yV(e,t,r,n,s,o){e.applyStyles(e.userStyles),o=o??t.body.length;var i=Math.min(r+o,t.body.length),l=-1;return t.body.slice(r,i).forEach(function(c,d){var u=r+d===t.body.length-1,f=Poe(e,t,u,n);c.canEntireRowFit(f,s)&&(Hm(e,t,c,n,s),l=r+d)}),l}function Fk(e,t,r,n){var s=t.settings;e.applyStyles(e.userStyles),(s.showFoot==="lastPage"||s.showFoot==="everyPage")&&t.foot.forEach(function(o){return Hm(e,t,o,r,n)})}function Mot(e,t,r){var n=r.getLineHeight(e.styles.fontSize),s=e.padding("vertical"),o=Math.floor((t-s)/n);return Math.max(0,o)}function Rot(e,t,r,n){var s={};e.spansMultiplePages=!0,e.height=0;for(var o=0,i=0,l=r.columns;i<l.length;i++){var c=l[i],d=e.cells[c.index];if(d){Array.isArray(d.text)||(d.text=[d.text]);var u=new jF(d.raw,d.styles,d.section);u=Am(u,d),u.text=[];var f=Mot(d,t,n);d.text.length>f&&(u.text=d.text.splice(f,d.text.length));var h=n.scaleFactor(),m=n.getLineHeightFactor();d.contentHeight=d.getContentHeight(h,m),d.contentHeight>=t&&(d.contentHeight=t,u.styles.minCellHeight-=t),d.contentHeight>e.height&&(e.height=d.contentHeight),u.contentHeight=u.getContentHeight(h,m),u.contentHeight>o&&(o=u.contentHeight),s[c.index]=u}}var x=new wF(e.raw,-1,e.section,s,!0);x.height=o;for(var g=0,v=r.columns;g<v.length;g++){var c=v[g],u=x.cells[c.index];u&&(u.height=x.height);var d=e.cells[c.index];d&&(d.height=e.height)}return x}function Fot(e,t,r,n){var s=e.pageSize().height,o=n.settings.margin,i=o.top+o.bottom,l=s-i;t.section==="body"&&(l-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var c=t.getMinimumRowHeight(n.columns,e),d=c<r;if(c>l)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!d)return!1;var u=t.hasRowSpan(n.columns),f=t.getMaxCellHeight(n.columns)>l;return f?(u&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(u||n.settings.rowPageBreak==="avoid")}function bC(e,t,r,n,s,o,i){var l=Poe(e,t,n,o);if(r.canEntireRowFit(l,i))Hm(e,t,r,o,i);else if(Fot(e,r,l,t)){var c=Rot(r,l,t,e);Hm(e,t,r,o,i),mw(e,t,s,o,i),bC(e,t,c,n,s,o,i)}else mw(e,t,s,o,i),bC(e,t,r,n,s,o,i)}function Hm(e,t,r,n,s){n.x=t.settings.margin.left;for(var o=0,i=s;o<i.length;o++){var l=i[o],c=r.cells[l.index];if(!c){n.x+=l.width;continue}e.applyStyles(c.styles),c.x=n.x,c.y=n.y;var d=t.callCellHooks(e,t.hooks.willDrawCell,c,r,l,n);if(d===!1){n.x+=l.width;continue}Lot(e,c,n);var u=c.getTextPos();xoe(c.text,u.x,u.y,{halign:c.styles.halign,valign:c.styles.valign,maxWidth:Math.ceil(c.width-c.padding("left")-c.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,c,r,l,n),n.x+=l.width}n.y+=r.height}function Lot(e,t,r){var n=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),typeof n.lineWidth=="number"){var s=woe(n.lineWidth,n.fillColor);s&&e.rect(t.x,r.y,t.width,t.height,s)}else typeof n.lineWidth=="object"&&(n.fillColor&&e.rect(t.x,r.y,t.width,t.height,"F"),$ot(e,t,r,n.lineWidth))}function $ot(e,t,r,n){var s,o,i,l;n.top&&(s=r.x,o=r.y,i=r.x+t.width,l=r.y,n.right&&(i+=.5*n.right),n.left&&(s-=.5*n.left),c(n.top,s,o,i,l)),n.bottom&&(s=r.x,o=r.y+t.height,i=r.x+t.width,l=r.y+t.height,n.right&&(i+=.5*n.right),n.left&&(s-=.5*n.left),c(n.bottom,s,o,i,l)),n.left&&(s=r.x,o=r.y,i=r.x,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.left,s,o,i,l)),n.right&&(s=r.x+t.width,o=r.y,i=r.x+t.width,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.right,s,o,i,l));function c(d,u,f,h,m){e.getDocument().setLineWidth(d),e.getDocument().line(u,f,h,m,"S")}}function Poe(e,t,r,n){var s=t.settings.margin.bottom,o=t.settings.showFoot;return(o==="everyPage"||o==="lastPage"&&r)&&(s+=t.getFootHeight(t.columns)),e.pageSize().height-n.y-s}function mw(e,t,r,n,s,o){s===void 0&&(s=[]),o===void 0&&(o=!1),e.applyStyles(e.userStyles),t.settings.showFoot==="everyPage"&&!o&&t.foot.forEach(function(l){return Hm(e,t,l,n,s)}),t.callEndPageHooks(e,n);var i=t.settings.margin;boe(e,t,r,n),Eoe(e),t.pageNumber++,n.x=i.left,n.y=i.top,r.y=i.top,t.callWillDrawPageHooks(e,n),t.settings.showHead==="everyPage"&&(t.head.forEach(function(l){return Hm(e,t,l,n,s)}),e.applyStyles(e.userStyles))}function Eoe(e){var t=e.pageNumber();e.setPage(t+1);var r=e.pageNumber();return r===t?(e.addPage(),!0):!1}function koe(e){e.API.autoTable=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0],s=bF(this,n),o=_F(this,s);return NF(this,o),this},e.API.lastAutoTable=!1,e.API.autoTableText=function(t,r,n,s){xoe(t,r,n,s,this)},e.API.autoTableSetDefaults=function(t){return e0.setDefaults(t,this),this},e.autoTableSetDefaults=function(t,r){e0.setDefaults(t,r)},e.API.autoTableHtmlToJson=function(t,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var s=new e0(this),o=Noe(s,t,window,r,!1),i=o.head,l=o.body,c=((n=i[0])===null||n===void 0?void 0:n.map(function(d){return d.content}))||[];return{columns:c,rows:l,data:l}}}var Lk;function bV(e,t){var r=bF(e,t),n=_F(e,r);NF(e,n)}function Bot(e,t){var r=bF(e,t);return _F(e,r)}function qot(e,t){NF(e,t)}try{if(typeof window<"u"&&window){var wV=window,jV=wV.jsPDF||((Lk=wV.jspdf)===null||Lk===void 0?void 0:Lk.jsPDF);jV&&koe(jV)}}catch(e){console.error("Could not apply autoTable plugin",e)}const zot=Object.freeze(Object.defineProperty({__proto__:null,Cell:jF,CellHookData:Soe,Column:Aoe,HookData:yC,Row:wF,Table:Coe,__createTable:Bot,__drawTable:qot,applyPlugin:koe,autoTable:bV,default:bV},Symbol.toStringTag,{value:"Module"})),Uot={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.08,delayChildren:.1}}},sc={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};function o2({icon:e,label:t,value:r,delta:n,positive:s=!0,color:o="brand"}){return a.jsxs(Fr.div,{variants:sc,className:"fx-card border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(e,{className:`w-4 h-4 text-${o}`}),a.jsx("span",{children:t})]}),n!=null&&a.jsxs("div",{className:`text-xs font-bold ${s?"text-success":"text-danger"}`,children:[s?"+":"",n]})]}),a.jsx("div",{className:"text-3xl font-bold text-text-primary tabular-nums",children:r})]})}function Vot(){const{userProfile:e}=lo(),{toast:t}=Zs(),[r,n]=qC(),s=p.useMemo(()=>{try{return typeof window<"u"&&localStorage.getItem("debug:financeiro")==="1"}catch{return!1}},[]),o=p.useCallback((...ee)=>{if(s)try{console.log("[FinanceiroDbg]",...ee)}catch{}},[s]),[i,l]=p.useState(r.get("tab")||"visao-geral"),[c,d]=p.useState(!1),[u,f]=p.useState(()=>{const ee=new Date;return new Date(ee.getFullYear(),ee.getMonth(),1).toISOString().slice(0,10)}),[h,m]=p.useState(()=>new Date().toISOString().slice(0,10)),[x,g]=p.useState(null),[v,y]=p.useState(0),[b,w]=p.useState(0),[j,_]=p.useState([]),[C,E]=p.useState([]),[S,A]=p.useState([]),[M,O]=p.useState([]),[I,T]=p.useState([]),[k,q]=p.useState(0),[B,z]=p.useState(0),[F,V]=p.useState(!1),[me,be]=p.useState(!1),[U,L]=p.useState(null),[H,ie]=p.useState([]),[Y,W]=p.useState(!1),[se,pe]=p.useState(!1),[G,te]=p.useState(!1),[oe,De]=p.useState(null),[re,ae]=p.useState([]),[ut,pt]=p.useState([]);p.useState({open:!1,tipo:"suprimento",valor:"",observacao:"",loading:!1});const[ft,bt]=p.useState(!1),[Lt,Dt]=p.useState(!1),[Bt,ge]=p.useState(null),[wt,Gt]=p.useState([]),[Sr,wr]=p.useState(""),[he,ot]=p.useState("all"),[Vt,qt]=p.useState("all"),[Re,Ct]=p.useState([]),[Wt,Er]=p.useState(""),[Me,lt]=p.useState("all"),[gt,or]=p.useState("all"),[br,ur]=p.useState(new Set),[an,zr]=p.useState(!1),[Gr,ha]=p.useState(!1),[pn,on]=p.useState(null),[cn,ke]=p.useState([]),[We,Ze]=p.useState(!1),[Je,At]=p.useState([]);p.useState("");const Ye=ee=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(ee||0)),lr=ee=>Number(ee||0).toFixed(2),ce=async(ee,Ie,Oe,Yt)=>{try{const{default:Pt}=await zf(()=>Promise.resolve().then(()=>jZe),void 0);await zf(()=>Promise.resolve().then(()=>zot),void 0);const Qt=new Pt("p","mm","a4"),nr=Qt.internal.pageSize.getWidth();if(Qt.setFontSize(20),Qt.setTextColor(245,158,11),Qt.text(ee,14,20),Qt.setDrawColor(245,158,11),Qt.setLineWidth(.5),Qt.line(14,23,nr-14,23),Qt.setFontSize(10),Qt.setTextColor(100,100,100),Qt.text(`Perodo: ${u||"N/A"} at ${h||"N/A"}`,14,30),Qt.text(`Gerado em: ${new Date().toLocaleString("pt-BR")}`,14,35),typeof Qt.autoTable=="function"){Qt.autoTable({head:[Ie],body:Oe,startY:42,theme:"striped",headStyles:{fillColor:[245,158,11],textColor:[255,255,255],fontStyle:"bold",fontSize:11},bodyStyles:{fontSize:10,textColor:[50,50,50]},alternateRowStyles:{fillColor:[249,249,249]},margin:{top:42,left:14,right:14}});const fn=Qt.lastAutoTable.finalY||50;Qt.setFontSize(8),Qt.setTextColor(150,150,150),Qt.text("Relatrio gerado por Fluxo7Arena - Sistema de Gesto de Quadras Esportivas",nr/2,fn+15,{align:"center"})}else{let fn=45;Qt.setFontSize(11),Qt.setTextColor(0,0,0),Ie.forEach((J,Xe)=>{const He=14+Xe*60;Qt.text(J,He,fn)}),fn+=7,Qt.setFontSize(10),Oe.forEach(J=>{J.forEach((Xe,He)=>{const fe=14+He*60;Qt.text(String(Xe),fe,fn)}),fn+=6})}Qt.save(`${Yt}_${dr(new Date,"yyyy-MM-dd")}.pdf`),t({title:"PDF baixado com sucesso!",description:"O arquivo foi salvo na sua pasta de downloads"})}catch(Pt){console.error("Erro ao gerar PDF:",Pt),t({title:"Erro ao gerar PDF",description:Pt.message,variant:"destructive"})}},qe=async()=>{try{const ee=["Abertura","Fechamento","Saldo Inicial","Saldo Final","Valor Final (Dinheiro)","Diferena","Status"],Ie=(ut||[]).map(Oe=>[Oe?.aberto_em?new Date(Oe.aberto_em).toLocaleString("pt-BR"):"-",Oe?.fechado_em?new Date(Oe.fechado_em).toLocaleString("pt-BR"):"-",Ye(Oe?.saldo_inicial||0),Oe?.saldo_final!=null?Ye(Oe.saldo_final):Ye(0),Oe?.valor_final_dinheiro!=null?Ye(Oe.valor_final_dinheiro):"",Oe?.diferenca_dinheiro!=null?Ye(Oe.diferenca_dinheiro):"",String(Oe?.status||"").toUpperCase()]);await ce("Fechamentos de Caixa",ee,Ie,"fechamentos_caixa")}catch(ee){t({title:"Erro ao exportar PDF",description:ee?.message||"Tente novamente",variant:"destructive"})}},ze=()=>{try{const ee=";",Oe=[["Abertura","Fechamento","Saldo Inicial","Saldo Final","Valor Final (Dinheiro)","Diferena","Status"].join(ee)];(ut||[]).forEach(nr=>{const fn=nr?.aberto_em?new Date(nr.aberto_em).toLocaleString("pt-BR"):"-",J=nr?.fechado_em?new Date(nr.fechado_em).toLocaleString("pt-BR"):"-",Xe=Number(nr?.saldo_inicial||0).toFixed(2).replace(".",","),He=(nr?.saldo_final!=null?Number(nr.saldo_final):0).toFixed(2).replace(".",","),fe=nr?.valor_final_dinheiro!=null?Number(nr.valor_final_dinheiro):null,Ve=nr?.diferenca_dinheiro!=null?Number(nr.diferenca_dinheiro):null,xe=String(nr?.status||"").toUpperCase();Oe.push([fn,J,Xe,He,fe!=null?fe.toFixed(2).replace(".",","):"",Ve!=null?Ve.toFixed(2).replace(".",","):"",xe].join(ee))});const Yt=new Blob(["\uFEFF"+Oe.join(`
`)],{type:"text/csv;charset=utf-8;"}),Pt=URL.createObjectURL(Yt),Qt=document.createElement("a");Qt.href=Pt,Qt.download=`fechamentos_caixa_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(Qt),Qt.click(),document.body.removeChild(Qt),URL.revokeObjectURL(Pt),t({title:"CSV baixado com sucesso!"})}catch(ee){t({title:"Erro ao exportar CSV",description:ee?.message||"Tente novamente",variant:"destructive"})}},xt=({cx:ee,cy:Ie,midAngle:Oe,outerRadius:Yt,percent:Pt})=>{const Qt=Math.PI/180,nr=(Yt||0)+12,fn=ee+nr*Math.cos(-Oe*Qt),J=Ie+nr*Math.sin(-Oe*Qt);return a.jsx("text",{x:fn,y:J,fill:"#fff",textAnchor:fn>ee?"start":"end",dominantBaseline:"central",style:{pointerEvents:"none",fontSize:15,fontWeight:700},children:`${Math.round((Pt||0)*100)}%`})},rr=ee=>{const Ie=cr!=null&&cr!==ee;return{transition:"opacity 320ms ease-in-out, filter 320ms ease-in-out",opacity:Ie?.25:1,filter:Ie?"grayscale(15%)":"none",cursor:"pointer"}};p.useEffect(()=>{(async()=>{if(!Gr||!pn||pn.origem!=="Comanda"||!pn.comanda_id){ke([]),At([]);return}try{Ze(!0);const Ie=e?.codigo_empresa;let Oe=Q.from("comanda_itens").select("descricao, quantidade, preco_unitario").eq("comanda_id",pn.comanda_id);Ie&&(Oe=Oe.eq("codigo_empresa",Ie));const{data:Yt}=await Oe;ke(Yt||[]);let Pt=Q.from("pagamentos").select("id, valor, metodo, status, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").eq("comanda_id",pn.comanda_id);Ie&&(Pt=Pt.eq("codigo_empresa",Ie));const{data:Qt}=await Pt;At(Qt||[])}catch(Ie){console.warn("[Financeiro][RecebimentoModal] Falha ao carregar itens da comanda:",Ie?.message),ke([]),At([])}finally{Ze(!1)}})()},[Gr,pn,e?.codigo_empresa]);const ir=async()=>{try{d(!0);const ee=ia(u)||void 0,Ie=Kn(h)||void 0,Oe=e?.codigo_empresa;console.debug("[Financeiro][VisaoGeral] Carregando com perodo:",{fromISO:ee,toISO:Ie,codigo:Oe});const Yt=await fu({from:ee,to:Ie}).catch(()=>null);g(Yt||{totalPorFinalizadora:{},totalEntradas:0,totalVendasBrutas:0,totalDescontos:0,totalVendasLiquidas:0}),console.debug("[Financeiro][VisaoGeral] Resumo calculado:",Yt);try{let Pt=Q.from("pagamentos").select("valor, status").eq("codigo_empresa",Oe);ee&&(Pt=Pt.gte("recebido_em",ee)),Ie&&(Pt=Pt.lte("recebido_em",Ie));const{data:Qt}=await Pt,nr=(Qt||[]).reduce((He,fe)=>{const Ve=fe.status||"Pago";return Ve==="Cancelado"||Ve==="Estornado"?He:He+Number(fe.valor||0)},0);y(nr);let fn=Q.from("agendamentos").select("id").eq("codigo_empresa",Oe);ee&&(fn=fn.gte("inicio",ee)),Ie&&(fn=fn.lte("inicio",Ie));const{data:J}=await fn;let Xe=0;if(J&&J.length>0){const He=J.map(Ve=>Ve.id),{data:fe}=await Q.from("agendamento_participantes").select("valor_cota, aplicar_taxa, finalizadoras!agp_finalizadora_id_fkey(taxa_percentual)").eq("codigo_empresa",Oe).in("agendamento_id",He).eq("status_pagamento","Pago");Xe=(fe||[]).reduce((Ve,xe)=>{let kt=Number(xe.valor_cota||0);if(xe.aplicar_taxa===!0){const st=Number(xe.finalizadoras?.taxa_percentual||0);st>0&&(kt=kt/(1+st/100))}return Ve+kt},0)}w(Xe),console.debug("[Financeiro][VisaoGeral] Receitas por origem:",{totalComandas:nr,totalAg:Xe})}catch(Pt){console.warn("[Financeiro][VisaoGeral] Falha ao calcular KPIs por origem:",Pt?.message),y(0),w(0)}try{let Pt=Q.from("pagamentos").select("valor, status, origem").eq("codigo_empresa",Oe).eq("origem","xml");ee&&(Pt=Pt.gte("recebido_em",ee)),Ie&&(Pt=Pt.lte("recebido_em",Ie));const{data:Qt}=await Pt,nr=(Qt||[]).reduce((J,Xe)=>["Cancelado","Estornado"].includes(Xe.status)?J:J+Number(Xe.valor||0),0);q(nr);const{count:fn}=await Q.from("produtos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",Oe).or("importado_via_xml.is.true,categoria.ilike.Importados").gte("criado_em",ee).lte("criado_em",Ie);z(fn||0)}catch(Pt){console.warn("[Financeiro][VisaoGeral] Falha KPIs XML:",Pt?.message),q(0),z(0)}if(Oe){let Pt=Q.from("comandas").select("id").eq("status","closed");Oe&&(Pt=Pt.eq("codigo_empresa",Oe)),ee&&(Pt=Pt.gte("fechado_em",ee)),Ie&&(Pt=Pt.lte("fechado_em",Ie));const{data:Qt,error:nr}=await Pt;if(nr)throw nr;const fn=(Qt||[]).map(fe=>fe.id);console.debug("[Financeiro][VisaoGeral] Comandas fechadas:",fn.length);let J=[];if(fn.length>0){let fe=Q.from("comanda_itens").select("produto_id, quantidade, preco_unitario, produtos!comanda_itens_produto_id_fkey(nome)").in("comanda_id",fn);Oe&&(fe=fe.eq("codigo_empresa",Oe));const{data:Ve}=await fe;J=Ve||[]}const Xe={};(J||[]).forEach(fe=>{const Ve=fe.produtos?.nome||"Produto sem nome",xe=Number(fe.quantidade||0),kt=xe*Number(fe.preco_unitario||0);Xe[Ve]||(Xe[Ve]={quantidade:0,valor:0}),Xe[Ve].quantidade+=xe,Xe[Ve].valor+=kt});const He=Object.entries(Xe).map(([fe,Ve])=>({nome:fe,quantidade:Ve.quantidade,valor:Ve.valor})).sort((fe,Ve)=>Ve.valor-fe.valor);A(He),_(He.slice(0,5)),console.debug("[Financeiro][VisaoGeral] Produtos agregados:",{total:He.length,top5:He.slice(0,5)})}if(Oe)try{let Pt=Q.from("pagamentos").select("comanda_id, valor, status").eq("codigo_empresa",Oe).neq("status","Cancelado").neq("status","Estornado");ee&&(Pt=Pt.gte("recebido_em",ee)),Ie&&(Pt=Pt.lte("recebido_em",Ie));const{data:Qt}=await Pt;console.debug("[Financeiro][VisaoGeral] Pagamentos carregados:",(Qt||[]).length);const nr=Array.from(new Set((Qt||[]).map(xe=>xe.comanda_id).filter(Boolean)));let fn=[];if(nr.length>0){let xe=Q.from("comanda_clientes").select("comanda_id, cliente_id, nome_livre").in("comanda_id",nr).eq("codigo_empresa",Oe);const{data:kt}=await xe;fn=kt||[]}console.debug("[Financeiro][VisaoGeral] Vinculos comanda_clientes:",fn.length);const J=Array.from(new Set(fn.map(xe=>xe.cliente_id).filter(Boolean))),Xe={};if(J.length>0){const{data:xe}=await Q.from("clientes").select("id, nome").in("id",J).eq("codigo_empresa",Oe);(xe||[]).forEach(kt=>{Xe[kt.id]=kt.nome})}const He={};fn.forEach(xe=>{const kt=xe.nome_livre||Xe[xe.cliente_id]||`Cliente ${xe.cliente_id||""}`;He[xe.comanda_id]||(He[xe.comanda_id]=new Set),kt&&He[xe.comanda_id].add(kt)});const fe={};(Qt||[]).forEach(xe=>{const kt=Array.from(He[xe.comanda_id]||[]),st=Number(xe.valor||0);if(kt.length===0){const zt="Sem cliente";fe[zt]||(fe[zt]={id:null,nome:zt,valor:0}),fe[zt].valor+=st}else kt.forEach(zt=>{fe[zt]||(fe[zt]={id:null,nome:zt,valor:0}),fe[zt].valor+=st})});try{const xe=new Map(Object.values(Xe).map((Nr,xn)=>[Object.keys(Xe)[xn],Nr]));let kt=Q.from("v_agendamento_participantes").select("agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text");Oe&&(kt=kt.eq("codigo_empresa",Oe));let{data:st}=await kt;st=st||[];const zt=Array.from(new Set(st.map(Nr=>Nr.agendamento_id).filter(Boolean)));let pr=new Set;if(zt.length>0){let Nr=Q.from("agendamentos").select("id, inicio").in("id",zt);Oe&&(Nr=Nr.eq("codigo_empresa",Oe));const{data:xn}=await Nr,Dn=ee?new Date(ee).getTime():null,Pa=Ie?new Date(Ie).getTime():null;(xn||[]).forEach(Aa=>{const Na=Aa?.inicio?new Date(Aa.inicio).getTime():null;Na!=null&&(Dn==null||Na>=Dn)&&(Pa==null||Na<=Pa)&&pr.add(Aa.id)})}const en=st.filter(Nr=>pr.has(Nr.agendamento_id));console.debug("[Financeiro][Agendamentos] participantes no perodo (by agendamento.inicio):",en.length);const la=Array.from(new Set((en||[]).map(Nr=>Nr.cliente_id).filter(Boolean).map(String))).filter(Nr=>!xe.has(Nr));if(la.length>0){const{data:Nr}=await Q.from("clientes").select("id,nome").in("id",la);(Nr||[]).forEach(xn=>xe.set(String(xn.id),xn.nome))}(en||[]).forEach(Nr=>{const xn=String(Nr.status_pagamento||Nr.status_pagamento_text||"pago").toLowerCase();if(["cancelado","estornado"].includes(xn))return;const Dn=Nr.cliente_id,Pa=Dn?xe.get(String(Dn))||`Cliente ${Dn}`:null;if(!Pa)return;const Aa=Number(Nr.valor_cota||0);fe[Pa]||(fe[Pa]={id:Dn||null,nome:Pa,valor:0}),fe[Pa].valor+=Aa})}catch{}const Ve=Object.values(fe).sort((xe,kt)=>kt.valor-xe.valor);O(Ve),E(Ve.slice(0,5)),console.debug("[Financeiro][VisaoGeral] Clientes agregados:",{total:Ve.length,top5:Ve.slice(0,5)})}catch(Pt){console.error("Erro ao carregar top clientes:",Pt),E([]),O([])}if(Oe&&ee&&Ie)try{let Pt=Q.from("pagamentos").select("recebido_em, valor, status").eq("codigo_empresa",Oe).gte("recebido_em",ee).lte("recebido_em",Ie).order("recebido_em",{ascending:!0});const{data:Qt}=await Pt;let nr=Q.from("v_agendamentos_detalhado").select("inicio, valor_pago, status_pagamento").eq("codigo_empresa",Oe).eq("status_pagamento","Pago").gte("inicio",ee).lte("inicio",Ie).order("inicio",{ascending:!0});const{data:fn}=await nr,J={};(Qt||[]).forEach(He=>{if(["Cancelado","Estornado"].includes(He.status))return;const fe=new Date(He.recebido_em).toLocaleDateString("pt-BR");J[fe]=(J[fe]||0)+Number(He.valor||0)}),(fn||[]).forEach(He=>{const fe=new Date(He.inicio).toLocaleDateString("pt-BR");J[fe]=(J[fe]||0)+Number(He.valor_pago||0)});const Xe=Object.entries(J).map(([He,fe])=>({data:He,valor:fe})).sort((He,fe)=>{const[Ve,xe,kt]=He.data.split("/").map(Number),[st,zt,pr]=fe.data.split("/").map(Number);return new Date(kt,xe-1,Ve).getTime()-new Date(pr,zt-1,st).getTime()});T(Xe),console.debug("[Financeiro][VisaoGeral] Evoluo diria:",Xe.length,"dias")}catch(Pt){console.warn("[Financeiro][VisaoGeral] Falha ao calcular evoluo diria:",Pt?.message),T([])}else T([])}catch(ee){t({title:"Falha ao carregar viso geral",description:ee?.message||"Tente novamente",variant:"destructive"})}finally{d(!1)}},Kr=async()=>{try{const ee=e?.codigo_empresa,Ie=await $h({codigoEmpresa:ee});if(te(!!Ie),Ie){const[Yt,Pt]=await Promise.all([P1({codigoEmpresa:ee}),Fg({caixaSessaoId:Ie.id,codigoEmpresa:ee})]);De(Yt||null),ae(Pt||[])}else De(null),ae([]);const Oe=await cne({limit:50,codigoEmpresa:ee});if(console.log("[FinanceiroPage][loadCaixa] Histrico recebido de listarFechamentosCaixa:",Oe?.length,"sesses"),Oe&&Oe.length>0){console.log("[FinanceiroPage][loadCaixa] Primeira sesso do histrico:",Oe[0]);const Yt=Oe.filter(Pt=>Pt.valor_final_dinheiro!=null);console.log("[FinanceiroPage][loadCaixa] Sesses com valor_final_dinheiro:",Yt.length,"/",Oe.length)}pt(Oe||[])}catch(ee){t({title:"Falha ao carregar caixa",description:ee?.message,variant:"destructive"})}},jr=async()=>{try{d(!0);const ee=e?.codigo_empresa,Ie=ia(u)||void 0,Oe=Kn(h)||void 0;let Yt=Q.from("pagamentos").select("id, comanda_id, valor, status, metodo, recebido_em, origem, xml_chave, finalizadoras!pagamentos_finalizadora_id_fkey(nome)").eq("codigo_empresa",ee).order("recebido_em",{ascending:!1});Ie&&(Yt=Yt.gte("recebido_em",Ie)),Oe&&(Yt=Yt.lte("recebido_em",Oe));const{data:Pt}=await Yt;let Qt=new Map,nr=new Map;try{const fe=Array.from(new Set((Pt||[]).map(Ve=>Ve.comanda_id).filter(Boolean)));if(fe.length>0){const{data:Ve}=await Q.from("comandas").select("id, cliente_id, tipo").in("id",fe).eq("codigo_empresa",ee),xe=Array.from(new Set((Ve||[]).map(zt=>zt.cliente_id).filter(Boolean)));let kt=new Map;if(xe.length>0){const{data:zt}=await Q.from("clientes").select("id, nome").in("id",xe).eq("codigo_empresa",ee);kt=new Map((zt||[]).map(pr=>[pr.id,pr.nome]))}for(const zt of Ve||[]){if(!zt)continue;const pr=kt.get(zt.cliente_id)||null;Qt.set(zt.id,pr),nr.set(zt.id,zt.tipo||null)}const st=(Ve||[]).filter(zt=>!zt?.cliente_id).map(zt=>zt.id);if(st.length>0)try{const{data:zt}=await Q.from("comanda_clientes").select("comanda_id, cliente_id").in("comanda_id",st).eq("codigo_empresa",ee),pr=Array.from(new Set((zt||[]).map(en=>en.cliente_id).filter(Boolean)));if(pr.length>0){const{data:en}=await Q.from("clientes").select("id, nome").in("id",pr).eq("codigo_empresa",ee),sn=new Map((en||[]).map(la=>[la.id,la.nome]));for(const la of zt||[]){const Nr=sn.get(la.cliente_id)||null;Nr&&!Qt.get(la.comanda_id)&&Qt.set(la.comanda_id,Nr)}}}catch{console.debug("[Financeiro][Recebimentos] comanda_clientes indisponvel (ok)")}}}catch(fe){console.warn("[Financeiro][Recebimentos] Falha ao buscar clientes de comandas:",fe?.message)}let fn=Q.from("v_agendamentos_detalhado").select("agendamento_id, agendamento_codigo, inicio, quadra_nome, participante_nome, valor_cota, status_pagamento, finalizadora_nome").eq("codigo_empresa",ee).eq("status_pagamento","Pago").order("inicio",{ascending:!1});Ie&&(fn=fn.gte("inicio",Ie)),Oe&&(fn=fn.lte("inicio",Oe));const{data:J}=await fn,Xe=(Pt||[]).map(fe=>({id:fe.id,origem:nr.get(fe.comanda_id||"")==="balcao"?"Balco":"Comanda",comanda_id:fe.comanda_id||null,recebido_em:fe.recebido_em,finalizadoras:fe.finalizadoras,metodo:fe.metodo,valor:fe.valor,status:fe.status,descricao:Qt.get(fe.comanda_id||"")||null,fonte:fe.origem||"manual",xml_chave:fe.xml_chave||null})),He=(J||[]).map((fe,Ve)=>({id:`ag-${fe.agendamento_id}-${Ve}`,origem:"Agendamento",recebido_em:fe.inicio,finalizadoras:fe.finalizadora_nome?{nome:fe.finalizadora_nome}:null,metodo:fe.finalizadora_nome||null,valor:fe.valor_cota,status:fe.status_pagamento,descricao:`#${fe.agendamento_codigo} - ${fe.participante_nome} (${fe.quadra_nome||""})`,agendamento_codigo:fe.agendamento_codigo,quadra_nome:fe.quadra_nome,participante_nome:fe.participante_nome,fonte:null}));Gt([...Xe,...He])}catch(ee){t({title:"Falha ao carregar recebimentos",description:ee?.message,variant:"destructive"})}finally{d(!1)}},sa=async()=>{try{d(!0);const ee=e?.codigo_empresa,Ie=ia(u)||void 0,Oe=Kn(h)||void 0;o("loadAgendamentos:start",{codigo:ee,fromISO:Ie,toISO:Oe});let Yt=Q.from("agendamentos").select("id, codigo, inicio, fim, quadra:quadras(id, nome)").eq("codigo_empresa",ee).order("inicio",{ascending:!1});Ie&&(Yt=Yt.gte("inicio",Ie)),Oe&&(Yt=Yt.lte("inicio",Oe));const{data:Pt}=await Yt,Qt=Array.isArray(Pt)?Pt:[],nr=Qt.map(He=>He.id).filter(Boolean);if(o("loadAgendamentos:agendamentos",{count:Qt.length,agendamentoIds:nr.length}),nr.length===0){Ct([]);return}const fn=new Map(Qt.map(He=>[He.id,He])),{data:J}=await Q.from("agendamento_participantes").select("id, agendamento_id, cliente_id, nome, valor_cota, status_pagamento, finalizadora:finalizadoras(id, nome), ordem, is_representante, deleted_at, cliente:clientes!agendamento_participantes_cliente_id_fkey(id, codigo, is_consumidor_final, nome)").eq("codigo_empresa",ee).in("agendamento_id",nr).is("deleted_at",null).order("ordem",{ascending:!0}).order("id",{ascending:!0});o("loadAgendamentos:participants",{count:Array.isArray(J)?J.length:null,nullClienteIdCount:(J||[]).filter(He=>He?.cliente_id==null).length});const Xe=(J||[]).map(He=>{const fe=fn.get(He.agendamento_id)||{},Ve=(Array.isArray(fe?.quadra)?fe.quadra[0]?.nome:fe?.quadra?.nome)||null,xe=Array.isArray(He?.cliente)?He.cliente[0]:He?.cliente,kt=(He?.nome||xe?.nome||"").toString(),st=(Array.isArray(He?.finalizadora)?He.finalizadora[0]?.nome:He?.finalizadora?.nome)||null,zt=!!xe?.is_consumidor_final;return{agendamento_id:He.agendamento_id,agendamento_codigo:fe?.codigo??null,inicio:fe?.inicio??null,fim:fe?.fim??null,quadra_nome:Ve,participante_nome:kt,cliente_id:He.cliente_id,valor_cota:He.valor_cota,finalizadora_nome:st,status_pagamento:He.status_pagamento||"Pendente",is_consumidor_final:zt,cliente_codigo:zt?0:xe?.codigo??null,ordem:He.ordem??null,is_representante:He.is_representante??null,participante_row_id:He.id}});o("loadAgendamentos:rowsBuilt",{count:Xe.length,nullOrdemCount:Xe.filter(He=>He?.ordem==null).length}),Ct(Xe)}catch(ee){t({title:"Falha ao carregar agendamentos",description:ee?.message,variant:"destructive"})}finally{d(!1)}};p.useEffect(()=>{n({tab:i})},[i]);const ia=ee=>{if(!ee)return null;if(typeof ee=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(ee)){const[Ie,Oe,Yt]=ee.split("-").map(Number);return new Date(Ie,Oe-1,Yt,0,0,0,0).toISOString()}return new Date(ee).toISOString()},Kn=ee=>{if(!ee)return null;if(typeof ee=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(ee)){const[Ie,Oe,Yt]=ee.split("-").map(Number);return new Date(Ie,Oe-1,Yt,23,59,59,999).toISOString()}return new Date(ee).toISOString()};p.useEffect(()=>{e?.codigo_empresa&&(i==="visao-geral"||i==="relatorios"?ir():i==="caixa"?Kr():i==="recebimentos"?jr():i==="agendamentos"&&sa())},[i,u,h,e?.codigo_empresa]);const at=p.useMemo(()=>{const ee=x?.totalPorFinalizadora||{},Ie=Object.entries(ee).map(([Oe,Yt])=>({name:Oe,valor:Number(Yt||0)}));return Ie.sort((Oe,Yt)=>Yt.valor-Oe.valor),Ie},[x]),[Te,Fe]=p.useState(null),[cr,ht]=p.useState(null),Xr={start:90,end:-270},Ft=(ee,Ie,Oe)=>ee+(Ie-ee)*Oe,kr=ee=>ee<.5?4*ee*ee*ee:1-Math.pow(-2*ee+2,3)/2,jt=ee=>{const Ie=Number(v||0),Oe=Number(b||0),Yt=Math.max(1e-4,Ie+Oe),Pt=360*(Ie/Yt);return ee===0?{a:Xr.start,b:Xr.start-Pt}:{a:Xr.start-Pt,b:Xr.end}},[er,Nt]=p.useState({from:null,to:null,t:1}),Cr=cr??Te;p.useEffect(()=>{if(Cr==null)return;const ee=jt(Cr);Nt(Qt=>({from:Qt.to||ee,to:ee,t:0}));let Ie;const Oe=performance.now(),Yt=380,Pt=Qt=>{const nr=Math.min(1,(Qt-Oe)/Yt),fn=kr(nr);Nt(J=>({...J,t:fn})),nr<1&&(Ie=requestAnimationFrame(Pt))};return Ie=requestAnimationFrame(Pt),()=>Ie&&cancelAnimationFrame(Ie)},[Cr,v,b]);const Lr=86,un=94,ra=80,[Wn,ln]=p.useState({from:[Lr,Lr],to:[Lr,Lr],t:1});p.useEffect(()=>{const ee=Cr===0?[un,ra]:Cr===1?[ra,un]:[Lr,Lr];ln(Qt=>({from:Qt.to||ee,to:ee,t:0}));let Ie;const Oe=performance.now(),Yt=380,Pt=Qt=>{const nr=Math.min(1,(Qt-Oe)/Yt),fn=kr(nr);ln(J=>({...J,t:fn})),nr<1&&(Ie=requestAnimationFrame(Pt))};return Ie=requestAnimationFrame(Pt),()=>Ie&&cancelAnimationFrame(Ie)},[Cr]);const da=({cx:ee,cy:Ie,outerRadius:Oe})=>{if(!er.from||!er.to)return null;const Yt=Ft(er.from.a,er.to.a,er.t),Pt=Ft(er.from.b,er.to.b,er.t),Qt=Cr===0?"#22C55E":"#F59E0B";return a.jsx(JM,{cx:ee,cy:Ie,innerRadius:0,outerRadius:(Oe||0)+4,startAngle:Yt,endAngle:Pt,fill:Qt,fillOpacity:.18,stroke:"transparent"})},va=p.useMemo(()=>{let ee=wt;if(Sr){const Ie=Sr.toLowerCase();ee=ee.filter(Oe=>(Oe.descricao||"").toLowerCase().includes(Ie)||(Oe.finalizadoras?.nome||"").toLowerCase().includes(Ie)||String(Oe.valor||"").includes(Ie)||(Oe.origem||"").toLowerCase().includes(Ie))}return he!=="all"&&(ee=ee.filter(Ie=>(Ie.finalizadoras?.nome||Ie.metodo)===he)),Vt!=="all"&&(ee=ee.filter(Ie=>(Ie.fonte||"manual")===Vt)),ee},[wt,Sr,he,Vt]),oa=p.useMemo(()=>{const ee={};return(Re||[]).forEach(Ie=>{const Oe=Ie.agendamento_id||Ie.agendamento_codigo;ee[Oe]||(ee[Oe]={agendamento_id:Ie.agendamento_id,agendamento_codigo:Ie.agendamento_codigo,inicio:Ie.inicio,fim:Ie.fim,quadra_nome:Ie.quadra_nome,participantes:[],participantesMap:new Map,rawRows:0,total:0,totalPago:0,totalPendente:0,statusGeral:"Pendente",representante:"",representanteClienteId:null,representanteCodigo:null,isRepresentanteConsumidor:!1}),ee[Oe].rawRows+=1;const Pt=`${Number.isFinite(Number(Ie?.ordem))?String(Number(Ie.ordem)):""}::${Ie.cliente_id!=null?String(Ie.cliente_id):""}::${String(Ie.participante_nome||"").trim().toLowerCase()}`,Qt=ee[Oe].participantesMap.get(Pt);if(Qt){const nr=String(Qt.status_pagamento||""),fn=String(Ie.status_pagamento||""),J=nr==="Pago",Xe=fn==="Pago",He=Number(Qt.valor_cota||0),fe=Number(Ie.valor_cota||0);if(!J&&Xe){ee[Oe].participantesMap.set(Pt,Ie);const Ve=ee[Oe].participantes.indexOf(Qt);Ve>=0&&(ee[Oe].participantes[Ve]=Ie),ee[Oe].totalPendente-=He,ee[Oe].totalPago+=fe,ee[Oe].total+=fe-He}else if(J===Xe&&fe>He){ee[Oe].participantesMap.set(Pt,Ie);const Ve=ee[Oe].participantes.indexOf(Qt);Ve>=0&&(ee[Oe].participantes[Ve]=Ie),J?ee[Oe].totalPago+=fe-He:ee[Oe].totalPendente+=fe-He,ee[Oe].total+=fe-He}}else{ee[Oe].participantesMap.set(Pt,Ie),ee[Oe].participantes.push(Ie);const nr=Number(Ie.valor_cota||0);ee[Oe].total+=nr,Ie.status_pagamento==="Pago"?ee[Oe].totalPago+=nr:ee[Oe].totalPendente+=nr}}),Object.values(ee).forEach(Ie=>{try{Ie.participantes.sort((Oe,Yt)=>{const Pt=Number.isFinite(Number(Oe?.ordem))?Number(Oe.ordem):1/0,Qt=Number.isFinite(Number(Yt?.ordem))?Number(Yt.ordem):1/0;if(Pt!==Qt)return Pt-Qt;const nr=String(Oe?.participante_nome||"").toLowerCase(),fn=String(Yt?.participante_nome||"").toLowerCase();return nr.localeCompare(fn)})}catch{}}),Object.values(ee).forEach(Ie=>{const Oe=Ie.participantes.every(Pt=>Pt.status_pagamento==="Pago");if(Ie.participantes.every(Pt=>Pt.status_pagamento==="Cancelado")?Ie.statusGeral="Cancelado":Oe?Ie.statusGeral="Pago":Ie.statusGeral="Pendente",Ie.participantes.length>0){let Pt=Ie.participantes.find(nr=>!nr.is_consumidor_final);Pt||(Pt=Ie.participantes[0]);let Qt=Pt?.participante_nome||"";Pt?.is_consumidor_final&&Qt&&(Qt.toLowerCase().includes("cliente consumidor")||(Qt=Qt)),Ie.representante=Qt,Ie.representanteClienteId=Pt?.cliente_id||null,Ie.representanteCodigo=Pt?.is_consumidor_final?0:Pt?.cliente_codigo??null,Ie.isRepresentanteConsumidor=Pt?.is_consumidor_final||!1}}),Object.values(ee).map(Ie=>{s&&Ie.rawRows!==Ie.participantes.length&&o("group:dedupe",{agendamento_id:Ie.agendamento_id,agendamento_codigo:Ie.agendamento_codigo,rawRows:Ie.rawRows,uniqueParticipants:Ie.participantes.length,participantes:Ie.participantes.map(Qt=>({ordem:Qt.ordem??null,cliente_id:Qt.cliente_id??null,nome:Qt.participante_nome??null,valor:Qt.valor_cota??null,status:Qt.status_pagamento??null}))});const{participantesMap:Oe,rawRows:Yt,...Pt}=Ie;return Pt}).sort((Ie,Oe)=>new Date(Oe.inicio)-new Date(Ie.inicio))},[Re,s,o]),Tn=p.useMemo(()=>{const ee=Wt.toLowerCase().trim();return oa.filter(Ie=>{if(Me!=="all"&&(Me==="Pago"&&Ie.statusGeral!=="Pago"||Me==="Pendente"&&Ie.statusGeral!=="Pendente"||Me==="Cancelado"&&Ie.statusGeral!=="Cancelado")||gt!=="all"&&!Ie.participantes.some(nr=>nr.finalizadora_nome===gt))return!1;if(!ee)return!0;const Oe=String(Ie.agendamento_codigo||""),Yt=String(Ie.quadra_nome||"").toLowerCase(),Pt=Ie.participantes.map(Qt=>String(Qt.participante_nome||"").toLowerCase()).join(" ");return Oe.includes(ee)||Yt.includes(ee)||Pt.includes(ee)})},[oa,Wt,Me,gt]);return a.jsx(a.Fragment,{children:a.jsxs(Fr.div,{variants:Uot,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsx(Fr.div,{variants:sc,className:"fx-card p-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Financeiro"}),a.jsx("p",{className:"text-sm text-text-secondary",children:"Gesto completa das finanas da empresa"})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-stretch sm:items-center gap-3 w-full sm:w-auto",children:[a.jsxs("div",{className:"flex flex-col justify-center flex-1 sm:flex-initial",children:[a.jsx("label",{className:"text-xs text-text-secondary mb-1",children:"Incio"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"h-9 w-full sm:w-[160px] pl-3 pr-3 flex items-center gap-2 justify-start text-left font-medium bg-black border-warning/40 text-white hover:bg-black/80 hover:border-warning",children:[a.jsx(Io,{className:"h-5 w-5 text-warning flex-shrink-0"}),a.jsx("span",{className:"font-mono tracking-wide text-sm leading-none",children:u?dr(new Date(u+"T00:00:00"),"dd/MM/yyyy",{locale:$a}):"Selecione"})]})}),a.jsx(Go,{className:"w-auto p-0 bg-black border-warning/40",align:"start",children:a.jsx(ei,{mode:"single",selected:u?new Date(u+"T00:00:00"):void 0,onSelect:ee=>ee&&f(dr(ee,"yyyy-MM-dd")),initialFocus:!0,classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md border-warning/40"}})})]})]}),a.jsxs("div",{className:"flex flex-col justify-center flex-1 sm:flex-initial",children:[a.jsx("label",{className:"text-xs text-text-secondary mb-1",children:"Fim"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:"h-9 w-full sm:w-[160px] pl-3 pr-3 flex items-center gap-2 justify-start text-left font-medium bg-black border-warning/40 text-white hover:bg-black/80 hover:border-warning",children:[a.jsx(Io,{className:"h-5 w-5 text-warning flex-shrink-0"}),a.jsx("span",{className:"font-mono tracking-wide text-sm leading-none",children:h?dr(new Date(h+"T00:00:00"),"dd/MM/yyyy",{locale:$a}):"Selecione"})]})}),a.jsx(Go,{className:"w-auto p-0 bg-black border-warning/40",align:"start",children:a.jsx(ei,{mode:"single",selected:h?new Date(h+"T00:00:00"):void 0,onSelect:ee=>ee&&m(dr(ee,"yyyy-MM-dd")),initialFocus:!0,classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md border-warning/40"}})})]})]})]})]})}),a.jsxs(_d,{value:i,onValueChange:l,children:[a.jsx("div",{className:"md:hidden mb-4",children:a.jsxs(Zn,{value:i,onValueChange:l,children:[a.jsx(Yn,{className:"w-full h-11 bg-black border-warning/40 text-white",children:a.jsx(ta,{placeholder:"Selecione uma aba"})}),a.jsxs(Jn,{className:"bg-black text-white border-warning/40",children:[a.jsx(nt,{value:"visao-geral",children:"Viso Geral"}),a.jsx(nt,{value:"caixa",children:"Caixa"}),a.jsx(nt,{value:"recebimentos",children:"Recebimentos"}),a.jsx(nt,{value:"agendamentos",children:"Agendamentos"}),a.jsx(nt,{value:"relatorios",children:"Relatrios"})]})]})}),a.jsxs(xc,{className:"hidden md:grid w-full grid-cols-5",children:[a.jsx(Ya,{value:"visao-geral",children:"Viso Geral"}),a.jsx(Ya,{value:"caixa",children:"Caixa"}),a.jsx(Ya,{value:"recebimentos",children:"Recebimentos"}),a.jsx(Ya,{value:"agendamentos",children:"Agendamentos"}),a.jsx(Ya,{value:"relatorios",children:"Relatrios"})]}),a.jsxs(yo,{value:"visao-geral",className:"space-y-6 mt-6",children:[a.jsxs(Fr.div,{variants:sc,className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[a.jsx(o2,{icon:AG,label:"Total Geral",value:Ye(Number(v||0)+Number(b||0)),color:"brand"}),a.jsx(o2,{icon:Y1,label:"Comandas",value:Ye(v),color:"success"}),a.jsx(o2,{icon:Io,label:"Agendamentos",value:Ye(b),color:"success"}),a.jsx(o2,{icon:Dh,label:"XML (Recebimentos)",value:Ye(k),color:"success"})]}),a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(Dh,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Proporo de Receita"})]})}),Number(v||0)+Number(b||0)===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem receitas no perodo."}):a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[a.jsx("div",{className:"w-full md:flex-1 h-[280px]",children:a.jsx(Gb,{width:"100%",height:"100%",children:a.jsxs(jUe,{children:[a.jsxs(Jf,{data:function(){const ee=Ft(Wn.from?.[0]??Lr,Wn.to?.[0]??Lr,Wn.t),Ie=Ft(Wn.from?.[1]??Lr,Wn.to?.[1]??Lr,Wn.t);return[{name:"Comandas",value:Number(v||0),fill:"#22C55E",outerRadius:ee},{name:"Agendamentos",value:Number(b||0),fill:"#F59E0B",outerRadius:Ie}]}(),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:0,stroke:"transparent",label:!1,labelLine:!1,isAnimationActive:!0,animationBegin:50,animationDuration:500,startAngle:Xr.start,endAngle:Xr.end,activeIndex:Cr,activeShape:void 0,onMouseEnter:(ee,Ie)=>Fe(Ie),onMouseLeave:()=>Fe(null),onClick:(ee,Ie)=>{ht(Oe=>Oe===Ie?null:Ie),Fe(Ie)},children:[a.jsx(Xw,{fill:"#22C55E",style:rr(0)},"c"),a.jsx(Xw,{fill:"#F59E0B",style:rr(1)},"a")]}),da({cx:"50%",cy:"50%",outerRadius:92}),a.jsx(Jf,{data:function(){const ee=Ft(Wn.from?.[0]??Lr,Wn.to?.[0]??Lr,Wn.t),Ie=Ft(Wn.from?.[1]??Lr,Wn.to?.[1]??Lr,Wn.t);return[{name:"Comandas",value:Number(v||0),fill:"transparent",outerRadius:ee},{name:"Agendamentos",value:Number(b||0),fill:"transparent",outerRadius:Ie}]}(),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:0,stroke:"transparent",label:xt,labelLine:!1,isAnimationActive:!1,startAngle:Xr.start,endAngle:Xr.end}),a.jsx(Dc,{formatter:ee=>Ye(ee),contentStyle:{background:"rgba(10, 10, 10, 0.95)",border:"1px solid #fbbf24",borderRadius:"8px",padding:"8px 10px",color:"#fff"},labelStyle:{color:"#fff"},itemStyle:{color:"#fff"},cursor:{fill:"rgba(251, 191, 36, 0.06)"}})]})})}),a.jsx("div",{className:"w-full md:w-64 space-y-3 md:pr-2",children:[{name:"Comandas",value:Number(v||0),color:"#22C55E"},{name:"Agendamentos",value:Number(b||0),color:"#F59E0B"}].map((ee,Ie)=>a.jsxs("div",{className:`flex items-center justify-between px-3 py-2 rounded-md transition-all duration-200 ${Te===Ie?"bg-white/5":"hover:bg-white/5"} cursor-pointer ${cr!=null&&cr!==Ie?"opacity-60":""}`,onMouseEnter:()=>Fe(Ie),onMouseLeave:()=>Fe(null),onClick:()=>ht(Oe=>Oe===Ie?null:Ie),role:"button",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-sm",style:{backgroundColor:ee.color}}),a.jsx("span",{className:"text-sm text-text-secondary",children:ee.name})]}),a.jsx("div",{className:`text-sm font-semibold ${cr!=null&&cr!==Ie?"opacity-70":""}`,children:Ye(ee.value)})]},ee.name))})]})]}),a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider",children:[a.jsx(Dh,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Entradas por Finalizadora"})]})}),at.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos no perodo."}):a.jsx("div",{className:"h-[280px]",children:a.jsx(Gb,{width:"100%",height:"100%",children:a.jsxs(wUe,{data:at,margin:{top:8,right:8,left:8,bottom:8},children:[a.jsx(BS,{strokeDasharray:"3 3",stroke:"#333"}),a.jsx(bp,{dataKey:"name",stroke:"#aaa"}),a.jsx(wp,{stroke:"#aaa",tickFormatter:ee=>Ye(ee),width:80}),a.jsx(Dc,{formatter:ee=>Ye(ee),labelFormatter:ee=>`Finalizadora: ${ee}`,contentStyle:{background:"rgba(10, 10, 10, 0.95)",border:"1px solid #fbbf24",borderRadius:"8px",padding:"8px 12px",color:"#fff"},cursor:{fill:"rgba(251, 191, 36, 0.1)"}}),a.jsx(Tg,{}),a.jsx(_x,{dataKey:"valor",name:"Valor",fill:"#fbbf24"})]})})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4 border-0 ring-0 outline-none focus-visible:outline-none shadow-none cursor-pointer",onClick:()=>V(!0),children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider mb-3",children:[a.jsx(bu,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Produtos mais vendidos"}),S.length>5&&a.jsx(Z,{variant:"outline",size:"xs",className:"ml-auto h-7 px-2",onClick:()=>V(!0),children:"Ver todos"})]}),j.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados no perodo."}):a.jsx("div",{className:"space-y-2",children:j.map((ee,Ie)=>a.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border last:border-0",children:[a.jsxs("span",{className:"text-sm text-text-primary",children:[Ie+1,". ",ee.nome]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:Ye(ee.valor)}),a.jsxs("span",{className:"text-sm font-bold text-brand",children:["x",ee.quantidade]})]})]},Ie))})]}),a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4 border-0 ring-0 outline-none focus-visible:outline-none shadow-none cursor-pointer",onClick:()=>be(!0),children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-xs font-semibold uppercase tracking-wider mb-3",children:[a.jsx(mc,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Clientes (por valor pago)"}),M.length>5&&a.jsx(Z,{variant:"outline",size:"xs",className:"ml-auto h-7 px-2",onClick:()=>be(!0),children:"Ver todos"})]}),C.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados no perodo."}):a.jsx("div",{className:"space-y-2",children:C.map((ee,Ie)=>a.jsxs("button",{className:"w-full flex items-center justify-between py-2 border-b border-border last:border-0 hover:bg-surface-2 rounded-sm px-2 text-left",onClick:()=>{L(ee),be(!0)},children:[a.jsxs("span",{className:"text-sm text-text-primary",children:[Ie+1,". ",ee.nome]}),a.jsx("span",{className:"text-sm font-bold text-success",children:Ye(ee.valor)})]},Ie))})]})]})]}),a.jsx(yo,{value:"agendamentos",className:"space-y-6 mt-6",children:a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"Agendamentos (Pagamentos por Participante)"}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:items-center",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar (#cdigo, participante, quadra)",value:Wt,onChange:ee=>Er(ee.target.value),className:"pl-10 pr-10 w-full md:w-[260px] bg-black border-warning/40 text-white placeholder:text-white/60"}),a.jsxs(Qo,{open:an,onOpenChange:zr,children:[a.jsx(Zo,{asChild:!0,children:a.jsx(Z,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0 hover:bg-warning/20",title:"Selecionar cliente",children:a.jsx("svg",{className:"h-4 w-4 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})}),a.jsx(Go,{className:"w-[280px] p-2 bg-surface border-border",align:"end",children:a.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto",children:[a.jsx("div",{className:"text-xs font-semibold text-text-secondary px-2 py-1 sticky top-0 bg-surface z-10",children:"Selecionar Cliente"}),(()=>{const ee=new Map;Re.forEach(Oe=>{const Yt=Oe.participante_nome,Qt=`${Number.isFinite(Number(Oe?.ordem))?String(Number(Oe.ordem)):""}::${Oe?.cliente_id!=null?String(Oe.cliente_id):""}::${String(Yt||"").trim().toLowerCase()}`;Yt&&!ee.has(Qt)&&ee.set(Qt,{nome:Yt,codigo:Oe.cliente_codigo||0,is_consumidor:Oe.is_consumidor_final||!1})});const Ie=Array.from(ee.values()).sort((Oe,Yt)=>Oe.is_consumidor!==Yt.is_consumidor?Oe.is_consumidor?1:-1:Oe.nome.localeCompare(Yt.nome));return Ie.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-4",children:"Nenhum participante encontrado"}):Ie.map((Oe,Yt)=>a.jsxs("button",{onClick:()=>{Er(Oe.nome),zr(!1)},className:"w-full flex items-center gap-2 px-2 py-2 hover:bg-surface-2 rounded text-left transition-colors",children:[a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[24px] h-5 px-1 rounded text-[10px] font-bold ${Oe.codigo===0?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Oe.codigo]}),a.jsx("span",{className:"text-sm text-text-primary flex-1 truncate",children:Oe.nome})]},Yt))})()]})})]})]}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[a.jsxs(Zn,{value:Me,onValueChange:lt,children:[a.jsx(Yn,{className:"w-full md:w-[170px] h-9 bg-black border-warning/40 text-white",children:a.jsx(ta,{placeholder:"Todos os Status"})}),a.jsxs(Jn,{className:"bg-black text-white border-warning/40",children:[a.jsx(nt,{value:"all",children:"Todos os Status"}),a.jsx(nt,{value:"Pago",children:"Pago"}),a.jsx(nt,{value:"Pendente",children:"Pendente"}),a.jsx(nt,{value:"Cancelado",children:"Cancelado"})]})]}),a.jsxs(Zn,{value:gt,onValueChange:or,children:[a.jsx(Yn,{className:"w-full md:w-[220px] h-9 bg-black border-warning/40 text-white",children:a.jsx(ta,{placeholder:"Todas as Finalizadoras"})}),a.jsxs(Jn,{className:"bg-black text-white border-warning/40",children:[a.jsx(nt,{value:"all",children:"Todas as Finalizadoras"}),[...new Set((Re||[]).map(ee=>ee.finalizadora_nome).filter(Boolean))].map(ee=>a.jsx(nt,{value:ee,children:ee},ee))]})]})]}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>{try{const ee=";",Oe=[["Data","Horrio","Cdigo","Representante","Quadra","Participantes","Total","Pago","Pendente","Status"].join(ee)];Tn.forEach(Xe=>{const He=Xe.inicio?new Date(Xe.inicio).toLocaleDateString("pt-BR"):"",fe=Xe.inicio&&Xe.fim?`${new Date(Xe.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}-${new Date(Xe.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:"",Ve=Xe.participantes.length,xe=Xe.participantes.filter(pr=>pr.status_pagamento==="Pago").length,kt=Xe.participantes.filter(pr=>pr.status_pagamento==="Pendente").length,st=String(lr(Xe.total)).replace(".",","),zt=[He,fe,Xe.agendamento_codigo??"",(Xe.representante??"").replace(/"/g,'""'),(Xe.quadra_nome??"").replace(/"/g,'""'),Ve,st,xe,kt,Xe.statusGeral??""].map(pr=>`"${pr}"`).join(ee);Oe.push(zt)});const Yt="\uFEFF"+Oe.join(`
`),Pt=new Blob([Yt],{type:"text/csv;charset=utf-8;"}),Qt=URL.createObjectURL(Pt),nr=document.createElement("a");nr.href=Qt;const fn=u?new Date(u+"T00:00:00").toLocaleDateString("pt-BR").replace(/\//g,"-"):"",J=h?new Date(h+"T00:00:00").toLocaleDateString("pt-BR").replace(/\//g,"-"):"";nr.download=`agendamentos_${fn}_a_${J}.csv`,document.body.appendChild(nr),nr.click(),document.body.removeChild(nr),URL.revokeObjectURL(Qt),t({title:"CSV exportado com sucesso!"})}catch(ee){t({title:"Falha ao exportar CSV",description:ee?.message,variant:"destructive"})}},children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Exportar CSV"]})]})]}),c?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):Tn.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros no perodo."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{className:"w-12"}),a.jsx(ka,{children:"Data/Hora"}),a.jsx(ka,{children:"Cdigo"}),a.jsx(ka,{children:"Representante"}),a.jsx(ka,{children:"Quadra"}),a.jsx(ka,{className:"text-right",children:"Participantes"}),a.jsx(ka,{className:"text-right",children:"Total"}),a.jsx(ka,{children:"Status"})]})}),a.jsx(lc,{children:Tn.map(ee=>{const Ie=br.has(ee.agendamento_id||ee.agendamento_codigo);return a.jsxs(Ce.Fragment,{children:[a.jsxs(zs,{className:"cursor-pointer hover:bg-surface-2",onClick:()=>{const Oe=ee.agendamento_id||ee.agendamento_codigo;ur(Yt=>{const Pt=new Set(Yt);return Pt.has(Oe)?Pt.delete(Oe):Pt.add(Oe),Pt})},children:[a.jsx(ca,{children:a.jsx("div",{className:`transition-transform ${Ie?"rotate-90":""}`,children:""})}),a.jsx(ca,{children:ee.inicio?a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-xs text-text-secondary",children:new Date(ee.inicio).toLocaleDateString("pt-BR")}),a.jsxs("span",{className:"font-medium",children:[new Date(ee.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),ee.fim&&` - ${new Date(ee.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`]})]}):""}),a.jsxs(ca,{className:"font-semibold",children:["#",ee.agendamento_codigo||""]}),a.jsx(ca,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[ee.representanteCodigo!==null&&ee.representanteCodigo!==void 0&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[32px] h-6 px-1.5 rounded text-xs font-bold ${ee.representanteCodigo===0||ee.representanteCodigo==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",ee.representanteCodigo]}),a.jsx("span",{className:"text-text-primary",children:ee.representante||""})]})}),a.jsx(ca,{children:ee.quadra_nome||""}),a.jsx(ca,{className:"text-right",children:ee.participantes.length}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.total)}),a.jsx(ca,{children:a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${ee.statusGeral==="Pago"?"bg-success/20 text-success":ee.statusGeral==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:ee.statusGeral==="Parcial"?"Pendente":ee.statusGeral})})]}),Ie&&ee.participantes.map((Oe,Yt)=>{const Pt=Oe.is_consumidor_final?0:Oe.cliente_codigo??null;return a.jsxs(zs,{className:"bg-surface-2/30 hover:bg-surface-2/50 transition-colors",children:[a.jsx(ca,{}),a.jsx(ca,{colSpan:2}),a.jsx(ca,{className:"pl-8 text-sm text-text-secondary",children:a.jsxs("div",{className:"flex items-center gap-2",children:[Pt!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[28px] h-5 px-1 rounded text-[10px] font-bold ${Pt===0||Pt==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Pt]}),a.jsx("span",{children:Oe.participante_nome||""})]})}),a.jsx(ca,{className:"text-sm text-text-secondary",children:Oe.finalizadora_nome||""}),a.jsx(ca,{}),a.jsx(ca,{className:"text-right text-sm font-medium",children:Ye(Oe.valor_cota)}),a.jsx(ca,{className:"text-sm",children:a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs ${Oe.status_pagamento==="Pago"?"bg-success/20 text-success":Oe.status_pagamento==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:Oe.status_pagamento||"Pendente"})})]},`${ee.agendamento_codigo}-${Yt}`)})]},ee.agendamento_id||ee.agendamento_codigo)})})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:Tn.map(ee=>{const Ie=br.has(ee.agendamento_id||ee.agendamento_codigo);return a.jsxs("div",{className:"bg-surface-2 rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>{const Oe=ee.agendamento_id||ee.agendamento_codigo;ur(Yt=>{const Pt=new Set(Yt);return Pt.has(Oe)?Pt.delete(Oe):Pt.add(Oe),Pt})},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`transition-transform text-text-secondary ${Ie?"rotate-90":""}`,children:""}),a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["#",ee.agendamento_codigo||""]})]}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${ee.statusGeral==="Pago"?"bg-success/20 text-success":ee.statusGeral==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:ee.statusGeral==="Parcial"?"Pendente":ee.statusGeral})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Data:"}),a.jsx("span",{className:"text-text-primary",children:ee.inicio?new Date(ee.inicio).toLocaleDateString("pt-BR"):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Horrio:"}),a.jsx("span",{className:"text-text-primary font-medium",children:ee.inicio&&ee.fim?`${new Date(ee.inicio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})} - ${new Date(ee.fim).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:""})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-text-secondary",children:"Representante:"}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[ee.representanteCodigo!==null&&ee.representanteCodigo!==void 0&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[28px] h-5 px-1 rounded text-[10px] font-bold ${ee.representanteCodigo===0||ee.representanteCodigo==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",ee.representanteCodigo]}),a.jsx("span",{className:"text-text-primary font-medium",children:ee.representante||""})]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Quadra:"}),a.jsx("span",{className:"text-text-primary font-medium",children:ee.quadra_nome||""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Participantes:"}),a.jsx("span",{className:"text-text-primary",children:ee.participantes.length})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border/50",children:[a.jsx("span",{className:"text-text-secondary",children:"Total:"}),a.jsx("span",{className:"font-bold text-lg text-success",children:Ye(ee.total)})]})]})]}),Ie&&a.jsx("div",{className:"border-t border-border/50 bg-surface-2/20",children:ee.participantes.map((Oe,Yt)=>{const Pt=Oe.is_consumidor_final?0:Oe.cliente_codigo??null;return a.jsxs("div",{className:"px-4 py-3 border-b border-border/30 last:border-b-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[Pt!=null&&a.jsxs("span",{className:`inline-flex items-center justify-center min-w-[24px] h-4 px-1 rounded text-[9px] font-bold ${Pt===0||Pt==="0"?"bg-amber-500/20 text-amber-400 ring-1 ring-amber-500/30":"bg-emerald-600/20 text-emerald-400"}`,children:["#",Pt]}),a.jsx("div",{className:"font-medium text-sm",children:Oe.participante_nome||""})]}),a.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full ${Oe.status_pagamento==="Pago"?"bg-success/20 text-success":Oe.status_pagamento==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:Oe.status_pagamento||"Pendente"})]}),a.jsxs("div",{className:"flex justify-between text-xs",children:[a.jsx("span",{className:"text-text-secondary",children:Oe.finalizadora_nome||""}),a.jsx("span",{className:"font-semibold text-success",children:Ye(Oe.valor_cota)})]})]},Yt)})})]},ee.agendamento_id||ee.agendamento_codigo)})})]})]})}),a.jsx(yo,{value:"caixa",className:"space-y-6 mt-6",children:a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[a.jsx("h3",{className:"text-base font-bold",children:"Fechamentos Anteriores"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",onClick:ze,children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:qe,children:[a.jsx(Ix,{className:"h-4 w-4 mr-2"})," PDF"]})]})]}),ut.length===0?a.jsx("div",{className:"text-sm text-text-secondary",children:"Nenhum fechamento encontrado."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Aberto em"}),a.jsx(ka,{children:"Fechado em"}),a.jsx(ka,{className:"text-right",children:"Saldo Inicial"}),a.jsx(ka,{className:"text-right",children:"Saldo Final (contado)"}),a.jsx(ka,{children:"Status"})]})}),a.jsxs(lc,{children:[(()=>{console.log("[FinanceiroPage][Render] Renderizando histrico, total de sesses:",ut.length);const ee=ut.filter(Ie=>Ie.valor_final_dinheiro!=null);return console.log("[FinanceiroPage][Render] Sesses com valor_final_dinheiro no render:",ee.length),ut.length>0&&console.log("[FinanceiroPage][Render] Primeira sesso no array history:",ut[0]),null})(),ut.map(ee=>a.jsxs(zs,{className:"cursor-pointer hover:bg-surface-2",onClick:async()=>{bt(!0),Dt(!0),ge(null);try{const Ie=e?.codigo_empresa,Oe=typeof performance<"u"&&performance.now?performance.now():Date.now();console.log("[Caixa][Fechamento][Open]",{sessaoId:ee.id,from:ee.aberto_em,to:ee.fechado_em,codigo:Ie});let Yt=await QS({caixaSessaoId:ee.id,codigoEmpresa:Ie}),Qt=(en=>{if(!en)return null;if(en.total_bruto!=null||en.por_finalizadora!=null){let sn=en.por_finalizadora;if(sn&&typeof sn=="string")try{sn=JSON.parse(sn)}catch{sn={}}return{from:en.periodo_de||null,to:en.periodo_ate||null,totalPorFinalizadora:sn||{},totalEntradas:Number(en.total_entradas||0),totalVendasBrutas:Number(en.total_bruto||0),totalDescontos:Number(en.total_descontos||0),totalVendasLiquidas:Number(en.total_liquido||0)}}return en})(Yt);Qt||(console.log("[Caixa][Fechamento] Snapshot ausente, calculando resumo por perodo..."),Qt=await fu({from:ee.aberto_em,to:ee.fechado_em||new Date().toISOString(),codigoEmpresa:Ie}));const nr={...ee,saldo_inicial:Yt&&typeof Yt.saldo_inicial<"u"?Number(Yt.saldo_inicial):ee.saldo_inicial,saldo_final:Yt&&typeof Yt.saldo_final<"u"?Number(Yt.saldo_final):ee.saldo_final};if(!Qt||!Qt.totalPorFinalizadora||Object.keys(Qt.totalPorFinalizadora).length===0)try{const en=ee.aberto_em,sn=ee.fechado_em||new Date().toISOString();let la=Q.from("pagamentos").select("metodo, valor, status, recebido_em, finalizadoras:finalizadoras!pagamentos_finalizadora_id_fkey(nome)").gte("recebido_em",en).lte("recebido_em",sn);Ie&&(la=la.eq("codigo_empresa",Ie));const{data:Nr}=await la,xn={};let Dn=0;for(const Pa of Nr||[]){if(!((Pa.status||"Pago")!=="Cancelado"&&(Pa.status||"Pago")!=="Estornado"))continue;const Na=Pa.finalizadoras?.nome||Pa.metodo||"Outros",Hn=Number(Pa.valor||0);xn[Na]=(xn[Na]||0)+Hn,Dn+=Hn}Qt={...Qt||{},totalPorFinalizadora:xn,totalEntradas:Number(Qt?.totalEntradas||0)||Dn},console.log("[Caixa][Fechamento][FallbackPF]",{methods:Object.keys(xn).length})}catch{}const J=await Fg({caixaSessaoId:ee.id,codigoEmpresa:Ie}),Xe=Yt&&Yt.movimentos?Yt.movimentos:null,He=ee.aberto_em,fe=ee.fechado_em||new Date().toISOString();let Ve=Q.from("pagamentos").select("id, valor, status, metodo, recebido_em, finalizadoras:finalizadoras!pagamentos_finalizadora_id_fkey(nome)").gte("recebido_em",He).lte("recebido_em",fe).order("recebido_em",{ascending:!1});Ie&&(Ve=Ve.eq("codigo_empresa",Ie));const{data:xe}=await Ve;console.log("[Caixa][Fechamento][Pays]",{count:(xe||[]).length});const kt=Yt&&typeof Yt.valor_final_dinheiro<"u"?Number(Yt.valor_final_dinheiro):null;ge({resumo:Qt,movimentacoes:J,movimentosAgg:Xe,pagamentos:xe||[],sessao:nr,valorFinalContado:kt});const st=typeof performance<"u"&&performance.now?performance.now():Date.now(),zt=Array.isArray(J)?J.length:0,pr=Qt&&Qt.totalPorFinalizadora?Object.keys(Qt.totalPorFinalizadora).length:0;console.log("[Caixa][Fechamento][Loaded]",{sessaoId:ee.id,finCount:pr,movCount:zt,ms:Math.round(st-Oe)})}catch(Ie){console.error("[Caixa][Fechamento][Error]",{sessaoId:ee.id,message:Ie?.message,code:Ie?.code}),t({title:"Falha ao carregar fechamento",description:Ie?.message||"Tente novamente",variant:"destructive"})}finally{Dt(!1)}},children:[a.jsx(ca,{children:ee.aberto_em?new Date(ee.aberto_em).toLocaleString("pt-BR"):""}),a.jsx(ca,{children:ee.fechado_em?new Date(ee.fechado_em).toLocaleString("pt-BR"):""}),a.jsx(ca,{className:"text-right",children:Ye(ee.saldo_inicial)}),a.jsx(ca,{className:"text-right",children:ee.valor_final_dinheiro!=null?Ye(ee.valor_final_dinheiro):""}),a.jsx(ca,{children:String(ee.status||"").toLowerCase()==="open"?"Aberto":"Fechado"})]},ee.id))]})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:ut.map(ee=>a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 cursor-pointer hover:bg-surface-2/80 transition-colors",onClick:async()=>{bt(!0),Dt(!0),ge(null);try{const Ie=e?.codigo_empresa;let Oe=await QS({caixaSessaoId:ee.id,codigoEmpresa:Ie}),Pt=(Xe=>{if(!Xe)return null;if(Xe.total_bruto!=null||Xe.por_finalizadora!=null){let He=Xe.por_finalizadora;if(He&&typeof He=="string")try{He=JSON.parse(He)}catch{He={}}return{from:Xe.periodo_de||null,to:Xe.periodo_ate||null,totalPorFinalizadora:He||{},totalEntradas:Number(Xe.total_entradas||0),totalVendasBrutas:Number(Xe.total_bruto||0),totalDescontos:Number(Xe.total_descontos||0),totalVendasLiquidas:Number(Xe.total_liquido||0)}}return Xe})(Oe);Pt||(Pt=await fu({from:ee.aberto_em,to:ee.fechado_em||new Date().toISOString(),codigoEmpresa:Ie}));const Qt={...ee,saldo_inicial:Oe&&typeof Oe.saldo_inicial<"u"?Number(Oe.saldo_inicial):ee.saldo_inicial,saldo_final:Oe&&typeof Oe.saldo_final<"u"?Number(Oe.saldo_final):ee.saldo_final},nr=await Fg({caixaSessaoId:ee.id,codigoEmpresa:Ie}),fn=Oe&&Oe.movimentos?Oe.movimentos:null,J=Oe&&typeof Oe.valor_final_dinheiro<"u"?Number(Oe.valor_final_dinheiro):null;ge({resumo:Pt,movimentacoes:nr,movimentosAgg:fn,sessao:Qt,pagamentos:[],valorFinalContado:J})}catch(Ie){console.error("[Caixa][Fechamento][Error]",Ie),t({title:"Erro ao carregar detalhes",description:Ie?.message,variant:"destructive"})}finally{Dt(!1)}},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["Sesso #",ee.id]}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${ee.status==="fechado"?"bg-success/20 text-success":"bg-warning/20 text-warning"}`,children:String(ee.status||"").toLowerCase()==="open"?"Aberto":"Fechado"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Aberto em:"}),a.jsx("span",{className:"text-text-primary",children:ee.aberto_em?new Date(ee.aberto_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Fechado em:"}),a.jsx("span",{className:"text-text-primary",children:ee.fechado_em?new Date(ee.fechado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Saldo Inicial:"}),a.jsx("span",{className:"font-semibold text-info",children:Ye(ee.saldo_inicial)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Saldo Final (contado):"}),a.jsx("span",{className:"font-semibold text-success",children:ee.valor_final_dinheiro!=null?Ye(ee.valor_final_dinheiro):""})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted text-center",children:"Toque para ver detalhes"})]},ee.id))})]})]})}),a.jsx(yo,{value:"recebimentos",className:"space-y-6 mt-6",children:a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4 border-0 ring-0 outline-none shadow-none",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[a.jsx("h2",{className:"text-lg font-bold",children:"Todos os Recebimentos"}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar...",value:Sr,onChange:ee=>wr(ee.target.value),className:"pl-10 w-full md:w-[200px]"})]}),a.jsxs(Zn,{value:Vt,onValueChange:qt,children:[a.jsx(Yn,{className:"w-full md:w-[160px] h-9 bg-black border-warning/40 text-white",children:a.jsx(ta,{placeholder:"Todas as Fontes"})}),a.jsxs(Jn,{className:"bg-black text-white border-warning/40",children:[a.jsx(nt,{value:"all",children:"Todas as Fontes"}),a.jsx(nt,{value:"manual",children:"Manual"}),a.jsx(nt,{value:"xml",children:"XML"})]})]}),a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>{try{const ee=va||[],Oe=[["Data/Hora","Origem","Fonte","Descrio","Finalizadora","Valor","Status"].join(";")];for(const Xe of ee){const He=[Xe.recebido_em?new Date(Xe.recebido_em).toLocaleString("pt-BR"):"",Xe.origem??"",Xe.fonte??"",(Xe.descricao??"").replaceAll('"','""'),(Xe.finalizadoras?.nome||Xe.metodo||"").replaceAll('"','""'),String(lr(Xe.valor)).replace(".",","),Xe.status??""].map(fe=>`"${String(fe)}"`).join(";");Oe.push(He)}const Yt="\uFEFF"+Oe.join(`
`),Pt=new Blob([Yt],{type:"text/csv;charset=utf-8;"}),Qt=URL.createObjectURL(Pt),nr=u?new Date(u+"T00:00:00").toLocaleDateString("pt-BR"):"",fn=h?new Date(h+"T00:00:00").toLocaleDateString("pt-BR"):"",J=document.createElement("a");J.href=Qt,J.download=`recebimentos_${nr}_a_${fn}.csv`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(Qt)}catch(ee){t({title:"Falha ao exportar CSV",description:ee?.message,variant:"destructive"})}},children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Exportar CSV"]})]})]}),c?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):va.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros no perodo."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Data/Hora"}),a.jsx(ka,{children:"Origem"}),a.jsx(ka,{children:"Fonte"}),a.jsx(ka,{children:"Descrio"}),a.jsx(ka,{children:"Finalizadora"}),a.jsx(ka,{className:"text-right",children:"Valor"}),a.jsx(ka,{children:"Status"})]})}),a.jsx(lc,{children:va.map(ee=>a.jsxs(zs,{className:"cursor-pointer hover:bg-surface-2",onClick:()=>{on(ee),ha(!0)},children:[a.jsx(ca,{children:ee.recebido_em?new Date(ee.recebido_em).toLocaleString("pt-BR"):""}),a.jsx(ca,{children:ee.origem||""}),a.jsx(ca,{children:ee.fonte?ee.fonte.toUpperCase():""}),a.jsx(ca,{className:"truncate max-w-[260px]",title:ee.descricao||"",children:ee.descricao||""}),a.jsx(ca,{children:ee.finalizadoras?.nome||ee.metodo||""}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.valor)}),a.jsx(ca,{children:ee.status||""})]},ee.id))})]})}),a.jsx("div",{className:"md:hidden space-y-3",children:va.map(ee=>a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 cursor-pointer hover:bg-surface-2/80 transition-colors",onClick:()=>{on(ee),ha(!0)},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary",children:ee.origem||"Recebimento"}),a.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${ee.status==="Pago"?"bg-success/20 text-success":ee.status==="Cancelado"?"bg-danger/20 text-danger":"bg-warning/20 text-warning"}`,children:ee.status||"Pendente"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Data/Hora:"}),a.jsx("span",{className:"text-text-primary",children:ee.recebido_em?new Date(ee.recebido_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Fonte:"}),a.jsx("span",{className:"text-text-primary font-medium",children:ee.fonte?ee.fonte.toUpperCase():""})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-secondary",children:"Finalizadora:"}),a.jsx("span",{className:"text-text-primary",children:ee.finalizadoras?.nome||ee.metodo||""})]}),ee.descricao&&a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:"text-text-secondary",children:"Descrio:"}),a.jsx("span",{className:"text-text-primary text-xs bg-surface/50 p-2 rounded",children:ee.descricao})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border/50",children:[a.jsx("span",{className:"text-text-secondary",children:"Valor:"}),a.jsx("span",{className:"font-bold text-lg text-success",children:Ye(ee.valor)})]})]}),a.jsx("div",{className:"mt-3 text-xs text-text-muted text-center",children:"Toque para ver detalhes"})]},ee.id))})]})]})}),a.jsxs(yo,{value:"relatorios",className:"space-y-6 mt-6",children:[a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Wi,{className:"w-5 h-5 text-success"}),"Faturamento Consolidado"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Resumo geral das receitas no perodo"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const Ie=[["Mtrica","Valor"],["Receita de Comandas",Ye(v)],["Receita de Agendamentos",Ye(b)],["Receita Total",Ye(Number(v||0)+Number(b||0))],["Perodo",`${u||"N/A"} at ${h||"N/A"}`]].map(Qt=>Qt.map(nr=>`"${nr}"`).join(";")).join(`
`),Oe=new Blob(["\uFEFF"+Ie],{type:"text/csv;charset=utf-8;"}),Yt=URL.createObjectURL(Oe),Pt=document.createElement("a");Pt.href=Yt,Pt.download=`faturamento_consolidado_${dr(new Date,"yyyy-MM-dd")}.csv`,Pt.click(),URL.revokeObjectURL(Yt),t({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ws,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const ee=[["Receita de Comandas",Ye(v)],["Receita de Agendamentos",Ye(b)],["Receita Total",Ye(Number(v||0)+Number(b||0))]];ce("Faturamento Consolidado",["Mtrica","Valor"],ee,"faturamento_consolidado")},children:[a.jsx(Ix,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"p-4 bg-success/5 border border-success/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Comandas"}),a.jsx("div",{className:"text-2xl font-bold text-success",children:Ye(v)}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Vendas no perodo"})]}),a.jsxs("div",{className:"p-4 bg-purple-500/5 border border-purple-500/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Agendamentos"}),a.jsx("div",{className:"text-2xl font-bold text-purple-400",children:Ye(b)}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Reservas pagas"})]}),a.jsxs("div",{className:"p-4 bg-brand/5 border border-brand/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Receita Total"}),a.jsx("div",{className:"text-2xl font-bold text-brand",children:Ye(Number(v||0)+Number(b||0))}),a.jsx("div",{className:"text-xs text-text-muted mt-1",children:"Perodo selecionado"})]})]})]}),a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Dh,{className:"w-5 h-5 text-info"}),"Pagamentos por Mtodo"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Distribuio por finalizadora"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-info/10 border-info/40 text-info hover:bg-info/20",onClick:()=>{const ee=x?.totalPorFinalizadora||{},Ie=Object.entries(ee).map(([J,Xe])=>[J,Ye(Xe)]).sort((J,Xe)=>{const He=Number(String(J[1]).replace(/[^\d,]/g,"").replace(",","."));return Number(String(Xe[1]).replace(/[^\d,]/g,"").replace(",","."))-He}),Oe=Object.values(ee).reduce((J,Xe)=>J+Xe,0),Pt=[["Mtodo de Pagamento","Valor","% do Total"],...Ie.map(([J,Xe])=>{const fe=((Object.entries(ee).find(([Ve])=>Ve===J)?.[1]||0)/Oe*100).toFixed(1)+"%";return[J,Xe,fe]}),["TOTAL",Ye(Oe),"100%"]].map(J=>J.map(Xe=>`"${Xe}"`).join(";")).join(`
`),Qt=new Blob(["\uFEFF"+Pt],{type:"text/csv;charset=utf-8;"}),nr=URL.createObjectURL(Qt),fn=document.createElement("a");fn.href=nr,fn.download=`pagamentos_por_metodo_${dr(new Date,"yyyy-MM-dd")}.csv`,fn.click(),URL.revokeObjectURL(nr),t({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ws,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-info/10 border-info/40 text-info hover:bg-info/20",onClick:()=>{const ee=x?.totalPorFinalizadora||{},Ie=Object.values(ee).reduce((Yt,Pt)=>Yt+Pt,0),Oe=Object.entries(ee).sort(([,Yt],[,Pt])=>Pt-Yt).map(([Yt,Pt])=>[Yt,Ye(Pt),(Pt/Ie*100).toFixed(1)+"%"]);Oe.push(["TOTAL",Ye(Ie),"100%"]),ce("Pagamentos por Mtodo",["Mtodo","Valor","% do Total"],Oe,"pagamentos_por_metodo")},children:[a.jsx(Ix,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),Object.keys(x?.totalPorFinalizadora||{}).length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem pagamentos no perodo."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Mtodo de Pagamento"}),a.jsx(ka,{className:"text-right",children:"Valor"}),a.jsx(ka,{className:"text-right",children:"% do Total"})]})}),a.jsxs(lc,{children:[Object.entries(x?.totalPorFinalizadora||{}).sort(([,ee],[,Ie])=>Ie-ee).map(([ee,Ie])=>{const Oe=Object.values(x?.totalPorFinalizadora||{}).reduce((Pt,Qt)=>Pt+Qt,0),Yt=(Ie/Oe*100).toFixed(1);return a.jsxs(zs,{children:[a.jsx(ca,{className:"font-medium",children:ee}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(Ie)}),a.jsxs(ca,{className:"text-right text-text-secondary",children:[Yt,"%"]})]},ee)}),a.jsxs(zs,{className:"bg-surface-2 font-bold",children:[a.jsx(ca,{children:"TOTAL"}),a.jsx(ca,{className:"text-right",children:Ye(Object.values(x?.totalPorFinalizadora||{}).reduce((ee,Ie)=>ee+Ie,0))}),a.jsx(ca,{className:"text-right",children:"100%"})]})]})]})})]}),a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(bu,{className:"w-5 h-5 text-purple-400"}),"Produtos Mais Vendidos"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Top produtos por faturamento"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-purple-500/10 border-purple-500/40 text-purple-400 hover:bg-purple-500/20",onClick:()=>{const Ie=[["Posio","Produto","Faturamento"],...S.slice(0,50).map((Qt,nr)=>[nr+1,Qt.nome,Ye(Qt.valor)])].map(Qt=>Qt.map(nr=>`"${nr}"`).join(";")).join(`
`),Oe=new Blob(["\uFEFF"+Ie],{type:"text/csv;charset=utf-8;"}),Yt=URL.createObjectURL(Oe),Pt=document.createElement("a");Pt.href=Yt,Pt.download=`produtos_vendidos_${dr(new Date,"yyyy-MM-dd")}.csv`,Pt.click(),URL.revokeObjectURL(Yt),t({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ws,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-purple-500/10 border-purple-500/40 text-purple-400 hover:bg-purple-500/20",onClick:()=>{const ee=S.slice(0,50).map((Ie,Oe)=>[Oe+1,Ie.nome,Ye(Ie.valor)]);ce("Produtos Mais Vendidos",["#","Produto","Faturamento"],ee,"produtos_vendidos")},children:[a.jsx(Ix,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),S.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem produtos vendidos no perodo."}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{className:"w-16",children:"#"}),a.jsx(ka,{children:"Produto"}),a.jsx(ka,{className:"text-right",children:"Faturamento"})]})}),a.jsx(lc,{children:S.slice(0,20).map((ee,Ie)=>a.jsxs(zs,{children:[a.jsx(ca,{className:"text-text-secondary font-mono",children:Ie+1}),a.jsx(ca,{className:"font-medium",children:ee.nome}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.valor)})]},`${ee.nome}-${Ie}`))})]}),S.length>20&&a.jsx("div",{className:"text-center mt-4",children:a.jsxs(Z,{variant:"ghost",size:"sm",className:"text-brand hover:text-brand/80",onClick:()=>V(!0),children:["Ver todos os ",S.length," produtos"]})})]})]}),a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(mc,{className:"w-5 h-5 text-warning"}),"Clientes que Mais Consomem"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Ranking por faturamento total"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-warning/10 border-warning/40 text-warning hover:bg-warning/20",onClick:()=>{const Ie=[["Posio","Cliente","Faturamento"],...M.slice(0,50).map((Qt,nr)=>[nr+1,Qt.nome,Ye(Qt.valor)])].map(Qt=>Qt.map(nr=>`"${nr}"`).join(";")).join(`
`),Oe=new Blob(["\uFEFF"+Ie],{type:"text/csv;charset=utf-8;"}),Yt=URL.createObjectURL(Oe),Pt=document.createElement("a");Pt.href=Yt,Pt.download=`clientes_top_${dr(new Date,"yyyy-MM-dd")}.csv`,Pt.click(),URL.revokeObjectURL(Yt),t({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ws,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-warning/10 border-warning/40 text-warning hover:bg-warning/20",onClick:()=>{const ee=M.slice(0,50).map((Ie,Oe)=>[Oe+1,Ie.nome,Ye(Ie.valor)]);ce("Clientes que Mais Consomem",["#","Cliente","Total Gasto"],ee,"clientes_top")},children:[a.jsx(Ix,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),M.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem dados de clientes no perodo."}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{className:"w-16",children:"#"}),a.jsx(ka,{children:"Cliente"}),a.jsx(ka,{className:"text-right",children:"Total Gasto"})]})}),a.jsx(lc,{children:M.slice(0,20).map((ee,Ie)=>a.jsxs(zs,{children:[a.jsx(ca,{className:"text-text-secondary font-mono",children:Ie+1}),a.jsx(ca,{className:"font-medium",children:ee.nome}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.valor)})]},`${ee.nome}-${Ie}`))})]}),M.length>20&&a.jsx("div",{className:"text-center mt-4",children:a.jsxs(Z,{variant:"ghost",size:"sm",className:"text-brand hover:text-brand/80",onClick:()=>be(!0),children:["Ver todos os ",M.length," clientes"]})})]})]}),a.jsxs(Fr.div,{variants:sc,className:"fx-card p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Lm,{className:"w-5 h-5 text-success"}),"Evoluo Diria de Receitas"]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Faturamento dia a dia no perodo"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const Ie=[["Data","Receita"],...I.map(Qt=>[Qt.data,Ye(Qt.valor)])].map(Qt=>Qt.map(nr=>`"${nr}"`).join(";")).join(`
`),Oe=new Blob(["\uFEFF"+Ie],{type:"text/csv;charset=utf-8;"}),Yt=URL.createObjectURL(Oe),Pt=document.createElement("a");Pt.href=Yt,Pt.download=`evolucao_diaria_${dr(new Date,"yyyy-MM-dd")}.csv`,Pt.click(),URL.revokeObjectURL(Yt),t({title:"Relatrio exportado",description:"CSV salvo com sucesso"})},children:[a.jsx(ws,{className:"w-4 h-4 mr-2"}),"CSV"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"bg-success/10 border-success/40 text-success hover:bg-success/20",onClick:()=>{const ee=I.map(Ie=>[Ie.data,Ye(Ie.valor)]);ce("Evoluo Diria de Receitas",["Data","Receita"],ee,"evolucao_diaria")},children:[a.jsx(Ix,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}),I.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem dados de evoluo no perodo."}):a.jsx("div",{className:"h-80",children:a.jsx(Gb,{width:"100%",height:"100%",children:a.jsxs(Vee,{data:I,margin:{top:5,right:20,bottom:5,left:0},children:[a.jsx(BS,{strokeDasharray:"3 3",stroke:"#2a2a2a"}),a.jsx(bp,{dataKey:"data",stroke:"#888",tick:{fill:"#888",fontSize:11},tickFormatter:ee=>{const Ie=ee.split("/");return`${Ie[0]}/${Ie[1]}`}}),a.jsx(wp,{stroke:"#888",tick:{fill:"#888",fontSize:11},tickFormatter:ee=>`R$ ${(ee/1e3).toFixed(0)}k`}),a.jsx(Dc,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px"},labelStyle:{color:"#fff"},itemStyle:{color:"#22C55E"},formatter:ee=>[Ye(ee),"Receita"]}),a.jsx(jy,{type:"monotone",dataKey:"valor",stroke:"#22C55E",strokeWidth:2,dot:{fill:"#22C55E",r:4},activeDot:{r:6}})]})})})]})]})]}),a.jsx(Un,{open:Gr,onOpenChange:ha,children:a.jsxs(zn,{className:"max-w-lg",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-xl font-bold",children:"Detalhes do Recebimento"}),a.jsx(ma,{children:pn?.origem==="Comanda"?"Operao de comanda":pn?.origem==="Agendamento"?"Operao de agendamento":"Operao"})]}),pn&&a.jsxs("div",{className:"space-y-3 text-sm",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Data/Hora"}),a.jsx("div",{className:"font-medium",children:pn.recebido_em?new Date(pn.recebido_em).toLocaleString("pt-BR"):""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Valor"}),a.jsx("div",{className:"font-semibold",children:Ye(pn.valor)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Origem"}),a.jsx("div",{children:pn.origem||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Fonte"}),a.jsx("div",{children:pn.fonte?pn.fonte.toUpperCase():""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Finalizadora"}),a.jsx("div",{children:pn.finalizadoras?.nome||pn.metodo||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Status"}),a.jsx("div",{children:pn.status||""})]})]}),pn.origem==="Comanda"&&a.jsxs("div",{className:"mt-2 p-3 rounded border border-border",children:[a.jsx("div",{className:"font-semibold mb-2",children:"Comanda"}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Cliente"}),a.jsx("div",{children:pn.descricao||""})]})}),a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"text-text-muted mb-1",children:"Produtos"}),We?a.jsx("div",{className:"text-xs text-text-muted",children:"Carregando itens..."}):cn.length===0?a.jsx("div",{className:"text-xs text-text-muted",children:"Sem itens encontrados."}):a.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:cn.map((ee,Ie)=>a.jsxs("div",{className:"text-xs flex justify-between gap-3",children:[a.jsxs("div",{className:"truncate",children:[a.jsx("span",{className:"font-mono",children:lr(ee.quantidade)}),a.jsx("span",{children:" x "}),a.jsx("span",{className:"font-medium",children:ee.descricao})]}),a.jsx("div",{className:"whitespace-nowrap",children:Ye(Number(ee.preco_unitario||0)*Number(ee.quantidade||0))})]},Ie))})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("div",{className:"text-text-muted mb-1",children:"Pagamentos"}),Je.length===0?a.jsx("div",{className:"text-xs text-text-muted",children:"Sem pagamentos adicionais."}):a.jsxs("div",{className:"space-y-1",children:[Je.map((ee,Ie)=>a.jsxs("div",{className:"text-xs flex justify-between gap-3",children:[a.jsx("div",{className:"truncate",children:a.jsx("span",{className:"font-medium",children:ee.finalizadoras?.nome||ee.metodo||""})}),a.jsx("div",{className:"whitespace-nowrap",children:Ye(ee.valor)})]},ee.id||Ie)),a.jsxs("div",{className:"text-xs flex justify-between gap-3 pt-2 border-t border-border",children:[a.jsx("div",{className:"font-semibold",children:"Total"}),a.jsx("div",{className:"font-semibold",children:Ye(Je.reduce((ee,Ie)=>ee+Number(Ie.valor||0),0))})]})]})]})]}),pn.origem==="Agendamento"&&a.jsxs("div",{className:"mt-2 p-3 rounded border border-border",children:[a.jsx("div",{className:"font-semibold mb-2",children:"Agendamento"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Cdigo"}),a.jsxs("div",{className:"font-mono",children:["#",pn.agendamento_codigo]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-muted",children:"Participante"}),a.jsx("div",{children:pn.participante_nome})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("div",{className:"text-text-muted",children:"Quadra"}),a.jsx("div",{children:pn.quadra_nome||""})]})]})]})]})]})}),a.jsx(Un,{open:F,onOpenChange:V,children:a.jsxs(zn,{className:"max-w-2xl bg-surface text-text-primary border-0",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Todos os Produtos"}),a.jsx(ma,{children:"Ordenados por valor de vendas"})]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Produto"}),a.jsx(ka,{className:"text-center",children:"Quantidade"}),a.jsx(ka,{className:"text-right",children:"Valor Total"})]})}),a.jsx(lc,{children:S.map((ee,Ie)=>a.jsxs(zs,{children:[a.jsxs(ca,{children:[Ie+1,". ",ee.nome]}),a.jsxs(ca,{className:"text-center",children:["x",ee.quantidade]}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.valor)})]},`${ee.nome}-${Ie}`))})]})})]})}),a.jsx(Un,{open:ft,onOpenChange:bt,children:a.jsxs(zn,{className:"sm:max-w-[900px] w-full max-h-[85vh] overflow-y-auto bg-surface text-text-primary border-0",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Fechamento do Caixa"}),a.jsxs(ma,{children:[Bt?.sessao?.aberto_em?`${new Date(Bt.sessao.aberto_em).toLocaleString("pt-BR")}`:"",Bt?.sessao?.fechado_em?`  ${new Date(Bt.sessao.fechado_em).toLocaleString("pt-BR")}`:""]})]}),Lt?a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando..."}):Bt?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Inicial"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:Ye(Bt.sessao?.saldo_inicial)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Total do Dia"}),a.jsx("p",{className:"text-2xl font-bold text-success tabular-nums",children:(()=>{const ee=Number(Bt.resumo?.totalEntradas||0),Ie=Array.isArray(Bt.movimentacoes)?Bt.movimentacoes:[];let Oe=0,Yt=0,Pt=0,Qt=0;for(const fn of Ie){const J=String(fn?.tipo||"").toLowerCase(),Xe=Number(fn?.valor||0);J==="suprimento"?Oe+=Xe:J==="sangria"?Yt+=Xe:J==="troco"?Pt+=Xe:J==="ajuste"&&(Qt+=Xe)}const nr=ee+Oe+Qt-Yt-Pt;return Ye(nr)})()})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:(()=>{const ee=Bt&&typeof Bt.valorFinalContado=="number"?Bt.valorFinalContado:null;return ee!=null?Ye(ee):""})()})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Descontos"}),a.jsx("p",{className:"text-2xl font-bold text-warning tabular-nums",children:Ye(Bt.resumo?.totalDescontos)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Lquido"}),a.jsx("p",{className:"text-2xl font-bold tabular-nums",children:Ye(Bt.resumo?.totalVendasLiquidas)})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Entradas por Finalizadora"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:Bt.resumo?.totalPorFinalizadora&&Object.keys(Bt.resumo.totalPorFinalizadora).length>0?Object.entries(Bt.resumo.totalPorFinalizadora).map(([ee,Ie])=>a.jsxs("div",{className:"bg-surface-2 rounded-md p-2 border border-border flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-text-secondary truncate",children:String(ee)}),a.jsx("span",{className:"text-sm font-semibold",children:Ye(Ie)})]},ee)):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem pagamentos."})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Movimentaes"}),!Bt.movimentacoes||Bt.movimentacoes.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem movimentaes nesta sesso."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Data"}),a.jsx(ka,{children:"Tipo"}),a.jsx(ka,{children:"Obs"}),a.jsx(ka,{className:"text-right",children:"Valor"})]})}),a.jsx(lc,{children:Bt.movimentacoes.map(ee=>a.jsxs(zs,{children:[a.jsx(ca,{children:ee.created_at?new Date(ee.created_at).toLocaleString("pt-BR"):""}),a.jsx(ca,{className:"capitalize",children:ee.tipo||""}),a.jsx(ca,{className:"truncate max-w-[280px]",title:ee.observacao||"",children:ee.observacao||""}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.valor)})]},ee.id))})]})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Recebimentos"}),!Bt.pagamentos||Bt.pagamentos.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem recebimentos no perodo deste caixa."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Data/Hora"}),a.jsx(ka,{children:"Finalizadora"}),a.jsx(ka,{className:"text-right",children:"Valor"}),a.jsx(ka,{children:"Status"})]})}),a.jsx(lc,{children:Bt.pagamentos.map(ee=>a.jsxs(zs,{children:[a.jsx(ca,{children:ee.recebido_em?new Date(ee.recebido_em).toLocaleString("pt-BR"):""}),a.jsx(ca,{children:ee.finalizadoras?.nome||ee.metodo||""}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.valor)}),a.jsx(ca,{children:ee.status||""})]},ee.id))})]})})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados."})]})}),a.jsx(Un,{open:me,onOpenChange:ee=>{be(ee),ee||(L(null),ie([]))},children:a.jsxs(zn,{className:"max-w-2xl bg-surface text-text-primary border-0",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Clientes"}),a.jsx(ma,{children:"Ordenados por valor pago no perodo selecionado"})]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto border border-border rounded-md",children:a.jsxs(oc,{children:[a.jsx(ic,{children:a.jsxs(zs,{children:[a.jsx(ka,{children:"Cliente"}),a.jsx(ka,{className:"text-right",children:"Pago"})]})}),a.jsx(lc,{children:M.map((ee,Ie)=>a.jsxs(zs,{className:"cursor-pointer hover:bg-brand/10",onClick:async()=>{pe(!0),L(ee),W(!0);try{const Oe=ia(u),Yt=Kn(h),Pt=(ee.nome||"").trim(),Qt=e?.codigo_empresa;let nr=Q.from("clientes").select("id, nome").eq("codigo_empresa",Qt).ilike("nome",`%${Pt}%`);const{data:fn}=await nr,J=new Set((fn||[]).map(sn=>sn.id));let Xe=Q.from("comanda_clientes").select("comanda_id").eq("codigo_empresa",Qt).ilike("nome_livre",`%${Pt}%`);const{data:He}=await Xe;let fe=new Set((He||[]).map(sn=>sn.comanda_id));if(J.size>0){let sn=Q.from("comanda_clientes").select("comanda_id, cliente_id").eq("codigo_empresa",Qt).in("cliente_id",Array.from(J));const{data:la}=await sn;(la||[]).forEach(Nr=>fe.add(Nr.comanda_id))}const Ve=Array.from(fe);let xe=Q.from("pagamentos").select("id, valor, recebido_em, metodo, finalizadoras!pagamentos_finalizadora_id_fkey(nome), comanda_id, status").in("comanda_id",Ve).neq("status","Cancelado").neq("status","Estornado").order("recebido_em",{ascending:!1}).limit(50);Oe&&(xe=xe.gte("recebido_em",Oe)),Yt&&(xe=xe.lte("recebido_em",Yt));const{data:kt}=await xe,st=kt||[],zt=Array.from(new Set(st.map(sn=>sn.comanda_id).filter(Boolean))),pr={};if(zt.length>0){let sn=Q.from("comandas").select("id, tipo, mesa_id").in("id",zt);const{data:la}=await sn,Nr=Array.from(new Set((la||[]).map(Dn=>Dn.mesa_id).filter(Boolean))),xn={};if(Nr.length>0){let Dn=Q.from("mesas").select("id, numero, nome").in("id",Nr);const{data:Pa}=await Dn;(Pa||[]).forEach(Aa=>{xn[Aa.id]=(Aa.nome||`Mesa ${Aa.numero||""}`).trim()})}(la||[]).forEach(Dn=>{let Pa="";const Aa=String(Dn?.tipo||"").toLowerCase();Aa==="balcao"||Aa==="balco"?Pa="Balco":Aa==="mesa"||Dn.mesa_id?Pa=xn[Dn.mesa_id]||"Mesa":Aa==="agendamento"&&(Pa="Agendamento"),pr[Dn.id]=Pa})}let en=st.map(sn=>({...sn,origem:sn.comanda_id&&pr[sn.comanda_id]||""}));try{const sn=e?.codigo_empresa;let la=[];if(J&&J.size>0){let Na=Q.from("v_agendamento_participantes").select("id, agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text").in("cliente_id",Array.from(J));sn&&(Na=Na.eq("codigo_empresa",sn));const{data:Hn}=await Na;if(la=Hn||[],la.length===0&&sn){let as=Q.from("v_agendamento_participantes").select("id, agendamento_id, cliente_id, valor_cota, status_pagamento, status_pagamento_text").in("cliente_id",Array.from(J));const{data:to}=await as;la=to||[]}}let Nr=[...la];const xn=Array.from(new Set(Nr.map(Na=>Na.agendamento_id).filter(Boolean)));let Dn=new Set;const Pa={};if(xn.length>0){let Na=Q.from("agendamentos").select("id, inicio").in("id",xn);sn&&(Na=Na.eq("codigo_empresa",sn));const{data:Hn}=await Na,as=Oe?new Date(Oe).getTime():null,to=Yt?new Date(Yt).getTime():null;(Hn||[]).forEach(As=>{const Vs=As?.inicio?new Date(As.inicio).getTime():null;Vs!=null&&(as==null||Vs>=as)&&(to==null||Vs<=to)&&Dn.add(As.id),As?.id&&(Pa[As.id]=As.inicio||null)})}Nr=Nr.filter(Na=>Dn.has(Na.agendamento_id));const Aa=new Set;console.debug("[Financeiro][Agendamentos][Detalhe] encontrados:",Nr.length),Nr.forEach(Na=>{const Hn=`${Na.id}`;if(Aa.has(Hn))return;Aa.add(Hn);const as=String(Na.status_pagamento||Na.status_pagamento_text||"pago").toLowerCase();if(["cancelado","estornado"].includes(as))return;const to=Na.finalizadora_nome||Na.metodo||Na.metodo_pagamento||Na.forma_pagamento||"Agendamento";en.push({id:`ag-${Na.id}`,recebido_em:Pa[Na.agendamento_id]||null,finalizadoras:to?{nome:to}:null,metodo:to,origem:"Agendamento",valor:Na.valor_cota})})}catch{}ie(en)}finally{W(!1)}},children:[a.jsx(ca,{children:ee.nome}),a.jsx(ca,{className:"text-right font-semibold",children:Ye(ee.valor)})]},`${ee.nome}-${Ie}`))})]})})]})}),a.jsx(Un,{open:se,onOpenChange:pe,children:a.jsxs(zn,{className:"max-w-5xl w-[95vw] md:w-[90vw] max-h-[85vh] bg-surface text-text-primary border-0 overflow-hidden flex flex-col",children:[a.jsxs(Bn,{className:"flex-shrink-0",children:[a.jsx(Ln,{className:"text-lg md:text-xl",children:"Detalhes do Cliente"}),a.jsx(ma,{className:"text-sm md:text-base",children:U?.nome})]}),U?a.jsxs("div",{className:"space-y-4 flex-1 overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 bg-surface-2 rounded-lg flex-shrink-0",children:[a.jsx("span",{className:"text-sm md:text-base text-text-secondary",children:"Total Pago no Perodo"}),a.jsx("span",{className:"text-lg md:text-2xl font-bold text-success",children:Ye(U.valor)})]}),Y?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Carregando detalhes..."}):H.length===0?a.jsx("div",{className:"text-sm text-text-muted text-center py-8",children:"Sem pagamentos no perodo selecionado."}):a.jsx("div",{className:"flex-1 overflow-auto border border-border rounded-md",children:a.jsxs(oc,{children:[a.jsx(ic,{className:"sticky top-0 bg-surface z-10",children:a.jsxs(zs,{children:[a.jsx(ka,{className:"text-xs md:text-sm w-[70px] md:w-auto",children:"Data"}),a.jsx(ka,{className:"text-xs md:text-sm w-[80px] md:w-auto",children:"Finaliz."}),a.jsx(ka,{className:"text-xs md:text-sm w-[60px] md:w-auto",children:"Origem"}),a.jsx(ka,{className:"text-right text-xs md:text-sm w-[70px] md:w-auto",children:"Valor"})]})}),a.jsx(lc,{children:H.map(ee=>a.jsxs(zs,{children:[a.jsx(ca,{className:"text-xs md:text-sm w-[70px] md:w-auto",children:a.jsx("div",{className:"text-[10px] md:text-xs leading-tight",children:ee.recebido_em?new Date(ee.recebido_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""})}),a.jsx(ca,{className:"text-xs md:text-sm w-[80px] md:w-auto",children:a.jsx("div",{className:"truncate max-w-[80px] md:max-w-[200px] text-[10px] md:text-xs",title:ee.finalizadoras?.nome||ee.metodo||"",children:ee.finalizadoras?.nome||ee.metodo||""})}),a.jsx(ca,{className:"text-xs md:text-sm w-[60px] md:w-auto",children:a.jsx("div",{className:"truncate max-w-[60px] md:max-w-[150px] text-[10px] md:text-xs",title:ee.origem||"",children:ee.origem||""})}),a.jsx(ca,{className:"text-right font-semibold text-xs md:text-sm w-[70px] md:w-auto",children:a.jsx("div",{className:"text-[10px] md:text-xs whitespace-nowrap",children:Ye(ee.valor)})})]},ee.id))})]})})]}):a.jsx("div",{className:"text-sm text-text-muted py-8 text-center",children:"Nenhum cliente selecionado"})]})})]})})}const Wot={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.06,delayChildren:.05}}},SF={hidden:{opacity:0,y:12},visible:{opacity:1,y:0,transition:{duration:.35}}};function Hot({children:e,className:t=""}){return a.jsx(Fr.div,{variants:SF,className:`fx-card ${t}`,children:e})}const $k=({icon:e,title:t,value:r,subtitle:n,color:s})=>{const o=e;return a.jsxs(Fr.div,{variants:SF,className:"bg-surface rounded-lg border-2 border-border hover:border-border-hover p-4 flex flex-col justify-between gap-2 transition-all duration-300",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("p",{className:"text-text-secondary text-sm font-semibold",children:t}),a.jsx(o,{className:`w-5 h-5 ${s}`})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-2xl font-bold text-text-primary",children:r}),a.jsx("p",{className:"text-xs text-text-muted",children:n})]})]})};function _V({label:e,...t}){return a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:e}),a.jsx("input",{...t,className:`bg-surface-2 border border-border rounded-md px-3 py-2 text-sm ${t.className||""}`})]})}function Got(){const{toast:e}=Zs(),{userProfile:t,authReady:r}=lo(),n=p.useRef(!1),[s,o]=p.useState(()=>{try{const ge=JSON.parse(localStorage.getItem("quadras:list")||"[]");return Array.isArray(ge)?ge:[]}catch{return[]}}),[i,l]=p.useState(()=>{try{const ge=JSON.parse(localStorage.getItem("quadras:list")||"[]");return!(Array.isArray(ge)&&ge.length>0)}catch{return!0}}),[c,d]=p.useState(!1),[u,f]=p.useState(!1),[h,m]=p.useState({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),[x,g]=p.useState(""),[v,y]=p.useState(!1),[b,w]=p.useState(null),[j,_]=p.useState({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),[C,E]=p.useState(""),[S,A]=p.useState(!0),[M,O]=p.useState({mostUsed:"-",topClient:"-",totalBookings:"-"}),[I,T]=p.useState(!1),[k,q]=p.useState(null),[B,z]=p.useState({0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0}),[F,V]=p.useState([]),[me,be]=p.useState(""),[U,L]=p.useState(""),[H,ie]=p.useState(!1),Y=ge=>{if(!ge)return null;const[wt,Gt]=String(ge).split(":");return`${wt.padStart(2,"0")}:${Gt.padStart(2,"0")}:00`},W=ge=>{const wt=String(ge??"").replace(/\D/g,"");if(!wt)return"";const Gt=(Number(wt)/100).toFixed(2),[Sr,wr]=Gt.split(".");return`${Sr.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${wr}`},se=ge=>{if(ge==null||ge==="")return NaN;const wt=String(ge).replace(/\./g,"").replace(",","."),Gt=parseFloat(wt);return Number.isFinite(Gt)?Gt:NaN},pe=(ge,wt=!1)=>{if(ge==null||!Number.isFinite(Number(ge)))return"-";const Sr=Number(ge).toFixed(2).split("."),wr=Sr[0],he=Sr[1],Vt=`${wr.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${he}`;return wt?`R$ ${Vt}`:Vt},G=ge=>{if(!ge)return"";const[wt,Gt]=String(ge).split(":");return`${String(wt).padStart(2,"0")}:${String(Gt).padStart(2,"0")}`},te=ge=>{if(!ge)return 0;const[wt,Gt]=String(ge).split(":").map(Number);return(wt===0&&Gt===0?24:wt||0)*60+(Gt||0)},oe=ge=>{if(!ge)return!1;const wt=String(ge).split(":");if(wt.length<2)return!1;const Gt=Number(wt[1]);return Gt===0||Gt===30},De=ge=>{if(!ge)return"";const[wt,Gt]=String(ge).split(":");let Sr=Math.max(0,Math.min(23,parseInt(wt||"0",10))),wr=Math.max(0,Math.min(59,parseInt(Gt||"0",10)));const he=Math.round(wr/30);if(he>=2?(Sr+=1,wr=0):wr=he*30,Sr>=24)return"23:59";const ot=String(Sr).padStart(2,"0"),Vt=String(wr).padStart(2,"0");return`${ot}:${Vt}`};p.useEffect(()=>{if(!c)return;const ge=setTimeout(()=>{console.error("[Quadras] add/update stuck >15s",{route:"/quadras",codigo_empresa:t?.codigo_empresa,editingId:b,formQuadra:h,editForm:j})},15e3);return()=>clearTimeout(ge)},[c,t?.codigo_empresa,b,h,j]);const re=async()=>{if(!t?.codigo_empresa)return;const ge=s&&s.length>0;ge||l(!0);const{data:wt,error:Gt}=await Q.from("quadras").select("*").eq("codigo_empresa",t.codigo_empresa).order("nome",{ascending:!0});if(Gt){if(!n.current){n.current=!0,setTimeout(re,800),ge||l(!1);return}e({title:"Erro ao carregar quadras",description:Gt.message}),ge||l(!1);return}const Sr=wt||[];if(Sr.length===0&&ge&&!n.current){n.current=!0,setTimeout(re,600),ge||l(!1);return}n.current=!1,o(Sr);try{localStorage.setItem("quadras:list",JSON.stringify(Sr))}catch{}ge||l(!1)},ae=ge=>{w(ge.id),_({nome:ge.nome||"",descricao:ge.descricao||"",modalidades:Array.isArray(ge.modalidades)?ge.modalidades:ge.modalidades?[ge.modalidades]:[],tipo:ge.tipo||"Descoberta",status:ge.status||"Ativa",hora_inicio:G(ge.hora_inicio||"06:00:00"),hora_fim:G(ge.hora_fim||"24:00:00")||"23:59",valor_hora:ge.valor!=null&&ge.valor!==""?W(String((Number(ge.valor)*2).toFixed(2))):""}),E(""),y(!0)},ut=async()=>{if(!j.nome?.trim()){e({title:"Nome obrigatrio",description:"Informe um nome para a quadra."});return}if(!j.hora_inicio||!j.hora_fim){e({title:"Horrio obrigatrio",description:"Informe horrio de abertura e fechamento."});return}if(!oe(j.hora_inicio)||!oe(j.hora_fim)){e({title:"Intervalo invlido",description:"Use apenas horrios em horas cheias ou :30."});return}if(te(j.hora_fim)<=te(j.hora_inicio)){e({title:"Horrio invlido",description:"Fechamento deve ser depois da abertura."});return}if(!j.modalidades?.length){e({title:"Adicione ao menos uma modalidade",description:"Informe e adicione uma modalidade usando o boto +."});return}if(!t?.codigo_empresa||!b){e({title:"Atualizao indisponvel",description:"Dados insuficientes para atualizar."});return}d(!0);const ge={nome:j.nome.trim(),descricao:j.descricao?.trim()||null,modalidades:j.modalidades,tipo:j.tipo,status:j.status,hora_inicio:Y(j.hora_inicio),hora_fim:Y(j.hora_fim==="24:00"?"23:59":j.hora_fim)};if(j.valor_hora!=null&&String(j.valor_hora).trim()!==""){const wr=se(j.valor_hora);!Number.isNaN(wr)&&Number.isFinite(wr)&&(ge.valor=Math.round(wr/2*100)/100)}else ge.valor=null;const wt=(wr,he)=>Promise.race([wr,new Promise((ot,Vt)=>setTimeout(()=>Vt(new Error("Timeout ao atualizar quadra (>12s)")),he))]);let Gt,Sr;try{({data:Gt,error:Sr}=await wt(Q.from("quadras").update(ge).eq("codigo_empresa",t.codigo_empresa).eq("id",b).select("id,nome,descricao,modalidades,tipo,status,hora_inicio,hora_fim,valor").single(),12e3))}catch(wr){console.error("update timeout/error",wr),e({title:"Tempo excedido",description:"Sem resposta do servidor ao atualizar. Verifique conexo e tente novamente."}),d(!1);return}if(d(!1),Sr){e({title:"Erro ao atualizar quadra",description:Sr.message});return}if(!Gt){await re(),e({title:"Quadra atualizada",description:`${ge.nome} foi atualizada.`}),y(!1),w(null),E("");return}e({title:"Quadra atualizada",description:`${Gt.nome} foi atualizada.`}),y(!1),w(null),E(""),o(wr=>wr.map(he=>he.id===Gt.id?Gt:he).sort((he,ot)=>he.nome.localeCompare(ot.nome)))};p.useEffect(()=>{try{const ge=JSON.parse(localStorage.getItem("quadras:list")||"[]");Array.isArray(ge)&&ge.length&&s.length===0&&(o(ge),l(!1))}catch{}},[]),p.useEffect(()=>{r&&t?.codigo_empresa&&(re(),pt())},[r,t?.codigo_empresa]);const pt=async()=>{if(t?.codigo_empresa)try{const ge=new Date;ge.setDate(ge.getDate()-30);const{data:wt}=await Q.from("agendamentos").select("quadra_id, cliente_id, quadras!inner(nome), clientes(nome, codigo)").eq("codigo_empresa",t.codigo_empresa).gte("inicio",ge.toISOString()).neq("status","canceled");if(!wt||wt.length===0){O({mostUsed:"Sem dados",topClient:"Sem dados",totalBookings:"0"});return}const Gt={};wt.forEach(ot=>{const Vt=ot.quadras?.nome||"Sem nome";Gt[Vt]=(Gt[Vt]||0)+1});const Sr=Object.entries(Gt).sort((ot,Vt)=>Vt[1]-ot[1])[0],wr={};wt.forEach(ot=>{if(ot.cliente_id&&ot.clientes?.nome){const Vt=ot.clientes?.codigo;if(Vt===0||Vt==="0")return;const qt=ot.clientes.nome;wr[qt]=(wr[qt]||0)+1}});const he=Object.entries(wr).sort((ot,Vt)=>Vt[1]-ot[1])[0];O({mostUsed:Sr?`${Sr[0]} (${Sr[1]})`:"Sem dados",topClient:he?`${he[0]} (${he[1]})`:"Sem dados",totalBookings:wt.length.toString()})}catch(ge){console.error("Erro ao carregar stats:",ge),O({mostUsed:"Erro",topClient:"Erro",totalBookings:"0"})}},ft=async()=>{if(console.groupCollapsed("[Quadras] addQuadra: CLICK"),console.time("[Quadras] addQuadra duration"),console.log("pre-validate",{codigo_empresa:t?.codigo_empresa,formQuadra:h}),!h.nome?.trim()){e({title:"Nome obrigatrio",description:"Informe um nome para a quadra."}),console.warn("validation: missing nome"),console.groupEnd();return}if(!h.modalidades?.length){e({title:"Adicione ao menos uma modalidade",description:"Informe e adicione uma modalidade usando o boto +."});return}if(!h.hora_inicio||!h.hora_fim){e({title:"Horrio obrigatrio",description:"Informe horrio de abertura e fechamento."});return}if(!oe(h.hora_inicio)||!oe(h.hora_fim)){e({title:"Intervalo invlido",description:"Use apenas horrios em horas cheias ou :30."});return}if(te(h.hora_fim)<=te(h.hora_inicio)){e({title:"Horrio invlido",description:"Fechamento deve ser depois da abertura."});return}if(!t?.codigo_empresa){e({title:"Empresa no localizada",description:"Associe o usurio a uma empresa para cadastrar quadras."});return}d(!0),console.log("validated, building payload");const ge={codigo_empresa:t.codigo_empresa,nome:h.nome.trim(),descricao:h.descricao?.trim()||null,modalidades:h.modalidades,tipo:h.tipo,status:h.status,hora_inicio:Y(h.hora_inicio),hora_fim:Y(h.hora_fim==="24:00"?"23:59":h.hora_fim)};if(h.valor_hora!=null&&String(h.valor_hora).trim()!==""){const wr=se(h.valor_hora);!Number.isNaN(wr)&&Number.isFinite(wr)&&(ge.valor=Math.round(wr/2*100)/100)}console.log("payload",ge);const wt=(wr,he)=>Promise.race([wr,new Promise((ot,Vt)=>setTimeout(()=>Vt(new Error("Timeout ao inserir quadra (>12s)")),he))]);let Gt,Sr;try{({data:Gt,error:Sr}=await wt(Q.from("quadras").insert(ge).select("id,nome,descricao,modalidades,tipo,status,hora_inicio,hora_fim,valor").single(),12e3))}catch(wr){d(!1),console.error("insert timeout/error",wr),e({title:"Tempo excedido",description:"Sem resposta do servidor ao cadastrar. Verifique conexo e tente novamente."}),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}if(d(!1),Sr){e({title:"Erro ao cadastrar quadra",description:Sr.message}),console.error("insert error",{code:Sr.code,message:Sr.message,details:Sr.details}),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}if(!Gt){console.warn("insert success sem representao; recarregando lista"),await re(),e({title:"Quadra adicionada",description:`${ge.nome} foi cadastrada.`}),m({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),f(!1),g(""),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd();return}console.log("insert success",{id:Gt?.id,nome:Gt?.nome}),e({title:"Quadra adicionada",description:`${Gt.nome} foi cadastrada.`}),m({nome:"",descricao:"",modalidades:[],tipo:"Descoberta",status:"Ativa",hora_inicio:"06:00",hora_fim:"23:59",valor_hora:""}),f(!1),g(""),o(wr=>[Gt,...wr].sort((he,ot)=>he.nome.localeCompare(ot.nome))),console.timeEnd("[Quadras] addQuadra duration"),console.groupEnd()},bt=async ge=>{q(ge),ie(!0);try{const{data:wt,error:Gt}=await Q.from("quadras_dias_funcionamento").select("*").eq("quadra_id",ge.id).eq("codigo_empresa",t.codigo_empresa);if(Gt)throw Gt;const Sr={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0},wr=[];wt?.forEach(he=>{he.tipo==="dia_semana"?Sr[he.dia_semana]=he.funciona:he.tipo==="data_fechamento"&&wr.push(he)}),z(Sr),V(wr),T(!0)}catch(wt){console.error("Erro ao carregar dias de funcionamento:",wt),e({title:"Erro",description:"No foi possvel carregar as configuraes."})}finally{ie(!1)}},Lt=async()=>{if(k){ie(!0);try{await Q.from("quadras_dias_funcionamento").delete().eq("quadra_id",k.id).eq("tipo","dia_semana");const ge=Object.entries(B).map(([Gt,Sr])=>({quadra_id:k.id,codigo_empresa:t.codigo_empresa,tipo:"dia_semana",dia_semana:parseInt(Gt),funciona:Sr,observacao:"Configurao de dias da semana"})),{error:wt}=await Q.from("quadras_dias_funcionamento").insert(ge);if(wt)throw wt;e({title:"Sucesso",description:"Dias da semana salvos com sucesso!"})}catch(ge){console.error("Erro ao salvar dias da semana:",ge),e({title:"Erro",description:"No foi possvel salvar as configuraes."})}finally{ie(!1)}}},Dt=async()=>{if(!(!k||!me)){ie(!0);try{const{data:ge,error:wt}=await Q.from("quadras_dias_funcionamento").insert({quadra_id:k.id,codigo_empresa:t.codigo_empresa,tipo:"data_fechamento",data_fechamento:me,funciona:!1,observacao:U||"Fechamento especial"}).select().single();if(wt)throw wt;V(Gt=>[...Gt,ge]),be(""),L(""),e({title:"Sucesso",description:"Data de fechamento adicionada!"})}catch(ge){console.error("Erro ao adicionar data de fechamento:",ge),e({title:"Erro",description:"No foi possvel adicionar a data de fechamento."})}finally{ie(!1)}}},Bt=async ge=>{ie(!0);try{const{error:wt}=await Q.from("quadras_dias_funcionamento").delete().eq("id",ge);if(wt)throw wt;V(Gt=>Gt.filter(Sr=>Sr.id!==ge)),e({title:"Sucesso",description:"Data de fechamento removida!"})}catch(wt){console.error("Erro ao remover data de fechamento:",wt),e({title:"Erro",description:"No foi possvel remover a data de fechamento."})}finally{ie(!1)}};return a.jsx(a.Fragment,{children:a.jsxs(Fr.div,{variants:Wot,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsxs(Fr.div,{variants:SF,className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-black text-text-primary tracking-tighter",children:"Controle de Quadras"}),a.jsx("p",{className:"text-text-secondary",children:"Gerencie as quadras e horrios disponveis."})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{variant:"outline",size:"icon",onClick:()=>A(ge=>!ge),title:S?"Ocultar resumo":"Mostrar resumo","aria-label":S?"Ocultar resumo":"Mostrar resumo",children:S?a.jsx(kg,{className:"h-4 w-4"}):a.jsx(Xg,{className:"h-4 w-4"})}),a.jsx(Z,{onClick:()=>f(!0),className:"shadow-sm",children:"Adicionar Quadra"})]})]}),S&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsx($k,{icon:jd,title:"Quadra Mais Usada",value:M.mostUsed,subtitle:"ltimos 30 dias",color:"text-brand"}),a.jsx($k,{icon:mc,title:"Cliente Top",value:M.topClient,subtitle:"Mais agendamentos no ms",color:"text-purple"}),a.jsx($k,{icon:Lm,title:"Total de Agendamentos",value:M.totalBookings,subtitle:"ltimos 30 dias",color:"text-success"})]}),a.jsxs(Hot,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Quadras"}),a.jsx("div",{className:"text-xs text-text-muted",children:i?"Carregando...":`${s.length} registro(s)`})]}),!i&&s.length===0?a.jsxs("div",{className:"text-sm text-text-muted py-8 text-center",children:[a.jsx("div",{className:"font-medium mb-1",children:"Nenhuma quadra cadastrada"}),a.jsx("div",{className:"mb-4",children:'Clique em "Adicionar Quadra" para cadastrar a primeira.'}),a.jsx(Z,{onClick:()=>f(!0),children:"Adicionar Quadra"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden space-y-3",children:s.map(ge=>a.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:wh(ge.nome),boxShadow:"0 0 0 2px rgba(255,255,255,0.06)"},"aria-hidden":"true"}),a.jsx("span",{className:"font-semibold text-base text-text-primary truncate",children:ge.nome})]}),a.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs border flex-shrink-0 ${ge.status==="Ativa"?"bg-emerald-50/5 border-emerald-500/30 text-emerald-400":ge.status==="Manuteno"?"bg-amber-50/5 border-amber-500/30 text-amber-400":"bg-surface-2 border-border text-text-muted"}`,children:ge.status})]}),Array.isArray(ge.modalidades)&&ge.modalidades.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted mb-1 block",children:"Modalidades"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:ge.modalidades.map(wt=>a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-xs",children:wt},wt))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Valor/hora"}),a.jsx("span",{className:"text-sm font-medium",children:ge.valor==null||ge.valor===""?"-":pe(Number(ge.valor)*2,!0)})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-text-muted block mb-1",children:"Funcionamento"}),a.jsxs("span",{className:"text-sm font-medium",children:[G(ge.hora_inicio)," - ",G(ge.hora_fim==="24:00:00"?"23:59:00":ge.hora_fim)]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>bt(ge),className:"flex items-center gap-1",children:[a.jsx(Io,{className:"h-3 w-3"}),"Dias"]}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>ae(ge),children:"Editar"})]})]},ge.id))}),a.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-border bg-surface-0",children:a.jsxs(oc,{children:[a.jsx(ic,{className:"bg-surface-2/60 backdrop-blur supports-[backdrop-filter]:bg-surface-2/70",children:a.jsxs(zs,{children:[a.jsx(ka,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Nome"}),a.jsx(ka,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Modalidades"}),a.jsx(ka,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Valor por hora"}),a.jsx(ka,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Funcionamento"}),a.jsx(ka,{className:"text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Status"}),a.jsx(ka,{className:"text-right text-[11px] md:text-xs uppercase tracking-wide text-text-muted",children:"Aes"})]})}),a.jsx(lc,{children:s.map(ge=>a.jsxs(zs,{className:"hover:bg-surface-2/40 transition-colors",children:[a.jsx(ca,{className:"font-medium text-sm md:text-base text-text-primary",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:wh(ge.nome),boxShadow:"0 0 0 2px rgba(255,255,255,0.06)"},"aria-hidden":"true"}),a.jsx("span",{children:ge.nome})]})}),a.jsx(ca,{className:"text-sm md:text-base",children:Array.isArray(ge.modalidades)&&ge.modalidades.length>0?a.jsx("div",{className:"flex flex-wrap gap-1",children:ge.modalidades.map(wt=>a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-[11px] md:text-xs",children:wt},wt))}):ge.modalidades||""}),a.jsx(ca,{className:"text-sm md:text-base",children:ge.valor==null||ge.valor===""?"-":a.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-surface-2 border border-border text-[11px] md:text-xs",children:pe(Number(ge.valor)*2,!0)})}),a.jsxs(ca,{className:"text-sm md:text-base",children:[G(ge.hora_inicio)," - ",G(ge.hora_fim==="24:00:00"?"23:59:00":ge.hora_fim)]}),a.jsx(ca,{className:"text-sm md:text-base",children:a.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-[11px] md:text-xs border ${ge.status==="Ativa"?"bg-emerald-50/5 border-emerald-500/30 text-emerald-400":ge.status==="Manuteno"?"bg-amber-50/5 border-amber-500/30 text-amber-400":"bg-surface-2 border-border text-text-muted"}`,children:ge.status})}),a.jsx(ca,{className:"text-right",children:a.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[a.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>bt(ge),className:"text-sm",children:[a.jsx(Io,{className:"h-3 w-3 mr-1"}),"Dias"]}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>ae(ge),className:"text-sm",children:"Editar"})]})})]},ge.id))})]})})]})]}),a.jsx(Un,{open:u,onOpenChange:f,children:a.jsxs(zn,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Adicionar Quadra"}),a.jsx(ma,{children:"Cadastre uma nova quadra da sua empresa."})]}),a.jsxs("div",{className:"grid gap-4 py-2",children:[a.jsx(_V,{label:"Nome",value:h.nome,onChange:ge=>m({...h,nome:ge.target.value}),placeholder:"Ex.: Quadra Society 2"}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Descrio (opcional)"}),a.jsx("textarea",{value:h.descricao,onChange:ge=>m({...h,descricao:ge.target.value}),placeholder:"Ex.: Quadra oficial com grama sinttica, iluminao LED, vestirios completos",rows:3,className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm resize-none"})]}),a.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Modalidades"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:x,onChange:ge=>g(ge.target.value),onKeyDown:ge=>{if(ge.key==="Enter"){ge.preventDefault();const wt=x.trim();if(!wt)return;m(Gt=>Gt.modalidades.some(wr=>wr.toLowerCase()===wt.toLowerCase())?Gt:{...Gt,modalidades:[...Gt.modalidades,wt]}),g("")}},placeholder:"Ex.: Society",className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-60 sm:w-72 focus:outline-none focus:ring-2 focus:ring-primary/30"}),a.jsx(Z,{type:"button",variant:"secondary",className:"bg-amber-500 hover:bg-amber-400 text-black disabled:opacity-50 disabled:cursor-not-allowed",disabled:!x.trim(),onClick:()=>{const ge=x.trim();ge&&(m(wt=>wt.modalidades.some(Sr=>Sr.toLowerCase()===ge.toLowerCase())?wt:{...wt,modalidades:[...wt.modalidades,ge]}),g(""))},"aria-label":"Adicionar modalidade",title:"Adicionar modalidade",children:"+"})]}),h.modalidades.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:h.modalidades.map(ge=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border bg-surface-2 text-xs",children:[a.jsx("span",{className:"px-0.5",children:ge}),a.jsx("button",{type:"button",className:"text-text-muted hover:text-destructive/80",onClick:()=>m(wt=>({...wt,modalidades:wt.modalidades.filter(Gt=>Gt!==ge)})),"aria-label":`Remover ${ge}`,title:`Remover ${ge}`,children:""})]},ge))})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Tipo"}),a.jsxs("select",{value:h.tipo,onChange:ge=>m({...h,tipo:ge.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Descoberta"}),a.jsx("option",{children:"Coberta"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Valor por hora (R$)"}),a.jsx("input",{type:"text",inputMode:"decimal",step:"0.01",placeholder:"0,00",value:h.valor_hora,onChange:ge=>m({...h,valor_hora:W(ge.target.value)}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-40"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Abertura"}),a.jsx("input",{type:"time",step:"1800",value:h.hora_inicio,onChange:ge=>m({...h,hora_inicio:ge.target.value}),onBlur:ge=>m(wt=>({...wt,hora_inicio:De(ge.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Fechamento"}),a.jsx("input",{type:"time",step:"1800",value:h.hora_fim,onChange:ge=>m({...h,hora_fim:ge.target.value}),onBlur:ge=>m(wt=>({...wt,hora_fim:De(ge.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Status"}),a.jsxs("select",{value:h.status,onChange:ge=>m({...h,status:ge.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Ativa"}),a.jsx("option",{children:"Inativa"}),a.jsx("option",{children:"Manuteno"})]})]})]}),a.jsx(Ga,{children:a.jsx(Z,{onClick:ft,disabled:c||h.modalidades.length===0,children:c?"Adicionando...":"Salvar"})})]})}),a.jsx(Un,{open:v,onOpenChange:y,children:a.jsxs(zn,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Editar Quadra"}),a.jsx(ma,{children:"Atualize os dados da quadra selecionada."})]}),a.jsxs("div",{className:"grid gap-4 py-2",children:[a.jsx(_V,{label:"Nome",value:j.nome,onChange:ge=>_({...j,nome:ge.target.value}),placeholder:"Ex.: Quadra Society 2"}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Descrio (opcional)"}),a.jsx("textarea",{value:j.descricao,onChange:ge=>_({...j,descricao:ge.target.value}),placeholder:"Ex.: Quadra oficial com grama sinttica, iluminao LED, vestirios completos",rows:3,className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm resize-none"})]}),a.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Modalidades"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:C,onChange:ge=>E(ge.target.value),onKeyDown:ge=>{if(ge.key==="Enter"){ge.preventDefault();const wt=C.trim();if(!wt)return;_(Gt=>Gt.modalidades.some(wr=>wr.toLowerCase()===wt.toLowerCase())?Gt:{...Gt,modalidades:[...Gt.modalidades,wt]}),E("")}},placeholder:"Ex.: Society",className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-60 sm:w-72 focus:outline-none focus:ring-2 focus:ring-primary/30"}),a.jsx(Z,{type:"button",variant:"secondary",onClick:()=>{const ge=C.trim();ge&&(_(wt=>wt.modalidades.some(Sr=>Sr.toLowerCase()===ge.toLowerCase())?wt:{...wt,modalidades:[...wt.modalidades,ge]}),E(""))},children:"+"})]}),j.modalidades.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:j.modalidades.map(ge=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-border bg-surface-2 text-xs",children:[a.jsx("span",{className:"px-0.5",children:ge}),a.jsx("button",{type:"button",className:"text-text-muted hover:text-destructive/80",onClick:()=>_(wt=>({...wt,modalidades:wt.modalidades.filter(Gt=>Gt!==ge)})),"aria-label":`Remover ${ge}`,title:`Remover ${ge}`,children:""})]},ge))})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Tipo"}),a.jsxs("select",{value:j.tipo,onChange:ge=>_({...j,tipo:ge.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Descoberta"}),a.jsx("option",{children:"Coberta"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Valor por hora (R$)"}),a.jsx("input",{type:"text",inputMode:"decimal",step:"0.01",placeholder:"0,00",value:j.valor_hora,onChange:ge=>_({...j,valor_hora:W(ge.target.value)}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm w-40"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Abertura"}),a.jsx("input",{type:"time",step:"1800",value:j.hora_inicio,onChange:ge=>_({...j,hora_inicio:ge.target.value}),onBlur:ge=>_(wt=>({...wt,hora_inicio:De(ge.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Fechamento"}),a.jsx("input",{type:"time",step:"1800",value:j.hora_fim,onChange:ge=>_({...j,hora_fim:ge.target.value}),onBlur:ge=>_(wt=>({...wt,hora_fim:De(ge.target.value)})),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Status"}),a.jsxs("select",{value:j.status,onChange:ge=>_({...j,status:ge.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{children:"Ativa"}),a.jsx("option",{children:"Inativa"}),a.jsx("option",{children:"Manuteno"})]})]})]}),a.jsx(Ga,{children:a.jsx(Z,{onClick:ut,disabled:c||j.modalidades.length===0,children:c?"Salvando...":"Salvar alteraes"})})]})}),a.jsx(Un,{open:I,onOpenChange:T,children:a.jsxs(zn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-hidden pointer-events-none",children:[a.jsx("div",{className:"fixed inset-0 z-50 backdrop-blur-lg bg-black/60 flex items-center justify-center pointer-events-auto",children:a.jsx("div",{className:"rounded-2xl border border-white/30 bg-slate-900 shadow-2xl max-w-sm w-full text-center mx-4",children:a.jsxs("div",{className:"px-8 py-10",children:[a.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[a.jsx("div",{className:"w-14 h-14 bg-brand rounded-xl flex items-center justify-center flex-shrink-0",children:a.jsx(jd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline select-none",children:[a.jsx("span",{className:"font-extrabold text-3xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-3xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-3xl",style:{color:"#FFFFFF"},children:" Arena"})]})]}),a.jsx("div",{className:"text-2xl font-bold text-white mb-3",children:"Em Desenvolvimento"}),a.jsx("p",{className:"text-base text-gray-200",children:"Esta funcionalidade est sendo desenvolvida e em breve estar disponvel."}),a.jsx("div",{className:"mt-8 flex items-center justify-center",children:a.jsx(Z,{variant:"outline",onClick:()=>T(!1),children:"Fechar"})})]})})}),a.jsxs(Bn,{children:[a.jsxs(Ln,{className:"flex items-center gap-2",children:[a.jsx(Io,{className:"h-5 w-5"}),"Dias de Funcionamento - ",k?.nome]}),a.jsx(ma,{children:"Configure os dias da semana que a quadra funciona e adicione datas especficas de fechamento."})]}),H?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"text-sm text-text-muted",children:"Carregando configuraes..."})}):a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:"Dias da Semana"}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{key:0,label:"Domingo",short:"Dom"},{key:1,label:"Segunda",short:"Seg"},{key:2,label:"Tera",short:"Ter"},{key:3,label:"Quarta",short:"Qua"},{key:4,label:"Quinta",short:"Qui"},{key:5,label:"Sexta",short:"Sex"},{key:6,label:"Sbado",short:"Sb"}].map(ge=>a.jsxs("label",{className:"flex items-center gap-2 p-3 rounded-lg border border-border hover:bg-surface-2/50 cursor-pointer transition-colors",children:[a.jsx("input",{type:"checkbox",checked:B[ge.key],onChange:wt=>z(Gt=>({...Gt,[ge.key]:wt.target.checked})),className:"w-4 h-4 text-primary bg-surface-2 border-border rounded focus:ring-primary focus:ring-2"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-medium text-text-primary",children:ge.short}),a.jsx("span",{className:"text-xs text-text-muted hidden sm:block",children:ge.label})]})]},ge.key))}),a.jsx("div",{className:"mt-4",children:a.jsx(Z,{onClick:Lt,disabled:H,size:"sm",children:H?"Salvando...":"Salvar Dias da Semana"})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:"Datas de Fechamento"}),a.jsx("div",{className:"bg-surface-2/30 rounded-lg p-4 mb-4",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Data"}),a.jsx("input",{type:"date",value:me,onChange:ge=>be(ge.target.value),className:"w-full bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Observao"}),a.jsx("input",{type:"text",placeholder:"Ex: Feriado, Manuteno",value:U,onChange:ge=>L(ge.target.value),className:"w-full bg-surface-2 border border-border rounded-md px-3 py-2 text-sm"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx(Z,{onClick:Dt,disabled:!me||H,size:"sm",className:"w-full sm:w-auto",children:"Adicionar"})})]})}),F.length>0?a.jsx("div",{className:"space-y-2",children:F.map(ge=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-2/50 rounded-lg border border-border",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(pu,{className:"h-4 w-4 text-text-muted"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-text-primary",children:new Date(ge.data_fechamento+"T00:00:00").toLocaleDateString("pt-BR")}),ge.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:ge.observacao})]})]}),a.jsx(Z,{variant:"outline",size:"sm",onClick:()=>Bt(ge.id),disabled:H,className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:a.jsx(Hc,{className:"h-3 w-3"})})]},ge.id))}):a.jsx("div",{className:"text-center py-6 text-sm text-text-muted",children:"Nenhuma data de fechamento configurada"})]})]}),a.jsx(Ga,{children:a.jsx(Z,{variant:"outline",onClick:()=>T(!1),children:"Fechar"})})]})})]})})}function xf(e){const t=String(e||"").toLowerCase();return t.includes("/producao")||t.includes("/produo")?"producao":"homologacao"}async function vf({acao:e,ambiente:t,cnpj:r,dados:n}){const s={acao:e,ambiente:t||"homologacao",cnpj:(r||"").replace(/\D/g,""),dados:n||{}},{data:o,error:i}=await Q.functions.invoke("emissor",{body:s});if(i){const l=new Error(i.message||"Erro na API fiscal");throw l.response=i,l}if(o&&o.status&&o.status>=400&&!o.ok){const l=new Error(o.message||"Erro na API fiscal");throw l.status=o.status,l.response=o.response,l}return o}async function Kot({baseUrl:e,apiKey:t,cnpj:r}){try{const n=xf(e),s=await vf({acao:"teste_conexao",ambiente:n,cnpj:r,dados:{}}),o=s?.status,i={via:s?.via||"edge",ambiente:s?.ambiente||n};return o===200?{reachable:!0,authorized:!0,status:o,response:s?.response,meta:i}:o===400?{reachable:!0,authorized:!0,status:o,response:s?.response,meta:i}:o===401||o===403?{reachable:!0,authorized:!1,status:o,response:s?.response,meta:i}:o===404?{reachable:!1,authorized:!1,status:o,response:s?.response,meta:i}:{reachable:!0,authorized:null,status:o,response:s?.response,meta:i}}catch(n){return{reachable:!1,authorized:!1,error:n?.message||String(n)}}}async function NV({baseUrl:e,apiKey:t,cnpj:r,dados:n}){if(!r)throw new Error("cnpj obrigatrio");if(!n)throw new Error("dados obrigatrio");const s=xf(e);return vf({acao:"nfce_enviar",ambiente:s,cnpj:r,dados:n})}async function tv({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfce_consultar",ambiente:s,cnpj:r,dados:n})}async function SV({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfce_cancelar",ambiente:s,cnpj:r,dados:n})}async function rv({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfce_pdf",ambiente:s,cnpj:r,dados:n})}async function nv({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfce_xml",ambiente:s,cnpj:r,dados:n})}async function Xot({baseUrl:e,apiKey:t,cnpj:r,dados:n}){if(!r)throw new Error("cnpj obrigatrio");if(!n)throw new Error("dados obrigatrio");const s=xf(e),o={...n};try{delete o.Numero}catch{}try{delete o.Serie}catch{}return vf({acao:"nfe_enviar",ambiente:s,cnpj:r,dados:o})}async function i2({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfe_consultar",ambiente:s,cnpj:r,dados:n})}async function Yot({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfe_cancelar",ambiente:s,cnpj:r,dados:n})}async function l2({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfe_pdf",ambiente:s,cnpj:r,dados:n})}async function c2({baseUrl:e,apiKey:t,cnpj:r,dados:n}){const s=xf(e);return vf({acao:"nfe_xml",ambiente:s,cnpj:r,dados:n})}function rl(e){const t=(e?.ambiente||"homologacao").toLowerCase(),r=t==="producao",n=r?e?.transmitenota_base_url_prod||e?.transmitenota_base_url||"":e?.transmitenota_base_url_hml||e?.transmitenota_base_url||"",s=r?e?.transmitenota_apikey_prod||e?.transmitenota_apikey||"":e?.transmitenota_apikey_hml||e?.transmitenota_apikey||"";return{baseUrl:n||(r?"/api/producao":"/api/homologacao"),apiKey:s,ambiente:t,cnpj:(e?.cnpj||"").replace(/\D/g,"")}}const Jot={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.06,delayChildren:.05}}},Qot={hidden:{opacity:0,y:12},visible:{opacity:1,y:0,transition:{duration:.35}}};function CV({children:e,className:t=""}){return a.jsx(Fr.div,{variants:Qot,className:`fx-card ${t}`,children:e})}function Pi({label:e,...t}){return a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:e}),a.jsx("input",{...t,className:`bg-surface-2 border border-border rounded-md px-3 py-2 text-sm ${t.className||""}`})]})}function Zot(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,18)}function eit(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,15)}function um(e){return String(e||"").replace(/\D/g,"")}function tit(){const{toast:e}=Zs(),{company:t,userProfile:r,reloadCompany:n}=lo(),[s,o]=p.useState(!1),[i,l]=p.useState({razao_social:"",nome_fantasia:"",cnpj:"",email:"",telefone:"",endereco:"",logo_url:"",inscricao_estadual:"",regime_tributario:"",ambiente:"homologacao",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",nfce_serie:"1",nfce_numeracao:"1",nfce_itoken:"",nfe_serie:"",nfe_numeracao:"",transmitenota_apikey:"",transmitenota_base_url:"",transmitenota_base_url_hml:"",transmitenota_apikey_hml:"",transmitenota_base_url_prod:"",transmitenota_apikey_prod:""}),c=p.useRef(null),[d,u]=p.useState(""),f=p.useRef(!0);p.useEffect(()=>(f.current=!0,()=>{f.current=!1}),[]),p.useEffect(()=>{(async()=>{try{const y=r?.codigo_empresa||null;if(!y)return;const b=`empresa:form:${y}`;try{const E=localStorage.getItem(b);if(E){const S=JSON.parse(E);S&&typeof S=="object"&&(l(A=>({...A,...S})),S.logo_url&&u(`${S.logo_url.split("?")[0]}?v=${Date.now()}`))}}catch{}const w=setTimeout(()=>{if(f.current)try{const E=localStorage.getItem(b);if(E){const S=JSON.parse(E);S&&typeof S=="object"&&(console.warn("[Empresas] slow fallback: using cached form"),l(A=>({...A,...S})),S.logo_url&&u(`${S.logo_url.split("?")[0]}?v=${Date.now()}`))}}catch{}},5e3),{data:j,error:_}=await Q.from("empresas").select("*").eq("codigo_empresa",y).single();if(clearTimeout(w),_)throw _;if(!f.current)return;const C={razao_social:j?.razao_social||"",nome_fantasia:j?.nome_fantasia||j?.nome||"",cnpj:j?.cnpj||"",email:j?.email||"",telefone:j?.telefone||"",endereco:j?.endereco||"",logo_url:j?.logo_url||"",inscricao_estadual:j?.inscricao_estadual||"",regime_tributario:j?.regime_tributario!=null?String(j.regime_tributario):"",ambiente:j?.ambiente||"homologacao",logradouro:j?.logradouro||"",numero:j?.numero||"",complemento:j?.complemento||"",bairro:j?.bairro||"",cidade:j?.cidade||"",uf:j?.uf||"",cep:j?.cep||"",codigo_municipio_ibge:j?.codigo_municipio_ibge||"",nfce_serie:j?.nfce_serie!=null?String(j.nfce_serie):"1",nfce_numeracao:j?.nfce_numeracao!=null?String(j.nfce_numeracao):"1",nfce_itoken:j?.nfce_itoken||"",nfe_serie:j?.nfe_serie!=null?String(j.nfe_serie):"",nfe_numeracao:j?.nfe_numeracao!=null?String(j.nfe_numeracao):"",transmitenota_apikey:j?.transmitenota_apikey||"",transmitenota_base_url:j?.transmitenota_base_url||"",transmitenota_base_url_hml:j?.transmitenota_base_url_hml||"",transmitenota_apikey_hml:j?.transmitenota_apikey_hml||"",transmitenota_base_url_prod:j?.transmitenota_base_url_prod||"",transmitenota_apikey_prod:j?.transmitenota_apikey_prod||""};l(C),u(C.logo_url?`${C.logo_url.split("?")[0]}?v=${Date.now()}`:"");try{localStorage.setItem(b,JSON.stringify(C))}catch{}}catch(y){console.warn("Falha ao carregar empresa:",y)}})()},[r?.codigo_empresa]),p.useEffect(()=>{if(!i.logo_url){u("");return}const v=i.logo_url.split("?")[0];u(`${v}?v=${Date.now()}`)},[i.logo_url]);const h=async v=>{if(v.preventDefault(),!s){if(!i.razao_social?.trim()||!i.cnpj?.trim()){e({title:"Campos obrigatrios",description:"Preencha Razo Social e CNPJ."});return}if(!r?.codigo_empresa){e({title:"Empresa no vinculada",description:"No foi possvel identificar a empresa do usurio para salvar."});return}try{o(!0);const y={nome:i.nome_fantasia||i.razao_social||"Empresa",razao_social:i.razao_social||null,nome_fantasia:i.nome_fantasia||null,cnpj:i.cnpj?.replace(/\D/g,"")||null,email:i.email||null,telefone:i.telefone||null,endereco:i.endereco||null,logo_url:i.logo_url||null,inscricao_estadual:i.inscricao_estadual?.trim()||null,regime_tributario:i.regime_tributario?Number(i.regime_tributario):null,ambiente:i.ambiente||"homologacao",logradouro:i.logradouro?.trim()||null,numero:i.numero?.trim()||null,complemento:i.complemento?.trim()||null,bairro:i.bairro?.trim()||null,cidade:i.cidade?.trim()||null,uf:(i.uf||"").toUpperCase().slice(0,2)||null,cep:um(i.cep)||null,codigo_municipio_ibge:i.codigo_municipio_ibge?.trim()||null,nfce_serie:i.nfce_serie?Number(i.nfce_serie):null,nfce_numeracao:i.nfce_numeracao?Number(i.nfce_numeracao):null,nfce_itoken:i.nfce_itoken?.trim()||null,nfe_serie:i.nfe_serie?Number(i.nfe_serie):null,nfe_numeracao:i.nfe_numeracao?Number(i.nfe_numeracao):null,transmitenota_apikey:i.transmitenota_apikey?.trim()||null,transmitenota_base_url:i.transmitenota_base_url?.trim()||null,transmitenota_base_url_hml:i.transmitenota_base_url_hml?.trim()||null,transmitenota_apikey_hml:i.transmitenota_apikey_hml?.trim()||null,transmitenota_base_url_prod:i.transmitenota_base_url_prod?.trim()||null,transmitenota_apikey_prod:i.transmitenota_apikey_prod?.trim()||null},b=async(w,j=1)=>{try{const{error:_}=await Q.from("empresas").upsert({codigo_empresa:r.codigo_empresa,...w},{onConflict:"codigo_empresa"}).select("id").single();if(_)throw _;return!0}catch(_){const E=String(_?.message||"").match(/the '([^']+)' column|column\s+"([^"]+)"\s+of/i),S=E&&(E[1]||E[2])?E[1]||E[2]:null;if(S&&w.hasOwnProperty(S)&&j<=5){console.warn("[Empresas] Removendo coluna inexistente e tentando novamente:",S);const A={...w};return delete A[S],await b(A,j+1)}throw _}};await b(y),await n?.(),e({title:"Dados salvos",description:"As informaes da empresa foram atualizadas."})}catch(y){console.error(y);const b=(y?.message||y?.hint||"").toString()||"No foi possvel salvar os dados. Verifique as permisses e tente novamente.";e({title:"Erro ao salvar",description:b})}finally{o(!1)}}},m=async v=>{try{const y=v.target.files?.[0];if(!y)return;if(!r?.codigo_empresa){e({title:"Empresa no vinculada",description:"Seu usurio no est associado a uma empresa."});return}const b=y.name.split(".").pop()?.toLowerCase()||"png",w=`${r.codigo_empresa}/logo.${b}`,j=(()=>{try{return(localStorage.getItem("custom-auth-token")||"").trim()}catch{return""}})();if(j){const E=`${yO}/storage/v1/object/logos/${w}`,S=await fetch(E,{method:"POST",headers:{Authorization:`Bearer ${j}`,apikey:bO,"x-upsert":"true","Content-Type":y.type||"application/octet-stream"},body:y});if(!S.ok){const A=await S.text();let M;try{M=A?JSON.parse(A):null}catch{}const O=M?.message||M?.error||S.statusText||"Falha no upload",I=new Error(O);throw I.status=S.status,I.response=M||A,I}}else{const{data:{session:E}}=await Q.auth.getSession(),S=E?.access_token||"";if(S){const A=`${yO}/storage/v1/object/logos/${w}`,M=await fetch(A,{method:"POST",headers:{Authorization:`Bearer ${S}`,apikey:bO,"x-upsert":"true","Content-Type":y.type||"application/octet-stream"},body:y});if(!M.ok){const O=await M.text();let I;try{I=O?JSON.parse(O):null}catch{}const T=I?.message||I?.error||M.statusText||"Falha no upload",k=new Error(T);throw k.status=M.status,k.response=I||O,k}}else{const{error:A}=await Q.storage.from("logos").upload(w,y,{upsert:!0,contentType:y.type||void 0});if(A)throw A}}const{data:_}=Q.storage.from("logos").getPublicUrl(w),C=_?.publicUrl||"";l(E=>({...E,logo_url:C})),u(C?`${C}?v=${Date.now()}`:""),e({title:"Logo enviada",description:"A imagem foi carregada com sucesso. Lembre-se de salvar."})}catch(y){console.error("Falha no upload da logo:",y),e({title:"Erro no upload",description:"No foi possvel enviar a logo. Tente outro arquivo."})}finally{c.current&&(c.current.value="")}};function x(v){return String(v||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim()}async function g(){const v=um(i.cnpj);if(v.length!==14){e({title:"CNPJ invlido",description:"Informe 14 dgitos para buscar.",variant:"destructive"});return}try{o(!0);const y=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${v}`);if(!y.ok){let k="Falha ao consultar CNPJ";try{const q=await y.json();q?.message&&(k=q.message)}catch{}throw new Error(k)}const b=await y.json();try{console.info("[empresas] BuscarCNPJ:payload",b)}catch{}const w=b.razao_social||b.nome||"",j=b.nome_fantasia||"",_=b.logradouro||"",C=(b.numero||"").toString(),E=b.complemento||"",S=b.bairro||"",A=b.municipio||b.localidade||"",M=b.uf||"",O=um(b.cep);let I="";try{if(A&&M){const k=await fetch(`https://brasilapi.com.br/api/ibge/municipios/v1/${M}`);if(k.ok){const q=await k.json(),B=x(A),z=(q||[]).find(F=>x(F.nome)===B);(z?.codigo_ibge||z?.codigo)&&(I=String(z.codigo_ibge||z.codigo))}}}catch{}const T=`${_}${C?", "+C:""}${S?" - "+S:""}${A||M?" - "+A+"/"+M:""}`;l(k=>({...k,razao_social:w,nome_fantasia:j||w,logradouro:_,numero:C,complemento:E,bairro:S,cidade:A,uf:M,cep:O,endereco:T||k.endereco,codigo_municipio_ibge:I||""}));try{console.info("[empresas] BuscarCNPJ:setForm",{razao:w,fantasia:j,logradouro:_,numero:C,complemento:E,bairro:S,cidade:A,uf:M,cep:O,codigoIBGE:I,enderecoFull:T})}catch{}e({title:"CNPJ carregado",description:"Dados preenchidos automaticamente."})}catch(y){e({title:"Falha ao buscar CNPJ",description:y.message||"Tente novamente.",variant:"destructive"})}finally{o(!1)}}return a.jsx(a.Fragment,{children:a.jsxs(Fr.div,{variants:Jot,initial:"hidden",animate:"visible",className:"space-y-6",children:[a.jsx(CV,{children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("h1",{className:"text-xl font-bold text-text-primary",children:"Cadastros  Empresa"})})}),a.jsxs(CV,{children:[a.jsx("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Dados da Empresa"}),a.jsxs("form",{onSubmit:h,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsx(Pi,{label:"Razo Social",value:i.razao_social,onChange:v=>l({...i,razao_social:v.target.value}),placeholder:"Ex.: Fluxo7 Arena LTDA"}),a.jsx(Pi,{label:"Nome Fantasia",value:i.nome_fantasia,onChange:v=>l({...i,nome_fantasia:v.target.value}),placeholder:"Ex.: Fluxo7 Arena"}),a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Pi,{label:"CNPJ",type:"text",inputMode:"numeric",value:i.cnpj,onChange:v=>l({...i,cnpj:Zot(v.target.value)}),placeholder:"00.000.000/0000-00"})}),a.jsx(Z,{type:"button",variant:"outline",onClick:g,disabled:s,children:"Buscar CNPJ"})]}),a.jsx(Pi,{label:"Email",type:"email",value:i.email,onChange:v=>l({...i,email:v.target.value}),placeholder:"contato@empresa.com"}),a.jsx(Pi,{label:"Telefone",type:"tel",inputMode:"tel",value:i.telefone,onChange:v=>l({...i,telefone:eit(v.target.value)}),placeholder:"(11) 99999-9999"}),a.jsx(Pi,{label:"Endereo",value:i.endereco,onChange:v=>l({...i,endereco:v.target.value}),placeholder:"Rua, nmero, bairro, cidade",className:"md:col-span-2 lg:col-span-2"}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(Pi,{label:"Inscrio Estadual",value:i.inscricao_estadual,onChange:v=>l({...i,inscricao_estadual:v.target.value})}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Regime Tributrio (CRT)"}),a.jsxs("select",{value:i.regime_tributario,onChange:v=>l({...i,regime_tributario:v.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Selecione"}),a.jsx("option",{value:"1",children:"1 - Simples Nacional"}),a.jsx("option",{value:"2",children:"2 - Simples (excesso sublimite)"}),a.jsx("option",{value:"3",children:"3 - Regime Normal"})]})]}),a.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Ambiente"}),a.jsxs("select",{value:i.ambiente,onChange:v=>l({...i,ambiente:v.target.value}),className:"bg-surface-2 border border-border rounded-md px-3 py-2 text-sm",children:[a.jsx("option",{value:"homologacao",children:"Homologao"}),a.jsx("option",{value:"producao",children:"Produo"})]})]})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-6 gap-4",children:[a.jsx("div",{className:"md:col-span-3",children:a.jsx(Pi,{label:"Logradouro",value:i.logradouro,onChange:v=>l({...i,logradouro:v.target.value})})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(Pi,{label:"Nmero",value:i.numero,onChange:v=>l({...i,numero:v.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Pi,{label:"Complemento",value:i.complemento,onChange:v=>l({...i,complemento:v.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Pi,{label:"Bairro",value:i.bairro,onChange:v=>l({...i,bairro:v.target.value})})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Pi,{label:"Cidade",value:i.cidade,onChange:v=>l({...i,cidade:v.target.value})})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(Pi,{label:"UF",value:i.uf,onChange:v=>l({...i,uf:(v.target.value||"").toUpperCase().slice(0,2)}),placeholder:"UF"})}),a.jsx("div",{className:"md:col-span-1",children:a.jsx(Pi,{label:"CEP",value:i.cep,onChange:v=>l({...i,cep:um(v.target.value).slice(0,8)}),placeholder:"00000000"})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(Pi,{label:"Cdigo IBGE Municpio (cMun)",value:i.codigo_municipio_ibge,onChange:v=>l({...i,codigo_municipio_ibge:um(v.target.value).slice(0,7)})})})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(Pi,{label:"NFC-e Srie",value:i.nfce_serie,onChange:v=>l({...i,nfce_serie:um(v.target.value).slice(0,3)})}),a.jsx(Pi,{label:"NFC-e Numerao Inicial",value:i.nfce_numeracao,onChange:v=>l({...i,nfce_numeracao:um(v.target.value).slice(0,9)})}),a.jsx(Pi,{label:"NFC-e IToken (CSC)",value:i.nfce_itoken,onChange:v=>l({...i,nfce_itoken:v.target.value})})]}),a.jsxs("div",{className:"md:col-span-2 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(Pi,{label:"NF-e Srie (opcional)",value:i.nfe_serie,onChange:v=>l({...i,nfe_serie:um(v.target.value).slice(0,3)})}),a.jsx(Pi,{label:"NF-e Numerao (opcional)",value:i.nfe_numeracao,onChange:v=>l({...i,nfe_numeracao:um(v.target.value).slice(0,9)})})]}),!1,a.jsx("div",{className:"md:col-span-2 lg:col-span-2 grid grid-cols-1 gap-3",children:a.jsxs("div",{className:"flex items-center gap-4",children:[d||i.logo_url?a.jsx("img",{src:d||i.logo_url,alt:"Logo da empresa",className:"w-16 h-16 rounded-md object-cover border border-border"}):a.jsx("div",{className:"w-16 h-16 rounded-md border border-dashed border-border/60 bg-surface-2/40 flex items-center justify-center text-xs text-text-muted",children:"Sem logo"}),a.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[a.jsx("span",{className:"text-xs text-text-muted",children:"Upload da Logo"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>c.current?.click(),className:"px-3",children:"Escolher imagem"}),a.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:m,className:"hidden"}),(d||i.logo_url)&&a.jsx("span",{className:"text-xs text-text-muted truncate max-w-[260px]",title:i.logo_url||d,children:"Logo selecionada"})]}),a.jsx("span",{className:"text-[11px] text-text-muted",children:"Formatos: PNG/JPG. Tamanho recomendado: 256x256."})]})]})}),a.jsx("div",{className:"flex items-end",children:a.jsx(Z,{type:"submit",className:"w-full md:w-auto",disabled:s,children:s?"Salvando...":"Salvar"})})]})]})]})})}const rit={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},V2={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},AV=[{codigo:"01",nome:"Dinheiro"},{codigo:"02",nome:"Cheque"},{codigo:"03",nome:"Carto de Crdito"},{codigo:"04",nome:"Carto de Dbito"},{codigo:"05",nome:"Carto da Loja (Private Label)"},{codigo:"10",nome:"Vale Alimentao"},{codigo:"11",nome:"Vale Refeio"},{codigo:"12",nome:"Vale Presente"},{codigo:"13",nome:"Vale Combustvel"},{codigo:"14",nome:"Duplicata Mercantil"},{codigo:"15",nome:"Boleto Bancrio"},{codigo:"16",nome:"Depsito Bancrio"},{codigo:"17",nome:"PIX Dinmico (QR-Code)"},{codigo:"18",nome:"Transferncia Bancria / Carteira Digital"},{codigo:"19",nome:"Programa de Fidelidade / Cashback"},{codigo:"20",nome:"PIX Esttico"},{codigo:"21",nome:"Crdito em Loja"},{codigo:"22",nome:"Pagamento Eletrnico no Informado"},{codigo:"90",nome:"Sem Pagamento"},{codigo:"99",nome:"Outros"}],Bk=({icon:e,title:t,value:r,subtitle:n,color:s,onClick:o,isActive:i})=>a.jsx(Fr.div,{variants:V2,onClick:o,className:Pr("bg-surface rounded-lg border md:border-2 p-3 md:p-4 transition-all text-center h-[90px] md:h-auto",o?"cursor-pointer hover:shadow-md":"",i?`border-${s} bg-${s}/5`:"border-border",o&&!i?"hover:border-border-hover":""),children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 md:flex-row md:items-center md:gap-3 h-full",children:[a.jsx("div",{className:Pr("p-1.5 md:p-2 rounded-lg",`bg-${s}/10`),children:a.jsx(e,{className:Pr("w-4 h-4 md:w-5 md:h-5",`text-${s}`)})}),a.jsxs("div",{className:"flex-1 md:text-left",children:[a.jsx("p",{className:"text-base md:text-2xl font-bold text-text-primary leading-none",children:r}),a.jsx("p",{className:"text-[10px] md:text-xs font-semibold text-text-secondary md:mt-0.5",children:t}),a.jsx("p",{className:"hidden md:block text-xs text-text-muted",children:n})]})]})});function nit(){const{toast:e}=Zs(),{userProfile:t,authReady:r}=lo(),[n,s]=p.useState([]),[o,i]=p.useState(!1),[l,c]=p.useState(!1),[d,u]=p.useState(""),[f,h]=p.useState("all"),[m,x]=p.useState("all"),[g,v]=p.useState(!0),[y,b]=p.useState(null),[w,j]=p.useState(!1),[_,C]=p.useState(null),[E,S]=p.useState({codigo_interno:"",codigo_sefaz:"",nome:"",taxa_percentual:"",ativo:!0}),[A,M]=p.useState(!1),[O,I]=p.useState(""),[T,k]=p.useState(!1),[q,B]=p.useState(null),[z,F]=p.useState(null),[V,me]=p.useState(!1),[be,U]=p.useState("mes"),[L,H]=p.useState(!1),[ie,Y]=p.useState([]),[W,se]=p.useState("customizado"),[pe,G]=p.useState(""),[te,oe]=p.useState(""),[De,re]=p.useState(!1),[ae,ut]=p.useState(!1);p.useEffect(()=>{const he=()=>{try{ut(typeof window<"u"&&window.innerWidth<=640)}catch{}};return he(),window.addEventListener("resize",he),()=>window.removeEventListener("resize",he)},[]);const pt=async()=>{try{i(!0);const he=t?.codigo_empresa;if(!he)return;const ot=await Fh({somenteAtivas:!1,codigoEmpresa:he});console.log(" Finalizadoras carregadas:",ot),console.log(" Primeira finalizadora:",ot?.[0]),s(Array.isArray(ot)?ot:[])}catch(he){e({title:"Erro ao carregar",description:he?.message,variant:"destructive"})}finally{i(!1)}},ft=p.useMemo(()=>{const he=n.length,ot=n.filter(Ct=>Ct.ativo).length,Vt=n.length>0?n.reduce((Ct,Wt)=>{const Er=Wt.nome||"Sem nome";return Ct[Er]=(Ct[Er]||0)+1,Ct},{}):{},qt=Object.entries(Vt).sort((Ct,Wt)=>Wt[1]-Ct[1])[0],Re=qt?qt[0]:"-";return{total:he,ativas:ot,maisUsada:Re}},[n]),bt=p.useMemo(()=>{let he=[...n];if(d){const ot=d.toLowerCase();he=he.filter(Vt=>{const qt=String(Vt.tipo||"").toLowerCase(),Re=String(Vt.nome||"").toLowerCase(),Ct=String(Vt.codigo_interno||"").toLowerCase(),Wt=ot.replace(/\D/g,""),Er=String(Vt.codigo_interno||"").replace(/\D/g,"");return qt.includes(ot)||Re.includes(ot)||Ct.includes(ot)||!!Wt&&Er===Wt})}return f!=="all"&&(he=he.filter(ot=>ot.tipo===f)),m!=="all"&&(he=he.filter(ot=>m==="active"?ot.ativo:!ot.ativo)),y==="ativas"&&(he=he.filter(ot=>ot.ativo)),he.sort((ot,Vt)=>{const qt=parseInt(ot.codigo_interno)||0,Re=parseInt(Vt.codigo_interno)||0;return qt-Re}),he},[n,d,f,m,y]),Lt=()=>{C(null);const he=n.reduce((Vt,qt)=>{const Re=parseInt(qt.codigo_interno)||0;return Re>Vt?Re:Vt},0),ot=String(he+1).padStart(2,"0");S({codigo_interno:ot,codigo_sefaz:"",nome:"",taxa_percentual:"",ativo:!0}),j(!0)},Dt=he=>{C(he),S({codigo_interno:he.codigo_interno||"",codigo_sefaz:he.codigo_sefaz||"",nome:he.nome||"",taxa_percentual:he.taxa_percentual!=null?String(he.taxa_percentual):"",ativo:he.ativo!==!1}),j(!0)},Bt=async(he,ot="mes")=>{try{me(!0);const Vt=t?.codigo_empresa;if(!Vt)return;const qt=new Date;let Re,Ct=qt.toISOString();switch(ot){case"hoje":Re=new Date(qt.setHours(0,0,0,0)).toISOString();break;case"semana":Re=new Date(qt.setDate(qt.getDate()-7)).toISOString();break;case"mes":Re=new Date(qt.setMonth(qt.getMonth()-1)).toISOString();break;default:Re=new Date(qt.setMonth(qt.getMonth()-1)).toISOString()}const{data:Wt,error:Er}=await Q.from("pagamentos").select("valor, recebido_em, status").eq("finalizadora_id",he).eq("codigo_empresa",Vt).gte("recebido_em",Re).lte("recebido_em",Ct).neq("status","Cancelado").neq("status","Estornado");if(Er)throw Er;const Me=Wt?.length||0,lt=Wt?.reduce((br,ur)=>br+(Number(ur.valor)||0),0)||0,gt=Me>0?lt/Me:0,or=Wt?.[Wt.length-1]?.recebido_em||null;F({transacoes:Me,faturamento:lt,ticketMedio:gt,ultimaUtilizacao:or})}catch(Vt){console.error("Erro ao carregar estatsticas:",Vt),e({title:"Erro ao carregar estatsticas",description:Vt?.message,variant:"destructive"})}finally{me(!1)}},ge=async(he="customizado",ot=null,Vt=null)=>{try{re(!0);const qt=t?.codigo_empresa;if(!qt)return;let Re,Ct;if(he==="customizado"&&ot&&Vt)Re=new Date(ot).toISOString(),Ct=new Date(Vt+"T23:59:59").toISOString();else{const gt=new Date;switch(Ct=gt.toISOString(),he){case"hoje":Re=new Date(gt.setHours(0,0,0,0)).toISOString();break;case"semana":Re=new Date(gt.setDate(gt.getDate()-7)).toISOString();break;case"mes":Re=new Date(gt.setMonth(gt.getMonth()-1)).toISOString();break;default:Re=new Date(gt.setMonth(gt.getMonth()-1)).toISOString()}}const{data:Wt,error:Er}=await Q.from("pagamentos").select("finalizadora_id, valor, finalizadoras!pagamentos_finalizadora_id_fkey(id, codigo_interno, nome)").eq("codigo_empresa",qt).gte("recebido_em",Re).lte("recebido_em",Ct).neq("status","Cancelado").neq("status","Estornado");if(Er)throw Er;const Me={};Wt?.forEach(gt=>{const or=gt.finalizadora_id;or&&(Me[or]||(Me[or]={id:or,codigo:gt.finalizadoras?.codigo_interno||"-",nome:gt.finalizadoras?.nome||"Sem nome",total:0,transacoes:0}),Me[or].total+=Number(gt.valor)||0,Me[or].transacoes+=1)});const lt=Object.values(Me).sort((gt,or)=>or.total-gt.total);Y(lt)}catch(qt){console.error("Erro ao carregar ranking:",qt),e({title:"Erro ao carregar ranking",description:qt?.message,variant:"destructive"})}finally{re(!1)}},wt=()=>{H(!0),se("customizado");const he=new Date,ot=new Date;ot.setMonth(ot.getMonth()-1),G(ot.toISOString().split("T")[0]),oe(he.toISOString().split("T")[0]),ge("customizado",ot.toISOString().split("T")[0],he.toISOString().split("T")[0])},Gt=he=>{B(he),k(!0),U("mes"),Bt(he.id,"mes")},Sr=async()=>{try{if(!E.nome?.trim()){e({title:"Nome  obrigatrio",variant:"warning"});return}if(!E.codigo_sefaz){e({title:"Cdigo SEFAZ  obrigatrio",variant:"warning"});return}if(E.codigo_interno?.trim()&&n.some(qt=>qt.codigo_interno===E.codigo_interno.trim()&&(!_||qt.id!==_.id))){e({title:"Cdigo j existe",description:"Este cdigo interno j est em uso por outra finalizadora",variant:"warning"});return}c(!0);const he=t?.codigo_empresa,ot={codigo_interno:E.codigo_interno?.trim()||null,codigo_sefaz:E.codigo_sefaz,nome:E.nome.trim(),tipo:"outros",taxa_percentual:E.taxa_percentual===""?null:Number(E.taxa_percentual),ativo:E.ativo};_?(await lKe(_.id,ot,he),e({title:"Finalizadora atualizada!",variant:"success"})):(await iKe(ot,he),e({title:"Finalizadora criada!",variant:"success"})),j(!1),await pt()}catch(he){e({title:"Erro ao salvar",description:he?.message,variant:"destructive"})}finally{c(!1)}},wr=async he=>{try{await cKe(he.id,!he.ativo,t?.codigo_empresa),e({title:he.ativo?"Desativada":"Ativada",variant:"success"}),await pt()}catch(ot){e({title:"Erro ao alterar status",description:ot?.message,variant:"destructive"})}};return p.useEffect(()=>{r&&t?.codigo_empresa&&pt()},[r,t?.codigo_empresa]),a.jsxs(a.Fragment,{children:[a.jsxs(Fr.div,{variants:rit,initial:"hidden",animate:"visible",className:"flex-1 space-y-6 p-4 md:p-6",children:[a.jsxs(Fr.div,{variants:V2,className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"min-w-0",children:a.jsx("h1",{className:"text-2xl md:text-3xl font-black text-text-primary tracking-tight leading-tight",children:"Finalizadoras"})}),a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx(Z,{variant:"ghost",size:"icon",onClick:()=>v(!g),className:"h-9 w-9",children:g?a.jsx(kg,{className:"h-5 w-5"}):a.jsx(Xg,{className:"h-5 w-5"})}),a.jsxs(Z,{onClick:Lt,className:"gap-2 h-9 px-3 whitespace-nowrap",children:[a.jsx(so,{className:"h-4 w-4"}),a.jsx("span",{className:"md:hidden",children:"Nova"}),a.jsx("span",{className:"hidden md:inline",children:"Nova Finalizadora"})]})]})]}),g&&a.jsxs("div",{className:"grid grid-cols-3 gap-3 md:grid-cols-3 md:gap-6",children:[a.jsx(Bk,{icon:Dh,title:"Total",value:ft.total,subtitle:"Finalizadoras cadastradas",color:"brand"}),a.jsx(Bk,{icon:Wi,title:"Ativas",value:ft.ativas,subtitle:"Disponveis para uso",color:"success",onClick:()=>b(y==="ativas"?null:"ativas"),isActive:y==="ativas"}),a.jsx(Bk,{icon:Lm,title:"Mais Usada",value:ft.maisUsada,subtitle:"Mtodo mais popular",color:"warning",onClick:wt})]}),a.jsx(Fr.div,{variants:V2,className:"bg-surface rounded-lg border border-border p-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative min-w-0 basis-0 flex-grow",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar finalizadora...",value:d,onChange:he=>u(he.target.value),className:"pl-10 h-11"})]}),a.jsxs(Zn,{value:m,onValueChange:x,children:[a.jsx(Yn,{className:"w-[110px] md:w-[180px]",children:a.jsx(ta,{placeholder:"Filtrar por status"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todos"}),a.jsx(nt,{value:"active",children:"Ativas"}),a.jsx(nt,{value:"inactive",children:"Inativas"})]})]})]})}),a.jsx(Fr.div,{variants:V2,className:"bg-surface rounded-lg border border-border overflow-hidden",children:o?a.jsxs("div",{className:"p-12 text-center",children:[a.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand border-r-transparent"}),a.jsx("p",{className:"mt-4 text-text-muted",children:"Carregando..."})]}):bt.length===0?a.jsxs("div",{className:"p-12 text-center text-text-muted",children:[a.jsx(Dh,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"Nenhuma finalizadora encontrada"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"md:hidden divide-y divide-border",children:bt.map(he=>a.jsxs("div",{className:"p-3 flex flex-col gap-2 hover:bg-surface-2/50 cursor-pointer",onClick:()=>Gt(he),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"px-2 py-0.5 rounded-md bg-surface-2 border border-border font-mono text-xs text-text-secondary",children:he.codigo_interno||"-"}),a.jsx("span",{className:"font-semibold text-sm text-text-primary truncate",title:he.nome,children:he.nome})]}),a.jsxs("span",{className:Pr("inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[11px] font-medium",he.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Pr("w-1.5 h-1.5 rounded-full",he.ativo?"bg-success":"bg-muted")}),he.ativo?"Ativa":"Inativa"]})]}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[a.jsx("div",{className:"flex items-center gap-3",children:a.jsxs("span",{children:["Taxa: ",he.taxa_percentual?`${he.taxa_percentual}%`:"-"]})}),a.jsxs("div",{className:"flex items-center gap-2",onClick:ot=>ot.stopPropagation(),children:[a.jsx(Z,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>Dt(he),children:a.jsx(fc,{className:"h-4 w-4"})}),a.jsx(Z,{variant:he.ativo?"ghost":"default",size:"sm",className:"h-7 px-2",onClick:()=>wr(he),children:he.ativo?"Desativar":"Ativar"})]})]})]},he.id))}),a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-surface-2 border-b border-border",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Cdigo"}),a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Descrio"}),a.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-text-secondary",children:"Taxa (%)"}),a.jsx("th",{className:"text-center px-6 py-4 text-sm font-semibold text-text-secondary",children:"Status"}),a.jsx("th",{className:"text-right px-6 py-4 text-sm font-semibold text-text-secondary",children:"Aes"})]})}),a.jsx("tbody",{className:"divide-y divide-border",children:bt.map(he=>a.jsxs("tr",{className:"hover:bg-surface-2/50 transition-colors cursor-pointer",onClick:()=>Gt(he),children:[a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"font-mono text-sm text-text-primary",children:he.codigo_interno||"-"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"font-semibold text-text-primary",children:he.nome})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-text-secondary",children:he.taxa_percentual?`${he.taxa_percentual}%`:"-"})}),a.jsx("td",{className:"px-6 py-4 text-center",children:a.jsxs("span",{className:Pr("inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium",he.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Pr("w-2 h-2 rounded-full",he.ativo?"bg-success":"bg-muted")}),he.ativo?"Ativa":"Inativa"]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex justify-end gap-2",onClick:ot=>ot.stopPropagation(),children:[a.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>Dt(he),children:a.jsx(fc,{className:"h-4 w-4"})}),a.jsx(Z,{variant:he.ativo?"ghost":"default",size:"sm",onClick:()=>wr(he),children:he.ativo?"Desativar":"Ativar"})]})})]},he.id))})]})})]})})]}),a.jsx(Un,{open:w,onOpenChange:j,children:a.jsxs(zn,{className:"sm:max-w-[500px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:_?"Editar Finalizadora":"Nova Finalizadora"}),a.jsx(ma,{children:_?"Atualize as informaes da finalizadora":"Adicione um novo mtodo de pagamento"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{htmlFor:"codigo_interno",children:"Cdigo Finalizadora"}),a.jsx(It,{id:"codigo_interno",type:"text",placeholder:"Ex: 01, 02, 03...",value:E.codigo_interno,onChange:he=>S({...E,codigo_interno:he.target.value})}),a.jsx("p",{className:"text-xs text-text-muted",children:"Gerado automaticamente, mas pode ser editado"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{htmlFor:"nome",children:"Descrio *"}),a.jsx(It,{id:"nome",placeholder:"Ex: PIX, Dinheiro, Carto de Crdito...",value:E.nome,onChange:he=>S({...E,nome:he.target.value})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{htmlFor:"codigo_sefaz",children:"Forma de Pagamento NF-e/NFC-e *"}),a.jsx(Z,{type:"button",variant:"outline",className:"justify-between w-full",onClick:()=>M(!0),children:E.codigo_sefaz?`${E.codigo_sefaz} - ${AV.find(he=>he.codigo===E.codigo_sefaz)?.nome||""}`:"Selecione a forma de pagamento"}),a.jsx("p",{className:"text-xs text-text-muted",children:"A lista abrir em um modal com rolagem."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ct,{htmlFor:"taxa",children:"Taxa"}),a.jsxs("div",{className:"relative",children:[a.jsx(It,{id:"taxa",inputMode:"decimal",placeholder:"0,00",className:"pr-10",value:E.taxa_percentual,onChange:he=>{const ot=String(he.target.value).replace(/[^0-9.,]/g,"").replace(/,/g,".");if(ot===""){S({...E,taxa_percentual:""});return}const Vt=Number(ot);if(Number.isFinite(Vt)){const qt=Math.max(0,Math.min(100,Vt));S({...E,taxa_percentual:String(qt)})}},onBlur:()=>{const he=String(E.taxa_percentual||"").replace(/,/g,".");if(he==="")return;const ot=Number(he);if(Number.isFinite(ot)){const Vt=Math.max(0,Math.min(100,ot));S(qt=>({...qt,taxa_percentual:Vt.toFixed(2)}))}}}),a.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-text-muted text-sm",children:"%"})]}),a.jsx("p",{className:"text-xs text-text-muted",children:"Deixe vazio se no houver taxa"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"ativo",checked:E.ativo,onChange:he=>S({...E,ativo:he.target.checked}),className:"h-4 w-4 rounded border-border"}),a.jsx(ct,{htmlFor:"ativo",className:"text-sm font-normal cursor-pointer",children:"Finalizadora ativa"})]})]}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>j(!1),disabled:l,children:"Cancelar"}),a.jsx(Z,{onClick:Sr,disabled:l,children:l?"Salvando...":"Salvar"})]})]})}),a.jsx(Un,{open:A,onOpenChange:M,children:a.jsxs(zn,{className:"sm:max-w-[520px] w-[92vw]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Selecionar Forma de Pagamento (SEFAZ)"}),a.jsx(ma,{children:"Busque por cdigo ou nome"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(It,{placeholder:"Ex.: 03, crdito, pix...",value:O,onChange:he=>I(he.target.value)}),a.jsx("div",{className:"max-h-[420px] overflow-auto fx-scroll rounded-md border border-border",children:a.jsx("ul",{className:"divide-y divide-border",children:AV.filter(he=>{const ot=(O||"").toLowerCase();return ot?he.codigo.includes(ot)||String(he.nome).toLowerCase().includes(ot):!0}).map(he=>a.jsx("li",{children:a.jsxs("button",{type:"button",className:`w-full text-left px-3 py-2 hover:bg-surface-2 ${E.codigo_sefaz===he.codigo?"bg-surface-2":""}`,onClick:()=>{S(ot=>({...ot,codigo_sefaz:he.codigo})),M(!1)},children:[a.jsx("span",{className:"font-mono mr-2 text-text-secondary",children:he.codigo}),a.jsx("span",{children:he.nome})]})},he.codigo))})})]})]})}),a.jsx(Un,{open:T,onOpenChange:k,children:a.jsxs(zn,{className:"sm:max-w-[700px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Detalhes da Finalizadora"}),a.jsx(ma,{children:"Estatsticas e informaes completas"})]}),q&&a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Informaes"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Cdigo Finalizadora"}),a.jsx("p",{className:"font-mono text-sm text-text-primary",children:q.codigo_interno||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Forma de Pagamento NF-e/NFC-e"}),a.jsx("p",{className:"font-mono text-sm text-text-primary",children:q.codigo_sefaz||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Descrio"}),a.jsx("p",{className:"font-medium text-text-primary",children:q.nome})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Taxa"}),a.jsx("p",{className:"font-medium text-text-primary",children:q.taxa_percentual?`${q.taxa_percentual}%`:"Sem taxa"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-xs text-text-muted mb-1",children:"Status"}),a.jsxs("span",{className:Pr("inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium",q.ativo?"bg-success/10 text-success":"bg-muted/10 text-muted"),children:[a.jsx("span",{className:Pr("w-2 h-2 rounded-full",q.ativo?"bg-success":"bg-muted")}),q.ativo?"Ativa":"Inativa"]})]})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Perodo de Anlise"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{variant:be==="hoje"?"default":"outline",size:"sm",onClick:()=>{U("hoje"),Bt(q.id,"hoje")},children:"Hoje"}),a.jsx(Z,{variant:be==="semana"?"default":"outline",size:"sm",onClick:()=>{U("semana"),Bt(q.id,"semana")},children:"7 Dias"}),a.jsx(Z,{variant:be==="mes"?"default":"outline",size:"sm",onClick:()=>{U("mes"),Bt(q.id,"mes")},children:"30 Dias"})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-3",children:"Estatsticas de Uso"}),V?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-brand border-t-transparent"})}):z?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Total de Transaes"}),a.jsx("span",{className:"font-semibold text-text-primary",children:z.transacoes})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Faturamento Total"}),a.jsxs("span",{className:"font-semibold text-success",children:["R$ ",z.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"Ticket Mdio"}),a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",z.ticketMedio.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:"ltima Utilizao"}),a.jsx("span",{className:"font-medium text-text-muted",children:z.ultimaUtilizacao?new Date(z.ultimaUtilizacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Nunca utilizada"})]})]}):a.jsx("div",{className:"text-center py-8 text-text-muted",children:a.jsx("p",{className:"text-sm",children:"Nenhum dado disponvel"})})]})]}),a.jsxs(Ga,{children:[a.jsx(Z,{variant:"outline",onClick:()=>k(!1),children:"Fechar"}),a.jsxs(Z,{onClick:()=>{k(!1),Dt(q)},children:[a.jsx(fc,{className:"h-4 w-4 mr-2"}),"Editar"]})]})]})}),a.jsx(Un,{open:L,onOpenChange:H,children:a.jsxs(zn,{className:"sm:max-w-[700px] w-[92vw] max-h-[90vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Ranking de Finalizadoras"}),a.jsx(ma,{children:"Faturamento por forma de pagamento"})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx(Z,{variant:W==="hoje"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{se("hoje"),ge("hoje")},children:"Hoje"}),a.jsx(Z,{variant:W==="semana"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{se("semana"),ge("semana")},children:"7 Dias"}),a.jsx(Z,{variant:W==="mes"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>{se("mes"),ge("mes")},children:"30 Dias"}),a.jsx(Z,{variant:W==="customizado"?"default":"outline",size:"sm",className:"flex-1 min-w-[70px]",onClick:()=>se("customizado"),children:"Perodo"})]}),W==="customizado"&&(ae?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx(ct,{className:"text-xs",children:"Data Inicial"}),a.jsx("input",{type:"date",className:"mt-1 h-9 w-full rounded-md border border-border bg-surface px-2 text-sm text-text-primary",value:pe,onChange:he=>G(he.target.value)})]}),a.jsxs("div",{children:[a.jsx(ct,{className:"text-xs",children:"Data Final"}),a.jsx("input",{type:"date",className:"mt-1 h-9 w-full rounded-md border border-border bg-surface px-2 text-sm text-text-primary",value:te,onChange:he=>oe(he.target.value)})]})]}),a.jsx(Z,{className:"w-full",onClick:()=>ge("customizado",pe,te),disabled:!pe||!te||De,children:De?"Buscando...":"Buscar"})]}):a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(ct,{children:"Data Inicial"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:Pr("w-full justify-start text-left font-normal",!pe&&"text-text-muted"),children:[a.jsx(Io,{className:"mr-2 h-4 w-4"}),pe?new Date(pe+"T12:00:00").toLocaleDateString("pt-BR"):"Selecione"]})}),a.jsx(Go,{className:"w-auto p-0 bg-surface border border-border",align:"start",children:a.jsx(e3,{mode:"single",selected:pe?new Date(pe+"T12:00:00"):void 0,onSelect:he=>{if(he){const ot=he.getFullYear(),Vt=String(he.getMonth()+1).padStart(2,"0"),qt=String(he.getDate()).padStart(2,"0");G(`${ot}-${Vt}-${qt}`)}},className:"p-3"})})]})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx(ct,{children:"Data Final"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{variant:"outline",className:Pr("w-full justify-start text-left font-normal",!te&&"text-text-muted"),children:[a.jsx(Io,{className:"mr-2 h-4 w-4"}),te?new Date(te+"T12:00:00").toLocaleDateString("pt-BR"):"Selecione"]})}),a.jsx(Go,{className:"w-auto p-0 bg-surface border border-border",align:"start",children:a.jsx(e3,{mode:"single",selected:te?new Date(te+"T12:00:00"):void 0,onSelect:he=>{if(he){const ot=he.getFullYear(),Vt=String(he.getMonth()+1).padStart(2,"0"),qt=String(he.getDate()).padStart(2,"0");oe(`${ot}-${Vt}-${qt}`)}},className:"p-3"})})]})]}),a.jsx(Z,{onClick:()=>ge("customizado",pe,te),disabled:!pe||!te||De,children:"Buscar"})]}))]}),De?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-brand border-t-transparent"})}):ie.length===0?a.jsx("div",{className:"text-center py-12 text-text-muted",children:a.jsx("p",{children:"Nenhuma transao no perodo selecionado"})}):a.jsx("div",{className:"space-y-3",children:ie.map((he,ot)=>a.jsx("div",{className:"bg-surface-2 rounded-lg p-3 md:p-4 border border-border",children:a.jsxs("div",{className:"flex items-start md:items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex items-start md:items-center gap-2 md:gap-3 flex-1 min-w-0",children:[a.jsxs("div",{className:Pr("flex items-center justify-center w-7 h-7 md:w-8 md:h-8 rounded-full font-bold text-xs md:text-sm flex-shrink-0",ot===0?"bg-warning/20 text-warning":ot===1?"bg-info/20 text-info":ot===2?"bg-success/20 text-success":"bg-muted/20 text-muted"),children:[ot+1,""]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[a.jsx("span",{className:"font-mono text-[10px] md:text-xs text-text-muted",children:he.codigo}),a.jsx("span",{className:"font-semibold text-sm md:text-base text-text-primary truncate",children:he.nome})]}),a.jsxs("p",{className:"text-[10px] md:text-xs text-text-muted",children:[he.transacoes," transaes"]})]})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsxs("p",{className:"text-base md:text-lg font-bold text-success whitespace-nowrap",children:["R$ ",he.total.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),a.jsxs("p",{className:"text-[10px] md:text-xs text-text-muted whitespace-nowrap",children:["Mdia: R$ ",(he.total/he.transacoes).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]})},he.id))})]}),a.jsx(Ga,{children:a.jsx(Z,{variant:"outline",onClick:()=>H(!1),children:"Fechar"})})]})})]})}function ait(){return a.jsxs("div",{className:"p-8",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Pgina de Teste"}),a.jsx("p",{children:"Esta  uma pgina de teste para verificar se o roteamento est funcionando corretamente."})]})}function sit(){const[e,t]=p.useState(!1),[r,n]=p.useState(""),[s,o]=p.useState("Manuteno em andamento. Volte em breve!"),[i,l]=p.useState(!1),[c,d]=p.useState("");p.useEffect(()=>{try{const h=localStorage.getItem("maintenance:active")==="false",m=localStorage.getItem("maintenance:end")||"",x=localStorage.getItem("maintenance:message")||"Manuteno em andamento. Volte em breve!";t(h),n(m),o(x)}catch{}},[]);const u=h=>{if(h?.preventDefault(),e&&!r){alert("Defina uma data de trmino para a manuteno");return}localStorage.setItem("maintenance:active",e),localStorage.setItem("maintenance:end",r),localStorage.setItem("maintenance:message",s),window.dispatchEvent(new Event("storage")),l(!1),d(" Configuraes salvas!"),setTimeout(()=>d(""),3e3)},f=()=>{const h=!e;if(t(h),localStorage.setItem("maintenance:active",String(h)),h&&!r){const m=new Date;m.setDate(m.getDate()+1);const x=m.toISOString().slice(0,16);n(x),localStorage.setItem("maintenance:end",x)}window.dispatchEvent(new Event("storage")),d(h?" Modo manuteno ATIVADO":" Modo manuteno DESATIVADO"),setTimeout(()=>d(""),3e3)};return a.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg mt-10",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Controle de Manuteno"}),a.jsx("button",{onClick:f,className:`inline-flex items-center px-4 py-2 rounded-md font-medium ${e?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:e?"Manuteno ATIVA":"Manuteno INATIVA"})]}),e&&a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"font-medium text-lg",children:"Configuraes"}),a.jsxs("button",{onClick:()=>l(!i),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-sm",children:[a.jsx(fc,{className:"w-4 h-4"}),i?"Ocultar":"Editar"]})]}),i?a.jsxs("form",{onSubmit:u,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Trmino"}),a.jsx("div",{className:"relative",children:a.jsx("input",{type:"datetime-local",value:r,onChange:h=>n(h.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",min:new Date().toISOString().slice(0,16),required:!0})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensagem de Manuteno"}),a.jsx("textarea",{value:s,onChange:h=>o(h.target.value),rows:3,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Ex: Estamos em manuteno programada. Volte em breve!",required:!0})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[a.jsx(afe,{className:"inline w-4 h-4 mr-1"}),"Salvar"]})]})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Trmino:"}),a.jsx("p",{className:"text-gray-900",children:r?new Date(r).toLocaleString():"No definido"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Mensagem:"}),a.jsx("p",{className:"text-gray-900 whitespace-pre-line",children:s})]})]})]}),a.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg text-sm text-gray-600",children:[a.jsx("h3",{className:"font-medium mb-2",children:"Como usar:"}),a.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[a.jsx("li",{children:"Ative/desative o boto no topo"}),a.jsx("li",{children:"Defina a data de trmino e uma mensagem amigvel"}),a.jsx("li",{children:"Salve as configuraes"}),a.jsx("li",{children:"Para acessar durante a manuteno, use a senha no link"})]})]}),c&&a.jsx("div",{className:"fixed bottom-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg",children:c})]})}function oit(e){const t=new URLSearchParams(e.startsWith("#")?e.slice(1):e),r=t.get("access_token"),n=t.get("refresh_token");return{access_token:r,refresh_token:n}}const iit=()=>{const{toast:e}=Zs(),t=Il(),[r,n]=p.useState(""),[s,o]=p.useState(""),[i,l]=p.useState(!1),[c,d]=p.useState(!1),u=p.useMemo(()=>oit(window.location.hash),[]);p.useEffect(()=>{(async()=>{const{data:{session:m}}=await Q.auth.getSession();if(m){d(!0);return}if(u.access_token&&u.refresh_token){const{data:x,error:g}=await Q.auth.setSession({access_token:u.access_token,refresh_token:u.refresh_token});g&&e({title:"Link invlido ou expirado",description:"Abra o link do email novamente.",variant:"destructive"}),d(!!x?.session)}else e({title:"Link invlido",description:"Abra o link de redefinio enviado por email.",variant:"destructive"})})()},[]);const f=async h=>{if(h.preventDefault(),r.length<6){e({title:"Senha muito curta",description:"A senha deve ter pelo menos 6 caracteres.",variant:"destructive"});return}if(r!==s){e({title:"Senhas no conferem",description:"As senhas digitadas so diferentes.",variant:"destructive"});return}l(!0);const{data:m,error:x}=await Q.auth.updateUser({password:r});if(l(!1),x){e({title:"Erro ao redefinir senha",description:x.message||"Tente novamente.",variant:"destructive"});return}e({title:"Senha redefinida",description:"Voc j pode acessar o sistema.",variant:"default"}),t("/")};return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:a.jsxs("div",{className:"w-full max-w-md bg-surface rounded-xl border border-border p-6 shadow",children:[a.jsx("h1",{className:"text-2xl font-semibold mb-2 text-text-primary",children:"Redefinir senha"}),a.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"Defina uma nova senha para sua conta."}),a.jsxs("form",{onSubmit:f,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1 text-text-secondary",children:"Nova senha"}),a.jsx(It,{type:"password",value:r,onChange:h=>n(h.target.value),placeholder:"",disabled:!c||i})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1 text-text-secondary",children:"Confirmar nova senha"}),a.jsx(It,{type:"password",value:s,onChange:h=>o(h.target.value),placeholder:"",disabled:!c||i})]}),a.jsx(Z,{type:"submit",className:"w-full",disabled:!c||i,children:i?"Salvando...":"Salvar nova senha"})]})]})})};function lit(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Ioe=p,cit=lit(Ioe);function PV(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dit(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var uit=!!(typeof window<"u"&&window.document&&window.document.createElement);function fit(e,t,r){if(typeof e!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof t!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof r<"u"&&typeof r!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function n(s){return s.displayName||s.name||"Component"}return function(o){if(typeof o!="function")throw new Error("Expected WrappedComponent to be a React component.");var i=[],l;function c(){l=e(i.map(function(u){return u.props})),d.canUseDOM?t(l):r&&(l=r(l))}var d=function(u){dit(f,u);function f(){return u.apply(this,arguments)||this}f.peek=function(){return l},f.rewind=function(){if(f.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var x=l;return l=void 0,i=[],x};var h=f.prototype;return h.UNSAFE_componentWillMount=function(){i.push(this),c()},h.componentDidUpdate=function(){c()},h.componentWillUnmount=function(){var x=i.indexOf(this);i.splice(x,1),c()},h.render=function(){return cit.createElement(o,this.props)},f}(Ioe.PureComponent);return PV(d,"displayName","SideEffect("+n(o)+")"),PV(d,"canUseDOM",uit),d}}var mit=fit;const hit=Us(mit);var pit=typeof Element<"u",git=typeof Map=="function",xit=typeof Set=="function",vit=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function W2(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,s;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!W2(e[n],t[n]))return!1;return!0}var o;if(git&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(o=e.entries();!(n=o.next()).done;)if(!t.has(n.value[0]))return!1;for(o=e.entries();!(n=o.next()).done;)if(!W2(n.value[1],t.get(n.value[0])))return!1;return!0}if(xit&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(o=e.entries();!(n=o.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(vit&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[n]))return!1;if(pit&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((s[n]==="_owner"||s[n]==="__v"||s[n]==="__o")&&e.$$typeof)&&!W2(e[s[n]],t[s[n]]))return!1;return!0}return e!==e&&t!==t}var yit=function(t,r){try{return W2(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}};const bit=Us(yit);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var EV=Object.getOwnPropertySymbols,wit=Object.prototype.hasOwnProperty,jit=Object.prototype.propertyIsEnumerable;function _it(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function Nit(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(o){return t[o]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(o){s[o]=o}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Sit=Nit()?Object.assign:function(e,t){for(var r,n=_it(e),s,o=1;o<arguments.length;o++){r=Object(arguments[o]);for(var i in r)wit.call(r,i)&&(n[i]=r[i]);if(EV){s=EV(r);for(var l=0;l<s.length;l++)jit.call(r,s[l])&&(n[s[l]]=r[s[l]])}}return n};const Cit=Us(Sit);var zg={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},xs={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(xs).map(function(e){return xs[e]});var Wo={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},wC={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},V1={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},Ait=Object.keys(wC).reduce(function(e,t){return e[wC[t]]=t,e},{}),Pit=[xs.NOSCRIPT,xs.SCRIPT,xs.STYLE],Qu="data-react-helmet",Eit=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kit=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Iit=function(){function e(t,r){for(var n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Oc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Oit=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},kV=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},Tit=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e},z3=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Dit=function(t){var r=t0(t,xs.TITLE),n=t0(t,V1.TITLE_TEMPLATE);if(n&&r)return n.replace(/%s/g,function(){return Array.isArray(r)?r.join(""):r});var s=t0(t,V1.DEFAULT_TITLE);return r||s||void 0},Mit=function(t){return t0(t,V1.ON_CHANGE_CLIENT_STATE)||function(){}},qk=function(t,r){return r.filter(function(n){return typeof n[t]<"u"}).map(function(n){return n[t]}).reduce(function(n,s){return Oc({},n,s)},{})},Rit=function(t,r){return r.filter(function(n){return typeof n[xs.BASE]<"u"}).map(function(n){return n[xs.BASE]}).reverse().reduce(function(n,s){if(!n.length)for(var o=Object.keys(s),i=0;i<o.length;i++){var l=o[i],c=l.toLowerCase();if(t.indexOf(c)!==-1&&s[c])return n.concat(s)}return n},[])},fb=function(t,r,n){var s={};return n.filter(function(o){return Array.isArray(o[t])?!0:(typeof o[t]<"u"&&Bit("Helmet: "+t+' should be of type "Array". Instead found type "'+Eit(o[t])+'"'),!1)}).map(function(o){return o[t]}).reverse().reduce(function(o,i){var l={};i.filter(function(h){for(var m=void 0,x=Object.keys(h),g=0;g<x.length;g++){var v=x[g],y=v.toLowerCase();r.indexOf(y)!==-1&&!(m===Wo.REL&&h[m].toLowerCase()==="canonical")&&!(y===Wo.REL&&h[y].toLowerCase()==="stylesheet")&&(m=y),r.indexOf(v)!==-1&&(v===Wo.INNER_HTML||v===Wo.CSS_TEXT||v===Wo.ITEM_PROP)&&(m=v)}if(!m||!h[m])return!1;var b=h[m].toLowerCase();return s[m]||(s[m]={}),l[m]||(l[m]={}),s[m][b]?!1:(l[m][b]=!0,!0)}).reverse().forEach(function(h){return o.push(h)});for(var c=Object.keys(l),d=0;d<c.length;d++){var u=c[d],f=Cit({},s[u],l[u]);s[u]=f}return o},[]).reverse()},t0=function(t,r){for(var n=t.length-1;n>=0;n--){var s=t[n];if(s.hasOwnProperty(r))return s[r]}return null},Fit=function(t){return{baseTag:Rit([Wo.HREF,Wo.TARGET],t),bodyAttributes:qk(zg.BODY,t),defer:t0(t,V1.DEFER),encode:t0(t,V1.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:qk(zg.HTML,t),linkTags:fb(xs.LINK,[Wo.REL,Wo.HREF],t),metaTags:fb(xs.META,[Wo.NAME,Wo.CHARSET,Wo.HTTPEQUIV,Wo.PROPERTY,Wo.ITEM_PROP],t),noscriptTags:fb(xs.NOSCRIPT,[Wo.INNER_HTML],t),onChangeClientState:Mit(t),scriptTags:fb(xs.SCRIPT,[Wo.SRC,Wo.INNER_HTML],t),styleTags:fb(xs.STYLE,[Wo.CSS_TEXT],t),title:Dit(t),titleAttributes:qk(zg.TITLE,t)}},U3=function(){var e=Date.now();return function(t){var r=Date.now();r-e>16?(e=r,t(r)):setTimeout(function(){U3(t)},0)}}(),IV=function(t){return clearTimeout(t)},Lit=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||U3:global.requestAnimationFrame||U3,$it=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||IV:global.cancelAnimationFrame||IV,Bit=function(t){return console&&typeof console.warn=="function"&&console.warn(t)},mb=null,qit=function(t){mb&&$it(mb),t.defer?mb=Lit(function(){OV(t,function(){mb=null})}):(OV(t),mb=null)},OV=function(t,r){var n=t.baseTag,s=t.bodyAttributes,o=t.htmlAttributes,i=t.linkTags,l=t.metaTags,c=t.noscriptTags,d=t.onChangeClientState,u=t.scriptTags,f=t.styleTags,h=t.title,m=t.titleAttributes;V3(xs.BODY,s),V3(xs.HTML,o),zit(h,m);var x={baseTag:av(xs.BASE,n),linkTags:av(xs.LINK,i),metaTags:av(xs.META,l),noscriptTags:av(xs.NOSCRIPT,c),scriptTags:av(xs.SCRIPT,u),styleTags:av(xs.STYLE,f)},g={},v={};Object.keys(x).forEach(function(y){var b=x[y],w=b.newTags,j=b.oldTags;w.length&&(g[y]=w),j.length&&(v[y]=x[y].oldTags)}),r&&r(),d(t,g,v)},Ooe=function(t){return Array.isArray(t)?t.join(""):t},zit=function(t,r){typeof t<"u"&&document.title!==t&&(document.title=Ooe(t)),V3(xs.TITLE,r)},V3=function(t,r){var n=document.getElementsByTagName(t)[0];if(n){for(var s=n.getAttribute(Qu),o=s?s.split(","):[],i=[].concat(o),l=Object.keys(r),c=0;c<l.length;c++){var d=l[c],u=r[d]||"";n.getAttribute(d)!==u&&n.setAttribute(d,u),o.indexOf(d)===-1&&o.push(d);var f=i.indexOf(d);f!==-1&&i.splice(f,1)}for(var h=i.length-1;h>=0;h--)n.removeAttribute(i[h]);o.length===i.length?n.removeAttribute(Qu):n.getAttribute(Qu)!==l.join(",")&&n.setAttribute(Qu,l.join(","))}},av=function(t,r){var n=document.head||document.querySelector(xs.HEAD),s=n.querySelectorAll(t+"["+Qu+"]"),o=Array.prototype.slice.call(s),i=[],l=void 0;return r&&r.length&&r.forEach(function(c){var d=document.createElement(t);for(var u in c)if(c.hasOwnProperty(u))if(u===Wo.INNER_HTML)d.innerHTML=c.innerHTML;else if(u===Wo.CSS_TEXT)d.styleSheet?d.styleSheet.cssText=c.cssText:d.appendChild(document.createTextNode(c.cssText));else{var f=typeof c[u]>"u"?"":c[u];d.setAttribute(u,f)}d.setAttribute(Qu,"true"),o.some(function(h,m){return l=m,d.isEqualNode(h)})?o.splice(l,1):i.push(d)}),o.forEach(function(c){return c.parentNode.removeChild(c)}),i.forEach(function(c){return n.appendChild(c)}),{oldTags:o,newTags:i}},Toe=function(t){return Object.keys(t).reduce(function(r,n){var s=typeof t[n]<"u"?n+'="'+t[n]+'"':""+n;return r?r+" "+s:s},"")},Uit=function(t,r,n,s){var o=Toe(n),i=Ooe(r);return o?"<"+t+" "+Qu+'="true" '+o+">"+z3(i,s)+"</"+t+">":"<"+t+" "+Qu+'="true">'+z3(i,s)+"</"+t+">"},Vit=function(t,r,n){return r.reduce(function(s,o){var i=Object.keys(o).filter(function(d){return!(d===Wo.INNER_HTML||d===Wo.CSS_TEXT)}).reduce(function(d,u){var f=typeof o[u]>"u"?u:u+'="'+z3(o[u],n)+'"';return d?d+" "+f:f},""),l=o.innerHTML||o.cssText||"",c=Pit.indexOf(t)===-1;return s+"<"+t+" "+Qu+'="true" '+i+(c?"/>":">"+l+"</"+t+">")},"")},Doe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(n,s){return n[wC[s]||s]=t[s],n},r)},Wit=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(n,s){return n[Ait[s]||s]=t[s],n},r)},Hit=function(t,r,n){var s,o=(s={key:r},s[Qu]=!0,s),i=Doe(n,o);return[Ce.createElement(xs.TITLE,i,r)]},Git=function(t,r){return r.map(function(n,s){var o,i=(o={key:s},o[Qu]=!0,o);return Object.keys(n).forEach(function(l){var c=wC[l]||l;if(c===Wo.INNER_HTML||c===Wo.CSS_TEXT){var d=n.innerHTML||n.cssText;i.dangerouslySetInnerHTML={__html:d}}else i[c]=n[l]}),Ce.createElement(t,i)})},fm=function(t,r,n){switch(t){case xs.TITLE:return{toComponent:function(){return Hit(t,r.title,r.titleAttributes)},toString:function(){return Uit(t,r.title,r.titleAttributes,n)}};case zg.BODY:case zg.HTML:return{toComponent:function(){return Doe(r)},toString:function(){return Toe(r)}};default:return{toComponent:function(){return Git(t,r)},toString:function(){return Vit(t,r,n)}}}},Moe=function(t){var r=t.baseTag,n=t.bodyAttributes,s=t.encode,o=t.htmlAttributes,i=t.linkTags,l=t.metaTags,c=t.noscriptTags,d=t.scriptTags,u=t.styleTags,f=t.title,h=f===void 0?"":f,m=t.titleAttributes;return{base:fm(xs.BASE,r,s),bodyAttributes:fm(zg.BODY,n,s),htmlAttributes:fm(zg.HTML,o,s),link:fm(xs.LINK,i,s),meta:fm(xs.META,l,s),noscript:fm(xs.NOSCRIPT,c,s),script:fm(xs.SCRIPT,d,s),style:fm(xs.STYLE,u,s),title:fm(xs.TITLE,{title:h,titleAttributes:m},s)}},Kit=function(t){var r,n;return n=r=function(s){Oit(o,s);function o(){return kit(this,o),Tit(this,s.apply(this,arguments))}return o.prototype.shouldComponentUpdate=function(l){return!bit(this.props,l)},o.prototype.mapNestedChildrenToProps=function(l,c){if(!c)return null;switch(l.type){case xs.SCRIPT:case xs.NOSCRIPT:return{innerHTML:c};case xs.STYLE:return{cssText:c}}throw new Error("<"+l.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},o.prototype.flattenArrayTypeChildren=function(l){var c,d=l.child,u=l.arrayTypeChildren,f=l.newChildProps,h=l.nestedChildren;return Oc({},u,(c={},c[d.type]=[].concat(u[d.type]||[],[Oc({},f,this.mapNestedChildrenToProps(d,h))]),c))},o.prototype.mapObjectTypeChildren=function(l){var c,d,u=l.child,f=l.newProps,h=l.newChildProps,m=l.nestedChildren;switch(u.type){case xs.TITLE:return Oc({},f,(c={},c[u.type]=m,c.titleAttributes=Oc({},h),c));case xs.BODY:return Oc({},f,{bodyAttributes:Oc({},h)});case xs.HTML:return Oc({},f,{htmlAttributes:Oc({},h)})}return Oc({},f,(d={},d[u.type]=Oc({},h),d))},o.prototype.mapArrayTypeChildrenToProps=function(l,c){var d=Oc({},c);return Object.keys(l).forEach(function(u){var f;d=Oc({},d,(f={},f[u]=l[u],f))}),d},o.prototype.warnOnInvalidChildren=function(l,c){return!0},o.prototype.mapChildrenToProps=function(l,c){var d=this,u={};return Ce.Children.forEach(l,function(f){if(!(!f||!f.props)){var h=f.props,m=h.children,x=kV(h,["children"]),g=Wit(x);switch(d.warnOnInvalidChildren(f,m),f.type){case xs.LINK:case xs.META:case xs.NOSCRIPT:case xs.SCRIPT:case xs.STYLE:u=d.flattenArrayTypeChildren({child:f,arrayTypeChildren:u,newChildProps:g,nestedChildren:m});break;default:c=d.mapObjectTypeChildren({child:f,newProps:c,newChildProps:g,nestedChildren:m});break}}}),c=this.mapArrayTypeChildrenToProps(u,c),c},o.prototype.render=function(){var l=this.props,c=l.children,d=kV(l,["children"]),u=Oc({},d);return c&&(u=this.mapChildrenToProps(c,u)),Ce.createElement(t,u)},Iit(o,null,[{key:"canUseDOM",set:function(l){t.canUseDOM=l}}]),o}(Ce.Component),r.propTypes={base:za.object,bodyAttributes:za.object,children:za.oneOfType([za.arrayOf(za.node),za.node]),defaultTitle:za.string,defer:za.bool,encodeSpecialCharacters:za.bool,htmlAttributes:za.object,link:za.arrayOf(za.object),meta:za.arrayOf(za.object),noscript:za.arrayOf(za.object),onChangeClientState:za.func,script:za.arrayOf(za.object),style:za.arrayOf(za.object),title:za.string,titleAttributes:za.object,titleTemplate:za.string},r.defaultProps={defer:!0,encodeSpecialCharacters:!0},r.peek=t.peek,r.rewind=function(){var s=t.rewind();return s||(s=Moe({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),s},n},Xit=function(){return null},Yit=hit(Fit,qit,Moe)(Xit),Y0=Kit(Yit);Y0.renderStatic=Y0.rewind;function ac(e){return e??""}function d2(e){return String(e||"").replace(/\D/g,"")}function Jit(){const{userProfile:e}=lo(),{toast:t}=Zs(),r=Il(),[n,s]=p.useState(!0),[o,i]=p.useState(!1),[l,c]=p.useState(null),[d,u]=p.useState({inscricao_estadual:"",regime_tributario:"",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",nfce_serie:"1",nfce_numeracao:"1",nfce_itoken:"",nfe_serie:"",nfe_numeracao:"",ambiente:"homologacao",transmitenota_apikey:"",transmitenota_base_url:"",transmitenota_base_url_hml:"",transmitenota_apikey_hml:"",transmitenota_base_url_prod:"",transmitenota_apikey_prod:""}),[f,h]=p.useState(!0),[m,x]=p.useState(!1),[g,v]=p.useState(""),[y,b]=p.useState(""),[w,j]=p.useState(!1);p.useEffect(()=>{async function T(){if(!e?.codigo_empresa)return;s(!0);const{data:k,error:q}=await Q.from("empresas").select("*").eq("codigo_empresa",e.codigo_empresa).single();q?t({title:"Erro ao carregar",description:q.message,variant:"destructive"}):k&&(c(k),u({inscricao_estadual:ac(k.inscricao_estadual),regime_tributario:k.regime_tributario?String(k.regime_tributario):"",logradouro:ac(k.logradouro),numero:ac(k.numero),complemento:ac(k.complemento),bairro:ac(k.bairro),cidade:ac(k.cidade),uf:ac(k.uf),cep:d2(k.cep),codigo_municipio_ibge:ac(k.codigo_municipio_ibge),nfce_serie:k.nfce_serie!=null?String(k.nfce_serie):"1",nfce_numeracao:k.nfce_numeracao!=null?String(k.nfce_numeracao):"1",nfce_itoken:ac(k.nfce_itoken),nfe_serie:k.nfe_serie!=null?String(k.nfe_serie):"",nfe_numeracao:k.nfe_numeracao!=null?String(k.nfe_numeracao):"",ambiente:k.ambiente||"homologacao",transmitenota_apikey:ac(k.transmitenota_apikey),transmitenota_base_url:ac(k.transmitenota_base_url),transmitenota_base_url_hml:ac(k.transmitenota_base_url_hml),transmitenota_apikey_hml:ac(k.transmitenota_apikey_hml),transmitenota_base_url_prod:ac(k.transmitenota_base_url_prod),transmitenota_apikey_prod:ac(k.transmitenota_apikey_prod)})),s(!1)}T()},[e?.codigo_empresa]),p.useEffect(()=>{if(l?.codigo_empresa)try{const T=`cfgfiscal_hash_${l.codigo_empresa}`,k=!!l?.cfgfiscal_hash,q=!!localStorage.getItem(T);x(k||q)}catch{}},[l?.codigo_empresa]);const _=T=>k=>{const q=k?.target?k.target.value:k;u(B=>({...B,[T]:q}))};async function C(T){try{const k=(typeof window<"u"?window.crypto:typeof globalThis<"u"?globalThis.crypto:null)||null;if(k&&k.subtle&&typeof TextEncoder<"u"){const B=new TextEncoder().encode(T),z=await k.subtle.digest("SHA-256",B);return Array.from(new Uint8Array(z)).map(F=>F.toString(16).padStart(2,"0")).join("")}}catch{}return E(T)}function E(T){const k=unescape(encodeURIComponent(T));return S(k)}function S(T){for(var k=function(pt,ft){return pt>>>ft|pt<<32-ft},q=Math.pow,B=q(2,32),z="length",F,V,me="",be=[],U=T[z]*8,L=S.h=S.h||[],H=S.k=S.k||[],ie=H[z],Y={},W=2;ie<64;W++)if(!Y[W]){for(F=0;F<313;F+=W)Y[F]=W;L[ie]=q(W,.5)*B|0,H[ie++]=q(W,1/3)*B|0}for(T+="";T[z]%64-56;)T+="\0";for(F=0;F<T[z];F++)V=T.charCodeAt(F),be[F>>2]|=V<<(3-F)%4*8;for(be[be[z]]=U/B|0,be[be[z]]=U,V=0;V<be[z];){var se=be.slice(V,V+=16),pe=L;for(L=L.slice(0),F=0;F<64;F++){var G=se[F-15],te=se[F-2],oe=L[0],De=L[4],re=L[7]+(k(De,6)^k(De,11)^k(De,25))+(De&L[5]^~De&L[6])+H[F]+(se[F]=F<16?se[F]:se[F-16]+(k(G,7)^k(G,18)^G>>>3)+se[F-7]+(k(te,17)^k(te,19)^te>>>10)|0),ae=(k(oe,2)^k(oe,13)^k(oe,22))+(oe&L[1]^oe&L[2]^L[1]&L[2]);L=[re+ae|0,oe,L[1],L[2],L[3]+re|0,L[4],L[5],L[6]]}for(F=0;F<8;F++)L[F]=L[F]+pe[F]|0}for(F=0;F<8;F++)for(V=3;V+1;V--){var ut=L[F]>>V*8&255;me+=(ut<16?0:"")+ut.toString(16)}return me}async function A(T){if(T?.preventDefault?.(),!(w||!l?.cnpj))try{j(!0);const k=`cfgfiscal_hash_${l.codigo_empresa}`,q=l?.cfgfiscal_hash||"",B=localStorage.getItem(k)||"",z=q||B;if(!z){t({title:"Nenhuma senha definida",variant:"destructive"});return}await C(String(g||"")+"|"+String(l.cnpj||""))===z?(h(!0),v(""),t({title:"Acesso liberado"})):t({title:"Senha incorreta",variant:"destructive"})}finally{j(!1)}}async function M(T){if(T?.preventDefault?.(),!(w||!l?.cnpj)){if(!g||g.length<8){t({title:"Defina uma senha com 8+ caracteres",variant:"destructive"});return}if(g!==y){t({title:"Senhas no conferem",variant:"destructive"});return}try{j(!0);const k=`cfgfiscal_hash_${l.codigo_empresa}`,q=await C(String(g)+"|"+String(l.cnpj||""));let B=!1;try{const{error:z}=await Q.from("empresas").update({cfgfiscal_hash:q}).eq("codigo_empresa",l.codigo_empresa).select("id").single();if(!z){B=!0,c(F=>({...F,cfgfiscal_hash:q}));try{localStorage.removeItem(k)}catch{}}}catch{}if(!B)try{localStorage.setItem(k,q)}catch{}h(!0),v(""),b(""),t({title:"Senha definida"})}finally{j(!1)}}}async function O(T){if(T?.preventDefault?.(),!e?.codigo_empresa)return;const k={inscricao_estadual:d.inscricao_estadual?.trim()||null,regime_tributario:d.regime_tributario?Number(d.regime_tributario):null,logradouro:d.logradouro?.trim()||null,numero:d.numero?.trim()||null,complemento:d.complemento?.trim()||null,bairro:d.bairro?.trim()||null,cidade:d.cidade?.trim()||null,uf:d.uf?.trim().toUpperCase()||null,cep:d2(d.cep)||null,codigo_municipio_ibge:d.codigo_municipio_ibge?.trim()||null,nfce_serie:d.nfce_serie?Number(d.nfce_serie):null,nfce_numeracao:d.nfce_numeracao?Number(d.nfce_numeracao):null,nfce_itoken:d.nfce_itoken?.trim()||null,nfe_serie:d.nfe_serie?Number(d.nfe_serie):null,nfe_numeracao:d.nfe_numeracao?Number(d.nfe_numeracao):null,ambiente:d.ambiente||"homologacao",transmitenota_apikey:d.transmitenota_apikey?.trim()||null,transmitenota_base_url:d.transmitenota_base_url?.trim()||null,transmitenota_base_url_hml:d.transmitenota_base_url_hml?.trim()||null,transmitenota_apikey_hml:d.transmitenota_apikey_hml?.trim()||null,transmitenota_base_url_prod:d.transmitenota_base_url_prod?.trim()||null,transmitenota_apikey_prod:d.transmitenota_apikey_prod?.trim()||null};try{i(!0);const{error:q}=await Q.from("empresas").update(k).eq("codigo_empresa",e.codigo_empresa).select("id").single();if(q)throw q;t({title:"Configuraes salvas",description:"Dados fiscais atualizados."})}catch(q){t({title:"Erro ao salvar",description:q.message,variant:"destructive"})}finally{i(!1)}}async function I(T){const k=d2(l?.cnpj||"");if(k.length!==14){t({title:"CNPJ invlido",description:"Salve um CNPJ vlido (14 dgitos) nos dados da empresa.",variant:"destructive"});return}const q=T==="prod",B=q?"/api/producao":"/api/homologacao";try{const z=await Kot({baseUrl:B,apiKey:"",cnpj:k});if(!z.reachable){t({title:"Sem conexo",description:z.error||`Endpoint inacessvel (${z.status||"sem status"})`,variant:"destructive"});return}if(z.authorized===!1){t({title:"Credenciais invlidas",description:`HTTP ${z.status}. Verifique ApiKey e CNPJ.`,variant:"destructive"});return}const F=z.status===200?"OK":z.status===400?"Conectado (dados mnimos ausentes; credenciais vlidas)":`Conectado (HTTP ${z.status})`,V=z.meta?`  via ${z.meta.via||"edge"}  ambiente ${z.meta.ambiente||(q?"producao":"homologacao")}`:"";t({title:`Conexo ${q?"PROD":"HML"}: sucesso`,description:F+V})}catch(z){t({title:"Falha no teste",description:z.message||"Erro inesperado",variant:"destructive"})}}return f?a.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[a.jsx(Y0,{children:a.jsx("title",{children:"Configurao Fiscal"})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>r(-1),children:"Voltar"}),a.jsxs("div",{className:"text-right",children:[a.jsx("h1",{className:"text-2xl font-semibold leading-tight",children:"Configurao Fiscal"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Dados que sero usados na emisso de NFC-e/NF-e."})]})]}),a.jsxs("form",{onSubmit:O,className:"grid gap-6 bg-surface border border-border rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"Inscrio Estadual"}),a.jsx(It,{value:d.inscricao_estadual,onChange:_("inscricao_estadual")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Regime Tributrio (CRT)"}),a.jsxs(Zn,{value:d.regime_tributario,onValueChange:_("regime_tributario"),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"1",children:"1 - Simples Nacional"}),a.jsx(nt,{value:"2",children:"2 - Simples Nacional (excesso sublimite)"}),a.jsx(nt,{value:"3",children:"3 - Regime Normal"})]})]})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Ambiente"}),a.jsxs(Zn,{value:d.ambiente,onValueChange:_("ambiente"),children:[a.jsx(Yn,{children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"homologacao",children:"Homologao"}),a.jsx(nt,{value:"producao",children:"Produo"})]})]})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-4 gap-3",children:[a.jsxs("div",{className:"sm:col-span-3",children:[a.jsx(ct,{children:"Logradouro"}),a.jsx(It,{value:d.logradouro,onChange:_("logradouro")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Nmero"}),a.jsx(It,{value:d.numero,onChange:_("numero")})]}),a.jsxs("div",{className:"sm:col-span-2",children:[a.jsx(ct,{children:"Complemento"}),a.jsx(It,{value:d.complemento,onChange:_("complemento")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Bairro"}),a.jsx(It,{value:d.bairro,onChange:_("bairro")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"CEP"}),a.jsx(It,{value:d.cep,onChange:T=>_("cep")({target:{value:d2(T.target.value)}})})]}),a.jsxs("div",{className:"sm:col-span-2",children:[a.jsx(ct,{children:"Cidade"}),a.jsx(It,{value:d.cidade,onChange:_("cidade")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"UF"}),a.jsx(It,{value:d.uf,onChange:T=>_("uf")({target:{value:String(T.target.value||"").toUpperCase().slice(0,2)}})})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Cdigo IBGE Municpio (cMun)"}),a.jsx(It,{value:d.codigo_municipio_ibge,onChange:_("codigo_municipio_ibge")})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"NFC-e Srie"}),a.jsx(It,{value:d.nfce_serie,onChange:_("nfce_serie")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"NFC-e Numerao Inicial"}),a.jsx(It,{value:d.nfce_numeracao,onChange:_("nfce_numeracao")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"NFC-e IToken (CSC)"}),a.jsx(It,{value:d.nfce_itoken,onChange:_("nfce_itoken")})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"NF-e Srie (opcional)"}),a.jsx(It,{value:d.nfe_serie,onChange:_("nfe_serie")})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"NF-e Numerao (opcional)"}),a.jsx(It,{value:d.nfe_numeracao,onChange:_("nfe_numeracao")})]}),a.jsxs("div",{className:"hidden",children:[a.jsx(ct,{children:"ApiKey do Emissor"}),a.jsx(It,{value:d.transmitenota_apikey,readOnly:!0,disabled:!0})]})]}),a.jsxs("div",{className:"border-t border-border/40 pt-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"border border-border rounded-md p-3",children:[a.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Emissor Fiscal  Homologao"}),a.jsxs("div",{className:"hidden",children:[a.jsx(ct,{className:"text-xs",children:"Base URL (HML)"}),a.jsx(It,{value:d.transmitenota_base_url_hml,readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3"})]}),a.jsx(ct,{className:"text-xs",children:"ApiKey (HML)  Gerenciado no servidor"}),a.jsx(It,{value:d.transmitenota_apikey_hml?"":"",readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3",children:a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>I("hml"),disabled:o||n,children:n?"Testando...":"Testar conexo HML"})})]}),a.jsxs("div",{className:"border border-border rounded-md p-3",children:[a.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Emissor Fiscal  Produo"}),a.jsxs("div",{className:"hidden",children:[a.jsx(ct,{className:"text-xs",children:"Base URL (PROD)"}),a.jsx(It,{value:d.transmitenota_base_url_prod,readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3"})]}),a.jsx(ct,{className:"text-xs",children:"ApiKey (PROD)  Gerenciado no servidor"}),a.jsx(It,{value:d.transmitenota_apikey_prod?"":"",readOnly:!0,disabled:!0,placeholder:"Gerenciado no servidor"}),a.jsx("div",{className:"mt-3",children:a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>I("prod"),disabled:o||n,children:n?"Testando...":"Testar conexo PROD"})})]})]}),a.jsx("div",{className:"flex gap-3 mt-4",children:a.jsx(Z,{type:"submit",disabled:o||n,children:o?"Salvando...":"Salvar Configuraes"})})]})]}):a.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[a.jsx(Y0,{children:a.jsx("title",{children:"Configurao Fiscal"})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx(Z,{type:"button",variant:"outline",size:"sm",onClick:()=>r(-1),children:"Voltar"}),a.jsxs("div",{className:"text-right",children:[a.jsx("h1",{className:"text-2xl font-semibold leading-tight",children:"Configurao Fiscal"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Acesso restrito."})]})]}),a.jsx("div",{className:"max-w-md mx-auto grid gap-4 bg-surface border border-border rounded-lg p-4 shadow-sm",children:n?a.jsx("div",{className:"text-sm text-text-secondary",children:"Carregando..."}):m?a.jsxs(a.Fragment,{children:[a.jsx(ct,{children:"Senha"}),a.jsx(It,{type:"password",value:g,onChange:T=>v(T.target.value)}),a.jsx(Z,{type:"button",onClick:A,disabled:w||!g,children:w?"Verificando...":"Desbloquear"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm",children:"Defina uma senha para proteger esta aba."}),a.jsx(ct,{children:"Nova senha"}),a.jsx(It,{type:"password",value:g,onChange:T=>v(T.target.value)}),a.jsx(ct,{children:"Confirmar senha"}),a.jsx(It,{type:"password",value:y,onChange:T=>b(T.target.value)}),a.jsx(Z,{type:"button",onClick:M,disabled:w||!g||!y,children:w?"Salvando...":"Definir senha"})]})})]})}function Dd(e){return String(e||"").replace(/\D/g,"")}function Vl(e){if(e==null)return 0;let t=String(e).trim();if(!t)return 0;t.includes(",")&&t.includes(".")?t=t.replace(/\./g,"").replace(",","."):t.includes(",")&&(t=t.replace(",","."));const r=Number(t);return Number.isFinite(r)?r:0}function Roe(e){return(Array.isArray(e?.itens)?e.itens:[]).map((r,n)=>{const s=Vl(r.quantidade),o=Vl(r.preco_unitario),i=Vl(r.desconto_percent),l=Vl(r.desconto_valor),c=Vl(r.acrescimos_valor),d=Vl(r.frete_valor),u=Vl(r.seguro_valor),f=s*o,h=i?f*i/100:l,m=Math.max(0,f-h+c+d+u),x=r.impostos||{},g=x.icms||{},v=x.pis||{},y=x.cofins||{},b={numero_item:n+1,codigo_produto:r.codigo||n+1,descricao:r.descricao||`Item ${n+1}`,cfop:Number(r.cfop||5102),unidade_comercial:r.unidade||"UN",quantidade_comercial:s,valor_unitario_comercial:io(o),codigo_ncm:Dd(r.ncm).slice(0,8)||"",valor_desconto:h?io(h):"",valor_frete:d?io(d):"",valor_seguro:u?io(u):"",valor_outras_despesas:c?io(c):"",valor_total:io(m),valor_total_sem_desconto:io(f),icms_orig:Number(x.origem||0)};if(g.csosn&&(b.icms_csosn=Number(g.csosn)),g.cst&&(b.icms_cst=Number(g.cst)),v.cst&&(b.pis_situacao_tributaria=v.cst),y.cst&&(b.cofins_situacao_tributaria=y.cst),v.aliquota){const w=Vl(v.aliquota);b.base_calculo_pis=io(m),b.aliquota_pis=TV(w/100),b.valor_pis=io(m*w/100)}if(y.aliquota){const w=Vl(y.aliquota);b.base_calculo_cofins=io(m),b.aliquota_cofins=TV(w/100),b.valor_cofins=io(m*w/100)}return b})}function Qit({form:e,finalizadoras:t=[]}){const r=Roe(e),n=r.reduce((h,m)=>h+Number(m.valor_total||0),0),s=Vl(e?.totais?.frete),o=Vl(e?.totais?.outras_despesas),i=Vl(e?.totais?.desconto_geral),l=n-i+s+o,c=Array.isArray(e?.pagamentos)?e.pagamentos:[],d=c.reduce((h,m)=>h+Vl(m.valor),0),u=Math.max(0,d-l),f=(()=>{if(!c.length)return"90";const h=c[0];return t.find(x=>String(x.id)===String(h.finalizadora_id))?.codigo_sefaz||"99"})();return{tipo_operacao:e?.tipo_nota==="entrada"?0:1,natureza_operacao:e?.natOp||"Venda de mercadoria",forma_pagamento:0,meio_pagamento:f,data_emissao:e?.data_emissao?new Date(e.data_emissao+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),data_saida_entrada:e?.data_saida?new Date(e.data_saida+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),hora_saida_entrada:new Date().toTimeString().slice(0,8),finalidade_emissao:Number(e?.finNFe||1),modalidade_frete:e?.transporte?.tipo_frete||"9",valor_frete:s?io(s):"0",valor_seguro:"0",valor_ipi:"0",valor_total:io(l),valor_total_sem_desconto:io(n),valor_troco:u?io(u):"",...e?.cpf_cnpj?{nome_destinatario:e?.nome||"",cnpj_destinatario:Dd(e?.cpf_cnpj),inscricao_estadual_destinatario:e?.ie_isento?"ISENTO":e?.inscricao_estadual||"",email_destinatario:e?.email||"",telefone_destinatario:Dd(e?.telefone||""),logradouro_destinatario:e?.logradouro||"",numero_destinatario:e?.numero||"",complemento_destinatario:"",bairro_destinatario:e?.bairro||"",municipio_destinatario:e?.cidade||"",codigo_cidade:e?.codigo_municipio_ibge||"",uf_destinatario:e?.uf||"",pais_destinatario:"Brasil",cep_destinatario:Dd(e?.cep||""),indicador_ie_destinatario:Number(e?.indIEDest||9)}:{},Itens:[r]}}function Zit({form:e}){const t=Roe(e),r=t.reduce((l,c)=>l+Number(c.valor_total||0),0),n=Vl(e?.totais?.frete),s=Vl(e?.totais?.outras_despesas),o=Vl(e?.totais?.desconto_geral),i=r-o+n+s;return{tipo_operacao:e?.tipo_nota==="entrada"?0:1,natureza_operacao:e?.natOp||"Venda de mercadoria",forma_pagamento:0,meio_pagamento:"01",data_emissao:e?.data_emissao?new Date(e.data_emissao+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),data_saida_entrada:e?.data_saida?new Date(e.data_saida+"T00:00:00").toLocaleDateString("pt-BR"):new Date().toLocaleDateString("pt-BR"),hora_saida_entrada:new Date().toTimeString().slice(0,8),finalidade_emissao:Number(e?.finNFe||1),modalidade_frete:Number(e?.transporte?.tipo_frete??9),valor_frete:n?io(n):"0",valor_seguro:"0",valor_ipi:"0",valor_total:io(i),valor_total_sem_desconto:io(r),icms_base_calculo:"0",icms_valor_total:"0",icms_base_calculo_st:"0",icms_valor_total_st:"0",icms_modalidade_base_calculo:0,icms_valor:"0",informacoes_adicionais_contribuinte:e?.adicionais?.obs_gerais||"",nome_transportadora:e?.transporte?.transportadora||"",cnpj_transportadora:"",endereco_transportadora:"",municipio_transportadora:"",uf_transportadora:"",inscricao_estadual_transportadora:"",nome_destinatario:e?.nome||"",cnpj_destinatario:Dd(e?.cpf_cnpj||""),inscricao_estadual_destinatario:e?.ie_isento?"ISENTO":e?.inscricao_estadual||"",email_destinatario:e?.email||"",telefone_destinatario:Dd(e?.telefone||""),logradouro_destinatario:e?.logradouro||"",numero_destinatario:e?.numero||"",complemento_destinatario:"",bairro_destinatario:e?.bairro||"",municipio_destinatario:e?.cidade||"",uf_destinatario:e?.uf||"",pais_destinatario:"Brasil",cep_destinatario:Dd(e?.cep||""),indicador_ie_destinatario:Number(e?.indIEDest??1),Itens:t.map(l=>[l])}}function io(e){const t=Number(e??0);return Number.isFinite(t)?t.toFixed(2):"0.00"}function TV(e){const t=Number(e??0);return Number.isFinite(t)?t.toFixed(4):"0.0000"}function elt(e){return e==null?"":String(e)}function tlt(e,t){const r=Number(t||0);if(!Array.isArray(e)||e.length===0||r<=0)return e;const n=e.map(d=>Number(d.valor_total||0)),s=n.reduce((d,u)=>d+(Number.isFinite(u)?u:0),0);if(!(s>0))return e;const i=n.map(d=>r*(d/s)).map(d=>Number(io(d)));let l=i.reduce((d,u)=>d+u,0),c=Number(io(r-l));if(Math.abs(c)>=.01){const d=e.length-1;i[d]=Number(io(i[d]+c)),l=i.reduce((u,f)=>u+f,0),c=Number(io(r-l))}return e.map((d,u)=>{const f=i[u]||0,h=Number(d.valor_desconto||0)||0,m=Number(d.valor_total||0)||0,x=Math.max(0,h+f),g=Math.max(0,m-f);return{...d,valor_desconto:x?io(x):"",valor_total:io(g)}})}function rlt(e){return e?.length,0}function nlt(e,t){if(!e?.length)return"90";const r=e[0];return t.find(s=>s.id===r.finalizadora_id)?.codigo_sefaz||"99"}function alt(e,t){if(t){const r=Dd(t.cpf||t.cnpj||t.cpf_cnpj||t.cpf_cnpj_limpo);return{nome:t.nome||t.nome_completo||t.razao_social||"",cpf_cnpj:r||void 0,ie:t.inscricao_estadual||void 0,email:t.email||void 0,telefone:Dd(t.telefone)||void 0,endereco:{logradouro:t.logradouro||t.endereco||"",numero:elt(t.numero||""),complemento:t.complemento||"",bairro:t.bairro||"",municipio:t.municipio||t.cidade||"",uf:t.uf||"",cep:Dd(t.cep),codigo_cidade:t.codigo_municipio||t.codigo_municipio_ibge||void 0,pais:t.pais||"Brasil"},indicador_ie_destinatario:t.indicador_ie_destinatario||9}}return null}async function lg({comandaId:e,codigoEmpresa:t}){if(!e)throw new Error("comandaId obrigatrio");if(!t)throw new Error("codigoEmpresa obrigatrio");const{data:r,error:n}=await Q.from("empresas").select("*").eq("codigo_empresa",t).single();if(n)throw n;const{data:s,error:o}=await Q.from("comandas").select("*").eq("codigo_empresa",t).eq("id",e).single();if(o)throw o;let i=null;if(s.cliente_id){const{data:S}=await Q.from("clientes").select("*").eq("id",s.cliente_id).single();i=S||null}else{const{data:S}=await Q.from("comanda_clientes").select("clientes:clientes!comanda_clientes_cliente_id_fkey(*)").eq("comanda_id",s.id).limit(1),A=Array.isArray(S)&&S.length?S[0]:null;A?.clientes&&(i=A.clientes)}const{data:l,error:c}=await Q.from("comanda_itens").select("*").eq("comanda_id",s.id);if(c)throw c;const d=Array.from(new Set(l.map(S=>S.produto_id).filter(Boolean)));let u=new Map;if(d.length){const{data:S}=await Q.from("produtos").select("*").in("id",d);(S||[]).forEach(A=>u.set(A.id,A))}const{data:f}=await Q.from("pagamentos").select("*").eq("comanda_id",s.id),h=Array.from(new Set((f||[]).map(S=>S.finalizadora_id).filter(Boolean)));let m=[];if(h.length){const{data:S}=await Q.from("finalizadoras").select("*").in("id",h);m=S||[]}const x=l.reduce((S,A)=>S+Number(A.quantidade||0)*Number(A.preco_unitario||0),0),g=l.reduce((S,A)=>S+Number(A.desconto||0),0),v=Math.max(0,x-g);let y=0;s?.desconto_tipo==="percentual"&&Number(s?.desconto_valor||0)>0?y=v*(Number(s.desconto_valor)/100):s?.desconto_tipo==="fixo"&&Number(s?.desconto_valor||0)>0&&(y=Number(s.desconto_valor));const b=alt(s,i);let w=l.map((S,A)=>{const M=u.get(S.produto_id)||{},O=Number(S.quantidade||0),I=Number(S.preco_unitario||0),T=Number(S.desconto||0),k=O*I-T,q=M.cfop_interno||M.cfop||5102,B=(M.ncm||"").replace(/\D/g,"").slice(0,8)||"",z=M.unidade||M.unit||"UN",F=M.csosn_interno||M.csosn||null;M.cst_icms_interno||M.cstIcmsInterno;const V=M.cst_pis_saida||M.cstPisSaida||"07",me=M.cst_cofins_saida||M.cstCofinsSaida||"07",be=M.icms_origem??0;return{numero_item:A+1,codigo_produto:M.code||M.codigo||M.id,descricao:M.name||M.descricao||S.descricao||"Item",cfop:Number(q),unidade_comercial:z,quantidade_comercial:O,valor_unitario_comercial:io(I),codigo_ncm:B,valor_desconto:T?io(T):"",valor_frete:"",valor_seguro:"",valor_outras_despesas:"",valor_total:io(k),valor_total_sem_desconto:io(O*I),icms_csosn:F?Number(F):void 0,icms_orig:Number(be)||0,pis_situacao_tributaria:V,base_calculo_pis:"",aliquota_pis:"",valor_pis:"",cofins_situacao_tributaria:me,base_calculo_cofins:"",aliquota_cofins:"",valor_cofins:""}});y>5e-4&&(w=tlt(w,y));const j=w.reduce((S,A)=>S+Number(A.valor_total||0),0),_={tipo_operacao:1,natureza_operacao:"Venda de mercadoria",forma_pagamento:rlt(f),meio_pagamento:nlt(f,m),data_emissao:new Date(s.fechado_em||s.updated_at||Date.now()).toLocaleDateString("pt-BR"),data_saida_entrada:new Date(s.fechado_em||Date.now()).toLocaleDateString("pt-BR"),hora_saida_entrada:new Date(s.fechado_em||Date.now()).toTimeString().slice(0,8),finalidade_emissao:1,modalidade_frete:"9",valor_frete:"0",valor_seguro:"0",valor_ipi:"0",valor_total:io(j),valor_total_sem_desconto:io(x),...b?{nome_destinatario:b.nome,cnpj_destinatario:b.cpf_cnpj,inscricao_estadual_destinatario:b.ie,email_destinatario:b.email,telefone_destinatario:b.telefone,logradouro_destinatario:b.endereco.logradouro,numero_destinatario:b.endereco.numero,complemento_destinatario:b.endereco.complemento,bairro_destinatario:b.endereco.bairro,municipio_destinatario:b.endereco.municipio,codigo_cidade:b.endereco.codigo_cidade,uf_destinatario:b.endereco.uf,pais_destinatario:b.endereco.pais,cep_destinatario:b.endereco.cep,indicador_ie_destinatario:b.indicador_ie_destinatario}:{},Itens:w.map(S=>[S])},C=[];r?.inscricao_estadual||C.push("Inscrio Estadual (empresa)"),r?.regime_tributario||C.push("CRT/Regime Tributrio (empresa)"),(!r?.cidade||!r?.uf)&&C.push("Cidade/UF (empresa)"),r?.codigo_municipio_ibge||C.push("Cdigo IBGE do municpio (empresa)"),r?.nfce_serie||C.push("NFC-e Srie (empresa)"),!r?.nfce_itoken&&r?.ambiente==="producao"&&C.push("NFC-e IToken/CSC (produo)"),Dd(r?.cnpj)||C.push("CNPJ da empresa"),l.forEach(S=>{const A=u.get(S.produto_id)||{},M=Dd(A.ncm||"").slice(0,8);(!M||/^0+$/.test(M))&&C.push(`Produto ${A.name||A.id}: NCM vlido`),!A.cfop_interno&&!A.cfop&&C.push(`Produto ${A.name||A.id}: CFOP interno`)});const E={ApiKey:r?.transmitenota_apikey||"",Cnpj:Dd(r?.cnpj),Dados:_};return{empresa:r,comanda:s,cliente:i,itens:l,pagamentos:f,finalizadoras:m,payload:E,missing:C}}async function slt({comandaId:e,codigoEmpresa:t,modelo:r="65",overrides:n={}}){if(!e)throw new Error("ID da comanda  obrigatrio");if(!t)throw new Error("Cdigo da empresa  obrigatrio");const{data:s,error:o}=await Q.from("vendas").select("*").eq("id",e).eq("codigo_empresa",t).single();if(o)throw new Error(`Erro ao buscar comanda: ${o.message}`);if(!s)throw new Error("Comanda no encontrada");const{data:i,error:l}=await Q.from("itens_venda").select(`
      *,
      produtos!itens_venda_produto_id_fkey (
        id,
        nome,
        codigo,
        ncm,
        cest,
        cfopInterno,
        cfopExterno,
        cstIcmsInterno,
        cstIcmsExterno,
        csosnInterno,
        csosnExterno,
        aliqIcmsInterno,
        aliqIcmsExterno,
        cstPisEntrada,
        cstPisSaida,
        aliqPisPercent,
        aliqCofinsPercent,
        cstIpi,
        aliqIpiPercent
      )
    `).eq("comanda_id",e).eq("codigo_empresa",t);if(l)throw new Error(`Erro ao buscar itens: ${l.message}`);const{data:c,error:d}=await Q.from("pagamentos").select(`
      *,
      finalizadoras!pagamentos_finalizadora_id_fkey (
        id,
        codigo_sefaz,
        nome
      )
    `).eq("comanda_id",e).eq("codigo_empresa",t).neq("status","Cancelado").neq("status","Estornado");if(d)throw new Error(`Erro ao buscar pagamentos: ${d.message}`);const{data:u,error:f}=await Q.from("empresas").select("*").eq("codigo_empresa",t).single();if(f)throw new Error(`Erro ao buscar empresa: ${f.message}`);let h=null;if(s.cliente_id){const{data:m}=await Q.from("clientes").select("*").eq("id",s.cliente_id).eq("codigo_empresa",t).single();h=m}return olt({comanda:s,itens:i||[],pagamentos:c||[],empresa:u,cliente:h,modelo:r,overrides:n})}function olt({comanda:e,itens:t,pagamentos:r,empresa:n,cliente:s,modelo:o="65",overrides:i={}}){const c=new Date().toISOString(),d=String(i.nNF||e.numero||"1"),u=o==="55"?"55":"65",f=u==="55"?"NF-e":"NFC-e",h=t.reduce((k,q)=>k+(Number(q.preco_total)||0),0),m=Number(e.desconto)||0,x=h-m,g=String(i.natOp||"VENDA"),v=String(i.serie||"1"),y=String(i.tpAmb||(n.ambiente==="producao"?"1":"2")),b=String(i.tpNF||"1"),w=String(i.indFinal||"1"),j=String(i.indPres||"1"),_=s&&s.uf&&n.uf&&s.uf!==n.uf?"2":"1",C=String(i.idDest||_),S=String({AC:"12",AL:"27",AM:"13",AP:"16",BA:"29",CE:"23",DF:"53",ES:"32",GO:"52",MA:"21",MG:"31",MS:"50",MT:"51",PA:"15",PB:"25",PE:"26",PI:"22",PR:"41",RJ:"33",RN:"24",RO:"11",RR:"14",RS:"43",SC:"42",SE:"28",SP:"35",TO:"17"}[(n.uf||"").toUpperCase()]||n.codigo_uf||"35"),A=String(n.codigo_municipio_ibge||n.codigo_municipio||""),M=s?`
    <dest>
      <${s.tipo_pessoa==="PJ"?"CNPJ":"CPF"}>${s.cpf_cnpj||""}</${s.tipo_pessoa==="PJ"?"CNPJ":"CPF"}>
      <xNome>${Ic(s.nome||s.razao_social||"")}</xNome>
      <enderDest>
        <xLgr>${Ic(s.logradouro||"")}</xLgr>
        <nro>${Ic(s.numero||"S/N")}</nro>
        <xBairro>${Ic(s.bairro||"")}</xBairro>
        <cMun>${s.codigo_municipio||s.codigo_municipio_ibge||""}</cMun>
        <xMun>${Ic(s.municipio||s.cidade||"")}</xMun>
        <UF>${s.uf||""}</UF>
        <CEP>${(s.cep||"").replace(/\D/g,"")}</CEP>
        <cPais>1058</cPais>
        <xPais>BRASIL</xPais>
      </enderDest>
      <indIEDest>9</indIEDest>
      ${s.email?`<email>${Ic(s.email)}</email>`:""}
    </dest>`:`
    <dest>
      <indIEDest>9</indIEDest>
    </dest>`,O=t.map((k,q)=>{const B=k.produtos||{},z=Number(k.preco_unitario)||0,F=Number(k.quantidade)||1,V=Number(k.preco_total)||z*F;return`
    <det nItem="${q+1}">
      <prod>
        <cProd>${Ic(B.codigo||k.produto_id)}</cProd>
        <cEAN>SEM GTIN</cEAN>
        <xProd>${Ic(B.nome||"Produto")}</xProd>
        <NCM>${B.ncm||"00000000"}</NCM>
        ${B.cest?`<CEST>${B.cest}</CEST>`:""}
        <CFOP>${B.cfopInterno||"5102"}</CFOP>
        <uCom>UN</uCom>
        <qCom>${F.toFixed(4)}</qCom>
        <vUnCom>${z.toFixed(10)}</vUnCom>
        <vProd>${V.toFixed(2)}</vProd>
        <cEANTrib>SEM GTIN</cEANTrib>
        <uTrib>UN</uTrib>
        <qTrib>${F.toFixed(4)}</qTrib>
        <vUnTrib>${z.toFixed(10)}</vUnTrib>
        <indTot>1</indTot>
      </prod>
      <imposto>
        <ICMS>
          ${B.csosnInterno?`
          <ICMSSN102>
            <orig>0</orig>
            <CSOSN>${B.csosnInterno}</CSOSN>
          </ICMSSN102>`:`
          <ICMS00>
            <orig>0</orig>
            <CST>${B.cstIcmsInterno||"00"}</CST>
            <modBC>3</modBC>
            <vBC>${V.toFixed(2)}</vBC>
            <pICMS>${B.aliqIcmsInterno||"0.00"}</pICMS>
            <vICMS>${(V*(Number(B.aliqIcmsInterno)||0)/100).toFixed(2)}</vICMS>
          </ICMS00>`}
        </ICMS>
        <PIS>
          <PISAliq>
            <CST>${B.cstPisSaida||"01"}</CST>
            <vBC>${V.toFixed(2)}</vBC>
            <pPIS>${B.aliqPisPercent||"0.00"}</pPIS>
            <vPIS>${(V*(Number(B.aliqPisPercent)||0)/100).toFixed(2)}</vPIS>
          </PISAliq>
        </PIS>
        <COFINS>
          <COFINSAliq>
            <CST>${B.cstPisSaida||"01"}</CST>
            <vBC>${V.toFixed(2)}</vBC>
            <pCOFINS>${B.aliqCofinsPercent||"0.00"}</pCOFINS>
            <vCOFINS>${(V*(Number(B.aliqCofinsPercent)||0)/100).toFixed(2)}</vCOFINS>
          </COFINSAliq>
        </COFINS>
      </imposto>
    </det>`}).join(""),I=r.map(k=>{const q=k.finalizadoras?.codigo_sefaz||"99",B=Number(k.valor)||0;return`
    <pag>
      <detPag>
        <tPag>${q}</tPag>
        <vPag>${B.toFixed(2)}</vPag>
      </detPag>
    </pag>`}).join("");return`<?xml version="1.0" encoding="UTF-8"?>
<nfeProc versao="4.00" xmlns="http://www.portalfiscal.inf.br/nfe">
  <NFe xmlns="http://www.portalfiscal.inf.br/nfe">
    <infNFe versao="4.00" Id="NFe${n.cnpj||""}${d.padStart(9,"0")}">
      <ide>
        <cUF>${S}</cUF>
        <cNF>${d.padStart(8,"0")}</cNF>
        <natOp>${g}</natOp>
        <mod>${u}</mod>
        <serie>${v}</serie>
        <nNF>${d}</nNF>
        <dhEmi>${c}</dhEmi>
        <tpNF>${b}</tpNF>
        <idDest>${C}</idDest>
        <cMunFG>${A}</cMunFG>
        <tpImp>4</tpImp>
        <tpEmis>1</tpEmis>
        <tpAmb>${y}</tpAmb>
        <finNFe>1</finNFe>
        <indFinal>${w}</indFinal>
        <indPres>${j}</indPres>
        <procEmi>0</procEmi>
        <verProc>1.0.0</verProc>
      </ide>
      <emit>
        <CNPJ>${n.cnpj||""}</CNPJ>
        <xNome>${Ic(n.razao_social||n.nome_fantasia||"")}</xNome>
        <xFant>${Ic(n.nome_fantasia||"")}</xFant>
        <enderEmit>
          <xLgr>${Ic(n.logradouro||"")}</xLgr>
          <nro>${Ic(n.numero||"S/N")}</nro>
          <xBairro>${Ic(n.bairro||"")}</xBairro>
          <cMun>${n.codigo_municipio_ibge||n.codigo_municipio||""}</cMun>
          <xMun>${Ic(n.municipio||n.cidade||"")}</xMun>
          <UF>${n.uf||""}</UF>
          <CEP>${(n.cep||"").replace(/\D/g,"")}</CEP>
          <cPais>1058</cPais>
          <xPais>BRASIL</xPais>
          <fone>${(n.telefone||"").replace(/\D/g,"")}</fone>
        </enderEmit>
        <IE>${n.inscricao_estadual||""}</IE>
        <CRT>${n.regime_tributario||"1"}</CRT>
      </emit>
      ${M}
      ${O}
      <total>
        <ICMSTot>
          <vBC>0.00</vBC>
          <vICMS>0.00</vICMS>
          <vICMSDeson>0.00</vICMSDeson>
          <vFCP>0.00</vFCP>
          <vBCST>0.00</vBCST>
          <vST>0.00</vST>
          <vFCPST>0.00</vFCPST>
          <vFCPSTRet>0.00</vFCPSTRet>
          <vProd>${h.toFixed(2)}</vProd>
          <vFrete>0.00</vFrete>
          <vSeg>0.00</vSeg>
          <vDesc>${m.toFixed(2)}</vDesc>
          <vII>0.00</vII>
          <vIPI>0.00</vIPI>
          <vIPIDevol>0.00</vIPIDevol>
          <vPIS>0.00</vPIS>
          <vCOFINS>0.00</vCOFINS>
          <vOutro>0.00</vOutro>
          <vNF>${x.toFixed(2)}</vNF>
        </ICMSTot>
      </total>
      <transp>
        <modFrete>9</modFrete>
      </transp>
      ${I}
      <infAdic>
        <infCpl>Comanda: ${e.id} | Modelo: ${f}</infCpl>
      </infAdic>
    </infNFe>
  </NFe>
</nfeProc>`}function Ic(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}const DV=[{code:"1102",desc:"Compra para industrializao, comercializao ou prestao de servios"},{code:"5101",desc:"Venda de produo do estabelecimento"},{code:"5102",desc:"Venda de mercadoria adquirida de terceiros"},{code:"5103",desc:"Venda de produo do estabelecimento, efetuada fora do estabelecimento"},{code:"5104",desc:"Venda de mercadoria adquirida de terceiros, efetuada fora do estabelecimento"},{code:"5405",desc:"Venda de mercadoria adquirida de terceiros, sujeita a ST"},{code:"5949",desc:"Outras sadas de mercadorias no especificadas"},{code:"5915",desc:"Remessa em bonificao, doao ou brinde"},{code:"5109",desc:"Venda de produo do estabelecimento, destinada a no contribuinte"},{code:"5110",desc:"Venda de mercadoria adquirida de terceiros, destinada a no contribuinte"},{code:"5401",desc:"Venda de produo do estabelecimento, sujeita a ST"},{code:"5403",desc:"Venda de mercadoria, de terceiros, sujeita a ST, efetuada pelo industrial substituto"},{code:"2102",desc:"Compra para industrializao, comercializao ou prestao de servios (fora do estado)"},{code:"6101",desc:"Venda de produo do estabelecimento (fora do estado)"},{code:"6102",desc:"Venda de mercadoria adquirida de terceiros (fora do estado)"},{code:"6403",desc:"Venda de produo do estabelecimento, sujeita a ST (fora do estado)"},{code:"6915",desc:"Remessa em bonificao, doao ou brinde (fora do estado)"}];function ao(e){return Number(e||0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}function hb(e){if(!e)return"";try{return new Date(e).toLocaleString("pt-BR")}catch{return""}}const es=e=>e==null||String(e).trim()==="";function MV({label:e,value:t,onChange:r}){const[n,s]=Ce.useState(!1),o=Ce.useRef(null),i=Ce.useRef(null),[l,c]=Ce.useState({top:0,left:0}),d=m=>{try{const[x,g,v]=String(m||"").split("-").map(Number);return x&&g&&v?new Date(x,g-1,v):null}catch{return null}},u=m=>{const x=g=>String(g).padStart(2,"0");return`${m.getFullYear()}-${x(m.getMonth()+1)}-${x(m.getDate())}`},f=Ce.useCallback(()=>{if(!i.current)return;const m=i.current.getBoundingClientRect(),x=280,g=Math.min(Math.max(8,m.left),window.innerWidth-x-8),v=Math.min(m.bottom+6,window.innerHeight-8-260);c({top:v,left:g})},[]);Ce.useEffect(()=>{if(!n)return;f();const m=()=>f(),x=()=>f();return window.addEventListener("scroll",m,!0),window.addEventListener("resize",x),()=>{window.removeEventListener("scroll",m,!0),window.removeEventListener("resize",x)}},[n,f]);const h=d(t);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"relative",ref:o,children:a.jsx("button",{ref:i,type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs",onClick:()=>s(m=>!m),children:t?new Date(t+"T00:00:00").toLocaleDateString("pt-BR"):e})}),n&&U4.createPortal(a.jsx("div",{className:"fixed z-[1000] p-2 bg-black text-white border border-warning/40 rounded-md shadow-xl",style:{top:l.top,left:l.left,width:280},children:a.jsx(ei,{mode:"single",selected:h||void 0,onSelect:m=>{m&&(r(u(m)),s(!1))},showOutsideDays:!0,classNames:{caption_label:"text-[11px] font-medium text-white",head_cell:"text-[10px] text-warning/80 w-7",day:"h-7 w-7 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}),document.body)]})}function ilt(){const{userProfile:e}=lo(),t=e?.codigo_empresa,{toast:r}=Zs(),n=Il(),[s,o]=p.useState([]),[i,l]=p.useState(!1),[c,d]=p.useState([]),[u,f]=p.useState(!1),[h,m]=p.useState(""),[x,g]=p.useState(""),[v,y]=p.useState("all"),b=D=>String(D).padStart(2,"0"),w=new Date,j=w.getFullYear(),_=w.getMonth()+1,C=`${j}-${b(_)}-01`,E=`${j}-${b(_)}-${b(new Date(j,_,0).getDate())}`,[S,A]=p.useState(C),[M,O]=p.useState(E),[I,T]=p.useState(!1),[k,q]=p.useState(null),[B,z]=p.useState("nfce");e&&(e.cargo||e.papel);const F=!0,V=!0,[me,be]=p.useState("aberto_em"),[U,L]=p.useState("desc"),[H,ie]=p.useState(1),[Y,W]=p.useState(50),[se,pe]=p.useState([]),G=D=>se.includes(D),te=(D,X)=>{pe(Pe=>X?Array.from(new Set([...Pe||[],D])):(Pe||[]).filter(rt=>rt!==D)),q(Pe=>X?D:Pe===D?null:Pe)},oe=(D="filtered")=>{const X=";",Pe=Ge=>{let Jt=String(Ge??"");return Jt=Jt.replaceAll('"','""'),Jt=Jt.replaceAll(";","|"),`"${Jt}"`},Le=[["Numero","Serie","Status","Destinatario","Origem","Chave","DataEmissao","ValorTotal"].join(X)];let Tt=[];if(D==="selected"){const Ge=new Set(se);k&&Ge.add(k),Tt=(Or||[]).filter(Jt=>Ge.has(Jt.id))}else Tt=Or||[];Tt.forEach(Ge=>{const Jt=Ge.status||"pendente",Kt=Ge.destinatario?.nome||"",Hr=Ge.origem==="comanda"?`Comanda ${Ge.comanda_id??""}`:Ge.origem||"manual",hn=Ge.data_emissao||Ge.criado_em||Ge.created_at||"",An=[Ge.numero??"",Ge.serie??"",Jt,Kt,Hr,Ge.xml_chave??"",hn,String(Ge.valor_total??"")];Le.push(An.map(Pe).join(X))});const Ot=new Blob(["\uFEFF"+Le.join(`\r
`)],{type:"text/csv;charset=utf-8;"}),Rt=URL.createObjectURL(Ot),yt=document.createElement("a");yt.href=Rt,yt.download=`nfe-${D}-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(yt),yt.click(),document.body.removeChild(yt),URL.revokeObjectURL(Rt)},[De,re]=p.useState(!1),ae=async D=>{try{if(!xe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:X,cnpj:Pe}=rl(xe);if(!Pe){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const rt=D.xml_chave||"";let Le;if(rt)Le={chave_nota:rt,chave:rt};else if(D.numero&&D.serie)Le={numero:D.numero,serie:D.serie};else{r({title:"Sem referncia para consultar",description:"Preencha nmero/srie ou emita para obter a chave",variant:"warning"});return}r({title:"Consultando status...",description:`NF-e ${D.numero||""}/${D.serie||""}`});let Tt=null,Ot="",Rt="",yt=!1,Ge=D.xml_url||null,Jt=D.pdf_url||null,Kt=D.xml_chave||null,Hr=D.numero||null,hn=D.serie||null;try{Tt=await i2({baseUrl:X,cnpj:Pe,dados:Le}),Ot=String(Tt?.status||Tt?.cStat||""),Rt=Tt?.xMotivo||Tt?.mensagem||Tt?.message||"Retorno da consulta",yt=Ot==="100"||/autorizad/i.test(Rt),Ge=Tt?.url_xml||Tt?.xml_url||Ge,Jt=Tt?.url_pdf||Tt?.pdf_url||Jt,Kt=Tt?.chave_nota||Tt?.chave||Tt?.Chave||Kt,Hr=Tt?.numero||Tt?.Numero||Hr,hn=Tt?.serie||Tt?.Serie||hn}catch(xr){Rt=xr?.message||String(xr)}if(!yt||!Jt&&!Ge){try{const xr=await l2({baseUrl:X,cnpj:Pe,dados:Le});Jt=xr?.url_pdf||xr?.pdf_url||Jt,Kt=xr?.chave||xr?.Chave||Kt}catch{}try{const xr=await c2({baseUrl:X,cnpj:Pe,dados:Le});Ge=xr?.url_xml||xr?.xml_url||Ge,Kt=Kt||xr?.chave||xr?.Chave||Kt}catch{}(Jt||Ge)&&(yt=!0)}const An=yt?"autorizada":/rejeit/i.test(Rt)?"rejeitada":Ot||D.status||"pendente";await Q.from("notas_fiscais").update({status:An,xml_url:Ge,pdf_url:Jt,xml_chave:Kt,numero:Hr,serie:hn}).eq("id",D.id).eq("codigo_empresa",t),await ua(),r({title:yt?"Autorizada":`Status ${Ot||""}`.trim(),description:Rt||"Consulta concluda",variant:yt?"success":"default"})}catch(X){r({title:"Falha ao consultar",description:X?.message||String(X),variant:"destructive"})}},ut=async D=>{try{if(!D)return;const X=(to||"").trim();if(!X){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}if(!xe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:Pe,cnpj:rt}=rl(xe);if(!rt){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const Le=D.xml_chave?{chave_nota:D.xml_chave,chave:D.xml_chave,motivo:X}:{numero:D.numero,serie:D.serie,motivo:X};await Yot({baseUrl:Pe,cnpj:rt,dados:Le}),await Q.from("notas_fiscais").update({status:"cancelada"}).eq("id",D.id).eq("codigo_empresa",t),await ua(),r({title:"NF-e cancelada"}),as(null),As("")}catch(X){r({title:"Falha ao cancelar",description:X?.message||String(X),variant:"destructive"})}},pt=async()=>{try{const D=c||[],X=k||se&&se[0];if(!X){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const Pe=D.find(rt=>rt.id===X);if(!Pe){r({title:"NF-e no encontrada na lista",variant:"warning"});return}await ae(Pe)}catch(D){r({title:"Falha ao consultar NF-e",description:D?.message||String(D),variant:"destructive"})}},ft=async()=>{try{const D=c||[],X=k||se&&se[0];if(!X){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const Pe=D.find(rt=>rt.id===X);if(!Pe){r({title:"NF-e no encontrada na lista",variant:"warning"});return}as(Pe),As("")}catch(D){r({title:"Falha ao cancelar NF-e",description:D?.message||String(D),variant:"destructive"})}},bt=async()=>{try{const D=c||[],X=k||se&&se[0];if(!X){r({title:"Nenhuma NF-e selecionada",variant:"warning"});return}const Pe=D.find(Le=>Le.id===X);if(!Pe){r({title:"NF-e no encontrada na lista",variant:"warning"});return}const rt=Pe?.draft_data;if(!rt||!Array.isArray(rt.itens)||rt.itens.length===0){Nt(Pe.id),Pe.draft_data&&Fe(Pe.draft_data),jr(!0),r({title:"Rascunho incompleto",description:"Abra o rascunho para revisar e emitir.",variant:"warning"});return}await sr(rt,Pe.id)}catch(D){r({title:"Falha ao emitir NF-e",description:D?.message||String(D),variant:"destructive"})}},Lt=async()=>{if(!er||!t){r({title:"Rascunho no iniciado",variant:"warning"});return}try{Lr(!0);const Pe=(Te.itens||[]).map(Le=>{const Tt=Ee(Le.preco_unitario)||0,Ot=Ee(Le.quantidade)||1,Rt=Tt*Ot,yt=Ee(Le.desconto_percent)||0,Ge=Ee(Le.desconto_valor)||0,Jt=Ee(Le.acrescimos_valor)||0,Kt=yt?Rt*yt/100:Ge;return{preco_total:Rt-Kt+Jt}}).reduce((Le,Tt)=>Le+(Number(Tt.preco_total)||0),0)-(Ee(Te.totais?.desconto_geral)||0)+(Ee(Te.totais?.frete)||0)+(Ee(Te.totais?.outras_despesas)||0),rt={tipo_pessoa:Te.tipo_pessoa,cpf_cnpj:Te.cpf_cnpj,nome:Te.nome,email:Te.email,telefone:Te.telefone,inscricao_estadual:Te.ie_isento?"ISENTO":Te.inscricao_estadual,logradouro:Te.logradouro,numero:Te.numero,bairro:Te.bairro,cidade:Te.cidade,uf:Te.uf,cep:Te.cep,codigo_municipio_ibge:Te.codigo_municipio_ibge};await Q.from("notas_fiscais").update({draft_data:Te,valor_total:Number.isFinite(Pe)?Pe:null,destinatario:rt,numero:Te.nNF?Number(Te.nNF):null,serie:Te.serie?Number(Te.serie):null}).eq("id",er).eq("codigo_empresa",t),await ua(),r({title:"Rascunho salvo"}),jr(!1)}catch(D){r({title:"Falha ao salvar rascunho",description:D?.message||String(D),variant:"destructive"})}finally{Lr(!1)}},Dt=async D=>{if(!D||!t)return null;try{const X=(s||[]).find(Rt=>Rt.id===D),Pe=Number(X?.total||X?.total_com_desconto||0)||0,{ambiente:rt}=rl(xe||{}),{data:Le,error:Tt}=await Q.from("notas_fiscais").insert({codigo_empresa:t,origem:"comanda",comanda_id:D,modelo:"55",numero:null,serie:null,status:"rascunho",xml_url:null,pdf_url:null,valor_total:Pe,destinatario:null,ambiente:rt||"homologacao"}).select("id").single();if(Tt)throw Tt;await ua();const Ot=Le?.id||null;return Ot&&Nt(Ot),Ot}catch(X){return r({title:"Falha ao criar rascunho",description:X?.message||String(X),variant:"destructive"}),null}},Bt=async()=>{if(!t)return null;try{const{ambiente:D}=rl(xe||{}),{data:X,error:Pe}=await Q.from("notas_fiscais").insert({codigo_empresa:t,origem:"manual",comanda_id:null,modelo:"55",numero:null,serie:null,status:"rascunho",xml_url:null,pdf_url:null,valor_total:null,destinatario:null,ambiente:D||"homologacao"}).select("id").single();if(Pe)throw Pe;await ua();const rt=X?.id||null;return rt&&Nt(rt),Fe({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:at,data_saida:at,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{tipo:"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:"",parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}),ia(""),jr(!0),rt}catch(D){return r({title:"Falha ao criar rascunho manual",description:D?.message||String(D),variant:"destructive"}),null}},[ge,wt]=p.useState([]),Gt=D=>ge.includes(D);p.useEffect(()=>{const D=setTimeout(()=>g(h),300);return()=>clearTimeout(D)},[h]);const[Sr,wr]=p.useState(!1),[he,ot]=p.useState(!1);p.useEffect(()=>{try{const D=String({}.VITE_MAINTENANCE_MODE||"").toLowerCase()==="true",X=localStorage.getItem("maintenance:active")==="true",Pe=localStorage.getItem("maintenance:end"),rt=Pe?new Date>new Date(Pe):!1,Le=(D||X)&&!rt,Tt=(()=>{try{const Ot=localStorage.getItem("maintenance:bypass")==="1",Rt=sessionStorage.getItem("maintenance:bypass")==="1",yt=document.cookie.split(";").some(Ge=>Ge.trim()==="fx_maint_bypass=1");return Ot||Rt||yt}catch{return!1}})();wr(!1),ot(!0)}catch{wr(!1),ot(!0)}},[]);const[Vt,qt]=p.useState(!1),[Re,Ct]=p.useState(!1),[Wt,Er]=p.useState(null),[Me,lt]=p.useState([]),[gt,or]=p.useState(!1),[br,ur]=p.useState(null),[an,zr]=p.useState(!1),[Gr,ha]=p.useState(!1),[pn,on]=p.useState({}),[cn,ke]=p.useState([]),[We,Ze]=p.useState(!1),[Je,At]=p.useState(!1),[Ye,lr]=p.useState(""),[ce,qe]=p.useState(null),[ze,xt]=p.useState({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:""}),[rr,ir]=p.useState(!1),[Kr,jr]=p.useState(!1),[sa,ia]=p.useState(""),Kn=new Date,at=`${Kn.getFullYear()}-${b(Kn.getMonth()+1)}-${b(Kn.getDate())}`,[Te,Fe]=p.useState({natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:at,data_saida:at,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{tipo:"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:"",parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}),[cr,ht]=p.useState([]),[Xr,Ft]=p.useState(!1),[kr,jt]=p.useState({codigo:"",descricao:""}),[er,Nt]=p.useState(null),[Cr,Lr]=p.useState(!1),[un,ra]=p.useState(!1),[Wn,ln]=p.useState(!1),[da,va]=p.useState(null),[oa,Tn]=p.useState("");p.useState(!1);const[ee,Ie]=p.useState(!1),[Oe,Yt]=p.useState(!1),Pt=p.useMemo(()=>{const D=Te||{},X=D.itens||[],Pe=D.pagamentos||[],rt=String(D.modelo)==="65",Le=!!(D.modelo&&D.serie&&D.natOp&&D.data_emissao&&D.tipo_nota&&D.finNFe),Tt=Array.isArray(X)&&X.length>0,Ot=Tt&&X.every(Jt=>{const Kt=Jt.impostos||{},Hr=Kt.icms||{},hn=Kt.pis||{},An=Kt.cofins||{},xr=!!(Kt.origem&&(Hr.cst||Hr.csosn)),Tr=hn.aliquota!==void 0&&String(hn.aliquota).trim()!=="",jn=An.aliquota!==void 0&&String(An.aliquota).trim()!=="";return xr&&Tr&&jn}),Rt=Tt&&Ot,yt=!!(D.transporte&&D.transporte.tipo_frete);let Ge=!0;if(rt){const Jt=X.reduce((Tr,jn)=>{const fa=Ee(jn.preco_unitario)||0,qn=Ee(jn.quantidade)||1,Fa=fa*qn,ps=Ee(jn.desconto_percent)||0,La=Ee(jn.desconto_valor)||0,xa=ps?Fa*ps/100:La,Ss=Ee(jn.acrescimos_valor)||0,js=Math.max(0,Fa-xa+Ss);return Tr+js},0),Kt=Ee(D.totais?.desconto_geral)||0,Hr=Ee(D.totais?.frete)||0,hn=Ee(D.totais?.outras_despesas)||0,An=Jt-Kt+Hr+hn,xr=Pe.reduce((Tr,jn)=>Tr+(Ee(jn.valor)||0),0);Ge=Pe.length>0&&xr+.009>=An}return{identOk:Le,produtosOk:Rt,pagamentosOk:Ge,totaisOk:!0,transpOk:yt}},[Te]),[Qt,nr]=p.useState("cliente"),[fn,J]=p.useState("ident"),[Xe,He]=p.useState(!1),[fe,Ve]=p.useState(""),[xe,kt]=p.useState(null),[st,zt]=p.useState([]),[pr,en]=p.useState(""),[sn,la]=p.useState(null),[Nr,xn]=p.useState(!1),[Dn,Pa]=p.useState(null),[Aa,Na]=p.useState(null),[Hn,as]=p.useState(null),[to,As]=p.useState(""),[Vs,ai]=p.useState(!1);p.useState(!1);const[Ni,Si]=p.useState("");p.useState("");const[Sc,Qc]=p.useState([]),[Cc,Yi]=p.useState("cliente"),[si,zo]=p.useState([]),[Uo,Ac]=p.useState(null);p.useState("");const[gl,qd]=p.useState(!1),[Os,pi]=p.useState(!1),[_s,Au]=p.useState(""),[Zc,Ji]=p.useState(null),[Ol,R]=p.useState(""),[de,Ue]=p.useState(!0),[vt,Ht]=p.useState(!1),[Ur,mn]=p.useState(!1),ne=async({tipo:D,scope:X,includePdf:Pe})=>{try{if(!xe){r({title:"Empresa no carregada",variant:"warning"});return}const rt=rl(xe),Le=rt?.ambiente||"homologacao",Tt=rt?.cnpj||"";if(!Tt){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}mn(!0);let Ot=[];if(D==="nfce"){let xr=[];if(X==="selected"){const Tr=new Set(se);k&&Tr.add(k),xr=(s||[]).filter(jn=>Tr.has(jn.id))}else xr=ds||[];Ot=xr.map(Tr=>({tipo:"nfce",chave:Tr.xml_chave,numero:Tr.nf_numero,serie:Tr.nf_serie,searchkey:Tr.xml_protocolo}))}else if(D==="nfe"){let xr=[];if(X==="selected"){const Tr=new Set(se);k&&Tr.add(k),xr=(c||[]).filter(jn=>Tr.has(jn.id))}else xr=Or||[];Ot=xr.map(Tr=>({tipo:"nfe",chave:Tr.xml_chave,numero:Tr.numero,serie:Tr.serie}))}if(Ot=Ot.filter(xr=>xr.chave||xr.numero&&xr.serie||xr.searchkey),!Ot.length){r({title:"Nada para exportar",description:"Nenhum documento elegvel encontrado.",variant:"warning"});return}const Rt=xr=>String(xr||"").replace(/[^0-9A-Za-z_-]/g,""),yt=`${D}-${X}-${Rt(S)}_a_${Rt(M)}${Pe?"-xml-pdf":"-xml"}.zip`,Ge=`${Q.supabaseUrl}/functions/v1/emissor`,Jt=await fetch(Ge,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q.supabaseKey}`,apikey:Q.supabaseKey,Accept:"application/zip"},body:JSON.stringify({acao:"export_zip",ambiente:Le,cnpj:Tt,dados:{items:Ot,includePdf:Pe,zipName:yt}})});if(!Jt.ok){const xr=await Jt.text();throw new Error(xr||"Falha ao gerar ZIP")}const Kt=await Jt.arrayBuffer(),Hr=new Blob([Kt],{type:"application/zip"}),hn=URL.createObjectURL(Hr),An=document.createElement("a");An.href=hn,An.download=yt,document.body.appendChild(An),An.click(),document.body.removeChild(An),URL.revokeObjectURL(hn),r({title:"Exportao iniciada",description:`${Ot.length} documentos adicionados ao ZIP`})}catch(rt){r({title:"Falha na exportao",description:rt?.message||String(rt),variant:"destructive"})}finally{mn(!1)}},Ae=D=>String(D||"").replace(/\D/g,""),Ee=D=>{if(D==null)return 0;let X=String(D).trim();if(!X)return 0;const Pe=X.includes(","),rt=X.includes(".");Pe&&rt?X=X.replace(/\./g,"").replace(",","."):Pe&&(X=X.replace(",","."));const Le=Number(X);return Number.isFinite(Le)?Le:0},it=D=>{try{const X=Ee(D?.totais?.desconto_geral)||0,Pe=Array.isArray(D?.itens)?D.itens:[];if(!X||!Pe.length)return D;const rt=Pe.map(Jt=>{const Kt=Ee(Jt.quantidade),Hr=Ee(Jt.preco_unitario),hn=Kt*Hr,An=Ee(Jt.desconto_percent),xr=Ee(Jt.desconto_valor),Tr=Ee(Jt.acrescimos_valor),jn=Ee(Jt.frete_valor),fa=Ee(Jt.seguro_valor),qn=An?hn*An/100:xr;return Math.max(0,hn-qn+Tr+jn+fa)}),Le=rt.reduce((Jt,Kt)=>Jt+Kt,0);if(!(Le>0))return D;const Ot=rt.map(Jt=>X*(Jt/Le)).map(Jt=>Number(Jt.toFixed(2)));let Rt=Ot.reduce((Jt,Kt)=>Jt+Kt,0),yt=Number((X-Rt).toFixed(2));if(Math.abs(yt)>=.01){const Jt=Ot.length-1;Ot[Jt]=Number((Ot[Jt]+yt).toFixed(2)),Rt=Ot.reduce((Kt,Hr)=>Kt+Hr,0)}const Ge=Pe.map((Jt,Kt)=>{const Hr=Ee(Jt.desconto_percent),hn=Ee(Jt.preco_unitario),xr=Ee(Jt.quantidade)*hn,Tr=Hr?xr*Hr/100:Ee(Jt.desconto_valor),jn=Number((Tr+(Ot[Kt]||0)).toFixed(2));return{...Jt,desconto_percent:"",desconto_valor:jn.toFixed(2)}});return{...D,itens:Ge,totais:{...D?.totais||{},desconto_geral:"0.00"}}}catch{return D}};p.useEffect(()=>{Fe(D=>({...D,baixar_estoque:D.tipo_nota!=="entrada"}))},[Te.tipo_nota]),p.useEffect(()=>{Yi(Te.tipo_nota==="entrada"?"fornecedor":"cliente")},[Te.tipo_nota]),p.useEffect(()=>{Fe(D=>({...D,cfop_padrao:Qr(D.uf)}))},[Te.tipo_nota,fe,Te.uf]),p.useEffect(()=>{if(!Kr||!t)return;let D=!0;return(async()=>{try{const X=[{id:"5102",codigo:"5102",descricao:"Venda de mercadoria adquirida ou recebida de terceiros",tipo_nota:"saida"},{id:"5101",codigo:"5101",descricao:"Venda de produo do estabelecimento",tipo_nota:"saida"},{id:"6102",codigo:"6102",descricao:"Venda de mercadoria para fora do estado (terceiros)",tipo_nota:"saida"},{id:"6101",codigo:"6101",descricao:"Venda de produo para fora do estado",tipo_nota:"saida"}],{data:Pe,error:rt}=await Q.from("cfops").select("id, codigo, descricao, tipo_nota").eq("codigo_empresa",t).order("codigo");if(rt)throw rt;if(!D)return;const Le=Array.isArray(Pe)?Pe:[],Tt=new Set(Le.map(Rt=>String(Rt.codigo))),Ot=[...Le,...X.filter(Rt=>!Tt.has(String(Rt.codigo)))];ht(Ot)}catch(X){console.error("[FiscalHub][CFOP] Falha ao carregar CFOPs",X),ht([{id:"5102",codigo:"5102",descricao:"Venda de mercadoria adquirida ou recebida de terceiros",tipo_nota:"saida"},{id:"5101",codigo:"5101",descricao:"Venda de produo do estabelecimento",tipo_nota:"saida"},{id:"6102",codigo:"6102",descricao:"Venda de mercadoria para fora do estado (terceiros)",tipo_nota:"saida"},{id:"6101",codigo:"6101",descricao:"Venda de produo para fora do estado",tipo_nota:"saida"}])}})(),()=>{D=!1}},[Kr,t]);const Et=p.useRef(Te.cfop_padrao);p.useEffect(()=>{const D=Et.current,X=Te.cfop_padrao||"";Et.current=X,!(!de||!X)&&Fe(Pe=>{const rt=Pe.itens||[];let Le=!1;const Tt=rt.map(Ot=>{const Rt=String(Ot.cfop||"");return Rt===""||D&&Rt===D?(Le=!0,{...Ot,cfop:X}):Ot});return Le?{...Pe,itens:Tt}:Pe})},[Te.cfop_padrao,de]);const gr=D=>{const X=String(D||"").replace(/\D/g,""),Pe=X?Number(X)/100:0;return new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Pe)},sr=async(D=null,X=null)=>{try{const Pe=D&&typeof D=="object"&&("nativeEvent"in D||"preventDefault"in D||"target"in D),rt=!D||Pe?Te:D,Le=rt.itens||[];try{console.log("[FiscalHub][emitirNota] start",{modelo:rt.modelo,itensLen:Array.isArray(Le)?Le.length:0})}catch{}if(!Array.isArray(Le)||Le.length===0){try{console.warn("[FiscalHub][emitirNota] itens ausentes",{form:rt})}catch{}r({title:"Sem itens",variant:"warning"});return}if(!xe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:Tt,cnpj:Ot}=rl(xe);if(!Ot){r({title:"CNPJ ausente",description:"Preencha o CNPJ na Configurao Fiscal",variant:"warning"});return}const Rt=String(rt.modelo)==="65",yt=it(rt);let Ge=Rt?Qit({form:yt,finalizadoras:si||[]}):Zit({form:yt});try{console.log("[FiscalHub][emitirNota] payload gerado (antes do preflight)",{isNFCe:Rt,Dados:Ge})}catch{}if(!Rt){if((!Ge||typeof Ge!="object")&&(Ge={}),"forma_pagamento"in Ge||(Ge.forma_pagamento=0),!("meio_pagamento"in Ge)||!Ge.meio_pagamento){let Xn="99";const ba=Array.isArray(yt?.pagamentos)?yt.pagamentos[0]:null;if(ba?.finalizadora_id&&Array.isArray(si)&&si.length){const Ws=si.find(Bs=>String(Bs.id)===String(ba.finalizadora_id));Ws?.codigo_sefaz&&(Xn=String(Ws.codigo_sefaz).padStart(2,"0"))}Ge.meio_pagamento=Xn}else Ge.meio_pagamento=String(Ge.meio_pagamento).padStart(2,"0");(!Ge.natureza_operacao||String(Ge.natureza_operacao).trim().length<15)&&(Ge.natureza_operacao="Venda de mercadoria");try{const ba=(Array.isArray(Ge.Itens)?Ge.Itens:[]).reduce((Ws,Bs)=>Ws+(Number(Bs?.valor_total_sem_desconto)||0),0);ba>0&&(Ge.valor_total_sem_desconto=ba.toFixed(2))}catch{}if("numero_destinatario"in Ge){const Xn=String(Ge.numero_destinatario||"").trim();(!Xn||/^s\/?n$/i.test(Xn))&&(Ge.numero_destinatario="0")}let La=Number(yt?.serie||1)||1;if(yt?.nNF)Ge.Numero=Number(yt.nNF),Ge.Serie=La;else try{try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"start",mensagem:`serie=${La}`})}catch{}const{data:Xn,error:ba}=await Q.rpc("reservar_numero_fiscal",{p_modelo:"55",p_serie:La,p_codigo_empresa:t});if(ba)throw ba;const Ws=Number(Xn);Fe(Bs=>({...Bs,nNF:String(Ws),serie:String(La)})),Ge.Numero=Ws,Ge.Serie=La;try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"success",mensagem:`numero=${Ws}`})}catch{}}catch(Xn){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",status:"error",mensagem:Xn?.message||String(Xn)})}catch{}r({title:"Falha ao reservar numerao NF-e",description:Xn?.message||String(Xn),variant:"destructive"});return}try{const Xn=String(yt?.cpf_cnpj||"").replace(/\D/g,""),ba=String(yt?.inscricao_estadual||"").trim();Xn.length===14?yt?.ie_isento?Ge.indicador_ie_destinatario=2:ba&&ba.toUpperCase()!=="ISENTO"?Ge.indicador_ie_destinatario=1:Ge.indicador_ie_destinatario=9:Ge.indicador_ie_destinatario=9}catch{}const xa=[],js=(Xn=>String(Xn||"").replace(/\D/g,""))(yt?.cpf_cnpj);if(js||xa.push("Informe CPF/CNPJ do destinatrio"),yt?.nome||xa.push("Informe o nome/razo social do destinatrio"),yt?.logradouro||xa.push("Informe o logradouro do destinatrio"),yt?.bairro||xa.push("Informe o bairro do destinatrio"),yt?.cidade||xa.push("Informe a cidade do destinatrio"),yt?.uf||xa.push("Informe a UF do destinatrio"),yt?.cep||xa.push("Informe o CEP do destinatrio"),yt?.codigo_municipio_ibge||xa.push("Informe o cdigo IBGE do municpio do destinatrio"),js.length===14){const Xn=String(yt?.inscricao_estadual||"").trim();!yt?.ie_isento&&(!Xn||Xn.toUpperCase()==="ISENTO")&&xa.push("Informe a IE do destinatrio ou marque ISENTO")}const Rs=Array.isArray(yt?.itens)?yt.itens:[];Rs.length||xa.push("Adicione ao menos 1 item"),Rs.forEach((Xn,ba)=>{const Ws=String(Xn?.ncm||"").trim(),Bs=Number((Xn?.quantidade||"").toString().replace(",",".")),oo=String(Xn?.preco_unitario||"").trim(),ed=String(Xn?.cfop||"").trim(),Qi=(Xn?.impostos||{}).icms||{},wa=(Xn?.impostos||{}).pis||{},Za=(Xn?.impostos||{}).cofins||{};(!Ws||/^0+$/.test(Ws))&&xa.push(`Item ${ba+1}: NCM invlido`),ed||xa.push(`Item ${ba+1}: CFOP obrigatrio`),(!Bs||Bs<=0)&&xa.push(`Item ${ba+1}: quantidade invlida`),(oo===""||oo==null)&&xa.push(`Item ${ba+1}: preo unitrio obrigatrio`),Qi.cst||Qi.csosn||xa.push(`Item ${ba+1}: preencha ICMS (CST/CSOSN)`);const xo=String(wa.cst||"").trim(),Zi=String(Za.cst||"").trim();xo==="01"&&String(wa.aliquota||"").trim()===""&&xa.push(`Item ${ba+1}: preencha alquota de PIS (CST 01)`),Zi==="01"&&String(Za.aliquota||"").trim()===""&&xa.push(`Item ${ba+1}: preencha alquota de COFINS (CST 01)`)});try{Array.isArray(Ge?.Itens)&&(Array.isArray(Ge.Itens[0])?Ge.Itens[0]=Ge.Itens[0].map(Xn=>{const ba={...Xn},Ws=Number(String(ba.aliquota_pis||"").replace(",","."))||0,Bs=Number(String(ba.aliquota_cofins||"").replace(",","."))||0;return String(ba.pis_situacao_tributaria||"").trim()==="01"&&Ws<=0&&(ba.pis_situacao_tributaria="07",ba.base_calculo_pis="",ba.aliquota_pis="",ba.valor_pis=""),String(ba.cofins_situacao_tributaria||"").trim()==="01"&&Bs<=0&&(ba.cofins_situacao_tributaria="07",ba.base_calculo_cofins="",ba.aliquota_cofins="",ba.valor_cofins=""),ba}):Ge.Itens=Ge.Itens.map(Xn=>{const ba={...Xn},Ws=Number(String(ba.aliquota_pis||"").replace(",","."))||0,Bs=Number(String(ba.aliquota_cofins||"").replace(",","."))||0;return String(ba.pis_situacao_tributaria||"").trim()==="01"&&Ws<=0&&(ba.pis_situacao_tributaria="07",ba.base_calculo_pis="",ba.aliquota_pis="",ba.valor_pis=""),String(ba.cofins_situacao_tributaria||"").trim()==="01"&&Bs<=0&&(ba.cofins_situacao_tributaria="07",ba.base_calculo_cofins="",ba.aliquota_cofins="",ba.valor_cofins=""),ba}))}catch{}if(xa.length){r({title:"Faltam dados para emitir NF-e",description:xa.slice(0,6).join("  ")+(xa.length>6?`  (+${xa.length-6} itens)`:""),variant:"destructive"});return}}const Jt=X??er;if(Jt&&t)try{await Q.from("notas_fiscais").update({status:"processando"}).eq("id",Jt).eq("codigo_empresa",t)}catch{}r({title:"Enviando nota...",description:`Modelo ${rt.modelo}`});try{Rt&&Array.isArray(Ge?.Itens)&&!Array.isArray(Ge.Itens[0])&&(Ge.Itens=[Ge.Itens]),console.log("[FiscalHub][emitirNota] payload final (antes do envio)",{Dados:Ge})}catch{}let Kt,Hr=null;try{Rt?Kt=await NV({baseUrl:Tt,cnpj:Ot,dados:Ge}):Kt=await Xot({baseUrl:Tt,cnpj:Ot,dados:Ge})}catch(La){Hr=La}try{console.log("[FiscalHub][emitirNota] resposta envio",{ok:!Hr,resp:Kt,envioErro:Hr})}catch{}if(!Hr&&Kt&&typeof Kt?.status=="string"&&/erro/i.test(Kt.status)){const La=Kt?.codigo||Kt?.Codigo||"",xa=Kt?.campo||Kt?.Campo||"",Ss=Kt?.descricao||Kt?.Descricao||Kt?.mensagem||Kt?.message||"Falha na emisso",js=[xa,Ss].filter(Boolean).join("  ");r({title:`Erro na emisso${La?` ${La}`:""}`,description:js,variant:"destructive"});const Rs=X??er;if(Rs&&t)try{await Q.from("notas_fiscais").update({status:"erro"}).eq("id",Rs).eq("codigo_empresa",t),await ua()}catch{}return}if(Hr){if(!Rt){const La=Hr?.status?`HTTP ${Hr.status}`:"Erro de transporte",xa=typeof Hr?.response=="string"&&Hr.response||Hr?.response?.message||Hr?.message||"Tentando consultar status";r({title:"Envio com erro",description:`${La}. ${xa}`.trim(),variant:"warning"})}}else r({title:"Envio solicitado",description:"Consultando status..."});const hn=Kt?.chave_nota||Kt?.chave||Kt?.Chave||"";let An=null;const xr=La=>new Promise(xa=>setTimeout(xa,La));for(let La=0;La<5;La++){const xa=hn?{chave_nota:hn,chave:hn}:{numero:yt?.nNF,serie:yt?.serie};try{Rt?An=await tv({baseUrl:Tt,cnpj:Ot,dados:xa}):An=await i2({baseUrl:Tt,cnpj:Ot,dados:xa})}catch{}const Ss=String(An?.status||An?.cStat||""),js=An?.xMotivo||An?.mensagem||An?.message||"";if(Ss==="100"||/autorizad/i.test(js))break;await xr(2e3)}let Tr=An?.url_xml||An?.xml_url||Kt?.url_xml||null,jn=An?.url_pdf||An?.pdf_url||Kt?.url_pdf||null,fa=hn||An?.chave_nota||An?.chave||An?.Chave||"";if(!jn||!Tr){const La=fa?{chave_nota:fa,chave:fa}:{numero:yt?.nNF,serie:yt?.serie};try{if(Rt){const xa=await rv({baseUrl:Tt,cnpj:Ot,dados:La});jn=jn||xa?.url_pdf||xa?.pdf_url||null,fa=fa||xa?.chave||xa?.Chave||""}else{const xa=await l2({baseUrl:Tt,cnpj:Ot,dados:La});jn=jn||xa?.url_pdf||xa?.pdf_url||null,fa=fa||xa?.chave||xa?.Chave||""}}catch{}try{if(Rt){const xa=await nv({baseUrl:Tt,cnpj:Ot,dados:La});Tr=Tr||xa?.url_xml||xa?.xml_url||null,fa=fa||xa?.chave||xa?.Chave||""}else{const xa=await c2({baseUrl:Tt,cnpj:Ot,dados:La});Tr=Tr||xa?.url_xml||xa?.xml_url||null,fa=fa||xa?.chave||xa?.Chave||""}}catch{}}const qn=String(An?.status||An?.cStat||""),Fa=An?.xMotivo||An?.mensagem||An?.message||"Status retornado",ps=qn==="100"||/autorizad/i.test(Fa);if(r(ps?{title:"Autorizada",description:Fa,variant:"success"}:qn?{title:`Status: ${qn}`,description:Fa,variant:"warning"}:{title:"Consulta retornada",description:Fa}),Jt&&t)try{const La=ps||jn||Tr?"autorizada":/rejeit/i.test(Fa)?"rejeitada":Hr?"processando":"pendente";await Q.from("notas_fiscais").update({status:La,xml_chave:fa||hn||null,xml_url:Tr||null,pdf_url:jn||null,numero:rt?.nNF?Number(rt.nNF):null,serie:rt?.serie?Number(rt.serie):null,ambiente:rl(xe||{}).ambiente||null}).eq("id",Jt).eq("codigo_empresa",t),await ua()}catch{}}catch(Pe){r({title:"Falha na emisso",description:Pe?.message||String(Pe),variant:"destructive"})}},Ir=async D=>{try{const X=D||_s;if(!X){r({title:"Selecione uma comanda para importar",variant:"warning"});return}const Pe=await ci({comandaId:X,codigoEmpresa:t});if(!Pe||!Pe.length){r({title:"Nenhum item encontrado nesta comanda",variant:"warning"});return}console.log("[FiscalHub][NF-e manual] Itens da comanda para importao:",{comandaId:X,itens:Pe});const rt=Array.from(new Set((Pe||[]).map(Rt=>Rt.produto_id).filter(Boolean)));let Le=[];if(rt.length)try{let Rt=Q.from("produtos").select("id, nome, codigo_produto, unidade, ncm, cest, cfop_interno, cfop_externo, cst_icms_interno, csosn_interno, aliquota_icms_interno, cst_pis_saida, aliquota_pis_percent, aliquota_cofins_percent, cst_ipi, aliquota_ipi_percent").in("id",rt);t&&(Rt=Rt.eq("codigo_empresa",t));const{data:yt}=await Rt;Le=yt||[]}catch{Le=[]}console.log("[FiscalHub][NF-e manual] Produtos carregados para os itens da comanda:",{prodIds:rt,prods:Le});const Tt=new Map((Le||[]).map(Rt=>[Rt.id,Rt])),Ot=(Pe||[]).map(Rt=>{const yt=Tt.get(Rt.produto_id)||null,Ge=yt?.cfop_interno||yt?.cfop_externo||Qr(Te.uf),Jt=(yt?.unidade||"UN").toString().toUpperCase(),Kt=Number(Rt.preco_unitario||0)||0,Hr=yt?.aliquota_pis_percent,hn=yt?.aliquota_cofins_percent,An=yt?.cst_pis_saida||((Hr??null)!=null?"01":""),xr=(hn??null)!=null?"01":"",Tr=Number(Rt.quantidade||1)||1,jn=Kt*Tr,fa=jn>0?jn.toFixed(2):"",qn=Ss=>{const js=Number(Ss??0);return!js||!jn?"":(jn*(js/100)).toFixed(2)},Fa=qn(yt?.aliquota_icms_interno),ps=qn(Hr),La=qn(hn),xa=qn(yt?.aliquota_ipi_percent);return{descricao:Rt.descricao||yt?.nome||"Item",codigo:yt?.codigo_produto||"",ncm:yt?.ncm||"",cest:yt?.cest||"",cfop:Ge||"5102",unidade:Jt,quantidade:String(Tr),preco_unitario:Kt.toFixed(2),desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",obs:"",impostos:{origem:"",icms:{cst:yt?.cst_icms_interno||"",csosn:yt?.csosn_interno||"",base:fa,aliquota:yt?.aliquota_icms_interno!=null?String(yt.aliquota_icms_interno):"",valor:Fa},icmsst:{base:"",aliquota:"",valor:""},pis:{cst:An,aliquota:Hr!=null?String(Hr):"",valor:ps},cofins:{cst:xr,aliquota:hn!=null?String(hn):"",valor:La},ipi:{cst:yt?.cst_ipi||"",aliquota:yt?.aliquota_ipi_percent!=null?String(yt.aliquota_ipi_percent):"",valor:xa},iss:{aliquota:"",valor:""}}}});if(console.log("[FiscalHub][NF-e manual] Itens mapeados para o construtor manual:",Ot),!Ot.length){r({title:"Nenhum item encontrado nesta comanda",variant:"warning"});return}Fe(Rt=>({...Rt,itens:Ot})),pi(!1),r({title:"Itens importados"})}catch(X){r({title:"Falha ao importar itens",description:X?.message||"Tente novamente",variant:"destructive"})}},yr=async D=>{if(console.log("[FiscalHub][NF-e manual] openManualFromComanda called with id:",D),!D){r({title:"Selecione uma comanda",variant:"warning"});return}const X=(s||[]).find(Pe=>Pe.id===D);console.log("[FiscalHub][NF-e manual] Comanda selecionada para NF-e:",X),nr("cliente"),jr(!0),Fe(()=>{const Pe=new Date,rt=`${Pe.getFullYear()}-${b(Pe.getMonth()+1)}-${b(Pe.getDate())}`,Le=Number(X?.total||0)||0,Tt=(X?.finalizadorasStr||"").trim(),Ot=(si||[]).find(Rt=>{const yt=(Rt?.nome||"").trim().toLowerCase(),Ge=Tt.toLowerCase();return!yt||!Ge?!1:Ge===yt||Ge.startsWith(yt)||yt.startsWith(Ge)});return{natOp:"VENDA",serie:"1",nNF:"",indFinal:"1",indPres:"1",idDest:"1",modelo:"55",finNFe:"1",data_emissao:rt,data_saida:rt,tipo_nota:"saida",baixar_estoque:!0,destacar_st:!1,cfop_padrao:"5102",indIntermed:"0",intermediador_cnpj:"",intermediador_id:"",parte_tipo:"cliente",party_id:"",party_codigo:"",tipo_pessoa:"PJ",cpf_cnpj:"",nome:"",email:"",telefone:"",inscricao_estadual:"",ie_isento:!1,indIEDest:"9",logradouro:"",numero:"",bairro:"",cidade:"",uf:"",cep:"",codigo_municipio_ibge:"",itens:[{descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:"5102",unidade:"UN",quantidade:"1",preco_unitario:"0.00",desconto_valor:"0.00",desconto_percent:"",acrescimos_valor:"0.00",frete_valor:"0.00",seguro_valor:"0.00",obs:"",dest_icms:!1,dest_icms_info:!1,benef_fiscal:!1,impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:"",desonerado_valor:"",desoneracao_motivo:"",operacao_valor:"",aliq_diferimento:"",valor_diferido:"",reducao_percent:"",reducao_motivo:"",ad_rem:"",ad_rem_retencao:"",monofasico_bc:"",monofasico_valor:"",mono_retencao_bc:"",mono_retencao_valor:"",mono_cobrado_ant_bc:"",mono_cobrado_ant_valor:"",proprio_devido_valor:""},icmsst:{base:"",aliquota:"",valor:""},fcp:{base:"",aliquota:"",valor:""},fcpst:{base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""},combustivel:{uf:"",perc_origem_uf:"",indicador_importacao:""},cide:{base:"",aliq:"",valor:""},iss:{aliquota:"",valor:""}}}],totais:{desconto_geral:"0.00",frete:"0.00",outras_despesas:"0.00"},pagamentos:[{finalizadora_id:Ot?.id||"",tipo:Ot?.nome||X?.finalizadorasStr||"Dinheiro",bandeira:"",cnpj_credenciadora:"",autorizacao:"",valor:gr(Le.toFixed(2)),parcelas:"",troco:""}],transporte:{tipo_frete:"9",transportadora:"",placa:"",volumes:"",peso_liquido:"",peso_bruto:""},adicionais:{obs_gerais:"",info_fisco:"",info_cliente:"",referencia_doc:""}}});try{const Pe=(X?.clientesStr||"").split(",")[0].trim();if(Pe&&t){const{data:rt}=await Q.from("clientes").select("*").eq("codigo_empresa",t).ilike("nome",Pe).limit(1).single();rt&&(console.log("[FiscalHub][NF-e manual] Cliente principal encontrado para pr-preenchimento do destinatrio:",rt),Yr(rt))}}catch(Pe){console.warn("[FiscalHub][NF-e manual] Falha ao pr-preencher destinatrio a partir da comanda:",Pe)}Au(String(D)),console.log("[FiscalHub][NF-e manual] Preparando importao de itens da comanda para NF-e, comandaId=",String(D));try{await Ir(String(D))}catch(Pe){console.error("[FiscalHub][NF-e manual] Erro ao importar itens da comanda para NF-e:",Pe)}},Ut=Array.isArray(DV)?DV:[];p.useEffect(()=>{let D=!1;async function X(){if(t)try{const{data:Pe}=await Q.from("empresas").select("uf").eq("codigo_empresa",t).single();D||Ve(Pe?.uf||"")}catch{}}return X(),()=>{D=!0}},[t]),p.useEffect(()=>{let D=!1;async function X(){if(t)try{const{data:Pe}=await Q.from("empresas").select("razao_social, nome_fantasia, cnpj, inscricao_estadual, regime_tributario, endereco, logradouro, numero, bairro, cidade, uf, cep, codigo_municipio_ibge, nfe_serie, nfce_serie, ambiente, transmitenota_apikey, transmitenota_base_url, transmitenota_apikey_hml, transmitenota_base_url_hml, transmitenota_apikey_prod, transmitenota_base_url_prod").eq("codigo_empresa",t).single();D||kt(Pe||null)}catch{D||kt(null)}}return X(),()=>{D=!0}},[t]),p.useEffect(()=>{xe&&Fe(D=>{const X=D.modelo==="65"?xe.nfce_serie||D.serie:xe.nfe_serie||D.serie,Pe=String(X||D.serie||"1");return String(D.serie||"")===Pe?D:{...D,serie:Pe}})},[xe,Te.modelo]),p.useEffect(()=>{let D=!0;async function X(){if(!(!Kr||!t))try{const Pe=await uf({includeInactive:!1,codigoEmpresa:t});D&&zt(Pe||[])}catch{D&&zt([])}}return X(),()=>{D=!1}},[Kr,t]);const _n=p.useMemo(()=>{const D=(pr||"").trim().toLowerCase(),X=(st||[]).slice().sort((Pe,rt)=>{const Le=Number(String(Pe.code||0).replace(/\D/g,""))||0,Tt=Number(String(rt.code||0).replace(/\D/g,""))||0;return Le-Tt});return D?X.filter(Pe=>(Pe.name||"").toLowerCase().includes(D)||(Pe.code||"").toLowerCase().includes(D)).slice(0,100):X.slice(0,100)},[st,pr]),Qr=(D,X=Te.tipo_nota)=>{const Pe=String(fe||"").toUpperCase(),rt=String(D||"").toUpperCase(),Tt=!!Pe&&!!rt?rt===Pe:!0;return X!=="entrada"?Tt?"5102":"6102":Tt?"1102":"2102"},Ar=D=>{const Pe=(Ut.find(rt=>rt.code===D)?.desc||"").toLowerCase();return Te.tipo_nota==="entrada"&&(Pe.includes("compra")||Pe.includes("entrada"))?"COMPRA":Pe.includes("venda")?"VENDA":Pe.includes("devolu")?"DEVOLUCAO":Pe.includes("transfer")?"TRANSFERENCIA":Pe.includes("bonifica")?"BONIFICACAO":Pe.includes("remessa")?"REMESSA":Pe.includes("demonstra")?"DEMONSTRACAO":Te.natOp||"VENDA"},Fn=(D,X)=>{Fe(Pe=>{const rt=[...Pe.itens],Le=X?.cfopInterno||X?.cfopExterno||Qr(Pe.uf),Tt=Number(X?.price??X?.salePrice??0)||0,Ot=String(Pe.uf||"").toUpperCase()===String(fe||"").toUpperCase(),Rt=Ot?X?.cstIcmsInterno||"":X?.cstIcmsExterno||"",yt=Ot?X?.csosnInterno||"":X?.csosnExterno||"",Ge=Ot?X?.aliqIcmsInterno??null:X?.aliqIcmsExterno??null,Jt=X?.cstPisSaida||((X?.aliqPisPercent??null)!=null?"01":""),Kt=X?.aliqPisPercent??null,Hr=(X?.aliqCofinsPercent??null)!=null?"01":"",hn=X?.aliqCofinsPercent??null,An=X?.cstIpi||"",xr=X?.aliqIpiPercent??null;rt[D]={...rt[D],descricao:X?.name||rt[D].descricao,codigo:X?.code||rt[D].codigo,cod_barras:X?.barcode||X?.ean||X?.gtin||X?.bar_code||rt[D].cod_barras,unidade:(X?.unit||"UN").toString().toUpperCase(),ncm:X?.ncm||rt[D].ncm,cest:X?.cest||rt[D].cest,cfop:Le||rt[D].cfop,preco_unitario:Tt?Tt.toFixed(2):rt[D].preco_unitario,impostos:{...rt[D].impostos||{},icms:{...rt[D].impostos?.icms||{},cst:Rt||rt[D].impostos?.icms?.cst||"",csosn:yt||rt[D].impostos?.icms?.csosn||"",aliquota:Ge!=null?String(Ge):rt[D].impostos?.icms?.aliquota||""},pis:{...rt[D].impostos?.pis||{},cst:Jt||rt[D].impostos?.pis?.cst||"",aliquota:Kt!=null?String(Kt):rt[D].impostos?.pis?.aliquota||""},cofins:{...rt[D].impostos?.cofins||{},cst:Hr||rt[D].impostos?.cofins?.cst||"",aliquota:hn!=null?String(hn):rt[D].impostos?.cofins?.aliquota||""},ipi:{...rt[D].impostos?.ipi||{},cst:An||rt[D].impostos?.ipi?.cst||"",aliquota:xr!=null?String(xr):rt[D].impostos?.ipi?.aliquota||""}}};const Tr=Ar(Le||rt[D].cfop);return{...Pe,itens:rt,natOp:Tr}}),la(null)};p.useEffect(()=>{let D=!0;async function X(){if(!(!Vs&&!Kr||!t))try{const[Pe,rt]=await Promise.all([tw({searchTerm:null,limit:200,codigoEmpresa:t}),kst(t)]),Le=[...Pe||[],...rt||[]];D&&Qc(Le)}catch{D&&Qc([])}}return X(),()=>{D=!1}},[Vs,Kr,t]),p.useEffect(()=>{Vs&&Si("")},[Vs]);const fr=p.useMemo(()=>{const D=(Ni||"").trim().toLowerCase(),X=(Sc||[]).slice().sort((Pe,rt)=>{const Le=Number(String(Pe.codigo||Pe.codigo_cliente||Pe.codigo_fornecedor||Pe.code||0).replace(/\D/g,""))||0,Tt=Number(String(rt.codigo||rt.codigo_cliente||rt.codigo_fornecedor||rt.code||0).replace(/\D/g,""))||0;return Le-Tt});return D?X.filter(Pe=>{const rt=String(Pe.codigo||Pe.codigo_cliente||Pe.codigo_fornecedor||Pe.code||"").toLowerCase(),Le=String(Pe.nome||Pe.razao_social||Pe.apelido||"").toLowerCase(),Tt=String(Pe.cnpj||Pe.cpf||"").toLowerCase();return rt.includes(D)||Le.includes(D)||Tt.includes(D)}):X},[Sc,Ni]),Yr=D=>{if(!D)return;const X=(D.tipo_pessoa||"PJ")==="PJ"||!!D.cnpj;Fe(Pe=>({...Pe,parte_tipo:D.is_fornecedor?"fornecedor":"cliente",party_id:D.id||"",party_codigo:String(D.codigo||D.codigo_cliente||D.codigo_fornecedor||D.code||""),tipo_pessoa:X?"PJ":"PF",cpf_cnpj:(D.cnpj||D.cpf||"").toString(),nome:D.nome||D.razao_social||D.apelido||"",email:D.email||"",telefone:D.telefone||"",logradouro:D.endereco||D.logradouro||"",numero:D.numero||"",bairro:D.bairro||"",cidade:D.cidade||"",uf:D.uf||"",cep:D.cep||"",codigo_municipio_ibge:D.cidade_ibge||D.codigo_municipio_ibge||"",inscricao_estadual:D.ie||D.inscricao_estadual||"",ie_isento:D.ie==="ISENTO"||!1})),ai(!1)};p.useEffect(()=>{let D=!0;async function X(){if(!(!Kr||fn!=="pagamentos"))try{const Pe=await Fh({somenteAtivas:!0,codigoEmpresa:t});D&&zo(Array.isArray(Pe)?Pe:[])}catch{D&&zo([])}}return X(),()=>{D=!1}},[Kr,fn,t]);const $r=async D=>{const X=Ae(D);if(X.length===8)try{He(!0);let Pe=null;try{const rt=await fetch(`https://brasilapi.com.br/api/cep/v2/${X}`);rt.ok&&(Pe=await rt.json())}catch{}if(!Pe)try{const rt=await fetch(`https://viacep.com.br/ws/${X}/json/`);rt.ok&&(Pe=await rt.json())}catch{}if(Pe){const rt=Pe.street||Pe.logradouro||"",Le=Pe.neighborhood||Pe.bairro||"",Tt=Pe.city||Pe.localidade||"",Ot=(Pe.state||Pe.uf||"").toString().toUpperCase().slice(0,2),Rt=Pe.city_ibge_code||Pe.ibge||"";Fe(yt=>({...yt,logradouro:rt||yt.logradouro,bairro:Le||yt.bairro,cidade:Tt||yt.cidade,uf:Ot||yt.uf,codigo_municipio_ibge:Rt||yt.codigo_municipio_ibge}))}}finally{He(!1)}},Dr=()=>{try{const D=localStorage.getItem("auth:userProfile");return D&&JSON.parse(D)?.codigo_empresa||null}catch{return null}},dn=()=>{let D=null,X=null;if(S&&(D=new Date(S+"T00:00:00").toISOString()),M){const Pe=new Date(M+"T00:00:00");Pe.setDate(Pe.getDate()+1),X=Pe.toISOString()}return{fromISO:D,toISOExclusive:X}},Nn=async()=>{if(t){l(!0);try{let D=Q.from("comandas").select("*").eq("codigo_empresa",t).not("fechado_em","is",null).neq("status","cancelled").order("aberto_em",{ascending:!1}).limit(300);const{fromISO:X,toISOExclusive:Pe}=dn();X&&(D=D.gte("aberto_em",X)),Pe&&(D=D.lt("aberto_em",Pe));const{data:rt,error:Le}=await D;if(Le)throw Le;const Tt=rt||[],Ot=Tt.map(hn=>hn.id);let Rt={};if(Ot.length)try{Rt=await JS(Ot,t)}catch{Rt={}}let yt=[];try{yt=await Lh(t)}catch{yt=[]}const Ge=new Map((yt||[]).map(hn=>[hn.id,hn.numero]));let Jt={},Kt={};try{Jt=await c3(Ot)}catch{Jt={}}try{Kt=await d3(Ot)}catch{Kt={}}const Hr=Tt.map(hn=>{const An=Number(Rt[hn.id]||0),xr=hn?.desconto_tipo,Tr=Number(hn?.desconto_valor||0);let jn=0;xr==="percentual"&&Tr>0?jn=An*(Tr/100):xr==="fixo"&&Tr>0&&(jn=Tr);const fa=Math.max(0,An-jn);return{...hn,total_sem_desconto:An,total:fa,mesaNumero:Ge.get(hn.mesa_id),clientesStr:Array.isArray(Jt[hn.id])?Jt[hn.id].join(", "):Jt[hn.id]||"",finalizadorasStr:Array.isArray(Kt[hn.id])?Kt[hn.id].join(", "):Kt[hn.id]||""}});o(Hr)}catch(D){r({title:"Erro ao carregar",description:D.message,variant:"destructive"})}finally{l(!1)}}};p.useEffect(()=>{Nn()},[t,S,M]);const ua=async()=>{if(t){f(!0);try{let D=Q.from("notas_fiscais").select("*").eq("codigo_empresa",t).eq("modelo","55").order("id",{ascending:!1});const{data:X,error:Pe}=await D;if(Pe)throw Pe;d(X||[])}catch(D){r({title:"Erro ao carregar NF-e",description:D.message,variant:"destructive"})}finally{f(!1)}}};p.useEffect(()=>{ua()},[t]),p.useEffect(()=>{let D=!1;async function X(){if(t)try{const{data:Pe}=await Q.from("empresas").select("cnpj, inscricao_estadual, regime_tributario, cidade, uf, codigo_municipio_ibge, nfce_serie, nfce_itoken, ambiente, transmitenota_apikey, transmitenota_base_url, transmitenota_apikey_hml, transmitenota_base_url_hml, transmitenota_apikey_prod, transmitenota_base_url_prod").eq("codigo_empresa",t).single();if(D)return;const rt=[],Le=Ot=>String(Ot||"").replace(/\D/g,"");(!Le(Pe?.cnpj)||Le(Pe?.cnpj).length!==14)&&rt.push("CNPJ"),Pe?.inscricao_estadual||rt.push("Inscrio Estadual"),Pe?.regime_tributario||rt.push("CRT"),(!Pe?.cidade||!Pe?.uf)&&rt.push("Cidade/UF"),Pe?.codigo_municipio_ibge||rt.push("cMun IBGE"),Pe?.nfce_serie||rt.push("Srie NFC-e"),String(Pe?.ambiente||"homologacao")==="producao"&&!Pe?.nfce_itoken&&rt.push("CSC/IToken"),ke(rt)}catch{}}return X(),()=>{D=!0}},[t]),p.useEffect(()=>{if(!t)return;const D=setInterval(()=>{Nn()},2e4);return()=>clearInterval(D)},[t,S,M]);const ds=p.useMemo(()=>{const D=(x||"").trim().toLowerCase(),X=Pe=>{const rt=Pe.nf_status||"pendente";return I?rt==="pendente"||rt==="rejeitada":v==="all"?!0:rt===v};return(s||[]).filter(Pe=>X(Pe)).filter(Pe=>{if(!D)return!0;const rt=String(Pe.mesaNumero||""),Le=String(Pe.clientesStr||""),Tt=String(Pe.finalizadorasStr||"");return(Pe.xml_chave||"").toLowerCase().includes(D)||String(Pe.nf_numero||"").includes(D)||rt.toLowerCase().includes(D)||Le.toLowerCase().includes(D)||Tt.toLowerCase().includes(D)})},[s,x,v,I]),Xs=p.useMemo(()=>{const D=(x||"").trim().toLowerCase();return(c||[]).filter(X=>{const Pe=(X.status||"pendente").toLowerCase();if(I&&!["pendente","rejeitada","rascunho"].includes(Pe))return!1;if(v!=="all"){if(v==="pendente"){if(!["pendente","rascunho"].includes(Pe))return!1}else if(v==="processando"){if(Pe!=="processando")return!1}else if(v==="autorizada"){if(!["autorizada","emitida"].includes(Pe))return!1}else if(v==="rejeitada"){if(Pe!=="rejeitada")return!1}else if(v==="cancelada"&&Pe!=="cancelada")return!1}if(S||M){const yt=X.data_emissao||X.criado_em||X.created_at||null;if(yt){const Ge=new Date(yt);if(S){const Jt=new Date(S+"T00:00:00");if(Ge<Jt)return!1}if(M){const Jt=new Date(M+"T23:59:59.999");if(Ge>Jt)return!1}}}if(!D)return!0;const rt=String(X.numero??"").toLowerCase(),Le=String(X.serie??"").toLowerCase(),Tt=String(X.destinatario?.nome||"").toLowerCase(),Rt=(X.origem==="comanda"?`comanda ${X.comanda_id??""}`:"manual").toLowerCase();return rt.includes(D)||Le.includes(D)||Tt.includes(D)||Rt.includes(D)})},[c,x,v,I,S,M]),vn=p.useMemo(()=>{const D=[...ds||[]],X=U==="asc"?1:-1;return D.sort((Pe,rt)=>{const Le=Ot=>Ot==null?"":String(Ot).toLowerCase(),Tt=Ot=>Ot==null?0:Number(Ot)||0;return me==="aberto_em"?(new Date(Pe.aberto_em).getTime()-new Date(rt.aberto_em).getTime())*X:me==="nf_status"?Le(Pe.nf_status).localeCompare(Le(rt.nf_status))*X:me==="mesa"?(Tt(Pe.mesaNumero)-Tt(rt.mesaNumero))*X:me==="nf_numero"?(Tt(Pe.nf_numero)-Tt(rt.nf_numero))*X:me==="total"?(Number(Pe.total||Pe.total_com_desconto||0)-Number(rt.total||rt.total_com_desconto||0))*X:0})},[ds,me,U]),Or=p.useMemo(()=>[...Xs||[]].sort((X,Pe)=>{const rt=X.data_emissao||X.criado_em||X.created_at||null,Le=Pe.data_emissao||Pe.criado_em||Pe.created_at||null,Tt=rt?new Date(rt).getTime():0;return(Le?new Date(Le).getTime():0)-Tt}),[Xs]),rn=Math.max(1,Math.ceil((vn||[]).length/Y));p.useEffect(()=>{H>rn&&ie(rn)},[rn]);const gn=p.useMemo(()=>{const D=(H-1)*Y;return(vn||[]).slice(D,D+Y)},[vn,H,Y]),Vn=p.useMemo(()=>{const D=(H-1)*Y;return(Or||[]).slice(D,D+Y)},[Or,H,Y]),On=Math.max(1,Math.ceil((Or||[]).length/Y)),mr=p.useMemo(()=>!gn||gn.length===0?!1:gn.every(D=>se.includes(D.id)),[gn,se]),Zr=D=>{pe(X=>{if(D){const rt=(gn||[]).map(Le=>Le.id);return Array.from(new Set([...X||[],...rt]))}const Pe=new Set((gn||[]).map(rt=>rt.id));return(X||[]).filter(rt=>!Pe.has(rt))})},_r=D=>{q(D),wt(X=>X.includes(D)?X.filter(Pe=>Pe!==D):[...X,D])},Br=p.useMemo(()=>(s||[]).filter(D=>se.includes(D.id)),[s,se]),qr=p.useMemo(()=>Br.filter(D=>["pendente","rejeitada"].includes(String(D.nf_status||"pendente").toLowerCase())).map(D=>D.id),[Br]),Rr=p.useMemo(()=>Br.filter(D=>["processando","rejeitada","pendente","erro"].includes(String(D.nf_status||"").toLowerCase())).map(D=>D.id),[Br]),Vr=p.useMemo(()=>Br.filter(D=>String(D.nf_status||"").toLowerCase()==="autorizada").map(D=>D.id),[Br]),kn=se.length>0,le=kn&&qr.length===Br.length,we=kn&&Rr.length===Br.length,et=kn&&Vr.length===Br.length,_e=p.useMemo(()=>{const D=k||se&&se[0];return D&&(s||[]).find(X=>X.id===D)||null},[s,k,se]),St=!!_e&&["autorizada","cancelada"].includes(String(_e.nf_status||"").toLowerCase()),tt=p.useMemo(()=>(c||[]).filter(D=>se.includes(D.id)),[c,se]),Ne=p.useMemo(()=>tt.filter(D=>{const X=String(D.status||"rascunho").toLowerCase();return["rascunho","pendente","rejeitada"].includes(X)}).map(D=>D.id),[tt]),Mt=p.useMemo(()=>tt.filter(D=>String(D.status||"rascunho").toLowerCase()!=="rascunho").map(D=>D.id),[tt]),Qe=p.useMemo(()=>tt.filter(D=>{const X=String(D.status||"rascunho").toLowerCase();return["autorizada","emitida"].includes(X)}).map(D=>D.id),[tt]),ar=tt.length>0,Sn=ar&&Ne.length===tt.length,wn=ar&&Mt.length===tt.length,$n=ar&&Qe.length===tt.length,En=p.useMemo(()=>{const D=k||se&&se[0];return D&&(c||[]).find(X=>X.id===D)||null},[c,k,se]),pa=!!En&&["autorizada","emitida","cancelada"].includes(String(En.status||"").toLowerCase()),rs=async()=>{if(!qr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}const D=se.length-qr.length,X=`Emitindo ${qr.length} NFC-e elegveis${D>0?` (ignorando ${D} no elegveis)`:""}...`;r({title:"Emisso de NFC-e",description:X});for(const Pe of qr)await ss(Pe)},Ys=async()=>{if(!Rr.length){r({title:"Nenhum elegvel",description:"Selecione notas para consultar.",variant:"destructive"});return}const D=se.length-Rr.length,X=`Consultando ${Rr.length} NFC-e${D>0?` (ignorando ${D})`:""}...`;r({title:"Consulta de NFC-e",description:X});for(const Pe of Rr)await ro(Pe)},ea=async()=>{if(!Vr.length){r({title:"Nenhum elegvel",description:"Selecione NFC-e autorizadas para cancelar.",variant:"destructive"});return}const D=Vr[0];Ji(D),R("")},na=(D="filtered")=>{const X=";",Pe=Ge=>{let Jt=String(Ge??"");return Jt=Jt.replaceAll('"','""'),Jt=Jt.replaceAll(";","|"),`"${Jt}"`},Le=[["Comanda","Mesa","Clientes","Finalizadoras","StatusNF","Numero","Serie","Chave","AutorizadoEm","CanceladoEm","Total"].join(X)];let Tt=[];if(D==="selected"){const Ge=new Set(se);k&&Ge.add(k),Tt=(s||[]).filter(Jt=>Ge.has(Jt.id))}else Tt=ds||[];Tt.forEach(Ge=>{const Kt=[Ge.mesaNumero?`Mesa ${Ge.mesaNumero}`:"Balco",Ge.mesaNumero??"",Ge.clientesStr||"",Ge.finalizadorasStr||"",Ge.nf_status??"",Ge.nf_numero??"",Ge.nf_serie??"",Ge.xml_chave??"",Ge.nf_autorizado_em??"",Ge.nf_cancelado_em??"",String(Ge.total??"")];Le.push(Kt.map(Pe).join(X))});const Ot=new Blob(["\uFEFF"+Le.join(`\r
`)],{type:"text/csv;charset=utf-8;"}),Rt=URL.createObjectURL(Ot),yt=document.createElement("a");yt.href=Rt,yt.download=`central-fiscal-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(yt),yt.click(),document.body.removeChild(yt),URL.revokeObjectURL(Rt)},ya=D=>{const X=(D||"pendente").toLowerCase(),Pe={rascunho:"bg-surface-2 text-text-secondary border border-border/60",pendente:"bg-amber-500/15 text-amber-400 border border-amber-400/30",processando:"bg-blue-500/15 text-blue-400 border border-blue-400/30",autorizada:"bg-emerald-500/15 text-emerald-400 border border-emerald-400/30",rejeitada:"bg-red-500/15 text-red-400 border border-red-400/30",cancelada:"bg-red-500/15 text-red-400 border border-red-400/30"};return Pe[X]||Pe.pendente},Wa=async D=>{try{Ct(!0),ur(D);const X=t||Dr(),{empresa:Pe,payload:rt,missing:Le}=await lg({comandaId:D,codigoEmpresa:X});Er(rt),lt(Le||[]);try{const Tt=rl(Pe||{}),Ot=!!Tt&&(Tt.cnpj||"").length===14&&!!Tt.apiKey&&!!Tt.baseUrl;zr(Ot),ha(Ot&&(!Le||Le.length===0))}catch{zr(!1),ha(!1)}on(Tt=>({...Tt,[D]:(Le||[]).length})),qt(!0)}catch(X){r({title:"Falha ao gerar prvia",description:X.message,variant:"destructive"})}finally{Ct(!1)}},Ea=async(D,X)=>{await Q.from("comandas").update(X).eq("id",D).eq("codigo_empresa",t)},is=async()=>{if(ce)try{At(!0);const D=Number(ze.serie||1)||1;let X=null;try{try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ce,status:"start",mensagem:`serie=${D}`})}catch{}const{data:Le,error:Tt}=await Q.rpc("reservar_numero_fiscal",{p_modelo:"55",p_serie:D,p_codigo_empresa:t});if(Tt)throw Tt;X=Number(Le);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ce,status:"success",mensagem:`numero=${X}`})}catch{}}catch(Le){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"reservar_numero",modelo:"55",comanda_id:ce,status:"error",mensagem:Le?.message||String(Le)})}catch{}r({title:"Falha ao reservar numerao NF-e",description:Le?.message||String(Le),variant:"destructive"}),At(!1);return}xt(Le=>({...Le,nNF:String(X),serie:String(D)}));const Pe={...ze,nNF:String(X),serie:String(D),idDest:ze.idDest==="auto"||!ze.idDest?void 0:ze.idDest};try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ce,status:"start",request:Pe})}catch{}const rt=await slt({comandaId:ce,codigoEmpresa:t,modelo:"55",overrides:Pe});lr(rt);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ce,status:"success"})}catch{}r({title:"XML NF-e gerado"})}catch(D){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"gerar_xml",modelo:"55",comanda_id:ce,status:"error",mensagem:D?.message||String(D)})}catch{}r({title:"Falha ao gerar XML",description:D.message,variant:"destructive"})}finally{At(!1)}},Ns=async()=>{if(!(!Ye||!ce))try{ir(!0);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ce,status:"start"})}catch{}const D=`nfe/${t}/${ce}-${Date.now()}.xml`,X=new Blob([Ye],{type:"text/xml;charset=utf-8"}),{error:Pe}=await Q.storage.from("fiscal").upload(D,X,{contentType:"text/xml"});if(Pe)throw Pe;const{data:rt}=await Q.storage.from("fiscal").getPublicUrl(D),Le=rt?.publicUrl||null;await Q.from("comandas").update({nf_xml_url:Le||D,nf_status:"pendente"}).eq("id",ce).eq("codigo_empresa",t);try{const Tt=s.find(yt=>yt.id===ce),Ot=Number(Tt?.total||0),{ambiente:Rt}=rl(xe||{});await Q.from("notas_fiscais").insert({codigo_empresa:t,origem:"comanda",comanda_id:ce,modelo:"55",numero:ze.nNF?Number(ze.nNF):null,serie:ze.serie?Number(ze.serie):null,status:"pendente",xml_url:Le||D,pdf_url:null,valor_total:isFinite(Ot)?Ot:null,destinatario:null,ambiente:Rt||"homologacao"})}catch{}try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ce,status:"success"})}catch{}r({title:"XML salvo",description:Le?"Link pblico gerado.":"Arquivo salvo no Storage."}),await Nn()}catch(D){try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"salvar_xml",modelo:"55",comanda_id:ce,status:"error",mensagem:D?.message||String(D)})}catch{}r({title:"Falha ao salvar XML",description:D.message,variant:"destructive"})}finally{ir(!1)}},ss=async D=>{try{l(!0);const{empresa:X,payload:Pe,missing:rt}=await lg({comandaId:D,codigoEmpresa:t});if(rt&&rt.length){r({title:"Pendncias para emisso",description:rt.join(", "),variant:"destructive"});return}try{const Tr=s.find(ps=>ps.id===D),jn=Tr&&(Tr.nf_status==="erro"||Tr.nf_status==="rejeitada"),fa=!Tr?.xml_chave,qn=!Tr?.nf_numero,Fa=!Tr?.nf_serie;Tr&&jn&&fa&&qn&&Fa&&await Ea(D,{nf_status:null,nf_modelo:null,nf_serie:null,nf_numero:null,nf_protocolo:null,xml_chave:null,nf_xml_url:null,nf_pdf_url:null,xml_protocolo:null})}catch{}try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"start",request:Pe?.Dados||null})}catch{}const Le=rl(X);if(!Le.cnpj||Le.cnpj.length!==14){r({title:"CNPJ invlido",description:"CNPJ da empresa est ausente ou invlido (14 dgitos).",variant:"destructive"});return}const Tt=Number(X?.nfce_serie||X?.nfe_serie||1)||1;let Ot=null;try{const{data:Tr,error:jn}=await Q.rpc("reservar_numero_fiscal",{p_modelo:"65",p_serie:Tt,p_codigo_empresa:t});if(jn)throw jn;Ot=Number(Tr)}catch(Tr){r({title:"Falha ao reservar numerao",description:Tr?.message||String(Tr),variant:"destructive"});return}await Ea(D,{nf_numero:Ot,nf_serie:Tt});try{Pe&&Pe.Dados&&(Pe.Dados.Numero=Ot,Pe.Dados.Serie=Tt)}catch{}await Ea(D,{nf_status:"processando"});let Rt;try{Rt=await NV({baseUrl:Le.baseUrl,cnpj:Le.cnpj,dados:Pe.Dados}),console.log("[FiscalHub][NFC-e emitir] resposta completa:",Rt)}catch(Tr){console.error("[FiscalHub][NFC-e emitir] erro ao enviar NFC-e:",Tr),await Ea(D,{nf_status:"processando"});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"error",mensagem:Tr?.message||String(Tr)})}catch{}try{const jn=s.find(Xn=>Xn.id===D)||{};let fa=jn.xml_protocolo||null,qn=null;if(fa)qn=await tv({baseUrl:Le.baseUrl,cnpj:Le.cnpj,dados:{searchkey:fa,SearchKey:fa}});else{const Xn=jn.nf_numero||Ot,ba=jn.nf_serie||Tt,Ws=Xn&&ba?{numero:Xn,Numero:Xn,serie:ba,Serie:ba}:jn.xml_chave?{chave:jn.xml_chave,Chave:jn.xml_chave}:{};qn=await tv({baseUrl:Le.baseUrl,cnpj:Le.cnpj,dados:Ws});const Bs=qn?.searchkey||qn?.SearchKey||qn?.searchKey||null;Bs&&(fa=Bs,await Ea(D,{xml_protocolo:Bs}))}const Fa=String(qn?.status||qn?.Status||qn?.cStat||"").toLowerCase();if(!!(qn?.autorizada||qn?.Autorizada||qn?.sucesso||qn?.Sucesso||Fa==="100")){const Xn=qn?.chave||qn?.Chave||jn.xml_chave||null,ba=qn?.pdf_url||qn?.PdfUrl||null,Ws=qn?.xml_url||qn?.XmlUrl||null,Bs=qn?.numero||qn?.Numero||jn.nf_numero||null,oo=qn?.serie||qn?.Serie||jn.nf_serie||null;await Ea(D,{nf_status:"autorizada",xml_chave:Xn,nf_pdf_url:ba,nf_xml_url:Ws,nf_numero:Bs,nf_serie:oo});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"success",response:qn||null})}catch{}r({title:"NFC-e autorizada",description:"Documento autorizado aps fallback de consulta.",variant:"success"}),await Nn();return}const La=jn.nf_numero||Ot,xa=jn.nf_serie||Tt;let Ss=null,js=null,Rs=jn.xml_chave||null;if(fa){try{const Xn=await rv({baseUrl:Le.baseUrl,cnpj:Le.cnpj,dados:{searchkey:fa,SearchKey:fa}});console.log("[FiscalHub][NFC-e emitir->PDF fallback] resp:",Xn),Ss=Xn?.pdf_url||Xn?.PdfUrl||null,Rs=Xn?.chave||Xn?.Chave||Rs}catch{}try{const Xn=await nv({baseUrl:Le.baseUrl,cnpj:Le.cnpj,dados:{searchkey:fa,SearchKey:fa}});console.log("[FiscalHub][NFC-e emitir->XML fallback] resp:",Xn),js=Xn?.xml_url||Xn?.XmlUrl||null,Rs=Rs||Xn?.chave||Xn?.Chave||Rs}catch{}}else{try{const Xn=await rv({baseUrl:Le.baseUrl,cnpj:Le.cnpj,dados:{numero:La,Numero:La,serie:xa,Serie:xa}});console.log("[FiscalHub][NFC-e emitir->PDF fallback] resp:",Xn),Ss=Xn?.pdf_url||Xn?.PdfUrl||null,Rs=Xn?.chave||Xn?.Chave||Rs}catch{}try{const Xn=await nv({baseUrl:Le.baseUrl,cnpj:Le.cnpj,dados:{numero:La,Numero:La,serie:xa,Serie:xa}});console.log("[FiscalHub][NFC-e emitir->XML fallback] resp:",Xn),js=Xn?.xml_url||Xn?.XmlUrl||null,Rs=Rs||Xn?.chave||Xn?.Chave||Rs}catch{}}if(Ss||js||Rs){await Ea(D,{nf_status:Ss||js?"autorizada":"processando",nf_pdf_url:Ss||jn.nf_pdf_url,nf_xml_url:js||jn.nf_xml_url,xml_chave:Rs||jn.xml_chave,nf_numero:La,nf_serie:xa}),Ss&&(r({title:"NFC-e autorizada",description:"DANFE encontrada (fallback).",variant:"success"}),window.open(Ss,"_blank")),await Nn();return}}catch{}throw Tr}const yt=Rt?.chave||Rt?.Chave||Rt?.chaveAcesso||null,Ge=Rt?.numero||Rt?.Numero||null,Jt=Rt?.serie||Rt?.Serie||null,Kt=Rt?.pdf_url||Rt?.PdfUrl||null,Hr=Rt?.xml_url||Rt?.XmlUrl||null,hn=Rt?.protocolo||Rt?.Protocolo||null,An=Rt?.searchkey||Rt?.SearchKey||Rt?.searchKey||null,xr=!!(Rt?.autorizada||Rt?.Autorizada||Rt?.sucesso||Rt?.Sucesso||yt);await Ea(D,{nf_status:xr?"autorizada":"processando",xml_chave:yt,nf_numero:Ge,nf_serie:Jt,nf_pdf_url:Kt,nf_xml_url:Hr,xml_protocolo:hn||An});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"emitir",modelo:"65",comanda_id:D,status:"success",response:Rt||null})}catch{}r({title:xr?"NFC-e autorizada":"Emisso enviada",description:xr?"Documento autorizado.":"Aguardando autorizao."}),await Nn()}catch(X){r({title:"Falha ao emitir",description:X.message,variant:"destructive"})}finally{l(!1)}},ro=async D=>{try{l(!0);const X=s.find(xr=>xr.id===D);if(!X)return;const{empresa:Pe}=await lg({comandaId:D,codigoEmpresa:t}),rt=rl(Pe);try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"start",request:X.xml_protocolo?{searchkey:X.xml_protocolo}:{numero:X.nf_numero,serie:X.nf_serie}})}catch{}let Le=null,Tt=!1,Ot="",Rt="Consulta retornada",yt=X.nf_pdf_url,Ge=X.nf_xml_url,Jt=X.xml_chave,Kt=X.nf_numero,Hr=X.nf_serie;const hn=!!X.xml_protocolo;if(hn)try{Le=await tv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:{SearchKey:X.xml_protocolo,searchkey:X.xml_protocolo}}),console.log("[FiscalHub][NFC-e consulta] resposta completa:",Le),Ot=String(Le?.status||Le?.Status||Le?.cStat||"").toLowerCase(),Rt=Le?.xMotivo||Le?.mensagem||Le?.message||Rt,Tt=!!(Le?.autorizada||Le?.Autorizada||Le?.sucesso||Le?.Sucesso||Ot==="100"),yt=Le?.pdf_url||Le?.PdfUrl||yt,Ge=Le?.xml_url||Le?.XmlUrl||Ge,Jt=Le?.chave||Le?.Chave||Jt,Kt=Le?.numero||Le?.Numero||Kt,Hr=Le?.serie||Le?.Serie||Hr}catch(xr){console.warn("[FiscalHub][NFC-e consulta] consulta por SearchKey falhou, tentando PDF/XML direto",xr)}if(!yt&&!Ge){const xr=hn?{searchkey:X.xml_protocolo||"",SearchKey:X.xml_protocolo||""}:{numero:Kt,Numero:Kt,serie:Hr,Serie:Hr};try{const Tr=await rv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:xr});console.log("[FiscalHub][NFC-e consulta] PDF resp:",Tr),yt=Tr?.pdf_url||Tr?.PdfUrl||yt,Jt=Tr?.chave||Tr?.Chave||Jt}catch(Tr){console.warn("[FiscalHub][NFC-e consulta] PDF erro:",Tr)}try{const Tr=await nv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:xr});console.log("[FiscalHub][NFC-e consulta] XML resp:",Tr),Ge=Tr?.xml_url||Tr?.XmlUrl||Ge,Jt=Jt||Tr?.chave||Tr?.Chave||Jt}catch(Tr){console.warn("[FiscalHub][NFC-e consulta] XML erro:",Tr)}Tt=!!(yt||Ge||Tt),Ot=Tt?"100":X.nf_status||"pendente",Rt=Tt?"Documento localizado":Rt}let An=X.nf_status||"processando";Tt?An="autorizada":Ot&&Ot.includes&&Ot.includes("rejeit")?An="rejeitada":Ot==="erro"?An=X.nf_status||"pendente":typeof Ot=="string"&&Ot&&(An=Ot),await Ea(D,{nf_status:An,nf_pdf_url:yt,nf_xml_url:Ge,xml_chave:Jt,nf_numero:Kt,nf_serie:Hr});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"consultar",modelo:"65",comanda_id:D,status:"success",response:Le||null})}catch{}r({title:Tt?"NFC-e autorizada":`Status: ${Ot||An}`,description:Rt,variant:Tt?"success":"warning"}),await Nn()}catch(X){r({title:"Falha ao consultar",description:X.message,variant:"destructive"})}finally{l(!1)}},xl=async(D,X)=>{try{const Pe=(X||"").trim();if(!Pe){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}l(!0);const{empresa:rt}=await lg({comandaId:D,codigoEmpresa:t}),Le=rl(rt),Tt=s.find(Ge=>Ge.id===D),Ot=Tt&&Tt.xml_chave?{chave:Tt.xml_chave,motivo:Pe}:{numero:Tt?.nf_numero,serie:Tt?.nf_serie,motivo:Pe};try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"start",request:Ot})}catch{}let Rt=await SV({baseUrl:Le.baseUrl,apiKey:Le.apiKey,cnpj:Le.cnpj,dados:Ot});try{const Ge=Rt&&typeof Rt.status=="string"&&/erro/i.test(Rt.status),Jt=Rt?.codigo||Rt?.Codigo||"",Kt=(Rt?.campo||Rt?.Campo||"").toString().toLowerCase();if(Ge&&(Jt==="1301"||Kt==="searchkey")&&Tt?.xml_protocolo){const hn={searchkey:Tt.xml_protocolo,SearchKey:Tt.xml_protocolo,motivo:Pe};try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"retry_searchkey",request:hn})}catch{}Rt=await SV({baseUrl:Le.baseUrl,apiKey:Le.apiKey,cnpj:Le.cnpj,dados:hn})}}catch{}if(Rt&&typeof Rt.status=="string"&&/erro/i.test(Rt.status)){const Ge=Rt?.codigo||Rt?.Codigo||"",Jt=Rt?.campo||Rt?.Campo||"",Kt=Rt?.descricao||Rt?.Descricao||Rt?.mensagem||Rt?.message||"Falha ao cancelar NFC-e",Hr=[Jt,Kt].filter(Boolean).join("  ");r({title:`Erro ao cancelar${Ge?` ${Ge}`:""}`,description:Hr,variant:"destructive"});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"business_error",response:Rt||null})}catch{}return}await Ea(D,{nf_status:"cancelada"});try{await Q.from("auditoria_fiscal").insert({codigo_empresa:t,acao:"cancelar",modelo:"65",comanda_id:D,status:"success",response:Rt||null})}catch{}r({title:"NFC-e cancelada"}),await Nn()}catch(Pe){r({title:"Falha ao cancelar",description:Pe.message,variant:"destructive"})}finally{l(!1)}};return a.jsxs("div",{className:"relative p-4",children:[a.jsx(Y0,{children:a.jsx("title",{children:"Central Fiscal"})}),!1,a.jsxs(_d,{value:B,onValueChange:z,className:"w-full",children:[a.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Central Fiscal"}),a.jsxs("div",{className:"flex items-center gap-2 sm:hidden",children:[a.jsxs(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>na("filtered"),title:"Exportar CSV das comandas/NF",children:[a.jsx(ws,{className:"w-4 h-4 mr-1"}),a.jsx("span",{children:"CSV"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>n("/configuracao-fiscal"),title:"Configurao Fiscal da Empresa",children:a.jsx(Wc,{className:"w-4 h-4"})})]})]}),a.jsx("p",{className:"text-xs text-text-secondary mt-1 hidden sm:block",children:"Acompanhe NFC-e e NF-e, pendncias e cancelamentos em um s lugar."}),(()=>{const X=rl(xe||{})?.ambiente||"homologacao",Pe=X==="producao"?"Produo":"Homologao",rt=X==="producao"?"bg-emerald-500/15 text-emerald-600 border-emerald-600/30":"bg-amber-500/15 text-amber-700 border-amber-600/30";return a.jsxs("div",{className:["mt-2 inline-flex items-center gap-2 text-[11px] px-2 py-0.5 rounded-full border hidden sm:inline-flex",rt].join(" "),children:[a.jsx("span",{children:"Ambiente:"}),a.jsx("strong",{children:Pe})]})})()]}),a.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[a.jsxs(xc,{className:"hidden sm:inline-flex rounded-full bg-surface-2 px-1 py-0.5",children:[a.jsx(Ya,{value:"nfce",children:"NFC-e"}),a.jsx(Ya,{value:"nfe",children:"NF-e"}),a.jsx(Ya,{value:"compras",children:"NF-e Entrada (Compras)"})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsxs(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>na("filtered"),title:"Exportar CSV das comandas/NF",children:[a.jsx(ws,{className:"w-4 h-4 mr-1"}),a.jsx("span",{children:"CSV"})]}),a.jsx(Z,{type:"button",variant:"outline",size:"sm",className:"rounded-full",onClick:()=>n("/configuracao-fiscal"),title:"Configurao Fiscal da Empresa",children:a.jsx(Wc,{className:"w-4 h-4"})})]})]})]}),a.jsxs(xc,{className:"sm:hidden w-full justify-start rounded-lg bg-surface-2 px-1 py-1 overflow-x-auto",children:[a.jsx(Ya,{value:"nfce",className:"flex-1 min-w-[90px]",children:"NFC-e"}),a.jsx(Ya,{value:"nfe",className:"flex-1 min-w-[100px]",children:"NF-e"}),a.jsx(Ya,{value:"compras",className:"flex-1 min-w-[130px]",children:"NF-e Entrada"})]}),a.jsxs("div",{className:"hidden sm:flex bg-surface-2/60 border border-border/70 rounded-xl px-3 py-3 flex flex-wrap items-center gap-3",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2 min-w-[220px]",children:[a.jsx(ct,{className:"text-xs text-text-secondary",children:"Buscar"}),a.jsx(It,{value:h,onChange:D=>m(D.target.value),placeholder:"Chave, nmero, cliente...",className:"w-[200px] sm:w-60 h-8 text-xs"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ct,{className:"text-xs text-text-secondary",children:"Status"}),a.jsxs(Zn,{value:v,onValueChange:y,children:[a.jsx(Yn,{className:"w-[150px] h-8 rounded-full text-xs",children:a.jsx(ta,{placeholder:"Selecionar status"})}),a.jsxs(Jn,{className:"rounded-xl text-xs",children:[a.jsx(nt,{value:"all",children:"Todos"}),a.jsx(nt,{value:"pendente",children:"Pendente"}),a.jsx(nt,{value:"processando",children:"Em andamento"}),a.jsx(nt,{value:"autorizada",children:"Autorizada"}),a.jsx(nt,{value:"rejeitada",children:"Rejeitada"}),a.jsx(nt,{value:"cancelada",children:"Cancelada"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ct,{className:"text-xs text-text-secondary",children:"Perodo"}),a.jsxs("div",{className:"inline-flex items-center gap-2",children:[a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:S?new Date(S+"T00:00:00").toLocaleDateString("pt-BR"):"Incio"})})}),a.jsx(Go,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:S?new Date(S+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const X=D.getFullYear(),Pe=b(D.getMonth()+1),rt=b(D.getDate());A(`${X}-${Pe}-${rt}`)}})})]}),a.jsx("span",{className:"text-text-secondary text-xs",children:"at"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:M?new Date(M+"T00:00:00").toLocaleDateString("pt-BR"):"Fim"})})}),a.jsx(Go,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:M?new Date(M+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const X=D.getFullYear(),Pe=b(D.getMonth()+1),rt=b(D.getDate());O(`${X}-${Pe}-${rt}`)}})})]})]})]}),a.jsxs("div",{className:"hidden sm:inline-flex items-center gap-2 text-xs ml-auto",children:[a.jsx(Qs,{checked:I,onCheckedChange:T,className:"rounded-full border-warning data-[state=checked]:bg-warning"}),a.jsx("span",{children:"Somente pendentes/rejeitadas"})]})]}),a.jsxs("div",{className:"sm:hidden mt-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx(It,{value:h,onChange:D=>m(D.target.value),placeholder:"Chave, nmero, cliente...",className:"h-9 text-xs"})}),a.jsx(Z,{type:"button",variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",onClick:()=>re(D=>!D),children:a.jsx(wN,{className:"w-4 h-4"})})]}),De&&a.jsxs("div",{className:"mt-2 bg-surface-2/60 border border-border/70 rounded-xl px-3 py-3 flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ct,{className:"text-xs text-text-secondary",children:"Status"}),a.jsxs(Zn,{value:v,onValueChange:y,children:[a.jsx(Yn,{className:"h-8 flex-1 rounded-full text-xs",children:a.jsx(ta,{placeholder:"Selecionar status"})}),a.jsxs(Jn,{className:"rounded-xl text-xs",children:[a.jsx(nt,{value:"all",children:"Todos"}),a.jsx(nt,{value:"pendente",children:"Pendente"}),a.jsx(nt,{value:"processando",children:"Em andamento"}),a.jsx(nt,{value:"autorizada",children:"Autorizada"}),a.jsx(nt,{value:"rejeitada",children:"Rejeitada"}),a.jsx(nt,{value:"cancelada",children:"Cancelada"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ct,{className:"text-xs text-text-secondary",children:"Perodo"}),a.jsxs("div",{className:"inline-flex items-center gap-2",children:[a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:S?new Date(S+"T00:00:00").toLocaleDateString("pt-BR"):"Incio"})})}),a.jsx(Go,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:S?new Date(S+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const X=D.getFullYear(),Pe=b(D.getMonth()+1),rt=b(D.getDate());A(`${X}-${Pe}-${rt}`)}})})]}),a.jsx("span",{className:"text-text-secondary text-xs",children:"at"}),a.jsxs(Qo,{modal:!0,children:[a.jsx(Zo,{asChild:!0,children:a.jsx("button",{type:"button",className:"h-7 px-2 rounded-md bg-surface border border-border text-xs inline-flex items-center gap-1",children:a.jsx("span",{children:M?new Date(M+"T00:00:00").toLocaleDateString("pt-BR"):"Fim"})})}),a.jsx(Go,{className:"w-auto p-2 z-50",align:"start",children:a.jsx(ei,{mode:"single",selected:M?new Date(M+"T00:00:00"):void 0,onSelect:D=>{if(!D)return;const X=D.getFullYear(),Pe=b(D.getMonth()+1),rt=b(D.getDate());O(`${X}-${Pe}-${rt}`)}})})]})]})]})]})]})]}),cn.length>0&&a.jsx("div",{className:"mb-4 p-3 rounded-md border border-warning/40 bg-warning/10 text-warning",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm",children:"Pendncias fiscais da empresa"}),a.jsxs("p",{className:"text-xs",children:["Preencha: ",cn.join(", "),"."]})]}),a.jsx(Z,{size:"sm",className:"bg-warning text-black hover:bg-warning/90",onClick:()=>n("/configuracao-fiscal"),children:"Corrigir agora"})]})}),a.jsxs(yo,{value:"nfce",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap sm:flex-nowrap whitespace-normal sm:whitespace-nowrap relative z-10",children:[a.jsxs("div",{className:"hidden sm:flex ml-auto items-center gap-2 text-xs text-text-secondary",children:[a.jsxs("span",{children:["Selecionadas: ",a.jsx("strong",{className:"text-text-primary",children:se.length})]}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>pe([]),disabled:se.length===0,children:"Limpar"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>pe(Array.from(new Set((ds||[]).map(D=>D.id)))),disabled:(ds||[]).length===0,children:"Selecionar filtrados"})]}),a.jsxs("div",{className:"flex sm:hidden items-center gap-2 w-full justify-start",children:[a.jsx(Z,{size:"sm",variant:"outline",className:"flex-1",disabled:se.length===0&&!k,onClick:()=>(async()=>{const D=k||se[0],X=s.find(Pe=>Pe.id===D);if(X){if(X.nf_pdf_url){window.open(X.nf_pdf_url,"_blank");return}try{l(!0);const{empresa:Pe}=await lg({comandaId:X.id,codigoEmpresa:t}),rt=rl(Pe);let Le=null,Tt=null,Ot=X.xml_chave||null,Rt=!1;if(X.xml_protocolo)try{const yt=await tv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:{SearchKey:X.xml_protocolo,searchkey:X.xml_protocolo}});console.log("[FiscalHub][NFC-e visualizar->consulta] resposta completa:",yt);const Ge=String(yt?.status||yt?.Status||yt?.cStat||"").toLowerCase();Rt=!!(yt?.autorizada||yt?.Autorizada||yt?.sucesso||yt?.Sucesso||Ge==="100"),Le=yt?.pdf_url||yt?.PdfUrl||null,Tt=yt?.xml_url||yt?.XmlUrl||null,Ot=yt?.chave||yt?.Chave||Ot}catch(yt){console.warn("[FiscalHub][NFC-e visualizar] consulta por SearchKey falhou, tentando PDF/XML direto",yt)}if(!Le&&!Tt){const yt={numero:X.nf_numero,Numero:X.nf_numero,serie:X.nf_serie,Serie:X.nf_serie};try{const Ge=await rv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:yt});Le=Ge?.pdf_url||Ge?.PdfUrl||Le,Ot=Ge?.chave||Ge?.Chave||Ot}catch{}try{const Ge=await nv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:yt});Tt=Ge?.xml_url||Ge?.XmlUrl||Tt,Ot=Ot||Ge?.chave||Ge?.Chave||Ot}catch{}Rt=!!(Le||Tt||Rt)}(Le||Tt||Rt||Ot)&&await Q.from("comandas").update({nf_pdf_url:Le||X.nf_pdf_url,nf_xml_url:Tt||X.nf_xml_url,xml_chave:Ot||X.xml_chave,nf_status:Rt?"autorizada":X.nf_status||null}).eq("id",X.id).eq("codigo_empresa",t),Le?window.open(Le,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"}),await Nn()}catch(Pe){r({title:"Falha ao visualizar",description:Pe.message,variant:"destructive"})}finally{l(!1)}}})(),children:"Visualizar"}),a.jsxs(Z,{size:"sm",className:"flex-1",disabled:!le,onClick:()=>{if(!qr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}Ht(!0)},children:["Emitir (",qr.length||0,")"]}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",className:"px-2",disabled:Ur&&!F&&!V,children:"Mais"})}),a.jsxs(Yu,{align:"end",children:[a.jsxs(bs,{disabled:!we,onClick:Ys,children:["Consultar (",Rr.length||0,")"]}),a.jsx(bs,{disabled:!et,onClick:ea,children:a.jsxs("span",{className:"text-destructive",children:["Cancelar (",Vr.length||0,")"]})}),a.jsx(bs,{onClick:()=>na("selected"),children:"Exportar CSV"}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfce",scope:"selected",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfce",scope:"selected",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(bs,{disabled:(ds||[]).length===0,onClick:()=>ne({tipo:"nfce",scope:"filtered",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(bs,{disabled:(ds||[]).length===0,onClick:()=>ne({tipo:"nfce",scope:"filtered",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",disabled:!St,onClick:()=>(async()=>{const D=k||se[0],X=s.find(Pe=>Pe.id===D);if(X){if(X.nf_pdf_url){window.open(X.nf_pdf_url,"_blank");return}try{l(!0);const{empresa:Pe}=await lg({comandaId:X.id,codigoEmpresa:t}),rt=rl(Pe);let Le=null,Tt=null,Ot=X.xml_chave||null,Rt=!1;if(X.xml_protocolo)try{const yt=await tv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:{SearchKey:X.xml_protocolo,searchkey:X.xml_protocolo}});console.log("[FiscalHub][NFC-e visualizar->consulta] resposta completa:",yt);const Ge=String(yt?.status||yt?.Status||yt?.cStat||"").toLowerCase();Rt=!!(yt?.autorizada||yt?.Autorizada||yt?.sucesso||yt?.Sucesso||Ge==="100"),Le=yt?.pdf_url||yt?.PdfUrl||null,Tt=yt?.xml_url||yt?.XmlUrl||null,Ot=yt?.chave||yt?.Chave||Ot}catch(yt){console.warn("[FiscalHub][NFC-e visualizar] consulta por SearchKey falhou, tentando PDF/XML direto",yt)}if(!Le&&!Tt){const yt={numero:X.nf_numero,Numero:X.nf_numero,serie:X.nf_serie,Serie:X.nf_serie};try{const Ge=await rv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:yt});Le=Ge?.pdf_url||Ge?.PdfUrl||Le,Ot=Ge?.chave||Ge?.Chave||Ot}catch{}try{const Ge=await nv({baseUrl:rt.baseUrl,cnpj:rt.cnpj,dados:yt});Tt=Ge?.xml_url||Ge?.XmlUrl||Tt,Ot=Ot||Ge?.chave||Ge?.Chave||Ot}catch{}Rt=!!(Le||Tt||Rt)}(Le||Tt||Rt||Ot)&&await Q.from("comandas").update({nf_pdf_url:Le||X.nf_pdf_url,nf_xml_url:Tt||X.nf_xml_url,xml_chave:Ot||X.xml_chave,nf_status:Rt?"autorizada":X.nf_status||null}).eq("id",X.id).eq("codigo_empresa",t),Le?window.open(Le,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"}),await Nn()}catch(Pe){r({title:"Falha ao visualizar",description:Pe.message,variant:"destructive"})}finally{l(!1)}}})(),children:"Visualizar"}),a.jsxs(Z,{size:"sm",disabled:!le,onClick:()=>{if(!qr.length){r({title:"Nenhum elegvel",description:"Selecione notas pendentes/rejeitadas para emitir.",variant:"destructive"});return}Ht(!0)},children:["Emitir (",qr.length||0,")"]}),a.jsxs(Z,{size:"sm",variant:"outline",disabled:!we,onClick:Ys,children:["Consultar (",Rr.length||0,")"]}),a.jsxs(Z,{size:"sm",variant:"destructive",disabled:!et,onClick:ea,children:["Cancelar (",Vr.length||0,")"]}),a.jsx(Z,{size:"sm",variant:"outline",disabled:se.length===0&&!k,onClick:()=>na("selected"),children:"Exportar CSV"}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",disabled:Ur,children:"Aes"})}),a.jsxs(Yu,{align:"end",children:[a.jsx(bs,{disabled:se.length===0&&!k,onClick:()=>na("selected"),children:"Exportar CSV"}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfce",scope:"selected",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfce",scope:"selected",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(bs,{disabled:(ds||[]).length===0,onClick:()=>ne({tipo:"nfce",scope:"filtered",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(bs,{disabled:(ds||[]).length===0,onClick:()=>ne({tipo:"nfce",scope:"filtered",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]})]}),a.jsxs("div",{className:"sm:hidden space-y-2 -mx-2",children:[(!gn||gn.length===0)&&a.jsx("div",{className:"px-3 py-4 text-center text-text-muted border border-border rounded-md bg-surface",children:i?"Carregando...":"Nada por aqui"}),gn.map(D=>{const X=D.nf_status||"pendente",Pe=X==="autorizada"?"bg-emerald-500/5 border-emerald-500/40":X==="cancelada"?"bg-red-500/5 border-red-500/40":X==="rejeitada"?"bg-orange-500/5 border-orange-500/40":X==="processando"||X==="em_andamento"?"bg-sky-500/5 border-sky-500/40":X==="pendente"?"bg-amber-500/5 border-amber-500/40":"bg-surface border-border/70";return a.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs flex flex-col gap-1 border ${Pe}`,onClick:()=>te(D.id,!G(D.id)),children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{onClick:rt=>{rt.stopPropagation(),te(D.id,!G(D.id))},className:"pt-1",children:a.jsx(Qs,{checked:G(D.id),onCheckedChange:rt=>te(D.id,!!rt)})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"font-medium text-sm truncate",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${ya(X)}`,children:X})]}),a.jsxs("div",{className:"text-xs text-text-secondary flex items-center justify-between gap-2 mt-0.5",children:[a.jsx("span",{children:hb(D.aberto_em)}),a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",ao(D.total||D.total_com_desconto)]})]}),a.jsxs("div",{className:"mt-1 text-xs text-text-secondary truncate",title:D.clientesStr||"",children:[a.jsx("span",{className:"text-text-muted",children:"Cliente(s): "}),a.jsx("span",{className:"text-text-primary",children:D.clientesStr||""})]}),a.jsxs("div",{className:"mt-0.5 text-xs text-text-secondary flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"truncate",title:D.finalizadorasStr||"",children:[a.jsx("span",{className:"text-text-muted",children:"Pagamento: "}),a.jsx("span",{className:"text-text-primary",children:D.finalizadorasStr||""})]}),a.jsxs("span",{className:"whitespace-nowrap text-text-primary text-[11px]",children:[D.nf_numero??"","/",D.nf_serie??""]})]}),a.jsxs("div",{className:"mt-0.5 text-[11px] text-text-secondary",title:D.xml_chave||"",children:[a.jsx("span",{className:"text-text-muted block mb-0.5",children:"Chave:"}),a.jsx("span",{className:"text-text-primary text-[10px] truncate block",children:D.xml_chave||""})]})]})]}),(D.nf_pdf_url||D.nf_xml_url)&&a.jsx("div",{className:"mt-2 border-t border-border/60 pt-2 text-[11px]",children:a.jsxs("div",{className:"flex gap-2",children:[D.nf_pdf_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.nf_pdf_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Abrir DANFE"})}),D.nf_xml_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.nf_xml_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Baixar XML"})})]})})]},D.id)})]}),a.jsx("div",{className:"hidden sm:block bg-surface rounded border border-border overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"w-8 px-3 py-2",children:a.jsx(Qs,{checked:mr,onCheckedChange:D=>Zr(!!D)})}),a.jsxs("th",{className:"text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{L(me==="aberto_em"&&U==="asc"?"desc":"asc"),be("aberto_em")},children:["Abertura ",me==="aberto_em"?U==="asc"?"":"":""]}),a.jsxs("th",{className:"text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{L(me==="nf_status"&&U==="asc"?"desc":"asc"),be("nf_status")},children:["Status ",me==="nf_status"?U==="asc"?"":"":""]}),a.jsxs("th",{className:"hidden text-left px-3 py-2 cursor-pointer select-none",onClick:()=>{L(me==="mesa"&&U==="asc"?"desc":"asc"),be("mesa")},children:["Mesa ",me==="mesa"?U==="asc"?"":"":""]}),a.jsx("th",{className:"text-left px-3 py-2",children:"Clientes"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Finalizadoras"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Nmero/Srie"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Chave"}),a.jsxs("th",{className:"text-right px-3 py-2 cursor-pointer select-none",onClick:()=>{L(me==="total"&&U==="asc"?"desc":"asc"),be("total")},children:["Total ",me==="total"?U==="asc"?"":"":""]})]})}),a.jsxs("tbody",{children:[(!gn||gn.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"px-3 py-4 text-center text-text-muted",children:i?"Carregando...":"Nada por aqui"})}),gn.map(D=>{const X=D.nf_status||"pendente";return a.jsxs(Ce.Fragment,{children:[a.jsxs("tr",{className:`border-t border-border/60 transition-colors ${k===D.id?"bg-surface-2 ring-2 ring-[#FF7A1A]/60 rounded-md":"hover:bg-surface-2/50"}`,onClick:()=>_r(D.id),children:[a.jsx("td",{className:"px-3 py-2",onClick:Pe=>Pe.stopPropagation(),children:a.jsx(Qs,{checked:G(D.id),onCheckedChange:Pe=>te(D.id,!!Pe)})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:hb(D.aberto_em)}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${ya(X)}`,children:X})}),a.jsx("td",{className:"hidden px-3 py-2 whitespace-nowrap",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.clientesStr||"",children:D.clientesStr||""}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.finalizadorasStr||"",children:D.finalizadorasStr||""}),a.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[D.nf_numero??"","/",D.nf_serie??""]}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[220px] truncate",title:D.xml_chave||"",children:D.xml_chave?`${String(D.xml_chave).slice(0,8)}...${String(D.xml_chave).slice(-4)}`:""}),a.jsxs("td",{className:"px-3 py-2 text-right whitespace-nowrap",children:["R$ ",ao(D.total||D.total_com_desconto)]})]}),Gt(D.id)&&a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"px-3 py-3 bg-surface-2/40 border-t border-border",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Mesa: "}),a.jsx("span",{className:"text-text-primary",children:D.mesaNumero?`Mesa ${D.mesaNumero}`:"Balco"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Clientes: "}),a.jsx("span",{className:"text-text-primary",children:D.clientesStr||""})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Finalizadoras: "}),a.jsx("span",{className:"text-text-primary",children:D.finalizadorasStr||""})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Nmero/Srie: "}),a.jsxs("span",{className:"text-text-primary",children:[D.nf_numero??"","/",D.nf_serie??""]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-secondary",children:"Chave: "}),a.jsx("span",{className:"text-text-primary",title:D.xml_chave||"",children:D.xml_chave||""})]}),a.jsxs("div",{className:"text-text-secondary mt-1",children:["Total: ",a.jsxs("span",{className:"text-text-primary",children:["R$ ",ao(D.total||D.total_com_desconto)]})]})]}),a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"flex gap-2",children:[D.nf_pdf_url&&a.jsx("a",{className:"inline-flex",href:D.nf_pdf_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",children:"Abrir DANFE"})}),D.nf_xml_url&&a.jsx("a",{className:"inline-flex",href:D.nf_xml_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",children:"Baixar XML"})})]})})]})})})]},D.id)})]})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[a.jsxs("div",{className:"sm:hidden text-[11px] text-text-secondary",children:["Pg. ",H," de ",rn]}),a.jsxs("div",{className:"hidden sm:block text-xs text-text-secondary",children:["Pgina ",H," de ",rn,"  ",vn.length," registros"]}),a.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Itens por pgina"}),a.jsxs("select",{className:"h-7 rounded-md bg-surface border border-border text-xs px-2",value:Y,onChange:D=>{ie(1),W(Number(D.target.value)||50)},children:[a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]})]}),a.jsx(Z,{size:"sm",variant:"outline",disabled:H<=1,onClick:()=>ie(D=>Math.max(1,D-1)),children:"Anterior"}),a.jsx(Z,{size:"sm",variant:"outline",disabled:H>=rn,onClick:()=>ie(D=>Math.min(rn,D+1)),children:"Prxima"})]})]})]}),a.jsxs(yo,{value:"nfe",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap whitespace-nowrap relative z-10",children:[a.jsxs("div",{className:"hidden sm:flex ml-auto items-center gap-2 text-xs text-text-secondary",children:[a.jsxs("span",{children:["Selecionadas: ",a.jsx("strong",{className:"text-text-primary",children:se.length})]}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>pe([]),disabled:se.length===0,children:"Limpar"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>{const D=Or||[];pe(Array.from(new Set(D.map(X=>X.id))))},disabled:(Or||[]).length===0,children:"Selecionar filtrados"})]}),a.jsxs("div",{className:"flex sm:hidden items-center gap-2 w-full justify-start",children:[a.jsx(Z,{size:"sm",variant:"outline",className:"flex-1",disabled:!pa,onClick:()=>(async()=>{try{const D=c||[],X=k||se&&se[0],Pe=D.find(Ge=>Ge.id===X);if(!Pe){r({title:"NF-e no encontrada",variant:"warning"});return}if(Pe.pdf_url){window.open(Pe.pdf_url,"_blank");return}if(!xe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:rt,cnpj:Le}=rl(xe),Tt=Pe.xml_chave?{chave:Pe.xml_chave,chave_nota:Pe.xml_chave}:{numero:Pe.numero,serie:Pe.serie};l(!0);let Ot=null,Rt=null,yt=Pe.xml_chave||null;try{const Ge=await i2({baseUrl:rt,cnpj:Le,dados:Tt});Ot=Ge?.url_pdf||Ge?.pdf_url||null,Rt=Ge?.url_xml||Ge?.xml_url||null,yt=Ge?.chave||Ge?.Chave||yt}catch{}if(!Ot)try{const Ge=await l2({baseUrl:rt,cnpj:Le,dados:Tt});Ot=Ge?.url_pdf||Ge?.pdf_url||null,yt=Ge?.chave||Ge?.Chave||yt}catch{}if(!Rt)try{const Ge=await c2({baseUrl:rt,cnpj:Le,dados:Tt});Rt=Ge?.url_xml||Ge?.xml_url||null,yt=yt||Ge?.chave||Ge?.Chave||yt}catch{}(Ot||Rt||yt)&&await Q.from("notas_fiscais").update({pdf_url:Ot||Pe.pdf_url,xml_url:Rt||Pe.xml_url,xml_chave:yt||Pe.xml_chave,status:Ot||Rt?"autorizada":Pe.status}).eq("id",Pe.id).eq("codigo_empresa",t),await ua(),Ot?window.open(Ot,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"})}catch(D){r({title:"Falha ao visualizar NF-e",description:D?.message||String(D),variant:"destructive"})}finally{l(!1)}})(),children:"Visualizar"}),a.jsx(Z,{size:"sm",className:"flex-1",disabled:!Sn||ee,onClick:async()=>{Ie(!0);try{await bt()}finally{Ie(!1)}},children:ee?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(cl,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Emitir NF-e"}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",className:"px-2",disabled:Ur,children:"Mais"})}),a.jsxs(Yu,{align:"end",children:[a.jsx(bs,{disabled:!wn,onClick:pt,children:"Consultar"}),a.jsx(bs,{disabled:!$n,onClick:ft,children:a.jsx("span",{className:"text-destructive",children:"Cancelar"})}),a.jsx(bs,{disabled:!0,className:"opacity-60 cursor-not-allowed",children:"Nova NF-e (em desenvolvimento)"}),a.jsx(bs,{disabled:se.length===0&&!k,onClick:()=>oe("selected"),children:"Exportar NF-e (CSV)"}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfe",scope:"selected",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfe",scope:"selected",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(bs,{disabled:(Or||[]).length===0,onClick:()=>ne({tipo:"nfe",scope:"filtered",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(bs,{disabled:(Or||[]).length===0,onClick:()=>ne({tipo:"nfe",scope:"filtered",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",disabled:!pa,onClick:()=>(async()=>{try{const D=c||[],X=k||se&&se[0],Pe=D.find(Ge=>Ge.id===X);if(!Pe){r({title:"NF-e no encontrada",variant:"warning"});return}if(Pe.pdf_url){window.open(Pe.pdf_url,"_blank");return}if(!xe){r({title:"Empresa no carregada",variant:"warning"});return}const{baseUrl:rt,cnpj:Le}=rl(xe),Tt=Pe.xml_chave?{chave:Pe.xml_chave,chave_nota:Pe.xml_chave}:{numero:Pe.numero,serie:Pe.serie};l(!0);let Ot=null,Rt=null,yt=Pe.xml_chave||null;try{const Ge=await i2({baseUrl:rt,cnpj:Le,dados:Tt});Ot=Ge?.url_pdf||Ge?.pdf_url||null,Rt=Ge?.url_xml||Ge?.xml_url||null,yt=Ge?.chave||Ge?.Chave||yt}catch{}if(!Ot)try{const Ge=await l2({baseUrl:rt,cnpj:Le,dados:Tt});Ot=Ge?.url_pdf||Ge?.pdf_url||null,yt=Ge?.chave||Ge?.Chave||yt}catch{}if(!Rt)try{const Ge=await c2({baseUrl:rt,cnpj:Le,dados:Tt});Rt=Ge?.url_xml||Ge?.xml_url||null,yt=yt||Ge?.chave||Ge?.Chave||yt}catch{}(Ot||Rt||yt)&&await Q.from("notas_fiscais").update({pdf_url:Ot||Pe.pdf_url,xml_url:Rt||Pe.xml_url,xml_chave:yt||Pe.xml_chave,status:Ot||Rt?"autorizada":Pe.status}).eq("id",Pe.id).eq("codigo_empresa",t),await ua(),Ot?window.open(Ot,"_blank"):r({title:"Sem PDF disponvel",description:"Documento ainda no possui DANFE.",variant:"destructive"})}catch(D){r({title:"Falha ao visualizar NF-e",description:D?.message||String(D),variant:"destructive"})}finally{l(!1)}})(),children:"Visualizar"}),a.jsx(Z,{size:"sm",disabled:!Sn||ee,onClick:async()=>{Ie(!0);try{await bt()}finally{Ie(!1)}},children:ee?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(cl,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Emitir NF-e"}),a.jsx(Z,{size:"sm",variant:"outline",disabled:!wn,onClick:pt,children:"Consultar"}),a.jsx(Z,{size:"sm",variant:"destructive",disabled:!$n,onClick:ft,children:"Cancelar"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",onClick:async()=>{q(null),pe([]),await Bt()&&(ia(""),jr(!0))},children:"Nova NF-e"})}),a.jsxs(Mf,{children:[a.jsx(Rf,{asChild:!0,children:a.jsx(Z,{size:"sm",variant:"outline",disabled:Ur,children:"Aes"})}),a.jsxs(Yu,{align:"end",children:[a.jsx(bs,{disabled:se.length===0&&!k,onClick:()=>oe("selected"),children:"Exportar CSV"}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfe",scope:"selected",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (selecionados)"]}),a.jsxs(bs,{disabled:se.length===0&&!k,onClick:()=>ne({tipo:"nfe",scope:"selected",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (selecionados)"]}),a.jsxs(bs,{disabled:(Or||[]).length===0,onClick:()=>ne({tipo:"nfe",scope:"filtered",includePdf:!1}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML (filtrados)"]}),a.jsxs(bs,{disabled:(Or||[]).length===0,onClick:()=>ne({tipo:"nfe",scope:"filtered",includePdf:!0}),children:[a.jsx(ws,{className:"h-4 w-4 mr-2"})," Baixar XML + PDF (filtrados)"]})]})]})]})]}),a.jsxs("div",{className:"sm:hidden space-y-2 -mx-2",children:[(!Vn||Vn.length===0)&&a.jsx("div",{className:"px-3 py-4 text-center text-text-muted border border-border rounded-md bg-surface",children:u?"Carregando...":"Nada por aqui"}),Vn.map(D=>{const X=String(D.status||"rascunho").toLowerCase(),Pe=X==="emitida"?"autorizada":X,rt=Pe==="autorizada"?"bg-emerald-500/5 border-emerald-500/40":Pe==="cancelada"?"bg-red-500/5 border-red-500/40":Pe==="rejeitada"?"bg-orange-500/5 border-orange-500/40":Pe==="processando"||Pe==="em_andamento"?"bg-sky-500/5 border-sky-500/40":Pe==="pendente"||Pe==="rascunho"?"bg-amber-500/5 border-amber-500/40":"bg-surface border-border/70",Le=D.data_emissao||D.criado_em||D.created_at||null;return a.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs flex flex-col gap-1 border ${rt}`,onClick:()=>te(D.id,!G(D.id)),children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{onClick:Tt=>{Tt.stopPropagation(),te(D.id,!G(D.id))},className:"pt-1",children:a.jsx(Qs,{checked:G(D.id),onCheckedChange:Tt=>te(D.id,!!Tt)})}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"font-medium text-sm truncate",children:["NF-e ",D.numero??"","/",D.serie??""]}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${ya(Pe)}`,children:Pe})]}),a.jsxs("div",{className:"text-xs text-text-secondary flex items-center justify-between gap-2 mt-0.5",children:[a.jsx("span",{children:Le?hb(Le):""}),a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",ao(D.valor_total||0)]})]}),a.jsxs("div",{className:"mt-1 text-xs text-text-secondary truncate",title:D.destinatario?.nome||"",children:[a.jsx("span",{className:"text-text-muted",children:"Destinatrio: "}),a.jsx("span",{className:"text-text-primary",children:D.destinatario?.nome||""})]}),a.jsxs("div",{className:"mt-0.5 text-[11px] text-text-secondary",title:D.xml_chave||"",children:[a.jsx("span",{className:"text-text-muted block mb-0.5",children:"Chave:"}),a.jsx("span",{className:"text-text-primary text-[10px] truncate block",children:D.xml_chave||""})]})]}),X==="rascunho"&&a.jsxs("div",{className:"flex flex-col items-end gap-1 ml-1",children:[!1,a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-6 h-6 rounded hover:bg-surface-2 text-text-secondary hover:text-destructive",onClick:Tt=>{Tt.stopPropagation(),Na(D.id)},title:"Excluir rascunho",children:a.jsx(bc,{className:"w-3 h-3"})})]})]})})]}),(D.pdf_url||D.xml_url)&&a.jsx("div",{className:"mt-2 border-t border-border/60 pt-2 text-[11px]",children:a.jsxs("div",{className:"flex gap-2",children:[D.pdf_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.pdf_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Abrir DANFE"})}),D.xml_url&&a.jsx("a",{className:"inline-flex flex-1",href:D.xml_url,target:"_blank",rel:"noreferrer",children:a.jsx(Z,{size:"sm",variant:"outline",className:"w-full",children:"Baixar XML"})})]})})]},D.id)})]}),a.jsx("div",{className:"hidden sm:block bg-surface rounded border border-border overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"w-8 px-3 py-2",children:a.jsx(Qs,{checked:!1,onCheckedChange:()=>{}})}),a.jsx("th",{className:"text-left px-3 py-2",children:"Data"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Status"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Destinatrio"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Nmero/Srie"}),a.jsx("th",{className:"text-right px-3 py-2",children:"Valor"})]})}),a.jsxs("tbody",{children:[(!Vn||Vn.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-text-muted",children:u?"Carregando...":"Nada por aqui"})}),Vn.map(D=>{const X=String(D.status||"rascunho").toLowerCase(),Pe=ya(X==="emitida"?"autorizada":X),rt=D.data_emissao||D.criado_em||D.created_at||null;return a.jsx(Ce.Fragment,{children:a.jsxs("tr",{className:`border-t border-border/60 transition-colors ${k===D.id?"bg-surface-2 ring-2 ring-[#FF7A1A]/60 rounded-md":"hover:bg-surface-2/50"}`,onClick:()=>{q(D.id),pe(Le=>!Le||Le.length===0?[D.id]:(Le.length===1&&Le[0]===D.id,Le))},children:[a.jsx("td",{className:"px-3 py-2",onClick:Le=>Le.stopPropagation(),children:a.jsx(Qs,{checked:G(D.id),onCheckedChange:Le=>te(D.id,!!Le)})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:rt?hb(rt):""}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${Pe}`,children:X}),(()=>{const Le=String(D.ambiente||rl(xe||{}).ambiente||"homologacao"),Tt=Le==="producao"?"bg-emerald-500/15 text-emerald-600 border border-emerald-600/30":"bg-amber-500/15 text-amber-700 border border-amber-600/30",Ot=Le==="producao"?"Produo":"Homologao";return a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] ${Tt}`,children:Ot})})(),X==="rascunho"&&a.jsxs(a.Fragment,{children:[!1,a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-5 h-5 rounded hover:bg-surface-2 text-text-secondary hover:text-destructive",onClick:Le=>{Le.stopPropagation(),Na(D.id)},title:"Excluir rascunho",children:a.jsx(bc,{className:"w-3 h-3"})})]})]})}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap max-w-[240px] truncate",title:D.destinatario?.nome||"",children:D.destinatario?.nome||""}),a.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[D.numero??"","/",D.serie??"",D.xml_chave&&a.jsxs("div",{className:"text-[10px] text-text-secondary truncate max-w-[220px] flex items-center gap-1",children:[a.jsx("span",{className:"truncate",children:`${String(D.xml_chave).slice(0,8)}...${String(D.xml_chave).slice(-4)}`}),a.jsx("button",{type:"button",className:"p-0.5 hover:text-text-primary",onClick:Le=>{Le.stopPropagation(),navigator.clipboard.writeText(D.xml_chave||""),r({title:"Chave copiada"})},title:"Copiar chave",children:a.jsx(Q4,{className:"w-3 h-3"})})]})]}),a.jsxs("td",{className:"px-3 py-2 text-right whitespace-nowrap",children:["R$ ",ao(D.valor_total||0)]})]})},D.id)})]})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[a.jsxs("div",{className:"sm:hidden text-[11px] text-text-secondary",children:["Pg. ",H," de ",On]}),a.jsxs("div",{className:"hidden sm:block text-xs text-text-secondary",children:["Pgina ",H," de ",On,"  ",(Or||[]).length," registros"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsx("label",{className:"text-xs text-text-secondary",children:"Itens por pgina"}),a.jsxs("select",{className:"h-7 rounded-md bg-surface border border-border text-xs px-2",value:Y,onChange:D=>{ie(1),W(Number(D.target.value)||50)},children:[a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:50,children:"50"}),a.jsx("option",{value:100,children:"100"})]})]}),a.jsx(Z,{size:"sm",variant:"outline",disabled:H<=1,onClick:()=>ie(D=>Math.max(1,D-1)),children:"Anterior"}),a.jsx(Z,{size:"sm",variant:"outline",disabled:H>=On,onClick:()=>ie(D=>Math.min(On,D+1)),children:"Prxima"})]})]})]}),a.jsx(yo,{value:"compras",children:a.jsx(hoe,{})})]}),a.jsx(Un,{open:vt,onOpenChange:Ht,children:a.jsxs(zn,{className:"sm:max-w-[520px]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Confirmar emisso de NFC-e"}),a.jsx(ma,{children:"As seguintes comandas sero enviadas para emisso agora. Revise rapidamente antes de confirmar."})]}),a.jsxs("div",{className:"max-h-[320px] overflow-y-auto mt-2 border border-border/60 rounded-md divide-y divide-border/40 text-xs",children:[qr.map(D=>{const X=s.find(rt=>rt.id===D)||{},Pe=X.mesaNumero?`Mesa ${X.mesaNumero}`:"Balco";return a.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-2 bg-surface/40",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx("div",{className:"font-medium text-text-primary",children:Pe}),a.jsx("div",{className:"text-text-secondary truncate max-w-[260px]",children:X.clientesStr||"Cliente Consumidor"})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-[11px] text-text-secondary",children:"Total"}),a.jsxs("div",{className:"text-sm font-semibold text-text-primary",children:["R$ ",ao(X.total||X.total_com_desconto)]})]})]},D)}),!qr.length&&a.jsx("div",{className:"px-3 py-2 text-text-secondary",children:"Nenhuma NFC-e elegvel selecionada."})]}),a.jsxs("div",{className:"flex justify-between items-center mt-3 text-[11px] text-text-secondary",children:[a.jsxs("span",{children:[qr.length," NFC-e sero emitidas agora."]}),se.length>qr.length&&a.jsxs("span",{children:[se.length-qr.length," seleo(es) sero ignoradas por no estarem pendentes/rejeitadas."]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",size:"sm",disabled:Oe,onClick:()=>Ht(!1),children:"Cancelar"}),a.jsx(Z,{size:"sm",className:"bg-[#FF7A1A] hover:bg-[#ff8f3b] text-black",disabled:Oe,onClick:async()=>{Yt(!0);try{await rs(),Ht(!1)}finally{Yt(!1)}},children:Oe?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(cl,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Confirmar emisso"})]})]})}),a.jsx(Un,{open:Xr,onOpenChange:Ft,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Novo CFOP"}),a.jsx(ma,{children:"Cadastrar um cdigo CFOP para esta empresa."})]}),a.jsxs("div",{className:"space-y-3 mt-2",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"Cdigo CFOP"}),a.jsx(It,{value:kr.codigo,onChange:D=>jt(X=>({...X,codigo:D.target.value})),placeholder:"Ex.: 5102"})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Descrio"}),a.jsx(It,{value:kr.descricao,onChange:D=>jt(X=>({...X,descricao:D.target.value})),placeholder:"Ex.: Venda de mercadoria adquirida de terceiros"})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>Ft(!1),children:"Cancelar"}),a.jsx(Z,{onClick:async()=>{const D=(kr.codigo||"").trim(),X=(kr.descricao||"").trim();if(!D||!X){r({title:"Informe cdigo e descrio do CFOP",variant:"warning"});return}if(!t){r({title:"Empresa no encontrada para salvar CFOP",variant:"destructive"});return}try{const{data:Pe,error:rt}=await Q.from("cfops").insert({codigo_empresa:t,codigo:D,descricao:X,tipo_nota:Te.tipo_nota||"saida"}).select().single();if(rt)throw rt;ht(Le=>[...Le,Pe]),Fe(Le=>({...Le,cfop_padrao:D,natOp:X||Le.natOp||""})),Ft(!1)}catch(Pe){r({title:"Falha ao salvar CFOP",description:Pe.message,variant:"destructive"})}},children:"Salvar"})]})]})}),a.jsx(Un,{open:Wn,onOpenChange:ln,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-[760px] max-h-[80vh] flex flex-col",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Selecionar Comanda"}),a.jsx(ma,{children:"Escolha a comanda de origem para criar o rascunho de NF-e."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto mt-2 space-y-2",children:(()=>{const D=(oa||"").trim().toLowerCase(),Pe=(Array.isArray(vn)?vn:[]).filter(Le=>D?`${Le.mesaNumero?`mesa ${Le.mesaNumero}`:"balcao"} ${Le.clientesStr||""}`.toLowerCase().includes(D):!0),rt=new Set((c||[]).filter(Le=>Le.origem==="comanda"&&Le.comanda_id).map(Le=>Le.comanda_id));return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[a.jsx("div",{className:"flex-1 min-w-[180px] flex items-center gap-2",children:a.jsx(It,{className:"h-8 text-xs",placeholder:"Filtrar por cliente ou mesa",value:oa,onChange:Le=>Tn(Le.target.value)})}),a.jsxs("div",{className:"text-xs text-text-secondary whitespace-nowrap",children:[Pe.length," comandas filtradas"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[Pe.slice(0,100).map(Le=>{const Tt=rt.has(Le.id);return a.jsxs("label",{className:"grid grid-cols-12 items-center px-3 py-2 hover:bg-surface-2 cursor-pointer gap-2",children:[a.jsx("div",{className:"col-span-1 flex items-center justify-center",children:a.jsx(Qs,{checked:da===Le.id,onCheckedChange:Ot=>{va(Rt=>Ot?Le.id:Rt===Le.id?null:Rt)}})}),a.jsx("div",{className:"col-span-3 text-sm",children:hb(Le.aberto_em)}),a.jsx("div",{className:"col-span-4 text-sm truncate",title:Le.clientesStr||"",children:Le.clientesStr||""}),a.jsxs("div",{className:"col-span-2 flex flex-col text-xs text-text-secondary",children:[a.jsx("span",{children:Le.mesaNumero?`Mesa ${Le.mesaNumero}`:"Balco"}),Tt&&a.jsx("span",{className:"text-[10px] text-amber-500",children:"J possui NF-e vinculada"})]}),a.jsxs("div",{className:"col-span-2 text-right text-sm",children:["R$ ",ao(Le.total||Le.total_com_desconto)]})]},Le.id)}),Pe.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhuma comanda encontrada"})]})]})})()}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3 pt-2 border-t border-border/60",children:[a.jsx(Z,{variant:"outline",onClick:()=>ln(!1),children:"Cancelar"}),a.jsx(Z,{onClick:async()=>{if(!da){r({title:"Selecione uma comanda",variant:"warning"});return}await Dt(da)&&(ia(""),await yr(da),ln(!1))},children:"Continuar"})]})]})}),a.jsx(Un,{open:!!Hn,onOpenChange:D=>{D||(as(null),As(""))},children:a.jsxs(zn,{className:"max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Cancelar NF-e"}),a.jsx(ma,{children:"Informe o motivo do cancelamento. Essa ao ser enviada para a API fiscal e a nota ser marcada como cancelada."})]}),a.jsxs("div",{className:"space-y-2 mt-2",children:[a.jsx(ct,{htmlFor:"motivo-cancel-nfe",children:"Motivo do cancelamento"}),a.jsx(It,{id:"motivo-cancel-nfe",value:to,onChange:D=>As(D.target.value),placeholder:"Ex.: Nota emitida em duplicidade"})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>{as(null),As("")},children:"Cancelar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!Hn){as(null);return}await ut(Hn)},children:"Confirmar cancelamento"})]})]})}),a.jsx(Un,{open:!!Zc,onOpenChange:D=>{D||(Ji(null),R(""))},children:a.jsxs(zn,{className:"max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Cancelar NFC-e"}),a.jsx(ma,{children:"Informe o motivo do cancelamento."})]}),a.jsxs("div",{className:"space-y-2 mt-2",children:[a.jsx(ct,{htmlFor:"motivo-nfce",children:"Motivo"}),a.jsx(It,{id:"motivo-nfce",value:Ol,onChange:D=>R(D.target.value),placeholder:"Ex.: Cliente desistiu da compra"})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(Z,{variant:"outline",onClick:()=>{Ji(null),R("")},children:"Voltar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!Zc){Ji(null);return}const D=(Ol||"").trim();if(!D){r({title:"Informe o motivo do cancelamento",variant:"warning"});return}await xl(Zc,D),Ji(null),R("")},children:"Confirmar cancelamento"})]})]})}),a.jsx(Un,{open:Vt,onOpenChange:qt,children:a.jsxs(zn,{className:"max-w-[880px]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Pr-Emisso NFC-e"}),a.jsx(ma,{children:"Revise os dados e pendncias antes de emitir."})]}),Re?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Gerando prvia"}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Pendncias"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>or(D=>!D),children:gt?"Ocultar JSON":"Ver JSON"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>n("/configuracao-fiscal"),children:"Corrigir Empresa"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>ai(!0),children:"Selecionar Cliente"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>{k&&Wa(k)},children:"Recarregar Prvia"})]})]}),!Me||Me.length===0?a.jsx("div",{className:"text-sm text-emerald-500",children:"Nenhuma pendncia encontrada."}):a.jsx("ul",{className:"list-disc pl-5 text-sm",children:Me.map((D,X)=>a.jsx("li",{children:D},X))})]}),gt&&a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"JSON (EnviarNfce)"}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto",children:Wt?JSON.stringify(Wt,null,2):""})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>qt(!1),children:"Fechar"}),a.jsx(Z,{disabled:!0,children:"Emitir (desabilitado)"})]})]})}),a.jsx(Un,{open:Vs,onOpenChange:ai,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Selecionar destinatrio"}),a.jsx(ma,{children:"Busque pelo cdigo, nome ou documento e escolha a parte."})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[a.jsx("div",{className:"flex-1 min-w-[200px]",children:a.jsx(It,{placeholder:"Buscar por cdigo, nome ou documento",value:Ni,onChange:D=>Si(D.target.value)})}),a.jsxs("span",{className:"text-xs text-text-secondary",children:[fr.length," itens"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[fr.map(D=>a.jsxs("div",{className:"grid grid-cols-12 items-center px-3 py-2 hover:bg-surface-2 cursor-pointer",onClick:()=>Yr(D),children:[a.jsx("div",{className:"col-span-2 text-xs font-medium",children:String(D.codigo||D.codigo_cliente||D.codigo_fornecedor||D.code||"")}),a.jsx("div",{className:"col-span-6 text-sm truncate",title:D.nome||D.razao_social||"",children:D.nome||D.razao_social||"Sem nome"}),a.jsxs("div",{className:"col-span-4 text-xs text-text-secondary text-right",children:[(D.cnpj||D.cpf||"").toString()," ",D.cidade?` ${D.cidade}/${D.uf||""}`:""]})]},D.id)),fr.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhum registro encontrado"})]}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsx(Z,{variant:"outline",onClick:()=>ai(!1),children:"Fechar"})})]})}),a.jsx(Un,{open:Nr,onOpenChange:xn,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Selecionar produto"}),a.jsx(ma,{children:"Busque pelo nome ou cdigo para preencher o item."})]}),a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(It,{placeholder:"Buscar produto por nome ou cdigo",value:pr,onChange:D=>en(D.target.value)}),a.jsxs("span",{className:"text-xs text-text-secondary",children:[_n.length," itens"]})]}),a.jsxs("div",{className:"border border-border rounded-md divide-y divide-border",children:[_n.map(D=>a.jsx("div",{className:"flex items-center justify-between px-3 py-2 hover:bg-surface-2 cursor-pointer",onClick:()=>{Dn!=null&&Fn(Dn,D),xn(!1)},children:a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"text-sm",children:[D.code&&a.jsxs("span",{className:"text-text-secondary mr-1",children:["[",D.code,"]"]}),a.jsx("span",{children:D.name})]}),a.jsxs("div",{className:"text-[11px] text-text-secondary",children:["R$ ",ao(D.price??D.salePrice??0)]})]})},D.id)),_n.length===0&&a.jsx("div",{className:"text-xs text-text-secondary px-3 py-2",children:"Nenhum produto encontrado"})]}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsx(Z,{variant:"outline",onClick:()=>xn(!1),children:"Fechar"})})]})}),a.jsx(Un,{open:!!Aa,onOpenChange:D=>{D||Na(null)},children:a.jsxs(zn,{className:"max-w-sm",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Remover rascunho"}),a.jsx(ma,{children:"Essa ao remove definitivamente o rascunho de NF-e selecionado. Os dados no podero ser recuperados."})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>Na(null),children:"Cancelar"}),a.jsx(Z,{variant:"destructive",onClick:async()=>{if(!Aa||!t){Na(null);return}try{await Q.from("notas_fiscais").delete().eq("id",Aa).eq("codigo_empresa",t),await ua(),r({title:"Rascunho removido"})}catch(D){r({title:"Falha ao remover rascunho",description:D.message,variant:"destructive"})}finally{Na(null)}},children:"Remover rascunho"})]})]})}),a.jsx(Un,{open:Kr,onOpenChange:jr,children:a.jsxs(zn,{className:"w-[960px] max-w-[96vw] h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Criar NF-e (manual)"}),a.jsx(ma,{children:"Vamos montar do zero."})]}),a.jsxs(_d,{value:fn,onValueChange:J,className:"flex-1 overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[a.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[a.jsx("div",{className:"w-full sm:hidden",children:a.jsxs(Zn,{value:fn,onValueChange:J,children:[a.jsx(Yn,{className:"h-9 text-xs",children:a.jsx(ta,{placeholder:"Selecionar etapa"})}),a.jsxs(Jn,{className:"text-xs",children:[a.jsx(nt,{value:"ident",children:"Identificao"}),a.jsx(nt,{value:"produtos",children:"Produtos"}),a.jsx(nt,{value:"pagamentos",children:"Pagamentos"}),a.jsx(nt,{value:"totais",children:"Totais & Impostos"}),a.jsx(nt,{value:"transporte",children:"Transporte"}),a.jsx(nt,{value:"resumo",children:"Resumo & Emisso"})]})]})}),a.jsxs(xc,{className:"hidden sm:inline-flex",children:[a.jsx(Ya,{value:"ident",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Pt.identOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Identificao"})]})}),a.jsx(Ya,{value:"produtos",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Pt.produtosOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Produtos"})]})}),a.jsx(Ya,{value:"pagamentos",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Pt.pagamentosOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Pagamentos"})]})}),a.jsx(Ya,{value:"totais",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Pt.totaisOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Totais & Impostos"})]})}),a.jsx(Ya,{value:"transporte",children:a.jsxs("span",{className:"flex items-center gap-1",children:[!Pt.transpOk&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),a.jsx("span",{children:"Transporte"})]})}),a.jsx(Ya,{value:"resumo",children:"Resumo & Emisso"})]})]}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>{va(null),ln(!0)},children:"Selecionar comanda"})]}),a.jsx(yo,{value:"ident",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Identificao da Nota"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 items-end",children:[a.jsxs("div",{className:"md:col-span-1 max-w-[210px]",children:[a.jsx(ct,{className:es(Te.modelo)?"text-red-400":"",children:"Tipo de Documento"}),a.jsxs(Zn,{value:Te.modelo,onValueChange:D=>Fe(X=>({...X,modelo:D})),children:[a.jsx(Yn,{className:`h-8 text-xs ${es(Te.modelo)?"border-red-500 text-red-400":""}`,children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"55",children:"55 - NF-e"}),a.jsx(nt,{value:"65",children:"65 - NFC-e"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[190px]",children:[a.jsx(ct,{className:es(Te.tipo_nota)?"text-red-400":"",children:"Tipo de Operao"}),a.jsxs(Zn,{value:Te.tipo_nota,onValueChange:D=>Fe(X=>({...X,tipo_nota:D})),children:[a.jsx(Yn,{className:`h-8 text-xs ${es(Te.tipo_nota)?"border-red-500 text-red-400":""}`,children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"saida",children:"Sada"}),a.jsx(nt,{value:"entrada",children:"Entrada"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[210px]",children:[a.jsx(ct,{className:es(Te.finNFe)?"text-red-400":"",children:"Finalidade"}),a.jsxs(Zn,{value:Te.finNFe,onValueChange:D=>Fe(X=>({...X,finNFe:D})),children:[a.jsx(Yn,{className:`h-8 text-xs ${es(Te.finNFe)?"border-red-500 text-red-400":""}`,children:a.jsx(ta,{placeholder:"Normal"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"1",children:"1 - Normal"}),a.jsx(nt,{value:"2",children:"2 - Complementar"}),a.jsx(nt,{value:"3",children:"3 - Ajuste"}),a.jsx(nt,{value:"4",children:"4 - Devoluo"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 col-span-2 hidden sm:block",children:[a.jsx(ct,{className:es(Te.natOp)?"text-red-400":"",children:"Natureza da Operao"}),a.jsx(It,{className:`h-8 text-xs ${es(Te.natOp)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:Te.natOp,onChange:D=>{const X=D.target.value;Fe(Pe=>({...Pe,natOp:X}))},placeholder:"Ex.: Venda de mercadoria"})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(ct,{className:Te.cfop_padrao?"":"text-red-400",children:"CFOP"}),a.jsxs(Zn,{value:Te.cfop_padrao||"",onValueChange:D=>{if(D==="__novo_cfop__"){jt({codigo:"",descricao:""}),Ft(!0);return}Fe(X=>{const rt=(cr||[]).find(Le=>String(Le.codigo)===String(D))?.descricao||"";return{...X,cfop_padrao:D,natOp:rt||X.natOp||""}})},children:[a.jsx(Yn,{className:`h-8 text-xs ${Te.cfop_padrao?"":"border-red-500 text-red-400"}`,children:a.jsx("span",{className:"truncate",children:Te.cfop_padrao||"Selecione"})}),a.jsxs(Jn,{className:"max-h-72",children:[(cr||[]).map(D=>a.jsxs(nt,{value:D.codigo,children:[D.codigo," - ",D.descricao]},D.id||D.codigo)),a.jsx(nt,{value:"__novo_cfop__",children:"+ Cadastrar novo CFOP"})]})]})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(ct,{className:es(Te.data_emissao)?"text-red-400":"",children:"Data de Emisso"}),a.jsx(MV,{label:"Selecione",value:Te.data_emissao,onChange:D=>Fe(X=>({...X,data_emissao:D}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[200px]",children:[a.jsx(ct,{children:"Data Sada/Entrada"}),a.jsx(MV,{label:"Selecione",value:Te.data_saida,onChange:D=>Fe(X=>({...X,data_saida:D}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[120px]",children:[a.jsx(ct,{className:es(Te.serie)?"text-red-400":"",children:"Srie"}),a.jsx(It,{className:`h-8 text-xs ${es(Te.serie)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:Te.serie,onChange:D=>Fe(X=>({...X,serie:D.target.value}))})]}),a.jsxs("div",{className:"md:col-span-1 max-w-[140px]",children:[a.jsx(ct,{children:"Nmero"}),a.jsx(It,{className:"h-8 text-xs",value:Te.nNF,onChange:D=>Fe(X=>({...X,nNF:D.target.value})),placeholder:"automtico"})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(ct,{className:es(Te.idDest)?"text-red-400":"",children:"Destino da Operao"}),a.jsxs(Zn,{value:Te.idDest||"auto",onValueChange:D=>Fe(X=>({...X,idDest:D==="auto"?"":D})),children:[a.jsx(Yn,{className:`h-8 text-xs ${es(Te.idDest)?"border-red-500 text-red-400":""}`,children:a.jsx(ta,{placeholder:"Automtico"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"auto",children:"Automtico"}),a.jsx(nt,{value:"1",children:"1 - Interna (mesmo estado)"}),a.jsx(nt,{value:"2",children:"2 - Interestadual"}),a.jsx(nt,{value:"3",children:"3 - Exterior"})]})]})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(ct,{className:es(Te.indFinal)?"text-red-400":"",children:"Consumidor Final"}),a.jsxs(Zn,{value:Te.indFinal??"",onValueChange:D=>Fe(X=>({...X,indFinal:D})),children:[a.jsx(Yn,{className:`h-8 text-xs ${es(Te.indFinal)?"border-red-500 text-red-400":""}`,children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"1",children:"Sim"}),a.jsx(nt,{value:"0",children:"No"})]})]})]}),a.jsxs("div",{className:"md:col-span-1",children:[a.jsx(ct,{className:es(Te.indPres)?"text-red-400":"",children:"Presena do Comprador"}),a.jsxs(Zn,{value:Te.indPres??"",onValueChange:D=>Fe(X=>({...X,indPres:D})),children:[a.jsx(Yn,{className:`h-8 text-xs ${es(Te.indPres)?"border-red-500 text-red-400":""}`,children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"1",children:"1 - Operao presencial"}),a.jsx(nt,{value:"2",children:"2 - No presencial, internet"}),a.jsx(nt,{value:"4",children:"4 - Entrega em domiclio"}),a.jsx(nt,{value:"9",children:"9 - No se aplica"})]})]})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Emitente (Empresa)"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"CNPJ"}),a.jsx("div",{className:"text-text-primary",children:xe?.cnpj||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"Inscrio Estadual"}),a.jsx("div",{className:"text-text-primary",children:xe?.inscricao_estadual||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary",children:"Regime Tributrio"}),a.jsx("div",{className:"text-text-primary",children:xe?.regime_tributario||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Razo Social"}),a.jsx("div",{className:"text-text-primary",children:xe?.razao_social||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Nome Fantasia"}),a.jsx("div",{className:"text-text-primary",children:xe?.nome_fantasia||""})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx("div",{className:"text-text-secondary",children:"Endereo"}),a.jsx("div",{className:"text-text-primary",children:xe?`${xe.logradouro||xe.endereco||""} ${xe.numero||""} ${xe.bairro||""} - ${xe.cidade||""}/${xe.uf||""}  CEP ${xe.cep||""}`.trim():""})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Destinatrio"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx(It,{className:"h-8 text-xs w-full",placeholder:"Nome, cdigo, CPF ou CNPJ",value:Ni,onChange:D=>Si(D.target.value)})}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-8 w-8 flex-shrink-0",onClick:()=>ai(!0),children:a.jsx(Yo,{className:"w-4 h-4"})})]})]}),(Ni||"").trim().length>0&&fr.length>0&&a.jsx("div",{className:"border border-border rounded-md mb-3 max-h-40 overflow-y-auto text-xs",children:fr.slice(0,8).map(D=>a.jsxs("div",{className:"flex items-center justify-between px-2 py-1 hover:bg-surface-2 cursor-pointer",onClick:()=>Yr(D),children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium truncate max-w-[220px]",children:D.nome||D.razao_social||"Sem nome"}),a.jsx("span",{className:"text-text-secondary truncate max-w-[220px]",children:(D.cnpj||D.cpf||"").toString()})]}),a.jsx("span",{className:"text-[10px] text-text-secondary ml-2",children:D.is_fornecedor?"Fornecedor":"Cliente"})]},D.id))}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"Tipo de Pessoa"}),a.jsxs(Zn,{value:Te.tipo_pessoa,onValueChange:D=>Fe(X=>({...X,tipo_pessoa:D})),children:[a.jsx(Yn,{children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"PF",children:"Pessoa Fsica"}),a.jsx(nt,{value:"PJ",children:"Pessoa Jurdica"})]})]})]}),a.jsxs("div",{className:"col-span-2 md:col-span-1",children:[a.jsx(ct,{className:es(Te.cpf_cnpj)?"text-red-400":"",children:Te.tipo_pessoa==="PF"?"CPF":"CNPJ"}),a.jsx(It,{className:es(Te.cpf_cnpj)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.cpf_cnpj,onChange:D=>Fe(X=>({...X,cpf_cnpj:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.nome)?"text-red-400":"",children:"Nome/Razo Social"}),a.jsx(It,{className:es(Te.nome)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.nome,onChange:D=>Fe(X=>({...X,nome:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.indIEDest)?"text-red-400":"",children:"Indicador de IE"}),a.jsxs(Zn,{value:Te.indIEDest||"9",onValueChange:D=>Fe(X=>({...X,indIEDest:D,ie_isento:D==="2",inscricao_estadual:D==="2"?"ISENTO":X.inscricao_estadual})),children:[a.jsx(Yn,{className:es(Te.indIEDest)?"border-red-500 text-red-400":"",children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"1",children:"Contribuinte"}),a.jsx(nt,{value:"2",children:"Isento"}),a.jsx(nt,{value:"9",children:"No Contribuinte"})]})]})]}),a.jsxs("div",{className:"col-span-2 md:col-span-1",children:[a.jsx(ct,{children:"Inscrio Estadual"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(It,{value:Te.ie_isento?"ISENTO":Te.inscricao_estadual||"",onChange:D=>Fe(X=>({...X,inscricao_estadual:D.target.value,ie_isento:String(D.target.value||"").toUpperCase()==="ISENTO"}))}),a.jsx(Z,{type:"button",size:"sm",variant:Te.ie_isento?"default":"outline",onClick:()=>Fe(D=>({...D,ie_isento:!0,inscricao_estadual:"ISENTO",indIEDest:"2"})),children:"ISENTO"})]})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.cep)?"text-red-400":"",children:"CEP"}),a.jsx(It,{className:es(Te.cep)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.cep,onChange:D=>Fe(X=>({...X,cep:D.target.value})),onBlur:()=>$r(Te.cep)})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(ct,{className:es(Te.logradouro)?"text-red-400":"",children:"Logradouro"}),a.jsx(It,{className:es(Te.logradouro)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.logradouro,onChange:D=>Fe(X=>({...X,logradouro:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.numero)?"text-red-400":"",children:"Nmero"}),a.jsx(It,{className:es(Te.numero)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.numero,onChange:D=>Fe(X=>({...X,numero:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.bairro)?"text-red-400":"",children:"Bairro"}),a.jsx(It,{className:es(Te.bairro)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.bairro,onChange:D=>Fe(X=>({...X,bairro:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.cidade)?"text-red-400":"",children:"Cidade"}),a.jsx(It,{className:es(Te.cidade)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.cidade,onChange:D=>Fe(X=>({...X,cidade:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.uf)?"text-red-400":"",children:"UF"}),a.jsx(It,{className:es(Te.uf)?"border-red-500 text-red-400 placeholder:text-red-400":"",value:Te.uf,onChange:D=>Fe(X=>({...X,uf:(D.target.value||"").toUpperCase().slice(0,2)}))})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.codigo_municipio_ibge)?"text-red-400":"",children:"Cdigo IBGE"}),a.jsx(It,{className:`h-8 text-xs ${es(Te.codigo_municipio_ibge)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:Te.codigo_municipio_ibge,onChange:D=>Fe(X=>({...X,codigo_municipio_ibge:D.target.value})),placeholder:"Ex.: 3550308"})]})]})]})]})}),a.jsx(yo,{value:"produtos",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Z,{size:"sm",onClick:()=>{Fe(D=>{const X={descricao:"",codigo:"",cod_barras:"",ncm:"",cest:"",cfop:D.cfop_padrao||"5102",unidade:"UN",quantidade:"1",preco_unitario:"0,00",desconto_valor:"0,00",desconto_percent:"",acrescimos_valor:"0,00",frete_valor:"0,00",seguro_valor:"0,00",obs:"",impostos:{origem:"",icms:{cst:"",csosn:"",base:"",aliquota:"",valor:""},pis:{cst:"",aliquota:"",valor:""},cofins:{cst:"",aliquota:"",valor:""},ipi:{cst:"",aliquota:"",valor:"",tipo_calculo:"nenhum",valor_unit:""}}};return{...D,itens:[...D.itens,X]}})},children:"Adicionar item"})}),a.jsx("div",{className:"border border-border rounded-md overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 py-2",children:"Produto"}),a.jsx("th",{className:"text-center px-2 py-2 w-[80px]",children:"Qtd"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"V. Unit"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"Desconto"}),a.jsx("th",{className:"text-center px-2 py-2 w-[110px]",children:"Total"}),a.jsx("th",{className:"text-center px-2 py-2 w-[180px]",children:"Aes"})]})}),a.jsxs("tbody",{children:[Te.itens.map((D,X)=>{const Pe=Ee(D.preco_unitario)||0,rt=Ee(D.quantidade)||1,Le=Pe*rt,Tt=Ee(D.desconto_percent)||0,Ot=Ee(D.desconto_valor)||0,Rt=Tt?Le*Tt/100:Ot,yt=Math.max(0,Le-Rt+(Ee(D.acrescimos_valor)||0));return a.jsxs(Ce.Fragment,{children:[a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsxs("td",{className:"px-2 py-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(It,{className:"h-7 text-xs flex-1",value:D.descricao,onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens];return Kt[X]={...Kt[X],descricao:Ge.target.value},{...Jt,itens:Kt}}),placeholder:"Descrio"}),a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7 flex-shrink-0",title:"Buscar produto",onClick:()=>{Pa(X),xn(!0)},children:a.jsx(Yo,{className:"w-3.5 h-3.5"})})]}),a.jsxs("div",{className:"text-[10px] text-text-secondary",children:[D.codigo||"","  UN ",String(D.unidade||"UN")]})]}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[80px] mx-auto",children:a.jsx(It,{className:"h-7 text-right text-xs",value:D.quantidade,onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens];return Kt[X]={...Kt[X],quantidade:Ge.target.value},{...Jt,itens:Kt}})})})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[110px] mx-auto",children:a.jsx(It,{className:"h-7 text-right text-xs",value:D.preco_unitario,onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr=gr(Ge.target.value||"");return Kt[X]={...Kt[X],preco_unitario:Hr},{...Jt,itens:Kt}}),onKeyDown:Ge=>{Ge.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ge.key)&&(/^[0-9]$/.test(Ge.key)||Ge.preventDefault())},onBeforeInput:Ge=>{const Jt=Ge.data??"";Jt&&/\D/.test(Jt)&&Ge.preventDefault()}})})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx("div",{className:"w-[110px] mx-auto",children:a.jsx(It,{className:"h-7 text-right text-xs",value:D.desconto_valor,onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr=gr(Ge.target.value||"");return Kt[X]={...Kt[X],desconto_valor:Hr,desconto_percent:""},{...Jt,itens:Kt}}),onKeyDown:Ge=>{Ge.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(Ge.key)&&(/^[0-9]$/.test(Ge.key)||Ge.preventDefault())},onBeforeInput:Ge=>{const Jt=Ge.data??"";Jt&&/\D/.test(Jt)&&Ge.preventDefault()}})})}),a.jsxs("td",{className:"px-2 py-1 text-right",children:["R$ ",ao(yt)]}),a.jsx("td",{className:"px-2 py-1 text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(()=>{const Ge=D.impostos||{},Jt=Ge.icms||{},Kt=Ge.pis||{},Hr=Ge.cofins||{};return Ge.origem&&(Jt.cst||Jt.csosn)&&Kt.aliquota!==void 0&&String(Kt.aliquota).trim()!==""&&Hr.aliquota!==void 0&&String(Hr.aliquota).trim()!==""?null:a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"})})(),a.jsx(Z,{size:"sm",variant:"outline",className:"h-7",onClick:()=>Ac(Uo===X?null:X),children:Uo===X?"Ocultar":"Detalhes"}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-7",onClick:()=>{Fe(Ge=>{const Jt=[...Ge.itens];return Jt.splice(X,1),{...Ge,itens:Jt}})},children:"Remover"})]})})]}),Uo===X&&a.jsx("tr",{className:"border-t border-border/60 bg-surface-2/40",children:a.jsx("td",{colSpan:6,className:"px-2 py-2",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"NCM"}),a.jsx(It,{className:"h-7 text-xs",value:D.ncm||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens];return Kt[X]={...Kt[X],ncm:Ge.target.value},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"CFOP"}),a.jsx(It,{className:"h-7 text-xs",value:D.cfop||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens];return Kt[X]={...Kt[X],cfop:Ge.target.value},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(D.impostos?.icms?.cst)&&es(D.impostos?.icms?.csosn)?"text-red-400":"",children:"CST/CSOSN"}),a.jsx(It,{className:`h-7 text-xs ${es(D.impostos?.icms?.cst)&&es(D.impostos?.icms?.csosn)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.icms?.cst||D.impostos?.icms?.csosn||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr={...Kt[X].impostos||{},icms:{...Kt[X].impostos?.icms||{},cst:Ge.target.value,csosn:Ge.target.value}};return Kt[X]={...Kt[X],impostos:Hr},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(D.impostos?.origem)?"text-red-400":"",children:"Origem"}),a.jsx(It,{className:`h-7 text-xs ${es(D.impostos?.origem)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.origem||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr={...Kt[X].impostos||{},origem:Ge.target.value};return Kt[X]={...Kt[X],impostos:Hr},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"ICMS %"}),a.jsx(It,{className:"h-7 text-xs",value:D.impostos?.icms?.aliquota||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr={...Kt[X].impostos?.icms||{},aliquota:Ge.target.value};return Kt[X]={...Kt[X],impostos:{...Kt[X].impostos||{},icms:Hr}},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"ICMS Base"}),a.jsx(It,{className:"h-7 text-xs",value:D.impostos?.icms?.base||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr={...Kt[X].impostos?.icms||{},base:Ge.target.value};return Kt[X]={...Kt[X],impostos:{...Kt[X].impostos||{},icms:Hr}},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(D.impostos?.pis?.aliquota)?"text-red-400":"",children:"PIS %"}),a.jsx(It,{className:`h-7 text-xs ${es(D.impostos?.pis?.aliquota)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.pis?.aliquota||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr={...Kt[X].impostos?.pis||{},aliquota:Ge.target.value};return Kt[X]={...Kt[X],impostos:{...Kt[X].impostos||{},pis:Hr}},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{className:es(D.impostos?.cofins?.aliquota)?"text-red-400":"",children:"COFINS %"}),a.jsx(It,{className:`h-7 text-xs ${es(D.impostos?.cofins?.aliquota)?"border-red-500 text-red-400 placeholder:text-red-400":""}`,value:D.impostos?.cofins?.aliquota||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr={...Kt[X].impostos?.cofins||{},aliquota:Ge.target.value};return Kt[X]={...Kt[X],impostos:{...Kt[X].impostos||{},cofins:Hr}},{...Jt,itens:Kt}})})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"IPI %"}),a.jsx(It,{className:"h-7 text-xs",value:D.impostos?.ipi?.aliquota||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens],Hr={...Kt[X].impostos?.ipi||{},aliquota:Ge.target.value};return Kt[X]={...Kt[X],impostos:{...Kt[X].impostos||{},ipi:Hr}},{...Jt,itens:Kt}})})]}),a.jsxs("div",{className:"md:col-span-4",children:[a.jsx(ct,{children:"Observao do item"}),a.jsx(It,{className:"h-7 text-xs",value:D.obs||"",onChange:Ge=>Fe(Jt=>{const Kt=[...Jt.itens];return Kt[X]={...Kt[X],obs:Ge.target.value},{...Jt,itens:Kt}})})]})]})})})]},X)}),Te.itens.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"px-2 py-3 text-center text-text-secondary",children:'Nenhum item. Use "Adicionar item" para inserir.'})})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"Desconto Geral"}),a.jsx(It,{className:"h-8 text-xs text-right",value:Te.totais.desconto_geral,onChange:D=>Fe(X=>({...X,totais:{...X.totais,desconto_geral:gr(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const X=D.data??"";X&&/\D/.test(X)&&D.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Frete"}),a.jsx(It,{className:"h-8 text-xs text-right",value:Te.totais.frete,onChange:D=>Fe(X=>({...X,totais:{...X.totais,frete:gr(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const X=D.data??"";X&&/\D/.test(X)&&D.preventDefault()}})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Outras Despesas"}),a.jsx(It,{className:"h-8 text-xs text-right",value:Te.totais.outras_despesas,onChange:D=>Fe(X=>({...X,totais:{...X.totais,outras_despesas:gr(D.target.value||"")}})),onKeyDown:D=>{D.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(D.key)&&(/^[0-9]$/.test(D.key)||D.preventDefault())},onBeforeInput:D=>{const X=D.data??"";X&&/\D/.test(X)&&D.preventDefault()}})]}),a.jsx("div",{className:"text-right self-end",children:(()=>{const D=Te.itens||[];let X=0;D.forEach(Ot=>{const Rt=Ee(Ot.preco_unitario)||0,yt=Ee(Ot.quantidade)||1,Ge=Rt*yt,Jt=Ee(Ot.desconto_percent)||0,Kt=Ee(Ot.desconto_valor)||0,Hr=Jt?Ge*Jt/100:Kt,hn=Math.max(0,Ge-Hr+(Ee(Ot.acrescimos_valor)||0));X+=hn});const Pe=Ee(Te.totais.desconto_geral)||0,rt=Ee(Te.totais.frete)||0,Le=Ee(Te.totais.outras_despesas)||0,Tt=X-Pe+rt+Le;return a.jsxs("div",{className:"text-sm",children:[a.jsx("div",{className:"text-text-secondary",children:"Total dos Produtos"}),a.jsxs("div",{className:"text-xl font-semibold",children:["R$ ",ao(X)]}),a.jsx("div",{className:"text-text-secondary mt-1",children:"Total da Nota"}),a.jsxs("div",{className:"text-xl font-semibold",children:["R$ ",ao(Tt)]})]})})()})]})]})}),a.jsx(yo,{value:"pagamentos",children:(()=>{const D=Te.itens||[];let X=0;D.forEach((Hr,hn)=>{const An=Ee(Hr.preco_unitario)||0,xr=Ee(Hr.quantidade)||1,Tr=An*xr,jn=Ee(Hr.desconto_percent)||0,fa=Ee(Hr.desconto_valor)||0,qn=jn?Tr*jn/100:fa,Fa=Ee(Hr.acrescimos_valor)||0,ps=Math.max(0,Tr-qn+Fa);X+=ps});const Pe=Ee(Te.totais.desconto_geral)||0,rt=Ee(Te.totais.frete)||0,Le=Ee(Te.totais.outras_despesas)||0,Tt=X-Pe+rt+Le,Ot=Te.pagamentos||[],Rt=Ot.reduce((Hr,hn)=>Hr+(Ee(hn.valor)||0),0),yt=(Rt||0)-(Tt||0),Ge=()=>{Fe(Hr=>{const hn=Array.isArray(Hr.pagamentos)?[...Hr.pagamentos]:[],An=Tt||0;return hn.push({finalizadora_id:"",tipo:"Dinheiro",valor:gr(An.toFixed(2)),bandeira:"",autorizacao:"",parcelas:"",troco:""}),{...Hr,pagamentos:hn}})},Jt=Hr=>{Fe(hn=>{const An=Array.isArray(hn.pagamentos)?[...hn.pagamentos]:[];return An.splice(Hr,1),{...hn,pagamentos:An}})},Kt=(Hr,hn)=>{Fe(An=>{const xr=Array.isArray(An.pagamentos)?[...An.pagamentos]:[],Tr=gr(hn||"");return xr[Hr]={...xr[Hr]||{},valor:Tr},{...An,pagamentos:xr}})};return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Formas de pagamento"}),a.jsx(Z,{size:"sm",onClick:Ge,children:"Adicionar pagamento"})]}),a.jsx("div",{className:"border border-border rounded-md overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-xs",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 py-2",children:"Forma"}),a.jsx("th",{className:"text-left px-2 py-2 w-[180px]",children:"Bandeira / Autorizao"}),a.jsx("th",{className:"text-right px-2 py-2 w-[140px]",children:"Valor"}),a.jsx("th",{className:"text-center px-2 py-2 w-[80px]",children:"Aes"})]})}),a.jsxs("tbody",{children:[Ot.map((Hr,hn)=>{const An=(si||[]).find(xr=>String(xr.id)===String(Hr.finalizadora_id));return a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsxs("td",{className:"px-2 py-1",children:[a.jsxs("select",{className:"h-7 text-xs bg-surface border border-border rounded-md px-1 w-full",value:Hr.finalizadora_id||"",onChange:xr=>Fe(Tr=>{const jn=Array.isArray(Tr.pagamentos)?[...Tr.pagamentos]:[],fa=xr.target.value||"",qn=(si||[]).find(Fa=>String(Fa.id)===String(fa));return jn[hn]={...jn[hn]||{},finalizadora_id:fa,tipo:qn?.nome||jn[hn]?.tipo||""},{...Tr,pagamentos:jn}}),children:[a.jsx("option",{value:"",children:"Selecione"}),(si||[]).map(xr=>a.jsxs("option",{value:xr.id,children:[xr.codigo_interno?`[${xr.codigo_interno}] `:"",xr.nome]},xr.id))]}),a.jsx("div",{className:"text-[10px] text-text-secondary truncate",children:Hr.tipo||An?.nome||""})]}),a.jsx("td",{className:"px-2 py-1",children:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx(It,{className:"h-7 text-xs",placeholder:"Bandeira (Visa, Master...)",value:Hr.bandeira||"",onChange:xr=>Fe(Tr=>{const jn=Array.isArray(Tr.pagamentos)?[...Tr.pagamentos]:[];return jn[hn]={...jn[hn]||{},bandeira:xr.target.value},{...Tr,pagamentos:jn}})}),a.jsx(It,{className:"h-7 text-xs",placeholder:"N autorizao (opcional)",value:Hr.autorizacao||"",onChange:xr=>Fe(Tr=>{const jn=Array.isArray(Tr.pagamentos)?[...Tr.pagamentos]:[];return jn[hn]={...jn[hn]||{},autorizacao:xr.target.value},{...Tr,pagamentos:jn}})})]})}),a.jsx("td",{className:"px-2 py-1 text-right",children:a.jsx(It,{className:"h-7 text-right text-xs",value:Hr.valor||"0,00",onChange:xr=>Kt(hn,xr.target.value),onKeyDown:xr=>{xr.stopPropagation(),!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(xr.key)&&(/^[0-9]$/.test(xr.key)||xr.preventDefault())},onBeforeInput:xr=>{const Tr=xr.data??"";Tr&&/\D/.test(Tr)&&xr.preventDefault()}})}),a.jsx("td",{className:"px-2 py-1 text-center",children:a.jsx(Z,{size:"icon",variant:"outline",className:"h-7 w-7",onClick:()=>Jt(hn),children:a.jsx(bc,{className:"w-3.5 h-3.5"})})})]},hn)}),Ot.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"px-2 py-3 text-center text-text-secondary text-xs",children:'Nenhum pagamento. Use "Adicionar pagamento".'})})]})]})}),a.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-3 text-xs",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Total da Nota:"})," ",a.jsxs("span",{className:"font-semibold",children:["R$ ",ao(Tt)]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-secondary",children:"Total Pago:"})," ",a.jsxs("span",{className:"font-semibold",children:["R$ ",ao(Rt)]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Diferena (Pago - Nota)"}),a.jsxs("div",{className:Math.abs(yt)<.009?"font-semibold text-emerald-500":"font-semibold text-amber-500",children:["R$ ",ao(yt)]})]})]})]})})()}),a.jsx(yo,{value:"transporte",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Transporte"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[a.jsxs("div",{children:[a.jsx(ct,{className:es(Te.transporte?.tipo_frete)?"text-red-400":"",children:"Modalidade do Frete"}),a.jsxs(Zn,{value:Te.transporte?.tipo_frete||"9",onValueChange:D=>Fe(X=>({...X,transporte:{...X.transporte||{},tipo_frete:D}})),children:[a.jsx(Yn,{className:`h-8 text-xs ${es(Te.transporte?.tipo_frete)?"border-red-500 text-red-400":""}`,children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"0",children:"Por conta do Emitente"}),a.jsx(nt,{value:"1",children:"Por conta do Destinatrio"}),a.jsx(nt,{value:"9",children:"Sem Frete"})]})]})]}),a.jsxs("div",{className:"md:col-span-3",children:[a.jsx(ct,{children:"Transportadora (se houver)"}),a.jsx(It,{className:"h-8 text-xs",value:Te.transporte?.transportadora||"",onChange:D=>Fe(X=>({...X,transporte:{...X.transporte||{},transportadora:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Placa do Veculo"}),a.jsx(It,{className:"h-8 text-xs",value:Te.transporte?.placa||"",onChange:D=>Fe(X=>({...X,transporte:{...X.transporte||{},placa:(D.target.value||"").toUpperCase()}})),placeholder:"ABC1D23"})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"UF da Placa"}),a.jsx(It,{className:"h-8 text-xs",value:Te.transporte?.uf_placa||"",onChange:D=>Fe(X=>({...X,transporte:{...X.transporte||{},uf_placa:(D.target.value||"").toUpperCase().slice(0,2)}})),placeholder:"UF"})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Qtd. de Volumes"}),a.jsx(It,{className:"h-8 text-xs",value:Te.transporte?.volumes||"",onChange:D=>Fe(X=>({...X,transporte:{...X.transporte||{},volumes:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Peso Bruto (kg)"}),a.jsx(It,{className:"h-8 text-xs",value:Te.transporte?.peso_bruto||"",onChange:D=>Fe(X=>({...X,transporte:{...X.transporte||{},peso_bruto:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Peso Lquido (kg)"}),a.jsx(It,{className:"h-8 text-xs",value:Te.transporte?.peso_liquido||"",onChange:D=>Fe(X=>({...X,transporte:{...X.transporte||{},peso_liquido:D.target.value}}))})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Informaes Adicionais"}),a.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"Observaes Fiscais"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:Te.adicionais?.info_fisco||"",onChange:D=>Fe(X=>({...X,adicionais:{...X.adicionais||{},info_fisco:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Informaes Complementares"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:Te.adicionais?.obs_gerais||"",onChange:D=>Fe(X=>({...X,adicionais:{...X.adicionais||{},obs_gerais:D.target.value}}))})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Observaes Legais"}),a.jsx("textarea",{className:"w-full h-20 text-xs rounded-md border border-border bg-surface px-2 py-1",value:Te.adicionais?.obs_legais||"",onChange:D=>Fe(X=>({...X,adicionais:{...X.adicionais||{},obs_legais:D.target.value}}))})]})]})]})]})}),a.jsx(yo,{value:"totais",children:(()=>{const D=Te.itens||[];let X=0,Pe=0,rt=0,Le=0,Tt=0,Ot=0,Rt=0,yt=0,Ge=0,Jt=0;D.forEach(fa=>{const qn=Ee(fa.preco_unitario)||0,Fa=Ee(fa.quantidade)||1,ps=qn*Fa,La=Ee(fa.desconto_percent)||0,xa=Ee(fa.desconto_valor)||0,Ss=La?ps*La/100:xa,js=Ee(fa.acrescimos_valor)||0,Rs=Math.max(0,ps-Ss+js);X+=Rs,Pe+=Ss;const Xn=Ee(fa.impostos?.icms?.base)||Rs,ba=Ee(fa.impostos?.icms?.aliquota)||0,Ws=Xn*ba/100;rt+=Xn,Le+=Ws;const Bs=Ee(fa.impostos?.pis?.aliquota)||0,oo=Ee(fa.impostos?.cofins?.aliquota)||0,ed=Ee(fa.impostos?.ipi?.aliquota)||0;Tt+=Rs*Bs/100,Ot+=Rs*oo/100,Rt+=Rs*ed/100,yt+=Ee(fa.frete_valor)||0,Ge+=Ee(fa.seguro_valor)||0,Jt+=js});const Kt=Ee(Te.totais.desconto_geral)||0,Hr=Ee(Te.totais.frete)||0,hn=Ee(Te.totais.outras_despesas)||0,An=yt+Hr,xr=Ge,Tr=Jt+hn,jn=X-Kt+An+xr+Tr;return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Total dos Produtos"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",ao(X)]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Total de Descontos"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",ao(Pe+Kt)]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Valor Total da Nota"}),a.jsxs("div",{className:"text-lg font-semibold",children:["R$ ",ao(jn)]})]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface space-y-3",children:[a.jsx("div",{className:"text-sm font-medium mb-1",children:"ICMS / PIS / COFINS / IPI"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 text-xs",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Base de Clculo ICMS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(rt)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do ICMS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(Le)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do PIS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(Tt)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do COFINS"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(Ot)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Valor do IPI"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(Rt)]})]})]})]}),a.jsxs("div",{className:"border border-border rounded-md p-3 bg-surface space-y-2 text-xs",children:[a.jsx("div",{className:"text-sm font-medium mb-1",children:"Outros Valores"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Frete"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(An)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Seguro"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(xr)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Outras Despesas"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(Tr)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-text-secondary mb-0.5",children:"Desconto Geral"}),a.jsxs("div",{className:"font-semibold",children:["R$ ",ao(Kt)]})]})]})]})]})})()}),a.jsx(yo,{value:"resumo",children:(()=>{const D=Te.itens||[];let X=0;D.forEach(wa=>{const Za=Ee(wa.preco_unitario)||0,xo=Ee(wa.quantidade)||1,Zi=Za*xo,td=Ee(wa.desconto_percent)||0,rm=Ee(wa.desconto_valor)||0,Pu=td?Zi*td/100:rm,Yl=Ee(wa.acrescimos_valor)||0,Tl=Math.max(0,Zi-Pu+Yl);X+=Tl});const Pe=Ee(Te.totais?.desconto_geral)||0,rt=Ee(Te.totais?.frete)||0,Le=Ee(Te.totais?.outras_despesas)||0,Tt=X-Pe+rt+Le,Ot=(Te.pagamentos||[]).reduce((wa,Za)=>wa+(Ee(Za.valor)||0),0),Rt=Ot-Tt,yt=String(Te.modelo)==="65",Ge=String(Te.modelo)==="55",Jt=!!(Te.modelo&&Te.serie&&Te.natOp&&Te.data_emissao&&Te.tipo_nota&&Te.idDest&&(Te.indFinal??"")!==""&&(Te.indPres??"")!==""&&Te.finNFe&&Te.cfop_padrao),Kt=xe?.cidade_ibge||xe?.codigo_municipio_ibge||xe?.codigo_ibge_municipio||xe?.ibge||xe?.cod_municipio||"",Hr=!!(xe&&xe.cnpj&&xe.razao_social&&xe.regime_tributario&&xe.inscricao_estadual&&xe.logradouro&&(xe.numero||xe.nro)&&xe.bairro&&xe.cidade&&xe.uf&&xe.cep&&Kt),hn=!!(Te?.nome||Te?.cpf_cnpj),An=Ge,xr=!!(Te?.cpf_cnpj&&Te?.nome&&Te?.indIEDest&&Te?.logradouro&&Te?.numero&&Te?.bairro&&Te?.cidade&&Te?.uf&&Te?.cep),Tr=An||hn?xr:!0,jn=Array.isArray(D)&&D.length>0,fa=jn&&D.every(wa=>(wa.codigo||wa.descricao)&&wa.ncm&&wa.cfop&&wa.unidade&&Ee(wa.quantidade)>0&&(wa.preco_unitario||wa.preco_unitario==="0,00")),qn=jn&&D.every(wa=>{const Za=wa.impostos||{},xo=Za.icms||{},Zi=Za.pis||{},td=Za.cofins||{},rm=!!(Za.origem!==void 0&&Za.origem!==""&&(xo.cst||xo.csosn)),Pu=Zi.aliquota!==void 0&&String(Zi.aliquota).trim()!=="",Yl=td.aliquota!==void 0&&String(td.aliquota).trim()!=="";return rm&&Pu&&Yl}),Fa=(()=>{let wa=0;return D.forEach(Za=>{const xo=(Ee(Za.preco_unitario)||0)*(Ee(Za.quantidade)||1)-(Ee(Za.desconto_percent)?(Ee(Za.preco_unitario)||0)*(Ee(Za.quantidade)||1)*(Ee(Za.desconto_percent)||0)/100:Ee(Za.desconto_valor)||0)+(Ee(Za.acrescimos_valor)||0),Zi=Ee(Za.impostos?.icms?.base);wa+=isFinite(Zi)&&Zi>0?Zi:xo}),wa})(),ps=D.reduce((wa,Za)=>wa+(Ee(Za.impostos?.icms?.base)||(Ee(Za.preco_unitario)||0)*(Ee(Za.quantidade)||1))*(Ee(Za.impostos?.icms?.aliquota)||0)/100,0),La=D.reduce((wa,Za)=>wa+(Ee(Za.preco_unitario)||0)*(Ee(Za.quantidade)||1)*(Ee(Za.impostos?.pis?.aliquota)||0)/100,0),xa=D.reduce((wa,Za)=>wa+(Ee(Za.preco_unitario)||0)*(Ee(Za.quantidade)||1)*(Ee(Za.impostos?.cofins?.aliquota)||0)/100,0),Ss=D.reduce((wa,Za)=>wa+(Ee(Za.preco_unitario)||0)*(Ee(Za.quantidade)||1)*(Ee(Za.impostos?.ipi?.aliquota)||0)/100,0),js=ps+La+xa+Ss,Rs=[Tt,Fa,ps,La,xa,Ss,rt,Pe,Le,js].every(wa=>wa!=null&&!Number.isNaN(wa)),Xn=!!(Te.transporte&&Te.transporte.tipo_frete),ba=Ot+.009>=Tt,Bs=!(yt&&(Te.pagamentos||[]).some(wa=>{const Za=(si||[]).find(Zi=>String(Zi.id)===String(wa.finalizadora_id)),xo=String(wa.tipo||Za?.nome||"").toLowerCase();return xo.includes("cart")||xo.includes("crdit")||xo.includes("credit")||xo.includes("db")||xo.includes("deb")}))||(Te.pagamentos||[]).every(wa=>{const Za=(si||[]).find(td=>String(td.id)===String(wa.finalizadora_id)),xo=String(wa.tipo||Za?.nome||"").toLowerCase();return!(xo.includes("cart")||xo.includes("crdit")||xo.includes("credit")||xo.includes("db")||xo.includes("deb"))||!!(wa.bandeira&&wa.bandeira.trim())}),oo=yt?(Te.pagamentos||[]).length>0&&ba&&Bs:!0,ed=Jt&&Hr&&jn&&fa&&qn&&Rs&&Xn&&Tr&&oo,Qi=({ok:wa,label:Za,extra:xo})=>a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border/60 last:border-b-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[wa?a.jsx(bb,{className:"w-4 h-4 text-emerald-500"}):a.jsx(Kf,{className:"w-4 h-4 text-amber-500"}),a.jsx("div",{className:"text-sm",children:Za})]}),xo?a.jsx("div",{className:"text-xs text-text-secondary",children:xo}):null]});return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"border border-border rounded-md bg-surface",children:[a.jsx("div",{className:"text-sm font-medium px-3 py-2",children:"Checklist"}),a.jsxs("div",{children:[a.jsx(Qi,{ok:Jt,label:"Identificao"}),a.jsx(Qi,{ok:Hr,label:"Emitente"}),a.jsx(Qi,{ok:Tr,label:"Destinatrio",extra:yt&&!hn?"Opcional na NFC-e":Te?.nome||""}),a.jsx(Qi,{ok:jn,label:"Itens",extra:`${D.length} item(ns)`}),a.jsx(Qi,{ok:fa,label:"Produtos completos"}),a.jsx(Qi,{ok:qn,label:"Impostos por item"}),a.jsx(Qi,{ok:Rs,label:"Totais"}),a.jsx(Qi,{ok:Xn,label:"Transporte"}),a.jsx(Qi,{ok:oo,label:"Pagamento",extra:yt?`Pago R$ ${ao(Ot)}  Nota R$ ${ao(Tt)}`:void 0})]})]}),a.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-3",children:[a.jsxs("div",{className:"text-sm text-text-secondary",children:[a.jsxs("div",{children:["Total da Nota: ",a.jsxs("span",{className:"text-text-primary font-semibold",children:["R$ ",ao(Tt)]})]}),a.jsxs("div",{children:["Total Pago: ",a.jsxs("span",{className:"text-text-primary font-semibold",children:["R$ ",ao(Ot)]})]}),a.jsxs("div",{children:["Diferena: ",a.jsxs("span",{className:Math.abs(Rt)<.009?"text-emerald-500 font-semibold":"text-amber-500 font-semibold",children:["R$ ",ao(Rt)]})]})]}),a.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:async()=>{const wa=[];Jt||wa.push("Preencha os dados de identificao da nota"),Hr||wa.push("Complete os dados da empresa (CNPJ, endereo, inscrio, regime)"),Tr||wa.push(Ge?"Informe os dados do destinatrio":"Revise os dados do destinatrio preenchidos"),jn||wa.push("Adicione pelo menos um item na nota"),fa||wa.push("Revise os campos obrigatrios dos itens (produto, NCM, CFOP, unidade, quantidade, preo)"),qn||wa.push("Preencha os impostos de todos os itens (origem, ICMS, PIS e COFINS)"),Rs||wa.push("Verifique os totais da nota"),Xn||wa.push("Informe a modalidade do frete em Transporte"),oo||wa.push("Revise a forma de pagamento e o valor pago"),wa.length?r({title:"Ainda faltam dados para emitir",description:wa.join("  "),variant:"warning"}):r({title:"Tudo certo",description:"A nota est pronta para emitir",variant:"success"})},children:"Validar Nota"}),a.jsx(Z,{size:"sm",disabled:!ed||un,onClick:async()=>{ra(!0);try{await sr()}finally{ra(!1)}},children:un?a.jsxs("span",{className:"inline-flex items-center",children:[a.jsx(cl,{className:"mr-2 h-4 w-4 animate-spin"})," Emitindo"]}):"Emitir Nota"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:Lt,children:"Salvar Rascunho"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>jr(!1),children:"Cancelar Emisso"})]})]}),a.jsxs("div",{className:"border border-border rounded-md bg-surface p-3 text-xs text-text-secondary",children:[a.jsx("div",{className:"mb-1 font-medium text-text-primary",children:"Ps-Emisso"}),a.jsx("div",{children:"Aps a emisso, exibiremos o status SEFAZ, chave de acesso, links do XML e DANFE, e opes de envio por e-mail ou WhatsApp."})]})]})})()})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{onClick:Lt,disabled:Cr,children:Cr?"Salvando...":"Salvar rascunho"}),a.jsx(Z,{variant:"outline",onClick:()=>jr(!1),children:"Fechar"})]}),!1]})}),a.jsx(Un,{open:gl,onOpenChange:qd,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-[800px] max-h-[85vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"XML gerado"}),a.jsx(ma,{children:"Faa o download ou salve no Supabase."})]}),a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Prvia do XML"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>RV(`nfe-manual-${Date.now()}.xml`,sa),children:"Baixar XML"}),a.jsx(Z,{size:"sm",onClick:async()=>{try{Lr(!0);const D=`nfe/${t}/manual-${Date.now()}.xml`,X=new Blob([sa],{type:"text/xml;charset=utf-8"}),{error:Pe}=await Q.storage.from("fiscal").upload(D,X,{contentType:"text/xml"});if(Pe)throw Pe;r({title:"XML salvo no Supabase"})}catch(D){r({title:"Falha ao salvar",description:D.message,variant:"destructive"})}finally{Lr(!1)}},disabled:Cr,children:Cr?"Salvando...":"Salvar no Supabase"})]})]}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto border border-border rounded p-2 bg-surface-2",children:sa})]})}),a.jsx(Un,{open:We,onOpenChange:Ze,children:a.jsxs(zn,{className:"w-[95vw] sm:max-w-[680px] md:max-w-[860px] lg:max-w-[900px] max-h-[85vh] overflow-y-auto",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Emisso NF-e (XML offline)"}),a.jsx(ma,{children:"Preencha os campos abaixo e gere o XML da NF-e. Transmisso para SEFAZ ficar para a prxima etapa."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{children:"Natureza da Operao (natOp)"}),a.jsx(It,{value:ze.natOp,onChange:D=>xt(X=>({...X,natOp:D.target.value})),placeholder:"VENDA"})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Srie"}),a.jsx(It,{value:ze.serie,onChange:D=>xt(X=>({...X,serie:D.target.value}))})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Nmero (nNF)"}),a.jsx(It,{value:ze.nNF,onChange:D=>xt(X=>({...X,nNF:D.target.value})),placeholder:"(opcional)"})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Destino da Operao (idDest)"}),a.jsxs(Zn,{value:ze.idDest||"auto",onValueChange:D=>xt(X=>({...X,idDest:D})),children:[a.jsx(Yn,{children:a.jsx(ta,{placeholder:"Automtico"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"auto",children:"Automtico"}),a.jsx(nt,{value:"1",children:"Interna (mesmo estado)"}),a.jsx(nt,{value:"2",children:"Interestadual"}),a.jsx(nt,{value:"3",children:"Exterior"})]})]})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Consumidor Final (indFinal)"}),a.jsxs(Zn,{value:ze.indFinal,onValueChange:D=>xt(X=>({...X,indFinal:D})),children:[a.jsx(Yn,{children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"1",children:"Sim"}),a.jsx(nt,{value:"0",children:"No"})]})]})]}),a.jsxs("div",{children:[a.jsx(ct,{children:"Presena do Comprador (indPres)"}),a.jsxs(Zn,{value:ze.indPres,onValueChange:D=>xt(X=>({...X,indPres:D})),children:[a.jsx(Yn,{children:a.jsx(ta,{})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"1",children:"Operao presencial"}),a.jsx(nt,{value:"2",children:"No presencial, internet"}),a.jsx(nt,{value:"4",children:"Entrega em domiclio"}),a.jsx(nt,{value:"9",children:"No se aplica"})]})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>Ze(!1),children:"Fechar"}),a.jsx(Z,{onClick:is,disabled:Je,children:Je?"Gerando...":"Gerar XML"})]}),Ye&&a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:"Prvia do XML Gerado"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>RV(`nfe-${ce||"doc"}.xml`,Ye),children:"Baixar XML"}),a.jsx(Z,{size:"sm",onClick:Ns,disabled:rr,children:rr?"Salvando...":"Salvar no Supabase"})]})]}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto border border-border rounded p-2 bg-surface-2",children:Ye})]})]})})]})}function RV(e,t){try{const r=new Blob([t],{type:"text/xml;charset=utf-8"}),n=URL.createObjectURL(r),s=document.createElement("a");s.href=n,s.download=e,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(n)}catch{}}const llt=(e,t,r)=>e.split(/(\*\*.*?\*\*)/g).map((s,o)=>{if(s.startsWith("**")&&s.endsWith("**")){const i=s.slice(2,-2);return a.jsx("strong",{className:`font-black ${t?r?"text-white":"text-[#000000]":"text-white"}`,style:{fontWeight:900,textShadow:t?r?"0 0 1px rgba(0,0,0,0.25)":"0 0 1px rgba(0,0,0,0.3)":"0 0 1px rgba(255,255,255,0.5)"},children:i},o)}return s}),Foe=({message:e})=>{const t=e.from==="isis",r=t&&e?.color==="green",n=t&&e?.color==="system",[s,o]=p.useState(!1),{selections:i}=p5(),{clientIdentified:l,userInitial:c}=p.useMemo(()=>{const u=i?.contato?.nome||i?.cliente?.nome||"",f=String(u).trim(),h=f?f[0]:"",m=h&&/[A-Za-z---]/.test(h)?h.toUpperCase():"U";return{clientIdentified:!!u,userInitial:m}},[i?.contato?.nome,i?.cliente?.nome]),d=async u=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(u);else{const f=document.createElement("textarea");f.value=u,f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.opacity="0",document.body.appendChild(f),f.focus(),f.select(),document.execCommand("copy"),document.body.removeChild(f)}o(!0),setTimeout(()=>o(!1),1800)}catch{}};return a.jsx(Fr.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:[.22,1,.36,1]},className:`flex ${t?"justify-start":"justify-end"} mb-4 md:mb-6`,children:a.jsxs("div",{className:`flex items-end gap-2 md:gap-3 max-w-[90%] md:max-w-[85%] lg:max-w-[75%] ${!t&&"flex-row-reverse"}`,children:[t?a.jsx(dl,{size:"sm",variant:"message",className:"md:w-14 md:h-14"}):l?a.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center flex-shrink-0 bg-brand/10 text-brand ring-2 ring-brand/60",children:a.jsx("span",{className:"font-extrabold text-base md:text-lg leading-none select-none",children:c})}):a.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center flex-shrink-0 bg-surface border border-white/10 text-text-muted",children:a.jsx(kf,{className:"w-5 h-5 md:w-6 md:h-6"})}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("div",{className:`relative px-3 py-2.5 md:px-5 md:py-3.5 backdrop-blur-sm transition-all duration-300 ${t?r?"bg-emerald-600/90 border border-emerald-400 text-white rounded-2xl rounded-bl-sm shadow-lg shadow-emerald-600/30":n?"bg-surface/70 border border-white/10 text-text-muted rounded-2xl rounded-bl-sm":"bg-brand border border-brand text-[#0A0A0A] rounded-2xl rounded-bl-sm shadow-lg shadow-brand/20":"bg-surface/70 border border-white/10 text-text-primary rounded-2xl rounded-br-sm"}`,children:[a.jsx("p",{className:"text-[15px] md:text-[15px] font-bold leading-relaxed whitespace-pre-wrap tracking-wide relative",children:llt(e.text,t,r)}),e.copyable&&a.jsx("button",{type:"button",onClick:()=>d(e.copyText||(typeof e.text=="string"?e.text:"")),className:`absolute right-2 bottom-2 p-1.5 md:p-2 rounded-full border shadow-sm transition ${t?"bg-white/80 border-white/40 text-[#0A0A0A] hover:bg-white":"bg-white/10 border-white/10 text-text-primary hover:bg-white/20"}`,"aria-label":"Copiar texto",children:s?a.jsx(Fm,{className:"w-4 h-4"}):a.jsx(Q4,{className:"w-4 h-4"})})]}),a.jsx("p",{className:`text-[10px] md:text-[10px] text-text-muted px-2 ${t?"text-left":"text-right"}`,children:dr(e.timestamp,"HH:mm")})]})]})})};function clt(){const[e,t]=p.useState([]),[r,n]=p.useState(""),[s,o]=p.useState(!1),[i,l]=p.useState(""),[c,d]=p.useState(!0),u=p.useRef(null),{company:f,userProfile:h,user:m}=lo();p.useEffect(()=>{const b={id:Date.now()+Math.random(),from:"isis",text:"Ol! Eu sou a verso Premium da sis, integrada  OpenAI. Em que posso ajudar? ",timestamp:new Date};t([b])},[]),p.useEffect(()=>{const b=setTimeout(()=>{u.current?.scrollIntoView({behavior:"smooth",block:"end"})},100);return()=>clearTimeout(b)},[e,s]);const x=b=>{t(w=>[...w,{id:Date.now()+Math.random(),timestamp:new Date,...b}])},g=b=>{const w=String(b||"").toLowerCase();return w?w.includes("agend")||w.includes("agenda")?w.includes("hoje")?"Consultando os agendamentos de hoje...":w.includes("amanh")?"Consultando os agendamentos de amanh...":"Consultando seus agendamentos...":w.includes("cliente")?"Buscando informaes de clientes...":w.includes("caixa")||w.includes("faturamento")||w.includes("financeiro")||w.includes("venda")||w.includes("pagamento")?"Analisando movimentaes da sua arena...":w.includes("quadra")||w.includes("reserva")?"Verificando horrios e quadras disponveis...":"...":"..."},v=async(b,w)=>{try{const j=f?.codigoEmpresa||f?.codigo_empresa||null,_=h?.id||m?.id||null,C=h?.nome||m?.email||null,E=h?.cargo||null,S=new Date,A=new Date(S.getFullYear(),S.getMonth(),S.getDate(),0,0,0,0),M=new Date(A);M.setDate(M.getDate()+1);const O=A.toISOString(),I=M.toISOString(),T=Array.isArray(w)?w.map(F=>({role:F.from==="isis"?"assistant":"user",content:F.text})):[],{data:k,error:q}=await Q.functions.invoke("chat-proxy",{body:{message:b,empresaCodigo:j,usuarioId:_,usuarioNome:C,usuarioCargo:E,data_inicio:O,data_fim:I,history:T}});if(q)throw q;const B=typeof k?.reply=="string"&&k.reply.trim().length>0?k.reply:"Certo! (resposta provisria)";let z=Array.isArray(k?.replies)?k.replies.filter(F=>typeof F=="string"&&F.trim().length>0):[];if(z.length===0&&(z=[B]),console.log("[sis][response]",{replies:z,raw:k}),k)try{console.log("[sis][response raw JSON]",JSON.stringify(k,null,2))}catch{}for(let F=0;F<z.length;F++){const V=z[F];x({from:"isis",text:V}),F<z.length-1&&await new Promise(me=>setTimeout(me,600))}o(!1),l("")}catch{x({from:"isis",text:"No momento, estou operando em modo de demonstrao. Em breve estarei 100% conectada  OpenAI aqui na aba Premium! "}),o(!1),l("")}},y=async b=>{b.preventDefault();const w=r.trim();if(!w)return;const j=[...e];console.log("[sis][question]",{message:w}),x({from:"user",text:w}),n(""),o(!0),l(g(w)),await v(w,j)};return a.jsxs("div",{className:"flex h-full w-full relative",children:[a.jsxs("div",{className:"flex-1 flex flex-col pointer-events-none",children:[a.jsxs("div",{className:"flex-1 overflow-y-auto px-3 md:px-6 py-4 md:py-6",children:[e.map(b=>a.jsx(Foe,{message:b},b.id)),s&&a.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start mb-4",children:a.jsx("div",{className:"px-4 py-2 rounded-2xl bg-brand border border-brand text-[#0A0A0A] flex items-center gap-2 animate-pulse",children:i&&i!=="..."?a.jsxs(a.Fragment,{children:[a.jsx("span",{role:"img","aria-label":"pensando",children:""}),a.jsx("span",{children:i})]}):a.jsx("span",{className:"font-semibold tracking-widest",children:"..."})})}),a.jsx("div",{ref:u})]}),a.jsx("div",{className:"sticky bottom-0 px-3 md:px-6 pb-3 md:pb-6 pt-3 md:pt-4 bg-gradient-to-t from-background via-background to-transparent",children:a.jsxs("form",{onSubmit:y,className:"flex items-center gap-2 bg-surface/70 border border-white/10 rounded-xl px-3 py-2.5",children:[a.jsx(yG,{className:"w-5 h-5 text-text-muted"}),a.jsx("input",{value:r,onChange:b=>n(b.target.value),placeholder:"Escreva aqui",className:"flex-1 bg-transparent outline-none text-sm"}),a.jsxs("button",{type:"submit",disabled:!r.trim(),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-semibold transition ${r.trim()?"bg-brand text-bg":"bg-surface/40 text-text-muted cursor-not-allowed"}`,children:[a.jsx(Z4,{className:"w-4 h-4"}),"Enviar"]})]})})]}),c&&a.jsx("div",{className:"absolute inset-0 z-10 backdrop-blur-lg bg-black/60 flex items-center justify-center pointer-events-auto rounded-lg overflow-hidden",children:a.jsx(Fr.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},transition:{duration:.5,ease:[.22,1,.36,1]},className:"rounded-2xl border border-white/30 bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 shadow-2xl max-w-sm w-full text-center mx-4 overflow-hidden",children:a.jsxs("div",{className:"px-8 py-10",children:[a.jsx(Fr.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.2,duration:.4},className:"flex items-center justify-center mb-8",children:a.jsx("div",{className:"w-24 h-24 rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_20px_rgba(168,85,247,0.5)] overflow-hidden",children:a.jsx("div",{className:"w-full h-full rounded-full overflow-hidden bg-background flex items-center justify-center",children:a.jsx(dl,{size:"lg"})})})}),a.jsxs(Fr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},children:[a.jsx("div",{className:"text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-400 via-violet-300 to-emerald-300 mb-4",children:"sis"}),a.jsx("p",{className:"text-sm text-gray-300 mb-6 leading-relaxed",children:"Em breve sua assistente IA vai estar pronta para revolucionar a gesto da sua arena. "}),a.jsxs("div",{className:"space-y-3 text-left",children:[a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-emerald-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Gerencie agendamentos com inteligncia artificial"})]}),a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-violet-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Otimize sua agenda e maximize ocupao"})]}),a.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-200",children:[a.jsx("span",{className:"text-fuchsia-400 font-bold mt-0.5",children:""}),a.jsx("span",{children:"Insights inteligentes sobre sua arena"})]})]})]})]})})})]})}function dlt(){const{company:e}=lo(),{clearIsisAlerts:t}=oj(),r=e?.codigo_empresa||e?.codigoEmpresa||null,[n,s]=p.useState(!0),[o,i]=p.useState(null),[l,c]=p.useState(!1),[d,u]=p.useState(null),[f,h]=p.useState(""),[m,x]=p.useState(""),[g,v]=p.useState(!1),[y,b]=p.useState(!1),[w,j]=p.useState(!1),[_,C]=p.useState(""),[E,S]=p.useState(""),[A,M]=p.useState(""),[O,I]=p.useState(!1),[T,k]=p.useState({agendamentosIsisTotal:0,agendamentosIsisHoje:0,agendamentosIsis7d:0,agendamentosTotal7d:0,cancelamentosIsis7d:0,perDay7d:[],topQuadras30d:[],ultimasInteracoes:[]}),[q,B]=p.useState({}),z=Y=>{if(!Y)return"";const W=Y instanceof Date?Y:new Date(Y);if(isNaN(W.getTime()))return"";const se=W.getFullYear(),pe=String(W.getMonth()+1).padStart(2,"0"),G=String(W.getDate()).padStart(2,"0");return`${se}-${pe}-${G}`},F=Y=>{if(!Y)return null;const W=/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/.exec(String(Y));if(!W)return null;const se=parseInt(W[1],10),pe=parseInt(W[2],10)-1,G=parseInt(W[3],10),te=new Date(se,pe,G,0,0,0,0);return isNaN(te.getTime())?null:te},V=Y=>{try{if(!Y)return"";const W=Y instanceof Date?Y:new Date(Y);return isNaN(W.getTime())?"":W.toLocaleDateString("pt-BR")}catch{return""}};p.useEffect(()=>{try{t?.()}catch{}},[t]),p.useEffect(()=>{if(!r||f||m)return;const Y=new Date,W=new Date;W.setDate(W.getDate()-6);const se=z(W),pe=z(Y);try{console.log("[IsisAnalytics] Init default range (auto-fill):",{startYmd:se,endYmd:pe})}catch{}h(se),x(pe)},[r]),p.useEffect(()=>{!g||!e?.id||(async()=>{try{b(!0);const{data:Y,error:W}=await Q.from("agenda_settings").select("isis_cancel_min_hours_before, isis_subdomain, isis_display_name").eq("empresa_id",e.id).single();if(W&&W.code!=="PGRST116")throw W;if(Y)C(Y.isis_cancel_min_hours_before??""),S(Y.isis_subdomain||""),M(Y.isis_display_name||"");else{const se=(e.nome_fantasia||"").toLowerCase().replace(/[^a-z0-9]+/g,"");S(se),M(e.nome_fantasia||"")}}catch(Y){console.error("[IsisSettings] Erro ao carregar:",Y)}finally{b(!1)}})()},[g,e?.id,e?.nome_fantasia]);const me=async()=>{if(e?.id)try{j(!0);const Y=_===""?null:parseInt(_,10);if(Y!==null&&(isNaN(Y)||Y<0)){alert("Horas de cancelamento deve ser um nmero >= 0"),j(!1);return}const W=(E||"").toLowerCase().replace(/[^a-z0-9]+/g,"");if(!W){alert("Subdomnio no pode estar vazio"),j(!1);return}const se=(A||"").trim();if(!se){alert("Nome de exibio no pode estar vazio"),j(!1);return}const{error:pe}=await Q.from("agenda_settings").upsert({empresa_id:e.id,isis_cancel_min_hours_before:Y,isis_subdomain:W,isis_display_name:se},{onConflict:"empresa_id"});if(pe)throw pe;S(W),M(se),I(!1),v(!1)}catch(Y){console.error("[IsisSettings] Erro ao salvar:",Y),alert("Erro ao salvar configuraes: "+(Y?.message||"desconhecido"))}finally{j(!1)}},be={hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.1,delayChildren:.15}}},U={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:[.22,1,.36,1]}}},L=({icon:Y,title:W,value:se,color:pe="brand"})=>a.jsxs(Fr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("div",{className:"flex items-center justify-center h-10 w-10 rounded-md border border-white/10 bg-white/5",style:{color:`var(--${pe})`},children:a.jsx(Y,{className:"h-5 w-5"})})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold text-text-secondary uppercase tracking-wider mb-2",children:W}),a.jsx("p",{className:"text-3xl font-bold text-text-primary tabular-nums tracking-tight",children:se})]})]}),H=p.useMemo(()=>(T.perDay7d||[]).map(Y=>({name:new Date(Y.date).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"}),total:Y.total,isis:Y.isis})),[T.perDay7d]);p.useEffect(()=>{let Y=!0;return(async()=>{try{s(!0),i(null);const W=lt=>{const gt=new Date(lt);return gt.setHours(0,0,0,0),gt},se=lt=>{const gt=new Date(lt);return gt.setHours(23,59,59,999),gt},pe=W(new Date),G=se(new Date),te=new Date;te.setDate(te.getDate()-6);const oe=W(te),De=G,re=new Date;re.setDate(re.getDate()-29);const ae=W(re);console.log("[IsisAnalytics] codigoEmpresa:",r,"company obj:",e);const{count:ut,error:pt}=await Q.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("created_by_isis",!0);if(pt)throw pt;console.log("[IsisAnalytics] HOJE intervalo criado_em:",pe.toISOString(),"->",G.toISOString());let bt=(await Q.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",pe.toISOString()).lte("criado_em",G.toISOString()))?.count??null;if(bt==null){const{data:lt}=await Q.from("agendamentos").select("id").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",pe.toISOString()).lte("criado_em",G.toISOString());bt=(lt||[]).length}console.log("[IsisAnalytics] agIsisHoje (count resolved):",bt),console.log("[IsisAnalytics] 7d intervalo criado_em:",oe.toISOString(),"->",De.toISOString());const{data:Lt}=await Q.from("agendamentos").select("id, criado_em").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("criado_em",oe.toISOString()).lte("criado_em",De.toISOString());console.log("[IsisAnalytics] agIsis7dRows length:",(Lt||[]).length);const{data:Dt}=await Q.from("agendamentos").select("id, inicio").eq("codigo_empresa",r).gte("inicio",oe.toISOString()).lte("inicio",De.toISOString());let ge=(await Q.from("agendamentos").select("id",{count:"exact",head:!0}).eq("codigo_empresa",r).eq("canceled_by","isis").gte("canceled_at",oe.toISOString()).lte("canceled_at",De.toISOString()))?.count??null;if(ge==null){const{data:lt}=await Q.from("agendamentos").select("id").eq("codigo_empresa",r).eq("canceled_by","isis").gte("canceled_at",oe.toISOString()).lte("canceled_at",De.toISOString());ge=(lt||[]).length}console.log("[IsisAnalytics] cancelamentosIsis7d (count resolved - canceled_by=isis):",ge);const wt=Array.isArray(Lt)?Lt.length:0,Gt=Array.isArray(Dt)?Dt.length:0,Sr=lt=>{const gt=new Date(lt);return gt.setHours(0,0,0,0),gt.toISOString().slice(0,10)},wr={};for(let lt=0;lt<7;lt++){const gt=new Date(oe);gt.setDate(oe.getDate()+lt),wr[Sr(gt)]={date:new Date(gt),isis:0,total:0}}(Dt||[]).forEach(lt=>{const gt=Sr(lt.inicio);wr[gt]&&(wr[gt].total+=1)}),(Lt||[]).forEach(lt=>{const gt=lt.inicio||lt.criado_em,or=Sr(gt);wr[or]&&(wr[or].isis+=1)});const he=Object.values(wr),{data:ot}=await Q.from("agendamentos").select("quadra_id").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("inicio",ae.toISOString()).lte("inicio",G.toISOString()),Vt=new Map;(ot||[]).forEach(lt=>{lt?.quadra_id&&Vt.set(lt.quadra_id,(Vt.get(lt.quadra_id)||0)+1)});const qt=Array.from(Vt.keys());let Re={};if(qt.length>0){const{data:lt}=await Q.from("quadras").select("id, nome").in("id",qt);(lt||[]).forEach(gt=>{Re[gt.id]=gt.nome})}const Ct=Array.from(Vt.entries()).map(([lt,gt])=>({id:lt,nome:Re[lt]||"Quadra",count:gt})).sort((lt,gt)=>gt.count-lt.count).slice(0,5),{data:Wt}=await Q.from("agendamentos").select("modalidade").eq("codigo_empresa",r).eq("created_by_isis",!0).gte("inicio",ae.toISOString()).lte("inicio",G.toISOString()),Er=new Map;(Wt||[]).forEach(lt=>{const gt=(lt?.modalidade||"").trim();gt&&Er.set(gt,(Er.get(gt)||0)+1)});const Me=Array.from(Er.entries()).map(([lt,gt])=>({nome:lt,count:gt})).sort((lt,gt)=>gt.count-lt.count).slice(0,5);if(!Y)return;k(lt=>({...lt,agendamentosIsisTotal:ut||0,agendamentosIsisHoje:bt||0,agendamentosIsis7d:wt,agendamentosTotal7d:Gt,cancelamentosIsis7d:ge||0,perDay7d:he,topQuadras30d:Ct,topModalidades30d:Me})),s(!1)}catch(W){if(!Y)return;i(W?.message||"Erro ao carregar mtricas"),s(!1)}})(),()=>{Y=!1}},[r,e?.nome_fantasia,e?.razao_social]),p.useEffect(()=>{let Y=!0;return(async()=>{if(r)try{c(!0),u(null);const W=wr=>{const he=new Date(wr);return he.setHours(0,0,0,0),he},se=wr=>{const he=new Date(wr);return he.setHours(23,59,59,999),he},G=z(new Date),te=new Date;te.setDate(te.getDate()-6);const oe=z(te),De=f||oe,re=m||G;let ae=Q.from("agendamentos").select("id, codigo, inicio, fim, criado_em, status, cliente_id, clientes, quadra_id").eq("codigo_empresa",r).eq("created_by_isis",!0).order("criado_em",{ascending:!1}).order("inicio",{ascending:!1});const ut=!!(De||re),pt=De?W(F(De)).toISOString():null,ft=re?se(F(re)).toISOString():null;if(pt||ft){const wr=[],he=[];pt&&he.push(`criado_em.gte.${pt}`),ft&&he.push(`criado_em.lte.${ft}`),he.length>0&&wr.push(`and(${he.join(",")})`);const ot=["criado_em.is.null"];pt&&ot.push(`inicio.gte.${pt}`),ft&&ot.push(`inicio.lte.${ft}`),wr.push(`and(${ot.join(",")})`),ae=ae.or(wr.join(","))}ae=ae.limit(ut?200:10);try{console.log("[IsisAnalytics] Fetch lastAgs with range (effective):",{effStart:De,effEnd:re,hasAnyFilter:ut,limit:ut?200:10})}catch{}const{data:bt,error:Lt}=await ae;if(Lt){try{console.error("[IsisAnalytics] lastAgs query error:",Lt)}catch{}throw Lt}try{console.log("[IsisAnalytics] lastAgs length:",(bt||[]).length)}catch{}const Dt=Array.from(new Set((bt||[]).map(wr=>wr.cliente_id).filter(Boolean)));let Bt={};if(Dt.length>0){const{data:wr}=await Q.from("clientes").select("id, nome").in("id",Dt);(wr||[]).forEach(he=>{Bt[he.id]=he.nome})}const ge=Array.from(new Set((bt||[]).map(wr=>wr.quadra_id).filter(Boolean)));let wt={};if(ge.length>0){const{data:wr}=await Q.from("quadras").select("id, nome").in("id",ge);(wr||[]).forEach(he=>{wt[he.id]=he.nome})}const Gt=(bt||[]).map(wr=>wr.id);let Sr={};if(Gt.length>0){const{data:wr}=await Q.from("agendamento_participantes").select("agendamento_id, nome, status_pagamento, valor_cota").in("agendamento_id",Gt).order("agendamento_id",{ascending:!0});(wr||[]).forEach(he=>{Sr[he.agendamento_id]||(Sr[he.agendamento_id]=[]),Sr[he.agendamento_id].push(he)})}if(!Y)return;B({}),k(wr=>({...wr,ultimasInteracoes:(bt||[]).map(he=>({...he,cliente_nome:Bt[he.cliente_id]||null,participantes:Sr[he.id]||[],quadra_nome:wt[he.quadra_id]||null}))})),c(!1)}catch(W){if(!Y)return;u(W?.message||"Erro ao carregar agendamentos"),c(!1)}})(),()=>{Y=!1}},[r,f,m]);const ie=p.useMemo(()=>e?.nome_fantasia||e?.razao_social||"sua arena",[e]);return a.jsxs(Fr.div,{variants:be,initial:"hidden",animate:"visible",className:"space-y-4",children:[a.jsxs(Fr.div,{variants:U,className:"bg-surface/70 backdrop-blur-sm relative p-4 md:p-6 rounded-xl border border-white/10 overflow-hidden shadow-1",children:[a.jsx("div",{className:"absolute inset-0 bg-court-pattern opacity-[0.03] mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsx("div",{className:"rounded-full p-[2px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_12px_rgba(168,85,247,0.35)] flex-shrink-0",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-10 h-10 sm:w-12 sm:h-12 grid place-items-center",children:a.jsx(dl,{size:"xs",className:"w-10 h-10 sm:w-12 sm:h-12"})})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("h1",{className:"text-xl sm:text-2xl font-black text-text-primary tracking-tight flex items-center gap-2 flex-wrap",children:[a.jsx(C2,{className:"h-5 w-5 sm:h-6 sm:w-6 text-brand flex-shrink-0"}),a.jsx("span",{className:"truncate",children:"Anlises da sis"})]}),a.jsxs("p",{className:"text-xs sm:text-sm text-text-secondary mt-1 line-clamp-2",children:["Como a sis est ajudando ",ie," a converter conversas em reservas."]})]})]}),a.jsx("button",{type:"button",onClick:()=>v(!0),className:"inline-flex items-center justify-center w-10 h-10 sm:w-11 sm:h-11 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-text-secondary hover:text-text-primary flex-shrink-0 self-end sm:self-auto",title:"Configuraes da sis",children:a.jsx(Wc,{className:"h-5 w-5"})})]})]}),n?a.jsxs(Fr.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-20 gap-4",children:[a.jsx("div",{className:"relative",children:a.jsx("div",{className:"rounded-full p-[3px] bg-gradient-to-r from-fuchsia-500 via-violet-500 to-emerald-400 shadow-[0_0_20px_rgba(168,85,247,0.4)] animate-pulse",children:a.jsx("div",{className:"rounded-full overflow-hidden bg-background w-20 h-20 grid place-items-center",children:a.jsx(dl,{size:"sm",className:"w-20 h-20"})})})}),a.jsxs("div",{className:"flex items-center gap-2 text-text-muted",children:[a.jsx(cl,{className:"h-5 w-5 animate-spin"}),a.jsx("span",{className:"text-sm font-medium",children:"Carregando anlises da sis..."})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4 w-full max-w-md",children:[a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-24 bg-white/5 rounded-lg animate-pulse"})]})]}):o?a.jsx("div",{className:"text-danger text-sm",children:o}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(L,{icon:zC,title:"Agendamentos feitos (hoje)",value:T.agendamentosIsisHoje,color:"success"}),a.jsx(L,{icon:Lm,title:"Agendamentos feitos (7 dias)",value:T.agendamentosIsis7d,color:"info"}),a.jsx(L,{icon:Og,title:"Cancelamentos",value:T.cancelamentosIsis7d,color:"danger"})]}),a.jsxs(Fr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("h2",{className:"text-base font-bold text-text-primary flex items-center",children:[a.jsx(Lm,{className:"mr-2 h-5 w-5 text-brand"}),"Distribuio  ltimos 7 dias"]})}),a.jsx("div",{className:"px-1 pb-2",children:a.jsx(Gb,{width:"100%",height:220,children:a.jsxs(Vee,{data:H,margin:{top:8,right:12,left:0,bottom:0},children:[a.jsx(BS,{strokeDasharray:"3 3",stroke:"var(--border)",opacity:.5}),a.jsx(bp,{dataKey:"name",tick:{fontSize:11,fill:"var(--text-muted)"},tickLine:!1,axisLine:{stroke:"var(--border)"}}),a.jsx(wp,{allowDecimals:!1,tick:{fontSize:11,fill:"var(--text-muted)"},tickLine:!1,axisLine:{stroke:"var(--border)"},width:28}),a.jsx(Dc,{cursor:{stroke:"var(--border)",strokeDasharray:"3 3"},contentStyle:{background:"rgba(10,10,10,0.85)",borderColor:"var(--border)",color:"var(--text-primary)",borderRadius:"8px"},formatter:Y=>[Y,"sis (feitos)"]}),a.jsx(jy,{type:"monotone",dataKey:"isis",name:"sis (feitos)",stroke:"var(--brand)",strokeWidth:2.2,dot:{r:3,strokeWidth:1.5,stroke:"var(--brand)",fill:"var(--background)"},activeDot:{r:5}})]})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs(Fr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h2",{className:"text-base font-bold text-text-primary",children:"Top quadras  ltimos 30 dias (sis)"})}),T.topQuadras30d.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum agendamento nos ltimos 30 dias."}):a.jsx("ul",{className:"divide-y divide-border",children:T.topQuadras30d.map(Y=>a.jsxs("li",{className:"py-2 text-sm flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:Y.nome}),a.jsx("span",{className:"text-text-muted",children:Y.count})]},Y.id))})]}),a.jsxs(Fr.div,{variants:U,className:"fx-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("h2",{className:"text-base font-bold text-text-primary",children:"Top modalidades  ltimos 30 dias (sis)"})}),!T.topModalidades30d||T.topModalidades30d.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados recentes."}):a.jsx("ul",{className:"divide-y divide-border",children:T.topModalidades30d.map((Y,W)=>a.jsxs("li",{className:"py-2 text-sm flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:Y.nome}),a.jsx("span",{className:"text-text-muted",children:Y.count})]},`${Y.nome}-${W}`))})]})]})]}),!n&&a.jsxs(Fr.div,{variants:U,className:"fx-card",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h2",{className:"text-sm sm:text-base font-bold text-text-primary",children:"ltimos agendamentos criados pela sis"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary",title:"Data incio (criado em)",children:[a.jsx(Io,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{children:f?V(F(f)):"Incio"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(f)||void 0,onSelect:Y=>h(Y?z(Y):""),locale:$a,initialFocus:!0})})]}),a.jsx("span",{className:"text-xs text-text-secondary select-none",children:"at"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary",title:"Data fim (criado em)",children:[a.jsx(Io,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{children:m?V(F(m)):"Fim"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(m)||void 0,onSelect:Y=>x(Y?z(Y):""),locale:$a,initialFocus:!0})})]})]}),null]})]}),a.jsxs("div",{className:"sm:hidden mb-3 rounded-lg border border-white/10 bg-white/5 p-2",children:[a.jsxs("div",{className:"grid [grid-template-columns:1fr_auto_1fr] gap-2 mb-2",children:[a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"w-full h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary justify-between",title:"Data incio (criado em)",children:[a.jsx(Io,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{className:"truncate",children:f?V(F(f)):"Incio"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(f)||void 0,onSelect:Y=>h(Y?z(Y):""),locale:$a,initialFocus:!0})})]}),a.jsx("div",{className:"flex items-center justify-center text-xs text-text-secondary select-none",children:"at"}),a.jsxs(Qo,{children:[a.jsx(Zo,{asChild:!0,children:a.jsxs(Z,{type:"button",variant:"ghost",className:"w-full h-9 px-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200 text-xs font-semibold text-text-primary justify-between",title:"Data fim (criado em)",children:[a.jsx(Io,{className:"h-4 w-4 text-text-secondary"}),a.jsx("span",{className:"truncate",children:m?V(F(m)):"Fim"})]})}),a.jsx(Go,{className:"w-auto p-0",children:a.jsx(ei,{mode:"single",selected:F(m)||void 0,onSelect:Y=>x(Y?z(Y):""),locale:$a,initialFocus:!0})})]})]}),null]}),l?a.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm py-6",children:[a.jsx(cl,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Carregando agendamentos..."})]}):d?a.jsx("div",{className:"text-danger text-sm",children:d}):T.ultimasInteracoes.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhum agendamento recente."}):a.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:a.jsx("div",{className:"inline-block min-w-full align-middle",children:a.jsx("div",{className:"overflow-hidden",children:a.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-text-secondary border-b border-white/10",children:[a.jsx("th",{className:"w-8 py-2 pl-4 sm:pl-0"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Cdigo"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Cliente"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden sm:table-cell",children:"Quadra"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Data"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden md:table-cell",children:"Horrio"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap",children:"Status"}),a.jsx("th",{className:"text-left py-2 pr-2 whitespace-nowrap hidden lg:table-cell",children:"Participantes"}),a.jsx("th",{className:"text-left py-2 pr-4 sm:pr-2 whitespace-nowrap hidden xl:table-cell",children:"Criado em"})]})}),a.jsx("tbody",{children:T.ultimasInteracoes.map(Y=>{const W=Y.inicio?new Date(Y.inicio):null,se=Y.fim?new Date(Y.fim):null,pe=W?W.toLocaleDateString():"-",G=W&&se?`${W.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${se.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:"-",te=Array.isArray(Y.participantes)?Y.participantes.length:Array.isArray(Y.clientes)?Y.clientes.length:0,oe=!!q[Y.id],De=()=>B(pt=>({...pt,[Y.id]:!pt[Y.id]})),re=String(Y.status||"").toLowerCase(),ut={scheduled:{label:"Agendado",cls:"bg-info/15 text-info border border-info/20"},confirmed:{label:"Confirmado",cls:"bg-success/15 text-success border border-success/20"},in_progress:{label:"Em andamento",cls:"bg-brand/15 text-brand border border-brand/20"},finished:{label:"Finalizado",cls:"bg-success/15 text-success border border-success/20"},canceled:{label:"Cancelado",cls:"bg-danger/15 text-danger border border-danger/20"},no_show:{label:"No-show",cls:"bg-warning/15 text-warning border border-warning/20"}}[re]||{label:Y.status||"",cls:"bg-white/10 text-text-secondary border border-white/15"};return a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:`border-b border-white/10 align-top ${oe?"bg-white/[0.03]":"hover:bg-white/[0.02]"} transition-colors`,children:[a.jsx("td",{className:"py-2 pl-4 sm:pl-0",children:a.jsx("button",{type:"button","aria-label":oe?"Recolher":"Expandir",onClick:pt=>{pt.stopPropagation(),De()},className:`inline-flex items-center justify-center w-6 h-6 rounded-md border border-white/10 hover:bg-white/5 transition-colors ${oe?"rotate-180":""}`,children:a.jsx(hx,{className:"w-3 h-3 sm:w-4 sm:h-4 text-text-secondary"})})}),a.jsxs("td",{className:"py-2 pr-2 font-semibold text-text-primary whitespace-nowrap",children:["#",Y.codigo]}),a.jsx("td",{className:"py-2 pr-2 max-w-[120px] truncate",children:Y.cliente_nome||Array.isArray(Y.clientes)&&Y.clientes[0]||""}),a.jsx("td",{className:"py-2 pr-2 hidden sm:table-cell max-w-[100px] truncate",children:Y.quadra_nome||""}),a.jsx("td",{className:"py-2 pr-2 whitespace-nowrap",children:pe}),a.jsx("td",{className:"py-2 pr-2 hidden md:table-cell whitespace-nowrap text-xs",children:G}),a.jsx("td",{className:"py-2 pr-2",children:a.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-[11px] font-bold tracking-wide whitespace-nowrap ${ut.cls}`,children:ut.label})}),a.jsx("td",{className:"py-2 pr-2 hidden lg:table-cell",children:a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-white/10 text-text-primary text-xs font-semibold",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-brand/70"}),te]})}),a.jsx("td",{className:"py-2 pr-4 sm:pr-2 hidden xl:table-cell text-xs whitespace-nowrap",children:Y.criado_em?new Date(Y.criado_em).toLocaleString():"-"})]},Y.id),oe&&a.jsx("tr",{children:a.jsxs("td",{colSpan:9,className:"p-3 sm:p-4 bg-white/[0.035] border-b border-white/10",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Criado em"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:Y.criado_em?new Date(Y.criado_em).toLocaleString():"-"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Incio"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:Y.inicio?new Date(Y.inicio).toLocaleString():"-"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted",children:"Trmino"}),a.jsx("div",{className:"font-medium text-text-primary text-xs sm:text-sm",children:Y.fim?new Date(Y.fim).toLocaleString():"-"})]})]}),a.jsxs("div",{className:"sm:hidden mb-3 grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted",children:"Quadra"}),a.jsx("div",{className:"font-medium text-text-primary text-xs truncate",children:Y.quadra_nome||""})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-text-muted",children:"Horrio"}),a.jsx("div",{className:"font-medium text-text-primary text-xs",children:G})]})]}),a.jsxs("div",{className:"text-[10px] sm:text-[11px] uppercase tracking-wider text-text-muted mb-2",children:["Participantes (",te,")"]}),Array.isArray(Y.participantes)&&Y.participantes.length>0?a.jsx("ul",{className:"grid grid-cols-1 gap-1.5",children:Y.participantes.map((pt,ft)=>a.jsxs("li",{className:"flex items-center justify-between py-1.5 px-2 sm:px-3 rounded-md border border-white/10 bg-white/5 gap-2",children:[a.jsx("span",{className:"text-text-primary font-medium text-xs sm:text-sm truncate flex-1",children:pt.nome}),a.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-[11px] font-bold tracking-wide whitespace-nowrap flex-shrink-0 ${pt.status_pagamento==="Pago"?"bg-success/15 text-success border border-success/20":"bg-warning/15 text-warning border border-warning/20"}`,children:pt.status_pagamento})]},ft))}):a.jsx("div",{className:"text-text-muted text-xs sm:text-sm",children:"Sem participantes cadastrados"})]})})]})})})]})})})})]}),g&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:()=>v(!1),children:a.jsxs(Fr.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-surface border border-white/10 rounded-xl shadow-2xl w-full max-w-lg p-6 space-y-4",onClick:Y=>Y.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-xl font-bold text-text-primary flex items-center gap-2",children:[a.jsx(Wc,{className:"h-5 w-5 text-brand"})," Configuraes da sis"]}),a.jsx("button",{type:"button",onClick:()=>v(!1),className:"inline-flex items-center justify-center w-8 h-8 rounded-lg hover:bg-white/10 transition-colors text-text-secondary hover:text-text-primary",children:a.jsx(Og,{className:"h-5 w-5"})})]}),y?a.jsxs("div",{className:"flex items-center gap-2 text-text-muted py-8 justify-center",children:[a.jsx(cl,{className:"h-5 w-5 animate-spin"})," Carregando..."]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Cancelamento (horas antes)"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Tempo mnimo (em horas) antes do agendamento para permitir cancelamento via sis."}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"number",min:"0",step:"1",value:_,onChange:Y=>C(Y.target.value),placeholder:"Ex: 2",className:"w-24 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary text-center placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("span",{className:"text-sm text-text-muted",children:"horas"})]}),a.jsx("p",{className:"text-xs text-text-muted italic",children:"Deixe vazio para permitir cancelamento a qualquer momento."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Nome de exibio"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Nome que aparecer no header da pgina de agendamento da sis."}),a.jsx("input",{type:"text",value:A,onChange:Y=>M(Y.target.value),placeholder:"Arena Palace",className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("p",{className:"text-xs text-text-muted italic",children:"Este  o nome que seus clientes vero ao acessar a sis."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Link de agendamento"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Personalize o subdomnio do link de agendamento da sis."}),O?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:E,onChange:Y=>S(Y.target.value.toLowerCase().replace(/[^a-z0-9]+/g,"")),placeholder:"arenapalace",autoFocus:!0,className:"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-brand/50 focus:border-brand transition-all"}),a.jsx("span",{className:"text-sm text-text-muted",children:".f7arena.com"})]}):a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 border border-white/10 rounded-lg group hover:border-white/20 transition-all cursor-pointer",onClick:()=>I(!0),children:[a.jsxs("span",{className:"flex-1 text-text-primary font-mono",children:[E||"arenapalace",".f7arena.com"]}),a.jsx("button",{type:"button",className:"inline-flex items-center justify-center w-7 h-7 rounded-md hover:bg-white/10 transition-colors text-text-muted group-hover:text-text-primary",title:"Editar subdomnio",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),a.jsx("path",{d:"m15 5 4 4"})]})})]})]}),a.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{v(!1),I(!1)},disabled:w,className:"flex-1 px-4 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors text-text-secondary hover:text-text-primary font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),a.jsx("button",{type:"button",onClick:me,disabled:w,className:"flex-1 px-4 py-2 rounded-lg bg-brand hover:bg-brand/90 transition-colors text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:w?a.jsxs(a.Fragment,{children:[a.jsx(cl,{className:"h-4 w-4 animate-spin"})," Salvando..."]}):"Salvar"})]})]})]})})]})}function ult({open:e,onOpenChange:t,codigoEmpresa:r,onSuccess:n}){const{toast:s}=Zs(),[o,i]=p.useState("upload"),[l,c]=p.useState(null),[d,u]=p.useState(null),[f,h]=p.useState(!1),[m,x]=p.useState({success:!1,comandaId:null,error:null}),g=async j=>{const _=j.target.files?.[0];if(_){if(!_.name.endsWith(".xml")){s({title:"Arquivo invlido",description:"Selecione um arquivo XML vlido.",variant:"destructive"});return}c(_);try{const C=await _.text(),E=gC(C);if(!E.success){s({title:"Erro ao ler XML",description:E.error||"XML invlido",variant:"destructive"});return}if(!E.produtos||E.produtos.length===0){s({title:"Nenhum produto encontrado",description:"O XML no contm produtos.",variant:"warning"});return}if(E.nfe?.tipo!=="Sada"){s({title:"Tipo de nota incorreto",description:"Este XML  de entrada. Use a importao em Produtos para notas de entrada.",variant:"warning"});return}u(E),i("preview")}catch(C){console.error("[XMLSalesImport] Erro ao processar arquivo:",C),s({title:"Erro ao processar XML",description:C.message,variant:"destructive"})}}},v=async()=>{i("processing"),h(!0);try{const j=await uf({searchTerm:"",limit:1e4,codigoEmpresa:r}),_=d.nfe?.dataEmissao?new Date(d.nfe.dataEmissao):new Date,C=d.nfe?.chaveAcesso||"",{data:E,error:S}=await Q.from("comandas").insert({codigo_empresa:r,mesa_id:null,status:"closed",aberto_em:_.toISOString(),fechado_em:_.toISOString(),observacao:`Importado de XML - NF-e ${d.nfe?.numero||""}${C?`
Chave: ${C}`:""}`,origem:"xml",xml_chave:C||null}).select().single();if(S)throw S;const A=[],M=[];for(const I of d.produtos){const T=xC(I,j);if(T){A.push({comanda_id:E.id,produto_id:T.id,descricao:I.nome,quantidade:I.quantidade,preco_unitario:I.valorUnitario,desconto:I.desconto||0,codigo_empresa:r});const k=Math.max(0,(T.stock||T.estoque||0)-I.quantidade);await Q.from("produtos").update({estoque:k}).eq("id",T.id).eq("codigo_empresa",r)}else M.push(I.nome)}if(A.length>0){const{error:I}=await Q.from("comanda_itens").insert(A);if(I)throw I}const O=d.pagamentos||[];if(O.length>0){const{data:I}=await Q.from("finalizadoras").select("id, codigo_sefaz, nome").eq("codigo_empresa",r).eq("ativo",!0),T=new Map((I||[]).map(B=>[B.codigo_sefaz,B])),k=O.map(B=>{const z=T.get(B.codigoSefaz);return{comanda_id:E.id,finalizadora_id:z?.id||null,metodo:B.descricao.toLowerCase(),valor:B.valor,status:"Pago",recebido_em:_.toISOString(),codigo_empresa:r,origem:"xml",xml_chave:C||null}}),{error:q}=await Q.from("pagamentos").insert(k);if(q)throw q}else{const I=d.produtos.reduce((k,q)=>k+(q.valorTotal||0),0),{error:T}=await Q.from("pagamentos").insert({comanda_id:E.id,finalizadora_id:null,metodo:"outros",valor:I,status:"Pago",recebido_em:_.toISOString(),codigo_empresa:r,origem:"xml",xml_chave:C||null});if(T)throw T}console.log("[XMLSalesImport] Venda importada com sucesso. Comanda ID:",E.id),M.length>0?s({title:"Venda importada com avisos",description:`${A.length} produto(s) registrado(s), ${M.length} no encontrado(s).`,variant:"warning",duration:5e3}):s({title:"Venda importada com sucesso!",description:`${A.length} produto(s) registrado(s). Total: R$ ${w.toFixed(2)}`,variant:"success"}),x({success:!0,comandaId:E.id,error:null,produtosNaoEncontrados:M,totalItens:A.length,totalVenda:w,dataEmissao:_.toISOString().slice(0,10)}),i("done"),n&&n(_.toISOString().slice(0,10))}catch(j){console.error("[XMLSalesImport] Erro ao importar:",j),x({success:!1,comandaId:null,error:j.message}),i("done"),s({title:"Erro ao importar XML",description:j.message,variant:"destructive"})}finally{h(!1)}},y=()=>{i("upload"),c(null),u(null),x({success:!1,comandaId:null,error:null}),t(!1)},b=()=>{i("upload"),c(null),u(null)},w=d?.produtos?.reduce((j,_)=>j+(_.valorTotal||0),0)||0;return a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"max-w-3xl max-h-[90vh] flex flex-col overflow-hidden",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-2xl font-bold",children:"Importar XML de Venda (NF-e)"}),a.jsxs(ma,{children:[o==="upload"&&"Selecione o arquivo XML da nota fiscal de sada",o==="preview"&&"Revise os dados da venda que ser importada",o==="processing"&&"Processando venda...",o==="done"&&"Importao finalizada"]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto px-1",children:[o==="upload"&&a.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:a.jsxs("div",{className:"w-full max-w-md",children:[a.jsxs("label",{htmlFor:"xml-sales-upload",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-border rounded-lg cursor-pointer bg-surface hover:bg-surface-2 transition-colors",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(tD,{className:"w-12 h-12 mb-4 text-text-muted"}),a.jsx("p",{className:"mb-2 text-sm text-text-primary font-semibold",children:"Clique para selecionar ou arraste o arquivo"}),a.jsx("p",{className:"text-xs text-text-muted",children:"XML de NF-e de Sada (Venda)"})]}),a.jsx("input",{id:"xml-sales-upload",type:"file",accept:".xml",className:"hidden",onChange:g})]}),l&&a.jsxs("div",{className:"mt-4 p-3 bg-surface-2 rounded-lg flex items-center gap-2",children:[a.jsx(il,{className:"w-5 h-5 text-success"}),a.jsx("span",{className:"text-sm text-text-primary",children:l.name})]})]})}),o==="preview"&&a.jsxs("div",{className:"space-y-4",children:[d?.nfe&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Informaes da NF-e"}),d.fornecedor&&a.jsxs("div",{className:"mb-3 pb-3 border-b border-border",children:[a.jsx("div",{className:"text-sm font-semibold text-text-primary mb-1",children:d.fornecedor.razaoSocial||d.fornecedor.nomeFantasia||"Fornecedor"}),a.jsxs("div",{className:"text-xs text-text-muted",children:[d.fornecedor.cnpj&&`CNPJ: ${d.fornecedor.cnpj}`,d.fornecedor.endereco?.cidade&&d.fornecedor.endereco?.uf&&`  ${d.fornecedor.endereco.cidade}/${d.fornecedor.endereco.uf}`]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Nmero:"})," ",a.jsx("span",{className:"font-mono",children:d.nfe.numero})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Srie:"})," ",a.jsx("span",{className:"font-mono",children:d.nfe.serie})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Tipo:"})," ",a.jsx("span",{className:"text-warning font-semibold",children:d.nfe.tipo})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-text-muted",children:"Data:"})," ",a.jsx("span",{children:new Date(d.nfe.dataEmissao).toLocaleDateString("pt-BR")})]})]}),d.nfe.naturezaOperacao&&a.jsxs("div",{className:"mb-2 text-sm",children:[a.jsx("span",{className:"text-text-muted",children:"Natureza:"})," ",a.jsx("span",{className:"font-medium",children:d.nfe.naturezaOperacao})]}),d.nfe.totalNota!==void 0&&a.jsxs("div",{className:"mb-3 text-sm",children:[a.jsx("span",{className:"text-text-muted",children:"Total da Nota:"})," ",a.jsxs("span",{className:"font-mono font-semibold text-lg text-success",children:["R$ ",d.nfe.totalNota.toFixed(2)]})]}),d.nfe.chaveAcesso&&a.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[a.jsx("span",{className:"text-text-muted text-xs",children:"Chave de Acesso:"}),a.jsx("p",{className:"font-mono text-xs break-all",children:d.nfe.chaveAcesso})]})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("h3",{className:"font-semibold mb-3",children:["Produtos da Venda (",d.produtos.length,")"]}),a.jsx("div",{className:"space-y-2",children:d.produtos.map((j,_)=>a.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface flex items-start gap-3",children:[a.jsx(Y1,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold text-sm truncate",children:j.nome}),a.jsxs("p",{className:"text-xs text-text-muted",children:[j.codigo&&`Cdigo: ${j.codigo}  `,"Qtd: ",j.quantidade," ",j.unidade]})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsxs("p",{className:"text-sm font-semibold",children:["R$ ",j.valorTotal.toFixed(2)]}),a.jsxs("p",{className:"text-xs text-text-muted",children:["Unit: R$ ",j.valorUnitario.toFixed(2)]})]})]})})]},_))})]}),d.pagamentos&&d.pagamentos.length>0&&a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsxs("h3",{className:"font-semibold mb-3",children:["Formas de Pagamento (",d.pagamentos.length,")"]}),a.jsx("div",{className:"space-y-2",children:d.pagamentos.map((j,_)=>a.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-sm",children:j.descricao}),a.jsxs("p",{className:"text-xs text-text-muted",children:["Cdigo SEFAZ: ",j.codigoSefaz]})]}),a.jsxs("p",{className:"text-sm font-semibold",children:["R$ ",j.valor.toFixed(2)]})]},_))})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pd,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-sm mb-1",children:"Ateno: Venda Externa"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Esta venda ser registrada no histrico como uma venda externa (importada de XML). O estoque dos produtos ser subtrado automaticamente."})]})]})}),a.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[a.jsx("span",{children:"Total da Venda:"}),a.jsxs("span",{className:"text-success",children:["R$ ",w.toFixed(2)]})]})]}),o==="processing"&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx(cl,{className:"w-12 h-12 animate-spin text-warning mb-4"}),a.jsx("p",{className:"text-lg font-semibold",children:"Processando venda..."}),a.jsx("p",{className:"text-sm text-text-muted",children:"Criando comanda e atualizando estoque"})]}),o==="done"&&a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"bg-surface-2 rounded-lg p-6 border border-border text-center",children:m.success?a.jsxs(a.Fragment,{children:[a.jsx(Di,{className:"w-16 h-16 text-success mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Venda Importada com Sucesso!"}),a.jsx("p",{className:"text-sm text-text-muted mb-4",children:"A venda foi registrada no histrico"}),m.produtosNaoEncontrados&&m.produtosNaoEncontrados.length>0&&a.jsxs("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-3 text-left",children:[a.jsx("p",{className:"text-sm font-semibold mb-2",children:" Produtos no encontrados:"}),a.jsx("ul",{className:"text-xs text-text-muted space-y-1",children:m.produtosNaoEncontrados.map((j,_)=>a.jsxs("li",{children:[" ",j]},_))})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(Pd,{className:"w-16 h-16 text-danger mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Erro na Importao"}),a.jsx("p",{className:"text-sm text-text-muted",children:m.error||"Ocorreu um erro ao importar a venda"})]})})})]}),a.jsxs(Ga,{children:[o==="upload"&&a.jsx(Z,{variant:"outline",onClick:y,children:"Cancelar"}),o==="preview"&&a.jsxs(a.Fragment,{children:[a.jsx(Z,{variant:"outline",onClick:b,children:"Voltar"}),a.jsx(Z,{onClick:v,children:"Confirmar Importao"})]}),o==="done"&&a.jsx(Z,{onClick:y,children:"Fechar"})]})]})})}const flt={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},pb={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};function mlt(e,t=300){const[r,n]=p.useState(e);return p.useEffect(()=>{const s=setTimeout(()=>n(e),t);return()=>clearTimeout(s)},[e,t]),r}function u2({value:e,onChange:t}){const[r,n]=p.useState(!1),s=p.useRef(null),o=p.useRef(null),i=p.useRef(null),[l,c]=p.useState({top:0,left:0,width:0,center:!1,mode:"fixed"});p.useEffect(()=>{function g(b){const w=b.target,j=s.current&&s.current.contains(w),_=i.current&&i.current.contains(w);!j&&!_&&n(!1)}function v(b){b.key==="Escape"&&n(!1)}function y(){r&&d()}return window.addEventListener("mousedown",g),window.addEventListener("keydown",v),window.addEventListener("scroll",y,!0),window.addEventListener("resize",y),()=>{window.removeEventListener("mousedown",g),window.removeEventListener("keydown",v),window.removeEventListener("scroll",y,!0),window.removeEventListener("resize",y)}},[r]),p.useEffect(()=>{if(r){const g=requestAnimationFrame(()=>{d();const v=requestAnimationFrame(()=>d());return()=>cancelAnimationFrame(v)});return()=>cancelAnimationFrame(g)}},[r]),p.useEffect(()=>{if(r&&l.mode==="overlay"){const g=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=g}}},[r,l.mode]);const d=()=>{try{const g=o.current;if(!g)return;const v=g.getBoundingClientRect(),y=window.innerWidth,b=window.innerHeight,w=8,j=Math.max(v.width,280),_=Math.min(y-w*2,360),C=Math.min(j,_);let E=320;if(i.current)try{E=i.current.getBoundingClientRect().height||E}catch{}if(y<=640){c({top:0,left:0,width:Math.min(y-w*2,360),center:!0,mode:"overlay"});return}const S=s.current,A=S?S.getBoundingClientRect():v,M=v.bottom-A.top+6,O=Math.max(v.width,280);c({top:M,left:0,width:O,center:!1,mode:"anchor"})}catch{}},u=g=>{try{const[v,y,b]=String(g||"").split("-").map(Number);return!v||!y||!b?null:new Date(v,y-1,b)}catch{return null}},f=g=>{const v=y=>String(y).padStart(2,"0");return`${g.getFullYear()}-${v(g.getMonth()+1)}-${v(g.getDate())}`},h=g=>{const v=y=>String(y).padStart(2,"0");return`${v(g.getDate())}/${v(g.getMonth()+1)}/${g.getFullYear()}`},m=u(e),x=m?h(m):"";return a.jsxs("div",{className:"relative",ref:s,children:[a.jsx("button",{type:"button",className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-warning/10 focus:outline-none",onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(g=>!g),setTimeout(d,0)},"aria-label":"Abrir calendrio",children:a.jsx(Rue,{className:"h-4 w-4 text-warning"})}),typeof window<"u"&&window.innerWidth<=640?a.jsx("button",{type:"button",ref:o,onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(!0),setTimeout(d,0)},className:"pl-9 pr-3 h-10 w-full text-left bg-surface text-text-primary border border-warning/40 rounded-md",children:x||"Selecionar data"}):a.jsx(It,{type:"text",readOnly:!0,ref:o,inputMode:"none",onMouseDown:g=>{g.preventDefault()},onClick:()=>{n(g=>!g),setTimeout(d,0)},className:"pl-9 pr-3 w-full bg-surface text-text-primary border border-warning/40 focus-visible:ring-warning focus-visible:border-warning",value:x}),r&&(l.mode==="overlay"?a.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",onClick:g=>{g.target===g.currentTarget&&n(!1)},children:a.jsx("div",{ref:i,className:"bg-black text-white border border-warning/40 rounded-md shadow-xl p-2 w-[92vw] max-w-[360px]",children:a.jsx(ei,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})})}):l.mode==="anchor"?a.jsx("div",{ref:i,className:"absolute z-[999] bg-black text-white border border-warning/40 rounded-md shadow-xl p-2 left-0",style:{top:`${l.top}px`,minWidth:`${l.width}px`,maxWidth:"92vw"},children:a.jsx(ei,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}):a.jsx("div",{ref:i,className:"fixed z-[999] bg-black text-white border border-warning/40 rounded-md shadow-xl p-2",style:{top:`${l.top}px`,left:`${l.left}px`,width:`${l.width}px`,maxWidth:"92vw"},children:a.jsx(ei,{mode:"single",selected:m||void 0,onSelect:g=>{g&&(t(f(g)),n(!1))},showOutsideDays:!0,className:"",classNames:{caption_label:"text-sm font-medium text-white",head_cell:"text-xs text-warning/80 w-9",day:"h-9 w-9 p-0 font-normal text-white hover:bg-warning/10 rounded-md",day_selected:"bg-warning text-black hover:bg-warning focus:bg-warning",day_today:"border border-warning text-white",day_outside:"text-white/30",nav_button:"h-7 w-7 p-0 text-white hover:bg-warning/10 rounded-md",table:"w-full"}})}))]})}function hlt(){const{toast:e}=Zs(),t=Il(),{userProfile:r}=lo(),[n]=qC(),s=n.get("mesa"),[o,i]=p.useState(!1),[l,c]=p.useState([]),[d,u]=p.useState(()=>s?"":new Date().toISOString().slice(0,10)),[f,h]=p.useState(()=>s?"":new Date().toISOString().slice(0,10)),[m,x]=p.useState(()=>s?"all":"closed"),[g,v]=p.useState(""),y=mlt(g,350),[b,w]=p.useState("all"),[j,_]=p.useState("comandas"),[C,E]=p.useState(!1),[S,A]=p.useState(""),[M,O]=p.useState(null),[I,T]=p.useState({loading:!1,itens:[],pagamentos:[]}),[k,q]=p.useState(null),[B,z]=p.useState({open:!1,loading:!1,resumo:null,periodo:{from:null,to:null},movs:[]}),[F,V]=p.useState(!1),[me,be]=p.useState(!1),[U,L]=p.useState(null),[H,ie]=p.useState([]),Y=async Me=>{try{be(!0);const lt=wt();if(!lt)throw new Error("Empresa no detectada");const{payload:gt,missing:or}=await lg({comandaId:Me,codigoEmpresa:lt});L(gt),ie(or||[]),V(!0)}catch(lt){e({title:"Falha ao gerar prvia",description:lt?.message||"Tente novamente",variant:"destructive"})}finally{be(!1)}},[W,se]=p.useState(!1),[pe,G]=p.useState(!1),[te,oe]=p.useState(!1),De=async()=>{try{e({title:"Gerando CSV...",description:"Aguarde enquanto preparamos o arquivo",variant:"default"});const Me=await zz({status:m,from:d||void 0,to:f||void 0,search:y||"",limit:1e4,offset:0});if(!Me||Me.length===0){e({title:"Nenhum dado para exportar",variant:"warning"});return}const lt=Me.map(ke=>ke.id),gt=await JS(lt,r?.codigo_empresa),or=await Lh(r?.codigo_empresa),br=new Map(or.map(ke=>[ke.id,ke.numero])),ur=await c3(lt),an=await d3(lt),zr=Me.map(ke=>{const We=ke.mesa_id?`Mesa ${br.get(ke.mesa_id)||"?"}`:"Balco",Ze=ur[ke.id]||"Sem cliente",Je=an[ke.id],At=Array.isArray(Je)?Je.join(", "):Je||"No informado",Ye=ke.fechado_em?"Fechada":"Aberta";return{Tipo:ke.tipo==="balcao"?"Balco":"Mesa","Mesa/Local":We,"Cliente(s)":Ze,Status:Ye,Abertura:new Date(ke.aberto_em).toLocaleString("pt-BR"),Fechamento:ke.fechado_em?new Date(ke.fechado_em).toLocaleString("pt-BR"):"-","Total (R$)":Number(gt[ke.id]||0).toFixed(2),"Forma(s) Pagamento":At,Observaes:ke.observacao||"-"}}),Gr=Object.keys(zr[0]),ha=[Gr.join(";"),...zr.map(ke=>Gr.map(We=>{const Ze=ke[We]||"";return`"${String(Ze).replace(/"/g,'""')}"`}).join(";"))].join(`
`),pn=new Blob(["\uFEFF"+ha],{type:"text/csv;charset=utf-8;"}),on=document.createElement("a"),cn=URL.createObjectURL(pn);on.setAttribute("href",cn),on.setAttribute("download",`historico_comandas_${new Date().toISOString().slice(0,10)}.csv`),on.style.visibility="hidden",document.body.appendChild(on),on.click(),document.body.removeChild(on),e({title:"CSV exportado!",description:`${zr.length} comandas exportadas`,variant:"success"})}catch(Me){console.error("Erro ao exportar CSV:",Me),e({title:"Erro ao exportar",description:Me.message,variant:"destructive"})}},re=async()=>{try{if(e({title:"Gerando CSV...",description:"Aguarde enquanto preparamos o arquivo",variant:"default"}),!l||l.length===0){e({title:"Nenhum dado para exportar",variant:"warning"});return}const Me=l.map(an=>{const zr=an.status==="open"?"Aberto":an.status==="closed"?"Fechado":an.status;return{"Data Abertura":an.aberto_em?new Date(an.aberto_em).toLocaleString("pt-BR"):"-","Data Fechamento":an.fechado_em?new Date(an.fechado_em).toLocaleString("pt-BR"):"-",Status:zr,"Saldo Inicial (R$)":Number(an.saldo_inicial||0).toFixed(2),"Saldo Final (R$)":Number(an.saldo_final||0).toFixed(2),"Valor Contado (R$)":an.valor_final_dinheiro?Number(an.valor_final_dinheiro).toFixed(2):"-","Diferena (R$)":an.diferenca_dinheiro?Number(an.diferenca_dinheiro).toFixed(2):"-"}}),lt=Object.keys(Me[0]),gt=[lt.join(";"),...Me.map(an=>lt.map(zr=>{const Gr=an[zr]||"";return`"${String(Gr).replace(/"/g,'""')}"`}).join(";"))].join(`
`),or=new Blob(["\uFEFF"+gt],{type:"text/csv;charset=utf-8;"}),br=document.createElement("a"),ur=URL.createObjectURL(or);br.setAttribute("href",ur),br.setAttribute("download",`fechamentos_caixa_${new Date().toISOString().slice(0,10)}.csv`),br.style.visibility="hidden",document.body.appendChild(br),br.click(),document.body.removeChild(br),e({title:"CSV exportado!",description:`${Me.length} fechamentos exportados`,variant:"success"})}catch(Me){console.error("Erro ao exportar CSV:",Me),e({title:"Erro ao exportar",description:Me.message,variant:"destructive"})}},ae=100,[ut,pt]=p.useState(0),[ft,bt]=p.useState(!1),Lt=p.useRef(!1),Dt=p.useRef(0),Bt=p.useRef(0),ge=p.useRef(!1),wt=()=>{try{const Me=localStorage.getItem("auth:userProfile");return Me&&JSON.parse(Me)?.codigo_empresa||null}catch{return null}},Gt=p.useMemo(()=>`hist:comandas:${wt()||"na"}:${d}:${f}:${m}:${b}:${(y||"").trim()}`,[d,f,m,b,y]),Sr=async({append:Me=!1,skipCacheWrite:lt=!1}={})=>{try{i(!0);const gt=wt();if(!gt){i(!1);return}const or=setTimeout(()=>i(!1),1e4);if(j==="comandas"){const br=!!(y&&y.trim()),ur=br?1e3:ae,an=br?0:ut;console.log("[HistoricoComandasPage] Carregando com:",{status:m,from:d,to:f,search:y,mesaId:s,searching:br,effLimit:ur});const zr=await zz({status:m,from:d,to:f,search:s||y,limit:ur,offset:an});console.log("[HistoricoComandasPage] Resultado:",zr?.length||0,"comandas");const Gr=(zr||[]).map(Ze=>Ze.id);let ha={};if(Gr.length>0)try{ha=await JS(Gr,gt)}catch{ha={}}let pn=[];try{pn=await Lh(gt)}catch{pn=[]}const on=new Map((pn||[]).map(Ze=>[Ze.id,Ze.numero]));let cn={},ke={};try{cn=await c3(Gr)}catch{cn={}}try{ke=await d3(Gr)}catch{ke={}}const We=(zr||[]).map(Ze=>{const Je=cn[Ze.id],At=ke[Ze.id];return{...Ze,statusDerived:Ze.status==="cancelled"?"cancelled":Ze.fechado_em?"closed":Ze.status||"open",total:Number(ha[Ze.id]||0),mesaNumero:on.get(Ze.mesa_id),clientesStr:Array.isArray(Je)?Je.join(", "):Je||"",finalizadorasStr:Array.isArray(At)?At.join(", "):At||""}});if(bt(br?!1:(zr||[]).length===ae),c(Me?Ze=>[...Ze,...We]:We),!lt)try{localStorage.setItem(Gt,JSON.stringify({ts:Date.now(),rows:We}))}catch{}}else{const br=await cne({from:d,to:f,limit:100,offset:0,codigoEmpresa:gt});c(br||[])}clearTimeout(or)}catch(gt){e({title:"Falha ao carregar histrico",description:gt?.message||"Tente novamente",variant:"destructive"})}finally{i(!1),Dt.current=Date.now()}};p.useEffect(()=>{s&&(async()=>{try{const gt=(await Lh(r?.codigo_empresa)||[]).find(or=>or.id===s);gt&&A(`Mesa ${gt.numero}`)}catch{}})()},[s,r?.codigo_empresa]),p.useEffect(()=>{if(Lt.current=!0,j==="comandas")try{const Me=localStorage.getItem(Gt);if(Me){const lt=JSON.parse(Me);lt&&Array.isArray(lt.rows)&&Date.now()-Number(lt.ts||0)<12e4&&c(lt.rows)}}catch{}return()=>{Lt.current=!1}},[Gt,j]),p.useEffect(()=>{j==="comandas"&&(pt(0),bt(!1)),Sr({append:!1})},[m,y,d,f,j]),p.useEffect(()=>{if(!o&&j==="comandas"&&l.length===0){const Me=setTimeout(()=>{Lt.current&&Sr({append:!1,skipCacheWrite:!1})},1500);return()=>clearTimeout(Me)}},[l.length,o,j]),p.useEffect(()=>{const Me=()=>{document.visibilityState==="visible"&&Date.now()-(Dt.current||0)>3e4&&Sr({append:!1})},lt=()=>{Date.now()-(Dt.current||0)>3e4&&Sr({append:!1})};return window.addEventListener("visibilitychange",Me),window.addEventListener("focus",lt),()=>{window.removeEventListener("visibilitychange",Me),window.removeEventListener("focus",lt)}},[Gt,j]);const wr=async Me=>{O(Me),T({loading:!0,itens:[],pagamentos:[]});const lt=wt();ge.current=!0;const gt=++Bt.current,or=setTimeout(()=>{Bt.current===gt&&ge.current&&T(br=>({...br,loading:!1}))},1e4);if(!lt){clearTimeout(or),Bt.current===gt&&ge.current&&T({loading:!1,itens:[],pagamentos:[]});return}try{const br=(l||[]).find(ur=>ur.id===Me)||null;if(br){const ur=br.mesa_id==null?"Balco":br.mesaNumero!=null?`Mesa ${br.mesaNumero}`:"Comanda";q({mesaLabel:ur,clientesStr:br.clientesStr||"",aberto_em:br.aberto_em||null,fechado_em:br.fechado_em||null,tipo:br.mesa_id==null?"balcao":"comanda",status:br.statusDerived||br.status||"open",diferenca_pagamento:typeof br.diferenca_pagamento=="number"?br.diferenca_pagamento:0})}else q(null)}catch{q(null)}try{const br=async()=>{const[an,zr]=await Promise.all([ci({comandaId:Me,codigoEmpresa:lt}),ine({comandaId:Me,codigoEmpresa:lt})]);let Gr=[];try{Gr=await nl({comandaId:Me,codigoEmpresa:lt})}catch{}console.log("[openDetail] clientesVinc:",Gr);const ha=new Map((Gr||[]).map(cn=>{const ke=cn?.cliente_id??cn?.clientes?.id??null,We=cn?.clientes?.nome??cn?.nome??cn?.nome_livre??"";return console.log(`[openDetail] Mapeando cliente: cid=${ke}, nome=${We}`),ke?[String(ke),We]:null}).filter(Boolean));console.log("[openDetail] nomeById map:",Array.from(ha.entries()));const pn=[...Array.from(ha.values()),...(Gr||[]).filter(cn=>!cn?.cliente_id&&(cn?.nome_livre||cn?.nome)).map(cn=>cn?.nome_livre||cn?.nome||"Consumidor")];console.log("[openDetail] clientesDisponiveis:",pn),console.log("[openDetail] pagamentos:",zr);const on=(zr||[]).map((cn,ke)=>{let We="";return cn?.cliente_id?(We=ha.get(String(cn.cliente_id))||"",!We&&pn.length>0&&(We=pn[ke%pn.length])):pn.length>0&&(We=pn[ke%pn.length]),console.log(`[openDetail] Pagamento ${ke}: cliente_id=${cn?.cliente_id}, clienteNome=${We}`),{...cn,cliente_nome:We,finalizadora_nome:cn?.finalizadoras?.nome||cn?.metodo||""}});return{itens:an||[],pagamentos:on}};let ur=await br();ur.itens.length===0&&ur.pagamentos.length===0&&(await new Promise(an=>setTimeout(an,700)),ur=await br()),Bt.current===gt&&ge.current&&T({loading:!1,itens:ur.itens,pagamentos:ur.pagamentos})}catch(br){Bt.current===gt&&ge.current&&T({loading:!1,itens:[],pagamentos:[]}),e({title:"Falha ao carregar detalhes",description:br?.message||"Tente novamente",variant:"destructive"})}finally{clearTimeout(or),Bt.current===gt&&ge.current&&T(br=>({...br,loading:!1}))}},he=p.useMemo(()=>({sum:l.reduce((lt,gt)=>lt+Number(gt.total||0),0)}),[l]),ot=Me=>(Me||"").toString().toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,""),Vt=p.useMemo(()=>{const Me=(y||"").trim(),lt=ot(Me),or=l.filter(br=>{const ur=br.mesa_id==null;return!(b==="balcao"&&!ur||b==="comanda"&&ur)}).filter(br=>{const ur=br.statusDerived||(br.status==="cancelled"?"cancelled":br.fechado_em?"closed":br.status||"open");return m==="closed"?ur==="closed":m==="open"?ur==="open":m==="awaiting-payment"?ur==="awaiting-payment":m==="cancelled"?ur==="cancelled":!0});return lt?or.filter(br=>{const ur=br.mesaNumero!=null?String(br.mesaNumero):"",an=br.mesa_id==null?"balcao":`mesa ${ur}`;return[ur,an,br.clientesStr||"",br.finalizadorasStr||"",br.mesa_id==null?"balcao":"comanda",br.statusDerived||br.status||""].map(ot).join(" | ").includes(lt)}):or},[l,y,b,m]),qt=Me=>Me==="open"?"Aberta":Me==="awaiting-payment"?"Pagamento":Me==="closed"?"Fechada":Me==="cancelled"?"Cancelada":Me||"",Re=Me=>{if(!Me)return"";try{return new Date(Me).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}},Ct=Me=>{const lt=String(Me||"").toLowerCase();return lt==="open"?"Aberto":lt==="closed"?"Fechado":""},Wt=Me=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(Me||0)),Er=Me=>Me==="open"?"text-info bg-info/10 border-info/30":Me==="awaiting-payment"?"text-warning bg-warning/10 border-warning/30":Me==="closed"?"text-success bg-success/10 border-success/30":Me==="cancelled"?"text-red-400 bg-red-500/10 border-red-500/30":"text-text-secondary bg-transparent border-border/50";return a.jsxs(Fr.div,{variants:flt,initial:"hidden",animate:"visible",className:"min-h-screen flex flex-col",children:[a.jsxs(Fr.div,{variants:pb,className:"mb-6 gap-3 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[a.jsx(_d,{value:"historico",onValueChange:Me=>{Me==="mesas"&&t("/vendas"),Me==="balcao"&&t("/balcao"),Me==="historico"&&t("/historico")},children:a.jsxs(xc,{className:"grid w-full sm:w-auto grid-cols-3 sm:inline-flex",children:[a.jsx(Ya,{value:"mesas",children:"Mesas"}),a.jsx(Ya,{value:"balcao",children:"Balco"}),a.jsx(Ya,{value:"historico",children:"Histrico"})]})}),a.jsxs("div",{className:"w-full flex items-center gap-2 sm:gap-3",children:[a.jsxs("div",{className:"flex sm:hidden items-center gap-2 w-full",children:[a.jsxs(Zn,{value:j,onValueChange:_,children:[a.jsx(Yn,{className:"w-[160px] text-sm",children:a.jsx(ta,{placeholder:"Selecionar"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"comandas",children:"Comandas"}),a.jsx(nt,{value:"fechamentos",children:"Fechamentos"})]})]}),a.jsxs("div",{className:"ml-auto text-xs text-text-secondary whitespace-nowrap",children:["Total: ",a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",he.sum.toFixed(2)]})]}),j==="comandas"&&a.jsx(Z,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 sm:hidden",onClick:()=>G(!0),title:"Aes",children:a.jsx(ws,{className:"h-4 w-4"})}),j==="fechamentos"&&a.jsx(Z,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 sm:hidden",onClick:re,title:"Exportar",children:a.jsx(ws,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"hidden sm:flex items-center gap-2 sm:gap-3 ml-auto",children:a.jsx(_d,{value:j,onValueChange:_,className:"w-full sm:w-auto",children:a.jsxs(xc,{className:"w-full grid grid-cols-2 sm:w-auto sm:inline-flex text-sm",children:[a.jsx(Ya,{value:"comandas",className:"text-sm",children:"Comandas"}),a.jsx(Ya,{value:"fechamentos",className:"text-sm",children:"Fechamentos"})]})})})]}),a.jsxs("div",{className:"hidden sm:flex w-full sm:w-auto items-center gap-2 sm:gap-3",children:[j==="comandas"&&a.jsxs(a.Fragment,{children:[a.jsxs(Z,{variant:"secondary",size:"sm",className:"hidden sm:inline-flex",onClick:()=>se(!0),children:[a.jsx(il,{className:"mr-2 h-4 w-4"}),"Importar XML"]}),a.jsxs(Z,{variant:"outline",size:"sm",className:"hidden sm:inline-flex",onClick:De,children:[a.jsx(ws,{className:"mr-1 h-3 w-3"}),"Exportar"]}),a.jsx("button",{className:"hidden sm:inline-block text-xs text-text-muted hover:text-text-primary transition-colors",onClick:()=>{if(te){const Me=new Date().toISOString().slice(0,10);u(Me),h(Me),oe(!1)}else u(""),h(""),oe(!0);pt(0)},title:te?"Voltar ao filtro de hoje":"Mostrar todas as comandas",children:te?"":""}),a.jsxs("div",{className:"text-sm text-text-secondary whitespace-nowrap ml-auto",children:["Total: ",a.jsxs("span",{className:"font-semibold text-text-primary",children:["R$ ",he.sum.toFixed(2)]})]})]}),j==="fechamentos"&&a.jsxs(Z,{variant:"outline",size:"sm",className:"hidden sm:inline-flex",onClick:re,children:[a.jsx(ws,{className:"mr-1 h-3 w-3"}),"Exportar"]})]})]}),a.jsx(Un,{open:pe,onOpenChange:G,children:a.jsxs(zn,{className:"sm:hidden w-[92vw] max-w-[360px] p-2",onOpenAutoFocus:Me=>Me.preventDefault(),onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{className:"text-base",children:"Aes"}),a.jsx(ma,{children:"Escolha uma ao para Comandas"})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs(Z,{variant:"secondary",onClick:()=>{G(!1),se(!0)},children:[a.jsx(il,{className:"mr-2 h-4 w-4"})," Importar XML"]}),a.jsxs(Z,{variant:"outline",onClick:()=>{G(!1),De()},children:[a.jsx(ws,{className:"mr-2 h-4 w-4"})," Exportar CSV"]})]})]})}),j==="comandas"&&a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:["Carregadas ",l.length," ",l.length===1?"comanda":"comandas"]}),ft&&a.jsx(Z,{size:"sm",variant:"outline",disabled:o,onClick:async()=>{const Me=ut+ae;pt(Me),await Sr({append:!0})},children:"Carregar mais"})]}),j==="comandas"&&a.jsxs("div",{className:"sm:hidden bg-surface rounded-lg border border-border p-3 mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Buscar...",className:"pl-9 h-9 text-sm",value:g,onChange:Me=>v(Me.target.value)})]}),a.jsx(Z,{size:"sm",variant:"outline",className:"h-9",onClick:()=>E(Me=>!Me),children:C?"Ocultar":"Filtros"})]}),a.jsxs("div",{className:"mt-1 text-[11px] text-text-secondary truncate",children:[d||"","  ",f||""]})]}),j==="comandas"&&a.jsx(Fr.div,{variants:pb,className:`bg-surface rounded-lg border border-border p-4 mb-4 ${C?"":"hidden"} sm:block`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Perodo Inicial"}),a.jsx(u2,{value:d,onChange:u})]}),a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Perodo Final"}),a.jsx(u2,{value:f,onChange:h})]}),a.jsxs("div",{className:"md:col-span-2 hidden sm:block",children:[a.jsxs(ct,{className:"mb-1 block",children:["Busca ",S&&a.jsxs("span",{className:"text-xs text-warning ml-1",children:["(",S,")"]})]}),a.jsxs("div",{className:"relative",children:[a.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),a.jsx(It,{placeholder:"Mesa, status (fechada/aberta) ou cliente",className:"pl-9 pr-12",value:g,onChange:Me=>v(Me.target.value)}),s&&a.jsx(Z,{size:"sm",variant:"ghost",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 text-xs",onClick:()=>{t("/historico")},children:" Limpar"})]})]}),a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Status"}),a.jsxs(Zn,{value:m,onValueChange:x,children:[a.jsx(Yn,{className:"w-full text-xs",children:a.jsx(ta,{placeholder:"Selecionar status"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"closed",children:"Fechadas"}),a.jsx(nt,{value:"open",children:"Abertas"}),a.jsx(nt,{value:"awaiting-payment",children:"Pagamento"}),a.jsx(nt,{value:"cancelled",children:"Canceladas"})]})]})]}),a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Tipo"}),a.jsxs(Zn,{value:b,onValueChange:w,children:[a.jsx(Yn,{className:"w-full text-xs",children:a.jsx(ta,{placeholder:"Selecionar tipo"})}),a.jsxs(Jn,{children:[a.jsx(nt,{value:"all",children:"Todos"}),a.jsx(nt,{value:"comanda",children:"Comandas"}),a.jsx(nt,{value:"balcao",children:"Balco"})]})]})]})]})}),j==="comandas"&&a.jsxs(Fr.div,{variants:pb,className:"bg-surface rounded-lg border border-border p-0 overflow-hidden",children:[a.jsx("div",{className:"hidden sm:block overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-4 py-3 whitespace-nowrap",children:"Local"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Clientes"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Finalizadora"}),a.jsx("th",{className:"text-left px-4 py-3 whitespace-nowrap",children:"Abertura"}),a.jsx("th",{className:"text-right px-4 py-3 whitespace-nowrap",children:"Diferena"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Total"}),a.jsx("th",{className:"text-right px-4 py-3 whitespace-nowrap",children:"Fiscal"})]})}),a.jsxs("tbody",{children:[Vt.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-text-muted",children:"Nenhuma comanda encontrada no perodo."})}),Vt.map(Me=>a.jsxs("tr",{className:"border-t border-border/70 hover:bg-warning/10 cursor-pointer transition-all duration-150 hover:translate-x-[1px]",onClick:()=>wr(Me.id),children:[a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:Me.mesa_id==null?"Balco":Me.mesaNumero!=null?`Mesa ${Me.mesaNumero}`:""}),a.jsx("td",{className:"px-4 py-2 break-words",title:Me.clientesStr||"",children:Me.clientesStr||""}),a.jsx("td",{className:"px-4 py-2",children:a.jsx("span",{className:Pr("inline-flex items-center text-[11px] font-medium px-2 py-0.5 rounded-full border",Er(Me.statusDerived||Me.status)),children:qt(Me.statusDerived||Me.status)})}),a.jsx("td",{className:"px-4 py-2 break-words",title:Me.finalizadorasStr||"",children:Me.finalizadorasStr||""}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:Re(Me.aberto_em)}),a.jsx("td",{className:"px-4 py-2 text-right whitespace-nowrap",children:(()=>{const lt=typeof Me.diferenca_pagamento=="number"?Me.diferenca_pagamento:0;if(Math.abs(lt)<.005)return a.jsx("span",{className:"text-xs text-text-muted",children:"R$ 0,00"});const gt=lt>0?"text-emerald-500":"text-amber-500",or=lt>0?"+":"-";return a.jsx("span",{className:`text-xs font-semibold ${gt}`,children:`${or} R$ ${Math.abs(lt).toFixed(2)}`})})()}),a.jsx("td",{className:"px-4 py-2 text-right font-semibold whitespace-nowrap",children:Wt(Me.total)}),a.jsx("td",{className:"px-4 py-2 text-right whitespace-nowrap",children:Me.fechado_em&&(!Me.nf_status||Me.nf_status==="rejeitada")&&a.jsx(Z,{size:"sm",variant:"outline",onClick:lt=>{lt.stopPropagation(),Y(Me.id)},children:"Pr-Emisso"})})]},Me.id))]})]})}),a.jsxs("div",{className:"sm:hidden divide-y divide-border",children:[Vt.length===0&&a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Nenhuma comanda encontrada no perodo."}),Vt.map(Me=>a.jsxs("button",{className:"w-full text-left p-3 active:bg-warning/10",onClick:()=>wr(Me.id),children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-xs text-text-secondary",children:Me.mesa_id==null?"Balco":Me.mesaNumero!=null?`Mesa ${Me.mesaNumero}`:"Comanda"}),a.jsx("div",{className:"font-semibold truncate max-w-[220px]",children:Me.clientesStr||"Sem cliente"})]}),a.jsx("div",{children:a.jsx("div",{className:Pr("inline-flex items-center text-[10px] font-medium px-2 py-0.5 rounded-full border",Er(Me.statusDerived||Me.status)),children:qt(Me.statusDerived||Me.status)})})]}),a.jsx("div",{className:"mt-1 text-xs text-text-secondary truncate",children:Me.finalizadorasStr||""}),a.jsxs("div",{className:"mt-2 flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0 text-[11px] text-text-muted truncate pr-2",children:[Re(Me.aberto_em),Me.fechado_em?`  ${Re(Me.fechado_em)}`:""]}),a.jsxs("div",{className:"flex-shrink-0 text-right min-w-[84px]",children:[a.jsx("div",{className:"text-[11px]",children:(()=>{const lt=typeof Me.diferenca_pagamento=="number"?Me.diferenca_pagamento:0;if(Math.abs(lt)<.005)return a.jsx("span",{className:"text-text-muted",children:"Dif.: R$ 0,00"});const gt=lt>0?"text-emerald-500":"text-amber-500",or=lt>0?"+":"-";return a.jsx("span",{className:gt,children:`Dif.: ${or} R$ ${Math.abs(lt).toFixed(2)}`})})()}),a.jsx("div",{className:"font-mono font-semibold whitespace-nowrap",children:Wt(Me.total)})]})]}),Me.fechado_em&&(!Me.nf_status||Me.nf_status==="rejeitada")&&a.jsx("div",{className:"mt-2 flex justify-end",children:a.jsx(Z,{size:"sm",variant:"outline",onClick:lt=>{lt.preventDefault(),lt.stopPropagation(),Y(Me.id)},children:"Pr-Emisso"})})]},Me.id))]})]}),a.jsx(Un,{open:F,onOpenChange:V,children:a.jsxs(zn,{className:"max-w-[800px]",children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Pr-Emisso NFC-e"}),a.jsx(ma,{children:"Revise os dados e pendncias antes de emitir."})]}),me?a.jsx("div",{className:"p-4 text-center text-text-muted",children:"Gerando prvia"}):a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"JSON (EnviarNfce)"}),a.jsx("pre",{className:"text-[11px] whitespace-pre-wrap break-all max-h-[360px] overflow-auto",children:U?JSON.stringify(U,null,2):""})]}),a.jsxs("div",{className:"border border-border rounded p-2 bg-surface-2",children:[a.jsx("div",{className:"text-xs text-text-secondary mb-1",children:"Pendncias"}),!H||H.length===0?a.jsx("div",{className:"text-sm text-emerald-500",children:"Nenhuma pendncia encontrada."}):a.jsx("ul",{className:"list-disc pl-5 text-sm",children:H.map((Me,lt)=>a.jsx("li",{children:Me},lt))})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[a.jsx(Z,{variant:"outline",onClick:()=>V(!1),children:"Fechar"}),a.jsx(Z,{disabled:!0,children:"Emitir (desabilitado)"})]})]})}),j==="fechamentos"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"sm:hidden bg-surface rounded-lg border border-border p-3 mb-3",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:"Filtros"}),a.jsx(Z,{size:"sm",variant:"outline",onClick:()=>E(Me=>!Me),children:C?"Ocultar filtros":"Mostrar filtros"})]})}),a.jsx(Fr.div,{variants:pb,className:`bg-surface rounded-lg border border-border p-4 mb-4 ${C?"":"hidden"} sm:block`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Perodo Inicial"}),a.jsx(u2,{value:d,onChange:u})]}),a.jsxs("div",{children:[a.jsx(ct,{className:"mb-1 block",children:"Perodo Final"}),a.jsx(u2,{value:f,onChange:h})]})]})}),a.jsxs(Fr.div,{variants:pb,className:"bg-surface rounded-lg border border-border p-4 overflow-hidden",children:[a.jsxs("div",{className:"sm:hidden space-y-2",children:[o&&(!l||l.length===0)&&a.jsxs("div",{className:"px-2 py-3 text-center text-text-muted",children:[a.jsx(cl,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando fechamentos"]}),(!l||l.length===0)&&!o&&a.jsx("div",{className:"px-2 py-3 text-center text-text-muted",children:"Nenhum fechamento encontrado no perodo."}),(l||[]).map(Me=>a.jsxs("button",{onClick:async()=>{try{z({open:!0,loading:!0,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}});const lt=wt(),[gt,or]=await Promise.all([QS({caixaSessaoId:Me.id,codigoEmpresa:lt}).catch(()=>null),Fg({caixaSessaoId:Me.id,codigoEmpresa:lt}).catch(()=>[])]);let br=gt?.movimentos||null;if(!br&&Array.isArray(or)){const an={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const zr of or){const Gr=String(zr?.tipo||"").toLowerCase(),ha=Number(zr?.valor||0);Gr==="suprimento"?an.suprimentos+=ha:Gr==="sangria"?an.sangrias+=ha:Gr==="ajuste"?an.ajustes+=ha:Gr==="troco"&&(an.troco+=ha)}br=an}const ur=gt?{totalDescontos:Number(gt.total_descontos||0),totalVendasLiquidas:Number(gt.total_liquido||0),totalEntradas:Number(gt.total_entradas||0),totalPorFinalizadora:gt.por_finalizadora||{}}:null;z({open:!0,loading:!1,resumo:ur,periodo:{from:gt?.periodo_de||Me.aberto_em,to:gt?.periodo_ate||Me.fechado_em},movs:or||[],movimentosAgg:br,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}})}catch{z({open:!0,loading:!1,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}})}},className:"w-full text-left p-3 rounded-lg border border-border hover:bg-surface-2 transition",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"text-xs text-text-secondary",children:[Re(Me.aberto_em),a.jsx("span",{className:"mx-1",children:""}),Re(Me.fechado_em)]}),a.jsx("div",{className:"text-[11px] px-2 py-0.5 rounded-full border bg-success/10 text-success border-success/30",children:Ct(Me.status)})]}),a.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:"bg-surface-2 rounded p-2 border border-border",children:[a.jsx("div",{className:"text-[10px] text-text-secondary",children:"Saldo Inicial"}),a.jsx("div",{className:"font-semibold",children:Me?.saldo_inicial!=null?Wt(Me.saldo_inicial):""})]}),a.jsxs("div",{className:"bg-surface-2 rounded p-2 border border-border",children:[a.jsx("div",{className:"text-[10px] text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("div",{className:"font-semibold",children:Me?.valor_final_dinheiro!=null?Wt(Me.valor_final_dinheiro):""})]})]})]},Me.id))]}),a.jsx("div",{className:"hidden sm:block overflow-x-auto max-h-[60vh] overflow-y-auto pr-2 sm:pr-3",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2 text-text-secondary",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-4 py-3",children:"Abertura"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Fechamento"}),a.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Saldo Inicial"}),a.jsx("th",{className:"text-right px-4 py-3",children:"Saldo Final (contado)"})]})}),a.jsxs("tbody",{children:[o&&(!l||l.length===0)&&a.jsx("tr",{children:a.jsxs("td",{colSpan:5,className:"px-4 py-6 text-center text-text-muted",children:[a.jsx(cl,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando fechamentos"]})}),(!l||l.length===0)&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-text-muted",children:"Nenhum fechamento encontrado no perodo."})}),(l||[]).map(Me=>a.jsxs("tr",{className:"border-t border-border/70 hover:bg-success/10 cursor-pointer transition-all duration-150 hover:translate-x-[1px]",onClick:async()=>{try{z({open:!0,loading:!0,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.saldo_final??null}});const lt=async()=>{const br=wt(),[ur,an]=await Promise.all([QS({caixaSessaoId:Me.id,codigoEmpresa:br}).catch(()=>null),Fg({caixaSessaoId:Me.id,codigoEmpresa:br}).catch(()=>[])]);return{snap:ur,movs:an}};let{snap:gt,movs:or}=await lt();if(gt||(await new Promise(br=>setTimeout(br,700)),{snap:gt,movs:or}=await lt()),gt){const br={totalDescontos:Number(gt.total_descontos||0),totalVendasLiquidas:Number(gt.total_liquido||0),totalEntradas:Number(gt.total_entradas||0),totalPorFinalizadora:gt.por_finalizadora||{}};let ur=gt.movimentos||null;if(!ur&&Array.isArray(or)){const an={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const zr of or){const Gr=String(zr?.tipo||"").toLowerCase(),ha=Number(zr?.valor||0);Gr==="suprimento"?an.suprimentos+=ha:Gr==="sangria"?an.sangrias+=ha:Gr==="ajuste"?an.ajustes+=ha:Gr==="troco"&&(an.troco+=ha)}ur=an}z({open:!0,loading:!1,resumo:br,periodo:{from:gt.periodo_de||Me.aberto_em,to:gt.periodo_ate||Me.fechado_em},movs:or||[],movimentosAgg:ur,saldos:{inicial:typeof gt.saldo_inicial<"u"?Number(gt.saldo_inicial):Me?.saldo_inicial??null,final:typeof gt.valor_final_dinheiro<"u"?Number(gt.valor_final_dinheiro):Me?.valor_final_dinheiro??null}})}else{const br=wt(),ur=await fu({from:Me.aberto_em,to:Me.fechado_em||new Date().toISOString(),codigoEmpresa:br});let an=null;if(Array.isArray(or)){const zr={suprimentos:0,sangrias:0,ajustes:0,troco:0};for(const Gr of or){const ha=String(Gr?.tipo||"").toLowerCase(),pn=Number(Gr?.valor||0);ha==="suprimento"?zr.suprimentos+=pn:ha==="sangria"?zr.sangrias+=pn:ha==="ajuste"?zr.ajustes+=pn:ha==="troco"&&(zr.troco+=pn)}an=zr}z({open:!0,loading:!1,resumo:ur||null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:or||[],movimentosAgg:an,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.valor_final_dinheiro??null}})}}catch{z({open:!0,loading:!1,resumo:null,periodo:{from:Me.aberto_em,to:Me.fechado_em},movs:[],movimentosAgg:null,saldos:{inicial:Me?.saldo_inicial??null,final:Me?.valor_final_dinheiro??null}})}},children:[a.jsx("td",{className:"px-4 py-2",children:Re(Me.aberto_em)}),a.jsx("td",{className:"px-4 py-2",children:Re(Me.fechado_em)}),a.jsx("td",{className:"px-4 py-2",children:Ct(Me.status)}),a.jsx("td",{className:"px-4 py-2 text-right",children:Me?.saldo_inicial!=null?Wt(Me.saldo_inicial):""}),a.jsx("td",{className:"px-4 py-2 text-right",children:Me?.valor_final_dinheiro!=null?Wt(Me.valor_final_dinheiro):""})]},Me.id))]})]})})]})]}),j==="comandas"&&a.jsx(Un,{open:!!M,onOpenChange:Me=>{Me?ge.current=!0:(ge.current=!1,O(null),T({loading:!1,itens:[],pagamentos:[]}),q(null))},children:a.jsxs(zn,{className:"sm:max-w-4xl w-[92vw] max-h-[90vh] overflow-hidden flex flex-col animate-none",onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsxs(Ln,{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("span",{children:k?a.jsxs("span",{children:[k.mesaLabel,k.clientesStr?a.jsxs("span",{className:"text-text-secondary",children:["  ",k.clientesStr]}):null]}):a.jsxs(a.Fragment,{children:["Comanda #",M||""]})}),k&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("span",{className:Pr("text-xs px-2 py-0.5 rounded-full border",Er(k.status)),children:k.status==="closed"?"Fechada":k.status==="open"?"Aberta":"Cancelada"}),a.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-info/10 text-info border-info/30",children:k.tipo==="balcao"?"Balco":k.tipo==="comanda"?"Mesa":"Importada"})]})]}),a.jsx(ma,{className:"space-y-1",children:k?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[k.aberto_em?a.jsxs(a.Fragment,{children:["Abertura: ",Re(k.aberto_em)]}):"",k.fechado_em&&a.jsxs(a.Fragment,{children:[" ",""," ","Fechamento: ",Re(k.fechado_em),(()=>{const Me=new Date(k.aberto_em),gt=new Date(k.fechado_em)-Me,or=Math.floor(gt/6e4),br=Math.floor(or/60),ur=or%60;return or>0?a.jsxs("span",{className:"text-text-muted",children:[" (",br>0?`${br}h `:"",ur,"min)"]}):null})()]})]}),k.observacao&&a.jsx("div",{className:"text-xs text-text-muted",children:k.observacao.includes("Importado de XML")?a.jsxs("span",{className:"text-warning",children:[" ",k.observacao.split(`
`)[0]]}):a.jsxs("span",{children:["Obs: ",k.observacao]})})]}):a.jsx(a.Fragment,{children:"Itens e pagamentos registrados."})})]}),I.loading?a.jsxs("div",{className:"p-6 text-center text-text-muted",children:[a.jsx(cl,{className:"mr-2 inline h-4 w-4 animate-spin"})," Carregando..."]}):a.jsxs("div",{className:"space-y-4 overflow-y-auto flex-1 px-1",children:[(()=>{const Me=I.itens.reduce((an,zr)=>an+Number(zr.quantidade||0)*Number(zr.preco_unitario||0),0),lt=I.itens.reduce((an,zr)=>an+Number(zr.desconto||0),0),gt=Me-lt,or=I.pagamentos.reduce((an,zr)=>an+Number(zr.valor||0),0),br=typeof k?.diferenca_pagamento=="number"?k.diferenca_pagamento:null,ur=br??or-gt;return a.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Resumo Financeiro"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-muted",children:"Subtotal"}),a.jsxs("span",{className:"font-mono font-semibold",children:["R$ ",Me.toFixed(2)]})]}),lt>0&&a.jsxs("div",{className:"flex items-center gap-2 text-warning",children:[a.jsx("span",{children:"Desconto"}),a.jsxs("span",{className:"font-mono font-semibold",children:["-R$ ",lt.toFixed(2)]})]})]}),a.jsxs("div",{className:"flex justify-between font-semibold pt-2 border-t border-border",children:[a.jsx("span",{children:"Total:"}),a.jsxs("span",{className:"font-mono text-lg",children:["R$ ",gt.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2 text-success",children:[a.jsx("span",{children:"Pagamentos"}),a.jsxs("span",{className:"font-mono",children:["R$ ",or.toFixed(2)]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-text-secondary",children:"Diferena"}),a.jsx("span",{className:Pr("font-semibold",Math.abs(ur)<.005?"text-text-muted":ur>0?"text-emerald-500":"text-amber-500"),children:Math.abs(ur)<.005?"R$ 0,00":`${ur>0?"+":"-"} R$ ${Math.abs(ur).toFixed(2)}`})]})]})]})]})})(),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"border rounded-md p-3",children:[a.jsxs("div",{className:"font-semibold mb-2",children:["Itens (",I.itens.length,")"]}),I.itens.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem itens."}):a.jsx("ul",{className:"text-sm space-y-2 max-h-64 overflow-auto thin-scroll",children:I.itens.map(Me=>{const lt=Number(Me.quantidade||0)*Number(Me.preco_unitario||0),gt=Number(Me.desconto||0),or=lt-gt;return a.jsx("li",{className:"border-b border-border/50 pb-2 last:border-0",children:a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("span",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium truncate",children:Me.descricao}),a.jsxs("div",{className:"text-xs text-text-muted",children:[Me.quantidade," x R$ ",Number(Me.preco_unitario||0).toFixed(2),gt>0&&a.jsxs("span",{className:"text-warning",children:[" (desc: R$ ",gt.toFixed(2),")"]})]})]}),a.jsxs("span",{className:"font-mono font-semibold whitespace-nowrap",children:["R$ ",or.toFixed(2)]})]})},Me.id)})})]}),a.jsxs("div",{className:"border rounded-md p-3",children:[a.jsxs("div",{className:"font-semibold mb-2",children:["Pagamentos (",I.pagamentos.length,")"]}),I.pagamentos.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Sem registros."}):a.jsx("ul",{className:"text-sm space-y-2 max-h-64 overflow-auto thin-scroll",children:I.pagamentos.map(Me=>a.jsxs("li",{className:"flex justify-between gap-2 border-b border-border/50 pb-2 last:border-0",children:[a.jsxs("span",{className:"pr-2 break-words flex-1",children:[Me.cliente_nome?a.jsx("div",{className:"font-medium",children:Me.cliente_nome}):a.jsx("div",{className:"text-text-muted",children:"Sem cliente"}),a.jsx("div",{className:"text-xs text-text-secondary",children:Me.finalizadora_nome||"Outros"})]}),a.jsxs("span",{className:"font-mono font-semibold whitespace-nowrap",children:["R$ ",Number(Me.valor||0).toFixed(2)]})]},Me.id))})]})]})]}),a.jsx(Ga,{children:a.jsx(Z,{size:"sm",variant:"secondary",onClick:()=>{O(null)},children:"Fechar"})})]})}),j==="fechamentos"&&a.jsx(Un,{open:B.open,onOpenChange:Me=>{Me||z({open:!1,loading:!1,resumo:null,periodo:{from:null,to:null}})},children:a.jsxs(zn,{className:"sm:max-w-2xl w-[92vw] max-h-[85vh] animate-none flex flex-col overflow-hidden overflow-x-hidden",onKeyDown:Me=>Me.stopPropagation(),children:[a.jsxs(Bn,{children:[a.jsx(Ln,{children:"Fechamento do Perodo"}),a.jsxs(ma,{children:[B.periodo.from?Re(B.periodo.from):""," ","at"," ",B.periodo.to?Re(B.periodo.to):""]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto pr-1",children:B.loading?a.jsxs("div",{className:"p-3 sm:p-4 text-text-muted",children:[a.jsx(cl,{className:"inline mr-2 h-4 w-4 animate-spin"}),"Carregando resumo"]}):a.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Inicial"}),a.jsx("p",{className:"text-xl font-bold",children:Wt(B?.saldos?.inicial??0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Entradas (pagamentos)"}),a.jsx("p",{className:"text-xl font-bold text-success",children:Wt(B.resumo?.totalEntradas||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border col-span-2 sm:col-span-1",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Saldo Final (contado)"}),a.jsx("p",{className:"text-xl font-bold",children:B?.saldos?.final!=null?Wt(B.saldos.final):""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Descontos"}),a.jsx("p",{className:"text-xl font-bold text-warning",children:Wt(B.resumo?.totalDescontos||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Lquido"}),a.jsx("p",{className:"text-xl font-bold",children:Wt(B.resumo?.totalVendasLiquidas||0)})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Por Finalizadora"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:B.resumo?.totalPorFinalizadora&&Object.keys(B.resumo.totalPorFinalizadora).length>0?Object.entries(B.resumo.totalPorFinalizadora).map(([Me,lt])=>a.jsxs("div",{className:"flex items-center justify-between bg-surface-2 rounded-md p-2 border border-border",children:[a.jsx("span",{className:"text-sm text-text-secondary",children:String(Me)}),a.jsx("span",{className:"text-sm font-semibold",children:Wt(lt)})]},Me)):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem dados de finalizadoras"})})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Resumo de Movimentaes"}),B.movimentosAgg?a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Suprimentos"}),a.jsx("p",{className:"text-lg font-bold text-success",children:Wt(B.movimentosAgg?.suprimentos||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Sangrias"}),a.jsx("p",{className:"text-lg font-bold text-danger",children:Wt(B.movimentosAgg?.sangrias||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Ajustes"}),a.jsx("p",{className:"text-lg font-bold",children:Wt(B.movimentosAgg?.ajustes||0)})]}),a.jsxs("div",{className:"bg-surface-2 rounded-lg p-3 border border-border",children:[a.jsx("p",{className:"text-xs text-text-secondary",children:"Troco"}),a.jsx("p",{className:"text-lg font-bold",children:Wt(B.movimentosAgg?.troco||0)})]})]}):a.jsx("div",{className:"text-sm text-text-muted",children:"Sem movimentaes agregadas nesta sesso."})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-1",children:"Movimentaes"}),!B.movs||B.movs.length===0?a.jsx("div",{className:"text-sm text-text-muted",children:"Nenhuma movimentao registrada"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"sm:hidden divide-y divide-border rounded-md border border-border overflow-hidden",children:B.movs.map((Me,lt)=>a.jsxs("li",{className:"px-3 py-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:Re(Me.criado_em)}),a.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:Wt(Me.valor||0)})]}),a.jsxs("div",{className:"mt-0.5 flex items-center gap-2 text-xs",children:[a.jsx("span",{className:"px-1.5 py-0.5 rounded bg-surface-2 border border-border text-text-secondary whitespace-nowrap",children:String(Me.tipo||"").toUpperCase()}),a.jsx("span",{className:"text-xs text-text-primary whitespace-normal break-words flex-1",children:Me.observacao||""})]})]},lt))}),a.jsx("div",{className:"hidden sm:block rounded-md border border-border overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-surface-2",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-3 py-2",children:"Data"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Tipo"}),a.jsx("th",{className:"text-left px-3 py-2",children:"Obs"}),a.jsx("th",{className:"text-right px-3 py-2",children:"Valor"})]})}),a.jsx("tbody",{children:B.movs.map((Me,lt)=>a.jsxs("tr",{className:"border-t border-border/60",children:[a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:Re(Me.criado_em)}),a.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:String(Me.tipo||"").toUpperCase()}),a.jsx("td",{className:"px-3 py-2 whitespace-normal break-words",children:Me.observacao||""}),a.jsx("td",{className:"px-3 py-2 text-right font-semibold whitespace-nowrap",children:Wt(Me.valor||0)})]},lt))})]})})]})]})]})})]})}),a.jsx(ult,{open:W,onOpenChange:se,codigoEmpresa:r?.codigo_empresa,onSuccess:async Me=>{se(!1),Me&&(u(Me),h(Me)),await new Promise(lt=>setTimeout(lt,500)),pt(0),await Sr({append:!1})}})]})}function plt(){const{userProfile:e}=lo(),[t]=qC(),r=t.get("comanda"),[n,s]=p.useState(!0),[o,i]=p.useState(null),[l,c]=p.useState([]),[d,u]=p.useState([]),[f,h]=p.useState([]),[m,x]=p.useState(null),[g,v]=p.useState(""),[y,b]=p.useState("");p.useEffect(()=>{(async()=>{try{if(!r||!e?.codigo_empresa)return;try{const{data:T,error:k}=await Q.from("empresas").select("nome_fantasia, nome").eq("codigo_empresa",e.codigo_empresa).single();if(k&&console.warn("[PrintComandaPage] Erro ao buscar empresa:",k.message),T){const q=T.nome_fantasia||T.nome||"";console.log("[PrintComandaPage] Empresa carregada:",T,"-> nome exibido:",q),b(q)}else console.warn("[PrintComandaPage] Empresa no encontrada para codigo_empresa:",e.codigo_empresa)}catch(T){console.warn("[PrintComandaPage] Exceo ao carregar empresa:",T)}const{data:E}=await Q.from("comandas").select("mesa_id, observacoes").eq("id",r).eq("codigo_empresa",e.codigo_empresa).single();if(E?.mesa_id){const{data:T}=await Q.from("mesas").select("numero").eq("id",E.mesa_id).eq("codigo_empresa",e.codigo_empresa).single();x(T)}v(E?.observacoes||"");const[S,A,M]=await Promise.all([ci({comandaId:r,codigoEmpresa:e.codigo_empresa}),nl({comandaId:r,codigoEmpresa:e.codigo_empresa}),ine({comandaId:r,codigoEmpresa:e.codigo_empresa})]);c(S||[]),u(A||[]),h(M||[]);const O=(S||[]).reduce((T,k)=>T+Number(k.quantidade||0)*Number(k.preco_unitario||0),0),I=(M||[]).reduce((T,k)=>T+Number(k.valor||0),0);i({id:r,totalItens:O,totalPagamentos:I,diferenca:I-O})}catch(E){console.error("Erro ao carregar comanda:",E)}finally{s(!1)}})()},[r,e?.codigo_empresa]);const w=()=>{window.print()},j=()=>{window.history.back()};if(n)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand mx-auto mb-4"}),a.jsx("p",{className:"text-text-muted",children:"Carregando comanda..."})]})});if(!o)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-text-muted mb-4",children:"Comanda no encontrada"}),a.jsxs(Z,{onClick:j,variant:"outline",children:[a.jsx(Fb,{className:"mr-2 h-4 w-4"}),"Voltar"]})]})});const _=(d||[]).map(C=>C?.nome||C?.nome_livre||"").filter(Boolean).join(", ")||"Sem cliente";return o.totalItens,o.totalPagamentos,a.jsxs("div",{className:"w-screen h-screen bg-gray-100 flex flex-col print:bg-white print:p-0",children:[a.jsxs("div",{className:"flex gap-2 p-4 bg-white border-b border-gray-200 print:hidden",children:[a.jsxs(Z,{onClick:j,size:"sm",className:"bg-black text-white hover:bg-black/80 border border-black shadow-sm",children:[a.jsx(Fb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(Z,{onClick:w,size:"sm",className:"ml-auto",children:[a.jsx(NG,{className:"mr-2 h-4 w-4"}),"Imprimir"]})]}),a.jsx("div",{className:"flex-1 overflow-auto flex items-start justify-center p-4 print:p-0 print:overflow-visible print:flex-none",children:a.jsxs("div",{className:"w-80 border border-black p-6 bg-white print:border-0 print:p-0 print:w-full",children:[a.jsxs("div",{className:"text-center mb-4 border-b border-black pb-3",children:[a.jsx("p",{className:"text-xs font-semibold text-black mb-2",children:y||" "}),a.jsx("h1",{className:"text-xl font-bold text-black",children:"COMANDA"}),m&&a.jsxs("p",{className:"text-xs text-black mt-1",children:["Mesa ",m.numero]}),a.jsx("p",{className:"text-xs text-black mt-1",children:new Date().toLocaleString("pt-BR")})]}),a.jsxs("div",{className:"mb-6 pb-4 border-b border-black",children:[a.jsx("p",{className:"text-sm font-semibold text-black",children:"CLIENTE:"}),a.jsx("p",{className:"text-sm text-black",children:_})]}),a.jsx("div",{className:"mb-6 pb-4 border-b border-black",children:a.jsx("div",{className:"space-y-2",children:l.map((C,E)=>{const S=Number(C.quantidade||0)*Number(C.preco_unitario||0);return a.jsxs("div",{className:"flex justify-between text-sm text-black",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{children:C.descricao||"Item"}),a.jsxs("span",{className:"ml-2 text-xs",children:["x",C.quantidade]})]}),a.jsxs("span",{className:"font-semibold",children:["R$ ",S.toFixed(2)]})]},E)})})}),g&&a.jsxs("div",{className:"mb-4 pb-3",children:[a.jsx("p",{className:"text-xs font-semibold text-black mb-1",children:"OBS:"}),a.jsx("p",{className:"text-xs text-black border-b border-black pb-3",children:g})]}),a.jsx("div",{className:"text-center pt-4",children:a.jsxs("p",{className:"text-lg font-bold text-black mt-2",children:["TOTAL: R$ ",o.totalItens.toFixed(2)]})}),a.jsxs("div",{className:"text-center mt-8 pt-4 border-t border-black text-xs text-black",children:[a.jsx("p",{children:"Obrigado pela preferncia!"}),a.jsx("p",{className:"mt-2",children:"Fluxo7Arena"})]})]})}),a.jsx("style",{children:`
        @media print {
          body {
            margin: 0;
            padding: 0;
            background: white;
          }
          .print\\:hidden {
            display: none !important;
          }
          .print\\:border-0 {
            border: none !important;
          }
          .print\\:p-0 {
            padding: 0 !important;
          }
        }
      `})]})}const glt="18810778",sv={hidden:{opacity:0,x:20},visible:{opacity:1,x:0,transition:{duration:.3}},exit:{opacity:0,x:-20,transition:{duration:.2}}};function xlt(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2").substring(0,18)}function vlt(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").substring(0,15)}async function ylt(){try{const{data:e,error:t}=await Q.from("empresas").select("codigo_empresa").order("codigo_empresa",{ascending:!1}).limit(100);if(t)return console.warn("Erro ao buscar cdigos:",t),"1";let r=0;return e&&e.length>0&&e.forEach(n=>{const s=parseInt(n.codigo_empresa);!isNaN(s)&&s>r&&(r=s)}),(r+1).toString()}catch(e){return console.warn("Erro ao gerar cdigo:",e),"1"}}function blt(){const{toast:e}=Zs(),t=Il(),[r,n]=p.useState(1),[s,o]=p.useState(!1),[i,l]=p.useState(!1),[c,d]=p.useState(""),[u,f]=p.useState({email:"",nomeUsuario:"",cargo:"",razaoSocial:"",nomeFantasia:"",cnpj:"",emailEmpresa:"",telefone:"",endereco:"",quadras:[],mesas:[],categorias:[]}),[h,m]=p.useState(null),x=z=>{z.preventDefault(),c===glt?(l(!0),n(2),e({title:"Acesso liberado",description:"Bem-vindo ao formulrio de criao de empresa."})):(e({title:"Senha incorreta",description:"Tente novamente.",variant:"destructive"}),d(""))},g=()=>!0,v=()=>u.razaoSocial.trim()?u.nomeFantasia.trim()?!0:(e({title:"Nome Fantasia obrigatrio",variant:"destructive"}),!1):(e({title:"Razo Social obrigatria",variant:"destructive"}),!1),y=()=>{r===2&&!g()||r===3&&!v()||n(r+1)},b=()=>{n(r-1)},w=()=>{const z=u.quadras.length+1;f({...u,quadras:[...u.quadras,{nome:`Quadra ${z}`}]})},j=z=>{f({...u,quadras:u.quadras.filter((F,V)=>V!==z)})},_=()=>{const z=u.mesas.length+1;f({...u,mesas:[...u.mesas,{numero:z,nome:`Mesa ${z}`}]})},C=z=>{f({...u,mesas:u.mesas.filter((F,V)=>V!==z)})},E=()=>{const z=prompt("Digite o nome da categoria:");z&&z.trim()&&f({...u,categorias:[...u.categorias,{nome:z.trim(),descricao:""}]})},S=z=>{f({...u,categorias:u.categorias.filter((F,V)=>V!==z)})},A=async()=>{try{o(!0);try{const U={user:{email:u.email?.trim()||null,nome:u.nomeUsuario?.trim()||null,cargo:u.cargo?.trim()||"admin"},empresa:{razao_social:u.razaoSocial?.trim()||null,nome_fantasia:u.nomeFantasia?.trim()||null,cnpj:u.cnpj?u.cnpj.replace(/\D/g,""):null,email:u.emailEmpresa?.trim()||null,telefone:u.telefone?.trim()||null,endereco:u.endereco?.trim()||null},quadras:u.quadras||[],mesas:u.mesas||[],categorias:u.categorias||[]},{data:L,error:H}=await Q.rpc("create_company_full",{payload:U});if(!H&&L&&L.codigo_empresa){m({success:!0,codigoEmpresa:L.codigo_empresa,email:u.email,nomeEmpresa:u.nomeFantasia,numQuadras:(u.quadras||[]).length,numMesas:(u.mesas||[]).length,numCategorias:(u.categorias||[]).length}),n(6),e({title:" Empresa criada com sucesso!",description:`Cdigo: ${L.codigo_empresa}`});return}else H&&console.warn("RPC create_company_full indisponvel/erro. Usando fluxo local.",H?.message||H)}catch(U){console.warn("Falha ao tentar RPC create_company_full. Usando fluxo local.",U?.message||U)}let z=null;u.email.trim()&&(console.log("Email fornecido:",u.email),console.log("Nota: O vnculo com o usurio ser criado no primeiro login"),z=null);const F=await ylt();console.log("Cdigo da empresa gerado:",F);const{data:V,error:me}=await Q.from("empresas").insert({codigo_empresa:F,nome:u.nomeFantasia,razao_social:u.razaoSocial,nome_fantasia:u.nomeFantasia,cnpj:u.cnpj?u.cnpj.replace(/\D/g,""):null,email:u.emailEmpresa||null,telefone:u.telefone||null,endereco:u.endereco||null}).select().single();if(me)throw new Error("Erro ao criar empresa: "+me.message);const{error:be}=await Q.from("empresa_counters").insert({empresa_id:V.id,next_cliente_codigo:1,next_agendamento_codigo:1});if(be&&console.warn("Erro ao criar contador:",be),u.email.trim()||u.nomeUsuario.trim())try{const U="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(ie){const Y=Math.random()*16|0;return(ie==="x"?Y:Y&3|8).toString(16)}),{error:L}=await Q.from("usuarios").insert({id:U,email:u.email||null,nome:u.nomeUsuario||null,papel:u.cargo||"admin",codigo_empresa:F});L&&console.warn("Aviso ao criar usurio:",L.message);const{error:H}=await Q.from("colaboradores").insert({id:U,nome:u.nomeUsuario||"Administrador",cargo:u.cargo||"admin",ativo:!0,codigo_empresa:F});H&&console.warn("Aviso ao criar colaborador:",H.message),u.email&&(console.log(" APS O PRIMEIRO LOGIN, execute este SQL no Supabase:"),console.log(`
-- Atualizar ID do colaborador com o ID real do auth.users
UPDATE public.colaboradores 
SET id = (SELECT id FROM auth.users WHERE email = '${u.email}')
WHERE codigo_empresa = '${F}' AND id = '${U}';

-- Atualizar ID do usurio
UPDATE public.usuarios 
SET id = (SELECT id FROM auth.users WHERE email = '${u.email}')
WHERE codigo_empresa = '${F}' AND id = '${U}';
            `))}catch(U){console.warn("Erro ao criar registros de usurio:",U)}try{await Q.from("agenda_settings").insert({empresa_id:V.id,auto_confirm_enabled:!1,auto_start_enabled:!0,auto_finish_enabled:!0})}catch(U){console.warn("Aviso: no foi possvel criar agenda_settings agora (provvel RLS). Ser configurado aps o primeiro login.",U?.message||U)}if(u.quadras.length>0){const U=u.quadras.map(L=>({nome:L.nome,codigo_empresa:F}));await Q.from("quadras").insert(U)}if(u.mesas.length>0){const U=u.mesas.map(L=>({numero:L.numero,nome:L.nome,codigo_empresa:F,status:"available"}));await Q.from("mesas").insert(U)}if(u.categorias.length>0){const U=u.categorias.map(L=>({nome:L.nome,descricao:L.descricao||null,codigo_empresa:F,ativa:!0}));await Q.from("produto_categorias").insert(U)}m({success:!0,codigoEmpresa:F,email:u.email,nomeEmpresa:u.nomeFantasia,numQuadras:u.quadras.length,numMesas:u.mesas.length,numCategorias:u.categorias.length}),n(6),e({title:" Empresa criada com sucesso!",description:`Cdigo: ${F}`})}catch(z){console.error("Erro ao criar empresa:",z),e({title:"Erro ao criar empresa",description:z.message,variant:"destructive"})}finally{o(!1)}},M=()=>{if(r===1||r===6)return null;const z=(r-1)/4*100;return a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-text-muted",children:["Etapa ",r-1," de 4"]}),a.jsxs("span",{className:"text-sm text-text-muted",children:[Math.round(z),"%"]})]}),a.jsx("div",{className:"h-2 bg-surface-2 rounded-full overflow-hidden",children:a.jsx(Fr.div,{className:"h-full bg-brand",initial:{width:0},animate:{width:`${z}%`},transition:{duration:.3}})})]})},O=()=>a.jsxs(Fr.div,{variants:sv,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-md mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(d0,{className:"w-8 h-8 text-brand"})}),a.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"rea Restrita"}),a.jsx("p",{className:"text-text-muted",children:"Digite a senha para acessar"})]}),a.jsxs("form",{onSubmit:x,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"senha",children:"Senha de Acesso"}),a.jsx(It,{id:"senha",type:"password",value:c,onChange:z=>d(z.target.value),placeholder:"Digite a senha",className:"text-center text-lg tracking-widest",autoFocus:!0})]}),a.jsxs(Z,{type:"submit",className:"w-full",children:["Acessar",a.jsx(d_,{className:"ml-2 h-4 w-4"})]})]})]},"step1"),I=()=>a.jsxs(Fr.div,{variants:sv,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(kf,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Primeiro Usurio"}),a.jsx("p",{className:"text-text-muted",children:"Informaes do administrador da empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"email",children:"Email cadastrado no Supabase Auth"}),a.jsx(It,{id:"email",type:"email",value:u.email,onChange:z=>f({...u,email:z.target.value}),placeholder:"usuario@email.com"}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Este email j deve estar cadastrado no Supabase Auth"})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"nomeUsuario",children:"Nome Completo"}),a.jsx(It,{id:"nomeUsuario",type:"text",value:u.nomeUsuario,onChange:z=>f({...u,nomeUsuario:z.target.value}),placeholder:"Joo Silva"})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"cargo",children:"Cargo na Empresa"}),a.jsx(It,{id:"cargo",type:"text",value:u.cargo,onChange:z=>f({...u,cargo:z.target.value}),placeholder:"Ex: Proprietrio, Gerente, Administrador, Scio, etc."}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Digite o cargo que voc ocupa na empresa"})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx(Z,{type:"button",variant:"outline",onClick:()=>t("/"),className:"flex-1",children:"Cancelar"}),a.jsxs(Z,{type:"button",onClick:y,className:"flex-1",children:["Prximo",a.jsx(d_,{className:"ml-2 h-4 w-4"})]})]})]})]},"step2"),T=()=>a.jsxs(Fr.div,{variants:sv,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(bN,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Dados da Empresa"}),a.jsx("p",{className:"text-text-muted",children:"Informaes cadastrais da empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(ct,{htmlFor:"razaoSocial",children:"Razo Social *"}),a.jsx(It,{id:"razaoSocial",type:"text",value:u.razaoSocial,onChange:z=>f({...u,razaoSocial:z.target.value}),placeholder:"Empresa LTDA"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(ct,{htmlFor:"nomeFantasia",children:"Nome Fantasia *"}),a.jsx(It,{id:"nomeFantasia",type:"text",value:u.nomeFantasia,onChange:z=>f({...u,nomeFantasia:z.target.value}),placeholder:"Minha Empresa"}),a.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Como a empresa aparecer no sistema"})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"cnpj",children:"CNPJ"}),a.jsx(It,{id:"cnpj",type:"text",value:u.cnpj,onChange:z=>f({...u,cnpj:xlt(z.target.value)}),placeholder:"00.000.000/0000-00"})]}),a.jsxs("div",{children:[a.jsx(ct,{htmlFor:"telefone",children:"Telefone"}),a.jsx(It,{id:"telefone",type:"tel",value:u.telefone,onChange:z=>f({...u,telefone:vlt(z.target.value)}),placeholder:"(11) 99999-9999"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(ct,{htmlFor:"emailEmpresa",children:"Email da Empresa"}),a.jsx(It,{id:"emailEmpresa",type:"email",value:u.emailEmpresa,onChange:z=>f({...u,emailEmpresa:z.target.value}),placeholder:"contato@empresa.com"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(ct,{htmlFor:"endereco",children:"Endereo Completo (opcional)"}),a.jsx(It,{id:"endereco",type:"text",value:u.endereco,onChange:z=>f({...u,endereco:z.target.value}),placeholder:"Rua X, 123, Bairro, Cidade - UF"})]})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(Z,{type:"button",variant:"outline",onClick:b,className:"flex-1",children:[a.jsx(Fb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(Z,{type:"button",onClick:y,className:"flex-1",children:["Prximo",a.jsx(d_,{className:"ml-2 h-4 w-4"})]})]})]})]},"step3"),k=()=>a.jsxs(Fr.div,{variants:sv,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(Wc,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Configurao Inicial"}),a.jsx("p",{className:"text-text-muted",children:"Adicione dados iniciais ou pule esta etapa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Gue,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Quadras Esportivas"})]}),a.jsxs(Z,{type:"button",onClick:w,size:"sm",className:"gap-2",children:[a.jsx(so,{className:"w-4 h-4"}),"Adicionar Quadra"]})]}),u.quadras.length>0?a.jsx("div",{className:"space-y-2",children:u.quadras.map((z,F)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:z.nome}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",onClick:()=>j(F),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(Hc,{className:"w-4 h-4"})})]},F))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma quadra adicionada"})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(mc,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Mesas da Loja"})]}),a.jsxs(Z,{type:"button",onClick:_,size:"sm",className:"gap-2",children:[a.jsx(so,{className:"w-4 h-4"}),"Adicionar Mesa"]})]}),u.mesas.length>0?a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:u.mesas.map((z,F)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:z.nome}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(F),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(Hc,{className:"w-4 h-4"})})]},F))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma mesa adicionada"})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(bu,{className:"w-5 h-5 text-brand"}),a.jsx("h3",{className:"font-semibold text-text-primary",children:"Categorias de Produtos"})]}),a.jsxs(Z,{type:"button",onClick:E,size:"sm",className:"gap-2",children:[a.jsx(so,{className:"w-4 h-4"}),"Adicionar Categoria"]})]}),u.categorias.length>0?a.jsx("div",{className:"space-y-2",children:u.categorias.map((z,F)=>a.jsxs("div",{className:"flex items-center justify-between bg-background rounded-md p-3 border border-border",children:[a.jsx("span",{className:"text-sm text-text-primary",children:z.nome}),a.jsx(Z,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(F),className:"h-8 w-8 p-0 text-danger hover:text-danger hover:bg-danger/10",children:a.jsx(Hc,{className:"w-4 h-4"})})]},F))}):a.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"Nenhuma categoria adicionada"})]}),a.jsx("div",{className:"bg-info/10 border border-info/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pd,{className:"w-5 h-5 text-info mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Configuraes Opcionais"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Voc pode adicionar quadras, mesas e categorias agora ou configurar depois no sistema."})]})]})}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(Z,{type:"button",variant:"outline",onClick:b,className:"flex-1",children:[a.jsx(Fb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsxs(Z,{type:"button",onClick:y,className:"flex-1",children:["Prximo",a.jsx(d_,{className:"ml-2 h-4 w-4"})]})]})]})]},"step4"),q=()=>a.jsxs(Fr.div,{variants:sv,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand/10 rounded-full mb-4",children:a.jsx(Di,{className:"w-8 h-8 text-brand"})}),a.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Reviso Final"}),a.jsx("p",{className:"text-text-muted",children:"Confira os dados antes de criar a empresa"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(kf,{className:"w-5 h-5"}),"Primeiro Usurio"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.email})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Nome:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.nomeUsuario})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Cargo:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.cargo})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(bN,{className:"w-5 h-5"}),"Empresa"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Razo Social:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.razaoSocial})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Nome Fantasia:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.nomeFantasia})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"CNPJ:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.cnpj})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.emailEmpresa})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Telefone:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.telefone})]}),u.endereco&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Endereo:"}),a.jsx("span",{className:"text-text-primary font-medium text-right",children:u.endereco})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsxs("h3",{className:"font-semibold text-text-primary mb-4 flex items-center gap-2",children:[a.jsx(Wc,{className:"w-5 h-5"}),"Configuraes Iniciais"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Quadras:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.quadras.length})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Mesas:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.mesas.length})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Categorias de Produtos:"}),a.jsx("span",{className:"text-text-primary font-medium",children:u.categorias.length})]})]})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pd,{className:"w-5 h-5 text-warning mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:"Ateno"}),a.jsx("p",{className:"text-xs text-text-muted",children:"Esta ao criar a empresa no banco de dados. Certifique-se de que todos os dados esto corretos."})]})]})}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsxs(Z,{type:"button",variant:"outline",onClick:b,className:"flex-1",disabled:s,children:[a.jsx(Fb,{className:"mr-2 h-4 w-4"}),"Voltar"]}),a.jsx(Z,{type:"button",onClick:A,className:"flex-1 bg-emerald-600 hover:bg-emerald-500",disabled:s,children:s?a.jsxs(a.Fragment,{children:[a.jsx(cl,{className:"mr-2 h-4 w-4 animate-spin"}),"Criando..."]}):a.jsx(a.Fragment,{children:" Criar Empresa"})})]})]})]},"step5"),B=()=>a.jsxs(Fr.div,{variants:sv,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-success/10 rounded-full mb-6",children:a.jsx(Di,{className:"w-12 h-12 text-success"})}),a.jsx("h2",{className:"text-3xl font-bold text-text-primary mb-2",children:" Empresa Criada!"}),a.jsx("p",{className:"text-text-muted",children:"Tudo pronto para comear a usar o sistema"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-brand/10 border border-brand/30 rounded-lg p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-text-muted mb-2",children:"Cdigo da Empresa"}),a.jsx("p",{className:"text-3xl font-bold text-brand font-mono",children:h?.codigoEmpresa})]})}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Dados de Acesso"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Email:"}),a.jsx("span",{className:"text-text-primary font-medium",children:h?.email})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-text-muted",children:"Senha:"}),a.jsx("span",{className:"text-text-primary font-medium",children:"(a que voc definiu no Supabase)"})]})]})]}),a.jsxs("div",{className:"bg-surface-2 border border-border rounded-lg p-6",children:[a.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Dados Criados"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Empresa"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Configuraes"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numQuadras}),a.jsx("div",{className:"text-xs text-text-muted",children:"Quadras"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numMesas}),a.jsx("div",{className:"text-xs text-text-muted",children:"Mesas"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:h?.numCategorias}),a.jsx("div",{className:"text-xs text-text-muted",children:"Categorias"})]}),a.jsxs("div",{className:"text-center p-4 bg-background rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-brand mb-1",children:""}),a.jsx("div",{className:"text-xs text-text-muted",children:"Pronto para Uso"})]})]})]}),a.jsx("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pd,{className:"w-5 h-5 text-warning mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:" IMPORTANTE: Execute o SQL Antes de Fazer Login"}),a.jsxs("div",{className:"space-y-2 text-xs text-text-muted",children:[a.jsx("p",{className:"font-semibold text-text-primary",children:"Para vincular seu usurio  empresa, siga estes passos:"}),a.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[a.jsxs("li",{children:["Abra o ",a.jsx("strong",{children:"Console do Navegador"})," (pressione F12)"]}),a.jsxs("li",{children:["Procure pela mensagem ",a.jsx("strong",{children:'" APS O PRIMEIRO LOGIN, execute este SQL"'})]}),a.jsx("li",{children:"Copie o comando SQL que aparece no console"}),a.jsxs("li",{children:["Acesse o ",a.jsx("strong",{children:"Supabase  SQL Editor"})]}),a.jsx("li",{children:"Cole e execute o SQL"}),a.jsx("li",{children:"Agora sim, faa login normalmente"})]}),a.jsx("p",{className:"mt-2 text-warning font-medium",children:' Se no executar o SQL, voc ver o erro "Empresa no vinculada"'})]})]})]})}),a.jsx("div",{className:"pt-4",children:a.jsx(Z,{type:"button",onClick:()=>t("/"),className:"w-full bg-brand hover:bg-brand/90",children:"Ir para Login"})})]})]},"step6");return a.jsx(a.Fragment,{children:a.jsx("div",{className:"min-h-screen bg-background text-text-primary p-8",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[M(),a.jsxs(Pge,{mode:"wait",children:[r===1&&O(),r===2&&I(),r===3&&T(),r===4&&k(),r===5&&q(),r===6&&B()]})]})})})}const wlt=()=>a.jsx(Fr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex justify-start mb-6",children:a.jsxs("div",{className:"flex items-end gap-3 max-w-[85%] md:max-w-[75%]",children:[a.jsx(dl,{size:"md",variant:"message"}),a.jsx("div",{className:"px-4 py-3 bg-brand border border-brand backdrop-blur-sm rounded-2xl rounded-bl-sm shadow-lg shadow-brand/20",children:a.jsx("div",{className:"flex gap-1.5",children:[0,1,2].map(e=>a.jsx(Fr.div,{className:"w-2.5 h-2.5 md:w-2 md:h-2 bg-[#0A0A0A] rounded-full",animate:{y:[0,-6,0],opacity:[.4,1,.4]},transition:{duration:.8,repeat:1/0,delay:e*.2,ease:"easeInOut"}},e))})})]})}),jlt=({buttons:e,onSelect:t,disabled:r=!1,hideText:n=!1,hidden:s=!1})=>a.jsx(Fr.div,{initial:{opacity:0,y:10,gridTemplateRows:"1fr"},animate:{opacity:s?0:1,y:s?-8:0,gridTemplateRows:s?"0fr":"1fr"},transition:{duration:.6,ease:[.16,1,.3,1]},className:`grid ml-12 md:ml-[68px] overflow-hidden transition-all duration-500 ${s?"mb-0 md:mb-0 pointer-events-none":"mb-2 md:mb-3"}`,children:a.jsx("div",{className:"flex flex-wrap gap-2 md:gap-2.5",children:e.map((o,i)=>a.jsx(Fr.button,{initial:{opacity:0,scale:.92,y:4,filter:"blur(2px)"},animate:{opacity:s||n?0:1,scale:s?.96:1,y:s?-8:0,filter:s?"blur(3.5px)":"blur(0px)"},transition:{duration:s?.4:.45,delay:s?i*.03:.2+i*.05,ease:[.16,1,.3,1]},whileHover:{scale:r?1:1.02,y:r?0:-2},whileTap:{scale:r?1:.98},onClick:()=>!r&&t(o),disabled:r,className:`
              group relative px-5 py-3.5 md:px-6 md:py-4 rounded-xl font-semibold text-[15px] md:text-[15px]
              transition-all duration-300 ease-out
              ${r?"bg-surface/30 text-text-muted cursor-not-allowed border border-white/5":"bg-surface/70 backdrop-blur-sm text-text-primary border border-white/10 hover:border-brand/70 hover:bg-brand/10 hover:text-brand hover:shadow-lg hover:shadow-brand/20 shadow-md"}
              ${n?"opacity-0 pointer-events-none":""}
            `,children:a.jsxs("div",{className:"flex flex-col gap-0.5 md:gap-1 relative z-10",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[o.icon&&!n&&a.jsx("span",{className:`text-base md:text-lg transition-transform duration-300 ${!r&&"group-hover:scale-110"}`,children:o.icon}),!n&&a.jsx("span",{className:"font-semibold",children:o.label})]}),o.subtitle&&!n&&a.jsx("span",{className:"text-[12px] md:text-xs opacity-70 pl-6 md:pl-7 font-normal",children:o.subtitle})]})},o.value||i))})}),_lt=({children:e,onButtonClick:t,hideButtonTexts:r=!1})=>{const{messages:n,isTyping:s,chatEndRef:o}=p5(),[i,l]=p.useState(0),[c,d]=p.useState(void 0);return p.useEffect(()=>{const u=f=>{const h=!!f?.detail?.expanded,m=typeof window<"u"&&window.innerWidth<768,x=m?280:320,g=140,v=m?8:20,y=Math.max(0,x-g+v);l(h?y:0),d(h&&m?0:void 0)};try{window.addEventListener("isis-participantes-expand",u)}catch{}return()=>{try{window.removeEventListener("isis-participantes-expand",u)}catch{}}},[]),a.jsxs("div",{className:"flex flex-col min-h-full",children:[a.jsxs("div",{className:"flex-1 px-3 md:px-6 py-4 md:py-8",style:{paddingBottom:i,paddingTop:c},children:[n.map(u=>a.jsxs(Fr.div,{layout:"position",transition:{duration:.35,ease:[.16,1,.3,1]},children:[a.jsx(Foe,{message:u}),u.type==="buttons"&&u.buttons&&a.jsx("div",{className:`overflow-hidden transition-all duration-500 ${u.buttonsHidden?"max-h-0 mb-0 md:mb-0":"max-h-[480px]"}`,children:a.jsx(jlt,{buttons:u.buttons,onSelect:f=>(t||u.onButtonClick)?.(f,u.id),disabled:u.disabled,hideText:r,hidden:!!u.buttonsHidden})})]},u.id)),s&&a.jsx(wlt,{}),a.jsx("div",{ref:o})]}),a.jsx("div",{className:"sticky bottom-0 px-3 md:px-6 pb-3 md:pb-6 pt-3 md:pt-4 bg-gradient-to-t from-background via-background to-transparent",children:e})]})},Nlt=({onSubmit:e,onMudarData:t,onMudarQuadra:r,hasMultipleQuadras:n=!1,disabled:s=!1,horariosDisponiveis:o=[],esportes:i=[]})=>{const[l,c]=p.useState(""),[d,u]=p.useState(""),[f,h]=p.useState(""),m=o.map((g,v)=>{let y=o[v].fim,b=0,w=v+1;for(;w<o.length&&o[w].inicio===y;)b++,y=o[w].fim,w++;const j=b>=1;return{value:g.inicio,label:g.inicio,available:j}}),x=(()=>{if(!l)return[];const g=o.findIndex(w=>w.inicio===l);if(g===-1)return[];const v=[];let y=o[g].fim,b=0;for(let w=g+1;w<o.length;w++){const j=o[w];if(j.inicio!==y)break;b++,b>=1&&v.push({value:j.fim,label:j.fim,available:!0}),y=j.fim}return v})();return p.useEffect(()=>{l&&d&&f&&!s&&e({inicio:l,fim:d,esporte:f})},[l,d,f]),p.useEffect(()=>{l&&u("")},[l]),a.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-sm md:text-xs",children:[a.jsx(pu,{className:"w-4 h-4"}),a.jsx("span",{className:"font-medium",children:"Horrio desejado"})]}),a.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"horario-inicio",className:"text-xs text-text-muted mb-1 block",children:"Incio"}),a.jsxs(Zn,{value:l,onValueChange:c,disabled:s,children:[a.jsx(Yn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsx(Jn,{className:"max-h-[300px] z-[60]",children:m.filter(g=>g.available).map(g=>a.jsx(nt,{value:g.value,children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx(pu,{className:"w-4 h-4 opacity-80"}),g.label]})},g.value))})]})]}),a.jsx("div",{className:"text-text-muted font-bold text-lg pt-5",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"horario-fim",className:"text-xs text-text-muted mb-1 block",children:"Trmino"}),a.jsxs(Zn,{value:d,onValueChange:u,disabled:!l||s,children:[a.jsx(Yn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(ta,{placeholder:"Selecione"})}),a.jsx(Jn,{className:"max-h-[300px] z-[60]",children:x.filter(g=>g.available).map(g=>a.jsx(nt,{value:g.value,children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx(pu,{className:"w-4 h-4 opacity-80"}),g.label]})},g.value))})]})]})]}),a.jsxs("div",{className:"flex items-end gap-2 md:gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"esporte",className:"text-xs text-text-muted mb-1 block",children:"Esporte"}),a.jsxs(Zn,{value:f,onValueChange:h,disabled:s,children:[a.jsx(Yn,{className:"w-full bg-surface/70 backdrop-blur-sm border-white/10 text-[15px] md:text-sm",children:a.jsx(ta,{placeholder:"Selecione o esporte"})}),a.jsx(Jn,{className:"max-h-[300px] z-[60]",children:i.map(g=>a.jsx(nt,{value:g,children:g},g))})]})]}),t&&a.jsxs(Fr.button,{type:"button",onClick:t,disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
              px-4 py-2.5 rounded-xl font-medium text-sm
              transition-all duration-300 shrink-0
              flex items-center gap-2
              ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/70 backdrop-blur-sm border border-white/10 text-text-primary hover:bg-surface/90 hover:border-white/20"}
            `,children:[a.jsx(Io,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden md:inline",children:"Mudar Data"}),a.jsx("span",{className:"md:hidden",children:"data"})]}),n&&r&&a.jsxs(Fr.button,{type:"button",onClick:r,disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
              px-4 py-2.5 rounded-xl font-medium text-sm
              transition-all duration-300 shrink-0
              flex items-center gap-2
              ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/70 backdrop-blur-sm border border-white/10 text-text-primary hover:bg-surface/90 hover:border-white/20"}
            `,children:[a.jsx(jd,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden md:inline",children:"Mudar Quadra"}),a.jsx("span",{className:"md:hidden",children:"Quadra"})]})]})]})},Slt=({onSubmit:e,tipo:t,onTrocarTipo:r,disabled:n=!1,mostrarBotaoTrocar:s=!0})=>{const[o,i]=p.useState(""),[l,c]=p.useState(!1),[d,u]=p.useState(!1);p.useEffect(()=>{i("")},[t]);const f=w=>{if(w){const j=dr(w,"dd/MM/yyyy",{locale:$a});i(j),u(!1)}},h=w=>{const j=w.replace(/\D/g,"");return j.length<=2?`(${j}`:j.length<=7?`(${j.slice(0,2)}) ${j.slice(2)}`:j.length===10?`(${j.slice(0,2)}) ${j.slice(2,6)}-${j.slice(6)}`:j.length===11?`(${j.slice(0,2)}) ${j.slice(2,7)}-${j.slice(7)}`:`(${j.slice(0,2)}) ${j.slice(2,7)}-${j.slice(7,11)}`},m=w=>{const j=w.replace(/\D/g,"");return j.length<=2?j:j.length<=4?`${j.slice(0,2)}/${j.slice(2)}`:j.length<=8?`${j.slice(0,2)}/${j.slice(2,4)}/${j.slice(4)}`:`${j.slice(0,2)}/${j.slice(2,4)}/${j.slice(4,8)}`},x=w=>{const j=w.target.value;if(t==="telefone"){const _=h(j);i(_)}else if(t==="data_custom"){const _=m(j);i(_)}else i(j)},g=w=>{if(w.preventDefault(),!(!o.trim()||n))if(t==="telefone"){const j=o.replace(/\D/g,"");j.length===11&&(e(j),i(""))}else t==="data_custom"?o.trim()&&(e(o.trim()),i("")):o.includes("@")&&o.includes(".")&&(e(o.trim()),i(""))},v=w=>{w.key==="Enter"&&(w.preventDefault(),g(w))},y=w=>{if(w.length!==10)return{valida:!1,erro:"Data incompleta"};const j=/^(\d{2})\/(\d{2})\/(\d{4})$/,_=w.match(j);if(!_)return{valida:!1,erro:"Formato invlido"};const[,C,E,S]=_,A=new Date(parseInt(S),parseInt(E)-1,parseInt(C));if(isNaN(A.getTime())||A.getDate()!==parseInt(C)||A.getMonth()!==parseInt(E)-1||A.getFullYear()!==parseInt(S))return{valida:!1,erro:"Data invlida"};const M=new Date;return M.setHours(0,0,0,0),A.setHours(0,0,0,0),A<M?{valida:!1,erro:"Data no passado"}:{valida:!0,erro:null}},b=()=>t==="telefone"?o.replace(/\D/g,"").length===11:t==="data_custom"?y(o).valida:o.includes("@")&&o.includes(".");return a.jsxs(Fr.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},onSubmit:g,className:"flex flex-col gap-3 max-w-md mx-auto",children:[a.jsx("div",{className:"relative",children:a.jsxs("div",{className:`
          flex items-center gap-2 px-3 py-2.5 rounded-xl
          bg-surface/70 backdrop-blur-sm
          border-2 transition-all duration-300
          ${l?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
        `,children:[t!=="data_custom"&&a.jsx("div",{className:`
              shrink-0 transition-colors duration-300
              ${l?"text-brand":"text-text-muted"}
            `,children:t==="telefone"?a.jsx(Tw,{className:"w-4 h-4"}):a.jsx(u0,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex-1 relative flex items-center",children:[a.jsx("input",{type:t==="data_custom"?"text":t==="telefone"?"tel":"email",value:o,onChange:x,onKeyDown:v,onFocus:()=>c(!0),onBlur:()=>c(!1),placeholder:t==="telefone"?"(00) 00000-0000":t==="data_custom"?"DD/MM/AAAA":"email@exemplo.com",disabled:n,className:`
                w-full bg-transparent text-text-primary placeholder:text-text-muted
                outline-none text-[17px] md:text-base font-medium
                ${t==="data_custom"?"pr-12":""}
                ${n?"opacity-50 cursor-not-allowed":""}
              `}),t==="data_custom"&&a.jsxs(Qo,{open:d,onOpenChange:u,children:[a.jsx(Zo,{asChild:!0,children:a.jsx(Fr.button,{type:"button",whileHover:{scale:1.1},whileTap:{scale:.9},disabled:n,className:`
                      absolute right-1 w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300
                      bg-brand/10 text-brand hover:bg-brand hover:text-white
                      border border-brand/20 hover:border-brand/40
                      shadow-md hover:shadow-lg hover:shadow-brand/30
                      ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                    `,children:a.jsx(Io,{className:"w-5 h-5"})})}),a.jsx(Go,{className:"w-auto p-0",align:"end",children:a.jsx(ei,{mode:"single",selected:o?(()=>{try{const[w,j,_]=o.split("/");return new Date(parseInt(_),parseInt(j)-1,parseInt(w))}catch{return}})():void 0,onSelect:f,disabled:w=>{const j=new Date;return j.setHours(0,0,0,0),w<j},initialFocus:!0})})]})]}),a.jsx(Fr.button,{type:"submit",whileHover:{scale:b()?1.1:1},whileTap:{scale:b()?.9:1},disabled:!b()||n,className:`
              shrink-0 w-9 h-9 rounded-full flex items-center justify-center transition-all duration-300
              ${b()?"bg-brand text-bg shadow-md hover:shadow-lg hover:shadow-brand/30":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
            `,children:a.jsx(Z4,{className:"w-4 h-4"})})]})}),t==="telefone"&&o&&a.jsx("div",{className:"text-xs text-center",children:(()=>{const w=o.replace(/\D/g,""),j=w.length===11,_=w.length>0&&!j;return j?a.jsx("span",{className:"text-green-400 flex items-center justify-center gap-1",children:" Telefone vlido"}):_?a.jsxs("span",{className:"text-yellow-400 flex items-center justify-center gap-1",children:[" Digite todos os dgitos (",w.length,"/11)"]}):null})()}),t==="data_custom"&&o&&a.jsx("div",{className:"text-xs text-center",children:(()=>{const w=y(o);return w.valida?a.jsx("span",{className:"text-green-400 flex items-center justify-center gap-1",children:" Data vlida"}):o.length>0?a.jsxs("span",{className:"text-red-400 flex items-center justify-center gap-1",children:[" ",w.erro]}):null})()}),s&&t!=="data_custom"&&a.jsx("button",{type:"button",onClick:r,className:"text-sm text-brand/80 hover:text-brand hover:underline self-center py-1 px-3 rounded-lg hover:bg-brand/5 transition-all",children:t==="telefone"?a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(u0,{className:"w-4 h-4"}),"Prefiro usar e-mail"]}):a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(Tw,{className:"w-4 h-4"}),"Prefiro usar telefone"]})})]})},Clt=({onSubmit:e,disabled:t=!1,valorInicial:r=null,tipoInicial:n="telefone",onCorrigirTelefone:s,onCorrigirEmail:o})=>{const[i,l]=p.useState(""),[c,d]=p.useState(n==="telefone"&&r||""),[u,f]=p.useState(n==="email"&&r||""),[h,m]=p.useState(null),x=b=>{const w=b.replace(/\D/g,"");return w.length<=2?`(${w}`:w.length<=7?`(${w.slice(0,2)}) ${w.slice(2)}`:w.length<=11?`(${w.slice(0,2)}) ${w.slice(2,7)}-${w.slice(7,11)}`:`(${w.slice(0,2)}) ${w.slice(2,7)}-${w.slice(7,11)}`},g=b=>{const w=x(b.target.value);d(w)},v=b=>{if(b.preventDefault(),!i.trim())return;const w=c.replace(/\D/g,"").length>=10,j=u.trim().includes("@")&&u.trim().includes(".");if(!w&&!j)return;const _={nome:i.trim(),telefone:w?c.replace(/\D/g,""):null,email:j?u.trim():null};e(_)},y=()=>{if(!i.trim())return!1;const b=c.replace(/\D/g,"").length>=10,w=u.trim().includes("@")&&u.trim().includes(".");return b||w};return a.jsxs(Fr.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},onSubmit:v,className:"flex flex-col gap-3",children:[a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="nome"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(kf,{className:`w-5 h-5 transition-colors ${h==="nome"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"text",value:i,onChange:b=>l(b.target.value),onFocus:()=>m("nome"),onBlur:()=>m(null),placeholder:"Seu nome completo",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="telefone"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(Tw,{className:`w-5 h-5 transition-colors ${h==="telefone"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"tel",value:c,onChange:g,onFocus:()=>m("telefone"),onBlur:()=>m(null),placeholder:"(00) 00000-0000",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),a.jsxs("div",{className:`
        flex items-center gap-3 px-4 py-3 rounded-2xl
        bg-surface/70 backdrop-blur-sm
        border-2 transition-all duration-300
        ${h==="email"?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
      `,children:[a.jsx(u0,{className:`w-5 h-5 transition-colors ${h==="email"?"text-brand":"text-text-muted"}`}),a.jsx("input",{type:"email",value:u,onChange:b=>f(b.target.value),onFocus:()=>m("email"),onBlur:()=>m(null),placeholder:"email@exemplo.com (opcional)",disabled:t,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-[17px] md:text-base font-medium"})]}),(s||o)&&a.jsx("div",{className:"-mt-1 mb-1",children:n==="email"&&o?a.jsx("button",{type:"button",onClick:o,className:"text-xs text-brand/80 hover:text-brand underline underline-offset-4 px-1 py-0.5 rounded-md hover:bg-brand/5",children:"Informei o e-mail errado"}):s&&a.jsx("button",{type:"button",onClick:s,className:"text-xs text-brand/80 hover:text-brand underline underline-offset-4 px-1 py-0.5 rounded-md hover:bg-brand/5",children:"Informei o telefone errado"})}),a.jsxs(Fr.button,{type:"submit",whileHover:{scale:y()?1.02:1},whileTap:{scale:y()?.98:1},disabled:!y()||t,className:`
          flex items-center justify-center gap-2 py-3 px-6 rounded-2xl
          font-semibold text-base transition-all duration-300
          ${y()?"bg-brand text-bg shadow-lg shadow-brand/20 hover:shadow-xl hover:shadow-brand/30":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
        `,children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})}),"Continuar"]}),a.jsx("p",{className:"text-xs text-text-muted text-center",children:"Preencha pelo menos telefone ou e-mail"})]})},Alt=({participantesAtuais:e=[],onAdicionar:t,onRemover:r,onFinalizar:n,disabled:s=!1,onAdicionarLote:o,selfName:i,onFixedRolesDetected:l,initialModalidade:c="",modalidadeOptions:d=[]})=>{const[u,f]=p.useState(""),[h,m]=p.useState(!1),[x,g]=p.useState(!1),v=p.useRef(null),[y,b]=p.useState(!1),[w,j]=p.useState(""),[_,C]=p.useState(!1),[E,S]=p.useState([]),[A,M]=p.useState([]),[O,I]=p.useState({}),[T,k]=p.useState(!1),[q,B]=p.useState(!1),[z,F]=p.useState(null),[V,me]=p.useState(!1),be=p.useRef(null),U=p.useRef(null),[L,H]=p.useState(c||"");p.useEffect(()=>{H(c||"")},[c]),p.useEffect(()=>{const he=()=>{g(window.innerWidth<768)};return he(),window.addEventListener("resize",he),()=>window.removeEventListener("resize",he)},[]),p.useEffect(()=>{if(y){const he=document.body.style.overflow;return document.body.style.overflow="hidden",S([]),M([]),I({}),k(!1),B(!1),F(null),()=>{document.body.style.overflow=he}}},[y]),p.useEffect(()=>{if(y&&re&&(!E||E.length===0)){const he=Y(re);S([re]),I({[he]:!0}),F(he),B(!0),k(!0)}},[y]);const ie=he=>he.normalize("NFD").replace(/[\u0300-\u036f]/g,""),Y=he=>ie(String(he||"").trim().toLowerCase()).replace(/\s+/g," "),W=he=>String(he||"").replace(/^\s*[*-]+/g,"").replace(/^\s*\d+\s*[\-\)\.]\s*/g,"").replace(/^[\W_]+|[\W_]+$/g,"").replace(//g,"").replace(/@[\S]+/g,"").replace(/\(\s*[mf]\s*\)/gi,"").replace(/\(\s*[mf][^)]*\)?/gi,"").replace(/\s{2,}/g," ").trim(),se=he=>/^(espera|lista\s+de\s+espera)\b/i.test(ie(String(he||"").trim().toLowerCase())),pe=he=>/^(jogador|jogadores|goleiro|goleiros|convocado|convocados|jogadore?s)\b/i.test(ie(String(he||"").trim().toLowerCase())),G=he=>{const ot=ie(String(he||"")).trim().toLowerCase();return/^(jogador|jogadores|goleiro|goleiros|convocado|convocados|levantador|levantadores)\b/.test(ot)||/^(lista\s+de\s+espera|convidad\w*)\b/.test(ot)},te=he=>{const ot=String(he||"").split(/\r?\n/);let Vt=!1,qt=!1;const Re=[];for(const Er of ot){const Me=String(Er||"").trim();if(!Me)continue;if(se(Me)){Vt=!0;continue}if(Vt)continue;if(pe(Me)){qt=!0;continue}if(!qt)continue;const lt=W(Me),gt=/[A-Za-z---]/.test(lt);lt&&lt.length>=2&&lt.length<=60&&gt&&!/[0-9@]/.test(lt)&&Re.push(lt.split(/\s+/).map(br=>br&&br[0].toUpperCase()+br.slice(1).toLowerCase()).join(" "))}const Ct=new Set,Wt=[];for(const Er of Re){const Me=Y(Er);!Me||Ct.has(Me)||(Ct.add(Me),Wt.push(Er))}return Wt},oe=he=>/^(reservas?)\b/i.test(ie(String(he||"").trim().toLowerCase())),De=he=>{const ot=String(he||"").split(/\r?\n/),Vt=[];let qt=!1,Re=!1;for(const Ct of ot){const Wt=String(Ct||"").trim();if(!Wt)continue;if(se(Wt)){qt=!0,Re=!1;continue}if(pe(Wt)||oe(Wt)){qt=!1,Re=!0;continue}if(qt||!Re)continue;const Er=W(Wt),Me=/[A-Za-z---]/.test(Er);if(!(Er&&Er.length>=2&&Er.length<=60&&Me&&!/[0-9@]/.test(Er)))continue;const gt=Er.split(/\s+/).map(or=>or&&or[0].toUpperCase()+or.slice(1).toLowerCase()).join(" ");G(gt)||Vt.push(gt)}return Vt};new Set((e||[]).map(he=>Y(he.nome)));const re=i?String(i).trim():e&&e[0]&&e[0].nome?String(e[0].nome).trim():null,ae=re?Y(re):null,ut=he=>ie(String(he||"").toLowerCase()).split(/\s+/).map(ot=>ot.trim()).filter(ot=>ot.length>=3),pt=he=>{if(!re)return!1;const ot=String(he||"").trim();if(!ot)return!1;if(Y(ot)===ae)return!0;const Vt=ut(re),qt=ut(ot);return Vt.length===0||qt.length===0?!1:qt.some(Re=>Vt.includes(Re))},ft=he=>{const ot=new Set;if(!he)return ot;const Vt=String(he).split(/\r?\n/);let qt=!1;for(let Re of Vt){const Ct=ie(String(Re||"")).toLowerCase().trim();if(!qt){/^\s*[*\-]?\s*((lista\s+de\s+)?espera|convidad\w*)\b[\s:]*$/i.test(Ct)&&(qt=!0);continue}if(/^\s*\*\s*\w+|^\s*(convocad|jogad|levanta|goleir)\w*/i.test(ie(Re))){qt=!1;continue}const Wt=String(Re).replace(/^\s*[*\-]+\s*/g,"").replace(/^\s*\d+\)?\s*/g,"").replace(/^[\W_]+/,"").trim(),Er=/[A-Za-z---]/.test(Wt);Wt&&Er&&!/[0-9@]/.test(Wt)&&Wt.length>=2&&Wt.length<=60&&ot.add(Y(Wt))}return ot},bt=he=>{const ot=String(he||"").split(/\r?\n/),Vt={levantadores:[],goleiros:[]};let qt=null;for(let Re of ot){const Ct=ie(String(Re||"")).toLowerCase().trim();if(/^\s*[*\-]?\s*levanta(dor|dores|dor(es)?)\b/i.test(Ct)){qt="levantadores";continue}if(/^\s*[*\-]?\s*goleir(o|os|a|as)\b/i.test(Ct)){qt="goleiros";continue}if(qt){if(/(^|\s)jogador(e|es)\b/.test(Ct)){qt=null;continue}if(/^\s*[*\-]?\s*(convocad|lista\s+de\s+(espera|reserva)|convidad)\b/i.test(Ct)){qt=null;continue}if(/^\s*[*_]{1,3}\s*[a-z-]+/i.test(Ct)){qt=null;continue}if(/^\s*[*\-]?\s*(levanta|goleir)\b/i.test(Ct)){qt=null;continue}}if(!qt)continue;const Wt=String(Re).replace(/^\s*[*\-]+\s*/g,"").replace(/^\s*\d+\)?\s*/g,"").replace(/^[\W_]+/,"").trim(),Er=/[A-Za-z---]/.test(Wt);if(!(Wt&&Er&&!/[0-9@]/.test(Wt)&&Wt.length>=2&&Wt.length<=60))continue;const lt=Wt.toLowerCase().split(/\s+/).map(or=>or&&or[0].toUpperCase()+or.slice(1)).join(" "),gt=Y(lt);qt==="levantadores"?Vt.levantadores.some(or=>Y(or)===gt)||Vt.levantadores.push(lt):qt==="goleiros"&&(Vt.goleiros.some(or=>Y(or)===gt)||Vt.goleiros.push(lt))}return Vt},Lt=he=>{he.preventDefault(),!(!u.trim()||s)&&(t(u.trim()),f(""),setTimeout(()=>{v.current?.focus()},100))},Dt=he=>{he.key==="Enter"&&!x&&(he.preventDefault(),he.shiftKey?n&&n(L):Lt(he))},Bt=async()=>{if(w.trim()){C(!0),S([]),M([]),I({});try{try{console.group("[Isis Import] start"),console.debug("[Isis Import] input.length=%s preview=%o",w.length,w.slice(0,180))}catch{}const{data:he,error:ot}=await Q.functions.invoke("parse-participants",{body:{text:w,locale:"pt-BR"}});if(ot)throw ot;if(he&&typeof he.source=="string"){console.log("[Isis Import] source=",he.source);try{console.debug("[Isis Import] edge.meta keys=%o",Object.keys(he||{}))}catch{}}const Vt=ft(w);try{console.debug("[Isis Import] waitlist.count=%s sample=%o",Vt.size,Array.from(Vt).slice(0,8))}catch{}const qt=Array.isArray(he?.roles?.levantadores)?he.roles.levantadores:[],Re=Array.isArray(he?.roles?.goleiros)?he.roles.goleiros:[],Ct=qt.length||Re.length?{levantadores:qt,goleiros:Re}:bt(w);try{console.debug("[Isis Import] roles.edge lev=%s gol=%s",qt.length,Re.length)}catch{}try{qt.length||Re.length||console.debug("[Isis Import] roles.local lev=%s gol=%s",Ct.levantadores.length,Ct.goleiros.length)}catch{}const Wt=Array.isArray(he?.extracted)?he.extracted:[];let Er=Wt.filter(pn=>!Vt.has(Y(pn)));Er=Er.filter(pn=>!G(pn));try{console.debug("[Isis Import] extracted.raw=%s filtered=%s sample=%o",Wt.length,Er.length,Er.slice(0,10))}catch{}try{if(Er.length<6&&/(goleir|jogador)/i.test(ie(w))){const on=te(w);try{console.debug("[Isis Import] local.mainOnly=%s sample=%o",on.length,on.slice(0,10))}catch{}const cn=[...Er],ke=new Set(cn.map(Y));for(const We of on){const Ze=Y(We);!Ze||ke.has(Ze)||Vt.has(Ze)||(ke.add(Ze),cn.push(We))}Er=cn.filter(We=>!G(We));try{console.debug("[Isis Import] boosted.count=%s",Er.length)}catch{}}}catch{}const Me=Er.some(pn=>pt(pn)),lt=Array.isArray(he?.invalid)?he.invalid:[],gt=[],or=new Set;for(const pn of Er){const on=W(pn);if(!on)continue;const cn=Y(on);if(!cn||or.has(cn))continue;or.add(cn);const ke=on.split(/\s+/).map(We=>We&&We[0].toUpperCase()+We.slice(1).toLowerCase()).join(" ");gt.push(ke)}try{console.debug("[Isis Import] uniques.count=%s sample=%o",gt.length,gt.slice(0,12))}catch{}try{console.debug("[Isis Import] invalid.count=%s sample=%o",lt.length,lt.slice(0,6))}catch{}try{console.debug("[Isis Import] detectedSelf=%s self=%o",Me,re)}catch{}const br=te(w),ur=new Map(br.map((pn,on)=>[Y(pn),on])),an=De(w);let zr=an&&an.length?an.slice(0,200):(()=>{const pn=gt.map((on,cn)=>({n:on,i:cn}));return pn.sort((on,cn)=>{const ke=ur.has(Y(on.n))?ur.get(Y(on.n)):Number.MAX_SAFE_INTEGER,We=ur.has(Y(cn.n))?ur.get(Y(cn.n)):Number.MAX_SAFE_INTEGER;return ke!==We?ke-We:on.i-cn.i}),pn.map(on=>on.n).slice(0,50)})(),Gr=zr.findIndex(pn=>pt(pn));if(Gr>=0){const pn=zr[Gr];F(Y(pn)),zr=[pn,...zr.filter((on,cn)=>cn!==Gr)]}else if(re){const pn=Y(re);F(pn),B(!0),zr=[re,...zr]}else F(null);S(zr),M(lt);const ha={};re&&(ha[Y(re)]=!0),gt.slice(0,50).forEach(pn=>{ha[Y(pn)]=!0}),I(ha),k(!0),B(Me||!!re);try{typeof l=="function"?l(Ct):window.dispatchEvent(new CustomEvent("isis:fixed-roles",{detail:Ct}))}catch{}try{console.debug("[Isis Import] final.suggested.count=%s sample=%o",zr.length,zr.slice(0,12))}catch{}try{console.groupEnd?.()}catch{}}catch(he){try{console.error("[Isis Import] error=%o",he)}catch{}const ot=ft(w),Vt=bt(w),qt=w.split(/[\n,;]+/).map(lt=>lt.trim()).filter(Boolean),Re=qt.some(lt=>{const gt=lt.replace(/^[\W_]+|[\W_]+$/g,"");return pt(gt)}),Ct=[],Wt=new Set;for(const lt of qt){const gt=lt.replace(/^[\W_]+|[\W_]+$/g,""),or=Y(gt),br=/[A-Za-z---]/.test(gt);if(!(gt.length>=2&&gt.length<=60&&br&&!/[0-9@]/.test(gt))||!or||ot.has(or)||Wt.has(or))continue;Wt.add(or);const an=gt.toLowerCase().split(/\s+/).map(zr=>zr&&zr[0].toUpperCase()+zr.slice(1)).join(" ");Ct.push(an)}let Er=Ct.slice(0,50);if(re){const lt=Y(re);F(lt),B(!0),Er=[re,...Er]}S(Er);const Me={};re&&(Me[Y(re)]=!0),Ct.slice(0,50).forEach(lt=>{Me[Y(lt)]=!0}),I(Me),k(!0),B(Re||!!re);try{typeof l=="function"?l(Vt):window.dispatchEvent(new CustomEvent("isis:fixed-roles",{detail:Vt}))}catch{}}finally{C(!1)}}},ge=he=>{const ot=Y(he);I(Vt=>({...Vt,[ot]:!Vt[ot]}))},wt=()=>{const he={...O};E.forEach(ot=>{he[Y(ot)]=!0}),I(he)},Gt=()=>{const he={...O};E.forEach(ot=>{he[Y(ot)]=!1}),I(he)},Sr=()=>{const he=E.filter(ot=>{const Vt=Y(ot);return z&&Vt===z?!1:O[Vt]});he.length!==0&&(typeof o=="function"?o(he):he.forEach(ot=>t(ot)),b(!1),j(""),S([]),M([]),I({}))},wr=()=>{j(""),S([]),M([]),I({}),k(!1),B(!1),F(null)};return a.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"flex flex-col gap-3 w-full",children:[a.jsxs("div",{ref:U,className:"flex items-center justify-end gap-2 scroll-mt-24 md:scroll-mt-28",children:[a.jsx("button",{type:"button",disabled:s,onClick:()=>b(!0),className:`px-3 py-1.5 rounded-lg text-sm font-semibold transition-all ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-surface/80 hover:bg-surface/60 border border-white/10 text-text-primary"}`,children:"Importar lista"}),a.jsx("div",{className:"relative",children:a.jsxs(Zn,{value:L,onValueChange:H,disabled:s,children:[a.jsx(Yn,{className:"min-w-[160px] bg-surface/70 backdrop-blur-sm border-white/10 text-sm",children:a.jsx(ta,{placeholder:"Modalidade"})}),a.jsxs(Jn,{className:"max-h-[300px] z-[70]",children:[(Array.isArray(d)?d:[]).map(he=>a.jsx(nt,{value:String(he),children:String(he)},String(he))),(!d||d.length===0)&&a.jsx(nt,{value:"",children:"Selecionar modalidade"})]})]})}),a.jsx("button",{type:"button",onClick:()=>{me(he=>{const ot=!he;try{window.dispatchEvent(new CustomEvent("isis-participantes-expand",{detail:{expanded:ot}}))}catch{}return ot}),setTimeout(()=>{try{U.current?.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},50)},className:`p-2 rounded-lg border transition-all ${V?"bg-white/10 border-brand/40 text-brand shadow-sm":"hover:bg-white/10 border-white/10"}`,"aria-label":V?"Recolher lista":"Expandir lista","aria-pressed":V,children:V?a.jsx(hx,{className:"w-4 h-4"}):a.jsx(Fue,{className:"w-4 h-4"})})]}),e.length>0&&a.jsx("div",{ref:be,className:`flex flex-col gap-1.5 ${V?"max-h-[360px] md:max-h-[320px]":"max-h-[140px]"} overflow-y-auto px-1 transition-all`,children:e.map((he,ot)=>a.jsxs(Fr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm ${he.principal?"bg-brand/10 border border-brand/30":"bg-surface/50 border border-white/10"}`,children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold ${he.principal?"bg-brand/20 text-brand":"bg-white/10 text-text-primary"}`,children:ot+1})}),a.jsx("span",{className:"text-base shrink-0",children:he.principal?"":""}),a.jsxs("span",{className:`flex-1 font-medium truncate ${he.principal?"text-brand":"text-text-primary"}`,children:[he.nome,he.principal&&a.jsx("span",{className:"ml-1.5 text-xs opacity-70",children:"(voc)"})]}),!he.principal&&r&&a.jsx(Fr.button,{type:"button",onClick:()=>r(ot),whileHover:{scale:1.1},whileTap:{scale:.9},className:"shrink-0 p-1 rounded-full hover:bg-red-500/20 text-red-400 hover:text-red-300 transition-colors",title:"Remover participante",children:a.jsx(Hc,{className:"w-4 h-4"})})]},ot))}),a.jsxs("form",{onSubmit:Lt,className:"flex flex-col gap-2",children:[a.jsxs("div",{className:`
          flex items-center gap-2 px-3 py-2.5 rounded-xl
          bg-surface/70 backdrop-blur-sm
          border-2 transition-all duration-300
          ${h?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
        `,children:[a.jsx(ufe,{className:`w-4 h-4 shrink-0 transition-colors ${h?"text-brand":"text-text-muted"}`}),a.jsx("input",{ref:v,type:"text",value:u,onChange:he=>f(he.target.value),onKeyDown:Dt,onFocus:()=>m(!0),onBlur:()=>m(!1),placeholder:x?"Nome":"Nome do participante",disabled:s,autoComplete:"off",className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-base font-medium min-w-0"}),a.jsx(Fr.button,{type:"submit",whileHover:{scale:u.trim()?1.05:1},whileTap:{scale:u.trim()?.95:1},disabled:!u.trim()||s,className:`
              px-3 py-1.5 rounded-lg transition-all duration-300 text-sm font-semibold shrink-0
              ${u.trim()?"bg-brand text-bg shadow-md":"bg-surface-light text-text-muted cursor-not-allowed opacity-50"}
            `,children:"Adicionar"})]}),a.jsx(Fr.button,{type:"button",onClick:()=>n&&n(L),disabled:s,whileHover:{scale:s?1:1.05},whileTap:{scale:s?1:.95},className:`
            w-full px-6 py-3.5 rounded-xl font-bold text-base
            transition-all duration-300
            ${s?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-brand text-bg shadow-lg hover:shadow-xl hover:shadow-brand/30"}
          `,children:a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsx(Fm,{className:"w-5 h-5"}),"Confirmar Participantes (",e.length,")"]})}),!x&&a.jsxs("p",{className:"text-xs text-text-muted text-center mt-1",children:[" ",a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface rounded text-[10px]",children:"Enter"})," adiciona  ",a.jsx("kbd",{className:"px-1.5 py-0.5 bg-surface rounded text-[10px]",children:"Shift+Enter"})," confirma"]})]}),y&&typeof document<"u"&&Km.createPortal(a.jsxs("div",{className:"fixed inset-0 z-[9999] overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black/75 backdrop-blur-sm",onClick:()=>!_&&b(!1)}),a.jsx("div",{className:"min-h-screen flex items-start justify-center pt-24 md:pt-16 pb-8 px-3",children:a.jsxs("div",{className:"relative w-[96vw] max-w-5xl bg-gradient-to-br from-surface via-background to-surface border border-white/10 rounded-3xl shadow-2xl flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"sticky top-0 z-10 px-5 py-4 border-b border-white/10 bg-surface/70 backdrop-blur flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(dl,{size:"sm",variant:"header"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-base md:text-lg font-extrabold text-text-primary leading-tight",children:E.length>0?"Sugestes encontradas":"Importar participantes"}),a.jsx("p",{className:"text-[11px] md:text-xs text-text-muted",children:E.length>0?`Selecione os nomes para adicionar (${E.length})`:"Cole sua lista e processe com IA"})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("button",{type:"button",disabled:_,onClick:()=>b(!1),className:"p-2 rounded-lg hover:bg-white/10",children:a.jsx(Hc,{className:"w-5 h-5"})})})]}),a.jsx("div",{className:"flex-1 max-h-[70vh] overflow-y-auto p-4 md:p-5",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-full",children:[a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("label",{className:"text-xs text-text-muted mb-2",children:"Sua lista"}),a.jsx("textarea",{value:w,onChange:he=>j(he.target.value),disabled:_,placeholder:`Exemplo:
1) Joo Silva
2) Maria Clara
3) Pedro Henrique

Dica: nomes sob os cabealhos 'Lista de espera', 'Lista de reserva' ou 'Convidados' sero ignorados.

Cole sua lista (um por linha ou separados por vrgula) e clique em Processar com sis`,className:"w-full min-h-[320px] max-h-[320px] resize-none overflow-y-auto bg-surface border border-white/10 rounded-xl p-3 outline-none text-sm focus:ring-2 focus:ring-brand/40"}),a.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[a.jsx("button",{type:"button",onClick:wr,disabled:_&&!w.trim(),className:"px-4 py-2 rounded-xl font-semibold bg-surface border border-white/10 text-text-primary hover:bg-white/10 disabled:opacity-60",children:"Apagar"}),a.jsx("button",{type:"button",onClick:Bt,disabled:_||!w.trim(),className:"px-5 py-2.5 rounded-xl font-semibold shadow-lg transition bg-gradient-to-r from-brand to-emerald-500 text-white hover:shadow-emerald-500/30 disabled:opacity-60 disabled:cursor-not-allowed",children:_?"Processando":"Processar com sis"})]})]}),a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[a.jsx("span",{children:"Sugeridos"}),a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/10",children:E.length})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:wt,disabled:_,className:"px-2 py-1 text-xs rounded-lg bg-surface hover:bg-white/10 disabled:opacity-50",children:"Selecionar todos"}),a.jsx("button",{type:"button",onClick:Gt,disabled:_,className:"px-2 py-1 text-xs rounded-lg bg-surface hover:bg-white/10 disabled:opacity-50",children:"Limpar"})]})]}),a.jsx("div",{className:"min-h-[320px] max-h-[320px] overflow-y-auto border border-white/10 rounded-xl bg-surface",children:_?a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative w-5 h-5",children:[a.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-brand to-emerald-500 opacity-30"}),a.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-transparent [border-image:linear-gradient(to_right,var(--tw-gradient-from),var(--tw-gradient-to))_1] animate-spin"})]}),a.jsx("span",{className:"text-xs font-semibold text-text-primary",children:"Processando com IA"})]}),a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-white/10 text-text-muted",children:"Premium"})]}),a.jsx("div",{className:"space-y-2",children:Array.from({length:10}).map((he,ot)=>a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-white/[0.03] overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0 w-full",children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold bg-white/10 text-text-muted",children:ot+1})}),a.jsx("div",{className:"relative h-3 w-full max-w-[220px] rounded bg-white/10 overflow-hidden",children:a.jsx("div",{className:"absolute inset-0 -translate-x-full animate-[shimmer_1.2s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})})]}),a.jsx("div",{className:"h-4 w-4 rounded bg-white/10"})]},ot))}),a.jsx("style",{children:"@keyframes shimmer{100%{transform:translateX(100%);}}"})]}):a.jsx("ul",{className:"divide-y divide-white/5",children:E.map((he,ot)=>{const Vt=Y(he),qt=T&&q&&z&&Vt===z;return a.jsxs("li",{className:`flex items-center justify-between px-3 py-2 ${qt?"bg-white/5":""}`,children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsx("span",{className:"w-7 shrink-0",children:a.jsx("span",{className:`inline-flex items-center justify-center px-2 py-0.5 rounded-md text-[11px] font-extrabold ${qt?"bg-emerald-600/25 text-emerald-400":"bg-white/10 text-text-primary"}`,children:ot+1})}),a.jsx("span",{className:"text-sm truncate pr-1",children:he}),qt&&a.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-emerald-600/20 text-emerald-400 border border-emerald-500/30 shrink-0",children:"Voc"})]}),a.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:qt?!0:!!O[Vt],onChange:()=>!qt&&ge(he),disabled:qt})]},`${Vt}-${ot}`)})})}),T&&E.length===0&&w.trim()&&!_&&a.jsx("div",{className:"p-3 text-sm text-text-muted",children:"Nenhum nome novo encontrado."}),A.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-text-muted flex items-center gap-2",children:[a.jsx("span",{children:"Ignorados"}),a.jsx("span",{className:"inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/10",children:A.length})]}),a.jsx("div",{className:"mt-3 flex items-center justify-end",children:a.jsx("button",{type:"button",onClick:Sr,disabled:_||E.filter(he=>O[Y(he)]).length===0,className:`px-5 py-2.5 rounded-xl font-semibold ${_||E.filter(he=>O[Y(he)]).length===0?"bg-surface/30 text-text-muted cursor-not-allowed":"bg-emerald-600 text-white shadow-lg hover:shadow-emerald-600/30 transition"}`,children:(()=>`Adicionar selecionados (${E.reduce((ot,Vt)=>{const qt=Y(Vt);return T&&q&&z&&qt===z?ot+1:ot+(O[qt]?1:0)},0)})`)()})})]})]})})]})})]}),document.body)]})},Plt=({onSubmit:e,disabled:t=!1})=>{const[r,n]=p.useState(0),[s,o]=p.useState(0),[i,l]=p.useState(""),[c,d]=p.useState(!1),u=g=>{g.preventDefault(),!(r===0||t)&&e({rating:r,comentario:i.trim()||null,timestamp:new Date().toISOString()})},f=g=>{t||n(g)},h=g=>{t||o(g)},m=()=>{t||o(0)},x=s||r;return a.jsx(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:"w-full mb-8 md:mb-4",children:a.jsx("div",{className:"bg-background/98 backdrop-blur-3xl border-2 border-white/50 rounded-3xl p-6 md:p-8 shadow-2xl relative z-50",children:a.jsxs("form",{onSubmit:u,className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(g=>a.jsx(Fr.button,{type:"button",onClick:()=>f(g),onMouseEnter:()=>h(g),onMouseLeave:m,disabled:t,whileHover:{scale:t?1:1.2},whileTap:{scale:t?1:.9},className:`
                    p-2 transition-all duration-200 rounded-full
                    ${t?"cursor-not-allowed":"cursor-pointer hover:bg-brand/10"}
                  `,children:a.jsx(ofe,{className:`w-8 h-8 md:w-10 md:h-10 transition-all duration-200 ${g<=x?"fill-yellow-400 text-yellow-400 drop-shadow-lg":"text-text-muted hover:text-yellow-300"}`})},g))}),r>0&&a.jsx(Fr.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center",children:a.jsxs("p",{className:"text-base font-semibold text-text-primary",children:[r===1&&" Muito ruim",r===2&&" Ruim",r===3&&" Regular",r===4&&" Bom",r===5&&" Excelente"]})})]}),r>0&&a.jsx("div",{className:"w-full h-px bg-white/10 my-2"}),r>0&&a.jsxs(Fr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3,delay:.2},className:"flex flex-col gap-4",children:[a.jsxs("label",{className:"text-base font-semibold text-text-primary flex items-center gap-2",children:[a.jsx(tfe,{className:"w-5 h-5 text-brand"}),"Comentrio (opcional)"]}),a.jsx("div",{className:`
                flex items-start gap-2 px-4 py-3 rounded-xl
                bg-background/60 backdrop-blur-sm
                border-2 transition-all duration-300
                ${c?"border-brand/50 shadow-lg shadow-brand/10":"border-white/10 shadow-md"}
              `,children:a.jsx("textarea",{value:i,onChange:g=>l(g.target.value),onFocus:()=>d(!0),onBlur:()=>d(!1),placeholder:"Conte-nos mais sobre sua experincia...",disabled:t,rows:3,maxLength:500,className:"flex-1 bg-transparent text-text-primary placeholder:text-text-muted outline-none text-base resize-none min-w-0"})}),a.jsxs("div",{className:"text-sm text-text-muted text-right",children:[i.length,"/500"]})]}),r>0&&a.jsx(Fr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},className:"mt-2 mb-4",children:a.jsxs(Fr.button,{type:"submit",disabled:t,whileHover:{scale:t?1:1.02},whileTap:{scale:t?1:.98},className:`
                w-full px-6 py-4 rounded-2xl font-bold text-lg
                transition-all duration-300 flex items-center justify-center gap-3
                shadow-xl border-2
                ${t?"bg-surface text-text-muted cursor-not-allowed border-white/10":"bg-gradient-to-r from-brand to-brand/90 text-white shadow-brand/30 hover:shadow-2xl hover:shadow-brand/40 border-brand/20 hover:from-brand/90 hover:to-brand"}
              `,children:[a.jsx(Z4,{className:"w-6 h-6"}),"Enviar Avaliao"]})})]})})})},Elt=({message:e="Carregando..."})=>{const t=[" sis IA iniciando..."," Processando dados em tempo real..."," IA analisando disponibilidade..."," sis aprendendo suas preferncias..."," Assistente virtual ativando..."," IA otimizando seu agendamento..."," sis calculando melhores opes..."," Sincronizando com IA..."," Inteligncia artificial carregando..."," sis processando informaes..."],r=t[Math.floor(Math.random()*t.length)];return a.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background via-surface/30 to-background",children:a.jsx(Fr.div,{className:"absolute inset-0 opacity-20",animate:{background:["radial-gradient(circle at 20% 50%, #FF6600 0%, transparent 50%)","radial-gradient(circle at 80% 50%, #FFAA33 0%, transparent 50%)","radial-gradient(circle at 50% 20%, #FF6600 0%, transparent 50%)","radial-gradient(circle at 20% 50%, #FF6600 0%, transparent 50%)"]},transition:{duration:4,repeat:1/0,ease:"easeInOut"}})}),a.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(6)].map((n,s)=>a.jsx(Fr.div,{className:"absolute w-2 h-2 rounded-full",style:{background:s%2===0?"#FF6600":"#FFAA33",left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{y:[-20,-100,-20],opacity:[0,1,0],scale:[.5,1,.5]},transition:{duration:3+Math.random()*2,repeat:1/0,delay:Math.random()*2,ease:"easeInOut"}},s))}),a.jsxs(Fr.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,ease:[.22,1,.36,1]},className:"relative z-10 text-center",children:[a.jsxs("div",{className:"mb-8 flex flex-col items-center gap-6",children:[a.jsxs(Fr.div,{className:"relative",animate:{rotateY:[0,360]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:[a.jsx(Fr.div,{className:"absolute inset-0 rounded-2xl blur-xl opacity-60",style:{background:"#FFAA33"},animate:{scale:[1,1.2,1],opacity:[.4,.8,.4]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),a.jsx(Fr.div,{className:"relative w-20 h-20 md:w-24 md:h-24 rounded-2xl flex items-center justify-center",style:{background:"#FFAA33"},whileHover:{scale:1.05},children:a.jsx(jd,{className:"w-12 h-12 md:w-14 md:h-14 text-white",strokeWidth:2})})]}),a.jsxs(Fr.div,{className:"flex items-baseline gap-1",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.3},children:[a.jsx(Fr.span,{className:"font-extrabold text-4xl md:text-5xl",style:{color:"#FF6600"},animate:{textShadow:["0 0 10px rgba(255, 102, 0, 0.5)","0 0 20px rgba(255, 102, 0, 0.8)","0 0 10px rgba(255, 102, 0, 0.5)"]},transition:{duration:2,repeat:1/0},children:"Fluxo"}),a.jsx(Fr.span,{className:"font-extrabold text-4xl md:text-5xl",style:{color:"#FFAA33"},animate:{textShadow:["0 0 10px rgba(255, 170, 51, 0.5)","0 0 20px rgba(255, 170, 51, 0.8)","0 0 10px rgba(255, 170, 51, 0.5)"]},transition:{duration:2,repeat:1/0,delay:.1},children:"7"}),a.jsx(Fr.span,{className:"font-medium text-4xl md:text-5xl ml-2",style:{color:"#B0B0B0"},initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.6},children:"Arena"})]})]}),a.jsx("div",{className:"w-64 md:w-80 mx-auto mb-6",children:a.jsx("div",{className:"h-1 bg-surface/30 rounded-full overflow-hidden",children:a.jsx(Fr.div,{className:"h-full rounded-full",style:{background:"linear-gradient(90deg, #FFAA33, #FFD700, #FFAA33)"},animate:{x:[-100,300]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},initial:{x:-100}})})}),a.jsxs(Fr.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.8},className:"space-y-3",children:[a.jsx(Fr.p,{className:"text-base md:text-lg font-medium text-text-primary px-4",animate:{opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0},children:r}),a.jsx("div",{className:"flex justify-center gap-1",children:[0,1,2].map(n=>a.jsx(Fr.div,{className:"w-2 h-2 rounded-full",style:{background:"#FFAA33"},animate:{scale:[.8,1.2,.8],opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0,delay:n*.2}},n))})]})]})]})},klt={greeting:["Ol! Eu sou a Isis  Vou te ajudar a agendar sua quadra! Qual voc prefere?","Oi! Sou a Isis!  Vamos agendar? Me diz, qual quadra voc quer?","E a! Isis aqui! Bora marcar sua partida? Qual quadra te interessa?","Ol!  Prazer, sou a Isis! Qual quadra voc quer reservar?","Opa! Isis na rea! Vamos agendar sua quadra? Qual delas?","Seja bem-vindo! Sou a Isis e vou facilitar sua reserva! Qual quadra?"],afterQuadra:["Boa escolha! {quadra}  tima!  Para qual dia?","Perfeito! {quadra}  top! Qual dia voc quer?","{quadra} confirmada!  Me diz, que dia?","Show! {quadra}  sucesso aqui! Qual o dia?","Anotado! {quadra}  Agora me fala o dia:","Excelente! {quadra}  uma das melhores! Para quando?"],afterData:["Beleza! {data} anotado!  Qual horrio voc prefere?","timo! {data} t disponvel! Que horas?","{data}  logo ali!  Me diz o horrio:","Confirmado {data}! Qual horrio te atende melhor?","Perfeito! {data}  Agora escolhe o horrio:","Show! {data} t livre! Qual o melhor horrio pra voc?"],afterHorario:["{horario}  seu!  Qual modalidade?","Reservado {horario}!  Vai ser qual modalidade?","Fechou {horario}! Qual esporte?","{horario} confirmado! Me diz a modalidade:","Show! {horario}  E a modalidade ...?","Perfeito! {horario} garantido! Qual modalidade?"],afterModalidade:["{modalidade}! Massa!  Quantas pessoas vo jogar?","Vai ser {modalidade}! Legal! Quantos jogadores?","{modalidade}  bom demais!  Quantas pessoas?","Top! {modalidade}  Me diz quantas pessoas:","{modalidade} confirmado! Quantos vo jogar?","timo! {modalidade}  show! Quantos participantes?"],askNames:["Agora preciso dos nomes! Digite cada um (um por linha):","Beleza! Me manda os nomes dos participantes:","Show! Lista os nomes pra mim:","timo! Quais so os nomes?","Perfeito! Me passa os nomes de todo mundo:","Legal! Agora os nomes dos jogadores:"],askContact:["ltimos dados! Qual seu nome completo?","Agora preciso do seu nome e telefone:","Quase l! Me passa seu nome e WhatsApp:","Beleza! Seus dados para contato:","Falta pouco! Nome completo e telefone:","ltima etapa! Qual seu nome e telefone?"],reviewData:["timo! Vamos conferir tudo antes de confirmar:","Perfeito! Revisa comigo os dados:","Show! Confirma se t tudo certo:","Beleza! D uma olhada se est correto:","Legal! Vamos revisar juntos:","Massa! Confere os detalhes aqui:"],confirmation:[" Tudo certo! Agendamento #{codigo} confirmado!"," Pronto! Seu agendamento #{codigo} est garantido!"," Feito! Cdigo #{codigo} confirmado!"," Sucesso! Agendamento #{codigo} t na agenda!"," Confirmado! #{codigo}  seu!"," Show! Agendamento #{codigo} marcado!"],thankYou:["Obrigada por agendar conosco! At logo! ","Valeu! Te vejo no jogo! ","Brigada! Bom jogo! ","Obrigada! At a partida! ","Valeu pela preferncia! At breve! ","Obrigada! Qualquer coisa,  s voltar aqui! "],loading:["Deixa eu verificar...","S um momento...","Aguarda um pouquinho...","Consultando aqui...","Verificando pra voc..."],error:["Ops! Algo deu errado. Vamos tentar de novo?","Eita! Tive um problema aqui. Podemos recomear?","Putz! Deu erro. Tenta novamente?","Opa! Algo no funcionou. Vamos de novo?","Caramba! Erro aqui. Pode tentar novamente?"],noAvailability:["Puts... esse horrio j foi reservado.  Escolhe outro?","Eita! Esse j est ocupado. Que tal outro horrio?","Opa! Esse horrio acabou de ser reservado. Tem outro?","Poxa! Algum reservou esse agora mesmo. Outro horrio?","Xiii! Esse j foi. Bora escolher outro?"]},ov=(e,t={})=>{const r=klt[e];if(!r||r.length===0)return console.warn(`[Isis] Nenhuma variao encontrada para step: ${e}`),"Ol! Como posso ajudar?";const n=Math.floor(Math.random()*r.length);let s=r[n];return Object.keys(t).forEach(o=>{const i=new RegExp(`\\{${o}\\}`,"g");s=s.replace(i,t[o])}),s},FV=e=>{try{const t=JSON.parse(localStorage.getItem("isis-feedbacks")||"[]");return t.push(e),localStorage.setItem("isis-feedbacks",JSON.stringify(t)),console.log("[ISIS Feedback] Salvo localmente como fallback:",e.id),e}catch(t){return console.error("[ISIS Feedback] Erro ao salvar localmente:",t),e}},Ilt=async e=>{const t={id:Date.now()+Math.random().toString(36).substr(2,9),timestamp:new Date().toISOString(),estrelas:e?.rating??null,nome_cliente:e?.cliente_nome??null,empresa:e?.empresa_nome??null,projeto:"fluxo7arena",comentario:e?.comentario??null};try{const r={id:String(e?.sessionId||e?.session_id||t.id),cod_cliente:e?.cliente_codigo??e?.cliente_id??e?.cod_cliente??null,nome_cliente:e?.cliente_nome||null,empresa:e?.empresa_nome||null,projeto:"fluxo7arena",nota:e?.rating??null,comentario:e?.comentario||null,conversa:Array.isArray(e?.conversaArray)?e.conversaArray:e?.conversa&&typeof e.conversa=="object"?e.conversa:null,timestamp:t.timestamp},{error:n}=await NO.from("isis").upsert(r,{onConflict:"id"});return n?(console.error("[Supabase ISIS] Erro ao inserir feedback:",n),FV({...t,projeto:"fluxo7arena"})):(console.log("[Supabase ISIS] Feedback inserido com sucesso:",r.id),t)}catch(r){return console.error("[Supabase ISIS] Exceo ao inserir feedback, salvando localmente:",r),FV(t)}},Olt=()=>{const{nomeFantasia:e}=Cde(),t=Ce.useMemo(()=>{try{if(typeof window>"u")return null;const ke=window.location.host||"",We="f7arena.com";if(!ke.endsWith(We))return null;const Ze=ke.slice(0,-We.length).replace(/\.$/,"");if(!Ze)return null;const Je=Ze.toLowerCase();return Je==="www"?null:Je}catch{return null}},[]),r=e||t;Il();const[n,s]=p.useState(null),{currentStep:o,selections:i,addIsisMessage:l,addIsisMessageWithButtons:c,addUserMessage:d,disableAllButtons:u,removeMessageById:f,hideButtonsInMessage:h,updateSelection:m,updateContact:x,nextStep:g,setIsLoading:v,setIsTyping:y,chatEndRef:b,sessionId:w,messages:j}=p5(),[_,C]=p.useState(null),[E,S]=p.useState([]),[A,M]=p.useState([]),[O,I]=p.useState(!0),[T,k]=p.useState("telefone"),[q,B]=p.useState(!1),[z,F]=p.useState(null),[V,me]=p.useState(null),[be,U]=p.useState(!1),[L,H]=p.useState(null),[ie,Y]=p.useState(null),W=Ce.useMemo(()=>{try{if(typeof window>"u")return{enabled:!1,verbose:!1};const We=(new URLSearchParams(window.location.search||"").get("debug")||"").toLowerCase();if(We==="0"||We==="false")return{enabled:!1,verbose:!1};const Ze=String(window.localStorage?.getItem("isis_debug")||"").toLowerCase();return Ze==="0"||Ze==="false"?{enabled:!1,verbose:!1}:{enabled:!0,verbose:!0}}catch{return{enabled:!0,verbose:!0}}},[]),se=Ce.useCallback((ke,We,{level:Ze="info"}={})=>{try{if(!W.enabled)return;const At={ts:new Date().toISOString(),...We||{}},Ye=`[Isis][Diag] ${ke}`;Ze==="error"?console.error(Ye,At):Ze==="warn"?console.warn(Ye,At):console.info(Ye,At)}catch{}},[W.enabled,W.verbose]);if(p.useEffect(()=>{if(W.enabled)try{const ke=()=>{try{const Ye=navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection;return Ye?{effectiveType:Ye.effectiveType,downlink:Ye.downlink,rtt:Ye.rtt,saveData:Ye.saveData,type:Ye.type}:null}catch{return null}};se("boot",{href:window.location.href,host:window.location.host,pathname:window.location.pathname,userAgent:navigator?.userAgent,language:navigator?.language,onLine:navigator?.onLine,connection:ke()},{level:"info"});const We=()=>se("online",{onLine:!0,connection:ke()},{level:"warn"}),Ze=()=>se("offline",{onLine:!1,connection:ke()},{level:"warn"}),Je=Ye=>{const lr=Ye?.reason;se("unhandledrejection",{message:lr?.message||String(lr||""),stack:lr?.stack,name:lr?.name},{level:"error"})},At=Ye=>{se("error",{message:Ye?.message,filename:Ye?.filename,lineno:Ye?.lineno,colno:Ye?.colno,stack:Ye?.error?.stack},{level:"error"})};window.addEventListener("online",We),window.addEventListener("offline",Ze),window.addEventListener("unhandledrejection",Je),window.addEventListener("error",At);try{const Ye=navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection;if(Ye?.addEventListener){const lr=()=>se("connection_change",{onLine:navigator?.onLine,connection:ke()},{level:"warn"});return Ye.addEventListener("change",lr),()=>{window.removeEventListener("online",We),window.removeEventListener("offline",Ze),window.removeEventListener("unhandledrejection",Je),window.removeEventListener("error",At);try{Ye.removeEventListener("change",lr)}catch{}}}}catch{}return()=>{window.removeEventListener("online",We),window.removeEventListener("offline",Ze),window.removeEventListener("unhandledrejection",Je),window.removeEventListener("error",At)}}catch{}},[W.enabled,se]),typeof window<"u"&&new URLSearchParams(window.location.search||"").get("crash")==="1")throw new Error("Isis forced crash test");const pe=ke=>ke?ke.replace(/([A-Z])/g," $1").replace(/([0-9]+)/g," $1").trim().split(/[\s_-]+/).filter(Boolean).map(Ze=>Ze.charAt(0).toUpperCase()+Ze.slice(1).toLowerCase()).join(" "):"",G=Ce.useMemo(()=>_?_.isis_display_name?_.isis_display_name:r?pe(r):_.nome_fantasia?_.nome_fantasia:_.razao_social?_.razao_social:"Arena":"",[_,r]),te=Ce.useMemo(()=>_?.logo_url?`${_.logo_url}?v=${Date.now()}`:_?.logo_url||"",[_?.logo_url]);p.useEffect(()=>{(async()=>{if(!r){I(!1);return}try{const Ze=decodeURIComponent(r).toLowerCase().replace(/[\s\-_]+/g,"").trim();let Je=null,At=null;try{const{data:ce,error:qe}=await Q.rpc("get_empresa_public_by_isis_subdomain",{p_subdomain:Ze});!qe&&ce&&ce.length>0&&(Je=ce[0],At=ce[0]?.isis_display_name||null)}catch{}try{if(!Je){const{data:ce}=await Q.from("agenda_settings").select("empresa_id, isis_subdomain, isis_display_name, empresas(codigo_empresa, nome_fantasia, razao_social, nome, logo_url, telefone, id)").eq("isis_subdomain",Ze).single();ce?.empresas&&(Je=ce.empresas,At=ce.isis_display_name)}}catch{}if(!Je){let ce=null;try{const{data:qe,error:ze}=await Q.rpc("get_empresa_public_by_slug",{p_slug:Ze});!ze&&qe&&qe.length>0&&(ce=qe[0])}catch{}Je=ce||null}if(!Je){const{data:ce,error:qe}=await Q.from("empresas").select("codigo_empresa, nome_fantasia, razao_social, nome, logo_url, id");if(!qe&&Array.isArray(ce)){const ze=ce.find(xt=>[xt?.nome_fantasia||"",xt?.razao_social||"",xt?.nome||""].some(ir=>ir.toLowerCase().replace(/[\s\-_]+/g,"").trim()===Ze));ze&&(Je=ze)}}const Ye=Je?.id||Je?.codigo_empresa;if(Je&&!At&&Ye)try{let ce=null,qe=null;if(Je.id){const ze=await Q.from("agenda_settings").select("isis_subdomain, empresa_id").eq("empresa_id",Je.id).single();ce=ze.data,qe=ze.error}else if(Je.codigo_empresa){const{data:ze}=await Q.from("empresas").select("id").eq("codigo_empresa",Je.codigo_empresa).single();if(ze?.id){const xt=await Q.from("agenda_settings").select("isis_subdomain, empresa_id").eq("empresa_id",ze.id).single();ce=xt.data,qe=xt.error}}if(ce?.isis_subdomain){console.error("[Isis] Acesso bloqueado. Use o subdomnio configurado."),s(null),I(!1);return}}catch{}if(!Je){console.error("[Isis] Empresa no encontrada"),s(null),I(!1);return}if(!At&&Je.id)try{const{data:ce}=await Q.from("agenda_settings").select("isis_display_name").eq("empresa_id",Je.id).single();ce?.isis_display_name&&(At=ce.isis_display_name)}catch{}const lr={...Je,isis_display_name:At};C(lr),s(Je.codigo_empresa),I(!1)}catch(We){console.error("[Isis] Erro ao buscar empresa:",We),s(null),I(!1)}})()},[r]),p.useEffect(()=>{const ke=We=>{try{We.preventDefault()}catch{}H(We)};return window.addEventListener("beforeinstallprompt",ke),()=>window.removeEventListener("beforeinstallprompt",ke)},[]),p.useEffect(()=>{try{if(!(new URLSearchParams(window.location.search||"").get("install")==="1"))return;const Ze=window.__installPrompt||L,Je=()=>{const At=[" Como instalar o app:",""," Chrome (Android/PC):","  1) Toque nos 3 pontinhos () do navegador",'  2) Escolha "Instalar app" ou "Adicionar  tela inicial"','  3) Confirme em "Instalar"',""," Safari (iPhone/iPad):","  1) Toque no boto Compartilhar (quadrado com seta )",'  2) Selecione "Adicionar  Tela de Incio"','  3) Toque em "Adicionar"'].join(`
`);l(At,400),setTimeout(()=>{l("Beleza! O que voc gostaria de fazer agora?",600),setTimeout(()=>{try{Bt()}catch{}},800)},700)};(async()=>{try{Ze?.prompt&&(Ze===L&&H(null),Ze===window.__installPrompt&&(window.__installPrompt=null),await Ze.prompt(),await Ze.userChoice)}catch{}Je()})()}catch{}},[L]),p.useEffect(()=>{!n||O||!i.cliente&&!be&&(U(!0),setTimeout(()=>{De()},2500))},[n,O,i.cliente,be]),p.useEffect(()=>{(async()=>{if(n)try{console.log("[useEffect] Definindo empresa atual para RLS:",n),await Q.rpc("set_current_empresa",{empresa_codigo:String(n)}),await wt()}catch(We){console.error("[useEffect] Erro ao definir empresa para RLS:",We),await wt()}})()},[n]);const oe=()=>{const We=new Date().getHours();return We>=5&&We<12?"Bom dia":We>=12&&We<18?"Boa tarde":"Boa noite"},De=()=>{console.log("[DEBUG] iniciarIdentificacao INICIOU:",{loadingEmpresa:O,empresa:_?.nome_fantasia,timestamp:new Date().toISOString()}),k("telefone"),B(!1);const ke=oe(),We=[`**${ke}!** Tudo bem? 

Sou a **sis**, assistente virtual da **${G}** e estou aqui para tornar seu **agendamento** super fcil!

Para comear, qual seu **telefone** ou **e-mail**?`,`Hey! **${ke}!**  **sis** na rea!

Sou a assistente virtual da **${G}** e vim facilitar sua vida.

Bora **agendar**? Me passa seu **telefone** ou **e-mail**:`,`**${ke}!** Prazer em te atender! 

Sou a **sis** da **${G}**, sua assistente virtual para **agendamentos**.

Para comear, preciso do seu **telefone** ou **e-mail**:`,`Opa! **${ke}!**  **sis** aqui, sua assistente virtual da **${G}**!

Vamos **marcar seu horrio**?  rapidinho!

Me informa seu **telefone** ou **e-mail**:`,`**${ke}!** Seja bem-vindo! 

Eu sou a **sis**, sua assistente virtual aqui na **${G}**.

Vou te ajudar a **agendar seu horrio** rapidinho!

Informe seu **telefone** ou **e-mail**:`],Ze=Math.floor(Math.random()*We.length);console.log("[DEBUG] Mostrando indicador de digitao primeiro:",{loadingEmpresa:O,timestamp:new Date().toISOString()}),y(!0),setTimeout(()=>{console.log("[DEBUG] Fazendo scroll inicial para mostrar indicador de digitao"),b.current?.scrollIntoView({behavior:"smooth",block:"end"})},300),setTimeout(()=>{console.log("[DEBUG] Enviando mensagem da Isis aps indicador de digitao"),y(!1),l(We[Ze],0),setTimeout(()=>{console.log("[DEBUG] Fazendo scroll aps mensagem aparecer"),b.current?.scrollIntoView({behavior:"smooth",block:"end"})},100)},3500),setTimeout(()=>{console.log("[DEBUG] Mostrando input"),B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"end"})},200)},3500+600),g("identificacao")},re=async ke=>{try{se("buscarCliente:start",{tipoIdentificacao:T,valorLen:String(ke||"").length,codigoEmpresa:n,onLine:navigator?.onLine},{level:"info"}),console.log("[DEBUG] Buscando cliente com valor:",ke),console.log("[DEBUG] Cdigo empresa:",n);const We=ke.replace(/\D/g,"");if(We.length>=10){console.log("[DEBUG] Buscando telefone:",We);const lr=performance.now(),{data:ce,error:qe}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, celular1, codigo").eq("codigo_empresa",n).eq("status","active"),ze=Math.round(performance.now()-lr);if(se("buscarCliente:clientes_tel_query",{ms:ze,hasError:!!qe,error:qe?{message:qe.message,code:qe.code,details:qe.details,hint:qe.hint}:null,count:Array.isArray(ce)?ce.length:null},{level:qe?"error":"info"}),qe)throw qe;console.log("[DEBUG] Total de clientes ativos:",ce?.length);const xt=ce?.find(rr=>{const ir=(rr.telefone||"").replace(/\D/g,""),Kr=(rr.whatsapp||"").replace(/\D/g,""),jr=(rr.celular1||"").replace(/\D/g,"");return ir.includes(We)||Kr.includes(We)||jr.includes(We)});return console.log("[DEBUG] Cliente encontrado:",xt),se("buscarCliente:found_by_tel",{found:!!xt,clienteId:xt?.id||null},{level:xt?"info":"warn"}),xt||null}const Ze=performance.now(),{data:Je,error:At}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, codigo").eq("codigo_empresa",n).eq("status","active").ilike("email",`%${ke}%`),Ye=Math.round(performance.now()-Ze);if(se("buscarCliente:clientes_email_query",{ms:Ye,hasError:!!At,error:At?{message:At.message,code:At.code,details:At.details,hint:At.hint}:null,count:Array.isArray(Je)?Je.length:null},{level:At?"error":"info"}),At)throw At;return se("buscarCliente:found_by_email",{found:!!Je?.[0],clienteId:Je?.[0]?.id||null},{level:Je?.[0]?"info":"warn"}),Je?.[0]||null}catch(We){return console.error("Erro ao buscar cliente:",We),se("buscarCliente:error",{message:We?.message||String(We||""),code:We?.code,details:We?.details,hint:We?.hint,status:We?.status},{level:"error"}),null}},ae=ke=>{const We=ke.trim().split(" ").filter(Ze=>Ze);return We.length===1?We[0]:We.length>=2?`${We[0]} ${We[1]}`:We[0]},ut=async ke=>{if(!ke){l("Por favor, informe a data desejada.",400);return}const We=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,Ze=ke.match(We);if(!Ze){l("**Formato invlido!** Por favor, use o formato DD/MM/AAAA (exemplo: 15/12/2024)",400);return}const[,Je,At,Ye]=Ze,lr=new Date(parseInt(Ye),parseInt(At)-1,parseInt(Je));if(isNaN(lr.getTime())||lr.getDate()!==parseInt(Je)||lr.getMonth()!==parseInt(At)-1||lr.getFullYear()!==parseInt(Ye)){l("**Data invlida!** Verifique se o dia, ms e ano esto corretos.",400);return}const ce=new Date;if(ce.setHours(0,0,0,0),lr.setHours(0,0,0,0),lr<ce){l("**Data no passado!** Por favor, escolha uma data de hoje em diante.",400);return}d(ke);const qe=dr(lr,"dd/MM/yyyy",{locale:$a}),ze=dr(lr,"EEEE",{locale:$a});v(!0);const xt=await he(i.quadra.id,lr);if(v(!1),xt.fechada){if(xt.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${qe}** (${ze}). 

**Motivo:** ${xt.observacao}`,800);else if(xt.motivo==="dia_semana"){const jr=dr(lr,"EEEE",{locale:$a});l(`**Ops!** A quadra no funciona ${jr==="domingo"||jr==="sbado"?"aos":"s"} **${jr}s**. 

Escolha outro dia da semana!`,800)}setTimeout(()=>{l("Digite **outra data** no formato DD/MM/AAAA:",1200),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200)},400)},1200);return}m("data",lr),B(!1),k("telefone"),l(`**Perfeito!** Data escolhida: **${qe}** (${ze}) `,600);const rr=xt.slots;if(rr.length===0){l("Ops! No encontrei **horrios disponveis** para esse dia.  Que tal tentar outra data?",800),setTimeout(()=>{perguntarData()},1200);return}const ir=ot(rr);let Kr="";ir.length===1?Kr=`Tenho **horrios livres** das **${ir[0].inicio}** s **${ir[0].fim}**! `:Kr=`Tenho **horrios livres** ${ir.map((sa,ia)=>ia===ir.length-1?`e das **${sa.inicio}** s **${sa.fim}**`:ia===0?`das **${sa.inicio}** s **${sa.fim}**`:`das **${sa.inicio}** s **${sa.fim}**`).join(", ")}! `,l(Kr,1e3),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",1200),g("horario"),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},1600)},pt=async ke=>{if(T==="data_custom")return await ut(ke);if(se("identificacao:submit",{tipoIdentificacao:T,valorLen:String(ke||"").length,codigoEmpresa:n,onLine:navigator?.onLine},{level:"info"}),!ke){l("Por favor, informe seu telefone ou e-mail.",400);return}const We=T==="telefone"?`(${ke.slice(0,2)}) ${ke.slice(2,7)}-${ke.slice(7)}`:ke;d(We);const Ze=performance.now(),Je=await re(ke),At=Math.round(performance.now()-Ze);if(se("identificacao:buscarCliente_done",{ms:At,found:!!Je,clienteId:Je?.id||null},{level:Je?"info":"warn"}),Je){m("cliente",Je),B(!1);const Ye=ae(Je.nome),lr=[`**${Ye}!** `,`Opa, **${Ye}!** `,`E a, **${Ye}!** `,`**${Ye}!** Que bom te ver! `,`Fala, **${Ye}!** `,`**${Ye}!** Tudo bem? `,`Hey, **${Ye}!** `],ce=Math.floor(Math.random()*lr.length);l(lr[ce],600);let qe="telefone";try{qe=i?.identificacao_tipo||T||"telefone",Y(qe==="email"?"email":"telefone")}catch{}const ze=qe==="email"?"email":"telefone";setTimeout(()=>{Bt(ze)},600)}else m("identificacao_valor",We),m("identificacao_tipo",T),B(!1),l("No encontrei seu cadastro. Sem problemas! Vamos fazer rapidinho. ",800),l("Preciso de algumas informaes:",1400),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600)},1400+800),g("cadastro")},ft=async ke=>{let We=`Nome: ${ke.nome}`;if(ke.telefone){const Ze=`(${ke.telefone.slice(0,2)}) ${ke.telefone.slice(2,7)}-${ke.telefone.slice(7)}`;We+=`
Telefone: ${Ze}`}ke.email&&(We+=`
E-mail: ${ke.email}`),d(We),B(!1),await bt(ke.nome,ke.email,ke.telefone)},bt=async(ke,We,Ze)=>{try{v(!0);try{if(Ze){const ce=String(Ze||"").replace(/\D/g,""),{data:qe,error:ze}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, celular1, codigo").eq("codigo_empresa",n).eq("status","active");if(!ze&&Array.isArray(qe)){const xt=qe.find(rr=>{const ir=(rr.telefone||"").replace(/\D/g,""),Kr=(rr.whatsapp||"").replace(/\D/g,""),jr=(rr.celular1||"").replace(/\D/g,"");return ir===ce||Kr===ce||jr===ce});if(xt){v(!1),m("cliente_sugerido",xt),c(`Encontrei um cadastro existente para este telefone: **${ae(xt.nome)}**.  voc?`,[{label:" Sim, sou eu",value:"confirm_cliente_existente"},{label:" No, quero corrigir",value:"corrigir_cadastro"}],200),B(!1),g("confirmar_cliente_existente");return}}}if(We){const ce=String(We||"").trim().toLowerCase(),{data:qe,error:ze}=await Q.from("clientes").select("id, nome, email, telefone, whatsapp, codigo").eq("codigo_empresa",n).eq("status","active").ilike("email",ce);if(!ze&&Array.isArray(qe)&&qe.length>0){const xt=qe.find(rr=>String(rr.email||"").trim().toLowerCase()===ce)||null;if(xt){v(!1),m("cliente_sugerido",xt),c(`Este e-mail j possui cadastro: **${ae(xt.nome)}**.  voc?`,[{label:" Sim, sou eu",value:"confirm_cliente_existente"},{label:" No, quero corrigir",value:"corrigir_cadastro"}],200),B(!1),g("confirmar_cliente_existente");return}}}}catch{}l(ov("loading"));const{data:Je}=await Q.from("empresa_counters").select("next_cliente_codigo").eq("empresa_id",_?.id).single(),At=Je?.next_cliente_codigo||1,{data:Ye,error:lr}=await Q.from("clientes").insert({codigo_empresa:n,codigo:At,nome:ke,email:We||null,telefone:Ze,whatsapp:Ze,status:"active"}).select("id, nome, email, telefone, whatsapp, codigo").single();if(lr){if(lr.code==="23505"&&lr.message.includes("uq_clientes_empresa_codigo")){console.log("[Isis] Cdigo duplicado, tentando prximo cdigo...");const{data:ce,error:qe}=await Q.from("clientes").insert({codigo_empresa:n,codigo:At+1,nome:ke,email:We||null,telefone:Ze,whatsapp:Ze,status:"active"}).select("id, nome, email, telefone, whatsapp, codigo").single();if(qe)throw qe;await Q.from("empresa_counters").update({next_cliente_codigo:At+2}).eq("empresa_id",_?.id),v(!1),B(!1),m("cliente",ce),l(`Pronto, ${ke}! Cadastro realizado com sucesso! `,800),setTimeout(()=>{ge()},1400);return}throw lr}await Q.from("empresa_counters").update({next_cliente_codigo:At+1}).eq("empresa_id",_?.id),v(!1),B(!1),m("cliente",Ye),l(`Pronto, ${ke}! Cadastro realizado com sucesso! `,800),setTimeout(()=>{ge()},1400)}catch(Je){console.error("Erro ao criar cliente:",Je),v(!1),l("Ops! Erro ao criar cadastro. Tente novamente.",400)}},Lt=()=>{const ke=new Date,We=Es(ke,1),Ze=[{label:`Hoje (${dr(ke,"dd/MM")})`,value:dr(ke,"yyyy-MM-dd"),icon:"",date:ke},{label:`Amanh (${dr(We,"dd/MM")})`,value:dr(We,"yyyy-MM-dd"),icon:"",date:We},{label:"Outro dia...",value:"custom",icon:""}];Array.isArray(E)&&E.length>1&&Ze.push({label:"Mudar quadra",value:"mudar_quadra",icon:""}),Ze.push({label:" Menu",value:"menu",action:"menu"}),c("Para qual dia voc gostaria de agendar?",Ze,600),g("data")},Dt=()=>{d(" Mudar Data"),B(!1),setTimeout(()=>{Lt()},400)},Bt=(ke=null)=>{const We=["O que voc gostaria de fazer hoje?","Como posso te ajudar?","Qual  o plano para hoje?","O que vamos fazer?","Em que posso te auxiliar?","Qual sua necessidade hoje?","Como posso ser til?"],Ze=We[Math.floor(Math.random()*We.length)];let Je=[{label:"Fazer Agendamento",value:"novo_agendamento",icon:""},{label:"Editar Agendamento",value:"buscar_agendamento",icon:""},{label:"Finalizar Atendimento",value:"finalizar_atendimento",icon:""}];const At=ke||ie;At==="telefone"?Je=[Je[0],Je[1],{label:"Informei o telefone errado",value:"corrigir_telefone",icon:""},Je[2]]:At==="email"&&(Je=[Je[0],Je[1],{label:"Informei o e-mail errado",value:"corrigir_email",icon:""},Je[2]]),c(Ze,Je,600),ie&&setTimeout(()=>Y(null),0)},ge=async()=>{let ke=E,We=_;if(!ke||ke.length===0){const Ze=await wt(!1);if(ke=Ze.quadras,We=Ze.empresa,!ke||ke.length===0){console.error("[iniciarAgendamento] Quadras ainda no disponveis aps carregar!"),l("Ops! No consegui carregar as quadras. Tente novamente.",600);return}}if(!We){console.error("[iniciarAgendamento] Empresa no disponvel!"),l("Ops! No consegui carregar os dados da empresa. Tente novamente.",600);return}setTimeout(()=>{Gt(ke,We,!0)},800)},wt=async(ke=!0)=>{try{ke&&I(!0);const We=Date.now(),Ze=3500,{data:Je,error:At}=await Q.from("empresas").select("*").eq("codigo_empresa",n).single();if(At)throw At;if(!Je)return D2({title:"Empresa no encontrada",description:"Verifique o cdigo e tente novamente",variant:"destructive"}),{empresa:null,quadras:[]};C(ze=>({...Je,isis_display_name:ze?.isis_display_name||Je.isis_display_name})),m("empresa",Je);const{data:Ye,error:lr}=await Q.from("quadras").select("id, nome, modalidades, hora_inicio, hora_fim, valor, codigo_empresa, status, descricao").eq("codigo_empresa",String(n)).eq("status","Ativa").order("nome",{ascending:!0});if(lr)throw console.error("[loadEmpresa] Erro ao buscar quadras:",lr),lr;if(!Ye||Ye.length===0){console.warn("[loadEmpresa] Nenhuma quadra encontrada devido a RLS. Criando quadra temporria.");const ze=[{id:"temp-quadra-1004",nome:"Quadra Principal",modalidades:["Futebol","Futsal"],hora_inicio:"07:00:00",hora_fim:"22:00:00",valor:30,codigo_empresa:String(n),status:"Ativa",descricao:"Quadra temporria (problema de permisso)"}];return S(ze),{empresa:Je,quadras:ze}}S(Ye||[]);const ce=Date.now()-We,qe=Math.max(0,Ze-ce);return qe>0&&await new Promise(ze=>setTimeout(ze,qe)),{empresa:Je,quadras:Ye||[]}}catch(We){console.error("[Isis] Erro ao carregar empresa:",We);const Ze=Date.now()-startTime,Je=Math.max(0,minLoadingTime-Ze);return Je>0&&await new Promise(At=>setTimeout(At,Je)),D2({title:"Erro ao carregar",description:"No foi possvel carregar os dados da empresa",variant:"destructive"}),{empresa:null,quadras:[]}}finally{ke&&I(!1)}},Gt=(ke,We,Ze=!1)=>{if(oe(),ke.length===1){const Ye=ke[0];if(Ze){const lr=[`Perfeito! Agora vamos **agendar** seu horrio na **${Ye.nome}!** `,`timo! Vou te ajudar a **marcar sua partida** na **${Ye.nome}!** `,`Show! Bora **agendar** a **${Ye.nome}?** `,`Perfeito! Vamos **marcar sua reserva** na **${Ye.nome}!** `],ce=Math.floor(Math.random()*lr.length),qe=lr[ce];l(qe)}m("quadra",Ye),setTimeout(()=>{const lr=new Date,ce=Es(lr,1),qe=[{label:`Hoje (${dr(lr,"dd/MM")})`,value:dr(lr,"yyyy-MM-dd"),icon:"",date:lr},{label:`Amanh (${dr(ce,"dd/MM")})`,value:dr(ce,"yyyy-MM-dd"),icon:"",date:ce},{label:"Outro dia...",value:"custom",icon:""},{label:" Menu",value:"menu",action:"menu"}];c("Para qual dia voc gostaria de agendar?",qe,800),g("data")},1200);return}let Je;if(Ze){const Ye=["Qual quadra voc quer reservar? ","Qual quadra te interessa? ","Me diz, qual quadra? ","Qual quadra voc prefere? ","Bora escolher a quadra? Qual delas? "],lr=Math.floor(Math.random()*Ye.length);Je=Ye[lr]}else return;const At=ke.map(Ye=>({label:Ye.nome,subtitle:Ye.descricao||null,value:Ye.id,icon:"",quadra:Ye}));At.push({label:" Menu",value:"menu",action:"menu"}),c(Je,At),g("quadra")},Sr=async ke=>{if(ke.action==="menu"){d(" Menu");try{me(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{B(!1)}catch{}g("identificacao"),setTimeout(()=>{Bt()},400);return}const We=ke.quadra;if(!We){console.error("[handleQuadraSelection] Quadra no encontrada no boto:",ke);return}if(d(We.nome),m("quadra",We),o==="review"){B(!1),F("horario"),v(!0);const lr=await he(We.id,i.data,V?.id);if(v(!1),lr.fechada){const qe=dr(i.data,"dd/MM/yyyy",{locale:$a}),ze=dr(i.data,"EEEE",{locale:$a});if(lr.motivo==="data_especifica")l(`**Ops!** A **${We.nome}** estar **fechada** no dia **${qe}** (${ze}). 

**Motivo:** ${lr.observacao}`,800);else if(lr.motivo==="dia_semana"){const xt=dr(i.data,"EEEE",{locale:$a}),rr=xt==="domingo"||xt==="sbado"?"aos":"s";l(`**Ops!** A **${We.nome}** no funciona ${rr} **${xt}s**. `,800)}setTimeout(()=>{l("Escolha **outra quadra** ou **mude a data**:",1200),setTimeout(()=>{Lt()},400)},1600);return}const ce=lr.slots;if(ce&&ce.length>0){const qe=ot(ce);let ze="";qe.length===1?ze=`Tenho **horrios livres** das **${qe[0].inicio}** s **${qe[0].fim}**! `:ze=`Tenho **horrios livres** ${qe.map((rr,ir)=>ir===qe.length-1?`e das **${rr.inicio}** s **${rr.fim}**`:ir===0?`das **${rr.inicio}** s **${rr.fim}**`:`das **${rr.inicio}** s **${rr.fim}**`).join(", ")}! `,console.log("[handleQuadraSelection] Mostrando horrios disponveis e input de horrio"),l(ze,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{console.log("[handleQuadraSelection] Ativando showInput=true"),B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else console.log("[handleQuadraSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para essa quadra nesse dia. "),setTimeout(()=>{l("Que tal tentar **outra data**? ",800),setTimeout(()=>{Lt()},400)},1200);return}console.log("[handleQuadraSelection] Fluxo normal (no edio)");const Ze=ov("afterQuadra",{quadra:We.nome});l(Ze,600);const Je=new Date,At=Es(Je,1),Ye=[{label:`Hoje (${dr(Je,"dd/MM")})`,value:dr(Je,"yyyy-MM-dd"),icon:"",date:Je},{label:`Amanh (${dr(At,"dd/MM")})`,value:dr(At,"yyyy-MM-dd"),icon:"",date:At},{label:"Outro dia...",value:"custom",icon:""},{label:" Menu",value:"menu",action:"menu"}];c("Para qual dia voc gostaria de agendar?",Ye,1e3),g("data")},wr=async ke=>{if(console.log("[handleDataSelection] Iniciando...",{button:ke,currentStep:o}),ke.action==="menu"){d(" Menu");try{me(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{B(!1)}catch{}g("identificacao"),setTimeout(()=>{Bt()},400);return}if(ke.value==="custom"){d(" Outro dia..."),l("**Perfeito!** Me informe a **data desejada** no formato DD/MM/AAAA:",600),k("data_custom"),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},800);return}const We=ke.date;if(!We){console.error("[handleDataSelection] Data no encontrada no boto:",ke);return}if(d(ke.label),m("data",We),!!i?.editing_agendamento||!!V){console.log("[handleDataSelection] Modo edio detectado - recarregando horrios"),console.log("[handleDataSelection] Quadra ID:",i.quadra?.id),console.log("[handleDataSelection] Nova Data:",We),B(!1),F("horario"),v(!0);const ce=await he(i.quadra.id,We,V?.id);if(console.log("[handleDataSelection] Resultado:",ce),v(!1),ce.fechada){const ze=dr(We,"dd/MM/yyyy",{locale:$a}),xt=dr(We,"EEEE",{locale:$a});if(ce.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${ze}** (${xt}). 

**Motivo:** ${ce.observacao}`,800);else if(ce.motivo==="dia_semana"){const rr=dr(We,"EEEE",{locale:$a});l(`**Ops!** A quadra no funciona ${rr==="domingo"||rr==="sbado"?"aos":"s"} **${rr}s**. `,800)}setTimeout(()=>{l("Escolha **outra data**:",1200),setTimeout(()=>{Lt()},400)},1600);return}const qe=ce.slots;if(qe&&qe.length>0){const ze=ot(qe);let xt="";ze.length===1?xt=`Tenho **horrios livres** das **${ze[0].inicio}** s **${ze[0].fim}**! `:xt=`Tenho **horrios livres** ${ze.map((ir,Kr)=>Kr===ze.length-1?`e das **${ir.inicio}** s **${ir.fim}**`:Kr===0?`das **${ir.inicio}** s **${ir.fim}**`:`das **${ir.inicio}** s **${ir.fim}**`).join(", ")}! `,console.log("[handleDataSelection] Mostrando horrios disponveis e input"),l(xt,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{console.log("[handleDataSelection] Ativando showInput=true"),B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else console.log("[handleDataSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para essa quadra nesse dia.  Tente outra data.");return}console.log("[handleDataSelection] Fluxo normal (no edio)"),v(!0);const Je=await he(i.quadra.id,We);if(console.log("[handleDataSelection] Resultado (fluxo normal):",Je),v(!1),Je.fechada){const ce=dr(We,"dd/MM/yyyy",{locale:$a}),qe=dr(We,"EEEE",{locale:$a});if(Je.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${ce}** (${qe}). 

**Motivo:** ${Je.observacao}`,800);else if(Je.motivo==="dia_semana"){const ze=dr(We,"EEEE",{locale:$a});l(`**Ops!** A quadra no funciona ${ze==="domingo"||ze==="sbado"?"aos":"s"} **${ze}s**. 

Escolha outro dia da semana!`,800)}setTimeout(()=>{l("Que tal tentar **outra data**? ",1200),setTimeout(()=>{Lt()},400)},1600);return}const At=Je.slots;if(At.length===0){console.log("[handleDataSelection] Nenhum horrio disponvel"),l("Ops! No encontrei **horrios disponveis** para esse dia.  Que tal tentar outro dia?"),setTimeout(()=>{l("Escolha **outra data**:",800),setTimeout(()=>{Lt()},400)},1200);return}const Ye=ot(At);let lr="";Ye.length===1?lr=`Tenho **horrios livres** das **${Ye[0].inicio}** s **${Ye[0].fim}**! `:lr=`Tenho **horrios livres** ${Ye.map((qe,ze)=>ze===Ye.length-1?`e das **${qe.inicio}** s **${qe.fim}**`:ze===0?`das **${qe.inicio}** s **${qe.fim}**`:`das **${qe.inicio}** s **${qe.fim}**`).join(", ")}! `,l(lr,800),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",1e3),g("horario"),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},1e3)},1e3+600)},1400)},he=async(ke,We,Ze=null)=>{try{console.log("[loadHorariosDisponiveis] quadraId:",ke),console.log("[loadHorariosDisponiveis] data:",We);const Je=E.find(at=>at.id===ke);if(!Je)return console.error("[loadHorariosDisponiveis] Quadra no encontrada:",ke),[];console.log("[loadHorariosDisponiveis] Quadra encontrada:",Je.nome),console.log("[loadHorariosDisponiveis] Horrio funcionamento:",Je.hora_inicio,"-",Je.hora_fim);const At=dr(We,"yyyy-MM-dd"),Ye=We.getDay();console.log("[loadHorariosDisponiveis] Verificando funcionamento para:",At,"dia da semana:",Ye);const{data:lr,error:ce}=await Q.from("quadras_dias_funcionamento").select("*").eq("codigo_empresa",n).eq("quadra_id",ke).or(`and(tipo.eq.data_fechamento,data_fechamento.eq.${At}),and(tipo.eq.dia_semana,dia_semana.eq.${Ye})`);if(ce)console.error("[loadHorariosDisponiveis] Erro ao buscar configuraes de funcionamento:",ce);else{console.log("[loadHorariosDisponiveis] Configuraes encontradas:",lr?.length||0);const at=lr?.find(Fe=>Fe.tipo==="data_fechamento"&&Fe.data_fechamento===At);if(at&&!at.funciona)return console.log("[loadHorariosDisponiveis] Quadra fechada em data especfica:",at.observacao),{slots:[],fechada:!0,motivo:"data_especifica",observacao:at.observacao||"Fechamento especial"};const Te=lr?.find(Fe=>Fe.tipo==="dia_semana"&&Fe.dia_semana===Ye);if(Te&&!Te.funciona)return console.log("[loadHorariosDisponiveis] Quadra no funciona neste dia da semana"),{slots:[],fechada:!0,motivo:"dia_semana",observacao:`Quadra fechada s ${["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"][Ye]}s`};console.log("[loadHorariosDisponiveis] Quadra funciona normalmente na data selecionada")}const qe=Po(We),ze=Es(qe,1);let xt=Q.from("agendamentos").select("inicio, fim, status").eq("codigo_empresa",n).eq("quadra_id",ke).gte("inicio",qe.toISOString()).lt("inicio",ze.toISOString()).neq("status","canceled");Ze&&(xt=xt.neq("id",Ze),console.log("[loadHorariosDisponiveis] Excluindo agendamento sendo editado:",Ze));const{data:rr,error:ir}=await xt;if(ir)throw ir;console.log("[loadHorariosDisponiveis] Agendamentos encontrados:",rr?.length||0);const Kr=parseInt(Je.hora_inicio?.split(":")[0]||"6");let jr=parseInt(Je.hora_fim?.split(":")[0]||"24");jr===0&&(jr=24);const sa=new Date,ia=Po(We).getTime()===Po(sa).getTime(),Kn=[];for(let at=Kr;at<jr;at++)for(let Te of[0,30]){const Fe=P_(A_(We,at),Te),cr=d8(Fe,30);if(ia&&Fe<sa)continue;rr?.some(Xr=>{const Ft=new Date(Xr.inicio),kr=new Date(Xr.fim),jt=Math.floor(Fe.getTime()/6e4),er=Math.floor(cr.getTime()/6e4),Nt=Math.floor(Ft.getTime()/6e4),Cr=Math.floor(kr.getTime()/6e4);return er===Nt||jt===Cr?!1:jt<Cr&&er>Nt})||Kn.push({inicio:dr(Fe,"HH:mm"),fim:dr(cr,"HH:mm"),inicioDate:Fe,fimDate:cr})}return console.log("[loadHorariosDisponiveis] Total de slots disponveis:",Kn.length),M(Kn),{slots:Kn,fechada:!1,motivo:null,observacao:null}}catch(Je){return console.error("[loadHorariosDisponiveis] Erro ao carregar horrios:",Je),M([]),{slots:[],fechada:!1,motivo:"erro",observacao:"Erro ao carregar horrios"}}},ot=ke=>{if(ke.length===0)return[];const We=[];let Ze={inicio:ke[0].inicio,fim:ke[0].fim};for(let At=1;At<ke.length;At++)ke[At].inicio===Ze.fim?Ze.fim=ke[At].fim:(We.push(Ze),Ze={inicio:ke[At].inicio,fim:ke[At].fim});We.push(Ze);const Je=At=>{const[Ye,lr]=At.split(":").map(Number);return Ye===0&&lr===0?24*60:Ye*60+lr};return We.filter(At=>Je(At.fim)-Je(At.inicio)>=60)},Vt=({inicio:ke,fim:We,esporte:Ze})=>{const[Je,At]=ke.split(":").map(Number),[Ye,lr]=We.split(":").map(Number),ce=i.data,qe=P_(A_(ce,Je),At),ze=Ye===0&&lr===0?P_(A_(Es(ce,1),0),0):P_(A_(ce,Ye),lr),xt={inicio:ke,fim:We,inicioDate:qe,fimDate:ze};if(d(`${xt.inicio} - ${xt.fim}  ${Ze}`),console.log("[handleHorarioSubmit] Atualizando horrio:",xt),console.log("[handleHorarioSubmit] Atualizando esporte:",Ze),m("horario",xt),m("esporte",Ze),B(!1),o==="review"||z==="horario"){setTimeout(()=>{F(null),g("review"),Me(xt,Ze)},600);return}const rr=i.participantes||[];if(!(Array.isArray(rr)&&rr.length>0)){const jr=[{nome:i.cliente.nome,cliente_id:i.cliente.id,principal:!0}];m("participantes",jr)}const Kr=ae(i.cliente.nome);l(`Perfeito! ${Kr}, voc j est na lista! `,800),l('Quer adicionar mais pessoas? Digite o nome e clique em "Adicionar" para cada um, ou finalize quando quiser.',1400),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},600)},1400+600),g("participantes")},qt=async()=>{const ke=i?.quadra?.id,We=i?.data,Ze=i?.horario;if(!ke||!We||!Ze?.inicioDate||!Ze?.fimDate)return{ok:!0,conflito:!1};const Je=await he(ke,We,null);if(Je?.fechada)return{ok:!0,conflito:!0,motivo:"fechada",detalhe:Je};const At=Array.isArray(Je?.slots)?Je.slots:[],Ye=Ze.inicioDate,lr=Ze.fimDate,ce=(ze,xt)=>{const rr=ze.getTime(),ir=xt.getTime();return At.some(Kr=>Kr?.inicioDate?.getTime?.()===rr&&Kr?.fimDate?.getTime?.()===ir)};let qe=new Date(Ye);for(;qe.getTime()<lr.getTime();){const ze=d8(qe,30);if(!ce(qe,ze))return{ok:!0,conflito:!0,motivo:"conflito"};qe=ze}return{ok:!0,conflito:!1}},Re=ke=>{if(!ke||!ke.trim())return;const We=i.participantes||[],Ze={nome:ke.trim(),cliente_id:null,principal:!1},Je=[...We,Ze];m("participantes",Je)},Ct=ke=>{if(!Array.isArray(ke)||ke.length===0)return;const We=ze=>String(ze||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g," "),Ze=i.cliente,Je=Ze?.nome?String(Ze.nome).trim():null,At=Je?We(Je):null,Ye=i.participantes||[],lr=Ye.length>0?Ye:Je&&Ze?[{nome:Je,cliente_id:Ze.id,principal:!0}]:[],ce=[];if(!!i?.editing_agendamento){let ze=lr.find(xt=>xt.principal)||(Je&&Ze?{nome:Je,cliente_id:Ze.id,principal:!0}:null);ze&&ce.push({...ze,principal:!0}),ke.forEach(xt=>{const rr=String(xt||"").trim();if(!rr)return;const ir=We(rr);At&&ir===At||ce.push({nome:rr,cliente_id:null,principal:!1})})}else lr.forEach(ze=>{const xt=We(ze.nome),rr=At&&xt===At;ce.push({...ze,principal:rr})}),ke.forEach(ze=>{const xt=String(ze||"").trim();if(!xt)return;const rr=We(xt);At&&rr===At||ce.push({nome:xt,cliente_id:null,principal:!1})});ce.length===0&&Je&&Ze&&ce.push({nome:Je,cliente_id:Ze.id,principal:!0}),m("participantes",ce)},Wt=ke=>{const We=i.participantes||[];if(ke===0)return;const Ze=We.filter((Je,At)=>At!==ke);m("participantes",Ze)},Er=ke=>{const We=i.participantes||[];if(We.length===0){l("Voc precisa ter pelo menos 1 participante!",400);return}try{const Je=(ke||"").trim();Je&&Je!==i.esporte&&m("esporte",Je)}catch{}B(!1);const Ze=We.length;if(Ze===1)d(" Apenas eu por enquanto");else{const Je=We.filter(At=>!At.principal).map(At=>At.nome).join(", ");d(` Eu + ${Je} (${Ze} pessoas)`)}setTimeout(()=>{F(null);try{const Je=(ke||"").trim();Me(null,Je||null)}catch{Me()}},600)},Me=(ke=null,We=null,Ze=!1,Je=null,At=null,Ye=null,lr=null)=>{const ce=ke||i.horario,qe=We||i.esporte,ze=Je||i.quadra,xt=At||i.data,rr=Ye||i.participantes||[],ir=!!(lr||i?.editing_agendamento||V);if(console.log("[mostrarResumo] Selections atuais:",i),console.log("[mostrarResumo] Horrio usado:",ce),console.log("[mostrarResumo] Esporte usado:",qe),console.log("[mostrarResumo] Quadra atual:",ze),console.log("[mostrarResumo] Data atual:",xt),console.log("[mostrarResumo] Modo edio inicial:",Ze),!xt||!ce||!ze){console.error("[mostrarResumo] Dados obrigatrios faltando:",{dataFinal:xt,horarioFinal:ce,quadraFinal:ze});return}if(!Ze){const Oe=ov("reviewData");l(Oe,400)}const Kr=rr.map((Oe,Yt)=>{const Pt=Yt===0?"":"",Qt=Yt===0?" (voc)":"";return`${Pt} ${Oe.nome}${Qt}`}).join(`
`),jr=dr(xt,"dd/MM/yyyy",{locale:$a}),sa=dr(xt,"EEEE",{locale:$a}),[ia,Kn]=ce.inicio.split(":").map(Number),[at,Te]=ce.fim.split(":").map(Number);let Fe=at*60+Te-(ia*60+Kn);at===0&&Te===0&&(Fe=24*60-(ia*60+Kn));const cr=Math.floor(Fe/60),ht=Fe%60,Xr=ht>0?`${cr}h ${ht}min`:`${cr}h`,Ft=ze.valor||0,kr=Fe/30,jt=Math.round(Ft*kr*100)/100,er=jt/rr.length;console.log("[mostrarResumo] Clculo do valor:"),console.log("- Valor por meia hora:",Ft),console.log("- Slots de 30min:",kr),console.log("- Durao em minutos:",Fe),console.log("- Valor total:",jt),console.log("- Participantes:",rr.length),console.log("- Valor dividido:",er);const Nt=i?.empresa?.endereco&&String(i.empresa.endereco).trim().length>0?String(i.empresa.endereco).trim():null,Cr=Nt?`
 **Endereo**
${Nt}
`:"",Lr=Oe=>{if(!Oe)return"N/A";const Yt=String(Oe).replace(/\D/g,"");return Yt.length===11?`(${Yt.slice(0,2)}) ${Yt.slice(2,7)}-${Yt.slice(7)}`:Yt.length===10?`(${Yt.slice(0,2)}) ${Yt.slice(2,6)}-${Yt.slice(6)}`:Oe},un=i.cliente.telefone||i.cliente.whatsapp||null,ra=Lr(un),Wn=` **RESUMO DO AGENDAMENTO**

 **Quadra**
${ze.nome}${Cr}
 **Data**
${jr} (${sa})

 **Horrio**
${ce.inicio} s ${ce.fim}
 Durao: **${Xr}**

 **Modalidade**
${qe}

 **Participantes** (${rr.length})
${Kr}

 **Valor Total**
R$ **${jt.toFixed(2).replace(".",",")}**
 **Valor Dividido**
R$ **${er.toFixed(2).replace(".",",")}** por pessoa

 **Responsvel**
${i.cliente.nome}
 ${ra}`,ln=Ze?200:1e3,da=Wn.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:Wn,copyable:!0,copyText:da},ln);const va=[{label:ir?"Salvar Alteraes":"Confirmar Agendamento",value:ir?"confirm":"criar agendamento",icon:""}],oa=[];E.length>1&&oa.push({label:"Editar Quadra",value:"edit_quadra",icon:""}),oa.push({label:"Editar Data",value:"edit_data",icon:""}),oa.push({label:"Editar Horrio e Esporte",value:"edit_horario",icon:""}),oa.push({label:"Editar Participantes",value:"edit_participantes",icon:""}),(Ze||ir&&!i?.editing_agendamento)&&oa.push({label:"Gerar Times",value:"gerar_times",icon:""}),ir&&oa.push({label:"Cancelar Agendamento",value:"cancelar_agendamento",icon:""});const ee=[...va,...oa];ee.push({label:" Menu",value:"menu",action:"menu"}),c("Est tudo correto?",ee,Ze?400:1600),g("review")},lt=(ke,We=!1)=>{l(We?" **Perfeito!** Suas **alteraes** foram **salvas com sucesso!**":" **Pronto!** Seu **agendamento** foi **confirmado com sucesso!**",600,"green");const Je=i.participantes||[],At=Je.map(Ft=>` ${Ft.nome}`).join(`
`),Ye=dr(i.data,"dd/MM/yyyy",{locale:$a}),lr=dr(i.data,"EEEE",{locale:$a}),[ce,qe]=i.horario.inicio.split(":").map(Number),[ze,xt]=i.horario.fim.split(":").map(Number);let rr=ze*60+xt-(ce*60+qe);ze===0&&xt===0&&(rr=24*60-(ce*60+qe));const ir=Math.floor(rr/60),Kr=rr%60,jr=Kr>0?`${ir}h ${Kr}min`:`${ir}h`,sa=i.quadra.valor||0,ia=rr/30,Kn=Math.round(sa*ia*100)/100,at=Je.length>0?Kn/Je.length:0,Te=i?.empresa?.endereco&&String(i.empresa.endereco).trim().length>0?String(i.empresa.endereco).trim():null,Fe=Te?`
 **Endereo**
${Te}
`:"",cr=` **AGENDAMENTO CONFIRMADO**

 **Cdigo:** #${ke.codigo}

 **Local**
${i.quadra.nome}${Fe}

 **Quando**
${Ye} (${lr})
 ${i.horario.inicio} s ${i.horario.fim} **(${jr})**

 **Modalidade**
${i.esporte}

 **Participantes** (${Je.length})
${At}

 **Valor Total:** R$ **${Kn.toFixed(2).replace(".",",")}**
 **Valor Dividido:** R$ **${at.toFixed(2).replace(".",",")}** por pessoa

 **Responsvel:** ${i.cliente.nome}`,ht=cr.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:cr,copyable:!0,copyText:ht},1200),c("O que voc gostaria de fazer?",[{label:"Gerar Times",value:"gerar_times",icon:""},{label:"Editar Agendamento",value:"editar_agendamento",icon:""},{label:"Cancelar Agendamento",value:"cancelar_agendamento",icon:""},{label:"Finalizar Atendimento",value:"finalizar",icon:""}],1800)},gt=async()=>{try{y(!0)}catch{}try{const ke=(i.participantes||[]).map(Nt=>String(Nt?.nome||"").trim()).filter(Boolean);if(!ke||ke.length===0){l("No h participantes suficientes para formar times.");return}const We=String(i?.esporte||i?.quadra?.tipo||"").toLowerCase();let Ze=0,Je="unknown";try{console.log("[Teams] Start generation modalidade=%o",We)}catch{}try{const{data:Nt}=await Q.functions.invoke("infer-team-size",{body:{modalidade:We,quadra:i?.quadra||null,totalPlayers:(i.participantes||[]).length}});try{console.log("[Teams] Edge infer-team-size response=%o",Nt)}catch{}Nt&&Number(Nt.teamSize)>0&&(Ze=Number(Nt.teamSize),Je="edge")}catch{}if(!Ze)if(/(praia|areia)/i.test(We)){Ze=5,Je="fallback:beach";try{console.log("[Teams] Fallback matched: praia/areia -> teamSize=5")}catch{}}else if(/(v[o]lei|voleibol)/i.test(We)){Ze=6,Je="fallback:volley";try{console.log("[Teams] Fallback matched: volei/voleibol -> teamSize=6")}catch{}}else if(/(hand|handebol)/i.test(We)){Ze=7,Je="fallback:hand";try{console.log("[Teams] Fallback matched: handebol -> teamSize=7")}catch{}}else if(/(futsal|society)/i.test(We)){Ze=5,Je="fallback:futsal";try{console.log("[Teams] Fallback matched: futsal/society -> teamSize=5")}catch{}}else if(/(futebol|campo)/i.test(We)){Ze=11,Je="fallback:campo";try{console.log("[Teams] Fallback matched: futebol/campo -> teamSize=11")}catch{}}else{Ze=5,Je="fallback:default";try{console.log("[Teams] Fallback matched: default -> teamSize=5")}catch{}}{const Nt=String(We||"").toLowerCase(),Cr=/(v[o]lei|voleibol)/.test(Nt),Lr=/(praia|areia)/.test(Nt),un=Ze;Cr&&(Ze=Lr?5:6),Cr&&(Je=Lr?"forced:beach":"forced:volley");try{console.log("[Teams] Normalization: isVolley=%s isBeach=%s before=%s after=%s source=%s",Cr,Lr,un,Ze,Je)}catch{}}const At=Nt=>String(Nt||"").trim().toLowerCase(),Ye=Array.isArray(i?.fixos)?i.fixos:[],lr=Array.isArray(i?.goleiros)?i.goleiros:[],ce=Array.isArray(i?.levantadores)?i.levantadores:[],qe=new Set([...Ye,...lr,...ce].map(At).filter(Boolean)),ze=Nt=>qe.has(At(Nt)),xt=(()=>{const Nt={},Cr=i?.fixoRoles;if(Cr&&typeof Cr=="object")for(const Lr of Object.keys(Cr))Nt[Lr]=Cr[Lr];return lr.forEach(Lr=>{Nt[At(Lr)]="Goleiro"}),ce.forEach(Lr=>{Nt[At(Lr)]="Levantador"}),Nt})(),rr=Nt=>ze(Nt)?` (${xt[At(Nt)]||"Fixo"})`:"",ir=ke.filter(ze),jr=ke.filter(Nt=>!ze(Nt)).slice();for(let Nt=jr.length-1;Nt>0;Nt--){const Cr=Math.floor(Math.random()*(Nt+1));[jr[Nt],jr[Cr]]=[jr[Cr],jr[Nt]]}Ze<2&&(Ze=2);const sa=Nt=>Nt.map((Cr,Lr)=>`${Lr+1}) ${Cr}${rr(Cr)}`).join(`
`)||"",ia=ke.length;let Kn=0;if(ia>=2*Ze){Kn=Math.max(2,Math.floor(ia/Ze));try{console.log("[Teams] Brute rule: canMakeTwoBase=true -> teamCount=%s teamSize=%s",Kn,Ze)}catch{}}else{const Nt=Ze;Ze>5&&(Ze=5),Kn=Math.ceil(ia/Ze);try{console.log("[Teams] Brute rule: canMakeTwoBase=false -> forceSize %s->%s, teamCount=%s",Nt,Ze,Kn)}catch{}}let Fe=` **Times gerados (${We?We[0].toUpperCase()+We.slice(1):"modalidade"})**`;const cr=["","","","","",""],ht=(We||"").toLowerCase(),Xr=/(fut|society|sal[a]o)/.test(ht),Ft=/(v[o]lei|volei|voleibol)/.test(ht);try{console.log("[Teams] teamSize=%s totalPlayers=%s teamCount=%s isVolleyLike=%s isSoccerLike=%s source=%s",Ze,ia,Kn,Ft,Xr,Je)}catch{}if(Kn>=2){const Nt=Array.from({length:Kn},()=>[]);if(Xr&&lr.length>0)for(let ln=0;ln<Kn;ln++){const da=lr[ln%lr.length],va=Nt[ln].some(oa=>lr.includes(oa));Nt[ln].length<Ze&&!va&&!Nt[ln].includes(da)&&Nt[ln].push(da)}if(Ft&&ce.length>0)for(let ln=0;ln<Kn;ln++){const da=ce[ln%ce.length],va=Nt[ln].some(oa=>ce.includes(oa));Nt[ln].length<Ze&&!va&&!Nt[ln].includes(da)&&Nt[ln].push(da)}const Cr=ir.filter(ln=>!lr.includes(ln)&&!ce.includes(ln));if(Cr.length>0){let ln=0;for(const da of Cr){let va=0;for(;va<Kn&&Nt[ln].length>=Ze;)ln=(ln+1)%Kn,va++;Nt[ln].length<Ze&&Nt[ln].push(da),ln=(ln+1)%Kn}}for(const ln of jr){let da=0,va=1/0;for(let oa=0;oa<Nt.length;oa++)Nt[oa].length<va&&Nt[oa].length<Ze&&(va=Nt[oa].length,da=oa);Nt[da].length<Ze&&Nt[da].push(ln)}for(let ln=0;ln<Nt.length;ln++)for(;Nt[ln].length<Ze;)if(Xr&&lr.length>0){if(Nt[ln].some(oa=>lr.includes(oa)))break;const va=lr.find(oa=>!Nt[ln].includes(oa));if(va)Nt[ln].push(va);else break}else if(Ft&&ce.length>0){if(Nt[ln].some(oa=>ce.includes(oa)))break;const va=ce.find(oa=>!Nt[ln].includes(oa));if(va)Nt[ln].push(va);else break}else break;const Lr=Kn*Ze,un=ia>Lr?[...ir,...jr].slice(Lr):[];Xr&&lr.length>0?un.some(da=>lr.includes(da))||un.unshift(lr[0]):Ft&&ce.length>0&&(un.some(da=>ce.includes(da))||un.unshift(ce[0]));try{const ln=Nt.map(da=>da.length);console.log("[Teams] Final distribution teamSize=%s teams=%o reservas=%o",Ze,ln,un)}catch{}const ra=[];for(;un.length>=Ze;)ra.push(un.splice(0,Ze));Nt.concat(ra).forEach((ln,da)=>{const va=cr[da%cr.length];Fe+=`

**${va} Time ${da+1} (${ln.length})**:
${sa(ln)}`}),un.length&&(Fe+=`

** Reservas (${un.length})**:
${sa(un)}`)}else{const Nt=[...ir,...jr];if(Nt.length===0){l("No h participantes suficientes para formar times.");return}if(Nt.length===1)Fe+=`

 Ainda no h jogadores suficientes para formar 2 times. Adicione mais participantes.`,Fe+=`

** Time 1 (1)**:
1) ${Nt[0]}${rr(Nt[0])}`;else{const Cr=Math.min(Ze,Math.ceil(Nt.length/2)),Lr=Math.min(Ze,Nt.length-Cr),un=Nt.slice(0,Cr),ra=Nt.slice(Cr,Cr+Lr);Fe+=`

 Jogadores insuficientes para 2 equipes completas de ${Ze}. Montei 2 times balanceados de ${un.length} e ${ra.length}.`,Fe+=`

** Time 1 (${un.length})**:
${sa(un)}`,Fe+=`

** Time 2 (${ra.length})**:
${sa(ra)}`}}const kr=Fe.replace(/\*\*(.+?)\*\*/g,"*$1*");l({text:Fe,copyable:!0,copyText:kr},600);const er=[...!0?[{label:"Gerar novamente",value:"gerar_times_again",icon:""}]:[],{label:"Concluir",value:"aceitar_times",icon:""}];c("Tudo certo com os times?",er,1400)}catch{l("No foi possvel gerar times agora. Tente novamente.")}},or=async ke=>{if(ke.action==="menu"){d(" Menu");try{me(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{B(!1)}catch{}g("identificacao"),setTimeout(()=>{Bt()},400);return}if(ke.quadra){await Sr(ke);return}if(ke.date){await wr(ke);return}if(ke.agendamento){const We=dr(new Date(ke.agendamento.inicio),"dd/MM/yyyy",{locale:$a}),Ze=dr(new Date(ke.agendamento.inicio),"HH:mm"),Je=dr(new Date(ke.agendamento.fim),"HH:mm");d(`${We}  ${Ze}-${Je}`),await ur(ke.agendamento);return}switch(ke.value){case"novo_agendamento":{d(" Fazer Agendamento");try{me(null)}catch{}try{m("editing_agendamento",null)}catch{}try{m("quadra",null)}catch{}try{m("data",null)}catch{}try{m("horario",null)}catch{}try{m("modalidade",null)}catch{}try{m("quantidade",null)}catch{}try{m("nomes",[])}catch{}try{m("participantes",[])}catch{}try{m("levantadores",[])}catch{}try{m("goleiros",[])}catch{}try{m("fixos",[])}catch{}try{m("fixoRoles",{})}catch{}try{F(null)}catch{}try{B(!1)}catch{}await ge();break}case"buscar_agendamento":{d(" Editar Agendamento"),l("Vou buscar seus agendamentos...",600),br();break}case"finalizar_atendimento":{d(" Finalizar Atendimento");try{resetConversation()}catch{}l("Atendimento finalizado. Se precisar,  s me chamar de novo! ",400);break}case"corrigir_telefone":{d(" Informei o telefone errado"),m("cliente",null),m("identificacao_valor",null),k("telefone"),B(!0),g("identificacao");break}case"corrigir_email":{d(" Informei o e-mail errado"),m("cliente",null),m("identificacao_valor",null),k("email"),B(!0),g("identificacao");break}case"continuar_fluxo":{Bt();break}case"gerar_times":case"gerar_times_again":{d(ke.value==="gerar_times_again"?" Gerar novamente":" Gerar Times"),await gt();break}case"aceitar_times":{d(" Concluir"),l("Beleza! O que voc gostaria de fazer agora?",400),setTimeout(()=>{Bt()},800);break}case"confirm":const We=!!i?.editing_agendamento||!!V;d(We?" Salvar Alteraes":" Confirmar Agendamento"),We?await ha():await pn();break;case"criar agendamento":d(" Confirmar Agendamento"),await pn();break;case"edit_quadra":d(" Editar Quadra");const Je=E.map(jr=>({label:jr.nome,value:jr.id,icon:"",subtitle:jr.descricao||jr.tipo||null,quadra:jr}));c("Qual quadra voc quer?",Je,600);break;case"edit_data":d(" Editar Data");const At=new Date,Ye=Es(At,1),lr=[{label:`Hoje (${dr(At,"dd/MM")})`,value:dr(At,"yyyy-MM-dd"),icon:"",date:At},{label:`Amanh (${dr(Ye,"dd/MM")})`,value:dr(Ye,"yyyy-MM-dd"),icon:"",date:Ye},{label:"Outro dia...",value:"custom",icon:""}];c("Para qual dia?",lr,600),g("data");break;case"edit_horario":d(" Editar Horrio e Esporte"),B(!1),F("horario"),v(!0);const ce=await he(i.quadra.id,i.data,V?.id);if(v(!1),ce.fechada){const jr=dr(i.data,"dd/MM/yyyy",{locale:$a}),sa=dr(i.data,"EEEE",{locale:$a});if(ce.motivo==="data_especifica")l(`**Ops!** A quadra estar **fechada** no dia **${jr}** (${sa}). 

**Motivo:** ${ce.observacao}`,800);else if(ce.motivo==="dia_semana"){const ia=dr(i.data,"EEEE",{locale:$a});l(`**Ops!** A quadra no funciona ${ia==="domingo"||ia==="sbado"?"aos":"s"} **${ia}s**. `,800)}setTimeout(()=>{l("No  possvel editar o horrio. Escolha **outra data** ou **quadra**:",1200),setTimeout(()=>{Lt()},400)},1600);return}const qe=ce.slots;if(qe&&qe.length>0){const jr=ot(qe);let sa="";jr.length===1?sa=`Tenho **horrios livres** das **${jr[0].inicio}** s **${jr[0].fim}**! `:sa=`Tenho **horrios livres** ${jr.map((Kn,at)=>at===jr.length-1?`e das **${Kn.inicio}** s **${Kn.fim}**`:at===0?`das **${Kn.inicio}** s **${Kn.fim}**`:`das **${Kn.inicio}** s **${Kn.fim}**`).join(", ")}! `,l(sa,600),setTimeout(()=>{l("Escolha o horrio de incio e trmino: ",800),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1e3)},800)}else l("Ops! No encontrei **horrios disponveis**. ");break;case"edit_participantes":d(" Editar Participantes"),B(!1),F("participantes"),l("Edite a lista de participantes:",600),setTimeout(()=>{B(!0),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},200)},800);break;case"finalizar":d(" Finalizar Atendimento");const ze=["Pronto! Seu agendamento est confirmado! ","Perfeito! Agendamento realizado com sucesso! ","Tudo certo! Seu horrio est garantido! ","Sucesso! Agendamento confirmado! "],xt=ze[Math.floor(Math.random()*ze.length)];l(xt,800),setTimeout(()=>{zr()},1400);break;case"cancelar_agendamento":d(" Cancelar Agendamento");const rr=[{label:"Sim, cancelar",value:"confirmar_cancelamento",icon:""},{label:"No, voltar",value:"voltar_cancelamento",icon:""}],ir=["Tem certeza que deseja cancelar este agendamento?","Confirma o cancelamento do agendamento?","Realmente quer cancelar? Esta ao no pode ser desfeita.","Deseja mesmo cancelar este agendamento?"],Kr=ir[Math.floor(Math.random()*ir.length)];c(Kr,rr,600);break;case"confirmar_cancelamento":await an();break;case"voltar_cancelamento":d(" Voltar"),l("Ok! Voltando ao resumo do agendamento.",400),setTimeout(()=>{Me(null,null,!0,null,null,null,V)},800);break;case"editar_agendamento":d(" Editar Agendamento"),l("Claro! O que voc gostaria de alterar?",600),setTimeout(()=>{Me(null,null,!0)},800);break;case"novo_agendamento":d(" Fazer Agendamento"),ge();break;case"buscar_agendamento":d(" Editar Agendamento"),l("Vou buscar seus agendamentos...",600),br();break;case"finalizar_atendimento":d(" Finalizar Atendimento"),zr();break;default:console.warn("[Isis] Ao no reconhecida:",ke.value)}},br=async()=>{try{console.log("[buscarAgendamentosCliente] Iniciando busca de agendamentos...");const{data:ke,error:We}=await Q.from("agendamentos").select(`
          id,
          codigo,
          inicio,
          fim,
          modalidade,
          status,
          valor_total,
          quadras!inner(nome, descricao, valor)
        `).eq("codigo_empresa",n).eq("cliente_id",i.cliente.id).in("status",["scheduled","confirmed"]).gte("inicio",new Date().toISOString()).order("inicio",{ascending:!0});if(We)throw We;if(!ke||ke.length===0){l("No encontrei agendamentos futuros para voc. ",800),l("Que tal fazer um novo agendamento? ",1400),setTimeout(()=>{ge()},2e3);return}if(ke.length===1){const Ze=ke[0],Je=dr(new Date(Ze.inicio),"dd/MM/yyyy",{locale:$a}),At=dr(new Date(Ze.inicio),"HH:mm"),Ye=dr(new Date(Ze.fim),"HH:mm");l(`Encontrei seu agendamento para ${Je} das ${At} s ${Ye} - ${Ze.modalidade}! `,800),setTimeout(()=>{ur(Ze)},1200)}else{l(`Encontrei ${ke.length} agendamentos futuros! Qual voc quer editar?`,800);const Ze=ke.map(Je=>{const At=new Date(Je.inicio),Ye=dr(At,"dd/MM/yyyy",{locale:$a}),lr=dr(At,"EEEE",{locale:$a}),ce=dr(At,"HH:mm"),qe=dr(new Date(Je.fim),"HH:mm"),ze=(new Date(Je.fim)-At)/(1e3*60),xt=Math.floor(ze/60),rr=ze%60;let ir="";xt>0?ir=rr>0?`${xt}h${rr}m`:`${xt}h`:ir=`${rr}m`;const Kr=Number(Je.quadras?.valor??0),jr=ze/30,ia=(Math.round(Kr*jr*100)/100).toFixed(2).replace(".",","),Kn=new Date,at=new Date(Kn);at.setDate(Kn.getDate()+1);let Te="";return At.toDateString()===Kn.toDateString()?Te="Hoje":At.toDateString()===at.toDateString()?Te="Amanh":Te=`${lr.charAt(0).toUpperCase()+lr.slice(1)}, ${Ye}`,{label:`${Te}  ${ce}-${qe}`,value:`editar_agendamento_${Je.id}`,icon:"",subtitle:`${Je.quadras?.nome||"Quadra"}  ${Je.modalidade||""}  ${ir}`,agendamento:Je}});setTimeout(()=>{c("Escolha o agendamento:",Ze,600)},1200)}}catch(ke){console.error("[Isis] Erro ao buscar agendamentos:",ke),l("Ops! Tive um problema ao buscar seus agendamentos. ",800),l("Que tal tentar fazer um novo agendamento?",1400),setTimeout(()=>{ge()},2e3)}},ur=async ke=>{try{console.log("[carregarAgendamentoParaEdicao] Iniciando carregamento do agendamento:",ke.id),console.debug("[carregarAgendamentoParaEdicao] Iniciando JOIN: agendamentos  quadras, agendamento_participantes");const{data:We,error:Ze}=await Q.from("agendamentos").select(`
          *,
          quadras(id, nome, descricao, modalidades, valor),
          agendamento_participantes(nome, cliente_id, ordem, is_representante)
        `).eq("id",ke.id).single();if(console.debug("[carregarAgendamentoParaEdicao] Resultado JOIN:",{hasError:!!Ze,error:Ze?.message,code:Ze?.code,participantes_len:Array.isArray(We?.agendamento_participantes)?We.agendamento_participantes.length:null}),Ze)throw console.error("[Isis] Erro ao buscar agendamento:",Ze),new Error(`Agendamento no encontrado ou inacessvel: ${Ze.message}`);if(!We)throw new Error("Agendamento no encontrado");const Je=new Date(We.inicio),At=dr(Je,"HH:mm"),Ye=dr(new Date(We.fim),"HH:mm");let lr=We.quadras||null;if(!lr)try{const{data:ir}=await Q.from("quadras").select("id, nome, descricao, modalidades, valor").eq("id",We.quadra_id).single();lr=ir||null}catch{}m("quadra",lr),m("data",Je),m("horario",{inicio:At,fim:Ye,inicioDate:new Date(We.inicio),fimDate:new Date(We.fim)}),m("esporte",We.modalidade);const ce=We.cliente_id||i.cliente?.id||null;let qe=We.agendamento_participantes||[];if(!qe||qe.length===0)try{console.debug("[carregarAgendamentoParaEdicao] JOIN sem participantes. Fazendo SELECT direto em agendamento_participantes...");const{data:ir,error:Kr}=await Q.from("agendamento_participantes").select("nome, cliente_id, codigo_empresa, ordem, is_representante").eq("agendamento_id",ke.id).order("ordem",{ascending:!0});console.debug("[carregarAgendamentoParaEdicao] SELECT direto participantes:",{hasError:!!Kr,error:Kr?.message,code:Kr?.code,count:Array.isArray(ir)?ir.length:null}),Array.isArray(ir)&&ir.length>0&&(qe=ir.map(jr=>({nome:jr.nome,cliente_id:jr.cliente_id,ordem:jr.ordem,is_representante:jr.is_representante})))}catch(ir){console.debug("[carregarAgendamentoParaEdicao] Falha no SELECT direto participantes:",ir?.message||ir)}const ze=[...qe].sort((ir,Kr)=>{const jr=Number(ir?.ordem??0),sa=Number(Kr?.ordem??0);return Number.isFinite(jr)&&Number.isFinite(sa)&&jr!==sa?jr-sa:0}),xt=(()=>{const ir=ze.findIndex(Kr=>!!Kr?.is_representante);if(ir>=0)return ir;if(ce){const Kr=ze.findIndex(jr=>jr?.cliente_id===ce);if(Kr>=0)return Kr}return 0})(),rr=ze.map((ir,Kr)=>({nome:ir.nome,cliente_id:ir.cliente_id,principal:Kr===xt}));m("participantes",rr);try{m("editing_agendamento",!0)}catch{}try{const ir=We?.meta_roles||null;if(ir&&typeof ir=="object"){const Kr=Array.isArray(ir.levantadores)?ir.levantadores:[],jr=Array.isArray(ir.goleiros)?ir.goleiros:[],sa=Array.isArray(ir.fixos)?ir.fixos:Array.from(new Set([...Kr,...jr])),ia=ir.fixoRoles&&typeof ir.fixoRoles=="object"?ir.fixoRoles:{};m("levantadores",Kr),m("goleiros",jr),m("fixos",sa),m("fixoRoles",ia)}else{const Kr=`f7a:fixos:${We.id}`,jr=JSON.parse(localStorage.getItem(Kr)||"null");if(jr&&typeof jr=="object"){const sa=Array.isArray(jr.levantadores)?jr.levantadores:[],ia=Array.isArray(jr.goleiros)?jr.goleiros:[],Kn=Array.isArray(jr.fixos)?jr.fixos:Array.from(new Set([...sa,...ia])),at=jr.fixoRoles&&typeof jr.fixoRoles=="object"?jr.fixoRoles:{};m("levantadores",sa),m("goleiros",ia),m("fixos",Kn),m("fixoRoles",at)}}}catch{}me(We),l("Perfeito! Aqui esto os detalhes do seu agendamento:",600),setTimeout(()=>{const ir={inicio:At,fim:Ye,inicioDate:new Date(We.inicio),fimDate:new Date(We.fim)};lr?(Me(ir,We.modalidade,!0,lr,Je,rr,We),g("review")):(l("No consegui carregar os dados da quadra deste agendamento. Vamos escolher a quadra novamente?",800),setTimeout(()=>{const Kr=E.map(jr=>({label:jr.nome,value:jr.id,icon:"",subtitle:jr.descricao||jr.tipo||null,quadra:jr}));c("Qual quadra voc quer?",Kr,600)},1200))},1400)}catch(We){console.error("[Isis] Erro ao carregar agendamento:",We),We.message.includes("no encontrado")?(l("Ops! Este agendamento no foi encontrado ou pode ter sido cancelado. ",800),l("Vou buscar seus agendamentos atualizados...",1400),setTimeout(()=>{br()},2e3)):(l("Ops! Tive um problema ao carregar o agendamento. ",800),l("Que tal tentar fazer um novo agendamento?",1400),setTimeout(()=>{ge()},2e3))}},an=async()=>{if(!V){console.error("[Isis] Nenhum agendamento para cancelar");return}try{console.groupCollapsed("[Isis][Cancel] start"),console.log("[Isis][Cancel] agendamentoCriado:",{id:V?.id,inicio:V?.inicio,fim:V?.fim,status:V?.status,codigo_empresa:V?.codigo_empresa,empresa_id:V?.empresa_id,cliente_id:V?.cliente_id}),console.log("[Isis][Cancel] empresa:",{id:_?.id,codigo_empresa:_?.codigo_empresa,nome_fantasia:_?.nome_fantasia,razao_social:_?.razao_social,isis_display_name:_?.isis_display_name,isis_cancel_min_hours_before:_?.isis_cancel_min_hours_before,telefone:_?.telefone}),console.groupEnd(),v(!0);let We=_?.isis_cancel_min_hours_before;if(We==null)try{const ce=(()=>{try{return decodeURIComponent(r||"")}catch{return String(r||"")}})(),qe=String(ce).toLowerCase().replace(/[\s\-_]+/g,"").trim();console.log("[Isis][Cancel] minHours missing. Trying RPC fallback with slug:",{slugRaw:ce,slugNorm:qe});try{const{data:ze,error:xt}=await Q.rpc("get_empresa_public_by_isis_subdomain",{p_subdomain:qe});if(console.log("[Isis][Cancel] rpc:get_empresa_public_by_isis_subdomain:",{hasError:!!xt,error:xt?.message,code:xt?.code,len:Array.isArray(ze)?ze.length:null}),!xt&&Array.isArray(ze)&&ze[0]){const rr=ze[0]?.isis_cancel_min_hours_before;rr!=null&&(We=rr)}}catch(ze){console.log("[Isis][Cancel] rpc subdomain threw:",ze?.message||ze)}if(We==null)try{const{data:ze,error:xt}=await Q.rpc("get_empresa_public_by_slug",{p_slug:qe});if(console.log("[Isis][Cancel] rpc:get_empresa_public_by_slug:",{hasError:!!xt,error:xt?.message,code:xt?.code,len:Array.isArray(ze)?ze.length:null}),!xt&&Array.isArray(ze)&&ze[0]){const rr=ze[0]?.isis_cancel_min_hours_before;rr!=null&&(We=rr)}}catch(ze){console.log("[Isis][Cancel] rpc slug threw:",ze?.message||ze)}}catch(ce){console.log("[Isis][Cancel] fallback unexpected error:",ce?.message||ce)}if(console.log("[Isis][Cancel] minHours(raw):",We,"type:",typeof We),We!=null){const ce=new Date(V.inicio),qe=new Date,ze=ce-qe,xt=ze/(1e3*60*60);if(console.log("[Isis][Cancel] timing:",{agendamentoInicio:ce?.toISOString?.()||String(ce),agora:qe?.toISOString?.()||String(qe),diffMs:ze,diffHours:xt}),xt<We){console.warn("[Isis][Cancel] BLOCKED by minHours rule:",{diffHours:xt,minHours:We}),v(!1);const rr=_?.telefone||"a arena",ir=_?.isis_display_name||_?.nome_fantasia||_?.razao_social||"a arena",Kr=[` Ops! S  possvel cancelar com ${We} hora${We>1?"s":""} de antecedncia. Este agendamento est muito prximo.`,` Desculpe! O cancelamento s pode ser feito com ${We} hora${We>1?"s":""} de antecedncia. Seu agendamento j est prximo demais.`],sa=`${Kr[Math.floor(Math.random()*Kr.length)]}

 Para mais informaes ou cancelamento de ltima hora, entre em contato diretamente com a ${ir}: ${rr}`;l(sa,600),setTimeout(()=>{l("O que voc gostaria de fazer agora?",800),setTimeout(()=>{Bt()},1200)},1200);return}}const Ze={status:"canceled",canceled_by:"isis",canceled_at:new Date().toISOString()};console.log("[Isis][Cancel] proceeding to cancel. update payload:",Ze);const{data:Je,error:At}=await Q.from("agendamentos").update(Ze).eq("id",V.id);if(console.log("[Isis][Cancel] supabase update result:",{hasError:!!At,error:At?.message,code:At?.code,data:Je}),At)throw At;v(!1);const Ye=[" Agendamento cancelado com sucesso!"," Pronto! Seu agendamento foi cancelado."," Cancelamento realizado! Agendamento removido."," Feito! O agendamento foi cancelado com sucesso."],lr=Ye[Math.floor(Math.random()*Ye.length)];l(lr,600),me(null),setTimeout(()=>{l("O que voc gostaria de fazer agora?",800),setTimeout(()=>{Bt()},1200)},1200)}catch(ke){console.error("[Isis] Erro ao cancelar agendamento:",ke),v(!1);const We=ov("error");l(We)}},zr=()=>{u();const ke=["Antes de finalizar, que tal me dar uma avaliao? ","Para finalizar, gostaria que avaliasse nosso atendimento! ","Quase pronto! Me ajuda com uma avaliao rpida? ","ltima etapa! Como foi nosso atendimento hoje? ","Para encerrar, que nota voc daria para nosso atendimento? ","Ei, que tal me contar como foi a experincia? ","Curiosa para saber: como voc avalia nosso atendimento? ","Rapidinho aqui: o que achou do nosso servio? ","Me conta a, como foi para voc hoje? ","Sua opinio  super importante! Como foi tudo? ","Sua avaliao nos ajuda a melhorar! Como foi? ","Para continuarmos evoluindo, como voc nos avalia? ","Queremos sempre melhorar! Que nota voc daria? ","Seu feedback  ouro para ns! Como foi o atendimento? ","Ajude-nos a ser ainda melhores! Qual sua avaliao? ","Espero ter te ajudado bem! Como voc me avalia? ","Fiz um bom trabalho hoje? Me conta sua opinio! ","Consegui resolver tudo certinho? Que tal uma avaliao? ","Antes de voc ir, me diz como foi nossa conversa? ","Sua experincia foi boa? Adoraria saber! ","Obrigada pela confiana! Como foi para voc? ","Foi um prazer te atender! Que nota voc daria? ","Agradeo pela pacincia! Como avalia nosso servio? ","Muito obrigada! Me conta como foi tudo? ","Pode ser sincero(a)! Como foi o atendimento? ","Sem papas na lngua: que nota voc daria? ","Honestamente, como voc nos avalia? ","Sua opinio real  importante! Como foi? ","Para finalizar o atendimento, preciso da sua avaliao! ","Processo quase concludo! Falta s sua avaliao! ","ltima etapa do nosso protocolo: sua opinio! ","Para encerrar com chave de ouro: como nos avalia? "],We=ke[Math.floor(Math.random()*ke.length)];l(We,800),setTimeout(()=>{B(!0),g("avaliacao"),setTimeout(()=>{b.current?.scrollIntoView({behavior:"smooth",block:"start"})},300)},1200)},Gr=async ke=>{try{const We=Array.isArray(j)?[...j]:[],Ze=`${ke.rating} estrela${ke.rating>1?"s":""}`,Je=ke.comentario?` ${Ze}
 "${ke.comentario}"`:` ${Ze}`;d(Je),B(!1),v(!0);const At=We.map(xt=>({ts:xt.timestamp instanceof Date?xt.timestamp.toISOString():new Date(xt.timestamp||Date.now()).toISOString(),from:xt.from==="isis"?"assistant":"user",text:String(xt.text??"")}));let Ye=-1;for(let xt=At.length-1;xt>=0;xt--)if(At[xt].from==="assistant"){Ye=xt;break}const lr=Ye>=0?At.slice(0,Ye+1):At;await Ilt({rating:Number(ke.rating),comentario:ke.comentario||null,cliente_codigo:i?.cliente?.codigo??null,cliente_nome:i?.cliente?.nome||i?.cliente?.name||null,empresa_nome:_?.nome_fantasia||_?.razao_social||"Desconhecida",sessionId:w,conversaArray:lr}),v(!1);const ce=new Date().getHours();let qe;ce>=5&&ce<12?qe="Tenha um timo dia! ":ce>=12&&ce<18?qe="Tenha uma tima tarde! ":ce>=18&&ce<22?qe="Tenha uma tima noite! ":qe="Tenha uma boa noite! ";let ze;if(ke.rating>=4){const xt=[` **Muito obrigada pela avaliao!** A **${G}** agradece imensamente! Foi um prazer te atender! ${qe}`,` **Que bom que gostou!** A **${G}** fica muito feliz! Volte sempre! ${qe}`,` **Perfeito!** A **${G}** agradece de corao! Espero ter ajudado! ${qe}`,` **Adorei seu feedback!** A **${G}** est muito grata! Nos vemos em breve! ${qe}`,` **Excelente!** A **${G}** agradece pela confiana! At a prxima! ${qe}`,` **Uau, que nota incrvel!** A **${G}** est nas nuvens! Obrigada! ${qe}`,` **Voc  demais!** A **${G}** adora clientes como voc! ${qe}`,` **Top demais!** A **${G}** se sente campe com seu feedback! ${qe}`,` **Que alegria!** A **${G}** fica radiante com sua avaliao! ${qe}`,` **Sensacional!** A **${G}** est celebrando sua nota! ${qe}`,` **Amei sua avaliao!** Fico feliz em saber que te atendi bem! A **${G}** agradece! ${qe}`,` **Que feedback maravilhoso!** Me deixou super feliz! A **${G}**  grata! ${qe}`,` **Seu carinho me emociona!** A **${G}** tem sorte de ter voc! ${qe}`,` **Voc iluminou meu dia!** A **${G}** agradece de todo corao! ${qe}`,` **Nota mxima!** A **${G}** te espera sempre de braos abertos! ${qe}`,` **Cliente 5 estrelas!** A **${G}** adora te ter aqui! Volte logo! ${qe}`,` **Voc  especial!** A **${G}** sempre ter um lugar especial para voc! ${qe}`,` **Show de avaliao!** A **${G}** te aguarda para a prxima apresentao! ${qe}`];ze=xt[Math.floor(Math.random()*xt.length)]}else if(ke.rating===3){const xt=[` **Obrigada pelo feedback!** A **${G}** vai melhorar ainda mais! ${qe}`,` **Agradecemos sua avaliao!** A **${G}** est trabalhando para evoluir! ${qe}`,` **Obrigada!** A **${G}** valoriza seu retorno! Foi um prazer te atender! ${qe}`,` **Toda avaliao nos faz crescer!** A **${G}** agradece sua sinceridade! ${qe}`,` **Feedback valioso!** A **${G}** usa cada retorno para evoluir! ${qe}`,` **Obrigada pela nota!** A **${G}** est sempre buscando melhorar! ${qe}`,` **Seu retorno  importante!** A **${G}** vai usar para aprimorar nosso servio! ${qe}`,` **Agradecemos a oportunidade!** A **${G}** espera te surpreender na prxima! ${qe}`,` **Obrigada pela dica!** A **${G}** vai trabalhar para te conquistar! ${qe}`,` **Toda crtica construtiva  bem-vinda!** A **${G}** agradece! ${qe}`];ze=xt[Math.floor(Math.random()*xt.length)]}else{const xt=[` **Obrigada pela sinceridade.** A **${G}** vai trabalhar para melhorar! ${qe}`,` **Agradecemos seu feedback.** A **${G}** est comprometida em evoluir! ${qe}`,` **Obrigada por compartilhar.** A **${G}** vai usar seu retorno para melhorar! ${qe}`,` **Lamentamos no ter atendido suas expectativas.** A **${G}** vai se esforar mais! ${qe}`,` **Sentimos muito pela experincia.** A **${G}** levar isso muito a srio! ${qe}`,` **Assumimos a responsabilidade.** A **${G}** vai fazer melhor da prxima vez! ${qe}`,` **Sua insatisfao nos preocupa.** A **${G}** vai revisar todos os processos! ${qe}`,` **Obrigada pelo alerta!** A **${G}** espera uma nova chance de te impressionar! ${qe}`,` **Vamos melhorar!** A **${G}** promete que da prxima vez ser diferente! ${qe}`,` **Seu feedback  nosso combustvel!** A **${G}** vai usar para crescer! ${qe}`,` **J estamos trabalhando nas melhorias!** A **${G}** agradece sua pacincia! ${qe}`,` **Sua honestidade  valiosa!** A **${G}** prefere a verdade para evoluir! ${qe}`,` **Crticas nos fazem crescer!** A **${G}** agradece sua coragem de falar! ${qe}`];ze=xt[Math.floor(Math.random()*xt.length)]}l(ze,600),setTimeout(()=>{l("Atendimento finalizado.",0,"system")},1200)}catch(We){console.error("[Isis] Erro ao enviar avaliao:",We),v(!1);const Ze=new Date().getHours();let Je;Ze>=5&&Ze<12?Je="Tenha um timo dia! ":Ze>=12&&Ze<18?Je="Tenha uma tima tarde! ":Ze>=18&&Ze<22?Je="Tenha uma tima noite! ":Je="Tenha uma boa noite! ";const At=[`Ops! Tive um problema ao salvar sua avaliao, mas a **${G}** agradece muito seu feedback! ${Je}`,` No consegui salvar sua avaliao, mas a **${G}** agradece imensamente! ${Je}`,` Deu uma travadinha aqui, mas sua opinio j ficou guardada no meu corao! A **${G}** agradece! ${Je}`,` Ops, falhei na tecnologia, mas no falhei em te ouvir! A **${G}** valoriza seu feedback! ${Je}`,` Parece que o sistema deu soluo, mas sua avaliao foi ouvida! A **${G}** agradece! ${Je}`,` A internet no colaborou, mas sua opinio chegou at mim! A **${G}**  grata! ${Je}`,` Problema tcnico aqui, mas o importante  que voc compartilhou! A **${G}** agradece! ${Je}`,` O sistema travou, mas sua avaliao no passou despercebida! A **${G}** valoriza! ${Je}`],Ye=At[Math.floor(Math.random()*At.length)];l(Ye,600),setTimeout(()=>{l("Atendimento finalizado.",0,"system")},1200)}},ha=async()=>{if(!V){console.error("[Isis] Nenhum agendamento para atualizar");return}try{v(!0);const ke=i.cliente,We=i.participantes||[],{data:Ze}=await Q.from("clientes").select("id").eq("codigo_empresa",n).eq("is_consumidor_final",!0).single(),Je=We.find(ht=>ht.principal),At=We.filter(ht=>!ht.principal),Ye=Je?[Je,...At]:We,lr=Ye.map(ht=>ht.nome),ce=Je?.cliente_id||ke?.id||null,[qe,ze]=i.horario.inicio.split(":").map(Number),[xt,rr]=i.horario.fim.split(":").map(Number);let ir=xt*60+rr-(qe*60+ze);xt===0&&rr===0&&(ir=24*60-(qe*60+ze));const Kr=i.quadra.valor||0,jr=ir/30,sa=Math.round(Kr*jr*100)/100,ia={levantadores:Array.isArray(i.levantadores)?i.levantadores:[],goleiros:Array.isArray(i.goleiros)?i.goleiros:[],fixos:Array.isArray(i.fixos)?i.fixos:[],fixoRoles:i.fixoRoles&&typeof i.fixoRoles=="object"?i.fixoRoles:{}},{data:Kn,error:at}=await Q.from("agendamentos").update({quadra_id:i.quadra.id,cliente_id:ce,clientes:lr,inicio:i.horario.inicioDate.toISOString(),fim:i.horario.fimDate.toISOString(),modalidade:i.esporte,valor_total:sa,meta_roles:ia}).eq("id",V.id).select().single();if(at)throw at;const{error:Te}=await Q.from("agendamento_participantes").delete().eq("agendamento_id",V.id);if(Te)throw Te;const Fe=Ye.map((ht,Xr)=>({agendamento_id:Kn.id,codigo_empresa:n,cliente_id:ht.cliente_id||(ht.principal?ke.id:Ze?.id||null),nome:ht.nome,valor_cota:0,status_pagamento:"Pendente",ordem:Xr+1,is_representante:Xr===0})),{error:cr}=await Q.from("agendamento_participantes").insert(Fe);if(cr)throw cr;v(!1),me(Kn);try{const ht=`f7a:fixos:${Kn.id}`,Xr={levantadores:i.levantadores||[],goleiros:i.goleiros||[],fixos:i.fixos||[],fixoRoles:i.fixoRoles||{}};localStorage.setItem(ht,JSON.stringify(Xr))}catch{}lt(Kn,!0),g("confirmation")}catch(ke){console.error("[Isis] Erro ao atualizar agendamento:",ke),v(!1);const We=ov("error");l(We)}},pn=async()=>{try{v(!0);const ke=await qt();if(!ke?.ok)throw new Error("No foi possvel validar disponibilidade do horrio");if(ke?.conflito){v(!1),B(!1);try{m("horario",null)}catch{}try{m("esporte",null)}catch{}try{F(null)}catch{}ke?.motivo==="fechada"?l(`**Ops!** Parece que este dia ficou **indisponvel** agora. 

Vamos escolher outra data?`,800):l(`**Ops!** Algum acabou de reservar esse horrio antes de voc. 

Vamos escolher outra data?`,800),setTimeout(()=>{Lt()},900);return}const We=i.cliente,Ze=i.participantes||[],{data:Je}=await Q.from("clientes").select("id").eq("codigo_empresa",n).eq("is_consumidor_final",!0).single(),At=Ze.find(jt=>jt.principal),Ye=Ze.filter(jt=>!jt.principal),lr=At?[At,...Ye]:Ze,ce=lr.map(jt=>jt.nome),qe=At?.cliente_id||We?.id||null,[ze,xt]=i.horario.inicio.split(":").map(Number),[rr,ir]=i.horario.fim.split(":").map(Number);let Kr=rr*60+ir-(ze*60+xt);rr===0&&ir===0&&(Kr=24*60-(ze*60+xt));const jr=i.quadra.valor||0,sa=Kr/30,ia=Math.round(jr*sa*100)/100,Kn={levantadores:Array.isArray(i.levantadores)?i.levantadores:[],goleiros:Array.isArray(i.goleiros)?i.goleiros:[],fixos:Array.isArray(i.fixos)?i.fixos:[],fixoRoles:i.fixoRoles&&typeof i.fixoRoles=="object"?i.fixoRoles:{}};let at=null;try{const jt=String(w||"").trim();/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(jt)&&(at=jt)}catch{}const{data:Te}=await Q.from("agendamentos").select("codigo").eq("codigo_empresa",n).order("codigo",{ascending:!1}).limit(1).single();let Fe=Te?Te.codigo+1:1;console.log("[criarAgendamento] ltimo cdigo usado:",Te?.codigo),console.log("[criarAgendamento] Prximo cdigo inicial:",Fe);let cr,ht=0;const Xr=10;for(;!cr&&ht<Xr;){ht++,console.log("[criarAgendamento] Tentativa",ht,"com cdigo:",Fe);const jt={codigo:Fe,codigo_empresa:n,quadra_id:i.quadra.id,cliente_id:qe,clientes:ce,inicio:i.horario.inicioDate.toISOString(),fim:i.horario.fimDate.toISOString(),modalidade:i.esporte,status:"scheduled",valor_total:ia,meta_roles:Kn,created_by_isis:!0};if(at)try{const{data:Cr}=await Q.from("isis_chat_sessions").select("id").eq("id",at).single();Cr?.id&&(jt.isis_session_id=at)}catch{}const{data:er,error:Nt}=await Q.from("agendamentos").insert(jt).select("id, codigo").single();if(Nt)if(Nt.code==="23505")console.log("[criarAgendamento] Cdigo",Fe,"j existe, tentando prximo..."),Fe++;else throw Nt;else cr=er,console.log("[criarAgendamento] Agendamento criado com cdigo:",cr.codigo)}if(!cr)throw new Error("No foi possvel gerar um cdigo nico aps "+Xr+" tentativas");try{const{data:jt}=await Q.from("empresas").select("id").eq("codigo_empresa",n).single();jt&&(await Q.from("empresa_counters").update({next_agendamento_codigo:cr.codigo+1}).eq("empresa_id",jt.id),console.log("[criarAgendamento] Counter atualizado para:",cr.codigo+1))}catch(jt){console.warn("[criarAgendamento] Erro ao atualizar counter:",jt)}const Ft=lr.map((jt,er)=>({codigo_empresa:n,agendamento_id:cr.id,cliente_id:jt.cliente_id||(jt.principal?We.id:Je?.id||null),nome:jt.nome,valor_cota:0,status_pagamento:"Pendente",ordem:er+1,is_representante:er===0})),{error:kr}=await Q.from("agendamento_participantes").insert(Ft);if(kr)throw kr;v(!1),me(cr);try{const jt=`f7a:fixos:${cr.id}`,er={levantadores:i.levantadores||[],goleiros:i.goleiros||[],fixos:i.fixos||[],fixoRoles:i.fixoRoles||{}};localStorage.setItem(jt,JSON.stringify(er))}catch{}lt(cr),g("confirmation")}catch(ke){console.error("[Isis] Erro ao criar agendamento:",ke),v(!1);const We=ov("error");l(We),D2({title:"Erro ao criar agendamento",description:ke.message||"Tente novamente",variant:"destructive"})}},on=(ke,We)=>{if(u(),We)try{h(We)}catch{}switch(o){case"quadra":Sr(ke);break;case"data":{if((ke?.value||"").toString()==="mudar_quadra"){try{B(!1);const Je=(E||[]).map(At=>({label:At.nome,value:At.id,icon:"",subtitle:At.descricao||At.tipo||null,quadra:At}));Je.length>0&&(c("Qual quadra voc quer?",Je,400),g("quadra"))}catch{}break}wr(ke)}break;case"identificacao":or(ke);break;case"review":or(ke);break;case"confirmation":or(ke);break;case"confirmar_cliente_existente":{const Ze=(ke?.value||"").toString();if(Ze==="confirm_cliente_existente"){const Je=i?.cliente_sugerido||null;if(Je){m("cliente",Je),m("cliente_sugerido",null);const At=ae(Je.nome||"");l(`Perfeito, **${At}**! `,300),B(!1),setTimeout(()=>{try{Bt()}catch{}},700)}else B(!0),g("identificacao")}else Ze==="corrigir_cadastro"&&(l("Sem problemas! Vamos corrigir seus dados. ",300),B(!0),g("cadastro"));break}default:console.warn("[Isis] Nenhum handler para step:",o)}},cn=()=>q?o==="participantes"||o==="review"&&q&&z==="participantes"?a.jsx(Alt,{participantesAtuais:i.participantes||[],onAdicionar:Re,onRemover:Wt,onFinalizar:Er,onAdicionarLote:Ct,selfName:i.cliente?.nome,initialModalidade:i.esporte||"",modalidadeOptions:Array.isArray(i.quadra?.modalidades)&&i.quadra.modalidades.length>0?i.quadra.modalidades:i.esporte?[i.esporte]:[],onFixedRolesDetected:ke=>{try{const We=Array.isArray(ke?.levantadores)?ke.levantadores:[],Ze=Array.isArray(ke?.goleiros)?ke.goleiros:[],Je=lr=>String(lr||"").trim().toLowerCase(),At=Array.from(new Set([...We,...Ze])),Ye={};We.forEach(lr=>{Ye[Je(lr)]="Levantador"}),Ze.forEach(lr=>{Ye[Je(lr)]="Goleiro"}),m("levantadores",We),m("goleiros",Ze),m("fixos",At),m("fixoRoles",Ye),V?.id&&(async()=>{try{const lr={levantadores:We,goleiros:Ze,fixos:At,fixoRoles:Ye};await Q.from("agendamentos").update({meta_roles:lr}).eq("id",V.id)}catch(lr){console.debug("[Isis] Falha ao persistir meta_roles imediatos:",lr?.message||lr)}})()}catch{}}}):o==="identificacao"||T==="data_custom"?a.jsx(Slt,{tipo:T,onSubmit:pt,onTrocarTipo:()=>{k(T==="telefone"?"email":"telefone")}}):o==="cadastro"?a.jsx(Clt,{onSubmit:ft,valorInicial:i.identificacao_valor,tipoInicial:i.identificacao_tipo||"telefone",onCorrigirTelefone:()=>{try{l("Sem problemas! Informe seu telefone novamente:",400)}catch{}m("cliente",null),m("identificacao_valor",null),k("telefone"),g("identificacao"),B(!0)},onCorrigirEmail:()=>{try{l("Sem problemas! Informe seu e-mail novamente:",400)}catch{}m("cliente",null),m("identificacao_valor",null),k("email"),g("identificacao"),B(!0)}}):o==="horario"||o==="review"&&q&&z==="horario"?a.jsx(Nlt,{onSubmit:Vt,onMudarData:Dt,onMudarQuadra:()=>{try{B(!1),F("horario"),g("review");const ke=(E||[]).map(We=>({label:We.nome,value:We.id,icon:"",subtitle:We.descricao||We.tipo||null,quadra:We}));ke.length>0&&c("Qual quadra voc quer?",ke,600)}catch{}},hasMultipleQuadras:(E||[]).length>1,horariosDisponiveis:A,esportes:i.quadra?.modalidades||[]}):o==="avaliacao"?a.jsx(Plt,{onSubmit:Gr}):null:null;return r?O?a.jsx(Elt,{message:"Preparando sua experincia..."}):_?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(Fr.header,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5},className:"bg-surface/70 backdrop-blur-xl border-b border-white/10 sticky top-0 z-20 shadow-lg",children:a.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-3 md:py-4 flex items-center justify-between gap-3 md:gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[a.jsxs("div",{className:"relative group",children:[a.jsx("div",{className:"transition-all duration-300 group-hover:scale-105",children:a.jsx(dl,{size:"md",variant:"header",className:"md:w-20 md:h-20"})}),a.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 md:w-4 md:h-4 bg-success rounded-full border-2 border-surface"})]}),a.jsxs("div",{className:"flex flex-col gap-0.5 md:gap-1",children:[a.jsx("h1",{className:"font-bold text-text-primary text-lg md:text-2xl tracking-tight leading-none",children:"sis"}),a.jsxs("div",{className:"relative group w-fit",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 blur-md opacity-60 group-hover:opacity-100 animate-pulse rounded-md"}),a.jsxs("div",{className:"relative px-2 py-0.5 md:px-2.5 md:py-1 bg-gradient-to-r from-cyan-500/20 via-purple-500/20 to-pink-500/20 backdrop-blur-sm border border-cyan-500/50 rounded-md flex items-center gap-1 md:gap-1.5 shadow-lg",children:[a.jsxs("svg",{className:"w-2.5 h-2.5 md:w-3 md:h-3 text-cyan-400",fill:"currentColor",viewBox:"0 0 20 20",children:[a.jsx("path",{d:"M13 7H7v6h6V7z"}),a.jsx("path",{fillRule:"evenodd",d:"M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z",clipRule:"evenodd"})]}),a.jsx("span",{className:"text-[9px] md:text-[10px] font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"chat"}),a.jsxs("div",{className:"hidden md:flex gap-0.5",children:[a.jsx("span",{className:"w-1 h-1 bg-cyan-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),a.jsx("span",{className:"w-1 h-1 bg-purple-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),a.jsx("span",{className:"w-1 h-1 bg-pink-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]})]})]})]}),a.jsx("div",{className:"flex flex-1 justify-end md:justify-center",children:a.jsxs("div",{className:"group relative",children:[a.jsx("div",{className:"hidden md:block absolute inset-0 bg-gradient-to-r from-brand/20 via-brand/10 to-brand/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),a.jsxs("div",{className:"relative flex items-center gap-2.5 md:gap-3 px-4 py-2 md:px-5 md:py-2.5 bg-gradient-to-r from-surface via-surface-2 to-surface backdrop-blur-sm rounded-lg md:rounded-xl border border-brand/20 shadow-md md:shadow-lg",children:[a.jsxs("div",{className:"relative w-9 h-9 md:w-10 md:h-10 shrink-0 overflow-hidden rounded-lg border border-white/10 bg-surface-2/60 grid place-items-center shadow-[0_0_0_3px_RGBA(0,0,0,0.2)] group-hover:border-white/20 transition-colors duration-300",children:[te?a.jsx("img",{src:te,alt:"Logo da empresa",className:"w-full h-full object-cover",onError:ke=>{ke.target.style.display="none",ke.target.nextSibling.style.display="block"}}):null,a.jsx(bN,{className:`w-5 h-5 md:w-6 md:h-6 opacity-80 ${te?"hidden":"block"}`,strokeWidth:2})]}),a.jsx("h2",{className:"text-sm md:text-base font-bold text-text-primary tracking-wide truncate max-w-[140px] md:max-w-none",children:G})]})]})}),a.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-brand rounded-xl flex items-center justify-center flex-shrink-0",children:a.jsx(jd,{className:"w-7 h-7 text-primary-foreground"})}),a.jsxs("div",{className:"hidden lg:flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})]})}),a.jsx("div",{className:"container mx-auto max-w-5xl pb-6 md:pb-6 mb-12 md:mb-0",children:a.jsx(_lt,{onButtonClick:on,hideButtonTexts:o==="avaliacao",children:cn()})}),a.jsx(Fr.footer,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.3},className:"md:hidden fixed bottom-0 left-0 right-0 bg-surface/90 backdrop-blur-xl border-t border-white/10 z-20 shadow-lg",children:a.jsx("div",{className:"flex items-center justify-center py-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-6 h-6 bg-brand rounded-lg flex items-center justify-center",children:a.jsx(jd,{className:"w-4 h-4 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-sm",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-sm",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-sm",style:{color:"#B0B0B0"},children:" Arena"})]})]})})})]}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-2xl",children:[a.jsx(Fr.div,{className:"mb-8 flex justify-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},children:a.jsxs("div",{className:"relative",children:[a.jsx(dl,{size:"xl",variant:"header"}),a.jsx(Fr.div,{className:"absolute inset-0 rounded-full border-4 border-brand/30",animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0}})]})}),a.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"space-y-6",children:[a.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-text-primary mb-4",children:[oe(),"! Tentando Agendar? "]}),a.jsxs("div",{className:"bg-surface/70 backdrop-blur-sm border border-white/10 rounded-2xl p-8 shadow-xl",children:[a.jsxs("p",{className:"text-xl text-text-primary mb-6 leading-relaxed",children:["Entre em contato com o dono da quadra e solicite o ",a.jsx("strong",{children:"link de agendamento"}),"."]}),a.jsxs("div",{className:"bg-surface-2/50 border border-white/5 rounded-xl p-6 mb-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-text-primary mb-3 flex items-center gap-2",children:[a.jsx(yG,{className:"w-5 h-5 text-brand"}),"Formato do Link"]}),a.jsxs("div",{className:"bg-background/60 border border-white/10 rounded-lg p-4 font-mono text-base md:text-lg",children:[a.jsx("span",{className:"text-brand font-bold",children:"nomedaempresa"}),a.jsx("span",{className:"text-text-muted",children:".f7arena.com"})]}),a.jsx("p",{className:"mt-2 text-xs text-text-muted",children:"(sem traos)"})]})]})]}),a.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},className:"mt-12 flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(jd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})})]})}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-2xl",children:[a.jsx(Fr.div,{className:"mb-8 flex justify-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},children:a.jsxs("div",{className:"relative",children:[a.jsx(dl,{size:"xl",variant:"header"}),a.jsx(Fr.div,{className:"absolute inset-0 rounded-full border-4 border-brand/30",animate:{scale:[1,1.2,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0}})]})}),a.jsxs(Fr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"space-y-6",children:[a.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-text-primary mb-4",children:[oe(),"! Tentando Agendar?"]}),a.jsx("div",{className:"bg-surface/70 backdrop-blur-sm border border-white/10 rounded-2xl p-8 shadow-xl",children:a.jsx("p",{className:"text-xl text-text-primary mb-4 leading-relaxed",children:"Entre em contato com o dono da quadra e solicite o link de agendamento."})})]}),a.jsx(Fr.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},className:"mt-12 flex items-center justify-center",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-brand rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(jd,{className:"w-6 h-6 text-primary-foreground"})}),a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{className:"font-extrabold text-2xl",style:{color:"#FFAA33"},children:"7"}),a.jsx("span",{className:"font-medium text-2xl",style:{color:"#B0B0B0"},children:" Arena"})]})]})})]})})};function LV(){return a.jsx(Loe,{children:a.jsx(ZY,{children:a.jsx(Tlt,{children:a.jsx(Olt,{})})})})}function Tlt({children:e}){const{selections:t}=p5(),[r,n]=Ce.useState({name:"",phone:"",source:"init"});return Ce.useEffect(()=>{const s=()=>{try{const c=t?.empresa||null;if(c){const d=c.isis_display_name||c.nome_fantasia||c.razao_social||c.nome||"",u=c.telefone||"";if(d||u)return{name:d,phone:u}}}catch{}return null},o=()=>{try{const c=window.location.host||"",d=window.location.pathname||"",u="f7arena.com";if(c.endsWith(u)){const h=c.slice(0,-u.length).replace(/\.$/,"").toLowerCase();if(h&&h!=="www")return h}const f=d.match(/\/agendar\/([^\/?#]+)/i);if(f&&f[1])return decodeURIComponent(f[1])}catch{}return null},i=s();if(i){try{console.info("[IsisError][Meta] Using context data",{name:!!i.name,phone:!!i.phone})}catch{}n({name:i.name,phone:i.phone,source:"context"});return}const l=o();if(!l){try{console.warn("[IsisError][Meta] No slug inferred from URL")}catch{}n(c=>c.name||c.phone?c:{name:"",phone:"",source:"none"});return}(async()=>{try{try{console.info("[IsisError][Meta] Start fetch by slug",{slug:l})}catch{}const c=String(l||"").toLowerCase().replace(/[\s\-_]+/g,"").trim();let d="",u="",f="";try{const{data:g,error:v}=await Q.rpc("get_empresa_public_by_slug",{p_slug:c});if(!v&&Array.isArray(g)&&g.length>0){const y=g[0]||{};d=y.isis_display_name||y.nome_fantasia||y.razao_social||y.nome||"",y.telefone&&(u=y.telefone,f="rpc.telefone");try{console.info("[IsisError][Meta] RPC result",{hasName:!!d,phoneSource:f,hasPhone:!!u})}catch{}}}catch{}if(!d||!u)try{const{data:g}=await Q.from("agenda_settings").select("isis_display_name, empresas(nome_fantasia, razao_social, nome, telefone)").eq("isis_subdomain",c).single(),v=g?.empresas||{};d=d||g?.isis_display_name||v?.nome_fantasia||v?.razao_social||v?.nome||"",!u&&v?.telefone&&(u=v.telefone,f="settings.telefone");try{console.info("[IsisError][Meta] Settings result",{hasName:!!d,phoneSource:f,hasPhone:!!u})}catch{}}catch{}const m=d||(g=>{try{return String(g||"").replace(/[\s_\-]+/g," ").trim().split(" ").filter(Boolean).map(y=>y.charAt(0).toUpperCase()+y.slice(1).toLowerCase()).join(" ")}catch{return g}})(l),x=u||"";try{console.info("[IsisError][Meta] Final",{finalName:m,hasPhone:!!x,phoneSource:f||"none"})}catch{}n({name:m,phone:x,source:f||"computed"})}catch(c){try{console.error("[IsisError][Meta] Exception during meta fetch",c)}catch{}n({name:l,phone:"",source:"error"})}})()},[t?.empresa]),a.jsx(Loe,{companyName:r.name,companyPhone:r.phone,children:e})}class Loe extends Ce.Component{constructor(t){super(t),this.state={hasError:!1,companyName:"",companyPhone:"",showDetails:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,r){try{console.error("[Isis] Uncaught error:",t,r)}catch{}try{this.setState({error:t,errorInfo:r})}catch{}(!this.props.companyName||!this.props.companyPhone)&&(async()=>{try{const n=()=>{try{const d=typeof window<"u"&&window.location.host||"",u=typeof window<"u"&&window.location.pathname||"",f="f7arena.com";if(d&&d.endsWith(f)){const m=d.slice(0,-f.length).replace(/\.$/,"").toLowerCase();if(m&&m!=="www")return m}const h=u.match(/\/agendar\/([^\/?#]+)/i);if(h&&h[1])return decodeURIComponent(h[1])}catch{}return null},s=d=>{try{return String(d||"").replace(/[\s_\-]+/g," ").trim().split(" ").filter(Boolean).map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" ")}catch{return d}},o=n();if(!o)return;const i=String(o).toLowerCase().replace(/[\s\-_]+/g,"").trim();let l="",c="";try{const{data:d,error:u}=await Q.rpc("get_empresa_public_by_slug",{p_slug:i});if(!u&&Array.isArray(d)&&d.length>0){const f=d[0]||{};l=f.isis_display_name||f.nome_fantasia||f.razao_social||f.nome||"",f.telefone&&(c=f.telefone);try{console.info("[IsisError][Outer] RPC",{hasName:!!l,hasPhone:!!c})}catch{}}}catch{}if(!l||!c)try{const{data:d}=await Q.from("agenda_settings").select("isis_display_name, empresas(nome_fantasia, razao_social, nome, telefone)").eq("isis_subdomain",i).single(),u=d?.empresas||{};l=l||d?.isis_display_name||u?.nome_fantasia||u?.razao_social||u?.nome||"",!c&&u?.telefone&&(c=u.telefone);try{console.info("[IsisError][Outer] Settings",{hasName:!!l,hasPhone:!!c})}catch{}}catch{}this.setState({companyName:l||s(o),companyPhone:c||""})}catch(n){try{console.error("[IsisError][Outer] meta fetch failed",n)}catch{}}})()}render(){if(this.state.hasError){try{console.info("[IsisError][Render] Props",{companyName:this.props.companyName,companyPhone:this.props.companyPhone})}catch{}const t=()=>{try{const u=typeof window<"u"&&window.location.host||"",f=typeof window<"u"&&window.location.pathname||"",h="f7arena.com";if(u&&u.endsWith(h)){const x=u.slice(0,-h.length).replace(/\.$/,"").toLowerCase();if(x&&x!=="www")return x}const m=f.match(/\/agendar\/([^\/?#]+)/i);if(m&&m[1])return decodeURIComponent(m[1])}catch{}return null},r=u=>{try{const f=String(u||"").replace(/\D/g,"");return f.length>=11?`(${f.slice(0,2)}) ${f.slice(2,7)}-${f.slice(7,11)}`:f.length>=10?`(${f.slice(0,2)}) ${f.slice(2,6)}-${f.slice(6,10)}`:u||""}catch{return u||""}},n=t(),s=this.props.companyName||this.state.companyName||n||"a arena",o=r(this.props.companyPhone||this.state.companyPhone||""),i=(()=>{try{const u=this.state.error;return u?u.message||String(u):""}catch{return""}})(),l=(()=>{try{const u=this.state.error;return u?.stack?String(u.stack):""}catch{return""}})(),c=(()=>{try{const u=this.state.errorInfo?.componentStack;return u?String(u):""}catch{return""}})(),d=(()=>{try{const u=navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection,f=u?{effectiveType:u.effectiveType,downlink:u.downlink,rtt:u.rtt,saveData:u.saveData,type:u.type}:null;return{href:typeof window<"u"?window.location.href:"",onLine:navigator?.onLine,userAgent:navigator?.userAgent,connection:f}}catch{return null}})();return a.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background text-text-primary p-6",children:a.jsxs("div",{className:"w-full max-w-xl mx-auto rounded-3xl border border-white/10 bg-surface/80 backdrop-blur-md shadow-2xl p-8 text-center",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx(dl,{size:"xl"})}),a.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight mb-3",children:" Ops, ocorreu um erro!"}),a.jsxs("p",{className:"text-base md:text-lg opacity-90 leading-relaxed mb-3",children:["Pode ser um ",a.jsx("span",{className:"font-semibold",children:"problema no seu dispositivo"})," ou na sua ",a.jsx("span",{className:"font-semibold",children:"conexo de rede"}),"."]}),a.jsxs("p",{className:"text-base md:text-lg opacity-90 leading-relaxed mb-6",children:[a.jsx("span",{className:"font-semibold",children:"Tente novamente"}),", experimente ",a.jsx("span",{className:"font-semibold",children:"outro navegador"})," ou ",a.jsx("span",{className:"font-semibold",children:"outra rede"}),"."]}),a.jsxs("p",{className:"text-base md:text-lg leading-relaxed mb-6",children:["Se persistir, ",a.jsx("span",{className:"font-semibold",children:"entre em contato"})," com ",a.jsx("span",{className:"font-semibold",children:s}),o?a.jsxs(a.Fragment,{children:[" ","pelo nmero ",a.jsx("span",{className:"font-semibold font-mono",children:o}),"."]}):"."]}),a.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a.jsx("button",{onClick:()=>{try{window.location.reload()}catch{}},className:"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-brand text-bg font-semibold shadow-lg shadow-brand/20 hover:shadow-xl hover:shadow-brand/30 transition-all",children:" Recarregar pgina"}),a.jsx("button",{onClick:()=>{try{this.setState(u=>({...u,showDetails:!u.showDetails}))}catch{}},className:"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-surface-2/70 border border-white/10 text-text-primary font-semibold shadow-lg hover:shadow-xl transition-all",children:this.state.showDetails?"Ocultar erro":"Ver erro"})]}),this.state.showDetails?a.jsx("div",{className:"mt-6 text-left",children:a.jsxs("div",{className:"rounded-2xl border border-white/10 bg-background/40 p-4",children:[a.jsx("div",{className:"text-sm font-semibold mb-2",children:"Detalhes do erro"}),a.jsx("pre",{className:"text-xs whitespace-pre-wrap break-words opacity-90",children:JSON.stringify({message:i,stack:l,componentStack:c,context:d},null,2)})]})}):null]})})}return this.props.children}}const $oe=!1,Dlt="",Mlt="Estamos em manuteno no momento. Voltaremos em breve.",$V="f740028922";function BV(e){try{return dr(e,"EEE, d 'de' MMM 's' HH:mm",{locale:$a})}catch{return""}}function qV(){const e=_i(),t=Il(),r=!!$oe||typeof window<"u"&&localStorage.getItem("maintenance:active")==="true",[n,s]=p.useState(""),[o,i]=p.useState("");p.useEffect(()=>{try{s(localStorage.getItem("maintenance:end")||""),i(localStorage.getItem("maintenance:message")||"");const f=h=>{h.key==="maintenance:end"&&s(h.newValue||""),h.key==="maintenance:message"&&i(h.newValue||"")};return window.addEventListener("storage",f),()=>window.removeEventListener("storage",f)}catch{}},[]);const l=n||Dlt||{}.VITE_MAINTENANCE_END||"",c=o&&o.trim()?o:Mlt,d=p.useMemo(()=>{if(!l)return null;const f=new Date(l);return isNaN(f.getTime())?null:f},[l]),u=p.useMemo(()=>c?.trim()?c:d?`Estamos em manuteno e voltaremos at ${BV(d)}.`:"Estamos em manuteno no momento. Voltaremos em breve.",[c,d]);return p.useEffect(()=>{try{window.f7MaintenanceBypass=f=>{const h=String(f||"")===$V;if(h){try{localStorage.setItem("maintenance:bypass","1")}catch{}try{sessionStorage.setItem("maintenance:bypass","1")}catch{}try{document.cookie="fx_maint_bypass=1; path=/; max-age=2592000"}catch{}try{sessionStorage.removeItem("auth:returnUrl")}catch{}t("/login",{replace:!0})}else console.warn("[Maintenance] Senha invlida.");return h},window.f7MaintenanceReset=()=>{try{localStorage.removeItem("maintenance:bypass")}catch{}console.info("[Maintenance] Bypass removido.")}}catch{}},[t]),p.useEffect(()=>{const h=String(e.pathname||"").split("/").filter(Boolean),m=h[h.length-1]||"",x=new URLSearchParams(e.search||""),v=x.get("senha")||x.get("pwd")||x.get("code")||""||m;if(v&&v===$V){try{localStorage.setItem("maintenance:bypass","1")}catch{}try{sessionStorage.setItem("maintenance:bypass","1")}catch{}try{document.cookie="fx_maint_bypass=1; path=/; max-age=2592000"}catch{}try{sessionStorage.removeItem("auth:returnUrl")}catch{}t("/login",{replace:!0})}},[e,t]),a.jsxs("div",{className:"min-h-screen relative overflow-hidden bg-gradient-to-b from-[#0f1324] via-[#0b0f1c] to-[#070a14] text-white",children:[a.jsx("div",{className:"pointer-events-none absolute -top-40 left-1/2 -translate-x-1/2 w-[90rem] h-[90rem] rounded-full opacity-30 blur-3xl",style:{background:"radial-gradient(50% 50% at 50% 50%, rgba(76,110,245,0.45) 0%, rgba(76,110,245,0.18) 40%, rgba(0,0,0,0) 70%)"}}),a.jsxs("div",{className:"relative z-10 mx-auto max-w-4xl px-6 py-16 md:py-24",children:[a.jsxs("div",{className:"mx-auto max-w-3xl rounded-3xl border border-white/10 bg-white/[0.02] backdrop-blur-xl shadow-[0_0_60px_-10px_rgba(76,110,245,0.5)] p-6 md:p-10",children:[a.jsx("div",{className:"text-center mb-8",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"w-16 h-16 bg-brand rounded-xl flex items-center justify-center mr-4",children:a.jsx(jd,{className:"w-8 h-8 text-primary-foreground"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-5xl font-extrabold",children:[a.jsx("span",{style:{color:"#FF6600"},children:"Fluxo"}),a.jsx("span",{style:{color:"#FFAA33"},children:"7"})]}),a.jsx("p",{className:"text-2xl font-semibold",style:{color:"#B0B0B0"},children:"Arena"})]})]})}),a.jsxs("div",{className:"flex items-center justify-center gap-3 text-red-400 mb-4",children:[a.jsx(X4,{className:"w-6 h-6"}),a.jsx("span",{className:"font-semibold tracking-wide",children:"Modo de Manuteno"})]}),a.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-8",children:[a.jsx("div",{className:"shrink-0",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute -inset-4 bg-brand/20 blur-2xl rounded-full"}),a.jsx("div",{className:"relative rounded-2xl p-1 bg-gradient-to-b from-brand/40 to-transparent",children:a.jsx(dl,{size:"xl",variant:"header"})})]})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h1",{className:"text-2xl md:text-3xl font-bold leading-tight",children:"Oi! Eu sou a Isis "}),a.jsx("p",{className:"text-white/80 mt-3 text-base md:text-lg leading-relaxed",children:u}),a.jsxs("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-white/80",children:[d&&a.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2",children:[a.jsx(pu,{className:"w-4 h-4 text-brand"}),a.jsxs("span",{children:["Previso de retorno: ",a.jsx("strong",{className:"text-white/90",children:BV(d)})]})]}),a.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2",children:[a.jsx(Io,{className:"w-4 h-4 text-brand"}),a.jsx("span",{children:"Vamos cuidar de tudo para voc jogar melhor "})]})]})]})]})]}),a.jsx("p",{className:"mt-6 text-center text-white/50 text-sm",children:r?"Modo de manuteno ativo":"Modo de manuteno inativo"})]})]})}const Boe="v2.5.0",qoe=["Correes e melhorias gerais"];function zoe({open:e,onOpenChange:t,title:r,versionLabel:n,items:s,footer:o}){const i=n||Boe,l=s||qoe;return a.jsx(Un,{open:e,onOpenChange:t,children:a.jsxs(zn,{className:"max-w-xl",overlayClassName:"bg-black/50 backdrop-blur-md",children:[a.jsx(Bn,{children:a.jsx(Ln,{children:r||a.jsxs("span",{className:"inline-flex flex-wrap items-center gap-2",children:[a.jsx("span",{children:"Novidades da verso"}),a.jsx("span",{className:"inline-flex items-center rounded-full border border-brand/30 bg-brand/10 px-3 py-1 text-base font-semibold leading-none text-brand",children:i})]})})}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"rounded-lg border border-border bg-background p-4",children:a.jsx("ul",{className:"list-disc pl-5 space-y-2 text-sm text-text-secondary",children:(l||[]).map((c,d)=>a.jsx("li",{className:"text-text-secondary",children:a.jsx("span",{className:"text-text-primary",children:c})},d))})}),o]})]})})}function Rlt(){const e=_i(),t=p.useMemo(()=>new URLSearchParams(e.search||""),[e.search]),[r,n]=p.useState(!1),[s,o]=p.useState(null),i=t.get("key")||"",l=String({}.VITE_RELEASE_PREVIEW_KEY||""),c=(()=>{try{return l?i===l:!1}catch{return!1}})();p.useEffect(()=>{c&&t.get("open")==="1"&&n(!0)},[c,t]),p.useEffect(()=>{if(!c)return;let f=!1;return(async()=>{try{const m=await fetch("/release-notes.json",{cache:"no-store"});if(!m.ok)return;const x=await m.json();if(f)return;o(x)}catch{}})(),()=>{f=!0}},[c]);const d=s?.versionLabel||s?.version||Boe,u=Array.isArray(s?.items)?s.items:qoe;return c?a.jsxs("div",{className:"p-8",children:[a.jsxs("div",{className:"max-w-2xl space-y-4",children:[a.jsxs("div",{className:"rounded-xl border border-border bg-surface p-6",children:[a.jsx("div",{className:"text-xl font-semibold",children:"Preview - Modal de Novidades"}),a.jsxs("div",{className:"mt-1 text-sm text-text-secondary",children:["Verso atual: ",d]}),a.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[a.jsx("button",{type:"button",onClick:()=>n(!0),className:"inline-flex items-center justify-center rounded-md bg-brand px-4 py-2 text-black font-medium hover:opacity-90",children:"Abrir modal"}),a.jsx("button",{type:"button",onClick:()=>n(!1),className:"inline-flex items-center justify-center rounded-md border border-border bg-background px-4 py-2 text-text-primary hover:bg-surface-2",children:"Fechar modal"})]})]}),a.jsxs("div",{className:"rounded-xl border border-border bg-surface p-6",children:[a.jsx("div",{className:"text-sm font-semibold",children:"Itens atuais"}),a.jsx("ul",{className:"mt-3 list-disc pl-5 space-y-1 text-sm text-text-secondary",children:(u||[]).map((f,h)=>a.jsx("li",{children:f},h))})]})]}),a.jsx(zoe,{open:r,onOpenChange:n,versionLabel:d,items:u})]}):a.jsx("div",{className:"p-8",children:a.jsxs("div",{className:"rounded-lg border border-border bg-surface p-6",children:[a.jsx("div",{className:"text-lg font-semibold",children:"Acesso negado"}),a.jsx("div",{className:"mt-2 text-sm text-text-secondary",children:"Essa rota  apenas para pr-visualizao."})]})})}const zV="release_notes";function Flt(){const{user:e,authReady:t}=lo(),[r,n]=p.useState(!1),[s,o]=p.useState(null),[i,l]=p.useState(!1),c=p.useRef(!1),d=p.useRef(null),u=!!(t&&e?.id),f=s?.releaseId||null,h=s?.versionLabel||s?.version||null,m=Array.isArray(s?.items)?s.items:null,x=p.useMemo(()=>{try{return Date.now()}catch{return 0}},[]);p.useEffect(()=>{if(!u||c.current)return;let y=!1;return(async()=>{c.current=!0,l(!0);try{try{console.log("[ReleaseNotesGate] Checando release notes...",{userId:e.id})}catch{}const w=`/release-notes.json?v=${x}`,j=(()=>{try{return new URL(w,window.location.origin).toString()}catch{return w}})();try{console.log("[ReleaseNotesGate] Fetch URL:",j)}catch{}const _=typeof AbortController<"u"?new AbortController:null,C=setTimeout(()=>{try{_?.abort()}catch{}},8e3);let E;try{E=await fetch(j,{cache:"no-store",signal:_?.signal})}catch(T){console.warn("[ReleaseNotesGate] Falha no fetch release-notes.json:",T);return}finally{try{clearTimeout(C)}catch{}}if(!E.ok){try{console.warn("[ReleaseNotesGate] release-notes.json no encontrado/erro:",{status:E.status,url:w})}catch{}return}let S=null;try{S=await E.json()}catch(T){console.warn("[ReleaseNotesGate] Falha ao parsear release-notes.json:",T);return}if(y)return;try{console.log("[ReleaseNotesGate] release-notes.json carregado:",S)}catch{}const A=String(S?.releaseId||"").trim();if(!A||d.current===A)return;const{data:M,error:O}=await Q.from("user_ui_settings").select("settings").eq("user_id",e.id).eq("scope",zV).maybeSingle();if(O){console.warn("[ReleaseNotesGate] Falha ao ler user_ui_settings:",O);return}const I=String(M?.settings?.last_seen_release_id||"").trim();try{console.log("[ReleaseNotesGate] Comparao release:",{rid:A,lastSeen:I})}catch{}if(I===A)return;o(S),d.current=A;try{console.log("[ReleaseNotesGate] Abrindo modal de release notes...",{rid:A})}catch{}setTimeout(()=>{try{y||n(!0)}catch{}},0)}catch(w){console.warn("[ReleaseNotesGate] Erro ao checar release notes:",w)}finally{c.current=!1,y||l(!1)}})(),()=>{y=!0}},[u,e?.id,x]);const g=async y=>{try{if(!e?.id||!y)return;const b={last_seen_release_id:String(y),seen_at:new Date().toISOString()},{error:w}=await Q.from("user_ui_settings").upsert({user_id:e.id,scope:zV,settings:b,updated_at:new Date().toISOString()},{onConflict:"user_id,scope"});w&&console.warn("[ReleaseNotesGate] Falha ao salvar release seen:",w)}catch(b){console.warn("[ReleaseNotesGate] Erro ao salvar release seen:",b)}},v=y=>{r&&!y&&g(f),n(y)};return u?a.jsx(zoe,{open:r,onOpenChange:v,versionLabel:h,items:m,footer:a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"button",onClick:()=>v(!1),className:"inline-flex items-center justify-center rounded-md bg-brand px-4 py-2 text-black font-medium hover:opacity-90",children:"Entendi"})})}):null}function Llt(){const[e,t]=p.useState(!0),[r,n]=p.useState(!1),s=()=>{t(d=>!d)},o=_i(),i=Il(),l=o.pathname==="/agenda",c=o.pathname==="/isis/analytics";return p.useEffect(()=>{const d=u=>{const f=String(u.target?.tagName||"").toLowerCase();if(!(["input","textarea","select"].includes(f)||u.target?.isContentEditable)&&!u.repeat){if(String(u.key).toLowerCase()==="b"){u.preventDefault();const h=String(o?.pathname||"").toLowerCase();console.log("[Global Hotkey B] Current path:",h),h.includes("balcao")?(console.log("[Global Hotkey B] Navigating to /vendas"),i("/vendas")):(console.log("[Global Hotkey B] Navigating to /balcao"),i("/balcao"));return}if(String(u.key).toLowerCase()==="h"){u.preventDefault(),i("/historico");return}}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[o,i]),p.useEffect(()=>{try{typeof window<"u"&&window.innerWidth<768&&c&&t(!1)}catch{}},[c]),a.jsx(Bje,{children:a.jsx(Tje,{children:a.jsx(qje,{children:a.jsxs("div",{className:"relative flex h-screen bg-background text-text-primary",children:[a.jsx(Flt,{}),a.jsxs(Y0,{children:[a.jsx("title",{children:"F7 Arena"}),a.jsx("meta",{name:"description",content:"Software para gesto de quadras esportivas."})]}),a.jsx(Rge,{isVisible:e,setIsVisible:t,sidebarPinned:r}),e&&a.jsx("button",{type:"button",onClick:()=>t(!1),className:"md:hidden fixed inset-0 z-30 bg-black/40","aria-label":"Fechar menu lateral"}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsx(Dje,{onToggleSidebar:s,sidebarVisible:e,sidebarPinned:r}),a.jsx("main",{className:Pr("flex-1 overflow-x-hidden overflow-y-auto bg-background",l?"p-0 md:p-8":"p-8"),children:a.jsxs(S2,{children:[a.jsx(Js,{path:"/",element:a.jsx(PUe,{})}),a.jsx(Js,{path:"/agenda",element:a.jsx(OZe,{sidebarVisible:e})}),a.jsx(Js,{path:"/isis",element:a.jsx(ZY,{children:a.jsx(clt,{})})}),a.jsx(Js,{path:"/isis/analytics",element:a.jsx(dlt,{})}),a.jsx(Js,{path:"/vendas",element:a.jsx(yst,{})}),a.jsx(Js,{path:"/balcao",element:a.jsx(bst,{})}),a.jsx(Js,{path:"/produtos",element:a.jsx(Hst,{})}),a.jsx(Js,{path:"/compras",element:a.jsx(hoe,{})}),a.jsx(Js,{path:"/clientes",element:a.jsx(Zst,{})}),a.jsx(Js,{path:"/equipe",element:a.jsx(aot,{})}),a.jsx(Js,{path:"/financeiro",element:a.jsx(Vot,{})}),a.jsx(Js,{path:"/caixa",element:a.jsx(uG,{to:"/financeiro?tab=caixa",replace:!0})}),a.jsx(Js,{path:"/quadras",element:a.jsx(Got,{})}),a.jsx(Js,{path:"/empresas",element:a.jsx(tit,{})}),a.jsx(Js,{path:"/finalizadoras",element:a.jsx(nit,{})}),a.jsx(Js,{path:"/configuracao-fiscal",element:a.jsx(Jit,{})}),a.jsx(Js,{path:"/fiscal",element:a.jsx(ilt,{})}),a.jsx(Js,{path:"/test-page",element:a.jsx(ait,{})}),a.jsx(Js,{path:"/historico",element:a.jsx(hlt,{})}),a.jsx(Js,{path:"/suporte",element:a.jsx(oot,{})}),a.jsx(Js,{path:"/__release-notes-preview",element:a.jsx(Rlt,{})})]})})]})]})})})})}function $lt(){_i();const[e,t]=p.useState(!1),[r,n]=p.useState(!1),s=String({}.VITE_MAINTENANCE_MODE||"").toLowerCase()==="true",o=Ce.useMemo(()=>{try{if(typeof window>"u")return null;const c=window.location.host||"",d="f7arena.com";if(!c.endsWith(d))return null;const u=c.slice(0,-d.length).replace(/\.$/,"").toLowerCase();return!u||u==="www"?null:u}catch{return null}},[]);p.useEffect(()=>{try{const c=()=>{const u=localStorage.getItem("maintenance:active")==="true",f=localStorage.getItem("maintenance:end");return u&&f&&new Date>new Date(f)?(localStorage.removeItem("maintenance:active"),!1):u};t(localStorage.getItem("maintenance:bypass")==="1"),n(c());const d=u=>{if(!u||!u.key){n(c()),t(localStorage.getItem("maintenance:bypass")==="1");return}u.key==="maintenance:bypass"&&t(u.newValue==="1"),(u.key==="maintenance:active"||u.key==="maintenance:end")&&n(c())};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)}catch{}},[]);const i=!!$oe||s||r,l=(()=>{try{const c=localStorage.getItem("maintenance:bypass")==="1",d=(()=>{try{return sessionStorage.getItem("maintenance:bypass")==="1"}catch{return!1}})(),u=(()=>{try{return document.cookie.split(";").some(f=>f.trim()==="fx_maint_bypass=1")}catch{return!1}})();return c||d||u}catch{return!1}})();return i&&!l?a.jsxs(S2,{children:[a.jsx(Js,{path:"/maintenance",element:a.jsx(qV,{})}),a.jsx(Js,{path:"*",element:a.jsx(uG,{to:"/maintenance",replace:!0})})]}):o?a.jsx(S2,{children:a.jsx(Js,{path:"/*",element:a.jsx(LV,{})})}):a.jsxs(S2,{children:[a.jsx(Js,{path:"/reset-password",element:a.jsx(iit,{})}),a.jsx(Js,{path:"/40028922",element:a.jsx(blt,{})}),a.jsx(Js,{path:"/agendar/:nomeFantasia",element:a.jsx(LV,{})}),a.jsx(Js,{path:"/maintenance",element:a.jsx(qV,{})}),a.jsx(Js,{path:"/backenddeploy",element:a.jsx(sit,{})}),a.jsx(Js,{path:"/print-comanda",element:a.jsx(y8,{children:a.jsx(plt,{})})}),a.jsx(Js,{path:"/*",element:a.jsx(y8,{children:a.jsx(Llt,{})})})]})}var CF="ToastProvider",[AF,Blt,qlt]=cA("Toast"),[Uoe,kct]=Nu("Toast",[qlt]),[zlt,HA]=Uoe(CF),Voe=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=e,[l,c]=p.useState(null),[d,u]=p.useState(0),f=p.useRef(!1),h=p.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${CF}\`. Expected non-empty \`string\`.`),a.jsx(AF.Provider,{scope:t,children:a.jsx(zlt,{scope:t,label:r,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:d,viewport:l,onViewportChange:c,onToastAdd:p.useCallback(()=>u(m=>m+1),[]),onToastRemove:p.useCallback(()=>u(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:f,isClosePausedRef:h,children:i})})};Voe.displayName=CF;var Woe="ToastViewport",Ult=["F8"],W3="toast.viewportPause",H3="toast.viewportResume",Hoe=p.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Ult,label:s="Notifications ({hotkey})",...o}=e,i=HA(Woe,r),l=Blt(r),c=p.useRef(null),d=p.useRef(null),u=p.useRef(null),f=p.useRef(null),h=$s(t,f,i.onViewportChange),m=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),x=i.toastCount>0;p.useEffect(()=>{const v=y=>{n.length!==0&&n.every(w=>y[w]||y.code===w)&&f.current?.focus()};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[n]),p.useEffect(()=>{const v=c.current,y=f.current;if(x&&v&&y){const b=()=>{if(!i.isClosePausedRef.current){const C=new CustomEvent(W3);y.dispatchEvent(C),i.isClosePausedRef.current=!0}},w=()=>{if(i.isClosePausedRef.current){const C=new CustomEvent(H3);y.dispatchEvent(C),i.isClosePausedRef.current=!1}},j=C=>{!v.contains(C.relatedTarget)&&w()},_=()=>{v.contains(document.activeElement)||w()};return v.addEventListener("focusin",b),v.addEventListener("focusout",j),v.addEventListener("pointermove",b),v.addEventListener("pointerleave",_),window.addEventListener("blur",b),window.addEventListener("focus",w),()=>{v.removeEventListener("focusin",b),v.removeEventListener("focusout",j),v.removeEventListener("pointermove",b),v.removeEventListener("pointerleave",_),window.removeEventListener("blur",b),window.removeEventListener("focus",w)}}},[x,i.isClosePausedRef]);const g=p.useCallback(({tabbingDirection:v})=>{const b=l().map(w=>{const j=w.ref.current,_=[j,...rct(j)];return v==="forwards"?_:_.reverse()});return(v==="forwards"?b.reverse():b).flat()},[l]);return p.useEffect(()=>{const v=f.current;if(v){const y=b=>{const w=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!w){const _=document.activeElement,C=b.shiftKey;if(b.target===v&&C){d.current?.focus();return}const A=g({tabbingDirection:C?"backwards":"forwards"}),M=A.findIndex(O=>O===_);zk(A.slice(M+1))?b.preventDefault():C?d.current?.focus():u.current?.focus()}};return v.addEventListener("keydown",y),()=>v.removeEventListener("keydown",y)}},[l,g]),a.jsxs(Kge,{ref:c,role:"region","aria-label":s.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:x?void 0:"none"},children:[x&&a.jsx(G3,{ref:d,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"forwards"});zk(v)}}),a.jsx(AF.Slot,{scope:r,children:a.jsx(Qa.ol,{tabIndex:-1,...o,ref:h})}),x&&a.jsx(G3,{ref:u,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"backwards"});zk(v)}})]})});Hoe.displayName=Woe;var Goe="ToastFocusProxy",G3=p.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=e,o=HA(Goe,r);return a.jsx(gR,{tabIndex:0,...s,ref:t,style:{position:"fixed"},onFocus:i=>{const l=i.relatedTarget;!o.viewport?.contains(l)&&n()}})});G3.displayName=Goe;var Rj="Toast",Vlt="toast.swipeStart",Wlt="toast.swipeMove",Hlt="toast.swipeCancel",Glt="toast.swipeEnd",Koe=p.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:o,...i}=e,[l,c]=zm({prop:n,defaultProp:s??!0,onChange:o,caller:Rj});return a.jsx($d,{present:r||l,children:a.jsx(Ylt,{open:l,...i,ref:t,onClose:()=>c(!1),onPause:Xc(e.onPause),onResume:Xc(e.onResume),onSwipeStart:aa(e.onSwipeStart,d=>{d.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:aa(e.onSwipeMove,d=>{const{x:u,y:f}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","move"),d.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${f}px`)}),onSwipeCancel:aa(e.onSwipeCancel,d=>{d.currentTarget.setAttribute("data-swipe","cancel"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:aa(e.onSwipeEnd,d=>{const{x:u,y:f}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","end"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${f}px`),c(!1)})})})});Koe.displayName=Rj;var[Klt,Xlt]=Uoe(Rj,{onClose(){}}),Ylt=p.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:l,onPause:c,onResume:d,onSwipeStart:u,onSwipeMove:f,onSwipeCancel:h,onSwipeEnd:m,...x}=e,g=HA(Rj,r),[v,y]=p.useState(null),b=$s(t,k=>y(k)),w=p.useRef(null),j=p.useRef(null),_=s||g.duration,C=p.useRef(0),E=p.useRef(_),S=p.useRef(0),{onToastAdd:A,onToastRemove:M}=g,O=Xc(()=>{v?.contains(document.activeElement)&&g.viewport?.focus(),i()}),I=p.useCallback(k=>{!k||k===1/0||(window.clearTimeout(S.current),C.current=new Date().getTime(),S.current=window.setTimeout(O,k))},[O]);p.useEffect(()=>{const k=g.viewport;if(k){const q=()=>{I(E.current),d?.()},B=()=>{const z=new Date().getTime()-C.current;E.current=E.current-z,window.clearTimeout(S.current),c?.()};return k.addEventListener(W3,B),k.addEventListener(H3,q),()=>{k.removeEventListener(W3,B),k.removeEventListener(H3,q)}}},[g.viewport,_,c,d,I]),p.useEffect(()=>{o&&!g.isClosePausedRef.current&&I(_)},[o,_,g.isClosePausedRef,I]),p.useEffect(()=>(A(),()=>M()),[A,M]);const T=p.useMemo(()=>v?tie(v):null,[v]);return g.viewport?a.jsxs(a.Fragment,{children:[T&&a.jsx(Jlt,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite",children:T}),a.jsx(Klt,{scope:r,onClose:O,children:Km.createPortal(a.jsx(AF.ItemSlot,{scope:r,children:a.jsx(Gge,{asChild:!0,onEscapeKeyDown:aa(l,()=>{g.isFocusedToastEscapeKeyDownRef.current||O(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:a.jsx(Qa.li,{tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":g.swipeDirection,...x,ref:b,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:aa(e.onKeyDown,k=>{k.key==="Escape"&&(l?.(k.nativeEvent),k.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,O()))}),onPointerDown:aa(e.onPointerDown,k=>{k.button===0&&(w.current={x:k.clientX,y:k.clientY})}),onPointerMove:aa(e.onPointerMove,k=>{if(!w.current)return;const q=k.clientX-w.current.x,B=k.clientY-w.current.y,z=!!j.current,F=["left","right"].includes(g.swipeDirection),V=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,me=F?V(0,q):0,be=F?0:V(0,B),U=k.pointerType==="touch"?10:2,L={x:me,y:be},H={originalEvent:k,delta:L};z?(j.current=L,f2(Wlt,f,H,{discrete:!1})):UV(L,g.swipeDirection,U)?(j.current=L,f2(Vlt,u,H,{discrete:!1}),k.target.setPointerCapture(k.pointerId)):(Math.abs(q)>U||Math.abs(B)>U)&&(w.current=null)}),onPointerUp:aa(e.onPointerUp,k=>{const q=j.current,B=k.target;if(B.hasPointerCapture(k.pointerId)&&B.releasePointerCapture(k.pointerId),j.current=null,w.current=null,q){const z=k.currentTarget,F={originalEvent:k,delta:q};UV(q,g.swipeDirection,g.swipeThreshold)?f2(Glt,m,F,{discrete:!0}):f2(Hlt,h,F,{discrete:!0}),z.addEventListener("click",V=>V.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),Jlt=e=>{const{__scopeToast:t,children:r,...n}=e,s=HA(Rj,t),[o,i]=p.useState(!1),[l,c]=p.useState(!1);return ect(()=>i(!0)),p.useEffect(()=>{const d=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(d)},[]),l?null:a.jsx(oy,{asChild:!0,children:a.jsx(gR,{...n,children:o&&a.jsxs(a.Fragment,{children:[s.label," ",r]})})})},Qlt="ToastTitle",Xoe=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(Qa.div,{...n,ref:t})});Xoe.displayName=Qlt;var Zlt="ToastDescription",Yoe=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(Qa.div,{...n,ref:t})});Yoe.displayName=Zlt;var Joe="ToastAction",Qoe=p.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?a.jsx(eie,{altText:r,asChild:!0,children:a.jsx(PF,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${Joe}\`. Expected non-empty \`string\`.`),null)});Qoe.displayName=Joe;var Zoe="ToastClose",PF=p.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,s=Xlt(Zoe,r);return a.jsx(eie,{asChild:!0,children:a.jsx(Qa.button,{type:"button",...n,ref:t,onClick:aa(e.onClick,s.onClose)})})});PF.displayName=Zoe;var eie=p.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...s}=e;return a.jsx(Qa.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:t})});function tie(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),tct(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",o=n.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const i=n.dataset.radixToastAnnounceAlt;i&&t.push(i)}else t.push(...tie(n))}}),t}function f2(e,t,r,{discrete:n}){const s=r.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?SD(s,o):s.dispatchEvent(o)}var UV=(e,t,r=0)=>{const n=Math.abs(e.x),s=Math.abs(e.y),o=n>s;return t==="left"||t==="right"?o&&n>r:!o&&s>r};function ect(e=()=>{}){const t=Xc(e);kl(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function tct(e){return e.nodeType===e.ELEMENT_NODE}function rct(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function zk(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var nct=Voe,rie=Hoe,nie=Koe,aie=Xoe,sie=Yoe,oie=Qoe,iie=PF;const act=nct,lie=Ce.forwardRef(({className:e,...t},r)=>a.jsx(rie,{ref:r,className:Pr("fixed z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));lie.displayName=rie.displayName;const sct=ND("group relative pointer-events-auto flex w-full items-start justify-between gap-4 overflow-hidden rounded-lg border p-4 pr-8 shadow-xl transition-all data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-warning text-black border-warning",destructive:"bg-danger text-white border-danger",success:"bg-success text-white border-success",info:"bg-info text-black border-info",warning:"bg-warning text-black border-warning"}},defaultVariants:{variant:"default"}}),cie=Ce.forwardRef(({className:e,variant:t,...r},n)=>a.jsx(nie,{ref:n,className:Pr(sct({variant:t}),e),...r}));cie.displayName=nie.displayName;const oct=Ce.forwardRef(({className:e,...t},r)=>a.jsx(oie,{ref:r,className:Pr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));oct.displayName=oie.displayName;const die=Ce.forwardRef(({className:e,...t},r)=>a.jsx(iie,{ref:r,className:Pr("absolute right-2 top-2 rounded-md p-1 text-white/80 transition-opacity hover:text-white focus:outline-none focus:ring-2 focus:ring-white/50 group-[.default]:text-black/70 group-[.default]:hover:text-black",e),...t,children:a.jsx(Hc,{className:"h-4 w-4"})}));die.displayName=iie.displayName;const uie=Ce.forwardRef(({className:e,...t},r)=>a.jsx(aie,{ref:r,className:Pr("text-sm font-semibold",e),...t}));uie.displayName=aie.displayName;const fie=Ce.forwardRef(({className:e,...t},r)=>a.jsx(sie,{ref:r,className:Pr("text-sm",e),...t}));fie.displayName=sie.displayName;function ict(){const{toasts:e}=Zs();return a.jsxs(act,{children:[e.map(({id:t,title:r,description:n,action:s,dismiss:o,...i})=>a.jsxs(cie,{...i,children:[a.jsxs("div",{className:"grid gap-1",children:[r&&a.jsx(uie,{children:r}),n&&a.jsx(fie,{children:n})]}),s,a.jsx(die,{onClick:o})]},t)),a.jsx(lie,{})]})}function lct(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(e=>{setInterval(()=>{e.update()},6e4),e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&window.confirm("Nova verso disponvel! Deseja atualizar agora?")&&(t.postMessage({type:"SKIP_WAITING"}),window.location.reload())})})}).catch(e=>{console.error("[SW] Erro ao registrar Service Worker:",e)}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()})})}lct();window.screen?.orientation?.lock&&window.screen.orientation.lock("portrait").catch(e=>{console.log("[Orientation] Lock no suportado ou j bloqueado:",e.message)});window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),window.__installPrompt=e},{passive:!1});window.addEventListener("appinstalled",()=>{window.__installPrompt=null});Uk.createRoot(document.getElementById("root")).render(a.jsx(Yde,{children:a.jsxs(Dwe,{children:[a.jsx($lt,{}),a.jsx(ict,{})]})}));export{gje as _,Gl as c,Us as g};
